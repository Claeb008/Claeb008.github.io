/**
 * ----------------- ThirdPartyNotices -----------------------------------------
 * This file is based on or incorporates material from the projects listed below
 * (collectively, “Third Party Code”).
 * Skype is not the original author of the Third Party Code.
 * The original copyright notice and the license, under which Skype received
 * such Third Party Code, are set forth below.
 * Such licenses and notices are provided for informational purposes only.
 * Skype, not the third party, licenses the Third Party Code to you
 * under the terms set forth in the Terms of Use for the Skype Product.
 * Skype reserves all other rights not expressly granted under this agreement,
 * whether by implication, estoppel or otherwise.
 */

/** License
*The JavaScript Canvas to Blob script is released under the
*MIT license: http://www.opensource.org/licenses/MIT.
*/

/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*! elementQuery | Author: Tyson Matanich (http://matanich.com), 2013 | License: MIT */

/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
 * @version   2.3.0
 */

/*!
 * Knockout JavaScript library v3.4.0
 * (c) Steven Sanderson - http://knockoutjs.com/
 * License: MIT (http://www.opensource.org/licenses/mit-license.php)
 */

/**
 * @license
 * lodash 3.6.0 (Custom Build) <https://lodash.com/>
 * Build: `lodash compat -o ./lodash.js`
 * Copyright 2012-2015 The Dojo Foundation <http://dojofoundation.org/>
 * Based on Underscore.js 1.8.2 <http://underscorejs.org/LICENSE>
 * Copyright 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 * Available under MIT license <https://lodash.com/license>
 *
 * Copyright (c) 2011 Laura Doktorova
 *
 * Software includes portions from jQote2 Copyright (c) 2010 aefxx,
 * http://aefxx.com/ licensed under the MIT license.
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * ""Software""), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED ""AS IS"", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE."
 */

/*!
 *
 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */

/*!
 * Reqwest! A general purpose XHR connection manager
 * license MIT (c) Dustin Diaz 2013
 * https://github.com/ded/reqwest
 ** version 1.0.2
 */

/*!
 * Sizzle CSS Selector Engine v@VERSION
 * http://sizzlejs.com/
 *
 * Copyright 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: @DATE
 */

/**
 * Copyright (c) 2011-2014 Felix Gnass
 * Licensed under the MIT license
 * http://spin.js.org/
 */

//
// usertiming.js
//
// A polyfill for UserTiming (http://www.w3.org/TR/user-timing/)
//
// Copyright 2013 Nic Jansma
// http://nicj.net
//
// https://github.com/nicjansma/usertiming.js
//
// Licensed under the MIT license
//

/* ***********************************
*  * Share on Skype *
*  * THIRD PARTY CODE NOTICE *
*  ***********************************
* This file is based on or incorporates material from the projects listed below (collectively, “Third Party Code”).   Skype is not the original author of the Third Party Code.   The original copyright * notice and the license, under which Skype received such Third Party Code, are set forth below.  Such licenses and notices are provided for informational purposes only.  Skype, not the third party, * licenses the Third Party Code to you under the terms set forth in the Terms of Use for the Skype Product.  Skype reserves all other rights not expressly granted under this agreement, whether by * implication, estoppel or otherwise.
* ------------------------------------------------------------------------------------------------------------------------
* React 0.13.3
*
* Copyright (c) 2013-2015, Facebook, Inc.
*
* For informational purposes only.
*
* All rights reserved.
*
* Redistribution and use in source and binary forms, with or without modification,
* are permitted provided that the following conditions are met:
*
*  * Redistributions of source code must retain the above copyright notice, this
*    list of conditions and the following disclaimer.
*
*  * Redistributions in binary form must reproduce the above copyright notice,
*    this list of conditions and the following disclaimer in the documentation
*    and/or other materials provided with the distribution.
*
*  * Neither the name Facebook nor the names of its contributors may be used to
*    endorse or promote products derived from this software without specific
*    prior written permission.
*
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
* ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
* WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
* DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
* ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
* (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
* LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
* ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
* (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
* ------------------------------------------------------------------------------------------------------------------------
* through 2.3.8
*
* Copyright (c) 2011 Dominic Tarr
*
* Provided for Informational Purposes Only
* MIT License
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE..
* ------------------------------------------------------------------------------------------------------------------------
* base62 0.1.1
*
* Copyright (c) 2012 Andrew Nesbitt
* Provided for Informational Purposes Only
* MIT License
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*
* ------------------------------------------------------------------------------------------------------------------------
*
* amdefine 1.0.0
*
* Copyright (c) 2011-2015 The Dojo Foundation
* Provided for Informational Purposes Only
* MIT License
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*
* ------------------------------------------------------------------------------------------------------------------------
*
* source-map 0.1.31
* Copyright (c) 2009-2011, Mozilla Foundation and contributors
* All rights reserved.
* Provided for Informational Purposes Only
* BSD License
*
* Redistribution and use in source and binary forms, with or without
* modification, are permitted provided that the following conditions are met:
*
* * Redistributions of source code must retain the above copyright notice, this
*   list of conditions and the following disclaimer.
*
* * Redistributions in binary form must reproduce the above copyright notice,
*   this list of conditions and the following disclaimer in the documentation
*   and/or other materials provided with the distribution.
*
* * Neither the names of the Mozilla Foundation nor the names of project
*   contributors may be used to endorse or promote products derived from this
*   software without specific prior written permission.
*
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
* ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
* WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
* DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
* FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
* SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
* CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
* OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
* OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
* ------------------------------------------------------------------------------------------------------------------------
* esprima-fb 13001.1001.0-dev-harmony-fb
*
* Copyright (c) Facebook
* Provided for Informational Purposes Only
* BSD License
*
* All rights reserved.
*
* Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
*
* Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
*
* Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
*
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS ""AS IS"" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*
* ------------------------------------------------------------------------------------------------------------------------
*
* jstransform 10.1.0
*
* Copyright (c) 2013-present, Facebook, Inc.
*
* Provided for Informational Purposes Only
* BSD License
*
* All rights reserved.
*
* Redistribution and use in source and binary forms, with or without modification,
* are permitted provided that the following conditions are met:
*  * Redistributions of source code must retain the above copyright notice, this
*    list of conditions and the following disclaimer.
*  * Redistributions in binary form must reproduce the above copyright notice,
*    this list of conditions and the following disclaimer in the documentation
*    and/or other materials provided with the distribution.
*  * Neither the name Facebook nor the names of its contributors may be used to
*    endorse or promote products derived from this software without specific
*    prior written permission.
*
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS ""AS IS"" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
* ------------------------------------------------------------------------------------------------------------------------
*
* envify 3.4.0
*
* Copyright (c) Hugh Kennedy and Andres Suarez
*
* Provided for Informational Purposes Only
* MIT License
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

/**
 * DOMPurify
 * Copyright 2015 Mario Heiderich
 *
 * Provided for Informational Purposes Only
 * Apache 2.0 License
 * Licensed under the Apache License, Version 2.0 (the License); you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0
 *
 * THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, EITHER EXPRESS OR IMPLIED,
 * INCLUDING WITHOUT LIMITATION ANY IMPLIED WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE, MERCHANTABLITY OR NON-INFRINGEMENT.
 * See the Apache Version 2.0 License for specific language governing permissions and limitations under the License.
 */

/**
 * ----------------- End of ThirdPartyNotices ----------------------------------
 */
(function(){var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("amd",function(){}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-polyfill-initializer/lib/string",["require","exports"],e)}(function(e,t){function n(e){var t=this;return t<e?-1:t>e?1:0}function r(e,t){return typeof t!="number"&&(t=0),t+e.length>this.length?!1:this.indexOf(e,t)!==-1}t.localeCompare=n,t.includes=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-polyfill-initializer/lib/function",["require","exports"],e)}(function(e,t){function n(){Object.defineProperty(Function.prototype,"name",{get:function(){try{var e=this.toString().match(/\s*function\s+([_\$\w\d]*)\.*/);return e&&e.length>1?e[1]:""}catch(t){return""}}})}t.polyfillFunctionName=n}),function(){function e(e){return typeof e=="function"||typeof e=="object"&&e!==null}function t(e){return typeof e=="function"}function n(e){return typeof e=="object"&&e!==null}function l(e){a=e}function c(e){f=e}function g(){var e=process.nextTick,t=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(t)&&t[1]==="0"&&t[2]==="10"&&(e=setImmediate),function(){e(x)}}function y(){return function(){u(x)}}function b(){var e=0,t=new d(x),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function w(){var e=new MessageChannel;return e.port1.onmessage=x,function(){e.port2.postMessage(0)}}function E(){return function(){setTimeout(x,1)}}function x(){for(var e=0;e<s;e+=2){var t=S[e],n=S[e+1];t(n),S[e]=undefined,S[e+1]=undefined}s=0}function T(){try{var e=require,t=e("vertx");return u=t.runOnLoop||t.runOnContext,y()}catch(n){return E()}}function C(){}function M(){return new TypeError("You cannot resolve a promise with itself")}function _(){return new TypeError("A promises callback cannot return that same promise.")}function D(e){try{return e.then}catch(t){return O.error=t,O}}function P(e,t,n,r){try{e.call(t,n,r)}catch(i){return i}}function H(e,t,n){f(function(e){var r=!1,i=P(n,t,function(n){if(r)return;r=!0,t!==n?F(e,n):q(e,n)},function(t){if(r)return;r=!0,R(e,t)},"Settle: "+(e._label||" unknown promise"));!r&&i&&(r=!0,R(e,i))},e)}function B(e,t){t._state===L?q(e,t._result):t._state===A?R(e,t._result):U(t,undefined,function(t){F(e,t)},function(t){R(e,t)})}function j(e,n){if(n.constructor===e.constructor)B(e,n);else{var r=D(n);r===O?R(e,O.error):r===undefined?q(e,n):t(r)?H(e,n,r):q(e,n)}}function F(t,n){t===n?R(t,M()):e(n)?j(t,n):q(t,n)}function I(e){e._onerror&&e._onerror(e._result),z(e)}function q(e,t){if(e._state!==k)return;e._result=t,e._state=L,e._subscribers.length!==0&&f(z,e)}function R(e,t){if(e._state!==k)return;e._state=A,e._result=t,f(I,e)}function U(e,t,n,r){var i=e._subscribers,s=i.length;e._onerror=null,i[s]=t,i[s+L]=n,i[s+A]=r,s===0&&e._state&&f(z,e)}function z(e){var t=e._subscribers,n=e._state;if(t.length===0)return;var r,i,s=e._result;for(var o=0;o<t.length;o+=3)r=t[o],i=t[o+n],r?$(n,r,i,s):i(s);e._subscribers.length=0}function W(){this.error=null}function V(e,t){try{return e(t)}catch(n){return X.error=n,X}}function $(e,n,r,i){var s=t(r),o,u,a,f;if(s){o=V(r,i),o===X?(f=!0,u=o.error,o=null):a=!0;if(n===o){R(n,_());return}}else o=i,a=!0;n._state===k&&(s&&a?F(n,o):f?R(n,u):e===L?q(n,o):e===A&&R(n,o))}function J(e,t){try{t(function(n){F(e,n)},function(n){R(e,n)})}catch(n){R(e,n)}}function K(e,t){var n=this;n._instanceConstructor=e,n.promise=new e(C),n._validateInput(t)?(n._input=t,n.length=t.length,n._remaining=t.length,n._init(),n.length===0?q(n.promise,n._result):(n.length=n.length||0,n._enumerate(),n._remaining===0&&q(n.promise,n._result))):R(n.promise,n._validationError())}function G(e){return(new Q(this,e)).promise}function Z(e){function s(e){F(n,e)}function o(e){R(n,e)}var t=this,n=new t(C);if(!i(e))return R(n,new TypeError("You must pass an array to race.")),n;var r=e.length;for(var u=0;n._state===k&&u<r;u++)U(t.resolve(e[u]),undefined,s,o);return n}function tt(e){var t=this;if(e&&typeof e=="object"&&e.constructor===t)return e;var n=new t(C);return F(n,e),n}function rt(e){var t=this,n=new t(C);return R(n,e),n}function ot(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function ut(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function ft(e){this._id=st++,this._state=undefined,this._result=undefined,this._subscribers=[],C!==e&&(t(e)||ot(),this instanceof ft||ut(),J(this,e))}function lt(){var e;if(typeof global!="undefined")e=global;else if(typeof self!="undefined")e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;if(n&&Object.prototype.toString.call(n.resolve())==="[object Promise]"&&!n.cast)return;e.Promise=at}var r;Array.isArray?r=Array.isArray:r=function(e){return Object.prototype.toString.call(e)==="[object Array]"};var i=r,s=0,o={}.toString,u,a,f=function(t,n){S[s]=t,S[s+1]=n,s+=2,s===2&&(a?a(x):N())},h=typeof window!="undefined"?window:undefined,p=h||{},d=p.MutationObserver||p.WebKitMutationObserver,v=typeof process!="undefined"&&{}.toString.call(process)==="[object process]",m=typeof Uint8ClampedArray!="undefined"&&typeof importScripts!="undefined"&&typeof MessageChannel!="undefined",S=new Array(1e3),N;v?N=g():d?N=b():m?N=w():h===undefined&&typeof require=="function"?N=T():N=E();var k=void 0,L=1,A=2,O=new W,X=new W;K.prototype._validateInput=function(e){return i(e)},K.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},K.prototype._init=function(){this._result=new Array(this.length)};var Q=K;K.prototype._enumerate=function(){var e=this,t=e.length,n=e.promise,r=e._input;for(var i=0;n._state===k&&i<t;i++)e._eachEntry(r[i],i)},K.prototype._eachEntry=function(e,t){var r=this,i=r._instanceConstructor;n(e)?e.constructor===i&&e._state!==k?(e._onerror=null,r._settledAt(e._state,t,e._result)):r._willSettleAt(i.resolve(e),t):(r._remaining--,r._result[t]=e)},K.prototype._settledAt=function(e,t,n){var r=this,i=r.promise;i._state===k&&(r._remaining--,e===A?R(i,n):r._result[t]=n),r._remaining===0&&q(i,r._result)},K.prototype._willSettleAt=function(e,t){var n=this;U(e,undefined,function(e){n._settledAt(L,t,e)},function(e){n._settledAt(A,t,e)})};var Y=G,et=Z,nt=tt,it=rt,st=0,at=ft;ft.all=Y,ft.race=et,ft.resolve=nt,ft.reject=it,ft._setScheduler=l,ft._setAsap=c,ft._asap=f,ft.prototype={constructor:ft,then:function(e,t){var n=this,r=n._state;if(r===L&&!e||r===A&&!t)return this;var i=new this.constructor(C),s=n._result;if(r){var o=arguments[r-1];f(function(){$(r,i,o,s)})}else U(n,i,e,t);return i},"catch":function(e){return this.then(null,e)}};var ct=lt,ht={Promise:at,polyfill:ct};typeof define=="function"&&define.amd?define("es6-promise/dist/es6-promise",[],function(){return ht}):typeof module!="undefined"&&module.exports?module.exports=ht:typeof this!="undefined"&&(this.ES6Promise=ht),ct()}.call(this),define("es6-promise",["es6-promise/dist/es6-promise"],function(e){return e}),function(e){var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,n=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),r=n&&e.Uint8Array&&function(){try{return(new Blob([new Uint8Array(100)])).size===100}catch(e){return!1}}(),i=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,s=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,o=(n||i)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,o,u,a,f,l,c,h,p;t=e.match(s);if(!t)throw new Error("invalid data URI");o=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII"),u=!!t[4],a=e.slice(t[0].length),u?f=atob(a):f=decodeURIComponent(a),l=new ArrayBuffer(f.length),c=new Uint8Array(l);for(h=0;h<f.length;h+=1)c[h]=f.charCodeAt(h);return n?new Blob([r?c:l],{type:o}):(p=new i,p.append(l),p.getBlob(o))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,n,r){r&&t.toDataURL&&o?e(o(this.toDataURL(n,r))):e(this.mozGetAsFile("blob",n))}:t.toDataURL&&o&&(t.toBlob=function(e,t,n){e(o(this.toDataURL(t,n)))})),typeof define=="function"&&define.amd?define("blueimp-canvas-to-blob/js/canvas-to-blob",[],function(){return o}):typeof module=="object"&&module.exports?module.exports=o:e.dataURLtoBlob=o}(window),define("blueimp-canvas-to-blob",["blueimp-canvas-to-blob/js/canvas-to-blob"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-polyfill-initializer/lib/polyfillInitializer",["require","exports","./string","./function","es6-promise","blueimp-canvas-to-blob"],e)}(function(e,t){var n=e("./string"),r=e("./function"),i=e("es6-promise");e("blueimp-canvas-to-blob"),i.polyfill(),String.prototype.localeCompare===undefined&&(String.prototype.localeCompare=n.localeCompare),Function.prototype.name===undefined&&r.polyfillFunctionName(),String.prototype.includes===undefined&&(String.prototype.includes=n.includes)}),define("swx-polyfill-initializer",["swx-polyfill-initializer/lib/polyfillInitializer"],function(e){return e}),function(){function At(e,t){if(e!==t){var n=e===e,r=t===t;if(e>t||!n||typeof e=="undefined"&&r)return 1;if(e<t||!r||typeof t=="undefined"&&n)return-1}return 0}function Ot(e,t,n){var r=e.length,i=n?r:-1;while(n?i--:++i<r)if(t(e[i],i,e))return i;return-1}function Mt(e,t,n){if(t!==t)return Ut(e,n);var r=n-1,i=e.length;while(++r<i)if(e[r]===t)return r;return-1}function _t(e){return typeof e=="function"||!1}function Dt(e){return typeof e=="string"?e:e==null?"":e+""}function Pt(e){return e.charCodeAt(0)}function Ht(e,t){var n=-1,r=e.length;while(++n<r&&t.indexOf(e.charAt(n))>-1);return n}function Bt(e,t){var n=e.length;while(n--&&t.indexOf(e.charAt(n))>-1);return n}function jt(e,t){return At(e.criteria,t.criteria)||e.index-t.index}function Ft(e,t,n){var r=-1,i=e.criteria,s=t.criteria,o=i.length,u=n.length;while(++r<o){var a=At(i[r],s[r]);if(a)return r>=u?a:a*(n[r]?1:-1)}return e.index-t.index}function It(e){return gt[e]}function qt(e){return yt[e]}function Rt(e){return"\\"+Et[e]}function Ut(e,t,n){var r=e.length,i=t+(n?0:-1);while(n?i--:++i<r){var s=e[i];if(s!==s)return i}return-1}function Wt(e){return!!e&&typeof e=="object"}function Xt(e){return e<=160&&e>=9&&e<=13||e==32||e==160||e==5760||e==6158||e>=8192&&(e<=8202||e==8232||e==8233||e==8239||e==8287||e==12288||e==65279)}function Vt(e,t){var n=-1,r=e.length,i=-1,s=[];while(++n<r)e[n]===t&&(e[n]=b,s[++i]=n);return s}function $t(e,t){var n,r=-1,i=e.length,s=-1,o=[];while(++r<i){var u=e[r],a=t?t(u,r,e):u;if(!r||n!==a)n=a,o[++s]=u}return o}function Jt(e){var t=-1,n=e.length;while(++t<n&&Xt(e.charCodeAt(t)));return t}function Kt(e){var t=e.length;while(t--&&Xt(e.charCodeAt(t)));return t}function Qt(e){return bt[e]}function Gt(C){function zn(e){if(Wt(e)&&!ru(e)&&!(e instanceof $n)){if(e instanceof Xn)return e;if(nn.call(e,"__chain__")&&nn.call(e,"__wrapped__"))return ls(e)}return new Xn(e)}function Wn(){}function Xn(e,t,n){this.__wrapped__=e,this.__actions__=n||[],this.__chain__=!!t}function $n(e){this.__wrapped__=e,this.__actions__=null,this.__dir__=1,this.__dropCount__=0,this.__filtered__=!1,this.__iteratees__=null,this.__takeCount__=Dn,this.__views__=null}function Jn(){var e=this.__actions__,t=this.__iteratees__,n=this.__views__,r=new $n(this.__wrapped__);return r.__actions__=e?sr(e):null,r.__dir__=this.__dir__,r.__filtered__=this.__filtered__,r.__iteratees__=t?sr(t):null,r.__takeCount__=this.__takeCount__,r.__views__=n?sr(n):null,r}function Kn(){if(this.__filtered__){var e=new $n(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Qn(){var e=this.__wrapped__.value();if(!ru(e))return oi(e,this.__actions__);var t=this.__dir__,n=t<0,r=Vi(0,e.length,this.__views__),i=r.start,s=r.end,o=s-i,u=n?s:i-1,a=kn(o,this.__takeCount__),f=this.__iteratees__,l=f?f.length:0,c=0,h=[];e:while(o--&&c<a){u+=t;var p=-1,d=e[u];while(++p<l){var y=f[p],b=y.iteratee,w=y.type;if(w==v){y.done&&(n?u>y.index:u<y.index)&&(y.count=0,y.done=!1),y.index=u;if(!y.done){var E=y.limit;if(!(y.done=E>-1?y.count++>=E:!b(d)))continue e}}else{var S=b(d);if(w==g)d=S;else if(!S){if(w==m)continue e;break e}}}h[c++]=d}return h}function Gn(){this.__data__={}}function Yn(e){return this.has(e)&&delete this.__data__[e]}function Zn(t){return t=="__proto__"?e:this.__data__[t]}function er(e){return e!="__proto__"&&nn.call(this.__data__,e)}function tr(e,t){return e!="__proto__"&&(this.__data__[e]=t),this}function nr(e){var t=e?e.length:0;this.data={hash:xn(null),set:new mn};while(t--)this.push(e[t])}function rr(e,t){var n=e.data,r=typeof t=="string"||hu(t)?n.set.has(t):n.hash[t];return r?0:-1}function ir(e){var t=this.data;typeof e=="string"||hu(e)?t.set.add(e):t.hash[e]=!0}function sr(e,t){var n=-1,r=e.length;t||(t=O(r));while(++n<r)t[n]=e[n];return t}function or(e,t){var n=-1,r=e.length;while(++n<r)if(t(e[n],n,e)===!1)break;return e}function ur(e,t){var n=e.length;while(n--)if(t(e[n],n,e)===!1)break;return e}function ar(e,t){var n=-1,r=e.length;while(++n<r)if(!t(e[n],n,e))return!1;return!0}function fr(e,t){var n=-1,r=e.length,i=-1,s=[];while(++n<r){var o=e[n];t(o,n,e)&&(s[++i]=o)}return s}function lr(e,t){var n=-1,r=e.length,i=O(r);while(++n<r)i[n]=t(e[n],n,e);return i}function cr(e){var t=-1,n=e.length,r=_n;while(++t<n){var i=e[t];i>r&&(r=i)}return r}function hr(e){var t=-1,n=e.length,r=Dn;while(++t<n){var i=e[t];i<r&&(r=i)}return r}function pr(e,t,n,r){var i=-1,s=e.length;r&&s&&(n=e[++i]);while(++i<s)n=t(n,e[i],i,e);return n}function dr(e,t,n,r){var i=e.length;r&&i&&(n=e[--i]);while(i--)n=t(n,e[i],i,e);return n}function vr(e,t){var n=-1,r=e.length;while(++n<r)if(t(e[n],n,e))return!0;return!1}function mr(e){var t=e.length,n=0;while(t--)n+=+e[t]||0;return n}function gr(e,t){return typeof e=="undefined"?t:e}function yr(e,t,n,r){return typeof e=="undefined"||!nn.call(r,n)?t:e}function br(e,t,n){var r=ju(t);if(!n)return Er(t,e,r);var i=-1,s=r.length;while(++i<s){var o=r[i],u=e[o],a=n(u,t[o],o,e,t);if((a===a?a!==u:u===u)||typeof u=="undefined"&&!(o in e))e[o]=a}return e}function wr(t,n){var r=-1,i=t.length,s=Zi(i),o=n.length,u=O(o);while(++r<o){var a=n[r];s?(a=parseFloat(a),u[r]=Qi(a,i)?t[a]:e):u[r]=t[a]}return u}function Er(e,t,n){n||(n=t,t={});var r=-1,i=n.length;while(++r<i){var s=n[r];t[s]=e[s]}return t}function Sr(e,t,n){var r=typeof e;return r=="function"?typeof t=="undefined"?e:fi(e,t,n):e==null?Ea:r=="object"?Wr(e):typeof t=="undefined"?Jr(e+""):Xr(e+"",t)}function xr(e,t,n,r,i,s,o){var u;n&&(u=i?n(e,r,i):n(e));if(typeof u!="undefined")return u;if(!hu(e))return e;var a=ru(e);if(a){u=$i(e);if(!t)return sr(e,u)}else{var f=sn.call(e),l=f==N;if(!(f==L||f==w||l&&!i))return vt[f]?Ki(e,f,t):i?e:{};if(zt(e))return i?e:{};u=Ji(l?{}:e);if(!t)return Er(e,u,ju(e))}s||(s=[]),o||(o=[]);var c=s.length;while(c--)if(s[c]==e)return o[c];return s.push(e),o.push(u),(a?or:jr)(e,function(r,i){u[i]=xr(r,t,n,i,e,s,o)}),u}function Nr(t,n,r){if(typeof t!="function")throw new Tt(y);return gn(function(){t.apply(e,r)},n)}function Cr(e,t){var n=e?e.length:0,r=[];if(!n)return r;var i=-1,s=Xi(),o=s==Mt,u=o&&t.length>=200?yi(t):null,a=t.length;u&&(s=rr,o=!1,t=u);e:while(++i<n){var f=e[i];if(o&&f===f){var l=a;while(l--)if(t[l]===f)continue e;r.push(f)}else s(t,f,0)<0&&r.push(f)}return r}function Ar(e,t){var n=!0;return kr(e,function(e,r,i){return n=!!t(e,r,i),n}),n}function Or(e,t,n,r){var i=e.length;n=n==null?0:+n||0,n<0&&(n=-n>i?0:i+n),r=typeof r=="undefined"||r>i?i:+r||0,r<0&&(r+=i),i=n>r?0:r>>>0,n>>>=0;while(n<i)e[n++]=t;return e}function Mr(e,t){var n=[];return kr(e,function(e,r,i){t(e,r,i)&&n.push(e)}),n}function _r(e,t,n,r){var i;return n(e,function(e,n,s){if(t(e,n,s))return i=r?n:e,!1}),i}function Dr(e,t,n){var r=-1,i=e.length,s=-1,o=[];while(++r<i){var u=e[r];if(Wt(u)&&Zi(u.length)&&(ru(u)||nu(u))){t&&(u=Dr(u,t,n));var a=-1,f=u.length;o.length+=f;while(++a<f)o[++s]=u[a]}else n||(o[++s]=u)}return o}function Br(e,t){return Pr(e,t,Fu)}function jr(e,t){return Pr(e,t,ju)}function Fr(e,t){return Hr(e,t,ju)}function Ir(e,t){var n=-1,r=t.length,i=-1,s=[];while(++n<r){var o=t[n];cu(e[o])&&(s[++i]=o)}return s}function qr(e,t,n,r,i,s){if(e===t)return e!==0||1/e==1/t;var o=typeof e,u=typeof t;return o!="function"&&o!="object"&&u!="function"&&u!="object"||e==null||t==null?e!==e&&t!==t:Rr(e,t,qr,n,r,i,s)}function Rr(e,t,n,r,i,s,o){var u=ru(e),a=ru(t),f=E,l=E;u||(f=sn.call(e),f==w?f=L:f!=L&&(u=Eu(e))),a||(l=sn.call(t),l==w?l=L:l!=L&&(a=Eu(t)));var c=(f==L||i&&f==N)&&!zt(e),h=(l==L||i&&l==N)&&!zt(t),p=f==l;if(p&&!u&&!c)return Ii(e,t,f);if(i){if(!p&&(!c||!h))return!1}else{var d=c&&nn.call(e,"__wrapped__"),v=h&&nn.call(t,"__wrapped__");if(d||v)return n(d?e.value():e,v?t.value():t,r,i,s,o);if(!p)return!1}s||(s=[]),o||(o=[]);var m=s.length;while(m--)if(s[m]==e)return o[m]==t;s.push(e),o.push(t);var g=(u?Fi:qi)(e,t,n,r,i,s,o);return s.pop(),o.pop(),g}function Ur(t,n,r,i,s){var o=-1,u=n.length,a=!s;while(++o<u)if(a&&i[o]?r[o]!==t[n[o]]:!(n[o]in t))return!1;o=-1;while(++o<u){var f=n[o],l=t[f],c=r[o];if(a&&i[o])var h=typeof l!="undefined"||f in t;else h=s?s(l,c,f):e,typeof h=="undefined"&&(h=qr(c,l,s,!0));if(!h)return!1}return!0}function zr(e,t){var n=[];return kr(e,function(e,r,i){n.push(t(e,r,i))}),n}function Wr(e){var t=ju(e),n=t.length;if(!n)return wa(!0);if(n==1){var r=t[0],i=e[r];if(es(i))return function(e){return e!=null&&e[r]===i&&(typeof i!="undefined"||r in fs(e))}}var s=O(n),o=O(n);while(n--)i=e[t[n]],s[n]=i,o[n]=es(i);return function(e){return e!=null&&Ur(fs(e),t,s,o)}}function Xr(e,t){return es(t)?function(n){return n!=null&&n[e]===t&&(typeof t!="undefined"||e in fs(n))}:function(n){return n!=null&&qr(t,n[e],null,!0)}}function Vr(t,n,r,i,s){if(!hu(t))return t;var o=Zi(n.length)&&(ru(n)||Eu(n));return(o?or:jr)(n,function(n,u,a){if(Wt(n))return i||(i=[]),s||(s=[]),$r(t,a,u,Vr,r,i,s);var f=t[u],l=r?r(f,n,u,t,a):e,c=typeof l=="undefined";c&&(l=n),(o||typeof l!="undefined")&&(c||(l===l?l!==f:f===f))&&(t[u]=l)}),t}function $r(t,n,r,i,s,o,u){var a=o.length,f=n[r];while(a--)if(o[a]==f){t[r]=u[a];return}var l=t[r],c=s?s(l,f,r,t,n):e,h=typeof c=="undefined";h&&(c=f,Zi(f.length)&&(ru(f)||Eu(f))?c=ru(l)?l:l&&l.length?sr(l):[]:yu(f)||nu(f)?c=nu(l)?Tu(l):yu(l)?l:{}:h=!1),o.push(f),u.push(c);if(h)t[r]=i(c,f,s,o,u);else if(c===c?c!==l:l===l)t[r]=c}function Jr(t){return function(n){return n==null?e:n[t]}}function Kr(e,t){return e+hn(Mn()*(t-e+1))}function Qr(e,t,n,r,i){return i(e,function(e,i,s){n=r?(r=!1,e):t(n,e,i,s)}),n}function Yr(e,t,n){var r=-1,i=e.length;t=t==null?0:+t||0,t<0&&(t=-t>i?0:i+t),n=typeof n=="undefined"||n>i?i:+n||0,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;var s=O(i);while(++r<i)s[r]=e[r+t];return s}function Zr(e,t){var n;return kr(e,function(e,r,i){return n=t(e,r,i),!n}),!!n}function ei(e,t){var n=e.length;e.sort(t);while(n--)e[n]=e[n].value;return e}function ti(t,n,r){var i=-1,s=t.length,o=Zi(s)?O(s):[];return kr(t,function(t){var r=n.length,s=O(r);while(r--)s[r]=t==null?e:t[n[r]];o[++i]={criteria:s,index:i,value:t}}),ei(o,function(e,t){return Ft(e,t,r)})}function ni(e,t){var n=0;return kr(e,function(e,r,i){n+=+t(e,r,i)||0}),n}function ri(e,t){var n=-1,r=Xi(),i=e.length,s=r==Mt,o=s&&i>=200,u=o?yi():null,a=[];u?(r=rr,s=!1):(o=!1,u=t?[]:a);e:while(++n<i){var f=e[n],l=t?t(f,n,e):f;if(s&&f===f){var c=u.length;while(c--)if(u[c]===l)continue e;t&&u.push(l),a.push(f)}else r(u,l,0)<0&&((t||o)&&u.push(l),a.push(f))}return a}function ii(e,t){var n=-1,r=t.length,i=O(r);while(++n<r)i[n]=e[t[n]];return i}function si(e,t,n,r){var i=e.length,s=r?i:-1;while((r?s--:++s<i)&&t(e[s],s,e));return n?Yr(e,r?0:s,r?s+1:i):Yr(e,r?s+1:0,r?i:s)}function oi(e,t){var n=e;n instanceof $n&&(n=n.value());var r=-1,i=t.length;while(++r<i){var s=[n],o=t[r];dn.apply(s,o.args),n=o.func.apply(o.thisArg,s)}return n}function ui(e,t,n){var r=0,i=e?e.length:r;if(typeof t=="number"&&t===t&&i<=Bn){while(r<i){var s=r+i>>>1,o=e[s];(n?o<=t:o<t)?r=s+1:i=s}return i}return ai(e,t,Ea,n)}function ai(e,t,n,r){t=n(t);var i=0,s=e?e.length:0,o=t!==t,u=typeof t=="undefined";while(i<s){var a=hn((i+s)/2),f=n(e[a]),l=f===f;if(o)var c=l||r;else u?c=l&&(r||typeof f!="undefined"):c=r?f<=t:f<t;c?i=a+1:s=a}return kn(s,Hn)}function fi(e,t,n){if(typeof e!="function")return Ea;if(typeof t=="undefined")return e;switch(n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)};case 5:return function(n,r,i,s,o){return e.call(t,n,r,i,s,o)}}return function(){return e.apply(t,arguments)}}function li(e){return fn.call(e,0)}function ci(e,t,n){var r=n.length,i=-1,s=Cn(e.length-r,0),o=-1,u=t.length,a=O(s+u);while(++o<u)a[o]=t[o];while(++i<r)a[n[i]]=e[i];while(s--)a[o++]=e[i++];return a}function hi(e,t,n){var r=-1,i=n.length,s=-1,o=Cn(e.length-i,0),u=-1,a=t.length,f=O(o+a);while(++s<o)f[s]=e[s];var l=s;while(++u<a)f[l+u]=t[u];while(++r<i)f[l+n[r]]=e[s++];return f}function pi(e,t){return function(n,r,i){var s=t?t():{};r=Ui(r,i,3);if(ru(n)){var o=-1,u=n.length;while(++o<u){var a=n[o];e(s,a,r(a,o,n),n)}}else kr(n,function(t,n,i){e(s,t,r(t,n,i),i)});return s}}function di(e){return function(){var t=arguments,n=t.length,r=t[0];if(n<2||r==null)return r;var i=t[n-2],s=t[n-1],o=t[3];n>3&&typeof i=="function"?(i=fi(i,s,5),n-=2):(i=n>2&&typeof s=="function"?s:null,n-=i?1:0),o&&Gi(t[1],t[2],o)&&(i=n==3?null:i,n=2);var u=0;while(++u<n){var a=t[u];a&&e(r,a,i)}return r}}function vi(e,t){return function(n,r){var i=n?n.length:0;if(!Zi(i))return e(n,r);var s=t?i:-1,o=fs(n);while(t?s--:++s<i)if(r(o[s],s,o)===!1)break;return n}}function mi(e){return function(t,n,r){var i=fs(t),s=r(t),o=s.length,u=e?o:-1;while(e?u--:++u<o){var a=s[u];if(n(i[a],a,i)===!1)break}return t}}function gi(e,t){function r(){var i=this&&this!==Lt&&this instanceof r?n:e;return i.apply(t,arguments)}var n=wi(e);return r}function bi(e){return function(t){var n=-1,r=ga(Yu(t)),i=r.length,s="";while(++n<i)s=e(s,r[n],n);return s}}function wi(e){return function(){var t=Tr(e.prototype),n=e.apply(t,arguments);return hu(n)?n:t}}function Ei(e){function t(n,r,i){i&&Gi(n,r,i)&&(r=null);var s=ji(n,e,null,null,null,null,null,r);return s.placeholder=t.placeholder,s}return t}function Si(e,t){return function(n,r,i){i&&Gi(n,r,i)&&(r=null);var s=Ui(),o=r==null;if(s!==Sr||!o)o=!1,r=s(r,i,3);if(o){var u=ru(n);if(!!u||!wu(n))return e(u?n:as(n));r=Pt}return Ri(n,r,t)}}function xi(t,n){return function(r,i,s){i=Ui(i,s,3);if(ru(r)){var o=Ot(r,i,n);return o>-1?r[o]:e}return _r(r,i,t)}}function Ti(e){return function(t,n,r){return!t||!t.length?-1:(n=Ui(n,r,3),Ot(t,n,e))}}function Ni(e){return function(t,n,r){return n=Ui(n,r,3),_r(t,n,e,!0)}}function Ci(e){return function(){var t=arguments.length;if(!t)return function(){return arguments[0]};var n,r=e?t:-1,i=0,s=O(t);while(e?r--:++r<t){var o=s[i++]=arguments[r];if(typeof o!="function")throw new Tt(y);var u=n?"":Wi(o);n=u=="wrapper"?new Xn([]):n}r=n?-1:t;while(++r<t){o=s[r],u=Wi(o);var a=u=="wrapper"?zi(o):null;a&&Yi(a[0])?n=n[Wi(a[0])].apply(n,a[3]):n=o.length==1&&Yi(o)?n[u]():n.thru(o)}return function(){var e=arguments;if(n&&e.length==1&&ru(e[0]))return n.plant(e[0]).value();var r=0,i=s[r].apply(this,e);while(++r<t)i=s[r].call(this,i);return i}}}function ki(e,t){return function(n,r,i){return typeof r=="function"&&typeof i=="undefined"&&ru(n)?e(n,r):t(n,fi(r,i,3))}}function Li(e){return function(t,n,r){if(typeof n!="function"||typeof r!="undefined")n=fi(n,r,3);return e(t,n,Fu)}}function Ai(e){return function(t,n,r){if(typeof n!="function"||typeof r!="undefined")n=fi(n,r,3);return e(t,n)}}function Oi(e){return function(t,n,r){return t=Dt(t),t&&(e?t:"")+Pi(t,n,r)+(e?"":t)}}function Mi(e){var t=Qo(function(n,r){var i=Vt(r,t.placeholder);return ji(n,e,null,r,i)});return t}function _i(e,t){return function(n,r,i,s){var o=arguments.length<3;return typeof r=="function"&&typeof s=="undefined"&&ru(n)?e(n,r,i,o):Qr(n,Ui(r,s,4),i,o,t)}}function Di(t,l,c,h,p,d,v,m,g,y){function k(){var i=arguments.length,s=i,o=O(i);while(s--)o[s]=arguments[s];h&&(o=ci(o,h,p)),d&&(o=hi(o,d,v));if(S||T){var f=k.placeholder,L=Vt(o,f);i-=L.length;if(i<y){var A=m?sr(m):null,M=Cn(y-i,0),_=S?L:null,D=S?null:L,P=S?o:null,H=S?null:o;l|=S?u:a,l&=~(S?a:u),x||(l&=~(n|r));var B=[t,l,c,P,_,H,D,A,g,M],j=Di.apply(e,B);return Yi(t)&&ss(j,B),j.placeholder=f,j}}var F=w?c:this;E&&(t=F[C]),m&&(o=is(o,m)),b&&g<o.length&&(o.length=g);var I=this&&this!==Lt&&this instanceof k?N||wi(t):t;return I.apply(F,o)}var b=l&f,w=l&n,E=l&r,S=l&s,x=l&i,T=l&o,N=!E&&wi(t),C=t;return k}function Pi(e,t,n){var r=e.length;t=+t;if(r>=t||!Tn(t))return"";var i=t-r;return n=n==null?" ":n+"",ua(n,ln(i/n.length)).slice(0,i)}function Hi(e,t,r,i){function u(){var t=-1,n=arguments.length,a=-1,f=i.length,l=O(n+f);while(++a<f)l[a]=i[a];while(n--)l[a++]=arguments[++t];var c=this&&this!==Lt&&this instanceof u?o:e;return c.apply(s?r:this,l)}var s=t&n,o=wi(e);return u}function Bi(e){return function(t,n,r,i){var s=Ui(r);return s===Sr&&r==null?ui(t,n,e):ai(t,n,s(r,i,1),e)}}function ji(t,i,s,o,f,l,c,h){var p=i&r;if(!p&&typeof t!="function")throw new Tt(y);var d=o?o.length:0;d||(i&=~(u|a),o=f=null),d-=f?f.length:0;if(i&a){var v=o,m=f;o=f=null}var g=p?null:zi(t),b=[t,i,s,o,f,v,m,l,c,h];g&&(ts(b,g),i=b[1],h=b[9]),b[9]=h==null?p?0:t.length:Cn(h-d,0)||0;if(i==n)var w=gi(b[0],b[2]);else i!=u&&i!=(n|u)||!!b[4].length?w=Di.apply(e,b):w=Hi.apply(e,b);var E=g?Gr:ss;return E(w,b)}function Fi(t,n,r,i,s,o,u){var a=-1,f=t.length,l=n.length,c=!0;if(f!=l&&!(s&&l>f))return!1;while(c&&++a<f){var h=t[a],p=n[a];c=e,i&&(c=s?i(p,h,a):i(h,p,a));if(typeof c=="undefined")if(s){var d=l;while(d--){p=n[d],c=h&&h===p||r(h,p,i,s,o,u);if(c)break}}else c=h&&h===p||r(h,p,i,s,o,u)}return!!c}function Ii(e,t,n){switch(n){case S:case x:return+e==+t;case T:return e.name==t.name&&e.message==t.message;case k:return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case A:case M:return e==t+""}return!1}function qi(t,n,r,i,s,o,u){var a=ju(t),f=a.length,l=ju(n),c=l.length;if(f!=c&&!s)return!1;var h=s,p=-1;while(++p<f){var d=a[p],v=s?d in n:nn.call(n,d);if(v){var m=t[d],g=n[d];v=e,i&&(v=s?i(g,m,d):i(m,g,d)),typeof v=="undefined"&&(v=m&&m===g||r(m,g,i,s,o,u))}if(!v)return!1;h||(h=d=="constructor")}if(!h){var y=t.constructor,b=n.constructor;if(y!=b&&"constructor"in t&&"constructor"in n&&!(typeof y=="function"&&y instanceof y&&typeof b=="function"&&b instanceof b))return!1}return!0}function Ri(e,t,n){var r=n?Dn:_n,i=r,s=i;return kr(e,function(e,o,u){var a=t(e,o,u);if((n?a<i:a>i)||a===r&&a===s)i=a,s=e}),s}function Ui(e,t,n){var r=zn.callback||ba;return r=r===ba?Sr:r,n?r(e,t,n):r}function Xi(e,t,n){var r=zn.indexOf||Ts;return r=r===Ts?Mt:r,e?r(e,t,n):r}function Vi(e,t,n){var r=-1,i=n?n.length:0;while(++r<i){var s=n[r],o=s.size;switch(s.type){case"drop":e+=o;break;case"dropRight":t-=o;break;case"take":t=kn(t,e+o);break;case"takeRight":e=Cn(e,t-o)}}return{start:e,end:t}}function $i(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&nn.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Ji(e){var t=e.constructor;return typeof t=="function"&&t instanceof t||(t=Et),new t}function Ki(e,t,n){var r=e.constructor;switch(t){case D:return li(e);case S:case x:return new r(+e);case P:case H:case B:case j:case F:case I:case q:case R:case U:r instanceof r&&(r=Rn[t]);var i=e.buffer;return new r(n?li(i):i,e.byteOffset,e.length);case k:case M:return new r(e);case A:var s=new r(e.source,tt.exec(e));s.lastIndex=e.lastIndex}return s}function Qi(e,t){return e=+e,t=t==null?Fn:t,e>-1&&e%1==0&&e<t}function Gi(e,t,n){if(!hu(n))return!1;var r=typeof t;if(r=="number")var i=n.length,s=Zi(i)&&Qi(t,i);else s=r=="string"&&t in n;if(s){var o=n[t];return e===e?e===o:o!==o}return!1}function Yi(e){var t=Wi(e);return!!t&&e===zn[t]&&t in $n.prototype}function Zi(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Fn}function es(e){return e===e&&(e===0?1/e>0:!hu(e))}function ts(e,t){var r=e[1],o=t[1],u=r|o,a=u<f,c=o==f&&r==s||o==f&&r==l&&e[7].length<=t[8]||o==(f|l)&&r==s;if(!a&&!c)return e;o&n&&(e[2]=t[2],u|=r&n?0:i);var h=t[3];if(h){var p=e[3];e[3]=p?ci(p,h,t[4]):sr(h),e[4]=p?Vt(e[3],b):sr(t[4])}return h=t[5],h&&(p=e[5],e[5]=p?hi(p,h,t[6]):sr(h),e[6]=p?Vt(e[5],b):sr(t[6])),h=t[7],h&&(e[7]=sr(h)),o&f&&(e[8]=e[8]==null?t[8]:kn(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=u,e}function ns(e,t){e=fs(e);var n=-1,r=t.length,i={};while(++n<r){var s=t[n];s in e&&(i[s]=e[s])}return i}function rs(e,t){var n={};return Br(e,function(e,r,i){t(e,r,i)&&(n[r]=e)}),n}function is(t,n){var r=t.length,i=kn(n.length,r),s=sr(t);while(i--){var o=n[i];t[i]=Qi(o,r)?s[o]:e}return t}function os(e){var t,n=zn.support;if(!Wt(e)||sn.call(e)!=L||!!zt(e)||!nn.call(e,"constructor")&&(t=e.constructor,typeof t=="function"&&!(t instanceof t))||!n.argsTag&&nu(e))return!1;var r;return n.ownLast?(Br(e,function(e,t,n){return r=nn.call(n,t),!1}),r!==!1):(Br(e,function(e,t){r=t}),typeof r=="undefined"||nn.call(e,r))}function us(e){var t=Fu(e),n=t.length,r=n&&e.length,i=zn.support,s=r&&Zi(r)&&(ru(e)||i.nonEnumStrings&&wu(e)||i.nonEnumArgs&&nu(e)),o=-1,u=[];while(++o<n){var a=t[o];(s&&Qi(a,r)||nn.call(e,a))&&u.push(a)}return u}function as(e){return e==null?[]:Zi(e.length)?zn.support.unindexedChars&&wu(e)?e.split(""):hu(e)?e:Et(e):Vu(e)}function fs(e){if(zn.support.unindexedChars&&wu(e)){var t=-1,n=e.length,r=Et(e);while(++t<n)r[t]=e.charAt(t);return r}return hu(e)?e:Et(e)}function ls(e){return e instanceof $n?e.clone():new Xn(e.__wrapped__,e.__chain__,sr(e.__actions__))}function cs(e,t,n){(n?Gi(e,t,n):t==null)?t=1:t=Cn(+t||1,1);var r=0,i=e?e.length:0,s=-1,o=O(ln(i/t));while(r<i)o[++s]=Yr(e,r,r+=t);return o}function hs(e){var t=-1,n=e?e.length:0,r=-1,i=[];while(++t<n){var s=e[t];s&&(i[++r]=s)}return i}function ds(e,t,n){var r=e?e.length:0;if(!r)return[];if(n?Gi(e,t,n):t==null)t=1;return Yr(e,t<0?0:t)}function vs(e,t,n){var r=e?e.length:0;if(!r)return[];if(n?Gi(e,t,n):t==null)t=1;return t=r-(+t||0),Yr(e,0,t<0?0:t)}function ms(e,t,n){return e&&e.length?si(e,Ui(t,n,3),!0,!0):[]}function gs(e,t,n){return e&&e.length?si(e,Ui(t,n,3),!0):[]}function ys(e,t,n,r){var i=e?e.length:0;return i?(n&&typeof n!="number"&&Gi(e,t,n)&&(n=0,r=i),Or(e,t,n,r)):[]}function Es(t){return t?t[0]:e}function Ss(e,t,n){var r=e?e.length:0;return n&&Gi(e,t,n)&&(t=!1),r?Dr(e,t):[]}function xs(e){var t=e?e.length:0;return t?Dr(e,!0):[]}function Ts(e,t,n){var r=e?e.length:0;if(!r)return-1;if(typeof n=="number")n=n<0?Cn(r+n,0):n;else if(n){var i=ui(e,t),s=e[i];return(t===t?t===s:s!==s)?i:-1}return Mt(e,t,n||0)}function Ns(e){return vs(e,1)}function Cs(){var e=[],t=-1,n=arguments.length,r=[],i=Xi(),s=i==Mt;while(++t<n){var o=arguments[t];if(ru(o)||nu(o))e.push(o),r.push(s&&o.length>=120?yi(t&&o):null)}n=e.length;var u=e[0],a=-1,f=u?u.length:0,l=[],c=r[0];e:while(++a<f){o=u[a];if((c?rr(c,o):i(l,o,0))<0){t=n;while(--t){var h=r[t];if((h?rr(h,o):i(e[t],o,0))<0)continue e}c&&c.push(o),l.push(o)}}return l}function ks(t){var n=t?t.length:0;return n?t[n-1]:e}function Ls(e,t,n){var r=e?e.length:0;if(!r)return-1;var i=r;if(typeof n=="number")i=(n<0?Cn(r+n,0):kn(n||0,r-1))+1;else if(n){i=ui(e,t,!0)-1;var s=e[i];return(t===t?t===s:s!==s)?i:-1}if(t!==t)return Ut(e,i,!0);while(i--)if(e[i]===t)return i;return-1}function As(){var e=arguments,t=e[0];if(!t||!t.length)return t;var n=0,r=Xi(),i=e.length;while(++n<i){var s=0,o=e[n];while((s=r(t,o,s))>-1)yn.call(t,s,1)}return t}function Ms(e,t,n){var r=-1,i=e?e.length:0,s=[];t=Ui(t,n,3);while(++r<i){var o=e[r];t(o,r,e)&&(s.push(o),yn.call(e,r--,1),i--)}return s}function _s(e){return ds(e,1)}function Ds(e,t,n){var r=e?e.length:0;return r?(n&&typeof n!="number"&&Gi(e,t,n)&&(t=0,n=r),Yr(e,t,n)):[]}function Bs(e,t,n){var r=e?e.length:0;if(!r)return[];if(n?Gi(e,t,n):t==null)t=1;return Yr(e,0,t<0?0:t)}function js(e,t,n){var r=e?e.length:0;if(!r)return[];if(n?Gi(e,t,n):t==null)t=1;return t=r-(+t||0),Yr(e,t<0?0:t)}function Fs(e,t,n){return e&&e.length?si(e,Ui(t,n,3),!1,!0):[]}function Is(e,t,n){return e&&e.length?si(e,Ui(t,n,3)):[]}function Rs(e,t,n,r){var i=e?e.length:0;if(!i)return[];t!=null&&typeof t!="boolean"&&(r=n,n=Gi(e,t,r)?null:t,t=!1);var s=Ui();if(s!==Sr||n!=null)n=s(n,r,3);return t&&Xi()==Mt?$t(e,n):ri(e,n)}function Us(e){var t=-1,n=(e&&e.length&&cr(lr(e,tn)))>>>0,r=O(n);while(++t<n)r[t]=lr(e,Jr(t));return r}function Ws(){var e=-1,t=arguments.length;while(++e<t){var n=arguments[e];if(ru(n)||nu(n))var r=r?Cr(r,n).concat(Cr(n,r)):n}return r?ri(r):[]}function Vs(e,t){var n=-1,r=e?e.length:0,i={};r&&!t&&!ru(e[0])&&(t=[]);while(++n<r){var s=e[n];t?i[s]=t[n]:s&&(i[s[0]]=s[1])}return i}function $s(e){var t=zn(e);return t.__chain__=!0,t}function Js(e,t,n){return t.call(n,e),e}function Ks(e,t,n){return t.call(n,e)}function Qs(){return $s(this)}function Gs(){return new Xn(this.value(),this.__chain__)}function Ys(e){var t,n=this;while(n instanceof Wn){var r=ls(n);t?i.__wrapped__=r:t=r;var i=r;n=n.__wrapped__}return i.__wrapped__=e,t}function Zs(){var e=this.__wrapped__;return e instanceof $n?(this.__actions__.length&&(e=new $n(this)),new Xn(e.reverse(),this.__chain__)):this.thru(function(e){return e.reverse()})}function eo(){return this.value()+""}function to(){return oi(this.__wrapped__,this.__actions__)}function io(e,t,n){var r=ru(e)?ar:Ar;n&&Gi(e,t,n)&&(t=null);if(typeof t!="function"||typeof n!="undefined")t=Ui(t,n,3);return r(e,t)}function so(e,t,n){var r=ru(e)?fr:Mr;return t=Ui(t,n,3),r(e,t)}function ao(e,t){return oo(e,Wr(t))}function ho(e,t,n,r){var i=e?e.length:0;return Zi(i)||(e=Vu(e),i=e.length),i?(typeof n!="number"||r&&Gi(t,n,r)?n=0:n=n<0?Cn(i+n,0):n||0,typeof e=="string"||!ru(e)&&wu(e)?n<i&&e.indexOf(t,n)>-1:Xi(e,t,n)>-1):!1}function mo(e,t,n){var r=ru(e)?lr:zr;return t=Ui(t,n,3),r(e,t)}function yo(e,t){return mo(e,Jr(t))}function Eo(e,t,n){var r=ru(e)?fr:Mr;return t=Ui(t,n,3),r(e,function(e,n,r){return!t(e,n,r)})}function So(t,n,r){if(r?Gi(t,n,r):n==null){t=as(t);var i=t.length;return i>0?t[Kr(0,i-1)]:e}var s=xo(t);return s.length=kn(n<0?0:+n||0,s.length),s}function xo(e){e=as(e);var t=-1,n=e.length,r=O(n);while(++t<n){var i=Kr(0,t);t!=i&&(r[t]=r[i]),r[i]=e[t]}return r}function To(e){var t=e?e.length:0;return Zi(t)?t:ju(e).length}function No(e,t,n){var r=ru(e)?vr:Zr;n&&Gi(e,t,n)&&(t=null);if(typeof t!="function"||typeof n!="undefined")t=Ui(t,n,3);return r(e,t)}function Co(e,t,n){if(e==null)return[];var r=-1,i=e.length,s=Zi(i)?O(i):[];return n&&Gi(e,t,n)&&(t=null),t=Ui(t,n,3),kr(e,function(e,n,i){s[++r]={criteria:t(e,n,i),index:r,value:e}}),ei(s,jt)}function ko(){var e=arguments,t=e[0],n=e[3],r=0,i=e.length-1;if(t==null)return[];var s=O(i);while(r<i)s[r]=e[++r];return n&&Gi(e[1],e[2],n)&&(s=e[1]),ti(t,Dr(s),[])}function Lo(e,t,n,r){return e==null?[]:(r&&Gi(t,n,r)&&(n=null),ru(t)||(t=t==null?[]:[t]),ru(n)||(n=n==null?[]:[n]),ti(e,t,n))}function Ao(e,t){return so(e,Wr(t))}function Mo(e,t){if(typeof t!="function"){if(typeof e!="function")throw new Tt(y);var n=e;e=t,t=n}return e=Tn(e=+e)?e:0,function(){if(--e<1)return t.apply(this,arguments)}}function _o(e,t,n){return n&&Gi(e,t,n)&&(t=null),t=e&&t==null?e.length:Cn(+t||0,0),ji(e,f,null,null,null,null,t)}function Do(e,t){var n;if(typeof t!="function"){if(typeof e!="function")throw new Tt(y);var r=e;e=t,t=r}return function(){return--e>0?n=t.apply(this,arguments):t=null,n}}function Io(t,n,r){function v(){f&&cn(f),s&&cn(s),s=f=l=e}function m(){var r=n-(Oo()-u);if(r<=0||r>n){s&&cn(s);var h=l;s=f=l=e,h&&(c=Oo(),o=t.apply(a,i),!f&&!s&&(i=a=null))}else f=gn(m,r)}function g(){f&&cn(f),s=f=l=e;if(p||h!==n)c=Oo(),o=t.apply(a,i),!f&&!s&&(i=a=null)}function b(){i=arguments,u=Oo(),a=this,l=p&&(f||!d);if(h===!1)var e=d&&!f;else{!s&&!d&&(c=u);var r=h-(u-c),v=r<=0||r>h;v?(s&&(s=cn(s)),c=u,o=t.apply(a,i)):s||(s=gn(g,r))}return v&&f?f=cn(f):!f&&n!==h&&(f=gn(m,n)),e&&(v=!0,o=t.apply(a,i)),v&&!f&&!s&&(i=a=null),o}var i,s,o,u,a,f,l,c=0,h=!1,p=!0;if(typeof t!="function")throw new Tt(y);n=n<0?0:+n||0;if(r===!0){var d=!0;p=!1}else hu(r)&&(d=r.leading,h="maxWait"in r&&Cn(+r.maxWait||0,n),p="trailing"in r?r.trailing:p);return b.cancel=v,b}function Wo(e,t){if(typeof e!="function"||t&&typeof t!="function")throw new Tt(y);var n=function(){var r=arguments,i=n.cache,s=t?t.apply(this,r):r[0];if(i.has(s))return i.get(s);var o=e.apply(this,r);return i.set(s,o),o};return n.cache=new Wo.Cache,n}function Xo(e){if(typeof e!="function")throw new Tt(y);return function(){return!e.apply(this,arguments)}}function Vo(e){return Do(e,2)}function Qo(e,t){if(typeof e!="function")throw new Tt(y);return t=Cn(typeof t=="undefined"?e.length-1:+t||0,0),function(){var n=arguments,r=-1,i=Cn(n.length-t,0),s=O(i);while(++r<i)s[r]=n[t+r];switch(t){case 0:return e.call(this,s);case 1:return e.call(this,n[0],s);case 2:return e.call(this,n[0],n[1],s)}var o=O(t+1);r=-1;while(++r<t)o[r]=n[r];return o[t]=s,e.apply(this,o)}}function Go(e){if(typeof e!="function")throw new Tt(y);return function(t){return e.apply(this,t)}}function Yo(e,t,n){var r=!0,i=!0;if(typeof e!="function")throw new Tt(y);return n===!1?r=!1:hu(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),mt.leading=r,mt.maxWait=+t,mt.trailing=i,Io(e,t,mt)}function Zo(e,t){return t=t==null?Ea:t,ji(t,u,null,[e],[])}function eu(e,t,n,r){return t&&typeof t!="boolean"&&Gi(e,t,n)?t=!1:typeof t=="function"&&(r=n,n=t,t=!1),n=typeof n=="function"&&fi(n,r,1),xr(e,t,n)}function tu(e,t,n){return t=typeof t=="function"&&fi(t,n,1),xr(e,!0,t)}function nu(t){var n=Wt(t)?t.length:e;return Zi(n)&&sn.call(t)==w}function iu(e){return e===!0||e===!1||Wt(e)&&sn.call(e)==S}function su(e){return Wt(e)&&sn.call(e)==x}function ou(e){return!!e&&e.nodeType===1&&Wt(e)&&(zn.support.nodeTag?sn.call(e).indexOf("Element")>-1:zt(e))}function uu(e){if(e==null)return!0;var t=e.length;return Zi(t)&&(ru(e)||wu(e)||nu(e)||Wt(e)&&cu(e.splice))?!t:!ju(e).length}function au(t,n,r,i){r=typeof r=="function"&&fi(r,i,3);if(!r&&es(t)&&es(n))return t===n;var s=r?r(t,n):e;return typeof s=="undefined"?qr(t,n,r):!!s}function fu(e){return Wt(e)&&typeof e.message=="string"&&sn.call(e)==T}function hu(e){var t=typeof e;return t=="function"||!!e&&t=="object"}function pu(e,t,n,r){var i=ju(t),s=i.length;if(!s)return!0;if(e==null)return!1;n=typeof n=="function"&&fi(n,r,3);if(!n&&s==1){var o=i[0],u=t[o];if(es(u))return u===e[o]&&(typeof u!="undefined"||o in fs(e))}var a=O(s),f=O(s);while(s--)u=a[s]=t[i[s]],f[s]=es(u);return Ur(fs(e),i,a,f,n)}function du(e){return gu(e)&&e!=+e}function vu(e){return e==null?!1:sn.call(e)==N?un.test(en.call(e)):Wt(e)&&(zt(e)?un:rt).test(e)}function mu(e){return e===null}function gu(e){return typeof e=="number"||Wt(e)&&sn.call(e)==k}function bu(e){return hu(e)&&sn.call(e)==A}function wu(e){return typeof e=="string"||Wt(e)&&sn.call(e)==M}function Eu(e){return Wt(e)&&Zi(e.length)&&!!dt[sn.call(e)]}function Su(e){return typeof e=="undefined"}function xu(e){var t=e?e.length:0;return Zi(t)?t?zn.support.unindexedChars&&wu(e)?e.split(""):sr(e):[]:Vu(e)}function Tu(e){return Er(e,Fu(e))}function Cu(e,t,n){var r=Tr(e);return n&&Gi(e,t,n)&&(t=null),t?Er(t,r,ju(t)):r}function Pu(e){return Ir(e,Fu(e))}function Hu(e,t){return e?nn.call(e,t):!1}function Bu(e,t,n){n&&Gi(e,t,n)&&(t=null);var r=-1,i=ju(e),s=i.length,o={};while(++r<s){var u=i[r],a=e[u];t?nn.call(o,a)?o[a].push(u):o[a]=[u]:o[a]=u}return o}function Fu(e){if(e==null)return[];hu(e)||(e=Et(e));var t=e.length,n=zn.support;t=t&&Zi(t)&&(ru(e)||n.nonEnumStrings&&wu(e)||n.nonEnumArgs&&nu(e))&&t||0;var r=e.constructor,i=-1,s=cu(r)&&r.prototype||kt,o=s===e,u=O(t),a=t>0,f=n.enumErrorProps&&(e===Ct||e instanceof gt),l=n.enumPrototypes&&cu(e);while(++i<t)u[i]=i+"";for(var c in e)(!l||c!="prototype")&&(!f||c!="message"&&c!="name")&&(!a||!Qi(c,t))&&(c!="constructor"||!o&&!!nn.call(e,c))&&u.push(c);if(n.nonEnumShadows&&e!==kt){var h=e===Xt?M:e===Ct?T:sn.call(e),p=Un[h]||Un[L];h==L&&(s=kt),t=ht.length;while(t--){c=ht[t];var d=p[c];(!o||!d)&&(d?nn.call(e,c):e[c]!==s[c])&&u.push(c)}}return u}function Iu(e,t,n){var r={};return t=Ui(t,n,3),jr(e,function(e,n,i){r[n]=t(e,n,i)}),r}function Uu(e){var t=-1,n=ju(e),r=n.length,i=O(r);while(++t<r){var s=n[t];i[t]=[s,e[s]]}return i}function Wu(t,n,r){var i=t==null?e:t[n];return typeof i=="undefined"&&(i=r),cu(i)?i.call(t):i}function Xu(e,t,n,r){var i=ru(e)||Eu(e);t=Ui(t,r,4);if(n==null)if(i||hu(e)){var s=e.constructor;i?n=ru(e)?new s:[]:n=Tr(cu(s)&&s.prototype)}else n={};return(i?or:jr)(e,function(e,r,i){return t(n,e,r,i)}),n}function Vu(e){return ii(e,ju(e))}function $u(e){return ii(e,Fu(e))}function Ju(e,t,n){return t=+t||0,typeof n=="undefined"?(n=t,t=0):n=+n||0,e>=t&&e<n}function Ku(e,t,n){n&&Gi(e,t,n)&&(t=n=null);var r=e==null,i=t==null;n==null&&(i&&typeof e=="boolean"?(n=e,e=1):typeof t=="boolean"&&(n=t,i=!0)),r&&i&&(t=1,i=!1),e=+e||0,i?(t=e,e=0):t=+t||0;if(n||e%1||t%1){var s=Mn();return kn(e+s*(t-e+parseFloat("1e-"+((s+"").length-1))),t)}return Kr(e,t)}function Gu(e){return e=Dt(e),e&&e.charAt(0).toUpperCase()+e.slice(1)}function Yu(e){return e=Dt(e),e&&e.replace(it,It).replace(Z,"")}function Zu(e,t,n){e=Dt(e),t+="";var r=e.length;return n=typeof n=="undefined"?r:kn(n<0?0:+n||0,r),n-=t.length,n>=0&&e.indexOf(t,n)==n}function ea(e){return e=Dt(e),e&&K.test(e)?e.replace($,qt):e}function ta(e){return e=Dt(e),e&&ut.test(e)?e.replace(ot,"\\$&"):e}function ra(e,t,n){e=Dt(e),t=+t;var r=e.length;if(r>=t||!Tn(t))return e;var i=(t-r)/2,s=hn(i),o=ln(i);return n=Pi("",o,n),n.slice(0,s)+e+n}function oa(e,t,n){return n&&Gi(e,t,n)&&(t=0),On(e,t)}function ua(e,t){var n="";e=Dt(e),t=+t;if(t<1||!e||!Tn(t))return n;do t%2&&(n+=e),t=hn(t/2),e+=e;while(t);return n}function la(e,t,n){return e=Dt(e),n=n==null?0:kn(n<0?0:+n||0,e.length),e.lastIndexOf(t,n)==n}function ca(t,n,r){var i=zn.templateSettings;r&&Gi(t,n,r)&&(n=r=null),t=Dt(t),n=br(br({},r||n),i,yr);var s=br(br({},n.imports),i.imports,yr),o=ju(s),u=ii(s,o),a,f,l=0,c=n.interpolate||st,h="__p += '",p=St((n.escape||st).source+"|"+c.source+"|"+(c===Y?et:st).source+"|"+(n.evaluate||st).source+"|$","g"),d="//# sourceURL="+("sourceURL"in n?n.sourceURL:"lodash.templateSources["+ ++pt+"]")+"\n";t.replace(p,function(e,n,r,i,s,o){return r||(r=i),h+=t.slice(l,o).replace(at,Rt),n&&(a=!0,h+="' +\n__e("+n+") +\n'"),s&&(f=!0,h+="';\n"+s+";\n__p += '"),r&&(h+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),l=o+e.length,e}),h+="';\n";var v=n.variable;v||(h="with (obj) {\n"+h+"\n}\n"),h=(f?h.replace(z,""):h).replace(W,"$1").replace(X,"$1;"),h="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(a?", __e = _.escape":"")+(f?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var m=ya(function(){return yt(o,d+"return "+h).apply(e,u)});m.source=h;if(fu(m))throw m;return m}function ha(e,t,n){var r=e;return e=Dt(e),e?(n?Gi(r,t,n):t==null)?e.slice(Jt(e),Kt(e)+1):(t+="",e.slice(Ht(e,t),Bt(e,t)+1)):e}function pa(e,t,n){var r=e;return e=Dt(e),e?(n?Gi(r,t,n):t==null)?e.slice(Jt(e)):e.slice(Ht(e,t+"")):e}function da(e,t,n){var r=e;return e=Dt(e),e?(n?Gi(r,t,n):t==null)?e.slice(0,Kt(e)+1):e.slice(0,Bt(e,t+"")+1):e}function va(e,t,n){n&&Gi(e,t,n)&&(t=null);var r=c,i=h;if(t!=null)if(hu(t)){var s="separator"in t?t.separator:s;r="length"in t?+t.length||0:r,i="omission"in t?Dt(t.omission):i}else r=+t||0;e=Dt(e);if(r>=e.length)return e;var o=r-i.length;if(o<1)return i;var u=e.slice(0,o);if(s==null)return u+i;if(bu(s)){if(e.slice(o).search(s)){var a,f,l=e.slice(0,o);s.global||(s=St(s.source,(tt.exec(s)||"")+"g")),s.lastIndex=0;while(a=s.exec(l))f=a.index;u=u.slice(0,f==null?o:f)}}else if(e.indexOf(s,o)!=o){var p=u.lastIndexOf(s);p>-1&&(u=u.slice(0,p))}return u+i}function ma(e){return e=Dt(e),e&&J.test(e)?e.replace(V,Qt):e}function ga(e,t,n){return n&&Gi(e,t,n)&&(t=null),e=Dt(e),e.match(t||ft)||[]}function ba(e,t,n){return n&&Gi(e,t,n)&&(t=null),Wt(e)?Sa(e):Sr(e,t)}function wa(e){return function(){return e}}function Ea(e){return e}function Sa(e){return Wr(xr(e,!0))}function xa(e,t){return Xr(e+"",xr(t,!0))}function Ta(e,t,n){if(n==null){var r=hu(t),i=r&&ju(t),s=i&&i.length&&Ir(t,i);if(s?!s.length:!r)s=!1,n=t,t=e,e=this}s||(s=Ir(t,ju(t)));var o=!0,u=-1,a=cu(e),f=s.length;n===!1?o=!1:hu(n)&&"chain"in n&&(o=n.chain);while(++u<f){var l=s[u],c=t[l];e[l]=c,a&&(e.prototype[l]=function(t){return function(){var n=this.__chain__;if(o||n){var r=e(this.__wrapped__),i=r.__actions__=sr(this.__actions__);return i.push({func:t,args:arguments,thisArg:e}),r.__chain__=n,r}var s=[this.value()];return dn.apply(s,arguments),t.apply(e,s)}}(c))}return e}function Na(){return C._=on,this}function Ca(){}function ka(e){return Jr(e+"")}function La(t){return function(n){return t==null?e:t[n]}}function Aa(e,t,n){n&&Gi(e,t,n)&&(t=n=null),e=+e||0,n=n==null?1:+n||0,t==null?(t=e,e=0):t=+t||0;var r=-1,i=Cn(ln((t-e)/(n||1)),0),s=O(i);while(++r<i)s[r]=e,e+=n;return s}function Oa(e,t,n){e=+e;if(e<1||!Tn(e))return[];var r=-1,i=O(kn(e,Pn));t=fi(t,n,1);while(++r<e)r<Pn?i[r]=t(r):t(r);return i}function Ma(e){var t=++rn;return Dt(e)+t}function _a(e,t){return e+t}function Ha(e,t,n){n&&Gi(e,t,n)&&(t=null);var r=Ui(),i=t==null;if(r!==Sr||!i)i=!1,t=r(t,n,3);return i?mr(ru(e)?e:as(e)):ni(e,t)}C=C?Yt.defaults(Lt.Object(),C,Yt.pick(Lt,ct)):Lt;var O=C.Array,_=C.Date,gt=C.Error,yt=C.Function,bt=C.Math,wt=C.Number,Et=C.Object,St=C.RegExp,xt=C.String,Tt=C.TypeError,Nt=O.prototype,Ct=gt.prototype,kt=Et.prototype,Xt=xt.prototype,Zt=(Zt=C.window)&&Zt.document,en=yt.prototype.toString,tn=Jr("length"),nn=kt.hasOwnProperty,rn=0,sn=kt.toString,on=C._,un=St("^"+ta(sn).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),an=vu(an=C.ArrayBuffer)&&an,fn=vu(fn=an&&(new an(0)).slice)&&fn,ln=bt.ceil,cn=C.clearTimeout,hn=bt.floor,pn=vu(pn=Et.getPrototypeOf)&&pn,dn=Nt.push,vn=kt.propertyIsEnumerable,mn=vu(mn=C.Set)&&mn,gn=C.setTimeout,yn=Nt.splice,bn=vu(bn=C.Uint8Array)&&bn,wn=vu(wn=C.WeakMap)&&wn,En=function(){try{var e=vu(e=C.Float64Array)&&e,t=new e(new an(10),0,1)&&e}catch(n){}return t}(),Sn=vu(Sn=O.isArray)&&Sn,xn=vu(xn=Et.create)&&xn,Tn=C.isFinite,Nn=vu(Nn=Et.keys)&&Nn,Cn=bt.max,kn=bt.min,Ln=vu(Ln=_.now)&&Ln,An=vu(An=wt.isFinite)&&An,On=C.parseInt,Mn=bt.random,_n=wt.NEGATIVE_INFINITY,Dn=wt.POSITIVE_INFINITY,Pn=bt.pow(2,32)-1,Hn=Pn-1,Bn=Pn>>>1,jn=En?En.BYTES_PER_ELEMENT:0,Fn=bt.pow(2,53)-1,In=wn&&new wn,qn={},Rn={};Rn[P]=C.Float32Array,Rn[H]=C.Float64Array,Rn[B]=C.Int8Array,Rn[j]=C.Int16Array,Rn[F]=C.Int32Array,Rn[I]=C.Uint8Array,Rn[q]=C.Uint8ClampedArray,Rn[R]=C.Uint16Array,Rn[U]=C.Uint32Array;var Un={};Un[E]=Un[x]=Un[k]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},Un[S]=Un[M]={constructor:!0,toString:!0,valueOf:!0},Un[T]=Un[N]=Un[A]={constructor:!0,toString:!0},Un[L]={constructor:!0},or(ht,function(e){for(var t in Un)if(nn.call(Un,t)){var n=Un[t];n[e]=nn.call(n,e)}});var Vn=zn.support={};(function(e){var t=function(){this.x=1},n={0:1,length:1},r=[];t.prototype={valueOf:1,y:1};for(var i in new t)r.push(i);Vn.argsTag=sn.call(arguments)==w,Vn.enumErrorProps=vn.call(Ct,"message")||vn.call(Ct,"name"),Vn.enumPrototypes=vn.call(t,"prototype"),Vn.funcDecomp=/\bthis\b/.test(function(){return this}),Vn.funcNames=typeof yt.name=="string",Vn.nodeTag=sn.call(Zt)!=L,Vn.nonEnumStrings=!vn.call("x",0),Vn.nonEnumShadows=!/valueOf/.test(r),Vn.ownLast=r[0]!="x",Vn.spliceObjects=(yn.call(n,0,1),!n[0]),Vn.unindexedChars="x"[0]+Et("x")[0]!="xx";try{Vn.dom=Zt.createDocumentFragment().nodeType===11}catch(s){Vn.dom=!1}try{Vn.nonEnumArgs=!vn.call(arguments,1)}catch(s){Vn.nonEnumArgs=!0}})(0,0),zn.templateSettings={escape:Q,evaluate:G,interpolate:Y,variable:"",imports:{_:zn}};var Tr=function(){function e(){}return function(t){if(hu(t)){e.prototype=t;var n=new e;e.prototype=null}return n||C.Object()}}(),kr=vi(jr),Lr=vi(Fr,!0),Pr=mi(),Hr=mi(!0),Gr=In?function(e,t){return In.set(e,t),e}:Ea;fn||(li=!an||!bn?wa(null):function(e){var t=e.byteLength,n=En?hn(t/jn):0,r=n*jn,i=new an(t);if(n){var s=new En(i,0,n);s.set(new En(e,0,n))}return t!=r&&(s=new bn(i,r),s.set(new bn(e,r))),i});var yi=!xn||!mn?wa(null):function(e){return new nr(e)},zi=In?function(e){return In.get(e)}:Ca,Wi=function(){return Vn.funcNames?wa.name=="constant"?Jr("name"):function(e){var t=e.name,n=qn[t],r=n?n.length:0;while(r--){var i=n[r],s=i.func;if(s==null||s==e)return i.name}return t}:wa("")}(),ss=function(){var e=0,t=0;return function(n,r){var i=Oo(),s=d-(i-t);t=i;if(s>0){if(++e>=p)return n}else e=0;return Gr(n,r)}}(),ps=Qo(function(e,t){return ru(e)||nu(e)?Cr(e,Dr(t,!1,!0)):[]}),bs=Ti(),ws=Ti(!0),Os=Qo(function(e,t){e||(e=[]),t=Dr(t);var n=t.length,r=wr(e,t);t.sort(At);while(n--){var i=parseFloat(t[n]);if(i!=s&&Qi(i)){var s=i;yn.call(e,i,1)}}return r}),Ps=Bi(),Hs=Bi(!0),qs=Qo(function(e){return ri(Dr(e,!1,!0))}),zs=Qo(function(e,t){return ru(e)||nu(e)?Cr(e,t):[]}),Xs=Qo(Us),no=Qo(function(e,t){var n=e?e.length:0;return Zi(n)&&(e=as(e)),wr(e,Dr(t))}),ro=pi(function(e,t,n){nn.call(e,n)?++e[n]:e[n]=1}),oo=xi(kr),uo=xi(Lr,!0),fo=ki(or,kr),lo=ki(ur,Lr),co=pi(function(e,t,n){nn.call(e,n)?e[n].push(t):e[n]=[t]}),po=pi(function(e,t,n){e[n]=t}),vo=Qo(function(t,n,r){var i=-1,s=typeof n=="function",o=t?t.length:0,u=Zi(o)?O(o):[];return kr(t,function(t){var o=s?n:t!=null&&t[n];u[++i]=o?o.apply(t,r):e}),u}),go=pi(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]}),bo=_i(pr,kr),wo=_i(dr,Lr),Oo=Ln||function(){return(new _).getTime()},Po=Qo(function(e,t,r){var i=n;if(r.length){var s=Vt(r,Po.placeholder);i|=u}return ji(e,i,t,r,s)}),Ho=Qo(function(e,t){t=t.length?Dr(t):Pu(e);var r=-1,i=t.length;while(++r<i){var s=t[r];e[s]=ji(e[s],n,e)}return e}),Bo=Qo(function(e,t,i){var s=n|r;if(i.length){var o=Vt(i,Bo.placeholder);s|=u}return ji(t,s,e,i,o)}),jo=Ei(s),Fo=Ei(o),qo=Qo(function(e,t){return Nr(e,1,t)}),Ro=Qo(function(e,t,n){return Nr(e,t,n)}),Uo=Ci(),zo=Ci(!0),$o=Mi(u),Jo=Mi(a),Ko=Qo(function(e,t){return ji(e,l,null,null,null,Dr(t))});Vn.argsTag||(nu=function(t){var n=Wt(t)?t.length:e;return Zi(n)&&nn.call(t,"callee")&&!vn.call(t,"callee")});var ru=Sn||function(e){return Wt(e)&&Zi(e.length)&&sn.call(e)==E};Vn.dom||(ou=function(e){return!!e&&e.nodeType===1&&Wt(e)&&!yu(e)});var lu=An||function(e){return typeof e=="number"&&Tn(e)},cu=_t(/x/)||bn&&!_t(bn)?function(e){return sn.call(e)==N}:_t,yu=pn?function(e){if(!e||sn.call(e)!=L||!zn.support.argsTag&&nu(e))return!1;var t=e.valueOf,n=vu(t)&&(n=pn(t))&&pn(n);return n?e==n||pn(e)==n:os(e)}:os,Nu=di(br),ku=Qo(function(t){var n=t[0];return n==null?n:(t.push(gr),Nu.apply(e,t))}),Lu=Ni(jr),Au=Ni(Fr),Ou=Li(Pr),Mu=Li(Hr),_u=Ai(jr),Du=Ai(Fr),ju=Nn?function(e){if(e)var t=e.constructor,n=e.length;return typeof t=="function"&&t.prototype===e||(typeof e=="function"?zn.support.enumPrototypes:n&&Zi(n))?us(e):hu(e)?Nn(e):[]}:us,qu=di(Vr),Ru=Qo(function(e,t){if(e==null)return{};if(typeof t[0]!="function"){var t=lr(Dr(t),xt);return ns(e,Cr(Fu(e),t))}var n=fi(t[0],t[1],3);return rs(e,function(e,t,r){return!n(e,t,r)})}),zu=Qo(function(e,t){return e==null?{}:typeof t[0]=="function"?rs(e,fi(t[0],t[1],3)):ns(e,Dr(t))}),Qu=bi(function(e,t,n){return t=t.toLowerCase(),e+(n?t.charAt(0).toUpperCase()+t.slice(1):t)}),na=bi(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),ia=Oi(),sa=Oi(!0);On(lt+"08")!=8&&(oa=function(e,t,n){return(n?Gi(e,t,n):t==null)?t=0:t&&(t=+t),e=ha(e),On(e,t||(nt.test(e)?16:10))});var aa=bi(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}),fa=bi(function(e,t,n){return e+(n?" ":"")+(t.charAt(0).toUpperCase()+t.slice(1))}),ya=Qo(function(t,n){try{return t.apply(e,n)}catch(r){return fu(r)?r:new gt(r)}}),Da=Si(cr),Pa=Si(hr,!0);return zn.prototype=Wn.prototype,Xn.prototype=Tr(Wn.prototype),Xn.prototype.constructor=Xn,$n.prototype=Tr(Wn.prototype),$n.prototype.constructor=$n,Gn.prototype["delete"]=Yn,Gn.prototype.get=Zn,Gn.prototype.has=er,Gn.prototype.set=tr,nr.prototype.push=ir,Wo.Cache=Gn,zn.after=Mo,zn.ary=_o,zn.assign=Nu,zn.at=no,zn.before=Do,zn.bind=Po,zn.bindAll=Ho,zn.bindKey=Bo,zn.callback=ba,zn.chain=$s,zn.chunk=cs,zn.compact=hs,zn.constant=wa,zn.countBy=ro,zn.create=Cu,zn.curry=jo,zn.curryRight=Fo,zn.debounce=Io,zn.defaults=ku,zn.defer=qo,zn.delay=Ro,zn.difference=ps,zn.drop=ds,zn.dropRight=vs,zn.dropRightWhile=ms,zn.dropWhile=gs,zn.fill=ys,zn.filter=so,zn.flatten=Ss,zn.flattenDeep=xs,zn.flow=Uo,zn.flowRight=zo,zn.forEach=fo,zn.forEachRight=lo,zn.forIn=Ou,zn.forInRight=Mu,zn.forOwn=_u,zn.forOwnRight=Du,zn.functions=Pu,zn.groupBy=co,zn.indexBy=po,zn.initial=Ns,zn.intersection=Cs,zn.invert=Bu,zn.invoke=vo,zn.keys=ju,zn.keysIn=Fu,zn.map=mo,zn.mapValues=Iu,zn.matches=Sa,zn.matchesProperty=xa,zn.memoize=Wo,zn.merge=qu,zn.mixin=Ta,zn.negate=Xo,zn.omit=Ru,zn.once=Vo,zn.pairs=Uu,zn.partial=$o,zn.partialRight=Jo,zn.partition=go,zn.pick=zu,zn.pluck=yo,zn.property=ka,zn.propertyOf=La,zn.pull=As,zn.pullAt=Os,zn.range=Aa,zn.rearg=Ko,zn.reject=Eo,zn.remove=Ms,zn.rest=_s,zn.restParam=Qo,zn.shuffle=xo,zn.slice=Ds,zn.sortBy=Co,zn.sortByAll=ko,zn.sortByOrder=Lo,zn.spread=Go,zn.take=Bs,zn.takeRight=js,zn.takeRightWhile=Fs,zn.takeWhile=Is,zn.tap=Js,zn.throttle=Yo,zn.thru=Ks,zn.times=Oa,zn.toArray=xu,zn.toPlainObject=Tu,zn.transform=Xu,zn.union=qs,zn.uniq=Rs,zn.unzip=Us,zn.values=Vu,zn.valuesIn=$u,zn.where=Ao,zn.without=zs,zn.wrap=Zo,zn.xor=Ws,zn.zip=Xs,zn.zipObject=Vs,zn.backflow=zo,zn.collect=mo,zn.compose=zo,zn.each=fo,zn.eachRight=lo,zn.extend=Nu,zn.iteratee=ba,zn.methods=Pu,zn.object=Vs,zn.select=so,zn.tail=_s,zn.unique=Rs,Ta(zn,zn),zn.add=_a,zn.attempt=ya,zn.camelCase=Qu,zn.capitalize=Gu,zn.clone=eu,zn.cloneDeep=tu,zn.deburr=Yu,zn.endsWith=Zu,zn.escape=ea,zn.escapeRegExp=ta,zn.every=io,zn.find=oo,zn.findIndex=bs,zn.findKey=Lu,zn.findLast=uo,zn.findLastIndex=ws,zn.findLastKey=Au,zn.findWhere=ao,zn.first=Es,zn.has=Hu,zn.identity=Ea,zn.includes=ho,zn.indexOf=Ts,zn.inRange=Ju,zn.isArguments=nu,zn.isArray=ru,zn.isBoolean=iu,zn.isDate=su,zn.isElement=ou,zn.isEmpty=uu,zn.isEqual=au,zn.isError=fu,zn.isFinite=lu,zn.isFunction=cu,zn.isMatch=pu,zn.isNaN=du,zn.isNative=vu,zn.isNull=mu,zn.isNumber=gu,zn.isObject=hu,zn.isPlainObject=yu,zn.isRegExp=bu,zn.isString=wu,zn.isTypedArray=Eu,zn.isUndefined=Su,zn.kebabCase=na,zn.last=ks,zn.lastIndexOf=Ls,zn.max=Da,zn.min=Pa,zn.noConflict=Na,zn.noop=Ca,zn.now=Oo,zn.pad=ra,zn.padLeft=ia,zn.padRight=sa,zn.parseInt=oa,zn.random=Ku,zn.reduce=bo,zn.reduceRight=wo,zn.repeat=ua,zn.result=Wu,zn.runInContext=Gt,zn.size=To,zn.snakeCase=aa,zn.some=No,zn.sortedIndex=Ps,zn.sortedLastIndex=Hs,zn.startCase=fa,zn.startsWith=la,zn.sum=Ha,zn.template=ca,zn.trim=ha,zn.trimLeft=pa,zn.trimRight=da,zn.trunc=va,zn.unescape=ma,zn.uniqueId=Ma,zn.words=ga,zn.all=io,zn.any=No,zn.contains=ho,zn.detect=oo,zn.foldl=bo,zn.foldr=wo,zn.head=Es,zn.include=ho,zn.inject=bo,Ta(zn,function(){var e={};return jr(zn,function(t,n){zn.prototype[n]||(e[n]=t)}),e}(),!1),zn.sample=So,zn.prototype.sample=function(e){return!this.__chain__&&e==null?So(this.value()):this.thru(function(t){return So(t,e)})},zn.VERSION=t,or(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){zn[e].placeholder=zn}),or(["dropWhile","filter","map","takeWhile"],function(e,t){var n=t!=g,r=t==v;$n.prototype[e]=function(e,i){var s=this.__filtered__,o=s&&r?new $n(this):this.clone(),u=o.__iteratees__||(o.__iteratees__=[]);return u.push({done:!1,count:0,index:0,iteratee:Ui(e,i,1),limit:-1,type:t}),o.__filtered__=s||n,o}}),or(["drop","take"],function(e,t){var n=e+"While";$n.prototype[e]=function(n){var r=this.__filtered__,i=r&&!t?this.dropWhile():this.clone();n=n==null?1:Cn(hn(n)||0,0);if(r)t?i.__takeCount__=kn(i.__takeCount__,n):ks(i.__iteratees__).limit=n;else{var s=i.__views__||(i.__views__=[]);s.push({size:n,type:e+(i.__dir__<0?"Right":"")})}return i},$n.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()},$n.prototype[e+"RightWhile"]=function(e,t){return this.reverse()[n](e,t).reverse()}}),or(["first","last"],function(e,t){var n="take"+(t?"Right":"");$n.prototype[e]=function(){return this[n](1).value()[0]}}),or(["initial","rest"],function(e,t){var n="drop"+(t?"":"Right");$n.prototype[e]=function(){return this[n](1)}}),or(["pluck","where"],function(e,t){var n=t?"filter":"map",r=t?Wr:Jr;$n.prototype[e]=function(e){return this[n](r(e))}}),$n.prototype.compact=function(){return this.filter(Ea)},$n.prototype.reject=function(e,t){return e=Ui(e,t,1),this.filter(function(t){return!e(t)})},$n.prototype.slice=function(e,t){e=e==null?0:+e||0;var n=e<0?this.takeRight(-e):this.drop(e);return typeof t!="undefined"&&(t=+t||0,n=t<0?n.dropRight(-t):n.take(t-e)),n},$n.prototype.toArray=function(){return this.drop(0)},jr($n.prototype,function(e,t){var n=zn[t];if(!n)return;var r=/^(?:filter|map|reject)|While$/.test(t),i=/^(?:first|last)$/.test(t);zn.prototype[t]=function(){var t=arguments,s=t.length,o=this.__chain__,u=this.__wrapped__,a=!!this.__actions__.length,f=u instanceof $n,l=t[0],c=f||ru(u);c&&r&&typeof l=="function"&&l.length!=1&&(f=c=!1);var h=f&&!a;if(i&&!o)return h?e.call(u):n.call(zn,this.value());var p=function(e){var r=[e];return dn.apply(r,t),n.apply(zn,r)};if(c){var d=h?u:new $n(this),v=e.apply(d,t);if(!i&&(a||v.__actions__)){var m=v.__actions__||(v.__actions__=[]);m.push({func:Ks,args:[p],thisArg:zn})}return new Xn(v,o)}return this.thru(p)}}),or(["concat","join","pop","push","replace","shift","sort","splice","split","unshift"],function(e){var t=(/^(?:replace|split)$/.test(e)?Xt:Nt)[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=!Vn.spliceObjects&&/^(?:pop|shift|splice)$/.test(e),i=/^(?:join|pop|replace|shift)$/.test(e),s=r?function(){var e=t.apply(this,arguments);return this.length===0&&delete this[0],e}:t;zn.prototype[e]=function(){var e=arguments;return i&&!this.__chain__?s.apply(this.value(),e):this[n](function(t){return s.apply(t,e)})}}),jr($n.prototype,function(e,t){var n=zn[t];if(n){var r=n.name,i=qn[r]||(qn[r]=[]);i.push({name:t,func:n})}}),qn[Di(null,r).name]=[{name:"wrapper",func:null}],$n.prototype.clone=Jn,$n.prototype.reverse=Kn,$n.prototype.value=Qn,zn.prototype.chain=Qs,zn.prototype.commit=Gs,zn.prototype.plant=Ys,zn.prototype.reverse=Zs,zn.prototype.toString=eo,zn.prototype.run=zn.prototype.toJSON=zn.prototype.valueOf=zn.prototype.value=to,zn.prototype.collect=zn.prototype.map,zn.prototype.head=zn.prototype.first,zn.prototype.select=zn.prototype.filter,zn.prototype.tail=zn.prototype.rest,zn}var e,t="3.6.0",n=1,r=2,i=4,s=8,o=16,u=32,a=64,f=128,l=256,c=30,h="...",p=150,d=16,v=0,m=1,g=2,y="Expected a function",b="__lodash_placeholder__",w="[object Arguments]",E="[object Array]",S="[object Boolean]",x="[object Date]",T="[object Error]",N="[object Function]",C="[object Map]",k="[object Number]",L="[object Object]",A="[object RegExp]",O="[object Set]",M="[object String]",_="[object WeakMap]",D="[object ArrayBuffer]",P="[object Float32Array]",H="[object Float64Array]",B="[object Int8Array]",j="[object Int16Array]",F="[object Int32Array]",I="[object Uint8Array]",q="[object Uint8ClampedArray]",R="[object Uint16Array]",U="[object Uint32Array]",z=/\b__p \+= '';/g,W=/\b(__p \+=) '' \+/g,X=/(__e\(.*?\)|\b__t\)) \+\n'';/g,V=/&(?:amp|lt|gt|quot|#39|#96);/g,$=/[&<>"'`]/g,J=RegExp(V.source),K=RegExp($.source),Q=/<%-([\s\S]+?)%>/g,G=/<%([\s\S]+?)%>/g,Y=/<%=([\s\S]+?)%>/g,Z=/[\u0300-\u036f\ufe20-\ufe23]/g,et=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,tt=/\w*$/,nt=/^0[xX]/,rt=/^\[object .+?Constructor\]$/,it=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,st=/($^)/,ot=/[.*+?^${}()|[\]\/\\]/g,ut=RegExp(ot.source),at=/['\n\r\u2028\u2029\\]/g,ft=function(){var e="[A-Z\\xc0-\\xd6\\xd8-\\xde]",t="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(e+"+(?="+e+t+")|"+e+"?"+t+"|"+e+"+|[0-9]+","g")}(),lt=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",ct=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","document","isFinite","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","window"],ht=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],pt=-1,dt={};dt[P]=dt[H]=dt[B]=dt[j]=dt[F]=dt[I]=dt[q]=dt[R]=dt[U]=!0,dt[w]=dt[E]=dt[D]=dt[S]=dt[x]=dt[T]=dt[N]=dt[C]=dt[k]=dt[L]=dt[A]=dt[O]=dt[M]=dt[_]=!1;var vt={};vt[w]=vt[E]=vt[D]=vt[S]=vt[x]=vt[P]=vt[H]=vt[B]=vt[j]=vt[F]=vt[k]=vt[L]=vt[A]=vt[M]=vt[I]=vt[q]=vt[R]=vt[U]=!0,vt[T]=vt[N]=vt[C]=vt[O]=vt[_]=!1;var mt={leading:!1,maxWait:0,trailing:!1},gt={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},yt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},bt={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},wt={"function":!0,object:!0},Et={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},St=wt[typeof exports]&&exports&&!exports.nodeType&&exports,xt=wt[typeof module]&&module&&!module.nodeType&&module,Tt=St&&xt&&typeof global=="object"&&global,Nt=wt[typeof self]&&self&&self.Object&&self,Ct=wt[typeof window]&&window&&window.Object&&window,kt=xt&&xt.exports===St&&St,Lt=Tt||Ct!==(this&&this.window)&&Ct||Nt||this,zt=function(){try{Object({toString:0}+"")}catch(e){return function(){return!1}}return function(e){return typeof e.toString!="function"&&typeof (e+"")=="string"}}(),Yt=Gt();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(Lt._=Yt,define("lodash-compat/index",[],function(){return Yt})):St&&xt?kt?(xt.exports=Yt)._=Yt:St._=Yt:Lt._=Yt}.call(this),define("lodash-compat",["lodash-compat/index"],function(e){return e}),function(e){typeof e=="undefined"&&(e={}),typeof e.performance=="undefined"&&(e.performance={}),e._perfRefForUserTimingPolyfill=e.performance,e.performance.userTimingJsNow=!1,e.performance.userTimingJsNowPrefixed=!1,e.performance.userTimingJsUserTiming=!1,e.performance.userTimingJsUserTimingPrefixed=!1,e.performance.userTimingJsPerformanceTimeline=!1,e.performance.userTimingJsPerformanceTimelinePrefixed=!1;var t=[],n=[],r=null,i,s;if(typeof e.performance.now!="function"){e.performance.userTimingJsNow=!0,n=["webkitNow","msNow","mozNow"];for(i=0;i<n.length;i++)if(typeof e.performance[n[i]]=="function"){e.performance.now=e.performance[n[i]],e.performance.userTimingJsNowPrefixed=!0;break}var o=+(new Date);e.performance.timing&&e.performance.timing.navigationStart&&(o=e.performance.timing.navigationStart),typeof e.performance.now!="function"&&(Date.now?e.performance.now=function(){return Date.now()-o}:e.performance.now=function(){return+(new Date)-o})}var u=function(){},a=function(){},f=[],l=!1,c=!1;if(typeof e.performance.getEntries!="function"||typeof e.performance.mark!="function"){typeof e.performance.getEntries=="function"&&typeof e.performance.mark!="function"&&(c=!0),e.performance.userTimingJsPerformanceTimeline=!0,t=["webkit","moz"],n=["getEntries","getEntriesByName","getEntriesByType"];for(i=0;i<n.length;i++)for(s=0;s<t.length;s++)r=t[s]+n[i].substr(0,1).toUpperCase()+n[i].substr(1),typeof e.performance[r]=="function"&&(e.performance[n[i]]=e.performance[r],e.performance.userTimingJsPerformanceTimelinePrefixed=!0);u=function(e){f.push(e),e.entryType==="measure"&&(l=!0)};var h=function(){if(!l)return;f.sort(function(e,t){return e.startTime-t.startTime}),l=!1};a=function(e,t){i=0;while(i<f.length){if(f[i].entryType!==e){i++;continue}if(typeof t!="undefined"&&f[i].name!==t){i++;continue}f.splice(i,1)}};if(typeof e.performance.getEntries!="function"||c){var p=e.performance.getEntries;e.performance.getEntries=function(){h();var t=f.slice(0);return c&&p&&(Array.prototype.push.apply(t,p.call(e.performance)),t.sort(function(e,t){return e.startTime-t.startTime})),t}}if(typeof e.performance.getEntriesByType!="function"||c){var d=e.performance.getEntriesByType;e.performance.getEntriesByType=function(t){if(typeof t=="undefined"||t!=="mark"&&t!=="measure")return c&&d?d.call(e.performance,t):[];t==="measure"&&h();var n=[];for(i=0;i<f.length;i++)f[i].entryType===t&&n.push(f[i]);return n}}if(typeof e.performance.getEntriesByName!="function"||c){var v=e.performance.getEntriesByName;e.performance.getEntriesByName=function(t,n){if(n&&n!=="mark"&&n!=="measure")return c&&v?v.call(e.performance,t,n):[];typeof n!="undefined"&&n==="measure"&&h();var r=[];for(i=0;i<f.length;i++){if(typeof n!="undefined"&&f[i].entryType!==n)continue;f[i].name===t&&r.push(f[i])}return c&&v&&(Array.prototype.push.apply(r,v.call(e.performance,t,n)),r.sort(function(e,t){return e.startTime-t.startTime})),r}}}if(typeof e.performance.mark!="function"){e.performance.userTimingJsUserTiming=!0,t=["webkit","moz","ms"],n=["mark","measure","clearMarks","clearMeasures"];for(i=0;i<n.length;i++)for(s=0;s<t.length;s++)r=t[s]+n[i].substr(0,1).toUpperCase()+n[i].substr(1),typeof e.performance[r]=="function"&&(e.performance[n[i]]=e.performance[r],e.performance.userTimingJsUserTimingPrefixed=!0);var m={};typeof e.performance.mark!="function"&&(e.performance.mark=function(t){var n=e.performance.now();if(typeof t=="undefined")throw new SyntaxError("Mark name must be specified");if(e.performance.timing&&t in e.performance.timing)throw new SyntaxError("Mark name is not allowed");m[t]||(m[t]=[]),m[t].push(n),u({entryType:"mark",name:t,startTime:n,duration:0})}),typeof e.performance.clearMarks!="function"&&(e.performance.clearMarks=function(e){e?m[e]=[]:m={},a("mark",e)}),typeof e.performance.measure!="function"&&(e.performance.measure=function(t,n,r){var i=e.performance.now();if(typeof t=="undefined")throw new SyntaxError("Measure must be specified");if(!n){u({entryType:"measure",name:t,startTime:0,duration:i});return}var s=0;if(e.performance.timing&&n in e.performance.timing){if(n!=="navigationStart"&&e.performance.timing[n]===0)throw new Error(n+" has a timing of 0");s=e.performance.timing[n]-e.performance.timing.navigationStart}else{if(!(n in m))throw new Error(n+" mark not found");s=m[n][m[n].length-1]}var o=i;if(r){o=0;if(e.performance.timing&&r in e.performance.timing){if(r!=="navigationStart"&&e.performance.timing[r]===0)throw new Error(r+" has a timing of 0");o=e.performance.timing[r]-e.performance.timing.navigationStart}else{if(!(r in m))throw new Error(r+" mark not found");o=m[r][m[r].length-1]}}var a=o-s;u({entryType:"measure",name:t,startTime:s,duration:a})}),typeof e.performance.clearMeasures!="function"&&(e.performance.clearMeasures=function(e){a("measure",e)})}typeof define!="undefined"&&define.amd?define("usertiming/src/usertiming",[],function(){return e.performance}):typeof module!="undefined"&&typeof module.exports!="undefined"&&(module.exports=e.performance)}(typeof window!="undefined"?window:undefined),define("usertiming",["usertiming/src/usertiming"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("global-portable/lib/global",["require","exports"],e)}(function(e,t){var n="undefined",r=typeof window!==n?window:typeof global!==n?global:Object.create(null);t.__esModule=!0,t["default"]=r}),define("global-portable",["global-portable/lib/global"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-browser-globals/lib/globals",["require","exports","global-portable"],e)}(function(e,t){function s(){return r}function o(){return i}var n=e("global-portable"),r=n["default"].window,i=n["default"].document;t.getWindow=s,t.getDocument=o}),define("swx-browser-globals",["swx-browser-globals/lib/globals"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/stringUtils",["require","exports","lodash-compat"],e)}(function(e,t){function o(e,t){if(!e)return!1;var r=new RegExp("\\b"+n.escapeRegExp(t),"i");return f(e).search(r)!==-1}function u(e){return e.replace(/[\W]+|[\s]+/gi," ").trim()}function a(e){return e.replace(/[.,\/#!£$%\^&\*;:{}=\-+`~()]+/gi," ").replace(/\s+/g," ").trim()}function f(e){var t=parseInt("0xD800"),r=parseInt("0xDBFF"),i=0,o="",u="",a;if(!e)return e;while(i<e.length){o+=e.charAt(i),a=e.charCodeAt(i);if(a<t||a>r)u+=n.has(s,o)?s[o]:o,o="";i++}return u}function l(e,t,n,r){return typeof r=="undefined"&&(r=n),e.substr(0,n)+t+e.substr(r,e.length)}function c(e){return e===""}function h(e){return n.isString(e)&&e.length>0}function p(e){return e==="\r"}function d(e){return e==="\n"}function v(e){return e===" "}function m(e,t){var n=this.wordBoundariesAt(e,t);return n.start===-1?"":e.substring(n.start,n.end)}function g(e,t){if(t>e.length)return{start:-1,end:-1};if(t===e.length){if(e.search(/\s$/)!==-1)return{start:-1,end:-1};t--}var n=e.substring(0,t).search(/\S+$/),r=e.substring(t).search(/\s/);return n===-1&&(n=t),r===-1?r=e.length:r+=t,{start:n,end:r}}function y(e){return r+e+i}function b(e,t){var n=t;return h(e)&&!isNaN(e)&&(n=parseInt(e,10)),n}var n=e("lodash-compat"),r="‪",i="‬",s={"ª":"a","º":"o","À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Ç":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ý":"Y","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ù":"u","ú":"u","û":"u","ü":"u","ý":"y","ÿ":"y","Ā":"A","ā":"a","Ă":"A","ă":"a","Ą":"A","ą":"a","Ć":"C","ć":"c","Ĉ":"C","ĉ":"c","Ċ":"C","ċ":"c","Č":"C","č":"c","Ď":"D","ď":"d","Ē":"E","ē":"e","Ĕ":"E","ĕ":"e","Ė":"E","ė":"e","Ę":"E","ę":"e","Ě":"E","ě":"e","Ĝ":"G","ĝ":"g","Ğ":"G","ğ":"g","Ġ":"G","ġ":"g","Ģ":"G","ģ":"g","Ĥ":"H","ĥ":"h","Ĩ":"I","ĩ":"i","Ī":"I","ī":"i","Ĭ":"I","ĭ":"i","Į":"I","į":"i","İ":"I","Ĳ":"IJ","ĳ":"ij","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","Ĺ":"L","ĺ":"l","Ļ":"L","ļ":"l","Ľ":"L","ľ":"l","Ŀ":"L·","ŀ":"l·","Ń":"N","ń":"n","Ņ":"N","ņ":"n","Ň":"N","ň":"n","ŉ":"ʼn","Ō":"O","ō":"o","Ŏ":"O","ŏ":"o","Ő":"O","ő":"o","Ŕ":"R","ŕ":"r","Ŗ":"R","ŗ":"r","Ř":"R","ř":"r","Ś":"S","ś":"s","Ŝ":"S","ŝ":"s","Ş":"S","ş":"s","Š":"S","š":"s","Ţ":"T","ţ":"t","Ť":"T","ť":"t","Ũ":"U","ũ":"u","Ū":"U","ū":"u","Ŭ":"U","ŭ":"u","Ů":"U","ů":"u","Ű":"U","ű":"u","Ų":"U","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","ź":"z","Ż":"Z","ż":"z","Ž":"Z","ž":"z","ſ":"s","Ơ":"O","ơ":"o","Ư":"U","ư":"u","Ǆ":"DZ","ǅ":"Dz","ǆ":"dz","Ǉ":"LJ","ǈ":"Lj","ǉ":"lj","Ǌ":"NJ","ǋ":"Nj","ǌ":"nj","Ǎ":"A","ǎ":"a","Ǐ":"I","ǐ":"i","Ǒ":"O","ǒ":"o","Ǔ":"U","ǔ":"u","Ǖ":"U","ǖ":"u","Ǘ":"U","ǘ":"u","Ǚ":"U","ǚ":"u","Ǜ":"U","ǜ":"u","Ǟ":"A","ǟ":"a","Ǡ":"A","ǡ":"a","Ǧ":"G","ǧ":"g","Ǩ":"K","ǩ":"k","Ǫ":"O","ǫ":"o","Ǭ":"O","ǭ":"o","ǰ":"j","Ǳ":"DZ","ǲ":"Dz","ǳ":"dz","Ǵ":"G","ǵ":"g","Ǹ":"N","ǹ":"n","Ǻ":"A","ǻ":"a","Ȁ":"A","ȁ":"a","Ȃ":"A","ȃ":"a","Ȅ":"E","ȅ":"e","Ȇ":"E","ȇ":"e","Ȉ":"I","ȉ":"i","Ȋ":"I","ȋ":"i","Ȍ":"O","ȍ":"o","Ȏ":"O","ȏ":"o","Ȑ":"R","ȑ":"r","Ȓ":"R","ȓ":"r","Ȕ":"U","ȕ":"u","Ȗ":"U","ȗ":"u","Ș":"S","ș":"s","Ț":"T","ț":"t","Ȟ":"H","ȟ":"h","Ȧ":"A","ȧ":"a","Ȩ":"E","ȩ":"e","Ȫ":"O","ȫ":"o","Ȭ":"O","ȭ":"o","Ȯ":"O","ȯ":"o","Ȱ":"O","ȱ":"o","Ȳ":"Y","ȳ":"y","ʰ":"h","ʲ":"j","ʳ":"r","ʷ":"w","ʸ":"y","ˡ":"l","ˢ":"s","ˣ":"x"};t.anyWordStartsWith=o,t.clean=u,t.removeNonWordCharacters=a,t.normalize=f,t.inject=l,t.isEmpty=c,t.isNotEmpty=h,t.isCarriageReturn=p,t.isNewLine=d,t.isWhiteSpace=v,t.wordAt=m,t.wordBoundariesAt=g,t.forceLTREmbedding=y,t.tryParseInt=b}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/array",["require","exports","./stringUtils"],e)}(function(e,t){function r(e,t){function n(e,t){return e[t]}return e.sort(function(e,r){return a(n(e,t),n(r,t))})}function i(e,t){function n(e,t){return e[t]()}return e.sort(function(e,r){return a(n(e,t),n(r,t))})}function s(e,t,n){e.splice(t,0,n)}function o(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function u(e,t){return e.splice(t,1)[0]}function a(e,t){var r=n.normalize(e.toLowerCase().trim()),i=n.normalize(t.toLowerCase().trim());return r<i?-1:r>i?1:0}var n=e("./stringUtils");t.sortByProperty=r,t.sortByObservableProperty=i,t.insertAt=s,t.swapItems=o,t.removeFrom=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/async",["require","exports","swx-browser-globals"],e)}(function(e,t){function r(e,t,r){var i=t?e.bind(t):e;return r?Promise.resolve().then(i):n.getWindow().setTimeout(i,0)}var n=e("swx-browser-globals");t.execute=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/builderMixin",["require","exports","lodash-compat"],e)}(function(e,t){function r(){return r.prototype}var n=e("lodash-compat");r.prototype={build:function(){var e=Object.create(this.prototype);return this.apply(e,arguments)||e}},n.assign(r,r.prototype);var i=r;return i});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/cancelation",["require","exports","lodash-compat"],e)})(function(e,t){function s(e,t){return Promise.race([Promise.resolve(e),t])}function o(e,t){if(!t||!e||!n.isObject(e))return Promise.resolve(e);var r=e;if(n.isFunction(r.makeCancelable))return r.makeCancelable(t);var i=e;return n.isFunction(i.then)?s(i,t):undefined}function u(e){if(!e||!n.isObject(e)||!n.isFunction(e.abort))return e;var t=e;return t.makeCancelable=function(e){var t=this,n;return e["catch"](function(e){n=e,t.abort()}),Promise.resolve(this)["catch"](function(t){throw e.isCanceled?(n.innerException=t,n):t})},t}function a(){return new r}var n=e("lodash-compat"),r=function(){function e(){}return e.prototype.getToken=function(){var e=this,t=function(){var t=new Promise(function(t,n){e.rejectTokenFn=n});return Object.defineProperty(t,"isCanceled",{get:function(){return e.isCanceled}}),t.throwIfCanceled=function(){if(e.isCanceled)throw new i},e.isCanceled=!1,t};return this.token=this.token||t(),this.token},e.prototype.cancel=function(e){e=e||new i,this.token||this.getToken();if(this.isCanceled)throw new Error("The token is already canceled");this.isCanceled=!0,this.rejectTokenFn(e)},e}();t.CancelationTokenFactory=r;var i=function(e){function t(){return e.call(this,"Operation canceled")||this}return __extends(t,e),t}(Error);t.OperationCanceledError=i,t.makeCancelablePromise=s,t.makeCancelable=o,t.adaptAbortable=u,t.cancelableOperation=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/guid",["require","exports"],e)}(function(e,t){function n(e){var t=e.toString(16),n=4-t.length,r;for(r=0;r<n;r+=1)t="0"+t;return t}function r(){var e=new Array(8),t,r;for(r=0;r<e.length;r+=2)t=Math.floor(Math.random()*4294967296),e[r]=n(t&65535),e[r+1]=n(t>>>16),r+1===3&&(e[r+1]="4"+e[r+1].substring(1));return e}function i(){var e=r();return e[0]+e[1]+"-"+e[2]+"-"+e[3]+"-"+e[4]+"-"+e[5]+e[6]+e[7]}function s(){var e=r();return e[0]+e[1]+e[2]+e[3]+e[4]+e[5]+e[6]+e[7]}t.create=i,t.createRaw=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/http",["require","exports","lodash-compat"],e)}(function(e,t){function i(e){var t=e.request.getAllResponseHeaders(),i=t&&t.split(/\n+/g),s={};return i&&i.length&&n.forEach(i,function(e){e=e&&e.trim();var t=r.exec(e);if(t&&t.length===4){var n=t[1],i=t[3];s[n]=i}}),s}function s(e,t){var n=i(e);return n&&n[t]||null}var n=e("lodash-compat"),r=/^([\w\-]+)(:{1}[ \t]*)(.*)$/i;t.getAllResponseHeaders=i,t.getResponseHeader=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/loader",["require","exports","swx-browser-globals"],e)}(function(e,t){function r(e,t){e.getElementsByTagName("head")[0].appendChild(t)}function i(e){var t=n.getDocument(),i=t.createElement("link");return i.href=e,i.type="text/css",i.rel="stylesheet",r(t,i),i}function s(e,t,i){var s=n.getDocument(),o=s.createElement("script");return o.src=e,o.type="text/javascript",o.async=!0,t&&(o.onload=t),i&&(o.onerror=i),r(s,o),o}var n=e("swx-browser-globals");t.loadStyle=i,t.loadScript=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/regex",["require","exports"],e)}(function(e,t){function n(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function r(e,t){return new RegExp(e.join(""),t)}t.escapeSpecialChars=n,t.multilineRegExp=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/sessionStorage",["require","exports","swx-browser-globals"],e)}(function(e,t){function r(e,r){var i=n.getWindow();try{i.sessionStorage.setItem(e,r),delete t._backingStore[e]}catch(s){t._backingStore[e]=r}}function i(e){var r=n.getWindow();try{var i=r.sessionStorage.getItem(e);return!i&&e in t._backingStore?t._backingStore[e]:(t._backingStore[e]=i,i)}catch(s){}}function s(e){var r=n.getWindow();try{delete t._backingStore[e],r.sessionStorage.removeItem(e)}catch(i){}}function o(){var e=n.getWindow();try{t._backingStore={},e.sessionStorage.clear()}catch(r){}}var n=e("swx-browser-globals");t._backingStore={},t.set=r,t.get=i,t.remove=s,t.clear=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/settablePromise",["require","exports"],e)}(function(e,t){function n(){var e,t,n=new Promise(function(n,r){e=n,t=r});return n.resolve=e,n.reject=t,n}t.build=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/stopwatch",["require","exports"],e)}(function(e,t){function r(){return new n}var n=function(){function e(){this.msElapsed=0,this.isPaused=!1,this.startTime=(new Date).getTime()}return e.prototype.pause=function(){this.isPaused||(this.msElapsed+=(new Date).getTime()-this.startTime,this.isPaused=!0)},e.prototype.resume=function(){this.isPaused&&(this.isPaused=!1,this.startTime=(new Date).getTime())},e.prototype.duration=function(){return this.isPaused?this.msElapsed:this.msElapsed+(new Date).getTime()-this.startTime},e.prototype.durationInMinutes=function(){var e=this.duration()/6e4;return Math.ceil(e)},e.prototype.durationInSeconds=function(){var e=this.duration()/1e3;return Math.ceil(e)},e}();t.Stopwatch=n,t.build=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/url",["require","exports","lodash-compat"],e)}(function(e,t){function r(e,t,n){return e.length?e.push("&"):e=["?"],t==null?e.push(encodeURIComponent(n)):e=e.concat([encodeURIComponent(n),"=",encodeURIComponent(t)]),e}function i(e){var t=[];for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];var s=[e].concat(t),o=n.takeWhile(s,n.isString);s.splice(0,o.length);if(o.length===0||s.length>1)throw new RangeError("Query arguments object should be the last parameter");var u=n.head(s),a=n.reduce(o,function(e,t,r){var i=n.last(e);return i&&!n.endsWith(i,"/")&&!n.startsWith(t,"/")&&e.push("/"),e.push(t),e},[]);return a=a.concat(n.flatten(n.reduce(u,r,[]))),a.join("")}function s(e,t){if(e.indexOf("?")>-1&&e.indexOf(t)>-1&&t!==""){var n=e.split("?"),r=new RegExp("[&]?"+t+"=[^&]+");n[1]=n[1].replace(r,"").replace(/^&/,""),e=n[1]!==""?n.join("?"):n[0]}return e}function o(e,t,n){var r="&";return e.indexOf("?")===-1&&(r="?"),e=e+r+t,n&&n.length&&(e+="="+n),e}function u(e,t){var n;if(e.indexOf("?")>-1){var r=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),i=r.exec(e);i&&i.length>=2&&(n=i[2])}return n}var n=e("lodash-compat");t.buildUrl=i,t.removeQueryParameter=s,t.appendQueryParameter=o,t.getQueryParameterValueByName=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/version",["require","exports"],e)}(function(e,t){var n=function(){function e(e){this.unknownVersionString="U",this.isVersionValid=!0,this.versionString=e,this.parseComponents()}return e.prototype.getMajor=function(){return this.components[0]},e.prototype.getMinor=function(){return this.components[1]},e.prototype.getAllComponents=function(){return this.components},e.prototype.getOriginalString=function(){return this.versionString},e.prototype.isValid=function(){return this.isVersionValid},e.prototype.compareTo=function(e){var t=0,n=0,r=e.getAllComponents();if(!this.isValid()||!e.isValid())throw new Error("Invalid version cannot be compared");for(var i=0;i<r.length;++i){t=parseInt(this.components[i],10),n=parseInt(r[i],10);if(isNaN(t)||t<n)return-1;if(t>n)return 1}return 0},e.prototype.parseComponents=function(){if(!this.versionString){this.components=[this.unknownVersionString,this.unknownVersionString],this.isVersionValid=!1;return}var e=this.getDelimiter();e?(this.components=this.versionString.split(e),this.validateComponents()):(this.components=[this.versionString,this.unknownVersionString],this.isVersionValid=!1)},e.prototype.validateComponents=function(){for(var e=0;e<this.components.length;++e)if(!this.components[e]||isNaN(parseInt(this.components[e],10))){this.components.push(this.unknownVersionString),this.isVersionValid=!1;break}},e.prototype.getDelimiter=function(){return this.versionString.indexOf(".")>-1?".":this.versionString.indexOf("_")>-1?"_":null},e}();t.Version=n;var r=function(e){return new n(e)};t.__esModule=!0,t["default"]={parse:r},t.parse=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/file",["require","exports"],e)}(function(e,t){function n(e){var t=["image/png","image/x-png","image/jpeg"];return t.some(function(t){return e.type===t})}t.isImage=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-common/lib/index",["require","exports","./array","./async","./builderMixin","./cancelation","./guid","./http","./loader","./regex","./sessionStorage","./settablePromise","./stopwatch","./stringUtils","./url","./version","./file"],e)}(function(e,t){var n=e("./array");t.array=n;var r=e("./async");t.async=r;var i=e("./builderMixin");t.builderMixin=i;var s=e("./cancelation");t.cancelation=s;var o=e("./guid");t.guid=o;var u=e("./http");t.http=u;var a=e("./loader");t.loader=a;var f=e("./regex");t.regex=f;var l=e("./sessionStorage");t.sessionStorage=l;var c=e("./settablePromise");t.settablePromise=c;var h=e("./stopwatch");t.stopwatch=h;var p=e("./stringUtils");t.stringUtils=p;var d=e("./url");t.url=d;var v=e("./version");t.version=v;var m=e("./file");t.file=m}),define("swx-utils-common",["swx-utils-common/lib/index"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-browser-detect/lib/detect",["require","exports","swx-browser-globals","swx-utils-common"],e)}(function(e,t){function p(){return n.getWindow().navigator.userAgent}function d(e){return p().indexOf(e)>-1}function v(){return d("Trident")}function m(){return d(i.EDGE)}function g(){return d(i.FIREFOX)}function y(){return d(i.CHROME)}function b(){return d(i.YANDEX)}function w(){return d("OPR/")}function E(){return w()?i.UNKNOWN:d(i.PHANTOMJS)?i.PHANTOMJS:m()?i.EDGE:d(i.ELECTRON)?i.ELECTRON:d(i.CHROME)?i.CHROME:d(i.FIREFOX)?i.FIREFOX:d(i.SAFARI)?i.SAFARI:d(i.SKYPE_SHELL)?i.SKYPE_SHELL:v()?i.MSIE:i.UNKNOWN}function S(){function e(){var e,t=p(),n=t.match(new RegExp(i.MSIE+" "+c));return n?n[1]:(e=t.match(new RegExp("rv:"+c)),e?e[1]:undefined)}function t(e){var t;return e===i.SAFARI&&(e="Version"),t=p().match(new RegExp(e+"/"+c)),t?t[1]:f}return v()?e():t(E())}function x(){var e=/(android|ipod|windows phone|wpdesktop|windows ce|blackberry\w*|meego|webos|palm|symbian|pda|\w*?mobile\w*?|\w*?phone\w*?)/i,t=/tablet|ipad/i;return p().match(e)?o.MOBILE:p().match(t)?o.TABLET:o.DESKTOP}function T(){var e=/(windows|win32)/i,t=/ arm;/i,n=/windows\sphone\s\d+\.\d+/i,r=/(macintosh|mac os x)/i,i=/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i,o=/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|cros)/i,u=/android/i;return p().match(n)?s.WINDOWS_PHONE:p().match(t)?s.WINDOWS_RT:p().match(i)?s.IOS:p().match(u)?s.ANDROID:p().match(o)?s.LINUX:p().match(r)?s.MACOSX:p().match(e)?s.WINDOWS:s.UNKNOWN}function N(e){function t(e){var t=p().match(new RegExp("Windows NT "+c));if(t){if(e)return t[1];if(u[t[1]])return u[t[1]]}return f}function n(e){var t=p().match(new RegExp(s.MACOSX+" "+h));if(t){var n=r.version.parse(t[1].replace(/_/g,"."));return e?n.getAllComponents().join("."):n.getMajor()}return f}return T()===s.WINDOWS?t(e):T()===s.MACOSX?n(e):f}function C(){return d("WOW64")||d("Win64")}function k(){var e=n.getWindow();return{width:n.getWindow().screen&&n.getWindow().screen.width||0,height:n.getWindow().screen&&n.getWindow().screen.height||0,pixelRatio:n.getWindow().devicePixelRatio||0,colorDepth:n.getWindow().screen&&n.getWindow().screen.colorDepth||0,isTouchEnabled:Object.prototype.hasOwnProperty.call(e,"ontouchstart")||n.getWindow().navigator.MaxTouchPoints>0||n.getWindow().navigator.msMaxTouchPoints>0}}function L(){return{deviceType:x(),osName:T(),osVersion:N(!1),osRawVersion:N(!0),is64bit:C(),platform:n.getWindow().navigator.platform}}function A(){return E()===i.MSIE&&O()?n.getWindow().external.msIsSiteMode():"n/a"}function O(){return n.getWindow().hasOwnProperty("external")&&n.getWindow().external.hasOwnProperty("msIsSiteMode")}function M(){return E()===i.SKYPE_SHELL}function _(){return E()===i.ELECTRON}function D(){return T()===s.LINUX&&(E()===i.CHROME||E()===i.ELECTRON)}function P(){var e=n.getWindow();return(e.navigator.getUserMedia||e.navigator.mozGetUserMedia||e.navigator.webkitGetUserMedia)&&(typeof e.RTCPeerConnection!="undefined"||typeof e.RTCIceGatherer!="undefined"||typeof e.mozRTCPeerConnection!="undefined"||typeof e.webkitRTCPeerConnection!="undefined")}function H(){return P()}function B(){return!1}function j(){var e=E();return e===i.FIREFOX||e===i.CHROME}function q(){var e=I();return isNaN(e)?e:parseInt(e,10)}function R(e){return e in n.getWindow().document.documentElement.style}var n=e("swx-browser-globals"),r=e("swx-utils-common"),i={MSIE:"MSIE",CHROME:"Chrome",FIREFOX:"Firefox",SAFARI:"Safari",EDGE:"Edge",ELECTRON:"Electron",SKYPE_SHELL:"SkypeShell",PHANTOMJS:"PhantomJS",YANDEX:"YaBrowser",UNKNOWN:"Unknown"},s={WINDOWS:"Windows",MACOSX:"Mac OS X",WINDOWS_PHONE:"Windows Phone",WINDOWS_RT:"Windows RT",IOS:"iOS",ANDROID:"Android",LINUX:"Linux",UNKNOWN:"Unknown"},o={DESKTOP:1,MOBILE:2,TABLET:8},u={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"},a={OBJECT_FIT:"objectFit"},f="U",l="42",c="([\\d,.]+)",h="([\\d,_,.]+)",F=function(){var e={},t=n.getWindow().location;if(!t.search)return e;var r=t.search.substring(1).split("&");if(!r)return e;for(var i=0;i<r.length;i++){var s=r[i].split("=");if(!s[1])continue;e[s[0]]=s[1]||!0}return e},I=function(){return r.version.parse(S()).getMajor()},U=function(){return{browserName:E(),browserVersion:S(),browserMajorVersion:q(),isPinnedSite:A(),isIeEngine:v(),isEdge:m(),isFirefox:g(),isChrome:y(),isShellApp:M(),isElectron:_(),isYandex:b(),isChromeOnLinux:D(),isInBrowserPluginSupported:B(),isPluginlessCallingSupported:H(),isBrowserDefaultToBlockPlugin:j(),getUrlParams:F,getUserAgent:p}};t.__esModule=!0,t["default"]={getBrowserInfo:U,getScreenInfo:k,getSystemInfo:L,supportsCssProperty:R,supportsPinnedSites:O,BROWSERS:i,OPERATING_SYSTEMS:s,DEVICE_TYPES:o,CSS_PROPERTIES:a}}),define("swx-browser-detect",["swx-browser-detect/lib/detect"],function(e){return e}),define("browser/window",[],function(){return window}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-enums/lib/enums",["require","exports"],e)}(function(e,t){var n;(function(e){e[e.ParticipantJoined="ParticipantJoined"]="ParticipantJoined",e[e.ParticipantLeft="ParticipantLeft"]="ParticipantLeft",e[e.ParticipantJoinFailed="ParticipantJoinFailed"]="ParticipantJoinFailed",e[e.ParticipantRoleUpdate="ParticipantRoleUpdate"]="ParticipantRoleUpdate",e[e.ParticipantTopicUpdate="ParticipantTopicUpdate"]="ParticipantTopicUpdate",e[e.ParticipantPictureUpdate="ParticipantPictureUpdate"]="ParticipantPictureUpdate",e[e.ParticipantHistoryDisclosed="ParticipantHistoryDisclosed"]="ParticipantHistoryDisclosed",e[e.ParticipantJoiningEnabled="ParticipantJoiningEnabled"]="ParticipantJoiningEnabled",e[e.ParticipantLegacyMemberAdded="ParticipantLegacyMemberAdded"]="ParticipantLegacyMemberAdded",e[e.ParticipantLegacyMemberUpgraded="ParticipantLegacyMemberUpgraded"]="ParticipantLegacyMemberUpgraded",e[e.CallStarted="CallStarted"]="CallStarted",e[e.CallEnded="CallEnded"]="CallEnded",e[e.CallMissed="CallMissed"]="CallMissed",e[e.NgcUpgradeMessage="NgcUpgradeMessage"]="NgcUpgradeMessage",e[e.PluginFreeFallbackScreenSharing="PluginFreeFallbackScreenSharing"]="PluginFreeFallbackScreenSharing",e[e.PluginFreeFallbackMicrophoneAccess="PluginFreeFallbackMicrophoneAccess"]="PluginFreeFallbackMicrophoneAccess",e[e.PluginFreeNoVideoCapability="PluginFreeNoVideoCapability"]="PluginFreeNoVideoCapability",e[e.PluginFreeVideoCompatibility="PluginFreeVideoCompatibility"]="PluginFreeVideoCompatibility",e[e.PstnInsufficientFunds="InsufficientFunds"]="PstnInsufficientFunds",e[e.PstnInvalidNumber="InvalidNumber"]="PstnInvalidNumber",e[e.PstnForbiddenNumber="ForbiddenNumber"]="PstnForbiddenNumber",e[e.TextMessage="TextMessage"]="TextMessage",e[e.AudioMessage="AudioMessage"]="AudioMessage",e[e.VideoMessage="VideoMessage"]="VideoMessage",e[e.PictureMessage="PictureMessage"]="PictureMessage",e[e.ContactRequestIncoming="ContactRequestIncoming"]="ContactRequestIncoming",e[e.ContactRequestIncomingInviteFree="ContactRequestIncomingInviteFree"]="ContactRequestIncomingInviteFree",e[e.ContactRequestOutgoing="ContactRequestOutgoing"]="ContactRequestOutgoing",e[e.ContactRequestOutgoingResend="ContactRequestOutgoingResend"]="ContactRequestOutgoingResend",e[e.ContactRequestOutgoingAgent="ContactRequestOutgoingAgent"]="ContactRequestOutgoingAgent",e[e.ContactRequestOutgoingPSTN="ContactRequestOutgoingPSTN"]="ContactRequestOutgoingPSTN",e[e.ContactRequestIsNowContact="ContactRequestIsNowContact"]="ContactRequestIsNowContact",e[e.SuggestedContact="SuggestedContact"]="SuggestedContact",e[e.UnblockContact="UnblockContact"]="UnblockContact",e[e.MojiMessage="MojiMessage"]="MojiMessage",e[e.FileTransfer="FileTransfer"]="FileTransfer",e[e.ContactInfoMessage="ContactInfoMessage"]="ContactInfoMessage",e[e.CreditTransaction="CreditTransaction"]="CreditTransaction",e[e.PollMessage="PollMessage"]="PollMessage",e[e.SystemMessage="SystemMessage"]="SystemMessage",e[e.CustomMessage="CustomMessage"]="CustomMessage",e[e.Transcript="Transcript"]="Transcript",e[e.Na="n/a"]="Na"})(n=t.activityType||(t.activityType={}));var r;(function(e){e[e.Pending="Pending"]="Pending",e[e.Succeeded="Succeeded"]="Succeeded",e[e.Failed="Failed"]="Failed"})(r=t.activityStatus||(t.activityStatus={}));var i;(function(e){e[e.Pending="Pending"]="Pending",e[e.Succeeded="Succeeded"]="Succeeded",e[e.Failed="Failed"]="Failed"})(i=t.transactionStatus||(t.transactionStatus={}));var s;(function(e){e[e.Incoming="Incoming"]="Incoming",e[e.Outgoing="Outgoing"]="Outgoing"})(s=t.direction||(t.direction={}));var o;(function(e){e[e.Text="Text"]="Text",e[e.Html="Html"]="Html"})(o=t.messageFormat||(t.messageFormat={}));var u;(function(e){e[e.Text="Text"]="Text",e[e.Html="Html"]="Html"})(u=t.messageType||(t.messageType={}));var a;(function(e){e[e.Disconnected="Disconnected"]="Disconnected",e[e.Notified="Notified"]="Notified",e[e.Connecting="Connecting"]="Connecting",e[e.Ringing="Ringing"]="Ringing",e[e.EarlyMedia="EarlyMedia"]="EarlyMedia",e[e.Connected="Connected"]="Connected",e[e.Disconnecting="Disconnecting"]="Disconnecting"})(a=t.callConnectionState||(t.callConnectionState={}));var f;(function(e){e[e.Terminated="Terminated"]="Terminated",e[e.FullSession="FullSession"]="FullSession",e[e.Busy="Busy"]="Busy",e[e.Refused="Refused"]="Refused",e[e.Missed="Missed"]="Missed",e[e.Dropped="Dropped"]="Dropped",e[e.InvalidNumber="InvalidNumber"]="InvalidNumber",e[e.ForbiddenNumber="ForbiddenNumber"]="ForbiddenNumber",e[e.EmergencyCallDenied="EmergencyCallDenied"]="EmergencyCallDenied",e[e.VoiceMailFailed="VoiceMailFailed"]="VoiceMailFailed",e[e.TransferFailed="TransferFailed"]="TransferFailed",e[e.InsufficientFunds="InsufficientFunds"]="InsufficientFunds",e[e.Failed="Failed"]="Failed",e[e.MissingSpeaker="MissingSpeaker"]="MissingSpeaker",e[e.MissingMicrophone="MissingMicrophone"]="MissingMicrophone",e[e.CallEscalated="CallEscalated"]="CallEscalated",e[e.OutOfBrowserCall="OutOfBrowserCall"]="OutOfBrowserCall",e[e.NoP2PFallback="NoP2PFallback"]="NoP2PFallback",e[e.AutoCallFailed="AutoCallFailed"]="AutoCallFailed",e[e.AutoCallTimeout="AutoCallTimeout"]="AutoCallTimeout",e[e.CallConnectTimeout="CallConnectTimeout"]="CallConnectTimeout",e[e.NotificationTimeout="NotificationTimeout"]="NotificationTimeout",e[e.Canceled="Canceled"]="Canceled",e[e.Unknown="Unknown"]="Unknown"})(f=t.callDisconnectionReason||(t.callDisconnectionReason={}));var l;(function(e){e[e.Skype="Skype"]="Skype"})(l=t.ecsClientNames||(t.ecsClientNames={}));var c;(function(e){e[e.Camera="Camera"]="Camera",e[e.Microphone="Microphone"]="Microphone",e[e.Speaker="Speaker"]="Speaker"})(c=t.deviceType||(t.deviceType={}));var h;(function(e){e[e.Root="Root"]="Root",e[e.Custom="Custom"]="Custom",e[e.Others="Others"]="Others",e[e.Favorites="Favorites"]="Favorites",e[e.Distribution="Distribution"]="Distribution",e[e.PrivacyRelationship="PrivacyRelationship"]="PrivacyRelationship"})(h=t.groupType||(t.groupType={}));var p;(function(e){e[e.None="None"]="None",e[e.Blocked="Blocked"]="Blocked",e[e.Colleagues="Colleagues"]="Colleagues",e[e.Workgroup="Workgroup"]="Workgroup",e[e.External="External"]="External",e[e.FriendsAndFamily="FriendsAndFamily"]="FriendsAndFamily"})(p=t.groupPrivacyRelationshipLevel||(t.groupPrivacyRelationshipLevel={}));var d;(function(e){e[e.Started="Started"]="Started",e[e.Active="Active"]="Active",e[e.Inactive="Inactive"]="Inactive",e[e.Stopped="Stopped"]="Stopped"})(d=t.mediaStreamState||(t.mediaStreamState={}));var v;(function(e){e[e.Unknown="Unknown"]="Unknown",e[e.Video="Video"]="Video",e[e.Video_WMV="Video_WMV"]="Video_WMV",e[e.Video_MOV="Video_MOV"]="Video_MOV",e[e.Video_MP4="Video_MP4"]="Video_MP4",e[e.Picture="Picture"]="Picture"})(v=t.mediaType||(t.mediaType={}));var m;(function(e){e[e.Unknown="Unknown"]="Unknown",e[e.Pending="Pending"]="Pending",e[e.Completed="Completed"]="Completed",e[e.Failed="Failed"]="Failed"})(m=t.mediaStatus||(t.mediaStatus={}));var g;(function(e){e[e.Attendee="Attendee"]="Attendee",e[e.Leader="Leader"]="Leader"})(g=t.participantRole||(t.participantRole={}));var y;(function(e){e[e.Disconnected="Disconnected"]="Disconnected",e[e.Connecting="Connecting"]="Connecting",e[e.InLobby="InLobby"]="InLobby",e[e.Connected="Connected"]="Connected",e[e.Disconnecting="Disconnecting"]="Disconnecting"})(y=t.participantState||(t.participantState={}));var b;(function(e){e[e.Online="Online"]="Online",e[e.Offline="Offline"]="Offline",e[e.Hidden="Hidden"]="Hidden",e[e.Busy="Busy"]="Busy",e[e.Idle="Idle"]="Idle",e[e.BeRightBack="BeRightBack"]="BeRightBack",e[e.Away="Away"]="Away",e[e.DoNotDisturb="DoNotDisturb"]="DoNotDisturb",e[e.Unknown="Unknown"]="Unknown",e[e.OnThePhone="OnThePhone"]="OnThePhone",e[e.OutForLunch="OutForLunch"]="OutForLunch"})(b=t.onlineStatus||(t.onlineStatus={}));var w;(function(e){e[e.Home="Home"]="Home",e[e.Work="Work"]="Work",e[e.Cell="Cell"]="Cell",e[e.Other="Other"]="Other"})(w=t.phoneType||(t.phoneType={}));var E;(function(e){e[e.autoBuddy="autoBuddy"]="autoBuddy",e[e.linkedMSA="linkedMSA"]="linkedMSA"})(E=t.selfSettings||(t.selfSettings={}));var S;(function(e){e[e.Personal="Personal"]="Personal",e[e.Work="Work"]="Work",e[e.Other="Other"]="Other"})(S=t.emailType||(t.emailType={}));var x;(function(e){e[e.Home="Home"]="Home",e[e.Work="Work"]="Work",e[e.Other="Other"]="Other",e[e.Unknown="Unknown"]="Unknown"})(x=t.locationType||(t.locationType={}));var T;(function(e){e[e.Personal="Personal"]="Personal",e[e.OutOfOffice="OutOfOffice"]="OutOfOffice"})(T=t.noteType||(t.noteType={}));var N;(function(e){e[e.Desktop="Desktop"]="Desktop",e[e.Mobile="Mobile"]="Mobile",e[e.Web="Web"]="Web",e[e.Unknown="Unknown"]="Unknown"})(N=t.endpointType||(t.endpointType={}));var C;(function(e){e[e.RequestFailed="RequestFailed"]="RequestFailed"})(C=t.reasonCode||(t.reasonCode={}));var k;(function(e){e[e.Desktop="Desktop"]="Desktop",e[e.Application="Application"]="Application",e[e.Window="Window"]="Window"})(k=t.sharedResourceType||(t.sharedResourceType={}));var L;(function(e){e[e.Agent="Agent"]="Agent",e[e.AddressBook="AddressBook"]="AddressBook",e[e.SkypeDirectory="SkypeDirectory"]="SkypeDirectory",e[e.Groups="Groups"]="Groups",e[e.All="All"]="All"})(L=t.searchScope||(t.searchScope={}));var A;(function(e){e[e.SignedOut="SignedOut"]="SignedOut",e[e.SigningIn="SigningIn"]="SigningIn",e[e.SignedIn="SignedIn"]="SignedIn",e[e.SigningOut="SigningOut"]="SigningOut"})(A=t.loginState||(t.loginState={}));var O;(function(e){e[e.NotReady="NotReady"]="NotReady",e[e.Authenticated="Authenticated"]="Authenticated",e[e.Error="Error"]="Error"})(O=t.translatorServiceState||(t.translatorServiceState={}));var M;(function(e){e[e.Password="Password"]="Password",e[e.Token="Token"]="Token",e[e.Passive="Passive"]="Passive",e[e.ImplicitOAuth="ImplicitOAuth"]="ImplicitOAuth",e[e.Guest="Guest"]="Guest",e[e.Integrated="Integrated"]="Integrated",e[e.OutOfBrowser="OutOfBrowser"]="OutOfBrowser"})(M=t.authType||(t.authType={}));var _;(function(e){e[e.PluginNotInstalled="PluginNotInstalled"]="PluginNotInstalled",e[e.PluginOutOfDate="PluginOutOfDate"]="PluginOutOfDate",e[e.BrowserNotSupported="BrowserNotSupported"]="BrowserNotSupported",e[e.PluginBlocked="PluginBlocked"]="PluginBlocked",e[e.PluginAlreadyRunning="PluginAlreadyRunning"]="PluginAlreadyRunning",e[e.OSNotSupported="OSNotSupported"]="OSNotSupported",e[e.FeatureDisabled="FeatureDisabled"]="FeatureDisabled",e[e.TooManyParticipants="TooManyParticipants"]="TooManyParticipants",e[e.NotInConversation="NotInConversation"]="NotInConversation",e[e.CameraUnavailable="CameraUnavailable"]="CameraUnavailable",e[e.TrouterNotInitialized="TrouterNotInitialized"]="TrouterNotInitialized"})(_=t.callingNotSupportedReasons||(t.callingNotSupportedReasons={}));var D;(function(e){e[e.Uploading="Uploading"]="Uploading",e[e.FileMissing="FileMissing"]="FileMissing",e[e.Failed="Failed"]="Failed",e[e.FailedMalwareScan="FailedMalwareScan"]="FailedMalwareScan",e[e.Cancelled="Cancelled"]="Cancelled",e[e.Sent="Sent"]="Sent"})(D=t.fileUploadState||(t.fileUploadState={}));var P;(function(e){e[e.Premium="Premium"]="Premium",e[e.Skypein="Skypein"]="Skypein",e[e.Calling="Calling"]="Calling",e[e.CallingLegacy="CallingLegacy"]="CallingLegacy",e[e.StickerPack="StickerPack"]="StickerPack"})(P=t.marketplaceSkuType||(t.marketplaceSkuType={}));var H;(function(e){e[e.None="None"]="None",e[e.P2P="P2P"]="P2P",e[e.NGC="NGC"]="NGC"})(H=t.callTechnology||(t.callTechnology={}));var B;(function(e){e[e.Unknown="Unknown"]="Unknown",e[e.PluginBasedP2P="PluginBasedP2P"]="PluginBasedP2P",e[e.PluginBasedNGC="PluginBasedNGC"]="PluginBasedNGC",e[e.Pluginless="Pluginless"]="Pluginless"})(B=t.mediaConnectionType||(t.mediaConnectionType={}));var j;(function(e){e[e.Plan="plan"]="Plan",e[e.Package="package"]="Package"})(j=t.subscriptionType||(t.subscriptionType={}));var F;(function(e){e[e.Unknown="Unknown"]="Unknown",e[e.Unset="Unset"]="Unset",e[e.Defined="Defined"]="Defined",e[e.Saving="Saving"]="Saving"})(F=t.preferenceValueState||(t.preferenceValueState={}));var I;(function(e){e[e.URL_PREVIEWS=11]="URL_PREVIEWS",e[e.YOUTUBE_PLAYER=12]="YOUTUBE_PLAYER",e[e.MENTIONS=13]="MENTIONS",e[e.FILE_PASTE=14]="FILE_PASTE",e[e.ALLOW_VIDEO_CALLS_FROM_CONTACTS_ONLY=15]="ALLOW_VIDEO_CALLS_FROM_CONTACTS_ONLY",e[e.DONT_ALLOW_VIDEO_CALLS=16]="DONT_ALLOW_VIDEO_CALLS",e[e.TYPING_INDICATOR=20]="TYPING_INDICATOR",e[e.NOTIFICATIONS=21]="NOTIFICATIONS",e[e.NOTIFICATIONS_SOUND=22]="NOTIFICATIONS_SOUND",e[e.SHOW_EMOTICON_SUGGESTIONS_SETTINGS=23]="SHOW_EMOTICON_SUGGESTIONS_SETTINGS",e[e.SHOW_EMOTICONS=24]="SHOW_EMOTICONS",e[e.SHOW_ANIMATED_EMOTICONS=25]="SHOW_ANIMATED_EMOTICONS",e[e.SHOW_LARGE_EMOTICONS=26]="SHOW_LARGE_EMOTICONS",e[e.DARK_THEME=28]="DARK_THEME",e[e.VIDEO_AUTOPLAY=29]="VIDEO_AUTOPLAY",e[e.CHAT_NOTIFICATIONS_SOUND=31]="CHAT_NOTIFICATIONS_SOUND",e[e.CALL_NOTIFICATIONS=32]="CALL_NOTIFICATIONS",e[e.CALL_NOTIFICATIONS_SOUND=33]="CALL_NOTIFICATIONS_SOUND"})(I=t.skypeFlagsApiMappings||(t.skypeFlagsApiMappings={}));var q;(function(e){e[e.Boolean="Boolean"]="Boolean",e[e.Number="Number"]="Number",e[e.String="String"]="String",e[e.CallPolicy="CallPolicy"]="CallPolicy",e[e.VideoPolicy="VideoPolicy"]="VideoPolicy",e[e.AutoBuddy="AutoBuddy"]="AutoBuddy",e[e.AutoBuddyDiscovery="AutoBuddyDiscovery"]="AutoBuddyDiscovery",e[e.AutoBuddyDiscoveryEmail="AutoBuddyDiscoveryEmail"]="AutoBuddyDiscoveryEmail",e[e.AutoBuddyDiscoveryPhone="AutoBuddyDiscoveryPhone"]="AutoBuddyDiscoveryPhone",e[e.Notifications="Notifications"]="Notifications",e[e.RingingDeferrer="RingingDeferrer"]="RingingDeferrer"})(q=t.preferenceType||(t.preferenceType={}));var R;(function(e){e[e.Anyone=0]="Anyone",e[e.ContactsOnly=1]="ContactsOnly",e[e.NoOne=2]="NoOne"})(R=t.privacyPolicyValues||(t.privacyPolicyValues={}));var U;(function(e){e[e.Top="Top"]="Top",e[e.Bottom="Bottom"]="Bottom"})(U=t.contextMenuPosition||(t.contextMenuPosition={}));var z;(function(e){e[e.Unset=0]="Unset",e[e.Defer4Hours=4]="Defer4Hours",e[e.Defer8Hours=8]="Defer8Hours",e[e.Defer24Hours=24]="Defer24Hours"})(z=t.ringingDeferrerOptions||(t.ringingDeferrerOptions={}));var W;(function(e){e[e.Sending="Sending"]="Sending",e[e.Sent="Sent"]="Sent",e[e.Delivered="Delivered"]="Delivered",e[e.Error="Error"]="Error",e[e.Unknown="Unknown"]="Unknown"})(W=t.smsStatus||(t.smsStatus={}));var X;(function(e){e[e.ActiveSpeaker="ActiveSpeaker"]="ActiveSpeaker",e[e.MultiView="MultiView"]="MultiView",e[e.Both="Both"]="Both"})(X=t.videoMode||(t.videoMode={}))}),define("swx-enums",["swx-enums/lib/enums"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-constants/lib/calling",["require","exports","swx-enums"],e)}(function(e,t){var n=e("swx-enums");t.__esModule=!0,t["default"]={DOM_ELEMENT:{ID:{CHAT_COMPONENT:"chatComponent",CONTENT_WRAPPER:"contentWrapper",CALL_SCREEN:"callScreen",CALL_SCREEN_RESIZE:"callScreenResize",LOCAL_VIDEO_CONTAINER:"local-video-ui"}},SELECTORS:{CONTAINER:".av .middle",MAIN:".av .main",VIDEO:".video",TOP:".top",BOTTOM:".bottom",STAGE:".stage",ROSTER:"swx-call-roster"},CLASSES:{VIDEO_ON:"videoOn",LOCAL_PIP_IN_ROSTER:"localPipInRoster",PLUGINLESS:"pluginless",ASPECT_RATIO_1BY1:"ratio1by1",ASPECT_RATIO_4BY3:"ratio4by3",ASPECT_RATIO_16BY9:"ratio16by9",SCREEN_SHARING:"screenSharing",SMALL_PREVIEW:"smallPreview"},CONTROLS:{CALL_SCREEN:"av",END_CALL_CONTROL:"endCallControl",MUTE_CONTROL:"muteControl"},EVENTS:{START_CALL:"calling.startCall",RINGING_IN:"calling.ringingIn",ANSWER:"calling.answer",REJECT:"calling.reject",INCOMING_CALL_TOAST_TIMEOUT:"calling.incomingCallToastTimeout",INCOMING_INIT_ERROR:"IncomingInitialisationError",INCOMING_INIT_SUCCESS:"IncomingInitialisationSuccess",STOP_RINGING:"calling.stopRinging",FULLSCREEN_CHANGED:"calling.fullscreenChanged",CALL_SCREEN_CLOSE:"calling.callScreenClose",CALL_SCREEN_HEIGHT_CHANGED:"calling.callScreenChanged",START_RINGING:"calling.startRinging",CALLSESSION_STARTING:"calling.callsession.starting",CALLSESSION_ENDED:"calling.callsession.ended",PARICIPANT_VOICE_STATUS:"calling.participantVoiceStatus",PARICIPANT_JOINED:"calling.participantJoined",CALL_STATUS_CHANGED:"calling.callStatusChanged",ERROR_INCOMING_CALL:"calling.error.incomingCall",ERROR_OUTGOING_CALL:"calling.error.outgoingCall",CQF_SCREEN_CLOSE:"calling.cqfScreenClose",CQF_CANCEL:"calling.cqfCancel",UNANSWERED_CALL_CLOSE:"unansweredCall:close",UNANSWERED_CALL_SEND_MESSAGE:"unansweredCall:sendMessage"},TELEMETRY_EVENTS:{PLUGIN_INSTALL_STARTED:"PluginInstallStarted",PLUGIN_INSTALL_ENDED:"PluginInstallEnded"},PLUGIN_INSTALL_EXIT_METHOD:{CLOSE:"close",PLUGIN_DETECTED:"pluginDetected",CALL_STARTED:"callStarted"},NA:"n/a",CALLING_SETUP_STEPS:{OVERLAY_PLUGIN_CALLBACK:"overlayPluginCallback",CLOSE_CALLING_SETUP:"closeCallingSetup",OVERLAY_PLUGIN_STEPS:"overlayPluginSteps",OVERLAY_EXTENSION_INSTALLED:"overlayExtensionInstalled",OVERLAY_EXTENSION_INSTALL:"overlayExtensionInstall",OVERLAY_EXTENSION_INSTALL_FAILED:"overlayExtensionInstallFailed",OVERLAY_EXTENSION_START:"overlayExtensionStart",OVERLAY_PLUGIN_START:"overlayPluginStart",OVERLAY_PLUGIN_UNBLOCK:"overlayPluginUnblock",OVERLAY_PLUGIN_FIREFOX_UNABLE_TO_CALL:"overlayPluginFirefoxUnableToCall"},SOUND_LEVEL_EVENT_MODE:{None:"None",Boolean:"Boolean",Full:"Full"},SOUND_LEVEL_DEFAULT_THRESHOLD:4,PLUGIN_MAX_SOUND_LEVEL:10,PARTICIPANT_REMOVE_FROM_CALLSCREEN_TIMEOUT:1e4,CALL_STATES:{CONNECTING:"connecting",CALLING:"calling",EARLY_MEDIA:"earlyMedia",CONNECTED:"connected",ENDING:"ending",ENDED:"ended"},NOTIFICATION_ACTIONS:{AUDIO:"audio",VIDEO:"video",REJECT:"reject",INSTALL_PLUGIN:"installPlugin"},PLUGIN_EVENT_RESULTS:{LOAD_SUCCESSFUL:"LoadSuccessful",LOGIN_SUCCESS:"LoggedIn",VIDEO_STATUS:{AVAILABLE:"Available",NOT_AVAILABLE:"NotAvailable"}},PLUGIN_COMPONENT:{MANAGER_ID:"__pluginFx",CORE_ID:"SkypeCore",VIDEO_ID:"VideoUI"},PLUGIN_VIDEO_MODES:{STRETCH:1,CROP:2,FIT:3},PLUGIN_MEDIA_TYPES:{VIDEO:"Video",SCREEN_SHARING:"ScreenSharing"},SHELL_APP_PRELOAD_ENABLED_VERSION:"7.4",SHELL_APP_METHODS:{GET_VERSION:"getVersion",SHOW_WINDOW:"showWindow",HIDE_WINDOW:"hideWindow",CLOSE_WINDOW:"closeWindow"},SHELL_APP_EVENTS:{WINDOW_CLOSING:"windowClosing"},ERRORS:{CALL_ABORTED:"callAborted"},ERROR_CODES:{TPC_INIT:1,REGISTRAR_INIT:2,UNSUPPORTED_BROWSER:3,UNSUPPORTED_OS:4},FEATURE_FLAGS:{RESIZE_CALL_AND_CHAT:"resizeCallAndChat",CALLING:"calling",GVC:"GVC"},CQF:{THANKS_TIMEOUT:3e3,STEPS:{INTRO:"intro",QUESTIONNAIRE:"questionnaire",THANKS:"thanks"}},DEVICE_TYPE:{CAMERA:"camera",MICROPHONE:"microphone",SPEAKER:"speaker"},UNANSWERED_CALL_REASONS:{BUSY:"BUSY",MISSED:"NO_ANSWER",UNAVAILABLE:"UNAVAILABLE"},UNANSWERED_CALL_ACTIONS:{CANCEL:"CANCEL",CHAT:"CHAT",RETRY:"RETRY",MESSAGE_CALLEE:"MESSAGE_CALLEE",OTHER_DISMISS:"OTHER_DISMISS"},UNANSWERED_CALL_RETRY_ACTIONS:{SKYPE:"SKYPE",PSTN:"PSTN",DIAL_PAD:"DIAL_PAD"},DEVICE_SELECTION_REASON:{USER:"UserAction",CACHE:"RestoredFromCache"},PARTICIPANT_MENU:{ANIMATION_ELEMENT_SELECTOR:".participantMenuPill",ANIMATION_NAME:"av-participant-menu-move-up",ANIMATION_OFFSET:70,DEFAULT_OFFSET:4},CALL_SCREEN_DIALOG:{ALLOWED_FOCUS_SELECTORS:[".Me",".toasts",".footer",".notifications","swx-sidebar",".conversationHistory",".swx-chat-input"],NAME:{ADD_PARTICIPANTS:"addParticipants",TRANSFER_CALL:"transferCall",AV_SETTINGS:"avSettings",SCREEN_SHARING_PREVIEW:"screenSharingPreview",PSTN_WARNING:"pstnWarning"}},PLUGINLESS_PSTN:{END_REASONS:{SUBCODE_RANGE:{MIN:2e5,MAX:299999},REASON_MAP:{403:{6423:n.callDisconnectionReason.InsufficientFunds,8403:n.callDisconnectionReason.ForbiddenNumber,9402:n.callDisconnectionReason.InsufficientFunds,10403:n.callDisconnectionReason.ForbiddenNumber},404:{10404:n.callDisconnectionReason.InvalidNumber},480:{6422:n.callDisconnectionReason.InsufficientFunds,6432:n.callDisconnectionReason.InvalidNumber}}}}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-constants/lib/pluginConst",["require","exports"],e)}(function(e,t){t.__esModule=!0,t["default"]={PERSISTENT_REQUIRED_VERSION:"7.2",NATIVE_ARGUMENTS_REQUIRED_VERSION:"7.6",LOGIN_STATUS:{LOGGED_OUT:"LoggedOut",LOGGED_IN:"LoggedIn",LOGGING_IN:"LoggingIn",LOGGING_OUT:"LoggingOut",INVALID_CREDENTIALS:"InvalidCredentials",IMPRINT_FAILURE:"ImprintFailure",LOGIN_FAILURE:"LoginFailure",LOGIN_SUCCESS:"LoginSuccess",UNKNOWN:"Unknown"},LOGIN_FAILURE_STOP_GAP:5,LOAD_RESULT:{LOAD_SUCCESSFUL:"LoadSuccessful",NO_INSTANCE_MANAGER:"NoInstanceManager",COMPONENT_NOT_FOUND:"ComponentNotFound",COMPONENT_LOAD_FAILED:"ComponentLoadFailed",COMPONENT_INIT_FAILED:"ComponentInitFailed",COMPONENT_LOAD_CANCELLED:"ComponentLoadCancelled"},VOICE_STATUS:{NOT_AVAILABLE:"NotAvailable",AVAILABLE:"Available",RINGING:"Ringing",JOINING:"Joining",LISTENING:"Listening",SPEAKING:"Speaking",ONHOLD:"OnHold",LEAVING:"Leaving",UNKNOWN:"Unknown"},VIDEO_STATUS:{NOT_AVAILABLE:"NotAvailable",AVAILABLE:"Available",STARTING:"Starting",RENDERING:"Rendering",STOPPING:"Stopping",SWITCHING_DEVICE:"SwitchingDevice",UNKNOWN:"Unknown"},VIDEO_MODE:{STRETCH:"Stretch",CROP:"Crop",FIT:"Fit"},PROGID_VERSION:"SkypePlugin.VersionQuery",MIME_TYPE:"application/x-skype-nativeplugin7.0",OBJECT_CLASS_ID:"CLSID:20BEBD18-11D0-4470-AAE1-F34B9E8D9761",PLUGIN_ERRORS:{REASON_CANNOT_CAPTURE:"CannotCapture",REASON_ALREADY_EXISTS:"AlreadyExists",NOT_INSTALLED:"pluginNotInstalled",INIT_TIMEOUT:"pluginInitializationTimeout",MANAGER_LOAD_ERROR:"pluginManagerLoadError",MANAGER_LOAD_TIMEOUT:"pluginManagerLoadTimeout",LOGIN_ABORTED:"pluginLoginAborted"},MAX_RESPONSE_LOG_LENGTH:500}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-constants/lib/people",["require","exports"],e)}(function(e,t){t.__esModule=!0,t["default"]={SELF:"self",ECHO_CONTACT_ID:"echo123",searchLimit:20,contactTypes:{USER:"8",AGENT:"28",PSTN:"4"},contactList:{className:{LOCAL:"people",DIRECTORY:"directory"}},contactPicker:{states:{STATE_DEFAULT:"default",STATE_SEARCH:"search"}},authorizationStates:{UNKNOWN:"UNKNOWN",UNAUTHORIZED:"UNAUTHORIZED",PENDING_OUTGOING:"PENDING_OUTGOING",PENDING_INCOMING:"PENDING_INCOMING",AUTHORIZED:"AUTHORIZED",SUGGESTED:"SUGGESTED"},showStrategies:{ALL:"ALL",AVAILABLE_ONLY:"AVAILABLE_ONLY",AGENTS_ONLY:"AGENTS_ONLY"},contactPageTabIds:{AVAILABLE_TAB:"availableTab",ALL_CONTACTS_TAB:"allContactsTab",AGENTS_TAB:"agentsTab"},scopes:{FULL:"full",DELTA:"delta"}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-constants/lib/outOfBrowser",["require","exports"],e)}(function(e,t){t.__esModule=!0,t["default"]={SHELL_APP_ID:"com.skype.shellapp",SHELL_APP_MIME_TYPE:"application/x-skype-shellapp",ESCALATION_TOPIC_SUBSCRIPTION_DELAY:3e3,commandTypes:{REQUEST:"REQUEST",RESPONSE:"RESPONSE"},commands:{SHELL_APP_READY_FOR_BOOTSTRAP:"SHELL_APP_READY_FOR_BOOTSTRAP",BOOTSTRAP:"BOOTSTRAP",INIT:"INIT",SHELL_APP_INITIALISED:"SHELL_APP_INITIALISED",SHOW:"SHOW",HIDE:"HIDE",JOIN_CALL:"JOIN_CALL",START:"START",ACCEPT:"ACCEPT",UPDATE_INCOMING_PAYLOAD:"UPDATE_INCOMING_PAYLOAD",REJECT:"REJECT",STOP:"STOP",MUTE:"MUTE",UNMUTE:"UNMUTE",CALL_INFO:"CALL_INFO",CONTACTS_DATA_REQUEST:"CONTACTS_DATA_REQUEST",CONTACTS_DATA_RESPONSE:"CONTACTS_DATA_RESPONSE",TOPIC_UPDATE:"TOPIC_UPDATE",SYNC_PARTICIPANTS:"SYNC_PARTICIPANTS",CHANGE_STATE:"CHANGE_STATE",UPDATE_PARTICIPANT_STATE:"UPDATE_PARTICIPANT_STATE",PARTICIPANT_AUTHORIZE:"PARTICIPANT_AUTHORIZE",PSTN_EVENT:"PSTN_EVENT",SHELL_APP_LOG:"SHELL_APP_LOG",PLUGIN_ERROR:"PLUGIN_ERROR",ESCALATE_CONVERSATION:"ESCALATE_CONVERSATION",SETTINGS_UPDATE:"SETTINGS_UPDATE"},shellAppIndexPagePath:"/shellApp/index.html",shellAppPreloadEnabledVersion:"7.4",shellAppMethods:{PostMessage:"postMessage",GetVersion:"getVersion",ShowWindow:"showWindow",HideWindow:"hideWindow",CloseWindow:"closeWindow"},shellAppEvents:{MessageReceived:"message",WindowShown:"windowShown",WindowHidden:"windowHidden",WindowClosing:"windowClosing"},shellAppMetaSelector:"meta[name=swx-chrome-extension]"}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-constants/lib/keys",["require","exports"],e)}(function(e,t){t.__esModule=!0,t["default"]={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMBER_0:48,NUMBER_9:57,NUMPAD_0:96,NUMPAD_9:105,A:65,G:71,H:72,J:74,K:75,L:76,Z:90,F6:117,F10:121}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-constants/lib/common",["require","exports"],e)}(function(e,t){t.__esModule=!0,t["default"]={storageKeys:{ENDPOINT_ID:"endpointId",PRESENCE_DATA:"presenceData",RESURECTION_KEY:"isResurected",RECENT_COUNTRY:"swx|recentCountry",AAD_TOKEN_EXPIRED:"aadTokenExpired",CHAT_NOTIFICATIONS_SETTINGS_KEY:"chatNotificationsMuted",NOTIFICATIONS_SOUND_SETTINGS_KEY:"notificationsSoundMuted",CHAT_NOTIFICATIONS_SOUND_SETTINGS_KEY:"chatNotificationsSoundMuted",CALL_NOTIFICATIONS_SETTINGS_KEY:"callNotificationsMuted",RINGING_DEFERRER_SETTINGS_KEY:"ringingDeferrerSetting"},browserProperties:{DEFAULT:{HIDDEN:"hidden",VISIBILITY_CHANGE:"visibilitychange"},MS:{HIDDEN:"msHidden",VISIBILITY_CHANGE:"msvisibilitychange"},MOZ:{HIDDEN:"mozHidden",VISIBILITY_CHANGE:"mozvisibilitychange"},WEBKIT:{HIDDEN:"webkitHidden",VISIBILITY_CHANGE:"webkitvisibilitychange"}},permission:{DEFAULT:"default",GRANTED:"granted",DENIED:"denied"},events:{actions:{subscriptionCreation:"subscriptioncreation",getUserPresence:"getuserpresence",setUserPresence:"setuserpresence",getSelfProperties:"getselfproperties",messageSubmitted:"messagesubmitted",messageQuoted:"messageQuoted",callMade:"action:callMade"},auth:{SIGNIN_FAILED:"signInFailed",SIGN_OUT:"signOut"},callScreen:{CONTROLS_VISIBLE:"controlsVisible",VIDEO_STATE_CHANGED:"videoStateChanged",VIDEO_CONTAINER_SIZE_CHANGED:"videoContainerSizeChanged",SIDEBAR_TOGGLED:"sidebarToggled",VIDEO_ZOOMED_IN:"videoZoomedIn",TOGGLE_FULLSCREEN:"toggleFullscreen",TOGGLE_NARROW_MENU:"toggleNarrowMenu",BUTTON_FOCUSED:"buttonFocused",FOCUS_CALL_SCREEN:"focusCallScreen",BUTTONS_WIDTH_CHANGED:"buttonsWidthChanged",ROSTER_WIDTH_CHANGED:"rosterWidthChanged",TOGGLE_MODAL_DIALOG:"toggleCallScreenModal",MORE_ACTION_MENU_VISIBLE:"moreActionsMenuVisible",MORE_ACTION_MENU_HIDDEN:"moreActionsMenuHidden",DIALPAD_VISIBLE:"dialpadVisible",DIALPAD_HIDDEN:"dialpadHidden",STAGE_LAYOUT_CHANGED:"stageLayoutChanged",PARTICIPANT_MENU_VISIBILITY_CHANGED:"participantMenuVisibilityChanged",PARTICIPANT_MENU_FOCUSED:"participantMenuFocused",TOGGLE_GRID_VIEW:"toggleGridView",PINNED_PARTICIPANT_CHANGED:"pinParticipant",PARTICIPANT_ITEM_CONTEXT_MENU:"participantItemContextMenu",SHOW_CHAT:"showChat",HIDE_CHAT:"hideChat"},contacts:{CONTACTS_LOADED:"contactsLoaded",CONTACT_REQUEST_SENT:"contactRequestSent",CONTACT_REQUEST_ACCEPTED:"contactRequestAccepted",CONTACT_REQUEST_DECLINED:"contactRequestDeclined"},message:{RENDERED:"message:rendered",QUOTE:"message:quote",EDIT:"message:edit",COPY:"message:copy",AFTER_EXPANDED:"message:afterExpanded",BEFORE_EXPANDED:"message:beforeExpanded",REMOVED:"message:removed",SENT:"message:sent",ADD_CONTACT:"message:addContact"},resourceTypes:{userPresence:"userpresence"},navigation:{OPEN_CONVERSATION:"navigate:conversation",NAVIGATE:"navigate:navigate",NAVIGATE_TO_PREVIOUS_PAGE:"navigate:previousPage",NAVIGATE_TO_SEARCH_INPUT:"navigate:searchInput",COMPONENT_RENDERED:"component:rendered",FRAGMENT_SHOW:"fragment:show",FRAGMENT_HIDE:"fragment:hide",FRAGMENT_BEFORE_SHOW:"fragment:beforeShow",FRAGMENT_BEFORE_HIDE:"fragment:beforeHide",FRAGMENT_LOADED:"fragment:loaded",FRAGMENT_REMOVE:"fragment:remove",FRAGMENT_REMOVE_ALL_HIDDEN:"fragment:removeAllHidden",LEAVE_EDIT_MODE:"leave:edit:mode",NOTIFICATIONS_CENTER:"navigate:notificationsCenter"},search:{QUERY_CHANGED:"query:changed",QUERY_EXECUTED:"query:finished",QUERY_RESET:"query:reset",RESET:"search:reset",DIRECTORY_SEARCH_RESULTS:"search:directory:results",DIRECTORY_SEARCH_RESULTS_RENDERED:"search:directory:results:rendered",DIRECTORY_SEARCH_ACTIVATED:"search:directory:activated",DIRECTORY_SEARCH_DEACTIVATED:"search:directory:deactivated",ACTIVATE_DIRECTORY_SEARCH:"search:directory:activate",GROUPS_SEARCH_RESULTS:"search:groups:results",LOCAL_SEARCH_RESULTS:"search:local:results",LOCAL_SEARCH_RESULTS_RENDERED:"search:local:results:rendered",INPUT_FOCUS:"searchInput:focus",INPUT_BLUR:"searchInput:blur",SESSION_SUCCESS:"search:sessionSuccess"},roster:{ROSTER_QUERY_CHANGED:"roster:participants:search",ROSTER_QUERY_EXECUTED:"roster:participants:searchFinished",ROSTER_SELECTION_REMOVED:"roster:selection:removed",PICKER_CONTACT_SELECTED:"people:picker:selected",PICKER_CONTACT_DESELECTED:"people:picker:deselected",EDIT_ROSTER_MODE:"roster:editRosterMode"},conversation:{JOINING_ENABLED:"conversation:joining:enabled",OPEN_PROFILE:"conversation:open:profile",CLOSE_PROFILE:"conversation:close:profile",COPY_LINK:"conversation:copy:link",EMAIL_LINK:"conversation:mail:link",SHARED:"conversation:shared",MARK_AS_READ:"conversation:mark:read",VIEWPORT_CHANGED:"conversation:viewport:changed",MESSAGES_LOADED:"conversation:messages:loaded",OVERLAY_CLOSED:"conversation:overlay:closed"},expressionPicker:{ITEM_PREVIEW_REQUEST:"pes:picker:previewRequest",ITEM_SELECT_REQUEST:"pes:picker:selectRequest",ITEM_SEND_REQUEST:"pes:picker:sendRequest",ITEM_CANCEL_REQUEST:"pes:picker:cancelRequest",TAB_SELECT_REQUEST:"pes:tabs:selectRequest",CLOSE_REQUEST:"pes:picker:close",OPEN_REQUEST:"pes:picker:open",MRUITEM_ADD_REQUEST:"pes:mruitem:addRequest",MRUITEM_ADD_EMOTICON_REQUEST:"pes:mruitem:addEmoticonRequest"},suggestionList:{SHOWN:"suggestionList:shown",HIDDEN:"suggestionList:hidden",ITEM_SELECTED:"suggestionList:itemSelected"},textarea:{MESSAGE_SENT:"textarea:messageSent",SUBMIT_AND_FOCUS:"textarea:submitAndFocus",CHANGED:"textarea:changed",KEY_DOWN:"textarea:keyDown",KEY_PRESS:"textarea:keyPress",INPUT:"textarea:input",HAS_INPUT:"textarea:hasInput",INITIALIZATION_COMPLETE:"textarea:initializationComplete",SET_ATTRIBUTION:"textarea:setAttribution",UPDATE_SMS_DESTINATION:"textarea:updateSmsDestination",UPDATE_SMS_FRAGMENTS:"textarea:updateSmsFragments",UPDATE_TEXTAREA_ENABLE:"textarea:enable"},chatInput:{INITIALIZATION_COMPLETE:"chatInput:initializationComplete"},emoticonPicker:{EMOTICON_SELECTED:"emoticon:selected",CLOSE:"emoticon:close"},errors:{SERVICE_FAILURE:"serviceFailure"},system:{EXPERIENCE_INITIALIZED:"experienceInitialized",EXPERIENCE_READY:"experienceReady",BUTTON_CLICK:"buttonClick",FORCE_RESYNC:"webapi:forceResync",ONLINE_STATE_CHANGED:"webapi:onlineStateChanged",DATE_CHANGED:"dateChanged"},trouter:{CONTACTLIST_CHANGE:6,OFFLINE_AUTHREQUEST:14,INCOMING_SKYPE_NGC_CALL:107,INCOMING_SKYPE_P2P_CALL:108,INCOMING_SKYPE_NGC_GVC_CALL:109,INCOMING_LYNC_NGC_CALL:105,INCOMING_STOP_RINGER:104,INCOMING_SKYPE_NGC_STOP_RINGER:110,INCOMING_SKYPE_NGC_PSTN_CALL:111,USER_SERVICES_CHANGE:601,INCOMING_CONTACT_INVITE:801,OUTGOING_CONTACT_INVITE_ACCEPTED:802,CONTACT_INVITES_LIST_CHANGE:803,USER_PROFILE_CHANGE:20,USER_AVATAR_CHANGE:21},newConversation:{CONFIRMED:"newConversation:confirmed",CANCELLED:"newConversation:cancelled"},narrowMode:{SIDEBAR_STATE_CHANGED:"narrowMode:sidebarStateChanged",SHOW_SIDEBAR:"narrowMode:showSidebar",HIDE_SIDEBAR:"narrowMode:hideSidebar",SIDEBAR_TRANSITION_ENDED:"narrowMode:sidebarTransitionEnded"},interaction:{SCROLL_START:"interaction:scrollStart"},browser:{CLICK:"click",RESIZE:"resize",SCROLL:"scroll",FOCUS:"focus",BLUR:"blur",KEYDOWN:"keydown",KEYUP:"keyup",KEYPRESS:"keypress",MOUSEMOVE:"mousemove",MOUSEDOWN:"mousedown",BEFOREUNLOAD:"beforeunload",VISIBILITYCHANGE:"visibilitychange",TRANSITIONEND:"transitionend",MESSAGE:"message",CONTEXTMENU:"contextmenu",NARRATOR_ANNOUNCE:"announce"},personalExpression:{CONFIG_INITIALIZED:"pes:configInitialized",CONFIG_PROCESSED:"pes:configProcessed",CDN_TOKEN_UPDATED:"pes:cdnTokenUpdated",store:{LOAD_PACKS:"pesStore:loadPacks",PACK_PURCHASED:"pesStore:packPurchased"}},mediaPicker:{CLOSE_PICKER:"mediaPicker:closePicker",FILE_PICKER_SELECTED:"mediaPicker:filePickerSelected",SEND_CONTACTS_SELECTED:"mediaPicker:sendContactsSelected",POLL_BUTTON_SELECTED:"mediaPicker:pollButtonSelected"},shareControl:{SHARE_CONTROL_SHOW:"shareControl:show",SHARE_CONTROL_HIDE:"shareControl:hide"},skypeOut:{DIAL_BUTTON_CLICKED:"skypeOut:dialButtonClicked",INPUT_CHANGED:"skypeOut:inputChanged",INPUT_TYPE_TOUCH:"touch",INPUT_TYPE_MOUSE:"mouse",INPUT_TYPE_KEYBOARD:"keyboard"},selectBox:{TOGGLE:"selectBox:toggle"},userListPopup:{POPUP_TOGGLE:"userListPopup:toggle"},videoPlayer:{FULLSCREEN_ON:"videoPlayer:fullscreenOn",FULLSCREEN_OFF:"videoPlayer:fullscreenOff"},me:{PRESENCE_POPUP_SHOW:"presencePopup:show",MOOD_MESSAGE_EDIT:"moodMessage:edit"},flags:{SET_FLAG:"setFlag"},contextMenu:{MENU_SHOWN:"contextMenu:shown",MENU_HIDDEN:"contextMenu:hidden"}},styleMode:{breakpoint:{NARROW:420,MEDIUM:600,WIDE:800},NARROW:"style:narrow",MEDIUM:"style:medium",WIDE:"style:wide"},deviceSelection:{DEFAULT_ID:"default",DEFAULT_NAME:"default"},notifications:{ERROR:"shellError",SUCCESS:"shellSuccess",WARNING:"shellWarning",INCOMING_CALL:"incomingCall",INCOMING_CALL_WITH_NO_PLUGIN:"incomingCallWithNoPlugin",INCOMING_CALL_BROWSER_NOT_SUPPORTED:"incomingCallBrowserNotSupported",INCOMING_CALL_OS_NOT_SUPPORTED:"incomingCallOsrNotSupported",DEVICE_MISSING_CAMERA:"cameraMissing",DEVICE_MISSING_MICROPHONE:"microphoneMissing",DEVICE_MISSING_SPEAKER:"speakerMissing",UNREAD_MESSAGE:"UnreadMessage",CONTACT_REQUEST:"ContactRequest",SIGN_IN_REQUEST:"SignInRequest",CHAT:"Chat",AUDIO:"Audio",AUDIO_CALL:"AudioCall",AUDIO_WITHOUT_VIDEO:"AudioWithoutVideo",EDUCATION:"Education",AVATAR_NOT_SUPPORTED_IMAGE_TYPE:"AvatarNotSupportedImageType",AVATAR_TOO_LARGE:"AvatarTooLarge",AVATAR_UPLOAD_ERROR:"AvatarUploadError"},serviceLocator:{FEATURE_FLAGS:"featureFlagApi",CONTROLS_BUILDER:"controlsBuilder",NAVIGATION_CONTEXT:"navigation",PUBSUB:"pubSub",SETTINGS:"settings",LOCAL_STORAGE:"localStorage",TELEMETRY_MANAGER:"telemetryManager",MODEL_UI_OBSERVER:"webClientModelObserver",SPLASH_SCREEN:"spashScreen",SUBSCRIPTION_PROVIDER:"subscriptionProvider",ACTION_TELEMETRY:"actionTelemetry",PES_MRU_SERVICE:"pesMRUService",PES_BING_SEARCH_SERVICE:"pesBingSearchService",PES_GIPHY_SEARCH_SERVICE:"pesGiphySearchService",URL_PREVIEW_SERVICE:"urlPreviewService",PES_CONFIG_SERVICE:"pesConfigService",PES_STORE_SERVICE:"pesStoreService",PROGRESSIVE_TIMEOUT:"progressiveTimeout"},msnpErrors:{nonExistingConverstion:730,redirectionOverride:752,missingEndpoint:729,invalidSyncState:230},callingErrors:{AUTO_CALL_FAILED:"AUTO_CALL_FAILED"},httpStatusCodes:{OK:200,created:201,badRequest:400,unauthorized:401,notFound:404,forbidden:403,preconditionFailed:412,unprocessableEntity:422,internalServerError:500},onlineStates:{ONLINE:"state:online",OFFLINE:"state:offline"},translatorServiceState:{NotReady:"NotReady",Authenticated:"Authenticated",Error:"Error"},isTyping:{THROTTLE:5e3,EXPIRY:7e3,DETAILED_PARTICIPANTS_MAX_COUNT:2,MESSAGE_TYPE:{SET_TYPING:"Control/Typing",CLEAR_TYPING:"Control/ClearTyping"}},activityItemGroups:{PARTICIPANT:"participant",TEXT:"text",CALL:"live-session",NGC_UPGRADE:"ngc-upgrade",PLUGIN_FREE:"plugin-free",MEDIA:"media",CONTACT_REQUEST:"contact-request",MOJI:"moji",CONTACT_INFO:"contact-info",TRANSACTION:"transaction",POLL:"poll",PSTN:"pstn",CUSTOM:"custom",TRANSCRIPT:"transcript",SYSTEM:"system"},customActivityItemTemplates:{SPACES_WELCOME_MESSAGE:"spacesWelcomeMessage"},featureFlags:{AGENTS_ENABLED:"agentsEnabled",AGENTS_DISCOVERABLE:"agentsDiscoverable",SHOW_AGENT_ID_ON_PROFILE:"showAgentIdOnProfile",SHOW_AGENT_RATING_ON_PROFILE:"showAgentRatingOnProfile",SHOW_AGENT_EXTRA_INFO_ON_PROFILE:"showAgentExtraInfoOnProfile",URL_OVERRIDE_ENABLED:"urlOverrideEnabled",CONTACTLIST_CHANGE_NOTIFICATION:"contactListChangeNotification",SHOW_SPLASH_SCREEN:"showSplashScreen",SHOW_EDU_CAROUSEL:"showEducationalCarousel",BLOCK_CONTACT:"blockContact",DEACTIVATE_CACHE:"deactivateCache",HAS_TIMELINE_BADGE:"hasTimelineBadge",HAS_BETA_LABEL:"hasBetaLabel",HAS_FEEDBACK_LINK:"hasFeedbackLink",HAS_FEEDBACK_LINK_ON_ERROR:"hasFeedbackLinkOnError",SKYPE_DIRECTORY_SEARCH:"skypeDirectorySearch",MUTE_NOTIFICATIONS:"muteNotifications",BROWSER_NATIVE_NOTIFICATIONS_ENABLED:"browserNativeNotificationsEnabled",USE_DARK_THEME_FOR_BROWSER_NOTIFICATIONS_OPT_IN_FLOW:"useDarkThemeForBrowserNotificationsOptInFlow",BROWSER_NOTIFICATIONS_EDUCATIONAL_TOAST_ENABLED:"browserNotificationEducationalToastEnabled",LAST_SEEN:"lastSeen",MOBILE_INDICATOR:"mobileIndicator",NEW_CONVERSATION_V2:"newConversationV2",SPACES:"spaces",SHOW_SPACES_WELCOME_MESSAGE:"showSpacesWelcomeMessage",SHOW_CONTACTS_PAGE_HINT:"showContactsPageHint",SHOW_CONTACTS_PAGE_INFORMATIONAL_MESSAGE:"showContactsPageInformationalMessage",SHOW_FIRST_RUN_LANDING_EXPERIENCE:"showFirstRunLandingExperience",INCOMING_SCREEN_SHARING:"incomingScreenSharing",OUTGOING_SCREEN_SHARING:"outgoingScreenSharing",OUTGOING_SCREEN_SHARING_PREVIEW:"outgoingScreenSharingPreview",TRANSFER_CALL:"transferCall",INCOMING_WIKI_MARKUP:"incomingWikiMarkup",MESSAGE_ENFORCE_TEXT_FORMAT:"messageEnforceTextFormat",PHOTO_SHARING_ENABLED:"photoSharingEnabled",SPACE_TOPIC_EDITOR:"spaceTopicEditor",HEADER_CONTROLS_DISABLED:"headerControlsDisabled",HIDE_SIDEBAR_ON_START:"hideSidebarOnStart",SINGLE_CONVERSATION_MODE:"singleConversationMode",DISABLE_POLLING_ON_KAHUNA:"disablePollingOnKahuna",ENABLE_RAW_EMOTICONS_RENDERING:"enableRawEmoticonsRendering",UNREAD_MESSAGE_REMINDER_TOAST:"unreadMessageReminderToast",PROFILE_UPDATE_NOTIFICATIONS_ENABLED:"profileUpdateNotificationsEnabled",TIMEZONE_IN_CHATSERVICE_REQUEST:"timezoneInChatServiceRequest",CONTENT_SEARCH:"contentSearch",SWIFT_CARD_COMMAND:"swiftCardCommand",SWIFT_CARD_RENDERING:"swiftCardRendering",SWIFT_CARD_RENDERING_MEDIA_CARDS:"swiftCardRenderingMediaCards",BOT_MESSAGES_MODE_V2_ENABLED:"botMessagesModeV2enabled",SUGGESTED_ACTIONS_ENABLED:"suggestedActionsEnabled",UNREAD_MSG_LOGGING:"enableUnreadMessagesLogging",SEND_SKYPE_INITIATING_USERNAME:"sendSkypeInitiatingUsername",SHOW_MESSAGE_DELIVERY_INDICATOR_SW4B:"showMessageDeliveryIndicator",SHOW_MESSAGE_DELIVERY_STATUS:"showMessageDeliveryStatus",SHOW_TIMESTAMPS_IN_NARROW_MODE:"showTimestampsInNarrowMode",HIDE_EMOTICON_PICKER_BUTTON:"hideEmoticonPickerButton",IS_TYPING_INDICATOR:"isTypingIndicator",SERVICE_FAILURE_REPORTING:"serviceFailureReporting",CALLING:"calling",CALLING_FULL_SCREEN_ENABLED:"callingFullScreen",INCLUDE_SELF_IN_PARTICIPANTS_COUNT:"includeSelfInParticipantsCount",HIDE_USER_ROLE:"hideUserRole",SHOW_ALTERNATE_SHARE_DIALOG_EXPERIENCE:"showAlternateShareDialogExperience",IS_FLIK_MESSAGE_ENABLED:"isFlikMessageEnabled",PES_CDN_AUTH_ENABLED:"pesCDNAuthEnabled",PINNING_TO_DOGFOOD_CLOUD:"pinningToDogfoodCloud",NOTIFICATIONS_CENTER:"notificationsCenter",POLLS_ENABLED:"pollsEnabled",SUPPORT_MESSAGE_PROPERTIES:"supportMessageProperties",ENABLE_PING_ECS_CONFIG:"enablePingEcsConfig",ENABLE_ENDPOINT_ECS_CONFIG:"enableEndpointEcsConfig",SUPPORT_STANDBY_MODE:"supportStandbyMode",MENTIONS_ENABLED:"mentionsEnabled",MENTIONS_PEOPLE_ENABLED:"mentionsPeopleEnabled",CODE_SNIPPET_ENABLED:"codeSnippetEnabled",SKYPE_URI_NAVIGATION_ENABLED:"skypeUriNavigationEnabled",ALTERNATIVE_SIDEBAR_LAYOUT_ENABLED:"alternativeSidebarLayout",CONTEXT_MENU_QUOTE_MESSAGES_ENABLED:"contextMenuQuoteMessagesEnabled",CONTEXT_MENU_COPY_MESSAGES_ENABLED:"contextMenuCopyMessagesEnabled",CONTEXT_MENU_SAVE_VIDEO_MESSAGES_ENABLED:"contextMenuSaveVideoMessagesEnabled",CONTEXT_MENU_MARK_AS_READ_ENABLED:"contextMenuMarkAsReadEnabled",MARK_READ_MESSAGES_V2_ENABLED:"markReadMessagesV2Enabled",SKIP_CHAT_CAPABILITY_CHECK:"skipChatCapabilityCheck",URL_PREVIEWS:"urlPreviews",SILENT_LINKING:"silentLinking",REMOVE_CONVERSATION_HISTORY:"removeConversationHistory",AVATAR_SERVICE_SUPPORTS_SIZE_PARAMETER:"avatarServiceSupportsSizeParameter",COPY_SELECTION_AS_QUOTE_KEYBOARD:"copySelectionAsQuoteKeyboard",FULL_SCREEN_MODE_FROM_SIDEPANE:"fullScreenModeFromSidepane",GDPR_WEB_API:"GDPRwebApi",PES_CDN_AUTH_URL_FALLBACK_ENABLED:"pesCDNAuthUrlFallbackEnabled",PES_FETCH_SMALL_ASSETS_ON_DEMAND:"pesFetchSmallAssetsOnDemand",PES_FETCH_MEDIUM_ASSETS_ON_DEMAND:"pesFetchMediumAssetsOnDemand",PES_FETCH_LARGE_ASSETS_ON_DEMAND:"pesFetchLargeAssetsOnDemand",PES_FETCH_MOJI_ASSETS_ON_DEMAND:"pesFetchMojiAssetsOnDemand",PES_USE_EXTRA_LARGE_EMOTICONS:"pesUseExtraLargeEmoticons",PES_BING_IMAGE_SEARCH_ENABLED:"pesBingImageSearchEnabled",PES_GIPHY_IMAGE_SEARCH_ENABLED:"pesGiphyImageSearchEnabled",PES_LOCAL_SEARCH_ENABLED:"pesLocalSearchEnabled",EMOTICON_SUGGESTION_ENABLED:"emoticonSuggestionEnabled",EMOTICON_IMPLICIT_SUGGESTION_DISABLED:"emoticonImplicitSuggestionDisabled",SUGGEST_HIDDEN_EMOTICONS:"suggestHiddenEmoticons",PES_STORE_ENABLED:"pesStoreEnabled",EMOTICON_SETTINGS_ENABLED:"emoticonSettingsEnabled",YOUTUBE_PLAYER_ENABLED:"youtubePlayer",FILE_DRAG_DROP_ENABLED:"fileDragDropEnabled",FILE_PASTE_ENABLED:"filePasteEnabled",TYPING_INDICATOR_ENABLED:"showWhenIamTyping",FILE_TRANSFER_ENABLED:"fileTransferEnabled",CONTEXT_MENU_LIKE_MESSAGES_ENABLED:"contextMenuLikeMessagesEnabled",SHOW_DEFAULT_AVATAR_IN_NOTIFICATIONS:"showDefaultAvatarInNotifications",MEDIA_BAR_ENABLED:"mediaBarEnabled",MEDIA_BAR_V2_ENABLED:"mediaBarV2Enabled",PSTN_ENABLED:"PSTN",CQF_ENABLED:"CQF",UNANSWERED_CALL_UI:"unansweredCallUIEnabled",CONSOLE_LOGGING:"consoleLogging",ISSUE_REPORTING:"issueReporting",CALL_INFO_COMMAND:"callInfoCommand",ERROR_LOG_REPORTING:"errorLogReporting",AGGRESSIVE_IMPLICT_MENTIONS_MATCHING:"aggressiveImplicitMentionsMatching",ENABLE_AGGRESSIVE_MENTIONS_TOAST:"enableAggressiveMentionsToast",SEND_CONTACT_CARD_ENABLED:"sendContactCardEnabled",NOTIFY_HOST_EVEN_WHEN_ME_NOTAVAILABLE:"notifyHostEvenWhenMeNotAvailable",HEARTS_ENABLED:"heartsEnabled",HEARTS_NOTIFICATION_ENABLED:"heartsNotificationEnabled",SHOW_CHAT_INTRO_TEXT:"showChatIntroText",TRANSLATOR_SENDING_ENABLED:"translatorSendingEnabled",REACTIONS_SUPPORT_ENABLED:"reactionsSupportEnabled",HIGH_PRIORITY_SCRIPT_ENABLED:"addHighPriorityScript",CONTACT_CARD_RENDERING_ENABLED:"contactCardRenderingEnabled",NEW_URLP_DOMAIN_ENABLED:"newUrlPreviewDomainEnabled",IS_CLOUD_VIDEO_MESSAGE_ENABLED:"isCloudVideoMessageEnabled",IS_CLOUD_AUDIO_MESSAGE_ENABLED:"isCloudAudioMessageEnabled",CREDIT_GIFTING:"creditGifting",MUTE_SPECIFIC_CONVERSATIONS_ENABLED:"muteSpecificConversationsEnabled",AUTO_CALLING:"autoCalling",GVC_ESCALATION:"GVCEscalation",GVC_LOCAL_ESCALATION:"GVCLocalEscalation",GVC_JOINING:"GVCJoining",GVC_OUTGOING:"GVCOutgoing",HOSTLESS_GROUP_CALLING_PLUGINLESS:"hostlessGroupCallingPluginless",PERSISTENT_PLUGIN:"persistentPlugin",PERSISTENT_SHELL_APP:"persistentShellApp",PLUGINLESS_CALLING_CHROME:"pluginlessCallingChrome",PLUGINLESS_CALLING_CHROME_NO_EXTENSION:"pluginlessCallingChromeNoExtension",PLUGINLESS_CALLING_CHROME_LINUX:"pluginlessCallingChromeLinux",PLUGINLESS_CALLING_EDGE:"pluginlessCallingEdge",PLUGINLESS_CALLING_FIREFOX:"pluginlessCallingFirefox",PLUGINLESS_CALLING_ELECTRON:"pluginlessCallingElectron",PLUGINLESS_VIDEO_CALLING_CHROME_LINUX:"pluginlessVideoCallingChromeLinux",PLUGINLESS_VIDEO_CALLING_FIREFOX:"pluginlessVideoCallingFirefox",PLUGINLESS_GROUP_VIDEO_CALLING_CHROME_LINUX:"pluginlessGroupVideoCallingChromeLinux",PLUGINLESS_PSTN_CALLING:"pluginlessPSTNCalling",PLUGINLESS_INCOMING_SCREEN_SHARING_EDGE:"pluginlessIncomingScreenSharingEdge",PLUGINLESS_REMOTE_ESCALATION:"pluginlessRemoteEscalation",PLUGINLESS_LOCAL_ESCALATION:"pluginlessLocalEscalation",DEVICE_DISABLED_DIALOG_ENABLED:"deviceDisabledDialogEnabled",CAN_NOTIFY_WITHOUT_VIDEO:"canNotifyWithoutVideo",PRELOAD_PLUGIN:"preloadPlugin",PRELOAD_SHELL_APP:"preloadShellApp",NG_CALLING:"NGCalling",FAIL_INITIALIZATION_FOR_IE_AND_EDGE:"failInitializationOnIE",SHELL_APP_LOGS:"shellAppLogs",BROKER_ENABLED_OUTGOING:"brokerEnabledOutgoing",BROKER_ENABLED_INCOMING:"brokerEnabledIncoming",BROKER_REQUEST_BATCHING:"brokerRequestBatching",BROKER_EXCLUSIVELY:"brokerExclusively",SYNC_TROUTER_RESPONSE:"supportsSynchronousTrouterResponse",SUPPORT_PAYLOAD_COMPRESSION:"supportsCompressedServicePayload",INVITE_FREE:"inviteFree",INVITE_FREE_IMPLICIT_INCOMING_CONTACT_REQUEST:"inviteFreeImplicitIncomingContactRequest",SHORT_CIRCUIT:"shortCircuit",USER_SETTINGS_ENABLED:"userSettingsEnabled",ALTERNATIVE_SETTINGS_POSITION:"alternativeSettingsPositionEnabled",SHOW_UNLISTED_SETTINGS:"showUnlistedSettings",ABOUT_PAGE_ENABLED:"aboutPageEnabled",LOCATION_MESSAGE_SUPPORT:"locationMessageSupport",READ_RECEIPT_ENABLED:"readReceiptEnabled",URL_PREVIEW_LOAD_YOUTUBE_PLAYER:"urlPreviewLoadYoutubePlayer",SEARCH_EDUCATION_BUBBLE:"searchEducationBubble",CHAT_EDUCATION_BUBBLE:"chatEducationBubble",CALL_EDUCATION_BUBBLE:"callEducationBubble",SCHEDULE_CALL_EDUCATION_BUBBLE_1:"scheduleCallEducationBubble1",SCHEDULE_CALL_EDUCATION_BUBBLE_2:"scheduleCallEducationBubble2",WELCOME_DIALOG:"welcomeDialog",NOTIFICATIONS_SETTINGS_ENABLED:"notificationsSettingsEnabled",NOTIFICATIONS_SOUNDS_SETTING_ENABLED:"notificationsSoundsSettingsEnabled",CHAT_NOTIFICATIONS_SETTINGS_ENABLED:"chatNotificationsSettingsEnabled",CHAT_NOTIFICATIONS_SOUND_SETTINGS_ENABLED:"chatNotificationsSoundSettingsEnabled",CALL_NOTIFICATIONS_SETTINGS_ENABLED:"callNotificationsSettingsEnabled",CALL_NOTIFICATIONS_SOUND_SETTINGS_ENABLED:"callNotificationsSoundSettingsEnabled",UNREAD_MESSAGE_TOAST_NOTIFICATIONS:"unreadMessageToastNotifications",INCOMING_CALL_TOAST_NOTIFICATIONS:"incomingCallToastNotifications",CONTACT_REQUEST_TOAST_NOTIFICATIONS:"contactRequestToastNotifications",CHAT_REQUEST_TOAST_NOTIFICATIONS:"chatRequestToastNotifications",UNREAD_MESSAGE_TOAST_FOR_ACTIVE_ENDPOINT:"unreadMessageToastForActiveEndpoint",CHAT_MESSAGE_TYPE_NOTIFICATION_ENABLED:"chatMessageTypeNotificationEnabled",TELEMETRY_UIACTIONPERF_ENABLED:"uiActionPerfTelemetryEnabled",TELEMETRY_RUNTIME_ERRORS_ENABLED:"runtimeErrorsTelemetryEnabled",TELEMETRY_CAPTURE_SOURCE_ENABLED:"captureSourceInAllTelemetryEnabled",DO_NOT_SEND_CONTACTS_TO_CHAT_SERVICE:"doNotSendContactsToChatService",SCHEDULE_CALL_FROM_CONVERSATION:"scheduleCallFromConversation",USE_LEGACY_SCHEDULER_URI_FORMAT:"useLegacySchedulerUriFormat",DIRECTORY_SEARCH_SKYPE_AND_LYNC:"directorySearchSkypeAndLync",USE_GRAPH_SEARCH_ANNOTATIONS:"useGraphSearchAnnotations",GRAPH_SEARCH_MIRRORING_ENABLED:"graphSearchMirroringEnabled",GIPHY:"giphy",ME_COMMAND_ENABLED:"meCommandEnabled",SKYPE_CALL_POLICY_SUPPORT:"skypeCallPolicySupport",SKYPE_VIDEO_CALLING_POLICY_SUPPORT:"skypeVideoCallingPolicySupport",SHORT_CIRCUIT_SUPPORT:"shortCircuit",FETCH_CONTACTS_BY_PAGE:"fetchContactsByPageEnabled",CONTACT_PAGE_FILTER_TABS:"contactPageFilterTabs",USE_AZURE_BASED_SILENT_LOGIN:"useAzureBasedSilentLogin",KEY_ENCRYPTION_SERVICE_V2_ENABLED:"keyEncryptionServiceV2Enabled",NAVIGATION_MENU_ICONS_ENABLED:"navigationMenuIconsEnabled",CANVAS_EMOTICONS_ENABLED:"canvasEmoticonsEnabled",MOOD_MESSAGE_EDIT_ENABLED:"moodMessageEditEnabled",FAVORITES_CONVERSATION_ENABLED:"favoritesConversationsEnabled",FAVORITE_CONTACTS_ENABLED:"favoriteContactsEnabled",SYNC_THREAD_BEFORE_JOIN_CONVERSATION_FLOW_ENABLED:"syncThreadBeforeJoinConversationEnabled",AUDIO_VIDEO_SETTINGS_SUPPORT:"audioVideoSettingsSupport",SPLASH_SCREEN_WHITE_THEME:"useWhiteThemeForSplashScreen",SHOW_SIGN_IN_BUTTON_ON_TIMEOUT:"showSignInButtonOnTimeout",SHOW_SIGN_IN_BUTTON_ON_SIGNOUT:"showSignInButtonOnSignout",IDLE_USERS_ANALYTICS:"idleUsersAnalytics",USERS_ANALYTICS:"usersAnalytics",ENHANCED_NOTIFICATION:"enhancedNotification",REOPEN_SIDEBAR:"sidebarReopenEnabled",USE_AVATAR_CACHE:"useAvatarCache",USE_AVATAR_INITIALS:"useAvatarInitials",SHOW_ONE_ACCOUNT_LINK:"showOneAccountLink",INIT_PREFERENCES_AFTER_SIGNIN:"initPreferencesAfterSignin",RINGING_DEFERRING:"ringingDeferring",SHOW_EMOTICON_SUGGESTIONS_SETTINGS:"showEmoticonSuggestionsSetting",FORMAT_QUOTES_ENABLED:"formatQuotesEnabled",DARK_THEME_ENABLED:"darkThemeEnabled",VIDEO_AUTOPLAY_SETTINGS_ENABLED:"videoAutoPlaybackSettingsEnabled",ASK_TO_UNBLOCK_PLUGIN:"askToUnblockPlugin",SMS_SUPPORT_ENABLED:"smsSupportEnabled",UNREAD_CONVERSATION_DEBUGGER:"unreadConversationDebugger",GROUP_AVATAR_UPDATE_ENABLED:"groupAvatarUpdateEnabled",HIDE_SYSTEM_MESSAGES:"hideSystemMessages",LOW_FOCUS_IMPORTANCE_CONTACT_REQUEST:"lowFocusImportanceContactRequest",ENABLE_BUSINESS_CONTACT_MANAGEMENT:"enableBusinessContactManagement",USE_BUSINESS_WORDING:"useBusinessWording",SEARCH_EDUCATION_BUBBLE_BUSINESS:"searchEducationBubbleBusiness",CHAT_EDUCATION_BUBBLE_BUSINESS:"chatEducationBubbleBusiness",NOTIFICATIONS_TOGGLE_ENABLED:"notificationsToggleEnabled",DISABLE_CONCURRENT_ACTIVE_CALLS:"disableConcurrentActiveCalls",DISABLE_CONTACT_CARD_MENU:"disableContactCardMenu",DISABLE_KES:"disableKes",DISABLE_LEAVE_CONVERSATION:"disableLeaveConversation",DISABLE_OPEN_CONVERSATION_WITH_AUTHOR:"disableOpenConversationWithAuthor",DISABLE_PERSISTENT_CONTACT_PRESENCE_SUBSCRIPTION:"disablePersistentContactPresenceSubscription",OPTIMIZE_SPACE_FOR_CC:"optimizeSpaceForCC",DISABLE_REMOVE_CONVERSATION_CONFIRMATION:"disableRemoveConversationConfirmation",DISABLE_CALLSCREEN_CHAT_OPTION:"disableCallScreenChatOption",HAS_FEEDBACK_ICON:"hasFeedbackIcon",SHOW_PICKER_SPINNER:"showPickerSpinner",SHOW_SEARCH_QUERY_MORE_RESULTS_AVAILABLE:"showSearchQueryMoreResultsAvailable",CALLSCREEN_MINMAX:"callscreenMinMax"},autoCallingMode:{call:"Call",join:"Join",golive:"GoLive"},autoCallingThreadId:"autoCallingThreadId",capabilities:{chat:"im.receive",audio:"audio.receive",video:"video.receive",screenSharing:"screen_share",groupAdd:"group.add",_gvc:"gvc",_groupChat:"group_chat",_fileSend:"file.send",_contactSend:"contact.send",_videoMessageSend:"videomessage.send",_audioMessageSend:"audiomessage.send",_mediaMessageSend:"meidamessage.send",_annotationSend:"annotation.send",_photoSend:"photo.send",_mojiSend:"moji.send",_locationSend:"location.send"},modalityType:{CHAT:"Chat",AUDIO:"Audio",VIDEO:"Video",SCREENSHARING:"ScreenSharing",DATACOLLABORATION:"DataCollaboration"},apiUIEvents:{SWX_TIMELINE_LOADED:"swx:timeline:loaded",SWX_CHAT_LOADED:"swx:chat:loaded",SWX_CONTENT_LOADED:"swx:content:loaded",SWX_SPLASHSCREEN_LOADED:"swx:splashscreen:loaded",SWX_CALLSCREEN_MAXIMIZE:"swx:callscreen:maximize",SWX_ON_SIGN_OUT:"swx:on:sign:out",SWX_SINGLE_CONVERSATION:"swx:single:conversation"},chat:{messageType:{OUTGOING:"Outgoing",INCOMING:"Incoming",AUDIO:"Audio",VIDEO:"Video"},BOT_MESSAGING_MODE:{UNDEFINED:"Undefined",ALL:"All",AT:"At"}},telemetry:{APP_SOURCE_NAME:"SWX",uiActions:{TYPE:"ui_action"},runtimeErrors:{TYPE:"runtime_error"},calling:{MASTER_EVENT:"calling",DEVICES:"devices",INTERNAL_PLUGIN_TELEMETRY:"internal_plugin_telemetry",CALL_INFO:"CallInfo",START_CALL:"StartCall",END_CALL:"EndCall",RINGING_CALL:"RingingCall",CONNECTED_CALL:"ConnectedCall",UNKNOWN_CONTACT_TYPE:"unknown",PARTICIPANTS_COUNT_PREFIX:"participantsCount_",direction:{OUTGOING:"Outgoing call",INCOMING:"Incoming call"},callType:{S2S:"S2S",SkypeOut:"SkypeOut",SkypeIn:"SkypeIn"},AVAILABLE:"Available",UNAVAILABLE:"Unavailable",NA:"N/A"},callQualityFeedback:{MASTER_EVENT:"call_quality_feedback",NA:"N/A",PROBLEM_TOKEN_PREFIX:"checks=",reason:{CANCEL:"cancel",RANDOM:"random"}},unansweredCallUI:{MASTER_EVENT:"log_call_unanswered"},autoCalling:{MASTER_EVENT:"autoCalling",SERVICE_FAILURE:"serviceFailure",AUTO_CALL_ENDED:"autoCallEnded",AUTO_CALL_PAYLOAD_INVALID:"autoCallPayloadInvalid",AUTO_CALL_HANDLING_ERROR:"autoCallHandlingError",HOST_JOINED:"hostJoined",PARTICIPANT_JOINED:"participantJoined",ATTEMPT_TO_JOIN:"attemptToJoin"},meArea:{CREDIT_DISPLAY:"credit_display"},chat:{UI_SEND_MESSAGE:"ui_sendMessage",UI_EDIT_MESSAGE:"ui_editMessage",MESSAGE_NOTIFICATION:"message_notification",FILE_TRANSFER:"file_transfer",SYSTEM_COMMAND:"system_command",VIDEO_MESSAGE:{TYPE:"video_message",action:{FIRST_PLAY:"firstPlay",PLAY:"play",FULLSCREEN:"fullscreen",SEEK:"seeking",REPLAY:"replay"},eventName:{LOADED:"loaded"}},AUDIO_MESSAGE:{TYPE:"audio_message",action:{VM_CHAT_PLAYBACK:"vm_chat_playback",VM_CHAT_REPLAY:"vm_chat_playback_replay"}},SMS_ADD_CREDIT:"sms_add_credit"},navigation:{ONE_TO_ONE_CHAT_SKYPE_URI:"skypeUriOneToOneChat",GROUP_CHAT_SKYPE_URI:"skypeUriGroupChat",ONE_TO_ONE_CALL_SKYPE_URI:"skypeUriOneToOneCall",GROUP_CALL_SKYPE_URI:"skypeUriGroupCall"},contacts:{type:{CONTACTS:"Contacts",CONTACT_REQUESTS:"ContactRequests"},name:{GET_CONTACT_LIST:"GetContactList",GET_CONTACT_LIST_DELTA:"GetContactListDelta",CONTACT_REQUEST_READ:"ContactRequestRead",CONTACT_REQUEST_ACCEPTED:"AcceptContact",CONTACT_REQUEST_DECLINED:"DeclineContact",CONTACT_BLOCKED:"ContactBlocked",CONTACT_UNBLOCKED:"ContactUnblocked",CONTACT_DELETED:"ContactDeleted",GET_PROFILES:"GetProfiles",ADD_CONTACT:"AddContact",CONTACTS_PAGE_PERFORMANCE:"ContactsPagePerformance",DISCOVER_AGENTS_PAGE_PERFORMANCE:"DiscoverAgentsPagePerformance",PROFILE_OPENED:"contact_profile_opened"},source:{INITIALIZED:"initilized",UPDATED:"updated"},shortCircuit:{START:"log_sc_start",FINISHED:"log_sc_finished",VISIBLE:"log_sc_visible",ADDRESS_BOOK_ADDED:"log_sc_address_book_added"},searchForFriends:{event:{SHOW:"searchForFriends_page_visible",CLICK:"searchForFriends_search_clicked",KEYDOWN:"searchForFriends_search_key_pressed"}}},contactsV2:{contactManagement:{TYPE:"contacts_contact",names:{ADD_CONTACT:"add_contact",UPDATE_CONTACT:"update_contact",REMOVE_CONTACT:"remove_contact",QUERY_CONTACT:"query_contact"},fields:{NAME:"name",SUCCESS:"success",BEGIN_TIMESTAMP:"begin_timestamp",ELAPSED:"elapsed",SOURCE:"action_source",CONTACT_TYPE:"contact_type"}},contactAction:{TYPE:"contacts_contact_action",names:{BLOCK_CONTACT:"block_contact",UNBLOCK_CONTACT:"unblock_contact",ADD_TO_FAVORITES:"add_contact_to_favorites",REMOVE_FROM_FAVORITES:"remove_contact_from_favorites"},fields:{NAME:"name",SUCCESS:"success",BEGIN_TIMESTAMP:"begin_timestamp",ELAPSED:"elapsed",SOURCE:"action_source",CONTACT_TYPE:"contact_type",REASON:"reason",REPORT_ABUSE:"report_abuse"}},contactList:{TYPE:"contacts_contact_list",names:{QUERY_CONTACT_LIST:"query_contact_list"},fields:{NAME:"name",SUCCESS:"success",BEGIN_TIMESTAMP:"begin_timestamp",ELAPSED:"elapsed",SOURCE:"action_source",SERVICE_ELAPSED:"service_elapsed",FULL_FETCH:"full_fetch",INITIAL_LOAD:"initial_load",NUM_CONTACTS:"number_of_contacts",NUM_AGENTS:"number_of_agents",NUM_SUGGESTED:"number_of_suggested",NUM_PENDING:"number_of_pending",NUM_BLOCKED:"number_of_blocked",NUM_FAVOURITES:"number_of_favorites"}},invitation:{TYPE:"contacts_invitation",names:{SEND_CONTACT_REQUEST:"send_contact_request",ACCEPT_CONTACT_REQUEST:"accept_contact_request",DECLINE_CONTACT_REQUEST:"decline_contact_request",QUERY_INVITATION_LIST:"query_invitation_list"},fields:{NAME:"name",SUCCESS:"success",BEGIN_TIMESTAMP:"begin_timestamp",SERVICE_ELAPSED:"service_elapsed",ELAPSED:"elapsed",SOURCE:"action_source",RESEND:"resend",INVITATION_COUNT:"invitationCount"}},contactSearch:{TYPE:"contacts_search",names:{SEARCH_ADDRESSBOOK:"search_addressBook",SEARCH_DIRECTORY:"search_directory",SEARCH_GROUPS:"search_groups"},fields:{NAME:"name",SUCCESS:"success",BEGIN_TIMESTAMP:"begin_timestamp",ELAPSED:"elapsed",SOURCE:"action_source",QUERY_ID:"query_id",RESULT_COUNT:"result_count",CLICK_POSITION:"click_position"}},searchSession:{TYPE:"contacts_search_session",names:{SEARCH_SESSION:"search_session"},fields:{NAME:"name",SUCCESS:"success",BEGIN_TIMESTAMP:"begin_timestamp",ELAPSED:"elapsed",SOURCE:"action_source",SESSION_ID:"session_id",SUCCESS_CRITERIA:"success_criteria",QUERY_COUNT:"query_count"},enums:{success_criteria:{IM_SENT:"IMsent",CALL_MADE:"callMade",CONTACT_ADDED:"contactAdded"}}}},agents:{type:{AGENTS:"Agents"},name:{DISCOVER_AGENTS_PAGE_PERFORMANCE:"DiscoverAgentsPagePerformance"}},autoBuddy:{SUCCESS:"AutoBuddySuccess"},pes:{eventName:{MOJI_SENT:"moji_sent",MOJI_PLAYED:"moji_played",EMO_SENT:"emo_sent",IMAGE_SENT:"image_sent",PICKER_OPENED:"expression_picker_opened"},section:{FEATURED:"FEATURED",REGULAR:"REGULAR"},source:{TYPED:"TYPED",ROSTER:"ROSTER",RECENTS:"RECENTS"},UNKNOWN:"N/A"},presence:{TYPE:"Presence",name:{SET_ME_PRESENCE:"SetMePresence",GET_CONTACTS_PRESENCE:"GetContactsPresence"}},search:{TYPE:"Search"},promiseInvalidStateException:{TYPE:"PromiseInvalidStateException",feature:{GROUP_SEARCH:"GroupSearch",CONTACT_PICKER:"ContactPicker",PEOPLE_SEARCH:"PeopleSearch"}},NOT_AVAILABLE:"n/a",conversationJoined:{TYPE:"weblauncher_join",result:{SIGNED_IN:"signed_in",SIGNED_OUT:"signed_out",SUCCESS:"success",INCONCLUSIVE:"inconclusive"},milestoneType:{CLIENT_INIT:"client_init",ERROR:"error",END:"end"}},guestActionsInHeader:{TYPE:"chat_guest_headerActions",cta:{PROFILE_TOGGLED:"profileToggled",COPY_LINK:"copyLink",EMAIL_LINK:"emailLink"},telemetryItem:{AVATAR:"telemetryItemAvatar",TOPIC:"telemetryItemTopic",CHEVRON_DOWN:"telemetryItemChevronDown",CHEVRON_UP:"telemetryItemChevronUp"},parent:{GROUP_PROFILE_VIEW_MODEL:"GroupProfileViewModel",HEADER_VIEW_MODEL:"HeaderViewModel"}},removeConversationHistory:{TYPE:"swx_conversation_removeHistory",cta:{TIMELINE_MENU:"timeline",PROFILE:"profile"},action:{CANCELED:"canceled",CONFIRMED:"confirmed"}},leaveConversation:{TYPE:"swx_conversation_leave",cta:{TIMELINE_MENU:"timeline",PROFILE:"profile"},action:{CANCELED:"canceled",CONFIRMED:"confirmed"}},sendSms:{TYPE:"swx_send_sms",status:{FAILED:"failed",NOT_ENOUGH_CREDIT:"notEnoughCredit",SUCCESSFUL:"successful"}},markAllConversationsAsRead:{TYPE:"swx_mark_all_conversations_read"},markConversationAsRead:{TYPE:"swx_conversation_mark_read"},browserToast:{EVENTS:{SHOWN:"kpi_toast_shown",CLICKED:"kpi_toast_clicked"},toastType:{INDIVIDUAL:"Individual",BIRTHDAY:"Birthday",SUMMARY:"Summary"},unreadState:{NONE:"none",PASSIVE:"PassiveOnly",ACTIVE:"ActiveOnly",BOTH:"Both"},displayType:{REMINDER:"reminder",NORMAL:"normal",SUMMARY:"summary"},ignore:{TIMEOUT:864e5,TIMEOUT_KEY:"IgnoreSessionToastMs"}},sendContacts:{TYPE:"message_contactInfo_send",cta:{MEDIABAR:"mediabar"},action:{CANCELED:"canceled",CONFIRMED:"confirmed"}},urlPreviewShown:{TYPE:"message_urlpreview_show"},urlPreviewClicked:{TYPE:"message_urlpreview_action"},contactInfo:{TYPE:"message_contactinfo_receive",action:{SHOW:"showed",CLICK:"clicked"}},menuItemClicked:{TYPE:"menu_item_clicked"},messageSent:{TYPE:"kpi_message_sent"},conversationOrigin:{GUEST_HOST:"guestHost",NORMAL:"normal"},mediaBarEvent:{TYPE:"media_bar_event"},timelineLoadEvent:{TYPE:"chat_timeline_load"},conversationHistoryLoadEvent:{TYPE:"chat_conversation_historyLoad"},splashScreenEvent:{TYPE:"experience_load_times"},splashScreenSignInEvent:{TYPE:"splash_screen_sign_in",STATE:{APP_READY:"appReady",SIGN_IN_FAILED:"signInFailed",REAUTH_NEEDED:"reauthNeeded",SIGNING_OUT:"signingOut",SIGNED_OUT:"signedOut"}},eduCarouselEvents:{telemetry:{START:"educational_carousel_start",FINISH:"educational_carousel_finish"},action:{HIDE:"educational_carousel_hide"}},notificationActionsEvent:{TYPE:"notificationActions",action:{accept:"accept",decline:"decline",open:"open"}},skypeTokenEvent:{TYPE:"skype_token_fetched"},swiftCard:{swiftCardActionEventName:"kpi_swift_cards_button_pressed",swiftCardInvalidEventName:"kpi_swift_cards_invalid_card",swiftCardUnsupportedEventName:"kpi_swift_cards_unsupported_card",invalidCardReasons:{MissingActionType:"Missing action type",MissinActionTitle:"Missing action title",MissinActionValue:"Missing action value",CardMissingContent:"Missing content in card",InvalidButton:"Content buttons are not valid",MainSectionNotValid:"Invalid main section in Content",SignInMissingButtons:"SignIn missing buttons",SignInMissingText:"SignIn missing text",ReceiptMissingTotal:"Receipt missing total",ReceiptInvalidButton:"Receipt invalid buttons",MediaCardMissingSrc:"Media card has no SD/HD source",SwiftMissingType:"Swift missing type",SwiftMissingCards:"Swift missing cards"},unsupportedCardReasons:{CardUnsupportedType:"Card has unsupported type",ContentUnsupportedButton:"Content contains unsupported button",ReceiptUnsupportedButton:"Receipt contains unsupported button",SwiftUnknownType:"Swift has unknown type"}},translator:{eventType:{OUTGOING:"translator_message_outgoing",INCOMING:"translator_message_incoming",SETTINGS_SHOW:"translator_settings_show",SETTINGS_HIDE:"translator_settings_hide",SETTINGS_BUTTON_ENABLED:"translator_settings_button_enabled",ME_LANGUAGE_CHANGED:"translator_me_language_changed",PARTICIPANT_LANGUAGE_CHANGED:"translator_participant_language_changed"},action:{CLICK_SEE_ORIGINAL:"click_see_original",CLICK_SEE_TRANSLATION:"click_see_translation",TRANSLATE:"translate",RETRANSLATE:"re-translate",SHOW:"show"},initiator:{ESCAPE_KEY:"escape_key",CLICK_GLOBE_BUTTON:"click_globe_button"}},performanceMarks:{EXPERIENCE:{INIT_START:"swx_timeline_initStart",INIT_END_OK:"swx_timeline_initEnd_ok",INIT_END_404:"swx_timeline_initEnd_404",INIT_END_ERROR:"swx_timeline_initEnd_err",TTL_START:"swx_experience_ttl_start",CONTENT_INIT:"swx_content_initStart"},TIMELINE:{RENDER_END:"swx_timeline_renderEnd",SYNC_START:"swx_timeline_syncStart",SYNC_END_OK:"swx_timeline_syncEnd_ok",SYNC_END_404:"swx_timeline_syncEnd_404",SYNC_END_ERROR:"swx_timeline_syncEnd_err"},CONVERSATION:{TTP:"swx_conversation_ttp"},NEW_CONVERSATION:{FLOW_START:"swx_newConversation_flowStart",CREATION_START:"swx_newConversation_creationStart",CREATION_END_OK:"swx_newConversation_creationEnd_ok",CREATION_END_404:"swx_newConversation_creationEnd_404",CREATION_END_ERROR:"swx_newConversation_creationEnd_err",RENDER_END:"swx_newConversation_renderEnd"},CONVERSATION_UPDATE:{UPDATE_START:"swx_conversationupdate_start",UPDATE_END:"swx_conversationupdate_end",SYNC_END:"swx_conversationupdate_syncEnd"},IM_SEND:{POST_START:"swx_imSend_postStart",POST_END_OK:"swx_imSend_postEnd_ok",POST_END_404:"swx_imSend_postEnd_404",POST_END_ERROR:"swx_imSend_postEnd_err"},CONTACTS:{LIST_LOAD:"swx_contact_list_load",REMOVE_CONTACT:"swx_contact_remove_contact",SEND_REQUEST:"swx_contact_send_request",ACCEPT_REQUEST:"swx_contact_accept_request",DECLINE_REQUEST:"swx_contact_decline_request",QUERY_INVITATION_LIST:"swx_contact_query_invitation_list",ADD_CONTACT:"swx_contact_add_contact",BLOCK_CONTACT:"swx_contact_block_contact",UNBLOCK_CONTACT:"swx_contact_unblock_contact",ADD_TO_FAVORITES:"swx_contact_add_contact_to_favorites",REMOVE_FROM_FAVORITES:"swx_contact_remove_contact_from_favorites",SESSION_SEARCH:"swx_contact_session_search",SEARCH_CONTACT:"swx_contact_search",PAGE:{OPENED:"swx_contacts_page_opened",INITIALIZED:"swx_contacts_page_initialized",RENDERED:"swx_contacts_page_rendered"}},DISCOVER_AGENTS:{LIST_LOAD:{START:"swx_discover_agents_list_load",END:"swx_discover_agents_list_end"},PAGE:{OPENED:"swx_discover_agents_page_opened",INITIALIZED:"swx_discover_agents_page_initialized",RENDERED:"swx_discover_agents_page_rendered"}},SEARCH:{LOCAL:{START:"swx_search_local_start",END:"swx_search_local_end",RESULTS_RENDERED:"swx_search_local_results_rendered"},GLOBAL:{START:"swx_search_global_start",END:"swx_search_global_end",RESULTS_RENDERED:"swx_search_global_results_rendered"}},SKYPEOUT:{PAGE:{OPENED:"swx_skypeout_page_opened"}},USER_SETTINGS:{PAGE:{OPENED:"swx_settings_page_opened"}}},measurements:{EXPERIENCE:{TTL:"swx_experience_ttl",TTL404:"swx_experience_ttl",SPLASH_TIME:"swx_experience_splash_screen_time"},TIMELINE:{TTL:"swx_timeline_ttl",TTL404:"swx_timeline_ttl",TTR:"swx_timeline_ttr"},NEW_CONVERSATION:{TTC:"swx_newConversation_ttc",TTS:"swx_newConversation_tts",TTR:"swx_newConversation_ttr"},CONVERSATION_UPDATE:{TTC:"swx_conversationupdate_ttc",TTS:"swx_conversationupdate_tts"},IM_SEND:{TTS:"swx_imsend_tts",TTS404:"swx_imsend_tts_404",TTR:"swx_imsend_ttr"},CONTACTS:{LIST_LOAD:{TTC:"swx_contacts_list_load_ttc"},PAGE:{TTC:"swx_contacts_page_ttc",TTR:"swx_contacts_page_ttr"}},DISCOVER_AGENTS:{LIST_LOAD:{TTC:"swx_discover_agents_list_load_ttc"},PAGE:{TTC:"swx_discover_agents_page_ttc",TTR:"swx_discover_agents_page_ttr"}},SEARCH:{LOCAL:{TTR:"swx_search_local_ttr"},GLOBAL:{TTR:"swx_search_global_ttr"}}},stages:{NEW_CONVERSATION:{STARTED:1,CREATED:2,REDIRECTED:3,ABANDONED:4},CONVERSATION_UPDATE:{COMPLETED:1,CANCELLED:2,ABANDONED:3}},conversationType:{UNKNOWN:-1,DIALOG:0,GROUP:1},persona:{NEWBEE:1,RETURNING:2,CLASSIC_IM:3,POWER_IM:4},historyLoadOrigin:{TIMELINE_INIT:1,NOTIFICATION_CONV:2,NOTIFICATION_AGGR:3,CONTACT_SEARCH:4,GROUP_SEARCH:5,DIRECTORY_SEARCH:6,NEW_CHAT_OPEN_EXISTING:7,PAGING:8,CALLING:9,AUTHOR_SWITCH:10,ROSTER:11,CONVERSATION_TO_THREAD:12,NEW_CHAT_CREATION:13,TIMELINE_CLICK:14,CONTACT_REQUEST_DECLINED:15,NEW_CHAT_DUMMY:16,NEW_CHAT_API_START_CONVERSATION:17,CONTACTS_PAGE:18,SKYPEOUT_PAGE:19,NEW_CONVERSATION_API:20,CONVERSATION_HEADER_BUTTON:21,CREATE_CONVERSATION_FOR_SCHEDULED_CALL:22,DISCOVER_AGENTS_PAGE:23,SKYPEOUT_PAGE_API:24,UNANSWERED_CALL_UI:25,MENTION_ME:99,SKYPE_URI:100},timelineLoadOrigin:{LOAD:1,RELOAD:2,RESSURECT:3},messageTypes:{MEDIA_VIDEO:1,MEDIA_PICTURE:2,MEDIA_LOCATION:4,CALLING_OTHER:8,FILES_MASK:4080,FILES_PICTURE:16,FILES_VIDEO:32,FILES_OFFICE:64,FILES_ARCHIVE:128,FILES_BINARY:256,FILES_PDF:512,FILES_OTHER:1024,FILES_AUDIO:2048,RICHTEXT_MASK:61440,RICHTEXT_FORMAT:4096,RICHTEXT_EMOTICONS:8192,RICHTEXT_ME:16384,RICHTEXT_OTHER:32768,CONTACT_OTHER:65536,TEXT_MASK:15728640,TEXT_ME:1048576,TEXT_OTHER:2097152,OTHER_TYPES:16777216},subCategories:{LOCAL_CONTACT_SEARCH:"LocalContactSearch",GLOBAL_CONTACT_SEARCH:"GlobalContactSearch",LOAD_CONTACTS:"LoadContacts"},poll:{eventName:{DESIGNER_OPENED:"poll_ui_designer_opened",STICKY_MESSAGE_CLICKED:"poll_ui_sticky_message_clicked",AVATAR_ELIPSIS_CLICKED:"poll_ui_avatar_elipsis_clicked",ERROR:"poll_error",ANSWER_LENGTH:"poll_ui_answer_length",ACTIVITY:"poll_activity"},activityType:{SEND:"send",VOTE:"vote",QUOTE:"quote",EDIT:"edit",REMOVE:"remove",CLOSE:"close"},errorType:{PARSING:"parsing",SEND:"send",OTHER:"other"},property:{CONVERSATION_ID:"conversation_id",MESSAGE_ID:"message_id",ACTIVITY_TYPE:"activity_type",ERROR_TYPE:"error_type",XMM_TYPE:"xmm_type",QUESTION_LENGTH:"question_length",ANSWER_LENGTH:"answer_length",ANSWERS_COUNT:"answers_count",MULTI_VOTE:"multi_vote",IS_NEW_VOTE:"is_new_vote",TOTAL_VOTES:"total_votes",TIME_SINCE_CREATION:"time_since_creation"}},userSettings:{eventName:{PREFERENCE_FETCHED:"user_settings_preference_fetched",PREFERENCE_CHANGED:"user_settings_preference_changed",PANEL_SHOWN:"user_settings_panel_shown",PAGE_DISMISSED:"user_settings_page_dismissed"},outcomeNames:{SUCCESS:"success",FAILURE:"failure"},property:{ITEM_NAME:"name",ITEM_VALUE:"value",OPERATION_OUTCOME:"outcome",OPERATION_DURATION:"duration"},UNKNOWN:"N/A"},inappActivity:{KPI_INAPP_ACTIVITY_START:"kpi_inapp_activity_start",KPI_INAPP_ACTIVITY_END:"kpi_inapp_activity_end"},pstn:{eventName:{PSTN_BUTTON_CLICKED:"kpi_pstn_button_clicked",PSTN_CALL_INITIATED:"kpi_pstn_call_initiated",ADD_CREDIT:"kpi_pstn_add_credit",ADD_SUBSCRIPTION:"kpi_pstn_add_subscription",CREDIT_BALANCE_UPDATE_CALL_END:"kpi_pstn_credit_balance_latency_call_end"},entryPoint:{CONTACT_LIST:"Contact List",SKYPE_OUT_PAGE:"Skype Out Page",CONVERSATION:"Conversation",RECENTS:"Recents",SEARCH:"Search Results",NO_CREDIT_CALL_START:"No Credit Call Start",NO_CREDIT_CALL_END:"No Credit Call End",NO_SUBSCRIPTION_CALL_START:"No Subscription Call Start",NO_SUBSCRIPTION_CALL_END:"No Subscription Call End"},cssClasses:{ADD_CREDIT:"js-addCredit",ADD_SUBSCRIPTION:"js-addSubscription"}},endpoints:{TYPE:"endpoints"},reopenSidebar:{REOPENED:"sidebar_reopened",CLOSE_TIMEOUT:"sidebar_close_timeout"},idleUsersAnalytics:{localKeys:{signInData:"swx|signInData",sidebarActivity:"swx|sidebarActivity"},TYPE:"idleUsersAnalytics"},usersAnalytics:{TYPE:"usersAnalytics"},themeEvent:{TYPE:"current_theme",theme:{DEFAULT:"default",DARK:"dark"}},teamsMigration:{EVENT_NAME:"teamsMigration",eventType:{ALERT_DISPLAYED:"alertDisplayed",ALERT_CLOSED:"alertClosed",ALERT_ACTION_INVOKED:"alertActionInvoked",MIGRATION_UI_SHOWN:"migrationUIShown",MIGRATION_UI_ACTION_INVOKED:"migrationUIActionInvoked"},eventAction:{CLOSE_ALERT:"close",CLICK_CTA:"cta"}},teamsAsDefaultClient:{EVENT_NAME:"teamsAsDefaultClient",eventType:{ALERT_DISPLAYED:"alertDisplayed",ALERT_CLOSED:"alertClosed",ALERT_ACTION_INVOKED:"alertActionInvoked"},eventAction:{CLOSE_ALERT:"close",CLICK_CTA:"cta"}}},globalizationFormatKeys:{time:{CALL_DURATION:"duration",SHORT:"short"},date:{DAY_MONTH:"dayMonth",DAY_MONTH_YEAR:"dayMonthYear",DAY_ABBREVIATION:"dayAbbr",DAY_NAME:"dayName",DATE_ABBREVIATION:"dateAbbr",SHORT_DATE_ABBREVIATION:"shortDateAbbr"}},api:{renderConversation:{errorMessages:{CONTAINER_UNDEFINED:"Container is undefined",CONTAINER_NOT_ELEMENT_NOT_SELECTOR:"Container is not a DOM element or CSS selector",PARTICIPANTS_WRONG_FORMAT:"Participants are expected to be an array",CONVERSATION_ID_WRONG_FORMAT:"Conversation ID is expected to be a string",PARTICIPANTS_AND_CONVERSATION_ID_UNDEFINED:"Participants or Conversation ID can't be undefined"}},conversation:{errorMessages:{NO_PARTICIPANTS:"Cannot start, at least one participant is required",SEARCH_FAILED:"Search for Person failed",URI_NOT_VALID:"Uri not a string",SUCCESS_CALLBACK_ERROR:"Unexpected error in success callback"}},modality:{errorMessages:{INVALID_MODALITIES:"Invalid modalities format provided",MODALITY_TYPE_NOT_SUPPORTED:"Modality type not supported",MODALITY_START_FAILED:"Modality cannot be started",ERROR_CALLBACK_ERROR:"Unexpected error in error callback"}},auth:{errorTypes:{TOO_MANY_CONNECTIONS_ERROR:"TooManyConnectionsError",NOT_LINKED:"AccountNotLinkedError",AGE_RESTRICTION_ERROR:"underage",OAUTH_FAILED_ERROR:"OAuthFailed",LOGIN_REQUIRED_ERROR:"login_required",SIGN_IN_CANCELED_ERROR:"Canceled",SIGNED_OUT_ERROR:"SignedOut",REAUTH_NEEDED:"ReauthenticationNeeded",TIMEOUT:"timeout"},errorMessages:{AUTH_DISABLED:"authentication disabled",ALREADY_SIGNED_IN:"user already signed in",ALREADY_SIGNED_OUT:"user already signed out",NOT_LINKED:"not-linked"},accountLinking:{WELCOME_FLOW:"welcome",RELINK_FLOW:"relink",INLINE_NEW_USER_FLOW:"inlineNewUser"},authProviderType:{SKYPE_TOKEN:"skypeToken",IMPLICIT_AUTH:"implicitOAuth",PASSWORD:"password",ANONYMOUS:"anonymous"},DEFAULT_SIGNIN_TIMEOUT:65e3}},silentLogin:{errorMessages:{NOT_LINKED:"not_linked",TIMED_OUT:"timed_out",INVALID_GRANT:"invalid_grant"}},conversation:{TOPIC_DELIMITER:", ",NUMBER_OF_PARTICIPANT_NAMES_IN_TOPIC:4},uiMode:{NARROW:"narrow"},cache:{VERSION:"1.9",PREFIX_KEYWORD:"swx",INTERNAL_KEYS:{VERSION:"version",ENCRYPTION_KEY:"encryptionKey",KEYS_MAP:"keysMap"},DEFAULT_BUFFER_TIMEOUT:300},experience:{RENDERER_CLASS:"swx"},disposableGroups:{PUB_SUB:"PUB_SUB",GENERIC_DISPOSABLE:"GENERIC_DISPOSABLE",INTERVAL:"INTERVAL",TIMEOUT:"TIMEOUT",DOM_EVENT:"DOM_EVENT"},urlValidator:{ALLOW_EMPTY:{}},i18n:{EMBEDDED_LOCALE:"en-us"},mentions:{"class":"mention(?: me)?",meIdentifier:/class\s?=\s?["']mention me["']/},fileTransfer:{MAX_RESOLUTION:16e3,MAX_FILE_SIZE:314572800,SUPPORTED_PICTURE_TYPES:"image/x-png, image/png, image/jpeg",MAX_PHOTO_SIZE:20971520,FILE_DOWNLOAD_WARNING_FLAG_API_ID:19},messageDestination:{SKYPE_NETWORK:"destination:skype",SMS_NETWORK:"destination:sms"},annotationType:{EMOTIONS:"emotions"},emotionTypes:{HEART:"heart"},sidebar:{position:{LEFT:"left",RIGHT:"right"},cssClasses:{SLIDE_LEFT_TO_RIGHT:"slideLeftToRight",SLIDE_RIGHT_TO_LEFT:"slideRightToLeft"}},textarea:{MAX_LENGTH:2e3},urlPreviewType:{WWW:"urlp-www",YT:"utlp-yt",GIF:"urlp-gif"},userSettings:{categories:{IM_SETTINGS:"im_settings",IM_APPEARANCE:"im_appearance",PRIVACY:"privacy",UNLISTED:"unlisted",CONTACTS:"contacts",AUDIO_VIDEO:"audio_video",NOTIFICATIONS:"notifications",PERSONALIZATION:"personalization"},preferences:{URL_PREVIEWS:"urlPreviews",YOUTUBE_PLAYER:"youTubePlayer",MENTIONS:"mentions",FILE_PASTE:"filePaste",TYPING_INDICATOR:"typingIndicator",SKYPE_CALL_POLICY_SUPPORT:"skypeCallPolicySupport",SKYPE_VIDEO_CALLING_POLICY_SUPPORT:"skypeVideoCallingPolicySupport",READ_RECEIPT:"readReceipt",AUTO_BUDDY:"autoBuddy",AUTO_BUDDY_DISCOVERY:"autoBuddyDiscovery",DYNAMIC_DISCOVERY:"dynamicDiscovery",NOTIFICATIONS:"notifications",NOTIFICATIONS_SOUND:"notificationsSound",CHAT_NOTIFICATIONS_SOUND:"chatNotificationsSound",CALL_NOTIFICATIONS:"callNotifications",CALL_NOTIFICATIONS_SOUND:"callNotificationsSound",DEFER_RINGING_SOUND:"deferRingingSound",EMOTICON_SUGGESTIONS:"emoticonSuggestions",SHOW_EMOTICONS:"showEmoticons",SHOW_ANIMATED_EMOTICONS:"showAnimatedEmoticons",SHOW_LARGE_EMOTICONS:"showLargeEmoticons",DARK_THEME:"darkTheme",VIDEO_AUTOPLAY:"videoAutoPlayback"}},proofTypes:{EMAIL:"email",PHONE:"phone"},shortCircuit:{scenarios:{ADD_VERIFIED_PHONE:"settingspnv",MANAGE_ADDRESSBOOKS:"settingsaddressbooks"}},window:{BLANK_NAME:"_blank"},educationBubbles:{ORIENTATION:{TOP:"TOP",BOTTOM:"BOTTOM",LEFT:"LEFT",RIGHT:"RIGHT"},SIZE:{LARGE:"LARGE"}},classes:{WHITE_THEME:"themeWhiteCompliant",BLUE_THEME:"themeBlue",WHITE_COLOR:"white"},modalDialog:{ALLOW_BROWSER_NOTIFICATIONS_CONTAINER_ID:"overlayAllowBrowserNotifications"},rtlLanguages:["ar-sa","fa-ir","he-il","ku-arab-iq","ur-pk"],teamsMigration:{SHOW_NOTIFICATION:"showNotification",REDIRECT_CLIENT:"redirectClient",UPDATE_CLIENT:"updateClient",TEAMS_ALERT_ACTION_CLASS:".TeamsAlert-action",TEAMS_ALERT_HIDE_NOTIFICATION_CLASS:".TeamsAlert-hide",LOCAL_STORAGE_KEY:"teamsMigrationExpiration",EXPIRATION_MULTIPLIER_NEVER:31536e8,EXPIRATION_MULTIPLIER_24H:864e5},teamsAsDefaultClient:{NONE:0,CHAT:1,CALLING:2,CHAT_AND_CALLING:3}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-constants/lib/index",["require","exports","./calling","./pluginConst","./people","./outOfBrowser","./keys","./common"],e)}(function(e,t){var n=e("./calling");t.CALLING=n["default"];var r=e("./pluginConst");t.PLUGIN_CONST=r["default"];var i=e("./people");t.PEOPLE=i["default"];var s=e("./outOfBrowser");t.OUT_OF_BROWSER=s["default"];var o=e("./keys");t.KEYS=o["default"];var u=e("./common");t.COMMON=u["default"]}),define("swx-constants",["swx-constants/lib/index"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-cafe-application-instance/lib/instance",["require","exports"],e)}(function(e,t){function r(e){n=e}function i(){if(!n)throw new Error("Instance does not exist yet!");return n}var n;t.set=r,t.get=i}),define("swx-cafe-application-instance",["swx-cafe-application-instance/lib/instance"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-internal-application-instance/lib/instance",["require","exports"],e)}(function(e,t){function r(e){n=e}function i(){if(!n)throw new Error("Instance does not exist yet!");return n}var n;t.set=r,t.get=i}),define("swx-jskype-internal-application-instance",["swx-jskype-internal-application-instance/lib/instance"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("jcafe-property-model/lib/propertyModel",["require","exports"],e)}(function(e,t){function v(e,t){return t=U({code:e},t),U(Error(this||e),t)}function m(e,t){var n=e+" is not a "+t;return v.call(n,"WrongType",{value:e})}function g(e,t,n){var r="`"+e+"` = "+t+" is not a "+n;return v.call(r,"WrongArgType",{arg:e,value:t})}function y(e,t){var n=e+" != "+t;return v.call(n,"DoesNotEqual",{lhs:e,rhs:t})}function b(e,t){var n="`"+e+"` is invalid: "+t;return v.call(n,"InvalidArgument",{arg:e,reason:t})}function w(e,t){var n="Invalid state: "+e+" (expected "+t+")";return v.call(n,"InvalidState",{actual:e,expected:t})}function E(e,t){var n="the `"+e+"` property is missing";return v.call(n,"KeyMissing",{key:e,object:t})}function S(e){return v("AlreadyExists",{item:e})}function x(e){return v("DoesNotExist",{item:e})}function T(e){return v("NotSupported",{reason:e})}function N(e,t,n){if(!e){if(!c)debugger;throw v(t||"AssertionFailed",n)}}function C(e,t,n){if(!e)throw v(t||"RuntimeCheckFailed",n)}function k(e){return c?e:e+":"+X()}function L(e,t){p.replacePrototype?e.__proto__?e.__proto__=t:Object.setPrototypeOf?Object.setPrototypeOf(e,t):U(e,t):U(e,t)}function A(){function r(e,t){s(e,0)}function i(){var n=l();while(e.length){var r=e.shift();r();var i=l()-n;if(i>=t||i<0)return}}function o(){n=!0;try{i()}finally{n=!1,e.length&&r(o,!1)}}function u(){if(n||e.length>1)return;r(o,!0)}function a(t){e.push(t),u()}var e=[],t=16,n=!1;return a}function M(e){var t=[];for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];e=e.bind.apply(e,[this].concat(t)),c?e():O(e)}function _(e){N(e>=0);var t=jt(e+" sec timeout",{cancel:function(e){o(n),t.reject(e)}}),n=s(function(){t.resolve()},e*1e3|0);return t.promise}function D(e){return Pt(e)().then(function(){return U(D(e),{locked:!0})})}function P(e,t){return N(ht(t)&&t>0),e=Pt(e),D(function(){return e().then(B(_,t))})}function H(e,t,n){return t in e?e[t]:n}function B(e){var t=[];for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=this;return e.bind?e.bind.apply(e,[r].concat(t)):function(){return e.apply(r,t.concat([].slice.call(arguments,0)))}}function j(e,t){var n;if(e.indexOf)return e.indexOf(t);for(n=0;n<e.length;n++)if(e[n]==t)return n;return-1}function F(e,t){e.splice(t,1)}function I(e,t,n){e.splice(t,0,n)}function q(e){var t;return Object.keys?t=Object.keys(e):(t=[],J(e,function(e,n){t.push(n)})),t}function R(e,t){for(var n in e)if(!t(e[n],n))return!1;return!0}function U(e){var t=[];for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r,i,s,o=t[t.length-1];e=e||{},o=ct(o)?o:"";for(i=0;i<t.length;i++){r=t[i]||{};if(r!==o)for(s in r)if(o!="append"||!(s in e))e[s]=r[s]}return e}function z(e,t,n){n===void 0&&(n=null);var r,i=n||window,s=e.split(".");for(r=0;r<s.length;r++)i=i[s[r]]||(i[s[r]]={});for(r in t)r in i?f&&f.warn:i[r]=t[r];return i}function W(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=a.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})}function X(){return a.random().toString(16).slice(2)}function V(e,t,n,r){try{Object.defineProperty(e,t,{value:n,enumerable:!1,writable:!r})}catch(i){e[t]=n}}function $(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/gm,"")}function J(e,t){N(ft(e)||at(e)),N(pt(t));var n,r,i;if(ft(e))for(r=0;r<e.length;++r)t(e[r],r);else for(i in e)n=t(e[i],i),N(n===void 0)}function K(e,t){N(ft(e)||at(e)),N(pt(t));var n;return ft(e)?(n=[],J(e,function(e,r){t(e,r)&&n.push(e)})):(n={},J(e,function(e,r){t(e,r)&&(n[r]=e)})),n}function Q(e){N(at(e));var t=[];return J(e,function(e){t.push(e)}),t}function G(e){return N(ft(e)||at(e)),ft(e)?e.length:q(e).length}function Y(e,t){N(ft(e)||at(e)),N(pt(t));var n;if(ft(e)){for(n=0;n<e.length;++n)if(t(e[n],n))return!0}else for(n in e)if(t(e[n],n))return!0;return!1}function Z(e,t){N(ft(e)||at(e)),N(pt(t));var n,r={};if(ft(e)){for(n=0;n<e.length;++n)if(t(e[n],n))return e[n]}else for(n in e)if(t(e[n],n))return r[n]=e[n],r;return null}function et(e){return Object.freeze?Object.freeze(e):e}function tt(){var e={},t,n;for(n=0;n<arguments.length;n++)t=arguments[n],e[t]=t;return et(e)}function nt(){var e,t;if(arguments.length==1&&at(arguments[0]))e=arguments[0];else{e={};for(t=0;t<arguments.length;t++)e[arguments[t]]=t}return et(e)}function rt(e,t){for(var n in e)if(e[n]==t)return n;return""}function it(e,t,n){var r,i;if(ft(e)){r=[];for(i=0;i<e.length;i++)r.push(t.call(n,e[i],i,e))}else if(at(e)){r={};for(i in e)r[i]=t.call(n,e[i],i,e)}return r}function st(e,t,n){var r,i={};e=e||{},t=t||{};for(r in t)if(!(r in e)||n!="append")i[r]={value:t[r],writable:!0,enumerable:!0,configurable:!0};return Object.create(e,i)}function ot(e){return e&&JSON.parse(JSON.stringify(e))}function ut(e){return e&&Object.prototype.toString.call(e)=="[object Object]"}function at(e){return ut(e)}function ft(e){return Object.prototype.toString.call(e)=="[object Array]"}function lt(e,t){if(!ft(e))return!1;for(var n=0;n<e.length;n++)if(!t(e[n]))return!1;return!0}function ct(e){return Object.prototype.toString.call(e)=="[object String]"}function ht(e){return Object.prototype.toString.call(e)=="[object Number]"}function pt(e){return Object.prototype.toString.call(e)=="[object Function]"}function dt(e){return Object.prototype.toString.call(e)=="[object Boolean]"}function vt(e){return ct(e)&&e.length>0}function mt(e){return e===null||e===undefined}function gt(e){return ht(e)&&(e|0)==e}function yt(e,t){return gt(e)&&ft(t)&&e>=0&&e<t.length}function bt(e,t,n){return ht(n)&&n>=e&&n<=t}function wt(e){return ut(e)&&vt(e.type)&&vt(e.url)}function Et(e){return at(e)&&"status"in e}function St(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function xt(e){return e&&e[h]}function Tt(e){return e instanceof Ft}function Nt(e){return e&&e.constructor===ln}function Ct(e){return e&&e.constructor===sn}function kt(e){return e&&e.constructor===Zt}function Lt(e,t){var n,r=t.split("|");for(n=0;n<r.length;n++)if(r[n]in Lt.types&&Lt.types[r[n]](e))return!0;return!1}function At(e){return e&&pt(e.then)}function Ot(e,t){var n,r=typeof e,i=typeof t;if(e===t)return!0;if(r!==i||r!=="object"&&r!=="function")return!1;if(e===null||t===null)return e===t;if(e instanceof u&&t instanceof u)return+e==+t;for(n in e)if(!(n in t)||e[n]!==t[n])return!1;for(n in t)if(!(n in e)||e[n]!==t[n])return!1;return!0}function Mt(e){return e.replace(/[<>&;#/]/gm,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/\r\n|\n/gm,function(){return"<br>"})}function _t(e){return(new Qt("<root>"+e+"</root>")).text()}function Dt(e){return e.replace(/&(#?\w+);/gm,function(e,t){return t.charAt(0)=="#"?String.fromCharCode(+t.slice(1)):Dt.entities[t]})}function Pt(e,t){var n=e[h]?e:function(){try{return jt.wait(e.apply(this,arguments),t)}catch(n){return jt().reject(n).promise}};return V(n,h,!0),n}function Bt(e,t){this.event=e,this.listener=t}function jt(e,t){if(this instanceof jt){ct(e)||(t=e,e=void 0),t=t||{};var n=this,r={};return r.leafs=[],r.state="pending",r.status=sn({value:e}),t.mode&&(r.mode=t.mode),t.cancel&&(r.fnCancel=t.cancel),r.promise=new jt.Promise(n),U(n,{_:r,status:r.status,promise:r.promise}),undefined}return new jt(e,t)}function Ft(e){var t=jt();try{e(function(e){t.resolve(e)},function(e){t.reject(e)},t.status)}catch(n){t.promise.state()=="pending"&&t.reject(n)}return t.promise}function It(e){return st(It.prototype,{exec:function(t,n){var r=e(t,n||0);return arguments.length==2?r:!r||r.pos!=t.length?null:r.res}})}function qt(e){return It(function(t,n){return t.slice(n,n+e.length)==e?{res:e,pos:n+e.length}:undefined})}function Rt(e){return It(function(t,n){var r=e.exec(t.slice(n));return r&&r.index==0?{res:r[0],pos:n+r[0].length}:undefined})}function Ut(e,t){return It(function(n,r){return e.exec(n,r)||{res:t,pos:r}})}function zt(e,t){return It(function(n,r){return!t.exec(n,r)&&e.exec(n,r)})}function Wt(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];return It(function(t,n){var r,i,s=[];for(r=0;r<e.length;r++){i=e[r].exec(t,n);if(!i)return undefined;s.push(i.res),n=i.pos}return{res:s,pos:n}})}function Xt(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];return It(function(t,n){var r,i;for(r=0;r<e.length&&!i;r++)i=e[r].exec(t,n);return i})}function Vt(e){return It(function(t,n){var r,i=[];while(r=e.exec(t,n))i.push(r.res),n=r.pos;return{res:i,pos:n}})}function $t(e,t){var n=Wt(t,e).select(1),r=Wt(e,Vt(n)).then(function(e){return[e[0]].concat(e[1])});return Ut(r,[])}function Jt(e,t){var n=Rt(/\\./).then(function(e){return e.slice(1)}),r=Xt(n,zt(Rt(/./),t));return Wt(e,Vt(r),t).select(1).merge()}function Kt(e){var t=Kt.pattern.exec(e);if(!t)throw new SyntaxError("Invalid data URL: "+e);return t.base64=!!t.attributes.base64,t}function Gt(e){return{root:new Qt($(e.replace(/^<\?.+?\?>/,"")))}}function Yt(e){var t=Yt.pattern.exec(e||"");if(t)return t;throw new SyntaxError("Invalid WWW-Authenticate header:\n"+e)}function Zt(e,t){function r(){var t;if(!n.enabled()){t=v("CommandDisabled",{reason:n.enabled.reason});if(xt(e))return jt().reject(t).promise;throw t}return e.apply(this,arguments)}function i(){return"[Command: enabled = "+n.enabled()+"]"}function s(e){return Zt(function(){return n.apply(e,arguments)},n.enabled)}var n=r;return U(n,{constructor:Zt,enabled:t&&t.asReadOnly(),bind:s,toString:i})}function en(e){return U(e,{constructor:Zt,toString:function(){return"[Command: enabled = true]"},enabled:on(!0)})}function tn(e){return e!==void 0?Zt(function(){},on(!1,e)):(tn.instance||(tn.instance=Zt(function(){},on(!1))),tn.instance)}function nn(e){return e!==void 0?Zt(Pt(function(){}),on(!1,e)):(nn.instance||(nn.instance=Zt(Pt(function(){}),on(!1))),nn.instance)}function rn(e,t){var n=0;return function(){var r=!1;return n++,n==1&&e&&e(),{dispose:function(){if(r)throw v("AlreadyDisposed");r=!0,n--,n==0&&t&&t()}}}}function sn(e){function s(e,n){return arguments.length==0?t._value:(t._write(e,n),this)}var t=s,n=e&&e.get,r=e&&e.set,i=e&&e.readOnly;return e&&e.value!==void 0&&(t._value=e.value),e&&e.reason!==void 0&&(t.reason=e.reason),e&&e.check&&(t._check=e.check),n&&(t._getter=Pt(n)),i&&(t._ro=t),r&&(t._setter=Pt(r,"sync")),e&&e.subscribed&&(t._subscribed=e.subscribed),e&&e.unsubscribed&&(t._unsubscribed=e.unsubscribed),L(t,sn.prototype),U(t,{get:kt(n)?Zt(t._getAsync,n.enabled):en(t._getAsync),set:i?nn():kt(r)?Zt(t._setAsync,r.enabled):en(t._setAsync)}),Object.defineProperty(t,"changed",{get:t._getChanged,set:function(e){t._getChanged(),t._changed.observer=e}}),t}function on(e,t){if(t===void 0){if(e===null)return sn["null"];if(e===!0)return sn["true"];if(e===!1)return sn["false"]}return sn({value:e,reason:t,readOnly:!0})}function an(e,t){var n=sn();return n(e,t),n.inc=function(){n(n()+1)},n.dec=function(){n(n()-1)},n}function fn(e,t){var n=sn();return n(e,t),n}function ln(e){function r(e){return arguments.length==0?t._asArray():ft(e)?(t.empty(),t._addArray(e),this):t._getFromCache(e)}var t=r,n=t._=U({},e);return e&&e.get&&(n.get=Pt(e.get)),n.vals=[],n.keys=[],n.idxs={},L(t,ln.prototype),t._init(),t}function cn(e){function o(t,n){N(!r[t]),N(t>e),N(pt(n)),r[t]=Pt(n)}function u(e){C(e>=n(),"InvalidTargetState",{currentTarget:n(),requestedTarget:e});if(e==t())return;return e>n()&&(i=jt("advancing to target state "+e,{cancel:a}),n.set(e),f(i)),i.promise}function a(e){s.cancel(e),s=null}function f(e){if(s)return;var i=t()+1;e.status("advancing to state "+i),s=r[i].call(null),s.then(function(r){s=null,t.set(i),t()<n()?f(e):e.resolve(r)},function(t){s=null,e.reject(t)})}var t=sn({value:e}),n=sn({value:e}),r={},i,s;return{defineState:o,advanceTo:Pt(u),state:t.asReadOnly(),target:n.asReadOnly()}}function hn(e,t){function a(){N(n<=t);while(n<t&&r.length>0)f()}function f(){var t=r.splice(0,1)[0],f=s[t],l=i[t];delete s[t],delete i[t],o.splice(0,1),n++,u[t]=e(f),u[t].then(function(e){l.resolve(e)},function(e){l.reject(e)},l.status).then(function(){n--,delete u[t],a()})}function l(e,t){var n=o.length;while(n>0&&t>o[n-1])n--;o.splice(n,0,t),r.splice(n,0,e)}function c(e,t){var n;if(u[e])u[e].cancel(t);else{i[e].reject(t),delete s[e],delete i[e];for(n=0;n<r.length;n++)if(r[n]==e){r.splice(n,1),o.splice(n,1);break}}}N(pt(e)),N(t>0),e=Pt(e);var n=0,r=[],i={},s={},o=[],u={};return function(e,t){var n=X(),r=jt("Waiting in the throttling queue.",{cancel:B(c,n)});return i[n]=r,s[n]=e,l(n,t),a(),r.promise}}function pn(e){N(pt(e));var t=null;return function(){return t||(t=e())}}function dn(e,t){function i(e,t,r){N(ht(e)),N(r instanceof jt);var i=0;while(i<n.length&&e>n[i].priority)i++;n.splice(i,0,{priority:e,request:t,task:r})}function o(e){N(e>0),N(n.length>0);var t,r=[],i=[];for(t=n.length-1;t>=0&&r.length<e;t--)r.push(n[t].request),i.push(n[t].task);return n.splice(t+1,e),{requests:r,tasks:i}}function u(e,t){var r;for(r=0;r<n.length;r++)if(n[r].task===e)break;r<n.length?(n.splice(r,1),e.reject(t)):(e.cancelled=!0,e.reject(t))}function a(){function r(e){J(n.tasks,function(t,n){t.cancelled||e(t,n)})}var n=o(t);jt.wait(e(n.requests)).then(function(e){r(function(t,n){var r=ft(e)?e[n]:e;jt.wait(r).then(function(e){t.resolve(e)},function(e){t.reject(e)},t.status)})},function(e){r(function(t){t.reject(e)})},function(e){r(function(t){t.status(e)})})}N(t>0);var n=[],r;return function(e,t){var o=jt("Waiting in the batching queue.",{cancel:function(e){u(o,e)}});return r||(r=s(function(){r=null;while(n.length>0)a()},0)),i(t,e,o),o.promise}}function gn(e){function t(e){N(ct(e));var t=e.split("\r\n"),n,r,s,o;for(var u=0;u<t.length;u++)if(o=$(t[u]))n=o.indexOf(":"),n>=0&&(r=$(o.substr(0,n)),s=$(o.substr(n+1)),i(r,s))}function n(e){N(at(e));for(var t in e)i(t,e[t]+"")}function r(e){return N(vt(e)),o[e.toLowerCase()]}function i(e,t){N(vt(e)),N(vt(t)),e=e.toLowerCase(),o[e]?o[e]+="\n"+t:o[e]=t}function s(){var e,t,n,r="";for(t in o){n=o[t].split("\n");for(e=0;e<n.length;e++)n[e]&&(r+=t+": "+n[e]+"\r\n")}return r+"\r\n"}var o={};return vt(e)?t(e):at(e)&&n(e),{get:r,add:i,toString:s}}function yn(e){var t=Kt("data:"+e.replace(/\s/g,"")+",");return{mimeType:t.mime,attributes:t.attributes}}function bn(e){if(!e)return e;var t=/\d+/.exec(e);return new u(t&&+t[0])}function wn(e){return e?"/Date("+ +e+")/":e}function En(e,t){function n(e,t){for(var n=0;n<e.length;n++)if(j(t,e[n])<0)return!1;return!0}return n(e,t)&&n(t,e)}var n=null;try{n=window}catch(r){}!n&&global&&(global.window=global);var i=window.ttt?ttt.window:window,s=i.setTimeout,o=i.clearTimeout,u=i.Date,a=i.Math,f=i.console,l=i.performance&&i.performance.now?function(){return performance.now()}:function(){return u.now()};i=null;var c=typeof SkypeWebTests!="undefined",h=k("async"),p=z("Skype.Web.Utils",{replacePrototype:!0}),d={log:function(){if(!c)try{f.log.apply(f,arguments)}catch(e){}}};(function(e){function t(n,r){if(r instanceof RegExp)e(r.test(n),"DoesNotMatchPattern",{value:n,pattern:r});else if(r&&!t(n,r)){debugger;throw m(n,r)}}function n(e,n){J(n,function(n,r){var i=e&&e[r];if(!t(i,n)){debugger;throw g(r,i,n)}})}e.is=t,e.args=n})(N||(N={})),function(e){function t(e,t){if(e!=t)throw y(e,t)}function n(e,t){if(ft(t)){if(j(t,e)==-1)throw w(e,t)}else if(e!=t)throw w(e,t)}function r(e,t){if(!(e in t))throw E(e,t)}e.equals=t,e.state=n,e.belongs=r}(C||(C={}));var O=A();t.isPromise=Tt,t.isCollection=Nt,t.isProperty=Ct,t.isCommand=kt,function(e){e.types={String:ct,NotEmptyString:vt,Function:pt,Dictionary:at,Object:ut,Array:ft,Boolean:dt,Void:mt,Number:ht}}(Lt||(Lt={})),function(e){e.entities={lt:"<",gt:">",amp:"&",nbsp:" ",quot:'"'}}(Dt||(Dt={})),t.async=Pt;var Ht=function(){function e(t){function s(e,t){return n.on(e,t),pt(t)&&t(this),new Bt(n,e)}var n=s,r,i=t||{};return this instanceof e?(r=this,U(r,i),r._listeners=[],r._modes=[],r._locked=!1,r.observer=n,L(n,e.prototype.observer),n._event=r,r):new e(t)}return e}();t.event=Ht,U(Bt.prototype,{dispose:function(){this.event.off(this.listener)}}),Ht.prototype=function(){},U(Ht.prototype,{constructor:Ht,fire:function(){var e=this;if(e._enqueue(e,e._fire,arguments))return;e._fire.apply(e,arguments),e._dequeue()},_fire:function(){var e,t=this;for(e=0;e<t._listeners.length;e++)t._invoke(t._listeners[e],arguments,t._modes[e])},_invoke:function(e,t,n){var r=this;if(n=="async"&&!c)M.call(r,r.invoke,e,t,"sync");else try{e.apply(null,t)}catch(i){if(i!==r._ie){f&&f.log;debugger}}},_enqueue:function(e,t,n){var r=this;return r._locked?(r._queue=r._queue||[],r._queue.push([e,t,n])):r._locked=!0,r._queue&&r._queue.length>0},_dequeue:function(){var e,t=this;if(t._queue){while(e=t._queue.shift())e[1].apply(e[0],e[2]);t._queue=null}t._locked=!1},observed:function(){return this._listeners.length>0},observer:{toString:function(){var e=this._event._listeners.length;return"[Event"+(e?": "+e+" listener"+(e==1?"":"s"):"")+"]"},on:function(e,t){var n=this._event;if(n._enqueue(this,this._addListener,[e,t]))return;this._addListener(e,t),n._dequeue()},_addListener:function(e,t){var n=this._event;N(pt(e)),n.adding&&n.adding.call(n.context,e),n._listeners.push(e),n._modes.push(t),n.added&&n.added.call(n.context,e),n._listeners.length==1&&n.subscribed&&n.subscribed.call(n.context)},off:function(e){var t=this._event;if(t._enqueue(this,this._removeListener,[e]))return;this._removeListener(e),t._dequeue()},_removeListener:function(e){var t=this._event,n=j(t._listeners,e);n>=0&&(t._listeners.splice(n,1),t._modes.splice(n,1),t._listeners.length==0&&t.unsubscribed&&t.unsubscribed.call(t.context))}}}),t.task=jt,U(jt.prototype,{resolve:function(e){var t=this,n=t._;return C.state(n.state,"pending"),n.value=e,n.state="resolved",n.$state&&n.$state._set(n.state),n.promise.result=e,t._complete()},reject:function(e){var t=this,n=t._;return C.state(n.state,"pending"),n.value=e,n.state="rejected",n.$state&&n.$state._set(n.state),n.promise.error=e,t._complete()},_complete:function(){var e=this,t=e._;t.status(null);for(var n=0;n<t.leafs.length;n++)t.leafs[n]();return t.fnCancel=null,e}}),function(e){function t(e){this.task=e,Object.defineProperty(this,"state",{get:this._getState}),Object.defineProperty(this,"status",{get:this._getStatus})}e.Promise=t}(jt||(jt={})),t.task=jt,jt.Promise.prototype=st(Ft.prototype,{_getState:function(){var e=this.task._;return e.$state||(e.$state=sn({value:e.state,readOnly:!0})),e.$state},_getStatus:function(){var e=this.task._;return e.status.asReadOnly()},from:function(e){var t=this.task,n=t._;this.locked?this.target.from(e):(n.source=e,n.source.then(function(e){t.resolve(e)},function(e){t.reject(e)},n.status),n.fnCancel=function(e){n.source.cancel(e)},n.source.locked&&(n.source.target=this))},cancel:function(e){var t=this.task,n=t._;C.state(n.state,"pending"),n.fnCancel?n.fnCancel(e):t.reject(e)},then:function(e,t,n){function a(){i.status.changed.off(f);try{if(i.state=="resolved")s=pt(e)?e(i.value):i.value;else{if(!pt(t)){o.reject(i.value);return}s=t(i.value)}}catch(n){o.reject(n);return}At(s)?o.promise.from(jt.wait(s)):o.resolve(s)}function f(e,t){i.state=="pending"&&(o.status(e,t),pt(n)&&n(e,t))}function l(e){if(i.leafs.length<2)i.promise.cancel(e);else{F(i.leafs,j(i.leafs,u)),i.status.changed.off(f);try{pt(t)?o.promise.from(jt.wait(t(e))):o.reject(e)}catch(n){o.reject(n)}}}var r=this.task,i=r._,s,o=jt({cancel:l}),u=i.mode=="sync"?a:B(M,a);return i.state=="pending"?(i.status.changed(f),i.leafs.push(u)):u(),o.promise}}),function(e){function t(t){function s(e){J(t,function(t){try{t.cancel(e)}catch(n){}})}var n=t.length,r=e({cancel:s}),i=r.promise;return n==1?i=e.wait(t[0]):n==0?r.reject(Error()):J(t,function(e){e.then(function(e){n--,r&&(r.resolve(e),r=null,s(v("CompetingTaskResolved")))},function(e){n--,n||(r.reject(e),r=null)},function(){var e=it(t,function(e,t){return e.status()||"#"+t});r.status(e.join(" || "))})}),i}function n(t){function u(e){for(var n=0;n<t.length;n++)try{t[n].state()=="pending"&&t[n].cancel(e)}catch(r){debugger}}function a(){var e=it(o,function(e,t){return e.status()||"#"+t});i.status(Q(e).join(" && "))}var n=t.length,r=[],i=e({cancel:u}),s=i.promise,o={};return r.length=t.length,n==0?i.resolve([]):n==1?s=e.wait(t[0]).then(function(e){return[e]}):(J(t,function(n,r){o[r]=t[r]=e.wait(n)}),a(),J(t,function(e,t){e.then(function(e){r[t]=e,delete o[t],a(),n--,n||(i.resolve(r),i=null)},function(e){delete o[t],n--,i&&(i.reject(e),i=null,u(e))},a)})),s}e.waitAny=t,e.waitAll=n}(jt||(jt={})),t.task=jt,jt.wait=function(e,t){return Tt(e)?e:At(e)?Ft(B.call(e,e.then)):jt({mode:t}).resolve(e).promise},t.promise=Ft,U(Ft.prototype,{"catch":function(e){return this.then(null,e||function(){})},"finally":function(e){return this.then(function(t){return jt.wait(e()).then(function(){return t})},function(t){return jt.wait(e()).then(function(){throw t})})}}),U(It.prototype,{then:function(e){var t=this.exec;return It(function(n,r){var i=t(n,r);return i&&{res:e(i.res),pos:i.pos}})},select:function(e){return this.then(function(t){return t[e]})},merge:function(e){return this.then(function(t){return t.join(e||"")})},join:function(e,t){return this.then(function(n){var r,i={};for(r=0;r<n.length;r++)i[n[r][e]]=n[r][t];return i})},as:function(e){return this.then(function(t){var n,r={};for(n in e)r[n]=t[e[n]];return r})}}),function(e){function t(e){return encodeURIComponent(e).replace(/%20/gm,"+")}function n(e){return decodeURIComponent(e.replace(/\+/gm," "))}e.encodeData=t,e.decodeData=n,e.pattern=function(){var t=Rt(/[^()<>@,;:\\\x22/\[\]?=\s]+/),n=Wt(t,qt("/"),t).merge(),r=Rt(/[^\uffff]*/).then(e.decodeData),i=Jt(qt('"'),qt('"')),s=Wt(Rt(/\s*=\s*/),Xt(i,t)).select(1),o=Wt(Rt(/\s*;\s*/),t,Ut(s,!0));return Wt(qt("data:"),Ut(n),Vt(o).join(1,2),Rt(/\s*,\s*/),r).as({mime:1,attributes:2,data:4})}()}(Kt||(Kt={}));var Qt=function(){function e(t){if(!(ct(t)||t&&t.ast))throw new Error("Invalid argument: "+t);if(!(this instanceof e))return new e(t);var n,r;try{n=t.ast||e.pattern.exec(t);if(!n)throw void 0}catch(i){throw r=new SyntaxError("Invalid XML: "+t),r.reason=i,r}var s=n.attrs||{},o=(n.nodes||[]).map(function(t){return new e({ast:ct(t)?{text:t}:t})}),u=function(e,t){return e+t.text()},a=function(){return n.name},f=function(){return n.text||o.reduce(u,"")};this.attrs=s,this.nodes=o,this.name=a,this.text=f}return e.prototype.toString=function(){return"[object XmlNode]"},e.prototype.attr=function(e){return N(e in this.attrs,"Attribute does not exist: "+this.name()+"."+e),this.attrs[e]},e.prototype.selectOne=function(e,t){var n=K(this.nodes,pt(e)?e:function(n){var r,i;if(t)for(r in t){i=r.toLowerCase();if(t[i]!=n.attrs[i])return!1}return n.name()==e.toLowerCase()});return N(n.length==1,"Single node expected: "+e),n[0]},e}();Qt.pattern=function(){var e,t=Rt(/[\x00-\x20]*/),n=Rt(/\x22[^\x22]*\x22/).then(function(e){return e.slice(1,-1)}),r=Rt(/[^\s<>\x22]+/),i=Xt(n,r).then(Dt),s=Rt(/[^<]+/m).then(Dt),o=Rt(/[\w\d:-]+/).then(function(e){return e.toLowerCase()}),u=Wt(o,Ut(Wt(t,qt("="),t,i).select(3))),a=$t(u,t).join(0,1),f=Wt(qt("<"),t,o,t,a,t,qt(">")).as({name:2,attrs:4}),l=Wt(qt("<"),t,o,t,a,t,qt("/>")).as({name:2,attrs:4}),c=Wt(qt("</"),t,o,t,qt(">")).select(2),h=It(function(t,n){return e.exec(t,n)}),p=Wt(f,Vt(Xt(h,s)),c).then(function(e){if(e[0].name==e[2])return{name:e[2],nodes:e[1],attrs:e[0].attrs};throw new SyntaxError("</"+e[2]+"> does not match <"+e[0].name+">")});return e=Xt(p,l)}(),function(e){e.pattern=function(){var e=Rt(/[\s,]*/),t=Rt(/[^\s,=]+/),n=Jt(qt('"'),qt('"')),r=Wt(t,Rt(/\s*=\s*/),n),i=$t(r,e).join(0,2),s=Wt(t,e,i);return $t(s,e).join(0,2)}()}(Yt||(Yt={})),t.command=Zt,t.enabledCommand=en,t.disabledCommand=tn,function(e){}(tn||(tn={})),t.disabledCommand=tn,t.disabledAsyncCommand=nn,function(e){}(nn||(nn={})),t.disabledAsyncCommand=nn,t.property=sn,function(e){e.sUpdated={}}(sn||(sn={})),t.property=sn,sn.prototype=function(){},U(sn.prototype,{constructor:sn,toString:function(){return"[Property: value = "+this()+"]"},map:function(e){var t=this,n,r=sn({get:Zt(function(){return t.get().then(e)},t.get.enabled),subscribed:function(){n=t.subscribe()},unsubscribed:function(){n.dispose()}});return t.changed(function(t,n){r(e(t),n)}),r.asReadOnly()},when:function(e,t){function s(e,n,s){i(e)&&t.call(r,n,s)}var n=this.changed,r={dispose:function(){n.off(s)}},i=pt(e)?e:function(t){return t===e};return n(s),r},once:function(e,t){return this.when(e,function(){this.dispose(),t.apply(null,arguments)})},equals:function(e){return this.map(function(t){return t==e})},equalsAny:function(){var e=[].slice.call(arguments);return this.map(function(t){return Y(e,function(e){return e==t})})},fork:function(e){var t=this,n,r=e.enabled||on(!0),i=r===on(!1),s=sn({value:t(),reason:t.reason,readOnly:i,set:!i&&Zt(function(n,r){return Pt(e)(n,r).then(function(e){return t.set(e,r)})},r),get:t.get.bind(t),subscribed:function(){n=t.subscribe()},unsubscribed:function(){n.dispose()}});return(t._forks=t._forks||[]).push(s),s},asReadOnly:function(){var e=this;return e._ro||(e._ro=e.fork(nn())),e._ro},observed:function(){var e=this,t=e._changed;return t&&t.observed()},subscribe:function(){var e=this;return e.subscribe=rn(e._subscribed,e._unsubscribed),e.subscribe()}}),U(sn.prototype,{_set:function(e,t){var n=this,r=n._value,i,s=n._forks,o=n._changed;if(!Ot(e,r)||!Ot(t,n.reason)){n._value=e,n.reason=t,o&&o.fire(e,t,r);if(s)for(i=0;i<s.length;i++)s[i]._set(e,t)}return e},_getChanged:function(){var e=this;return e._changed||(e._changed=new Ht({context:e,added:e._listenerAdded})),e._changed.observer},_listenerAdded:function(e){var t=this,n=t._value,r=t.reason;n!==void 0&&e(n,r)},_getAsync:Pt(function(){var e=this,t=e._getter,n=e._value;return t?t.call(e,n,e.reason).then(function(t){return e._set(t,e.reason),e._value}):n}),_setAsync:Pt(function(e,t){var n=this,r=n._check,i=n._setter;return N(arguments.length>0),r&&r(e),i?i.call(n,e,t).then(function(e){return n._set(e,t)}):n._set(e,t)},"sync"),_write:function(e,t){var n=this,r=n._check,i=n._setter;r&&r(e);if(!n.set.enabled())throw Error("This is a read-only property.");i&&t!==sn.sUpdated?i.call(n,e,t).then(function(e){n._set(e,t)}):n._set(e,t)}}),t.constProperty=on;var un=sn;un["true"]=sn({value:!0,readOnly:!0}),un["false"]=sn({value:!1,readOnly:!0}),un["true"].get.enabled=un["true"],un["true"].set.enabled=un["false"],un["false"].get.enabled=un["true"],un["false"].set.enabled=un["false"],nn.instance.enabled=un["false"],un["null"]=sn({value:null,readOnly:!0}),t.numProperty=an,t.boolProperty=fn,t.collection=ln,ln.prototype=function(){},U(ln.prototype,{_init:function(){var e=this;Object.defineProperties(e,{added:{enumerable:!0,get:e._initAddedEvent,set:function(t){e._initAddedEvent(),e._.added.observer=t}},removed:{enumerable:!0,get:e._initRemovedEvent,set:function(t){e._initRemovedEvent(),e._.removed.observer=t}},changed:{enumerable:!0,get:e._initChangedEvent,set:function(t){e._initChangedEvent(),e._.changed.observer=t}},size:{enumerable:!0,get:e._initSizeProperty,set:function(t){e._initSizeProperty(),e._.size.observer=t}}})},_initAddedEvent:function(){var e=this,t=e._,n="added",r;return t[n]=t[n]||new Ht({context:e,adding:e._addedListenerAdding}),r=t[n].observer,r},_addedListenerAdding:function(e){var t=this,n=t._;J(n.vals,function(t,r){e(t,n.keys[r],r)})},_initRemovedEvent:function(){var e=this,t=e._,n="removed",r;return t[n]=t[n]||new Ht,r=t[n].observer,r},_initChangedEvent:function(){var e=this,t=e._,n="changed",r;return t[n]=t[n]||new Ht({added:e._changedListenerAdded}),r=t[n].observer,r},_changedListenerAdded:function(e){e()},_initSizeProperty:function(){var e=this,t=e._,n="size",r;return t[n]=t[n]||an(t.vals.length),r=t[n].asReadOnly(),r},subscribe:function(){var e=this,t=e._;return e.subscribe=rn(t.subscribed,t.unsubscribed),e.subscribe()},observed:function(){var e=this._,t=e.added,n=e.removed,r=e.changed;return t&&t.observed()||n&&n.observed()||r&&r.observed()},_insert:function(e,t,n){var r,i=this._,s=i.vals.length;for(r=n;r<s;r++)i.idxs[i.keys[r]]++;I(i.vals,n,e),I(i.keys,n,t),i.idxs[t]=n},add:function(e,t,n){var r=this._,i=r.vals.length;t=t||(r.key||X)(e);if(t in r.idxs)throw S(t);return n=gt(n)?n:i,n<0&&(n=0),n>i&&(n=i),this._insert(e,t,n),r.size&&r.size.inc(),r.added&&r.added.fire(e,t,n),r.changed&&r.changed.fire(),t},remove:function(e){var t=this._,n,r,i;gt(e)?(n=e,e=t.keys[n]):n=t.idxs[e],r=t.vals[n];if(n>=0&&n<t.vals.length){for(i=n+1;i<t.keys.length;i++)t.idxs[t.keys[i]]--;F(t.vals,n),F(t.keys,n),delete t.idxs[e],t.size&&t.size.dec(),t.removed&&t.removed.fire(r,e,n),t.changed&&t.changed.fire()}},_getFromCache:function(e){var t=this._;return ct(e)?t.vals[t.idxs[e]]:t.vals[e]},get:function(e){var t=this,n=t._.get,r=n&&n().then(function(e){return t._setNewItems(e)});return jt.wait(r).then(function(){return mt(e)?t._asArray():t._getFromCache(e)})},index:function(e){return this._.idxs[e]},key:function(e){return this._.keys[e]},_setNewItems:function(e){var t=this,n=t._,r;if(!at(e))return;for(r in n.idxs)(!(r in e)||n.vals[n.idxs[r]]!==e[r])&&t.remove(r);for(r in e)r in n.idxs||t.add(e[r],r)},empty:function(){var e=this._,t;if(e.removed)for(t=0;t<e.vals.length;t++)e.removed.fire(e.vals[t],e.keys[t]);e.vals=[],e.keys=[],e.idxs={},e.size&&e.size(0),e.changed&&e.changed.fire()},_addArray:function(e){for(var t=0;t<e.length;t++)this.add(e[t])},_asArray:function(){return this._.vals.slice(0)},asReadOnly:function(){function n(e){return arguments.length==0?t._asArray():t._getFromCache(e)}var e=n,t=this;return L(e,t),e._init(),e.add=null,e.remove=null,e.empty=null,e},fork:function(e){function r(e){return kt(e)?Zt(Pt(e),e.enabled):pt(e)?en(Pt(e)):nn(T())}function i(e){return arguments.length==0?n():n(e)}var t=i,n=this;return L(t,n),U(t,{add:r(e.add),remove:r(e.remove)}),t._init(),t},asWritable:function(e){return this.fork(e)}}),U(ln.prototype,{constructor:ln,toString:function(){return"[Collection: "+this.size()+" items]"},each:function(e){return this.added(e),this.added.off(e),this},contains:function(e){var t=!1;return this.each(function(n){e(n)&&(t=!0)}),t},observe:function(e){function u(e,t){r[t]=e,delete i[t],f()}function a(e,t){i[t]=e,delete r[t],f()}function f(){t||(t=s(function(){var n=r,s=i;r={},i={},t=null,e(n,s)},0))}function l(){t&&(o(t),t=null)}var t,n=this,r={},i={};return n.added(u),n.removed(a),{dispose:function(){l(),n.added.off(u),n.removed.off(a)}}},map:function(e){var t=this,n,r=ln({get:function(e){return t.get().then(function(){return r(e)})},subscribed:function(){n=t.subscribe()},unsubscribed:function(){n.dispose()}});return t.added(function(t,n,i){r.add(e(t),n,i)}),t.removed(function(e,t){r.remove(t)}),r.asReadOnly()},filter:function(e){var t=this,n,r=ln({get:function(e){return t.get().then(function(){return r(e)})},subscribed:function(){n=t.subscribe()},unsubscribed:function(){n.dispose()}});return t.added(function(n,i,s){var o,u,a;if(!e(n))return;o=s+1,u=t.size();while(o<u&&!e(t(o)))o++;a=o<u?r.index(t.key(o)):r.size(),r.add(n,i,a)}),t.removed(function(e,t){r.remove(t)}),r.asReadOnly()},sort:function(e){function i(t,n){return e(t,n)||!e(n,t)}var t=this,n,r=ln({get:function(e){return t.get().then(function(){return r(e)})},subscribed:function(){n=t.subscribe()},unsubscribed:function(){n.dispose()}});return t.added(function(e,n,s){var o=r.size(),u=0;while(u<o&&!i(e,r(u)))u++;while(u<o&&i(r(u),e)&&t.index(r.key(u))<s)u++;r.add(e,n,u)}),t.removed(function(e,t){r.remove(t)}),r.asReadOnly()}}),function(e){e.empty=e().asReadOnly()}(ln||(ln={})),t.collection=ln;var vn=function(){function e(t){function r(e){var t=function(t){return arguments.length==0?(n[e]||"")+"":(n[e]=(t||"")+"",this)};return t.toString=function(){return t()},t}var n;if(!(this instanceof e))return new e(t);n=e.pattern.exec((t||"")+"");if(!n)throw new SyntaxError("Invalid URI: "+t);this.scheme=r("scheme"),this.user=r("user"),this.host=r("host"),this.port=r("port"),this.path=r("path"),this.query=r("query"),this.hash=r("hash")}return e.prototype.toString=function(){function e(e,t){return t?e+t:""}var t=(this.user()?this.user()+"@":"")+(this.host()||"")+e(":",this.port());return(this.scheme()?this.scheme()+":":"")+e("//",t)+this.path()+e("?",this.query())+e("#",this.hash())},e}();vn.pattern={regexp:/^(?:([a-zA-Z][\w+-.]*):)?(?:\/\/(?:([^/@]*)@)?([^:/?#]*)(?:\:(\d*))?)?([^?#]*)(?:\?([^#]*))?(?:#(.*))?$/,exec:function(e){var t=this.regexp.exec(e);return t&&{scheme:t[1],user:t[2],host:t[3],port:t[4],path:t[5],query:t[6],hash:t[7]}}},function(e){var t=function(){function t(t){if(!(this instanceof e.Query))return new e.Query(t);var n=this;ct(t)?J(t.split("&"),function(e){var t,r,i=e.indexOf("=");i<0?(t=e,r=""):(t=e.slice(0,i),r=e.slice(i+1)),t&&(n[decodeURIComponent(t)]=decodeURIComponent(r))}):t&&J(ot(t),function(e,t){n[t]=e+""})}return t.prototype.toString=function(){var e=[];return J(ot(this),function(t,n){e.push(t?encodeURIComponent(n)+"="+encodeURIComponent(t):encodeURIComponent(n))}),e.join("&")},t}();e.Query=t}(vn||(vn={}));var mn={isInfo:B(bt,100,199),isSuccess:B(bt,200,299),isRedirection:B(bt,300,399),isClientError:B(bt,400,499),isServerError:B(bt,500,599),isError:B(bt,400,599),Unauthorized:401,ProxyAuthenticationRequired:407,ExpectationFailed:417,TooManyRequests:429,InternalServerError:500}}),define("jcafe-property-model",["jcafe-property-model/lib/propertyModel"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/signIn/parameterBuilder",["require","exports","lodash-compat","swx-enums"],e)}(function(e,t){function i(e){if(!n.isString(e.username))throw new Error("Username not defined");if(!n.isString(e.password))throw new Error("Password not defined");return{username:e.username,password:e.password,type:r.authType.Password}}function s(e){if(!n.isString(e.client_id))throw new Error("client_id not defined");return{client_id:e.client_id,type:r.authType.ImplicitOAuth}}function o(e){if(!n.isString(e.client_id))throw new Error("client_id not defined");if(!n.isString(e.skypetoken))throw new Error("skypetoken not defined");if(!n.isString(e.rps_token))throw new Error("rps_token not defined");if(!n.isNumber(e.expires_in))throw new Error("expires_in not defined");return{skypetoken:e.skypetoken,rps_token:e.rps_token,expires_in:e.expires_in,client_id:e.client_id,type:r.authType.ImplicitOAuth,site_name:e.site_name}}function u(e){if(!n.isString(e.displayName))throw new Error("DisplayName not defined");return{displayName:e.displayName,type:r.authType.Guest}}function a(e){if(!n.isFunction(e.getToken))throw new Error("getToken method is not defined");return{type:r.authType.Token,getToken:e.getToken,getExpiryTime:e.getExpiryTime}}var n=e("lodash-compat"),r=e("swx-enums");t.createPasswordSignInParameter=i,t.createImplicitOAuthSignInParameter=s,t.createTokenImplicitOAuthSignInParameter=o,t.createGuestSignInParameter=u,t.createTokenSignInParameter=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/signIn/handlers/token",["require","exports"],e)}(function(e,t){function n(e){return Promise.resolve(r(e))}function r(e){function t(){return e&&e.getExpiryTime&&typeof e.getExpiryTime=="function"?e.getExpiryTime()*1e3:undefined}if(e&&e.getToken)return{getToken:e.getToken,getExpiryTime:t};throw"Unknown signIn parameter"}t.handler=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/signIn/handlers/password",["require","exports"],e)}(function(e,t){function n(){return Promise.resolve(r())}function r(){return{getToken:function(){return!0},getExpiryTime:function(){return 0}}}t.handler=n}),function(){typeof SKYPE=="undefined"&&(window.SKYPE={}),SKYPE.linking=function(){var e={pre:"https://a.prelogin.skype.net",qa:"https://a.qalogin.skype.net",dogfood:"https://dogfood.login.skype.com",live:"https://a.login.skype.com"},t="/linking",n=null,r,i=null,s=!1,o="",u=!1,a={},f={env:"dogfood",theme:"skype-blue",client_id:null,redirect_uri:null,rps_token:null,setlang:null,welcome:!1,createTechnical:!1,microsoft:!0,hidden:!1,relink:!1,site_name:null},l=function(e){var t=["https://login.skype.com","https://prelogin.skype.net","https://qalogin.skype.net","https://a.pre.lw.skype.net","https://a.qa.lw.skype.net","https://a.lw.skype.com","https://a.prelogin.skype.net","https://a.qalogin.skype.net","https://a.login.skype.com"];return t.push(i),t.indexOf(e)!==-1},c=function(e){var t;if(!l(e.origin))return;var n=e.data;if(typeof n=="string")try{n=JSON.parse(e.data)}catch(r){}var i=n.state||null;if(o!==i)return;t={};for(var s in n)n.hasOwnProperty(s)&&(t[s]=n[s]);m(t)},h=function(e){return p(),n=document.createElement("iframe"),n.frameBorder=0,n.width="100%",n.height="100%",n.id="linkingFrame"+Math.floor(Math.random()*10+1),n.style.backgroundColor="#00AFF0",a.hidden&&(n.style.display="none"),n.setAttribute("src",e),n},p=function(){n&&(n.parentNode&&n.parentNode.removeChild(n),n=null)},d=function(){if(!a.client_id||!a.rps_token)throw"[linking.js] client_id not initialized. Call init() first.";if(a.createTechnical&&a.welcome)throw"[linking.js] cannot initialize both createTechnical and welcome flows at the same time.";a.redirect_uri||(a.redirect_uri=window.location.protocol+"//"+window.location.host+window.location.pathname)},v=function(){return"postMessage"in window&&typeof JSON=="object"&&JSON.parse},m=function(e){u=!1,typeof r=="function"&&r(e)},g=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},y=function(){var n,r=(new Date).getTime(),s;return i=e[a.env]||e.dogfood,o="linkingsdk_"+r,n={response_type:"postmessage",client_id:a.client_id,env:a.env,theme:a.theme,redirect_uri:a.redirect_uri,state:o},a.microsoft&&(n.partner="999"),a.setlang&&(n.setlang=a.setlang),a.relink&&(n.scenario="relink"),a.createTechnical&&(n.scenario="silentCreateTechnical"),a.welcome&&(n.scenario="welcome"),a.site_name&&(n.site_name=a.site_name),s=g(n)+"#access_token="+encodeURIComponent(a.rps_token),i+t+"?"+s},b=function(){a={},r=null,s=!1,o="",u=!1,window.addEventListener?window.removeEventListener("message",c):window.detachEvent("onmessage",c),p()},w=function(e){b();if(typeof e=="object"){e=e||{},e.hasOwnProperty("callback")&&E(e.callback);for(var t in f)e.hasOwnProperty(t)?a[t]=e[t]:a[t]=f[t]}return s||(s=!0,window.addEventListener?window.addEventListener("message",c):window.attachEvent("onmessage",c)),this},E=function(e){return typeof e=="function"&&(r=e),this},S=function(){if(u)return;d(),u=!0;if(!v()){m({error:"unsupported_browser"});return}return h(y())},x=function(e){var t=S();t&&e.appendChild(t)};return{init:w,setCallback:E,getIFrame:S,load:x}}()}(),define("swx-xco/lib/linking",function(){}),function(){typeof window.SKYPE=="undefined"&&(window.SKYPE={});var e=window.SKYPE;e.login=e.login||{},e.login.Silent=function(){function g(e,t){if(typeof t=="string")return e+" - "+t;if(typeof t!="object")return e;var n=[];for(var r in t)r==="skypetoken"?n.push(r+": "+"<HIDDEN>"):n.push(r+": "+JSON.stringify(t[r]));return e+=" - "+n.join(", "),e}function L(e,t){for(var n in e)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}var e={pre:"https://prelogin.skype.net",qa:"https://qalogin.skype.net",live:"https://login.skype.com"},t={pre:"https://a.pre.lw.skype.net",qa:"https://a.qa.lw.skype.net",live:"https://a.lw.skype.com"},n="/login/silent",r="1.0",i=null,s,o={},u={},a=2e4,f=null,l=null,c="",h=!1,p=!1,d=null,v={env:"live",client_id:null,redirect_uri:null,microsoft:!1,use_azure:!1},m=function(e,t){d===null&&(d=window.location.host.match(/^(pre|qa).*\.net$/)||document.cookie.indexOf("debug")>-1||window.location.search.indexOf("debug")>-1);if(!d)return;try{e="[silentlogin.js] - "+g(e,t)}catch(n){}},y=function(e){m("Received message from "+e.origin);if(!l||e.origin!==l)return;var t=e.data;if(typeof e.data=="string")try{t=JSON.parse(e.data)}catch(n){}m("Message data",t);var r=t.state||null;if(c!==r){m("State "+r+" doesn't match the last submitted state "+c);return}window.clearTimeout(f),u={};for(var i in t)t.hasOwnProperty(i)&&(u[i]=t[i]);x()},b=function(e){w(),typeof s=="undefined"&&(s=document.body||document.head||document.getElementsByTagName("head")[0]),i=document.createElement("iframe"),i.frameBorder=0,i.width="1px",i.height="1px",i.style.display="none",i.style.visibility="hidden",i.id="silentLoginFrame"+Math.floor(Math.random()*10+1),i.setAttribute("tabindex",-1),i.setAttribute("src",e),s.appendChild(i),m("Created iFrame: "+e)},w=function(){i&&(s.removeChild(i),i=null)},E=function(){if(!v.client_id)throw"[silentlogin.js] client_id not initialized. Call init() first.";v.redirect_uri||(v.redirect_uri=window.location.protocol+"//"+window.location.host+window.location.pathname)},S=function(){return"postMessage"in window&&typeof JSON=="object"&&JSON.parse},x=function(){m("Calling callback function",u),p=!1,typeof o=="function"&&o(u)},T=function(){w(),u={},u.error="timeout",x()},N=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},C=function(){var i=(new Date).getTime(),s=e;c="silentloginsdk_"+i;var o={response_type:"postmessage",client_id:v.client_id,redirect_uri:v.redirect_uri,state:c,_accept:r,_nc:i};return v.microsoft&&(o.partner="999",s=v.use_azure?t:e),l=s[v.env]||s.live,l+n+"?"+N(o)},k=function(e){return typeof e=="object"&&(e=e||{},e.hasOwnProperty("callback")&&A(e.callback),v=L(v,e)),h||(h=!0,window.addEventListener?window.addEventListener("message",y,!1):window.attachEvent("onmessage",y)),this},A=function(e){return typeof e=="function"&&(o=e),this},O=function(){if(p)return;E(),p=!0;if(!S()){u={error:"unsupported_browser"},x();return}window.clearTimeout(f),f=window.setTimeout(T,a),b(C())},M=function(){return u.skypetoken||null},_=function(){return u};return{init:k,setCallback:A,load:O,getSkypetoken:M,getFullResponse:_}}()}(),define("swx-xco/lib/silentlogin",function(){}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-xco/lib/index",["require","exports","./linking","./silentlogin"],e)}(function(e,t){e("./linking"),e("./silentlogin"),t.linking=SKYPE.linking,t.silentLogin=SKYPE.login.Silent}),define("swx-xco",["swx-xco/lib/index"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-log-tracer/lib/helpers",["require","exports"],e)}(function(e,t){function n(e){var t="",n=!1,r=function(e){return r=function(e){return n||e?(n=e,"\n"):" "},n=e,""};for(var s=2;s<e.length;s++){var o=e[s];if(typeof o=="string"||typeof o=="undefined")t+=r(!1)+o;else{var u=i(o);t+=r(u.length>200)+u}}return t}function r(){function e(e){return(e<10?"0":"")+e}var t=new Date,n=e(t.getHours()),r=e(t.getMinutes()),i=e(t.getSeconds());return n+":"+r+":"+i+":"+t.getMilliseconds()}function i(e){var t;try{typeof e=="undefined"?t="undefined":e instanceof Error?t=e.toString():t=JSON.stringify(e)||""}catch(n){t="!!!LOG TRACER ERROR!!!Unable to parse argument!!!"}return t}t.getFormattedMessage=n,t.getTimeOfDayString=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-log-tracer/lib/bufferingWriter",["require","exports","./helpers"],e)}(function(e,t){function r(e,t,n){return new i(e,t,n)}var n=e("./helpers");t.build=r;var i=function(){function e(e,t,r){function i(i,s,o){var u=(new Date).toUTCString(),a=o[0],f=o[1],l=n.getFormattedMessage(o),c="["+u+"]["+s+"]["+(f?f+"][":"")+a+"]"+" "+l,h=["["+u+"]",a+" -> "+l];f&&h.splice(1,0,"["+f+"]");if(e)try{e[i].apply(e,h)}catch(p){}t.addMessage(c),"error"===s&&r.addMessage(c)}this.supportsCorrelationId=function(){return!0},this.log=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];return i("log","log",e)},this.info=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];return i("info","info",e)},this.warn=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];return i("warn","warn",e)},this.error=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];return i("error","error",e)},this.debug=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];return i("log","debug",e)}}return e}()}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-log-tracer/lib/consoleWriter",["require","exports","./helpers"],e)}(function(e,t){function r(){var e={};return["error","warn","info","log"].forEach(function(t){Object.defineProperty(e,t,{get:function(){return console[t].bind(console,n.getTimeOfDayString())}})}),e.debug=function(){function r(e,t,n){var r=e.length,i=0,s=e.indexOf("\n",i);do{var o=Math.min(r,i+t);for(var u=o;s>=i&&s<u;o=s+1,s=e.indexOf("\n",s+1));n(e.substring(i,o)),i=o}while(i<r)}function f(e,t){var n=typeof e=="string"?e.length:0,r=s-t,o=typeof e=="string"&&e.indexOf("\n")!==-1;return i.accumulatedLength+=n,i.accumulatedLength>r||o?(i.accumulatedLength=0,!0):!1}var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];var i={accumulatedLength:0},s=1024,o=[n.getTimeOfDayString(),e[0]],u=o.reduce(function(e,t){return e+t.length+2},0),a=e.length;for(var l=1;l<e.length;l++)if(f(e[l],u)){a=l;break}console.log.apply(console,o.concat(Array.prototype.slice.call(e,1,a)));var c=a;for(var l=c;l<e.length;l++){var h=f(e[l],0);l>c&&(h||l===e.length-1)&&console.log.apply(console,Array.prototype.slice.call(e,c,l)),h&&(r(e[l],s,console.log.bind(console)),c=l+1)}},e}var n=e("./helpers");t.build=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-log-tracer/lib/telemetryWriter",["require","exports","lodash-compat","./helpers"],e)}(function(e,t){function i(e,t){var i={};return i.supportsCorrelationId=function(){return!0},["log","info","warn","debug"].forEach(function(t){i[t]=e?e[t]:n.noop}),i.error=function(){var n=[];for(var s=0;s<arguments.length;s++)n[s]=arguments[s];e&&e.error.apply(i,n);var o=r.getFormattedMessage(n),u=n[0],a=typeof n[1]!="undefined"?n[1]:"",f=typeof n[2]!="undefined"?n[2]:"",l={namespace:u,message:o,shortMessage:f,correlationId:a,level:"error"};t.send(l)},i}var n=e("lodash-compat"),r=e("./helpers");t.build=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-log-tracer/lib/messageBuffer",["require","exports"],e)}(function(e,t){function n(){var e,t,n={clear:function(){e=[],t=0},addMessage:function(n){t+=n.length,e.push(n)},toString:function(){return e.join("\n")}};return n.clear(),n}t.build=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-log-tracer/lib/nullLogger",["require","exports"],e)}(function(e,t){function n(){return new r}t.build=n;var r=function(){function e(){}return e.prototype.log=function(){},e.prototype.info=function(){},e.prototype.warn=function(){},e.prototype.error=function(){},e.prototype.debug=function(){},e.prototype.createChild=function(){return this},e.prototype.supportsCorrelationId=function(){return!1},e}()}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-log-tracer/lib/decoratingLogger",["require","exports","lodash-compat"],e)}(function(e,t){function r(e,t,i,s){function u(e){return typeof e.supportsCorrelationId=="function"&&e.supportsCorrelationId()}function a(e){return typeof e=="function"?e():e}var o={};return["error","warn","info","log"].forEach(function(n){Object.defineProperty(o,n,{get:function(){return u(e)?e[n].bind(e,t(),a(i)):e[n].bind(e,t())}})}),s?Object.defineProperty(o,"debug",{get:function(){return u(e)?e.debug.bind(e,t(),a(i)):e.debug.bind(e,t())}}):o.debug=n.noop,o.createChild=function(n,o,u){var a=typeof n=="function"?function(){return t()+"::"+n()}:function(){return t()+"::"+n};return typeof u=="undefined"&&(u=s),typeof o=="undefined"&&(o=i),r(e,a,o,u)},o}var n=e("lodash-compat");t.build=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-log-tracer/lib/telemetryReporter",["require","exports","lodash-compat"],e)}(function(e,t){function r(){var e={send:n.noop,update:function(t){var r=t.reporting.telemetryManager,i=t.reporting.telemetryToken,s=t.reporting.throttleInterval;r&&i?e.send=n.throttle(function(e){r.sendEvent(i,"logging",e)},s,{trailing:!1}):e.send=n.noop}};return e}var n=e("lodash-compat");t.build=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-log-tracer/lib/api",["require","exports","lodash-compat","./bufferingWriter","./consoleWriter","./telemetryWriter","./messageBuffer","./nullLogger","./decoratingLogger","./telemetryReporter","swx-browser-globals"],e)}(function(e,t){function g(){return{all:c.toString(),error:h.toString()}}function y(){c.clear(),h.clear()}function b(e,t,n){function u(){var o,u=function(){return e};if(v.logToBuffer){var f=v.logToConsole?console:null;o=r.build(f,c,h)}else v.logToConsole&&(o=i.build());return v.reporting.enabled&&(o=s.build(o,d)),o?a.build(o,u,t,n):p}function f(e){return function(){return o||(o=u()),o[e]}}var o;return Object.create(Object.prototype,{log:{get:f("log")},info:{get:f("info")},warn:{get:f("warn")},error:{get:f("error")},debug:{get:f("debug")},createChild:{get:f("createChild")}})}function w(e){v={logToConsole:!1,logToBuffer:!1,logUnhandled:!1,reporting:{enabled:!1,throttleInterval:1e4,telemetryManager:null,telemetryToken:null}},n.merge(v,e),d.update(v),E()}function E(){m&&(l.getWindow().removeEventListener("error",S),m=null),v.logUnhandled&&(m=b("Unhandled Exceptions"),l.getWindow().addEventListener("error",S))}function S(e){try{m.error(JSON.stringify(e.error,["message","arguments","type","name","stack"]))}catch(t){m.error("Error: "+e)}}var n=e("lodash-compat"),r=e("./bufferingWriter"),i=e("./consoleWriter"),s=e("./telemetryWriter"),o=e("./messageBuffer"),u=e("./nullLogger"),a=e("./decoratingLogger"),f=e("./telemetryReporter"),l=e("swx-browser-globals"),c=o.build(),h=o.build(),p=u.build(),d=f.build(),v,m;t.getLogs=g,t.clearLogs=y,t.getLogger=b,t.configure=w,w()}),define("swx-log-tracer",["swx-log-tracer/lib/api"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("jskype-settings-instance/lib/index",["require","exports","swx-log-tracer"],e)}(function(e,t){function i(e){return t.settings.featureFlags?Boolean(t.settings.featureFlags[e]):(r.warn("No feature flags set on settings, checking feature "+e),!1)}var n=e("swx-log-tracer"),r=n.getLogger("[jskype-settings]");t.settings={flagsApiUrl:"",featureFlags:{},userOptionsService:{host:"",optionsEndpoint:""},contactsProxyService:{},stratusService:{host:"",avatarUrl:"",retry:null},abchUserWebService:{host:"",appId:"",settingsEndpoint:""},profileService:{appId:"",profileEndpoint:""},avatarService:{host:"",contactAvatarEndpoint:"",publicAvatarEndpoint:""},serviceQosReporter:{iterationCountBeforeFlushingQoSMetrics:0},telemetry:{jSkypeTenantToken:"",chatTenantToken:"",trouterTenantToken:"",mdscToken:"",skypeConcoreToken:"",issueReportUrl:""},sessionId:"",platformId:"",ecsClientCobrandTag:"",environment:""},t.isFeatureOn=i}),define("jskype-settings-instance",["jskype-settings-instance/lib/index"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/signIn/handlers/implicitOAuth",["require","exports","lodash-compat","swx-xco","jskype-settings-instance","swx-constants"],e)}(function(e,t){function f(e){var t;return l(e)?t=c(e):t=p(e),t}function l(e){return!!e.skypetoken&&!!e.expires_in&&!!e.rps_token}function c(e){var t=Promise.resolve(v(n.clone(e)));return h(e),t}function h(e){delete e.skypetoken,delete e.expires_in,delete e.rps_token,delete e.site_name}function p(e){var t=0,n=new Promise(function(n,o){function f(e){t++;if(e&&e.skypetoken){a=a.filter(function(e){return e!==f});var s=v(e,t);n(s)}else if(t<i.settings.maxSilentLoginRetries&&(!e||e.error!==u))r.silentLogin.load();else{a=a.filter(function(e){return e!==f});var s=e||{error:"unknown_error"};s.retryCount=t,o(s)}}r.silentLogin.init({env:i.settings.xcoEnv,client_id:e.client_id,clientVersion:i.settings.uiVersion,microsoft:!0,use_azure:i.isFeatureOn(s.COMMON.featureFlags.USE_AZURE_BASED_SILENT_LOGIN)}),r.silentLogin.setCallback(d),a.push(f),r.silentLogin.load()});return n}function d(e){a.forEach(function(t){t(e)})}function v(e,t){function i(){return e.skypetoken}function s(){var t=e.expires_in;if(n.isNumber(t))return r+m(t);var i=parseInt(t);return i?r+m(i):r+m(o)}function u(){return e.rps_token}function a(){return e.site_name}function f(){return t||0}var r=Date.now();return{getToken:i,getExpiryTime:s,getRpsToken:u,getSiteName:a,getRetryCount:f}}function m(e){return e*1e3}var n=e("lodash-compat"),r=e("swx-xco"),i=e("jskype-settings-instance"),s=e("swx-constants"),o=3600,u="invalid_grant",a=[];t.handler=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/signIn/handlers",["require","exports","swx-enums","./handlers/token","./handlers/password","../../modelHelpers/signIn/handlers/implicitOAuth"],e)}(function(e,t){var n=e("swx-enums"),r=e("./handlers/token"),i=e("./handlers/password"),s=e("../../modelHelpers/signIn/handlers/implicitOAuth"),o={};return o[n.authType.Token]=r.handler,o[n.authType.Password]=i.handler,o[n.authType.ImplicitOAuth]=s.handler,o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/telemetry/people/skypeTokenFetched",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","swx-constants"],e)}(function(e,t){var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("swx-constants"),s=i.COMMON.telemetry.skypeTokenEvent.TYPE,o=i.COMMON.telemetry.NOT_AVAILABLE,u=function(){function e(){this.startTime=Date.now(),this.published=!1,this.reauth=!1}return e.prototype.publish=function(e,t,i,u){if(this.published)return;var a={authType:e,success:t,message:u||o,retryCount:i||o,reauth:this.reauth,ttc:Date.now()-this.startTime};n.get()._telemetryManager.sendEvent(r.settings.telemetry.jSkypeTenantToken,s,a),this.published=!0},e.updateIfNeeded=function(t){return!t||t.published?new e:t},e}();t.__esModule=!0,t["default"]=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/electron",["require","exports","swx-browser-globals"],e)}(function(e,t){function r(){return n.getWindow().Skype.getSkypeModule()}function i(e,t){return n.getWindow().Skype.registerPresence(e,t)}function s(){return n.getWindow().Skype&&n.getWindow().Skype.refreshAuthentication}function o(){return s()?n.getWindow().Skype.refreshAuthentication().then(function(e){return Promise.resolve({token:e})}):Promise.reject("")}var n=e("swx-browser-globals");t.getSkypeModule=r,t.registerPresence=i,t.isRefreshAuthenticationAvailable=s,t.refreshAuthentication=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/signIn/skypeTokenManager",["require","exports","jcafe-property-model","./handlers","swx-enums","../../telemetry/people/skypeTokenFetched","../../services/electron"],e)}(function(e,t){function h(e){return new c(e)}var n=e("jcafe-property-model"),r=e("./handlers"),i=e("swx-enums"),s=e("../../telemetry/people/skypeTokenFetched"),o=e("../../services/electron"),u=6e5,a=!0,f=!1,l,c=function(){function e(e){function p(){return t&&!v()?m():b(c)}function d(){return o.isRefreshAuthenticationAvailable()?o.refreshAuthentication():(l=s["default"].updateIfNeeded(l),l.reauth=!0,b(i.authType.ImplicitOAuth))}function v(){return c===i.authType.ImplicitOAuth?Date.now()>=t.getExpiryTime()-u:!1}function m(){var e={token:t.getToken?t.getToken():undefined,expiration:t.getExpiryTime?t.getExpiryTime():undefined};return c===i.authType.ImplicitOAuth&&(e.rpsToken=t.getRpsToken(),e.siteName=t.getSiteName()),e}function g(e){w(e),this.resolve(m()),l.publish(c,a,e.getRetryCount&&e.getRetryCount())}function y(e){this.reject(e),e=e||{},l.publish(c,f,e.retryCount,e.error)}function b(t){var i=r[t],o=n.task();return t&&i?(l=s["default"].updateIfNeeded(l),i(e).then(g.bind(o),y.bind(o))):o.reject("Unknown sign in parameters"),o.promise}function w(e){e&&(t=e)}e=e||{};var t,c=e.type||null,h=n.property({get:p});this.get=h.get.bind(h),this.check=d}return e}();t.build=h}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("jskype-constants/lib/calling",["require","exports"],e)}(function(e,t){t.__esModule=!0,t["default"]={eventProperties:{PluginVersion:"plugin_version"}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("jskype-constants/lib/common",["require","exports"],e)}(function(e,t){t.__esModule=!0,t["default"]={contentTypes:{FORM_URL_ENCODED:"application/x-www-form-urlencoded",JSON_V1_0:"application/json; ver=1.0",JSON_V2_0:"application/json; ver=2.0",JSON_V3_0:"application/json; ver=3.0"}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("jskype-constants/lib/data",["require","exports"],e)}(function(e,t){function n(e){return new RegExp("^"+e+"\\|")}var r="contactPresence";t.__esModule=!0,t["default"]={storageKeys:{ENDPOINT_ID:"endpointId",SKYPE_ID_REG_TOKEN:"skypeIdRegistrationToken",PRESENCE_DATA:"presenceData",RESURECTION_KEY:"isResurected",CONTACT_PROFILES:"contacts",CONTACT_PRESENCE:r,CONTACT_LIST_ETAG:"etagContacts",CONTACTS_RAW_VIEW_ETAG:"etagContactsRawView",CONTACTS_RAW_VIEW_DATA:"contactsRawViewData",CALLING_DEVICES:"callingDevices"},storageKeyRegExp:{CONTACT_PRESENCE:n(r),CONVERSATION:n("conv")}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("jskype-constants/lib/events",["require","exports"],e)}(function(e,t){t.__esModule=!0,t["default"]={actions:{subscriptionCreation:"subscriptioncreation",getUserPresence:"getuserpresence",setUserPresence:"setuserpresence",getSelfProperties:"getselfproperties",messageSubmitted:"messagesubmitted"},contacts:{CONTACTS_LOADED:"contactsLoaded"},resourceTypes:{USER_PRESENCE:"userpresence"}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("jskype-constants/lib/featureFlags",["require","exports"],e)}(function(e,t){t.__esModule=!0,t["default"]={PLUGIN_AUTO_UPDATE:"pluginAutoUpdate",CREDIT_BALANCE_AUTO_UPDATE_ENABLED:"creditBalanceAutoUpdateEnabled"}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("jskype-constants/lib/people",["require","exports"],e)}(function(e,t){t.__esModule=!0,t["default"]={SELF:"self",SUGGESTED_CONTACT_ACTIVITY_MESSAGE:"Skype",batch:{MAX_ITEMS:100,MAX_DELAY:500},contactList:{retry:{TIMEOUT:3e4}},endpoints:{MOBILE:"isMobile"},authorizationStates:{UNKNOWN:"UNKNOWN",UNAUTHORIZED:"UNAUTHORIZED",PENDING_OUTGOING:"PENDING_OUTGOING",PENDING_INCOMING:"PENDING_INCOMING",AUTHORIZED:"AUTHORIZED",SUGGESTED:"SUGGESTED"}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("jskype-constants/lib/index",["require","exports","./calling","./common","./data","./events","./featureFlags","./people"],e)}(function(e,t){var n=e("./calling");t.CALLING=n["default"];var r=e("./common");t.COMMON=r["default"];var i=e("./data");t.DATA=i["default"];var s=e("./events");t.EVENTS=s["default"];var o=e("./featureFlags");t.FEATURE_FLAGS=o["default"];var u=e("./people");t.PEOPLE=u["default"]}),define("jskype-constants",["jskype-constants/lib/index"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/utils/batch",["require","exports","jskype-constants"],e)}(function(e,t){function o(e){return e?new s(e):null}var n=e("jskype-constants"),r=n.PEOPLE.batch.MAX_ITEMS,i=n.PEOPLE.batch.MAX_DELAY,s=function(){function e(e){this.items=[],this.callback=e}return e.prototype.add=function(e){window.clearTimeout(this.timerId),this.items.push(e),this.items.length>=r?this.releaseBatch():this.timerId=window.setTimeout(this.releaseBatch.bind(this),i)},e.prototype.clear=function(){window.clearTimeout(this.timerId),this.items=[]},e.prototype.releaseBatch=function(){this.callback(this.items),this.items=[]},e}();t.Batch=s,t.create=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/propertyModelHelper",["require","exports","jcafe-property-model"],e)}(function(e,t){function r(e){function n(e,t){var n;for(n=0;n<e.size();++n)if(t(e(n)))return n;return-1}var t=e.asReadOnly();return t._add=e.add,t._remove=e.remove,t._removeAll=e.empty,t._removeByCondition=function(t){var r=n(e,t);r>=0&&e.remove(r)},t}function i(e,t,r){var i=n.property({value:!!r}),s=n.command(t,i),o=n.property({value:e,set:s});return o.set._enabled=i,o}function s(e,t){var r=n.command(e,t);return r._enabled=t,r}function o(e){var t=n.task();return t.resolve(e),t.promise}function u(e){var t=n.task();return t.reject(e),t.promise}function a(e,t){return function(){return t()?u():e()}}var n=e("jcafe-property-model");t.exposeReadOnlyCollection=r,t.createPropertyWithSetter=i,t.createCommandWithSetter=s,t.createResolvedPromise=o,t.createRejectedPromise=u,t.createCancellablePromiseFunction=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-mri/lib/mriMaps",["require","exports","lodash-compat"],e)}(function(e,t){var n=e("lodash-compat"),r;(function(e){e.agent="28",e.lync="2",e.msn="1",e.skype="8",e.pstn="4"})(r=t.contactMriTypes||(t.contactMriTypes={}));var i;(function(e){e.agent="agent",e.lync="lync",e.msn="msn",e.skype="skype",e.pstn="pstn"})(i=t.contactTypeNames||(t.contactTypeNames={})),t.contactTypes={},t.contactTypes[i.agent]=r.agent,t.contactTypes[i.lync]=r.lync,t.contactTypes[i.msn]=r.msn,t.contactTypes[i.skype]=r.skype,t.contactTypes[i.pstn]=r.pstn,t.contactTypesByCode=n.invert(t.contactTypes)}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-i18n/lib/plurals",["require","exports"],e)}(function(e,t){function a(e,t){t||(t=u);var s=null,a="";for(var f in o)o[f].languages.indexOf(t)!==-1&&(s=f);switch(s){case"group0":a=e===1?n:r;break;case"group1":a=e===1?n:i;break;case"group2":a=e>1?i:n;break;case"group3":a=e%10===1&&e%100!==11?n:e===0?r:i;break;case"group4":a=e===1||e===11?n:e===2||e===12?r:i;break;case"group5":a=e===1?n:e===0||e%100>0&&e%100<20?r:i;break;case"group6":a=e%10===1&&e%100!==11?n:e%10>=2&&(e%100<10||e%100>=20)?i:r;break;case"group7":a=e%10===1&&e%100!==11?n:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?r:i;break;case"group8":a=e===1?n:e>=2&&e<=4?r:i;break;case"group9":a=e===1?n:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?r:i;break;case"group11":a=e===1?n:e>=2&&e<=10?r:i;break;case"group12":a=e===1?n:e===2?r:i;break;default:a=""}return a}function f(e){u=e}var n="",r="_few",i="_many",s={af:"af",am:"am",ar:"ar",as:"as",az:"az",be:"be",bg:"bg",bn:"bn",bs:"bs",chr:"chr",ca:"ca",cs:"cs",cy:"cy",da:"da",de:"de",el:"el",en:"en",es:"es",et:"et",eu:"eu",fa:"fa",fi:"fi",fil:"fil",fr:"fr",ga:"ga",gd:"gd",gl:"gl",gu:"gu",ha:"ha",he:"he",hi:"hi",hr:"hr",hu:"hu",hy:"hy",id:"id",ig:"ig",is:"is",it:"it",iw:"iw",ja:"ja",ka:"ka",kk:"kk",km:"km",kn:"kn",ko:"ko",kok:"kok",ku:"ku",ky:"ky",lb:"lb",lt:"lt",lv:"lv",mi:"mi",ml:"ml",mn:"mn",mr:"mr",ms:"ms",ne:"ne",nl:"nl",nn:"nn",nb:"nb",no:"no",nso:"nso",or:"or",pa:"pa",pl:"pl",prs:"prs",pt_br:"pt-br",pt_pt:"pt-pt",qps:"qps",qut:"qut",quz:"quz",ro:"ro",ru:"ru",rw:"rw",sd:"sd",si:"si",sl:"sl",sk:"sk",sq:"sq",sr:"sr",sv:"sv",sw:"sw",ta:"ta",te:"te",tg:"tg",th:"th",ti:"ti",tk:"tk",tn:"tn",tr_tr:"tr-tr",tt:"tt",ug:"ug",uk:"uk",ur:"ur",uz:"uz",vi:"vi",wo:"wo",xh:"xh",yo:"yo",zh:"zh",zu:"zu"},o={group0:{languages:[s.ja,s.id,s.ko,s.tr_tr,s.vi,s.zh,s.az,s.ig,s.fa,s.ka,s.km,s.kn,s.ms,s.prs,s.th,s.tt,s.ug,s.wo,s.yo]},group1:{languages:[s.bg,s.ca,s.cy,s.da,s.de,s.el,s.en,s.es,s.et,s.fi,s.he,s.hu,s.it,s.iw,s.nb,s.nl,s.no,s.pt_pt,s.qps,s.sv,s.af,s.as,s.bn,s.chr,s.eu,s.gl,s.gu,s.ha,s.hy,s.is,s.kk,s.kok,s.ku,s.ky,s.lb,s.mi,s.ml,s.mn,s.mr,s.ne,s.nn,s.or,s.pa,s.qut,s.quz,s.rw,s.sd,s.si,s.sq,s.sw,s.ta,s.te,s.tk,s.tn,s.ur,s.xh,s.zu]},group2:{languages:[s.fr,s.pt_br,s.am,s.fil,s.hi,s.nso,s.tg,s.ti,s.uz]},group3:{languages:[s.lv]},group4:{languages:[s.gd]},group5:{languages:[s.ro]},group6:{languages:[s.lt]},group7:{languages:[s.ru,s.uk,s.hr,s.sr,s.be,s.bs,s.sl]},group8:{languages:[s.cs,s.sk]},group9:{languages:[s.pl]},group11:{languages:[s.ga]},group12:{languages:[s.ar]}};t.pluralizationLocale=s;var u=s.en;t.getPluralSuffix=a,t.setLocale=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-i18n/lib/resources",["require","exports","lodash-compat"],e)}(function(e,t){function i(e){if(!e)throw new Error("[i18n / resources] Specified destination for localizations resources is not reachable")}function s(e){i(e),r=e}function o(e){i(e),r=n.merge(r,e)}function u(){return r}var n=e("lodash-compat"),r={};t.set=s,t.merge=o,t.get=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-i18n/lib/localization",["require","exports","./plurals","./resources"],e)}(function(e,t){function i(e){var t=r.get(),n=t&&t[e]||e;return n}var n=e("./plurals"),r=e("./resources");t.fetch=function(e){if(typeof e!="object")throw new Error("[i18n / localization] Argument must be type of object");var t=e.key,r,s,o,u;if(!t)throw new Error("[i18n / localization] Missing key");var a=i(t);e.count!==undefined&&(r=e.count,e.params=e.params||{},e.params.count=r,s=n.getPluralSuffix(r,e.locale),t+=s);if(e.params){a=i(t);for(o in e.params)if(e.params.hasOwnProperty(o)){u=e.params[o];if(typeof u=="function")throw new Error("[i18n / localization] Replacement value must not be a function");a=a.replace(new RegExp("{"+o+"}","g"),u)}}return a}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-i18n/lib/knockoutBindingExtensions",["require","exports","./localization"],e)}(function(e,t){function r(e){e.bindingHandlers.l10n={update:function(t,r,i,s,o){var u=e.utils.unwrapObservable(r()),a=u.params;for(var f in a)a.hasOwnProperty(f)&&typeof a[f]=="function"&&(a[f]=e.utils.unwrapObservable(a[f]()));var l=n.fetch(u);e.bindingHandlers.html.update(t,function(){return l},i,s,o)}},e.bindingHandlers.l10n_attr={update:function(t,r,i,s,o){function l(){var e={};return e[f]=a,e}var u=e.utils.unwrapObservable(r()),a,f;for(f in u)u.hasOwnProperty(f)&&(a=n.fetch({key:u[f]}),e.bindingHandlers.attr.update(t,l,i,s,o))}}}var n=e("./localization");t.init=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-i18n/lib/index",["require","exports","./knockoutBindingExtensions","./localization","./plurals","./resources"],e)}(function(e,t){var n=e("./knockoutBindingExtensions");t.knockoutBindingExtensions=n;var r=e("./localization");t.localization=r;var i=e("./plurals");t.plurals=i;var s=e("./resources");t.resources=s}),define("swx-i18n",["swx-i18n/lib/index"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-people/lib/lastSeenConverter",["require","exports","swx-i18n","swx-constants"],e)}(function(e,t){var n=e("swx-i18n"),r=e("swx-constants"),i=[{max:2,msg:"presence_lastseen_moments"},{max:59,msg:"presence_lastseen_minutes"},{max:1439,msg:"presence_lastseen_hours",recalculate:60},{max:10080,msg:"presence_lastseen_days",recalculate:1440}],s={SEVEN_DAYS:10080,TXT_DATE_SHORT:"presence_lastseen_date_short",TXT_DATE_FULL:"presence_lastseen_date_full"},o=r.COMMON.globalizationFormatKeys,u=function(){function e(e,t){this.dateTime=e,this.g11nFormatter=t}return e.prototype.getMessage=function(e){var t,r={};return typeof e!="number"?"":(this.isMoreThanOneWeek(e)?(t=this.toDate(e),this.isWithinThisCalendarYear(t)?(r.key=s.TXT_DATE_SHORT,r.params={shortdate:this.g11nFormatter.formatDate(t,o.date.DAY_MONTH)}):(r.key=s.TXT_DATE_FULL,r.params={fulldate:this.g11nFormatter.formatDate(t,o.date.DAY_MONTH_YEAR)})):r=this.getLastSeenTranslationOptions(e),n.localization.fetch(r))},e.prototype.toDate=function(e){return this.dateTime.getDate(this.dateTime.now()-e*6e4)},e.prototype.isWithinThisCalendarYear=function(e){return e.getFullYear()===this.dateTime.getDate(null).getFullYear()},e.prototype.isMoreThanOneWeek=function(e){return e>s.SEVEN_DAYS},e.prototype.getLastSeenTranslationOptions=function(e){var t={};for(var n=0;n<i.length;n++){var r=i[n];t={};if(e>r.max)continue;var s=r.recalculate!==undefined?Math.floor(e/r.recalculate):e;t.key=r.msg,t.params={number:s};break}return t},e}();t.__esModule=!0,t["default"]=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-people/lib/organizePersons",["require","exports","swx-utils-common","swx-i18n"],e)}(function(e,t){function i(e){var t,i=e.displayName()||e.id()||"",s=n.stringUtils.clean(n.stringUtils.normalize(i))[0];return n.stringUtils.isNotEmpty(s)?t=s.toUpperCase():t=r.localization.fetch({key:"message_bucketName_other"}),t}function s(e){var t={};return e.forEach(function(e){var n=i(e);t[n]||(t[n]=[]),t[n].push(e)}),o(t)}function o(e){var t,i=[],s=r.localization.fetch({key:"message_bucketName_other"});return Object.keys(e).sort().forEach(function(r){if(r===s)t={name:r,contacts:e[r]};else{var o=e[r].map(u);o=n.array.sortByProperty(o,"sortValue"),i.push({name:r,contacts:o.map(a)})}}),t&&i.push(t),i}function u(e){return{sortValue:n.stringUtils.clean(n.stringUtils.normalize(e.displayName())),person:e}}function a(e){return e.person}var n=e("swx-utils-common"),r=e("swx-i18n");t.getBucketName=i,t.byAlphabet=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-people/lib/personPropertyFormatter",["require","exports","lodash-compat"],e)}(function(e,t){function i(e){return n.isString(e)?e.replace(/^((\d+):)+/,""):undefined}function s(e,t){t===void 0&&(t=r),t||(t=r);if(!e)return e;if(e.length<=t)return e.trim();var n=e.substring(0,t).lastIndexOf(" ");return n===-1&&(n=t),e.substring(0,n).trim()}var n=e("lodash-compat"),r=15;t.getId=i,t.truncateDisplayName=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-people/lib/progressiveTimeout",["require","exports","swx-utils-common"],e)}(function(e,t){var n=e("swx-utils-common"),r={ONE_MINUTE:1,LIMIT_HOUR:59,ONE_HOUR:60,LIMIT_DAY:1439,ONE_DAY:1440},i=[{timeout:r.ONE_MINUTE,limit:r.LIMIT_HOUR},{timeout:r.ONE_HOUR,limit:r.LIMIT_DAY},{timeout:r.ONE_DAY,limit:null}],s=function(){function e(e){this.timeouts={},this.$unit={timeouts:this.timeouts},this.timeoutProvider=e}return e.prototype.start=function(e,t){this.timeouts.hasOwnProperty(e)||(this.timeouts[e]={callbacks:{},timeoutId:null,timeout:this.getTimeout()});var r=this.timeouts[e];r.callbacks||(r.callbacks={});var i=n.guid.create();return r.callbacks[i]=t,r.timeoutId===null&&this.runCallbacks(e),i},e.prototype.stop=function(e,t){var n=this.timeouts[e];if(!n)return;n.callbacks.hasOwnProperty(t)&&delete n.callbacks[t],Object.keys(n.callbacks).length===0&&(this.timeoutProvider.clearTimeout(n.timeoutId),n.timeoutId=null)},e.prototype.reset=function(e,t){this.timeouts.hasOwnProperty(e)&&(this.timeouts[e].timeout=this.getTimeout(t))},e.prototype.getTimeout=function(e){e===void 0&&(e=null);if(e===undefined||e===null)return this.toMilliseconds(i[0].timeout);for(var t=0;t<i.length;t++){var n=i[t];if(n.limit&&e>n.limit)continue;return this.toMilliseconds(n.timeout)}return this.toMilliseconds(i[i.length-1].timeout)},e.prototype.toMilliseconds=function(e){return e*60*1e3},e.prototype.runCallbacks=function(e){var t=this,n=this.timeouts[e];n.timeoutId=this.timeoutProvider.setTimeout(function(){t.runCallbacks(e)},n.timeout);for(var r in n.callbacks)n.callbacks.hasOwnProperty(r)&&n.callbacks[r]()},e}();t.__esModule=!0,t["default"]=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-encoder/lib/countryCodes",["require","exports"],e)}(function(e,t){t.CountryCodes={eu:"Europe",uk:"United Kingdom",af:"Afghanistan",ax:"&Aring;land Islands",al:"Albania",dz:"Algeria",as:"American Samoa",ad:"Andorra",ao:"Angola",ai:"Anguilla",aq:"Antarctica",ag:"Antigua and Barbuda",ar:"Argentina",am:"Armenia",aw:"Aruba",au:"Australia",at:"Austria",az:"Azerbaijan",bs:"Bahamas",bh:"Bahrain",bd:"Bangladesh",bb:"Barbados",by:"Belarus",be:"Belgium",bz:"Belize",bj:"Benin",bm:"Bermuda",bt:"Bhutan",bo:"Bolivia, Plurinational State of",ba:"Bosnia and Herzegovina",bw:"Botswana",bv:"Bouvet Island",br:"Brazil",io:"British Indian Ocean Territory",bn:"Brunei Darussalam",bg:"Bulgaria",bf:"Burkina Faso",bi:"Burundi",kh:"Cambodia",cm:"Cameroon",ca:"Canada",cv:"Cabo Verde",ky:"Cayman Islands",cf:"Central African Republic",td:"Chad",cl:"Chile",cn:"China",cx:"Christmas Island",cc:"Cocos (Keeling) Islands",co:"Colombia",km:"Comoros",cg:"Congo",cd:"Congo, the Democratic Republic of the",ck:"Cook Islands",cr:"Costa Rica",ci:"C&ocirc;te d'Ivoire",hr:"Croatia",cu:"Cuba",cy:"Cyprus",cz:"Czech Republic",dk:"Denmark",dj:"Djibouti",dm:"Dominica","do":"Dominican Republic",ec:"Ecuador",eg:"Egypt",sv:"El Salvador",gq:"Equatorial Guinea",er:"Eritrea",ee:"Estonia",et:"Ethiopia",fk:"Falkland Islands (Malvinas)",fo:"Faroe Islands",fj:"Fiji",fi:"Finland",fr:"France",gf:"French Guiana",pf:"French Polynesia",tf:"French Southern Territories",ga:"Gabon",gm:"Gambia",ge:"Georgia",de:"Germany",gh:"Ghana",gi:"Gibraltar",gr:"Greece",gl:"Greenland",gd:"Grenada",gp:"Guadeloupe",gu:"Guam",gt:"Guatemala",gg:"Guernsey",gn:"Guinea",gw:"Guinea-Bissau",gy:"Guyana",ht:"Haiti",hm:"Heard Island and McDonald Islands",va:"Holy See (Vatican City State)",hn:"Honduras",hk:"Hong Kong",hu:"Hungary",is:"Iceland","in":"India",id:"Indonesia",ir:"Iran, Islamic Republic of",iq:"Iraq",ie:"Ireland",im:"Isle of Man",il:"Israel",it:"Italy",jm:"Jamaica",jp:"Japan",je:"Jersey",jo:"Jordan",kz:"Kazakhstan",ke:"Kenya",ki:"Kiribati",kp:"Korea, Democratic People's Republic of",kr:"Korea, Republic of",kw:"Kuwait",kg:"Kyrgyzstan",la:"Lao People's Democratic Republic",lv:"Latvia",lb:"Lebanon",ls:"Lesotho",lr:"Liberia",ly:"Libya",li:"Liechtenstein",lt:"Lithuania",lu:"Luxembourg",mo:"Macao SAR",mk:"Macedonia, the former Yugoslav Republic of",mg:"Madagascar",mw:"Malawi",my:"Malaysia",mv:"Maldives",ml:"Mali",mt:"Malta",mh:"Marshall Islands",mq:"Martinique",mr:"Mauritania",mu:"Mauritius",yt:"Mayotte",mx:"Mexico",fm:"Micronesia, Federated States of",md:"Moldova, Republic of",mc:"Monaco",mn:"Mongolia",me:"Montenegro",ms:"Montserrat",ma:"Morocco",mz:"Mozambique",mm:"Myanmar",na:"Namibia",nr:"Nauru",np:"Nepal",nl:"Netherlands",an:"Netherlands Antilles",nc:"New Caledonia",nz:"New Zealand",ni:"Nicaragua",ne:"Niger",ng:"Nigeria",nu:"Niue",nf:"Norfolk Island",mp:"Northern Mariana Islands",no:"Norway",om:"Oman",pk:"Pakistan",pw:"Palau",ps:"Palestinian Authority",pa:"Panama",pg:"Papua New Guinea",py:"Paraguay",pe:"Peru",ph:"Philippines",pn:"Pitcairn",pl:"Poland",pt:"Portugal",pr:"Puerto Rico",qa:"Qatar",re:"R&eacute;union",ro:"Romania",ru:"Russian Federation",rw:"Rwanda",bl:"Saint Barth&eacute;lemy",sh:"Saint Helena, Ascension and Tristan da Cunha",kn:"Saint Kitts and Nevis",lc:"Saint Lucia",mf:"Saint Martin (French part)",pm:"Saint Pierre and Miquelon",vc:"Saint Vincent and the Grenadines",ws:"Samoa",sm:"San Marino",st:"Sao Tome and Principe",sa:"Saudi Arabia",sn:"Senegal",rs:"Serbia",sc:"Seychelles",sl:"Sierra Leone",sg:"Singapore",sk:"Slovakia",si:"Slovenia",sb:"Solomon Islands",so:"Somalia",za:"South Africa",gs:"South Georgia and the South Sandwich Islands",es:"Spain",lk:"Sri Lanka",sd:"Sudan",sr:"Suriname",sj:"Svalbard and Jan Mayen",sz:"Swaziland",se:"Sweden",ch:"Switzerland",sy:"Syrian Arab Republic",tw:"Taiwan",tj:"Tajikistan",tz:"Tanzania, United Republic of",th:"Thailand",tl:"Timor-Leste",tg:"Togo",tk:"Tokelau",to:"Tonga",tt:"Trinidad and Tobago",tn:"Tunisia",tr:"Turkey",tm:"Turkmenistan",tc:"Turks and Caicos Islands",tv:"Tuvalu",ug:"Uganda",ua:"Ukraine",ae:"United Arab Emirates",gb:"United Kingdom",us:"United States",um:"United States Minor Outlying Islands",uy:"Uruguay",uz:"Uzbekistan",vu:"Vanuatu",ve:"Venezuela, Bolivarian Republic of",vn:"Viet Nam",vg:"Virgin Islands, British",vi:"Virgin Islands, U.S.",wf:"Wallis and Futuna",ye:"Yemen",zm:"Zambia",zw:"Zimbabwe"}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-encoder/lib/aggregateEncoder",["require","exports","lodash-compat","./countryCodes"],e)}(function(e,t){function i(e,t){return typeof e=="undefined"?t:e}function o(e){var t=new u;return t.init(e),t}var n=e("lodash-compat"),r=e("./countryCodes"),s;(function(e){e[e.Element=1]="Element",e[e.Text=3]="Text"})(s||(s={})),t.build=o;var u=function(){function e(){this.xml=!0,this.countryCodes={},this.largeEmoticonClass="large",this.emoticonEncoder={},this.domTransformers=[],this.domDecoders=[],this._private={separators:{"   ":!0,"\n":!0,"\r":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0,"　":!0},createMentionElement:function(e,t,n,r){var i=e.get().personsAndGroupsManager,s=n.match(/^\d+:/),o="mention";s&&(n=n.substring(s[0].length));if(n===i.mePerson.id())r=i.mePerson.displayName(),o+=" me";else{var u=i.all.persons(n);u&&(r=u.displayName())}r=this.escapeXml(r);var a=t.createElement("span");a.setAttribute("title",n),a.textContent=r;var f=t.createElement("i");return f.setAttribute("class",o),f.appendChild(a),f},createFlagElement:function(e,t,n){var r=e.createElement("span");return r.textContent=n,r.setAttribute("class","flag "+t),r.textContent="(flag:"+t+")",r},encapsulateInRootElement:function(e){var t;while(t!==e)t=e,e=e.replace(/<\s*?root[\s\S]*?>.*?(<\s*?\/\s*?root\s*?>)?/ig,"");return"<root>"+e+"</root>"},decapsulateFromRootElement:function(e){return e.match(/<root ?\/>/)?"":e.length==="</root>".length?"":e.substring("<root>".length,e.length-"</root>".length)},parseXML:function(e){var t;try{if(window.DOMParser){var n=new DOMParser;n.async=!1,t=n.parseFromString(e,"text/xml")}else{var r=new ActiveXObject("Microsoft.XMLDOM");r.async=!1;if(r.loadXML(e))return r}}catch(i){return null}var s=t.parseError;return s&&s.errorCode!==0?null:t.getElementsByTagName("parsererror").length>0?null:t},xmlToString:function(e){var t;try{t=(new XMLSerializer).serializeToString(e)}catch(n){t=e.xml}return t},xmlEscapeMap:{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&apos;"},escapeXml:function(e){var t=this.xmlEscapeMap;return e.replace(/[<>&"']/g,function(e){return t[e]})},unescapeXml:function(e){var t={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"};return e.replace(/&lt;|&gt;|&amp;|&quot;|&apos/g,function(e){return t[e]})}}}return e.prototype.init=function(e){e=e||{},this.app=e.app,this.xml=i(e.xml,this.xml),this.countryCodes=i(e.countries,r.CountryCodes),this.largeEmoticonClass=i(e.largeEmoticonClass,this.largeEmoticonClass),this.emoticonEncoder=i(e.emoticonEncoder,this.emoticonEncoder),e.domTransformers&&e.domTransformers.length&&(this.domTransformers=this.domTransformers.concat(e.domTransformers)),e.domDecoders&&e.domDecoders.length&&(this.domDecoders=this.domDecoders.concat(e.domDecoders))},e.prototype.encode=function(e,t){function f(e){var t=e.implementation.createDocument(e.body.namespaceURI,"message",null);while(e.body.childNodes.length!==0)t.childNodes[0].appendChild(e.body.childNodes[0]);var n=t.childNodes[0].outerHTML;return n.replace(/(?:^<message.*?>|<\/message>$)/g,"").replace(/&nbsp;/g," ")}t===void 0&&(t=!0);var r=this,i=new DOMParser;if(typeof e!="string")throw new TypeError("Text parameter must be of type string.");var s=t?n.escape(e):e;try{var o=i.parseFromString(s,"text/html"),u=o.getElementsByTagName("parsererror").length!==0;if(u)throw new Error("ParserError");return this.domTransformers.forEach(function(e){try{e.transformRawToXml(o,o.body)}catch(t){}}),f(o)}catch(a){return s}},e.prototype.decode=function(e){function i(e,t){t.parentNode&&t.parentNode.replaceChild(e,t)}function s(){var e=r.getElementsByTagName("flag"),s=[];for(n=0;n<e.length;++n){var o=t._private.createFlagElement(a,e[n].getAttribute("country"),e[n].textContent);s.push([o,e[n]])}for(n=0;n<s.length;++n)i(s[n][0],s[n][1])}function o(){var e=r.getElementsByTagName("ss"),s=[],o=e.length<=3&&e.length>0;if(o)for(n=0;n<r.childNodes.length;++n){var u=r.childNodes[n].textContent.replace(" ","").length===0;o=o&&(r.childNodes[n].tagName==="ss"||u)}var f=e.length>20;for(n=0;n<e.length;++n){var l=t.emoticonEncoder.createHtmlElement(a,e[n].getAttribute("type"),e[n].textContent,o,f,t.largeEmoticonClass);l&&s.push([l,e[n]])}for(n=0;n<s.length;++n)i(s[n][0],s[n][1])}function u(){if(!t.app)return;var e=r.getElementsByTagName("at"),s=[];for(n=0;n<e.length;++n){var o=t._private.createMentionElement(t.app,a,e[n].getAttribute("id"),e[n].textContent);s.push([o,e[n]])}for(n=0;n<s.length;++n)i(s[n][0],s[n][1])}var t=this,n,r;try{var a=this._private.parseXML(this._private.encapsulateInRootElement(e));if(a)return r=a.documentElement,s(),o(),u(),this.domDecoders.forEach(function(e){try{e.transformRawToXml(a,r)}catch(t){}}),this.emoticonEncoder.fixInvalidHtml(this._private.decapsulateFromRootElement(this._private.xmlToString(a)))}catch(f){}return e},e.prototype.escapeXml=function(e){return this._private.escapeXml(e)},e.prototype.getNodeTextContent=function(e){var t=this._private.parseXML(this._private.encapsulateInRootElement(e));return t&&t.documentElement?t.documentElement.textContent:e},e.prototype.firstLetter=function(e,t){t=i(t,0);for(var n=t;n<e.length;++n)if(!this._private.separators[e[n]])return n;return-1},e.prototype.firstSeparator=function(e,t){t=i(t,0);for(var n=t;n<e.length;++n)if(this._private.separators[e[n]])return n;return-1},e}()}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-emoticon-map-instance/lib/map",["require","exports"],e)}(function(e,t){t.map={":)":"smile",":-)":"smile",":=)":"smile","(smile)":"smile",":(":"sad",":-(":"sad",":=(":"sad","(sad)":"sad",":<":"sad",":-<":"sad",":D":"laugh",":-D":"laugh",":=D":"laugh",":d":"laugh",":-d":"laugh",":=d":"laugh","(laugh)":"laugh",":>":"laugh",":->":"laugh","(lol)":"laugh","(LOL)":"laugh","(cool)":"cool","8-)":"cool","8=)":"cool","B-)":"cool","B=)":"cool",":O":"surprised",":-O":"surprised",":=O":"surprised",":o":"surprised",":-o":"surprised",":=o":"surprised","(surprised)":"surprised",";)":"wink",";-)":"wink",";=)":"wink","(wink)":"wink",";(":"cry",";-(":"cry",";=(":"cry","(cry)":"cry",":'(":"cry","(:|":"sweat","(sweat)":"sweat",":|":"speechless",":-|":"speechless",":=|":"speechless","(speechless)":"speechless","(kiss)":"kiss",":*":"kiss",":-*":"kiss",":=*":"kiss","(xo)":"kiss","(K)":"kiss","(k)":"kiss",":P":"tongueout",":-P":"tongueout",":=P":"tongueout",":p":"tongueout",":-p":"tongueout",":=p":"tongueout","(tongueout)":"tongueout",":$":"blush",":-$":"blush",":=$":"blush",':">':"blush","(blush)":"blush",":^)":"wonder","(wonder)":"wonder","|-)":"sleepy","I-)":"sleepy","I=)":"sleepy","(snooze)":"sleepy","|-(":"dull","|(":"dull","|=(":"dull","(dull)":"dull","(inlove)":"inlove","(love)":"inlove",":]":"inlove",":-]":"inlove","]:)":"eg",">:)":"eg","(grin)":"eg","(yn)":"fingerscrossed","(fingers)":"fingerscrossed","(fingerscrossed)":"fingerscrossed","(crossedfingers)":"fingerscrossed","(yawn)":"yawn","(puke)":"puke",":&":"puke",":-&":"puke",":=&":"puke","+o(":"puke","(doh)":"doh","(angry)":"angry",":@":"angry",":-@":"angry",":=@":"angry","x(":"angry","x-(":"angry","X(":"angry","X-(":"angry","x=(":"angry","X=(":"angry",";@":"angry",";-@":"angry","(wasntme)":"wasntme","(wm)":"wasntme","(party)":"party","<O)":"party","<o)":"party","<:o)":"party","(worry)":"worry",":S":"worry",":s":"worry",":-s":"worry",":-S":"worry",":=s":"worry",":=S":"worry","(mm)":"mmm","(mmm)":"mmm","(mmmm)":"mmm","(nerd)":"nerdy","8-|":"nerdy","B-|":"nerdy","8|":"nerdy","B|":"nerdy","8=|":"nerdy","B=|":"nerdy",":x":"lipssealed",":-x":"lipssealed",":X":"lipssealed",":-X":"lipssealed",":#":"lipssealed",":-#":"lipssealed",":=x":"lipssealed",":=X":"lipssealed",":=#":"lipssealed","(wave)":"hi","(hi)":"hi","(bye)":"hi","(BYE)":"hi","(Bye)":"hi","(Hi)":"hi","(HI)":"hi","(facepalm)":"facepalm","(fail)":"facepalm","(devil)":"devil","(6)":"devil","(angel)":"angel","(A)":"angel","(a)":"angel","(envy)":"envy","(V)":"envy","(v)":"envy","(wait)":"wait","(hug)":"hug","(bear)":"hug","(makeup)":"makeup","(kate)":"makeup","(chuckle)":"giggle","(giggle)":"giggle","(clap)":"clap","(think)":"think",":-?":"think",":?":"think",":=?":"think","*-)":"think","(bow)":"bow","(rofl)":"rofl","(rotfl)":"rofl","(whew)":"whew","(phew)":"whew","(happy)":"happy","(smirk)":"smirk","(nod)":"nod","(shake)":"shake","(waiting)":"waiting","(forever)":"waiting","(impatience)":"waiting","(emo)":"emo","(y)":"yes","(Y)":"yes","(ok)":"yes","(yes)":"yes","(OK)":"yes","(oK)":"yes","(Ok)":"yes","(n)":"no","(N)":"no","(no)":"no","(handshake)":"handshake","(highfive)":"highfive","(hifive)":"highfive","(h5)":"highfive","(heart)":"heart","(h)":"heart","(H)":"heart","(l)":"heart","(L)":"heart","<3":"heart","(lalala)":"lalala","(lalalala)":"lalala","(lala)":"lalala","(notlistening)":"lalala","(heidy)":"heidy","(squirrel)":"heidy","(F)":"flower","(f)":"flower","(flower)":"flower","(rain)":"rain","(london)":"rain","(st)":"rain","(ST)":"rain","(St)":"rain","(sun)":"sun","(#)":"sun","(tumbleweed)":"tumbleweed","(music)":"music","(8)":"music","(bandit)":"bandit","(tmi)":"tmi","(coffee)":"coffee","(c)":"coffee","(C)":"coffee","(pi)":"pizza","(pizza)":"pizza","(cash)":"cash","(mo)":"cash","($)":"cash","(flex)":"muscle","(muscle)":"muscle","(^)":"cake","(cake)":"cake","(beer)":"beer","(bricklayers)":"beer","(B)":"beer","(b)":"beer","(d)":"drink","(D)":"drink","(drink)":"drink","\\o/":"dance","\\:D/":"dance","\\:d/":"dance","(dance)":"dance","(ninja)":"ninja","(J)":"ninja","(j)":"ninja","(*)":"star","(star)":"star","(headbang)":"headbang","(banghead)":"headbang","(swear)":"swear","(drunk)":"drunk","(finger)":"finger","(poolparty)":"poolparty","(hrv)":"poolparty","(rock)":"rock","(smoking)":"smoke","(smoke)":"smoke","(ci)":"smoke","(bug)":"bug","(toivo)":"toivo","(wfh)":"wfh","(@h)":"wfh","(@H)":"wfh","(hollest)":"hollest","(zilmer)":"priidu","(e)":"mail","(m)":"mail","(mail)":"mail","(E)":"mail","(o)":"time","(O)":"time","(time)":"time","(clock)":"time","(0)":"time","(~)":"movie","(film)":"movie","(movie)":"movie","(mp)":"phone","(ph)":"phone","(phone)":"phone","(talk)":"talk","(call)":"call","(T)":"call","(t)":"call","(punch)":"punch","*|":"punch","*-|":"punch","(skype)":"skype","(ss)":"skype","(u)":"brokenheart","(U)":"brokenheart","(brokenheart)":"brokenheart","(mooning)":"mooning","(oliver)":"oliver","(bartlett)":"bertlett","(football)":"bertlett","(soccer)":"bertlett","(so)":"bertlett","(talktothehand)":"talktothehand","(idea)":"idea",":i":"idea",":I":"idea","*-:)":"idea","(sheep)":"sheep","(bah)":"sheep","(cat)":"cat",":3":"cat","(@)":"cat","(meow)":"cat","(bike)":"bike","(bicycle)":"bike","(sander)":"bike","(dog)":"dog",":o3":"dog","(&)":"dog"},t.maxLength=16,t.minLength=2,t.firstLetters="8:(B;|I]>+xX<*\\",t.firstLettersMap={8:"8",":":":","(":"(",B:"B",";":";","|":"|",I:"I","]":"]",">":">","+":"+",x:"x",X:"X","<":"<","*":"*","\\":"\\"}}),define("swx-emoticon-map-instance",["swx-emoticon-map-instance/lib/map"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-service-locator/lib/serviceLocator",["require","exports","lodash-compat"],e)}(function(e,t){function r(e){if(!n.isString(e)||e==="")throw new Error("You must provide a valid name for this service")}function s(){return new i}var n=e("lodash-compat"),i=function(){function e(){}return e.prototype.contains=function(e){return r(e),e in this},e.prototype.fetchOne=function(e){r(e);if(!this.contains(e))throw new Error("Service '"+e+"' not found");return this[e]},e.prototype.resolve=function(e){return this.fetchOne(e)},e.prototype.register=function(e,t){if(Object.isFrozen(this))throw new Error("Service locator is readonly when registering ' "+e+"'");r(e);if(this.contains(e))throw new Error("Service '"+e+"' already registered");this[e]=t},e.prototype.destroy=function(e){if(Object.isFrozen(this))throw new Error("Service locator is readonly when removing ' "+e+"'");var t=this.resolve(e);if(!this.hasOwnProperty(e))throw new Error("Service '"+e+"' does not belong to this locator");return delete this[e],t},e.prototype.reset=function(){var e=this;if(Object.isFrozen(this))throw new Error("Service locator is readonly when clearing it");Object.keys(this).forEach(function(t){return e.destroy(t)})},e}();t.ServiceLocator=i,t.build=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-service-locator/lib/serviceLocatorBuilder",["require","exports","lodash-compat","./serviceLocator"],e)}(function(e,t){function s(e){var t=new i;return e?t.withOptions(e):t}var n=e("lodash-compat"),r=e("./serviceLocator"),i=function(){function e(){this.options={factories:[],frozen:!1,baseLocator:r.ServiceLocator.prototype}}return e.prototype.withOptions=function(e){return n.assign(this.options,e),this},e.prototype.withService=function(e,t){var r={name:e.name,build:e.build};return t&&n.extend(r,t),this.options.factories.push(r),this},e.prototype.withServiceInstance=function(e,t){return t?this.options.factories.push({name:t.name,build:function(){return e}}):this.options.factories.push({name:e.name,build:function(){return e.instance}}),this},e.prototype.frozen=function(){return this.options.frozen=!0,this},e.prototype.withBase=function(e){return this.options.baseLocator=e,this},e.prototype.build=function(e){var t=this;return Promise.all(this.options.factories.map(function(e){return Promise.resolve(e.build()).then(function(t){return[e.name,t]})})).then(function(n){return n.reduce(function(e,t){var n=t[0],r=t[1];return e.register(n,r),e},e||Object.create(t.options.baseLocator))}).then(function(e){return t.options.frozen?Object.freeze(e):e})},e.prototype.buildSync=function(e){var t=this.options.factories.map(function(e){return[e.name,e.build()]}).map(function(e){var t=e[0],n=e[1];if(n.then===undefined)return[t,n];throw new Error("#buildSync can't build "+t+" because it is asynchronous")}).reduce(function(e,t){var n=t[0],r=t[1];return e.register(n,r),e},e||Object.create(this.options.baseLocator));return this.options.frozen?Object.freeze(t):t},e}();t.serviceLocatorBuilder=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-service-locator/lib/index",["require","exports","./serviceLocator","./serviceLocatorBuilder"],e)}(function(e,t){var n=e("./serviceLocator");t.ServiceLocator=n;var r=e("./serviceLocatorBuilder");t.serviceLocatorBuilder=r.serviceLocatorBuilder}),define("swx-service-locator",["swx-service-locator/lib/index"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-service-locator-instance/lib/instance",["require","exports","swx-service-locator"],e)}(function(e,t){var n=e("swx-service-locator");t.__esModule=!0,t["default"]=n.ServiceLocator.build()}),define("swx-service-locator-instance",["swx-service-locator-instance/lib/instance"],function(e){return e});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-encoder/lib/domTransformers",["require","exports","lodash-compat","./countryCodes"],e)})(function(e,t){var n=e("lodash-compat"),r=e("./countryCodes"),i=function(){function e(){}return e.prototype.transformRawToXml=function(e,t){var n=[];n.push(t);while(n.length!==0){var r=n.pop();r.nodeType===Node.TEXT_NODE?this.encodeTextNodeToXml(e,r):r.nodeName.toLowerCase()!=="pre"&&this.isElementAllowed(r)&&this.pushChildNodes(n,r)}},e.prototype.encodeTextNodeToXml=function(e,t){var n=t.parentNode,r=this.encodeWords(e,t);if(r.length===0)return;for(var i=0;i<r.length;i++)n.insertBefore(r[i],t);n.removeChild(t)},e.prototype.encodeWords=function(e,t){var r=this,i=t.nodeValue,s=this.getAllWords(i),o=0,u=[];return s.forEach(function(t){var s=r.wordRawToXml(e,t[0]);if(n.isUndefined(s)||s.length===0)return;o!==t.index&&u.push(e.createTextNode(i.substring(o,t.index))),o=t.index+t[0].length,u=u.concat(s)}),o!==0&&o<i.length&&u.push(e.createTextNode(i.substring(o))),u},e.prototype.getAllWords=function(e){var t=this.wordMatcher(),n,r=[];while((n=t.exec(e))!==null)r.push(n);return r},e.prototype.pushChildNodes=function(e,t){for(var n=0;n<t.childNodes.length;n++)e.push(t.childNodes[n])},e.prototype.wordMatcher=function(){return/[\w()#:\-=<>\u2329\u232A;'\|\$"\]\*\^&\+@\{\?Ǝ\/\\!~]+/g},e}();t.WordDomTransformer=i;var s=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return __extends(t,e),t.build=function(){return new t},t.prototype.isElementAllowed=function(e){return e.nodeName.toLowerCase()!=="span"||e.className.toLowerCase().indexOf("flag")===-1},t.prototype.wordRawToXml=function(e,t){var n=t.match(/^\(flag:([A-Za-z]{2})\)$/i),i=n&&n[1].toLowerCase();return i&&r.CountryCodes[i]?[this.createXmlElement(e,i,t)]:[]},t.prototype.createXmlElement=function(e,t,n){var r=e.createElement("flag");return r.setAttribute("country",t),r.innerText=n,r},t}(i);t.FlagDomTransformer=s;var o=function(e){function t(t){var n=e.call(this)||this;return n.isOutgoing=t,n}return __extends(t,e),t.build=function(e){return e===void 0&&(e=!1),new t(e)},t.prototype.isElementAllowed=function(e){return e.nodeName.toLowerCase()!=="a"},t.prototype.wordRawToXml=function(e,t){var n=t.match(/^(\()?(.*?)((\.|\?|\!|\))+)?$/i),r=n[1],i=n[2],s=n[3],o=i.match(/^(?:https?:\/\/|mailto:)(.+)$/i),u=o&&o[0];u||(o=i.match(/^[^@]+@(?:\w+(?:\.\w+)+)$/i),u=o&&"mailto:"+o[0]),u||(o=i.match(/^www\.\S+$/i),u=o&&"http://"+o[0]);if(u){var a=[];return r&&a.push(e.createTextNode(r)),a.push(this.createXmlElement(e,u,i)),s&&a.push(e.createTextNode(s)),a}return[]},t.prototype.createXmlElement=function(e,t,n){var r=e.createElement("a");return r.setAttribute("href",t),this.isOutgoing||(r.setAttribute("title",t),r.setAttribute("target","_blank"),r.setAttribute("tabindex","-1")),r.innerText=n,r},t.prototype.wordMatcher=function(){return/\S+/g},t}(i);t.URLDomTransformer=o;var u=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return __extends(t,e),t.build=function(){return new t},t.prototype.isElementAllowed=function(e){return e.nodeName.toLowerCase()!=="pre"},t.prototype.getAllWords=function(e){var t=/\r?\n/g,n,r=[];while((n=t.exec(e))!==null)r.push(n);return r},t.prototype.wordRawToXml=function(e,t){return[this.createXmlElement(e)]},t.prototype.createXmlElement=function(e){return e.createElement("br")},t}(i);t.NewLineDomTransformer=u;var a=function(){function e(){}return e.prototype.transformRawToXml=function(e,t){var n=[];n.push(t);while(n.length!==0){var r=n.pop();this.isDesiredElement(r)?this.visitElement(e,r):r.nodeType===Node.ELEMENT_NODE&&this.pushChildNodes(n,r)}},e.prototype.pushChildNodes=function(e,t){for(var n=0;n<t.childNodes.length;n++)e.push(t.childNodes[n])},e}();t.ElementVisitor=a});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-encoder/lib/encoders/emoticonEncoder",["require","exports","swx-constants","swx-emoticon-map-instance","swx-service-locator-instance","../domTransformers","swx-cafe-application-instance"],e)})(function(e,t){function a(e,t,n){var r=e.createElement("ss");return r.setAttribute("type",t),r.innerText=n,r}function f(e){return u.test(e)}function p(){var e=i["default"].resolve(n.COMMON.serviceLocator.FEATURE_FLAGS);return e.isFeatureOn(n.COMMON.featureFlags.CANVAS_EMOTICONS_ENABLED)?new h:new c}var n=e("swx-constants"),r=e("swx-emoticon-map-instance"),i=e("swx-service-locator-instance"),s=e("../domTransformers"),o=e("swx-cafe-application-instance"),u=/^\w$/,l=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.isElementAllowed=function(e){return e.nodeName.toLowerCase()!=="span"||e.className.toLowerCase().indexOf("emoticon")===-1},t.prototype.wordRawToXml=function(e,t){var n=[],i=0;for(var s=0;s<t.length;s++){var o=undefined,u=-1;for(var l=s+1;l<t.length+1;l++){var c=t.substring(s,l),h=r.map.hasOwnProperty(c)&&r.map[c];h&&!f(t[l])&&(o=h,u=l)}o&&(i!==s&&n.push(e.createTextNode(t.substring(i,s))),i=u,n.push(a(e,o,t.substring(s,u))),s=u-1)}return i!==0&&i<t.length&&n.push(e.createTextNode(t.substring(i))),n},t}(s.WordDomTransformer);t._EmoticonEncoder=l;var c=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createHtmlElement=function(e,t,n,r,i,s){var o=e.createElement("span"),u=["emoticon"];u.push(t),i||u.push("animated"),r&&u.push(s),o.setAttribute("class",u.join(" "));var a=e.createElement("span");return a.textContent=n,a.setAttribute("class","emoSprite"),o.appendChild(a),o},t.prototype.fixInvalidHtml=function(e){return e.replace(/<span class="emoSprite"\s*\/>/g,'<span class="emoSprite"></span>')},t.prototype.hasEmoticons=function(e){return e.indexOf('<span class="emoSprite">')>-1},t.prototype.hasLargeEmoticon=function(e){return/<span class="emoticon\s?\w*\s?(animated)?\s+\w*large"><span class="emoSprite">.*<\/span><\/span>/i.test(e)},t}(l);t._SpanEmoticonEncoder=c;var h=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.canShowLargeEmoticon=function(){var e=o.get().personsAndGroupsManager.mePerson,t=e.preferences(n.COMMON.userSettings.preferences.SHOW_LARGE_EMOTICONS);return t?t.value():null},t.prototype.canShowAnimatedEmoticon=function(){var e=o.get().personsAndGroupsManager.mePerson,t=e.preferences(n.COMMON.userSettings.preferences.SHOW_ANIMATED_EMOTICONS);return t?t.value():null},t.prototype.createHtmlElement=function(e,t,i,s,u,a){var f=e.createElement("span"),l=e.createElement("canvas"),c=["emoticon"],h=o.get().personsAndGroupsManager.mePerson,p=h.preferences(n.COMMON.userSettings.preferences.SHOW_ANIMATED_EMOTICONS),d=h.preferences(n.COMMON.userSettings.preferences.SHOW_LARGE_EMOTICONS),v=o.get().personsAndGroupsManager.mePerson.preferences(n.COMMON.userSettings.preferences.SHOW_EMOTICONS),m=!v||v.value();return!t||!r.map.hasOwnProperty(i)||!m?undefined:(l.setAttribute("data-item-id",t),l.textContent=i,!u&&(p&&this.canShowAnimatedEmoticon()||!p)&&l.setAttribute("data-is-animated","true"),s&&(d&&this.canShowLargeEmoticon()||!d)&&c.push(a),d&&d.value.get().then(function(e){if(e!==!1)return;var t=c.indexOf(a,0);t>-1&&(c.splice(t,1),f.setAttribute("class",c.join(" ")))}),f.setAttribute("class",c.join(" ")),f.appendChild(l),f)},t.prototype.fixInvalidHtml=function(e){return e.replace(/<canvas((?:\s?(?:data-[-a-z]*|height|width)="[a-z0-9]*")*)\s*\/>/g,"<canvas$1></canvas>")},t.prototype.hasEmoticons=function(e){return e.indexOf("<canvas")>-1},t.prototype.hasLargeEmoticon=function(e){return/<span class="emoticon\s?\w*\s?(animated)?\s+\w*large"><canvas(\s?(data-[-a-z]*|height|width)="[a-z0-9]*")*>.*<\/canvas><\/span>/i.test(e)},t}(l);t._CanvasEmoticonEncoder=h,t.build=p});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-encoder/lib/encoders/markupDecoder",["require","exports","../domTransformers"],e)})(function(e,t){function s(){return new i}var n=e("../domTransformers"),r={b:"*",s:"~",i:"_"},i=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.isDesiredElement=function(e){var t=e.nodeType===Node.ELEMENT_NODE?e.nodeName.toLowerCase():"",n=e.nodeType===Node.ELEMENT_NODE?e.className.toLowerCase():"";return t!==""&&(t==="b"||t==="s"||t==="i"&&n.indexOf("mention")===-1)},t.prototype.visitElement=function(e,t){var n=t.parentNode,i=t.childNodes.length;n.insertBefore(e.createTextNode(r[t.nodeName.toLowerCase()]),t);for(var s=0;s<i;s++)n.insertBefore(t.childNodes[0],t);n.insertBefore(e.createTextNode(r[t.nodeName.toLowerCase()]),t),n.removeChild(t)},t}(n.ElementVisitor);t.build=s});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-encoder/lib/encoders/mentionsDecoder",["require","exports","lodash-compat","swx-cafe-application-instance","../domTransformers"],e)})(function(e,t){function o(){return new s}var n=e("lodash-compat"),r=e("swx-cafe-application-instance"),i=e("../domTransformers"),s=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.isDesiredElement=function(e){var t=e.nodeType===Node.ELEMENT_NODE?e.nodeName.toLowerCase():"",n=e.nodeType===Node.ELEMENT_NODE?e.className.toLowerCase():"";return t==="i"&&n.indexOf("mention")!==-1},t.prototype.visitElement=function(e,t){var i=t.parentNode,s=t.childNodes.length===1&&t.childNodes[0];if(!s)return;var o=s.title.toLowerCase(),u=r.get().personsAndGroupsManager.all.persons(),a=n.find(u,function(e){return e.id().toLowerCase()===o}),f=a&&a.isAgent()?"("+a.displayName().replace(/(\(|\))/g,"")+")":s.title;i.replaceChild(e.createTextNode("@"+f),t)},t}(i.ElementVisitor);t.build=o});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-encoder/lib/encoders/mentionsEncoder",["require","exports","lodash-compat","swx-cafe-application-instance","../domTransformers"],e)})(function(e,t){function u(e){return new o(e)}var n=e("lodash-compat"),r=e("swx-cafe-application-instance"),i=e("../domTransformers"),s=/(\(|\))/g,o=function(e){function t(t){var n=e.call(this)||this;return n.conversation=t,n}return __extends(t,e),t.prototype.createXmlElement=function(e,t){var n=e.createElement("at");return n.setAttribute("id",t.type+":"+t.skypeId),n.innerText=t.defaultDisplayName,n},t.prototype.getMentionUserData=function(e){var t,i="",o={defaultDisplayName:"",displayName:"",skypeId:"",type:"",isMePerson:!1};if(!e)return undefined;e=e.toLowerCase();var u=e.indexOf("(")===0,a=u?e.substring(1,e.length-1):"",f=r.get().personsAndGroupsManager.mePerson,l=r.get().personsAndGroupsManager.all.persons();if(this.conversation){var c=this.conversation.participants().map(function(e){return e.person});l=l.concat(c)}return o.isMePerson=e===f.id().toLowerCase()||u&&f.displayName().replace(s,"").toLowerCase()===a,o.isMePerson?t=f:t=n.find(l,function(t){return t.id().toLowerCase()===e||u&&t.displayName().replace(s,"").toLowerCase()===a}),t?(o.skypeId=t.id(),o.type=t._type(),o.displayName=t.displayName(),t.firstName()&&(o.defaultDisplayName=t.firstName(),i=" "),t.lastName()&&(o.defaultDisplayName+=i+t.lastName()),o.defaultDisplayName||(o.defaultDisplayName=o.displayName),o):undefined},t.prototype.isElementAllowed=function(e){return e.nodeName.toLowerCase()!=="i"||e.className.toLowerCase().indexOf("mention")===-1},t.prototype.wordRawToXml=function(e,t){var n=[],r=t.substring(1),i=/[\.,_:\-;?]$/,s,o=this.getMentionUserData(r);while(!o&&r.match(i))s=r.charAt(r.length-1),r=r.substring(0,r.length-1),o=this.getMentionUserData(r);return o&&(n.push(this.createXmlElement(e,o)),s&&n.push(e.createTextNode(s))),n},t.prototype.wordMatcher=function(){return/@([a-z0-9\.,\-_:]+|\(.+?\))/gi},t}(i.WordDomTransformer);t.build=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-encoder/lib/encoders/noTranslateDomTransformer",["require","exports"],e)}(function(e,t){function r(e){return new n(e)}var n=function(){function e(e){this.mode=e}return e.prototype.decorate=function(e,t){var n=t.parentNode,r=e.createElement("span");r.setAttribute("class","notranslate"),n.replaceChild(r,t),r.appendChild(t)},e.prototype.excludeFromTranslation=function(e){var t=e.nodeName.toLowerCase(),n=e.className.toLowerCase();return t==="ss"||t==="at"||t==="flag"||t==="a"||t==="span"&&(n.indexOf("emoticon")!==-1||n.indexOf("flag")!==-1)||t==="i"&&n.indexOf("mention")!==-1||t==="pre"},e.prototype.isNoTranslateElement=function(e){var t=e.nodeName.toLowerCase(),n=e.className.toLowerCase();return t==="span"&&n.indexOf("notranslate")!==-1},e.prototype.pushChildNodes=function(e,t){for(var n=0;n<t.childNodes.length;n++)e.push(t.childNodes[n])},e.prototype.removeElement=function(e,t){var n=t.parentNode,r=t.childNodes.length;for(var i=0;i<r;i++)n.insertBefore(t.childNodes[0],t);n.removeChild(t)},e.prototype.transformRawToXml=function(t,n){var r=[],i,s;this.mode===e.Mode.Add?(i=this.excludeFromTranslation,s=this.decorate):(i=this.isNoTranslateElement,s=this.removeElement),r.push(n);while(r.length!==0){var o=r.pop();o.nodeType===Node.ELEMENT_NODE&&i(o)?s(t,o):this.pushChildNodes(r,o)}},e}();n.Mode={Add:"add",Remove:"remove"},t.build=r,t.Mode=n.Mode});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-encoder/lib/encoders/quoteDecoder",["require","exports","lodash-compat","../domTransformers"],e)})(function(e,t){function s(e){var t=new i;return t.timeFormat=e,t}var n=e("lodash-compat"),r=e("../domTransformers"),i=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.isDesiredElement=function(e){var t=e.nodeType===Node.ELEMENT_NODE?e.nodeName.toLowerCase():"";return t!==""&&t==="quote"},t.prototype.visitElement=function(e,t){var r=t.parentNode,i=t,s=n.unescape(i.getAttribute("authorname")),o=i.getAttribute("timestamp"),u=e.createElement("div"),a=e.createElement("p"),f=e.createElement("a"),l=e.createElement("span");u.setAttribute("class","quotedText"),a.setAttribute("class","quoted");for(var c=i.childNodes.length;c>2;c--)a.appendChild(i.childNodes[1]);u.appendChild(a),f.textContent=s+", ",f.setAttribute("class","author"),f.setAttribute("role","button"),f.setAttribute("author",i.getAttribute("author")),u.appendChild(f),!this.timeFormat||(l.textContent=this.timeFormat(Number(o)*1e3)),l.setAttribute("class","time"),u.appendChild(l),r.insertBefore(u,t),r.removeChild(t)},t}(r.ElementVisitor);t.QuoteDecoder=i,t.build=s});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-encoder/lib/encoders/quoteEncoder",["require","exports","lodash-compat","../domTransformers"],e)})(function(e,t){function s(){return new i}var n=e("lodash-compat"),r=e("../domTransformers"),i=function(e){function t(){var t=e!==null&&e.apply(this,arguments)||this;return t.shouldMaintainLegacyQuote=!0,t.QUOTE_NODE="quote",t.AUTHOR_ATTR="author",t.AUTHOR_NAME_ATTR="authorname",t.CONVERSATION_ATTR="conversation",t.TIMESTAMP_ATTR="timestamp",t.LEGACY_QUOTE_NODE="legacyquote",t.LEGACY_ANNOTATION_TEXT_NODE="\r\n\r\n<<< ",t}return __extends(t,e),t.prototype.isElementAllowed=function(e){return e.nodeName!="#text"},t.prototype.createXmlElement=function(e,t){if(n.isUndefined(t)||n.isUndefined(t.author)||n.isUndefined(t.authorName)||n.isUndefined(t.conversationId)||n.isUndefined(t.quoteMessage)||n.isUndefined(t.timestamp))return undefined;var r=e.createElement(this.QUOTE_NODE);r.setAttribute(this.AUTHOR_ATTR,t.author),r.setAttribute(this.AUTHOR_NAME_ATTR,t.authorName),r.setAttribute(this.CONVERSATION_ATTR,t.conversationId);var i=this.isValidTimestampString(t.timestamp)?Math.round(Date.parse(t.timestamp)/1e3).toString():"";r.setAttribute(this.TIMESTAMP_ATTR,i);var s=e.createTextNode(t.quoteMessage);return this.shouldMaintainLegacyQuote?r=this.createAndAppendLegacyQuoteNode(e,t,r,s):r.appendChild(s),r},t.prototype.isValidTimestampString=function(e){var t=new Date(e);return Object.prototype.toString.call(t)==="[object Date]"?!isNaN(t.getTime()):!1},t.prototype.getLegacyTimeStamp=function(e){if(this.isValidTimestampString(e)){var t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString()}return""},t.prototype.createElementWithText=function(e,t,n){var r=e.createElement(t);return r.textContent=n,r},t.prototype.createAndAppendLegacyQuoteNode=function(e,t,n,r){var i=this.getLegacyTimeStamp(t.timestamp),s=this.createElementWithText(e,this.LEGACY_QUOTE_NODE,"["+i+"] "+t.authorName+": ");n.appendChild(s),n.appendChild(r);var o=this.createElementWithText(e,this.LEGACY_QUOTE_NODE,this.LEGACY_ANNOTATION_TEXT_NODE);return n.appendChild(o),n},t.prototype.wordRawToXml=function(e,t){try{var r=[],i=JSON.parse(t),s=this.createXmlElement(e,i);return n.isUndefined(s)||r.push(s),r}catch(o){return[]}},t.prototype.wordMatcher=function(){return/{.*}/g},t}(r.WordDomTransformer);t.QuoteEncoder=i,t.build=s});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-encoder/lib/encoders/codeSnippetEncoder",["require","exports","lodash-compat","../domTransformers"],e)})(function(e,t){function s(){return new i}var n=e("lodash-compat"),r=e("../domTransformers"),i=function(e){function t(){var t=e!==null&&e.apply(this,arguments)||this;return t.PRE_NODE="pre",t.RAW_PRE_ATTR="raw_pre",t.RAW_POST_ATTR="raw_post",t.CODE_WRAPPER_MATCHER=/(\{code})((?:.|[\r\n])*)(\{code})/g,t.GLOBAL_CODE_MATCHER=/^(!!)((?:.|[\r\n])*)$/g,t}return __extends(t,e),t.prototype.isElementAllowed=function(e){return e.nodeName.toLowerCase()!==this.PRE_NODE},t.prototype.createXmlElement=function(e,t,r,i){if(!r||n.isUndefined(t)||n.isNull(t))return null;var s=e.createElement(this.PRE_NODE);return s.setAttribute(this.RAW_PRE_ATTR,r),i&&s.setAttribute(this.RAW_POST_ATTR,i),s.textContent=t,s},t.prototype.wordRawToXml=function(e,t){var n=this;try{var r=[];return[this.GLOBAL_CODE_MATCHER,this.CODE_WRAPPER_MATCHER].forEach(function(i){var s=i.exec(t);s!==null&&s.length>=2&&r.length===0&&r.push(n.createXmlElement(e,s[2],s[1],s[3]))}),r}catch(i){return[]}},t.prototype.wordMatcher=function(){return/(\{code}(?:.|[\r\n])*\{code})|(^!!(?:.|[\r\n])*)$/g},t}(r.WordDomTransformer);t.CodeSnippetEncoder=i,t.build=s});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-encoder/lib/encoders/codeSnippetDecoder",["require","exports","lodash-compat","../domTransformers"],e)})(function(e,t){function s(){return new i}var n=e("lodash-compat"),r=e("../domTransformers"),i=function(e){function t(){var t=e!==null&&e.apply(this,arguments)||this;return t.PRE_NODE="pre",t.RAW_PRE_ATTR="raw_pre",t.RAW_POST_ATTR="raw_post",t.UNESCAPED_MATCHER=/<|>/g,t}return __extends(t,e),t.prototype.isDesiredElement=function(e){var t=e.nodeType===Node.ELEMENT_NODE?e.nodeName.toLowerCase():"";return t===this.PRE_NODE},t.prototype.visitElement=function(e,t){var r=t.parentNode,i=t.childNodes.length,s=e.createElement(this.PRE_NODE),o=t.getAttribute(this.RAW_PRE_ATTR),u=t.getAttribute(this.RAW_POST_ATTR);o&&s.setAttribute(this.RAW_PRE_ATTR,o);for(var a=0;a<i;a++)s.appendChild(t.childNodes[0]);u&&s.setAttribute(this.RAW_POST_ATTR,u),this.UNESCAPED_MATCHER.test(s.innerHTML)&&(s.innerHTML=n.escape(s.innerHTML)),r.insertBefore(s,t),r.removeChild(t)},t}(r.ElementVisitor);t.CodeSnippetDecoder=i,t.build=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-encoder/lib/encoderFactory",["require","exports","lodash-compat","swx-constants","./encoders/emoticonEncoder","./encoders/codeSnippetEncoder","./aggregateEncoder","./domTransformers","./encoders/mentionsEncoder","swx-service-locator-instance"],e)}(function(e,t){function l(e,t){var l=f["default"].resolve(r.COMMON.serviceLocator.FEATURE_FLAGS),c=n.extend({app:e},t),h=i.build(),p=u.FlagDomTransformer.build(),d=[];l.isFeatureOn(r.COMMON.featureFlags.CODE_SNIPPET_ENABLED)&&d.push(s.build()),d=d.concat([p,h]),l.isFeatureOn(r.COMMON.featureFlags.MENTIONS_ENABLED)&&d.push(a.build(t&&t.conversation));var v=c.domTransformers||d;return t&&t.domTransformeExtensions&&(v=v.concat(t.domTransformeExtensions)),t&&t.domDecoders&&(c.domDecoders=t.domDecoders),l.isFeatureOn(r.COMMON.featureFlags.PES_USE_EXTRA_LARGE_EMOTICONS)&&(c.largeEmoticonClass="extraLarge"),c.emoticonEncoder=h,c.domTransformers=v,o.build(c)}var n=e("lodash-compat"),r=e("swx-constants"),i=e("./encoders/emoticonEncoder"),s=e("./encoders/codeSnippetEncoder"),o=e("./aggregateEncoder"),u=e("./domTransformers"),a=e("./encoders/mentionsEncoder"),f=e("swx-service-locator-instance");t.build=l}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-encoder/lib/index",["require","exports","./aggregateEncoder","./encoders/emoticonEncoder","./encoders/markupDecoder","./encoders/mentionsDecoder","./encoders/mentionsEncoder","./encoders/noTranslateDomTransformer","./encoders/quoteDecoder","./encoders/quoteEncoder","./encoders/codeSnippetEncoder","./encoders/codeSnippetDecoder","./countryCodes","./domTransformers","./encoderFactory"],e)}(function(e,t){function n(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}var r=e("./aggregateEncoder");t.AggregateEncoder=r;var i=e("./encoders/emoticonEncoder");t.EmoticonEncoder=i;var s=e("./encoders/markupDecoder");t.MarkupDecoder=s;var o=e("./encoders/mentionsDecoder");t.MentionDecoder=o;var u=e("./encoders/mentionsEncoder");t.MentionEncoder=u;var a=e("./encoders/noTranslateDomTransformer");t.NoTranslateDomTransformer=a;var f=e("./encoders/quoteDecoder");t.QuoteDecoder=f;var l=e("./encoders/quoteEncoder");t.QuoteEncoder=l;var c=e("./encoders/codeSnippetEncoder");t.CodeSnippetEncoder=c;var h=e("./encoders/codeSnippetDecoder");t.CodeSnippetDecoder=h;var p=e("./countryCodes");t.CountryCodes=p.CountryCodes;var d=e("./domTransformers");t.WordDomTransformer=d.WordDomTransformer,t.FlagDomTransformer=d.FlagDomTransformer,t.URLDomTransformer=d.URLDomTransformer,t.NewLineDomTransformer=d.NewLineDomTransformer,t.ElementVisitor=d.ElementVisitor,n(e("./encoderFactory"))}),define("swx-encoder",["swx-encoder/lib/index"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-chat/lib/conversation",["require","exports","lodash-compat"],e)}(function(e,t){function r(e,t){return t.getConversation(e)}function i(e,t){var n=t.createConversation();return u(e,n),n}function s(e){return!e||!e.indexOf?!1:e.indexOf("guesthost_")>-1}function o(e,t,n){return e.length>1||n?i(e,t):r(e[0],t)}function u(e,t){return Promise.all(n.map(e,function(e){var n=t.createParticipant(e);return t.participants.add(n)}))}function a(e,t){return e.participants.filter(function(e){return e.person.id()===t})(0)}var n=e("lodash-compat");t.isGuestHostConversation=s,t.createConversation=o,t.addPersonsToConversation=u,t.getParticipantFromConversation=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-chat/lib/conversationCache",["require","exports"],e)}(function(e,t){function r(e){var t=n.filter(function(t){return t.model===e})[0];return t||(t={model:e},n.push(t)),t}var n=[];t.forModel=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-g11n/lib/formatter",["require","exports"],e)}(function(e,t){function r(e,t,r){var i=r.calendar,s=r.time,o=i.days,u=i.months;return t.replace(n,function(t){var n;switch(t){case"dName":n=o.names[e.getDay()];break;case"dAbbr":n=o.namesAbbr[e.getDay()];break;case"mName":n=u.names[e.getMonth()];break;case"mAbbr":n=u.namesAbbr[e.getMonth()];break;case"tt":n=e.getHours()<12?s.AM:s.PM;break;case"yyyy":n=e.getFullYear();break;case"yy":n=e.getFullYear()%100;break;case"d":n=e.getDate();break;case"dd":n=e.getDate(),n.toString().length===1&&(n="0"+n);break;case"M":n=e.getMonth()+1;break;case"MM":n=e.getMonth()+1,n.toString().length===1&&(n="0"+n);break;case"h":n=e.getHours()%12||12;break;case"hh":n=e.getHours()%12||12,n.toString().length===1&&(n="0"+n);break;case"H":n=e.getHours();break;case"HH":n=e.getHours(),n.toString().length===1&&(n="0"+n);break;case"m":n=e.getMinutes();break;case"mm":n=e.getMinutes(),n.toString().length===1&&(n="0"+n);break;case"s":n=e.getSeconds();break;case"ss":n=e.getSeconds(),n.toString().length===1&&(n="0"+n)}return n!==undefined?n:t.slice(1,t.length-1)})}function i(e,t){var r,i;return s(t)&&(r=Math.floor(e/60/60),e-=r*60*60),o(t)&&(i=Math.floor(e/60),e-=i*60),t.replace(n,function(t){var n;switch(t){case"h":n=r;break;case"hh":n=r,n.toString().length===1&&(n="0"+n);break;case"H":n=r;break;case"HH":n=r,n.toString().length===1&&(n="0"+n);break;case"m":n=i;break;case"mm":n=i,n.toString().length===1&&(n="0"+n);break;case"s":n=e;break;case"ss":n=e,n.toString().length===1&&(n="0"+n)}return n!==undefined?n:t.slice(1,t.length-1)})}function s(e){return/HH|H|hh|h/.test(e)}function o(e){return/mm|m/.test(e)}var n=/dName|dAbbr|mName|mAbbr|dd|d|MM|M|yyyy|yy|HH|H|hh|h|mm|m|tt|ss|s|'[^']*'|'[^']*'/g;t.formatDate=r,t.formatDuration=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-g11n/lib/settings",["require","exports"],e)}(function(e,t){function i(e){r=e}function s(){return r}var n={calendar:{days:{names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],namesAbbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},months:{names:["January","February","March","April","May","June","July","August","September","October","November","December"],namesAbbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},firstDay:0},time:{AM:"am",PM:"pm",separator:":",format:{duration:"mm:ss","short":"h:mm tt","long":"h:mm:ss tt"}},date:{separator:"/",format:{dayMonth:"M/d",dayMonthYear:"M/d/yy",dayAbbr:"dAbbr",dayName:"dName",dateAbbr:"mAbbr d yyyy",shortDateAbbr:"mAbbr d"}},dir:"ltr"},r=n;t.set=i,t.get=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-g11n/lib/globalization",["require","exports","swx-browser-globals","./formatter","./settings"],e)}(function(e,t){function s(e){i.set(e)}function o(e){var t=n.getDocument().documentElement;t.dir?f(e,t.dir):i.get().dir&&f(e,i.get().dir)}function u(e,t){var n=i.get().time.format[t];n||(n=i.get().date.format[t]);if(!n)throw new Error("No format found with a key:"+t+"in settings of:"+JSON.stringify(i.get().date.format));return r.formatDate(e,n,i.get())}function a(e,t){var n=i.get().time.format[t];if(!n)throw new Error("No format found with a key:"+t+"in settings of:"+JSON.stringify(i.get().time.format));return r.formatDuration(e,n)}function f(e,t){e.dir||(e.dir=t)}var n=e("swx-browser-globals"),r=e("./formatter"),i=e("./settings");t.init=s,t.initLocaleDirection=o,t.formatDate=u,t.formatDuration=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-g11n/lib/index",["require","exports","./formatter","./globalization","./settings"],e)}(function(e,t){var n=e("./formatter");t.formatter=n;var r=e("./globalization");t.globalization=r;var i=e("./settings");t.settings=i}),define("swx-g11n",["swx-g11n/lib/index"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-pubsub/lib/pubSub",["require","exports"],e)}(function(e,t){function n(e){for(var t in e)if(!e[t])throw new Error(t+" is mandatory")}function r(e,t){return t&&t.indexOf(e)>=0}function i(e,t){if(!t||!r(e,t))return;t.splice(t.indexOf(e),1)}function o(){return new s}var s=function(){function e(){this.callbacks={},this.bulkHandlers=[]}return e.prototype.addBulkSubscriber=function(e){n({callback:e}),r(e,this.bulkHandlers)||this.bulkHandlers.push(e)},e.prototype.removeBulkSubscriber=function(e){n({callback:e}),i(e,this.bulkHandlers)},e.prototype.subscribe=function(e,t){n({eventName:e,callback:t}),this.callbacks[e]=this.callbacks[e]||[],r(t,this.callbacks[e])||this.callbacks[e].push(t)},e.prototype.unsubscribe=function(e,t){n({eventName:e,callback:t});var r=this.callbacks[e];i(t,r)},e.prototype.publish=function(e,t){t===void 0&&(t=null),n({eventName:e});if(this.callbacks[e]){var r=this.callbacks[e].slice(0);for(var i=r.length-1;i>=0;i--)r[i](t)}this.bulkHandlers.slice(0).reverse().forEach(function(n){return n(e,t)})},e.prototype.unsubscribeAll=function(){this.callbacks={},this.bulkHandlers=[]},e}();t.__esModule=!0,t["default"]=s,t.build=o}),define("swx-pubsub",["swx-pubsub/lib/pubSub"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-pubsub-instance/lib/instance",["require","exports","swx-pubsub"],e)}(function(e,t){var n=e("swx-pubsub");t.__esModule=!0,t["default"]=n.build()}),define("swx-pubsub-instance",["swx-pubsub-instance/lib/instance"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-chat/lib/dateTime",["require","exports","swx-i18n","swx-g11n","swx-constants","swx-browser-globals","swx-pubsub-instance"],e)}(function(e,t){function d(e){return e===0||e>0&&e!==!0}function v(e,n){var i=t.getDate(e);return r.globalization.formatDate(i,n)}function m(e,t){var n=c.time.SHORT,r=e<E(6,t),i=e<t;return r?n=c.date.DAY_MONTH:i&&(n=c.date.DAY_ABBREVIATION),n}function g(e){var n=t.getDate(e).getFullYear(),r=t.getDate().getFullYear();return n===r?c.date.SHORT_DATE_ABBREVIATION:c.date.DATE_ABBREVIATION}function y(){var e=t.getDate(),n=e.getTime(),r=e.setHours(24,0,0,0);return r-n}function b(){var e=t.getDate();e.setHours(0,0,0,0);var n=p<e;return n&&(p=e),n}function w(){s.getWindow().setTimeout(function(){b()&&o["default"].publish(h,null),w()},y()+u)}function E(e,n){n===void 0&&(n=null);var r=n?t.getDate(n):t.getDate(),i=r.setDate(r.getDate()-e);return t.getDate(i).setHours(0,0,0,0)}var n=e("swx-i18n"),r=e("swx-g11n"),i=e("swx-constants"),s=e("swx-browser-globals"),o=e("swx-pubsub-instance"),u=1e3,a=u*60,f=a*60,l=f*24,c=i.COMMON.globalizationFormatKeys,h=i.COMMON.events.system.DATE_CHANGED,p;t.amNotifyingDayChange=!1,t.now=function(){return s.getWindow().Date.now()},t.getDate=function(e){e===void 0&&(e=null);var t=s.getWindow().Date;return e!==null?new t(e):new t},t.formatDate=function(e){return d(e)?v(e,g(e)):""},t.formatTimestampShort=function(e){return d(e)?v(e,c.time.SHORT):""},t.formatTimestamp=function(e,n){n===void 0&&(n=null);if(d(e)){var r=n||t.getMidnight(t.getDate().getTime()),i=m(e,r);return v(e,i)}return""},t.formatTimestampLong=function(e,r){r===void 0&&(r=null);if(d(e)){var i=t.formatTimestampShort(e),s=r||t.getMidnight(t.getDate().getTime());return e<s?n.localization.fetch({key:"message_text_longTimeStamp",params:{date:t.formatDate(e),time:i}}):i}return""},t.formatTimestampForceLong=function(e){if(d(e)){var r=t.formatTimestampShort(e);return n.localization.fetch({key:"message_text_longTimeStamp",params:{date:t.formatDate(e),time:r}})}return""},t.getDateGroup=function(e){if(d(e)){var i=t.getDate(e),s=t.getMidnight(e),o=t.getDate().setHours(0,0,0,0),u=E(1),a=E(7);return s===o?n.localization.fetch({key:"today"}):s===u?n.localization.fetch({key:"yesterday"}):s<a?n.localization.fetch({key:"olderThanAWeek"}):r.globalization.formatDate(i,c.date.DAY_NAME)}return""},t.getMidnight=function(e){return d(e)?t.getDate(e).setHours(0,0,0,0):0},t.formatCallDuration=function(e){return r.globalization.formatDuration(e,c.time.CALL_DURATION)},t.notifyOnDayChange=function(){t.amNotifyingDayChange||(t.amNotifyingDayChange=!0,p=t.getDate(),p.setHours(0,0,0,0),w())},t.getTimeSinceTimestamp=function(e,r){r===void 0&&(r=null),r=r||{},r.now=r.now||t.now(),r.key=r.key||"duration";if(e&&d(e.getTime())&&d(r.now)){var i=r.now-e.getTime();return Math.floor(i/l)>0?n.localization.fetch({key:r.key+"_days",count:Math.floor(i/l),params:r.params}):Math.floor(i/f)>0?n.localization.fetch({key:r.key+"_hours",count:Math.floor(i/f),params:r.params}):Math.floor(i/a)>0?n.localization.fetch({key:r.key+"_minutes",count:Math.floor(i/a),params:r.params}):n.localization.fetch({key:r.key+"_moment",params:r.params})}return""}}),function(e){var t=typeof window=="undefined"?null:window;typeof define=="function"&&define.amd?define("dompurify/src/purify",[],function(){return e(t)}):typeof module!="undefined"?module.exports=e(t):t.DOMPurify=e(t)}(function factory(e){var t=function(e){return factory(e)};t.version="0.7.3";if(!e||!e.document||e.document.nodeType!==9)return t.isSupported=!1,t;var n=e.document,r=n,i=e.DocumentFragment,s=e.HTMLTemplateElement,o=e.NodeFilter,u=e.NamedNodeMap||e.MozNamedAttrMap,a=e.Text,f=e.Comment,l=e.DOMParser;typeof s=="function"&&(n=n.createElement("template").content.ownerDocument);var c=n.implementation,h=n.createNodeIterator,p=n.getElementsByTagName,d=n.createDocumentFragment,v=r.importNode,m={};t.isSupported=typeof c.createHTMLDocument!="undefined"&&n.documentMode!==9;var g=function(e,t){var n=t.length;while(n--)e[t[n]]=!0;return e},y=function(e){var t={},n;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},b=null,w=g({},["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr","svg","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","switch","symbol","text","textpath","title","tref","tspan","view","vkern","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","feSpecularLighting","feTile","feTurbulence","math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmuliscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mpspace","msqrt","mystyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","#text"]),E=null,S=g({},["accept","action","align","alt","autocomplete","background","bgcolor","border","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","coords","datetime","default","dir","disabled","download","enctype","face","for","headers","height","hidden","high","href","hreflang","id","ismap","label","lang","list","loop","low","max","maxlength","media","method","min","multiple","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","rows","rowspan","spellcheck","scope","selected","shape","size","span","srclang","start","src","step","style","summary","tabindex","title","type","usemap","valign","value","width","xmlns","accent-height","accumulate","additivive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mode","min","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","surfacescale","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","u1","u2","unicode","values","viewbox","visibility","vert-adv-y","vert-origin-x","vert-origin-y","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","y","y1","y2","z","zoomandpan","accent","accentunder","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","display","displaystyle","fence","frame","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),x=null,T=null,N=!0,C=!1,k=!1,L=!1,A=!1,O=!1,M=!1,_=!0,D=!0,P=g({},["audio","head","math","script","style","svg","video"]),H=null,B=n.createElement("form"),j=function(e){typeof e!="object"&&(e={}),b="ALLOWED_TAGS"in e?g({},e.ALLOWED_TAGS):w,E="ALLOWED_ATTR"in e?g({},e.ALLOWED_ATTR):S,x="FORBID_TAGS"in e?g({},e.FORBID_TAGS):{},T="FORBID_ATTR"in e?g({},e.FORBID_ATTR):{},N=e.ALLOW_DATA_ATTR!==!1,C=e.SAFE_FOR_JQUERY||!1,k=e.SAFE_FOR_TEMPLATES||!1,L=e.WHOLE_DOCUMENT||!1,A=e.RETURN_DOM||!1,O=e.RETURN_DOM_FRAGMENT||!1,M=e.RETURN_DOM_IMPORT||!1,_=e.SANITIZE_DOM!==!1,D=e.KEEP_CONTENT!==!1,O&&(A=!0),e.ADD_TAGS&&(b===w&&(b=y(b)),g(b,e.ADD_TAGS)),e.ADD_ATTR&&(E===S&&(E=y(E)),g(E,e.ADD_ATTR)),D&&(b["#text"]=!0),Object&&"freeze"in Object&&Object.freeze(e),H=e},F=function(e){try{e.parentNode.removeChild(e)}catch(t){e.outerHTML=""}},I=function(e){var t,n;try{t=(new l).parseFromString(e,"text/html")}catch(r){}return t||(t=c.createHTMLDocument(""),n=t.body,n.parentNode.removeChild(n.parentNode.firstElementChild),n.outerHTML=e),typeof t.getElementsByTagName=="function"?t.getElementsByTagName(L?"html":"body")[0]:p.call(t,L?"html":"body")[0]},q=function(e){return h.call(e.ownerDocument||e,e,o.SHOW_ELEMENT|o.SHOW_COMMENT|o.SHOW_TEXT,function(){return o.FILTER_ACCEPT},!1)},R=function(e){return e instanceof a||e instanceof f?!1:typeof e.nodeName=="string"&&typeof e.textContent=="string"&&typeof e.removeChild=="function"&&e.attributes instanceof u&&typeof e.removeAttribute=="function"&&typeof e.setAttribute=="function"?!1:!0},U=/\{\{.*|.*\}\}/gm,z=/<%.*|.*%>/gm,W=function(e){Q("beforeSanitizeElements",e,null);if(R(e))return F(e),!0;var t=e.nodeName.toLowerCase();Q("uponSanitizeElement",e,{tagName:t});if(!b[t]||x[t]){if(D&&!P[t]&&typeof e.insertAdjacentHTML=="function")try{e.insertAdjacentHTML("AfterEnd",e.innerHTML)}catch(n){}return F(e),!0}C&&!e.firstElementChild&&(!e.content||!e.content.firstElementChild)&&(e.innerHTML=e.textContent.replace(/</g,"&lt;"));if(k&&e.nodeType===3){var r=e.textContent;r=r.replace(U," "),r=r.replace(z," "),e.textContent=r}return Q("afterSanitizeElements",e,null),!1},X=/^data-[\w.\u00B7-\uFFFF-]/,V=/^(?:\w+script|data):/i,$=/[\x00-\x20\xA0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,J=function(t){Q("beforeSanitizeAttributes",t,null);var r=t.attributes;if(!r)return;var i={attrName:"",attrValue:"",keepAttr:!0},s=r.length,o,u,a,f,l;while(s--){o=r[s],u=o.name,a=o.value,f=u.toLowerCase(),i.attrName=f,i.attrValue=a,i.keepAttr=!0,Q("uponSanitizeAttribute",t,i),a=i.attrValue,f==="name"&&t.nodeName==="IMG"&&r.id?(l=r.id,r=Array.prototype.slice.apply(r),t.removeAttribute("id"),t.removeAttribute(u),r.indexOf(l)>s&&t.setAttribute("id",l.value)):(u==="id"&&t.setAttribute(u,""),t.removeAttribute(u));if(!i.keepAttr)continue;if(_&&(f==="id"||f==="name")&&(a in e||a in n||a in B))continue;if((E[f]&&!T[f]||!k&&N&&X.test(f))&&(!V.test(a.replace($,""))||f==="src"&&a.indexOf("data:")===0&&t.nodeName==="IMG"))try{k&&(a=a.replace(U," "),a=a.replace(z," ")),t.setAttribute(u,a)}catch(c){}}Q("afterSanitizeAttributes",t,null)},K=function(e){var t,n=q(e);Q("beforeSanitizeShadowDOM",e,null);while(t=n.nextNode()){Q("uponSanitizeShadowNode",t,null);if(W(t))continue;t.content instanceof i&&K(t.content),J(t)}Q("afterSanitizeShadowDOM",e,null)},Q=function(e,n,r){if(!m[e])return;m[e].forEach(function(e){e.call(t,n,r,H)})};return t.sanitize=function(n,s){n||(n=""),typeof n!="string"&&(n=n.toString());if(!t.isSupported)return typeof e.toStaticHTML=="object"||typeof e.toStaticHTML=="function"?e.toStaticHTML(n):n;j(s);if(!A&&!L&&n.indexOf("<")===-1)return n;var o=I(n);if(!o)return A?null:"";var u,a,f=q(o);while(u=f.nextNode()){if(u.nodeType===3&&u===a)continue;if(W(u))continue;u.content instanceof i&&K(u.content),J(u),a=u}var l;if(A){if(O){l=d.call(o.ownerDocument);while(o.firstChild)l.appendChild(o.firstChild)}else l=o;return M&&(l=v.call(r,l,!0)),l}return L?o.outerHTML:o.innerHTML},t.addHook=function(e,t){if(typeof t!="function")return;m[e]=m[e]||[],m[e].push(t)},t.removeHook=function(e){m[e]&&m[e].pop()},t.removeHooks=function(e){m[e]&&(m[e]=[])},t.removeAllHooks=function(){m=[]},t}),define("dompurify",["dompurify/src/purify"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-chat/lib/messageSanitizer",["require","exports","lodash-compat","swx-cafe-application-instance","swx-constants","swx-encoder","swx-encoder","swx-encoder","swx-service-locator-instance","swx-utils-common","dompurify","./dateTime"],e)}(function(e,t){function I(e,t,n){return n===void 0&&(n=!1),new RegExp("((?:&lt;"+e+' raw_pre="'+t+'"'+(n?"":' raw_post="'+t+'"')+"&gt;)+)([\\s\\S]*?)((?:&lt;/"+e+"&gt;)+)","gi")}function q(e,t,n){var r='<{0} raw_pre="{1}" raw_post="{1}">{2}</{0}>';return r.split("{0}").join(e).split("{1}").join(t).split("{2}").join(n)}function R(){var e="^(https?://)?",t="(([0-9a-z_!~*'()\\.&=+$%-]+:)?[0-9a-z_!~*'()\\.&=+$%-]+@)?",n="(\\d{1,2}|1\\d{2}|2[0-4]\\d|25[0-5])",r="("+n+"\\.){3}"+n,i="([0-9a-z][0-9a-z_-]*)?[0-9a-z]",s="("+i+"\\.)+(com|org|net|edu|gov|mil|aero|arpa|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|pro|tel|travel|[a-z]{2})",o="(:\\d{1,5})?",u="([#/].*)?$",a=[e+t+s+o+u,e+t+r+o+u,e+t+i+o+u];return a.map(function(e){return new RegExp(e,"i")})}function U(e){return B[e]}function z(e){return e.replace(/([<>])/gi,U)}function W(e){return e.replace(/(&lt;|&gt;)/gi,U)}function X(e){return e.replace(/([<>&"'])/gi,U)}function V(e){return e.replace(/&(lt|gt|amp|quot|apos|#39|#96);/gi,U)}function $(e,t){return e.replace(t,W)}function J(e){function o(e,t){return r[n]=t,e.replace(t,"DUMMY"+n++)}function f(e,n){t=t.replace("DUMMY"+n,e)}var t,n=0,r=[],i=new RegExp(d,"gi"),s=new RegExp(d,"i"),u=i.exec(e);if(!u)return e;var a=e;while(u){var l=u[0].match(s).splice(1);t=l.reduce(o,u[0]),t=W(t),r.forEach(f),a=a.replace(u[0],t),u=i.exec(e)}return a}function K(e){var t=e.match(S).slice(1);return t.reduce($,e)}function Q(e,t){var n=/(<a|&lt;a)/;return e.search(f.regex.escapeSpecialChars(t))>-1?e:e.replace(n,function(e){return e+" "+t})}function G(e,t,n,r,i){var s,o;return s=W(t),o=W(i),n.indexOf(j)!==0&&(s=Q(s,'target="_blank"')),s=Q(s,'tabindex="-1"'),s=Q(s,'title="'+n+'"'),s+r+o}function Y(e,t){var n="&lt;",r=/(\+?[\s\d\-]*\d)&lt;/i,i=t.match(r)[0];return i.slice(0,i.length-n.length)}function Z(e){return X(e.replace(p,G))}function et(e){return V(e.replace(p,G))}function tt(e){return e.replace(/<a(:?>|\s.*?>)/g,"").replace(/<\/a>/g,"")}function nt(e){function t(e,t){return e.replace(A[t],"")}return Object.keys(A).reduce(t,e)}function rt(e){function t(e,t,n,r,i){var s=H[e]||H["default"];return e==="rawFontColor"&&(n=n.replace(/font(\s+)color/i,"font color")),W(n.substr(0,s.opening))+r+W(i.substr(0,s.closing))}function n(e,n){return e.replace(D[n],t.bind(null,n))}return Object.keys(D).reduce(n,e)}function it(e,t){function u(){return t&&Object.keys(t).length>0&&!f(e)&&e.length>1}function a(e){return t[e]!==undefined}function f(e){return!e||!/\S/.test(e)}function l(e,t){var n;for(var r=0;r<e.length;r++){n=e[r];if(t!==undefined&&t.length>0&&t.indexOf(n)!==-1)continue;return n===" "}return!0}function c(e){return e.split("").reverse().join("")}function h(e,t,n){var r=[",",".",";",":","?","!","(",")"];return a(t)?l(c(e),r)||l(n,r):!1}function p(e,t,r,i){var s=[",",".",";",":","?","!","(",")"];return r!==e||n.first(i)===e?!1:l(c(t),s)||l(i,s)}function d(e,t,n){for(var r=t;r<=e.length;r++)if(n(e.substring(0,r),e[r],e.substring(r+1,e.length)))return r;return-1}function v(e,t,n){var r=t,i,s;do{r+=1,i=d(e,r,p.bind(null,n));if(i===-1)return-1;s=e.substring(t+1,i)}while(f(s));return i}var r=0,i,s,o;if(!u())return[];do{if(r>=e.length-1)return[];i=d(e,r,h);if(i===-1)return[];o=e.charAt(i),s=v(e,i,o),t=n.omit(t,o),r+=1}while(s===-1);return[i,s]}function st(e,t){var r=it(t,e),i=r[0],s=r[1],o,u,a,f,l,c,h;return i===undefined||s===undefined||i<0||s<0?t:(o=t.charAt(i),u=e[o],h=t.substring(0,i),a=t.substring(i+1,s),l=t.substring(s+1),f=st(n.omit(e,o),a),f=u(f),c=st(e,l),h+f+c)}function ot(e){var t=e.split(/\r?\n/),r;return r=n.map(t,function(e){return st(P,e)}),r.join("\r\n")}function ut(e,t){function r(e){function n(e){return e.test(t)}var t=e.replace(/[\u0080-\u9999]/g,"z");return M.some(n)}function i(e){return e.replace(/(["''])/gi,U)}function s(e,s){return r(s)?(s=i(s),n=/^w{3}\./i.test(s)?"http://"+s:s,"<a"+(t?"":' tabindex="-1" target="_blank"')+' href="'+n+'">'+s+"</a>"):s}function o(e,t){return r(t)?'<a href="mailto:'+t+'">'+t+"</a>":t}t===void 0&&(t=!1);var n;return e.replace(O,s).replace(v,o)}function at(e,t,n){var r=z(e.replace(/&/g,"&amp;")),i=r.match(t),s;return i?i.forEach(function(e,t){var o=r.indexOf(e),u=o+e.length,a=i[t+1];t===0&&(s=n(r.substring(0,o))),s+=r.substring(o,u),r=r.substring(u);var f=a?r.indexOf(a):undefined;s+=n(r.substring(0,f))}):s=n(r),W(s.replace(/&amp;/g,"&"))}function ft(e){return l.sanitize(e,{ALLOWED_TAGS:[]})}function lt(e){l.addHook("beforeSanitizeElements",function(e,t,n){yt(e,"legacyquote")}),l.addHook("beforeSanitizeAttributes",function(e,t,n){gt(e,"target","_blank"),bt(e,"authorname","quote")}),l.addHook("afterSanitizeAttributes",function(e,t,n){var r=wt(e,"href");r&&(gt(e,"rel","noreferrer noopener"),gt(e,"onclick","return false;"),gt(e,"title",r))});var t=l.sanitize(e,F);return l.removeHook("beforeSanitizeElements"),l.removeHook("beforeSanitizeAttributes"),l.removeHook("afterSanitizeAttributes"),t.replace("&nbsp;"," ")}function ct(e){var t=a["default"].resolve(i.COMMON.serviceLocator.FEATURE_FLAGS),n=t.isFeatureOn(i.COMMON.featureFlags.INCOMING_WIKI_MARKUP),r=z(e);return r=r.replace(E,K),r=r.replace(x,W),r=J(r),r=r.replace(p,G),r=r.replace(m,Y),n?rt(r):r}function ht(e){return z(e).replace(/&lt;ss type="[^"]*"&gt;/gi,W).replace(/&lt;\/ss&gt;/gi,W).replace(T,W)}function pt(e){var t=u.NoTranslateDomTransformer.build(u.NoTranslateDomTransformer.Mode.Remove),n=s.build(r,{domTransformers:[t]});return n.encode(e,!1)}function dt(e){var t=/(\r?\n)|(&lt;br\s?\/&gt;)/gm,n="<br/>";return e.replace(t,n)}function vt(e){var t=new RegExp(_,"gi"),n=new RegExp(_,"i"),r=e,i=t.exec(e);while(i){var s=n.exec(i[0]);s&&(r=r.replace(s[0],s[2])),i=t.exec(e)}return r}function mt(e){var t=/^<pre\s/,n=/^!!|\{code}/,i=o.CodeSnippetDecoder.build(),u=o.CodeSnippetEncoder.build(),a=!t.test(e)&&n.test(e),f=e!==undefined&&a?s.build(r,{domTransformers:[u]}).encode(e):e,h=f!==undefined?s.build(r,{domDecoders:[i]}).decode(f):e,p=lt(h),d=o.QuoteDecoder.build(c.formatTimestampLong),v=s.build(r,{domDecoders:[d]}).decode(p),m=v.replace(g,Y),y=nt(m),b=l.sanitize(y,{ADD_ATTR:["target","rel","onclick","title","author","role","raw_pre","raw_post"],ADD_TAGS:["at"]}),w=dt(b);return w.replace(/&nbsp;/g," ")}function gt(e,t,n){return e&&e.tagName&&e.tagName.toLowerCase()==="a"&&(e.hasAttribute(t)||e.setAttribute(t,n)),e}function yt(e,t){return e&&e.nodeName&&e.nodeName.toLowerCase()===t&&(e.innerHTML=n.escape(e.innerHTML)),e}function bt(e,t,r){return e&&e.tagName&&e.tagName.toLowerCase()===r&&e.hasAttribute(t)&&e.setAttribute(t,n.escape(e.getAttribute(t))),e}function wt(e,t){return e&&e.tagName&&e.tagName.toLowerCase()==="a"&&e.hasAttribute(t)?e.getAttribute(t):null}function Et(e){var t=o.MarkupDecoder.build(),n=o.MentionDecoder.build(),i=o.CodeSnippetDecoder.build(),u=s.build(r,{domTransformers:[t,n,i]}),a=u.encode(e,!1);return a=vt(a),a}function St(e){return e.replace(String.fromCharCode(11),"")}function xt(e,t){t===void 0&&(t=null),e=e.trim(),e=St(e);var n=s.URLDomTransformer.build(!0);return e=s.build(r,{conversation:t,domTransformeExtensions:[n]}).encode(e,!0),e=ot(e),e}function Tt(e,t){t===void 0&&(t=null);var n=xt(e,t),i=u.NoTranslateDomTransformer.build(u.NoTranslateDomTransformer.Mode.Add),o=s.build(r,{domTransformers:[i]});return o.encode(n,!1)}function Nt(e){var t=u.NoTranslateDomTransformer.build(u.NoTranslateDomTransformer.Mode.Add),n=s.build(r,{domTransformers:[t]});return n.encode(e,!1)}function Ct(e,t){var r=n.isArray(t)?t:[t];return n.each(r,function(t){e=e.replace(t,"")}),e=e.trim(),!e}function kt(e){var t=/<at id="(.*?)">.*?<\/at>/g,n=/<i class="(.*?)"><span title="(.*?)">.*?<\/span><\/i>/g;return Ct(e,[t,n])}function Lt(e){return Ct(e,[N,C,w,k,L])}function At(e){var t=o.EmoticonEncoder.build(),n=s.URLDomTransformer.build(),i=s.NewLineDomTransformer.build(),u=s.FlagDomTransformer.build(),a=o.MentionEncoder.build(null),f=o.QuoteDecoder.build(c.formatTimestampLong),h=s.build(r,{domTransformers:[u,t,n,i,a],domDecoders:[f]}),p=h.encode(e),d=h.decode(p),v=l.sanitize(d,{ADD_ATTR:["target","rel","onclick"]});return v}function Mt(e,t,n,r){r===void 0&&(r=null);var i=Ot[t]&&Ot[t][n];if(i)return i(e,r);throw new Error("Encoder from "+t+" to "+n+" is not available")}function _t(e){return z(e).replace(p,G)}function Dt(e){function t(e){var t=s.build(r);return t.decode(t.encode(e))}return at(e,E,t)}function Pt(e){var t=s.build(r),n=t.encode(e,!1);return t.decode(n)}function Ht(e){return at(e,p,ut)}function Bt(e){function i(e,t){var r=t.match(n)[1]||"",i=r.replace("&amp;","&");return e.replace(t,i)}var t=/(<a.*?<\/a>)/gi,n=/href="(.*?)"/i,r=e.match(t)||[];return r.reduce(i,e)}function jt(e){var t="\r\n",n=/<br\s*\/?>/g;return e.replace(n,t)}function Ft(e){return et(tt(e))}function It(e){var t=[],n=/(?:<ss type=")(\w+)">/g,r;while(r=n.exec(e)){var i=r[1];t.push(i)}return t}function qt(e){return s.build(r).encode(e)}function Rt(e){var t=/<div class=["\']quotedText["\'']>.*[\S\s]*<\/div>/ig,r=t.exec(e);return n.isUndefined(r)||n.isNull(r)?"":r[0]}function Ut(e){var t=/<quote.*[\S\s]*<\/quote>/ig,r=t.exec(e);return n.isUndefined(r)||n.isNull(r)?"":r[0]}function zt(e){var t=jt(e);return t=s.build(r).getNodeTextContent(t),t=Bt(t),t}var n=e("lodash-compat"),r=e("swx-cafe-application-instance"),i=e("swx-constants"),s=e("swx-encoder"),o=e("swx-encoder"),u=e("swx-encoder"),a=e("swx-service-locator-instance"),f=e("swx-utils-common"),l=e("dompurify"),c=e("./dateTime"),h='(?:(?:\\s*title="[^"]+?"\\s*)|(?:\\s*tabindex="-1"\\s*)|(?:\\s*target="_blank"\\s*)){0,3}',p=f.regex.multilineRegExp(["(&lt;a ",h,'href="((?:https?://|mailto:)[^"]+?)"',h,"&gt;)","((?:(?!&lt;/a&gt;)[\\s\\S])*)","(&lt;/a&gt;)"],"gi"),d='&lt;i class="'+i.COMMON.mentions["class"]+'"&gt;&lt;span title="(.*?)"&gt;(.*?)&lt;/span&gt;&lt;/i&gt;',v=/((([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,}))/gi,m=/(&lt;a href="skype:\+\d+"&gt;(\+?[\s\d\-]*\d)&lt;\/a&gt;)/gi,g=/(<a href="skype:\+\d+">(\+?[\s\d\-]*\d)<\/a>)/gi,y=["(",'&lt;span class="emoticon [a-z0-9]+\\s?(?:animated)?\\s?\\s?(?:large|extraLarge)?\\s?"&gt;','&lt;span class="emoSprite"&gt;',"|",'&lt;span class="emoticon\\s?(?:large|extraLarge)?\\s?"&gt;','&lt;canvas(?:\\s?(?:data-[-a-z]*|height|width)="[a-z0-9]*")*&gt;',")","(?:.+?)","(","&lt;/span&gt;&lt;/span&gt;","|","&lt;/canvas&gt;&lt;/span&gt;",")"],b=["(?:",'<span class="emoticon [a-z0-9]+\\s?(?:animated)?\\s?\\s?(?:large|extraLarge)?\\s?">','<span class="emoSprite">',"|",'<span class="emoticon\\s?(?:large|extraLarge)?\\s?">','<canvas(?:\\s?(?:data-[-a-z]*|height|width)="[a-z0-9]*")*>',")","(?:.+?)","(?:","</span></span>","|","</canvas></span>",")"],w=f.regex.multilineRegExp(b,"gi"),E=f.regex.multilineRegExp(y,"gi"),S=f.regex.multilineRegExp(y,"i"),x=/&lt;span class="flag ([^"]{2})"&gt;[\s]*\(flag:\1\)[\s]*&lt;\/span&gt;/gi,T=/&lt;flag country="([^"]{2})"&gt;[\s]*\(flag:\1\)[\s]*&lt;\/flag&gt;/gi,N=/<ss type="\w+">.*?<\/ss>/g,C=/<flag country="[\w+]{2}">(?:.+?)<\/flag>/gi,k=/<span class="flag [^"]{2}">(?:.+?)<\/span>/gi,L=/(<(?:\/?)(?:quote|legacyquote)[^>]*>)/gi,A={text:/Edited previous message: /,edited:/<e_m [^<>]+>/g,editedEnd:/<\/e_m>/g,quoted:L},O=/\b((https?:\/\/|w{3}\.)\S+)/gi,M=R(),_='<ss type="(.*?)">(.*?)</ss>',D={bold:I("b","\\*"),italic:I("i","_"),strike:I("s","~"),rawBold:new RegExp("(&lt;b&gt;)(.*?)(&lt;/b&gt;)","gi"),rawItalic:new RegExp("(&lt;i&gt;)(.*?)(&lt;/i&gt;)","gi"),rawFontColor:new RegExp('(&lt;font\\s+color="#[a-f0-9]{6}"&gt;)(.*?)(&lt;/font&gt;)',"gi")},P={"*":function(e){return q("b","*",e)},_:function(e){return q("i","_",e)},"~":function(e){return q("s","~",e)}},H={code:{opening:46,closing:12},codeBlock:{opening:25,closing:12},rawBold:{opening:9,closing:10},rawItalic:{opening:9,closing:10},rawFontColor:{opening:28,closing:13},"default":{opening:34,closing:10}},B={"<":"&lt;",">":"&gt;","&lt;":"<","&gt;":">","&LT;":"<","&GT;":">","&":"&amp;",'"':"&quot;","'":"&apos;","&amp;":"&","&quot;":'"',"&apos;":"'","&#39;":"'","&#96;":"`","&AMP;":"&","&QUOT;":'"',"&APOS;":"'"},j="mailto:",F={ALLOWED_ATTR:["href","target","type","country","id","authorname","timestamp","author","raw_pre","raw_post"],ALLOWED_TAGS:["b","i","s","u","a","ss","flag","at","pre","quote","legacyquote","br","pre"]};t.escapeHTML=Z,t.unescapeHTML=et,t.removeAnchorTags=tt,t.removeMetaData=nt,t.handleWikiMarkup=rt,t.stripHTML=ft,t.escapeIncomingXml=lt,t.escapeIncomingHTML=ct,t.escapeOutgoingHTML=ht,t.removeNoTranslateTags=pt,t.webify=dt,t.getMessageSanitizedContent=mt,t.compactHtml=Et,t.processOutgoingTextMessage=xt,t.processOutgoingTextMessageForTranslation=Tt,t.processIncomingSanitizedTextMessageForTranslation=Nt,t.isMessageWithMentionOnly=kt,t.isMessageWithEmoticonsOnly=Lt;var Ot={"text/typed":{"text/html":At}};t.transform=Mt,t.validateUnescapedLink=_t,t.encodeEmoticonsTextRepresentation=Dt,t.encodeEmoticonsRawRepresentation=Pt,t.encodeLinkTextRepresentation=Ht,t.unboxHrefContent=Bt,t.unwebify=jt,t.getSanitizedTopic=Ft,t.getEmoticonNamesFromMessage=It,t.encode=qt,t.quotesPresentInHTML=Rt,t.quotesPresentInXML=Ut,t.extractMessageTextContent=zt}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-chat/lib/sort",["require","exports"],e)}(function(e,t){function n(e,t){return e.id-t.id}function r(e,t){return e.timestamp-t.timestamp}function i(e,t){return t.timestamp-e.timestamp}t.byId=n,t.byTimestamp=r,t.byTimestampDescending=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-chat/lib/spaceMail",["require","exports","swx-i18n"],e)}(function(e,t){function r(){return encodeURI(n.localization.fetch({key:"spaces_email_subject"}))}function i(e,t){var r=n.localization.fetch({key:"spaces_email_greeting"}),i=n.localization.fetch({key:"spaces_email_joinMe",params:{spaceName:e}}),s=n.localization.fetch({key:"spaces_email_link"});return encodeURI(r+"\r\n\r\n"+i+"\r\n"+s+" "+t)}function s(e,t){return"mailto:?subject="+r()+"&body="+i(e,t)}var n=e("swx-i18n");t.createMailtoLink=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-chat/lib/urlParser",["require","exports"],e)}(function(e,t){function n(e,t){var n=decodeURIComponent(e),r=new RegExp("("+t+")=([^&]+)"),i=n.match(r);return i&&i[2]?i[2]:undefined}function r(e){e===void 0&&(e=null);var t=new RegExp("index[^#]*#(.+)/"),n=e&&e.match(t);return n&&n[1]?n[1]:undefined}function i(e){return/^https:/.test(e)}function s(e){var t=/(?:youtube\.com|youtu\.be)\/watch(?:\?|\&|&amp;)v=([\w-]{11})/.exec(e);return t||(t=/(?:youtube\.com|youtu\.be)\/([\w-]{11})/.exec(e)),t?!0:!1}t.getParam=n,t.getRoute=r,t.isHttps=i,t.isYoutubeLink=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-chat/lib/urlValidator",["require","exports","lodash-compat","swx-constants"],e)}(function(e,t){function o(e,t){t===void 0&&(t=null);if(!e)return!1;var r=n.clone(s);t&&n.extend(r,t);var i=l(e);return i?!n.isEmpty(r.allowedProtocols)&&!n.some(r.allowedProtocols,function(e){return f(e)(i.scheme)})?!1:!n.isEmpty(r.allowedDomains)&&!n.some(r.allowedDomains,function(e){return f(e)(i.host)})?!1:!n.isEmpty(r.allowedPorts)&&!n.some(r.allowedPorts,function(e){return f(e)(i.port)})?!1:!0:!1}function u(e){return e.toString().replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function a(e){var t=u(e);return t=t.replace("\\*\\*","[^\\/]*"),t=t.replace("\\*","[^.\\/]*"),t=t.replace("\\?","."),"^"+t+"$"}function f(e){if(n.isUndefined(e))throw new Error("`undefined` is not a valid argument");return e===t.ALLOW_EMPTY?n.isUndefined:n.isFunction(e)?e:(n.isRegExp(e)||(e=new RegExp(a(e),"i")),e.test.bind(e))}function l(e){e=e.toString().trim();var t=e.split("#",2)[1];e=e.split("#",2)[0];var n=i.exec(e);return n&&{scheme:n[1],user:n[2],host:n[3],port:n[4],path:n[5],query:n[6],hash:t}}var n=e("lodash-compat"),r=e("swx-constants"),i=/^(?:([^:\/?#]+):)?(?:\/\/(?:([\S][^\/]*)(?:[\@]))?([^\/\\?:#]*)(?:\:(\d*)?)?)?([^?#]*)(?:(?:\?)([^#]*))?(?:#(.*))?/;t.ALLOW_EMPTY=r.COMMON.urlValidator.ALLOW_EMPTY;var s={allowedDomains:["**"],allowedProtocols:[t.ALLOW_EMPTY,"http","https"],allowedPorts:[t.ALLOW_EMPTY]};t.validate=o,t.$unit={escapeRegExp:u,wildcardToRegExp:a,asMatcher:f,explodeURL:l}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-chat/lib/participant",["require","exports"],e)}(function(e,t){function n(e,t){return t.mePerson.id()===e.person.id()}t.isMeParticipant=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-chat/lib/index",["require","exports","./conversation","./conversationCache","./dateTime","./messageSanitizer","./sort","./spaceMail","./urlParser","./urlValidator","./participant"],e)}(function(e,t){var n=e("./conversation");t.conversation=n;var r=e("./conversationCache");t.conversationCache=r;var i=e("./dateTime");t.dateTime=i;var s=e("./messageSanitizer");t.messageSanitizer=s;var o=e("./sort");t.sort=o;var u=e("./spaceMail");t.spaceMail=u;var a=e("./urlParser");t.urlParser=a;var f=e("./urlValidator");t.urlValidator=f;var l=e("./participant");t.participant=l}),define("swx-utils-chat",["swx-utils-chat/lib/index"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-people/lib/userDataProcessor",["require","exports","swx-cafe-application-instance","swx-encoder","swx-utils-chat","lodash-compat"],e)}(function(e,t){function u(e){if(s.isString(e)){var t=r.build(n),u=e;if(e.match(o)===null){var a=i.messageSanitizer.escapeIncomingHTML(e);u=t.encode(a,!1)}return i.messageSanitizer.escapeIncomingHTML(t.decode(u))}return""}function a(e){return s.isString(e)?s.escape(e):""}function f(e){return s.isString(e)?i.messageSanitizer.removeAnchorTags(e):""}var n=e("swx-cafe-application-instance"),r=e("swx-encoder"),i=e("swx-utils-chat"),s=e("lodash-compat"),o=/(<flag country="\S+">\S+<\/flag>|<ss type="\S+">\S+<\/ss>)/gi;t.sanitize=u,t.sanitizeXml=a,t.stripAnchors=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-people/lib/avatar/cache",["require","exports","lodash-compat"],e)}(function(e,t){var n=e("lodash-compat"),r="404Avatar",i=function(){function e(e,t,n){this.cacheInstanceProvider=e,this.settings=t,this.dateTime=n}return e.prototype.add=function(e){var t=this,n=this.cacheInstanceProvider.get();return n.getItem(r).then(function(i){if(!i||!Array.isArray(i))i=[];return i.push({src:e,expiresAt:t.dateTime.now()+t.settings.avatarCacheDuration}),n.setItem(r,i)})},e.prototype.isCached=function(e){var t=this,i=this.cacheInstanceProvider.get();return e?i.getItem(r).then(function(s){var o=n.find(s,{src:e});return o?o.expiresAt<t.dateTime.now()?(n.remove(s,{src:e}),i.setItem(r,s).then(function(){return Promise.resolve(!1)})):Promise.resolve(!0):Promise.resolve(!1)}):Promise.resolve(!1)},e}();t.__esModule=!0,t["default"]=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-people/lib/avatar/helper",["require","exports"],e)}(function(e,t){var n=".AvatarInitials text",r=["rgb(153, 180, 51)","rgb(107, 165, 231)","rgb(231, 115, 189)","rgb(0, 163, 0)","rgb(30, 113, 69)","rgb(255, 0, 151)","rgb(126, 56, 120)","rgb(96, 60, 186)","rgb(29, 29, 29)","rgb(0, 171, 169)","rgb(45, 137, 239)","rgb(43, 87, 151)","rgb(218, 83, 44)","rgb(185, 29, 71)","rgb(238, 17, 17)"],i=function(){function e(e){this.document=e}return e.prototype.showColoredInitials=function(e,t){t===void 0&&(t=null);if(!t||!this.isValidDisplayName(t)){this.resetInitials(e);return}this.setBackgroundColor(e,t),this.setInitials(e,t)},e.prototype.setBackgroundColor=function(e,t){var n=e.querySelector("img");n.style.display="none",e.style.backgroundColor=this.getBackgroundColor(t)},e.prototype.setInitials=function(e,t){var r=e.querySelector(n);if(!r){var i=this.document.createElementNS("http://www.w3.org/2000/svg","svg"),s=i.namespaceURI;i.setAttribute("viewBox","0 0 47 47"),i.setAttribute("class","AvatarInitials"),r=this.document.createElementNS(s,"text"),r.setAttribute("x","50%"),r.setAttribute("y","65%"),i.appendChild(r),e.appendChild(i)}r.textContent=this.getInitials(t)},e.prototype.isValidDisplayName=function(e){return!!e&&!!this.filterDisplayName(e)},e.prototype.resetInitials=function(e){var t=e.querySelector(n),r=e.querySelector("img");e.style.backgroundColor="",r.style.display="block",t&&(t.textContent="")},e.prototype.getBackgroundColor=function(e){var t=0;for(var n=e.length-1;n>=0;n--){var i=e.charCodeAt(n),s=n%8;t^=(i<<s)+(i>>8-s)}return r[t%r.length]},e.prototype.getInitials=function(e){var t="";e=this.filterDisplayName(e);var n=e.split(" ");return n.length===2?(t+=n[0][0].toUpperCase(),t+=n[1][0].toUpperCase()):n.length===3?(t+=n[0][0].toUpperCase(),t+=n[2][0].toUpperCase()):n.length!==0&&(t+=n[0][0].toUpperCase()),t},e.prototype.filterDisplayName=function(e){var t=e.replace(/\(([^)]*)\)/gi,"");return t=t.replace(/[^ A-Za-z0-9]/gi,""),t=t.replace(/\s+/gi," "),t&&(t=t.trim()),t},e}();t.__esModule=!0,t["default"]=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-utils-people/lib/index",["require","exports","./lastSeenConverter","./organizePersons","./personPropertyFormatter","./progressiveTimeout","./userDataProcessor","./avatar/cache","./avatar/helper"],e)}(function(e,t){var n=e("./lastSeenConverter");t.lastSeenConverter=n;var r=e("./organizePersons");t.organizePersons=r;var i=e("./personPropertyFormatter");t.personPropertyFormatter=i;var s=e("./progressiveTimeout");t.progressiveTimeout=s;var o=e("./userDataProcessor");t.userDataProcessor=o;var u=e("./avatar/cache");t.avatarCache=u;var a=e("./avatar/helper");t.avatarHelper=a}),define("swx-utils-people",["swx-utils-people/lib/index"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-mri/lib/mri",["require","exports","lodash-compat","./mriMaps"],e)}(function(e,t){function u(e){return n.isString(e)?e.replace(i,""):undefined}function a(e){var t=i.exec(e);return t?t[1]:undefined}function f(e,t){return h(e)?e:p(e,t)}function l(e){return s.test(e)}function c(e){return o.test(e)}function h(e){return e.match(i)}function p(e,t){return l(e)?d(e,r.contactMriTypes.pstn):n(r.contactMriTypes).values().contains(t)?d(e,t):d(e,r.contactMriTypes.skype)}function d(e,t){return t+":"+e}var n=e("lodash-compat"),r=e("./mriMaps"),i=/^(?:(\d+):)+/,s=/^(\+)?\d+$/,o=/^guest:/;t.getId=u,t.getTypeFromKey=a,t.getKey=f,t.isPstnId=l,t.isGuestId=c}),define("swx-mri",["swx-mri/lib/mri"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/personHelper",["require","exports","lodash-compat","jskype-settings-instance","swx-mri","swx-constants","jskype-constants"],e)}(function(e,t){function u(e,t){return n.isString(e)?t?m(e,t):v(e):undefined}function a(e){return i.isGuestId(e.id())}function f(e){return!!e.phoneNumbers.size()&&e.id()===e.phoneNumbers(0).telUri()}function l(e){return c(e.id())}function c(e){return e===s.PEOPLE.ECHO_CONTACT_ID}function h(e){return!f(e)&&!e.isBlocked()}function p(e){return e._authorization()===o.PEOPLE.authorizationStates.AUTHORIZED&&!e.isBlocked()&&!f(e)&&!l(e)}function d(e){return!f(e)&&!l(e)}function v(e){var t=r.settings.avatarService;return t.host+t.publicAvatarEndpoint.replace("${contactId}",encodeURIComponent(e))}function m(e,t){var n=r.settings.avatarService;return n.host+n.contactAvatarEndpoint.replace("${contactId}",encodeURIComponent(e)).replace("${authKey}",encodeURIComponent(t))}var n=e("lodash-compat"),r=e("jskype-settings-instance"),i=e("swx-mri"),s=e("swx-constants"),o=e("jskype-constants");t.getAvatarUri=u,t.isGuest=a,t.isPstn=f,t.isEchoContact=l,t.isEchoContactId=c,t.canRequestContactAuthorization=h,t.canAddToChatServiceContactList=p,t.canRemoveContactFromChatServiceContactList=d}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/phoneNumber",["require","exports","jcafe-property-model"],e)}(function(e,t){var n=e("jcafe-property-model"),r=function(){function e(){this.type=n.property({readOnly:!0}),this.telUri=n.property({readOnly:!0}),this.displayString=n.property({readOnly:!0}),this.fromProfile=n.property({readOnly:!0})}return e}();t.__esModule=!0,t["default"]=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataMappers/mappers",["require","exports","lodash-compat","swx-mri/lib/mriMaps","swx-utils-people","../../personHelper","../../../models/phoneNumber","swx-utils-chat","swx-utils-common","swx-constants","swx-enums"],e)}(function(e,t){function h(e,t){e&&P(t.id,e,i.userDataProcessor.sanitizeXml)}function p(e,t){if(e){var n=U(e);e=s.getAvatarUri(t.id(),n),P(t.avatarUrl,e)}}function d(e,t){e&&P(t.displayName,e,i.userDataProcessor.sanitizeXml)}function v(e,t){var n=/(\d{4})-(\d{2})-(\d{2})/,r=n.exec(e);if(e&&t._birthday&&r&&r.length===4){var i=parseInt(r[1],10),s=parseInt(r[2],10)-1,o=parseInt(r[3],10);P(t._birthday,(new Date(i,s,o)).getTime())}}function m(e,t,n){e&&t?P(n.displayName,e+" "+t,i.userDataProcessor.sanitizeXml):e?P(n.displayName,e,i.userDataProcessor.sanitizeXml):t&&P(n.displayName,t,i.userDataProcessor.sanitizeXml)}function g(e,t){e&&P(t.firstName,e,i.userDataProcessor.sanitizeXml)}function y(e,t){e&&P(t.lastName,e,i.userDataProcessor.sanitizeXml)}function b(e,t){e&&P(t.title,e,i.userDataProcessor.sanitizeXml)}function w(e,t){e&&P(t.location.city,e,i.userDataProcessor.sanitize)}function E(e,t){e&&P(t.location.state,e,i.userDataProcessor.sanitize)}function S(e,t){if(e){var r=n.flowRight(R,i.userDataProcessor.sanitize);P(t.location.country,e,r)}}function x(e,t){e&&P(t.activity,e,i.userDataProcessor.sanitize)}function T(e,t,n){e&&!!e.length&&H(e,t,n);var r=j(e||[],t,n);F(t,r)}function N(e,t){e&&(P(t._type,r.contactTypes[e]),e===r.contactTypeNames.agent&&P(t.isAgent,!0))}function C(e,t){function r(r,i){var s=n.includes(e,r),o=t.capabilities[i];o&&P(o,s)}n.forOwn(f.COMMON.capabilities,r)}function k(e,t){e&&P(t.registeredAt,u.dateTime.getDate(parseInt(e,10)))}function L(e,t){e&&P(t.agentDetails.author,e,i.userDataProcessor.sanitizeXml)}function A(e,t){e&&P(t.agentDetails.description,e,i.userDataProcessor.sanitizeXml)}function O(e,t){e&&P(t.agentDetails.website,e,i.userDataProcessor.sanitizeXml)}function M(e,t){e&&P(t.agentDetails.privacyStatement,e,i.userDataProcessor.sanitizeXml)}function _(e,t){e&&P(t.agentDetails.termsOfService,e,i.userDataProcessor.sanitizeXml)}function D(e,t){e&&P(t.agentDetails.extraInfo,e,i.userDataProcessor.sanitizeXml)}function P(e,t,n){e._set(n?n(t):t)}function H(e,r,i){n.forEach(e,function(n){var s=t.phoneTypes[n.type];B(r.phoneNumbers,s,n.number,i)})}function B(e,t,n,r){var s=q(e,n);return s||(s=new o["default"],P(s.telUri,n,i.userDataProcessor.sanitize),P(s.fromProfile,r),e.add(s,s.telUri())),s.type._set(t),P(s.displayString,n,i.userDataProcessor.sanitize),e}function j(e,t,r){var i=[];return n.forEach(t.phoneNumbers(),function(s){!I(s,e)&&s.telUri()!==t.id()&&s.fromProfile()===r&&i.push(s)}),i}function F(e,t){n.forEach(t,function(n){e.phoneNumbers.remove(n.telUri())})}function I(e,t){return n.some(t,function(t){return e.telUri()===t.number})}function q(e,t){return n.find(e(),function(e){return e.telUri()===t})}function R(e){return e.toUpperCase()}function U(e){return a.url.getQueryParameterValueByName(e,"auth_key")}var n=e("lodash-compat"),r=e("swx-mri/lib/mriMaps"),i=e("swx-utils-people"),s=e("../../personHelper"),o=e("../../../models/phoneNumber"),u=e("swx-utils-chat"),a=e("swx-utils-common"),f=e("swx-constants"),l=e("swx-enums"),c;(function(e){e.home="home",e.office="office",e.mobile="mobile",e.other="other"})(c=t.phoneTypeKeys||(t.phoneTypeKeys={})),t.phoneTypes={},t.phoneTypes[c.home]=l.phoneType.Home,t.phoneTypes[c.office]=l.phoneType.Work,t.phoneTypes[c.mobile]=l.phoneType.Cell,t.phoneTypes[c.other]=l.phoneType.Other,t.mapId=h,t.mapAvatarUrl=p,t.mapDisplayName=d,t.mapBirthday=v,t.mapDisplayNameFallback=m,t.mapFirstName=g,t.mapLastName=y,t.mapTitle=b,t.mapCity=w,t.mapState=E,t.mapCountry=S,t.mapActivity=x,t.mapPhoneNumbers=T,t.mapType=N,t.mapCapabilities=C,t.mapRegistrationDate=k,t.mapAgentAuthor=L,t.mapAgentDescription=A,t.mapAgentWebsite=O,t.mapAgentPrivacyStatement=M,t.mapAgentTermsOfService=_,t.mapAgentExtraInfo=D}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataMappers/profileToPerson",["require","exports","./mappers","jskype-constants"],e)}(function(e,t){function i(e,t,r){r===void 0&&(r=!1),n.mapId(e.username,t),n.mapFirstName(e.firstname,t),n.mapLastName(e.lastname,t),n.mapDisplayName(e.displayname,t),n.mapCity(e.city,t),n.mapState(e.state,t),n.mapCountry(e.country,t),n.mapActivity(e.mood,t),n.mapAvatarUrl(e.avatarUrl,t),n.mapBirthday(e.birthday,t),s(e,t,r)}function s(e,t,i){var s=t.displayName();(i||s===r.PEOPLE.SELF||s===t.id())&&n.mapDisplayNameFallback(e.firstname,e.lastname,t)}var n=e("./mappers"),r=e("jskype-constants");t.map=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataHandlers/batchProfiles",["require","exports","lodash-compat","swx-constants","jskype-settings-instance","../../propertyModelHelper","../dataMappers/profileToPerson","swx-jskype-internal-application-instance"],e)}(function(e,t){function f(e){return new a(o,e)}var n=e("lodash-compat"),r=e("swx-constants"),i=e("jskype-settings-instance"),s=e("../../propertyModelHelper"),o=e("../dataMappers/profileToPerson"),u=e("swx-jskype-internal-application-instance"),a=function(){function e(e,t){var o=this;this.onSuccess=function(e){var t=e&&e.response&&e.response.length?e.response:[];return t.forEach(o.mapProfileToPerson),o.publishBatchCountOnFirstLoad(e),s.createResolvedPromise()},this.onError=function(e){return s.createRejectedPromise(e)},this.mapProfileToPerson=function(e){var t=o.registryInstance.getOrCreate(e.username);o.dataMapperInstance.map(e,t)},this.publishBatchProfilesLoaded=function(e){var t=u.get()._telemetryManager,n=e&&e.response?e.response.length:0,s=r.COMMON.telemetry.contacts.type.CONTACTS,o={name:r.COMMON.telemetry.contacts.name.GET_PROFILES,batchCount:n};t.sendEvent(i.settings.telemetry.jSkypeTenantToken,s,o)},this.dataMapperInstance=e,this.registryInstance=t,this.publishBatchCountOnFirstLoad=n.once(this.publishBatchProfilesLoaded)}return e}();t.build=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-client-info/lib/index",["require","exports","jskype-settings-instance","swx-browser-detect","swx-constants","swx-service-locator-instance"],e)}(function(e,t){function o(){return n.settings.biAppName}function u(){return n.settings.uiVersion}function a(){return n.settings.countryCode}function f(){var e=r["default"].getSystemInfo(),t=n.settings.lcid||"en-us",o=n.settings.countryCode||"n/a",u="os="+e.osName+"; osVer="+e.osVersion+"; proc="+e.platform+"; lcid="+t+"; deviceType="+e.deviceType+"; country="+o+"; clientName="+n.settings.biAppName+"; clientVer="+n.settings.uiVersion,a=s["default"].resolve(i.COMMON.serviceLocator.FEATURE_FLAGS);return a.isFeatureOn(i.COMMON.featureFlags.TIMEZONE_IN_CHATSERVICE_REQUEST)&&n.settings.utcOffset&&(u+="; utcOffset="+n.settings.utcOffset),u}var n=e("jskype-settings-instance"),r=e("swx-browser-detect"),i=e("swx-constants"),s=e("swx-service-locator-instance");t.getBIAppName=o,t.getBIVersion=u,t.getCountryCode=a,t.getClientInfo=f}),define("swx-client-info",["swx-client-info/lib/index"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-telemetry-buckets/lib/telemetryBuckets",["require","exports","swx-constants","swx-enums"],e)}(function(e,t){function c(e){switch(e){case"png":case"jpg":case"gif":case"bmp":case"tiff":return a.fileTypeBucket.Picture;case"avi":case"mp4":case"mkv":case"wmv":case"m4v":return a.fileTypeBucket.Video;case"mp3":case"cda":case"m4a":case"wav":return a.fileTypeBucket.Audio;case"xls":case"xlsx":case"xlsm":case"doc":case"docx":case"ppt":case"pptx":return a.fileTypeBucket.Office;case"zip":case"rar":case"ace":case"7z":case"dmg":return a.fileTypeBucket.Archive;case"exe":case"msi":case"iso":return a.fileTypeBucket.Binary;case"pdf":return a.fileTypeBucket.Pdf;default:return a.fileTypeBucket.Other}}function h(e){return e<=i?a.timeDeltaBucket.Min1:e>i&&e<=5*i?a.timeDeltaBucket.Min5:e>5*i&&e<=10*i?a.timeDeltaBucket.Min10:e>10*i&&e<=30*i?a.timeDeltaBucket.Min30:e>30*i&&e<=s?a.timeDeltaBucket.Hour1:e>s&&e<=3*s?a.timeDeltaBucket.Hour3:e>3*s&&e<=6*s?a.timeDeltaBucket.Hour6:e>6*s&&e<=9*s?a.timeDeltaBucket.Hour9:e>9*s&&e<=12*s?a.timeDeltaBucket.Hour12:e>12*s&&e<=18*s?a.timeDeltaBucket.Hour18:e>18*s&&e<=24*s?a.timeDeltaBucket.Hour24:e>o?Math.round(e/o)+a.timeDeltaBucket.Days:undefined}function p(e){return e===0?a.participantCountBucket.Zero:e===1?a.participantCountBucket.One:e===2?a.participantCountBucket.Two:e>2&&e<=5?a.participantCountBucket.Less5:e>5&&e<=10?a.participantCountBucket.Less10:e>10&&e<=25?a.participantCountBucket.Less25:e>25&&e<=50?a.participantCountBucket.Less50:e>50&&e<=100?a.participantCountBucket.Less100:e>100?Math.round(e/100)+a.participantCountBucket.More100:undefined}function d(e){switch(e.model.type_()){case r.activityType.TextMessage:if(e.previews){var t=e.previews();if(t.length>0)return t[0].type_()}return r.activityType.TextMessage;case r.activityType.VideoMessage:case r.activityType.PictureMessage:case r.activityType.MojiMessage:case r.activityType.FileTransfer:return e.model.type_();default:return r.activityType.Na}}function v(e){return e===0?a.contactCountBucket.Zero:e>=1&&e<=5?a.contactCountBucket.Less5:e>5&&e<=10?a.contactCountBucket.Less10:e>10&&e<=25?a.contactCountBucket.Less25:e>25&&e<=50?a.contactCountBucket.Less50:e>50&&e<=100?a.contactCountBucket.Less100:e>100&&e<=150?a.contactCountBucket.Less150:e>150&&e<=200?a.contactCountBucket.Less200:e>200?Math.round(e/200)+a.contactCountBucket.More200:undefined}function m(e){return y(e)}function g(e){return y(e,!0)}function y(e,t){return e===0?a.conversationCountBucket.Zero:e===1?a.conversationCountBucket.One:e===2?a.conversationCountBucket.Two:e===3?a.conversationCountBucket.Three:e===4?a.conversationCountBucket.Four:e===5?a.conversationCountBucket.Five:e>5&&e<=10?a.conversationCountBucket.Less10:e>10&&e<=15?a.conversationCountBucket.Less15:e>15&&e<=20?a.conversationCountBucket.Less20:e>20&&e<=50?a.conversationCountBucket.Less50:t&&e>50?Math.round(e/50)+a.conversationCountBucket.More50:e>50&&e<=100?a.conversationCountBucket.Less100:e>100?Math.round(e/100)+a.conversationCountBucket.More100:undefined}function b(e){return e===0?a.durationBucket.Zero:e===1?a.durationBucket.One:e===2?a.durationBucket.Two:e===3?a.durationBucket.Three:e===4?a.durationBucket.Four:e===5?a.durationBucket.Five:e>5&&e<=10?a.durationBucket.Less10:e>10?Math.round(e/10)+a.durationBucket.More10:a.durationBucket.Na}function w(e){return b(E(e))}function E(e){return Math.round(e/1e3)}function S(e){return f.Start<=e&&e<f.End?!1:l.Start<=e&&e<l.End?!0:u}function x(e){return e.indexOf("www.youtube.com")>-1?a.urlContentTypeBucket.YouTube:/^http.*\.gif$/.exec(e)?a.urlContentTypeBucket.Gif:e.indexOf("twitter.com")>-1?a.urlContentTypeBucket.Twitter:a.urlContentTypeBucket.Other}function T(e){return e<i?a.lifetimeBucket.Min:e<5*i?a.lifetimeBucket.Less5Min:e<10*i?a.lifetimeBucket.Less10Min:e<20*i?a.lifetimeBucket.Less20Min:e<s?a.lifetimeBucket.Less1Hour:e<o?a.lifetimeBucket.Less1Day:e<2*o?a.lifetimeBucket.Less2Days:e<4*o?a.lifetimeBucket.Less4Days:e<6*o?a.lifetimeBucket.Less6Days:e<14*o?a.lifetimeBucket.Less14Days:e<21*o?a.lifetimeBucket.Less21Days:e<29*o?a.lifetimeBucket.Less29Days:a.lifetimeBucket.Na}function N(e){return e?e.sidebar&&e.sidebar.lastTimeOpened?L(new Date(e.sidebar.lastTimeOpened))<=30:!1:u}function C(e){return e?e.sidebar&&e.sidebar.lastTimeOpened?L(new Date(e.sidebar.lastTimeOpened))>30:!1:u}function k(e){if(!e)return u;if(e.sidebar&&e.sidebar.lastTimeOpened){var t=L(new Date(e.sidebar.lastTimeOpened));return t>1&&t<=30}return!1}function L(e){var t=864e5;return Math.round(Math.abs((Date.now()-e)/t))}var n=e("swx-constants"),r=e("swx-enums"),i=6e4,s=60*i,o=24*s,u=n.COMMON.telemetry.NOT_AVAILABLE,a;(function(e){var t;(function(e){e.Zero="zero",e.One="1",e.Two="2",e.Less5="3-5",e.Less10="5-10",e.Less25="10-25",e.Less50="25-50",e.Less100="50-100",e.More100="x100"})(t=e.participantCountBucket||(e.participantCountBucket={}));var n;(function(e){e.Min1="1MIN",e.Min5="5MIN",e.Min10="10MIN",e.Min30="30MIN",e.Hour1="1HOUR",e.Hour3="3HOUR",e.Hour6="6HOUR",e.Hour9="9HOUR",e.Hour12="12HOUR",e.Hour18="18HOUR",e.Hour24="24HOUR",e.Days="DAY"})(n=e.timeDeltaBucket||(e.timeDeltaBucket={}));var r;(function(e){e.Zero="zero",e.Less5="1-5",e.Less10="5-10",e.Less25="10-25",e.Less50="25-50",e.Less100="50-100",e.Less150="100-150",e.Less200="150-200",e.More200="x200"})(r=e.contactCountBucket||(e.contactCountBucket={}));var i;(function(e){e.Zero="zero",e.One="1",e.Two="2",e.Three="3",e.Four="4",e.Five="5",e.Less10="5-10",e.Less15="10-15",e.Less20="15-20",e.Less50="20-50",e.More50="x50",e.Less100="50-100",e.More100="x100"})(i=e.conversationCountBucket||(e.conversationCountBucket={}));var s;(function(e){e.Min="1MIN",e.Less5Min="5MIN",e.Less10Min="10MIN",e.Less20Min="20MIN",e.Less1Hour="1hour",e.Less1Day="1DAY",e.Less2Days="2DAYS",e.Less4Days="3_4_DAYS",e.Less6Days="5_6_DAYS",e.Less14Days="7_14_DAYS",e.Less21Days="15_21_DAYS",e.Less29Days="22_29_DAYS",e.Na="n/a"})(s=e.lifetimeBucket||(e.lifetimeBucket={}));var o;(function(e){e.YouTube="YT",e.Gif="GIF",e.Twitter="TWIT",e.Other="WWW"})(o=e.urlContentTypeBucket||(e.urlContentTypeBucket={}));var u;(function(e){e.UrlOnly="URL",e.TextWithUrl="URL_MID",e.TextEndingWithUrl="URL_END"})(u=e.urlPositionBucket||(e.urlPositionBucket={}));var a;(function(e){e.Na="n/a",e.Zero="0SEC",e.One="1SEC",e.Two="2SEC",e.Three="3SEC",e.Four="4SEC",e.Five="5SEC",e.Less10="5-10SEC",e.More10="x10SEC"})(a=e.durationBucket||(e.durationBucket={}));var f;(function(e){e.Picture="picture",e.Video="video",e.Audio="audio",e.Office="office",e.Archive="archive",e.Binary="binary",e.Pdf="pdf",e.Other="other"})(f=e.fileTypeBucket||(e.fileTypeBucket={}))})(a=t.enums||(t.enums={}));var f;(function(e){e[e.Start=200]="Start",e[e.End=399]="End"})(f||(f={}));var l;(function(e){e[e.Start=400]="Start",e[e.End=599]="End"})(l||(l={})),t.getFileTypeGroup=c,t.getDurationGroup=h,t.getParticipantCountGroup=p,t.getMessageType=d,t.getContactsGroup=v,t.getConversationCountGroup=m,t.getMessageCountGroup=g,t.getSecondsDurationGroup=b,t.getSecondsDurationGroupFromMs=w,t.isError=S,t.getUrlContentType=x,t.getMessageLifeDurationGroup=T,t.isMau=N,t.isMauCandidate=C,t.isDauCandidate=k,t.getDays=L}),define("swx-telemetry-buckets",["swx-telemetry-buckets/lib/telemetryBuckets"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/serviceAccessLayer/qos/reporter",["require","exports","swx-jskype-internal-application-instance","swx-telemetry-buckets","jskype-settings-instance","lodash-compat"],e)}(function(e,t){function u(){function a(n,r,i){if(u===0||!n)return!1;i=i||{};var o=n;return s.forIn(i,function(e,t){c(t)&&(o+=t+e)}),t[o]||(t[o]={total:0,success:0,serviceName:n,payload:i}),r&&t[o].success++,t[o].total++,e++,e>=u&&(f(),t={},e=0),!0}function f(){Object.keys(t).forEach(function(e){var t=l(e);n.get()._telemetryManager.sendEvent(i.settings.telemetry.jSkypeTenantToken,o,t)})}function l(e){var n=t[e],r={qos:Math.round(n.success/n.total*100).toString(),service_id:n.serviceName,success_count:n.success.toString(),failure_count:(n.total-n.success).toString()};return s.forIn(n.payload,function(e,t){c(t)&&e&&(r[t]=e.toString())}),r}function c(e){return!s.includes(["serviceName","service_id","success_count","failure_count"],e)}var e=0,t={},u=i.settings.serviceQosReporter.iterationCountBeforeFlushingQoSMetrics;return{reportSuccess:function(e,t){return a(e,!0,t)},reportFail:function(e,t){return a(e,!1,t)},reportRetry:function(e){n.get()._telemetryManager.sendEvent(i.settings.telemetry.jSkypeTenantToken,"serviceRetry_qos",{ttcGroup:r.getSecondsDurationGroupFromMs(e.ttc)})}}}function f(){return a||(a=u()),a}var n=e("swx-jskype-internal-application-instance"),r=e("swx-telemetry-buckets"),i=e("jskype-settings-instance"),s=e("lodash-compat"),o="service_qos";t.build=u;var a=null;t.get=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-chat-service/lib/constants",["require","exports"],e)}(function(e,t){var n;(function(e){e.SET_THREAD_OPTION="setThreadOption",e.SET_CONVERSATION_OPTION="setConversationOption",e.PIN_TO_DOGFOOD="pinToDogfood",e.CREATE_CONVERSATION="createConversation",e.POST_MESSAGE="postMessage",e.ADD_PARTICIPANT="addParticipant",e.REMOVE_PARTICIPANT="removeParticipant",e.SET_CONSUMPTION_HORIZON="setConsumptionHorizon",e.FETCH_MESSAGES="fetchMessages",e.FETCH_MESSAGES_LOAD_MORE="fetchMessagesLoadMore",e.FETCH_THREAD="fetchThread",e.FETCH_CONVERSATION="fetchConversation",e.FETCH_CONVERSATIONS="fetchConversations",e.FETCH_CONVERSATIONS_BY_SYNC_STATE="fetchConversationsBySyncState",e.REQUEST_ENDPOINT_CREATION="requestEndpointCreation",e.REQUEST_ENDPOINT_DELETION="requestEndpointDeletion",e.REQUEST_SUBSCRIPTION_CREATION="requestSubscriptionCreation",e.REQUEST_POLLING="requestPolling",e.SET_ENDPOINT_PRESENCE="setEndpointPresence",e.SET_ENDPOINT_PROPERTY="setEndpointProperty",e.ACTIVATE_ENDPOINT="activateEndpoint",e.SET_USER_PRESENCE="setUserPresence",e.GET_USER_PRESENCE="getUserPresence",e.SEND_CONTACT_LIST="sendContactsList",e.ADD_CONTACT_TO_CONTACTS_LIST="addContactToContactsList",e.REMOVE_CONTACT_FROM_CONTACTS_LIST="removeContactFromContactsList",e.GET_SELF_PROPERTIES="getSelfProperties",e.SET_MESSAGE_PROPERTY="setMessageProperty",e.REMOVE_MESSAGE_PROPERTY="removeMessageProperty",e.REMOVE_ALL_MESSAGES="removeAllMessage",e.SET_IS_FAVORITE="setIsFavorite",e.SMS_PRICE="getSmsPrice"})(n=t.SERVICE_CALLS||(t.SERVICE_CALLS={}));var r;(function(e){e.SUPPORTS_MESSAGE_PROPERTIES="supportsMessageProperties"})(r=t.ENDPOINT_PROPERTIES||(t.ENDPOINT_PROPERTIES={}));var i;(function(e){var t;(function(e){e.ACTIVITY_DATA="activityData",e.PINNED="pinned",e.PROTOTYPE_SKYPEX="prototype_skypex"})(t=e.GLOBAL||(e.GLOBAL={}));var n;(function(e){e.EMOTIONS="emotions",e.POLL="poll",e.TRANSLATIONS="translations",e.ACTIVITY_DATA="activityData",e.SMS_REPORT="smsdeliveryreports"})(n=e.PER_USER||(e.PER_USER={}))})(i=t.MESSAGE_PROPERTIES||(t.MESSAGE_PROPERTIES={})),t.ACTIVATE_ENDPOINT_TIMEOUT=12e3,t.ACTIVATE_ENDPOINT_TOLERANCE=6e3}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/serviceAccessLayer/decorations/reporting",["require","exports","swx-jskype-internal-application-instance","../qos/reporter","swx-constants/lib/common","swx-chat-service/lib/constants","jskype-settings-instance","lodash-compat"],e)}(function(e,t){function f(e){if(u.isString(e)){var t=e.match(/(?:[\s\S]*):\/\/([^\/\r\n]+)(?:\/[^\r\n]*)?/i);if(t&&t.length>0)return t[1]}return undefined}function l(e,t){try{var n=JSON.parse(t.response);n&&n.errorCode&&(e.errorCode=n.errorCode,e.errorMessage=n.message)}catch(r){}}function c(e,t){e.getAllResponseHeaders();var n=e.getAllResponseHeaders().toLowerCase();return u.includes(n,t)&&e.getResponseHeader(t)}function h(e,t){var n=u.map(t.eventMessages,"resourceType");u.uniq(n).forEach(function(t){var r=n.length,i=u.without(n,t).length;e[u.camelCase(t)]=r-i})}function p(e,t){if(e.faultCode===404){if(c(t,"location")||t.response===undefined)return;l(e,t)}n.get()._telemetry.eventBus.publish(i["default"].events.errors.SERVICE_FAILURE,e)}function d(e){return e&&o.isFeatureOn(i["default"].featureFlags.SERVICE_FAILURE_REPORTING)}var n=e("swx-jskype-internal-application-instance"),r=e("../qos/reporter"),i=e("swx-constants/lib/common"),s=e("swx-chat-service/lib/constants"),o=e("jskype-settings-instance"),u=e("lodash-compat"),a=s.SERVICE_CALLS;t.name="reporting",t.build=function(e,t){var n=t.serviceName;return function(i){function o(e){r.get().reportSuccess(n,l(e)),e.retry&&r.get().reportRetry(v(e,!1))}function u(e){e.retry&&r.get().reportRetry(v(e,!0));if(d(n)){var t=l();e instanceof XMLHttpRequest&&(t.faultCode=e.status,t.contextId=c(e,"contextid")),r.get().reportFail(n,t),p(t,e)}}function l(e){var t={serviceName:n,verb:i.type,host:f(i.url)};return n==="webapi-"+a.REQUEST_POLLING&&e&&e.response&&e.response.eventMessages&&h(t,e.response),t}function v(e,t){var r=e.request?e.request.status:e.status;return{serviceName:n,retryCount:e.retry.count,responseCode:r,isFailed:t,ttc:e.retry.ttc}}var s=e(i);return s.then(o,u),s}}}),!function(e,t,n){typeof module!="undefined"&&module.exports?module.exports=n():typeof define=="function"&&define.amd?define("reqwest/reqwest",n):t[e]=n()}("reqwest",this,function(){function succeed(e){var t=protocolRe.exec(e.url);return t=t&&t[1]||context.location.protocol,httpsRe.test(t)?twoHundo.test(e.request.status):!!e.request.response}function handleReadyState(e,t,n){return function(){if(e._aborted)return n(e.request);if(e._timedOut)return n(e.request,"Request is aborted: timeout");e.request&&e.request[readyState]==4&&(e.request.onreadystatechange=noop,succeed(e)?t(e.request):n(e.request))}}function setHeaders(e,t){var n=t.headers||{},r;n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"];var i=typeof FormData!="undefined"&&t.data instanceof FormData;!t.crossOrigin&&!n[requestedWith]&&(n[requestedWith]=defaultHeaders.requestedWith),!n[contentType]&&!i&&(n[contentType]=t.contentType||defaultHeaders.contentType);for(r in n)n.hasOwnProperty(r)&&"setRequestHeader"in e&&e.setRequestHeader(r,n[r])}function setCredentials(e,t){typeof t.withCredentials!="undefined"&&typeof e.withCredentials!="undefined"&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,r){var i=uniqid++,s=e.jsonpCallback||"callback",o=e.jsonpCallbackName||reqwest.getcallbackPrefix(i),u=new RegExp("((^|\\?|&)"+s+")=([^&]+)"),a=r.match(u),f=doc.createElement("script"),l=0,c=navigator.userAgent.indexOf("MSIE 10.0")!==-1;return a?a[3]==="?"?r=r.replace(u,"$1="+o):o=a[3]:r=urlappend(r,s+"="+o),context[o]=generalCallback,f.type="text/javascript",f.src=r,f.async=!0,typeof f.onreadystatechange!="undefined"&&!c&&(f.htmlFor=f.id="_reqwest_"+i),f.onload=f.onreadystatechange=function(){if(f[readyState]&&f[readyState]!=="complete"&&f[readyState]!=="loaded"||l)return!1;f.onload=f.onreadystatechange=null,f.onclick&&f.onclick(),t(lastValue),lastValue=undefined,head.removeChild(f),l=1},head.appendChild(f),{abort:function(){f.onload=f.onreadystatechange=null,n({},"Request is aborted: timeout",{}),lastValue=undefined,head.removeChild(f),l=1}}}function getRequest(e,t){var n=this.o,r=(n.method||"GET").toUpperCase(),i=typeof n=="string"?n:n.url,s=n.processData!==!1&&n.data&&typeof n.data!="string"?reqwest.toQueryString(n.data):n.data||null,o,u=!1;return(n["type"]=="jsonp"||r=="GET")&&s&&(i=urlappend(i,s),s=null),n["type"]=="jsonp"?handleJsonp(n,e,t,i):(o=n.xhr&&n.xhr(n)||xhr(n),o.open(r,i,n.async===!1?!1:!0),setHeaders(o,n),setCredentials(o,n),context[xDomainRequest]&&o instanceof context[xDomainRequest]?(o.onload=e,o.onerror=t,o.onprogress=function(){},u=!0):o.onreadystatechange=handleReadyState(this,e,t),n.before&&n.before(o),u?setTimeout(function(){o.send(s)},200):o.send(s),o)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){if(e===null)return undefined;if(e.match("json"))return"json";if(e.match("javascript"))return"js";if(e.match("text"))return"html";if(e.match("xml"))return"xml"}function init(o,fn){function complete(e){o.timeout&&clearTimeout(self.timeout),self.timeout=null;while(self._completeHandlers.length>0)self._completeHandlers.shift()(e)}function success(resp){var type=o.type||resp&&setType(resp.getResponseHeader("Content-Type"));resp=type!=="jsonp"?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=context.JSON?context.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);while(self._fulfillmentHandlers.length>0)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function timedOut(){self._timedOut=!0,self.request.abort()}function error(e,t,n){e=self.request,self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=n,self._erred=!0;while(self._errorHandlers.length>0)self._errorHandlers.shift()(e,t,n);complete(e)}this.url=typeof o=="string"?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){timedOut()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n=e.name,r=e.tagName.toLowerCase(),i=function(e){e&&!e.disabled&&t(n,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))},s,o,u,a;if(e.disabled||!n)return;switch(r){case"input":/reset|button|image|file/i.test(e.type)||(s=/checkbox/i.test(e.type),o=/radio/i.test(e.type),u=e.value,(!s&&!o||e.checked)&&t(n,normalize(s&&u===""?"on":u)));break;case"textarea":t(n,normalize(e.value));break;case"select":if(e.type.toLowerCase()==="select-one")i(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(a=0;e.length&&a<e.length;a++)e.options[a].selected&&i(e.options[a])}}function eachFormElement(){var e=this,t,n,r=function(t,n){var r,i,s;for(r=0;r<n.length;r++){s=t[byTag](n[r]);for(i=0;i<s.length;i++)serial(s[i],e)}};for(n=0;n<arguments.length;n++)t=arguments[n],/input|select|textarea/i.test(t.tagName)&&serial(t,e),r(t,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}function buildParams(e,t,n,r){var i,s,o,u=/\[\]$/;if(isArray(t))for(s=0;t&&s<t.length;s++)o=t[s],n||u.test(e)?r(e,o):buildParams(e+"["+(typeof o=="object"?s:"")+"]",o,n,r);else if(t&&t.toString()==="[object Object]")for(i in t)buildParams(e+"["+i+"]",t[i],n,r);else r(e,t)}var context=this;if("window"in context)var doc=document,byTag="getElementsByTagName",head=doc[byTag]("head")[0];else{var XHR2;try{XHR2=require("xhr2")}catch(ex){throw new Error("Peer dependency `xhr2` required! Please npm install xhr2")}}var httpsRe=/^http/,protocolRe=/(^\w+):\/\//,twoHundo=/^(20\d|1223)$/,readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",uniqid=0,callbackPrefix="reqwest_"+ +(new Date),lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray=typeof Array.isArray=="function"?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(e){if(e.crossOrigin===!0){var t=context[xmlHttpRequest]?new XMLHttpRequest:null;if(t&&"withCredentials"in t)return t;if(context[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return context[xmlHttpRequest]?new XMLHttpRequest:XHR2?new XHR2:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(e){return e}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return e=e||function(){},t=t||function(){},this._fulfilled?this._responseArgs.resp=e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this},"catch":function(e){return this.fail(e)}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(arguments.length===0)return"";var e,t,n=Array.prototype.slice.call(arguments,0);return e=n.pop(),e&&e.nodeType&&n.push(e)&&(e=null),e&&(e=e.type),e=="map"?t=serializeHash:e=="array"?t=reqwest.serializeArray:t=serializeQueryString,t.apply(null,n)},reqwest.toQueryString=function(e,t){var n,r,i=t||!1,s=[],o=encodeURIComponent,u=function(e,t){t="function"==typeof t?t():t==null?"":t,s[s.length]=o(e)+"="+o(t)};if(isArray(e))for(r=0;e&&r<e.length;r++)u(e[r].name,e[r].value);else for(n in e)e.hasOwnProperty(n)&&buildParams(n,e[n],i,u);return s.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest.ajaxSetup=function(e){e=e||{};for(var t in e)globalSetupOptions[t]=e[t]},reqwest}),define("reqwest",["reqwest/reqwest"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-xhr-dispatcher/lib/uriBuilder",["require","exports","lodash-compat","swx-log-tracer"],e)}(function(e,t){function i(){function i(){var e=t.fqdn+t.resource;return e+=t.queryParams!==null?o(t.queryParams):"",e}function u(e){var n=typeof e=="string";if(!n||e==="")throw new TypeError("domain must be a string");t.fqdn=e}function a(n){t.fqdn===null&&e.error("FQDN was not set yet!",n),t.fqdn.substring(0,6)==="skype:"?t.resource=n:t.resource=s(t.fqdn,n)}function f(e){if(!n.isPlainObject(e)&&!n.isUndefined(e))throw new Error("queryParams must be an object");t.queryParams=e||{}}var e=r.getLogger("[xhrDispatcher]"),t={fqdn:"",resource:"",queryParams:null};return{getUri:i,setDomain:u,setResource:a,setQueryParams:f}}function s(e,t){var n="/",r=t[0]===n;return e[e.length-1]===n?r?t.substring(1):t:r?t:n+t}function o(e){var t=n.reduce(n.keys(e),function(t,n){var r=u(e[n]);return r?t.concat(n+"="+r):t},[]).join("&");return t.length?"?"+t:""}function u(e){var t=/^ *$/;return!n.isUndefined(e)&&e!==null?e.toString().replace(t,""):undefined}var n=e("lodash-compat"),r=e("swx-log-tracer");t.build=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-xhr-dispatcher/lib/xhrDecorator",["require","exports","lodash-compat"],e)}(function(e,t){function r(e,t){var r=e,s=n.isArray(t.decorations)?n.slice(t.decorations):[];return n.forEach(s,function(e){r=e.build(r,i(e.name,t))}),r}function i(e,t){return n.isString(e)&&n.isPlainObject(t[e])?t[e]:{}}var n=e("lodash-compat");t.decorate=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-xhr-dispatcher/lib/decorations/retry",["require","exports","lodash-compat"],e)}(function(e,t){function s(e,t){var s=n.assign({},r,t);return function(r){var u=!1,f,l=new Promise(function(t,l){function h(n){f=e(r),u&&f.abort(),f.then(function(e){t(p(e,n))})["catch"](function(e){if(s.isSuccessCheck(e)){var r={request:e};t(p(r,n))}else!u&&o(n,s)&&s.isTransientCheck(e)?a(h,n,s):l(p(e,n))})}function p(e,t){return t>1&&(e.retry={count:t,ttc:n.now()-c}),e}var c=n.now();i(r.timeout)&&r.timeout.then(function(){u=!0}),h(1)});return l.abort=function(){u=!0,f&&f.abort()},l}}function o(e,t){return t.enabled&&e<t.limit}function u(e,n){return n.strategy===t.STRATEGIES.INCREMENTAL?n.delay*e:n.strategy===t.STRATEGIES.EXPONENTIAL?Math.pow(3,e-1)*n.delay:n.delay}function a(e,t,r){function i(){e(++t)}n.delay(i,u(t,r))}function f(){return!1}var n=e("lodash-compat");t.name="retry",t.STRATEGIES={INCREMENTAL:"incremental",EXPONENTIAL:"exponential",FIXED:"fixed"};var r={enabled:!0,limit:3,delay:3e3,strategy:t.STRATEGIES.EXPONENTIAL,isSuccessCheck:f,isTransientCheck:f},i=function(e){return e&&typeof e.then=="function"};t.build=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-xhr-dispatcher/lib/xhrDispatcher",["require","exports","lodash-compat","reqwest","./uriBuilder","./xhrDecorator","./decorations/retry"],e)}(function(e,t){function a(e){var t=i.build();t.setDomain(e.host);var r=n.cloneDeep(e);r.decorations=r.decorations||[],r.decorations.unshift(o);var s=l(n.partial(d,"GET"),t),u=l(n.partial(d,"POST"),t),a=l(n.partial(d,"PUT"),t),f=l(n.partial(d,"DELETE"),t);return{get:c(s,r),post:c(u,r),put:c(a,r),remove:c(f,r),uriBuilder:t}}function f(e){return function(){e.request.readyState!==t.REQUEST_DONE_READY_STATE&&e.abort()}}function l(e,t){return function(n,r){return t.setResource(n),t.setQueryParams(r.params),e(t.getUri(),r)}}function c(e,t){return function(n,r){return r.decorations=t.decorations,e(n,r)}}function h(e,t){return n.isUndefined(e)?t:e}function p(e,r,i){var s={url:r,type:e,headers:i.headers||{},timeout:i.timeout||45e3,dataType:i.dataType||"json",data:i.payload||"",crossOrigin:h(i.crossOrigin,!0),withCredentials:h(i.withCredentials,!1)};if(n.isUndefined(i.addContentType)||i.addContentType===!0)s.contentType=i.contentType||t.contentTypes.JSON;if(i.jsonp||i.dataType==="jsonp")s.jsonp=i.jsonp||"callback";return n.isBoolean(i.processData)&&(s.processData=i.processData),s}function d(e,t,n){var r=s.decorate(v,n);return r(p(e,t,n))}function v(e){var t=Date.now(),i;u(e.timeout)&&(i=e.timeout,delete e.timeout);var s=r.compat(n.cloneDeep(e)),o=new Promise(function(e,n){s.then(function(n){e({response:n,request:s.request,duration:Date.now()-t})})["catch"](function(){n(s.request)})});return o.abort=f(s),i&&i.then(function(){o.abort()}),o}function y(e){return new g(e)}var n=e("lodash-compat"),r=e("reqwest"),i=e("./uriBuilder"),s=e("./xhrDecorator"),o=e("./decorations/retry");t.contentTypes={FORM_URL_ENCODED:"application/x-www-form-urlencoded",JSON:"application/json",JSON_V1_0:"application/json; ver=1.0",JSON_V2_0:"application/json; ver=2.0",JSON_V3_0:"application/json; ver=3.0"};var u=function(e){return e&&typeof e.then=="function"};t.REQUEST_DONE_READY_STATE=4,t.build=a;var m={retry:{limit:3,delay:1e3,strategy:o.STRATEGIES.FIXED}},g=function(){function e(e){this.REQUEST_DONE_READY_STATE=t.REQUEST_DONE_READY_STATE,this.decorations=e.slice()}return e.prototype.get=function(e,t){return d("GET",e,this.makeOptions(t))},e.prototype.post=function(e,t){return d("POST",e,this.makeOptions(t))},e.prototype.put=function(e,t){return d("PUT",e,this.makeOptions(t))},e.prototype.remove=function(e,t){return d("DELETE",e,this.makeOptions(t))},e.prototype.makeOptions=function(e){return e=n.assign(n.cloneDeep(m),e),e.decorations||(e.decorations=this.decorations),e},e}();t.buildDispatcherWithFixedRetry=y}),define("swx-xhr-dispatcher",["swx-xhr-dispatcher/lib/xhrDispatcher"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-stratus-web-service/lib/stratusWebService",["require","exports","lodash-compat","swx-utils-common","swx-xhr-dispatcher"],e)}(function(e,t){function s(e,t){function o(n){return e().then(function(e){return{headers:{Accept:i.contentTypes.JSON_V1_0,"X-Skypetoken":e,"X-Stratus-Caller":t.appName,"X-Stratus-Request":r.guid.create().substring(0,8)},reporting:{serviceName:n}}})}function u(e,t,r){return o("updateAvatar").then(function(i){var o="users/"+encodeURIComponent(e)+"/profile/avatar";return s.put(o,n.merge(i,{contentType:r,payload:t,processData:!1}))})}function a(){return o("getProfile").then(function(e){return s.get("users/self/profile",e)})}function f(e){return o("getProfiles").then(function(t){var r,o;return r="batch/profiles",o={contentType:i.contentTypes.JSON_V1_0,payload:JSON.stringify({usernames:e})},s.post(r,n.merge(t,o))})}function l(){return o("getUserInfo").then(function(e){return s.get("users/self",n.merge(e,{headers:{Accept:i.contentTypes.JSON_V2_0}}))})}function c(e){return o("searchDirectory").then(function(n){var r="search/users/any?keyWord="+encodeURIComponent(e);return t.useSkypeOnlySearch===!0&&(r+="&contactTypes[]=skype"),s.get(r,n)})}function h(e){return o("searchDirectoryById").then(function(t){var n="search/users?skypename="+encodeURIComponent(e);return s.get(n,t)})}function p(e,t){return o("sendContactRequest").then(function(r){var o="users/self/contacts/auth-request/"+encodeURIComponent(e);return s.put(o,n.merge(r,{contentType:i.contentTypes.FORM_URL_ENCODED,payload:"greeting="+t}))})}function d(){return o("getIncomingContactRequests").then(function(e){var t="users/self/contacts/auth-request";return s.get(t,e)})}function v(e){return o("acceptContactRequest").then(function(t){var r="users/self/contacts/auth-request/"+encodeURIComponent(e)+"/accept";return s.put(r,n.merge(t,{contentType:i.contentTypes.FORM_URL_ENCODED}))})}function m(e){return o("declineContactRequest").then(function(t){var r="users/self/contacts/auth-request/"+encodeURIComponent(e)+"/decline";return s.put(r,n.merge(t,{contentType:i.contentTypes.FORM_URL_ENCODED}))})}function g(e){return o("deleteContact").then(function(t){var r="users/self/contacts/"+encodeURIComponent(e);return s.remove(r,n.merge(t,{headers:{Accept:i.contentTypes.JSON_V1_0}}))})}function y(e,t){return o("setMoodMessage").then(function(r){var o,u;return o="users/"+encodeURIComponent(e)+"/profile/partial",u={contentType:i.contentTypes.JSON_V1_0,payload:JSON.stringify({payload:{mood:t}})},s.post(o,n.merge(r,u))})}var s=i.build(t);return{updateAvatar:u,getProfile:a,getProfiles:f,getUserInfo:l,searchDirectory:c,searchDirectoryById:h,sendContactRequest:p,getIncomingContactRequests:d,acceptContactRequest:v,declineContactRequest:m,deleteContact:g,setMoodMessage:y}}var n=e("lodash-compat"),r=e("swx-utils-common"),i=e("swx-xhr-dispatcher");t.build=s}),define("swx-stratus-web-service",["swx-stratus-web-service/lib/stratusWebService"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/stratus/instance",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","swx-client-info","swx-constants","../serviceAccessLayer/decorations/reporting","swx-stratus-web-service"],e)}(function(e,t){function f(){var e;return a||(e=n.get().signInManager._skypeToken,a=u.build(e,{host:r.settings.stratusService.host,appName:i.getBIAppName(),useSkypeOnlySearch:!r.isFeatureOn(s.COMMON.featureFlags.DIRECTORY_SEARCH_SKYPE_AND_LYNC),decorations:[o]})),a}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("swx-client-info"),s=e("swx-constants"),o=e("../serviceAccessLayer/decorations/reporting"),u=e("swx-stratus-web-service"),a;t.get=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/note",["require","exports","jcafe-property-model"],e)}(function(e,t){var n=e("jcafe-property-model"),r=function(){function e(){this.type=n.property({readOnly:!0}),this.text=n.property({readOnly:!0})}return e}();t.__esModule=!0,t["default"]=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/location",["require","exports","jcafe-property-model"],e)}(function(e,t){var n=e("jcafe-property-model"),r=function(){function e(){this.type=n.property({readOnly:!0}),this.street=n.property({readOnly:!0}),this.city=n.property({readOnly:!0}),this.state=n.property({readOnly:!0}),this.country=n.property({readOnly:!0}),this.postalCode=n.property({readOnly:!0})}return e}();t.__esModule=!0,t["default"]=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/capabilities",["require","exports","jcafe-property-model"],e)}(function(e,t){var n=e("jcafe-property-model"),r=function(){function e(){this.chat=n.property({value:!1,readOnly:!0}),this.audio=n.property({value:!1,readOnly:!0}),this.video=n.property({value:!1,readOnly:!0}),this.groupAdd=n.property({value:!1,readOnly:!0}),this.screenSharing=n.property({value:!1,readOnly:!0}),this.dataCollaboration=n.property({value:!1,readOnly:!0}),this._groupChat=n.property({value:!1,readOnly:!0}),this._gvc=n.property({value:!1,readOnly:!0}),this._fileSend=n.property({value:!1,readOnly:!0}),this._contactSend=n.property({value:!1,readOnly:!0}),this._videoMessageSend=n.property({value:!1,readOnly:!0}),this._audioMessageSend=n.property({value:!1,readOnly:!0}),this._mediaMessageSend=n.property({value:!1,readOnly:!0}),this._annotationSend=n.property({value:!1,readOnly:!0}),this._photoSend=n.property({value:!1,readOnly:!0}),this._mojiSend=n.property({value:!1,readOnly:!0}),this._locationSend=n.property({value:!1,readOnly:!0}),this._mediaAutoplay=n.property({value:!1,readOnly:!0})}return e}();t.__esModule=!0,t["default"]=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-contacts-web-service/lib/utils/contactsInfo",["require","exports","swx-constants/lib/people"],e)}(function(e,t){var n=e("swx-constants/lib/people"),r=function(){function e(e){this.items=[],this.itemsObj={},this.key=e}return e.prototype.reset=function(){this.items=[],this.itemsObj={}},e.prototype.add=function(e){var t=this;if(!e)return;e.forEach(function(e){!t.itemsObj[e[t.key]]||(t.items=t.items.filter(function(n){return n[t.key]!==e[t.key]})),t.itemsObj[e[t.key]]=e}),this.items=this.items.concat(e)},e.prototype.getItems=function(){return this.items},e}(),i=function(){function e(){this.callCount=0,this.contacts=new r("mri"),this.blocklist=new r("mri"),this.groups=new r("id"),this.duration=0,this.firstScope=""}return e.prototype.reset=function(){this.firstScope="",this.contacts.reset(),this.groups.reset(),this.blocklist.reset()},e.prototype.update=function(e){this.callCount++,this.duration+=e.duration||0;var t=e.response;if(!t)return;this.callCount>1&&t.scope===n["default"].scopes.FULL&&this.reset(),t.scope&&!this.firstScope&&(this.firstScope=t.scope),this.contacts.add(t.contacts),this.groups.add(t.groups),this.blocklist.add(t.blocklist)},e}();t.ContactsInfo=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-contacts-web-service/lib/contactsWebService",["require","exports","lodash-compat","swx-utils-common","swx-xhr-dispatcher","./utils/contactsInfo"],e)}(function(e,t){function u(e,u){function l(t){return e().then(function(e){return{headers:{Accept:i.contentTypes.JSON_V1_0,"X-Skypetoken":e,"X-Skype-Caller":u.appName,"X-Skype-Request-Id":r.guid.create().substring(0,8)},reporting:{serviceName:t}}})}function c(e,n,r){return n===void 0&&(n="/"),r===void 0&&(r=t.reasons.DEFAULT),n=n||"/",r=r||t.reasons.DEFAULT,l("getRawView").then(function(i){var s="contacts/v2/users/"+encodeURIComponent(e)+"?delta&reason="+encodeURIComponent(r);return i.headers[t.headers.IF_NONE_MATCH]=n,a.get(s,i)})}function h(e,n,r){n===void 0&&(n="/"),r===void 0&&(r=t.reasons.DEFAULT),n=n||"/",r=r||t.reasons.DEFAULT;var i=new s.ContactsInfo;return new Promise(function(s,o){l("getRawView").then(function(u){var l=function(e){e||o({status:""}),i.update(e);if(e.request){var n=e.request.getResponseHeader(t.headers.CONTINUATION);if(!n){e.response=e.response||{},e.response.contacts=i.contacts.getItems(),e.response.groups=i.groups.getItems(),e.response.blocklist=i.blocklist.getItems(),e.response.scope=i.firstScope,e.duration=i.duration,s(e);return}u.headers[t.headers.CONTINUATION]=n}return a.get(c,u).then(l.bind(null),o)},c="contacts/v2/users/"+encodeURIComponent(e)+"?delta&page_size="+f+"&reason="+encodeURIComponent(r);u.headers[t.headers.IF_NONE_MATCH]=n,l({})})})}function p(e,n){return n===void 0&&(n=t.reasons.DEFAULT),n=n||t.reasons.DEFAULT,l("getMyContacts").then(function(t){var r="contacts/v2/users/"+encodeURIComponent(e)+"/contacts?reason="+encodeURIComponent(n);return a.get(r,t)})}function d(e,n,r){return n===void 0&&(n="/"),r===void 0&&(r=t.reasons.DEFAULT),n=n||"/",r=r||t.reasons.DEFAULT,l("getMyContacts").then(function(i){var s="contacts/v2/users/"+encodeURIComponent(e)+"/contacts?delta&reason="+encodeURIComponent(r);return i.headers[t.headers.IF_NONE_MATCH]=n,a.get(s,i)})}function v(e,t,r){return l("addContact").then(function(s){var o="contacts/v2/users/"+encodeURIComponent(e)+"/contacts",u=n.merge(s,{contentType:i.contentTypes.JSON,payload:JSON.stringify({mri:t,greeting:r})});return a.post(o,u)})}function m(e,t,r){return l("addContact").then(function(s){var o="contacts/v2/users/"+encodeURIComponent(e)+"/contacts",u=n.merge(s,{contentType:i.contentTypes.JSON,payload:JSON.stringify({mri:t,phones:[{type:"other",number:r}],send_invite:!1})});return a.post(o,u)})}function g(e,t){return l("deleteContact").then(function(n){var r="contacts/v2/users/"+encodeURIComponent(e)+"/contacts/"+encodeURIComponent(t);return a.remove(r,n)})}function y(e,t,r,s){return r===void 0&&(r=!1),l("blockContact").then(function(o){var f="contacts/v2/users/"+encodeURIComponent(e)+"/contacts/blocklist/"+encodeURIComponent(t),l={report_abuse:String(r),ui_version:u.appName};r&&s&&(l.reason=s);var c=n.merge(o,{contentType:i.contentTypes.FORM_URL_ENCODED,payload:JSON.stringify(l)});return a.put(f,c)})}function b(e,t){return l("unblockContact").then(function(n){var r="contacts/v2/users/"+encodeURIComponent(e)+"/contacts/blocklist/"+encodeURIComponent(t);return a.remove(r,n)})}function w(e,t){return l("addContactToFavorites").then(function(n){var r="contacts/v2/users/"+encodeURIComponent(e)+"/contacts/favorites/"+encodeURIComponent(t);return a.put(r,n)})}function E(e,t){return l("removeContactFromFavorites").then(function(n){var r="contacts/v2/users/"+encodeURIComponent(e)+"/contacts/favorites/"+encodeURIComponent(t);return a.remove(r,n)})}function S(e){return l("getIncomingContactInvites").then(function(t){var n="contacts/v2/users/"+encodeURIComponent(e)+"/invites";return a.get(n,t)})}function x(e,t){return l("acceptContactInvite").then(function(n){var r="contacts/v2/users/"+encodeURIComponent(e)+"/invites/"+encodeURIComponent(t)+"/accept";return a.put(r,n)})}function T(e,t){return l("declineContactInvite").then(function(n){var r="contacts/v2/users/"+encodeURIComponent(e)+"/invites/"+encodeURIComponent(t)+"/decline";return a.put(r,n)})}function N(e,t,r,s){return l("addContactPhoneNumber").then(function(o){var u="contacts/v2/users/"+encodeURIComponent(e)+"/contacts/"+encodeURIComponent(t)+"/phones",f={number:s,type:r},l=n.merge(o,{contentType:i.contentTypes.JSON,payload:JSON.stringify(f)});return a.post(u,l)})}function C(e,t,r,s,o){return l("modifyContactPhoneNumber").then(function(u){var f="contacts/v2/users/"+encodeURIComponent(e)+"/contacts/"+encodeURIComponent(t)+"/phones/"+o,l={number:s,type:r},c=n.merge(u,{contentType:i.contentTypes.JSON,payload:JSON.stringify(l)});return a.put(f,c)})}function k(e,t,n){return l("deleteContactPhoneNumber").then(function(r){var i="contacts/v2/users/"+encodeURIComponent(e)+"/contacts/"+encodeURIComponent(t)+"/phones/"+n;return a.remove(i,r)})}var a=i.build(u),f=u.pageSize||o;return{getRawViewDelta:u.fetchingByPageEnabled?h:c,getMyContacts:p,getMyContactsDelta:d,getInvites:S,addContact:v,addPSTNContact:m,deleteContact:g,blockContact:y,unblockContact:b,acceptContactInvite:x,declineContactInvite:T,addContactToFavorites:w,removeContactFromFavorites:E,addContactPhoneNumber:N,modifyContactPhoneNumber:C,deleteContactPhoneNumber:k}}var n=e("lodash-compat"),r=e("swx-utils-common"),i=e("swx-xhr-dispatcher"),s=e("./utils/contactsInfo"),o=100;t.reasons={DEFAULT:"default",NOTIFICATION:"notification"},t.headers={IF_NONE_MATCH:"If-None-Match",CONTINUATION:"X-Skype-Continuation-Token"},t.build=u}),define("swx-contacts-web-service",["swx-contacts-web-service/lib/contactsWebService"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/contactsV2/instance",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","swx-client-info","../serviceAccessLayer/decorations/reporting","swx-contacts-web-service","swx-constants"],e)}(function(e,t){function f(){var e;return a||(e=n.get().signInManager._skypeToken,a=o.build(e,{host:r.settings.contactsService.host,appName:i.getBIAppName(),decorations:[s],pageSize:r.settings.contactsService.pageSize,fetchingByPageEnabled:r.isFeatureOn(u.COMMON.featureFlags.FETCH_CONTACTS_BY_PAGE)})),a}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("swx-client-info"),s=e("../serviceAccessLayer/decorations/reporting"),o=e("swx-contacts-web-service"),u=e("swx-constants"),a;t.get=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/contacts/serviceSettings",["require","exports","jskype-settings-instance"],e)}(function(e,t){function r(){return n.settings.contactsService.host}function i(e,t,r){return o(n.settings.contactsService.myContactsEndpoint,e,t,r)}function s(){return n.settings.contactsService.retry}function o(e,n,r,i){return i=i||t.reasons["default"],e.replace(t.tokens.id,encodeURIComponent(n)).replace(t.tokens.version,r).replace(t.tokens.reason,i)}function u(e,t){return e.reduce(function(e,n){return e[n]=t(n),e},{})}function a(e){return t.name+"-"+e}function f(e){return"${"+e+"}"}var n=e("jskype-settings-instance");t.getHost=r,t.getMyContactsEndpoint=i,t.getRetryPolicy=s,t.name="CBLProxy",t.version="v1",t.actions=u(["getMyContacts","blockContact","deleteContact"],a),t.reasons={"default":"default",notification:"notification"},t.tokens=u(["id","contactId","contactType","version","reason"],f)}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-chat-service/lib/serviceSettings",["require","exports","jskype-settings-instance"],e)}(function(e,t){function r(){return n.settings.webApiServiceHost}var n=e("jskype-settings-instance");t.getHost=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/entitlement/serviceSettings",["require","exports","jskype-settings-instance"],e)}(function(e,t){function r(){return n.settings.entitlementService.host}function i(e){return n.settings.entitlementService.listingEndpoint.replace(t.tokens.username,encodeURIComponent(e))}function s(e,r){return n.settings.entitlementService.serviceEndpoint.replace(t.tokens.username,encodeURIComponent(e)).replace(t.tokens.service,r)}function o(){return n.settings.entitlementService.retry}function u(e){return t.name+"-"+e}function a(e){return"${"+e+"}"}var n=e("jskype-settings-instance");t.getHost=r,t.getEntitlementListingEndpoint=i,t.getEntitlementServiceEndpoint=s,t.getRetryPolicy=o,t.name="Entitlement",t.version="3.0",t.serviceNames={credit:"pstn"},t.actions={getEntitlementService:u("getEntitlementService")},t.tokens={username:a("username"),service:a("service")}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/contacts/facade",["require","exports","./serviceSettings"],e)}(function(e,t){var n=e("./serviceSettings"),r=function(){function e(e,t,n){this.mePersonId=e,this.serviceLocator=t,this.optionsBuilder=n}return e.prototype.getMyContacts=function(t,r,i){var s=this;return this.optionsBuilder.setServiceName(n.actions.getMyContacts),r?this.optionsBuilder.setHeader(e.IF_NONE_MATCH,r):this.invalidateETag(),this.optionsBuilder.build().then(function(e){var r=n.getMyContactsEndpoint(t,n.version,i);return s.serviceLocator.get(r,e)})},e.prototype.invalidateETag=function(){this.optionsBuilder.setHeader(e.IF_NONE_MATCH,"/")},e}();(function(e){e.IF_NONE_MATCH="If-None-Match"})(r||(r={})),t.__esModule=!0,t["default"]=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/contacts/main",["require","exports","./facade"],e)}(function(e,t){function i(e,t,i){return r||(r=new n["default"](e,t,i)),r}var n=e("./facade"),r;t.getInstance=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-chat-service/lib/utils/conversationMetadataStore",["require","exports"],e)}(function(e,t){var n=function(){function e(){this.conversationMetadataStore={}}return e.prototype.get=function(e){return this.conversationMetadataStore[e]?this.conversationMetadataStore[e].syncState:undefined},e.prototype.set=function(e,t){this.conversationMetadataStore[e]={syncState:t}},e.prototype.clear=function(e){delete this.conversationMetadataStore[e]},e}();t.__esModule=!0,t["default"]=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-chat-service/lib/utils/lockAndKey",["require","exports"],e)}(function(e,t){var n="msmsgs@msnmsgr.com",r="Q1P7W2E4J9R8U3S5",i=function(){function e(e){this.auth=e}return e.prototype.generate=function(){var e=this.getTimeInSeconds(),t=this.getMacHash(e);return this.buildLockAndKey(e,t)},e.prototype.getTimeInSeconds=function(){var e=window.chatServerTime||(new Date).getTime();return Math.round(e/1e3).toString()},e.prototype.getMacHash=function(e){return this.auth.getMacHash(e,n,r)},e.prototype.buildLockAndKey=function(e,t){return"appId="+n+"; time="+e+"; lockAndKeyResponse="+t},e}();t.__esModule=!0,t["default"]=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-chat-service/lib/utils/exponentialTimeout",["require","exports","jskype-settings-instance","swx-constants"],e)}(function(e,t){function u(){o&&clearTimeout(o)}function a(e){var t=1e3,a=12e4,f=0;n.isFeatureOn(r.COMMON.featureFlags.ENABLE_ENDPOINT_ECS_CONFIG)&&(t=n.settings.webApiService.endpointRetry.base*1e3,a=n.settings.webApiService.endpointRetry.limit*1e3,f=n.settings.webApiService.endpointRetry.noiseFactor),u(),i===null&&(i=t),o=setTimeout(e,i+Math.random()*f*i),i<a&&(s++,i*=s)}function f(){u(),i=null,s=1}var n=e("jskype-settings-instance"),r=e("swx-constants"),i=null,s=1,o;t.execute=a,t.reset=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-chat-service/lib/utils/sanitizer",["require","exports"],e)}(function(e,t){function i(e,n){n===void 0&&(n=!1),e.forEach(function(e){if(!e)return;t.message(e.lastMessage,n)})}var n=["id","type","clientmessageid","ackrequired","imdisplayname","from","messagetype","conversationLink","originalarrivaltime","composetime","content","contenttype","contentformat","skypeeditedid","skypeeditoffset","skypeemoteoffset","skypeguid","skypeignore","properties","isactive"],r=["_isFromPolling","originalContent","personId","timestamp","contactRequestType","greeting","isOutgoing","pstnEventType","isGroup","participantName","participantEndpoint","pluginFreeMessageType"];t.message=function(e,t){t===void 0&&(t=!1);var i=t?n:n.concat(r);for(var s in e)e.hasOwnProperty(s)&&i.indexOf(s)===-1&&delete e[s]},t.conversations=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("msr-crypto/lib/msrcrypto.aes",["require","exports"],e)}(function(){var e="1.3",t=t||function(){function p(e,t,n,r,i){return[]}function E(){function u(e){var t;for(t=e.length-1;t>=0;t-=1){e[t]+=1,e[t]>=256&&(e[t]=0);if(e[t])break}}function a(){t=l.getVector(32),n=l.getVector(16),r=32,i=48,s=1}function f(e,t){t=t||[0];if(t.length>i)throw new Error("Incorrect entropy or additionalEntropy length");t=t.concat(l.getVector(i-t.length)),e=e.concat(l.getVector((i-e.length%i)%i));for(var n=0;n<e.length;n+=i){var r=l.xorVectors(e.slice(n,n+i),t);c(r)}s=1}function c(e){var s=[],o=new g.aes(t);while(s.length<i){u(n);var a=n.slice(0,16),f=o.encrypt(a);s=s.concat(f)}s=l.xorVectors(s,e),t=s.slice(0,r),n=s.slice(r)}function h(e,r){if(e>=65536)throw new Error("too much random requested");if(s>o)throw new Error("Reseeding is required");if(r&&r.length>0){while(r.length<i)r=r.concat(l.getVector(i-r.length));c(r)}else r=l.getVector(i);var a=[],f=new g.aes(t);while(a.length<e){u(n);var h=n.slice(0,n.length),p=f.encrypt(h);a=a.concat(p)}return a=a.slice(0,e),c(r),s+=1,a}if(this instanceof E){var e=!1,t,n,r,i,s=1,o=1<<24;return a(),{reseed:f,init:function(t,n){if(t.length<i)throw new Error("Initial entropy length too short");a(),f(t,n),e=!0},getBytes:function(t,n){if(!e)throw new Error("can't get randomness before initialization");return h(t,n)},getNonZeroBytes:function(t,n){if(!e)throw new Error("can't get randomness before initialization");var r=[],i;while(r.length<t){i=h(t,n);for(var s=0;s<i.length;s+=1)i[s]!==0&&r.push(i[s])}return r.slice(0,t)}}}throw new Error("create MsrcryptoPrng object with new keyword")}function x(){function a(){var n,r=[];for(n=0;n<e;n+=1)r[n]=Math.floor(Math.random()*256);var a=window.crypto||window.msCrypto;if(a&&typeof a.getRandomValues=="function"&&window.Uint8Array){var f=new window.Uint8Array(e);a.getRandomValues(f),r=r.concat(Array.apply(null,f)),o=!0}var h=new XMLHttpRequest;for(n=0;n<u.length;n+=1)try{var p=h.getResponseHeader(u[n]);if(p){var d=l.stringToBytes(p);r=r.concat(d)}}catch(v){}o||(r=r.concat(t.splice(0,t.length)),c.startCollectors()),s?i.reseed(r):i.init(r),s=!0}function f(e){for(var r=0;r<e.length;++r)t.push(e[r]);t.length>=n&&c.stopCollectors()}var e=48,t=[],n=128,r=0,i=new E,s=!1,o=!1,u=["Cookie","RedirectUri","ETag","x-ms-client-antiforgery-id","x-ms-client-request-id","x-ms-client-session-id","SubscriptionPool"],c=function(){return{startCollectors:function(){if(!this.collectorsRegistered){if(window.addEventListener)window.addEventListener("mousemove",this.MouseEventCallBack,!0),window.addEventListener("load",this.LoadTimeCallBack,!0);else{if(!document.attachEvent)throw new Error("Can't attach events for entropy collection");document.attachEvent("onmousemove",this.MouseEventCallBack),document.attachEvent("onload",this.LoadTimeCallBack)}this.collectorsRegistered=1}},stopCollectors:function(){this.collectorsRegistered&&(window.removeEventListener?(window.removeEventListener("mousemove",this.MouseEventCallBack,1),window.removeEventListener("load",this.LoadTimeCallBack,1)):window.detachEvent&&(window.detachEvent("onmousemove",this.MouseEventCallBack),window.detachEvent("onload",this.LoadTimeCallBack)),this.collectorsRegistered=0)},MouseEventCallBack:function(e){var t=(new Date).valueOf(),n=e.x||e.clientX||e.offsetX||0,r=e.y||e.clientY||e.offsetY||0,i=[t&255,t>>8&255,t>>16&255,t>>24&255,n&255,n>>8&255,r&255,r>>8&255];f(i)},LoadTimeCallBack:function(){var e=(new Date).valueOf(),t=[e&255,e>>8&255,e>>16&255,e>>24&255];f(t)}}}();return{init:function(){a();if(!o&&!r)try{c.startCollectors()}catch(e){}},reseed:function(e){i.reseed(e)},read:function(e){if(!s)throw new Error("Entropy pool is not initialized.");var t=i.getBytes(e);return a(),t}}}var e={};e.register=function(t,n,r){e[t]||(e[t]={});var i=e[t];i[n]||(i[n]=r)},e.exists=function(t,n){return e[t]?e[t][n]?!0:!1:!1};var t=function(){if(typeof document!="undefined")try{throw new Error}catch(e){if(e.stack){var t=/\w+:\/\/(.+?\/)*.+\.js/.exec(e.stack);return t&&t.length>0?t[0]:null}}else if(typeof self!="undefined")return self.location.href;return null}(),n=!1,r=typeof Worker!="undefined",i=typeof importScripts!="undefined",s=typeof Uint8Array!="undefined",o=function(){try{return Object.defineProperty({},"oncomplete",{}),!0}catch(e){return!1}}(),u=r,a=function(e,t,n,r,i){if(!o){e[t]=n;return}var s={};r&&(s.get=r),i&&(s.set=i),Object.defineProperty(e,t,s)},f={},l=function(){function n(n,r){var i="";r||(r=!1);if(n.pop||n.subarray)n=String.fromCharCode.apply(null,n);if(t)i=btoa(n);else{var s,o,u,a,f,l,c,h;for(h=0;h<n.length;h+=3)s=n.charCodeAt(h),o=n.charCodeAt(h+1),u=n.charCodeAt(h+2),a=s>>2,f=(s&3)<<4|o>>4,l=(o&15)<<2|u>>6,c=u&63,isNaN(o)?l=c=64:isNaN(u)&&(c=64),i=i+e.charAt(a)+e.charAt(f)+e.charAt(l)+e.charAt(c)}return r?i.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""):i}function r(e){if(t){e=e.replace(/-/g,"+").replace(/_/g,"/");while(e.length%4!==0)e+="=";return atob(e)}return String.fromCharCode.apply(null,i(e))}function i(t){t=t.replace(/-/g,"+").replace(/_/g,"/");while(t.length%4!==0)t+="=";var n=[],r,i,s,o,u,a,f,l;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(l=0;l<t.length;l+=4)o=e.indexOf(t.charAt(l)),u=e.indexOf(t.charAt(l+1)),a=e.indexOf(t.charAt(l+2)),f=e.indexOf(t.charAt(l+3)),r=o<<2|u>>4,i=(u&15)<<4|a>>2,s=(a&3)<<6|f,n.push(r),a!==64&&n.push(i),f!==64&&n.push(s);return n}function s(e){return Object.prototype.toString.call(e).slice(8,-1)}function o(e,t){var n="";typeof t=="undefined"&&(t=!1);for(var r=0;r<e.length;r++){t&&r%4===0&&r!==0&&(n+="-");var i=e[r].toString(16).toUpperCase();i.length===1&&(n+="0"),n+=i}return n}function u(e,t){return t=t||0,e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function a(e){var t=new Array(e.length);for(var n=0;n<t.length;n++)t[n]=e.charCodeAt(n);return t}function f(e){e=e.replace(/\-/g,"");var t=[];while(e.length>=2)t.push(parseInt(e.substring(0,2),16)),e=e.substring(2,e.length);return t}function l(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function c(e,t,n){var r=i(e),s=[],o;if(isNaN(t))return r;for(o=0;o<r.length;o+=t)s.push(r.slice(o,o+t));if(n)for(o=0;o<s.length;o++)s[o]=(s[o][0]<<24)+(s[o][1]<<16)+(s[o][2]<<8)+s[o][3];return s}function h(e){return[e>>>24&255,e>>>16&255,e>>>8&255,e&255]}function p(e){var t=[];for(var n=0;n<e.length;n++)t=t.concat(h(e[n]));return t}function d(e,t){var n=Math.min(e.length,t.length),r=new Array(n);for(var i=0;i<n;i+=1)r[i]=e[i]^t[i];return r}function v(e,t){t||(t=0);var n=new Array(e);for(var r=0;r<e;r+=1)n[r]=t;return n}function m(e){function t(){var t=6e4,n=[],r=[];if(e.length<=t)return Array.apply(null,e);for(var i=0,s=e.length;i<s;i+=t)n.push(e.subarray(i,i+t));return n.forEach(function(e){r=r.concat(Array.apply(null,e))}),r}return e.pop?e:e.length===1?[e[0]]:t()}function g(e,t,n){while(e.length<n)e.push(t);return e}function y(e,t,n){while(e.length<n)e.unshift(t);return e}function b(e,t){var n=!0;e.length!==t.length&&(n=!1);for(var r=0;r<e.length;r++)e[r]!==t[r]&&(n=!1);return n}function w(e){if(s(e)!=="Array")return!1;var t;for(var n=0;n<e.length;n++){t=e[n];if(isNaN(t)||t<0||t>255)return!1}return!0}var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t=typeof btoa!="undefined";return{toBase64:n,base64ToString:r,base64ToBytes:i,getObjectType:s,bytesToHexString:o,bytesToInt32:u,stringToBytes:a,unpackData:c,hexToBytesArray:f,int32ToBytes:h,int32ArrayToBytes:p,toArray:m,arraysEqual:b,clone:l,xorVectors:d,padEnd:g,padFront:y,getVector:v,verifyByteArray:w}}(),c=function(){function t(e){return i&&self.postMessage(e),e}return{jsCryptoRunner:function(n){var r=n.data.operationType,i;if(!e.exists(r,n.data.algorithm.name))throw new Error("unregistered algorithm.");var s=e[r][n.data.algorithm.name],o=n.data;return o.operationSubType==="process"?(s(o),i=t({type:"process"})):i=t(s(o)),i}}}();i&&(self.onmessage=function(e){if(e.data.prngSeed){var t=e.data.prngSeed;S.init(t);return}c.jsCryptoRunner(e)});var h=function(){function t(e){var t=[];for(var n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t[t.length-1]===0&&t.pop(),t}function n(e){var t=e.algorithm.name.slice(0,3).toLowerCase();return t==="rsa"?"RSA":t==="ecd"?"EC":"oct"}function r(r,i){var s={};s.kty=n(r),s.extractable=r.extractable;if(i.pop)s.k=e.toBase64(i,!0);else for(var o in i)i[o].pop&&(s[o]=e.toBase64(i[o],!0));r.algorithm.namedCurve&&(s.crv=r.algorithm.namedCurve);var u=JSON.stringify(s,null,"	");return t(u)}function i(t,n,r){var i=String.fromCharCode.apply(null,t),s=JSON.parse(i);for(var o=0;o<r.length;o+=1){var u=s[r[o]];u&&(s[r[o]]=e.base64ToBytes(u))}return s}var e=l;return{keyToJwk:r,jwkToKey:i}}(),d=function(e,t,n,r,i,s,o){function p(e){var t=Math.floor(e.length/i);for(var n=0;n<t;n++)s(e,n,a,r,f);return h+=t,e.slice(t*i)}function d(){var e=[];for(var t=0;t<a.length;t++)e=e.concat(u.int32ToBytes(a[t]));return e.length=o/8,e}function v(e){var t=i-e.length%i;t<=i/8&&(t+=i);var n=u.getVector(t);n[0]=128;var r=(e.length+h*i)*8;return n[t-4]=r>>>24&255,n[t-3]=r>>>16&255,n[t-2]=r>>>8&255,n[t-1]=r&255,e.concat(n)}function m(e){return c=p(e),y()}function g(e){c=c.concat(e),c.length>=i&&(c=p(c));return}function y(){if(p(v(c)).length!==0)throw new Error("buffer.length !== 0");var e=d();return c=[],a=n.slice(),h=0,e}var u=l,a=n.slice(),f=new Array(i),c=[],h=0;return{name:e,computeHash:m,process:g,finish:y,der:t,hashLen:o,maxMessageSize:4294967295}},v=function(){function t(t,n,r,i,s){var o,u,a,f,l,c=64,h=4294967295,p=r[0],d=r[1],v=r[2],m=r[3],g=r[4],y=r[5],b=r[6],w=r[7];for(u=0;u<16;u++)s[u]=e.bytesToInt32(t,n*c+u*4);for(o=16;o<64;o++)f=s[o-15],l=s[o-2],s[o]=((l>>>17|l<<15)^(l>>>19|l<<13)^l>>>10)+s[o-7]+((f>>>7|f<<25)^(f>>>18|f<<14)^f>>>3)+s[o-16],s[o]=s[o]&h;for(u=0;u<64;u++)a=w+((g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7))+(g&y^~g&b)+i[u]+s[u],m+=a,a+=((p>>>2|p<<30)^(p>>>13|p<<19)^(p>>>22|p<<10))+(p&(d^v)^d&v),w=b,b=y,y=g,g=m,m=v,v=d,d=p,p=a;return r[0]+=p&h,r[1]+=d&h,r[2]+=v&h,r[3]+=m&h,r[4]+=g&h,r[5]+=y&h,r[6]+=b&h,r[7]+=w&h,r}var e=l,n,r,i,s,o,u=e.unpackData;return r=u("wQWe2DZ81QcwcN0X9w5ZOf/ACzFoWBURZPmPp776T6Q",4,1),i=u("agnmZ7tnroU8bvNypU/1OlEOUn+bBWiMH4PZq1vgzRk",4,1),n=u("QoovmHE3RJG1wPvP6bXbpTlWwltZ8RHxkj+CpKscXtXYB6qYEoNbASQxhb5VDH3Dcr5ddIDesf6b3AanwZvxdOSbacHvvkeGD8GdxiQMocwt6SxvSnSEqlywqdx2+YjamD5RUqgxxm2wAyfIv1l/x8bgC/PVp5FHBspjURQpKWcntwqFLhshOE0sbfxTOA0TZQpzVHZqCruBwskuknIshaK/6KGoGmZLwkuLcMdsUaPRkugZ1pkGJPQONYUQaqBwGaTBFh43bAgnSHdMNLC8tTkcDLNO2KpKW5zKT2gub/N0j4LueKVjb4TIeBSMxwIIkL7/+qRQbOu++aP3xnF48g",4,1),s=u("MC0wDQYJYIZIAWUDBAIEBQAEHA"),o=u("MDEwDQYJYIZIAWUDBAIBBQAEIA"),{sha224:d("SHA-224",s,r,n,64,t,224),sha256:d("SHA-256",o,i,n,64,t,256)}}();typeof e!="undefined"&&(v.hash256=function(e){if(e.operationSubType==="process"){v.sha256.process(e.buffer);return}return e.operationSubType==="finish"?v.sha256.finish():v.sha256.computeHash(e.buffer)},v.hash224=function(e){if(e.operationSubType==="process"){v.sha224.process(e.buffer);return}return e.operationSubType==="finish"?v.sha224.finish():v.sha224.computeHash(e.buffer)},e.register("digest","sha-224",v.hash224),e.register("digest","sha-256",v.hash256)),f["sha-224"]=v.sha224,f["sha-256"]=v.sha256;var m=function(){function t(e,t,n,r,i){var s=t+r|0,o=s>>>0<r>>>0;i[0]=e+n+o|0,i[1]=s;return}function n(e,n,r,i,s){var o,u,a=128,f,l,c,h,p,d,v=[],m=[],g=[],y,b=r[0],w=r[1],E=r[2],S=r[3],x=r[4],T=r[5],N=r[6],C=r[7],k=r[8],L=r[9],A=r[10],O=r[11],M=r[12],_=r[13],D=r[14],P=r[15];for(o=0;o<32;o++)y=n*a+o*4,s[o]=e.slice(y,y+4),s[o]=s[o][0]<<24|s[o][1]<<16|s[o][2]<<8|s[o][3];for(o=32;o<160;o+=2)p=s[o-30],d=s[o-29],f=(p>>>1|d<<31)^(p>>>8|d<<24)^p>>>7,l=(d>>>1|p<<31)^(d>>>8|p<<24)^(d>>>7|p<<25),p=s[o-4],d=s[o-3],c=(p>>>19|d<<13)^(d>>>29|p<<3)^p>>>6,h=(d>>>19|p<<13)^(p>>>29|d<<3)^(d>>>6|p<<26),t(c,h,s[o-14],s[o-13],v),t(f,l,v[0],v[1],v),t(s[o-32],s[o-31],v[0],v[1],v),s[o]=v[0],s[o+1]=v[1];for(u=0;u<160;u+=2)f=(k>>>14|L<<18)^(k>>>18|L<<14)^(L>>>9|k<<23),l=(L>>>14|k<<18)^(L>>>18|k<<14)^(k>>>9|L<<23),c=k&A^M&~k,h=L&O^_&~L,t(D,P,f,l,v),t(c,h,i[u],i[u+1],m),t(v[0],v[1],s[u],s[u+1],g),t(m[0],m[1],g[0],g[1],g),t(g[0],g[1],N,C,v),N=v[0],C=v[1],l=(w>>>28|b<<4)^(b>>>2|w<<30)^(b>>>7|w<<25),f=(b>>>28|w<<4)^(w>>>2|b<<30)^(w>>>7|b<<25),h=w&(S^T)^S&T,c=b&(E^x)^E&x,t(g[0],g[1],f,l,v),f=v[0],l=v[1],t(c,h,f,l,v),f=v[0],l=v[1],D=M,P=_,M=A,_=O,A=k,O=L,k=N,L=C,N=x,C=T,x=E,T=S,E=b,S=w,b=f,w=l;return t(r[0],r[1],b,w,v),r[0]=v[0],r[1]=v[1],t(r[2],r[3],E,S,v),r[2]=v[0],r[3]=v[1],t(r[4],r[5],x,T,v),r[4]=v[0],r[5]=v[1],t(r[6],r[7],N,C,v),r[6]=v[0],r[7]=v[1],t(r[8],r[9],k,L,v),r[8]=v[0],r[9]=v[1],t(r[10],r[11],A,O,v),r[10]=v[0],r[11]=v[1],t(r[12],r[13],M,_,v),r[12]=v[0],r[13]=v[1],t(r[14],r[15],D,P,v),r[14]=v[0],r[15]=v[1],r}var e=l,r,i,s,o,u,a,f,c=e.unpackData;return r=c("y7udXcEFnthimikqNnzVB5FZAVowcN0XFS/s2PcOWTlnMyZn/8ALMY60SodoWBUR2wwuDWT5j6dHtUgdvvpPpA==",4,1),i=c("agnmZ/O8yQi7Z66FhMqnOzxu83L+lPgrpU/1Ol8dNvFRDlJ/reaC0ZsFaIwrPmwfH4PZq/tBvWtb4M0ZE34heQ",4,1),s=c("QoovmNcoriJxN0SRI+9lzbXA+8/sTTsv6bXbpYGJ27w5VsJb80i1OFnxEfG2BdAZkj+CpK8ZT5urHF7V2m2BGNgHqpijAwJCEoNbAUVwb74kMYW+TuSyjFUMfcPV/7Ticr5ddPJ7iW+A3rH+OxaWsZvcBqclxxI1wZvxdM9pJpTkm2nBnvFK0u++R4Y4TyXjD8GdxouM1bUkDKHMd6ycZS3pLG9ZKwJ1SnSEqm6m5INcsKncvUH71Hb5iNqDEVO1mD5RUu5m36uoMcZtLbQyELADJ8iY+yE/v1l/x77vDuTG4AvzPaiPwtWnkUeTCqclBspjUeADgm8UKSlnCg5ucCe3CoVG0i/8LhshOFwmySZNLG38WsQq7VM4DROdlbPfZQpzVIuvY952agq7PHeyqIHCyS5H7a7mknIshRSCNTuiv+ihTPEDZKgaZku8QjABwkuLcND4l5HHbFGjBlS+MNGS6BnW71IY1pkGJFVlqRD0DjWFV3EgKhBqoHAyu9G4GaTBFrjS0MgeN2wIUUGrUydId0zfjuuZNLC8teGbSKg5HAyzxclaY07YqkrjQYrLW5zKT3dj43NoLm/z1rK4o3SPgu5d77L8eKVjb0MXL2CEyHgUofCrcozHAggaZDnskL7/+iNjHiikUGzr3oK96b75o/eyxnkVxnF48uNyUyvKJz7O6iZhnNGGuMchwMIH6tp91s3g6x71fU9/7m7ReAbwZ6pyF2+6CmN9xaLImKYRP5gEvvkNrhtxCzUTHEcbKNt39SMEfYQyyqt7QMckkzyevgoVyb68Qx1nxJwQDUxMxdS+yz5Ctll/KZz8ZX4qX8tvqzrW+uxsRBmMSkdYFw==",4,1),o=c("MEEwDQYJYIZIAWUDBAICBQAEMA"),u=c("MFEwDQYJYIZIAWUDBAIDBQAEQA"),a=c("MC0wDQYJYIZIAWUDBAIFBQAEHA"),f=c("MDEwDQYJYIZIAWUDBAIGBQAEIA"),{sha384:d("SHA-384",o,r,s,128,n,384),sha512:d("SHA-512",u,i,s,128,n,512),sha512_224:d("SHA-512.224",a,i,s,128,n,224),sha512_256:d("SHA-512.256",f,i,s,128,n,256)}}();typeof e!="undefined"&&(m.hash384=function(e){if(e.operationSubType==="process"){m.sha384.process(e.buffer);return}return e.operationSubType==="finish"?m.sha384.finish():m.sha384.computeHash(e.buffer)},m.hash512=function(e){if(e.operationSubType==="process"){m.sha512.process(e.buffer);return}return e.operationSubType==="finish"?m.sha512.finish():m.sha512.computeHash(e.buffer)},e.register("digest","sha-384",m.hash384),e.register("digest","sha-512",m.hash512)),f["sha-384"]=m.sha384,f["sha-512"]=m.sha512;var g=function(){var e,t,n,r,i,s,o,u,a,f;return{aes:function(c){e||(e=l.unpackData("AAIEBggKDA4QEhQWGBocHiAiJCYoKiwuMDI0Njg6PD5AQkRGSEpMTlBSVFZYWlxeYGJkZmhqbG5wcnR2eHp8foCChIaIioyOkJKUlpianJ6goqSmqKqsrrCytLa4ury+wMLExsjKzM7Q0tTW2Nrc3uDi5Obo6uzu8PL09vj6/P4bGR8dExEXFQsJDw0DAQcFOzk/PTMxNzUrKS8tIyEnJVtZX11TUVdVS0lPTUNBR0V7eX99c3F3dWtpb21jYWdlm5mfnZORl5WLiY+Ng4GHhbu5v72zsbe1q6mvraOhp6Xb2d/d09HX1cvJz83DwcfF+/n//fPx9/Xr6e/t4+Hn5QADBgUMDwoJGBseHRQXEhEwMzY1PD86OSgrLi0kJyIhYGNmZWxvaml4e359dHdycVBTVlVcX1pZSEtOTURHQkHAw8bFzM/Kydjb3t3U19LR8PP29fz/+vno6+7t5Ofi4aCjpqWsr6qpuLu+vbS3srGQk5aVnJ+amYiLjo2Eh4KBm5idnpeUkZKDgIWGj4yJiquora6npKGis7C1tr+8ubr7+P3+9/Tx8uPg5ebv7Onqy8jNzsfEwcLT0NXW39zZ2ltYXV5XVFFSQ0BFRk9MSUpraG1uZ2RhYnNwdXZ/fHl6Ozg9Pjc0MTIjICUmLywpKgsIDQ4HBAECExAVFh8cGRoADhwSODYkKnB+bGJIRlRa4O788tjWxMqQnoyCqKa0utvVx8nj7f/xq6W3uZOdj4E7NScpAw0fEUtFV1lzfW9hraOxv5WbiYfd08HP5ev5901DUV91e2lnPTMhLwULGRd2eGpkTkBSXAYIGhQ+MCIslpiKhK6gsrzm6Pr03tDCzEFPXVN5d2VrMT8tIwkHFRuhr72zmZeFi9HfzcPp5/X7mpSGiKKsvrDq5Pb40tzOwHp0ZmhCTF5QCgQWGDI8LiDs4vD+1NrIxpySgI6kqri2DAIQHjQ6KCZ8cmBuREpYVjc5KyUPARMdR0lbVX9xY23X2cvF7+Hz/aepu7WfkYONAA0aFzQ5LiNoZXJ/XFFGS9Ddysfk6f7zuLWir4yBlpu7tqGsj4KVmNPeycTn6v3wa2ZxfF9SRUgDDhkUNzotIG1gd3pZVENOBQgfEjE8Kya9sKeqiYSTntXYz8Lh7Pv21tvMweLv+PW+s6SpioeQnQYLHBEyPyglbmN0eVpXQE3a18DN7uP0+bK/qKWGi5yRCgcQHT4zJClib3h1VltMQWFse3ZVWE9CCQQTHj0wJyqxvKumhYifktnUw87t4Pf6t7qtoIOOmZTf0sXI6+bx/GdqfXBTXklEDwIVGDs2ISwMARYbODUiL2RpfnNQXUpH3NHGy+jl8v+0ua6jgI2alwALFh0sJzoxWFNORXR/Ymmwu6atnJeKgejj/vXEz9LZe3BtZldcQUojKDU+DwQZEsvA3dbn7PH6k5iFjr+0qaL2/eDr2tHMx66luLOCiZSfRk1QW2phfHceFQgDMjkkL42Gm5Chqre81d7DyPny7+Q9NisgERoHDGVuc3hJQl9U9/zh6tvQzcavpLmyg4iVnkdMUVprYH12HxQJAjM4JS6Mh5qRoKu2vdTfwsn48+7lPDcqIRAbBg1kb3J5SENeVQEKFxwtJjswWVJPRHV+Y2ixuqesnZaLgOni//TFztPYenFsZ1ZdQEsiKTQ/DgUYE8rB3Nfm7fD7kpmEj761qKMACRIbJC02P0hBWlNsZX53kJmCi7S9pq/Y0crD/PXu5zsyKSAfFg0Ec3phaFdeRUyrormwj4adlOPq8fjHztXcdn9kbVJbQEk+NywlGhMIAebv9P3Cy9DZrqe8tYqDmJFNRF9WaWB7cgUMFx4hKDM63dTPxvnw6+KVnIeOsbijquzl/vfIwdrTpK22v4CJkpt8dW5nWFFKQzQ9Ji8QGQIL197FzPP64eiflo2Eu7KpoEdOVVxjanF4DwYdFCsiOTCak4iBvrespdLbwMn2/+TtCgMYES4nPDVCS1BZZm90faGos7qFjJee6eD78s3E39YxOCMqFRwHDnlwa2JdVE9GY3x3e/Jrb8UwAWcr/terdsqCyX36WUfwrdSir5ykcsC3/ZMmNj/3zDSl5fFx2DEVBMcjwxiWBZoHEoDi6yeydQmDLBobblqgUjvWsynjL4RT0QDtIPyxW2rLvjlKTFjP0O+q+0NNM4VF+QJ/UDyfqFGjQI+SnTj1vLbaIRD/89LNDBPsX5dEF8Snfj1kXRlzYIFP3CIqkIhG7rgU3l4L2+AyOgpJBiRcwtOsYpGV5HnnyDdtjdVOqWxW9Opleq4IunglLhymtMbo3XQfS72LinA+tWZIA/YOYTVXuYbBHZ7h+JgRadmOlJseh+nOVSjfjKGJDb/mQmhBmS0PsFS7FlIJatUwNqU4v0CjnoHz1/t84zmCmy//hzSOQ0TE3unLVHuUMqbCIz3uTJULQvrDTgguoWYo2SSydluiSW2L0SVy+PZkhmiYFtSkXMxdZbaSbHBIUP3tudpeFUZXp42dhJDYqwCMvNMK9+RYBbizRQbQLB6Pyj8PAsGvvQMBE4prOpERQU9n3OqX8s/O8LTmc5asdCLnrTWF4vk36Bx1325H8RpxHSnFiW+3Yg6qGL4b/FY+S8bSeSCa28D+eM1a9B/dqDOIB8cxsRIQWSeA7F9gUX+pGbVKDS3lep+TyZzvoOA7Ta4q9bDI67s8g1OZYRcrBH66d9Ym4WkUY1UhDH2NAQIECBAgQIAbNmzYq02aL168Y8aXNWrUs33678WROXLk071hwp8lSpQzZsyDHTp06MuNAQIECBAgQIAbNmzYq02aL168Y8aXNWrUs33678WROXLk071hwp8lSpQzZsyDHTp06MuNAQIECBAgQIAbNmzYq02aL168Y8aXNWrUs33678WROXLk071hwp8lSpQzZsyDHTp06MuNAQIECBAgQIAbNmzYq02aL168Y8aXNWrUs33678WROXLk071hwp8lSpQzZsyDHTp06MuNAQIECBAgQIAbNmzYq02aL168Y8aXNWrUs33678WROXLk071hwp8lSpQzZsyDHTp06MuN",256,!1),t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8]);var h=128,p,d,v=4,m,g;switch(c.length*8){case 128:p=128,d=4,m=10;break;case 192:p=192,d=6,m=12;break;case 256:p=256,d=8,m=14;break;default:throw new Error("Unsupported keyLength")}var y=function(e){var t=e[1];e[1]=e[5],e[5]=e[9],e[9]=e[13],e[13]=t,t=e[2],e[2]=e[10],e[10]=t,t=e[6],e[6]=e[14],e[14]=t,t=e[15],e[15]=e[11],e[11]=e[7],e[7]=e[3],e[3]=t},b=function(e){var t=e[13];e[13]=e[9],e[9]=e[5],e[5]=e[1],e[1]=t,t=e[10],e[10]=e[2],e[2]=t,t=e[14],e[14]=e[6],e[6]=t,t=e[3],e[3]=e[7],e[7]=e[11],e[11]=e[15],e[15]=t},w=function(e){var r=e[0],i=e[1],s=e[2],o=e[3],u=e[4],a=e[5],f=e[6],l=e[7],c=e[8],h=e[9],p=e[10],d=e[11],v=e[12],m=e[13],g=e[14],y=e[15];e[0]=t[r]^n[i]^s^o,e[1]=r^t[i]^n[s]^o,e[2]=r^i^t[s]^n[o],e[3]=n[r]^i^s^t[o],e[4]=t[u]^n[a]^f^l,e[5]=u^t[a]^n[f]^l,e[6]=u^a^t[f]^n[l],e[7]=n[u]^a^f^t[l],e[8]=t[c]^n[h]^p^d,e[9]=c^t[h]^n[p]^d,e[10]=c^h^t[p]^n[d],e[11]=n[c]^h^p^t[d],e[12]=t[v]^n[m]^g^y,e[13]=v^t[m]^n[g]^y,e[14]=v^m^t[g]^n[y],e[15]=n[v]^m^g^t[y]},E=function(e){var t=e[0],n=e[1],u=e[2],a=e[3],f=e[4],l=e[5],c=e[6],h=e[7],p=e[8],d=e[9],v=e[10],m=e[11],g=e[12],y=e[13],b=e[14],w=e[15];e[0]=r[t]^s[n]^i[u]^o[a],e[1]=o[t]^r[n]^s[u]^i[a],e[2]=i[t]^o[n]^r[u]^s[a],e[3]=s[t]^i[n]^o[u]^r[a],e[4]=r[f]^s[l]^i[c]^o[h],e[5]=o[f]^r[l]^s[c]^i[h],e[6]=i[f]^o[l]^r[c]^s[h],e[7]=s[f]^i[l]^o[c]^r[h],e[8]=r[p]^s[d]^i[v]^o[m],e[9]=o[p]^r[d]^s[v]^i[m],e[10]=i[p]^o[d]^r[v]^s[m],e[11]=s[p]^i[d]^o[v]^r[m],e[12]=r[g]^s[y]^i[b]^o[w],e[13]=o[g]^r[y]^s[b]^i[w],e[14]=i[g]^o[y]^r[b]^s[w],e[15]=s[g]^i[y]^o[b]^r[w]},S=function(e,t){return[e[0]^t[0],e[1]^t[1],e[2]^t[2],e[3]^t[3]]},x=function(e,t,n){for(var r=0;r<e.length;r+=1)e[r]^=t[r+n]},T=function(e){var t=e[0];e[0]=e[1],e[1]=e[2],e[2]=e[3],e[3]=t},N=function(e){for(var t=0;t<e.length;t+=1)e[t]=u[e[t]]},C=function(e){for(var t=0;t<e.length;t+=1)e[t]=a[e[t]]},k=function(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]},L=function(e,t,n,r){e[4*n]=t[4*r],e[4*n+1]=t[4*r+1],e[4*n+2]=t[4*r+2],e[4*n+3]=t[4*r+3]},A=function(e){var t,n=[],r=0;while(r<4*d)n.push(e[r++]);r=d;while(r<v*(m+1)){t=k(n,r-1);if(r%d===0){var i=r/d,s=[f[i],0,0,0];T(t),N(t),t=S(t,s)}else d>6&&r%d===4&&N(t);var o=S(k(n,r-d),t);L(n,o,r,0),r+=1}return n};return g=A(c),{encrypt:function(e){var t=e,n;x(t,g,0);for(n=1;n<=m-1;n+=1)N(t),y(t),w(t),x(t,g,4*n*v);return N(t),y(t),x(t,g,4*m*v),t},decrypt:function(e){var t=e,n;x(t,g,4*m*v);for(n=m-1;n>=1;n-=1)b(t),C(t),x(t,g,4*n*v),E(t);return b(t),C(t),x(t,g,0),t},clear:function(){},keyLength:p,blockSize:h}}}}(),y=y||{};y.pkcsv7=function(e){function t(t){var n=t.length-1>=0?t.length-1:0,r=t[n],i=r.length,s=i===e;if(s){var o=[],u;for(u=0;u<e;u+=1)o.push(e);t.push(o)}else{var a=e-i&255;while(r.length!==e)r.push(a)}}function n(t){var n=!0;t.length%e!==0&&(n=!1);var r=t.slice(-e),i=r[r.length-1];for(var s=0;s<e;s++){var o=e-s<=i,u=r[s]===i;n=(o?u:!0)&&n}var a=n?i:0;return t.length-=a,n}return{pad:t,unpad:n}};var b=function(e){function i(e){var n=[];a=a.concat(e);var r=Math.floor(a.length/t);for(var i=0;i<r;i++)n.push(a.slice(i*t,(i+1)*t));return a=a.slice(r*t),n}function s(t){var n=[],r;for(var i=0;i<t.length;i++)r=l.xorVectors(c,t[i]),n.push(e.encrypt(r)),c=n[i];return n}function o(t){var n=[],r,i;for(var s=0;s<t.length;s+=1)r=t[s].slice(0,t[s].length),i=e.decrypt(r),n.push(l.xorVectors(c,i)),c=t[s];return n}function u(){a=[],f=[],c=null}var t=e.blockSize/8,n=y.pkcsv7(t),r=function(e){var t=[],n,r;for(n=0;n<e.length;n+=1){var i=e[n];for(r=0;r<i.length;r+=1)t.push(i[r])}return t},a=[],f=[],c;return{init:function(e){if(e.length!==t)throw new Error("Invalid iv size");c=e.slice()},encrypt:function(e){return this.processEncrypt(e),this.finishEncrypt()},processEncrypt:function(e){var t=s(i(e));f=f.concat(r(t));return},finishEncrypt:function(){var e=a.length===1?[[a[0]]]:[a];n.pad(e);var t=f.concat(r(s(e)));return u(),t},decrypt:function(e){return this.processDecrypt(e),this.finishDecrypt()},processDecrypt:function(e){var t=o(i(e));f=f.concat(r(t));return},finishDecrypt:function(){var e=f,t=n.unpad(e);return u(),e}}},w=null;typeof e!="undefined"&&(b.workerEncrypt=function(e){var t;w||(w=b(g.aes(e.keyData)),w.init(e.algorithm.iv));if(e.operationSubType==="process"){w.processEncrypt(e.buffer);return}return e.operationSubType==="finish"?(t=w.finishEncrypt(),w=null,t):(t=w.encrypt(e.buffer),w=null,t)},b.workerDecrypt=function(e){var t;w||(w=b(g.aes(e.keyData)),w.init(e.algorithm.iv));if(e.operationSubType==="process"){w.processDecrypt(e.buffer);return}return e.operationSubType==="finish"?(t=w.finishDecrypt(),w=null,t):(t=w.decrypt(e.buffer),w=null,t)},b.generateKey=function(e){if(e.algorithm.length%8!==0)throw new Error;return{type:"keyGeneration",keyData:S.getBytes(Math.floor(e.algorithm.length/8)),keyHandle:{algorithm:e.algorithm,extractable:e.extractable,keyUsage:e.keyUsage,type:"secret"}}},b.importKey=function(e){var t=h.jwkToKey(e.keyData,e.algorithm,["k"]);return{type:"keyImport",keyData:t.k,keyHandle:{algorithm:e.algorithm,extractable:e.extractable||t.extractable,keyUsage:e.keyUsage,type:"secret"}}},b.exportKey=function(e){var t=h.keyToJwk(e.keyHandle,e.keyData);return{type:"keyExport",keyHandle:t}},e.register("importKey","aes-cbc",b.importKey),e.register("exportKey","aes-cbc",b.exportKey),e.register("generateKey","aes-cbc",b.generateKey),e.register("encrypt","aes-cbc",b.workerEncrypt),e.register("decrypt","aes-cbc",b.workerDecrypt));var S=new E,T;i||(T=function(){function n(){function t(t){try{e=c.jsCryptoRunner({data:t}),(!t.operationSubType||t.operationSubType!=="process")&&this.onmessage({data:e})}catch(n){this.onerror({data:n.description,type:"error"})}}var e;return{postMessage:t,onmessage:null,onerror:null,terminate:function(){}}}function o(e){function s(e,t){}function o(e,t){}function u(e){n=e,this.result&&n({target:this})}function f(e){r=e}function l(){return n}function c(){return r}function h(t){if(t.type==="error"){this.onerror&&this.onerror(t);return}if(t.type==="process")return;this.result=e(t.data),this.oncomplete&&this.oncomplete({target:this});return}var t=null,n=null,r=null,i;return i={dispatchEvent:h,addEventListener:s,removeEventListener:o,result:null},a(i,"oncomplete",null,l,u),a(i,"onerror",null,c,f),i}function f(){function e(e){switch(e.type){case"keyGeneration":case"keyImport":case"keyDerive":return v.add(e.keyHandle,e.keyData),e.keyHandle;case"keyExport":return p(e.keyHandle);case"keyPairGeneration":return v.add(e.keyPair.publicKey.keyHandle,e.keyPair.publicKey.keyData),v.add(e.keyPair.privateKey.keyHandle,e.keyPair.privateKey.keyData),{publicKey:e.keyPair.publicKey.keyHandle,privateKey:e.keyPair.privateKey.keyHandle};default:throw new Error("Unknown key operation")}return}return o(e)}function h(e){function t(e){return e=p(e),e}var n=o(t);return n.process=function(t){e.operationSubType="process",e.buffer=g.toArray(t),m.continueJob(this,g.clone(e))},n.finish=function(){e.operationSubType="finish",e.buffer=[],m.continueJob(this,g.clone(e))},n.abort=function(){m.abortJob(this)},n.onabort=null,n.onprogress=null,n.algorithm=e.algorithm||null,n.key=e.keyHandle||null,n}function p(e){return s&&e.pop?(new Uint8Array(e)).buffer:e}function d(e){e.oncomplete?e.oncomplete({target:e}):setTimeout(function(){d(e)},i)}function y(t,n){if(!e.exists(t,n))throw new Error("unsupported algorithm")}function E(e){var t=v.lookup(e);if(!t)throw new Error("key not found");return t}function x(e,t){var n={operationType:e},r=w[e];for(var i=0;i<r.length;i+=1){var s=b[r[i]],o=t[i];if(!o){if(s.required)throw new Error(s.name);continue}o.subarray&&(o=g.toArray(o));if(l.getObjectType(o)!==s.type)throw new Error(s.name);s.name==="algorithm"&&(o.name=o.name.toLowerCase(),o.iv&&(o.iv=g.toArray(o.iv)),o.salt&&(o.salt=g.toArray(o.salt)),o.additionalData&&(o.additionalData=g.toArray(o.additionalData)),o.hash&&!o.hash.name&&l.getObjectType(o.hash)==="String"&&(o.hash={name:o.hash})),n.hasOwnProperty(s.name)?n[s.name+"1"]=o:n[s.name]=o}return n}function T(e,t,n){var r=x(e,t);y(e,r.algorithm.name),r.keyHandle&&(r.keyData=E(r.keyHandle)),r.keyHandle1&&(r.keyData1=E(r.keyHandle1)),r.algorithm&&r.algorithm.publicKey&&(r.additionalKeyData=E(r.algorithm.publicKey));var i=n?f(r):h(r);return(n||r.buffer||e==="deriveBits"||e==="wrapKey")&&m.runJob(i,r),i}var i=100,v=[];v.add=function(e,t){v.push({keyHandle:e,keyData:t})},v.remove=function(e){for(var t=0;t<v.length;t++)if(v[t].keyHandle===e){v=v.splice(t,1);return}},v.lookup=function(e){for(var t=0;t<v.length;t++)if(v[t].keyHandle===e)return v[t].keyData;return null};var m=function(){function f(){l(!u);for(var e=0;e<s.length;e++)if(!s[e].busy)return s[e];return null}function l(e){for(var t=s.length-1;t>=0;t-=1)s[t].isWebWorker===e&&(s[t].terminate(),s.splice(t,1))}function c(){var e=0;for(var t=0;t<s.length;t++)s[t].busy||(e+=1);return e}function h(e){s.push(e)}function p(e){for(var t=0;t<s.length;t++)if(s[t]===e){e.terminate(),s.splice(t,1);return}}function d(e){for(var t=0;t<s.length;t++)if(s[t].operation===e)return s[t];return null}function v(e,t){o.push({operation:e,data:t,id:a++})}function m(e){e.busy=!1,e.operation=null;if(u)if(o.length>0){var t=o.shift();w(t.operation,t.data)}else c()>i&&p(e)}function g(e){var r;if(u)try{r=new Worker(t),r.postMessage({prngSeed:S.getBytes(48)}),r.isWebWorker=!0}catch(i){u=!1,N.forceSync=!0,r=n(),r.isWebWorker=!1}else r=n(),r.isWebWorker=!1;return r.operation=e,r.busy=!1,r.onmessage=function(e){var t=r.operation;for(var n=0;n<o.length;n++)if(o[n].operation===r.operation){var i=o[n];o.splice(n,1),E(r,i.data);return}t&&e.data.type!=="process"&&(m(r),t.dispatchEvent(e))},r.onerror=function(e){var t=r.operation;m(r),t.dispatchEvent(e)},h(r),r}function y(e){var t=d(e);t&&p(t)}function b(t,n){var i=null;u=r&&!N.forceSync,i=f();if(u&&i===null&&s.length>=e){v(t,n);return}i===null&&(i=g(t));if(i===null)throw v(t,n),new Error("could not create new worker");i.operation=t,i.busy=!0,E(i,n)}function w(e,t){var n=d(e);if(n){E(n,t);return}b(e,t)}function E(e,t){u?(e.data=t,e.postMessage(t)):setTimeout(function(){e.postMessage(t)},0)}var e=15,i=4,s=[],o=[],a=0;return{runJob:b,continueJob:w,abortJob:y}}(),g=l,b=[{name:"algorithm",type:"Object",required:!0},{name:"keyHandle",type:"Object",required:!0},{name:"buffer",type:"Array",required:!1},{name:"signature",type:"Array",required:!0},{name:"format",type:"String",required:!0},{name:"keyData",type:"Array",required:!0},{name:"extractable",type:"Boolean",required:!1},{name:"keyUsages",type:"Array",required:!1},{name:"derivedKeyType",type:"Object",required:!0},{name:"length",type:"Number",required:!1}],w={encrypt:[0,1,2],decrypt:[0,1,2],sign:[0,1,2],verify:[0,1,3,2],digest:[0,2],generateKey:[0,6,7],importKey:[4,5,0,6,7],exportKey:[0,4,1,6,7],deriveKey:[0,1,8,6,7],deriveBits:[0,1,9],wrapKey:[1,1,0],unwrapKey:[2,0,1,6,7]},N={encrypt:function(e,t,n){return T("encrypt",arguments,0)},decrypt:function(e,t,n){return T("decrypt",arguments,0)},sign:function(e,t,n){return T("sign",arguments,0)},verify:function(e,t,n,r){return T("verify",arguments,0)},digest:function(e,t){return T("digest",arguments,0)},generateKey:function(e,t,n){return T("generateKey",arguments,1)},deriveKey:function(e,t,n,r,i){return T("deriveKey",arguments,1)},deriveBits:function(e,t,n){return T("deriveBits",arguments,0)},importKey:function(e,t,n,r,i){return T("importKey",arguments,1)},exportKey:function(e,t){return T("exportKey",[t.algorithm,e,t],1)},wrapKey:function(e,t,n){return T("wrapKey",arguments,0)},unwrapKey:function(e,t,n,r,i){return T("unwrapKey",arguments,1)}};return N}());var N={subtle:T,getRandomValues:function(e){var t,n=S.getBytes(e.length);for(t=0;t<e.length;t+=1)e[t]=n[t];return e},initPrng:function(e){var t=Object.prototype.toString.call(e);if(t!=="[object Array]"&&t!=="[object Uint8Array]")throw new Error("entropyData must be a Array or Uint8Array");C&&C.reseed(e),S.reseed(C.read(48)),n=!0},toBase64:function(e,t){return l.toBase64(e,!1)},base64ToString:function(e){return l.base64ToString(e)},utilities:l,sha256:v.sha256,sha512:m.sha512,url:t};typeof cryptoMath!="undefined"&&(N.cryptoMath=cryptoMath),typeof testInterface!="undefined"&&(N.testInterface=testInterface);var C;if(!i){C=C||new x,C.init();var k=C.read(48);S.init(k)}return N}();return t}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("msr-crypto/lib/StringBuilder",["require","exports"],e)}(function(){return function(){function t(e){return this._parts.push(e),this}function n(e){return this._parts.push(typeof e=="undefined"||e===null||e===""?"\r\n":e+"\r\n"),this}function r(){if(arguments.length!==0)throw new Error("InvalidParameterCount");this._parts=[],this._value={},this._len=0}function i(){if(arguments.length!==0)throw new Error("InvalidParameterCount");return this._parts.length===0?!0:this.toString()===""}function s(e){e=e||"";var t=this._parts;this._len!==t.length&&(this._value={},this._len=t.length);var n=this._value;if(typeof n[e]=="undefined"){if(e!=="")for(var r=0;r<t.length;)typeof t[r]=="undefined"||t[r]===""||t[r]===null?t.splice(r,1):r++;n[e]=this._parts.join(e)}return n[e]}var e={};return e.StringBuilder=function(n){this._parts=e.isNullOrEmpty(n)?[]:[n.toString()],this._value={},this._len=0},e.StringBuilder.prototype={append:t,appendLine:n,clear:r,isEmpty:i,toString:s},e.isNullOrEmpty=function(t){return!t||!t.length},e}()}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("msr-crypto/lib/BigInt",["require","exports","./StringBuilder"],e)}(function(e){var t=e("./StringBuilder");return function(){var e="0123456789abcdef",n=16,r=3,i=function(t,n){this._elements=[],this._radix=t,this._elements.splice(0,0,n),this._length=1,this._normalize()};return i.hexRadix=16,i.decRadix=1e3,i._createDec=function(t){return new i(i.decRadix,t)},i._createHex=function(t){return new i(i.hexRadix,t)},i._computeHexNegative=function(t,r){var s,o=[];for(s=0;s<r;s++)o.splice(s,0,t[s]);for(s=0;s<o.length;s++)o[s]>0&&(o[s]=i.hexRadix-o[s],s+1<o.length?o[s+1]=o[s+1]+1:o.length<n&&o.splice(s+1,0,1));return o},i.parseDecInt=function(t,n){switch(t){case i.decRadix:return i._parseDecIntToDecRadixBigInt(n);case i.hexRadix:return i._parseDecIntToHexRadixBigInt(n);default:return null}},i._parseDecIntToHexRadixBigInt=function(n){if(t.isNullOrEmpty(n))return null;var r=n.charAt(0)==="-";r&&(n=n.substr(1));var s=9,o=i._createHex(1e9),u=i._createHex(0),a=Math.ceil(n.length/s),f=i._createHex(1),l=n.length;for(var c=0;c<a;c++){var h=l-s<0?0:l-s,p=parseInt(n.substr(h,l-h),10),d=i._createHex(p);d.multiply(f),u.add(d),f.multiply(o),l-=s}return u._isNegative=r,u},i._parseDecIntToDecRadixBigInt=function(t){if(t.length===0)return i._createDec(0);var n=!1,s=[];t.charAt(0)==="-"&&(n=!0,t=t.substr(1,t.length-1));var o;for(o=0;r*(o+1)<=t.length;o++)s.splice(o,0,parseInt(t.substring(t.length-r*(o+1),t.length-r*o),10));0!==t.length%r&&s.splice(o++,0,parseInt(t.substring(0,t.length%r),10));var u=i._createDec(0);return u._elements=s,u._length=o,u._isNegative=n,u},i._getHexValues=function(t){var n=new Array(t.length);for(var r=0;r<t.length;r++){n[r]=i._hexCharValue(t.charAt(r));if(n[r]<0)return null}return n},i._hexCharValue=function(t){if(t>="0"&&t<="9")return t-"0";switch(t){case"a":return 10;case"b":return 11;case"c":return 12;case"d":return 13;case"e":return 14;case"f":return 15;default:return-1}},i._toNegativeValues=function(t){for(var n=t.length-1;n>=0;n--)t[n]>0&&(t[n]=16-t[n],n>0&&(t[n-1]+=1));return t},i.prototype={_isNegative:!1,_length:0,_radix:0,_normalize:function(){var t;for(t=this._length-1;t>=0;t--){if(this._elements[t]!==0)break;this._length--}for(var n=0;n<2;n++)if(this._length===0)this._isNegative=!1;else{if(this._elements[this._length-1]<0){for(t=0;t<this._length;t++)this._elements[t]=-this._elements[t];this._isNegative=!this._isNegative}for(t=0;t<this._length-1;t++){var r;this._elements[t]<0&&(r=Math.ceil(-this._elements[t]/this._radix),this._elements[t]=this._elements[t]+this._radix*r,this._elements[t+1]=this._elements[t+1]-r),this._elements[t]>=this._radix&&(r=Math.floor(this._elements[t]/this._radix),this._elements[t]=this._elements[t]%this._radix,this._elements[t+1]=this._elements[t+1]+r)}while(this._elements[this._length-1]>=this._radix)this._ensureCapacity(),this._elements[this._length]=Math.floor(this._elements[this._length-1]/this._radix),this._elements[this._length-1]=this._elements[this._length-1]%this._radix,this._length++;if(!(this._elements[this._length-1]<0))break;for(t=0;t<this._length;t++)this._elements[t]=-this._elements[t];this._isNegative=!this._isNegative}},_ensureCapacity:function(){this._length===this._elements.length&&this._elements.push(0)},add:function(t){var n;for(n=0;n<this._length-t._length;n++)t._elements.splice(t._length+n,0,0);for(n=0;n<t._length-this._length;n++)this._elements.splice(this._length+n,0,0);this._length=Math.max(t._length,this._length);if(this._isNegative===t._isNegative)for(n=0;n<this._length;n++)this._elements[n]=this._elements[n]+t._elements[n];else for(n=0;n<this._length;n++)this._elements[n]=this._elements[n]-t._elements[n];this._normalize()},multiply:function(t){var n,r=new i(this._radix,0);for(n=0;n<t._length+this._length;n++)n<r._elements.length?r._elements[n]=0:r._elements.splice(n,0,0);for(n=0;n<t._length;n++){for(var s=0;s<this._length;s++)r._elements[n+s]=r._elements[n+s]+t._elements[n]*this._elements[s],r._elements[n+s]!==0&&(r._length=Math.max(r._length,n+s+1));r._normalize()}r._isNegative=t._isNegative!==this._isNegative,this._elements=r._elements,this._isNegative=r._isNegative,this._length=r._length},modulus:function(t){for(;;){if(t._length===0||this._length===0)break;var n=this._length-t._length;if(n<0)break;var r=this._elements[this._length-1],i=t._elements[t._length-1];if(r>=i){var s=Math.floor(r/i);for(var o=0;o<t._length;o++)this._elements[o+n]=this._elements[o+n]-s*t._elements[o];this._normalize();continue}if(n===0)break;this._elements[this._length-2]=this._elements[this._length-2]+this._radix*this._elements[this._length-1],this._length--}this._isNegative&&(t._isNegative?(t._isNegative=!1,this.add(t),t._isNegative=!0):this.add(t)),this._normalize()},toString:function(){switch(this._radix){case i.hexRadix:return this._toHexString();case i.decRadix:return this._toDecString();default:return""}},_toHexString:function(){if(this._elements.length===0)return"0";var r=this._elements;this._isNegative&&(r=i._computeHexNegative(r,this._length));var s=new t.StringBuilder,o=!1;for(var u=r.length-1;u>=0;u--)o||r[u]!==0&&(o=!0),o&&s.append(e.charAt(r[u]));return s.toString()},_toDecString:function(){if(this._length===0)return"0";var t="";for(var n=0;n<this._length;n++){t=this._elements[n]+t;if(n<this._length-1)for(var r=10;r<this._radix;r*=10)this._elements[n]<r&&(t=0+t)}return this._isNegative&&(t="-"+t),t}},i}()}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("msr-crypto/lib/ConvertHelper",["require","exports"],e)}(function(){return function(){var e={tryParseInt:function(t){var n=parseInt(t,10);return isNaN(n)?-1:n},parseHexInt:function(t){var n=parseInt(t,16);return isNaN(n)?0:n}};return e}()}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("msr-crypto/lib/sha256Auth",["require","exports","./msrcrypto.aes","./StringBuilder","./BigInt","./ConvertHelper"],e)}(function(e){var t=e("./msrcrypto.aes"),n=e("./StringBuilder"),r=e("./BigInt"),i=e("./ConvertHelper");return function(e){function o(e){var n=t.utilities.stringToBytes(e),r=t.sha256.computeHash(n);return t.utilities.bytesToHexString(r)}function u(e,t){var r=e.toString(2),i=t.toString(2),s=new n.StringBuilder,o=new n.StringBuilder,u=Math.abs(r.length-i.length),a;for(a=0;a<u;a++)o.append("0");r.length<i.length?(o.append(r),r=o.toString()):i.length<r.length&&(o.append(i),i=o.toString());for(a=0;a<r.length;a++)s.append(r.charAt(a)===i.charAt(a)?"0":"1");return parseInt(s.toString(),2)}function a(e,t,n){return e.length<t?(n=n||" ",e+f(n,t-e.length)):e.valueOf()}function f(e,t){var n=e;for(var r=1;r<t;r++)n+=e;return n}var s=e.MSP||{};return s._sha256Auth=function(){},s._sha256Auth.prototype={_int32ToHexString:function(t){var r="0123456789abcdef",i=new n.StringBuilder;for(var s=0;s<=3;s++)i.append(r.charAt(t>>s*8+4&15)),i.append(r.charAt(t>>s*8&15));return i.toString()},getMacHash:function(t,n,r){var s=t+n,f=s,l=8-f.length%8;l!==8&&(f=a(f,f.length+l,"0"));var c=f.length/4,h=[],p,d;for(p=0,d=0;p<c;p++)h.splice(p,0,0),h[p]=h[p]+f.charCodeAt(d++)*1,h[p]=h[p]+f.charCodeAt(d++)*256,h[p]=h[p]+f.charCodeAt(d++)*65536,h[p]=h[p]+f.charCodeAt(d++)*16777216;var v=new Array(4),m=o(t+r);for(p=0,d=0;p<v.length;p++)v[p]=0,v[p]+=i.parseHexInt(m.substr(d,2))*1,d+=2,v[p]+=i.parseHexInt(m.substr(d,2))*256,d+=2,v[p]+=i.parseHexInt(m.substr(d,2))*65536,d+=2,v[p]+=i.parseHexInt(m.substr(d,2))*16777216,d+=2;var g=new Array(2);this._cS64_C(h,v,g);var y=u(v[0],g[0]),b=u(v[1],g[1]),w=u(v[2],g[0]),E=u(v[3],g[1]);return this._int32ToHexString(y)+this._int32ToHexString(b)+this._int32ToHexString(w)+this._int32ToHexString(E)},_cS64_C:function(t,n,i){var s=2147483647;if(t.length<2||(t.length&1)===1)return!1;var o=n[0]&s,u=n[1]&s,a=n[2]&s,f=n[3]&s,l=242854337,c=r.parseDecInt(r.decRadix,o.toString()),h=r.parseDecInt(r.decRadix,u.toString()),p=r.parseDecInt(r.decRadix,a.toString()),d=r.parseDecInt(r.decRadix,f.toString()),v=r.parseDecInt(r.decRadix,l.toString()),m=0,g=r.parseDecInt(r.decRadix,s.toString()),y=r.parseDecInt(r.decRadix,"0"),b=r.parseDecInt(r.decRadix,"0"),w=r.parseDecInt(r.decRadix,"0");for(var E=0;E<t.length/2;E++)y=r.parseDecInt(r.decRadix,t[m++].toString()),y.multiply(v),y.modulus(g),b.add(y),b.multiply(c),b.add(h),b.modulus(g),w.add(b),b.add(r.parseDecInt(r.decRadix,t[m++].toString())),b.multiply(p),b.add(d),b.modulus(g),w.add(b);return b.add(h),b.modulus(g),w.add(d),w.modulus(g),i[0]=parseInt(b.toString(),10),i[1]=parseInt(w.toString(),10),!0}},s._sha256Auth}(window)}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("msr-crypto/lib/index",["require","exports","./msrcrypto.aes","./sha256Auth"],e)}(function(e,t){t.aes=e("./msrcrypto.aes"),t.sha256Auth=e("./sha256Auth")}),define("msr-crypto",["msr-crypto/lib/index"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-chat-service/lib/builders/requestOptionsBuilder",["require","exports","jcafe-property-model","jskype-settings-instance"],e)}(function(e,t){var n=e("jcafe-property-model"),r=e("jskype-settings-instance"),i=function(){function e(e,t){this.headerSelector=e,this.transientFaultPolicy=t}return e.prototype.build=function(e,t){var i=this,s=n.task(),o=r.settings.webApiService,u=o.overrides&&o.overrides[e],a=o.retry.limit,f=o.retry.delay,l=o.retry.strategy,c=function(n){var r={headers:n,retry:{limit:a,delay:f,strategy:l,isTransientCheck:i.transientFaultPolicy.isTransientFailure,isSuccessCheck:i.transientFaultPolicy.isWebApiSuccess},reporting:{serviceName:"webapi-"+e}};t&&t.payload&&(r.payload=JSON.stringify(t.payload)),t&&t.params&&(r.params=t.params),s.resolve(r)};return this.headerSelector.fetch(e).then(c,s.reject.bind(s)),u&&(f=u.delay||f,a=u.limit||a,l=u.strategy||l),s.promise},e}();t.__esModule=!0,t["default"]=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-chat-service/lib/builders/headerSelector",["require","exports","lodash-compat","swx-utils-common","jskype-constants","swx-client-info","jcafe-property-model","../constants"],e)}(function(e,t){var n=e("lodash-compat"),r=e("swx-utils-common"),i=e("jskype-constants"),s=e("swx-client-info"),o=e("jcafe-property-model"),u=e("../constants"),a="registrationToken",f=a+"Expiration",l=i.DATA.storageKeys,c=function(){function e(e,t){var n=this;this.hasValidRegToken=o.boolProperty(!1),this.clearRegistrationToken=function(){r.sessionStorage.remove(a),r.sessionStorage.remove(f),n.hasValidRegToken(!1)},this.skypeTokenProvider=e,this.mePerson=t}return e.prototype.setLockAndKey=function(e){this.lockAndKey=e},e.prototype.setRegistrationToken=function(e){var t=/registrationToken=(.+); expires=(\d+)/,n=t.test(e)&&e.match(t),i=n&&(new Date(parseInt(n[2],10)*1e3)).getTime();i&&i>0&&(r.sessionStorage.set(a,a+"="+n[1]),r.sessionStorage.set(f,i),r.sessionStorage.set(l.SKYPE_ID_REG_TOKEN,this.getMePersonId()),this.hasValidRegToken(!0))},e.prototype.fetch=function(e){var t=this,n=this.fetchDefaultHeaders(),i=o.task();this.updateRegistrationTokenValidity();var s=function(){n.RegistrationToken=r.sessionStorage.get(a),i.resolve(n)},f=function(e){n.LockAndKey=t.lockAndKey,n.Authentication="skypetoken="+e,i.resolve(n)},l=function(){switch(e){case u.SERVICE_CALLS.REQUEST_ENDPOINT_CREATION:case u.SERVICE_CALLS.REQUEST_SUBSCRIPTION_CREATION:case u.SERVICE_CALLS.REQUEST_POLLING:case u.SERVICE_CALLS.REQUEST_ENDPOINT_DELETION:t.skypeTokenProvider().then(f,i.reject.bind(i));break;default:t.hasValidRegToken.once(!0,s)}};return this.hasValidRegToken()?s():this.lockAndKey?l():i.reject(new Error("no valid authorization token present")),i.promise},e.prototype.updateRegistrationTokenValidity=function(){var e=r.sessionStorage.get(f)||0,t=e<n.now(),i=r.sessionStorage.get(l.SKYPE_ID_REG_TOKEN)!==this.getMePersonId(),s=r.sessionStorage.get(a)!==null;if(t||i)this.clearRegistrationToken(),s=!1;i&&this.clearEndpointData(),this.hasValidRegToken(s)},e.prototype.getMePersonId=function(){return this.mePerson.id()},e.prototype.clearEndpointData=function(){r.sessionStorage.remove(l.ENDPOINT_ID),r.sessionStorage.remove(l.PRESENCE_DATA)},e.prototype.fetchDefaultHeaders=function(){return{ClientInfo:s.getClientInfo(),"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0",ContextId:"tcid="+(new Date).getTime()+(Math.floor(Math.random()*9e4)+1e4),BehaviorOverride:"redirectAs404"}},e}();t.__esModule=!0,t["default"]=c}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-chat-service/lib/calls/service",["require","exports","lodash-compat","swx-enums","swx-constants","swx-client-info","jskype-settings-instance","../constants","../index"],e)}(function(e,t){var n=e("lodash-compat"),r=e("swx-enums"),i=e("swx-constants"),s=e("swx-client-info"),o=e("jskype-settings-instance"),u=e("../constants"),a=e("../index"),f=function(){function e(e,t,n,r,s){this.requestURIBuilder=e,this.requestOptionsBuilder=t,this.xhrDispatcher=n,this.mePerson=r,this.browserDetect=s,this.isGdprEnabled=o.isFeatureOn(i.COMMON.featureFlags.GDPR_WEB_API)}return e.prototype.updateServiceDomain=function(e){this.xhrDispatcher.uriBuilder.setDomain(e)},e.prototype.setConversationOption=function(e,t,n){var r="/conversations/"+e+"/properties",i=this.requestURIBuilder.customResource(r);return this.setOption(u.SERVICE_CALLS.SET_CONVERSATION_OPTION,i,t,n)},e.prototype.setThreadOption=function(e,t,n){var r="v1/threads/"+e+"/properties";return this.setOption(u.SERVICE_CALLS.SET_THREAD_OPTION,r,t,n)},e.prototype.ping=function(){var e=this.requestURIBuilder.ping();return this.xhrDispatcher.get(e,{})},e.prototype.pinToDogfood=function(){var e=this,t={params:{name:"dogfoodUser"},payload:{dogfoodUser:!0}};return this.requestOptionsBuilder.build(u.SERVICE_CALLS.PIN_TO_DOGFOOD,t).then(function(t){return e.xhrDispatcher.put("v1/users/ME/properties",t)})},e.prototype.createConversation=function(e){var t=this,n={payload:{members:e}};return this.requestOptionsBuilder.build(u.SERVICE_CALLS.CREATE_CONVERSATION,n).then(function(e){return t.xhrDispatcher.post("v1/threads",e)})},e.prototype.postMessage=function(e,t,n){var r=this,i=this.requestURIBuilder.messages(e),s={payload:t},o=!!t.skypeeditedid&&n,a=o&&!t.content;return this.requestOptionsBuilder.build(u.SERVICE_CALLS.POST_MESSAGE,s).then(function(e){return r.isGdprEnabled&&a?(e.payload="",r.xhrDispatcher.remove(i+"/"+n,e)):r.isGdprEnabled&&o?r.xhrDispatcher.put(i+"/"+n,e):r.xhrDispatcher.post(i,e)},function(e){})},e.prototype.addParticipant=function(e,t,n){var i=this,s=this.requestURIBuilder.member(e,t),o={payload:{role:n===r.participantRole.Leader?"Admin":"User"}};return this.requestOptionsBuilder.build(u.SERVICE_CALLS.ADD_PARTICIPANT,o).then(function(e){return i.xhrDispatcher.put(s,e)})},e.prototype.removeParticipant=function(e,t){var n=this,r=this.requestURIBuilder.member(e,t);return this.requestOptionsBuilder.build(u.SERVICE_CALLS.REMOVE_PARTICIPANT).then(function(e){return n.xhrDispatcher.remove(r,e)})},e.prototype.setConsumptionHorizon=function(e,t){var n="/conversations/"+e+"/properties",s=this.requestURIBuilder.customResource(n),a={};return o.isFeatureOn(i.COMMON.featureFlags.READ_RECEIPT_ENABLED)&&this.mePerson.status()===r.onlineStatus.Online&&(a.readReceipt=!0),this.setOption(u.SERVICE_CALLS.SET_CONSUMPTION_HORIZON,s,"consumptionhorizon",t,a)},e.prototype.setIsFavorite=function(e,t){var n="/conversations/"+e+"/properties",r=this.requestURIBuilder.customResource(n),s={};return o.isFeatureOn(i.COMMON.featureFlags.FAVORITES_CONVERSATION_ENABLED)?this.setOption(u.SERVICE_CALLS.SET_IS_FAVORITE,r,"favorite",t.toString().toLowerCase(),s):undefined},e.prototype.fetchMessages=function(e,t,n){var r=this,s=this.requestURIBuilder.messages(e),a={params:{startTime:t,pageSize:n,view:"msnp24Equivalent"+(o.isFeatureOn(i.COMMON.featureFlags.SUPPORT_MESSAGE_PROPERTIES)?"|supportsMessageProperties":""),targetType:"Passport|Skype|Lync|Thread"+(o.isFeatureOn(i.COMMON.featureFlags.PSTN_ENABLED)?"|PSTN":"")+(o.isFeatureOn(i.COMMON.featureFlags.AGENTS_ENABLED)?"|Agent":"")}};return this.requestOptionsBuilder.build(u.SERVICE_CALLS.FETCH_MESSAGES,a).then(function(e){return r.xhrDispatcher.get(s,e)})},e.prototype.fetchMessagesLoadMore=function(e,t){var n=this,r=this.requestURIBuilder.messages(e),s={params:{syncState:a.utils.conversationMetadataStore.get(e),startTime:0,pageSize:t,view:"msnp24Equivalent"+(o.isFeatureOn(i.COMMON.featureFlags.SUPPORT_MESSAGE_PROPERTIES)?"|supportsMessageProperties":"")}};return this.requestOptionsBuilder.build(u.SERVICE_CALLS.FETCH_MESSAGES_LOAD_MORE,s).then(function(e){return n.xhrDispatcher.get(r,e)})},e.prototype.fetchThread=function(e){var t=this,n=this.requestURIBuilder.thread(e),r={params:{view:"msnp24Equivalent"}};return this.requestOptionsBuilder.build(u.SERVICE_CALLS.FETCH_THREAD,r).then(function(e){return t.xhrDispatcher.get(n,e)})},e.prototype.fetchConversation=function(e){var t=this,n=this.requestURIBuilder.conversations(e),r={params:{view:"msnp24Equivalent"}};return this.requestOptionsBuilder.build(u.SERVICE_CALLS.FETCH_CONVERSATION,r).then(function(e){return t.xhrDispatcher.get(n,e)})},e.prototype.fetchConversations=function(e,t){var n=this,r=this.requestURIBuilder.conversations(),s={params:{startTime:e,pageSize:t,view:"msnp24Equivalent",targetType:"Passport|Skype|Lync|Thread"+(o.isFeatureOn(i.COMMON.featureFlags.PSTN_ENABLED)?"|PSTN":"")+(o.isFeatureOn(i.COMMON.featureFlags.AGENTS_ENABLED)?"|Agent":"")}};return this.requestOptionsBuilder.build(u.SERVICE_CALLS.FETCH_CONVERSATIONS,s).then(function(e){return n.xhrDispatcher.get(r,e)})},e.prototype.fetchConversationsBySyncState=function(e,t){var n=this,r=this.requestURIBuilder.conversations(),i={params:{syncState:e,pageSize:t,view:"msnp24Equivalent"}};return this.requestOptionsBuilder.build(u.SERVICE_CALLS.FETCH_CONVERSATIONS_BY_SYNC_STATE,i).then(function(e){return n.xhrDispatcher.get(r,e)})},e.prototype.requestEndpointCreation=function(e,t){var n=this,r="/endpoints"+(e?"/"+e:""),i=this.requestURIBuilder.customResource(r),s={payload:t||{}};return this.requestOptionsBuilder.build(u.SERVICE_CALLS.REQUEST_ENDPOINT_CREATION,s).then(function(t){return e?n.xhrDispatcher.put(i,t):n.xhrDispatcher.post(i,t)})},e.prototype.requestEndpointRemoval=function(e){var t=this;if(!e)return Promise.reject(new Error("invalid endpointID"));var n="/endpoints/"+e,r=this.requestURIBuilder.customResource(n),i={payload:{}};return this.requestOptionsBuilder.build(u.SERVICE_CALLS.REQUEST_ENDPOINT_DELETION,i).then(function(e){return t.xhrDispatcher.remove(r,e)})},e.prototype.requestSubscriptionCreation=function(e){var t=this,n=this.requestURIBuilder.customResource("/endpoints/SELF/subscriptions"),r={payload:{channelType:"httpLongPoll",template:"raw",interestedResources:e}};return this.requestOptionsBuilder.build(u.SERVICE_CALLS.REQUEST_SUBSCRIPTION_CREATION,r).then(function(e){return t.xhrDispatcher.post(n,e)})},e.prototype.requestPolling=function(e){var t=this,n=this.requestURIBuilder.customResource("/poll",e);return this.requestOptionsBuilder.build(u.SERVICE_CALLS.REQUEST_POLLING).then(function(e){var r=t.xhrDispatcher.post(n,e);return t.currentPoll=r,r})},e.prototype.abortCurrentPoll=function(){this.currentPoll&&this.currentPoll.abort()},e.prototype.setEndpointPresence=function(){var e=this,t=this.requestURIBuilder.constructPresenceEndpointURI("/presenceDocs/messagingService"),n=this.browserDetect.getSystemInfo(),r={id:"messagingService",type:"EndpointPresenceDoc",selfLink:"uri",privateInfo:{epname:"skype"},publicInfo:{capabilities:"video|audio",type:n.deviceType,skypeNameVersion:s.getBIAppName(),nodeInfo:"",version:s.getBIVersion()}};return this.requestOptionsBuilder.build(u.SERVICE_CALLS.SET_ENDPOINT_PRESENCE,{payload:r}).then(function(n){return e.xhrDispatcher.put(t,n)})},e.prototype.getEndpointsPresence=function(){var e=this,t=this.requestURIBuilder.customResource("/presenceDocs/messagingService?view=expanded");return this.requestOptionsBuilder.build("getEndpointsPresence").then(function(n){return e.xhrDispatcher.get(t,n)})},e.prototype.getActiveEndpoints=function(){var e=this,t=this.requestURIBuilder.customResource("/endpoints");return this.requestOptionsBuilder.build("getActiveEndpoints").then(function(n){return e.xhrDispatcher.get(t,n)})},e.prototype.setEndpointProperty=function(e,t){var n=this,r=this.requestURIBuilder.customResource("/endpoints/SELF/properties"),i={params:{name:e},payload:{}};return i.payload[e]=t,this.requestOptionsBuilder.build(u.SERVICE_CALLS.SET_ENDPOINT_PROPERTY,i).then(function(e){return n.xhrDispatcher.put(r,e)})},e.prototype.activateEndpoint=function(){var e=this,t=this.requestURIBuilder.constructPresenceEndpointURI("/active"),n={payload:{timeout:u.ACTIVATE_ENDPOINT_TIMEOUT/1e3}};return this.requestOptionsBuilder.build(u.SERVICE_CALLS.ACTIVATE_ENDPOINT,n).then(function(n){return e.xhrDispatcher.post(t,n)})},e.prototype.setUserPresence=function(e){var t=this,r=this.requestURIBuilder.customResource("/presenceDocs/messagingService"),i={payload:{status:n.capitalize(e.toString())}};return this.requestOptionsBuilder.build(u.SERVICE_CALLS.SET_USER_PRESENCE,i).then(function(e){return t.xhrDispatcher.put(r,e)})},e.prototype.getUserPresence=function(e){var t=this,n="/presenceDocs/messagingService",r=this.requestURIBuilder.contacts(e,n);return this.requestOptionsBuilder.build(u.SERVICE_CALLS.GET_USER_PRESENCE).then(function(e){return t.xhrDispatcher.get(r,e)})},e.prototype.sendContactsList=function(e){var t=this,n=this.requestURIBuilder.contacts(),r={payload:{contacts:e.map(function(e){return{id:e}})}};return this.requestOptionsBuilder.build(u.SERVICE_CALLS.SEND_CONTACT_LIST,r).then(function(e){return t.xhrDispatcher.post(n,e)})},e.prototype.addContactToContactsList=function(e){var t=this,n=this.requestURIBuilder.contacts(e);return this.requestOptionsBuilder.build(u.SERVICE_CALLS.ADD_CONTACT_TO_CONTACTS_LIST).then(function(e){return t.xhrDispatcher.put(n,e)})},e.prototype.removeContactFromContactsList=function(e){var t=this,n=this.requestURIBuilder.contacts(e);return this.requestOptionsBuilder.build(u.SERVICE_CALLS.REMOVE_CONTACT_FROM_CONTACTS_LIST).then(function(e){return t.xhrDispatcher.remove(n,e)})},e.prototype.getSelfProperties=function(){var e=this,t=this.requestURIBuilder.customResource("/properties");return this.requestOptionsBuilder.build(u.SERVICE_CALLS.GET_SELF_PROPERTIES).then(function(n){return e.xhrDispatcher.get(t,n)})},e.prototype.setMessageProperty=function(e,t,n,r){var i=this,s=this.requestURIBuilder.messageProperties(e,t),o={params:{name:n},payload:{}};return o.payload[n]=JSON.stringify(r),this.requestOptionsBuilder.build(u.SERVICE_CALLS.SET_MESSAGE_PROPERTY,o).then(function(e){return i.xhrDispatcher.put(s,e)})},e.prototype.removeMessageProperty=function(e,t,n,r){var i=this,s=this.requestURIBuilder.messageProperties(e,t),o=u.MESSAGE_PROPERTIES.PER_USER,a={params:{name:n}},f=function(e){return o.hasOwnProperty(e)&&o[e]===n};for(var l in o)if(f(l)){a.payload={},a.payload[n]=JSON.stringify({key:r});break}return this.requestOptionsBuilder.build(u.SERVICE_CALLS.REMOVE_MESSAGE_PROPERTY,a).then(function(e){return i.xhrDispatcher.remove(s,e)})},e.prototype.removeAllMessages=function(e){var t=this,n=this.requestURIBuilder.messages(e);return this.requestOptionsBuilder.build(u.SERVICE_CALLS.REMOVE_ALL_MESSAGES).then(function(e){return t.xhrDispatcher.remove(n,e)})},e.prototype.setOption=function(e,t,r,i,s){var o=this,u={params:{},payload:{}};return u.params.name=r,typeof i!="undefined"&&i!==null&&(r==="historydisclosed"||r==="joiningenabled"?u.payload[r]=i.toString().toLowerCase():u.payload[r]=i.toString()),n.forOwn(s,function(e,t){u.params[t]=e}),this.requestOptionsBuilder.build(e,u).then(function(e){return o.xhrDispatcher.put(t,e)})},e}();t.__esModule=!0,t["default"]=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-chat-service/lib/builders/requestURIBuilder",["require","exports","swx-utils-common"],e)}(function(e,t){function p(e){return s+e}function d(e,t){return t.replace(i,"")+(e||"")}function v(){return"/"+n.sessionStorage.get("endpointId")}function m(){return r+o}function g(e){var t=a;return e&&(t+="/"+e),p(t)}function y(e,t){var n="/"+e+u,r="/"+t+"/properties",i=a+n+r;return p(i)}function b(e){var t="/"+e+u,n=a+t;return p(n)}function w(e){return r+f+"/"+e}function E(e,t){return this.thread(e)+l+"/"+t}function S(e,t){t===void 0&&(t="");var n=e?"/"+e:"";return p(c+n+t)}function x(e,t){var n;return t?n=d(e,t):n=p(e),n}function T(e){return s+h+v()+e}var n=e("swx-utils-common"),r="v1",i=/http(s)?:\/\/+[\w\-.]*/,s=r+"/users/ME",o="/ng/ping",u="/messages",a="/conversations",f="/threads",l="/members",c="/contacts",h="/endpoints";t.ping=m,t.conversations=g,t.messageProperties=y,t.messages=b,t.thread=w,t.member=E,t.contacts=S,t.customResource=x,t.constructPresenceEndpointURI=T}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-chat-service/lib/boundary/facade",["require","exports","lodash-compat","swx-constants","jskype-constants","jcafe-property-model","../builders/requestURIBuilder","../constants","../utils/exponentialTimeout","jskype-settings-instance","swx-browser-globals","swx-utils-common"],e)}(function(e,t){function b(e,t){var n=e.getAllResponseHeaders().toLowerCase();return n.indexOf(t)===-1?null:e.getResponseHeader(t)}function w(e){e||(e="");var t=e.match(/^(https?:.+?\.live\.com)/i);return t?t[1]:null}function E(e,t){var n=new RegExp("errorCode[\"']?:[\"']?"+t,"i");return n.test(e)}var n=e("lodash-compat"),r=e("swx-constants"),i=e("jskype-constants"),s=e("jcafe-property-model"),o=e("../builders/requestURIBuilder"),u=e("../constants"),a=e("../utils/exponentialTimeout"),f=e("jskype-settings-instance"),l=e("swx-browser-globals"),c=e("swx-utils-common"),h=i.DATA.storageKeys,p=r.COMMON.msnpErrors,d=r.COMMON.httpStatusCodes,v=r.COMMON.events.system,m=r.COMMON.onlineStates,g=r.COMMON.telemetry.performanceMarks,y=["/v1/users/ME/conversations/ALL/properties","/v1/users/ME/conversations/ALL/messages","/v1/users/ME/contacts/ALL","/v1/threads/ALL"],S=function(){function e(e,t,i,u,w,S,x,T,N,C,k,L,A,O,M){var D=this;this._internal={ANNOTATIONS_RETRY_COUNT:50,ANNOTATIONS_RETRY_TIMEOUT:200,POLLING_DURATION:5e3},this.canPoll=s.task(),this.pollingSequenceInitialized=!1,this.addContactToContactsList=this.ifEndpointExists(function(e){D.service.addContactToContactsList(e)["catch"](function(t){D.handleRedirection(t,D.addContactToContactsList.bind(D,e))})}),this.removeContactFromContactsList=this.ifEndpointExists(function(e){}),this.setMessageProperty=function(e,t,n,r,i,s){var o=0,u=function(o){D.handleRedirection(o,D.setMessageProperty.bind(D,e,t,n,r,i,s))||s(o)},a=function(){o++,o<D._internal.ANNOTATIONS_RETRY_COUNT&&(t._actualId?D.service.setMessageProperty(e,t._actualId,n,r).then(i,u):setTimeout(a,D._internal.ANNOTATIONS_RETRY_TIMEOUT))};a()},this.removeMessageProperty=function(e,t,n,r,i,s){var o=0,u=function(o){D.handleRedirection(o,D.removeMessageProperty.bind(D,e,t,n,r,i,s))||s(o)},a=function(){o++,o<D._internal.ANNOTATIONS_RETRY_COUNT&&(t._actualId?D.service.removeMessageProperty(e,t._actualId,n,r).then(i,u):setTimeout(a,D._internal.ANNOTATIONS_RETRY_TIMEOUT))};a()},this.removeAllMessages=function(e,t,n){var r=D.telemetry.context,i=function(e){r.statusCode=e.response.status,t&&t()},s=function(i){D.handleRedirection(i,D.removeAllMessages.bind(D,e,t,n))||n(i),r.statusCode=i.status};D.service.removeAllMessages(e).then(i,s)},this.setConversationOption=function(e,t,n,r,i){var s=function(s){D.handleRedirection(s,D.setConversationOption.bind(D,e,t,n,r,i))||i(s)};D.service.setConversationOption(e,t,n).then(r,s)},this.setThreadOption=function(e,t,n,r,i){var s=function(s){D.handleRedirection(s,D.setThreadOption.bind(D,e,t,n,r,i))||i(s)};D.service.setThreadOption(e,t,n).then(r,s)},this.pinUserToDogfoodCloud=function(){var e=D.buildDispatcher("pinToDogfood"),t=function(t){e.success(t),D.poll()},n=function(t){e.error(t),D.handleRedirection(t,D.pinUserToDogfoodCloud)};D.service.pinToDogfood().then(t,n)},this.ping=function(){var e=D.buildDispatcher("ping");D.internalPubSub.publish(v.ONLINE_STATE_CHANGED,m.OFFLINE),D.update403DebugData("O"),D.service.ping().then(function(t){D.update403DebugData("OOK"),D.internalPubSub.publish(v.ONLINE_STATE_CHANGED,m.ONLINE),e.success(t),D.poll(),D.QosReporter.get().reportSuccess("webapi-ping")},function(t){var n=c.sessionStorage.get("chat-4171")||"",i=n.match(/(\d+)x>O$/),s=1e3;if(f.isFeatureOn(r.COMMON.featureFlags.ENABLE_PING_ECS_CONFIG)){var o=f.settings.webApiService.pingDelayTime.min||30,u=f.settings.webApiService.pingDelayTime.max||60;s=D.pickRandomDelay(o*1e3,u*1e3)}i?(n=n.replace(/\d+x>O$/,""),D.update403DebugData(n+(+i[1]+1)+"x",!0)):D.update403DebugData("OERR1x"),e.error(t),setTimeout(D.ping,s)})},this.createConversation=function(e,t,n){var r=D.buildDispatcher("createConversation");D.usertiming.mark(g.NEW_CONVERSATION.CREATION_START);var i=function(e){D.usertiming.mark(g.NEW_CONVERSATION.CREATION_END_OK),r.success(e);var n=b(e.request,"location"),i=n.match(/threads\/(19:.*)$/)[1];t(i)},s=function(i){D.usertiming.mark(g.NEW_CONVERSATION.CREATION_END_ERROR),r.error(i),D.handleRedirection(i,D.createConversation.bind(D,e,t,n)),n(i)};D.service.createConversation(e).then(i,s)},this.getUserPresence=function(e){var t=D.buildDispatcher("getUserPresence");D.service.getUserPresence(e).then(t.success,function(n){t.error(n),D.handleRedirection(n,D.getUserPresence.bind(D,e))})},this.setEndpointPresence=function(){var e=D.buildDispatcher("setEndpointPresence");D.service.setEndpointPresence().then(e.success,function(t){e.error(t),D.handleRedirection(t,D.setEndpointPresence)})},this.getEndpointsPresence=function(){if(!D.endpointsTelemetry.available())return;D.service.getEndpointsPresence().then(function(e){if(!e||!e.response)return;e.response.endpointPresenceDocs&&D.endpointsDataProvider.set(e.response.endpointPresenceDocs),e.response.publicInfo&&D.endpointsDataProvider.set([{publicInfo:e.response.publicInfo}]),D.endpointsTelemetry.publish()})},this.getActiveEndpoints=function(){return D.service.getActiveEndpoints()},this.activateEndpoint=function(){D.isEndpointCreated.when(!0,function(){var e=D.buildDispatcher("activateEndpoint");D.service.activateEndpoint().then(e.success,e.error)})},this._getEndpointId=function(){return new Promise(function(e){var t=c.sessionStorage.get(h.ENDPOINT_ID);D.cache.get().getItem(h.ENDPOINT_ID).then(function(n){n===t?e(t):e()})})},this.poll=function(){if(D.validatingSkypeToken){a.reset();return}var e=D.buildDispatcher("endpointCreation"),t=D.buildDispatcher("getSelfProperties"),i=D.buildDispatcher("subscriptionCreation"),s=function(e){i.error(e);if(D.handleRedirection(e,D.poll)){D.update403DebugData("SERR404");return}D.update403DebugData("SERR");if(e.status===d.notFound&&E(e.response,p.missingEndpoint))return;a.execute(D.poll)},u=function(e){D.update403DebugData("SOK"),i.success(e),D.setEndpointPresence(),D.continuallyPoll(b(e.request,"location"))},l=function(e){var t=b(e,"set-registrationtoken");t&&(D.headerSelector.setRegistrationToken(t),D.storeEndpointId(t))},m=function(t){e.error(t);if(n.isObject(t)){l(t);if(D.handlePinToDogfoodRedirection(t)){D.update403DebugData("EERRdf");return}var i=t.status===d.unauthorized||t.status===d.forbidden;i&&D.pollFailedWithAuthErrorCount++;if(D.pollFailedWithAuthErrorCount===2&&D.signInManager.validateState.enabled()){a.reset(),D.validatingSkypeToken=!0,D.signInManager.validateState().then(function(){D.validatingSkypeToken=!1,D.poll()});return}if(D.pollFailedWithAuthErrorCount>2){D.signInManager.signOut.enabled.once(!0,function(){D.signInManager.signOut({reason:r.COMMON.api.auth.errorTypes.REAUTH_NEEDED})});return}if(D.handleRedirection(t,D.poll)){D.update403DebugData("EERR404");return}}D.update403DebugData("EERR"),a.execute(D.poll)},g=function(){var e=D.service.getSelfProperties();return e.then(t.success.bind(t),t.error.bind(t)),e},w=function(t){var n=t.response,i=t.request,p=r.COMMON.telemetry.timelineLoadOrigin,d=D.telemetry.context,m;D.pollFailedWithAuthErrorCount=0,l(i),D.update403DebugData("EOK"),a.reset(),e.success(t),m=c.sessionStorage.get(h.RESURECTION_KEY),m?(c.sessionStorage.remove(h.RESURECTION_KEY),d.timelineLoadOrigin=p.RESSURECT):D.isEndpointCreated()?d.timelineLoadOrigin=p.RELOAD:d.timelineLoadOrigin=p.LOAD;if(!f.settings.isPollingEnabled)return;f.isFeatureOn(r.COMMON.featureFlags.SUPPORT_MESSAGE_PROPERTIES)&&D.enableMessageProperties();if(n.subscriptions&&n.subscriptions.length>0){var b=o.customResource("/endpoints/SELF/subscriptions/")+n.subscriptions[0].id;g()["finally"](function(){D.continuallyPoll(b)})}else D.pollingSequenceInitialized&&D.internalPubSub.publish(v.FORCE_RESYNC),g()["finally"](function(){D.update403DebugData("S"),D.service.requestSubscriptionCreation(y).then(u,s)});D.pollingSequenceInitialized=!0,D.getEndpointsPresence()},S=function(){var e="Agent";return f.isFeatureOn(r.COMMON.featureFlags.READ_RECEIPT_ENABLED)&&(e+=",readReceipts"),{endpointFeatures:e}};D.update403DebugData("E"+!!c.sessionStorage.get(h.ENDPOINT_ID)),D._getEndpointId().then(function(e){D.service.requestEndpointCreation(e,S()).then(w,m)})},this.reset=function(){D.service.abortCurrentPoll();var e=function(){D.pollingSequenceInitialized=!1};return D.validatingSkypeToken=!1,D.pollFailedWithAuthErrorCount=0,D.service.requestEndpointRemoval(c.sessionStorage.get(h.ENDPOINT_ID)).then(e,e)},this.postMessage=function(e,t,n,r,i){var s=t.clientmessageid;D.usertiming.mark(g.IM_SEND.POST_START+s);var o=function(e){D.usertiming.mark(g.IM_SEND.POST_END_OK+s),n(e)},u=function(o){if(D.handleRedirection(o,D.postMessage.bind(D,e,t,n,r,i)))return;D.usertiming.mark(g.IM_SEND.POST_END_ERROR+s),r(o)};D.service.postMessage(e,t,i).then(o,u)},this.sendContactsList=function(e){D.service.sendContactsList(e)["catch"](function(t){D.handleRedirection(t,D.sendContactsList.bind(D,e))})},this.addParticipant=function(e,t,n,r,i){D.service.addParticipant(e,t,n).then(r,function(s){D.handleRedirection(s,D.addParticipant.bind(D,e,t,n,r,i))||typeof i=="function"&&i(s)})},this.removeParticipant=function(e,t,n,r){D.service.removeParticipant(e,t).then(n,function(i){D.handleRedirection(i,D.removeParticipant.bind(D,e,t,n,r))||r(i)})},this.setConsumptionHorizon=function(e,t,n){var r=D.buildDispatcher("setConsumptionHorizon"),i=function(e){n&&n(e),r.success(e)},s=function(n){r.error(n),D.handleRedirection(n,D.setConsumptionHorizon.bind(D,e,t))};D.service.setConsumptionHorizon(e,t).then(i,s)},this.setIsFavorite=function(e,t,n,r){var i=D.buildDispatcher("setIsFavorite"),s=function(e){i.success(e),n(e)},o=function(s){D.handleRedirection(s,D.setIsFavorite.bind(D,e,t,n,r))||(i.error(s),r(s))};D.service.setIsFavorite(e,t).then(s,o)},this.setUserPresence=function(e){var t=D.buildDispatcher("setUserPresence"),n=function(n){t.error(n),D.handleRedirection(n,D.setUserPresence.bind(D,e))};D.service.setUserPresence(e).then(t.success,n)},this.syncMessages=function(e,t,n,r,i){var s=D.buildDispatcher("syncMessages"),o=D.telemetry.context;o.chatHistoryLoadResult[e]=d.OK;var u=function(t){var n=D.handlers.buildMessageSuccess(e,r,D.syncStateRetriever);D.readyToPoll(),n(t)},a=function(u){o.chatHistoryLoadResult[e]=u.status;var a=D.handleRedirection(u,D.syncMessages.bind(D,e,t,n,r,i));a?o.isChatHistoryLoad404=!0:(s.error(u),i&&i())};D.service.fetchMessages(e,t,n).then(u,a)},this.syncMessagesLoadMore=function(e,t,n,r){var i=D.buildDispatcher("syncMessagesLoadMore"),s=function(t){var r=D.handlers.buildMessageSuccess(e,n,D.syncStateRetriever);r(t)},o=function(s){var o=D.handleRedirection(s,D.syncMessagesLoadMore.bind(D,e,t,n,r));o||(i.error(s),r(s))};D.service.fetchMessagesLoadMore(e,t).then(s,o)},this.syncRecents=function(e,t,n,r){var i=function(e){n(e),D.readyToPoll()},s=function(i){var s=D.handleRedirection(i,D.syncRecents.bind(D,e,t,n,r));s||r(i)};D.service.fetchConversations(e,t).then(i,s)},this.syncRecentsBySyncState=function(e,t,n,i){var s=function(e){n(e),f.isFeatureOn(r.COMMON.featureFlags.DISABLE_POLLING_ON_KAHUNA)||D.readyToPoll()},o=function(r){var s=D.handleRedirection(r,D.syncRecentsBySyncState.bind(D,e,t,n,i));s||i(r)};D.service.fetchConversationsBySyncState(e,t).then(s,o)},this.syncConversation=function(e,t,n){var r=function(e){t(e),D.readyToPoll()},i=function(r){var i=D.handleRedirection(r,D.syncConversation.bind(D,e,t,n));i||n(r)};D.service.fetchConversation(e).then(r,i)},this.syncThread=function(e,t,n){var r=D.buildDispatcher("syncThread");t=t||function(){return},n=n||function(){return};var i=function(e){r.success(e),t(),D.readyToPoll()},s=function(i){var s=D.handleRedirection(i,D.syncThread.bind(D,e,t,n));s||(r.error(i),n(i))};D.service.fetchThread(e).then(i,s)},this.standbyMode=u,this.telemetry=w,this.buildDispatcher=e,this.handlers=t,this.service=i,this.headerSelector=S,this.cache=x,this.usertiming=T,this.internalPubSub=N,this.QosReporter=C,this.endpointsTelemetry=k,this.endpointsDataProvider=L,this.analytics=A,this.syncStateRetriever=O,this.signInManager=M,this.validatingSkypeToken=!1,this.pollFailedWithAuthErrorCount=0,this.whenActivePromise=new Promise(function(e){D.standbyMode.once(!1,e)}),l.getWindow().Skype&&l.getWindow().Skype.isElectron&&l.getWindow().Skype.Shell&&(l.getWindow().Skype.Shell.clearChatServiceToken=this.headerSelector.clearRegistrationToken),this.isEndpointCreated=s.property({value:!!c.sessionStorage.get(h.ENDPOINT_ID)}),this.endpointsDataProvider.setup(this.getActiveEndpoints)}return e.prototype.ifEndpointExists=function(e){return function(){c.sessionStorage.get(h.ENDPOINT_ID)!==null&&e.apply(this,arguments)}},e.prototype.storeEndpointId=function(e){var t=new RegExp(h.ENDPOINT_ID+"=({.+})"),n=e&&e.match(t),r;n&&(r=n[1],c.sessionStorage.set(h.ENDPOINT_ID,r),this.cache.get().setItem(h.ENDPOINT_ID,r),this.isEndpointCreated(!0))},e.prototype.readyToPoll=function(){this.canPoll.promise.state()==="pending"&&this.canPoll.resolve()},e.prototype.update403DebugData=function(e,t){var n="chat-4171",r;t?c.sessionStorage.set(n,e):(r=c.sessionStorage.get(n),c.sessionStorage.set(n,r+">"+e))},e.prototype.handleRedirection=function(e,t){var n=e.status===d.notFound&&E(e.response,p.redirectionOverride),r=e.status===d.unauthorized,i=e.status===d.forbidden,s;return(r||i)&&this.headerSelector.clearRegistrationToken(),n?(s=w(b(e,"location")),s?(this.service.updateServiceDomain(s),t(),!0):!1):!1},e.prototype.handlePinToDogfoodRedirection=function(e){if(!f.isFeatureOn(r.COMMON.featureFlags.PINNING_TO_DOGFOOD_CLOUD))return!1;var t=/https:\/\/.*?-?df-/i,n=t.test(w(e.responseURL)),i=w(b(e,"location")),s=t.test(i),o=e.status===d.notFound&&n&&!s;return o&&(this.service.updateServiceDomain(i),this.pinUserToDogfoodCloud()),o},e.prototype.continuallyPoll=function(e){var t=this,n=this.buildDispatcher("polling"),r=function(r){var i=c.sessionStorage.get("chat-4171"),s=i&&i.match(/(\d+)x>P$/),o=Date.now()-t.pollStartTime.getTime();s?(i=i.replace(/\d+x>P$/,""),t.update403DebugData(i+(+s[1]+1)+"x",!0)):t.update403DebugData("POK1x"),n.success(r);if(t.standbyMode()&&(t.enteredStandbyMode||o>t._internal.POLLING_DURATION)){var u=f.settings.webApiService.standbyPollingDelayTime.min||30,a=f.settings.webApiService.standbyPollingDelayTime.max||60,l=t.pickRandomDelay(u,a),h=new Promise(function(e){setTimeout(e,l*1e3)});t.analytics.publish(),Promise.race([t.whenActivePromise,h]).then(function(){t.continuallyPoll(e)}),t.enteredStandbyMode=!0}else t.continuallyPoll(e)},i=function(e){n.error(e);if(t.handleRedirection(e,t.poll)){t.update403DebugData("PERR404");return}e.status===0?(t.update403DebugData("PERR0"),t.ping()):(t.update403DebugData("PERR"),t.poll())};this.canPoll.promise.then(function(){t.update403DebugData("P"),t.pollStartTime=new Date,t.service.requestPolling(e).then(r,i)})},e.prototype.enableMessageProperties=function(){this.service.setEndpointProperty(u.ENDPOINT_PROPERTIES.SUPPORTS_MESSAGE_PROPERTIES,!0)},e.prototype.pickRandomDelay=function(e,t){return Math.floor(Math.random()*Math.abs(t-e)+e)},e}();t.__esModule=!0,t["default"]=S}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-chat-service/lib/boundary/dispatcher",["require","exports","lodash-compat"],e)}(function(e,t){var n=e("lodash-compat"),r=function(){function e(e,t){var r=this;this.success=function(e){var t=r.appendIDInfo(e.response);r.internalPubSub.publish("webapi:data",t)},this.error=function(e){var t=r.appendIDInfo(e);r.internalPubSub.publish("webapi:error",t)},this.appendIDInfo=function(e){return e=e||{},n.isObject(e)&&(e.moduleName="webapi",e.actionName=r.actionName),e},this.actionName=e,this.internalPubSub=t}return e}();t.__esModule=!0,t["default"]=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-chat-service/lib/actions/handlers",["require","exports","../index"],e)}(function(e,t){function r(e,t,r){return function(i){var s=i.response,o=r(s),u=!!s._metadata.backwardLink;n.utils.conversationMetadataStore.set(e,o),t(s.messages||[],u)}}var n=e("../index");t.buildMessageSuccess=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-chat-service/lib/index",["require","exports","./utils/conversationMetadataStore","./utils/lockAndKey","./constants","./utils/exponentialTimeout","./utils/sanitizer","msr-crypto","./builders/requestOptionsBuilder","./builders/headerSelector","./calls/service","./boundary/facade","./boundary/dispatcher","./builders/requestURIBuilder","./actions/handlers"],e)}(function(e,t){function v(e,t,n,i,s,o,v,m,g,y,b,w,E,S,x){function A(e){return new h["default"](e,s)}var T=new u.sha256Auth,N=new r["default"](T),C=new f["default"](n._skypeToken,i),k=new a["default"](C,t),L=new l["default"](p,k,e,i,S);return C.setLockAndKey(N.generate()),new c["default"](A,d,L,o,v,C,m,g,s,y,b,w,E,x,n)}var n=e("./utils/conversationMetadataStore"),r=e("./utils/lockAndKey"),i=e("./constants"),s=e("./utils/exponentialTimeout"),o=e("./utils/sanitizer"),u=e("msr-crypto"),a=e("./builders/requestOptionsBuilder"),f=e("./builders/headerSelector"),l=e("./calls/service"),c=e("./boundary/facade"),h=e("./boundary/dispatcher"),p=e("./builders/requestURIBuilder"),d=e("./actions/handlers");t.__esModule=!0,t["default"]=v,t.utils={conversationMetadataStore:new n["default"],exponentialTimeout:s,sanitizer:o,LockAndKey:r["default"]},t.constants=i}),define("swx-chat-service",["swx-chat-service/lib/index"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/internalPubSub",["require","exports","swx-pubsub","lodash-compat"],e)}(function(e,t){function s(){i=null}function o(){return i||(i=n.build(),r.bindAll(i,"subscribe","unsubscribe","publish","unsubscribeAll")),i}var n=e("swx-pubsub"),r=e("lodash-compat"),i;t.reset=s,t.get=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/utils/chat/endpointsDataProvider",["require","exports","swx-jskype-internal-application-instance","swx-constants","lodash-compat","swx-mri","swx-utils-common","jskype-constants","jskype-settings-instance"],e)}(function(e,t){function g(e){N();var t=a.settings.webApiService.activeEndpointsFetch,n=t&&t.delay||60;v=i.throttle(function(){m=new Promise(function(t,n){e().then(function(e){if(!h)return t(!1);if(!e.response||!Array.isArray(e.response))return t(S());var n=e.response.filter(function(e){return e.isActive});if(n.length>1)return t(!1);t(C(n[0].id,o.sessionStorage.get(l.ENDPOINT_ID)))},function(e){t(S())})})},n*1e3,{trailing:!1})}function y(e){c=P(e),L(o.sessionStorage.get(l.ENDPOINT_ID))}function b(){return c}function w(){d=!0}function E(e){if(!k(e.selfLink))return!1;var t=O(e);if(!t)return!1;d&&(L(M(e.selfLink)),d=!1);var r=n.get()._telemetry.context.activeEndpoints,s=i.find(r,function(e){return e===t});return s?!1:(r.push(t),c={count:r.length,endpoints:A(r),nameVersions:c.nameVersions,versions:c.versions},!0)}function S(){return h}function x(e){if(h===!!e)return;h=!!e}function T(){return h?(v(),m):Promise.resolve(!1)}function N(){n.get()._context=n.get()._context||{},n.get()._context.isMyEndpointActive=S,n.get()._context.isTheOnlyActiveEndpoint=T}function C(e,t){return e.length<t.length?"{"+e+"}"===t:e.length>t.length?"{"+t+"}"===e:e===t}function k(e){if(!/v1\/users\/(.*)\/endpoints.*/.test(e))return!1;var t=/v1\/users\/(.*)\/endpoints.*/.exec(e),r=t&&t[1];if(!r)return!1;var i=s.getId(r);return i===n.get().personsAndGroupsManager.mePerson.id()||r===n.get().personsAndGroupsManager.mePerson._msaId()}function L(e){p=e}function A(e){return e=i.uniq(e),e.join(",")||r.COMMON.telemetry.NOT_AVAILABLE}function O(e){var t=_(e.publicInfo);if(!t)return null;switch(t){case"0":t+=" - Delphi";break;case"908":t+=" - Web";break;case"15":t+=" - Win10 Client";break;case"20703":t+=" - Android";break;case"10021":t+=" - IPhone";break;case"1410":t+=" - Win Phone 8.1";break;case"10043":t+=" - IPAD";break;case"1421":t+=" - Win10 Client for mobile"}return t}function M(e){var t=/{(.*)}/.exec(e);return t?t[0]:null}function _(e){var t=/^\d+/.exec(e.skypeNameVersion)||/^\d+/.exec(e.version);return t?t[0]:null}function D(){var e=i.find(n.get()._telemetry.context.activeEndpoints,function(e){e!==f});return e===null}function P(e){var t=[],r=[],i=[],s=!1;return e.forEach(function(e){var n=O(e);if(!n){e.publicInfo.skypeNameVersion&&r.push(e.publicInfo.skypeNameVersion),e.publicInfo.version&&i.push(e.publicInfo.version);return}s=s||n===f,t.push(n)}),s||t.push(f),n.get()._telemetry.context.activeEndpoints=t,{count:t.length,endpoints:A(t),nameVersions:A(r),versions:A(i)}}var n=e("swx-jskype-internal-application-instance"),r=e("swx-constants"),i=e("lodash-compat"),s=e("swx-mri"),o=e("swx-utils-common"),u=e("jskype-constants"),a=e("jskype-settings-instance"),f="908 - Web",l=u.DATA.storageKeys,c,h=!0,p="",d=!1,v,m;t.setup=g,t.set=y,t.get=b,t.startingUpdate=w,t.update=E,t.isMyEndpointActive=S,t.setEndpointActiveStatusTo=x,t.isTheOnlyActiveEndpoint=T}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/telemetry/endpointsTelemetry",["require","exports","swx-jskype-internal-application-instance","../utils/chat/endpointsDataProvider","jskype-settings-instance","swx-constants"],e)}(function(e,t){function u(){return o?(n.get()._telemetryManager.sendEvent(i.settings.telemetry.jSkypeTenantToken,s.COMMON.telemetry.endpoints.TYPE,r.get()),o=!1,!0):!1}function a(){return o}function f(){o=!0}var n=e("swx-jskype-internal-application-instance"),r=e("../utils/chat/endpointsDataProvider"),i=e("jskype-settings-instance"),s=e("swx-constants"),o=!0;t.publish=u,t.available=a,t.reset=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/telemetry/analytics",["require","exports","swx-jskype-internal-application-instance","../utils/chat/endpointsDataProvider","jskype-settings-instance","swx-browser-globals","swx-constants","lodash-compat"],e)}(function(e,t){function l(){if(!i.isFeatureOn(o.COMMON.featureFlags.IDLE_USERS_ANALYTICS)||a||!h()||b())return!1;try{var e={numberOfContacts:p()};d(e),g(e),y(e),n.get()._telemetryManager.sendEvent(i.settings.telemetry.jSkypeTenantToken,o.COMMON.telemetry.idleUsersAnalytics.TYPE,e),a=!0}catch(t){}return undefined}function c(){a=!1}function h(){var e,t,n=s.getWindow().localStorage.getItem(o.COMMON.telemetry.idleUsersAnalytics.localKeys.sidebarActivity);if(n){var r=JSON.parse(n);return r.sidebar&&r.sidebar.lastTimeOpened&&(e=E(new Date(r.sidebar.lastTimeOpened))),r.sidebar&&r.sidebar.numberOfSignIns&&(t=r.sidebar.numberOfSignIns),t>=10||e>=7}return!1}function p(){return n.get().personsAndGroupsManager&&n.get().personsAndGroupsManager.all.persons()?n.get().personsAndGroupsManager.all.persons().length:f}function d(e){var t,r;if(n.get().conversationsManager&&n.get().conversationsManager._allConversations){t=n.get().conversationsManager._allConversations(),e.numberOfConversations=t.length;for(var i=0;i<t.length;i++)v(t[i],e);e.daysSinceLastConversation===undefined&&(e.daysSinceLastConversation=f),r=n.get().conversationsManager._unreadConversations(),e.numberOfUnreadNonGroups=0,e.numberOfUnreadGroups=0;for(var i=0;i<r.length;i++)m(r[i],e)}}function v(e,t){var n=e.lastMessage;if(!n)return;var r=E(new Date(n.composetime));if(t.daysSinceLastConversation===undefined||t.daysSinceLastConversation>r)t.daysSinceLastConversation=r}function m(e,t){var n=w(e.id);n?t.numberOfUnreadGroups=t.numberOfUnreadGroups+1:t.numberOfUnreadNonGroups=t.numberOfUnreadNonGroups+1}function g(e){var t=s.getWindow().localStorage.getItem(o.COMMON.telemetry.idleUsersAnalytics.localKeys.sidebarActivity);e.daysSinceSidebarOpened=f,e.numberOfSignIns=f,e.sidebarState=f;if(t){var n=JSON.parse(t);n.sidebar&&n.sidebar.lastTimeOpened&&(e.daysSinceSidebarOpened=E(new Date(n.sidebar.lastTimeOpened))),n.sidebar&&n.sidebar.numberOfSignIns&&(e.numberOfSignIns=n.sidebar.numberOfSignIns),n.sidebar&&n.sidebar.state&&(e.sidebarState=n.sidebar.state)}}function y(e){var t=r.get();e.endpoints=t.endpoints,e.endpointsNameVersions=t.nameVersions,e.endpointsVersions=t.versions,e.endpointsCount=t.count}function b(){return!n.get().conversationsManager||!n.get().conversationsManager._allConversations}function w(e){return u.isString(e)&&/^19:/.test(e)}function E(e){var t=864e5;return Math.round(Math.abs(((new Date).getTime()-e.getTime())/t))}var n=e("swx-jskype-internal-application-instance"),r=e("../utils/chat/endpointsDataProvider"),i=e("jskype-settings-instance"),s=e("swx-browser-globals"),o=e("swx-constants"),u=e("lodash-compat"),a=!1,f=o.COMMON.telemetry.NOT_AVAILABLE;t.publish=l,t.reset=c}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/cache/instance",["require","exports"],e)}(function(e,t){function r(){return n}function i(e){n=e}var n;t.get=r,t.set=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/serviceAccessLayer/transientFaultPolicy",["require","exports"],e)}(function(e,t){function r(e){return e.status===0}function i(e){return e instanceof XMLHttpRequest}function s(e,t){return t.test(e.status)}function o(e){return i(e)?s(e,n.success)||s(e,n.redirection):!1}function u(e){return i(e)?r(e)||s(e,n.serverError):!1}var n={success:/^(2)\d{2}/,redirection:/^(3)\d{2}/,serverError:/^(5)\d{2}/};t.isWebApiSuccess=o,t.isTransientFailure=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/utils/chat/parser",["require","exports","swx-utils-chat"],e)}(function(e,t){function i(e){if(typeof e!="string")throw new TypeError("Expected a string, got: "+typeof e);var t=e.match(r);return t?t[1]:e}function s(e){var t=e.replace(/<[^a\/].*?>(.*?)<\/[^a].*?>/gi,"$1"),r=t.replace(/(<.*?\.{3,})$/,"").trim(),i=r===""?"":n.messageSanitizer.validateUnescapedLink(r);return i}function o(e){var t=/\/(\d+:[^?]*)/,n=e&&e.match(t);return n&&n[1]?n[1]:undefined}var n=e("swx-utils-chat"),r=/\/((?:\d+:|live:)[^\/]+)/;t.parseName=i,t.parseTopic=s,t.getConversationIdFromUrl=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/utils/chat/message",["require","exports","swx-jskype-internal-application-instance","./parser","swx-enums","swx-mri"],e)}(function(e,t){function f(e){var t=/<initiator>(\d+:.+)<\/initiator>/,n=e.match(t);return n?n[1]:undefined}function l(e){var t=/<target>(.+)<\/target>/,n=e.match(t);return n?n[1].split("</target><target>"):undefined}function c(e,t,n){if(!e)return!0;var r=e.lastReadMessageId===t,i=e.lastReadMessageTimestamp>=n;return r||i}function h(e){if(typeof e.isOutgoing!="undefined")return e.isOutgoing;var t=r.parseName(e.from),i=n.get().personsAndGroupsManager.mePerson;return a=a||s.getKey(i.id(),i._type()),t===a}function p(e){return e.messagetype&&o.indexOf(e.messagetype)>-1?b(e)||w(e):e.messagetype&&u.indexOf(e.messagetype)>-1?!1:!(e.messagetype&&e.messagetype.indexOf("ThreadActivity/")>-1||e.contactRequestType&&e.contactRequestType===i.activityType.ContactRequestIsNowContact)}function d(e){return!h(e)&&p(e)}function v(e){return e?!e._isSMS||!e._isSMS()?!0:e._smsInfo().isSuccessful():!1}function m(){a=undefined}function g(){return a?s.getId(a):n.get().personsAndGroupsManager.mePerson.id()}function y(e){var t=l(e),n=t?t.map(function(e){return s.getId(e)}):null;return n}function b(e){var t=e.content?f(e.content):null,n=e.content?y(e.content):null,r=g();return n?e.messagetype==="ThreadActivity/AddMember"&&s.getId(t)!==r&&n.indexOf(r)>-1:!1}function w(e){var t=e.content?f(e.content):null,n=g();return e.messagetype==="ThreadActivity/TopicUpdate"&&s.getId(t)!==n}var n=e("swx-jskype-internal-application-instance"),r=e("./parser"),i=e("swx-enums"),s=e("swx-mri"),o=["ThreadActivity/TopicUpdate","ThreadActivity/AddMember"],u=["Notice","PopCard"],a;t.getInitiator=f,t.getTargets=l,t.isMessageReadOnServer=c,t.isMessageOutgoing=h,t.doesMessageTypeSupportUnreadState=p,t.canMessageBeMarkedAsUnreadInUI=d,t.allDependenciesAllowSuccessStatus=v,t.reset=m}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/utils/chat/conversation",["require","exports","lodash-compat","swx-mri","swx-jskype-internal-application-instance","./message","swx-constants"],e)}(function(e,t){function f(e){function t(){return(new Date(e.lastMessage.originalarrivaltime)).getTime()}var n=l(e.properties.consumptionhorizon),r=c(e.lastMessage);return s.isMessageReadOnServer(n,r,t())}function l(e){if(!n.isString(e))return{};var t=e.split(";");return{lastReadMessageTimestamp:t[0],modificationTime:t[1],lastReadMessageId:t[2]}}function c(e){return e.clientmessageid||e.skypeeditedid||e.messageid||e.id||0}function h(e,t){var n=e.indexOf(u)!==-1,r=t&&t.migrationcompleted&&t.migrationcompleted==="true";return n&&!r}function p(e){return r.getTypeFromKey(e)===o.PEOPLE.contactTypes.AGENT}function d(e){var t=i.get().personsAndGroupsManager.mePerson;return e===r.getKey(t.id(),t._type())}function v(e){return/^\d:\+/.test(e)}function m(e){return/^(\+)?\d+$/.test(e)}function g(e){var t=e.participants.subscribe();if(!e.participants.size())return t.dispose(),!1;for(var n=0,r=e.participants.size();n<r;n++){var i=e.participants(n);if(!i.audio.endpoint||!m(i.audio.endpoint()))return t.dispose(),!1}return t.dispose(),!0}function y(e){var t=e._metadata&&e._metadata.syncState,n=null;return t&&a.test(t)&&(n=t.match(a)[1]),n}var n=e("lodash-compat"),r=e("swx-mri"),i=e("swx-jskype-internal-application-instance"),s=e("./message"),o=e("swx-constants"),u="@p2p.thread.skype",a=/syncState=([^&]+)/;t.isConversationReadOnServer=f,t.parseConsumptionHorizon=l,t.getMessageKey=c,t.isPartiallyMigrated=h,t.isAgentConversation=p,t.isMeConversation=d,t.isPstnConversation=v,t.isPstnEndpoint=m,t.isPstnOnlyConversation=g,t.getSyncStateFromResponse=y}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/webapi/main",["require","exports","swx-chat-service","swx-browser-detect","usertiming","swx-jskype-internal-application-instance","../internalPubSub","../serviceAccessLayer/qos/reporter","../../telemetry/endpointsTelemetry","../../utils/chat/endpointsDataProvider","../../telemetry/analytics","../../services/cache/instance","../../services/serviceAccessLayer/transientFaultPolicy","../../utils/chat/conversation"],e)}(function(e,t){function v(e){if(!d){var t=s.get();d=n["default"](e,h,t.signInManager,t.personsAndGroupsManager.mePerson,o.get(),t._standbyMode,t._telemetry,c,i,u,a,f,l,r["default"],p.getSyncStateFromResponse)}return d}var n=e("swx-chat-service"),r=e("swx-browser-detect"),i=e("usertiming"),s=e("swx-jskype-internal-application-instance"),o=e("../internalPubSub"),u=e("../serviceAccessLayer/qos/reporter"),a=e("../../telemetry/endpointsTelemetry"),f=e("../../utils/chat/endpointsDataProvider"),l=e("../../telemetry/analytics"),c=e("../../services/cache/instance"),h=e("../../services/serviceAccessLayer/transientFaultPolicy"),p=e("../../utils/chat/conversation"),d;t.getInstance=v}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/entitlement/facade",["require","exports","./serviceSettings"],e)}(function(e,t){var n=e("./serviceSettings"),r=function(){function e(e,t){var r=this;this.getEntitlementServiceData=function(e,t){var i=n.getEntitlementServiceEndpoint(e,t);return r.optionsBuilder.build().then(function(e){return r.serviceLocator.get(i,e)})},this.getEntitlementListingData=function(e){var t=n.getEntitlementListingEndpoint(e);return r.optionsBuilder.build().then(function(e){return r.serviceLocator.get(t,e)})},this.serviceLocator=e,this.optionsBuilder=t}return e}();t.__esModule=!0,t["default"]=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/entitlement/main",["require","exports","../entitlement/facade"],e)}(function(e,t){function i(e,t){return r||(r=new n["default"](e,t)),r}var n=e("../entitlement/facade"),r;t.getInstance=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/optionsBuilder",["require","exports","lodash-compat","swx-jskype-internal-application-instance","jcafe-property-model","jskype-constants","./serviceAccessLayer/transientFaultPolicy","jskype-settings-instance"],e)}(function(e,t){function l(e,t){var r=this,i;return function(s){var o={makeDefault:!0};r.setHeader(a,s,o),i=n.merge({},r._defaultOptions,t),e.resolve(i)}}var n=e("lodash-compat"),r=e("swx-jskype-internal-application-instance"),i=e("jcafe-property-model"),s=e("jskype-constants"),o=e("./serviceAccessLayer/transientFaultPolicy"),u=e("jskype-settings-instance"),a="X-Skypetoken",f=function(){function e(){this._dynamicOptions={},this._defaultOptions={headers:{Accept:s.COMMON.contentTypes.JSON_V1_0}},this._defaultOptions.headers[a]="",this._defaultOptions.retry=this.getRetryPolicy()}return e.prototype.getRetryPolicy=function(){var e=u.settings.retry;return n.merge({isTransientCheck:o.isTransientFailure},e)},e.prototype.setOption=function(e,t){this._dynamicOptions[e]=t},e.prototype.setHeader=function(e,t,n){n&&n.makeDefault?this._defaultOptions.headers[e]=t:(this._dynamicOptions.headers=this._dynamicOptions.headers||{},this._dynamicOptions.headers[e]=t)},e.prototype.removeHeader=function(e){this._dynamicOptions.headers&&delete this._dynamicOptions.headers[e]},e.prototype.setServiceName=function(e){this._dynamicOptions.reporting={serviceName:e}},e.prototype.build=function(){var e=i.task();return r.get().signInManager._skypeToken().then(l.call(this,e,this._dynamicOptions)),this._dynamicOptions={},e.promise},e}();t.__esModule=!0,t["default"]=f});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/contacts/optionsBuilder",["require","exports","lodash-compat","../optionsBuilder","./serviceSettings","swx-client-info"],e)})(function(e,t){var n=e("lodash-compat"),r=e("../optionsBuilder"),i=e("./serviceSettings"),s=e("swx-client-info"),o=function(e){function t(){var t=e.call(this)||this;return n.merge(t._defaultOptions.retry,i.getRetryPolicy()),n.merge(t._defaultOptions.headers,{"X-Skype-Caller":s.getBIAppName()}),t}return __extends(t,e),t}(r["default"]);t.__esModule=!0,t["default"]=o});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/entitlement/entitlementOptionsBuilder",["require","exports","lodash-compat","swx-jskype-internal-application-instance","jskype-constants","./serviceSettings","../serviceAccessLayer/transientFaultPolicy","../optionsBuilder","swx-client-info"],e)})(function(e,t){var n=e("lodash-compat"),r=e("swx-jskype-internal-application-instance"),i=e("jskype-constants"),s=e("./serviceSettings"),o=e("../serviceAccessLayer/transientFaultPolicy"),u=e("../optionsBuilder"),a=e("swx-client-info"),f=function(e){function t(){var t=e.call(this)||this;return t._options={headers:{Accept:i.COMMON.contentTypes.JSON_V3_0,"X-Skype-Caller":a.getBIAppName(),"X-Skypetoken":""},retry:n.merge({},{isTransientCheck:o.isTransientFailure},s.getRetryPolicy()),reporting:{serviceName:s.actions.getEntitlementService},addContentType:!1},t}return __extends(t,e),t.prototype.setHeader=function(e,t){this._options.headers[e]=t},t.prototype.build=function(){var e=this;return r.get().signInManager._skypeToken().then(function(t){return e.setHeader("X-Skypetoken",t),e._options})},t}(u["default"]);t.__esModule=!0,t["default"]=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/serviceFactory",["require","exports","swx-xhr-dispatcher","./serviceAccessLayer/decorations/reporting","swx-jskype-internal-application-instance","./contacts/serviceSettings","swx-chat-service/lib/serviceSettings","./entitlement/serviceSettings","./contacts/main","./webapi/main","./entitlement/main","./contacts/optionsBuilder","./entitlement/entitlementOptionsBuilder"],e)}(function(e,t){function p(){var e=i.get().personsAndGroupsManager.mePerson.id(),t=n.build(m(s.getHost()));return a.getInstance(e,t,new c["default"])}function d(){var e=n.build(m(o.getHost()));return f.getInstance(e)}function v(){var e=n.build(m(u.getHost()));return l.getInstance(e,new h["default"])}function m(e){return{host:e,decorations:[r]}}var n=e("swx-xhr-dispatcher"),r=e("./serviceAccessLayer/decorations/reporting"),i=e("swx-jskype-internal-application-instance"),s=e("./contacts/serviceSettings"),o=e("swx-chat-service/lib/serviceSettings"),u=e("./entitlement/serviceSettings"),a=e("./contacts/main"),f=e("./webapi/main"),l=e("./entitlement/main"),c=e("./contacts/optionsBuilder"),h=e("./entitlement/entitlementOptionsBuilder");t.getContactsService=p,t.getPresenceService=d,t.getEntitlementService=v}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/contactActivityItemHelper",["require","exports","lodash-compat","swx-enums"],e)}(function(e,t){function s(e){return e.filter(p)}function o(e){return e.filter(d)}function u(e,t){var n=e.historyService,r=s(n.activityItems()),i=!1;return r.forEach(function(e){e.type()!==t?n._removeMessage(e):i=!0}),i}function a(e){var t=e.historyService,n=o(t.activityItems());n.forEach(function(e){t._removeMessage(e)})}function f(e){var t=e.historyService.activityItems();return n.find(t,c)}function l(e){var t=e.historyService.activityItems();return n.find(t,h)}function c(e){return e.type()===r.activityType.ContactRequestIncoming}function h(e){return e.type()===r.activityType.ContactRequestIncomingInviteFree}function p(e){return i.indexOf(e.type())!==-1}function d(e){return e.type()===r.activityType.UnblockContact}var n=e("lodash-compat"),r=e("swx-enums"),i=[r.activityType.ContactRequestOutgoingResend,r.activityType.ContactRequestOutgoing,r.activityType.ContactRequestOutgoingAgent,r.activityType.ContactRequestIncoming,r.activityType.ContactRequestIsNowContact,r.activityType.SuggestedContact];t.filterContactRequestActivityItems=s,t.filterUnblockContactActivityItems=o,t.clearContactRequestActivityItems=u,t.clearUnblockContactActivityItems=a,t.getContactRequestIncomingActivityItem=f,t.getContactRequestIncomingInviteFreeActivityItem=l}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/contactMessageFactory",["require","exports","swx-enums","jskype-constants","./contactActivityItemHelper","../personHelper"],e)}(function(e,t){function o(e,t){return e.isAgent()?d(e,!0,n.activityType.ContactRequestOutgoingAgent,t):d(e,!0,n.activityType.ContactRequestOutgoing,t)}function u(e,t){return d(e,!0,n.activityType.ContactRequestOutgoingResend,t)}function a(e,t,r){return d(e,!1,n.activityType.ContactRequestIncoming,t,r)}function f(e,t){return d(e,!1,n.activityType.ContactRequestIncomingInviteFree,t-1)}function l(e){return d(e,!1,n.activityType.ContactRequestIsNowContact)}function c(e,t){return d(e,!0,n.activityType.SuggestedContact,t)}function h(e,t){return d(e,!0,n.activityType.UnblockContact,t)}function p(e,t){function f(){switch(e._authorization()){case r.PEOPLE.authorizationStates.PENDING_OUTGOING:return u(e);case r.PEOPLE.authorizationStates.SUGGESTED:return c(e);case r.PEOPLE.authorizationStates.UNAUTHORIZED:return o(e);default:return undefined}}var n=i.filterContactRequestActivityItems(t.historyService.activityItems()),a=i.filterUnblockContactActivityItems(t.historyService.activityItems());return!n.length&&s.canRequestContactAuthorization(e)?f():!a.length&&e.isBlocked()?h(e):undefined}function d(e,t,n,r,i){return r=+r||+(new Date),{id:+r,personId:e.id(),timestamp:+r,contactRequestType:n,greeting:i,isOutgoing:t}}var n=e("swx-enums"),r=e("jskype-constants"),i=e("./contactActivityItemHelper"),s=e("../personHelper");t.getOutgoing=o,t.getOutgoingResend=u,t.getIncoming=a,t.getIncomingInviteFree=f,t.getIsNowContact=l,t.getSuggested=c,t.getUnblockContact=h,t.getActivityItemForInitialConversationLoad=p}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/presenceHelper",["require","exports","jskype-constants","swx-enums","../personHelper"],e)}(function(e,t){function s(e,t){var s=n.PEOPLE.authorizationStates;return t===s.AUTHORIZED&&(e.isAgent()||i.isEchoContact(e))?r.onlineStatus.Online:t===s.PENDING_INCOMING?r.onlineStatus.Unknown:t===s.AUTHORIZED&&!i.isPstn(e)?r.onlineStatus.Offline:undefined}var n=e("jskype-constants"),r=e("swx-enums"),i=e("../personHelper");t.getDefaultPresence=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/groupHelper",["require","exports","swx-jskype-internal-application-instance","swx-constants","swx-enums","lodash-compat"],e)}(function(e,t){function u(e,t){var r=t||[],u=n.get().personsAndGroupsManager.all,a=u.groups(),f=!0;switch(e._authorization()){case o.AUTHORIZED:case o.PENDING_OUTGOING:case o.SUGGESTED:m(e,u,f);break;case o.UNAUTHORIZED:g(e,u,f)}e.isBlocked()&&r.push(i.groupPrivacyRelationshipLevel.Blocked),s.forEach(a,function(t){r.indexOf(t.uri())>-1?m(e,t,f):g(e,t,f)})}function a(e){var t=y(e.id());return t&&t.length>0?s.map(t,function(e){return e.uri()}):[]}function f(e){var t=b(e);return t?t.persons():[]}function l(e,t){var n=b(e);return!!n&&!!n.persons(t.id())}function c(e,t){var n=b(e);n&&n.persons.changed(t)}function h(e,t){var n=b(e);n&&n.persons.changed.off(t)}function p(e,t){var n=b(e);return n?n.persons.add(t,t.id()):Promise.resolve()}function d(e,t){var n=b(e),r=!0;n&&m(t,n,r)}function v(){return n.get().personsAndGroupsManager.all.groups(i.groupPrivacyRelationshipLevel.Blocked)}function m(e,t,n){t.persons(e.id())||t.persons.add(e,e.id(),undefined,n||!1)}function g(e,t,n){t.persons(e.id())&&t.persons.remove(e.id(),n||!1)}function y(e){var t=n.get().personsAndGroupsManager.all.groups(),r=s.filter(t,function(t){return!!t.persons(e)});return r}function b(e){return n.get().personsAndGroupsManager.all.uri()===e?n.get().personsAndGroupsManager.all:n.get().personsAndGroupsManager.all.groups(e)}var n=e("swx-jskype-internal-application-instance"),r=e("swx-constants"),i=e("swx-enums"),s=e("lodash-compat"),o=r.PEOPLE.authorizationStates;t.updateGroups=u,t.getAffiliatedGroupUris=a,t.getPersonsFromGroup=f,t.isPersonInGroup=l,t.subscribeToGroup=c,t.unsubscribeFromGroup=h,t.addPersonToGroup=p,t.simpleAddPersonToGroup=d,t.getBlockedGroup=v}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/authorizationChange",["require","exports","swx-jskype-internal-application-instance","../../services/contactsV2/instance","../../services/serviceFactory","swx-enums","swx-constants","jskype-constants","../personHelper","../contacts/contactActivityItemHelper","../contacts/contactMessageFactory","jskype-settings-instance","../contacts/presenceHelper","swx-mri","../contacts/groupHelper"],e)}(function(e,t){function v(e,r){function a(){f.clearContactRequestActivityItems(i),n.get().conversationsManager.conversations(p.getKey(e.id(),e._type()))?n.get().conversationsManager.conversations.remove(i):(s=l.getUnblockContact(e),i.historyService._processRawMessage(s))}var i,s,o;if(e.isBlocked())return Promise.resolve();r=g(r,!0),e.isBlocked._set(!0),i=w(e),b(e,!0);switch(e._authorization()){case u.PEOPLE.authorizationStates.PENDING_INCOMING:o=t.sendDeclineRequest(e),i&&(f.clearContactRequestActivityItems(i),n.get().conversationsManager.conversations.remove(i));break;case u.PEOPLE.authorizationStates.UNAUTHORIZED:i&&a();break;case u.PEOPLE.authorizationStates.PENDING_OUTGOING:case u.PEOPLE.authorizationStates.SUGGESTED:i&&(s=l.getUnblockContact(e),f.clearContactRequestActivityItems(i),i.historyService._processRawMessage(s));break;case u.PEOPLE.authorizationStates.AUTHORIZED:i&&(s=l.getUnblockContact(e),f.clearUnblockContactActivityItems(i),i.historyService._processRawMessage(s)),S(e);break;default:}return r&&d.updateGroups(e),o||Promise.resolve()}function m(e,t){var n,r,i;if(!e.isBlocked())return;t=g(t,!0),e.isBlocked._set(!1),n=w(e),b(e,!1);switch(e._authorization()){case u.PEOPLE.authorizationStates.AUTHORIZED:n&&f.clearUnblockContactActivityItems(n),x(e);break;case u.PEOPLE.authorizationStates.UNAUTHORIZED:n&&(r=l.getOutgoing(e),f.clearUnblockContactActivityItems(n),n.historyService._processRawMessage(r));break;case u.PEOPLE.authorizationStates.PENDING_OUTGOING:n&&(i=l.getOutgoingResend(e),f.clearUnblockContactActivityItems(n),n.historyService._processRawMessage(i));break;case u.PEOPLE.authorizationStates.SUGGESTED:n&&(i=l.getSuggested(e),f.clearUnblockContactActivityItems(n),n.historyService._processRawMessage(i));break;default:}t&&d.updateGroups(e)}function g(e,t){return e===undefined?t:e}function y(){var e={};return e[u.PEOPLE.authorizationStates.AUTHORIZED]=function(e,t,n){var r;if(t===u.PEOPLE.authorizationStates.AUTHORIZED)return;e._authorization._set(u.PEOPLE.authorizationStates.AUTHORIZED),r=h.getDefaultPresence(e,u.PEOPLE.authorizationStates.AUTHORIZED),r&&e.status._set(r);switch(t){case u.PEOPLE.authorizationStates.PENDING_OUTGOING:case u.PEOPLE.authorizationStates.PENDING_INCOMING:case u.PEOPLE.authorizationStates.SUGGESTED:case u.PEOPLE.authorizationStates.UNAUTHORIZED:n&&(f.clearContactRequestActivityItems(n),E(e,n)),x(e);break;default:}},e[u.PEOPLE.authorizationStates.UNAUTHORIZED]=function(e,t,r){var i;if(t===u.PEOPLE.authorizationStates.UNAUTHORIZED)return;e._authorization._set(u.PEOPLE.authorizationStates.UNAUTHORIZED),e.status._set(undefined);switch(t){case u.PEOPLE.authorizationStates.PENDING_INCOMING:r&&(f.clearContactRequestActivityItems(r),n.get().conversationsManager.conversations.remove(r));break;case u.PEOPLE.authorizationStates.UNKNOWN:case u.PEOPLE.authorizationStates.PENDING_OUTGOING:case u.PEOPLE.authorizationStates.SUGGESTED:r&&a.canRequestContactAuthorization(e)&&(i=l.getOutgoing(e),f.clearContactRequestActivityItems(r),r.historyService._processRawMessage(i));break;case u.PEOPLE.authorizationStates.AUTHORIZED:r&&a.canRequestContactAuthorization(e)&&(i=l.getOutgoing(e),f.clearContactRequestActivityItems(r),r.historyService._processRawMessage(i)),S(e);break;default:}},e[u.PEOPLE.authorizationStates.PENDING_OUTGOING]=function(e,t,n){var r;if(t===u.PEOPLE.authorizationStates.PENDING_OUTGOING)return;e._authorization._set(u.PEOPLE.authorizationStates.PENDING_OUTGOING),e.status._set(s.onlineStatus.Unknown);switch(t){case u.PEOPLE.authorizationStates.UNKNOWN:case u.PEOPLE.authorizationStates.UNAUTHORIZED:case u.PEOPLE.authorizationStates.SUGGESTED:case u.PEOPLE.authorizationStates.AUTHORIZED:n&&(f.clearContactRequestActivityItems(n),r=l.getOutgoingResend(e),n.historyService._processRawMessage(r));break;default:}},e[u.PEOPLE.authorizationStates.SUGGESTED]=function(e,t,n){if(t===u.PEOPLE.authorizationStates.SUGGESTED)return;e._authorization._set(u.PEOPLE.authorizationStates.SUGGESTED),n&&(t===u.PEOPLE.authorizationStates.UNAUTHORIZED||t===u.PEOPLE.authorizationStates.UNKNOWN)&&(f.clearContactRequestActivityItems(n),n.historyService._processRawMessage(l.getSuggested(e)))},e}function b(e,t){n.get().conversationsManager._conversationBlockedUpdate(p.getKey(e.id(),e._type()),t)}function w(e){return n.get().conversationsManager._getConversation(p.getKey(e.id(),e._type()))}function E(e,t){c.isFeatureOn(o.COMMON.featureFlags.INVITE_FREE_IMPLICIT_INCOMING_CONTACT_REQUEST)||t.historyService._processRawMessage(l.getIsNowContact(e))}function S(e){if(N(e)){var t=i.getPresenceService();t.removeContactFromContactsList(p.getKey(e.id(),e._type()))}}function x(e){if(T(e)){var t=i.getPresenceService();t.addContactToContactsList(p.getKey(e.id(),e._type()))}}function T(e){return!c.isFeatureOn(o.COMMON.featureFlags.DO_NOT_SEND_CONTACTS_TO_CHAT_SERVICE)&&a.canAddToChatServiceContactList(e)}function N(e){return!c.isFeatureOn(o.COMMON.featureFlags.DO_NOT_SEND_CONTACTS_TO_CHAT_SERVICE)&&a.canRemoveContactFromChatServiceContactList(e)}var n=e("swx-jskype-internal-application-instance"),r=e("../../services/contactsV2/instance"),i=e("../../services/serviceFactory"),s=e("swx-enums"),o=e("swx-constants"),u=e("jskype-constants"),a=e("../personHelper"),f=e("../contacts/contactActivityItemHelper"),l=e("../contacts/contactMessageFactory"),c=e("jskype-settings-instance"),h=e("../contacts/presenceHelper"),p=e("swx-mri"),d=e("../contacts/groupHelper");t.setAuthorization=function(e,t,n){var r=y()[t];return r&&r(e,e._authorization(),w(e)),g(n,!0)&&d.updateGroups(e),e},t.setBlocked=v,t.setUnblocked=m,t.sendDeclineRequest=function(e){function s(){t.setAuthorization(e,u.PEOPLE.authorizationStates.UNAUTHORIZED)}function o(e){}var i=e.id();return r.get().declineContactInvite(n.get().personsAndGroupsManager.mePerson.id(),p.getKey(i,e._type())).then(s,o)}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/agentDetails",["require","exports","jcafe-property-model"],e)}(function(e,t){var n=e("jcafe-property-model"),r=function(){function e(){this.author=n.property({readOnly:!0}),this.description=n.property({readOnly:!0}),this.certification=n.property({readOnly:!0}),this.rating=n.property({readOnly:!0}),this.website=n.property({readOnly:!0}),this.privacyStatement=n.property({readOnly:!0}),this.termsOfService=n.property({readOnly:!0}),this.extraInfo=n.property({readOnly:!0}),this.messages_mode_all=n.property({readOnly:!0})}return e}();t.__esModule=!0,t["default"]=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/person",["require","exports","jcafe-property-model","./note","./location","./capabilities","./phoneNumber","swx-enums","swx-jskype-internal-application-instance","../modelHelpers/contacts/authorizationChange","../modelHelpers/personHelper","../services/contactsV2/instance","./agentDetails","swx-mri","swx-mri/lib/mriMaps"],e)}(function(e,t){function m(e){var t=e.id();if(p.isPstnId(t)){var n=new o["default"];n.type._set(u.phoneType.Other),n.telUri._set(t),n.displayString._set(t),n.fromProfile._set(!0),e.phoneNumbers.add(n,t)}}function g(e,t){e.capabilities.chat._set(t),e.capabilities.audio._set(t),e.capabilities.video._set(t),e.capabilities.groupAdd._set(t),e.capabilities.screenSharing._set(t)}function y(e,t,n){function o(){var e=!!n&&n.value;return e?c.get().blockContact(r,s,e,n.reason):c.get().blockContact(r,s,e)}function u(){return c.get().unblockContact(r,s)}function l(){return t?f.setBlocked(e).then(function(){return!0}):(f.setUnblocked(e),Promise.resolve(!1))}var r=a.get().personsAndGroupsManager.mePerson.id(),i=e.id(),s=p.getKey(i,e._type());return t?o().then(l):u().then(l)}var n=e("jcafe-property-model"),r=e("./note"),i=e("./location"),s=e("./capabilities"),o=e("./phoneNumber"),u=e("swx-enums"),a=e("swx-jskype-internal-application-instance"),f=e("../modelHelpers/contacts/authorizationChange"),l=e("../modelHelpers/personHelper"),c=e("../services/contactsV2/instance"),h=e("./agentDetails"),p=e("swx-mri"),d=e("swx-mri/lib/mriMaps"),v=function(){function e(e){this._type=n.property({readOnly:!0,value:d.contactMriTypes.skype}),this._authorization=n.property({readOnly:!0}),this.isAgent=n.property({readOnly:!0,value:!1}),this.firstName=n.property({readOnly:!0}),this.lastName=n.property({readOnly:!0}),this.title=n.property({readOnly:!0}),this.office=n.property({readOnly:!0}),this.department=n.property({readOnly:!0}),this.company=n.property({readOnly:!0}),this.emails=n.collection(),this.status=n.property({readOnly:!0}),this.activity=n.property({readOnly:!0}),this.endpointType=n.property({readOnly:!0,value:u.endpointType.Desktop}),this.note=new r["default"],this.lastSeenAt=n.property({set:function(e){return e!==undefined?new Date(e):undefined}}),this.location=new i["default"],this._birthday=n.property({readOnly:!0}),this.capabilities=new s["default"],this.phoneNumbers=n.collection(),this.agentDetails=new h["default"],this.subscribe=n.enabledCommand(function(){}),this.addPhoneNumber=function(e,t){var n=this,r=a.get().personsAndGroupsManager.mePerson.id(),i=p.getKey(this.id(),this._type());return t=t||"mobile",c.get().addContactPhoneNumber(r,i,t,e).then(function(){var t=new o["default"];t.type._set(u.phoneType.Cell),t.telUri._set(e),t.fromProfile._set(!1),t.displayString._set(e),n.phoneNumbers.add(t,e)})},this.removePhoneNumber=function(e){var t=this,n=a.get().personsAndGroupsManager.mePerson.id(),r=p.getKey(this.id(),this._type());return c.get().deleteContactPhoneNumber(n,r,e).then(function(n){var r=-1;return t.phoneNumbers().forEach(function(t,n){t.telUri()===e&&!t.fromProfile()&&(r=n)}),r>=0&&t.phoneNumbers.remove(r),n})};var t=y.bind(null,this),f=n.enabledCommand(t);this.id=n.property({readOnly:!0,value:e}),this.isBlocked=n.property({set:f,value:!1}),this.displayName=n.property({readOnly:!0,value:e}),this.avatarUrl=n.property({readOnly:!0,value:p.isGuestId(e)?undefined:l.getAvatarUri(e)}),this.location.type._set(u.locationType.Unknown),g(this,!0),m(this)}return e}();t.__esModule=!0,t["default"]=v}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/agents/telemetryDecorator",["require","exports","lodash-compat","swx-jskype-internal-application-instance","jskype-settings-instance","swx-constants"],e)}(function(e,t){function u(e,t){return function(u){var f=e(u);return f["catch"](function(e){var n=e.getResponseHeader&&e.getResponseHeader("ContextId");r.get()._telemetryManager.sendEvent(i.settings.telemetry.jSkypeTenantToken,"ServiceFault",{serviceName:a(t.serviceName),faultCode:a(e.status),faultContext:o,errorCode:a(e.status),errorMessage:a(e.responseText),verb:a(u.type),host:i.settings.agentProvisioningService.host,contextId:n||s.COMMON.telemetry.NOT_AVAILABLE})}),f}}function a(e){var t=!n.isBoolean(e)&&!e;return t?o:e}var n=e("lodash-compat"),r=e("swx-jskype-internal-application-instance"),i=e("jskype-settings-instance"),s=e("swx-constants"),o=s.COMMON.telemetry.NOT_AVAILABLE;t.name="reporting",t.build=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-agents-web-service/lib/agentsWebService",["require","exports","lodash-compat","swx-xhr-dispatcher"],e)}(function(e,t){function i(e,t){function s(n){return e().then(function(e){var r={headers:{"X-SkypeToken":e,"X-Client-Version":t.clientVersion,"X-Host-System-Version":t.hostSystemVersion,"X-Client-UI-Language":t.clientUILanguage},reporting:{serviceName:"agents-"+n},params:{}};return r})}function o(e){return s("add").then(function(t){return i.put("relationship/me/"+e,t)})}function u(e){return s("search").then(function(r){if(!e||!e.agentId)r.params.clientCountry=t.countryCode;return i.get("agents",n.merge(r,{params:e}))})}var i=r.build(t);return{add:o,search:u}}var n=e("lodash-compat"),r=e("swx-xhr-dispatcher");t.build=i}),define("swx-agents-web-service",["swx-agents-web-service/lib/agentsWebService"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/agents/instance",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","swx-browser-detect","swx-client-info","../serviceAccessLayer/decorations/reporting","./telemetryDecorator","swx-agents-web-service"],e)}(function(e,t){function l(){var e=r.settings.agentProvisioningService,t,i;return f||(t=n.get().signInManager._skypeToken,i=c(),f=a.build(t,{host:e.host,decorations:[o,u],countryCode:s.getCountryCode(),clientVersion:r.settings.uiVersion,hostSystemVersion:i,clientUILanguage:r.settings.initParams.locale})),f}function c(){var e=i["default"].getSystemInfo(),t=e.osVersion,n="0",r="0",s="";return t+"."+n+"."+r+"/"+s}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("swx-browser-detect"),s=e("swx-client-info"),o=e("../serviceAccessLayer/decorations/reporting"),u=e("./telemetryDecorator"),a=e("swx-agents-web-service"),f;t.get=l}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataMappers/agentToPerson",["require","exports","lodash-compat","./mappers","swx-mri/lib/mriMaps"],e)}(function(e,t){function s(e,t){return t.isAgent._set(!0),t._type._set(i.contactMriTypes.agent),t.avatarUrl._set(e.userTileStaticUrl),r.mapDisplayName(e.displayName,t),r.mapAgentAuthor(e.developer,t),r.mapAgentDescription(e.description,t),r.mapAgentWebsite(e.webpage,t),r.mapAgentPrivacyStatement(e.privacyStatement,t),r.mapAgentTermsOfService(e.tos,t),r.mapAgentExtraInfo(e.extra,t),t.agentDetails.certification._set(e.isTrusted),t.agentDetails.rating._set(e.starRating),t.agentDetails.messages_mode_all._set(n(e.disclosures).includes("all.groups.messages")),t.capabilities.chat._set(n(e.capabilities).includes("im.send")),t.capabilities.audio._set(n(e.capabilities).includes("audio.send")),t.capabilities.video._set(n(e.capabilities).includes("video.send")),t.capabilities.screenSharing._set(n(e.capabilities).includes("screen_share")),t.capabilities._gvc._set(n(e.capabilities).includes("gvc")),t.capabilities._groupChat._set(n(e.capabilities).includes("group_chat")),t.capabilities._fileSend._set(n(e.capabilities).includes("file.send")),t.capabilities._contactSend._set(n(e.capabilities).includes("contact.send")),t.capabilities._videoMessageSend._set(n(e.capabilities).includes("videomessage.send")),t.capabilities._audioMessageSend._set(n(e.capabilities).includes("audiomessage.send")),t.capabilities._mediaMessageSend._set(n(e.capabilities).includes("mediamessage.send")),t.capabilities._annotationSend._set(n(e.capabilities).includes("annotation.send")),t.capabilities._photoSend._set(n(e.capabilities).includes("photo.send")),t.capabilities._mojiSend._set(n(e.capabilities).includes("moji.send")),t.capabilities._locationSend._set(n(e.capabilities).includes("location.send")),t.capabilities._mediaAutoplay._set(n(e.capabilities).includes("external.media.receive")),t}var n=e("lodash-compat"),r=e("./mappers"),i=e("swx-mri/lib/mriMaps");t.map=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataProcessors/agents",["require","exports","lodash-compat","swx-utils-common","../../../services/agents/instance","../dataMappers/agentToPerson"],e)}(function(e,t){function o(e){var t=n.reduce(e,u,[]);return Promise.all(t)}function u(e,t){var n={agentId:t.id()},o=r.settablePromise.build();return i.get().search(n).then(function(e){var n=e.response.agentDescriptions||[];n[0]?o.resolve(s.map(n[0],t)):o.resolve(t)},function(){o.resolve(t)}),e.concat(o)}var n=e("lodash-compat"),r=e("swx-utils-common"),i=e("../../../services/agents/instance"),s=e("../dataMappers/agentToPerson");t.process=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/personsRegistry/registry",["require","exports","lodash-compat","../../utils/batch","jskype-constants","../../modelHelpers/contacts/dataHandlers/batchProfiles","../../services/stratus/instance","../../modelHelpers/personHelper","../../models/person","../../modelHelpers/contacts/dataProcessors/agents","swx-mri/lib/mriMaps"],e)}(function(e,t){function p(e,t){t&&n.isString(t)&&(e._type._set(t),t===l.contactMriTypes.agent&&e.isAgent._set(!0))}function d(e){u.isPstn(e)?(e.capabilities.video._set(!1),e.capabilities.chat._set(!1),e.capabilities.screenSharing._set(!1)):u.isEchoContact(e)&&(e.capabilities.video._set(!1),e.capabilities.screenSharing._set(!1))}function v(e){return g(e.id())&&e._type()===l.contactMriTypes.skype&&(e._authorization()===c.UNAUTHORIZED||e._authorization()===c.PENDING_INCOMING)}function m(e){return e._type()===l.contactMriTypes.agent&&e._authorization()===c.UNAUTHORIZED}function g(e){var t=/.+\@.+\..+/;return n.isString(e)?!e.match(t):undefined}var n=e("lodash-compat"),r=e("../../utils/batch"),i=e("jskype-constants"),s=e("../../modelHelpers/contacts/dataHandlers/batchProfiles"),o=e("../../services/stratus/instance"),u=e("../../modelHelpers/personHelper"),a=e("../../models/person"),f=e("../../modelHelpers/contacts/dataProcessors/agents"),l=e("swx-mri/lib/mriMaps"),c=i.PEOPLE.authorizationStates,h=function(){function e(){function l(e){e&&e.length&&o.get().getProfiles(e).then(i.onSuccess,i.onError)}var e=this;this.defaultPersonAuthorization=c.UNKNOWN,this.create=function(t,r,i){var s=new a["default"](t);return i&&n.isString(i)?s._authorization._set(i):s._authorization._set(e.defaultPersonAuthorization),p(s,r),d(s),s},this.getOrCreate=function(t,n,r,i){var s=e.get(t);return s||(s=e.create(t,n,r),e.add(s,i)),s},this.filter=function(t){return e.toArray().filter(t)};var t={},i=s.build(this),u=r.create(l);this.get=function(e){return t[e]},this.add=function(e,n){var r=e.id();t[r]=e,n||(m(e)?f.process([e]):v(e)&&u.add(r))},this.toArray=function(){var e=[];return Object.keys(t).forEach(function(n){var r=t[n];e.push(r)}),e},this.dispose=function(){return u.clear()}}return e}();t.__esModule=!0,t["default"]=h}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/personsRegistry/instance",["require","exports","./registry"],e)}(function(e,t){function i(){r&&(r.dispose(),r=null)}function s(){return r||(r=new n["default"]),r}var n=e("./registry"),r;t.reset=i,t.build=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/personsAndGroupsHelper",["require","exports","swx-browser-globals","swx-enums","swx-jskype-internal-application-instance","./personsRegistry/instance","swx-mri","jskype-constants/lib/people"],e)}(function(e,t){function f(e){return s.build().get(e)}function l(e){var t=i.get().personsAndGroupsManager.mePerson,n=o.getId(e);return n===a||t.id()===n||t._msaId&&o.getId(t._msaId())===n}function c(e){return!!e&&!!i.get().personsAndGroupsManager.all.persons(e.id())}function h(e){var n=f(e);return!l(e)&&!c(n)?n||t.createDefaultPerson(e):undefined}function p(){var e=i.get().personsAndGroupsManager.all;return e.groups().filter(function(e){return e.relationshipLevel()===r.groupPrivacyRelationshipLevel.Blocked})[0]}function d(e,t){return l(e)?i.get().personsAndGroupsManager.mePerson:s.build().getOrCreate(e,t)}function v(e){var t=o.getId(e),n=o.getTypeFromKey(e);return s.build().getOrCreate(t,n)}function m(e){return JSON.parse(n.getWindow().atob(e.split(".")[1])).skypeid}function g(e){return JSON.parse(n.getWindow().atob(e.split(".")[1])).cid}var n=e("swx-browser-globals"),r=e("swx-enums"),i=e("swx-jskype-internal-application-instance"),s=e("./personsRegistry/instance"),o=e("swx-mri"),u=e("jskype-constants/lib/people"),a=u["default"].SELF;t.getPersonById=f,t.isMePerson=l,t.isKnownPerson=c,t.createDefaultPerson=function(e){return s.build().create(e)},t.getUnknownPerson=h,t.getBlockedGroup=p,t.getPerson=d,t.getPersonByConversationId=v,t.extractSkypeIdFromToken=m,t.extractCIDFromToken=g}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/signIn/resignInHelper",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","../personsAndGroupsHelper"],e)}(function(e,t){function s(e,t){var r=n.get().signInManager;e.start({rps_token:r._rpsToken(),site_name:r._siteName(),relink:!0,callback:function(e){return o(e,t)}})}function o(e,t){var r=n.get().signInManager;return r._skypeToken().then(function(n){var s=i.extractSkypeIdFromToken(n),o=i.extractSkypeIdFromToken(e.skypetoken);s!==o&&u(r,e,t)})}function u(e,t,n){var i=e.createTokenImplicitOAuthSignInParameter({skypetoken:t.skypetoken,rps_token:t.rps_token,expires_in:t.expires_in,client_id:r.settings.implicitOAuthParams.client_id,site_name:t.site_name});n.get().implicitSignOut=!0,e.signOut().then(function(){e.signIn(i)})}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("../personsAndGroupsHelper");t.startRelinkingFlow=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/signInManager",["require","exports","lodash-compat","jcafe-property-model","swx-jskype-internal-application-instance","swx-enums","../modelHelpers/signIn/parameterBuilder","../modelHelpers/signIn/skypeTokenManager","../modelHelpers/personsAndGroupsHelper","../modelHelpers/signIn/resignInHelper","jskype-settings-instance","swx-constants"],e)}(function(e,t){function p(e){i.get()._telemetryManager.setSkypeUserId(e)}function d(e){var t=y(e);i.get()._telemetryManager.setCommonProperty("signed_in",t)}function v(e){var t=y(g(e));i.get()._telemetryManager.setCommonProperty("technical_account",t)}function m(){var e=i.get().personsAndGroupsManager.mePerson,t=e.preferences(c.COMMON.userSettings.preferences.DARK_THEME),n=c.COMMON.telemetry.themeEvent;i.get()._telemetryManager.setCommonProperty(n.TYPE,n.theme.DEFAULT);if(!l.isFeatureOn(c.COMMON.featureFlags.DARK_THEME_ENABLED)||!t)return;t.value.get().then(function(e){e&&i.get()._telemetryManager.setCommonProperty(n.TYPE,n.theme.DARK)})}function g(e){return e&&e.indexOf("live:")===0}function y(e){return e?1:0}function b(e,t){return n.extend(new h(e,t),o)}var n=e("lodash-compat"),r=e("jcafe-property-model"),i=e("swx-jskype-internal-application-instance"),s=e("swx-enums"),o=e("../modelHelpers/signIn/parameterBuilder"),u=e("../modelHelpers/signIn/skypeTokenManager"),a=e("../modelHelpers/personsAndGroupsHelper"),f=e("../modelHelpers/signIn/resignInHelper"),l=e("jskype-settings-instance"),c=e("swx-constants"),h=function(){function e(e,t){function w(n){if(n&&n.relink)return f.startRelinkingFlow(e,t),Promise.resolve();i.state._set(s.loginState.SigningIn),b=u.build(n);var r=o.get();return r.then(x),r}function E(e){return i.context=e,new Promise(function(e){i.state._set(s.loginState.SigningOut),y(!1),i.state.once(s.loginState.SignedOut,function(){l(!0),h(!1),d(!1),e(!0)})})}function S(){return y(!1),b.check().then(function(){y(!0)},function(e){return E({reason:c.COMMON.api.auth.errorTypes.REAUTH_NEEDED}),Promise.reject({})})}function x(e){var t=a.extractSkypeIdFromToken(e);i.state._set(s.loginState.SignedIn),l(!1),h(!0),p(t),d(!0),v(t),m(),k(t),y(!0)}function T(){var e=o.get.bind(o);return e.changed=o.changed,e}function N(){return i.state()!==s.loginState.SignedOut?b.get().then(function(e){return C(e),i._tokenExpiration=e.expiration,e.token},function(e){return C(e),i._tokenExpiration=undefined,E(),Promise.reject(e)}):Promise.reject("Not signed in")}function C(e){e&&(i._rpsToken(e.rpsToken),i._siteName(e.siteName))}function k(e){g(e)&&l(!0)}var n=this;this.state=r.property({readOnly:!0,value:s.loginState.SignedOut}),this._rpsToken=r.property(),this._siteName=r.property(),this.getSignOutContext=function(){return n.context};var i=this,o=r.property({get:N}),l=r.boolProperty(!0),h=r.boolProperty(!1),y=r.boolProperty(!1),b;this.signIn=r.command(w,l),this.signOut=r.command(E,h),this.validateState=r.command(S,y),this._skypeToken=T()}return e}();t.build=b}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/translatorService",["require","exports","jcafe-property-model","jskype-settings-instance","lodash-compat","swx-utils-common","swx-enums","swx-jskype-internal-application-instance","reqwest"],e)}(function(e,t){function l(){return new f}var n=e("jcafe-property-model"),r=e("jskype-settings-instance"),i=e("lodash-compat"),s=e("swx-utils-common"),o=e("swx-enums"),u=e("swx-jskype-internal-application-instance"),a=e("reqwest"),f=function(){function e(){this.supportedLanguages=n.collection({get:this.getLanguagesCommand.bind(this)}),this.translateMessage=n.command(this.translateMessageCommand.bind(this),n.boolProperty(!0)),this.state=n.property({readOnly:!0,value:o.translatorServiceState.NotReady})}return e.prototype.requestServiceWithSkypeToken=function(e){function i(e){t.resolve(e)}function s(e){t.reject(e)}var t=n.task();return u.get().signInManager._skypeToken().then(function(t){var n={url:e,method:"GET",crossOrigin:!0,dataType:"json",headers:{"X-Skypetoken":t,"Accept-Language":r.settings.initParams.locale,"X-ScenarioId":r.settings.translatorClientAppId}};a.compat(n).then(i,s)},s),t.promise},e.prototype.translateMessageCommand=function(e,t,i){var o=n.task();if(!t||!i)return o.reject(),o.promise;var u=s.url.buildUrl(r.settings.translatorServiceURI.TRANSLATE,{from:e||"",to:t,text:i});return this.requestServiceWithSkypeToken(u).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},e.prototype.processSupportedLanguages=function(e){var t=this,r=e.text;i.forIn(r,function(e,r){if(!e.name||!r)return;t.supportedLanguages.add({name:n.property({value:e.name}),code:n.property({value:r})})})},e.prototype.getLanguagesCommand=function(){var e=this,t=n.task(),i=s.url.buildUrl(r.settings.translatorServiceURI.LANGUAGES,{scope:"text"});return this.requestServiceWithSkypeToken(i).then(function(n){e.processSupportedLanguages(n),e.state._set(o.translatorServiceState.Authenticated),t.resolve(e.supportedLanguages())},function(n){e.state._set(o.translatorServiceState.Error),t.reject(n)}),t.promise},e}();t.TranslatorService=f,t.build=l}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/messageSearch/main",["require","exports","swx-jskype-internal-application-instance","reqwest","swx-utils-common","jskype-settings-instance"],e)}(function(e,t){function u(){return new o}var n=e("swx-jskype-internal-application-instance"),r=e("reqwest"),i=e("swx-utils-common"),s=e("jskype-settings-instance"),o=function(){function e(){var e=this;this.serviceSettings=s.settings.messageSearchService,this.queryPattern="{OPTION: {RESULTBASE: 0, RESULTCOUNT: %COUNT%}, QUERYSTRING: {Content: %CRITERIA%}}",this.query=function(t,n){var s={url:e.serviceSettings.host+e.serviceSettings.endpoints.query,headers:{"x-ms-correlation-id":i.guid.create(),"X-Skypetoken":""},method:"POST",dataType:"json",contentType:"application/json",data:e.queryPattern.replace("%CRITERIA%",JSON.stringify(t)).replace("%COUNT%",n.toString())};return e.setupToken().then(function(e){return s.headers["X-Skypetoken"]=e,Promise.resolve(r.compat(s))})}}return e.prototype.setupToken=function(){return n.get().signInManager._skypeToken()},e}();t.build=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/searchQuery",["require","exports","jcafe-property-model","../modelHelpers/propertyModelHelper"],e)}(function(e,t){var n=e("jcafe-property-model"),r=e("../modelHelpers/propertyModelHelper"),i=function(){function e(){this.keywords={},this.limit=n.property({value:20}),this.sources=n.property(),this.text=n.property(),this.moreResultsAvailable=n.boolProperty(!0).asReadOnly(),this.results=r.exposeReadOnlyCollection(n.collection()),this.supportedKeywords=r.exposeReadOnlyCollection(n.collection())}return e}();t.__esModule=!0,t["default"]=i});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/marketplaceSearchQuery",["require","exports","jcafe-property-model","../modelHelpers/propertyModelHelper","./searchQuery"],e)})(function(e,t){var n=e("jcafe-property-model"),r=e("../modelHelpers/propertyModelHelper"),i=e("./searchQuery"),s=function(e){function t(){function s(){var e=n.task();return e.promise}var t=e.call(this)||this,i=n.collection();return i.add("type","type"),t.supportedKeywords=r.exposeReadOnlyCollection(i),t.getMore=n.command(s,t.moreResultsAvailable),t}return __extends(t,e),t}(i["default"]);t.__esModule=!0,t["default"]=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/marketplaceManager",["require","exports","jcafe-property-model","./marketplaceSearchQuery"],e)}(function(e,t){var n=e("jcafe-property-model"),r=e("./marketplaceSearchQuery"),i=function(){function e(){this.createSearchQuery=function(){return new r["default"]},this.purchase=n.disabledCommand()}return e}();t.__esModule=!0,t["default"]=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/propertyValidator",["require","exports","lodash-compat"],e)}(function(e,t){function r(e){return n.isString(e)&&/^19:/.test(e)}function i(e){return n.isString(e)&&(/^\+?\d+$/.test(e)||/^4:/.test(e))}function s(e){return n.isString(e)&&/^(1|8|(28)):/.test(e)}var n=e("lodash-compat");t.isGroupConversation=r,t.isPhoneNumber=i,t.is1to1Conversation=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/calling/callData",["require","exports","swx-enums","swx-constants","jcafe-property-model"],e)}(function(e,t){function u(){return new o}var n=e("swx-enums"),r=e("swx-constants"),i=e("jcafe-property-model"),s=r.COMMON.events.trouter,o=function(){function e(){this.callPayloads=[],this.isProcessingCall=i.boolProperty(!1),this.isCurrentCallIncoming=i.boolProperty(!1),this.pluginAwaitCall=i.boolProperty(!1),this.pluginRingingForMe=i.boolProperty(!1),this.callTechnology=i.property({value:n.callTechnology.None}),this.isHostless=!1,this.pluginOthersAreLive=i.boolProperty(!1),this.pluginCallInfo=i.property(),this.nodeId=i.property(),this.ngcEndpointId=i.property(),this.ngcParticipantId=i.property(),this.resetPluginCallState=function(){this.pluginRingingForMe(!1)},this.hasIncomingP2PNotification=function(){return this.callPayloads.some(function(e){return e.payload.evt===s.INCOMING_SKYPE_P2P_CALL})},this.hasIncomingNGCNotification=function(){return this.callPayloads.some(this.isIncomingNGCPayload)},this.isGroupIncomingCall=function(){return this.getFirstPayload()?this.getFirstPayload().conversationId!=="8:"+this.getFirstPayload().callerId:!1},this.addIncomingCallPayload=function(e){this.isCurrentCallIncoming(!0),this.callPayloads.push({processed:!1,payload:e})}}return e.prototype.oncePluginCallInfoReady=function(e){return this.pluginCallInfo(null),this.pluginCallInfo.once(function(e){return!!e},e)},e.prototype.getFirstPayload=function(){return this.callPayloads[0]?this.callPayloads[0].payload:null},e.prototype.resetCallData=function(){this.callPayloads=[],this.isProcessingCall(!1),this.isCurrentCallIncoming(!1),this.pluginAwaitCall(!1),this.callTechnology(n.callTechnology.None),this.isHostless=!1,this.pluginCallInfo(null),this.nodeId(null),this.ngcEndpointId(null),this.ngcParticipantId(null)},e.prototype.getCallIdFromCurrentCall=function(){return this.getFirstPayload()&&this.getFirstPayload().convoCallId},e.prototype.getIncomingNGCPayload=function(){var e=this,t=null;return this.callPayloads.forEach(function(n){if(e.isIncomingNGCPayload(n)){if(t)return;n.processed||(t=n.payload,n.processed=!0)}}),t},e.prototype.wasNGCPayloadProcessed=function(){var e=this;return this.callPayloads.some(function(t){var n=e.isIncomingNGCPayload(t);return n&&t.processed})},e.prototype.getUnprocessedIncomingCallPayloads=function(){var e=[];return this.callPayloads.forEach(function(t){t.processed||(t.processed=!0,e.push(t.payload))}),e},e.prototype.markIncomingPayloadsAsProcessed=function(e){this.callPayloads.forEach(function(t){t.payload===e&&(t.processed=!0)})},e.prototype.markAllIncomingPayloadsAsProcessed=function(){this.callPayloads.forEach(function(e){e.processed=!0})},e.prototype.isIncomingNGCPayload=function(e){return e.payload.evt===s.INCOMING_SKYPE_NGC_CALL||e.payload.evt===s.INCOMING_SKYPE_NGC_GVC_CALL||e.payload.evt===s.INCOMING_LYNC_NGC_CALL||e.payload.evt===s.INCOMING_SKYPE_NGC_PSTN_CALL},e}();t.build=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/calling/internalCallTelemetry",["require","exports","../../services/internalPubSub"],e)}(function(e,t){function i(){return new r}var n=e("../../services/internalPubSub"),r=function(){function e(){this.callTelemetryData={},n.get().subscribe("internalPluginEvent",this.recordStep.bind(this))}return e.prototype.setData=function(e,t){e&&t&&(this.callTelemetryData[e]=t.toString())},e.prototype.recordStep=function(e){this.setData(e,!0)},e.prototype.getData=function(){return Object.keys(this.callTelemetryData).length?this.callTelemetryData:null},e.prototype.setCallDirection=function(e){this.callTelemetryData.direction=e},e.prototype.reset=function(){this.callTelemetryData={}},e}();t.build=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/participantAudio",["require","exports","jcafe-property-model","../../lib/modelHelpers/propertyModelHelper","../../lib/modelHelpers/personsAndGroupsHelper","swx-enums"],e)}(function(e,t){function u(e,t){return new o(e,t.id())}var n=e("jcafe-property-model"),r=e("../../lib/modelHelpers/propertyModelHelper"),i=e("../../lib/modelHelpers/personsAndGroupsHelper"),s=e("swx-enums"),o=function(){function e(e,t){var o=this;this.isMuted=r.createPropertyWithSetter(!1,this.isMutedSetter.bind(this),!0),this.isMuteEnabledProperty=this.isMuted.set._enabled,this.state=n.property({readOnly:!0,value:s.callConnectionState.Disconnected}),this.isSpeaking=n.property({readOnly:!0,value:!1}),this.importance=n.property({readOnly:!0,value:0}),this.isOnHold=n.property({value:!1}),this._isFailedCall=n.property({value:!1}),this._sourceId=n.property(),this.handleConnectionStateChanged=function(e,t,n){if(n===undefined||t===s.callDisconnectionReason.CallEscalated)return;e===s.callConnectionState.Connecting&&(o.isMuteEnabledProperty(!0),o.isMuted._set(!1)),e===s.callConnectionState.Disconnected&&(o.isMuteEnabledProperty(!1),o.isMuted._set(!1))},this._dispose=function(){o.isSelfParticipant&&o.state.changed.off(o.handleConnectionStateChanged)},this.conversation=e,this.participantId=t,this.endpoint=n.property({value:t}),this.isSelfParticipant=i.isMePerson(t),this.isSelfParticipant&&this.state.changed(this.handleConnectionStateChanged)}return e.prototype.isMutedSetter=function(e){var t=this,n;return this.isMuteEnabledProperty(!1),this.isSelfParticipant&&(e?n=this.conversation._callHandler.mute():n=this.conversation._callHandler.unmute()),n.then(function(e){t.isMuted._set(e),t.isMuteEnabledProperty(!0)}),n},e}();t.ParticipantAudio=o,t.build=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/mediaStreamSink",["require","exports","jcafe-property-model"],e)}(function(e,t){var n=e("jcafe-property-model"),r=function(){function e(){this.container=n.property()}return e}();t.__esModule=!0,t["default"]=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/mediaStreamSource",["require","exports","../../lib/models/mediaStreamSink"],e)}(function(e,t){var n=e("../../lib/models/mediaStreamSink"),r=function(){function e(){this.sink=new n["default"]}return e}();t.__esModule=!0,t["default"]=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/mediaStream",["require","exports","jcafe-property-model","../../lib/models/mediaStreamSource","swx-enums"],e)}(function(e,t){var n=e("jcafe-property-model"),r=e("../../lib/models/mediaStreamSource"),i=e("swx-enums"),s=function(){function e(){this.state=n.property({readOnly:!0,value:i.mediaStreamState.Stopped}),this.source=new r["default"],this.width=n.property({readOnly:!0,value:0}),this.height=n.property({readOnly:!0,value:0})}return e}();t.__esModule=!0,t["default"]=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/videoChannel",["require","exports","jcafe-property-model","../../lib/modelHelpers/personsAndGroupsHelper","../../lib/modelHelpers/propertyModelHelper","../../lib/models/mediaStream","swx-enums","swx-constants"],e)}(function(e,t){function f(e,t,n){return new a(e,t,n)}var n=e("jcafe-property-model"),r=e("../../lib/modelHelpers/personsAndGroupsHelper"),i=e("../../lib/modelHelpers/propertyModelHelper"),s=e("../../lib/models/mediaStream"),o=e("swx-enums"),u=e("swx-constants"),a=function(){function e(e,t,i){var u=this;this.streamSubscriptions=[],this.isOnHold=n.property({value:!1}),this.isVideoOn=n.property({readOnly:!0,value:!1}),this.stream=new s["default"],this.camera=null,this._init=function(){u.streamSubscriptions.push(u.stream.source.sink.container.changed(function(){u.canAttachVideoStream()&&u.attachVideoStream()})),u.streamSubscriptions.push(u.stream.state.when(o.mediaStreamState.Started,u.attachVideoStream.bind(u))),u.streamSubscriptions.push(u.stream.state.when(o.mediaStreamState.Stopped,u.detachVideoStream.bind(u))),u.videoStateSubscription=u.videoState.when(o.callConnectionState.Disconnected,u.onDisconnectedCallState.bind(u))},this._dispose=function(){u.stream.state._set(o.mediaStreamState.Stopped),u.streamSubscriptions.forEach(function(e){e.dispose()}),u.streamSubscriptions.length=0,u.videoStateSubscription.dispose()},this._reset=function(){u.stream.state._set(o.mediaStreamState.Stopped),u.isStarted._set(!1),u.isVideoOn._set(!1)},this.conversation=e,this.videoState=t,this.participantId=i,this.isSelfParticipant=r.isMePerson(i),this.setIsStartedDefaultValue()}return e.prototype.setIsStartedDefaultValue=function(){var e=this.getStartedDefaultValue();this.isStarted=i.createPropertyWithSetter(e,this.toggleIsStarted.bind(this),!0),this.channelStarted=e,this.isStartedEnabledProperty=this.isStarted.set._enabled},e.prototype.getStartedDefaultValue=function(){return!this.isSelfParticipant&&!this.conversation.isGroupConversation()},e.prototype.canAttachVideoStream=function(){return this.conversation.selfParticipant.audio.state()!==o.callConnectionState.Disconnected&&this.conversation.selfParticipant.audio.state()!==o.callConnectionState.Disconnecting&&this.conversation._callHandler&&this.stream.state()!==o.mediaStreamState.Stopped&&this.stream.source.sink.container()&&this.isVideoOn()&&this.channelStarted},e.prototype.canDetachVideoStream=function(){return this.conversation._callHandler},e.prototype.attachVideoStream=function(){this.canAttachVideoStream()&&this.conversation._callHandler.attachParticipantVideo(this.participantId,this.stream.source.sink.container(),u.CALLING.PLUGIN_MEDIA_TYPES.VIDEO)["catch"](function(){})},e.prototype.detachVideoStream=function(){this.canDetachVideoStream()&&this.conversation._callHandler.detachParticipantVideo(this.participantId,u.CALLING.PLUGIN_MEDIA_TYPES.VIDEO)["catch"](function(){})},e.prototype.toggleIsStarted=function(e){return this.isSelfParticipant&&this.conversation.selfParticipant.audio.state()===o.callConnectionState.Connected&&this.isStartedEnabledProperty(!1),this.conversation._callHandler?(this.channelStarted=e,this.channelStarted&&this.isSelfParticipant&&this.stream.state._set(o.mediaStreamState.Started),this.isSelfParticipant&&this.isVideoOn._set(this.channelStarted),this.channelStarted?this.attachVideoStream():this.detachVideoStream(),Promise.resolve(this.channelStarted)):Promise.reject(null)},e.prototype.onDisconnectedCallState=function(e,t){if(t===undefined)return;this.stream.state._set(o.mediaStreamState.Stopped),this.isStartedEnabledProperty(!0),this.isStarted._set(!1),this.isVideoOn._set(!1),this.channelStarted=this.getStartedDefaultValue()},e}();t.VideoChannel=a,t.build=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/participantVideo",["require","exports","jcafe-property-model","../../lib/modelHelpers/propertyModelHelper","swx-jskype-internal-application-instance","../../lib/modelHelpers/personsAndGroupsHelper","../../lib/models/videoChannel","swx-enums"],e)}(function(e,t){function f(e,t){return new a(e,t)}var n=e("jcafe-property-model"),r=e("../../lib/modelHelpers/propertyModelHelper"),i=e("swx-jskype-internal-application-instance"),s=e("../../lib/modelHelpers/personsAndGroupsHelper"),o=e("../../lib/models/videoChannel"),u=e("swx-enums"),a=function(){function e(e,t){var i=this;this.channelsInternal=n.collection(),this.state=n.property({readOnly:!0,value:u.callConnectionState.Disconnected}),this.channels=r.exposeReadOnlyCollection(this.channelsInternal),this._sourceId=n.property(),this._dispose=function(){i.channels().forEach(function(e){e._dispose()}),i.channels._removeAll(),s.isMePerson(i.personId)&&i.selectedCameraSubsription&&i.selectedCameraSubsription.dispose()},this.conversation=e,this.person=t,this.personId=t.id(),this.createAndAddVideoChannel(),s.isMePerson(this.personId)&&this.handleCameraAvailability()}return e.prototype.handleCameraAvailability=function(){this.channels(0).isStarted.set.enabled._set(!1),this.selectedCameraSubsription=i.get().devicesManager.selectedCamera.changed(this.handleSelectedCameraChanged.bind(this))},e.prototype.createAndAddVideoChannel=function(){var e=o.build(this.conversation,this.state,this.personId);e._init(),this.channels._add(e)},e.prototype.handleSelectedCameraChanged=function(e,t){if(e)this.channels(0).camera=e,this.channels(0).isStarted.set.enabled._set(!0);else if(!Boolean(e)||t==="ActiveDeviceUnplugged")this.channels(0).camera=null,this.channels(0).isStarted.set.enabled._set(!1),this.channels(0)._reset()},e}();t.ParticipantVideo=a,t.build=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/participantChat",["require","exports","jcafe-property-model","swx-enums","swx-constants"],e)}(function(e,t){function u(e){return new o(e)}var n=e("jcafe-property-model"),r=e("swx-enums"),i=e("swx-constants"),s=i.COMMON.isTyping,o=function(){function e(e){var t=this;this.state=n.property({readOnly:!0,value:r.callConnectionState.Disconnected}),this.isTyping=n.property({readOnly:!0,value:!1}),this.onChatModalityChanged=function(e){t.state._set(e?r.callConnectionState.Connected:r.callConnectionState.Disconnected)},this._setIsTyping=function(e){clearTimeout(t.isTypingTimeout),t.isTyping._set(e),t.isTyping&&(t.isTypingTimeout=setTimeout(t.expireIsTyping.bind(t),s.EXPIRY))},this._dispose=function(){clearTimeout(t.isTypingTimeout),t.conversation.activeModalities.chat.changed.off(t.onChatModalityChanged)},this.conversation=e,e.activeModalities.chat.changed(this.onChatModalityChanged)}return e.prototype.expireIsTyping=function(){this.isTyping._set(!1)},e}();t.ParticipantChat=o,t.build=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/participantScreenSharing",["require","exports","swx-enums","swx-constants","jcafe-property-model","../../lib/models/mediaStream","../../lib/modelHelpers/personsAndGroupsHelper"],e)}(function(e,t){function a(e,t){return new u(e,t.id())}var n=e("swx-enums"),r=e("swx-constants"),i=e("jcafe-property-model"),s=e("../../lib/models/mediaStream"),o=e("../../lib/modelHelpers/personsAndGroupsHelper"),u=function(){function e(e,t){var r=this;this.streamSubscriptions=[],this.state=i.property({readOnly:!0,value:n.callConnectionState.Disconnected}),this.stream=new s["default"],this.isControlling=i.property({value:!1}),this._sourceId=i.property(),this._dispose=function(){r.onStreamStopped(),r.streamSubscriptions.forEach(function(e){e.dispose()}),r.streamSubscriptions.length=0},this.conversation=e,this.participantId=t,this.isSelfParticipant=o.isMePerson(t),this.streamSubscriptions.push(this.stream.source.sink.container.changed(function(){r.canAttachScreenSharingStream()?r.attachScreenSharingStream():r.canDetachScreenSharingStream()&&r.detachScreenSharingStream()})),this.streamSubscriptions.push(this.stream.state.when(n.mediaStreamState.Started,this.onStreamStarted.bind(this))),this.streamSubscriptions.push(this.stream.state.when(n.mediaStreamState.Active,this.onStreamActive.bind(this))),this.streamSubscriptions.push(this.stream.state.when(n.mediaStreamState.Stopped,this.onStreamStopped.bind(this))),this.streamSubscriptions.push(this.state.when(n.callConnectionState.Connecting,this.onConnecting.bind(this))),this.streamSubscriptions.push(this.state.when(n.callConnectionState.Disconnecting,this.onDisconnecting.bind(this)))}return e.prototype.canAttachScreenSharingStream=function(){var e=this.stream.source.sink.container();return this.conversation._callHandler&&this.stream.state()!==n.mediaStreamState.Stopped&&e},e.prototype.canDetachScreenSharingStream=function(){return this.conversation._callHandler&&this.state()!==n.callConnectionState.Disconnected&&(this.stream.state()===n.mediaStreamState.Stopped||!this.stream.source.sink.container())},e.prototype.canStartOutgoingScreenSharing=function(){return this.conversation._callHandler&&this.stream.state()===n.mediaStreamState.Stopped},e.prototype.canStopOutgoingScreenSharing=function(){return this.conversation._callHandler&&this.stream.state()!==n.mediaStreamState.Stopped},e.prototype.attachScreenSharingStream=function(){this.canAttachScreenSharingStream()&&this.conversation._callHandler.attachParticipantVideo(this.participantId,this.stream.source.sink.container(),r.CALLING.PLUGIN_MEDIA_TYPES.SCREEN_SHARING)["catch"](function(){})},e.prototype.detachScreenSharingStream=function(){this.canDetachScreenSharingStream()&&this.conversation._callHandler.detachParticipantVideo(this.participantId,r.CALLING.PLUGIN_MEDIA_TYPES.SCREEN_SHARING)["catch"](function(){})},e.prototype.startOutgoingScreenSharing=function(){this.canStartOutgoingScreenSharing()&&this.conversation._callHandler.startScreenSharing(this.participantId)["catch"](function(){})},e.prototype.stopOutgoingScreenSharing=function(){this.canStopOutgoingScreenSharing()&&this.conversation._callHandler.stopScreenSharing(this.participantId)["catch"](function(){})},e.prototype.onStreamStarted=function(){this.state._set(n.callConnectionState.Notified)},e.prototype.onStreamActive=function(){this.state._set(n.callConnectionState.Connected)},e.prototype.onStreamStopped=function(){this.state()!==n.callConnectionState.Disconnecting&&this.state()!==n.callConnectionState.Disconnected&&this.state._set(n.callConnectionState.Disconnecting),this.state._set(n.callConnectionState.Disconnected)},e.prototype.onConnecting=function(){this.isSelfParticipant?this.startOutgoingScreenSharing():this.attachScreenSharingStream()},e.prototype.onDisconnecting=function(){this.isSelfParticipant?this.stopOutgoingScreenSharing():this.detachScreenSharingStream()},e}();t.ParticipantScreenSharing=u,t.build=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/participant",["require","exports","jcafe-property-model","swx-enums","../../lib/models/participantAudio","../../lib/models/participantVideo","../../lib/models/participantChat","swx-mri","../../lib/models/participantScreenSharing"],e)}(function(e,t){function f(e){return/^guest:/.test(e)}function l(e){return e.chat.state()===r.callConnectionState.Disconnected&&e.audio.state()===r.callConnectionState.Disconnected&&e.video.state()===r.callConnectionState.Disconnected&&e.screenSharing.state()===r.callConnectionState.Disconnected?r.participantState.Disconnected:r.participantState.Connected}var n=e("jcafe-property-model"),r=e("swx-enums"),i=e("../../lib/models/participantAudio"),s=e("../../lib/models/participantVideo"),o=e("../../lib/models/participantChat"),u=e("swx-mri"),a=e("../../lib/models/participantScreenSharing"),c=function(){function e(e,t,u){var c=this;this.lastReadTimestamp=n.property({readOnly:!0,value:null}),this.updateParticipantState=function(){c.state._set(l(c))},this.updateIsAnonymous=function(e){c.isAnonymous._set(f(e))},this.updateParticipantScreenSharingCapability=function(e){var t=/^(\+)?\d+$/.test(e);c.person.capabilities.screenSharing._set(!t)},this._dispose=function(){c.chat.state.changed.off(c.updateParticipantState),c.audio.state.changed.off(c.updateParticipantState),c.video.state.changed.off(c.updateParticipantState),c.screenSharing.state.changed.off(c.updateParticipantState),c.conversation.selfParticipant.role.changed.off(c.onSelfParticipantRoleChanged),c.chat._dispose(),c.audio._dispose(),c.video._dispose(),c.screenSharing._dispose(),c.person.id.changed.off(c.updateIsAnonymous),c.audio.endpoint.changed.off(c.updateParticipantScreenSharingCapability)},this.onSelfParticipantRoleChanged=function(e){c.canSetRole(e===r.participantRole.Leader)},this.apiHandler=u,this.conversation=t,this.person=e,this.canSetRole=n.boolProperty(t.selfParticipant&&t.selfParticipant.role()===r.participantRole.Leader),this.setRoleCommand=n.command(this.setRole.bind(this),this.canSetRole),this.role=n.property({value:r.participantRole.Attendee,set:this.setRoleCommand}),this.isAnonymous=n.property({readOnly:!0,value:f(e.id())}),t.selfParticipant&&t.selfParticipant.role.changed(this.onSelfParticipantRoleChanged),this.chat=o.build(t),this.audio=i.build(t,e),this.video=s.build(t,e),this.screenSharing=a.build(t,e),this.state=n.property({readOnly:!0,value:l(this)}),this.chat.state.changed(this.updateParticipantState),this.audio.state.changed(this.updateParticipantState),this.video.state.changed(this.updateParticipantState),this.screenSharing.state.changed(this.updateParticipantState),e.id.changed(this.updateIsAnonymous.bind(this)),this.person.phoneNumbers.size()&&this.audio.endpoint.changed(this.updateParticipantScreenSharingCapability.bind(this))}return e.prototype.setRole=function(e){return this.role()===e||!r.participantRole[e]?this.role():(this.apiHandler.addParticipant(this.conversation.conversationId,u.getKey(this.person.id(),this.person._type()),e),e)},e}();t.__esModule=!0,t["default"]=c}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-async-media-service/lib/asyncMediaService",["require","exports","reqwest","swx-utils-common","swx-browser-globals"],e)}(function(e,t){var n=e("reqwest"),r=e("swx-utils-common"),i=e("swx-browser-globals"),s=0,o=500,u=3,a="imgt1",f="imgpsh_fullsize",l="imgpsh",c="avatar",h="avatar_fullsize",p="original",d="thumbnail",v="video",m="audio",g=908,y=function(){function e(e,t){this._getSkypeToken=e,this._settings=t}return e.prototype.authenticate=function(e){var t={method:"post",dataType:"json",url:this._settings.amdServiceHost+"/v1/skypetokenauth",data:"skypetoken="+e,contentType:"application/x-www-form-urlencoded",crossOrigin:!0,withCredentials:!0,headers:{"X-Client-Version":g+"/"+this._getClientVersion()}};return n.compat(t)},e.prototype._getClientVersion=function(){var e=this._settings.version.split(".",4);while(e.length<4)e.push("0");return e[3]=e[2],e[2]="0",e.join(".")},e.prototype.getThumbnailStatus=function(e){return this._getViewStatus(e,a)},e.prototype.getPictureStatus=function(e){return this._getViewStatus(e,f)},e.prototype.getVideoStatus=function(e){return this._getViewStatus(e,v)},e.prototype.getAudioStatus=function(e){return this._getViewStatus(e,m)},e.prototype.sendFile=function(e,t,n,r,i){var s=this;return new Promise(function(o,u){s._getSkypeToken().then(function(a){s._getDocumentId(e,a,t,i).then(function(e){s._uploadDocument(e.id,t,a,n,r,i).then(o,u)},function(){u("Can't retrieve documentId")})},function(){u("Can't retrieve Skype token")})})},e.prototype.deleteFile=function(e){var t=this;return new Promise(function(n,r){t._getSkypeToken().then(function(i){t._deleteDocument(e,i).then(function(e){n(e.status_location)},function(){r("File deletion failed")})},function(){r("Can't retrieve Skype token")})})},e.prototype._deleteDocument=function(e,t){var r=this._settings.amdServiceHost+"/v1/objects/"+e,i={url:r,method:"DELETE",crossOrigin:!0,dataType:"json",headers:{Authorization:"skype_token "+t,"X-Client-Version":g+"/"+this._getClientVersion()}};return n.compat(i)},e.prototype._getThumbnailStatusForFile=function(e,t,n){return this._getViewStatus(t,this._getDocumentCloudStoreData(e,n).thumbnail)},e.prototype._uploadDocument=function(e,t,n,r,i,s){function l(e){r(e,a)}var o=this,u=this._settings.amdServiceHost+"/v1/objects/"+e,a=new XMLHttpRequest,f=this._getDocumentCloudStoreData(t,s);return new Promise(function(r,c){a.upload.addEventListener("progress",l),a.open("PUT",u+"/content/"+f.content,!0),a.setRequestHeader("Authorization","skype_token "+n),a.setRequestHeader("Content-Type","multipart/form-data"),a.send(t),a.onreadystatechange=function(){a.readyState===4&&(a.status===201?(a.upload.removeEventListener("progress",l),o._getThumbnailStatusForFile(t,u,s).then(function(){i(u+"/views/"+f.thumbnail),r(e)},function(){c("Unsupported Media Type")})):(a.upload.removeEventListener("progress",l),c("Can't upload file")))}})},e.prototype._getImageCloudData=function(){return{type:"pish/image",thumbnail:a,content:l,original:f}},e.prototype._getGroupAvatarCloudData=function(){return{type:"avatar/group",thumbnail:h,content:c}},e.prototype._getFileCloudData=function(){return{type:"sharing/file",thumbnail:d,content:p,original:p}},e.prototype._getDocumentCloudStoreData=function(e,t){return t?this._getGroupAvatarCloudData():r.file.isImage(e)?this._getImageCloudData():this._getFileCloudData()},e.prototype._getDocumentId=function(e,t,i,s){var o=this._getDocumentCloudStoreData(i,s),u={};u[e]=["read"];var a={type:o.type,permissions:u};return r.file.isImage(i)||(a.filename=i.name),n.compat({method:"post",dataType:"json",url:this._settings.amdServiceHost+"/v1/objects",data:JSON.stringify(a),headers:{Authorization:"skype_token "+t,"X-Client-Version":g+"/"+this._getClientVersion()},contentType:"application/json",crossOrigin:!0,withCredentials:!0})},e.prototype._getViewStatus=function(e,t,r,a){var f=this;r===void 0&&(r=s),a===void 0&&(a=u);var l=e+"/views/"+t,c=l+"/status",h={url:c,dataType:"json",crossOrigin:!0,withCredentials:!0};if(a===0)return Promise.reject({});var p=function(n){var i=n.scan&&n.scan.status!=="in progress"&&n.scan.status!=="ready",s=n.view_state==="ready"&&!n.scan,u=n.view_state==="ready"&&n.scan&&n.scan.status==="passed";return n.status_location&&!n.view_state?(e=n.status_location.replace("/views/"+t+"/status",""),f._getViewStatus(e,t,r,a)):s||u?Promise.resolve(l):n.view_state==="failed"||i?Promise.reject({}):n.content_state!=="expired"?f._getViewStatus(e,t,o,a):Promise.reject({})},d=function(n){return n.status===401||n.status===403?(a--,f._getSkypeToken().then(function(n){return f.authenticate(n).then(function(){return f._getViewStatus(e,t,r,a)})})):Promise.reject({})};return(new Promise(function(e){i.getWindow().setTimeout(e,r)})).then(function(){return n.compat(h).then(p,d)})},e}();t.__esModule=!0,t["default"]=y,t.build=function(e,t){return new y(e,t)}}),define("swx-async-media-service",["swx-async-media-service/lib/asyncMediaService"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/asyncMedia/main",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","swx-async-media-service"],e)}(function(e,t){function s(){return i.build(n.get().signInManager._skypeToken,r.settings)}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("swx-async-media-service");t.get=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/telemetry/messageSent",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","swx-constants","swx-utils-chat","swx-telemetry-buckets","swx-browser-globals","swx-enums"],e)}(function(e,t){function v(e,t,n,r){return new d(e,t,n,r)}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("swx-constants"),s=e("swx-utils-chat"),o=e("swx-telemetry-buckets"),u=e("swx-browser-globals"),a=e("swx-enums"),f=i.COMMON.telemetry.messageSent,l=i.COMMON.telemetry.conversationOrigin,c=i.COMMON.telemetry.NOT_AVAILABLE,h=a.activityType,p={PRESENT:"Yes",NOT_PRESENT:"No"},d=function(){function e(e,t,i,s){var u=this;this.wasLiked=!1,this.data={},this.heartEvent=function(){u.wasLiked=!0},this.publish=function(e){var t=u.getTts(),i=f.TYPE,s=u.conversation.participantsCount(),a=u.getContentLength(),l=u.activityItem.translations&&u.activityItem.translations.size()>0;u.data.group_conversation=u.getPresence(u.conversation.isGroupConversation()),u.conversation.isGroupConversation()&&(u.data.conversation_id=u.conversation.conversationId.replace("19:","")),u.data.conversation_members_number=s+1,u.data.send_timestamp=u.activityItem.timestamp().getTime(),u.data.message_type=u.getMessageType(u.activityItem.type()),u.data.send_context="chat_view",u.wasLiked&&(u.data.message_type="Heart_"+u.data.message_type.toLowerCase()),u.data.translation_action=u.getPresence(l),l&&(u.data.translation_value=u.getTranslationValue()),u.data.swx_messageLength=a,u.data.swx_isRemove=a===0,u.data.swx_isEdit=!!u.skypeeditedid&&!u.data.swx_isRemove,u.data.swx_participantsCountGroup=o.getParticipantCountGroup(s),u.data.swx_responseCode=e,u.data.swx_isError=o.isError(e),u.data.swx_tts=t,u.data.swx_ttsGroup=o.getSecondsDurationGroupFromMs(t),u.data.swx_isFavorite=!!u.conversation._isFavorited&&u.conversation._isFavorited(),u.data.swx_conversationOrigin=u.getConversationOrigin(u.conversation),n.get()._telemetryManager.sendEvent(r.settings.telemetry.jSkypeTenantToken,i,u.data)},this.conversation=e,this.activityItem=t,this.skypeeditedid=i,this.contentLength=s,this.postStart=this.getCurrentTime()}return e.prototype.getPresence=function(e){return e?p.PRESENT:p.NOT_PRESENT},e.prototype.getTts=function(){return this.getCurrentTime()-this.postStart},e.prototype.getCurrentTime=function(){var e=u.getWindow().Date;return(new e).getTime()},e.prototype.getTranslationValue=function(){var e=this.conversation._translatorSettings;return e&&e.isEnabled?e.meLanguage.code+"-"+e.participantLanguage.code:this.activityItem.translations()[0].key},e.prototype.getConversationOrigin=function(e){return s.conversation.isGuestHostConversation(e.conversationId)?l.GUEST_HOST:l.NORMAL},e.prototype.getMessageType=function(e){switch(e){case h.TextMessage:return"Text";case h.PictureMessage:return"Photo";case h.VideoMessage:return"Video_message";case h.FileTransfer:return"File";case h.ContactInfoMessage:return"Contact";case h.MojiMessage:return"Moji";case h.PollMessage:return"Poll";default:return c}},e.prototype.getContentLength=function(){return this.contentLength||this.contentLength===0?this.contentLength:this.activityItem.type()!==h.TextMessage?c:this.activityItem.html().length},e}();t.MessageSent=d,t.build=v,t.presenceType=p}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/annotations/main",["require","exports","swx-jskype-internal-application-instance","../../../lib/services/serviceAccessLayer/decorations/reporting","../../../lib/modelHelpers/personsAndGroupsHelper","../../../lib/services/webapi/main","../../../lib/telemetry/messageSent","swx-xhr-dispatcher","jskype-settings-instance","swx-chat-service/lib/constants","swx-utils-chat","swx-mri","jcafe-property-model","swx-constants","lodash-compat"],e)}(function(e,t){function g(e,t){var r=e(t.key),s=n.get().personsAndGroupsManager.mePerson;r||(r={key:t.key,users:t.users||[]});var o=d.some(r.users,function(e){return i.isMePerson(e.mri)});o||(e.empty(),r.users.push({mri:s.id(),person:s,time:(new Date).getTime(),value:t.value}),e.add(r,r.key))}function y(e,t){var n=e(t.key);if(!n)return;e.empty(),d.remove(n.users,function(e){return i.isMePerson(e.mri)}),e.add(n,n.key)}function b(e,t,n){if(n!==v.EMOTIONS)return undefined;var r=o.build(t,e);return r.heartEvent(),r}function w(e,t,n,r,i,s){function a(e){y(n,i),o.reject(e);if(u){var t=e?e.status:m;u.publish(t)}}function f(e){o.resolve();if(u){var t=e?e.response.status:m;u.publish(t)}}var o=h.task(),u=b(e,t,r);return g(n,i),s||S().setMessageProperty(t.conversationId,e,r,i,f,a),o.promise}function E(e,t,n,r,i,s){function a(e){g(n,i),o.reject(e);if(u){var t=e?e.status:m;u.publish(t)}}function f(e){o.resolve();if(u){var t=e?e.response.status:m;u.publish(t)}}var o=h.task(),u=b(e,t,r);return y(n,i),s||S().removeMessageProperty(t.conversationId,e,r,i.key,f,a),o.promise}function S(){var e=u.build({host:a.settings.webApiServiceHost,decorations:[r]});return s.getInstance(e)}function x(e,t,n){var r="_"+t+"Array";return e[r]?e[r](n):null}function T(e){var t=JSON.parse(e);for(var n in t)t.hasOwnProperty(n)&&(t[n]=l.messageSanitizer.unescapeHTML(l.messageSanitizer.getMessageSanitizedContent(t[n])));return t}var n=e("swx-jskype-internal-application-instance"),r=e("../../../lib/services/serviceAccessLayer/decorations/reporting"),i=e("../../../lib/modelHelpers/personsAndGroupsHelper"),s=e("../../../lib/services/webapi/main"),o=e("../../../lib/telemetry/messageSent"),u=e("swx-xhr-dispatcher"),a=e("jskype-settings-instance"),f=e("swx-chat-service/lib/constants"),l=e("swx-utils-chat"),c=e("swx-mri"),h=e("jcafe-property-model"),p=e("swx-constants"),d=e("lodash-compat"),v=f.MESSAGE_PROPERTIES.PER_USER,m=p.COMMON.telemetry.NOT_AVAILABLE,N=function(){function e(){this.parseMessageProperties=function(e,t){if(!t.properties)return;var r=n.get().personsAndGroupsManager.mePerson;d.forEach(e._supportedAnnotations,function(n){var s=t.properties[n],o=e["_"+n+"Array"];if(s&&n===v.ACTIVITY_DATA){e._activityData._set(T(s));return}d.forEach(s,function(e){var t=o(e.key);t||(t={key:e.key,users:[]},o.add(t,e.key)),e.users.forEach(function(e){var n=c.getId(e.mri);i.isMePerson(n)?e.person=r:(e.person=i.getPersonById(n),e.person||(e.person=i.createDefaultPerson(n))),e.value&&(e.value=l.messageSanitizer.getMessageSanitizedContent(l.messageSanitizer.unescapeHTML(e.value)));var s=d.some(t.users,function(e,t){return t.mri===e.mri});s||t.users.push(e)})})})},this.updateMessageProperties=function(e,t){d.forEach(e._supportedAnnotations,function(n){if(n===v.ACTIVITY_DATA&&e["_"+n]){e._activityData._set(t._activityData());return}var r="_"+n+"Array";if(!e[r])return;e[r].empty(),t[r]&&d.forEach(t[r](),function(t){e[r].add(t,t.key)})})},this.decorateEmotions=function(e,t){if(e.emotions)return;var n=!0;e._supportedAnnotations.push(v.EMOTIONS),e._emotionsArray=h.collection(),e.emotions=e._emotionsArray.asWritable({add:h.command(w.bind(null,e,t,e._emotionsArray,v.EMOTIONS,n),h.boolProperty(!0)),remove:h.command(E.bind(null,e,t,e._emotionsArray,v.EMOTIONS,n),h.boolProperty(!0))})},this.decorateSms=function(e,t,n){if(n!=="RichText/Sms")return;if(e.smsdeliveryreports)return;e._supportedAnnotations.push(v.SMS_REPORT),e._smsdeliveryreportsArray=h.collection(),e.smsdeliveryreports=e._smsdeliveryreportsArray.asWritable({add:h.command(w.bind(null,e,t,e._smsdeliveryreportsArray,v.SMS_REPORT),h.boolProperty(!0)),remove:h.command(E.bind(null,e,t,e._smsdeliveryreportsArray,v.SMS_REPORT),h.boolProperty(!0))})},this.decorateTranslations=function(e,t){if(t.isGroupConversation())return;if(e.translations)return;e._supportedAnnotations.push(v.TRANSLATIONS),e._translationsArray=h.collection(),e.translations=e._translationsArray.asWritable({add:h.command(w.bind(null,e,t,e._translationsArray,v.TRANSLATIONS),h.boolProperty(!0)),remove:h.command(E.bind(null,e,t,e._translationsArray,v.TRANSLATIONS),h.boolProperty(!0))})},this.decorateActivityData=function(e){if(e._activityData)return;e._supportedAnnotations.push(v.ACTIVITY_DATA),e._activityData=h.property({readOnly:!0})},this.decoratePoll=function(e,t){if(!t.isGroupConversation())return;if(e.poll)return;e._supportedAnnotations.push(v.POLL),e._pollArray=h.collection(),e.poll=e._pollArray.asWritable({add:h.command(w.bind(null,e,t,e._pollArray,v.POLL),h.boolProperty(!0)),remove:h.command(E.bind(null,e,t,e._pollArray,v.POLL),h.boolProperty(!0))})},this.isMessagePropertyUnseen=function(e,t,n,r){var s=!1;if(e.sender&&!i.isMePerson(e.sender.id()))return s;var o=x(e,t,n);return o?(d.forEach(o.users,function(e){e.time>r&&!i.isMePerson(e.mri)&&(s=!0)}),s):s},this.getMessagePropertyLastTimestamp=function(e,t,n){var r=x(e,t,n);return r?(r.users.sort(function(e,t){return e.time-t.time}),r.users[r.users.length-1].time):null},this.getLastPersonFromProperty=function(e,t,n){var r=x(e,t,n);return r?(r.users.sort(function(e,t){return e.time-t.time}),r.users[r.users.length-1].person):null}}return e}(),C=new N;t.__esModule=!0,t["default"]=C});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/conversationActivityItem",["require","exports","jcafe-property-model","swx-utils-chat","swx-encoder","swx-enums","../../lib/services/asyncMedia/main","swx-i18n","swx-utils-chat","../../lib/services/annotations/main","swx-jskype-internal-application-instance","swx-constants","jskype-settings-instance"],e)})(function(e,t){function p(e){var t=u.localization.fetch({key:"message_text_removed",params:{date:a.dateTime.formatDate(e),time:a.dateTime.formatTimestampShort(e)}});return'<span class="deleted">'+t+"</span>"}function d(e,t,n){t.chatService._editMessage(n,e).then(function(){var n=t.historyService.activityItems(e.key());n.status._set(s.activityStatus.Succeeded)},function(){var n=t.historyService.activityItems(e.key());n.status._set(s.activityStatus.Failed)}),e.status._set(s.activityStatus.Pending);if(n.length===0)return e.isDeleted._set(!0),p(t.lastModificationTimestamp());if(e.type()===s.activityType.TextMessage){var i=e,o=r.messageSanitizer.quotesPresentInXML(i.getOriginalContent());if(o!=="")return r.messageSanitizer.quotesPresentInHTML(i.html())+n.replace(o,"")}return n}var n=e("jcafe-property-model"),r=e("swx-utils-chat"),i=e("swx-encoder"),s=e("swx-enums"),o=e("../../lib/services/asyncMedia/main"),u=e("swx-i18n"),a=e("swx-utils-chat"),f=e("../../lib/services/annotations/main"),l=e("swx-jskype-internal-application-instance"),c=e("swx-constants"),h=e("jskype-settings-instance"),v=function(){function e(){this._supportedAnnotations=[],this.key=n.property({readOnly:!0}),this.type=n.property({readOnly:!0}),this.timestamp=n.property({readOnly:!0}),this.status=n.property({readOnly:!0}),this.reason=n.property({readOnly:!0}),this.isRead=n.property({readOnly:!0,value:!0})}return e}();t.ConversationActivityItem=v;var m=function(e){function t(){var t=e!==null&&e.apply(this,arguments)||this;return t.author=null,t.persons=n.collection(),t.context=n.property({readOnly:!0}),t}return __extends(t,e),t}(v);t.ParticipantActivityItem=m;var g=function(e){function t(){var t=e!==null&&e.apply(this,arguments)||this;return t.direction=n.property({readOnly:!0}),t.duration=n.property({readOnly:!0}),t}return __extends(t,e),t}(v);t.CallingActivityItem=g;var y=function(e){function t(){var t=e!==null&&e.apply(this,arguments)||this;return t.direction=n.property({readOnly:!0}),t.isGroup=n.property({readOnly:!0}),t.participantName=n.property({readOnly:!0}),t.participantEndpoint=n.property({readOnly:!0}),t}return __extends(t,e),t}(v);t.PstnActivityItem=y;var b=function(e){function t(){var t=e!==null&&e.apply(this,arguments)||this;return t.participantNames=n.collection(),t}return __extends(t,e),t}(v);t.NgcUpgradeActivityItem=b;var w=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return __extends(t,e),t}(v);t.PluginFreeActivityItem=w;var E=function(e){function t(t,s){var o=e.call(this)||this;o.setHtmlCommandProperty=n.boolProperty(!1),o.setHtmlCommand=n.command(o.htmlSet.bind(o),o.setHtmlCommandProperty),o.direction=n.property({readOnly:!0}),o.sender=null,o.isEdited=n.property({readOnly:!0}),o.isDeleted=n.property({readOnly:!0}),o.html=n.property({set:o.setHtmlCommand}),o._isSMS=n.property({value:!1}),o._smsInfo=n.property({value:null}),o._htmlSetEnabled=o.setHtmlCommandProperty,o.text=function(){var e=r.messageSanitizer.unwebify(o.html());return i.build(l).getNodeTextContent(e)},o.getOriginalContent=function(){return o._originalContent},o._isOriginal=function(){return!o.isEdited()&&!o.isDeleted()},o._updateAllProperties=function(e){o._id=e._id,o._actualId=e._actualId,o.key._set(e.key()),o.type._set(e.type()),o.timestamp._set(e.timestamp()),o.status._set(e.status()),o.reason._set(e.reason()),o.isRead._set(e.isRead()),o.direction._set(e.direction()),o.sender=e.sender,o.isEdited._set(e.isEdited()),o.isDeleted._set(e.isDeleted()),o.html._set(e.html()),o._htmlSetEnabled(e._htmlSetEnabled()),f["default"].updateMessageProperties(o,e)};if(!t)throw new Error("Text message activity item requires conversation");return o.conversation=t,f["default"].decorateSms(o,t,s),f["default"].decorateTranslations(o,t),f["default"].decorateActivityData(o),f["default"].decorateEmotions(o,t),o.isDeleted.once(!0,function(){o.setHtmlCommandProperty(!1)}),o}return __extends(t,e),t.prototype.htmlSet=function(e){return this._skypeemoteoffset&&!!e&&(e=this.html().substr(0,this._skypeemoteoffset)+e),d(this,this.conversation,e)},t}(v);t.TextMessageActivityItem=E;var S=function(e){function t(t){var r=e.call(this)||this;r.setHtmlCommandProperty=n.boolProperty(!1),r.setHtmlCommand=n.command(r.htmlSet.bind(r),r.setHtmlCommandProperty),r.direction=n.property({readOnly:!0}),r.duration=n.property({readOnly:!0}),r.sender=null,r.thumbnailPath=n.property({readOnly:!0}),r.thumbnailProgress=n.property({readOnly:!0}),r.mediaUrl=n.property({readOnly:!0}),r.mediaUrlProgress=n.property({readOnly:!0}),r.html=n.property({set:r.setHtmlCommand}),r.isDeleted=n.property({readOnly:!0,value:!1}),r.documentId=n.property({readOnly:!0}),r._uri=null,r._htmlSetEnabled=r.setHtmlCommandProperty,r.isExpired=n.property({readOnly:!0,get:function(){return r.videoStatusTask||(r.videoStatusTask=n.task(),o.get().getVideoStatus(r._uri).then(function(){r.videoStatusTask.resolve(!1)},function(){r.videoStatusTask.resolve(!0)})),r.videoStatusTask.promise}}),r._isOriginal=function(){return!r.isDeleted()},r._updateAllProperties=function(e){f["default"].updateMessageProperties(r,e),r.isDeleted._set(e.isDeleted()),r.html._set(e.html()),r._htmlSetEnabled(e._htmlSetEnabled())};if(!t)throw new Error("Video message activity item requires conversation");return r.conversation=t,r.type._set(s.activityType.VideoMessage),f["default"].decorateEmotions(r,t),r}return __extends(t,e),t.prototype.htmlSet=function(e){return e.length===0&&o.get().deleteFile(this.documentId()),d(this,this.conversation,e)},t}(v);t.VideoMessageActivityItem=S;var x=function(e){function t(t){var r=e.call(this)||this;r.setHtmlCommandProperty=n.boolProperty(!1),r.setHtmlCommand=n.command(r.htmlSet.bind(r),r.setHtmlCommandProperty),r.direction=n.property({readOnly:!0}),r.duration=n.property({readOnly:!0}),r.sender=null,r.mediaUrl=n.property({readOnly:!0}),r.mediaUrlProgress=n.property({readOnly:!0}),r.html=n.property({set:r.setHtmlCommand}),r.isDeleted=n.property({readOnly:!0,value:!1}),r.documentId=n.property({readOnly:!0}),r._uri=null,r._htmlSetEnabled=r.setHtmlCommandProperty,r.isExpired=n.property({readOnly:!0,get:function(){return r.audioStatusTask||(r.audioStatusTask=n.task(),o.get().getAudioStatus(r._uri).then(function(){r.audioStatusTask.resolve(!1)},function(){r.audioStatusTask.resolve(!0)})),r.audioStatusTask.promise}}),r._isOriginal=function(){return!r.isDeleted()},r._updateAllProperties=function(e){f["default"].updateMessageProperties(r,e),r.isDeleted._set(e.isDeleted()),r.html._set(e.html()),r._htmlSetEnabled(e._htmlSetEnabled())};if(!t)throw new Error("Audio message activity item requires conversation");return r.conversation=t,r.type._set(s.activityType.AudioMessage),r}return __extends(t,e),t.prototype.htmlSet=function(e){return e.length===0&&o.get().deleteFile(this.documentId()),d(this,this.conversation,e)},t}(v);t.AudioMessageActivityItem=x;var T=function(e){function t(t){var r=e.call(this)||this;r.setHtmlCommandProperty=n.boolProperty(!1),r.setHtmlCommand=n.command(r.htmlSet.bind(r),r.setHtmlCommandProperty),r.direction=n.property({readOnly:!0}),r.sender=null,r.contacts=n.collection(),r.html=n.property({set:r.setHtmlCommand}),r.isDeleted=n.property({readOnly:!0,value:!1}),r._htmlSetEnabled=r.setHtmlCommandProperty,r._isOriginal=function(){return!r.isDeleted()},r._updateAllProperties=function(e){r._id=e._id,r._actualId=e._actualId,r.status._set(e.status()),r.isDeleted._set(e.isDeleted()),r.html._set(e.html()),r._htmlSetEnabled(e._htmlSetEnabled()),f["default"].updateMessageProperties(r,e)};if(!t)throw new Error("ContactInfo message activity item requires conversation");return r.conversation=t,r.type._set(s.activityType.ContactInfoMessage),r}return __extends(t,e),t.prototype.htmlSet=function(e){return d(this,this.conversation,e)},t}(v);t.ContactInfoMessageActivityItem=T;var N=function(e){function t(t){var r=e.call(this)||this;r.setHtmlCommandProperty=n.boolProperty(!1),r.setHtmlCommand=n.command(r.htmlSet.bind(r),r.setHtmlCommandProperty),r.direction=n.property({readOnly:!0}),r.sender=null,r.progress=n.property({value:0}),r.shouldAbort=n.boolProperty(!1),r.html=n.property({set:r.setHtmlCommand}),r.isDeleted=n.property({readOnly:!0,value:!1}),r.documentId=n.property({readOnly:!0}),r._uri=null,r._htmlSetEnabled=r.setHtmlCommandProperty,r.thumbnailUrl=n.property({readOnly:!0,get:function(){if(!r._uri)return;return r.thumbnailStatusTask||(r.thumbnailStatusTask=n.task(),o.get().getThumbnailStatus(r._uri).then(r.thumbnailStatusTask.resolve.bind(r.thumbnailStatusTask),r.thumbnailStatusTask.reject.bind(r.thumbnailStatusTask))),r.thumbnailStatusTask.promise}}),r.pictureUrl=n.property({readOnly:!0,get:function(){if(!r._uri)return;return r.pictureStatusTask||(r.pictureStatusTask=n.task(),o.get().getPictureStatus(r._uri).then(r.pictureStatusTask.resolve.bind(r.pictureStatusTask),r.pictureStatusTask.reject.bind(r.pictureStatusTask))),r.pictureStatusTask.promise}}),r._isOriginal=function(){return!r.isDeleted()},r._updateAllProperties=function(e){r._id=e._id,r._actualId=e._actualId,r.status._set(e.status()),r._uri=e._uri,r.pictureUrl.get(),f["default"].updateMessageProperties(r,e)};if(!t)throw new Error("Picture message activity item requires conversation");return r.conversation=t,r.type._set(s.activityType.PictureMessage),f["default"].decorateEmotions(r,t),r}return __extends(t,e),t.prototype.htmlSet=function(e){return e.length===0&&this.conversation.fileTransferService.remove(this.documentId()),d(this,this.conversation,e)},t}(v);t.PictureMessageActivityItem=N;var C=function(e){function t(t){var r=e.call(this)||this;r.setHtmlCommandProperty=n.boolProperty(!1),r.setHtmlCommand=n.command(r.htmlSet.bind(r),r.setHtmlCommandProperty),r.direction=n.property({readOnly:!0}),r.sender=null,r.fileName=null,r.fileType=null,r.fileUri=n.property({readOnly:!0}),r.fileThumbnailUri=n.property({readOnly:!0}),r.fileSize=null,r.progress=n.property({value:0}),r.shouldAbort=n.boolProperty(!1),r.html=n.property({set:r.setHtmlCommand}),r.isDeleted=n.property({readOnly:!0,value:!1}),r.documentId=n.property({readOnly:!0}),r._htmlSetEnabled=r.setHtmlCommandProperty,r._isOriginal=function(){return!r.isDeleted()},r._updateAllProperties=function(e){f["default"].updateMessageProperties(r,e),r._id=e._id,r._actualId=e._actualId,r.isDeleted._set(e.isDeleted()),r.html._set(e.html()),r._htmlSetEnabled(e._htmlSetEnabled())};if(!t)throw new Error("File transfer message activity item requires conversation");return r.conversation=t,r.type._set(s.activityType.FileTransfer),f["default"].decorateEmotions(r,t),r}return __extends(t,e),t.prototype.htmlSet=function(e){return e.length===0&&this.conversation.fileTransferService.remove(this.documentId()),d(this,this.conversation,e)},t}(v);t.FileTransferActivityItem=C;var k=function(e){function t(){var t=e.call(this)||this;return t.greeting=n.property({readOnly:!0}),t.sender=null,t.direction=n.property({readOnly:!0,value:s.direction.Incoming}),t.isRead._set(!1),t.isRead.once(!0,function(){t.sender!==null&&t.direction()===s.direction.Incoming&&t.sendContactRequestReadEvent()}),t}return __extends(t,e),t.prototype.sendContactRequestReadEvent=function(){var e={name:c.COMMON.telemetry.contacts.name.CONTACT_REQUEST_READ,user_from:[this.sender.id(),window.skypeTelemetryManager.PIIType.Identity]};l.get()._telemetryManager.sendEvent(h.settings.telemetry.jSkypeTenantToken,c.COMMON.telemetry.contacts.type.CONTACT_REQUESTS,e)},t}(v);t.ContactRequestActivityItem=k;var L=function(e){function t(t){var r=e.call(this)||this;r.setHtmlCommandProperty=n.boolProperty(!1),r.setHtmlCommand=n.command(r.htmlSet.bind(r),r.setHtmlCommandProperty),r.direction=n.property({readOnly:!0}),r.thumbnailUrl=n.property({readOnly:!0}),r.mojiUrl=n.property({readOnly:!0}),r.sender=null,r.html=n.property({set:r.setHtmlCommand}),r.isDeleted=n.property({readOnly:!0,value:!1}),r._htmlSetEnabled=r.setHtmlCommandProperty,r._isOriginal=function(){return!r.isDeleted()},r._updateAllProperties=function(e){r._id=e._id,r._actualId=e._actualId,f["default"].updateMessageProperties(r,e)};if(!t)throw new Error("Moji message activity item requires conversation");return r.conversation=t,f["default"].decorateEmotions(r,t),r}return __extends(t,e),t.prototype.htmlSet=function(e){return d(this,this.conversation,e)},t}(v);t.MojiMessageActivityItem=L;var A=function(e){function t(t){var r=e.call(this)||this;r.setHtmlCommandProperty=n.boolProperty(!1),r.setHtmlCommand=n.command(r.htmlSet.bind(r),r.setHtmlCommandProperty),r.conversationId=n.property({readOnly:!0}),r.xmmType=n.property({readOnly:!0}),r.direction=n.property({readOnly:!0}),r.sender=null,r.isEdited=n.property({readOnly:!0}),r.html=n.property({set:r.setHtmlCommand}),r.pollQuestion=n.property({readOnly:!0}),r.pollAnswers=n.collection(),r.highestNumberOfVotes=n.property({readOnly:!0}),r.peopleVotedNum=n.property({readOnly:!0}),r.meCheckedAnswerPositions=n.collection(),r.meVoted=n.property({readOnly:!0}),r.multipleVotes=n.boolProperty(!1),r.isDeleted=n.property({readOnly:!0,value:!1}),r._htmlSetEnabled=r.setHtmlCommandProperty,r._isOriginal=function(){return!r.isEdited()&&!r.isDeleted()},r._updateAllProperties=function(e){r._id=e._id,r._actualId=e._actualId,r.key._set(e.key()),r.type._set(e.type()),r.timestamp._set(e.timestamp()),r.status._set(e.status()),r.reason._set(e.reason()),r.isRead._set(e.isRead()),r.direction._set(e.direction()),r.sender=e.sender,r.isEdited._set(e.isEdited()),r.isDeleted._set(e.isDeleted()),r.html._set(e.html()),r._htmlSetEnabled(e._htmlSetEnabled()),r.conversationId._set(e.conversationId()),r.xmmType._set(e.xmmType()),r.pollQuestion._set(e.pollQuestion()),r.pollAnswers(e.pollAnswers()),r.highestNumberOfVotes._set(e.highestNumberOfVotes()),r.peopleVotedNum._set(e.peopleVotedNum()),r.meCheckedAnswerPositions(e.meCheckedAnswerPositions()),r.meVoted._set(e.meVoted()),r.multipleVotes._set(e.multipleVotes()),f["default"].updateMessageProperties(r,e)},r.addAnswer=function(e){var t=r.pollAnswers().indexOf(e);if(t===-1)return;r.meCheckedAnswerPositions.add(t),r.poll.add({key:"pollAnswer",value:JSON.stringify(r.meCheckedAnswerPositions())}),r.meVoted._set(!0)};if(!t)throw new Error("Poll message activity item requires conversation");return r.conversation=t,f["default"].decorateEmotions(r,t),f["default"].decoratePoll(r,t),r}return __extends(t,e),t.prototype.htmlSet=function(e){return d(this,this.conversation,e)},t}(v);t.PollMessageActivityItem=A;var O=function(e){function t(t){var r=e.call(this)||this;r.sender=null,r.direction=n.property({readOnly:!0}),r.orderId=null,r.transactionStatus=n.property({readOnly:!0,value:s.transactionStatus.Pending}),r.amount=null,r.currency=null,r.personalization=null,r._isOriginal=function(){return!0},r._updateAllProperties=function(e){r._id=e._id,r._actualId=e._actualId,f["default"].updateMessageProperties(r,e)};if(!t)throw new Error("Transaction message activity item requires conversation");return r.conversation=t,r.isRead._set(!1),f["default"].decorateEmotions(r,t),r}return __extends(t,e),t}(v);t.TransactionMessageActivityItem=O}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/telemetry/poll",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","swx-constants"],e)}(function(e,t){function s(e){var t=u(e,i.COMMON.telemetry.poll.activityType.SEND);n.get()._telemetryManager.sendEvent(r.settings.telemetry.jSkypeTenantToken,i.COMMON.telemetry.poll.eventName.ACTIVITY,t),e.pollAnswers().forEach(function(t){var s={};s[i.COMMON.telemetry.poll.property.CONVERSATION_ID]=e.conversationId(),s[i.COMMON.telemetry.poll.property.ANSWER_LENGTH]=t.answerText.length,n.get()._telemetryManager.sendEvent(r.settings.telemetry.jSkypeTenantToken,i.COMMON.telemetry.poll.eventName.ANSWER_LENGTH,s)})}function o(e,t,s,o){var u={};u[i.COMMON.telemetry.poll.property.CONVERSATION_ID]=e,t&&(u[i.COMMON.telemetry.poll.property.MESSAGE_ID]=t),u[i.COMMON.telemetry.poll.property.XMM_TYPE]=s,u[i.COMMON.telemetry.poll.property.ERROR_TYPE]=o,n.get()._telemetryManager.sendEvent(r.settings.telemetry.jSkypeTenantToken,i.COMMON.telemetry.poll.eventName.ERROR,u)}function u(e,t){var n={};return n[i.COMMON.telemetry.poll.property.CONVERSATION_ID]=e.conversationId(),n[i.COMMON.telemetry.poll.property.MESSAGE_ID]=e.key(),n[i.COMMON.telemetry.poll.property.ACTIVITY_TYPE]=t,n[i.COMMON.telemetry.poll.property.XMM_TYPE]=e.xmmType(),n[i.COMMON.telemetry.poll.property.QUESTION_LENGTH]=e.pollQuestion().length,n[i.COMMON.telemetry.poll.property.ANSWERS_COUNT]=e.pollAnswers().length,n[i.COMMON.telemetry.poll.property.MULTI_VOTE]=e.multipleVotes(),n[i.COMMON.telemetry.poll.property.TIME_SINCE_CREATION]=(new Date).getTime()-e.timestamp(),n}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("swx-constants");t.sendPoll=s,t.error=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/utils/chat/smsMessageBuilder",["require","exports","lodash-compat","swx-utils-common","jcafe-property-model","swx-enums"],e)}(function(e,t){function o(e){switch(e){case 3:case 4:case 5:return s.smsStatus.Sending;case 1:case 2:case 6:return s.smsStatus.Delivered;case 8:case 7:case 9:case 16:return s.smsStatus.Error;default:return s.smsStatus.Error}}function u(e){switch(e){case 8:case 7:case 9:case 16:return!1;default:return!0}}function a(e,t){var n=e;return t.forEach(function(e){e.users.sort(function(e,t){return e.time-t.time}),n=JSON.parse(e.users[e.users.length-1].value).status}),n}function f(e,t){return e?t?e.getAttribute(t):e.textContent:""}function l(e,t,n){var r=e.querySelector(t);return f(r,n)}function c(e,t,n){var r=e.querySelectorAll(t);return[].slice.call(r).map(function(e){return f(e,n)})}function h(e,t){var n=u(t)?s.activityStatus.Succeeded:s.activityStatus.Failed;e.status._set(n)}function p(e,t){function S(){return u(w())}function x(){E&&E.dispose()}var n=new DOMParser,r=n.parseFromString(e,"application/xml"),s=Number(l(r,"status")),f=l(r,"sms","alt"),p=c(r,"target"),d=l(r,"price"),v=l(r,"requestId"),m=i.boolProperty(!0),g=i.command(o.bind(this),m),y=i.property({set:g}),b=i.command(a.bind(this,s),m),w=i.property({set:b});w(t.smsdeliveryreports()),y(w()),h(t,w());var E=t.smsdeliveryreports.observe(function(e){var n=e;if(!Array.isArray(e)){var r=e[v];if(!r)return;n=[{key:r.key,users:r.users}]}w(n),y(w()),h(t,w())}),T={content:f,targets:p,price:d,requestId:v,status:y,isSuccessful:S,dispose:x};return T}function g(e,t){var n=[];for(var r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=function(e){return e+'="'+v(String(t[e]))+'"'},s=t?[""].concat(Object.keys(t).map(i)).join(" "):"",o=function(e){return e instanceof d?e.toString():m(e)};return new d("<"+e+s+">"+n.map(o).join("")+"</"+e+">")}function y(e){function c(){var e=_.sum(i);if(e<=160){u=1;return}u=1;var t=153,n=0,r=0;while(n<i.length)r+i[n]<=t?(r+=i[n],n+=1):(u+=1,r=0)}function h(){var e=r.length;if(e<=70)u=1;else{var t=67;u=Math.floor(e/t)+(e%t?1:0)}}var t=e,n=!0,r=new Array,i=new Array,s=0,o=t.length,u,a=-1,f=[a,a,a,a,a,a,a,a,a," ",10,a,-10,13,a,a,16,a,18,19,20,21,22,23,24,25,26,a,a,a,a,a," ","!",'"',"#",2,"%","&","'","(",")","*","+",",","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";","<","=",">","?",0,"A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",-60,-47,-62,-20,17,a,"a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z",-40,-64,-41,-61,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a," ",64,a,1,36,3,a,95,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,96,a,a,a,a,91,14,28,9,a,31,a,a,a,a,a,a,a,93,a,a,a,a,92,a,11,a,a,a,94,a,a,30,127,a,a,a,123,15,29,a,4,5,a,a,7,a,a,a,a,125,8,a,a,a,124,a,12,6,a,a,126,a,a,a],l=function(){for(var e=s;e<o;e++){var u=t.charCodeAt(e);if(!u)return;r.push(u);if(u>256){n=!1;continue}f[u]===a?n=!1:f[u]<-1?i.push(2):i.push(1)}};return l(),n?c():h(),u}function b(e,t){var n=t||[],i=[e],s=[e],o=String(g("sms",{alt:e},g("type",null,String(2)),g("status",null,String(4)),g("failurereason",null,String(0)),g.apply(void 0,["targets",null].concat(n.map(function(e){return g("target",{status:3},e)}))),g.apply(void 0,["body",null].concat(i.map(function(e,t){return g("chunk",{id:t},e)}),[g("untilnext",null,"155")])),g("encoded_body",null,e),g("sendtimestamp",null,(new Date).getTime()+""),g("restApiVersion",null,"2"),g("defaults",null,g("skype",null,g("deliveryReportVersion",null,"chatservice")),g("control",null,g("flowId",null,"skype.client.sms.1way"),g("deliveryMethod",null,"reliable")),g("content",null,g("body",null,e))),g.apply(void 0,["bulkItems",null].concat(s.map(function(e,t){return g("bulkItem",null,g("requestId",null,r.guid.create()),g("recipient",null,g("address",null,n[0])))})))));return o}var n=e("lodash-compat"),r=e("swx-utils-common"),i=e("jcafe-property-model"),s=e("swx-enums");t.getInfo=p;var d=function(){function e(e){this.content=e}return e.prototype.toString=function(){return this.content},e}(),v=n.escape,m=n.escape;t.calculateSmsFragments=y,t.createOutgoingXMLPayload=b}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/utils/chat/messageTypes",["require","exports","lodash-compat","swx-i18n","swx-encoder","swx-enums","swx-constants","swx-jskype-internal-application-instance","../../../lib/models/conversationActivityItem","swx-mri","swx-mri/lib/mriMaps","../../../lib/modelHelpers/personsAndGroupsHelper","jskype-settings-instance","../../../lib/services/annotations/main","../../../lib/telemetry/poll","../../../lib/utils/chat/parser","../../../lib/utils/chat/message","swx-utils-chat","./smsMessageBuilder","swx-utils-chat/lib/dateTime","swx-utils-chat/lib/urlValidator"],e)}(function(e,t){function x(e){return at.hasOwnProperty(e)?at[e]:at.Unknown}function T(e,t){try{return e(t)}catch(n){var r=t.content.match(/<URIObject[^>]*?\stype=\"([^"]+?)\"/i);return r&&r[1]&&r[1].split(".")[0].toLowerCase()==="poll"&&d.error(t.conversationModel.conversationId,t.key,r[1],o.COMMON.telemetry.poll.errorType.PARSING),O(t)}}function N(e){var t=r.localization.fetch({key:"message_text_removed",params:{date:b.formatDate(e),time:b.formatTimestampShort(e)}});return'<span class="deleted">'+t+"</span>"}function C(){var e=r.localization.fetch({key:"message_text_removed",params:{date:"[^<>&]*",time:"[^<>&]*"}}),t='(?:<|&lt;)span class="deleted"(?:>|&gt;)'+e+"(?:<|&lt;)/span(?:>|&gt;)";return t}function k(){var e=new RegExp("^"+C()+"$");return e}function L(e){var t=/<target>(\d+:[^<]+)<\/target>/,n=e.match(t);return n?n[1]:undefined}function A(e){var t=/<value>(.+)<\/value>/,n=e.match(t);return n?n[1]:undefined}function O(e){return e.content=r.localization.fetch({key:"message_text_parsing_error"}),q(e)}function M(e){return e.content=r.localization.fetch({key:"message_text_pollsFeatureDisabled"}),q(e)}function _(e){return null}function D(e){var t=i.build(u).decode(e),n=g.messageSanitizer.removeMetaData(t);return n.length===0?!0:k().test(n)}function P(e){function i(){e.content===""&&!n.isUndefined(t)&&t!==""&&(e.content=g.messageSanitizer.processOutgoingTextMessage(t))}var t=e.originalContent||e.content,r=e.skypeemoteoffset&&D(t.substr(e.skypeemoteoffset));return!e._processed&&!D(t)&&!r&&(e.content=g.messageSanitizer.getMessageSanitizedContent(t),i()),q(e)}function H(e){if(e._processed||D(e.content))return q(e);var t=function(e){var t=/cardId=\"(\S+?)\">(.+?)<\/URIObject>/,n=e.match(t);return n&&n.length>2&&n[2]},n=t(e.content);return n&&(e.content=g.messageSanitizer.getMessageSanitizedContent(n)),P(e)}function B(e){if(e._processed||D(e.content))return q(e);var t=function(e){var t=/<Currency(.+?)\/>(.+?)<\/URIObject>/,n=e.match(t);return n&&n.length>2&&n[2]},n=t(e.content);return n&&(e.content=g.messageSanitizer.getMessageSanitizedContent(n)),P(e)}function j(e){var t=f.getId(g.messageSanitizer.escapeIncomingHTML(e));return c.getPerson(t,f.getTypeFromKey(e))}function F(e){var t;if(e._proccessed)return;e.content=g.messageSanitizer.removeMetaData(e.content),t=e.content,e.skypeemoteoffset&&(t=t.substr(e.skypeemoteoffset));if(t.length===0||k().test(e.content))e.isDeleted=!0,e.content=N((new Date(parseInt(e.timestamp))).getTime());e._proccessed=!0}function I(e,t){F(t),e.html._set(t.content),!t.isMyself||e._htmlSetEnabled(!0),e.isDeleted._set(!!t.isDeleted),e.isEdited._set(!!t.skypeeditedid&&!t.isDeleted)}function q(e){var t=j(e.author),n=new a.TextMessageActivityItem(e.conversationModel,e.messagetype);return n._id=e.id,n.sender=t,I(n,e),n.type._set(s.activityType.TextMessage),n.direction._set(e.isMyself?s.direction.Outgoing:s.direction.Incoming),e.skypeemoteoffset&&h.isFeatureOn(o.COMMON.featureFlags.ME_COMMAND_ENABLED)&&(n._skypeemoteoffset=e.skypeemoteoffset),p["default"].parseMessageProperties(n,e),n}function R(e){var t=j(e.author),n=new a.ContactInfoMessageActivityItem(e.conversationModel);n._id=e.id,n.sender=t,n.direction._set(e.isMyself?s.direction.Outgoing:s.direction.Incoming);var r=Z(e);return r.forEach(function(e,t){n.contacts.add(e,t)}),e.isMyself&&n._htmlSetEnabled.set(!0),n}function U(e){var t=new a.ParticipantActivityItem;return t._id=e.id,t.type._set(e.activityType),t.author=e.author,t.persons(e.persons),t.context._set(e.context),t}function z(e){var t=new a.NgcUpgradeActivityItem,n=e.content.match(/<systemMessage[^>]*?\susers=\"([^"]+?)\"/i),r=n&&n[1]?n[1].split("##~~"):[];return t._id=e.id,t.type._set(s.activityType.NgcUpgradeMessage),r.forEach(function(e){t.participantNames.add(g.messageSanitizer.escapeIncomingHTML(e.trim()))}),t}function W(e,t){if(!w.validate(t,h.settings.URLSanitizer.securedResources))return _(e);var n=t.match(/.+\/(.+?)\/?$/),r=new a.PictureMessageActivityItem(e.conversationModel);return r._id=e.id,r.isRead._set(!1),r.direction._set(e.isMyself?s.direction.Outgoing:s.direction.Incoming),r.sender=j(e.author),r._uri=t,r.documentId._set(n?n[1]:""),e.isMyself&&r._htmlSetEnabled.set(!0),p["default"].parseMessageProperties(r,e),r}function X(e){var t=j(e.author),r=u.get().personsAndGroupsManager.mePerson,i=new a.PollMessageActivityItem(e.conversationModel),o=(new DOMParser).parseFromString(e.content,"text/xml"),f=o.documentElement.getAttribute("type"),l=o.documentElement.getElementsByTagName("Question")[0].getAttribute("value"),c=o.documentElement.getElementsByTagName("MultipleChoice"),h=c.length?c[0].getAttribute("value")==="true":!1,d=0,v=0,m=[],y=n.map(o.documentElement.getElementsByTagName("Answer"),function(e){return{answerText:g.messageSanitizer.escapeIncomingHTML(g.messageSanitizer.unwebify(e.getAttribute("value"))),barWidth:0,votes:0,users:[]}});p["default"].parseMessageProperties(i,e),i._id=e.id,i.sender=t,i.conversationId._set(e.conversationModel.conversationId),F(e),!e.isMyself||i._htmlSetEnabled.set(!0),i.isDeleted._set(!!e.isDeleted),i.isEdited._set(!!e.skypeeditedid&&!e.isDeleted),i.type._set(s.activityType.PollMessage),i.direction._set(e.isMyself?s.direction.Outgoing:s.direction.Incoming);if(i.poll){var b=n.find(i.poll(),function(e){return e.key==="pollAnswer"});b&&b.users&&(b.users.forEach(function(e){var t=e.value?JSON.parse(e.value):[],n={};v++,n.person=e.person,e.person?n.displayName=e.person.displayName():n.displayName=e.mri,t.forEach(function(e){var t=y[e];t.votes=t.votes+1,t.users.push(n),d<t.votes&&(d=t.votes)}),e.person===r&&(m=t)}),b.users.forEach(function(e){var t=JSON.parse(e.value);t.forEach(function(e){var t=y[e];t.barWidth=Math.round(t.votes/d*100)})}))}return i.xmmType._set(f),i.pollQuestion._set(g.messageSanitizer.escapeIncomingHTML(g.messageSanitizer.unwebify(l))),i.highestNumberOfVotes._set(d),i.pollAnswers(y),i.peopleVotedNum._set(v),i.meCheckedAnswerPositions(m),i.meVoted._set(!n.isEmpty(m)),i.multipleVotes._set(h),i}function V(e,t,n){var r=t.match(/.+\/(.+?)\/?$/);n._id=e.id,n._uri=t,n.isRead._set(!1),n.direction._set(e.isMyself?s.direction.Outgoing:s.direction.Incoming),n.sender=j(e.author),n.documentId._set(r?r[1]:""),e.isMyself&&n._htmlSetEnabled.set(!0),p["default"].parseMessageProperties(n,e)}function $(e,t){var n=h.isFeatureOn(o.COMMON.featureFlags.IS_CLOUD_VIDEO_MESSAGE_ENABLED);if(!n||!w.validate(t,h.settings.URLSanitizer.securedResources))return _(e);var r=new a.VideoMessageActivityItem(e.conversationModel);return r.thumbnailPath._set(t+"/views/thumbnail"),r.mediaUrl._set(t+"/views/video"),V(e,t,r),r}function J(e,t){var n=h.isFeatureOn(o.COMMON.featureFlags.IS_CLOUD_AUDIO_MESSAGE_ENABLED);if(!n||!w.validate(t,h.settings.URLSanitizer.securedResources))return _(e);var r=new a.AudioMessageActivityItem(e.conversationModel);return r.mediaUrl._set(t+"/views/audio"),V(e,t,r),r}function K(e,t){function d(e){if(!e)return"unknown";var t=e.split(".");return t.length<2?"unknown":t.pop().toLowerCase()}var n=j(e.author),r=new a.FileTransferActivityItem(e.conversationModel),i=t.match(/.+\/(.+?)\/?$/),o=e.content.match(/<OriginalName[\s]+[^<]*v=\"([\s\S]*?)\"[^<]/),u=e.content.match(/<URIObject[\s\S]*url_thumbnail=\"([\S]*?)\"/i),f=e.content.match(/<FileSize[\s]+[^<]*v=\"([\d]*?)\"[^<]/i),l=e.content.match(/uri=\"https:[s\S]*v1\/objects\/([\s\S]*?)(\"|\/)/),c=o?o[1]:"";return r.isRead._set(!1),r.direction._set(e.isMyself?s.direction.Outgoing:s.direction.Incoming),r.sender=n,r.fileName=c,r.fileType=d(c),r.fileThumbnailUri._set(u?u[1]:""),r.fileUri._set(i?h.settings.amdServiceHost+"/v1/objects/"+i[1]+"/views/original":""),r.fileSize=f?f[1]:0,r.documentId._set(l?l[1]:""),e.isMyself&&r._htmlSetEnabled.set(!0),p["default"].parseMessageProperties(r,e),r}function Q(e){var t=new a.TransactionMessageActivityItem(e.conversationModel);t.sender=j(e.author),t.type._set(s.activityType.CreditTransaction),t.direction._set(e.isMyself?s.direction.Outgoing:s.direction.Incoming);var n=e.content.match(/<Order[^>]*?\svalue=\"([^"]+?)\"/i);return t.orderId=n&&g.messageSanitizer.escapeIncomingHTML(n[1]),n=e.content.match(/<Personalization[^>]*?\svalue=\"([^"]+?)\"/i),t.personalization=n&&g.messageSanitizer.escapeIncomingHTML(n[1]),n=e.content.match(/<Amount[^>]*?\svalue=\"([^"]+?)\"/i),t.amount=n&&parseFloat(g.messageSanitizer.escapeIncomingHTML(n[1])),n=e.content.match(/<Currency[^>]*?\svalue=\"([^"]+?)\"/i),t.currency=n&&g.messageSanitizer.escapeIncomingHTML(n[1]),p["default"].parseMessageProperties(t,e),t}function G(e){var t=e.content.match(/<sms alt=\"([^"]+?)\">/);return t?g.messageSanitizer.escapeIncomingHTML(t[1]):g.messageSanitizer.processOutgoingTextMessage(e.content)}function Y(){var e=r.localization.fetch({key:"message_text_fileTransferNotSupported"});return'<div class="icon-error"></div>'+e}function Z(e){function r(e){var t=/(<c t=\"([^"]+?)\"( p=\"([^"]+?)\")?( s=\"([^"]+?)\")?( f=\"([^"]+?)\")?\/>)/,n,r,i,s=e.match(t);s[2]==="s"?(n=g.messageSanitizer.escapeIncomingHTML(s[6]),r=s[8]?g.messageSanitizer.escapeIncomingHTML(s[8]):n,i=l.contactMriTypes.skype):(s[4]=g.messageSanitizer.escapeIncomingHTML(s[4]),n=r=s[4],i=l.contactMriTypes.pstn);var o=c.getPerson(n,i);return o.displayName._set(r),o}function i(){var e=[];for(var t=0;t<n.length;t++)e.push(r(n[t]));return e}var t=/(<c t=\"([^"]+?)\"( p=\"([^"]+?)\")?( s=\"([^"]+?)\")?( f=\"([^"]+?)\")?\/>)/g,n=e.content.match(t);return n?i():null}function et(e){var t=e.content.match(/<URIObject[^>]*?\suri=\"([^"]+?)\"/i);return t?{url:t[1]}:null}function tt(e){var t=h.isFeatureOn(o.COMMON.featureFlags.IS_FLIK_MESSAGE_ENABLED);if(D(e.content))return P(e);if(!t)return _(e);var n=new a.MojiMessageActivityItem(e.conversationModel),r=j(e.author),i=et(e);if(!i)return _(e);var u=i.url;if(!w.validate(u,h.settings.URLSanitizer.securedResources))return _(e);var f=u+"/views/default",l=u+"/views/thumbnail";return n._id=e.id,n.isRead._set(!1),n.direction._set(e.isMyself?s.direction.Outgoing:s.direction.Incoming),n.type._set(s.activityType.MojiMessage),n.sender=r,n.thumbnailUrl._set(l),n.mojiUrl._set(f),e.isMyself&&n._htmlSetEnabled.set(!0),p["default"].parseMessageProperties(n,e),n}function nt(e){return decodeURIComponent(Array.prototype.map.call(atob(e),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}function rt(e){var t=e.content.match(/<URIObject[^>]*?\stype=\"([^"]+?)\"/i),i=e.content.match(/<Title>(.*)<\/Title>/i),s=e.content.match(/<Swift b64="([^"]+)"\s*\/>/i);if(!t||!s)return _(e);t=t[1].split(".")[0],i?i=i[1]:i=r.localization.fetch({key:"message_text_swift_defaultTitle",params:{mesageType:e.messagetype}});if(t.trim().toLowerCase()!=="swift")return it(e);var o=n.clone(e);try{return o.content='<SwiftCard Swift="'+encodeURIComponent(nt(s[1]))+'">'+g.messageSanitizer.stripHTML(i)+"</SwiftCard>",q(o)}catch(u){return _(e)}}function it(e){var t=e.content.match(/<URIObject[^>]*?\suri=\"([^"]+?)\"/i),n=e.content.match(/<URIObject[^>]*?\stype=\"([^"]+?)\"/i),r=e.content.match(/<meta[^>]*?\stype=\"([^"]+?)\"/i);if(!t)return P(e);t=t[1];if(!n)return r&&r[1]==="photo"?W(e,t):_(e);n=n[1].split(".")[0];var i=E[n]||_;return i(e,t)}function st(e){var t=Z(e),n="";return t&&t.forEach(function(e){n+=r.localization.fetch({key:"message_text_contactItem",params:{fullName:e.displayName(),name:e.id()}})}),n}function ot(e){var t,n=e.content.match(/<URIObject[^>]*?\stype=\"([^"]+?)\"/i),r=n&&n[1]&&n[1].split(".")[0].toLowerCase();if(!(t=S[r]))return!1;var i=h.isFeatureOn(t.flagName);return i?t.onHandler:t.offHandler}function ut(e){var t=e.content.match(/<systemMessage[^>]*?\stype=\"([^"]+?)\"/i);return t&&t[1]==="ngcUpgradeMessage"?z:undefined}var n=e("lodash-compat"),r=e("swx-i18n"),i=e("swx-encoder"),s=e("swx-enums"),o=e("swx-constants"),u=e("swx-jskype-internal-application-instance"),a=e("../../../lib/models/conversationActivityItem"),f=e("swx-mri"),l=e("swx-mri/lib/mriMaps"),c=e("../../../lib/modelHelpers/personsAndGroupsHelper"),h=e("jskype-settings-instance"),p=e("../../../lib/services/annotations/main"),d=e("../../../lib/telemetry/poll"),v=e("../../../lib/utils/chat/parser"),m=e("../../../lib/utils/chat/message"),g=e("swx-utils-chat"),y=e("./smsMessageBuilder"),b=e("swx-utils-chat/lib/dateTime"),w=e("swx-utils-chat/lib/urlValidator"),E={Picture:W,Audio:J,Video:$,File:K},S={credit:{onHandler:Q,offHandler:B,flagName:o.COMMON.featureFlags.CREDIT_GIFTING},poll:{onHandler:X,offHandler:M,flagName:o.COMMON.featureFlags.POLLS_ENABLED}};t.fetch=x,t.parse=T,t._isDeletedMessage=D;var at={Unknown:_,Text:P,RichText:function(e){var t=ot(e)||ut(e);return t?t(e):P(e)},"RichText/Contacts":function(e){if(!e._proccessed&&!D(e.content)){var t=h.isFeatureOn(o.COMMON.featureFlags.CONTACT_CARD_RENDERING_ENABLED);if(t)return R(e);e.content=r.localization.fetch({key:"message_text_sentContacts",params:{contacts:st(e)}})}return q(e)},"RichText/Files":function(e){return e._proccessed||(e.content=Y()),q(e)},"RichText/Sms":function(e){e._proccessed||(e.content=G(e));var t=q(e);return t._isSMS(!0),t._smsInfo(y.getInfo(e.originalContent,t)),t},"RichText/Location":function(e){var t=e.content.match(/<a[^>]+href="https:\/\/www.bing.com\/maps([^"]+)"[^>]*>([^<]*)/);return t?(e._proccessed||(e.content='<a href="'+h.settings.locationHost+t[1]+'" target="_blank">'+g.messageSanitizer.escapeIncomingHTML(t[2])+"</a>"),q(e)):_(e)},"RichText/UriObject":it,"RichText/Media_GenericFile":function(e){return!e._proccessed&&!D(e.content)?it(e):q(e)},"RichText/Money":H,"RichText/Media_Video":it,"RichText/Media_AudioMsg":it,"RichText/Media_FlikMsg":tt,"RichText/Media_Card":rt,"Event/SkypeVideoMessage":function(e){return e.content=r.localization.fetch({key:"message_text_unsupportedVideoMessageYet"}),q(e)},"Event/SkypeAudioMessage":function(e){return e.content=r.localization.fetch({key:"message_text_unsupportedAudioMessageYet"}),q(e)},"ThreadActivity/AddMember":function(e){var t={},n=m.getInitiator(e.content),r=m.getTargets(e.content),i=function(e){var t=e.map(function(e){return j(e)});return t};return t.activityType=s.activityType.ParticipantJoined,t.author=j(n),t.persons=i(r),U(t)},"ThreadActivity/DeleteMember":function(e){var t={},n=m.getInitiator(e.content),r=L(e.content),i=v.getConversationIdFromUrl(e.conversationLink);return t.activityType=s.activityType.ParticipantLeft,t.author=j(n),t.persons=r===n?[]:[j(r)],t.context=i.replace(/^\d+:/,""),U(t)},"ThreadActivity/RoleUpdate":function(e){var t=m.getInitiator(e.content),n=/<target><id>(\d+:.+)<\/id><role>(.+)<\/role><\/target>/,r=e.content.match(n),i={};return i.activityType=s.activityType.ParticipantRoleUpdate,i.author=j(t),i.persons=[j(r[1])],i.context=g.messageSanitizer.escapeIncomingHTML(r[2]),U(i)},"ThreadActivity/TopicUpdate":function(e){var t=m.getInitiator(e.content),n=/(?:<value>(.+)<\/value>|<value \/>)/,r=e.content.match(n),o=i.build(u),a={};return a.activityType=s.activityType.ParticipantTopicUpdate,a.author=j(t),a.persons=[],a.context=g.messageSanitizer.escapeIncomingHTML(o.decode(g.messageSanitizer.unescapeHTML(r[1]||""))),U(a)},"ThreadActivity/PictureUpdate":function(e){var t=m.getInitiator(e.content),n={};return n.activityType=s.activityType.ParticipantPictureUpdate,n.author=j(t),n.persons=[],U(n)},"ThreadActivity/HistoryDisclosedUpdate":function(e){var t=m.getInitiator(e.content),n=A(e.content).toLowerCase(),r={};return r.activityType=s.activityType.ParticipantHistoryDisclosed,r.author=j(t),r.persons=[],r.context=n!=="false",U(r)},"ThreadActivity/JoiningEnabledUpdate":function(e){var t=m.getInitiator(e.content),n=A(e.content).toLowerCase(),r={};return r.activityType=s.activityType.ParticipantJoiningEnabled,r.author=j(t),r.persons=[],r.context=n!=="false",U(r)},"ThreadActivity/LegacyMemberAdded":function(e){var t=L(e.content),n={};return n.activityType=s.activityType.ParticipantLegacyMemberAdded,n.author=j(t),n.persons=[],U(n)},"ThreadActivity/LegacyMemberUpgraded":function(e){var t=L(e.content),n={};return n.activityType=s.activityType.ParticipantLegacyMemberUpgraded,n.author=j(t),n.persons=[],U(n)},"Event/Call":function(e){var t=e.content.replace(/\r?\n/g,""),n=f.getId(e.myself),r=new RegExp('<part identity="'+n+'">.*?<duration>(\\d+)</duration>\\s*?</part>',"g"),i=t.match(r.source),o=/<partlist type="started" alt="">(.*)<\/partlist>/.test(t),u=/<partlist alt="">\s*<\/partlist>/.test(t),l=/<partlist type="ended" alt="">(.*)<\/partlist>/.test(t),c=0,h=s.activityType.CallMissed;o||u?h=s.activityType.CallStarted:i?(c=parseInt(i[1],10),h=s.activityType.CallEnded):l&&e.isMyself&&(h=s.activityType.CallEnded);var p=new a.CallingActivityItem;return p.duration._set(c),p.isRead._set(!1),p.type._set(h),p.direction._set(e.isMyself?s.direction.Outgoing:s.direction.Incoming),p}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/utils/chat/generator",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","swx-constants","../../../lib/models/conversationActivityItem","swx-utils-chat","swx-enums","swx-i18n","../../../lib/utils/chat/messageTypes","../../../lib/utils/chat/parser","../../../lib/utils/chat/message","swx-mri","../../../lib/modelHelpers/personsAndGroupsHelper","lodash-compat"],e)}(function(e,t){function v(e,t){return e.contactRequestType?C(e,t):e.pstnEventType?_(e):e.pluginFreeMessageType?M(e):N(e,t)}function m(e){var t={content:e.content,messagetype:e.messagetype,properties:e.properties,contenttype:"text","Has-Mentions":P(e.content),imdisplayname:n.get().personsAndGroupsManager.mePerson.displayName()};return e.skypeeditedid?t.skypeeditedid=String(e.skypeeditedid):t.clientmessageid=String(e.key),e.skypeemoteoffset&&(t.skypeemoteoffset=e.skypeemoteoffset),t}function g(e,t){e.messagetype=e.messageType||"RichText",e.content=D(e.content);var r=f.fetch(e.messagetype),i=n.get().personsAndGroupsManager.mePerson,s=new Date;e.isMyself=!0,e.conversationModel=t,e.author=h.getKey(i.id(),i._type());var o=f.parse(r,e);return o._id=s.getTime(),o._actualId=o._id,o.key._set(String(s.getTime())),o.timestamp._set(s),o._htmlSetEnabled(!0),o.isRead._set(!0),o.status._set(u.activityStatus.Pending),o._originalContent=""+(e.originalContent||e.content),o}function y(e){var t=f.fetch(e.messagetype),r=f.parse(t,e);return r._id=e.timestamp,r._actualId=e.timestamp,r.isRead._set(!0),r._htmlSetEnabled(!0),r.sender=n.get().personsAndGroupsManager.mePerson,r.direction._set(u.direction.Outgoing),r.status._set(u.activityStatus.Pending),r.key._set(e.key),r.timestamp._set(new Date(e.timestamp)),r}function b(e,t){var r=new s.MojiMessageActivityItem(t.conversationModel),i=e+"/views/default",o=e+"/views/thumbnail";return r._id=t.timestamp,r._actualId=r._id,r._htmlSetEnabled(!0),r.direction._set(u.direction.Outgoing),r.type._set(u.activityType.MojiMessage),r.sender=n.get().personsAndGroupsManager.mePerson,r.thumbnailUrl._set(o),r.mojiUrl._set(i),r.key._set(t.key),r.timestamp._set(new Date(t.timestamp)),r.isRead._set(!0),r.status._set(u.activityStatus.Pending),r.html._set(t.content),r}function w(e,t){var r=new s.ContactInfoMessageActivityItem(t),i=o.dateTime.getDate();return r._htmlSetEnabled(!0),r.sender=n.get().personsAndGroupsManager.mePerson,r.direction._set(u.direction.Outgoing),r.status._set(u.activityStatus.Pending),r.key._set(String(i.getTime())),r.contacts(e),r.timestamp._set(i),r}function E(e){var t=new s.PictureMessageActivityItem(e);return t._htmlSetEnabled(!0),t.sender=n.get().personsAndGroupsManager.mePerson,t.direction._set(u.direction.Outgoing),t.status._set(u.activityStatus.Pending),t.key._set(String((new Date).getTime())),t.timestamp._set(o.dateTime.getDate()),t}function S(e,t){function i(e){if(!e)return"unknown";var t=e.split(".");return t.length<2?"unknown":t.pop().toLowerCase()}var r=new s.FileTransferActivityItem(t);return r._htmlSetEnabled(!0),r.fileName=e.name,r.fileType=i(e.name),r.sender=n.get().personsAndGroupsManager.mePerson,r.direction._set(u.direction.Outgoing),r.status._set(u.activityStatus.Pending),r.key._set(String((new Date).getTime())),r.fileSize=e.size?e.size:0,r.timestamp._set(o.dateTime.getDate()),r}function x(e,t){var r=n.get().personsAndGroupsManager.mePerson;e.myself=h.getKey(r.id(),r._type()),e.author=l.parseName(e.from),e.isMyself=T(e,t),e.originalContent||(e.originalContent=e.content===undefined?"":""+d.unescape(e.content)),e.conversationModel=t}function T(e,t){var n=new RegExp("^4:"),r=n.test(t.conversationId);return r||e.author===e.myself}function N(e,t){var n=""+(e.originalContent||e.content);x(e,t);var r=f.fetch(e.messagetype),i=f.parse(r,e),s=c.allDependenciesAllowSuccessStatus(i)?u.activityStatus.Succeeded:u.activityStatus.Failed;return i?(i._id=e.id,i._actualId=e.id,i.key._set(e.key||e.clientmessageid),i.timestamp._set(new Date(e.originalarrivaltime)),i.isRead._set(c.canMessageBeMarkedAsUnreadInUI(e)?!e.isUnread:!0),i.status._set(s),i._originalContent=n,i._isFromPolling=e._isFromPolling,i):null}function C(e,t){return k(e)?A(e,t):L(e)}function k(e){var t=r.isFeatureOn(i.COMMON.featureFlags.INVITE_FREE_IMPLICIT_INCOMING_CONTACT_REQUEST);return t&&(e.contactRequestType===u.activityType.ContactRequestIncoming||e.contactRequestType===u.activityType.ContactRequestIncomingInviteFree)}function L(e){var t=new s.ContactRequestActivityItem;return t.sender=p.getPerson(e.personId),t._id=e.id,t._actualId=e.id,t.key._set(e.id),t.type._set(e.contactRequestType),t.timestamp._set(new Date(e.timestamp)),t.greeting._set(e.greeting),t.isRead._set(e.isOutgoing),t}function A(e,t){return e.contactRequestType===u.activityType.ContactRequestIncoming?O(e,t):e.contactRequestType===u.activityType.ContactRequestIncomingInviteFree?L(e):undefined}function O(e,t){var r=p.getPerson(e.personId),i=n.get().personsAndGroupsManager.mePerson,o=new s.TextMessageActivityItem(t),f=a.localization.fetch({key:"message_text_contactRequestGreeting",params:{displayName:i.displayName()}});return o._id=e.id,o._actualId=e.id,o.key._set(e.id),o.sender=r,o.timestamp._set(new Date(e.timestamp)),o.html._set(e.greeting||f),o.type._set(u.activityType.TextMessage),o.isRead._set(!1),o}function M(e){var t=new s.PluginFreeActivityItem;return t.type._set(e.pluginFreeMessageType),t.timestamp._set(e.timestamp),t.key._set(e.id),t}function _(e){var t=new s.PstnActivityItem;return t.type._set(e.pstnEventType),t.timestamp._set(e.timestamp),t.key._set(e.id),t.isGroup._set(e.isGroup),t.participantName._set(e.participantName),t.participantEndpoint._set(e.participantEndpoint),t}function D(e){var t=/href="((?:https?:\/\/|mailto:)[^"]+)"/gi,n=e.match(t)||[];return n.forEach(function(t){e=e.replace(t,t.replace("&amp;","&"))}),e}function P(e){var t=/<at id="(.*?)">.*?<\/at>/g;return t.test(e).toString().toLowerCase()}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("swx-constants"),s=e("../../../lib/models/conversationActivityItem"),o=e("swx-utils-chat"),u=e("swx-enums"),a=e("swx-i18n"),f=e("../../../lib/utils/chat/messageTypes"),l=e("../../../lib/utils/chat/parser"),c=e("../../../lib/utils/chat/message"),h=e("swx-mri"),p=e("../../../lib/modelHelpers/personsAndGroupsHelper"),d=e("lodash-compat");t.activityFromRawMessage=v,t.messageForService=m,t.outgoingTextMessageActivityItem=g,t.outgoingPollMessageActivityItem=y,t.outgoingMojiActivityItem=b,t.outgoingContactInfoActivityItem=w,t.outgoingPictureActivityItem=E,t.outgoingFileActivityItem=S,t.extendRawMessage=x}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/telemetry/systemCommand",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","swx-constants"],e)}(function(e,t){function s(){return{argument:i.COMMON.telemetry.NOT_AVAILABLE,isAvailable:i.COMMON.telemetry.NOT_AVAILABLE,isExisting:i.COMMON.telemetry.NOT_AVAILABLE,isGroup:i.COMMON.telemetry.NOT_AVAILABLE,isAdmin:i.COMMON.telemetry.NOT_AVAILABLE,name:i.COMMON.telemetry.NOT_AVAILABLE,isSuccess:i.COMMON.telemetry.NOT_AVAILABLE}}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("swx-constants"),o=function(){function e(){this.data=s()}return e.prototype.publish=function(){n.get()._telemetryManager.sendEvent(r.settings.telemetry.jSkypeTenantToken,i.COMMON.telemetry.chat.SYSTEM_COMMAND,this.data),this.reset()},e.prototype.reset=function(){this.data=s()},e}();t.__esModule=!0,t["default"]=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commandsHelper",["require","exports","swx-enums","../../../lib/utils/chat/generator","swx-utils-chat"],e)}(function(e,t){function s(e,t){var s=i.messageSanitizer.processOutgoingTextMessage(t,e),o=r.outgoingTextMessageActivityItem({content:s},e);o.status._set(n.activityStatus.Succeeded),o.type._set(n.activityType.SystemMessage),e.historyService._addOutgoingMessage(o)}function o(){return!0}function u(){return!1}function a(e){return!e.isGroupConversation()}function f(e){return e.isGroupConversation()}function l(e){return e.isGroupConversation()&&!e.selfParticipant.isAnonymous()}function c(e){return e.isGroupConversation()&&e.selfParticipant.role()===n.participantRole.Leader}var n=e("swx-enums"),r=e("../../../lib/utils/chat/generator"),i=e("swx-utils-chat");t.sendSystemMessage=s,t.availableAlways=o,t.availableNever=u,t.availableForOneToOne=a,t.availableForAllGroupMembers=f,t.availableForNonAnonymousGroupMembers=l,t.availableForGroupLeaders=c}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/topic",["require","exports","../../../../lib/services/systemCommands/commandsHelper","lodash-compat"],e)}(function(e,t){function s(){return new i}var n=e("../../../../lib/services/systemCommands/commandsHelper"),r=e("lodash-compat"),i=function(){function e(){this.isAvailableFor=n.availableForAllGroupMembers,this.help="[text]",this.showInHelp=!0,this.action=function(e,t,n){n.data.isSuccess=!1;if(r.isEmpty(r.trim(t))){n.publish();return}e.topic.set.enabled()&&(e.topic.set(t)["catch"](function(e){}),n.data.isSuccess=!0),n.publish()}}return e}();t.Topic=i,t.build=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/add",["require","exports","swx-jskype-internal-application-instance","../../../../lib/services/systemCommands/commandsHelper","../../../../lib/modelHelpers/personsAndGroupsHelper","swx-utils-chat","swx-pubsub-instance","swx-constants","swx-i18n"],e)}(function(e,t){function f(e){var t=n.get().conversationsManager,r=s.conversation.createConversation(e,t,!0);o["default"].publish(u.COMMON.events.navigation.OPEN_CONVERSATION,{model:r,origin:u.COMMON.telemetry.historyLoadOrigin.CONVERSATION_TO_THREAD})}function c(){return new l}var n=e("swx-jskype-internal-application-instance"),r=e("../../../../lib/services/systemCommands/commandsHelper"),i=e("../../../../lib/modelHelpers/personsAndGroupsHelper"),s=e("swx-utils-chat"),o=e("swx-pubsub-instance"),u=e("swx-constants"),a=e("swx-i18n"),l=function(){function e(){this.help="[skypename]",this.showInHelp=!0,this.isAvailableFor=function(e){return r.availableForOneToOne(e)||r.availableForNonAnonymousGroupMembers(e)},this.action=function(e,t,n){function l(){return!s.isAgent()||s.isAgent()&&typeof s.capabilities._groupChat=="function"&&s.capabilities._groupChat()}var s=i.getPersonById(t);if(!s||!l()){n.data.isSuccess=!1,n.publish(),r.sendSystemMessage(e,a.localization.fetch({key:"message_text_joinConversationFailed",params:{participant:t}}));return}if(!e.isGroupConversation()){var o=[s,e.participants(0).person];f(o),n.data.isSuccess=!0}else if(e.participants.add.enabled()){var u=e.createParticipant(s);e.participants.add(u)["catch"](function(e){}),n.data.isSuccess=!0}n.data.isSuccess!==!0&&(n.data.isSuccess=!1),n.publish()}}return e}();t.Add=l,t.build=c}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/kick",["require","exports","../../../../lib/services/systemCommands/commandsHelper","swx-utils-chat"],e)}(function(e,t){function s(){return new i}var n=e("../../../../lib/services/systemCommands/commandsHelper"),r=e("swx-utils-chat"),i=function(){function e(){this.isAvailableFor=n.availableForGroupLeaders,this.help="[skypename]",this.showInHelp=!0,this.action=function(e,t,n){t[0]==="@"&&(t=t.substring(1));var i=r.conversation.getParticipantFromConversation(e,t);n.data.isSuccess=!1;if(!i){n.publish();return}e.participants.remove.enabled()&&(e.participants.remove(i)["catch"](function(e){}),n.data.isSuccess=!0),n.publish()}}return e}();t.Kick=i,t.build=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/leave",["require","exports","../../../../lib/services/systemCommands/commandsHelper"],e)}(function(e,t){function i(){return new r}var n=e("../../../../lib/services/systemCommands/commandsHelper"),r=function(){function e(){this.isAvailableFor=n.availableForAllGroupMembers,this.showInHelp=!0,this.action=function(e,t,n){n.data.isSuccess=!1,e.leave.enabled()&&(e.leave()["catch"](function(e){}),n.data.isSuccess=!0),n.publish()}}return e}();t.Leave=r,t.build=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/telemetry/logging/callingLogTracer",["require","exports","swx-log-tracer"],e)}(function(e,t){function r(){return n.getLogger("Calling")}var n=e("swx-log-tracer");t.get=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/callRegister",["require","exports","../../lib/telemetry/logging/callingLogTracer","../../lib/modelHelpers/propertyModelHelper","jcafe-property-model","swx-enums"],e)}(function(e,t){function l(){return f=f||new a,f}var n=e("../../lib/telemetry/logging/callingLogTracer"),r=e("../../lib/modelHelpers/propertyModelHelper"),i=e("jcafe-property-model"),s=e("swx-enums"),o=n.get(),u=1,a=function(){function e(){var e=this;this.conversationsByCallId={},this.endedCalls={},this.canPlaceCall=i.property({readOnly:!0,value:!0}),this.activeCalls=r.exposeReadOnlyCollection(i.collection()),this.canProcessIncomingCall=function(t){return e.activeCalls(t)?!0:e.activeCalls.size()===0?!0:!1},this.wasCallEnded=function(t){return Boolean(e.endedCalls[e.getCallId(t)])},this.registerCall=function(t){o.log("[CallRegister] Register call",t.conversationId),e.activeCalls._add(t,t.conversationId)},this.unregisterCall=function(t,n){o.log("[CallRegister] Unregister call",t.conversationId),e.endedCalls.hasOwnProperty(n)&&(e.endedCalls[n]=!0),e.activeCalls._remove(t.conversationId),e.conversationsByCallId.hasOwnProperty(n)&&delete e.conversationsByCallId[n]},this.getConversationByCallId=function(t){if(e.conversationsByCallId.hasOwnProperty(t))return e.conversationsByCallId[t]},this.registerCallIdMapping=function(t,n){if(e.hasCallId(n)){var r=e.getCallId(n);return e.conversationsByCallId[r]=t,e.endedCalls.hasOwnProperty(r)||(e.endedCalls[r]=!1),o.log("[CallRegister] New Call Id Registered:",r),!0}return o.log("[CallRegister] Call Id is missing"),!1},this.hasConnectedCall=function(){return e.activeCalls().some(function(e){return e.selfParticipant.audio.state()===s.callConnectionState.Connected})},this.activeCalls.size.changed(function(){e.canPlaceCall._set(e.activeCalls.size()<u)})}return e.prototype.getCallId=function(e){return e.convoCallId||null},e.prototype.hasCallId=function(e){return Boolean(this.getCallId(e))},e}();t.CallRegister=a;var f;t.get=l}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/callInfo",["require","exports","../../../../lib/services/systemCommands/commandsHelper","../../../../lib/telemetry/logging/callingLogTracer","../../../../lib/services/callRegister","jskype-settings-instance","swx-constants"],e)}(function(e,t){function f(){return new a}var n=e("../../../../lib/services/systemCommands/commandsHelper"),r=e("../../../../lib/telemetry/logging/callingLogTracer"),i=e("../../../../lib/services/callRegister"),s=e("jskype-settings-instance"),o=e("swx-constants"),u=r.get(),a=function(){function e(){this.showInHelp=!0,this.isAvailableFor=function(e){return s.isFeatureOn(o.COMMON.featureFlags.CALL_INFO_COMMAND)&&e===i.get().activeCalls()[0]},this.action=function(e,t,r){function i(t){n.sendSystemMessage(e,t),r.data.isSuccess=!0,r.publish()}function s(e){u.log("/callInfo command failed: "+e),r.data.isSuccess=!1,r.publish()}e._callHandler?e._callHandler.requestCallInfo().then(i)["catch"](s):s("no call handler exists")}}return e}();t.CallInfo=a,t.build=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/moji",["require","exports","../../../../lib/services/systemCommands/commandsHelper","lodash-compat"],e)}(function(e,t){function s(){return new i}var n=e("../../../../lib/services/systemCommands/commandsHelper"),r=e("lodash-compat"),i=function(){function e(){this.isAvailableFor=n.availableAlways,this.help="[mojiId]",this.showInHelp=!1,this.action=function(e,t){if(r.isEmpty(r.trim(t)))return;e.chatService._sendMoji.enabled()&&e.chatService._sendMoji(t)["catch"](function(e){})}}return e}();t.Moji=i,t.build=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/serviceAccessLayer/requestDispatcher",["require","exports","swx-xhr-dispatcher","swx-xhr-dispatcher/lib/decorations/retry","./decorations/reporting"],e)}(function(e,t){var n=e("swx-xhr-dispatcher"),r=e("swx-xhr-dispatcher/lib/decorations/retry"),i=e("./decorations/reporting"),s=n.buildDispatcherWithFixedRetry([r,i]);return s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/telemetry/logging/issueReporter",["require","exports","swx-log-tracer","../../services/serviceAccessLayer/requestDispatcher","jskype-settings-instance","lodash-compat"],e)}(function(e,t){function u(e){var t={dataType:"html"};return typeof e!="undefined"?s.merge(t,e):t}function a(e){var t=i.settings.telemetry.issueReportUrl,s,a;return r.put(t+"/session/unprocessed",u({headers:{"X-comment":e.message}})).then(function(e){var o=e.response.split("\n"),f=n.getLogs();return s=o[0],a=o[2],Promise.all([{name:"logs.log",content:f.all},{name:"errors.log",content:f.error},{name:"config.log",content:JSON.stringify(i)}].map(function(e){return r.put(t+"/upload/"+s+"/"+e.name,u({payload:e.content}))}))}).then(function(){return r.put(t+"/session/"+s+"/done",u())}).then(function(){return n.clearLogs(),{id:s,url:a}})["catch"](function(e){throw o.error("failed to report issue: ",e),e})}var n=e("swx-log-tracer"),r=e("../../services/serviceAccessLayer/requestDispatcher"),i=e("jskype-settings-instance"),s=e("lodash-compat"),o=n.getLogger("issueReporter");t.report=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/reportIssue",["require","exports","../../../../lib/services/systemCommands/commandsHelper","jskype-settings-instance","swx-constants","../../../../lib/telemetry/logging/issueReporter","lodash-compat"],e)}(function(e,t){function u(e,t){n.sendSystemMessage(e,"Thank you for reporting the issue. Your issue id is: "+t.id+". Logs have been uploaded to: "+t.url+". If you happened to encounter a calling issue when "+"using Edge browser, make sure to also run the following script to collect media stack logs: "+r.settings.telemetry.issueReportScript)}function a(e){n.sendSystemMessage(e,"Failed to report the issue.")}function l(){return new f}var n=e("../../../../lib/services/systemCommands/commandsHelper"),r=e("jskype-settings-instance"),i=e("swx-constants"),s=e("../../../../lib/telemetry/logging/issueReporter"),o=e("lodash-compat"),f=function(){function e(){var e=this;this.isAvailableFor=r.isFeatureOn(i.COMMON.featureFlags.ISSUE_REPORTING)?n.availableAlways:n.availableNever,this.help="[text]",this.showInHelp=!0,this.action=function(t,n){o.isEmpty(o.trim(n))&&(n="No Message"),s.report({message:n}).then(u.bind(e,t),a.bind(e,t))}}return e}();t.ReportIssue=f,t.build=l}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/showMembers",["require","exports","../../../../lib/services/systemCommands/commandsHelper","swx-enums"],e)}(function(e,t){function s(){return new i}var n=e("../../../../lib/services/systemCommands/commandsHelper"),r=e("swx-enums"),i=function(){function e(){this.isAvailableFor=n.availableForAllGroupMembers,this.showInHelp=!0,this.action=function(e,t,i){var s="CONVERSATION MEMBERS:",o=e.participants().concat(e.selfParticipant);o.forEach(function(e){s+="\n  "+e.person.id()+" "+(e.role()===r.participantRole.Attendee?"SPEAKER":"ADMIN")}),n.sendSystemMessage(e,s),i.data.isSuccess=!0,i.publish()}}return e}();t.ShowMembers=i,t.build=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/swiftCard",["require","exports","../../../../lib/services/systemCommands/commandsHelper","jskype-settings-instance","swx-constants","lodash-compat"],e)}(function(e,t){function u(){return new o}var n=e("../../../../lib/services/systemCommands/commandsHelper"),r=e("jskype-settings-instance"),i=e("swx-constants"),s=e("lodash-compat"),o=function(){function e(){this.isAvailableFor=r.isFeatureOn(i.COMMON.featureFlags.SWIFT_CARD_COMMAND)?n.availableAlways:n.availableNever,this.help="[swift card json]",this.showInHelp=!1,this.action=function(e,t){if(s.isEmpty(s.trim(t)))return;t=t.replace(/<a href[^>]+?>/gi,"").replace(/<\/a>/g,"");if(e.chatService._sendSwiftCard.enabled())try{e.chatService._sendSwiftCard('<SwiftCard Swift="'+encodeURIComponent(JSON.stringify(JSON.parse(t)))+'">Testing SwiftCard</SwiftCard>')["catch"](function(e){})}catch(r){n.sendSystemMessage(e,"There was error processing swift card json.")}}}return e}();t.SwiftCard=o,t.build=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/swiftXmm",["require","exports","lodash-compat","jskype-settings-instance","../../../../lib/services/systemCommands/commandsHelper","swx-constants"],e)}(function(e,t){function u(){return new o}var n=e("lodash-compat"),r=e("jskype-settings-instance"),i=e("../../../../lib/services/systemCommands/commandsHelper"),s=e("swx-constants"),o=function(){function e(){this.isAvailableFor=r.isFeatureOn(s.COMMON.featureFlags.SWIFT_CARD_COMMAND)?i.availableAlways:i.availableNever,this.help="[swift xmm json]",this.showInHelp=!1,this.action=function(e,t){if(n.isEmpty(n.trim(t)))return;t=t.replace(/<a href[^>]+?>/gi,"").replace(/<\/a>/g,"");if(e.chatService._sendSwiftCard.enabled())try{var r='<URIObject type="SWIFT.1"><Title>Testing Action card</Title><Swift b64="'+btoa(JSON.stringify(JSON.parse(t)))+'"/></URIObject>';e.chatService._sendSwiftCard(r,!0)["catch"](function(e){})}catch(s){i.sendSystemMessage(e,"There was error processing swift card json.\n"+s.toString())}}}return e}();t.SwiftXMM=o,t.build=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/giphy",["require","exports","../../../../lib/services/systemCommands/commandsHelper","jskype-settings-instance","swx-constants","swx-log-tracer","reqwest"],e)}(function(e,t){function f(){return new a}var n=e("../../../../lib/services/systemCommands/commandsHelper"),r=e("jskype-settings-instance"),i=e("swx-constants"),s=e("swx-log-tracer"),o=e("reqwest"),u=s.getLogger("CommandGiphy"),a=function(){function e(){this.isAvailableFor=r.isFeatureOn(i.COMMON.featureFlags.GIPHY)?n.availableAlways:n.availableNever,this.help="[expression] - sends random GIF for given expression (optional)",this.showInHelp=!0,this.action=function(e,t,i){i.data.argument=t,o.compat({method:"get",dataType:"json",url:"https://api.giphy.com/v1/gifs/random?api_key="+r.settings.giphy.apiKey+"&rating="+r.settings.giphy.rating+(t?"&tag="+t.replace(/\s+/g,"+"):""),crossOrigin:!0}).then(function(r){if(r&&r.data&&r.data.image_url){t?e.chatService.sendMessage(r.data.image_url,null,{activityData:JSON.stringify({giphyExpression:t})}):e.chatService.sendMessage(r.data.image_url),i.data.isSuccess=!0,i.publish();return}n.sendSystemMessage(e,"No giphies found for *"+t+"*. Try different one."),i.data.isSuccess=!1,i.publish()},function(t){u.error(t),n.sendSystemMessage(e,"Failed to connect to giphy"),i.data.isSuccess=!1,i.publish()})}}return e}();t.Giphy=a,t.build=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/alerts",["require","exports","../../../../lib/services/systemCommands/commandsHelper"],e)}(function(e,t){function o(){return new s}var n=e("../../../../lib/services/systemCommands/commandsHelper"),r=function(){function e(){this.isAvailableFor=n.availableAlways,this.help="",this.showInHelp=!0,this.action=function(e,t,n){e.chatService._updateNotificationSettings(!1),n.data.isSuccess=!0,n.publish()}}return e}();t.Off=r;var i=function(){function e(){this.isAvailableFor=n.availableAlways,this.help="[keywords]",this.showInHelp=!0,this.action=function(e,t,n){e.chatService._updateNotificationSettings(!0,t),n.data.isSuccess=!0,n.publish()}}return e}();t.On=i;var s=function(){function e(){var e=this;this.on=new i,this.off=new r,this.isAvailableFor=n.availableAlways,this.help="off | on [keywords]",this.showInHelp=!0,this.action=function(t,r,i){function s(e){n.sendSystemMessage(t,"Unknown argument, use: /alerts "+e)}i.data.isSuccess=!1;if(!r){s(e.help),i.publish();return}var o=r.match(/^(\w+)\s*([\s\S]+)?/),u=o&&o[1].toLowerCase();if(u==="on"||u==="off"){var a=e;a[u].action(t,o&&o[2],i),i.data.argument=u,i.data.isSuccess=!0}else s(e.help);i.publish()}}return e}();t.Alerts=s,t.off={build:function(){return new r}},t.on={build:function(){return new i}},t.build=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/setRole",["require","exports","lodash-compat","../../../../lib/services/systemCommands/commandsHelper","swx-enums"],e)}(function(e,t){function u(){return new o}var n=e("lodash-compat"),r=e("../../../../lib/services/systemCommands/commandsHelper"),i=e("swx-enums"),s={admin:!0,master:!0,user:!1,speaker:!1},o=function(){function e(){this.isAvailableFor=r.availableForGroupLeaders,this.help="[Skype Name] ADMIN | USER",this.showInHelp=!0,this.action=function(e,t,r){var o=(t||"").split(/\s+/),u=o[0]&&o[0].toLowerCase(),a=o[1]&&o[1].toLowerCase();u[0]==="@"&&(u=u.substring(1)),s.hasOwnProperty(a)&&(r.data.argument=a);var f=n.find(e.participants(),function(e){return e.person.id().toLowerCase()===u});if(!f||!f.role.set.enabled()||!s.hasOwnProperty(a)){r.data.isSuccess=!1,r.publish();return}f.role(s[a]?i.participantRole.Leader:i.participantRole.Attendee),r.data.isSuccess=!0,r.publish()}}return e}();t.SetRole=o,t.build=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/help",["require","exports","../../../../lib/services/systemCommands/commandsHelper","lodash-compat"],e)}(function(e,t){function s(){return new i}var n=e("../../../../lib/services/systemCommands/commandsHelper"),r=e("lodash-compat"),i=function(){function e(){this.isAvailableFor=n.availableAlways,this.showInHelp=!0,this.action=function(e,t,i){var s="Available commands:\n";r.forIn(t,function(t,n){if(t.isAvailableFor(e)&&t.showInHelp)if(r.isFunction(t.help)){var i=t.help(e);i.forEach(function(e){s+="  /"+n+" "+e+"\n"})}else s+="  /"+n,s+=t.help?" "+t.help:"",s+="\n"}),n.sendSystemMessage(e,s),i.data.isSuccess=i.data.name==="help",i.publish()}}return e}();t.Help=i,t.build=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/me",["require","exports","../../../../lib/services/systemCommands/commandsHelper","swx-jskype-internal-application-instance","jskype-settings-instance","swx-constants"],e)}(function(e,t){function u(){return new o}var n=e("../../../../lib/services/systemCommands/commandsHelper"),r=e("swx-jskype-internal-application-instance"),i=e("jskype-settings-instance"),s=e("swx-constants"),o=function(){function e(){this.isAvailableFor=i.isFeatureOn(s.COMMON.featureFlags.ME_COMMAND_ENABLED)?n.availableAlways:n.availableNever,this.help="[message] - sends special message prepended by your name",this.showInHelp=!0,this.action=function(e,t,n){if(!t)return;var i=r.get().personsAndGroupsManager.mePerson.displayName();t=i+" "+t,e.chatService.sendMessage(t,null,{skypeemoteoffset:i.length+1}),n.data.isSuccess=!0,n.publish()}}return e}();t.Me=o,t.build=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/properties/admins",["require","exports","../../../../../lib/services/systemCommands/commandsHelper","swx-enums","lodash-compat"],e)}(function(e,t){function o(){return new s}var n=e("../../../../../lib/services/systemCommands/commandsHelper"),r=e("swx-enums"),i=e("lodash-compat"),s=function(){function e(){this.get={isAvailableFor:n.availableForAllGroupMembers,action:function(e){var t="admins=",s=i.filter(e.participants().concat(e.selfParticipant),function(e){return e.role()===r.participantRole.Leader});s.forEach(function(e){t+=e.person.id()+" "}),n.sendSystemMessage(e,t)}}}return e}();t.Admins=s,t.build=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/properties/role",["require","exports","../../../../../lib/services/systemCommands/commandsHelper","swx-enums"],e)}(function(e,t){function s(){return new i}var n=e("../../../../../lib/services/systemCommands/commandsHelper"),r=e("swx-enums"),i=function(){function e(){this.get={isAvailableFor:n.availableForAllGroupMembers,action:function(e){n.sendSystemMessage(e,"role="+(e.selfParticipant.role()===r.participantRole.Attendee?"SPEAKER":"ADMIN"))}}}return e}();t.Role=i,t.build=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/properties/uri",["require","exports","../../../../../lib/services/systemCommands/commandsHelper"],e)}(function(e,t){function i(){return new r}var n=e("../../../../../lib/services/systemCommands/commandsHelper"),r=function(){function e(){this.get={isAvailableFor:n.availableForAllGroupMembers,action:function(e){e.isJoiningEnabled()?n.sendSystemMessage(e,e.uri()):n.sendSystemMessage(e,"Link-based joining not enabled, to enable: /set options +JOINING_ENABLED")}}}return e}();t.Uri=r,t.build=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/properties/options/joiningEnabled",["require","exports"],e)}(function(e,t){function r(){return new n}var n=function(){function e(){}return e.prototype.isEnabled=function(e){return e.isJoiningEnabled()},e.prototype.enable=function(e){e.isJoiningEnabled.set(!0)["catch"](function(){})},e.prototype.disable=function(e){e.isJoiningEnabled.set(!1)["catch"](function(){})},e}();t.JoiningEnabled=n,t.build=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/properties/options/historyDisclosed",["require","exports"],e)}(function(e,t){function r(){return new n}var n=function(){function e(){}return e.prototype.isEnabled=function(e){return e.historyService.isHistoryDisclosed()},e.prototype.enable=function(e){e.historyService.isHistoryDisclosed.set(!0)["catch"](function(){})},e.prototype.disable=function(e){e.historyService.isHistoryDisclosed.set(!1)["catch"](function(){})},e}();t.HistoryDisclosed=n,t.build=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/properties/options",["require","exports","lodash-compat","../../../../../lib/services/systemCommands/commandsHelper","../../../../../lib/services/systemCommands/commands/properties/options/joiningEnabled","../../../../../lib/services/systemCommands/commands/properties/options/historyDisclosed"],e)}(function(e,t){function a(){return new u}function f(e){o=e}var n=e("lodash-compat"),r=e("../../../../../lib/services/systemCommands/commandsHelper"),i=e("../../../../../lib/services/systemCommands/commands/properties/options/joiningEnabled"),s=e("../../../../../lib/services/systemCommands/commands/properties/options/historyDisclosed"),o={JOINING_ENABLED:i,HISTORY_DISCLOSED:s},u=function(){function e(){var e=this;this.optionCommands={},this.get={isAvailableFor:r.availableForAllGroupMembers,action:function(t){var i="options=";n.forOwn(e.optionCommands,function(e,n){e.isEnabled(t)&&(i+=n+" ")}),r.sendSystemMessage(t,i)}},this.set={isAvailableFor:r.availableForAllGroupMembers,help:function(){return"[[+|-]flag]"},action:function(t,n){var i=n.slice(1).toUpperCase(),s=e.optionCommands[i],o=n[0]==="+";if(!s||!o&&n[0]!=="-"){r.sendSystemMessage(t,"Unknown flag.");return}o?s.enable(t):s.disable(t)}},n.forOwn(o,function(t,n){e.optionCommands[n.toUpperCase()]=t.build()})}return e}();t.Options=u,t.build=a,t._setCommandBuilders=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/commands/property",["require","exports","lodash-compat","../../../../lib/services/systemCommands/commandsHelper","../../../../lib/services/systemCommands/commands/properties/admins","../../../../lib/services/systemCommands/commands/properties/role","../../../../lib/services/systemCommands/commands/properties/uri","../../../../lib/services/systemCommands/commands/properties/options"],e)}(function(e,t){function l(e){a=e}var n=e("lodash-compat"),r=e("../../../../lib/services/systemCommands/commandsHelper"),i=e("../../../../lib/services/systemCommands/commands/properties/admins"),s=e("../../../../lib/services/systemCommands/commands/properties/role"),o=e("../../../../lib/services/systemCommands/commands/properties/uri"),u=e("../../../../lib/services/systemCommands/commands/properties/options"),a={admins:i,role:s,uri:o,options:u},f=function(){function e(e){var t=this;this.commands={},this.showInHelp=!0,this.method=e,n.forOwn(a,function(n,r){var i=n.build();i[e]&&(t.commands[r.toLowerCase()]=i[e])})}return e.prototype.isAvailableFor=function(e){return n(this.commands).values().some(function(t){return t&&t.isAvailableFor(e)})},e.prototype.help=function(e){var t=[];return n.forOwn(this.commands,function(n,r){n&&n.isAvailableFor(e)&&t.push({key:r,command:n})}),t.map(function(e){return e.key+(e.command.help?" "+e.command.help():"")})},e.prototype.action=function(e,t,n){var i=t.match(/^(\w+)\s*(.+)?/),s=i&&i[1]&&i[1].toLowerCase(),o=i&&this.commands[s];n.data.argument=t;if(!o||!o.isAvailableFor(e)){r.sendSystemMessage(e,"Unknown argument: '"+s+"'"),n.data.isSuccess=!1,n.publish();return}o.action(e,i&&i[2]),n.data.isSuccess=!0,n.publish()},e}();t.Property=f,t.get={build:function(){return new f("get")}},t.set={build:function(){return new f("set")}},t._setCommandBuilders=l}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/systemCommands/main",["require","exports","../../../lib/telemetry/systemCommand","../../../lib/services/systemCommands/commands/topic","../../../lib/services/systemCommands/commands/add","../../../lib/services/systemCommands/commands/kick","../../../lib/services/systemCommands/commands/leave","../../../lib/services/systemCommands/commands/callInfo","../../../lib/services/systemCommands/commands/moji","../../../lib/services/systemCommands/commands/reportIssue","../../../lib/services/systemCommands/commands/showMembers","../../../lib/services/systemCommands/commands/swiftCard","../../../lib/services/systemCommands/commands/swiftXmm","../../../lib/services/systemCommands/commands/giphy","../../../lib/services/systemCommands/commands/alerts","../../../lib/services/systemCommands/commands/setRole","../../../lib/services/systemCommands/commands/help","../../../lib/services/systemCommands/commands/me","../../../lib/services/systemCommands/commands/property","../../../lib/services/systemCommands/commands/alerts","lodash-compat","swx-enums"],e)}(function(e,t){function C(){return T=T||new N,T}function k(e){return w.some(S,function(t){return e.indexOf(t)===0})}var n=e("../../../lib/telemetry/systemCommand"),r=e("../../../lib/services/systemCommands/commands/topic"),i=e("../../../lib/services/systemCommands/commands/add"),s=e("../../../lib/services/systemCommands/commands/kick"),o=e("../../../lib/services/systemCommands/commands/leave"),u=e("../../../lib/services/systemCommands/commands/callInfo"),a=e("../../../lib/services/systemCommands/commands/moji"),f=e("../../../lib/services/systemCommands/commands/reportIssue"),l=e("../../../lib/services/systemCommands/commands/showMembers"),c=e("../../../lib/services/systemCommands/commands/swiftCard"),h=e("../../../lib/services/systemCommands/commands/swiftXmm"),p=e("../../../lib/services/systemCommands/commands/giphy"),d=e("../../../lib/services/systemCommands/commands/alerts"),v=e("../../../lib/services/systemCommands/commands/setRole"),m=e("../../../lib/services/systemCommands/commands/help"),g=e("../../../lib/services/systemCommands/commands/me"),y=e("../../../lib/services/systemCommands/commands/property"),b=e("../../../lib/services/systemCommands/commands/alerts"),w=e("lodash-compat"),E=e("swx-enums"),S=["\\o/","\\:D/","\\:d/"],x={topic:r,add:i,kick:s,leave:o,callInfo:u,moji:a,reportIssue:f,showmembers:l,swiftCard:c,swiftXmm:h,get:y.get,set:y.set,giphy:p,alerts:d,alertsoff:b.off,alertson:b.on,setrole:v,help:m,me:g},T,N=function(){function e(){var e=this;this.commands={},this.isSkypeCommand=function(t,r){return!k(t)&&!!e.parseCommand(t,r,new n["default"]).command},this.executeCommand=function(t,r){if(k(t))return!1;var i=new n["default"],s=e.parseCommand(t,r,i),o=s.command,u=s.data;return o?(o===e.commands.help&&(u=e.commands),o.action(r,u,i),!0):!1},w.forOwn(x,function(t,n){e.commands[n.toLowerCase()]=t.build()})}return e.prototype.parseCommand=function(e,t,n){var r=e.match(/^\/(\w+)\s*([\s\S]+)?/),i=r&&r[1]&&r[1].toLowerCase(),s=r&&this.commands[i];return r&&(n.data.name=i,n.data.isExisting=!!s,n.data.isGroup=t.isGroupConversation(),n.data.isAdmin=t.isGroupConversation()&&t.selfParticipant.role()===E.participantRole.Leader,n.data.isExisting&&(n.data.isAvailable=s.isAvailableFor(t))),r&&(!s||!s.isAvailableFor(t))&&(s=this.commands.help),{command:s,data:r&&r[2]}},e}();t.SystemCommandsService=N,t.get=C}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/chatService",["require","exports","swx-jskype-internal-application-instance","swx-enums","jcafe-property-model","../../lib/utils/chat/generator","jskype-settings-instance","swx-constants","jskype-constants","swx-utils-chat","../../lib/services/systemCommands/main","swx-mri","lodash-compat","../../../swx-jskype-main/lib/utils/chat/smsMessageBuilder"],e)}(function(e,t){var n=e("swx-jskype-internal-application-instance"),r=e("swx-enums"),i=e("jcafe-property-model"),s=e("../../lib/utils/chat/generator"),o=e("jskype-settings-instance"),u=e("swx-constants"),a=e("jskype-constants"),f=e("swx-utils-chat"),l=e("../../lib/services/systemCommands/main"),c=e("swx-mri"),h=e("lodash-compat"),p=e("../../../swx-jskype-main/lib/utils/chat/smsMessageBuilder"),d=a.PEOPLE.authorizationStates,v=function(){function e(e,t){var s=this;this.app=n.get(),this.supportedFormats=i.collection(),this.systemCommandsService=l.get(),this._notificationOn=!0,this._notificationKeywords=[],this.supportedMessageFormats=this.supportedFormats.asReadOnly(),this.start=i.enabledCommand(this.dummyCommand.bind(this)),this.accept=i.disabledCommand(),this.reject=i.disabledCommand(),this.stop=i.disabledCommand(),this._editMessage=function(e,t){var n=i.task(),r=e==="",o=r?null:s.getMyTranslation(t.translations),u={skypeeditedid:t.key(),key:t.key(),content:e,messagetype:"RichText"};return o&&(t._translationsArray.add(o),u.properties=s.prepareTranslationsPropeties(o)),t._skypeemoteoffset&&(u.skypeemoteoffset=t._skypeemoteoffset),s.apiHandler.sendMessage(s.conversation,u,t,n.resolve.bind(n),n.reject.bind(n)),n.promise},this._setNotificationSettings=function(e,t){s._notificationOn=!e||e.toLowerCase()!=="false",s._notificationKeywords=t?t.split(" ").filter(function(e){var t=e===0||e;return t}):[],s.conversation._notificationsEnabled._set(s._notificationOn)},this._updateNotificationSettings=function(e,t){var n=function(e,t){s._setNotificationSettings(e.toString(),t)};s.apiHandler.setAlerts(s.conversation.conversationId,e,t,n)},this.shouldNotify=function(e){var t=function(t){var n=new RegExp("(?:\\b)"+h.escapeRegExp(t),"i");return n.test(e)};return s._notificationOn||s._notificationKeywords.some(t)},this.apiHandler=e,this.conversation=t,this.supportedFormats([r.messageFormat.Text,r.messageFormat.Html]),this.sendMessage=i.command(this.sendMessageCommand.bind(this),this.conversation.activeModalities.chat),this._sendMessageWithoutSanitization=i.command(this.sendMessageWithoutSanitization.bind(this),t.activeModalities.chat),this._sendMoji=i.command(this.sendMojiCommand.bind(this),t.activeModalities.chat),this._sendSwiftCard=i.command(this.sendSwiftCardCommand.bind(this),t.activeModalities.chat),this.sendIsTyping=i.command(this.sendIsTypingCommand.bind(this),t.activeModalities.chat)}return e.prototype.sendMessageCommand=function(e,t,n){var r=n&&n.translation&&n.translation.users&&n.translation.users.length&&n.translation.users[0].value,i=n&&n.quotesPresent,s=r?e:f.messageSanitizer.processOutgoingTextMessage(e,this.conversation);if(t==="RichText/Sms"){var o=n&&n.targets?n.targets:[];s=p.createOutgoingXMLPayload(e,o),e=s}else i&&!h.isUndefined(n.quotedMessageXML)&&(e=n.quotedMessageXML+e,s=n.quotedMessageXML+s);return this.sendMessageWithoutSanitization(s,t,n,e)},e.prototype.sendMessageWithoutSanitization=function(e,t,n,o){var u=this;o||(o=e);var a=i.task(),l=n&&n.translation&&n.translation.users&&n.translation.users.length&&n.translation.users[0].value,c=n&&n.skypeemoteoffset?n.skypeemoteoffset:null,h=s.outgoingTextMessageActivityItem({content:e,originalContent:o,skypeemoteoffset:c,messageType:t},this.conversation),p=this.conversation.participants()[0],d,v=n&&n.activityData,m=function(){var e=u.conversation.historyService._lastMessageFromServer;if(e&&e.timestamp()>h.timestamp()){var t=e.timestamp().getTime()+100;h.timestamp._set(new Date(t))}},g=function(){h.status._set(r.activityStatus.Succeeded),a.resolve()},y=function(){h.status._set(r.activityStatus.Failed),a.reject()};if(l&&!f.messageSanitizer.isMessageWithMentionOnly(e)){var b=h;b._translationsArray.add(n.translation),d=this.prepareTranslationsPropeties(n.translation)}else v&&(d=this.prepareGiphyPropeties(n.activityData));var w={key:h.key(),content:e,messagetype:t||"RichText",properties:d,skypeemoteoffset:c};return m(),this.isInviteFreeMode(p,w)?(this.conversation.historyService._addOutgoingMessage(h),this.app.personsAndGroupsManager.all.persons.add(p.person,p.person.id(),undefined,r.activityType.ContactRequestIncoming).then(function(){u.apiHandler.sendMessage(u.conversation,w,h,g,y)},y)):this.apiHandler.sendMessage(this.conversation,w,h,g,y)&&this.conversation.historyService._addOutgoingMessage(h),a.promise},e.prototype.prepareTranslationsPropeties=function(e){var t={translations:JSON.stringify({key:e.key,mri:e.users[0].mri,value:f.messageSanitizer.escapeHTML(e.users[0].value)})};return t},e.prototype.prepareGiphyPropeties=function(e){var t;try{var n=JSON.parse(e);t={activityData:JSON.stringify({giphyExpression:f.messageSanitizer.escapeOutgoingHTML(n.giphyExpression)})}}catch(r){}return t},e.prototype.sendMojiCommand=function(e){var t=i.task();return this.apiHandler.sendMojiMessage(this.conversation,e,t.resolve.bind(t),t.reject.bind(t)),t.promise},e.prototype.sendSwiftCardCommand=function(e,t){var n=i.task(),r=s.outgoingTextMessageActivityItem({content:e},this.conversation),o=t?"RichText/Media_Card":"RichText";return this.apiHandler.sendMessage(this.conversation,{content:e,key:""+Date.now(),messagetype:o},r,n.resolve.bind(n),n.reject.bind(n)),n.promise},e.prototype.isInviteFreeMode=function(e,t){var n=this,r=o.isFeatureOn(u.COMMON.featureFlags.INVITE_FREE_IMPLICIT_INCOMING_CONTACT_REQUEST),i=function(){return e&&e.person},s=function(){return n.systemCommandsService.isSkypeCommand(t.content,n.conversation)},a=function(){return e.person._authorization()===d.PENDING_INCOMING};return r&&!this.conversation.isGroupConversation()&&i()&&a()&&!s()},e.prototype.sendIsTypingCommand=function(){var e=i.task();return this.apiHandler.setIsTyping(this.conversation.conversationId,!0,e.resolve.bind(e),e.reject.bind(e)),e.promise},e.prototype.dummyCommand=function(){return i.task().resolve().promise},e.prototype.getMyTranslation=function(e){if(!e||!e().length)return null;var t=this.app.personsAndGroupsManager.mePerson.id(),n=h.filter(e(),function(e){return e.users&&e.users[0]&&c.getId(e.users[0].mri)===t});return n.length?n[0]:null},e}();t.__esModule=!0,t["default"]=v}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/calling/callNotificationTimeout",["require","exports","jskype-settings-instance","swx-enums","swx-browser-globals"],e)}(function(e,t){function o(e,t){s[e.conversationId]||(s[e.conversationId]={notifiedSubscription:null,timeoutReference:null},s[e.conversationId].notifiedSubscription=e.selfParticipant.audio.state.once(r.callConnectionState.Notified,function(){s[e.conversationId].timeoutReference=i.getWindow().setTimeout(function(){t(),u(e)},n.settings.incomingCalls.notificationTimeout)}))}function u(e){var t=s[e.conversationId];t&&(t.timeoutReference&&i.getWindow().clearTimeout(t.timeoutReference),t.notifiedSubscription&&typeof t.notifiedSubscription.dispose=="function"&&t.notifiedSubscription.dispose(),delete s[e.conversationId])}var n=e("jskype-settings-instance"),r=e("swx-enums"),i=e("swx-browser-globals"),s={};t.observe=o,t.clearTimeout=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-util-calling-stack/lib/callingStack",["require","exports","swx-browser-detect","swx-constants","../../swx-log-tracer"],e)}(function(e,t){var n=e("swx-browser-detect"),r=e("swx-constants"),i=e("../../swx-log-tracer"),s=i.getLogger("CallingStack"),o=null,u=null,a=55,f=function(){function e(){this.outOfBrowserAvailable=!1}return e.prototype.isPluginlessEnabledInCurrentBrowser=function(){var e=n["default"].getBrowserInfo(),t=n["default"].getSystemInfo();return e.browserName===n["default"].BROWSERS.FIREFOX&&u.featureFlags[r.COMMON.featureFlags.PLUGINLESS_CALLING_FIREFOX]?!0:e.browserName===n["default"].BROWSERS.CHROME&&(e.browserMajorVersion<a||e.isYandex)?!1:e.browserName===n["default"].BROWSERS.CHROME&&u.featureFlags[r.COMMON.featureFlags.PLUGINLESS_CALLING_CHROME]?!0:e.browserName===n["default"].BROWSERS.CHROME&&u.featureFlags[r.COMMON.featureFlags.PLUGINLESS_CALLING_CHROME_NO_EXTENSION]?!this.outOfBrowserAvailable:e.browserName===n["default"].BROWSERS.EDGE&&u.featureFlags[r.COMMON.featureFlags.PLUGINLESS_CALLING_EDGE]&&e.browserMajorVersion>=u.pluginless.allowedMinEdgeVersion?!0:e.browserName===n["default"].BROWSERS.ELECTRON&&u.featureFlags[r.COMMON.featureFlags.PLUGINLESS_CALLING_ELECTRON]?!0:t.osName===n["default"].OPERATING_SYSTEMS.LINUX&&e.browserName===n["default"].BROWSERS.CHROME&&u.featureFlags[r.COMMON.featureFlags.PLUGINLESS_CALLING_CHROME_LINUX]?!0:!1},e.prototype.isPluginlessCallingSupported=function(){var e=n["default"].getBrowserInfo();return u.featureFlags[r.COMMON.featureFlags.NG_CALLING]?e.isPluginlessCallingSupported&&this.isPluginlessEnabledInCurrentBrowser():!1},e.prototype.isInBrowserPluginSupported=function(){return!1},e.prototype.isInBrowserCallingSupported=function(){return this.isPluginlessCallingSupported()},e.prototype.isOutofBrowserCallingSupported=function(){return!n["default"].getBrowserInfo().isInBrowserPluginSupported&&!this.isPluginlessCallingSupported()},e.prototype.isPluginlessOnly=function(){var e=n["default"].getBrowserInfo(),t=n["default"].getSystemInfo();return e.browserName===n["default"].BROWSERS.EDGE&&e.browserMajorVersion>13||t.osName===n["default"].OPERATING_SYSTEMS.LINUX},e.prototype.initInfo=function(){return this.browserCheckPromise||(s.info("No browser checks necessary"),this.browserCheckPromise=Promise.resolve(void 0)),this.browserCheckPromise},e}();t.init=function(e){return u=e},t.get=function(){if(!u)throw new Error("No settings found for calling stack!");return o=o||new f,o},t.__esModule=!0,t["default"]={get:t.get,init:t.init}}),define("swx-util-calling-stack",["swx-util-calling-stack/lib/callingStack"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/telemetry/callInfoTelemetry",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","swx-mri/lib/mriMaps","swx-enums","swx-utils-common","swx-constants","swx-util-calling-stack","lodash-compat"],e)}(function(e,t){function h(e,t){return a.get().isInBrowserCallingSupported()?new c(e,t):{dispose:function(){}}}function p(e,t){return l[e.conversationId]||(l[e.conversationId]=h(e,t)),l[e.conversationId]}function d(e){l[e.conversationId]&&(l[e.conversationId].dispose(),delete l[e.conversationId])}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("swx-mri/lib/mriMaps"),s=e("swx-enums"),o=e("swx-utils-common"),u=e("swx-constants"),a=e("swx-util-calling-stack"),f=e("lodash-compat"),l={},c=function(){function e(e,t){var r=this;this.contactTypes=f.invert(i.contactTypes),this.callCorrelationId=o.guid.create(),this.telemetryManager=n.get()._telemetryManager,this.dispose=function(){r.connectedSubscription.dispose()},this.conversation=e,this.direction=t,this.connectedSubscription=e.selfParticipant.audio.state.once(s.callConnectionState.Connected,function(){r.sendCallInfoEvent(u.COMMON.telemetry.calling.CONNECTED_CALL)})}return e.prototype.sendCallInfoEvent=function(e){var t=f.extend({callCorrelationId:this.callCorrelationId,name:u.COMMON.telemetry.calling.CALL_INFO,callState:e,direction:this.direction,isGroupCall:this.conversation.isGroupConversation(),callTechnology:this.conversation._callData.callTechnology(),isHostless:this.conversation._callData.isHostless},this.getParticipantsCountPerType());this.telemetryManager.sendEvent(r.settings.telemetry.jSkypeTenantToken,u.COMMON.telemetry.calling.MASTER_EVENT,t)},e.prototype.getParticipantsCountPerType=function(){var e=this,t=u.COMMON.telemetry.calling.PARTICIPANTS_COUNT_PREFIX,n={},r=this.conversation.participants().map(function(t){return e.contactTypes[t.person._type()]||u.COMMON.telemetry.calling.UNKNOWN_CONTACT_TYPE});return r.forEach(function(e){n.hasOwnProperty(t+e)?n[t+e]+=1:n[t+e]=1}),n},e}();t.CallInfoTelemetry=c,t.build=p,t.dispose=d}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/calling/participantHelper",["require","exports","swx-enums","../../modelHelpers/personsAndGroupsHelper","../../telemetry/logging/callingLogTracer","swx-utils-chat"],e)}(function(e,t){function u(e,t,n){if(!t){o.warn("Trying to update to undefined state!, ignoring");return}o.log("Updating participant",e.person.id()," state to:",t,", from:",e.audio.state(),"reason: ",n),e.audio.state._set(t,n),e.video.state._set(t,n)}function a(e,t,n){e.participants().forEach(function(e){u(e,t,n)})}function f(e,t){e.audio.state()===n.callConnectionState.Disconnected&&u(e,n.callConnectionState.Connecting),e.audio.state()===n.callConnectionState.Connecting&&!t._callData.isCurrentCallIncoming()&&u(e,n.callConnectionState.Ringing)}function l(e,t){f(e,t),u(e,n.callConnectionState.Connected)}function c(e,t){e.forEach(function(e){h(e,t)})}function h(e,t){t=t||n.callDisconnectionReason.Terminated,e.audio.state()!==n.callConnectionState.Disconnected&&(e.audio.state()!==n.callConnectionState.Disconnecting&&u(e,n.callConnectionState.Disconnecting,t),u(e,n.callConnectionState.Disconnected,t)),e.screenSharing.stream.state()!==n.mediaStreamState.Stopped&&e.screenSharing.stream.state._set(n.mediaStreamState.Stopped,t),e.screenSharing.state()!==n.callConnectionState.Disconnected&&(e.screenSharing.state()!==n.callConnectionState.Disconnecting&&e.screenSharing.state._set(n.callConnectionState.Disconnecting,t),e.screenSharing.state._set(n.callConnectionState.Disconnected,t))}function p(e,t){var n;e.selfParticipant.person.id()===t?n=e.selfParticipant:n=s.conversation.getParticipantFromConversation(e,t);if(!n){var i=r.getPerson(t);e._addParticipant(i),n=s.conversation.getParticipantFromConversation(e,t)}return n}function d(e){return e.some(function(e){var t=e.audio.state();return t!==n.callConnectionState.Disconnecting&&t!==n.callConnectionState.Disconnected})}var n=e("swx-enums"),r=e("../../modelHelpers/personsAndGroupsHelper"),i=e("../../telemetry/logging/callingLogTracer"),s=e("swx-utils-chat"),o=i.get();t.updateParticipantAudioVideoState=u,t.updateParticipantsAudioVideoState=a,t.handleParticipantRingingStateTransition=f,t.handleParticipantJoiningStateTransition=l,t.handleRemoteParticipantsLeavingStateTransition=c,t.handleParticipantLeavingStateTransition=h,t.getOrCreateParticipantInConversation=p,t.isAnyRemoteParticipantConnected=d}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/calling/escalationHelper",["require","exports","swx-enums","./participantHelper"],e)}(function(e,t){function s(e,t){if(!t._callHandler)return;t.audioService.callConnected._set(e.audioService.callConnected());var s=e.participants(0),l=r.getOrCreateParticipantInConversation(t,s.person.id()),c=e.selfParticipant,h=t.selfParticipant,p=e.screenSharingService.sharer();i=t._callHandler.isPluginless(),p&&(t.screenSharingService.sharer(p===s?l:h),e.screenSharingService.sharer(null)),f(l),a(s,l),f(h),a(c,h),u(e,t),t._callHandler.transferFrom(e._callHandler),t._callHandler.canToggleMute&&t._callHandler.canToggleMute._set(e._callHandler.canToggleMute()),r.handleParticipantLeavingStateTransition(s,n.callDisconnectionReason.CallEscalated),r.handleParticipantLeavingStateTransition(c,n.callDisconnectionReason.CallEscalated),o(e)}function o(e){e.selfParticipant.video.channels(0)&&e.selfParticipant.video.channels(0).isStarted.set._enabled(!0),e.selfParticipant.audio.isMuted.set.enabled._set(!0)}function u(e,t){t.audioService.callId._set(e.audioService.callId()),t._callData.nodeId(e._callData.nodeId()),t._callData.ngcEndpointId(e._callData.ngcEndpointId()),t._callData.ngcParticipantId(e._callData.ngcParticipantId())}function a(e,t){var r=e.screenSharing.stream.state(),s=e.video.channels,o=null;s(0)&&(o=s(0).stream.state()),t.audio.isMuted._set(e.audio.isMuted()),t.audio.isSpeaking._set(e.audio.isSpeaking()),t.audio.isOnHold._set(e.audio.isOnHold()),t.audio.endpoint._set(e.audio.endpoint()),o&&o!==n.mediaStreamState.Stopped&&(t.video.channels(0).isStarted.set(!0),t.video.channels(0).isStarted.set._enabled(!0),i||t.video.channels(0).stream.state._set(o)),r!==n.mediaStreamState.Stopped&&(t.screenSharing.isControlling._set(e.screenSharing.isControlling()),i||t.screenSharing.stream.state._set(r),e.screenSharing.stream.state._set(n.mediaStreamState.Stopped))}function f(e){r.updateParticipantAudioVideoState(e,n.callConnectionState.Connecting,n.callDisconnectionReason.CallEscalated),r.updateParticipantAudioVideoState(e,n.callConnectionState.Connected,n.callDisconnectionReason.CallEscalated)}var n=e("swx-enums"),r=e("./participantHelper"),i;t.escalateCall=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/preferences/settingsUtils/privacySettingsUtil",["require","exports","swx-jskype-internal-application-instance","swx-constants","swx-enums","jskype-settings-instance","swx-log-tracer","swx-utils-chat","swx-constants","swx-browser-detect"],e)}(function(e,t){function c(e){return s.isFeatureOn(r.COMMON.featureFlags.SKYPE_CALL_POLICY_SUPPORT)?e.isGroupConversation()?Promise.resolve(!0):v(e.participants(0),r.COMMON.userSettings.preferences.SKYPE_CALL_POLICY_SUPPORT):Promise.resolve(!0)}function h(e){return s.isFeatureOn(r.COMMON.featureFlags.SKYPE_VIDEO_CALLING_POLICY_SUPPORT)?v(e,r.COMMON.userSettings.preferences.SKYPE_VIDEO_CALLING_POLICY_SUPPORT):Promise.resolve(!0)}function p(e){if(e.value.state()===i.preferenceValueState.Defined)return Promise.resolve(e.value());if(f["default"].getBrowserInfo().isShellApp)return Promise.resolve(i.privacyPolicyValues.Anyone);var t=new Promise(function(e,t){setTimeout(t,s.settings.userSettings.privacySettingsFetchTimeout)});return Promise.race([e.value.get(),t])}function d(e,t){var n=e.person._authorization._value===a.PEOPLE.authorizationStates.AUTHORIZED;return t===i.privacyPolicyValues.Anyone||t===i.privacyPolicyValues.ContactsOnly&&n}function v(e,t){var r=n.get().personsAndGroupsManager;if(u.participant.isMeParticipant(e,r))return Promise.resolve(!0);var i=r.mePerson.preferences(t);return i?p(i).then(function(n){var r=d(e,n);return l.log("[Settings Manager] Privacy settings for "+t+" is "+r),r})["catch"](function(){return l.log("[Settings Manager] Could not reach privacy settings within "+s.settings.userSettings.privacySettingsFetchTimeout+" ms"),!0}):Promise.resolve(!0)}var n=e("swx-jskype-internal-application-instance"),r=e("swx-constants"),i=e("swx-enums"),s=e("jskype-settings-instance"),o=e("swx-log-tracer"),u=e("swx-utils-chat"),a=e("swx-constants"),f=e("swx-browser-detect"),l=o.getLogger("Settings");t.checkCallPolicySettings=c,t.checkVideoPolicySettings=h}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/callController",["require","exports","jcafe-property-model","swx-jskype-internal-application-instance","swx-constants","../../lib/services/calling/callNotificationTimeout","jskype-settings-instance","swx-util-calling-stack","../../lib/telemetry/logging/callingLogTracer","../../lib/services/callRegister","../../lib/telemetry/callInfoTelemetry","swx-constants","swx-enums","../../lib/modelHelpers/calling/escalationHelper","../../lib/modelHelpers/calling/participantHelper","../../lib/services/preferences/settingsUtils/privacySettingsUtil"],e)}(function(e,t){function S(e){g=e}function x(e){var t;return m.log("[Call Controller] Setup call"),e._callHandler?(m.log("[Call Controller] Setup call, callHandler exists!"),Promise.resolve(e)):(t=g.createCallHandler(e),e._setCallHandler(t),f.get().registerCall(e),G(e),Y(e),Z(e),R(e),Promise.resolve(e))}function T(e,t){return j(e).then(I).then(x).then(B).then(F).then(M.bind(null,e,t))["catch"](function(t){return m.log("[Call Controller] Failed to process placeCall",t),H(e,h.callDisconnectionReason.Failed),Promise.reject(t)})}function N(e,t){return x(e).then(function(){return e._callHandler.acceptCall(t)})["catch"](function(t){return m.log("[Call Controller] Failed to acceptCall",t),Q(e),Promise.reject(undefined)})}function C(e){if(f.get().wasCallEnded(e))return m.log("[Call Controller] This call was already ended/rejected, ignoring"),Promise.resolve();var t=W(e);return f.get().registerCallIdMapping(t,e)?(s.observe(t,O.bind(null,t)),V(t,e).then(function(n){l.build(t,c.COMMON.telemetry.calling.direction.INCOMING);switch(n){case E.callingAllowed:return D(t,e),X(t);case E.notifyOnly:return D(t,e),z(t);case E.ignore:return s.clearTimeout(t),t._callData.markIncomingPayloadsAsProcessed(e),Promise.resolve()}return Promise.reject(undefined)})):(I(t),Promise.resolve())}function k(e){function t(){return e._callHandler?e._callHandler.cancelCall(e):Promise.resolve()}return m.log("[Call Controller] cancel call, audio cancellable",U(e)),U(e)?t().then(function(){H(e,h.callDisconnectionReason.Canceled),Q(e)}):Promise.resolve()}function L(e,t){return e._callHandler?e._callHandler.endCall(t):(e.autoCall()&&(m.log("[Call controller] No call handler, fake disconnect"),H(e)),Promise.resolve())}function A(e){H(e,h.callDisconnectionReason.AutoCallFailed)}function O(e){e.selfParticipant.audio.state()===h.callConnectionState.Notified&&H(e,h.callDisconnectionReason.NotificationTimeout)}function M(e,t){var n,r=new Promise(function(e,t){n=t});return b[e.conversationId]={reject:n},Promise.race([q(e,t),r])}function _(e){if(b[e]){try{b[e].reject(i.CALLING.ERRORS.CALL_ABORTED)}catch(t){m.warn("[CallController] rejecting active call error",t)}delete b[e]}}function D(e,t){e.audioService.callId._set(t.convoCallId)}function P(e){e.audioService.callId._set(null)}function H(e,t){var n=t||h.callDisconnectionReason.Terminated;d.handleParticipantLeavingStateTransition(e.selfParticipant,n)}function B(e){return e._autoCallingService.handleAutoCall()}function j(e){return new Promise(function(t,n){f.get().canPlaceCall()?(m.log("[Call controller] checkIfCanPlaceCall: true"),t(e)):(m.log("[Call controller] checkIfCanPlaceCall: false"),n())})}function F(e){return l.build(e,c.COMMON.telemetry.calling.direction.OUTGOING),Promise.resolve(e)}function I(e){return m.log("[Call Controller] Clean conversation state"),e._callData.resetCallData(),P(e),Promise.resolve(e)}function q(e,t){return m.log("[Call Controller] Place call, withVideo",t),e._callHandler.placeCall(t)}function R(e){var t=o.SoundLevelEventMode||i.CALLING.SOUND_LEVEL_EVENT_MODE.Boolean,n=o.SoundLevelThreshold||i.CALLING.SOUND_LEVEL_DEFAULT_THRESHOLD;e._callHandler.setSoundLevelEventMode({mode:t,threshold:n})}function U(e){var t=[h.callConnectionState.Disconnected,h.callConnectionState.Notified];return t.indexOf(e.selfParticipant.audio.state())>-1}function z(e){return e.selfParticipant.audio.state()!==h.callConnectionState.Notified&&(e.audioService._setMediaConnectionType(),d.updateParticipantAudioVideoState(e.selfParticipant,h.callConnectionState.Notified)),Promise.resolve()}function W(e){var t=e.conversationId;J(e)&&(t=e.conversationId.replace("8:#T/",""));var n=r.get().conversationsManager._getOrCreateConversation(t);return n._callData.addIncomingCallPayload(e),r.get().conversationsManager.conversations.add(n),n}function X(e){return e.audioService._setMediaConnectionType(),x(e).then(e._callHandler.acknowledge)["catch"](function(t){throw m.log("[Call Controller] Failed to process incomingCall",t),Q(e),t})}function V(e,t){var i=n.task();return r.get().personsAndGroupsManager.mePerson.capabilities.audio.get().then(function(){var n=E.callingAllowed,i=r.get().personsAndGroupsManager.mePerson.capabilities.audio;return f.get().canProcessIncomingCall(t.conversationId)||(m.log("[Call Controller] Call Register is not allowing calls. Ignoring incoming call"),n=E.ignore),i()||(m.log("[Call Controller] Calling is not supported because:",i.reason),$(i.reason)||$(e.audioService.accept.enabled.reason)?(m.log("[Call Controller] Notify Only"),n=E.notifyOnly):(m.log("[Call Controller] Ignoring call"),n=E.ignore)),e._callData.isGroupIncomingCall()&&!o.isFeatureOn(c.COMMON.featureFlags.GVC_JOINING)&&(m.log("[Call Controller] This is a group call, but the feature flag is off. Ignoring call"),n=E.ignore),!o.isFeatureOn(c.COMMON.featureFlags.PLUGINLESS_PSTN_CALLING)&&u.get().isPluginlessCallingSupported()&&e.audioService._hasPSTNParticipants()&&(m.log("[Call Controller] PSTN call in plugin-less env, no plugin installed, notify user"),n=E.notifyOnly),u.get().isPluginlessCallingSupported()&&!e._callData.hasIncomingNGCNotification()&&(m.log("[Call Controller] Incoming P2P calls are not supported on this platform"),n=E.ignore),f.get().wasCallEnded(t)&&(m.log("[Call Controller] This call was already ended/rejected, ignoring"),n=E.ignore),v.checkCallPolicySettings(e).then(function(e){return e?n:E.ignore})}).then(function(e){m.log("[Call Controller] Incoming call policy is ",e),i.resolve(e)})["catch"](function(){i.resolve(E.ignore)}),i.promise}function $(e){switch(e){case h.callingNotSupportedReasons.PluginNotInstalled:case h.callingNotSupportedReasons.PluginBlocked:case h.callingNotSupportedReasons.OSNotSupported:case h.callingNotSupportedReasons.BrowserNotSupported:return!0;default:return!1}}function J(e){return e.conversationId!=="8:"+e.callerId}function K(e){var t=e._internalCallTelemetry.getData();!e.isGroupConversation()&&t&&(m.log("[Call Controller] Internal telemetry",t),r.get()._telemetryManager.sendEvent(o.settings.telemetry.jSkypeTenantToken,c.COMMON.telemetry.calling.INTERNAL_PLUGIN_TELEMETRY,t)),e._internalCallTelemetry.reset()}function Q(e){_(e.conversationId),m.log("[Call Controller] Calling unregister with",e.conversationId),f.get().unregisterCall(e,e._callData.getCallIdFromCurrentCall()),K(e),e._callHandler&&(e._callHandler.dispose(),e._callHandler=null),e._autoCallingService.reset(e.selfParticipant.audio.state.reason),s.clearTimeout(e),I(e),e._callData.resetPluginCallState(),et(e),P(e),l.dispose(e),y[e.conversationId]&&(y[e.conversationId].dispose(),delete y[e.conversationId]),w&&w.dispose()}function G(e){function r(t,r,i){m.log("[Call Controller] Audio state changed",t,r,i),i!==undefined&&t===h.callConnectionState.Disconnected&&(Q(e),n.dispose())}var t=e.selfParticipant.audio.state,n=e.participants.subscribe();m.log("[Call Controller] subscribe to audio state"),y[e.conversationId]=t.changed(r)}function Y(e){function n(){t(!1)}function r(){f.get().unregisterCall(e),e._callHandler.cancelCall(e).then(n,n)}var t=e.selfParticipant.audio._isFailedCall;t.once(!0,r)}function Z(e){e.isGroupConversation()||(w=e.spawnedConversation.changed(function(t){t&&x(t).then(function(){r.get().conversationsManager.conversations.add(t),p.escalateCall(e,t),e.spawnedConversation._set(undefined)})}))}function et(e){if(!e.isGroupConversation()){var t=e.participants(0);t.audio.endpoint(t.person.id())}}var n=e("jcafe-property-model"),r=e("swx-jskype-internal-application-instance"),i=e("swx-constants"),s=e("../../lib/services/calling/callNotificationTimeout"),o=e("jskype-settings-instance"),u=e("swx-util-calling-stack"),a=e("../../lib/telemetry/logging/callingLogTracer"),f=e("../../lib/services/callRegister"),l=e("../../lib/telemetry/callInfoTelemetry"),c=e("swx-constants"),h=e("swx-enums"),p=e("../../lib/modelHelpers/calling/escalationHelper"),d=e("../../lib/modelHelpers/calling/participantHelper"),v=e("../../lib/services/preferences/settingsUtils/privacySettingsUtil"),m=a.get(),g,y={},b={},w,E={callingAllowed:1,notifyOnly:2,ignore:3};t.initialize=S,t.setupCall=x,t.placeCall=T,t.acceptCall=N,t.handleIncoming=C,t.cancelCall=k,t.endCall=L,t.abortAutoCall=A}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("ecs-client/lib/httpRequest",["require","exports"],e)}(function(e,t){function n(e,t,n,r,i){function u(){clearTimeout(o),r&&(r(new Error("timeout")),r=void 0,n=void 0)}function a(){if(s.readyState!==4)return;s.status===200?(clearTimeout(o),n&&n(s.responseText)):(clearTimeout(o),r&&r(new Error("response code "+s.status)))}if(t<=0||t>=Math.pow(2,31)||t!==(t|0))throw new Error("invalid timeout");if(typeof XMLHttpRequest!="function"){r(new Error("XMLHttpRequest is not supported in this environment"),!0);return}var s=new XMLHttpRequest;s.onreadystatechange=a,s.open("GET",e,!0),s.send();var o=setTimeout(u,t)}t.get=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("ecs-client/lib/jsonp",["require","exports","swx-browser-globals"],e)}(function(e,t){function r(e,t,n,r,s){function l(e){clearTimeout(f),n&&n(e)}function c(e){clearTimeout(f),r&&(r(new Error(e)),r=void 0,n=void 0)}function h(){c("timeout")}function p(){c("script.onerror invoked")}if(t<=0||t>=Math.pow(2,31)||t!==(t|0))throw new Error("invalid timeout");if(typeof s.callbackName!="string"&&s.callbackName!==void 0||s.callbackName==="")throw new Error("if provided, jsonp callback name must be a non-empty string");if(typeof s.async!="boolean"&&s.async!==void 0)throw new Error("if provided, async flag must be boolean");try{var o=e+(/\?/.test(e)?"&":"?")+"callback="+i(l,s.callbackName);a(o,p,s.async)}catch(u){r(u,!0);return}var f=setTimeout(h,t)}function i(e,t){var r=n.getWindow();return t?o(e,t,r):s(e,r)}function s(e,t){var n;do n=(Math.random().toString(36)+"00000000000000000").slice(2,12);while(n in t);return t[n]=e,n}function o(e,t,n){var r=t.split("."),i=u(r.slice(0,-1),n),s=r.pop();if(s in i&&typeof i[s]!="function")throw new Error("non-function property with supplied callback name already exists");return i[s]=e,t}function u(e,t){var n=t;return e.forEach(function(e){if(e in n){if(n[e]&&!Object.isExtensible(n[e]))throw new Error("callback namespace already exists but is not an extensible type")}else n[e]={};n=n[e]}),n}function a(e,t,r){var i=n.getDocument(),s=i.createElement("script");s.src=e,s.type="text/javascript",r?s.async=!0:s.defer=!0,s.onerror=t,i.getElementsByTagName("head")[0].appendChild(s)}var n=e("swx-browser-globals");t.request=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("ecs-client/lib/ecsClient",["require","exports","swx-browser-globals","./httpRequest","./jsonp"],e)}(function(e,t){function s(e,t,s){function x(){var t=[],n=e.queryParams||{};return e.userId&&t.push("id="+encodeURIComponent(e.userId)),e.clientId&&t.push("clientId="+encodeURIComponent(e.clientId)),Object.keys(n).sort().forEach(function(e){t.push([encodeURIComponent(e),encodeURIComponent(n[e])].join("="))}),t.length===0?"":"?"+t.join("&")}function T(){function n(){if(typeof t!="function")throw new Error("success callback is required and must be a function");if(s&&typeof s!="function")throw new Error("failure callback must be a function if provided")}function r(){function t(e){return e instanceof Array&&e.length!==0&&e.every(function(e){return e&&typeof e=="string"})}function n(e){return typeof e=="object"&&e&&Object.keys(e).length}function r(e){return e&&typeof e=="string"}function i(e){return e&&typeof e=="object"}function s(e){return e===void 0}function o(){switch(e.endpoints){case"int":return;case"prod":return;default:if(!t(e.endpoints))throw new Error('options.endpoints must be "int", "prod", or an array of endpoint URIs')}}function u(t){t.forEach(function(t){var n=e[t.name];if(!s(n)&&(typeof n!="number"||n<t.min||n>t.max||n!==(n|0)))throw new Error("if defined, options."+t.name+" must be an integer between "+t.min+" and "+t.max+", inclusive")})}function a(t){t.forEach(function(t){var n=e[t];if(n!==void 0&&!r(n))throw new Error("if defined, options."+t+" must be a non-empty string")})}function f(){var t=e.queryParams;if(!s(t)&&(!n(t)||Object.keys(t).some(function(e){switch(e){case"id":case"clientId":case"fingerprint":throw new Error("id, clientId, and fingerprint are forbidden as queryParams. Use the userId and clientId options instead");default:return!r(t[e])}})))throw new Error("if defined, options.queryParams must be a non-empty object with only non-empty string properties")}function l(t){t.forEach(function(t){if(!r(e[t]))throw new Error("options."+t+" must be a non-empty string")})}function c(){switch(e.requestType){case void 0:return;case"jsonp":return;case"xhr":return;default:throw new Error('if defined, options.requestType must be either "jsonp" or "xhr"')}}function h(){if(!s(e.requestTypeOptions)&&!i(e.requestTypeOptions))throw new Error("If defined, options.requestTypeOptions must be a non-null object")}if(typeof e!="object"||!e)throw new Error("options must be a non-null object");l(["clientName","clientVersion"]),a(["teamName","userId","clientId","localStoragePrefix"]),u([{max:10,min:1,name:"retryAttempts"},{max:12e4,min:1,name:"requestTimeout"}]),o(),f(),c(),h()}n(),r()}function N(e){var t=new Error(e);if(!s)throw t;s(t)}function C(t){b++;var n;switch(h){case"jsonp":n=i.request;break;case"xhr":n=r.get;break;default:throw new Error("unknown request type "+h)}n(t,f,O,A,e.requestTypeOptions||{})}function A(e,t){if(b/d.length<a&&!t){if(b%d.length===0&&!L){k=!0;return}b%d.length===0&&(L=!1,k=!1,S=setTimeout(M,l*Math.pow(l,b/d.length))),C(d[++y%d.length])}else B()||N("Configuration service is unreachable and no valid cached config is available: "+e.message)}function O(n){clearTimeout(S),k=!1;if(w)return;var r=_(n);r&&(w=!0,H(r),e.teamName?t(r[e.teamName]||{}):t(r))}function M(){clearTimeout(S),k&&!w?(k=!1,L=!1,S=setTimeout(M,l*Math.pow(c,b/d.length)),C(d[++y%d.length])):L=!0}function _(e){if(typeof e=="object")return e;try{return JSON.parse(e)}catch(t){B()||N("Malformed response and no valid cached config for team is available")}}function D(){switch(e.endpoints){case"int":return["https://a.config.skype.net","https://b.config.skype.net"];case"prod":return["https://a.config.skype.com","https://b.config.skype.com"];default:return e.endpoints}}function P(){if(E===void 0){E=!1;try{if(m&&g&&g.localStorage){var e=g.localStorage.getItem(m)||"{}";g.localStorage.setItem(m,e),E=!0}}catch(t){}}return E}function H(e){P()&&g.localStorage.setItem(m,JSON.stringify(e))}function B(){if(!P())return!1;var n;try{n=JSON.parse(g.localStorage.getItem(m))}catch(r){return!1}return n?(e.teamName?t(n[e.teamName]||{}):t(n),!0):!1}T();var o=D(),u=x(),a=e.retryAttempts||3,f=e.requestTimeout||7500,l=500,c=1.2,h=e.requestType||"xhr",p=encodeURIComponent(e.clientName)+"/"+encodeURIComponent(e.clientVersion)+u,d=o.map(function(e){return encodeURI(e)+"/config/v1/"+p}),v=e.endpoints==="prod"?"":e.endpoints==="int"?"int|":"custom|",m=e.localStoragePrefix?e.localStoragePrefix+"|"+v+p:"",g=n.getWindow(),y=Math.floor(Math.random()*d.length),b=0,w=!1,E;C(d[y]);var S=setTimeout(M,l),k,L}var n=e("swx-browser-globals"),r=e("./httpRequest"),i=e("./jsonp");t.fetchConfig=s}),define("ecs-client",["ecs-client/lib/ecsClient"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-registrar/lib/index",["require","exports","swx-browser-globals"],e)}(function(e,t){function i(e){return new r(e)}var n=e("swx-browser-globals"),r=function(){function e(e){var t=this;this.isTtlRefresh=!1,this.registerEndpoint=function(e,n){t.isTtlRefresh=!1,t.currentPublicUrl=e,t.currentRegistrationId=n,t.clearRegistrationRefresh(),t.initialRegistrationTimestamp=Date.now(),t.getPayloadAndRegister()},this.unregisterEndpoint=function(e){t.skypetokenProvider().then(function(n){var r={headers:{"X-Skypetoken":n}};t.requestDispatcherProvider.remove(t.settings.registrarServiceUrl+"/"+e,r)},function(){})},this.getPayloadAndRegister=function(){var e;t.customRegistrationProvider?e=t.customRegistrationProvider.registerPresence(t.settings.registrarServiceUrl,t.getPayload()):e=t.skypetokenProvider().then(function(e){var n={headers:{"X-Skypetoken":e},payload:JSON.stringify(t.getPayload())};return t.requestDispatcherProvider.post(t.settings.registrarServiceUrl,n)}),e.then(t.registrationSuccess,t.registrationError)},this.renewTtl=function(){t.isTtlRefresh=!0,t.getPayloadAndRegister()},this.registrationSuccess=function(e){e.response||t.registrationError("Invalid success response result, expected response property"),e.response.status||t.registrationError("Invalid success response result, expected status property"),t.isSuccessCode(e.response.status)||t.registrationError(e.response),t.schedulePresenceRefresh(),t.onRegistrationSuccess&&t.onRegistrationSuccess(t.isTtlRefresh)},this.registrationError=function(e){t.onRegistrationError&&t.onRegistrationError(typeof XMLHttpRequest=="function"&&e instanceof XMLHttpRequest?e:null)},this.schedulePresenceRefresh=function(){t.clearRegistrationRefresh(),t.getRegistrationTime()+t.settings.registrarRefreshTimeoutInMs<t.settings.maxRegistrationTimeInMs&&(t.refreshTimeout=n.getWindow().setTimeout(t.renewTtl,t.settings.registrarRefreshTimeoutInMs))},this.clearRegistrationRefresh=function(){n.getWindow().clearTimeout(t.refreshTimeout)},this.setLogProvider=function(e){t.logProvider=e||{log:console.log,warn:console.warn,error:console.error,debug:console.debug,info:console.info}},this.settings=e.settings,this.requestDispatcherProvider=e.requestDispatcherProvider,this.skypetokenProvider=e.skypetokenProvider,this.onRegistrationSuccess=e.onRegistrationSuccess,this.onRegistrationError=e.onRegistrationError,this.customRegistrationProvider=e.customRegistrationProvider||null,this.setLogProvider(e.logProvider)}return e.prototype.getPayload=function(){return{clientDescription:{appId:this.settings.pnhAppId,aesKey:"",languageId:"en-US",platform:this.settings.platform,templateKey:this.settings.pnhTemplate,platformUIVersion:this.settings.platformUIVersion},registrationId:this.currentRegistrationId,nodeId:"",transports:{TROUTER:[{context:"",path:this.currentPublicUrl,ttl:this.settings.registrarTtlInSeconds}]}}},e.prototype.isSuccessCode=function(e){return e===202||e===200},e.prototype.getRegistrationTime=function(){return Date.now()-this.initialRegistrationTimestamp},e}();t.build=i,t.EVENTS={REGISTRATION_SUCCESS:"REGISTRATION_SUCCESS",REGISTRATION_FAILURE:"REGISTRATION_FAILURE",REGISTRATION_REFRESH:"REGISTRATION_REFRESH"}}),define("swx-registrar",["swx-registrar/lib/index"],function(e){return e}),!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("trouterclient",[],t):"object"==typeof exports?exports.trouterclient=t():e.trouterclient=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(module,exports,__webpack_require__){(function(global,module){!function(e,t){var n=e;n.version="0.9.6",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(e,r){var i,s,o=n.util.parseUri(e);t&&t.location&&(o.protocol=o.protocol||t.location.protocol.slice(0,-1),o.host=o.host||(t.document?t.document.domain:t.location.hostname),o.port=o.port||t.location.port),i=n.util.uniqueUri(o);var u={host:o.host,secure:"https"==o.protocol,port:o.port||("https"==o.protocol?443:80),query:o.query||""};return n.util.merge(u,r),!u["force new connection"]&&n.sockets[i]||(s=new n.Socket(u)),!u["force new connection"]&&s&&(n.sockets[i]=s),s=s||n.sockets[i],s.of(o.path.length>1?o.path:"")}}(module.exports,void 0===global?window:global);var io=module.exports;!function(e,t){var n=e.util={},r=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){for(var t=r.exec(e||""),n={},s=14;s--;)n[i[s]]=t[s]||"";return n},n.uniqueUri=function(e){var n=e.protocol,r=e.host,i=e.port;return"document"in t?(r=r||document.domain,i=i||("https"==n&&"https:"!==document.location.protocol?443:document.location.port)):(r=r||"localhost",i||"https"!=n||(i=443)),(n||"http")+"://"+r+":"+(i||80)},n.query=function(e,t){var r=n.chunkQuery(e||""),i=[];n.merge(r,n.chunkQuery(t||""));for(var s in r)r.hasOwnProperty(s)&&i.push(s+"="+r[s]);return i.length?"?"+i.join("&"):""},n.chunkQuery=function(e){for(var t,n={},r=e.split("&"),i=0,s=r.length;i<s;++i)t=r[i].split("="),t[0]&&(n[t[0]]=t[1]);return n};var s=!1;n.load=function(e){if("document"in t&&"complete"===document.readyState||s)return e();n.on(t,"load",e,!1)},n.on=function(e,t,n,r){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,r)},n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null},"undefined"!=typeof window&&n.load(function(){s=!0}),n.defer=function(e){if(!n.ua.webkit||"undefined"!=typeof importScripts)return e();n.load(function(){setTimeout(e,100)})},n.merge=function(e,t,r,i){var s,o=i||[],u=void 0===r?2:r;for(s in t)t.hasOwnProperty(s)&&n.indexOf(o,s)<0&&("object"==typeof e[s]&&u?n.merge(e[s],t[s],u-1,o):(e[s]=t[s],o.push(t[s])));return e},n.mixin=function(e,t){n.merge(e.prototype,t.prototype)},n.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.intersect=function(e,t){for(var r=[],i=e.length>t.length?e:t,s=e.length>t.length?t:e,o=0,u=s.length;o<u;o++)~n.indexOf(i,s[o])&&r.push(s[o]);return r},n.indexOf=function(e,t,n){for(var r=e.length,n=n<0?n+r<0?0:n+r:n||0;n<r&&e[n]!==t;n++);return r<=n?-1:n},n.toArray=function(e){for(var t=[],n=0,r=e.length;n<r;n++)t.push(e[n]);return t},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(e){return!1}return void 0!=e.withCredentials}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent)}(void 0!==io?io:module.exports,void 0===global?window:global),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function n(){r.removeListener(e,n),t.apply(this,arguments)}var r=this;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var r=this.$events[e];if(t.util.isArray(r)){for(var i=-1,s=0,o=r.length;s<o;s++)if(r[s]===n||r[s].listener&&r[s].listener===n){i=s;break}if(i<0)return this;r.splice(i,1),r.length||delete this.$events[e]}else(r===n||r.listener&&r.listener===n)&&delete this.$events[e]}return this},n.prototype.removeAllListeners=function(e){return this.$events&&this.$events[e]&&(this.$events[e]=null),this},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){if(!this.$events)return!1;var n=this.$events[e];if(!n)return!1;var r=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,r);else{if(!t.util.isArray(n))return!1;for(var i=n.slice(),s=0,o=i.length;s<o;s++)i[s].apply(this,r)}return!0}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(exports,nativeJSON){function f(e){return e<10?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o,u=gap,a=t[e];switch(a instanceof Date&&(a=date(e)),"function"==typeof rep&&(a=rep.call(t,e,a)),typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(a)){for(s=a.length,n=0;n<s;n+=1)o[n]=str(n,a)||"null";return i=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+u+"]":"["+o.join(",")+"]",gap=u,i}if(rep&&"object"==typeof rep)for(s=rep.length,n=0;n<s;n+=1)"string"==typeof rep[n]&&(r=rep[n],(i=str(r,a))&&o.push(quote(r)+(gap?": ":":")+i));else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a))&&o.push(quote(r)+(gap?": ":":")+i);return i=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+u+"}":"{"+o.join(",")+"}",gap=u,i}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(e,t,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;r<n;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,!t||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw new Error("JSON.stringify")},JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&"object"==typeof i)for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),void 0!==r?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}(void 0!==io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var n=e.parser={},r=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],i=n.reasons=["transport not supported","client not handshaken","unauthorized"],s=n.advice=["reconnect"],o=t.JSON,u=t.util.indexOf;n.encodePacket=function(e){var t=u(r,e.type),n=e.id||"",a=e.endpoint||"",f=e.ack,l=null;switch(e.type){case"error":var h=e.reason?u(i,e.reason):"",p=e.advice?u(s,e.advice):"";""===h&&""===p||(l=h+(""!==p?"+"+p:""));break;case"message":""!==e.data&&(l=e.data);break;case"event":var d={name:e.name};e.args&&e.args.length&&(d.args=e.args),l=o.stringify(d);break;case"json":l=o.stringify(e.data);break;case"connect":e.qs&&(l=e.qs);break;case"ack":l=e.ackId+(e.args&&e.args.length?"+"+o.stringify(e.args):"")}var v=[t,n+("data"==f?"+":""),a];return null!==l&&void 0!==l&&v.push(l),v.join(":")},n.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var n=0,r=e.length;n<r;n++)t+="�"+e[n].length+"�"+e[n];return t},n.decodePacket=function(e){var t=e.match(/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/);if(!t)return{};var n=t[2]||"",e=t[5]||"",u={type:r[t[1]],endpoint:t[4]||""};switch(n&&(u.id=n,t[3]?u.ack="data":u.ack=!0),u.type){case"error":var t=e.split("+");u.reason=i[t[0]]||"",u.advice=s[t[1]]||"";break;case"message":u.data=e||"";break;case"event":try{var a=o.parse(e);u.name=a.name,u.args=a.args}catch(e){}u.args=u.args||[];break;case"json":try{u.data=o.parse(e)}catch(e){}break;case"connect":u.qs=e||"";break;case"ack":var t=e.match(/^([0-9]+)(\+)?(.*)/);if(t&&(u.ackId=t[1],u.args=[],t[3]))try{u.args=t[3]?o.parse(t[3]):[]}catch(e){}}return u},n.decodePayload=function(e){if("�"==e.charAt(0)){for(var t=[],r=1,i="";r<e.length;r++)"�"==e.charAt(r)?(t.push(n.decodePacket(e.substr(r+1).substr(0,i))),r+=Number(i)+1,i=""):i+=e.charAt(r);return t}return[n.decodePacket(e)]}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.onData=function(e){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e){var n=t.parser.decodePayload(e);if(n&&n.length)for(var r=0,i=n.length;r<i;r++)this.onPacket(n[r])}return this},n.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),"error"==e.type&&"reconnect"==e.advice&&(this.open=!1),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.close&&this.open&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.open=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){this.open=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(e,t){t.call(this)},n.prototype.clearEventHandlers=function(){return this}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,n){function r(e){if(this.options={port:80,secure:!1,document:"document"in n&&document,resource:"socket.io",transports:t.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var r=this;t.util.on(n,"unload",function(){r.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function i(){}e.Socket=r,t.util.mixin(r,t.EventEmitter),r.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},r.prototype.publish=function(){this.emit.apply(this,arguments);var e;for(var t in this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t),e.$emit.apply(e,arguments))},r.prototype.handshake=function(e){function n(t){t instanceof Error?r.onError(t.message):e.apply(null,t.split(":"))}var r=this,s=this.options,o=["http"+(s.secure?"s":"")+":/",s.host+":"+s.port,s.resource,t.protocol,t.util.query(this.options.query,"t="+ +(new Date))].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var u=document.getElementsByTagName("script")[0],a=document.createElement("script");a.src=o+"&jsonp="+t.j.length,u.parentNode.insertBefore(a,u),t.j.push(function(e){n(e),a.parentNode.removeChild(a)})}else{var f=t.util.request();f.open("GET",o,!0),f.withCredentials=!0,f.onreadystatechange=function(){4==f.readyState&&(f.onreadystatechange=i,200==f.status?n(f.responseText):!r.reconnecting&&r.onError(f.responseText))},f.send(null)}},r.prototype.getTransport=function(e){for(var n,r=e||this.transports,i=0;n=r[i];i++)if(t.Transport[n]&&t.Transport[n].check(this)&&(!this.isXDomain()||t.Transport[n].xdomainCheck()))return new t.Transport[n](this,this.sessionid);return null},r.prototype.connect=function(e){if(this.connecting)return this;var n=this;return this.handshake(function(r,i,s,o){function u(e){if(n.transport&&(n.transport.clearTimeouts(),n.transport.clearEventHandlers()),n.transport=n.getTransport(e),!n.transport)return n.publish("connect_failed");n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){if(!n.connected&&(n.connecting=!1,n.options["try multiple transports"])){n.remainingTransports||(n.remainingTransports=n.transports.slice(0));for(var e=n.remainingTransports;e.length>0&&e.splice(0,1)[0]!=n.transport.name;);e.length?u(e):n.publish("connect_failed")}},n.options["connect timeout"]))})}n.sessionid=r,n.closeTimeout=1e3*s,n.heartbeatTimeout=1e3*i,n.transports=o?t.util.intersect(o.split(","),n.options.transports):n.options.transports,n.setHeartbeatTimeout(),u(n.transports),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),e&&"function"==typeof e&&e()})}),this},r.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)},r.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},r.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},r.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},r.prototype.disconnectSync=function(){var e=t.util.request(),n=this.resource+"/"+t.protocol+"/"+this.sessionid;e.open("GET",n,!0),this.onDisconnect("booted")},r.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},r.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},r.prototype.onOpen=function(){this.open=!0},r.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},r.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},r.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},r.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||n)&&(this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},r.prototype.reconnect=function(){function e(){if(n.connected){for(var e in n.namespaces)n.namespaces.hasOwnProperty(e)&&""!==e&&n.namespaces[e].packet({type:"connect"});n.publish("reconnect",n.transport.name,n.reconnectionAttempts)}clearTimeout(n.reconnectionTimer),n.removeListener("connect_failed",t),n.removeListener("connect",t),n.reconnecting=!1,delete n.reconnectionAttempts,delete n.reconnectionDelay,delete n.reconnectionTimer,delete n.redoTransports,n.options["try multiple transports"]=i}function t(){if(n.reconnecting)return n.connected?e():n.connecting&&n.reconnecting?n.reconnectionTimer=setTimeout(t,1e3):void (n.reconnectionAttempts++>=r?n.redoTransports?(n.publish("reconnect_failed"),e()):(n.on("connect_failed",t),n.options["try multiple transports"]=!0,n.transport=n.getTransport(),n.redoTransports=!0,n.connect()):(n.reconnectionDelay<s&&(n.reconnectionDelay*=2),n.connect(),n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts),n.reconnectionTimer=setTimeout(t,n.reconnectionDelay)))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var n=this,r=this.options["max reconnection attempts"],i=this.options["try multiple transports"],s=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(t,this.reconnectionDelay),this.on("connect",t)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new r(this,"json"),this.ackPackets=0,this.acks={}}function r(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],r={type:"event",name:e};return"function"==typeof n&&(r.id=++this.ackPackets,r.ack="data",this.acks[r.id]=n,t=t.slice(0,t.length-1)),r.args=t,this.packet(r)},n.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function n(){r.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var r=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var i=["message",e.data];"data"==e.ack?i.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,i);break;case"event":var i=[e.name].concat(e.args);"data"==e.ack&&i.push(n),this.$emit.apply(this,i);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):"unauthorized"==e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},r.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},r.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,n){function r(e){t.Transport.apply(this,arguments)}function i(){}e.websocket=r,t.util.inherit(r,t.Transport),r.prototype.name="websocket",r.prototype.open=function(){var e,r=t.util.query(this.socket.options.query),i=this;return e||(e=n.MozWebSocket||n.WebSocket),this.websocket=new e(this.prepareUrl()+r),this.websocket.onopen=function(){i.onOpen(),i.socket.setBuffer(!1)},this.websocket.onmessage=function(e){i.onData(e.data)},this.websocket.onclose=function(){i.onClose(),i.socket.setBuffer(!0)},this.websocket.onerror=function(e){i.onError(e)},this},r.prototype.send=function(e){return this.websocket.send(e),this},r.prototype.payload=function(e){for(var t=0,n=e.length;t<n;t++)this.packet(e[t]);return this},r.prototype.close=function(){return this.websocket.close(),this},r.prototype.onError=function(e){this.socket.onError(e)},r.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},r.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},r.xdomainCheck=function(){return!0},r.prototype.clearEventHandlers=function(){return this.websocket&&(this.websocket.onopen=this.websocket.onmessage=this.websocket.onclose=this.websocket.onerror=i),this},t.transports.push("websocket")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t,n){function r(e){e&&(t.Transport.apply(this,arguments),this.sendBuffer=[])}function i(){}e.XHR=r,t.util.inherit(r,t.Transport),r.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},r.prototype.payload=function(e){for(var n=[],r=0,i=e.length;r<i;r++)n.push(t.parser.encodePacket(e[r]));this.send(t.parser.encodePayload(n))},r.prototype.send=function(e){return this.post(e),this},r.prototype.post=function(e){function t(){4==this.readyState&&(this.onreadystatechange=i,s.posting=!1,200==this.status?s.socket.setBuffer(!1):s.onClose())}function r(){this.onload=i,s.socket.setBuffer(!1)}var s=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=r:this.sendXHR.onreadystatechange=t,this.sendXHR.send(e)},r.prototype.close=function(){return this.onClose(),this},r.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),r=t.util.query(this.socket.options.query,"t="+ +(new Date));if(n.open(e||"GET",this.prepareUrl()+r,!0),"POST"==e)try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(e){}return n},r.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},r.check=function(e,r){try{var i=t.util.request(r),s=n.XDomainRequest&&i instanceof XDomainRequest,o=e&&e.options&&e.options.secure?"https:":"http:",u=o!=n.location.protocol;if(i&&(!s||!u))return!0}catch(e){}return!1},r.xdomainCheck=function(){return r.check(null,!0)},r.prototype.clearEventHandlers=function(){return this.sendXHR&&(this.sendXHR.onreadystatechange=this.sendXHR.onload=i),this}}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t,n){function r(){t.Transport.XHR.apply(this,arguments)}function i(){}e["xhr-polling"]=r,t.util.inherit(r,t.Transport.XHR),t.util.merge(r,t.Transport.XHR),r.prototype.name="xhr-polling",r.prototype.open=function(){var e=this;return t.Transport.XHR.prototype.open.call(e),!1},r.prototype.get=function(){function e(){4==this.readyState&&(this.onreadystatechange=i,200==this.status?(s.onData(this.responseText),s.get()):s.onClose())}function t(){this.onload=i,this.onerror=i,s.onData(this.responseText),s.get()}function r(){s.onClose()}if(this.open){var s=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=t,this.xhr.onerror=r):this.xhr.onreadystatechange=e,this.xhr.send(null)}},r.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(e){}this.xhr=null}},r.prototype.ready=function(e,n){var r=this;t.util.defer(function(){n.call(r)})},r.prototype.clearEventHandlers=function(){return t.Transport.XHR.prototype.clearEventHandlers.call(this),this.xhr&&(this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i),this},t.transports.push("xhr-polling")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t,n){function r(e){t.Transport["xhr-polling"].apply(this,arguments),this.index=t.j.length;var n=this;t.j.push(function(e){n._(e)})}var i=n.document&&"MozAppearance"in n.document.documentElement.style;e["jsonp-polling"]=r,t.util.inherit(r,t.Transport["xhr-polling"]),r.prototype.name="jsonp-polling",r.prototype.post=function(e){function n(){r(),i.socket.setBuffer(!1)}function r(){i.iframe&&i.form.removeChild(i.iframe);try{o=document.createElement('<iframe name="'+i.iframeId+'">')}catch(e){o=document.createElement("iframe"),o.name=i.iframeId}o.id=i.iframeId,i.form.appendChild(o),i.iframe=o}var i=this,s=t.util.query(this.socket.options.query,"t="+ +(new Date)+"&i="+this.index);if(!this.form){var o,u=document.createElement("form"),a=document.createElement("textarea"),f=this.iframeId="socketio_iframe_"+this.index;u.className="socketio",u.style.position="absolute",u.style.top="0px",u.style.left="0px",u.style.display="none",u.target=f,u.method="POST",u.setAttribute("accept-charset","utf-8"),a.name="d",u.appendChild(a),document.body.appendChild(u),this.form=u,this.area=a}this.form.action=this.prepareUrl()+s,r(),this.area.value=t.JSON.stringify(e);try{this.form.submit()}catch(e){}this.iframe.attachEvent?o.onreadystatechange=function(){"complete"==i.iframe.readyState&&n()}:this.iframe.onload=n,this.socket.setBuffer(!0)},r.prototype.get=function(){var e=this,n=document.createElement("script"),r=t.util.query(this.socket.options.query,"t="+ +(new Date)+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),n.async=!0,n.src=this.prepareUrl()+r,n.onerror=function(){e.onClose()};var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(n,s),this.script=n,i&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},r.prototype._=function(e){return this.onData(e),this.open&&this.get(),this},r.prototype.ready=function(e,n){var r=this;if(!i)return n.call(this);t.util.load(function(){n.call(r)})},r.check=function(){return"document"in n},r.xdomainCheck=function(){return!0},r.prototype.clearEventHandlers=function(){return t.Transport["xhr-polling"].prototype.clearEventHandlers.call(this),this.script&&(this.script.onerror=function(){}),this},t.transports.push("jsonp-polling")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),exports.io=io}).call(exports,__webpack_require__(1),__webpack_require__(2)(module))},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i,s=n(0),o="111.1.5",u=function(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(t+"="+e[t]);return n.join("&")},a=function(e){if(!e)return"";if("object"!=typeof e)return e;var t,n,r={},i=["name","message","description","number","fileName","lineNumber","stack"];for(t=0;t<i.length;t++)(n=i[t])in e&&(r[n]=e[n]);return JSON.stringify(r)},f=function(e){return"string"==typeof e?e:""},l=function(){return Date.now()},c=function(){},h=function(){if("undefined"!=typeof window&&window&&window.performance){var e=function(){return Math.round(window.performance.now())};e(),l=e}},p=function(e,t){var n=1+.4*(Math.random()-.5),r=1e3*Math.pow(2,e)*n;return r=Math.round(r),Math.min(t,r)},d=function(){function e(e,t){this.forwarder=e,this.forwardee=t}return e.GetCallback=function(t,n){var r=new e(t,n);return r.Callback.bind(r)},e.prototype.Callback=function(){if("function"==typeof this.forwardee){var e=Array.prototype.concat.apply(this.forwarder,arguments);this.forwardee.apply(this.forwardee,e)}},e}();!function(e){e[e.Connected=0]="Connected",e[e.Disconnected=1]="Disconnected",e[e.Error=2]="Error",e[e.Progress=3]="Progress",e[e.Response=4]="Response"}(i||(i={}));var v,m=(H={},H[i.Connected]="trouter_js_client_connected",H[i.Disconnected]="trouter_js_client_disconnected",H[i.Error]="trouter_js_client_error",H[i.Progress]="trouter_js_client_progress",H[i.Response]="trouter_js_client_response",H),g=function(){function e(){this.cv=o,this.ua="",this.hr="",this.v=""}return e}(),y=function(){function e(){this["force new connection"]=!0,this.reconnect=!1,this.query="",this.requireMtls=!1}return e}();!function(e){e[e.connect=0]="connect",e[e.connecting=1]="connecting",e[e.connect_failed=2]="connect_failed",e[e.disconnect=3]="disconnect",e[e.reconnect=4]="reconnect",e[e.reconnect_failed=5]="reconnect_failed",e[e.reconnecting=6]="reconnecting",e[e.error=7]="error",e[e.message=8]="message"}(v||(v={}));var b=function(e){},w=(function(){function e(){}}(),function(){function e(){}}(),function(){function e(){}return e}()),E=function(){function e(){this.enabled=!1,this.numberOfStepsToMaintain=20,this.logHealthCheckError=!1,this.sendProgressTimeoutSecs=55,this.logSendPingError=!1,this.maxBackoffInMs=12e4;for(var e=Object.keys(i).map(function(e){return i[e]}),t=e.filter(function(e){return"number"==typeof e}),n=0,r=t;n<r.length;n++){var s=r[n];this[m[s]]=!1}}return e}(),S=function(){function e(){}return e}(),x=function(){function e(){}return e}(),T=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(w),N=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.connectionNumber=0,t}return r(t,e),t}(w),C=(function(){function e(){}}(),function(){function e(e){var t=JSON.parse(e);this.startTS=t.hasOwnProperty("startTS")?t.startTS:0,this.url=t.hasOwnProperty("url")?t.url:"",this.shortUrl=t.hasOwnProperty("shortUrl")?t.shortUrl:"",this.body=t.hasOwnProperty("body")?t.body:"",this.headers=t.hasOwnProperty("headers")?t.headers:[],this.id=t.hasOwnProperty("id")&&"number"==typeof t.id?t.id:-1,this.method=t.hasOwnProperty("method")?t.method:""}return e.prototype.on=function(e,t){"data"===e?this.dataCallback=t:"end"===e&&("function"==typeof this.dataCallback&&this.dataCallback(this.body),t())},e}()),k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(w),L=function(){function e(e){this.id=e,this.status=200,this.headers={},this.body=""}return e}(),A=function(){function e(e,t,n){this.request=e,this.responseData=t,this.sendResponse=n}return e.prototype.writeHead=function(e,t){this.responseData.status=e,this.responseData.headers=t},e.prototype.write=function(e){this.responseData.body+=e},e.prototype.end=function(e){e&&(this.responseData.body+=e),this.sendResponse(this.request,this.responseData)},e}(),O=function(){function e(){this.logFunc=b}return Object.defineProperty(e.prototype,"ConnectionId",{set:function(e){this._connectionId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ConnectedClientId",{set:function(e){this._ccId=e},enumerable:!0,configurable:!0}),e.prototype.debug=function(e){this.log("debug",e)},e.prototype.warn=function(e){this.log("warn",e)},e.prototype.error=function(e){this.log("error",e)},e.prototype.log=function(e,t){var n={level:e,message:t,connectionId:this._connectionId,connectedClientId:this._ccId};this.logFunc(JSON.stringify(n))},e}(),M=function(){function e(e,t,n,r,i,s){this.logger=e,this.clientCorrelationID=t,this.environment=n,this.clientId=r,this.clientInfo=i,this.getServerState=s,this.clientCorrelationID=t||"",this.steps=[],this.connectionAttempt=0,this.totalStepCount=0,this.beginTimestamp=Date.now(),this.eventLogSettings=new E,this.connectedInfo=new N,this.progressTimeout=null}return e.prototype.overrideAsBool=function(e,t){t&&(!this.eventLogSettings.hasOwnProperty(e)||!0!==t[e]&&!1!==t[e]||(this.eventLogSettings[e]=t[e]))},e.prototype.sendProgress=function(e){this.steps.length>0&&this.sendTelemetry(i.Progress,e,this.steps)},e.prototype.cancelProgressTimer=function(){this.progressTimeout&&(clearTimeout(this.progressTimeout),this.progressTimeout=null)},e.prototype.resetProgressSendTimer=function(){if(this.cancelProgressTimer(),this.eventLogSettings.sendProgressTimeoutSecs>0){var e=this;this.progressTimeout=setTimeout(function(){e.sendProgress({reason:"timeout",timeoutSecs:e.eventLogSettings.sendProgressTimeoutSecs})}.bind(this),1e3*e.eventLogSettings.sendProgressTimeoutSecs)}},e.prototype.setConnectedInfo=function(e,t){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=l(),this.connectedInfo.isNewUrl=e,this.connectedInfo.transportType=t,++this.connectedInfo.connectionNumber},e.prototype.clearConnectedInfo=function(){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=0,this.connectedInfo.isNewUrl=!0,this.connectedInfo.transportType=""},e.prototype.copyProperties=function(e,t){e.properties=e.properties||{};for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&(e.properties[n.replace(/-/g,"_")]={value:t[n]})},e.prototype.sendTelemetry=function(e,t,n){try{if(!0===this.eventLogSettings.enabled&&!0===this.eventLogSettings[m[e]]&&void 0!==this.eventLogger){var r={name:m[e],properties:{connectionAttempt:{value:this.connectionAttempt},clientCorrelationID:{value:this.clientCorrelationID},steps:{value:JSON.stringify(n||[])},clientID:{value:this.clientId},eventVersion:{value:3},environment:{value:this.environment},cv:{value:o},ua:{value:this.clientInfo.ua}}};if(this.copyProperties(r,this.getServerState()),this.copyProperties(r,t),this.copyProperties(r,this.connectedInfo),this.eventFactory){var i=this.eventFactory();i.name=r.name;for(var s in r.properties)r.properties.hasOwnProperty(s)&&i.setProperty(s,r.properties[s].value);r=i}this.eventLogger.logEvent(r)}}catch(t){this.logger.warn("error in sending event "+e+": "+a(t))}},e.prototype.createStep=function(e,t,n){var r=new S;return r.stepName=e,r.operation=t,r.delta=l()-this.beginTimestamp,r.ts=Date.now(),r.error=n,r},e.prototype.addStep=function(e,t,n){if(!1!==this.eventLogSettings.enabled&&(0===this.steps.length&&0===this.beginTimestamp&&(this.beginTimestamp=l()),this.steps.push(this.createStep(e,t,n)),++this.totalStepCount,this.steps.length>this.eventLogSettings.numberOfStepsToMaintain)){var r=this.steps.slice(0);this.steps.length=0,this.sendTelemetry(i.Progress,{reason:"flush"},r)}},e.prototype.trackStart=function(e){this.addStep(e,"start")},e.prototype.trackEnd=function(e){this.addStep(e,"end")},e.prototype.trackError=function(e,t,n,r){void 0===r&&(r=!1),"health"===e&&!0!==this.eventLogSettings.logHealthCheckError||(!0===r&&this.addStep(e,t,n),this.sendTelemetry(i.Error,{},[this.createStep(e,t,n)]))},e.prototype.trackProgress=function(e,t){this.addStep(e,t)},e.prototype.trackConnected=function(e,t){this.setConnectedInfo(e,t);var n=this.steps.slice(0),r=this.totalStepCount,s=l()-this.beginTimestamp;this.steps.length=0,this.totalStepCount=0,this.beginTimestamp=0,this.sendTelemetry(i.Connected,{stepCount:n.length,totalStepCount:r,connectionEstablishmentMs_Total:s},n),this.cancelProgressTimer()},e.prototype.trackDisconnected=function(e){e.sessionLengthMS=l()-this.connectedInfo.connectedTimestamp,this.sendTelemetry(i.Disconnected,e,[]),this.resetProgressSendTimer()},e.prototype.trackNewConnection=function(){++this.connectionAttempt},e.prototype.trackResponse=function(e,t,n,r){var s=new k;r&&(s.hasError=!0,s.error=r);try{if(e){s.requestID=e.id,s.httpMethod=e.method,s.shortUrl=e.shortUrl;var o=e.headers||{};for(var u in o)o.hasOwnProperty(u)&&(s[u]=o[u])}t&&(s.latencyMS=n,s.responseCode=t.status,s.responseLength=t.body?t.body.length:null)}catch(e){s.hasError=!0,s.error=s.error+"\nerror creating response context "+a(e)}this.sendTelemetry(i.Response,s,[])},e.prototype.sendResponseError=function(e,t,n){this.trackResponse(t,n,null,e)},e.prototype.close=function(){this.sendProgress({reason:"closed"}),this.steps.length=0,this.cancelProgressTimer()},e.prototype.mergeSettings=function(e){if(e){this.eventLogSettings.numberOfStepsToMaintain=Math.min(30,Math.max(10,e.numberOfStepsToMaintain)),this.eventLogSettings.sendProgressTimeoutSecs=Math.min(3600,Math.max(55,e.sendProgressTimeoutSecs)),this.overrideAsBool("enabled",e),this.overrideAsBool("logHealthCheckError",e);for(var t=Object.keys(i).map(function(e){return i[e]}),n=0,r=t;n<r.length;n++){var s=r[n];"number"==typeof s&&this.overrideAsBool(m[s],e)}this.overrideAsBool("logSendPingError",e),this.resetProgressSendTimer()}},e}(),_=function(){function e(e,t,n,r,i,s,o,u){this.logger=e,this.connectionTracker=t,this.config=n,this.url=r,this.body=i,this.tag=s,this.callback=o,this.maxBackoffInMs=u,this.backoff=0,this.stop=!1,this.xhr=null,n&&(this.xhr=n.xhr)}return e.prototype.useCORSXHR=function(){return!this.xhr&&"withCredentials"in new XMLHttpRequest},e.prototype.getXHR=function(){return this.xhr?this.xhr:this.useCORSXHR?XMLHttpRequest:window.XDomainRequest||XMLHttpRequest},e.prototype.post=function(e,t){var n=this;try{var r=this.getXHR(),i=new r;this.config.xhr||XMLHttpRequest&&i instanceof XMLHttpRequest?i.onreadystatechange=function(){if(4===i.readyState)if(i.status>=200&&i.status<300)n.done(i.responseText);else{var t="HTTP status "+i.status+" "+i.statusText+" in post to "+e+" response text: "+i.responseText;n.logger.error(t),n.errorHandler(t)}}:(i.onload=function(){var t=/^([0-9]{3}).*/g,r=t.exec(i.responseText),s=r?r[1]:200;if(s>=200&&s<300)n.done(i.responseText);else{var o="HTTP status (using XDomainRequest) "+s+" in post to "+e+" response text: "+i.responseText;n.logger.error(o),n.errorHandler(o)}},i.onerror=n.errorHandler),i.open("POST",e,!0),i.setRequestHeader&&(i.setRequestHeader("Content-Type","text/plain"),this.config.userAgent&&i.setRequestHeader("User-Agent",this.config.userAgent)),"undefined"!=typeof window&&window&&window.XDomainRequest&&i instanceof window.XDomainRequest?(i.onprogress=function(){},i.ontimeout=function(){},setTimeout(function(){try{i.send(t)}catch(t){var r=a(t);n.logger.error("Exception in post to "+e+": "+r),n.errorHandler(r)}},0)):i.send(t)}catch(t){var s=a(t);this.logger.error("Exception in post to "+e+": "+s),n.errorHandler(s)}},e.prototype.done=function(e){try{clearTimeout(this.timeout),this.timeout=null,this.connectionTracker.trackEnd(this.tag),this.stop||(this.logger.debug("done: "+this.url),this.callback(e))}catch(e){this.connectionTracker.trackError(this.tag,"done",e),this.logger.error("exception in done: "+a(e))}},e.prototype.go=function(){try{this.stop||(this.logger.debug("go: "+this.url),this.post(this.url,this.body))}catch(e){this.connectionTracker.trackError(this.tag,"go",e),this.logger.error("exception in go: "+a(e))}},e.prototype.cancel=function(){this.stop=!0,this.timeout&&(this.logger.debug("stop: "+this.url),clearTimeout(this.timeout))},e.prototype.errorHandler=function(e){try{this.connectionTracker.trackError(this.tag,"error",e),this.stop||(this.timeout=setTimeout(this.go.bind(this),p(this.backoff,this.maxBackoffInMs)),this.backoff++)}catch(e){this.connectionTracker.trackError(this.tag,"errorHandler",e),this.logger.error("exception in errorHandler: "+a(e))}},e}();_.noop=new _(null,null,null,null,null,null,null,null);var D;!function(e){e[e.Initial=0]="Initial",e[e.Connecting=1]="Connecting",e[e.Connected=2]="Connected",e[e.Disconnected=3]="Disconnected",e[e.WaitingHealthCheck=4]="WaitingHealthCheck"}(D||(D={}));var P=function(){function e(e,t){this.config=t||new x,this.serverClosed=!0,this.reconnectToOldServerFirst=!1,this.allocRequest=_.noop,this.healthRequest=_.noop,this.connectedClientId="",this.domId="",this.connectionId="",this.currentSocketNumber=0,this.pingIntervalId=null,this.reconnectTimeoutId=null,this.callbacks={auth:c,ready:c,request:c,disconnected:c,reconnecting:c,log:b},this.stats={reconnectAttempts:0},this.socketIOEventsListened=["connecting","connect_failed","disconnect","reconnect","reconnect_failed","reconnecting","error","message"],this.clientInfo=new g,this.clientInfo.cv=o,this.clientInfo.ua="",this.clientID=Date.now(),this.maxBackoffInMs=12e4,this.state=D.Initial,this.config&&this.config.clientInfo&&(this.clientInfo.hr=f(this.config.clientInfo.hr),this.clientInfo.ua=f(this.config.clientInfo.ua),this.clientInfo.v=f(this.config.clientInfo.v)),this.config&&this.config.telemetrySettings&&"number"==typeof this.config.telemetrySettings.maxBackoffInMs&&this.config.telemetrySettings.maxBackoffInMs>=4e3&&this.config.telemetrySettings.maxBackoffInMs<=12e4&&(this.maxBackoffInMs=this.config.telemetrySettings.maxBackoffInMs),"undefined"!=typeof window&&window.location&&(this.domId=window.location.hostname),this.logger=new O,this.connectionTracker=new M(this.logger,this.config.clientCorrelationID,this.config.environment,this.clientID,this.clientInfo,this.getServerState.bind(this));try{h(),this.config.eventLogger&&"function"==typeof this.config.eventLogger.logEvent?(this.connectionTracker.eventLogger=this.config.eventLogger,this.config.eventFactory&&"function"==typeof this.config.eventFactory&&(this.connectionTracker.eventFactory=this.config.eventFactory),this.connectionTracker.eventLogSettings.enabled=!1,this.connectionTracker.mergeSettings(this.config.telemetrySettings||this.config.clientSettings)):this.logger.warn("Trouter client event logging disabled due to invalid configuration.")}catch(e){this.connectionTracker.eventLogSettings.enabled=!1,this.logger.warn("Trouter client event logging disabled. error in initialization: "+a(e))}"function"==typeof e&&(this.callbacks.request=e)}return e.createServer=function(t,n){return new e(t,n)},e.prototype.appendConnectedClientIds=function(e,t){t||(t=-1!==e.indexOf("?")?"&":"?");var n;return n=e.indexOf("ccid=")<0?e+t+"ccid="+this.connectedClientId+(this.domId?"&dom="+this.domId:""):e+(this.domId?t+"dom="+this.domId:""),this.appendCorrelationIds(n)},e.prototype.appendCorrelationIds=function(e){var t=-1!==e.indexOf("?")?"&":"?";return e.indexOf("cor_id")<0?e+t+"cor_id="+this.connectionTracker.clientCorrelationID+"&con_num="+this.clientID+"_"+this.connectionTracker.connectionAttempt:e},e.prototype.getHealthUrl=function(e){var t=e.lastIndexOf("/a");return e.substring(0,t)+"/h"},e.prototype.saveUrl=function(e){this.url=e,this.urlPath=e.replace(/https?:\/\/([A-z0-9\:\$\-\_\.\+\!\*\"\(\)\,]*)\//,"/")},e.prototype.authorized=function(e){try{var t=null;if(e)if(e.issuer)if(e.se)if(e.sp)if(e.sr)if(e.sig)if(this.serverClosed)t="server closed";else if(this.authorization)t="already have authorization data";else try{this.logger.debug("got authorization: "+JSON.stringify(e))}catch(e){t="unable to parse authorization data, error: "+a(e)}else t="Invalid authz data: missing sig";else t="Invalid authz data: missing sr";else t="Invalid authz data: missing sp";else t="Invalid authz data: missing se";else t="Invalid authz data: missing issuer";else t="received null authorization data";t?(this.connectionTracker.trackError("auth","authParseError",t),this.logger.error(t)):(this.authorization=e,this.connectionTracker.trackEnd("auth"),this.connectSocket())}catch(e){this.connectionTracker.trackError("auth","authError",e),this.logger.error("exception in authorized: "+a(e))}},e.prototype.allocated=function(e){try{this.allocateResult=JSON.parse(e),this.connectionId=this.allocateResult.id||"",this.logger.ConnectionId=this.connectionId,this.allocateResult.healthUrl?this.healthUrl=this.allocateResult.healthUrl:(this.healthUrl=this.getHealthUrl(this.allocationUri),this.logger.warn("No healthUrl property found when parsing allocation.")),!this.connectedClientId&&this.allocateResult.ccid&&(this.connectedClientId=this.allocateResult.ccid,this.logger.ConnectedClientId=this.connectedClientId,this.allocationUri=this.appendConnectedClientIds(this.allocationUri),this.healthUrl=this.appendConnectedClientIds(this.healthUrl),this.logger.debug("connected client id set{connectedClientId:"+this.connectedClientId+"}")),this.connectionTracker.trackStart("auth"),this.callbacks.auth(this.allocateResult.connId,this.authorized.bind(this))}catch(e){var t=a(e);this.connectionTracker.trackError("allocation","authorization error",t),this.logger.error("authorization error: "+t)}},e.prototype.allocateConnection=function(){this.logger.debug("allocating new connection"),this.authorization=void 0,this.allocRequest.cancel(),this.connectionTracker.trackStart("allocation"),this.connectionTracker.trackNewConnection(),this.allocRequest=new _(this.logger,this.connectionTracker,this.config,this.appendCorrelationIds(this.allocationUri),"","allocation",this.allocated.bind(this),this.maxBackoffInMs),this.allocRequest.go()},e.prototype.reconnectToOldServer=function(){this.logger.debug("reconnectToOldServer"),this.reconnectToOldServerFirst=!1,this.healthRequest.cancel(),this.connectionTracker.trackStart("health"),this.connectionTracker.trackNewConnection(),this.state=D.WaitingHealthCheck,this.healthRequest=new _(this.logger,this.connectionTracker,this.config,this.healthUrl,"","health",function(){this.serverClosed||(this.logger.debug("reconnecting with old allocation"),this.connectSocket())}.bind(this),this.maxBackoffInMs),this.healthRequest.go()},e.prototype.maybeReconnect=function(e,t){try{var n=this.reconnectToOldServerFirst?"reusePrevious":"freshConnection";if(t&&t.socketNumber!==this.currentSocketNumber)return this.connectionTracker.trackError("reconnect",n,"not reconnecting on an old socket. old,new id: "+t.socketNumber+","+this.currentSocketNumber),void this.logger.debug("not reconnecting on an old socket");if(this.serverClosed)return void this.callbacks.disconnected();e&&this.logger.debug("Last connection failed, reason: "+e),this.connectionTracker.trackProgress("reconnect",n),this.callbacks.reconnecting(),this.serverClosed||(this.reconnectToOldServerFirst?this.reconnectToOldServer():this.allocateConnection())}catch(e){this.connectionTracker.trackError("reconnect","error",a(e),!0),this.logger.error("exception in maybeReconnect: "+a(e))}},e.prototype.sendPing=function(){if(this.socket)try{this.socket.emit("ping",this.handlePong.bind(this))}catch(e){this.logger.error("unable to send ping, error: "+a(e)),!0===this.connectionTracker.eventLogSettings.logSendPingError&&this.connectionTracker.trackError("ping","send",a(e))}},e.prototype.handlePong=function(e){++this.connectionTracker.connectedInfo.numberOfPingReplies},e.prototype.startPing=function(){this.cancelPing(),this.socket&&"websocket"===this.transportType&&(this.pingIntervalId=setInterval(this.sendPing.bind(this),55e3))},e.prototype.cancelPing=function(){this.pingIntervalId&&(clearInterval(this.pingIntervalId),this.pingIntervalId=null)},e.prototype.cancelReconnectTimeout=function(){this.reconnectTimeoutId&&(clearTimeout(this.reconnectTimeoutId),this.reconnectTimeoutId=null)},e.prototype.connectSocket=function(){this.connectionTracker.trackStart("connectSocket");var e,t=this.config.ioOptions||new y;this.state=D.Connecting,t["force new connection"]=!0,t.reconnect=!1,this.authorization.r=this.allocateResult.instance,this.authorization.v="v2",this.authorization.p=this.allocateResult.instancePort,t.query=this.appendConnectedClientIds(u(this.authorization),"&"),!0===t.requireMtls&&(e=-1!==t.query.indexOf("&")?"&":"?",t.query+=e+"auth=true"),e=-1!==t.query.indexOf("&")?"&":"?",t.query+=e+"tc="+encodeURI(JSON.stringify(this.clientInfo)),t.query+="&timeout=55",this.logger.debug("connecting to "+this.allocateResult.socketio+"?"+t.query),this.cleanupSocket(),this.cancelReconnectTimeout(),this.reconnectTimeoutId=setTimeout(this.onReconnectTimeout.bind(this),12e4),this.socket=(this.config.io||s.io).connect(this.allocateResult.socketio,t),this.socket.socketNumber=++this.currentSocketNumber,this.socket.on(v[v.connecting],d.GetCallback(this.socket,this.onSocketConnecting.bind(this))),this.socket.on(v[v.connect],d.GetCallback(this.socket,this.onSocketConnect.bind(this))),this.socket.on(v[v.connect_failed],d.GetCallback(this.socket,this.onSocketConnectFailed.bind(this))),this.socket.on(v[v.disconnect],d.GetCallback(this.socket,this.onSocketDisconnect.bind(this))),this.socket.on(v[v.reconnect],d.GetCallback(this.socket,this.onSocketReconnect.bind(this))),this.socket.on(v[v.reconnect_failed],d.GetCallback(this.socket,this.onSocketReconnectFailed.bind(this))),this.socket.on(v[v.reconnecting],d.GetCallback(this.socket,this.onSocketReconnecting.bind(this))),this.socket.on(v[v.error],d.GetCallback(this.socket,this.onSocketError.bind(this))),this.socket.on(v[v.message],d.GetCallback(this.socket,this.onSocketMessage.bind(this)))},e.prototype.onReconnectTimeout=function(){this.state!==D.Connecting?(this.connectionTracker.trackProgress("reconnectTimeout","restarting"),this.maybeReconnect(null,null)):(this.connectionTracker.trackProgress("reconnectTimeout","preempted:"+this.transportType),this.logger.debug("reconnecting preempted while connecting"))},e.prototype.onSocketConnecting=function(e,t){this.state=D.Connecting,this.logger.debug("connecting using transportType: "+t),this.transportType=t,this.connectionTracker.trackProgress("connecting",this.transportType)},e.prototype.onSocketConnect=function(e){this.state=D.Connected;try{this.cancelReconnectTimeout(),this.stats.reconnectAttempts=0;var t=void 0,n=void 0;if(this.serverClosed)return void (this.socket&&this.socket.disconnect());t=this.allocateResult.url,n=this.url!==t,this.reconnectToOldServerFirst=!0,this.logger.debug("connected: "+t),this.saveUrl(t),this.startPing(),this.connectionTracker.trackEnd("connectSocket"),this.connectionTracker.trackConnected(n,this.transportType),this.callbacks.ready(t,n)}catch(e){var r="exception in socket.on connect: "+a(e);this.logger.error(r),this.connectionTracker.trackError("connectSocket","connectHandler",r)}},e.prototype.onSocketConnectFailed=function(e,t){this.state=D.Disconnected,this.cancelPing(),this.cancelReconnectTimeout(),this.logger.debug("connect_failed"),this.connectionTracker.trackError("connect_failed",this.transportType,t,!0),this.maybeReconnect(t,e)},e.prototype.onSocketDisconnect=function(e){this.state=D.Disconnected,this.cancelPing(),this.cancelReconnectTimeout(),this.logger.debug("disconnected"),this.connectionTracker.trackDisconnected({serverClosed:this.serverClosed}),this.connectionTracker.clearConnectedInfo(),this.maybeReconnect(null,e)},e.prototype.onSocketReconnect=function(e){this.state=D.Connected,this.startPing(),this.logger.debug("reconnect")},e.prototype.onSocketReconnectFailed=function(e,t){this.state=D.Disconnected,this.cancelPing(),this.cancelReconnectTimeout(),this.logger.debug("reconnect_failed"),this.connectionTracker.trackError("reconnect_failed",this.transportType,t,!0),this.maybeReconnect(t,e)},e.prototype.onSocketReconnecting=function(e){this.state=D.Connecting,this.cancelPing(),this.logger.debug("reconnecting")},e.prototype.onSocketError=function(e,t){if(this.cancelPing(),this.logger.error("error from socket.io: "+t),this.state!==D.Connecting){var n=p(this.stats.reconnectAttempts,this.maxBackoffInMs);this.stats.reconnectAttempts++,this.logger.debug("Reconnect in "+n+" msecs..."),this.cancelReconnectTimeout(),this.connectionTracker.trackError("connectSocket","socketio.error",t,!0),this.reconnectTimeoutId=setTimeout(function(){this.maybeReconnect(t,e)}.bind(this),n)}else this.connectionTracker.trackProgress("connectSocket","preempted:"+this.transportType),this.logger.debug("reconnecting preempted while connecting")},e.prototype.onSocketMessage=function(e,t){var n;try{var r=void 0;try{n=new C(t)}catch(e){this.logger.error("unable to parse request, error: "+a(e)+", request:"+n),this.connectionTracker.sendResponseError("unable to parse request, error: "+e.message,n,r)}n.startTS=l(),n.url&&0===n.url.indexOf(this.urlPath)&&(n.shortUrl="/"+n.url.substring(this.urlPath.length)),this.logger.debug("request: "+JSON.stringify(n)),r=new A(n,new L(n.id),this.sendResponse.bind(this)),this.callbacks.request(n,r)}catch(e){this.logger.error("exception in socket.on message: "+a(e)),this.connectionTracker.sendResponseError(e.message,n,null)}},e.prototype.sendResponse=function(e,t){t.headers=t.headers||{},e.headers&&e.headers["trouter-request"]&&!t.headers["trouter-request"]&&(t.headers["trouter-request"]=e.headers["trouter-request"]);var n=l()-e.startTS;if(t.headers["trouter-client"]=JSON.stringify({cd:n}),this.logger.debug("response: "+JSON.stringify(t)),this.socket)try{this.socket.send(JSON.stringify(t)),this.connectionTracker.trackResponse(e,t,n)}catch(n){var r="unable to send data on response.end, err: "+a(n);this.logger.error(r),this.connectionTracker.sendResponseError(r,e,t)}else this.connectionTracker.sendResponseError("no socket",e,t)},e.prototype.cleanupSocket=function(){if(this.socket){for(var e=0;e<this.socketIOEventsListened.length;e++)this.socket.removeAllListeners(this.socketIOEventsListened[e]);try{this.socket.disconnect(),this.logger.debug("cleared previous socket"),this.socket=null,this.transportType=void 0}catch(e){this.logger.error("exception in disconnecting previous socket: "+a(e))}}},e.prototype.on=function(e,t){return"log"===e&&(this.logger.logFunc=t),this.callbacks[e]||this.logger.warn("assigning a callback that is not used: "+e),this.callbacks[e]=t,this},e.prototype.close=function(){try{this.serverClosed=!0,this.socket&&(this.socket.disconnect(),this.socket=void 0),this.cancelReconnectTimeout(),this.allocRequest.cancel(),this.healthRequest.cancel(),this.allocateResult=void 0,this.allocationUri=void 0,this.authorization=void 0,this.transportType=void 0,this.connectionTracker.close()}catch(e){this.logger.error("exception in close: "+a(e))}},e.prototype.open=function(e){try{return this.allocationUri?(this.logger.error("server.open failed, already open"),null):e?(this.serverClosed=!1,this.allocationUri=e,this.stats.reconnectAttempts=0,this.allocateConnection(),this):(this.logger.error("server.open failed, invalid trouterUrl: "+e),this.connectionTracker.trackError("server","open","invalid trouterUrl: "+e),null)}catch(e){var t="exception in open: "+a(e);return this.logger.error(t),this.connectionTracker.trackError("server","open",t),null}},e.prototype.getServerState=function(){var e=new T;return e.connectionId=this.connectionId,e.connectedClientId=this.connectedClientId,e.domId=this.domId,e.url=this.allocateResult?this.allocateResult.url:"",e.surl=this.allocateResult?this.allocateResult.surl:"",e},e.prototype.applyTelemetrySettings=function(e){try{this.connectionTracker.mergeSettings(e)}catch(e){this.logger.debug("got an error while trying to apply telemetry settings "+a(e))}},e.prototype.getTelemetrySettings=function(){return JSON.parse(JSON.stringify(this.connectionTracker.eventLogSettings))},e.prototype.checkConnection=function(){this.state===D.Connected?(this.sendPing(),this.logger.debug("checkConnection: sent ping")):(this.cancelReconnectTimeout(),this.allocRequest.cancel(),this.healthRequest.cancel(),this.logger.debug("checkConnection: current trouter state - "+this.state+" triggering reconnect"),this.maybeReconnect("checkConnection",null))},e.prototype.getClientState=function(){var e="Unknown";switch(this.state){case D.Initial:e="Initial";break;case D.Connected:e="Connected";break;case D.Connecting:e="Connecting";break;case D.Disconnected:e="Disconnected";break;case D.WaitingHealthCheck:e="WaitingHealthCheck";break;default:e="Unknown"}return e},e}();t.default=P;var H}])}),define("trouterclient/lib/trouterclient",function(){}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-trouter/lib/index",["require","exports","trouterclient","swx-pubsub"],e)}(function(e,t){function a(e){return new u(e)}var n=e("trouterclient"),r=e("swx-pubsub"),i=400,s=500,o={READY:"READY",TROUTER_URL_CHANGED:"TROUTER_URL_CHANGED",AUTH:"AUTH",AUTH_SUCCESS:"AUTH_SUCCESS",AUTH_FAILURE:"AUTH_FAILURE",MESSAGE:"MESSAGE",RECONNECTING:"RECONNECTING",DISCONNECTED:"DISCONNECTED"},u=function(){function e(e){var t=this;this.messageHandlers=[],this.isStarted=!1,this.trouterEndpointUrl=null,this.eventProvider=r.build(),this.isAuthenticating=!1,this.pendingTrouterUrlPromise=null,this.start=function(){t.logProvider.log("[Trouter] open connection");if(t.isStarted){t.logProvider.warn("Trouter session already started. You are calling start twice");return}t.isStarted=!0,t.trouterServer=n["default"].createServer(null,t.populateTrouterOptions()),t.trouterServer.on("ready",t.onMessageChannelReady),t.trouterServer.on("auth",t.onMessageChannelAuthRequired),t.trouterServer.on("request",t.onIncomingMessage),t.trouterServer.on("disconnect",t.onDisconnect),t.trouterServer.on("error",t.onError),t.trouterServer.on("connect",t.onConnect),t.trouterServer.on("connecting",t.onConnecting),t.trouterServer.on("connect_failed",t.onConnectFailed),t.trouterServer.on("reconnect",t.onReconnect),t.trouterServer.on("reconnecting",t.onReconnecting),t.trouterServer.on("reconnect_failed",t.onReconnectFailed),t.trouterServer.on("log",t.onLog),t.trouterServer.open(t.settings.trouterServiceUrl)},this.stop=function(){t.logProvider.log("[Trouter] close connection"),t.isStarted=!1,t.clearMessageHandlers(),t.eventProvider.unsubscribeAll(),t.rejectPendingTrouterUrlPromise();if(t.trouterServer){var e=function(){};t.trouterServer.on("ready",e),t.trouterServer.on("auth",e),t.trouterServer.on("request",e),t.trouterServer.on("disconnect",e),t.trouterServer.on("error",e),t.trouterServer.on("connect",e),t.trouterServer.on("connecting",e),t.trouterServer.on("connect_failed",e),t.trouterServer.on("reconnect",e),t.trouterServer.on("reconnecting",e),t.trouterServer.on("reconnect_failed",e),t.trouterServer.on("log",e),t.trouterServer.close()}},this.trouterUrl=function(){return t.trouterEndpointUrl},this.getServerState=function(){return t.trouterServer.getServerState()},this.registerMessageHandler=function(e){if(t.messageHandlers.some(function(t){return t===e}))throw new Error("Registering the same handler twice is not allowed");t.messageHandlers.push(e)},this.unregisterMessageHandler=function(e){var n=t.messageHandlers.indexOf(e);n>-1&&t.messageHandlers.splice(n,1)},this.clearMessageHandlers=function(){t.messageHandlers=[]},this.getTrouterUrlAsync=function(){return t.pendingTrouterUrlPromise?t.pendingTrouterUrlPromise:t.trouterEndpointUrl&&!t.isAuthenticating?Promise.resolve(t.trouterEndpointUrl):(t.pendingTrouterUrlPromise=new Promise(function(e,n){t.pendingTrouterUrlPromiseResolveRef=e,t.pendingTrouterUrlPromiseRejectRef=n}),t.pendingTrouterUrlPromise)},this.resolvePendingTrouterUrlPromise=function(){t.pendingTrouterUrlPromise&&(t.pendingTrouterUrlPromiseResolveRef(t.trouterEndpointUrl),t.pendingTrouterUrlPromiseResolveRef=null,t.pendingTrouterUrlPromise=null)},this.rejectPendingTrouterUrlPromise=function(e){t.pendingTrouterUrlPromise&&(t.pendingTrouterUrlPromiseRejectRef(e),t.pendingTrouterUrlPromiseRejectRef=null,t.pendingTrouterUrlPromise=null)},this.setLogProvider=function(e){t.logProvider=e||{log:console.log,warn:console.warn,error:console.error,debug:console.debug,info:console.info}},this.onConnect=function(e){return t.logProvider.log("[Trouter] connect",e)},this.onConnecting=function(e){return t.logProvider.log("[Trouter] connecting",e)},this.onConnectFailed=function(e){return t.logProvider.log("[Trouter] connect failed",e)},this.onReconnect=function(e){return t.logProvider.log("[Trouter] reconnect",e)},this.onReconnectFailed=function(e){return t.logProvider.log("[Trouter] reconnect failed",e)},this.onLog=function(e){try{var n=JSON.parse(e);t.logProvider[n.level](e)}catch(r){t.logProvider.warn("onLog failed: "+r)}},this.onError=function(e){return t.logProvider.log("[Trouter] error",e)},this.onDisconnect=function(){t.logProvider.log("[Trouter] disconnected"),t.eventProvider.publish(o.DISCONNECTED),t.trouterEndpointUrl="",t.rejectPendingTrouterUrlPromise()},this.onReconnecting=function(){t.logProvider.log("[Trouter] reconnecting"),t.eventProvider.publish(o.RECONNECTING)},this.onMessageChannelAuthRequired=function(e,n){t.logProvider.log("[Trouter] auth required"),t.isAuthenticating=!0,t.skypeTokenProvider().then(function(n){var r={headers:{"X-Skypetoken":n},payload:JSON.stringify({sr:e})};return t.eventProvider.publish(o.AUTH),t.requestDispatcherProvider.post(t.settings.tpcServiceUrl,r)}).then(function(e){t.trouterUrlTtl=e.response.ttl,t.eventProvider.publish(o.AUTH_SUCCESS),n(e.response)})["catch"](function(e){t.isAuthenticating=!1,t.trouterEndpointUrl="",t.eventProvider.publish(o.AUTH_FAILURE,typeof XMLHttpRequest=="function"&&e instanceof XMLHttpRequest?e:null),t.rejectPendingTrouterUrlPromise(e)})},this.onMessageChannelReady=function(e,n){t.logProvider.log("[Trouter] ready"),t.isAuthenticating=!1,n&&(t.trouterEndpointUrl=t.trouterServer.getServerState().surl,t.eventProvider.publish(o.TROUTER_URL_CHANGED,{url:t.trouterServer.getServerState().surl,ttl:t.trouterUrlTtl})),t.eventProvider.publish(o.READY,{url:t.trouterServer.getServerState().surl,isNewUrl:n}),t.resolvePendingTrouterUrlPromise()},this.buildMessage=function(e){var n,r=null;try{n=JSON.parse(e.body),r=t.getEventIdFromRequestBody(n)}catch(i){}return{eventId:r,url:e.url,body:n,rawBody:e.body,headers:e.headers}},this.getEventIdFromRequestBody=function(e){return e&&(e.evt||e.eventId)||null},this.sendBackAcknowledgement=function(e,t,n,r){e.writeHead(t,r),e.end(n)},this.safeExecuteHandle=function(e,n){try{return e.handleMessage(n)}catch(r){return t.logProvider.warn("A trouter message handler is throwing exceptions. exception: "+r),{isHandled:!0,resultCode:s}}},this.handleMessage=function(e){var n,r={isHandled:!1,resultCode:i};if(!e)return r;for(var s=0;s<t.messageHandlers.length;s++){n=t.safeExecuteHandle(t.messageHandlers[s],e);if(n.isHandled===!0)return n}return r},this.onIncomingMessage=function(e,n){var r=t.buildMessage(e),i=t.handleMessage(r);t.sendBackAcknowledgement(n,i.resultCode,i.responseBody,i.responseHeaders)},this.settings=e.settings,this.requestDispatcherProvider=e.requestDispatcherProvider,this.skypeTokenProvider=e.skypetokenProvider,this.subscribe=this.eventProvider.subscribe.bind(this.eventProvider),this.unsubscribe=this.eventProvider.unsubscribe.bind(this.eventProvider),this.telemetryConfig=e.telemetryConfig,this.setLogProvider(e.logProvider)}return e.prototype.populateTrouterOptions=function(){var e={clientInfo:{ua:this.settings.userAgent,v:this.settings.version},ioOptions:{requireMtls:!0,"connect timeout":this.settings.connectTimeout},clientCorrelationID:this.settings.correlationId,environment:this.settings.environment,telemetrySettings:this.telemetryConfig,eventFactory:this.settings.eventFactory,eventLogger:this.settings.eventLogger};return e},e}();t.build=a}),define("swx-trouter",["swx-trouter/lib/index"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-trouter-manager/lib/index",["require","exports","swx-registrar","swx-trouter","swx-browser-globals"],e)}(function(e,t){function g(){var e=i.getWindow();l=e.setTimeout(w.bind(null,s.TROUTER_READY_TIMEOUT),v.trouterSettings.trouterReadyTimeoutInMs)}function y(){var e=i.getWindow();e.clearTimeout(l)}function b(e){var t=[];for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.forEach(function(t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}),e}function w(e,t){var n={type:e,registrationId:v.trouterSettings.registrationId};o&&o.getServerState()&&(n.connectionId=o.getServerState().connectionId,n.connectedClientId=o.getServerState().connectedClientId),b(n,t),v.actions.sendTelemetryEvent(v.trouterSettings.hostTelemetryTenantToken,s.TROUTER_INIT,n)}function E(){return(new Date).getTime()}function S(e){return Math.ceil((E()-e)/1e3)}function x(){o.subscribe("AUTH_SUCCESS",function(e){p=E(),y(),g(),w(s.AUTHENTICATION_SUCCEEDED),m=0}),o.subscribe("AUTH_FAILURE",k),o.subscribe("AUTH",L),o.subscribe("RECONNECTING",N),o.subscribe("DISCONNECTED",T),o.subscribe("READY",function(e){v.actions.logger.log("[Trouter event] ready");var t={};y(),t.isNewUrl=e.isNewUrl,e.isNewUrl?(t.authenticatedToReadyTime=S(p),v.trouterSettings.trouterUrl(e.url)):t.reconnectingToReadyTime=S(h),f&&(t.initToReadyTime=S(c),f=!1),w(s.TROUTER_READY_EVENT,t)}),o.subscribe("TROUTER_URL_CHANGED",function(e){A(e.url)}),o.start()}function T(){v.trouterSettings.trouterUrl(null)}function N(){v.actions.logger.log("[Trouter event] reconnecting"),h=E(),w(s.TROUTER_RECONNECTING)}function C(){var e=i.getWindow();e.setTimeout(function(){o.start()},Math.min(Math.pow(2,m)*1e3,6e5)),m++}function k(e){v.actions.logger.log("[Trouter event] authentication failed");var t;e&&(t={tpcFailureCode:e.status,tpcFailureText:e.statusText,tpcFailureMessage:e.responseText}),w(s.AUTHENTICATION_FAILED,t),e.status===401?(v.actions.logger.log("[Trouter event] Handling authentication failure, getting new skype token"),v.actions.getSkypeToken(!0).then(function(){C()})):(v.actions.logger.log("[Trouter event] Handling authentication failure, restarting trouter"),C())}function L(){v.actions.logger.log("[Trouter event] auth required"),w(s.TROUTER_AUTH_EVENT)}function A(e){u.registerEndpoint(e,v.trouterSettings.registrationId)}function O(e){v.actions.logger.log("[Trouter event] endpoint registered");var t={},n=e?s.RENEWAL:s.NEW_CONNECTION;a&&(t.initToRegisteredTime=S(c),a=!1),v.actions.registrationCallback&&v.actions.registrationCallback(!0),w(n,t)}function M(e){v.actions.logger.log("[Trouter event] endpoint registration failed");var t;e&&(t={registrarFailureCode:e.status,registrarFailureMessage:e.responseText}),v.actions.registrationCallback&&v.actions.registrationCallback(!1),w(s.ENDPOINT_REGISTRATION_FAILED,t)}function _(e){return v=e,o=r.build({settings:{trouterServiceUrl:v.trouterSettings.trouterServiceUrl,tpcServiceUrl:v.trouterSettings.tpcServiceUrl,connectTimeout:v.trouterSettings.trouterConnectTimeoutInMs,version:v.trouterSettings.version,userAgent:v.trouterSettings.productName,correlationId:v.trouterSettings.sessionId,environment:v.trouterSettings.environment,eventLogger:v.telemetryConfig.eventLogger,eventFactory:v.telemetryConfig.eventFactory},skypetokenProvider:v.actions.getSkypeToken,requestDispatcherProvider:v.actions.requestDispatcher,telemetryConfig:v.telemetryConfig.settings,logProvider:v.actions.logger}),u=n.build({settings:{registrarServiceUrl:v.trouterSettings.registrarServiceUrl,registrarTtlInSeconds:v.trouterSettings.registrarTtlInSeconds,maxRegistrationTimeInMs:v.trouterSettings.maxRegistrationTimeInMs,registrarRefreshTimeoutInMs:v.trouterSettings.registrarRefreshTimeoutInMs,pnhAppId:v.trouterSettings.pnhAppId,pnhTemplate:v.trouterSettings.pnhTemplate,platform:v.trouterSettings.platform,platformUIVersion:v.trouterSettings.platformUIVersion},skypetokenProvider:v.actions.getSkypeToken,requestDispatcherProvider:v.actions.requestDispatcher,onRegistrationSuccess:O,onRegistrationError:M,logProvider:v.actions.logger,customRegistrationProvider:v.actions.customRegistrationProvider}),d.length>0&&d.forEach(o.registerMessageHandler),{start:x,registerMessageHandler:o.registerMessageHandler}}function D(e){o?o.registerMessageHandler(e):d.push(e)}function P(){o&&o.stop(),u&&u.unregisterEndpoint(v.trouterSettings.registrationId)}function H(){return o?o.getTrouterUrlAsync():Promise.reject(new Error("trouterServiceInstance is not yet initialized"))}var n=e("swx-registrar"),r=e("swx-trouter"),i=e("swx-browser-globals"),s={AUTHENTICATION_SUCCEEDED:"authenticationSucceeded",AUTHENTICATION_FAILED:"authenticationFailed",TROUTER_INIT:"trouterinit",TROUTER_READY_EVENT:"trouterReadyEvent",TROUTER_READY_TIMEOUT:"trouterReadyTimeout",TROUTER_AUTH_EVENT:"trouterAuthEvent",TROUTER_RECONNECTING:"trouterReconnecting",RENEWAL:"renewal",NEW_CONNECTION:"newConnection",ENDPOINT_REGISTRATION_FAILED:"endpointRegistrationFailed"},o,u,a,f,l,c,h,p,d=[],v,m=0;t.initialize=_,t.registerMessageHandler=D,t.stop=P,t.getTrouterUrlAsync=H}),define("swx-trouter-manager",["swx-trouter-manager/lib/index"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/trouter/trouter",["require","exports","swx-jskype-internal-application-instance","swx-client-info","ecs-client","../electron","jcafe-property-model","../serviceAccessLayer/requestDispatcher","swx-log-tracer","swx-trouter-manager","swx-browser-detect","swx-constants","swx-utils-common","jskype-settings-instance","swx-enums"],e)}(function(e,t){function v(){return p.isFeatureOn(c.COMMON.featureFlags.NG_CALLING)?p.settings.incomingCalls.pnhNGCTemplate:p.settings.incomingCalls.pnhTemplate}function m(){var e=p.settings.version.split(".",4);while(e.length<4)e.push("0");return e[3]=e[2],e[2]=p.settings.ecsClientCobrandTag,p.settings.platformId+"_"+e.join(".")}function g(){return new Promise(function(e,t){n.get().personsAndGroupsManager.mePerson.id.get().then(function(n){var r={clientName:d.ecsClientNames.Skype,clientVersion:m(),endpoints:p.settings.incomingCalls.trouterTelemetryEnvironment,teamName:p.settings.ecsTrouterKey,userId:n,requestTimeout:3e3};i.fetchConfig(r,e,t)},function(){t()})})}function y(){return n.get().signInManager.state()===d.loginState.SignedIn?n.get().signInManager._skypeToken():Promise.reject("User currently not signed in, can not fetch token")}function b(){var e=a.getLogger("Trouter"),t={log:e.log,info:e.info,error:e.warn,debug:e.debug,warn:e.warn};return t}function w(){return{registrationId:h.guid.create(),registrarServiceUrl:p.settings.incomingCalls.registrarServiceUrl,registrarTtlInSeconds:p.settings.incomingCalls.registrarTtlInSeconds,maxRegistrationTimeInMs:p.settings.incomingCalls.maxRegistrationTimeInMs,registrarRefreshTimeoutInMs:p.settings.incomingCalls.registrarRefreshTimeoutInMs,pnhAppId:p.settings.incomingCalls.pnhAppId,pnhTemplate:v(),platform:l["default"].getBrowserInfo().browserName,platformUIVersion:r.getBIVersion(),trouterServiceUrl:p.settings.incomingCalls.trouterServiceUrl,tpcServiceUrl:p.settings.incomingCalls.tpcServiceUrl,version:p.settings.version,trouterReadyTimeoutInMs:p.settings.incomingCalls.trouterReadyTimeoutInMs,hostTelemetryTenantToken:p.settings.telemetry.jSkypeTenantToken,trouterConnectTimeoutInMs:p.settings.incomingCalls.trouterConnectTimeoutInMs,productName:p.settings.productName,sessionId:p.settings.sessionId,environment:p.settings.environment,trouterUrl:t.trouterUrl}}function E(){return{getSkypeToken:y,logger:b(),requestDispatcher:u,customRegistrationProvider:l["default"].getBrowserInfo().isElectron?s:null,sendTelemetryEvent:n.get()._telemetryManager.sendEvent}}function S(e){return{eventLogger:n.get()._telemetryManager._getLogger(p.settings.telemetry.trouterTenantToken),eventFactory:n.get()._telemetryManager._getEventProperties,settings:e}}function x(e){var t={trouterSettings:w(),actions:E(),telemetryConfig:S(e)};return f.initialize(t)}function T(){return g().then(function(e){return x(e)},function(){return x(null)})}function N(e){f.registerMessageHandler(e)}function C(){f.stop()}function k(){return f.getTrouterUrlAsync()}var n=e("swx-jskype-internal-application-instance"),r=e("swx-client-info"),i=e("ecs-client"),s=e("../electron"),o=e("jcafe-property-model"),u=e("../serviceAccessLayer/requestDispatcher"),a=e("swx-log-tracer"),f=e("swx-trouter-manager"),l=e("swx-browser-detect"),c=e("swx-constants"),h=e("swx-utils-common"),p=e("jskype-settings-instance"),d=e("swx-enums");t.trouterUrl=o.property({value:null}),t.initialize=T,t.registerMessageHandler=N,t.stop=C,t.getTrouterUrlAsync=k}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/calling/callTimeout",["require","exports","jskype-settings-instance","swx-enums","swx-browser-globals"],e)}(function(e,t){function o(e,t){t(),u(e)}function u(e){var t=s[e.conversationId];t&&(i.getWindow().clearTimeout(t.timer),t.callStateSubscription.dispose(),delete s[e.conversationId])}function a(e){return e===r.callConnectionState.Disconnected||e===r.callConnectionState.Connected}function f(e,t){if(e.selfParticipant.audio.state()===r.callConnectionState.Notified||e.activeModalities.audio()){var f={};f.timer=i.getWindow().setTimeout(o.bind(null,e,t),n.settings.incomingCalls.connectTimeout),f.callStateSubscription=e.selfParticipant.audio.state.when(a,u.bind(null,e)),s[e.conversationId]=f}}var n=e("jskype-settings-instance"),r=e("swx-enums"),i=e("swx-browser-globals"),s={};t.callStart=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/callingServiceBase",["require","exports","swx-jskype-internal-application-instance","swx-browser-detect","jskype-settings-instance","swx-enums","jcafe-property-model","swx-constants","../../lib/services/callController","swx-util-calling-stack","../../lib/services/callRegister","../../lib/utils/chat/conversation","../../lib/modelHelpers/calling/participantHelper","../../lib/modelHelpers/propertyModelHelper","../../lib/services/trouter/trouter","../../lib/services/calling/callTimeout"],e)}(function(e,t){var n=e("swx-jskype-internal-application-instance"),r=e("swx-browser-detect"),i=e("jskype-settings-instance"),s=e("swx-enums"),o=e("jcafe-property-model"),u=e("swx-constants"),a=e("../../lib/services/callController"),f=e("swx-util-calling-stack"),l=e("../../lib/services/callRegister"),c=e("../../lib/utils/chat/conversation"),h=e("../../lib/modelHelpers/calling/participantHelper"),p=e("../../lib/modelHelpers/propertyModelHelper"),d=e("../../lib/services/trouter/trouter"),v=e("../../lib/services/calling/callTimeout"),m=function(){function e(e,t){var r=this;this.meCapabilities=n.get().personsAndGroupsManager.mePerson.capabilities,this.startEnabled=o.property({value:!0}),this.stopEnabled=o.property({value:!0}),this.acceptEnabled=o.property({value:!0}),this.rejectEnabled=o.property({value:!0}),this.isGVCOutgoingEnabled=i.isFeatureOn(u.COMMON.featureFlags.GVC_OUTGOING),this.isGroupVideoChromeLinuxEnabled=i.isFeatureOn(u.COMMON.featureFlags.PLUGINLESS_GROUP_VIDEO_CALLING_CHROME_LINUX),this.isPSTNEnabled=i.isFeatureOn(u.COMMON.featureFlags.PSTN_ENABLED),this.isPluginlessPSTNEnabled=i.isFeatureOn(u.COMMON.featureFlags.PLUGINLESS_PSTN_CALLING),this.isCallingEnabled=i.isFeatureOn(u.COMMON.featureFlags.CALLING),this.iAmInConversation=!0,this.pstnParticipantInConversation=!1,this.callStarted=o.property({readOnly:!0}),this.start=p.createCommandWithSetter(function(){return r._setMediaConnectionType(),r.resetDevicesPermission(),r.setCallToConnectingState(),r.startCallConnectTimeout(),a.placeCall(r.conversation,r.withVideo)},this.startEnabled),this.stop=o.command(this.stopCall.bind(this),this.stopEnabled),this.accept=p.createCommandWithSetter(function(){return r.resetDevicesPermission(),r.setCallToConnectingState(),r.startCallConnectTimeout(),a.acceptCall(r.conversation,r.withVideo)},this.acceptEnabled),this.reject=o.command(function(){return r.conversation._callHandler?r.conversation._callHandler.rejectCall():(h.handleParticipantLeavingStateTransition(r.conversation.selfParticipant,s.callDisconnectionReason.Busy),h.handleRemoteParticipantsLeavingStateTransition(r.conversation.participants()),Promise.resolve())},this.rejectEnabled),this._setMediaConnectionType=function(){var e=s.mediaConnectionType.Unknown;r._canHandlePluginlessCall()?e=s.mediaConnectionType.Pluginless:r.conversation._callData.isCurrentCallIncoming()&&(e=r.conversation._callData.hasIncomingNGCNotification()?s.mediaConnectionType.PluginBasedNGC:s.mediaConnectionType.PluginBasedP2P),r.conversation.mediaConnectionType(e)},this._setPSTNParticipants=function(e){r.pstnParticipantInConversation=e,r.handleCallingCommands()},this._hasPSTNParticipants=function(){return r.pstnParticipantInConversation},this._canHandlePluginlessCall=function(){var e=r.conversation._callData.isCurrentCallIncoming()&&!r.conversation._callData.hasIncomingNGCNotification();return f.get().isPluginlessCallingSupported()?e?!1:!r.isPluginlessPSTNEnabled&&(r._hasPSTNParticipants()||c.isPstnOnlyConversation(r.conversation))?!1:!0:!1},this._membershipChanged=function(e){r.iAmInConversation=e,r.handleCallingCommands()},this.conversation=e,this.withVideo=t,this.setupCallingCommands()}return e.prototype.enableCallingCommand=function(){this.startEnabled(!0),this.acceptEnabled(!0),this.stopEnabled(!0)},e.prototype.disableCallingCommand=function(e){this.startEnabled(!1,e),this.acceptEnabled(!1,e),this.stopEnabled(!1,e)},e.prototype.disableStartForPSTN=function(e){this.startEnabled(!1,e)},e.prototype.isPSTNConversation=function(){return this.pstnParticipantInConversation},e.prototype.subscribeToGroupConversation=function(){this.conversation.isGroupConversation.once(!0,this.handleCallingCommands.bind(this))},e.prototype.handleCanPlaceCallChange=function(e){e?this.handleCallingCommands():this.startEnabled(!1)},e.prototype.subscribeToCallRegisterEvents=function(){l.get().canPlaceCall.changed(this.handleCanPlaceCallChange.bind(this))},e.prototype.subscribeToMeAVCapabilities=function(){this.meCapabilities.audio.changed(this.handleCallingCommands.bind(this)),this.meCapabilities.video.changed(this.handleCallingCommands.bind(this))},e.prototype.subscribeToParticipantsCount=function(){this.conversation.participantsCount.changed(this.handleCallingCommands.bind(this))},e.prototype.subscribeToActiveConversationAVModality=function(){this.conversation.activeModalities.audio.changed(this.handleCallingCommands.bind(this)),this.conversation.activeModalities.video.changed(this.handleCallingCommands.bind(this))},e.prototype.subscribeToTrouterUrl=function(){f.get().isPluginlessCallingSupported()&&d.trouterUrl.changed(this.handleCallingCommands.bind(this))},e.prototype.isChromeOnLinux=function(){return r["default"].getSystemInfo().osName===r["default"].OPERATING_SYSTEMS.LINUX&&(r["default"].getBrowserInfo().browserName===r["default"].BROWSERS.CHROME||r["default"].getBrowserInfo().browserName===r["default"].BROWSERS.ELECTRON)},e.prototype.handleCallingCommands=function(){if(!this.isCallingEnabled)return this.disableCallingCommand(s.callingNotSupportedReasons.FeatureDisabled),!1;if(this.conversation.isGroupConversation()){if(!this.isGVCOutgoingEnabled)return this.disableCallingCommand(s.callingNotSupportedReasons.FeatureDisabled),!1;if(this.withVideo&&this.isChromeOnLinux()&&!this.isGroupVideoChromeLinuxEnabled)return this.disableCallingCommand(s.callingNotSupportedReasons.FeatureDisabled),!1}return this.isPSTNConversation()&&!this.isPSTNEnabled?(this.disableStartForPSTN(s.callingNotSupportedReasons.FeatureDisabled),!1):this.iAmInConversation?this._hasTooManyParticipants()&&!this._activeConversationModality()?(this.disableCallingCommand(s.callingNotSupportedReasons.TooManyParticipants),!1):this.meCapabilities.audio()?this.withVideo&&!this.meCapabilities.video()?(this.disableCallingCommand(this.meCapabilities.video.reason),!1):!d.trouterUrl()&&f.get().isPluginlessCallingSupported()?(this.disableCallingCommand(s.callingNotSupportedReasons.TrouterNotInitialized),!1):(this.enableCallingCommand(),l.get().canPlaceCall()||this.startEnabled(!1),undefined):(this.disableCallingCommand(this.meCapabilities.audio.reason),!1):(this.disableCallingCommand(s.callingNotSupportedReasons.NotInConversation),!1)},e.prototype.setupCallingCommands=function(){this.handleCallingCommands(),this.isCallingEnabled&&(this.subscribeToGroupConversation(),this.subscribeToCallRegisterEvents(),this.subscribeToMeAVCapabilities(),this.subscribeToParticipantsCount(),this.subscribeToActiveConversationAVModality(),this.subscribeToTrouterUrl())},e.prototype.resetDevicesPermission=function(){n.get().devicesManager.mediaCapabilities.isMicrophoneEnabled._set(!0),n.get().devicesManager.mediaCapabilities.isCameraEnabled._set(!0)},e.prototype.setCallToConnectingState=function(){this.callStarted._set(new Date),h.updateParticipantsAudioVideoState(this.conversation,s.callConnectionState.Disconnected),h.updateParticipantAudioVideoState(this.conversation.selfParticipant,s.callConnectionState.Connecting)},e.prototype.startCallConnectTimeout=function(){var e=this;v.callStart(this.conversation,function(){e.stopCall(s.callDisconnectionReason.CallConnectTimeout)})},e.prototype.stopCall=function(e){var t=e||s.callDisconnectionReason.Terminated;return h.updateParticipantAudioVideoState(this.conversation.selfParticipant,s.callConnectionState.Disconnecting,t),a.endCall(this.conversation,t)},e}();t.__esModule=!0,t["default"]=m});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/audioService",["require","exports","jcafe-property-model","jskype-settings-instance","swx-enums","./callingServiceBase"],e)})(function(e,t){function a(e,t){return new u(e)}var n=e("jcafe-property-model"),r=e("jskype-settings-instance"),i=e("swx-enums"),s=e("./callingServiceBase"),o=["0","1","2","3","4","5","6","7","8","9","*","#"],u=function(e){function t(t){var r=e.call(this,t,!1)||this;return r.callConnected=n.property({readOnly:!0,value:null}),r.disconnectionReason=n.property({readOnly:!0}),r.sendDtmf=n.command(r.sendDtmfCommandImpl.bind(r),r.callConnected),r.callId=n.property({readOnly:!0}),r.callHadNoMicrophone=n.property({value:!1}),r._dispose=function(){r.callConnectedSubscription.dispose(),r.callConnectingSubscription.dispose()},r.callConnectingSubscription=r.conversation.selfParticipant.audio.state.when(i.callConnectionState.Connecting,r.onCallConnecting.bind(r)),r.callConnectedSubscription=r.conversation.selfParticipant.audio.state.when(i.callConnectionState.Connected,r.onCallConnected.bind(r)),r}return __extends(t,e),t.prototype.onCallConnecting=function(e){e!==i.callDisconnectionReason.CallEscalated&&this.callConnected._set(null)},t.prototype.onCallConnected=function(e){e!==i.callDisconnectionReason.CallEscalated&&this.callConnected._set(new Date)},t.prototype.sendDtmfCommandImpl=function(e){var t=this;return new Promise(function(n,r){o.indexOf(e)!==-1?t.conversation._callHandler.sendDtmf(e).then(function(){n(e)},function(){r(e)}):r(e)})},t.prototype._hasTooManyParticipants=function(){return this.conversation.participantsCount()>=r.settings.maximumParticipantsAudio},t.prototype._activeConversationModality=function(){return this.conversation.activeModalities.audio()},t}(s["default"]);t.AudioService=u,t.build=a});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/videoService",["require","exports","jskype-settings-instance","jcafe-property-model","./callingServiceBase","swx-enums"],e)})(function(e,t){function a(e,t){return new u(e)}var n=e("jskype-settings-instance"),r=e("jcafe-property-model"),i=e("./callingServiceBase"),s=e("swx-enums"),o=function(){function e(){this.participant=r.property({value:null})}return e}();t.ActiveSpeaker=o;var u=function(e){function t(t){var n=e.call(this,t,!0)||this;return n.maxVideos=r.property(),n.videoMode=r.property({value:s.videoMode.Both}),n.activeSpeaker=new o,n}return __extends(t,e),t.prototype._hasTooManyParticipants=function(){return this.conversation.participantsCount()>=n.settings.maximumParticipantsVideo},t.prototype._activeConversationModality=function(){return this.conversation.activeModalities.video()},t}(i["default"]);t.VideoService=u,t.build=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/calling/callingFacade",["require","exports","../../../lib/telemetry/logging/callingLogTracer"],e)}(function(e,t){function s(){return i?Promise.resolve(i):Promise.reject({error:"Handler not set"})}function o(e){i=e}function u(e){var t=s().then(function(t){return t.selectCameraDevice(e)});return t["catch"](function(e){r.error("selectCameraDevice error",e)}),t}function a(e){var t=s().then(function(t){t.selectMicrophoneDevice(e)});return t["catch"](function(e){r.error("selectMicrophoneDevice error",e)}),t}function f(e){var t=s().then(function(t){t.selectSpeakerDevice(e)});return t["catch"](function(e){r.error("selectSpeakerDevice error",e)}),t}function l(){var e=s().then(function(e){return e.getPluginVersion()});return e["catch"](function(e){r.log("getPluginVersion error",e)}),e}function c(){var e=s().then(function(e){return e.getMonitorList()});return e["catch"](function(e){}),e}function h(e,t){var n=s().then(function(n){return n.getDeviceName(e,t)});return n["catch"](function(e){}),n}function p(e){var t=s().then(function(t){return t.setScreenCaptureMonitor(e)});return t["catch"](function(e){}),t}function d(e,t,n){var r=s().then(function(r){return r.getMonitorPreview(e,t,n)});return r["catch"](function(e){}),r}var n=e("../../../lib/telemetry/logging/callingLogTracer"),r=n.get(),i;t.setCallingHandler=o,t.selectCameraDevice=u,t.selectMicrophoneDevice=a,t.selectSpeakerDevice=f,t.getPluginVersion=l,t.getMonitorList=c,t.getDeviceName=h,t.setScreenCaptureMonitor=p,t.getMonitorPreview=d}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/sharedResource",["require","exports","swx-enums","jcafe-property-model","../../lib/services/calling/callingFacade"],e)}(function(e,t){function o(e,t){return new s(e,t)}var n=e("swx-enums"),r=e("jcafe-property-model"),i=e("../../lib/services/calling/callingFacade"),s=function(){function e(e,t){var s=this;this._getPreviewImage=function(e,t){return new Promise(function(r,o){if(s._type!==n.sharedResourceType.Desktop){o("Not supported");return}i.getMonitorPreview(s._id,e,t).then(r,o)})},this._type=e,this._id=t,this.type=r.property({readOnly:!0,value:e}),this.id=r.property({readOnly:!0,value:t})}return e}();t.SharedResource=s,t.build=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/screenSharingService",["require","exports","jcafe-property-model","../../lib/modelHelpers/propertyModelHelper","swx-util-calling-stack","swx-enums","../../lib/services/calling/callingFacade","../../lib/models/sharedResource"],e)}(function(e,t){function f(e){return new a(e)}var n=e("jcafe-property-model"),r=e("../../lib/modelHelpers/propertyModelHelper"),i=e("swx-util-calling-stack"),s=e("swx-enums"),o=e("../../lib/services/calling/callingFacade"),u=e("../../lib/models/sharedResource"),a=function(){function e(e){var t=this;this.startEnabled=n.property({value:!1}),this.acceptEnabled=n.property({value:!1}),this.stopEnabled=n.property({value:!1}),this.sharedResourcesInternal=n.collection(),this.shareableResourcesInternal=n.collection({get:this.getShareableResources.bind(this)}),this.sharer=n.property({value:null}),this.sharedResources=this.sharedResourcesInternal.asReadOnly(),this.shareableResources=this.shareableResourcesInternal.asReadOnly(),this.controller=n.property({value:null}),this.controlRequesters=n.collection(),this.requestControl=n.disabledCommand(),this.releaseControl=n.disabledCommand(),this.acceptControlRequest=n.disabledCommand(),this.rejectControlRequest=n.disabledCommand(),this.start=r.createCommandWithSetter(function(){return t.sharedResourcesInternal.empty(),new Promise(function(e,n){t.shareableResources.get(0).then(function(r){o.setScreenCaptureMonitor(r.id()).then(function(){t.sharedResourcesInternal.add(r),t.sharer(t.conversation.selfParticipant),t.conversation.selfParticipant.screenSharing.state._set(s.callConnectionState.Connecting),e(!0)},n)},n)})},this.startEnabled),this.accept=r.createCommandWithSetter(function(){var e=t.sharer();e&&e.screenSharing.state._set(s.callConnectionState.Connecting)},this.acceptEnabled),this.reject=n.disabledCommand(),this.stop=r.createCommandWithSetter(function(){var e=t.sharer();e&&e.screenSharing.state()!==s.callConnectionState.Disconnecting&&e.screenSharing.state()!==s.callConnectionState.Disconnected&&e.screenSharing.state._set(s.callConnectionState.Disconnecting)},this.stopEnabled),this.conversation=e,e.selfParticipant.audio.state.changed(this.handleScreenSharingState.bind(this)),this.sharer.changed(function(e){t.sharerStateSubscription&&(t.sharerStateSubscription.dispose(),t.sharerStateSubscription=null),e&&(t.sharerStateSubscription=e.screenSharing.state.changed(function(n,r,i){i&&n===s.callConnectionState.Disconnected&&t.sharer()===e&&(t.sharer(null),t.sharedResourcesInternal.empty()),t.handleScreenSharingState()})),t.handleScreenSharingState()})}return e.prototype.handleScreenSharingState=function(){var e=this.conversation.participants().some(function(e){return e.person.capabilities.screenSharing()}),t=this.conversation.selfParticipant.audio.state()==s.callConnectionState.Connected,n=i.get().isPluginlessCallingSupported();if(!e||!t||n){this.startEnabled(!1),this.stopEnabled(!1),this.acceptEnabled(!1);return}var r=this.sharer();this.startEnabled(r!==this.conversation.selfParticipant),this.stopEnabled(!!r),this.acceptEnabled(r&&r!==this.conversation.selfParticipant)},e.prototype.getShareableResources=function(){var e=this;return this.shareableResourcesInternal.empty(),this.getShareableResourcesPromise||(this.getShareableResourcesPromise=new Promise(function(t,n){o.getMonitorList().then(function(r){r&&r.length?(r.forEach(function(t){e.shareableResourcesInternal.add(u.build(s.sharedResourceType.Desktop,t.monitorId),t.monitorId)}),t(e.shareableResourcesInternal())):n("Failed to get shareable resources"),e.getShareableResourcesPromise=null},n)})),this.getShareableResourcesPromise},e}();t.ScreenSharingService=a,t.build=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/utils/chat/editMessageHandler",["require","exports","../../../lib/services/annotations/main","swx-enums"],e)}(function(e,t){function i(e,t,n){n.type()!==t.type()?o(e,t,n):u(t,n)}function s(e){return!!e.html}function o(e,t,n){n.timestamp._set(t.timestamp()),e.replaceMessage(t,n)}function u(e,t){var i,o=e.direction().toLowerCase()===r.direction.Incoming.toLowerCase();s(e)&&s(t)&&(i=t.html(),e._actualId=t._id,e.isDeleted._set(t.isDeleted()),e.isEdited._set(t.isEdited()),n["default"].updateMessageProperties(e,t),e._skypeemoteoffset&&!t.isDeleted()&&o&&!t._skypeemoteoffset&&(i=e.html().substr(0,e._skypeemoteoffset)+i),e.html._set(i))}var n=e("../../../lib/services/annotations/main"),r=e("swx-enums");t.handleMessageEdit=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/historyService",["require","exports","jcafe-property-model","lodash-compat","swx-constants","swx-chat-service/lib/constants","../../lib/utils/chat/message","../../lib/utils/chat/generator","../../lib/utils/chat/editMessageHandler","jskype-settings-instance","swx-log-tracer","swx-enums","../../lib/services/annotations/main","swx-utils-chat"],e)}(function(e,t){var n=e("jcafe-property-model"),r=e("lodash-compat"),i=e("swx-constants"),s=e("swx-chat-service/lib/constants"),o=e("../../lib/utils/chat/message"),u=e("../../lib/utils/chat/generator"),a=e("../../lib/utils/chat/editMessageHandler"),f=e("jskype-settings-instance"),l=e("swx-log-tracer"),c=e("swx-enums"),h=e("../../lib/services/annotations/main"),p=e("swx-utils-chat"),d=[c.activityType.ParticipantHistoryDisclosed,c.activityType.ParticipantJoiningEnabled,c.activityType.ParticipantTopicUpdate],v,m=function(){function e(e,t,r){var s=this;this.markAllAsReadCommandState=n.boolProperty(!0),this.historyDisclosedChainTask=n.task(),this.removeAllCommandState=n.boolProperty(!0),this._messagesWithUnseenHearts=n.collection(),this.hiddenMessageNumber=0,this.hiddenTypesMapper={},this.newChunkOfMessages=!1,this._activityItemsInternal=n.collection({subscribed:function(){},unsubscribed:this.handleActivityItemUnSubscribed.bind(this)}),this.getMoreActivityItems=n.command(this.getMoreActivityItemsCommand.bind(this),n.boolProperty(!0)),this.markAllAsRead=n.command(this.markAllAsReadCommand.bind(this),this.markAllAsReadCommandState),this.historyDisclosedCommandEnabled=n.property({value:!1}),this.isHistoryDisclosed=n.property({value:!1,set:n.command(this.setHistoryDisclosed.bind(this),this.historyDisclosedCommandEnabled)}),this.removeAll=n.command(this.removeAllCommand.bind(this),this.removeAllCommandState),this._reset=function(){s._activityItemsInternal.empty(),s.messageCache.reset(!0),s.getMoreActivityItems.enabled._set(!0)},this._removeMessage=function(e){var t=e.key()+"";s.messageCache.onItemRemoved(t),s.removeMessage(t)},this._addOutgoingMessage=function(e){return s.addMessage(e)},this._processRawMessage=function(e,t,n,r){if(!e.id)return;s.messageCache.getItem(e.id)?s.messageCache.onItemUpdated(e):n||s.messageCache.onItemAdded(e),s.processMessage(e,t,n),!t&&!n&&!r&&s.markConversationAsReadIfMessageIsSystem(e)},this._updateReadStatusFromServer=function(){s.messageCache.onConsumptionHorizonChanged(),s._activityItemsInternal().forEach(function(e){e.isRead._set(o.isMessageReadOnServer(s.conversation._consumptionHorizon,e.key(),e.timestamp().getTime()))})},this.getMessagesFromCache=function(e,t){s.messageCache.get(e).then(s.handleMessagesReceived.bind(s,e,t))["catch"](t.reject.bind(t))},this.apiHandler=t,this.conversation=r,this.messageCache=new e(t,r),v||(f.isFeatureOn(i.COMMON.featureFlags.UNREAD_MSG_LOGGING)?v=l.getLogger("unread-msgs"):v={error:function(){},warn:function(){},info:function(){},log:function(){},debug:function(){}}),this.historyDisclosedChainTask.resolve(),this.activityItems=this._activityItemsInternal.sort(this.byTimestamp),this.unreadActivityItemsCount=this.messageCache.unreadActivityItemsCount,this._unreadActivityItemsWithKeywordsCount=this.messageCache._unreadActivityItemsWithKeywordsCount,this.isGuestHostConversation=p.conversation.isGuestHostConversation(r.conversationId),this.isHidingSystemMessagesEnabled=f.isFeatureOn(i.COMMON.featureFlags.HIDE_SYSTEM_MESSAGES),this.hiddenTypesMapper[c.activityType.ParticipantHistoryDisclosed]=0,this.hiddenTypesMapper[c.activityType.ParticipantJoiningEnabled]=1}return e.prototype.markConversationAsReadIfMessageIsSystem=function(e){if(this.messageCache.unreadActivityItemsCount()===0&&!o.isMessageReadOnServer(this.conversation._consumptionHorizon,e.key,e.timestamp)&&!o.isMessageOutgoing(e)&&!o.doesMessageTypeSupportUnreadState(e)){var t=this._activityItemsInternal(e.key);t&&this.apiHandler.setConsumptionHorizonToMessage(this.conversation,t)}},e.prototype.addMessage=function(e){try{this._activityItemsInternal.add(e,e.key()+"")}catch(t){return!1}return!0},e.prototype.removeMessage=function(e){var t=this._activityItemsInternal(e+"");t&&this._activityItemsInternal.remove(e+"")},e.prototype.handleActivityItemUnSubscribed=function(){var e=this.activityItems();for(var t=0;t<e.length-1;t++)this.removeMessage(e[t].key());this.messageCache.reset(),this.getMoreActivityItems.enabled._set(!0)},e.prototype.setHistoryDisclosed=function(e){var t=this,r=n.task(),i=this.isHistoryDisclosed,s=function(){r.resolve(e)},o=function(){i()===e?r.resolve(e):t.apiHandler.historyDisclosed(t.conversation.conversationId,e,s,r.reject.bind(r))};return this.historyDisclosedChainTask.promise.then(o,o),this.historyDisclosedChainTask=r,r.promise},e.prototype.isConversationMissingConsumptionHorizon=function(){return this.conversation._consumptionHorizon.lastReadMessageId===0&&this.conversation._consumptionHorizon.lastReadMessageTimestamp===0&&this.conversation._consumptionHorizon.modificationTime===0},e.prototype.markAllAsReadCommand=function(e){var t=this;v.log("historyService.markAllAsReadCommand:",this.conversation.conversationId);var n=function(){var n=e&&e.length,r=n?e.reverse()[0]:t.activityItems().reverse()[0];if(!r)return;n?e.forEach(function(e){e.isRead()||e.isRead._set(!0)}):t._activityItemsInternal().forEach(function(e){e.isRead._set(!0)});if(!t.isConversationMissingConsumptionHorizon()&&o.isMessageReadOnServer(t.conversation._consumptionHorizon,r.key(),r.timestamp().getTime()))return;var i=!r.direction||r.direction().toLowerCase()!==c.direction.Outgoing.toLowerCase();if(i||t.messageCache.unreadActivityItemsCount()>0)v.log("historyService.setConsumptionToLastMessage:",t.conversation.conversationId),t.apiHandler.setConsumptionHorizonToMessage(t.conversation,r)},r=function(){if(t.activityItems().length===0){if(t.getMoreActivityItems.enabled())return t.getMoreActivityItems(1).then(r)}else n()};r()},e.prototype.removeAllCommand=function(){var e=this;if(this.removeAllTask)return this.removeAllTask.promise;this.removeAllTask=n.task();var t=function(){e.messageCache.reset(),e._activityItemsInternal.empty(),e.removeAllTask.resolve()};return this.removeAllTask.promise["finally"](function(){e.removeAllTask=null}),this.apiHandler.removeAllMessages(this.conversation.conversationId,t,this.removeAllTask.reject.bind(this.removeAllTask)),this.removeAllTask.promise},e.prototype.handleMessagesReceived=function(e,t,n){var r=this.activityItems.size(),i=[];n.forEach(function(e){var t=i.filter(function(t){return t.clientmessageid===e.clientmessageid&&!t.skypeeditedid&&!!e.clientmessageid});t.length||i.push(e)}),this.addMessageCollectionSync(i);var s=this.activityItems.size()-r,o=e-s;o>0&&this.messageCache.hasMoreItems()?this.getMessagesFromCache(o,t):t.resolve(),this.messageCache.hasMoreItems()||this.getMoreActivityItems.enabled._set(!1)},e.prototype.getMoreActivityItemsCommand=function(e){var t=this,r=this.getMoreActivityItemsTask;return r?r.promise:(r=this.getMoreActivityItemsTask=n.task(),this.getMoreActivityItemsTask.promise["finally"](function(){t.getMoreActivityItemsTask=null}),this.getMessagesFromCache(e,r),r.promise)},e.prototype.addMessageCollectionSync=function(e){var t=this;this.newChunkOfMessages=!0,r.forEach(e,function(e){t.processMessage(e)})},e.prototype.byTimestamp=function(e,t){return e.timestamp()<t.timestamp()},e.prototype.isContactRequestOutgoingItem=function(e){return e===c.activityType.ContactRequestOutgoing||e===c.activityType.ContactRequestOutgoingAgent},e.prototype.updateLastModificationTimestamp=function(e){if(this.isContactRequestOutgoingItem(e.type()))return;e.timestamp&&e.timestamp()>this.conversation.lastModificationTimestamp()&&(this.conversation.lastModificationTimestamp._set(e.timestamp()),this._lastMessageFromServer=e)},e.prototype.replaceMessage=function(e,t){this._removeMessage(e),this.addMessage(t)},e.prototype.applyEditIfIsNewest=function(e,t){var n=this.messageCache.getMostRecentEditForMessage(e._id);n&&t.timestamp()>=n.timestamp&&a.handleMessageEdit({replaceMessage:this.replaceMessage.bind(this)},e,t)},e.prototype.editOriginalMessageIfSomeEditAvailable=function(e){var t=this.messageCache.getMostRecentEditForMessage(e._id);if(t){var n=u.activityFromRawMessage(t,this.conversation);a.handleMessageEdit({replaceMessage:this.replaceMessage.bind(this)},e,n)}},e.prototype.addMessageWithUnseenHeart=function(e,t){var n=t.key(),r=h["default"].getLastPersonFromProperty(t,s.MESSAGE_PROPERTIES.PER_USER.EMOTIONS,i.COMMON.emotionTypes.HEART);this._messagesWithUnseenHearts(n)&&this._messagesWithUnseenHearts.remove(n);var o={id:n,timestamp:e,type:t.type,html:t.html,text:t.text,sender:t.sender,person:r,isDeleted:t.isDeleted};this._messagesWithUnseenHearts.add(o,n)},e.prototype.collectUnseenHeartsIfAny=function(e){var t=h["default"].getMessagePropertyLastTimestamp(e,s.MESSAGE_PROPERTIES.PER_USER.EMOTIONS,i.COMMON.emotionTypes.HEART),n=e.key();if(this.isMessageWithUnseenHeart(e,this.conversation))this.addMessageWithUnseenHeart(t,e);else if(this._messagesWithUnseenHearts(n)){var r=this._messagesWithUnseenHearts(n).timestamp;(!t||t<r)&&this._messagesWithUnseenHearts.remove(n)}},e.prototype.isMessageWithUnseenHeart=function(e,t){return h["default"].isMessagePropertyUnseen(e,s.MESSAGE_PROPERTIES.PER_USER.EMOTIONS,i.COMMON.emotionTypes.HEART,t._consumptionHorizon.modificationTime)},e.prototype.processMessage=function(e,t,n){var i=this,s;e.content=e.content||"";try{s=u.activityFromRawMessage(e,this.conversation)}catch(o){l.getLogger("failed-msgs").log("historyService.processMessage: failed to get activity item for message",e.id,this.conversation.conversationId,o.stack);return}if(!s)return;if(this.isGuestHostConversation&&this.isHidingSystemMessagesEnabled){if(this.shouldHideSystemMessage){if(this.authorOfHiddenMessages===s.author&&s.type()===d[this.hiddenMessageNumber]){this.hiddenMessageNumber++,this.shouldHideSystemMessage=this.hiddenMessageNumber<d.length,this.newChunkOfMessages=!1;return}this.shouldHideSystemMessage=!1}if(this.newChunkOfMessages&&s.type()===c.activityType.ParticipantJoined)this.shouldHideSystemMessage=!0,this.authorOfHiddenMessages=s.author,this.hiddenMessageNumber=0;else if(this.newChunkOfMessages&&!r.isUndefined(this.hiddenTypesMapper[s.type()])&&s.context()){this.hiddenMessageNumber=d.indexOf(s.type())+1,this.authorOfHiddenMessages=s.author,this.shouldHideSystemMessage=!0,this.newChunkOfMessages=!1;return}}this.newChunkOfMessages=!1;var f=this._activityItemsInternal(s.key()),h=function(){f._id=s._id,f.timestamp._set(s.timestamp()),i.removeMessage(f.key()),i.addMessage(f)},p=function(){var e=function(e){return e._isOriginal&&e._isOriginal()},n=function(e){return e.isDeleted&&!!e.isDeleted()?!0:e.isEdited&&!!e.isEdited()?!0:!1},r=e(f)&&e(s),o=!e(f)&&e(s),u=!n(s)&&n(f);if(s.type()!==f.type()){s.timestamp()-f.timestamp()>=0&&a.handleMessageEdit({replaceMessage:i.replaceMessage.bind(i)},f,s);return}if(u){h();return}if(r&&!t){f._updateAllProperties(s);return}if(o&&!t){f._updateAllProperties(s);return}i.applyEditIfIsNewest(f,s)},v=function(){if(s._isFromPolling)return;h(),f._updateAllProperties(s)};if(f){if(s.sender!==f.sender)return;var m=s.isEdited&&!s.isEdited()&&s.isDeleted&&!s.isDeleted(),g=s._id!==f._id,y=f._originalContent!==s._originalContent;if(m&&g&&y){v();return}p(),this.collectUnseenHeartsIfAny(f)}else if(!e.skypeeditedid){if(n===!0&&!t){this.collectUnseenHeartsIfAny(s);return}this.addMessage(s),this.editOriginalMessageIfSomeEditAvailable(s)}this.updateLastModificationTimestamp(s)},e}();t.__esModule=!0,t["default"]=m}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/file",["require","exports","swx-jskype-internal-application-instance","jcafe-property-model","swx-constants","swx-enums","jskype-settings-instance","../../lib/utils/chat/generator","../../lib/services/asyncMedia/main","swx-telemetry-buckets","swx-i18n"],e)}(function(e,t){function h(e,t){return new c(e,t)}var n=e("swx-jskype-internal-application-instance"),r=e("jcafe-property-model"),i=e("swx-constants"),s=e("swx-enums"),o=e("jskype-settings-instance"),u=e("../../lib/utils/chat/generator"),a=e("../../lib/services/asyncMedia/main"),f=e("swx-telemetry-buckets"),l=e("swx-i18n"),c=function(){function e(e,t){var c=this;this.name=r.property({readOnly:!0}),this.size=r.property({readOnly:!0,value:0}),this.icon=r.property({readOnly:!0}),this.progress=r.property({readOnly:!0,value:0}),this.state=r.property({readOnly:!0}),this.cancel=r.disabledCommand(),this.pause=r.disabledCommand(),this.resume=r.disabledCommand(),this._send=function(e){e.isImage=function(){var t=["image/png","image/x-png","image/jpeg"];return t.some(function(t){return e.type&&e.type===t})};var t=r.task(),h,p=e.isImage(),d=function(){h.status._set(s.activityStatus.Succeeded),c.state._set(s.fileUploadState.Sent),t.resolve(),w(!0)},v=function(e){h.status._set(s.activityStatus.Failed),c.state._set(s.fileUploadState.Failed),t.reject(e),w(!1,e)},m=function(e,t){h.shouldAbort()&&t.abort(),e.lengthComputable&&(h.progress(e.loaded/e.total*100),c.progress._set(h.progress()))},g=function(t){c.icon._set(t);if(e.isImage()){var n=t.match(/(.+)(\/.+\/.+)$/i)[1];h._uri=n,h.thumbnailUrl.get()}},y=function(){var e=function(e){h=u.outgoingPictureActivityItem(c.conversation),c.conversation.historyService._addOutgoingMessage(h);if(e.size>i.COMMON.fileTransfer.MAX_PHOTO_SIZE){v("Upload file size is too big");return}a.get().sendFile(c.conversation.conversationId,e,m,g).then(t,v)},t=function(e){h.documentId._set(e),c.apiHandler.sendPhotoSharingMessage(c.conversation,h,e,c.name(),d,v)};return{send:e}},b=function(){var e=function(e){var n=o.isFeatureOn(i.COMMON.featureFlags.FILE_TRANSFER_ENABLED);if(!n){var r=l.localization.fetch({key:"file_transfer_upload_not_supported"});h=u.outgoingTextMessageActivityItem({content:r},c.conversation),c.conversation.historyService._addOutgoingMessage(h),v("Feature is disabled");return}h=u.outgoingFileActivityItem(e,c.conversation),c.conversation.historyService._addOutgoingMessage(h);if(e.size>i.COMMON.fileTransfer.MAX_FILE_SIZE){v("Upload file size is too big");return}a.get().sendFile(c.conversation.conversationId,e,m,g).then(t,v)},t=function(e){h.documentId._set(e),c.apiHandler.sendFileTransferMessage(c.conversation,h,e,c.name(),c.size(),d,v)};return{send:e}},w=function(e,t){var r=n.get()._telemetryManager,s=i.COMMON.telemetry.chat.FILE_TRANSFER,u=c.name().match(/[0-9a-z]+$/i)[0].toLowerCase(),a={success:e,type:u,fileTypeGroup:f.getFileTypeGroup(u),size:c.size()};t&&(a.reason=t),r.sendEvent(o.settings.telemetry.jSkypeTenantToken,s,a)};c.initFileProperties(e);var E=p?y():b();return E.send(e),t.promise},this.apiHandler=t,this.conversation=e}return e.prototype.initFileProperties=function(e){this.name._set(e.name),this.size._set(e.size),this.state._set(s.fileUploadState.Uploading)},e}();t.File=c,t.build=h}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/fileTransferService",["require","exports","jcafe-property-model","../../lib/models/file","../../lib/services/asyncMedia/main"],e)}(function(e,t){function o(e,t){return new s(e,t)}var n=e("jcafe-property-model"),r=e("../../lib/models/file"),i=e("../../lib/services/asyncMedia/main"),s=function(){function e(e,t){this.files=n.collection(),this.apiHandler=t,this.conversation=e,this.send=n.command(this.sendCommand.bind(this),this.conversation.activeModalities.chat),this.remove=n.command(this.removeCommand.bind(this),this.conversation.activeModalities.chat)}return e.prototype.sendCommand=function(e){var t=this,i=[];return Array.prototype.forEach.call(e,function(e){var n=r.build(t.conversation,t.apiHandler);i.push(n._send(e)),t.files.add(n)}),n.task.waitAll(i)},e.prototype.removeCommand=function(e){return i.get().deleteFile(e)},e}();t.FileTransferService=s,t.build=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/calling/autoCalling",["require","exports","swx-jskype-internal-application-instance","../../../lib/services/callController","jskype-settings-instance","swx-util-calling-stack","swx-constants","swx-enums","swx-utils-common","../../../lib/telemetry/logging/callingLogTracer","jcafe-property-model","reqwest","swx-browser-globals"],e)}(function(e,t){function v(e){return new d(e)}var n=e("swx-jskype-internal-application-instance"),r=e("../../../lib/services/callController"),i=e("jskype-settings-instance"),s=e("swx-util-calling-stack"),o=e("swx-constants"),u=e("swx-enums"),a=e("swx-utils-common"),f=e("../../../lib/telemetry/logging/callingLogTracer"),l=e("jcafe-property-model"),c=e("reqwest"),h=e("swx-browser-globals"),p=f.get(),d=function(){function e(e){var t=this;this.autoCallPayloadHandled=!1,this.isActive=!1,this.autoCallingSubs=[],this.shellAppCanJoin=l.boolProperty(!1),this.autoCallingMode=function(){return t.autoCallingModeInternal},this.partnerId=function(){return t.partnerIdInternal},this.callId=function(){return t.callIdInternal},this.reset=function(e){p.log("[AutoCall] reset, current autoCall()",t.conversation.autoCall()),t.conversation.autoCall()&&(t.conversation.autoCall(!1,e),t.sendTelemetry(o.COMMON.telemetry.autoCalling.AUTO_CALL_ENDED,{reason:e||"unknown",participantsCount:t.conversation.participantsCount()}),t.autoCallingModeInternal=undefined,t.partnerIdInternal=undefined,t.callIdInternal=undefined,!t.isActive&&t.autoCallRejectRef&&t.autoCallRejectRef({reason:e,message:"Autocall failed, reason:"+e,type:o.COMMON.callingErrors.AUTO_CALL_FAILED}),t.isActive=!1,n.get()._telemetryManager.setCommonProperty("autoCalling",!1))},this.handleAutoCall=function(){var e=new Promise(function(e,n){var r=function(){t.isActive=!0,t.clearSubscriptions(),e(t.conversation)};if(!i.isFeatureOn(o.COMMON.featureFlags.AUTO_CALLING)){p.log("AutoCalling is disabled, return conversation"),r();return}if(!t.conversation.autoCall()){r();return}t.autoCallRejectRef=n,p.log("AutoCalling handling, autoCall:",t.conversation.autoCall());var u=function(){t.sendTelemetry(o.COMMON.telemetry.autoCalling.ATTEMPT_TO_JOIN),t.isActive=!0,t.clearSubscriptions(),e(t.conversation)},a=function(){t.sendTelemetry(o.COMMON.telemetry.autoCalling.ATTEMPT_TO_JOIN),t.isActive=!0,e(t.conversation)},f=function(e){p.log("AutoCalling, waiting for participants, currently",t.conversation.participants().length),t.conversation.participants().length?e():(t.autoCallingSubs.push(t.conversation.participants.subscribe()),t.autoCallingSubs.push(t.conversation.participants.added(e)))},l=function(){p.log("AutoCalling, handling in parent window"),f(function(){t.clearSubscriptions(),t.conversation._callHandler.joinCall(!0)}),a()},c=function(){p.log("AutoCalling, handling in shellapp, can join:",t.shellAppCanJoin()),t.autoCallingSubs.push(t.shellAppCanJoin.once(!0,u))},d=function(){p.log("AutoCalling, handling standard plugin call"),f(u)};t.conversation.autoCall()&&(h.getWindow().shellApp?(c(),t.setupAutoCallTimeout()):s.get().isInBrowserCallingSupported()?s.get().isInBrowserCallingSupported()&&(d(),t.setupAutoCallTimeout()):l())});return e["catch"](function(e){t.sendTelemetry(o.COMMON.telemetry.autoCalling.AUTO_CALL_HANDLING_ERROR),p.error("Error while handling auto calling promise:",e)}),e},this.setupAutoCalling=function(e,r,i){if(t.autoCallingModeInternal||t.partnerIdInternal||t.callIdInternal)throw new Error("Auto-calling has already been set up");n.get()._telemetryManager.setCommonProperty("autoCalling",t.partnerIdInternal=r),n.get()._telemetryManager.setCommonProperty("autoCallId",t.callIdInternal=i),n.get()._telemetryManager.setCommonProperty("autoCallMode",t.autoCallingModeInternal=e),t.conversation.autoCall(!0)},this.setupMeeting=function(e,n){var r;if(!i.isFeatureOn(o.COMMON.featureFlags.AUTO_CALLING))return p.log("AutoCalling is disabled"),undefined;if(t.autoCallPayloadHandled||h.getWindow().shellApp)return p.warn("Cant update meeting details, previous message was handled or in shell app"),undefined;try{r=JSON.parse(n)}catch(s){return t.sendTelemetry(o.COMMON.telemetry.autoCalling.AUTO_CALL_PAYLOAD_INVALID),p.log("Unable to parse autoCallPayload",n),undefined}return t.matchAutoCallWithConversation(e)?(p.log("Setup autoCalling",e.conversationId,r),t.autoCallPayloadHandled=!0,t.setupAutoCalling(r.Mode,r.PartnerService,r.CallId),r.Mode===o.COMMON.autoCallingMode.call?(t.sendTelemetry(o.COMMON.telemetry.autoCalling.HOST_JOINED),e.selfParticipant.audio.state.once(u.callConnectionState.Connecting,function(){t.callbackAutoCallingService(e,r)})):t.sendTelemetry(o.COMMON.telemetry.autoCalling.PARTICIPANT_JOINED),undefined):!1},this.conversation=e}return e.prototype.sendTelemetry=function(e,t){var r=t||{};r.eventName=e,r.mode=this.autoCallingModeInternal,r.partnerId=this.partnerIdInternal,r.callId=this.callIdInternal,p.log("[AutoCall] telemetry sent",r),n.get()._telemetryManager.sendEvent(i.settings.telemetry.jSkypeTenantToken,o.COMMON.telemetry.autoCalling.MASTER_EVENT,r)},e.prototype.handleAutoCallTimeout=function(){this.isActive?this.conversation.selfParticipant.audio.state()!==u.callConnectionState.Connected&&(this.reset(u.callDisconnectionReason.AutoCallTimeout),r.endCall(this.conversation)):(this.reset(u.callDisconnectionReason.AutoCallTimeout),r.abortAutoCall(this.conversation))},e.prototype.setupAutoCallTimeout=function(){h.getWindow().setTimeout(this.handleAutoCallTimeout.bind(this),i.settings.autoCalling.callTimeout)},e.prototype.handleServiceFailure=function(){var e=this;h.getWindow().setTimeout(function(){e.reset(u.callDisconnectionReason.AutoCallFailed),r.abortAutoCall(e.conversation)},i.settings.autoCalling.serviceFailureTimeout)},e.prototype.callbackAutoCallingService=function(e,t){var n=this,r=JSON.stringify({host:e.selfParticipant.person.id(),payload:t.Token});p.log("AutoCalling service response:",r),c.compat({url:t.CallbackUrl,crossOrigin:!0,dataType:"json",data:r,method:"PUT",contentType:"application/json",error:function(e){p.log("AutoCalling service error",e),n.handleServiceFailure()},success:function(e){p.log("AutoCalling service success",e)}})},e.prototype.clearSubscriptions=function(){this.autoCallingSubs.forEach(function(e){return e&&e.dispose()}),this.autoCallingSubs=[]},e.prototype.matchAutoCallWithConversation=function(e){var t=a.sessionStorage.get(o.COMMON.autoCallingThreadId);return t===e.conversationId?(p.log("[AutoCall] conversation with auto call matched"),a.sessionStorage.remove(o.COMMON.autoCallingThreadId),!0):(p.log("[AutoCall] can not match conversation with auto call, ignoring"),!1)},e}();t.AutoCallingService=d,t.build=v}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/utils/ecsUtils",["require","exports","lodash-compat"],e)}(function(e,t){function i(e){var t=e.version.split(".",4);while(t.length<4)t.push("0");return t[3]=t[2],t[2]=e.ecsClientCobrandTag,r+"_"+t.join(".")}function s(e){return n.isString(e.ecsHosts)?JSON.parse(e.ecsHosts):e.ecsHosts||[]}function o(e){return e.initParams&&e.initParams.apiKey?e.initParams.apiKey:undefined}var n=e("lodash-compat"),r=908;t.getClientVersion=i,t.getHosts=s,t.getApiKey=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/spaces",["require","exports","swx-jskype-internal-application-instance","swx-enums","jcafe-property-model","ecs-client","../../lib/utils/ecsUtils","reqwest","jskype-settings-instance"],e)}(function(e,t){function c(e){l=e}function h(e){function s(t,n){var i="https://"+n.UrlGeneratorService.Host;n.UrlGeneratorService.Port!==443&&(i+=":"+n.UrlGeneratorService.Port),i+=n.UrlGeneratorService.Endpoints.Threads;var s={method:"post",url:i,dataType:"json",contentType:"application/json",headers:{"X-Skypetoken":t},data:JSON.stringify({baseDomain:n.WebLauncher.BaseUrl,threadId:e}),crossOrigin:!0};u.compat(s).then(r.resolve.bind(r),r.reject.bind(r))}function o(){r.reject(new Error("Loading of ecs configuration for spaces failed"))}var r=i.task();return n.get().signInManager._skypeToken().then(function(e){t.fetchConfig().then(s.bind(null,e),o)}),r.promise}var n=e("swx-jskype-internal-application-instance"),r=e("swx-enums"),i=e("jcafe-property-model"),s=e("ecs-client"),o=e("../../lib/utils/ecsUtils"),u=e("reqwest"),a=e("jskype-settings-instance"),f=null,l=null;t.initialize=c,t.fetchConfig=function(){if(!f){var e=o.getApiKey(l);f=new Promise(function(t,n){s.fetchConfig({clientName:r.ecsClientNames.Skype,clientVersion:o.getClientVersion(l),endpoints:o.getHosts(l),teamName:a.settings.ecsSpacesKey,queryParams:e?{apikey:e}:undefined},function(e){t(e)},function(e){n(e)})})}return f},t.getSpacesData=h}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/utils/chat/cacheBase",["require","exports","swx-constants","swx-log-tracer","jskype-settings-instance","jcafe-property-model","lodash-compat"],e)}(function(e,t){var n=e("swx-constants"),r=e("swx-log-tracer"),i=e("jskype-settings-instance"),s=e("jcafe-property-model"),o=e("lodash-compat"),u=function(){function e(e,t){var o=this;this.$unit={getCachedItems:this._getCachedItems.bind(this),getNewUnconsumedItems:this._getNewUnconsumedItems.bind(this),obtain:this._obtain.bind(this),onItemAddedOrUpdated:this._onItemAddedOrUpdated.bind(this)},this.cacheLogger=r.getLogger("Cache"),this.cache=s.collection(),this.consumed={},this.log=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];i.isFeatureOn(n.COMMON.featureFlags.UNREAD_MSG_LOGGING)&&o.cacheLogger.log.apply(o.cacheLogger,e)},this.onNewItemsLoaded=function(){o.log("onNewItemsLoaded"),o.serviceLoadTask=null},this.forAllItems=function(e){o.cache().forEach(e)},this.clean=function(e){e===void 0&&(e=null),o.log("clean:",e),e?e.forEach(function(e){o.cache.remove(e.id+"")}):o.cache.empty()},this.size=function(){return o.cache.size()},this.getItems=function(e,t){function s(){var e=[];for(var i=0;i<n.length;i++)r[i]&&e.push(n[i]);t(e)}var n=o.cache();if(!t)return n.filter(e);var r=new Array(n.length),i=n.length;return n.forEach(function(t,n){var o=!1;e(t,function(e){o||(o=!0,r[n]=e,i--,i===0&&s())})}),undefined},this.getItem=function(e){return o.cache(e+"")},this.getAllItems=function(){return o.cache()},this.replaceItem=function(e,t){o.log("replaceItem:",e,t),t+="",o.cache.remove(t),o.cacheItem(e,t)},this.cacheItem=function(e,t){if(typeof e.id=="undefined")throw new Error('Cached item has to have "id" property');o.log("Caching item:",e,t),o.cache.add(e,t+""),o._cacheItem(e,t)},this.hasMoreItems=function(){return o.getRemainingUnconsumedSize()>0||!!o._serverHasMoreItems()},this.onItemAdded=function(e){o.consumed[e.id]=!0,o._onItemAddedOrUpdated(e)},this.onItemUpdated=function(e){o._onItemAddedOrUpdated(e)},this.onItemRemoved=function(e){o.log("onItemRemoved:",e),o.cache.remove(e+""),o._onItemRemoved(e)},this.get=function(e){var t=s.task(),n=o._getCachedItems(e);return n.length===0?(o.log("No items in cache, getting them from service:",e),o.serviceLoadTask=o.serviceLoadTask||o._getItemsFromService(e),o.serviceLoadTask):(o.log("Returning items from cache:",n),t.resolve(n),o._serverHasMoreItems()&&o.getRemainingUnconsumedSize()<o.preCacheLimit&&(o.log("Not enough items in cache, get more:",o.getRemainingUnconsumedSize(),o._serverHasMoreItems()),o.serviceLoadTask=o.serviceLoadTask||o._getItemsFromService(e-n.length)),t.promise)},this.reset=function(e){e===void 0&&(e=!1),o.log("resetting:",e),e&&o._emptyCache(),o.consumed={}},this.preCacheLimit=e,this.sortingFunction=t}return e.prototype._obtain=function(){return this.serviceLoadTask=this.serviceLoadTask||this._getItemsFromService(0),this.serviceLoadTask},e.prototype._getCachedItems=function(e){var t=this.cache().filter(this.outConsumed.bind(this)).sort(this.sortingFunction),n=Math.max(0,t.length-e),r=t.slice(n);return this.consumeItems(r),r},e.prototype._getNewUnconsumedItems=function(){var e=this;if(o.isEmpty(this.consumed))return[];var t=this.cache().sort(this.sortingFunction),n=[],r=!1;return t.forEach(function(t){!r&&e.consumed[t.id]&&(r=!0),r&&!e.consumed[t.id]&&n.push(t)}),this.consumeItems(n),n},e.prototype.outConsumed=function(e){return!this.consumed[e.id]},e.prototype.getRemainingUnconsumedSize=function(){return this.cache().filter(this.outConsumed.bind(this)).length},e.prototype.consumeItems=function(e){var t=this;e.forEach(function(e){t.consumed[e.id]=!0})},e}();t.CacheBase=u});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/utils/chat/messagesCache",["require","exports","jcafe-property-model","swx-utils-chat","../../../lib/utils/chat/cacheBase","swx-chat-service","../../../lib/utils/chat/conversation","../../../lib/utils/chat/message","../../../lib/services/internalPubSub","swx-constants","lodash-compat","../../../lib/utils/chat/generator"],e)})(function(e,t){var n=e("jcafe-property-model"),r=e("swx-utils-chat"),i=e("../../../lib/utils/chat/cacheBase"),s=e("swx-chat-service"),o=e("../../../lib/utils/chat/conversation"),u=e("../../../lib/utils/chat/message"),a=e("../../../lib/services/internalPubSub"),f=e("swx-constants"),l=e("lodash-compat"),c=e("../../../lib/utils/chat/generator"),h=s.utils.sanitizer,p=10,d=50,v=d+1,m=function(e){function t(t,i){var s=e.call(this,p,r.sort.byTimestamp)||this;return s.serverHasMoreItems=!0,s.systemEvents=f.COMMON.events.system,s._updateConversationLastMessage=function(e){if(s.conversation._lastMessageRefreshed)return;var t=s.conversation.historyService.activityItems();if(e.length>0&&t.length>0){var n=l.find(e,function(e){return e.id===t[0]._id});if(!n)return;s.conversation.historyService._processRawMessage(n,!1,!1,!0),s.conversation._lastMessageRefreshed=!0}},s.unreadActivityItemsCount=n.property({readOnly:!0,value:0,get:s.unreadActivityItemsCountGetter.bind(s)}),s._unreadActivityItemsWithKeywordsCount=n.property({readOnly:!0,value:0,get:s.unreadActivityItemsCountGetterKeyword.bind(s)}),s.getOldestServerMessage=function(){var e=null;return s.forAllItems(function(t){if(s.isContactRequestMessage(t))return;if(!e||e.timestamp>t.timestamp)e=t}),e},s.onConsumptionHorizonChanged=function(){s.forAllItems(s.updateMessageReadState.bind(s)),s.updateUnreadActivityItemsCount()},s.getMostRecentEditForMessage=function(e){var t=s.getItem(e),n=function(e){return t.clientmessageid&&e.skypeeditedid===t.clientmessageid&&e.author===t.author};return t?s.getItems(n).sort(r.sort.byTimestampDescending)[0]||null:null},s.apiHandler=t,s.conversation=i,a.get().subscribe(s.systemEvents.FORCE_RESYNC,s.setHasMoreItemsOnServerFlag.bind(s)),s}return __extends(t,e),t.prototype.updateMessageReadState=function(e){if(this.isOutgoingMessage(e)){e.isUnread=!1;return}e.isUnread=!u.isMessageReadOnServer(this.conversation._consumptionHorizon,e.key,e.timestamp)},t.prototype.isUnread=function(e){return typeof e.isUnread=="undefined"&&this.updateMessageReadState(e),e.isUnread},t.prototype.isOutgoingMessage=function(e){var t=new RegExp("^4:"),n=t.test(this.conversation.conversationId);return typeof e.isOutgoing=="undefined"&&(e.isOutgoing=n||u.isMessageOutgoing(e)),e.isOutgoing},t.prototype.cacheMessages=function(e){var t=this;this.log("cacheMessages",e),e.forEach(function(e){t.log("caching and sanitizing message",e),h.message(e),e.key=o.getMessageKey(e),e.timestamp=e.timestamp||+(new Date(e.originalarrivaltime)),t.extendMessage(e),t.getItem(e.id)?(t.log("updating message",e),t.replaceItem(e,e.id)):(t.log("adding message",e),t.cacheItem(e,e.id),t.size()===1&&t.unreadActivityItemsCountGetterTask&&t.getUnreadMessagesForCounter())}),this.updateUnreadActivityItemsCount()},t.prototype.extendMessage=function(e){if(e.contactRequestType||e.pstnEventType||e.pluginFreeMessageType)return;c.extendRawMessage(e,this.conversation)},t.prototype.updateUnreadActivityItemsCount=function(){var e=this,t=[],n=this.conversation.chatService._notificationKeywords&&this.conversation.chatService._notificationKeywords.length>0,r=this.getAllUnreadMessages().filter(u.canMessageBeMarkedAsUnreadInUI);n&&(t=l.filter(r,function(t){return e.conversation.chatService.shouldNotify(t.content)})),this.log("updateUnreadActivityItemsCount",r),this.unreadActivityItemsCount._set(r.length-t.length),this._unreadActivityItemsWithKeywordsCount._set(t.length)},t.prototype.getAllUnreadMessages=function(){var e=this;return this.getItems(function(t){return t.skypeeditedid?!1:e.isUnread(t)&&!e.isOutgoingMessage(t)})},t.prototype.hasOnlyFakeMessage=function(){return this.size()>0&&!this.getOldestServerMessage()},t.prototype.getUnreadMessagesForCounter=function(){var e=this;this.log("getUnreadMessages");var t=function(){e.unreadActivityItemsCountGetterTask.promise.state()==="pending"?e.unreadActivityItemsCountGetterTask.resolve(e.unreadActivityItemsCount()):e.unreadActivityItemsCountGetterTask.promise.state()==="resolved"&&e.updateUnreadActivityItemsCount()},n=function(){var r=e.getOldestServerMessage(),i=r&&e.isUnread(r),s=e.getAllUnreadMessages().length<d;i&&s&&e._serverHasMoreItems()?e._obtain().then(n):t()},r=function(){var t=e.getAllItems();return t.forEach(function(e){return e.skypeeditedid?undefined:!1}),t.length>0};this.updateUnreadActivityItemsCount(),this.conversation._isAlive||this.getAllUnreadMessages().length>0||r()?n():t()},t.prototype.isContactRequestMessage=function(e){return e.contactRequestType},t.prototype.unreadActivityItemsCountGetter=function(){if(!this.unreadActivityItemsCountGetterTask||this.unreadActivityItemsCountGetterTask.promise.state()==="resolved")this.unreadActivityItemsCountGetterTask=n.task(),this.getUnreadMessagesForCounter();return this.unreadActivityItemsCountGetterTask.promise},t.prototype.unreadActivityItemsCountGetterKeyword=function(){var e=this;return this.unreadActivityItemsCountGetter().then(function(){return e._unreadActivityItemsWithKeywordsCount()})},t.prototype.setHasMoreItemsOnServerFlag=function(){this.serverHasMoreItems=!0},t.prototype._serverHasMoreItems=function(){return this.serverHasMoreItems},t.prototype._getItemsFromService=function(e,t){var r=this,i=n.task(),s=function(e){if(r.hasOnlyFakeMessage()){o([],!1);return}r.log("received messages from server - error"),r.onNewItemsLoaded(),i.reject(e)},o=function(t,n){r._updateConversationLastMessage(t),r.log("received messages from server",t,n),r.onNewItemsLoaded(),r.serverHasMoreItems=n,r.cacheMessages(t);var s=r._getCachedItems(e);r.log("Returning messages from server",s),i.resolve(s)};return this.apiHandler.syncMessages(this.conversation,v,o,s),i.promise},t.prototype._onItemAddedOrUpdated=function(e){this.log("_onItemAddedOrUpdated"),this.cacheMessages([e])},t.prototype._onItemRemoved=function(e){},t.prototype._cacheItem=function(e,t){},t.prototype._emptyCache=function(){var e=this;this.log("_emptyCache");var t=this.getItems(function(t){return!e.isContactRequestMessage(t)});this.clean(t)},t}(i.CacheBase);t.__esModule=!0,t["default"]=m}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/calling/pstnEventsHandler",["require","exports","swx-enums","lodash-compat"],e)}(function(e,t){function s(e){return new i(e)}var n=e("swx-enums"),r=e("lodash-compat"),i=function(){function e(e){var t=this;this.participantStateObservers={},this.subscribeToConversation=function(e){t.reset(),t.conversation=e,t.conversation.selfParticipant.audio.state.changed(t.selfParticipantsAudioStateChanged)},this.dispose=function(){t.reset()},this.reset=function(){t.participantsObserver&&t.participantsObserver.dispose(),t.conversation&&(t.conversation.participants().forEach(t.unsubscribeParticipant),t.conversation.selfParticipant.audio.state.changed.off(t.selfParticipantsAudioStateChanged)),t.participantStateObservers={},t.conversation=null},this.selfParticipantsAudioStateChanged=function(e){e===n.callConnectionState.Disconnected?(t.participantsObserver&&t.participantsObserver.dispose(),t.conversation.participants().forEach(t.unsubscribeParticipant)):e===n.callConnectionState.Connecting&&(t.participantsObserver=t.conversation.participants.observe(t.participantsChanged),t.conversation.participants().forEach(t.subscribeParticipant))},this.participantsChanged=function(e,n){r.forIn(e,function(e){t.subscribeParticipant(e)}),r.forIn(n,function(e){t.unsubscribeParticipant(e)})},this.subscribeParticipant=function(e){if(!t.isPstnEndpoint(e.audio.endpoint()))return;var n=e.person.id();if(n in t.participantStateObservers)return;var r=function(n){var r=e.audio.state.reason;t.pstnEventProcessor.process(t.conversation,e,r,n)};t.participantStateObservers[n]=r,e.audio.state.changed(r)},this.unsubscribeParticipant=function(e){var n,r;r=e.person.id(),r in t.participantStateObservers&&(n=t.participantStateObservers[r],e.audio.state.changed.off(n),delete t.participantStateObservers[r])},this.isPstnEndpoint=function(e){return/^(\+)?\d+$/.test(e)},this.pstnEventProcessor=e}return e}();t.PstnEventsHandler=i,t.build=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/calling/pstnMessageFactory",["require","exports","swx-enums","swx-utils-chat"],e)}(function(e,t){function i(e,t){return u(n.activityType.PstnInsufficientFunds,e,t)}function s(e,t){return u(n.activityType.PstnInvalidNumber,e,t)}function o(e,t){return u(n.activityType.PstnForbiddenNumber,e,t)}function u(e,t,n){var i=r.dateTime.getDate();return{id:+i,timestamp:i,pstnEventType:e,isGroup:t,participantName:n.person.displayName(),participantEndpoint:n.audio.endpoint(),isOutgoing:!0}}var n=e("swx-enums"),r=e("swx-utils-chat");t.getInsuficientFundsMessage=i,t.getInvalidNumberMessage=s,t.getForbiddenNumberMessage=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/calling/pstnActivityItemAdder",["require","exports","swx-enums","./pstnMessageFactory"],e)}(function(e,t){function s(){return new i}var n=e("swx-enums"),r=e("./pstnMessageFactory"),i=function(){function e(){}return e.prototype.process=function(e,t,r,i){i===n.callConnectionState.Disconnected&&(e.isGroupConversation()||this.isPstnOnlyConversation(e))&&this.addActivityItem(e,t,r)},e.prototype.addActivityItem=function(e,t,i){var s;switch(i){case n.callDisconnectionReason.InsufficientFunds:s=r.getInsuficientFundsMessage(e.isGroupConversation(),t);break;case n.callDisconnectionReason.InvalidNumber:s=r.getInvalidNumberMessage(e.isGroupConversation(),t);break;case n.callDisconnectionReason.EmergencyCallDenied:case n.callDisconnectionReason.ForbiddenNumber:case n.callDisconnectionReason.Refused:s=r.getForbiddenNumberMessage(e.isGroupConversation(),t)}s&&e.historyService._processRawMessage(s)},e.prototype.isPstnOnlyConversation=function(e){return e.participants.size()===1&&this.isPstnEndpoint(e.participants()[0].audio.endpoint())},e.prototype.isPstnEndpoint=function(e){return/^(\+)?\d+$/.test(e)},e}();t.build=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/conversation",["require","exports","swx-jskype-internal-application-instance","swx-browser-globals","swx-constants","jcafe-property-model","../../lib/modelHelpers/propertyModelHelper","../../lib/modelHelpers/propertyValidator","../../lib/modelHelpers/personsAndGroupsHelper","../../lib/utils/chat/parser","../../lib/modelHelpers/calling/callData","../../lib/modelHelpers/calling/internalCallTelemetry","./capabilities","./participant","./chatService","./audioService","./videoService","./screenSharingService","./historyService","./fileTransferService","../../lib/services/calling/autoCalling","../../lib/services/spaces","../../lib/utils/chat/conversation","../../lib/utils/chat/messagesCache","jskype-constants","jskype-settings-instance","swx-enums","../../lib/modelHelpers/calling/pstnEventsHandler","../../lib/modelHelpers/calling/pstnActivityItemAdder","../../lib/utils/chat/generator","../../lib/services/asyncMedia/main","swx-mri","swx-mri/lib/mriMaps","swx-utils-chat"],e)}(function(e,t){var n=e("swx-jskype-internal-application-instance"),r=e("swx-browser-globals"),i=e("swx-constants"),s=e("jcafe-property-model"),o=e("../../lib/modelHelpers/propertyModelHelper"),u=e("../../lib/modelHelpers/propertyValidator"),a=e("../../lib/modelHelpers/personsAndGroupsHelper"),f=e("../../lib/utils/chat/parser"),l=e("../../lib/modelHelpers/calling/callData"),c=e("../../lib/modelHelpers/calling/internalCallTelemetry"),h=e("./capabilities"),p=e("./participant"),d=e("./chatService"),v=e("./audioService"),m=e("./videoService"),g=e("./screenSharingService"),y=e("./historyService"),b=e("./fileTransferService"),w=e("../../lib/services/calling/autoCalling"),E=e("../../lib/services/spaces"),S=e("../../lib/utils/chat/conversation"),x=e("../../lib/utils/chat/messagesCache"),T=e("jskype-constants"),N=e("jskype-settings-instance"),C=e("swx-enums"),k=e("../../lib/modelHelpers/calling/pstnEventsHandler"),L=e("../../lib/modelHelpers/calling/pstnActivityItemAdder"),A=e("../../lib/utils/chat/generator"),O=e("../../lib/services/asyncMedia/main"),M=e("swx-mri"),_=e("swx-mri/lib/mriMaps"),D=e("swx-utils-chat"),P=i.COMMON.conversation.TOPIC_DELIMITER,H=T.PEOPLE.authorizationStates,B=null,j={admin:C.participantRole.Leader,user:C.participantRole.Attendee},F={PICTURE:"picture",AUTOCALLING:"autoCalling",JOINING_ENABLED:"joiningenabled",HISTORY_DISCLOSED:"historydisclosed"},I=function(){function e(e,t,r){var u=this;this.participantsStore=s.collection(),this.topicSubscriptions=[],this.updatingGeneratedTopic=!1,this.mePerson=n.get().personsAndGroupsManager.mePerson,this.pendingInvitationsInternal=s.collection(),this.joiningCommandEnabled=s.property({value:!1}),this.sendPollCommandEnabled=s.property({value:!1}),this.favoritingCommandEnabled=s.property({value:!1}),this.sendContactInfoCommandEnabled=s.boolProperty(!1),this.amParticipatingInConversation=!0,this.addParticipantCommandEnabled=s.property({value:!1}),this.removeParticipantCommandEnabled=s.property({value:!1}),this.joiningEnabledChainTask=s.task().resolve(),this.setFavoriteChainTask=s.task().resolve(),this.setTopicCommandProperty=s.boolProperty(!1),this.setTopicCommand=s.command(this.setTopic.bind(this),this.setTopicCommandProperty),this.pstnEventListener=k.build(L.build()),this.isFavoritesFlagOn=N.isFeatureOn(i.COMMON.featureFlags.FAVORITES_CONVERSATION_ENABLED),this.threadPropertiesUpdateSubscribers=[],this.escalatedParticipants=[],this._isAlive=!1,this.avatarUrl=s.property({value:B}),this.topic=s.property({set:this.setTopicCommand,value:""}),this.spawnedConversation=s.property({readOnly:!0}),this.uri=s.property({readOnly:!0,get:this.uriGetter.bind(this)}),this.participantsCount=this.participantsStore.size,this._topicSetEnabled=s.boolProperty(!1),this._conversationIdReady=s.boolProperty(!1),this._callPayload={},this._botsSettings={},this.autoCall=s.boolProperty(!1),this.activeModalities=new h["default"],this.lastModificationTimestamp=s.property({readOnly:!0,value:null}),this.isJoiningEnabled=s.property({value:!1,set:s.command(this.setJoiningEnabled.bind(this),this.joiningCommandEnabled)}),this.pendingInvitations=this.pendingInvitationsInternal.asWritable({add:s.command(this.addInvitationCommand.bind(this),s.boolProperty(!0)),remove:s.command(this.removeInvitationCommand.bind(this),this.activeModalities.chat)}),this.mediaConnectionType=s.property({value:C.mediaConnectionType.Unknown}),this.sendPollMessage=s.command(this.sendPollCommand.bind(this),this.sendPollCommandEnabled),this.sendContactInfo=s.command(this.sendContactInfoCommand.bind(this),this.sendContactInfoCommandEnabled),this.acknowledge=s.enabledCommand(function(){return o.createResolvedPromise()}),this._properties={},this._consumptionHorizon={lastReadMessageTimestamp:0,modificationTime:0,lastReadMessageId:0},this._callData=l.build(),this._internalCallTelemetry=c.build(),this._notificationsEnabled=s.boolProperty(!0),this._updateThreadPropertiesSubscription={add:this.addUpdateThreadPropertiesSubscription.bind(this),remove:this.removeUpdateThreadPropertiesSubscription.bind(this)},this._onlineStateChanged=function(){u.updateChatModality(),u.audioService.start.enabled._set(u.apiHandler.isOnline())},this._setCallHandler=function(e){u._callHandler=e},this._addParticipant=function(e,t){return u.addParticipant(e.id(),t,e)},this._removeParticipant=function(e){u.removeParticipant(e.id())},this._updateConsumptionHorizon=function(e){if(!e)return undefined;var t=S.parseConsumptionHorizon(e),n=!u._consumptionHorizon||u._consumptionHorizon.modificationTime<t.modificationTime;n&&(u._consumptionHorizon=t,u.historyService._updateReadStatusFromServer())},this._setGroupAvatar=function(e){if(!u.isGroup)return undefined;var t=s.task(),n=u.avatarUrl(),r,i=function(){u.avatarUrl(n),t.reject()},o=function(){r="URL@"+r,u.apiHandler.setAvatar(u.conversationId,r,t.resolve.bind(t),i)},a=function(e){r=e,u.avatarUrl(r)};return O.get().sendFile(u.conversationId,e,function(){},a,!0).then(o,i),t.promise},this._updateConsumptionHorizonModificationTime=function(){if(!u._consumptionHorizon||!u.conversationId)return undefined;u._consumptionHorizon.modificationTime=(new Date).getTime(),u.apiHandler.setConsumptionHorizon(u)},this._update=function(e){u._updateConversationProperties(e),u.isGroup&&u._updateThreadProperties(e)},this._updateIsFavorite=function(e){if(!u.isFavoritesFlagOn||!u.isGroup)return undefined;u._isFavorited._set(typeof e=="string"&&e.toLowerCase()==="true")},this._updateConversationProperties=function(e){u._updateConsumptionHorizon(e.properties.consumptionhorizon),u._updateIsFavorite(e.properties.favorite),u.chatService._setNotificationSettings(e.properties.alerts,e.properties.alertmatches),e.lastMessage&&u.historyService._processRawMessage(e.lastMessage,!0)},this._updateThreadProperties=function(e){u.updateMembers(e.members),u.updateTopic(e),u.updateJoiningOption(e),u.updateAutoCallingOption(e),u.updateHistoryDisclosedOption(e),u.updateGroupAvatar(e),u.updateJoinUri(e),u.updateBotSettingsProperties(e.botsSettings),u.notifySubscribers()},this._setCanJoinCall=function(e,t,n){u._callPayload=n,u._callHostId=t,u.activeModalities.audio._set(e),u.activeModalities.video._set(e)},this._setCanJoinNGCCall=function(e,t,n,r){u._ngcJoinUrl=n,u._ngcCorrelationId=r,u._callHostId=t,u._callPayload={},u.activeModalities.audio._set(e),u.activeModalities.video._set(e)},this._setSpawnedConversation=function(e){var t=n.get().conversationsManager._getOrCreateConversation(e);u.spawnedConversation._set(t)},this.canAddParticipant=function(){var e=u.isJoiningEnabled(),t=u.activeModalities.chat()&&!u.selfParticipant.isAnonymous()&&!u.isConversationWithEcho123();if(!u.isGroup){var n=u.participants(0)&&u.participants(0).person._authorization()===H.AUTHORIZED;u.addParticipantCommandEnabled(t&&n||e)}else u.addParticipantCommandEnabled((t||e)&&u.amParticipatingInConversation)},this.onBlockStateChange=function(){u.isGroup||u.updateChatModality()},this.apiHandler=e,this.isGroup=t,this.conversationId=r,this.participantsInternal=s.collection(t?{subscribed:this.handleParticipantsSubscribed.bind(this),unsubscribed:this.handleParticipantsUnSubscribed.bind(this)}:null),this.participants=this.participantsInternal.asWritable({add:s.command(this.addParticipantCommand.bind(this),this.addParticipantCommandEnabled),remove:s.command(this.removeParticipantCommand.bind(this),this.removeParticipantCommandEnabled)}),this.leaveConversationCommandEnabled=s.property({value:t}),this.leave=s.command(this.leaveConversationCommand.bind(this),this.leaveConversationCommandEnabled),this.isGroupConversation=s.property({readOnly:!0,value:t}),this.isFavoritesFlagOn&&(this._isFavorited=s.property({value:!1,set:s.command(this.setIsFavorite.bind(this),this.favoritingCommandEnabled)})),r&&(this._topicSetEnabled(!0),this._conversationIdReady(!0),this.canSetTopic()),this.selfParticipant=new p["default"](this.mePerson,this,e),this.historyService=new y["default"](x["default"],e,this),this.chatService=new d["default"](e,this),this.fileTransferService=b.build(this,e),this.activeModalities.chat.changed(function(e){u.canAddParticipant(),u.canRemoveParticipant(),u.canSetTopic(),u.leaveConversationCommandEnabled(t&&e),u.canSendContacts(),u.canSendPolls(),u.canFavoriteConversation()}),this.selfParticipant.role.changed(function(e){var t=e===C.participantRole.Leader;u.canRemoveParticipant(),u.canSetTopic(),u.joiningCommandEnabled(t),u.historyService.historyDisclosedCommandEnabled(t)}),this.participantsInternal.removed(function(e){e.person._authorization.changed.off(u.canAddParticipant),e.person.isBlocked.changed.off(u.onBlockStateChange),e._dispose()}),this.pstnEventListener.subscribeToConversation(this),this.audioService=v.build(this),this._autoCallingService=w.build(this),this.videoService=m.build(this),this.screenSharingService=g.build(this)}return e.prototype.createParticipant=function(e){return new p["default"](e,this,this.apiHandler)},e.prototype.createInvitation=function(){return null},e.prototype.notifySubscribers=function(){this.threadPropertiesUpdateSubscribers.forEach(function(e){typeof e=="function"&&e()})},e.prototype.addUpdateThreadPropertiesSubscription=function(e){this.threadPropertiesUpdateSubscribers.push(e)},e.prototype.removeUpdateThreadPropertiesSubscription=function(e){this.threadPropertiesUpdateSubscribers=this.threadPropertiesUpdateSubscribers.filter(function(t){return t!==e})},e.prototype.updateMembers=function(e){var t=this,n={};if(!e)return undefined;var r=!1;e.forEach(function(e){var i=M.getTypeFromKey(e.id),s=M.getId(e.id);e.contactType||(e.contactType=i),e.id=s,n[e.id]=e;var o=e.linkedMri&&e.linkedMri.indexOf(t.mePerson.id())>0;r=r||e.id===t.mePerson.id()||o}),this.setAmParticipatingInConversation(r),this.participantsStore.each(function(e){n[e.id]||t.removeParticipant(e.id)}),this.forEach(n,function(e){var r=n[e].role.toLowerCase(),i=n[e].contactType;t.addParticipant(e,j[r],null,i)})},e.prototype.updateBotSettingsProperties=function(e){if(!e)return undefined;this._botsSettings=e},e.prototype.setAmParticipatingInConversation=function(e){if(e===this.amParticipatingInConversation)return;this.amParticipatingInConversation=e,this.isFavoritesFlagOn&&this._isFavorited()&&!this.amParticipatingInConversation&&this._isFavorited(!1),this.updateChatModality(),this.updateAudioVideoAvailibility()},e.prototype.setTopic=function(e){return e.length===0?undefined:(this.apiHandler.setTopic(this.conversationId,e),e)},e.prototype.updateJoiningOption=function(e){var t=e.threadProperties&&e.threadProperties[F.JOINING_ENABLED];t&&this.isJoiningEnabled._set(t.toLowerCase()==="true")},e.prototype.updateAutoCallingOption=function(e){e.threadProperties&&e.threadProperties.autoCallingPayload&&this._autoCallingService.setupMeeting(this,e.threadProperties.autoCallingPayload)},e.prototype.updateHistoryDisclosedOption=function(e){var t=e.threadProperties&&e.threadProperties[F.HISTORY_DISCLOSED];if(t){var n=t.toLowerCase()==="true";n&&this.historyService.getMoreActivityItems.enabled._set(!0),this.historyService.isHistoryDisclosed._set(n)}},e.prototype.updateGroupAvatar=function(e){var t=e.threadProperties&&e.threadProperties[F.PICTURE];if(!t)return;var n=/^(URL@.*\.com)\//,r=t&&t.match(n);r&&(t=t.replace(r[1],N.settings.amdServiceHost),this.avatarUrl(t))},e.prototype.generateTopicFromMembers=function(e){var t=null;return e.length!==this.membersCount&&(t=e.slice(0,4).map(function(e){return M.getId(e.id)}).join(P)),t},e.prototype.updateTopic=function(e){var t;e.threadProperties&&e.threadProperties.topic&&e.threadProperties.topic!==" "?t=e.threadProperties.topic:e.members&&(t=this.generateTopicFromMembers(e.members)),this.membersCount=e.members&&e.members.length||this.membersCount;if(!t)return;if(t===this.mePerson.id()){this.topic._set("");return}var n=t.split(P),r=[];this.clearPersonTopicUpdate();for(var i=0;i<n.length;i++){var s=n[i];if(s===this.mePerson.id()||s==="...")continue;if(!this.hasParticipant(s)){this.membersCount=null,this.topic._set(f.parseTopic(t));return}r.push(s)}r.forEach(this.subscribeToPersonTopicUpdate.bind(this))},e.prototype.hasParticipant=function(e){return!!this.participantsStore(e)},e.prototype.subscribeToPersonTopicUpdate=function(e){var t=a.getPerson(e);this.topicSubscriptions.push({subscription:t.displayName.changed(this.handleParticipantNameChanged.bind(this)),person:t})},e.prototype.clearPersonTopicUpdate=function(){this.topicSubscriptions.forEach(function(e){e.subscription.dispose()}),this.topicSubscriptions=[]},e.prototype.updateChatModality=function(){var e=this.apiHandler.isOnline()&&this.amParticipatingInConversation&&!this.conversationIsBlocked()&&!this.isConversationWithEcho123();this.activeModalities.chat._set(e)},e.prototype.updateAudioVideoAvailibility=function(){this.audioService._membershipChanged(this.amParticipatingInConversation),this.videoService._membershipChanged(this.amParticipatingInConversation),this.amParticipatingInConversation||(this.activeModalities.audio._set(this.amParticipatingInConversation),this.activeModalities.video._set(this.amParticipatingInConversation))},e.prototype.isConversationWithEcho123=function(){return this.conversationId==="8:echo123"},e.prototype.conversationIsBlocked=function(){var e=this.participants(0);return e&&e.person.isBlocked()},e.prototype.setJoiningEnabled=function(e){var t=this,n=s.task(),r=this.isJoiningEnabled,i=function(){n.resolve(e)},o=function(){r()===e?n.resolve(e):t.apiHandler.joiningEnabled(t.conversationId,e,i,n.reject.bind(n))};return this.joiningEnabledChainTask.promise.then(o,o),this.joiningEnabledChainTask=n,n.promise},e.prototype.setIsFavorite=function(e,t){var n=this,r=s.task(),i=this._isFavorited,o=function(){r.resolve(e)},u=function(){!n.isFavoritesFlagOn||i()===e||!n.isGroup&&!t?r.resolve(e):n.apiHandler.setIsFavorite(n.conversationId,e,o,r.reject.bind(r))};return this.setFavoriteChainTask.promise.then(u,u),this.setFavoriteChainTask=r,r.promise},e.prototype.updateJoinUri=function(e){e.threadProperties&&e.threadProperties.joinURL&&this.uri._set(e.threadProperties.joinURL)},e.prototype.onSpacesData=function(e){this.uriGetterTask.promise.state()==="pending"&&this.uriGetterTask.resolve(e.JoinUrl)},e.prototype.uriGetter=function(){var e=this;return this.uriGetterTask||(this.uriGetterTask=s.task(),this.uri()?this.uriGetterTask.resolve(this.uri()):this.isJoiningEnabled.once(!0,function(){E.getSpacesData(e.conversationId).then(e.onSpacesData.bind(e),e.uriGetterTask.reject.bind(e.uriGetterTask))})),this.uriGetterTask.promise},e.prototype.leaveConversationCommand=function(){var e=this,t=s.task(),n=this.selfParticipant.role(),r=function(r){e.setAmParticipatingInConversation(!0),e.selfParticipant.role._set(n),t.reject(r)};return this.isFavoritesFlagOn&&this._isFavorited()&&this._isFavorited(!1),this.selfParticipant.role._set(C.participantRole.Attendee),this.setAmParticipatingInConversation(!1),this.apiHandler.removeParticipant(this.conversationId,M.getKey(this.selfParticipant.person.id(),this.selfParticipant.person._type()),t.resolve.bind(t),r),this.pstnEventListener.dispose(),this.pstnEventListener=null,t.promise},e.prototype.sendPollCommand=function(e){var t=s.task();return this.apiHandler.sendPollMessage(this,e,t.resolve.bind(t),t.reject.bind(t)),t.promise},e.prototype.sendContactInfoCommand=function(e){var t=s.task(),n=A.outgoingContactInfoActivityItem(e,this);return this.apiHandler.sendContactInfoMessage(this,n,e,t.resolve.bind(t),t.reject.bind(t)),t.promise},e.prototype.handleParticipantAddDuringCall=function(e,t){var i=this;this.escalatedParticipants.push(e),r.getWindow().clearTimeout(this.handleParticipantTimeoutHandle),this.handleParticipantTimeoutHandle=r.getWindow().setTimeout(function(){if(t){var e=[];i.escalatedParticipants.forEach(function(t){var n=a.getPerson(t);e.push(n)});var r=[i.participants(0).person].concat(e),s=D.conversation.createConversation(r,n.get().conversationsManager);s._conversationIdReady.when(!0,function(){i._callHandler.extendCall(i.escalatedParticipants,s.conversationId),i.escalatedParticipants=[]})}else i._callHandler.extendCall(i.escalatedParticipants,null),i.escalatedParticipants=[]},0)},e.prototype.addParticipantCommand=function(e){var t=this,n=e.person.id(),r=function(e){var r=s.task(),i=function(e){t.removeParticipant(n),r.reject(e)};return t.insertParticipant(e)||r.reject(),t.putParticipantIntoCache({id:n,role:e.role()}),t.conversationId&&t.apiHandler.addParticipant(t.conversationId,M.getKey(e.person.id(),e.person._type()),C.participantRole.Attendee,r.resolve.bind(r),i),r.promise};return this.selfParticipant.audio.state()===C.callConnectionState.Connected?(this._callHandler.isPluginless()?(this.isGroupConversation()&&r(e),this.handleParticipantAddDuringCall(n,!this.isGroupConversation())):this.handleParticipantAddDuringCall(n,!1),Promise.resolve()):r(e)},e.prototype.removeParticipantCommand=function(e){var t=this,n=s.task(),r=e.person.id(),i=function(i){t.participantsInternal.add(e,r),t.putParticipantIntoCache({id:r,role:e.role()}),n.reject(i)};return this.hasParticipant(r)?(this.removeParticipant(r),this.apiHandler.removeParticipant(this.conversationId,M.getKey(e.person.id(),e.person._type()),n.resolve.bind(n),i),n.promise):(n.reject(),undefined)},e.prototype.forEach=function(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n)},e.prototype.handleParticipantsSubscribed=function(){var e=this;this._isAlive=!0,this.participantsStore.each(function(t){e.participantsInternal(t.id)||e.insertParticipant(e.createParticipantForId(t.id,t.type))})},e.prototype.handleParticipantsUnSubscribed=function(){this._isAlive=!1,this.participantsInternal.empty()},e.prototype.insertParticipant=function(e){var t=this.participantsStore(e.person.id());try{t&&e.role._set(t.role),this.participantsInternal.add(e,e.person.id())}catch(n){return!1}return!0},e.prototype.shouldPreLoadParticipants=function(){return this._isAlive||!this.isGroup},e.prototype.getPersonForId=function(e,t){var n=M.getId(e);return a.getPerson(n,t)},e.prototype.createParticipantForId=function(e,t){var n=this.getPersonForId(e,t);return this.createParticipant(n)},e.prototype.putParticipantIntoCache=function(e){var t=e.id;this.hasParticipant(t)===!1?this.participantsStore.add(e,t):this.participantsStore(t).role=e.role,this.handleParticipantChangedInAVService()},e.prototype.removeParticipantFromCache=function(e){this.hasParticipant(e)&&this.participantsStore.remove(e),this.handleParticipantChangedInAVService()},e.prototype.addInvitationCommand=function(){},e.prototype.removeInvitationCommand=function(e){return this.pendingInvitationsInternal.remove(e)},e.prototype.removeParticipant=function(e){this.removeParticipantFromCache(e),this.shouldPreLoadParticipants()&&this.participantsInternal.remove(e)},e.prototype.handleParticipantNameChanged=function(){var e=this;if(this.updatingGeneratedTopic)return;this.updatingGeneratedTopic=!0,setTimeout(function(){var t=e.topicSubscriptions.map(function(e){return e.person.displayName()});e.topic._set(f.parseTopic(t.join(P))),e.updatingGeneratedTopic=!1},0)},e.prototype.addParticipant=function(e,t,n,r){var i=function(e,t){e&&e.role._set(t)},s,o,u;t=t||C.participantRole.Attendee;if(e===this.mePerson.id())this.setAmParticipatingInConversation(!0),this.selfParticipant.role._set(t),u=!0;else if(this.hasParticipant(e))s=this.participantsInternal(e),o=this.participantsStore(e),o.role!==t&&(this.putParticipantIntoCache({id:e,role:t,type:r}),i(s,t)),u=!1;else{this.putParticipantIntoCache({id:e,role:t,type:r});if(this.shouldPreLoadParticipants()||r===_.contactMriTypes.agent)n=n||this.getPersonForId(e,r),s=this.createParticipant(n),u=this.insertParticipant(s)}return this.updateChatModality(),this.isGroup||(this.participants(0).person._authorization.changed(this.canAddParticipant),this.participants(0).person.isBlocked.changed(this.onBlockStateChange)),u},e.prototype.hasPSTNParticipants=function(){var e=!1;return this.participantsStore.each(function(t){!e&&u.isPhoneNumber(t.id)&&(e=!0)}),e},e.prototype.handleParticipantChangedInAVService=function(){this.audioService._setPSTNParticipants(this.hasPSTNParticipants()),this.videoService._setPSTNParticipants(this.hasPSTNParticipants())},e.prototype.canRemoveParticipant=function(){var e=this.selfParticipant.role()===C.participantRole.Leader;this.removeParticipantCommandEnabled(e&&this.activeModalities.chat())},e.prototype.canFavoriteConversation=function(){this.favoritingCommandEnabled(!this.selfParticipant.isAnonymous()&&this.amParticipatingInConversation&&this.isFavoritesFlagOn)},e.prototype.canSetTopic=function(){this.setTopicCommandProperty(this._topicSetEnabled()&&this.selfParticipant&&(!this.selfParticipant.isAnonymous()||this.selfParticipant.role()===C.participantRole.Leader))},e.prototype.canSendContacts=function(){var e=this.activeModalities.chat(),t=N.isFeatureOn(i.COMMON.featureFlags.SEND_CONTACT_CARD_ENABLED);this.sendContactInfoCommandEnabled(e&&t)},e.prototype.canSendPolls=function(){var e=this.activeModalities.chat(),t=N.isFeatureOn(i.COMMON.featureFlags.POLLS_ENABLED);this.sendPollCommandEnabled(this.isGroup&&e&&t)},e}();t.__esModule=!0,t["default"]=I}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/searchResult",["require","exports"],e)}(function(e,t){var n=function(){function e(e){this.matches={},this.relevance=0,this.result=e}return e}();t.__esModule=!0,t["default"]=n});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/conversationsSearchQuery",["require","exports","swx-jskype-internal-application-instance","jcafe-property-model","../../lib/models/searchQuery","../../lib/models/searchResult","../../lib/modelHelpers/propertyValidator","swx-mri"],e)})(function(e,t){var n=e("swx-jskype-internal-application-instance"),r=e("jcafe-property-model"),i=e("../../lib/models/searchQuery"),s=e("../../lib/models/searchResult"),o=e("../../lib/modelHelpers/propertyValidator"),u=e("swx-mri"),a=function(e){function t(t){var n=e.call(this)||this;return n.conversationKeywords=[{key:"group",call:n.filterByGroup.bind(n)},{key:"topic",call:n.filterByTopic.bind(n)},{key:"participantsByIds",call:n.filterByParticipantsId.bind(n)}],n.getMore=r.command(n.getMoreCommand.bind(n),n.moreResultsAvailable),n.conversationsCache=t,n.conversationKeywords.forEach(function(e){n.supportedKeywords._add(e.key)}),n}return __extends(t,e),t.prototype.filterByParticipantsId=function(e,t){var r=t.trim().split(" "),i=n.get().personsAndGroupsManager.mePerson.id(),s=!e.members||e.members.length===0;r.indexOf(i)<0&&r.push(i);if(s||e.members.length!==r.length)return!1;var o=e.members.filter(function(e){return r.indexOf(u.getId(e.id))>-1});return o.length===e.members.length},t.prototype.filterByTopic=function(e,t){if(!e.threadProperties||!t)return!1;var n,r=t.split(" ");for(var i=r.length-1;i>=0;i--){var s=new RegExp("\\b"+r[i],"i");n=s.test(e.threadProperties.topic);if(!n)break}return n?!0:!1},t.prototype.filterByGroup=function(e,t){return o.isGroupConversation(e.id)===t},t.prototype.getMoreCommand=function(){var e=this,t=r.task(),i,o=function(t){var n=e.getConversationKeyword(t);if(!n)return;i=i.filter(function(t){return e.executeConversationQuery(t,n)})},u=function(){i=e.conversationsCache.getAllItems(),Object.keys(e.keywords).forEach(o),i.map(function(t){var r=new s["default"](n.get().conversationsManager._getOrCreateConversation(t.id));e.results._add(r)}),t.resolve()};return this.conversationsCache._syncAllConversations.enabled()?this.conversationsCache._syncAllConversations().then(u):u(),t.promise},t.prototype.getConversationKeyword=function(e){var t=this.conversationKeywords.filter(function(t){return t.key===e});return t.length===0?undefined:t[0]},t.prototype.executeConversationQuery=function(e,t){var n=this.keywords[t.key];return typeof n!="undefined"?t.call(e,n):!1},t}(i["default"]);t.__esModule=!0,t["default"]=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/webapiMapper/conversationLiveStateHandler",["require","exports","swx-jskype-internal-application-instance","../../../lib/utils/chat/parser","swx-browser-globals","jskype-settings-instance","swx-constants","swx-browser-detect","swx-log-tracer","lodash-compat"],e)}(function(e,t){function b(e,t){var i=e.match(p);if(!i)return;y.log("P2P Live state update",{content:e});var s=i[1],o=i[2],u=i[3],a=i[5]*h,f=i[6];if(s!==l)return;var d=r.getConversationIdFromUrl(t),v=n.get().conversationsManager._getConversation(d);if(!v){y.warn("Unable to find conversation");return}u===c?N(a,f,o,v):k(v)}function w(e,t){var r=null,f=null,l=null,c=null,h=a.getLogger("NGCBlackBar"),p=i.getWindow();if(!s.isFeatureOn(o.COMMON.featureFlags.GVC_JOINING)){h.log("conversationLiveStateHandler:updateNGCCallState: GVC Joining not supported");return}if(!s.isFeatureOn(o.COMMON.featureFlags.NG_CALLING)){h.log("conversationLiveStateHandler:updateNGCCallState: NGC caling not supported");return}if(u["default"].getBrowserInfo().browserName===u["default"].BROWSERS.SKYPE_SHELL)return;if(!t){h.log("conversationLiveStateHandler:updateNGCCallState: GVC Joining is supported but no awareness_conversationLiveState");return}var d=e,v=n.get().conversationsManager._getConversation(d);if(!v){h.log("conversationLiveStateHandler::updateNGCCallState: no conversation found","with id =   ",d);return}if(!t.awareness_conversationLiveState||t.awareness_conversationLiveState==="null"){E(v);return}if(!v.activeModalities.chat()){h.log("conversationLiveStateHandler:updateNGCCallState: The conversation is inactive (e.g. user was removed)"),E(v);return}try{var m=JSON.parse(t.awareness_conversationLiveState);r=m.conversationUrl,f=m.conversationId,l=m.groupCallInitiator,c=m.expiration}catch(y){h.error(y);return}if(r&&f){p.clearTimeout(g[v.conversationId]);var b=c*1e3-(new Date).getTime();h.log("conversationLiveStateHandler::updateNGCCallState: setting timeout for : "+b+" ms"),b>0&&(v._setCanJoinNGCCall(!0,l,r,f),g[v.conversationId]=p.setTimeout(E.bind(null,v),b))}else E(v)}function E(e){g.hasOwnProperty(e.conversationId)&&(i.getWindow().clearTimeout(g[e.conversationId]),e._setCanJoinNGCCall(!1))}function S(e){try{return JSON.parse(e)}catch(t){return null}}function x(e){return e.filter(function(e){return v.indexOf(e.VoiceStatus)!==-1})}function T(e){return f.isArray(e.Participants)?x(e.Participants).length>0:!1}function N(e,t,n,r){var i=S(t);if(u["default"].getBrowserInfo().browserName===u["default"].BROWSERS.SKYPE_SHELL)return;if(i){if(i.AccessToken===m)return;r._setCanJoinCall(T(i),n,i),C(e,r),y.log("Enabling P2P black bar")}else y.error("Unable to enable P2P black bar, wrong/missing payload")}function C(e,t){i.getWindow().clearTimeout(g[t.conversationId]),g[t.conversationId]=i.getWindow().setTimeout(k.bind(null,t),e)}function k(e){if(u["default"].getBrowserInfo().browserName===u["default"].BROWSERS.SKYPE_SHELL)return;i.getWindow().clearTimeout(g[e.conversationId]),e._setCanJoinCall(!1),y.log("Disabling P2P black bar")}var n=e("swx-jskype-internal-application-instance"),r=e("../../../lib/utils/chat/parser"),i=e("swx-browser-globals"),s=e("jskype-settings-instance"),o=e("swx-constants"),u=e("swx-browser-detect"),a=e("swx-log-tracer"),f=e("lodash-compat"),l="2",c="1",h=1e3,p=/1\/([12])\s([^ ]*)\s([01])(\s(\d*)\s(\{(.|[\r\n])*\}))?/,d={PARSING_ERROR:"Could not properly parse LiveState message !",WRONG_VERSION:"Could not properly parse LiveState message - wrong version. We need JSON payload version !",WRONG_PAYLOAD:"Could not properly parse LiveState payload !",WRONG_PARTICIPANTS_FORMAT:"Participants were not provided so live state could not be obtained !"},v=[4,6,7,8],m="NgAccessToken",g={},y=a.getLogger("P2PBlackBar");t.updateCallState=b,t.updateNGCCallState=w}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/webapiMapper/conversationDataFilter",["require","exports","../../../lib/utils/chat/conversation","../../../lib/services/webapiMapper/conversationLiveStateHandler","jskype-settings-instance","../../../lib/utils/chat/parser","swx-constants"],e)}(function(e,t){function l(e){var t=s.getConversationIdFromUrl(e.resource.conversationLink);return n.isMeConversation(t)}function c(e){return e==="Signal/Call"||e==="Signal/Flamingo"}function p(e){return new h(e)}var n=e("../../../lib/utils/chat/conversation"),r=e("../../../lib/services/webapiMapper/conversationLiveStateHandler"),i=e("jskype-settings-instance"),s=e("../../../lib/utils/chat/parser"),o=e("swx-constants"),u=o.COMMON.isTyping,a=[u.MESSAGE_TYPE.SET_TYPING,u.MESSAGE_TYPE.CLEAR_TYPING],f="Control/LiveState",h=function(){function e(e){var t=this;this.isGVCJoiningEnabled=i.isFeatureOn(o.COMMON.featureFlags.GVC_JOINING),this.eventMessages=function(e){for(var n=0;n<e.length;n++){var r=e[n],i=r.resource.messagetype;if(l(r))return;if(c(i))return;a.indexOf(i)>-1?t.dataHandlers.handleTypingControl(r):i===f?t.handleLiveStateMessage(r):t.handleAllOtherEventMessages(r)}},this.dataHandlers=e}return e.prototype.handleLiveStateMessage=function(e){this.isGVCJoiningEnabled&&r.updateCallState(e.resource.content,e.resource.conversationLink)},e.prototype.handleEventMessage=function(e){var t=this.dataHandlers["handle"+e.resourceType];t&&t.call(this.dataHandlers,e)},e.prototype.handleAllOtherEventMessages=function(e){e.type==="EventMessage"&&e.resourceType==="ThreadUpdate"&&e.resource.type==="Thread"&&r.updateNGCCallState(e.resource.id,e.resource.properties),this.handleEventMessage(e)},e}();t.ConversationDataFilter=h,t.build=p}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/webapiMapper/conversationDataHandlers",["require","exports","swx-jskype-internal-application-instance","../../../lib/utils/chat/parser","../../../lib/utils/chat/conversation","swx-constants","jskype-settings-instance","swx-chat-service","swx-mri","lodash-compat","../../utils/chat/endpointsDataProvider"],e)}(function(e,t){function d(e,t){return new p(e,t)}var n=e("swx-jskype-internal-application-instance"),r=e("../../../lib/utils/chat/parser"),i=e("../../../lib/utils/chat/conversation"),s=e("swx-constants"),o=e("jskype-settings-instance"),u=e("swx-chat-service"),a=e("swx-mri"),f=e("lodash-compat"),l=e("../../utils/chat/endpointsDataProvider"),c=u.utils.sanitizer,h=s.COMMON.isTyping,p=function(){function e(e,t){var u=this;this.handleNewMessage=function(e){c.message(e.resource,!0);var t=e.resource,a=r.getConversationIdFromUrl(t.conversationLink),f=n.get()._telemetry.messagesCollector;if(i.isPstnConversation(a)&&!o.isFeatureOn(s.COMMON.featureFlags.PSTN_ENABLED))return;t._isFromPolling=!0,l.setEndpointActiveStatusTo(t.isactive),u.conversationsManager._handleNewMessage(a,t),f.enqueueReceivedMessageInfo(t),["ThreadActivity/AddMember","ThreadActivity/DeleteMember"].indexOf(t.messagetype)!==-1&&u.apiHandler.syncThread(a)},this.handleMessageUpdate=function(e){c.message(e.resource,!0);var t=e.resource,n=r.getConversationIdFromUrl(t.conversationLink);t._isFromPolling=!0,u.conversationsManager._handleUpdatedMessage(n,t)},this.handleConversationUpdate=function(e){function t(){var t=e.resource.properties.clearedat;if(!t)return!1;var n=new Date(parseInt(t)),r=(new Date).getTime()-n.getTime();return r>=0&&r<1e4&&f.isEmpty(e.resource.lastMessage)?!0:!1}function n(e){e._isFavorited&&e._isFavorited._set(!1)}c.conversations([e.resource],!0);if(t()){var r=u.conversationsManager._getConversation(e.resource.id);if(r){n(r),u.conversationsManager.conversations.remove(r);return}}u.conversationsManager._conversationPropertiesUpdated(e.resource)},this.handleThreadUpdate=function(e){u.handleThreadSync(e.resource)},this.handleThreadSync=function(e){var t=u.transformThreadSyncToConversationUpdate(e);u.conversationsManager._threadPropertiesUpdated(t)},this.handleTypingControl=function(e){var t=r.getConversationIdFromUrl(e.resource.conversationLink),n=r.getConversationIdFromUrl(e.resource.from),i=n?a.getId(n):"",s=e.resource.messagetype===h.MESSAGE_TYPE.SET_TYPING,o=u.conversationsManager._getConversation(t);if(!o||!i)return;var f=o.participants(i);f&&f.chat._setIsTyping(s)},this.handleReadReceipt=function(e){var t=e.resource.conversationId,n=u.conversationsManager._getConversation(t);if(!n||n.isGroupConversation())return;n.participants(0).lastReadTimestamp._set(e.resource.readReceipt)},this.handleEndpointPresence=function(e){l.update(e.resource)},this.apiHandler=e,this.conversationsManager=t}return e.prototype.transformThreadSyncToConversationUpdate=function(e){var t={id:e.id,botsSettings:e.botsSettings,lastMessage:{},properties:{},threadProperties:{version:e.version},members:e.members};for(var n in e.properties)e.properties.hasOwnProperty(n)&&(t.threadProperties[n]=e.properties[n]);return t},e}();t.ConversationDataHandler=p,t.build=d}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/webapiMapper/conversationApiHandler",["require","exports","lodash-compat","swx-i18n","swx-constants","swx-enums","swx-jskype-internal-application-instance","jcafe-property-model","../../../lib/models/conversationActivityItem","../../../lib/modelHelpers/propertyValidator","../../../lib/services/internalPubSub","swx-xhr-dispatcher","../../../lib/services/serviceAccessLayer/decorations/reporting","../../../lib/services/webapi/main","swx-chat-service","swx-mri","../../../lib/services/systemCommands/main","../../../lib/services/webapiMapper/conversationDataFilter","../../../lib/services/webapiMapper/conversationDataHandlers","../../../lib/services/webapiMapper/conversationLiveStateHandler","jskype-settings-instance","../../../lib/telemetry/poll","../../../lib/utils/chat/conversation","../../../lib/utils/chat/message","../../../lib/utils/chat/generator","swx-utils-chat","swx-utils-chat","swx-utils-common","swx-utils-common","../../../lib/telemetry/messageSent","swx-log-tracer","../../utils/chat/endpointsDataProvider"],e)}(function(e,t){function I(){return w.isFeatureOn(i.COMMON.featureFlags.UNREAD_MSG_LOGGING)?O.getLogger("unread-msgs"):{log:n.noop}}var n=e("lodash-compat"),r=e("swx-i18n"),i=e("swx-constants"),s=e("swx-enums"),o=e("swx-jskype-internal-application-instance"),u=e("jcafe-property-model"),a=e("../../../lib/models/conversationActivityItem"),f=e("../../../lib/modelHelpers/propertyValidator"),l=e("../../../lib/services/internalPubSub"),c=e("swx-xhr-dispatcher"),h=e("../../../lib/services/serviceAccessLayer/decorations/reporting"),p=e("../../../lib/services/webapi/main"),d=e("swx-chat-service"),v=e("swx-mri"),m=e("../../../lib/services/systemCommands/main"),g=e("../../../lib/services/webapiMapper/conversationDataFilter"),y=e("../../../lib/services/webapiMapper/conversationDataHandlers"),b=e("../../../lib/services/webapiMapper/conversationLiveStateHandler"),w=e("jskype-settings-instance"),E=e("../../../lib/telemetry/poll"),S=e("../../../lib/utils/chat/conversation"),x=e("../../../lib/utils/chat/message"),T=e("../../../lib/utils/chat/generator"),N=e("swx-utils-chat"),C=e("swx-utils-chat"),k=e("swx-utils-common"),L=e("swx-utils-common"),A=e("../../../lib/telemetry/messageSent"),O=e("swx-log-tracer"),M=e("../../utils/chat/endpointsDataProvider"),_=d.utils.conversationMetadataStore,D=i.COMMON.isTyping,P="User",H=16,B=i.COMMON.storageKeys,j=i.COMMON.events.system,F=i.COMMON.onlineStates,q=function(){function e(e,t){var l=this;this.initializeTask=u.task(),this.unreadMessagesLogger=I(),this.queueForMessages=[],this.queuePendingState=!1,this.addConversationsCollectionTask=u.task(),this.isOnline=u.boolProperty(!0),this.init=function(){l.systemCommandsService=m.get(),l.xhrDispatcher=c.build({host:w.settings.webApiServiceHost,decorations:[h]}),l.webAPIService=p.getInstance(l.xhrDispatcher),l.bindDataEvents(),l.startPolling(),l.initializeTask.resolve()},this.reset=function(){var e=function(){l.initializeTask=u.task(),l.createEndpointTask=u.task(),l.syncRecentsTask=null,l.addConversationsCollectionTask=u.task(),l.isOnline(!0),L.sessionStorage.clear()};return l.webAPIService?l.webAPIService.reset().then(e):(e(),Promise.resolve())},this.createConversation=function(e,t,r){var i=function(n){e.activeModalities.chat._set(e.leave.enabled()),t(n)};k.async.execute(function(){e.activeModalities.chat._set(!1);var t=n.filter(e.participants(),function(e){var t=e.person;return!(v.isPstnId(t.id())&&t.id().length>H)}),s=t.map(l.participantToMember.bind(l,P));s.push(l.participantToMember("Admin",e.selfParticipant)),l.webAPIService.createConversation(s,i,r)}),e.activeModalities.chat._set(!0)},this.syncRecents=function(e,t,n){if(l.syncRecentsTask)return l.syncRecentsTask.promise;l.syncRecentsTask=u.task();var r=function(e){var t=S.getSyncStateFromResponse(e.response);l.conversationsCollectionAdded(),l.syncRecentsTask.resolve({conversations:e.response.conversations,syncState:t,hasMoreConversations:!!e.response._metadata.backwardLink,statusCode:e.request.status}),l.syncRecentsTask=null},i=function(e){l.syncRecentsTask.reject(e),l.syncRecentsTask=null},s=function(){n?l.webAPIService.syncRecentsBySyncState(n,t,r,i):l.webAPIService.syncRecents(e,t,r,i)};return l.createEndpointTask.promise.then(s),l.syncRecentsTask.promise},this.syncConversation=function(e,t,n){u.task.waitAll([l.initializeTask.promise,l.createEndpointTask.promise]).then(function(){l.webAPIService.syncConversation(e,t,n)})},this.syncThread=function(e,t,n){return t=t||function(){},n=n||function(){},new Promise(function(r,i){var s=function(){t(),r()},o=function(e){n(e),i(e)};f.isGroupConversation(e)?u.task.waitAll([l.initializeTask.promise,l.createEndpointTask.promise]).then(function(){l.webAPIService.syncThread(e,s,o)}):o(new Error("expected valid group conversation id"))})},this.sendMessage=function(e,t,r,i,s){var o=function(t){var n=t.response.OriginalArrivalTime;r.timestamp._set(new Date(n));var s=r.isEdited&&r.isEdited(),o=r.isDeleted&&r.isDeleted();!s&&!o&&l.setConsumptionHorizonToMessage(e,r),p.publish(t.request.status),a(),i()},u=function(e){p.publish(e.status),a(),s()},a=function(){var e=l.queueForMessages.shift();e?e():l.queuePendingState=!1},f=function(){l.webAPIService.postMessage(e.conversationId,c,o,u,r._id)};if(l.systemCommandsService.executeCommand(r._originalContent||t.content,e))return i(),!1;var c=T.messageForService(t),h=c.content?c.content.length:0,p=A.build(e,r,c.skypeeditedid,h);return n.isEmpty(l.queueForMessages)&&!l.queuePendingState?(f(),l.queuePendingState=!0):l.queueForMessages.push(f),!0},this.removeAllMessages=function(e,t,n){return l.webAPIService.removeAllMessages(e,t,n)},this.sendMojiMessage=function(e,t,n,r){var i=N.dateTime.getDate(),s=t+"/views/thumbnail",o=/\/([^\/]+)$/.exec(t)[1],u=w.settings.xmmFallbackUrl+"?go=webclient.xmm&amp;"+o,a={messagetype:"RichText/Media_FlikMsg",content:'<URIObject type="Video.1/Flik.1" uri="'+t+'" url_thumbnail="'+s+'">'+'To view this Moji, go to: <a href="'+u+'">'+u+"</a>"+"</URIObject>",key:String(i.getTime()),timestamp:i.getTime(),conversationModel:e},f=T.outgoingMojiActivityItem(t,a);l.sendMessage(e,a,f,n,r)},this.sendPollMessage=function(e,t,s,u){var a=N.dateTime.getDate().getTime(),f=o.get().personsAndGroupsManager.mePerson,c=JSON.parse(t),h=n.reduce(c.answers,function(e,t){return e+='<Answer value="'+C.messageSanitizer.escapeHTML(t)+'" />'},""),p=n.reduce(c.answers,function(e,t){return e+="- "+C.messageSanitizer.escapeHTML(t)+"\n"},""),d=C.messageSanitizer.escapeHTML(C.messageSanitizer.webify(c.question)),m=w.settings.pollFallbackUrl+"&amp;threadId="+e.conversationId,g=r.localization.fetch({key:"poll_fallback_link_text"}),y=r.localization.fetch({key:"poll_message_goto_text",params:{fallbackLink:'<a href="'+m+'">'+g+"</a>"}}),b="poll.1",S={messagetype:"RichText",conversationModel:e,content:'<URIObject type="'+b+'">'+"<Title>"+d+"</Title>"+"\n\n"+"<Description>"+p+"</Description>"+"\n"+y+"<Settings>"+'<MultipleChoice value="'+c.multipleChoice+'" />'+"</Settings>"+'<Question value="'+d+'" />'+"<Answers>"+h+"</Answers>"+"</URIObject>",key:String(a),timestamp:a,isMyself:!0,author:v.getKey(f.id(),f._type())},x=T.outgoingPollMessageActivityItem(S);x.html._set(S.content),l.sendMessage(e,S,x,function(){E.sendPoll(x),s()},function(){E.error(e.conversationId,undefined,b,i.COMMON.telemetry.poll.errorType.SEND),u()})},this.sendContactInfoMessage=function(e,t,n,r,i){var s=function(e){var t="<contacts>";return e.forEach(function(e){t+='<c t="s" s="'+e.id()+'" f="'+e.displayName()+'"/>'}),t+="</contacts>",t},o={messagetype:"RichText/Contacts",content:s(n),key:t.key(),timestamp:N.dateTime.getDate().getTime(),conversationModel:e};t.html._set(o.content),l.sendMessage(e,o,t,r,i)},this.sendPhotoSharingMessage=function(e,t,n,r,i,s){var o=w.settings.amdServiceHost+"/v1/objects/"+n,u=o+"/views/imgt1",a=w.settings.xmmFallbackUrl+"?go=webclient.xmm&amp;pic="+n,f={messagetype:"RichText/UriObject",content:'<URIObject type="Picture.1" uri="'+o+'" url_thumbnail="'+u+'">'+'To view this shared photo, go to: <a href="'+a+'">'+a+"</a>"+'<OriginalName v="'+r+'"/>'+'<meta type="photo" originalName="'+r+'"/>'+"</URIObject>",key:t.key(),timestamp:(new Date).getTime()};t.html._set(f.content),l.sendMessage(e,f,t,i,s)},this.sendFileTransferMessage=function(e,t,n,r,i,s,o){var u=w.settings.amdServiceHost+"/v1/objects/"+n,a=u+"/views/thumbnail",f=w.settings.xmmFallbackUrl+"?go=webclient.xmm&amp;docid="+n,c={messagetype:"RichText/Media_GenericFile",content:'<URIObject type="File.1" uri="'+u+'" url_thumbnail="'+a+'">'+"<Title>Title: "+r+"</Title>"+"<Description> Description: "+r+"</Description>"+'<a href="'+f+'"> '+f+"</a>"+'<OriginalName v="'+r+'"/>'+'<FileSize v="'+i+'"/>'+"</URIObject>",key:t.key(),timestamp:(new Date).getTime()};t.html._set(c.content),t.fileUri._set(u+"/views/original"),t.fileThumbnailUri._set(u+"/views/thumbnail"),l.sendMessage(e,c,t,s,o)},this.syncMessages=function(e,t,n,r){var i=function(){_.get(e.conversationId)?l.webAPIService.syncMessagesLoadMore(e.conversationId,t,n,r):l.webAPIService.syncMessages(e.conversationId,0,t,n,r)};l.isOnline.once(!0,function(){u.task.waitAll([l.initializeTask.promise,l.createEndpointTask.promise]).then(function(){e._requestedJoining?e._requestedJoining.promise.then(function(){i()}):i()})})},this.startPolling=function(){l.webAPIService.poll()},this.addParticipant=function(e,t,n,r,i){l.webAPIService.addParticipant(e,t,n,r,i)},this.removeParticipant=function(e,t,n,r){l.webAPIService.removeParticipant(e,t,n,r)},this.joinConversation=function(e,t){return e._requestedJoining&&e._requestedJoining.promise.state()==="pending"?Promise.reject(new Error("already joining this conversation")):(e._requestedJoining=u.task(),l.initializeTask.promise.then(function(){var n=o.get().personsAndGroupsManager.mePerson,r=function(t){t instanceof XMLHttpRequest&&(t=new Error("while joining "+e.conversationId+": "+t.response)),e._requestedJoining.reject(t)},i=function(){t?l.syncThread(e.conversationId).then(function(){e._requestedJoining.resolve()},r):(l.syncThread(e.conversationId),e._requestedJoining.resolve())};l.addParticipant(e.conversationId,v.getKey(n.id(),n._type()),s.participantRole.Attendee,i,r)}),e._requestedJoining.promise)},this.setAlerts=function(e,t,n,r,i){var s=function(){r(t&&n==="",n)},o=function(){l.webAPIService.setConversationOption(e,"alertmatches",n,s,i)};n||(n=""),l.webAPIService.setConversationOption(e,"alerts",t&&n==="",o,i)},this.setTopic=function(e,t,n,r){l.webAPIService.setThreadOption(e,"topic",t,n,r)},this.setAvatar=function(e,t,n,r){l.webAPIService.setThreadOption(e,"picture",t,n,r)},this.joiningEnabled=function(e,t,n,r){l.webAPIService.setThreadOption(e,"joiningenabled",t,n,r)},this.historyDisclosed=function(e,t,n,r){l.webAPIService.setThreadOption(e,"historydisclosed",t,n,r)},this.setConsumptionHorizonToMessage=function(e,t){var n=(new Date).getTime(),r=e.historyService.activityItems(),i=r[r.length-1],o=[s.activityType.ContactRequestOutgoing,s.activityType.ContactRequestOutgoingResend,s.activityType.ContactRequestOutgoingAgent],u;if(r.length===0){l.unreadMessagesLogger.log("apiHandler.setConsumptionHorizonToMessage in if messages are empty: ",e.conversationId);return}if(t===i)l.unreadMessagesLogger.log("apiHandler.setConsumptionHorizonToMessage in if message == lastDisplayedMessage: ",e.conversationId),u=t.timestamp().getTime();else if(t._isOriginal&&t._isOriginal())u=t.timestamp().getTime();else{var f=e.historyService.activityItems(t.key());u=f?f.timestamp().getTime():0}var c=t&&t._id&&o.indexOf(t.type())===-1;if(!c||x.isMessageReadOnServer(e._consumptionHorizon,t.key(),u)){l.unreadMessagesLogger.log("apiHandler.setConsumptionHorizonToMessage in if !isValidMessage: ",e.conversationId);return}var h=u+";"+n+";"+t.key();e._updateConsumptionHorizon(h),t instanceof a.ContactRequestActivityItem||l.setConsumptionHorizon(e)},this.setConsumptionHorizon=function(e){if(e._consumptionHorizon.lastReadMessageTimestamp===0)return;l.unreadMessagesLogger.log("apiHandler.setConsumptionHorizonToMessage calling webapi: ",e.conversationId);var t=e._consumptionHorizon.lastReadMessageTimestamp+";"+e._consumptionHorizon.modificationTime+";"+e._consumptionHorizon.lastReadMessageId;l.webAPIService.setConsumptionHorizon(e.conversationId,t,function(){})},this.setIsFavorite=function(e,t,n,r){return l.webAPIService.setIsFavorite(e,t,n,r)},this.setIsTyping=function(e,t,n,r){var i=(new Date).getTime(),s={clientmessageid:String(i),messagetype:t?D.MESSAGE_TYPE.SET_TYPING:D.MESSAGE_TYPE.CLEAR_TYPING,content:"",contenttype:"text"};l.webAPIService.postMessage(e,s,n,r)},this.conversationsManager=e,this.createEndpointTask=t||u.task(),this.dataHandler=y.build(this,e),this.filter=g.build(this.dataHandler)}return e.prototype.onOnlineStateChanged=function(e){this.isOnline(e===F.ONLINE),this.conversationsManager._onlineStateChanged()},e.prototype.resyncAll=function(){L.sessionStorage.set(B.RESURECTION_KEY,"1")},e.prototype.onWebAPIDataReceived=function(e){e.eventMessages&&(M.startingUpdate(),this.filter.eventMessages(e.eventMessages)),e.actionName==="syncThread"&&(this.dataHandler.handleThreadSync(e),b.updateNGCCallState(e.id,e.properties)),e.actionName==="endpointCreation"&&this.createEndpointTask.promise.state()==="pending"&&this.createEndpointTask.resolve()},e.prototype.bindDataEvents=function(){var e=l.get();e.subscribe("webapi:data",this.onWebAPIDataReceived.bind(this)),e.subscribe(j.FORCE_RESYNC,this.resyncAll.bind(this)),e.subscribe(j.ONLINE_STATE_CHANGED,this.onOnlineStateChanged.bind(this))},e.prototype.participantToMember=function(e,t){return{id:v.getKey(t.person.id(),t.person._type()),role:e}},e.prototype.conversationsCollectionAdded=function(){this.addConversationsCollectionTask.promise.state()==="pending"&&this.addConversationsCollectionTask.resolve()},e}();t.__esModule=!0,t["default"]=q}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/telemetry/userAnalytics",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","swx-browser-globals","swx-constants","lodash-compat"],e)}(function(e,t){function f(){var e,t,o,u;if(!r.isFeatureOn(s.COMMON.featureFlags.USERS_ANALYTICS)||a)return!1;try{a=!0,o=i.getWindow().localStorage.getItem(s.COMMON.telemetry.idleUsersAnalytics.localKeys.sidebarActivity),o&&(t=JSON.parse(o)),u=c(),e={numberOfContacts:h(u),isMau:y(t),isMauCandidate:b(t),isDauCandidate:w(t),isFirstLoadToday:E()},p(e,u),d(e),n.get()._telemetryManager.sendEvent(r.settings.telemetry.chatTenantToken,s.COMMON.telemetry.usersAnalytics.TYPE,e)}catch(f){a=!1}return undefined}function l(){a=!1}function c(){if(!n.get().personsAndGroupsManager||!n.get().personsAndGroupsManager.all.persons)return undefined;var e=n.get().personsAndGroupsManager.all.persons();return e?e:undefined}function h(e){return e?e.length:u}function p(e,t){var r,i,s=0,u=0;t&&n.get().conversationsManager&&n.get().conversationsManager._allConversations&&(r=o.filter(t,function(e){var t,n,r=new Date;return e._birthday&&e._birthday()?(n=(new Date(2016,r.getMonth(),r.getDate())).getTime()-2592e6,t=(new Date(2016,(new Date(e._birthday())).getMonth(),(new Date(e._birthday())).getDate())).getTime(),t>=n&&t<=r.getTime()):!1}),o.forEach(r,function(e){i=o.find(n.get().conversationsManager._allConversations(),function(t){return t.id==="8:"+e.id()}),i?s++:u++})),e.congratulationCandidates=s,e.missedCongratulations=u}function d(e){var t,r,i;e.numberOfUnreadNonGroups=u,e.numberOfUnreadGroups=u,e.numberOfConversations=u,e.daysSinceLastConversation=u;if(n.get().conversationsManager&&n.get().conversationsManager._allConversations){t=n.get().conversationsManager._allConversations(),e.numberOfConversations=t.length;for(r=0;r<t.length;r++)v(t[r],e);e.daysSinceLastConversation===undefined&&(e.daysSinceLastConversation=u),i=n.get().conversationsManager._unreadConversations(),e.numberOfUnreadNonGroups=0,e.numberOfUnreadGroups=0;for(r=0;r<i.length;r++)m(i[r],e)}}function v(e,t){var n,r=e.lastMessage;if(!r)return;n=S(new Date(r.composetime));if(t.daysSinceLastConversation===undefined||t.daysSinceLastConversation>n)t.daysSinceLastConversation=n}function m(e,t){var n=g(e.id);n?t.numberOfUnreadGroups=t.numberOfUnreadGroups+1:t.numberOfUnreadNonGroups=t.numberOfUnreadNonGroups+1}function g(e){return o.isString(e)&&/^19:/.test(e)}function y(e){return e?e.sidebar&&e.sidebar.lastTimeOpened?S(new Date(e.sidebar.lastTimeOpened))<=30:!1:u}function b(e){return e?e.sidebar&&e.sidebar.lastTimeOpened?S(new Date(e.sidebar.lastTimeOpened))>30:!1:u}function w(e){if(!e)return u;if(e.sidebar&&e.sidebar.lastTimeOpened){var t=S(new Date(e.sidebar.lastTimeOpened));return t>1&&t<=30}return!1}function E(){try{var e=void 0,t=s.COMMON.telemetry.idleUsersAnalytics.localKeys.signInData,n=i.getWindow().localStorage.getItem(t),r=n?JSON.parse(n):[];return!r||r.length<2?u:(e=r[r.length-2],S(new Date(e))!==0)}catch(o){return u}}function S(e){var t=864e5;return Math.round(Math.abs(((new Date).getTime()-e.getTime())/t))}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("swx-browser-globals"),s=e("swx-constants"),o=e("lodash-compat"),u=s.COMMON.telemetry.NOT_AVAILABLE,a=!1;t.publish=f,t.reset=l});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/utils/chat/conversationsCache",["require","exports","lodash-compat","swx-constants","swx-jskype-internal-application-instance","jcafe-property-model","../../../lib/modelHelpers/propertyValidator","../../../lib/services/internalPubSub","swx-chat-service","jskype-settings-instance","../../../lib/utils/chat/cacheBase","../../../lib/utils/chat/conversation","../../../lib/utils/chat/message","../../../lib/utils/chat/messageTypes","../../../lib/telemetry/userAnalytics","swx-utils-common","jskype-constants","../../../lib/services/cache/instance","swx-utils-chat"],e)})(function(e,t){function T(){var e=14,t=new Date;return t.setDate(t.getDate()-e),t.getTime()}function C(e,t){return new N(e,t)}var n=e("lodash-compat"),r=e("swx-constants"),i=e("swx-jskype-internal-application-instance"),s=e("jcafe-property-model"),o=e("../../../lib/modelHelpers/propertyValidator"),u=e("../../../lib/services/internalPubSub"),a=e("swx-chat-service"),f=e("jskype-settings-instance"),l=e("../../../lib/utils/chat/cacheBase"),c=e("../../../lib/utils/chat/conversation"),h=e("../../../lib/utils/chat/message"),p=e("../../../lib/utils/chat/messageTypes"),d=e("../../../lib/telemetry/userAnalytics"),v=e("swx-utils-common"),m=e("jskype-constants"),g=e("../../../lib/services/cache/instance"),y=e("swx-utils-chat"),b=a.utils.sanitizer,w=m.DATA.storageKeyRegExp,E=100,S=-1,x=r.COMMON.events.system,N=function(e){function t(t,n){var r=e.call(this,S,y.sort.byTimestamp)||this;return r.queueForSynchronization={},r.queueInSynchronization={},r.serverHasMoreItems=!0,r.firstTimeAskingService=!0,r.conversationsFromStorageProcessed=!1,r.blockedNotCachedYet={},r.syncAllConversationsCommandState=s.boolProperty(!1),r.conversationsFromCacheSynced=!1,r.conversationUnreadCountUpdateCounter=0,r.appliedConversationUnreadCountUpdateCounter=0,r.appliedConversationAllUnreadCountUpdateCounter=0,r.syncRecentsPromise=new Promise(function(e){r.syncRecentsPromiseResolver=e}),r._syncAllConversations=s.command(r.syncAllConversationsCommand,r.syncAllConversationsCommandState),r._init=function(){u.get().subscribe(x.FORCE_RESYNC,r.resyncAll.bind(r))},r._getUnreadConversations=s.property({readOnly:!0,value:[],get:r.getUnreadConversationsCountCommand.bind(r)}),r._allUnreadConversationsCount=s.property({readOnly:!0,value:0,get:r.getUnreadConversationsCountCommand.bind(r)}),r._getAllUnreadConversations=s.property({readOnly:!0,value:[],get:r.getUnreadConversationsCountCommand.bind(r)}),r.unreadConversationsCount=s.property({readOnly:!0,value:0,get:r.getUnreadConversationsCountCommand.bind(r)}),r.getConversation=function(e){var t=r.getItem(e);return!t&&o.isGroupConversation(e)&&(r.queueForSynchronization[e]=e),r.queueForSynchronization[e]&&r.syncThread(e),t},r.conversationUpdated=function(e){if(!!e.version&&!r.isValidConversation(e))return;r.getOrSyncConversation(e.id).then(function(t){if(!t)return;r.updateConversationProperties(t,"properties",e.properties),r.updateConversationProperties(t,"threadProperties",e.threadProperties),e.members&&(t.members=e.members),r.updateUnreadConversationsCount(),r.storeConversation(t)})},r.handleUpdatedMessage=function(e,t){var n=r.getItem(e);if(!n)return;n.lastMessage.id===t.id&&(n.lastMessage=t,r.storeConversation(n))},r.handleNewMessage=function(e,t){var n=r.getItem(e);if(!n)return;n.lastMessage=t,n.timestamp=+(new Date(t.originalarrivaltime)),r.updateUnreadConversationsCount(),r.storeConversation(n)},r.conversationBlockedUpdate=function(e,t){var n=r.getItem(e);n?(n.isBlocked=t,r.updateUnreadConversationsCount(),r.storeConversation(n)):r.blockedNotCachedYet[e]=t},r.syncFinished=s.property({readOnly:!0,value:!1}),r.unreadCounversationsCounters=function(){return Promise.all([r.unreadConversationsCount.get(),r.syncRecentsPromise])},r.apiHandler=t,r.onNewUnconsumedConversationsAdded=n,r}return __extends(t,e),t.prototype.joinedRecentlyTo=function(e){var t=36e5;return e.threadProperties?e.threadProperties.lastleaveat&&e.threadProperties.lastjoinat&&e.threadProperties.lastleaveat>e.threadProperties.lastjoinat?!1:e.threadProperties.lastjoinat&&Date.now()-e.threadProperties.lastjoinat<t:!1},t.prototype.isRemovedConversation=function(e){return e.properties?e.properties.clearedat:!1},t.prototype.lastMessageHasContent=function(e){return e.lastMessage&&typeof e.lastMessage.content!="undefined"},t.prototype.isValidConversation=function(e){return!f.isFeatureOn(r.COMMON.featureFlags.AGENTS_ENABLED)&&c.isAgentConversation(e.id)?!1:!f.isFeatureOn(r.COMMON.featureFlags.PSTN_ENABLED)&&c.isPstnConversation(e.id)?!1:(this.lastMessageHasContent(e)||this.joinedRecentlyTo(e)&&!this.isRemovedConversation(e))&&!c.isMeConversation(e.id)},t.prototype.isModelHavingUnreadActivityItems=function(e,t,n){var r=i.get().conversationsManager._getConversation(e.id);r||(this.onNewUnconsumedConversationsAdded([e],!0),r=i.get().conversationsManager._getConversation(e.id));var s=n?r.historyService._unreadActivityItemsWithKeywordsCount:r.historyService.unreadActivityItemsCount;s.get().then(function(e){t(e>0)})},t.prototype.asynchronouslyFilterOutReadConversations=function(e,t,r){var i=/false/i.test(t.properties.alerts),s=!n.isEmpty(t.properties.alertmatches);if(e&&(t.isBlocked||i&&!s)){r(!1);return}if(t.id&&c.isPstnConversation(t.id)){r(!1);return}if(h.doesMessageTypeSupportUnreadState(t.lastMessage)){if(t.lastMessage.skypeeditedid){this.isModelHavingUnreadActivityItems(t,r,i&&s);return}var o=typeof t.lastMessage.content!="undefined"&&!c.isConversationReadOnServer(t)&&!h.isMessageOutgoing(t.lastMessage);e&&i&&s&&o?this.isModelHavingUnreadActivityItems(t,r,!0):r(o);return}if(c.isConversationReadOnServer(t)){r(!1);return}this.isModelHavingUnreadActivityItems(t,r,e&&i&&s)},t.prototype.updateUnreadConversationsCount=function(){var e=this;this.conversationUnreadCountUpdateCounter++;var t=this.conversationUnreadCountUpdateCounter,n=s.task(),i=s.task();this.unreadCounterTask=this.unreadCounterTask&&this.unreadCounterTask.promise.state()==="pending"?this.unreadCounterTask:s.task(),Promise.all([n.promise,i.promise]).then(function(){v.async.execute(d.publish),f.isFeatureOn(r.COMMON.featureFlags.UNREAD_CONVERSATION_DEBUGGER),e.unreadCounterTask.promise.state()==="pending"&&e.unreadCounterTask.resolve()});var o=function(r){if(t<e.appliedConversationUnreadCountUpdateCounter)return;e.appliedConversationUnreadCountUpdateCounter=t,e.unreadConversationsCount._set(r.length),e._getUnreadConversations._set(r),n.resolve()};this.getItems(this.asynchronouslyFilterOutReadConversations.bind(this,!0),o);var u=function(n){if(t<e.appliedConversationAllUnreadCountUpdateCounter)return;e.appliedConversationAllUnreadCountUpdateCounter=t,e._allUnreadConversationsCount._set(n.length),e._getAllUnreadConversations._set(n),i.resolve()};this.getItems(this.asynchronouslyFilterOutReadConversations.bind(this,!1),u)},t.prototype.cacheConversations=function(e,t){var n=this,r=[],i=[];if(!e.length)return;b.conversations(e);var o=function(e){if(!e)return;var s=n.cacheItem;if(n.isValidConversation(e)){var o=n.getItem(e.id);if(o&&o===e)return;o&&(n.updateLastMessageWithPropertiesFromCacheIfAny(e),s=n.replaceItem,r.push(e)),e.timestamp=+(new Date(e.lastMessage.originalarrivaltime)),s(e,e.id),t||i.push(n.storeConversation(e))}};e.forEach(o),this.updateUnreadConversationsCount(),i.length?s.task.waitAll(i).then(this.updateStoredSyncState.bind(this)):t||this.updateStoredSyncState(),r.forEach(function(e){n.queueForSynchronization[e.id]&&n.syncThread(e.id)}),this.onNewUnconsumedConversationsAdded(this._getNewUnconsumedItems().concat(r))},t.prototype.reduceDataForCaching=function(e){var t=function(e){return e&&e.content&&p._isDeletedMessage(e.content)&&(e.content=""),e},r=n.omit(e.lastMessage,"conversationModel"),i=n.omit(e,"lastMessage");return i.lastMessage=t(r),i},t.prototype.updateStoredSyncState=function(){g.get().setItem("recentsSyncState",this.syncState)},t.prototype.storeConversation=function(e){return g.get().setSensitiveItem("conv|"+e.id,this.reduceDataForCaching(e))},t.prototype.removeConversationFromStorage=function(e){return g.get().removeItem("conv|"+e)},t.prototype.getFirstTimePopulationPromise=function(){return this.firstTimePopulationPromise?this.firstTimePopulationPromise:(this.firstTimePopulationPromise=g.get().getSensitiveItems(w.CONVERSATION),this.unreadCounversationsCounters(),this.firstTimePopulationPromise)},t.prototype.getOrSyncConversation=function(e){var t=this,n=s.task(),r=this.getItem(e),i=function(r){t.cacheConversations([r.response]),n.resolve(t.getItem(e))};return r?n.resolve(r):this.apiHandler.syncConversation(e,i,n.reject.bind(n)),n.promise},t.prototype.updateConversationProperties=function(e,t,n){for(var r in n)n.hasOwnProperty(r)&&(e[t][r]=n[r])},t.prototype.getUnreadConversationsCountCommand=function(){var e=this,t=this.firstTimePopulationPromise||this._obtain();return this.unreadCounterTask=this.unreadCounterTask||s.task(),Promise.all([t,this.unreadCounterTask.promise]).then(function(){return e.unreadConversationsCount()})},t.prototype.syncRecents=function(e,t){var n=this;t=t||function(){};var i=function(e){n.syncState=e,u()},s=function(t){n.syncState=t.syncState,e(t)},o=function(e){var i=!1;try{var s=JSON.parse(e.response);i=e.status===r.COMMON.httpStatusCodes.badRequest&&s.errorCode===r.COMMON.msnpErrors.invalidSyncState}catch(o){t(e);return}i?(n.syncState=null,n.updateStoredSyncState(),u()):t(e)},u=function(){n.apiHandler.syncRecents(T(),E,n.syncState).then(s,o)};this.syncState?u():g.get().getItem("recentsSyncState").then(i,u)},t.prototype.resyncAll=function(){var e=this;if(this.resyncingAll)return;this.resyncingAll=!0;var t=function(n){e.cacheConversations(n.conversations),e.onNewUnconsumedConversationsAdded(n.conversations),n.hasMoreConversations?e.syncRecents(t):e.resyncingAll=!1};this.syncRecents(t)},t.prototype.syncAllConversationsCommand=function(){var e=s.task(),t=0,n=function(){t--,t===0&&e.resolve()};for(var r in this.queueForSynchronization)this.queueForSynchronization.hasOwnProperty(r)&&(t++,this.syncThread(r,n,n));return e.promise},t.prototype.updateSyncAllConversationsCommandState=function(){this.syncAllConversationsCommandState(Object.keys(this.queueForSynchronization).length>0)},t.prototype.syncThread=function(e,t,n){var r=this,i=function(t,n){r.queueInSynchronization[e].forEach(function(e){var r=t?e.onError:e.onSuccess;r&&r(n)}),delete r.queueInSynchronization[e]};delete this.queueForSynchronization[e],this.updateSyncAllConversationsCommandState(),this.queueInSynchronization[e]||(this.queueInSynchronization[e]=[],this.apiHandler.syncThread(e,i.bind(null,!1),i.bind(null,!0))),this.queueInSynchronization[e].push({onSuccess:t,onError:n})},t.prototype.queueForSynchronizationIfNeeded=function(e){var t=!!e.members,n=o.isGroupConversation(e.id);!t&&n&&(this.queueForSynchronization[e.id]=e.id,this.updateSyncAllConversationsCommandState())},t.prototype.checkAllConversationsSyncState=function(){this.syncFinished._set(!this.serverHasMoreItems&&this.conversationsFromCacheSynced)},t.prototype.updateLastMessageWithPropertiesFromCacheIfAny=function(e){var t=this.getItem(e.id),n=e.lastMessage,r=t?t.lastMessage:null;if(!n||!r||n.properties||!r.properties)return;n.id===r.id&&n.originalarrivaltime===r.originalarrivaltime&&(n.properties=r.properties)},t.prototype._serverHasMoreItems=function(){return this.serverHasMoreItems},t.prototype._getItemsFromService=function(e,t){var n=this,r=s.task();t=t||this.firstTimeAskingService,this.firstTimeAskingService=!1;var o=function(e){n.onNewItemsLoaded(),r.reject(e)},u=function(t,i){n.onNewItemsLoaded(),n.cacheConversations(t,i),n.getFirstTimePopulationPromise().then(function(){r.promise.state()==="pending"&&r.resolve(e?n._getCachedItems(e):[])})},a=function(r){n.syncRecentsPromiseResolver(r.conversations.length),r.hasMoreConversations&&t&&n._getItemsFromService(e,t),i.get()._telemetry.context.timelineLoadStatusCode=r.statusCode,u(r.conversations),n.serverHasMoreItems=r.hasMoreConversations,n.checkAllConversationsSyncState()};return this.syncRecents(a,o),this.conversationsFromStorageProcessed||(this.conversationsFromStorageProcessed=!0,this.getFirstTimePopulationPromise().then(function(e){e&&u(e,!0),n.conversationsFromCacheSynced=!0,n.checkAllConversationsSyncState()})),r.promise},t.prototype._onItemAddedOrUpdated=function(e){this.cacheConversations([e]),this.queueForSynchronization[e.id]&&this.syncThread(e.id)},t.prototype._onItemRemoved=function(e){this.removeConversationFromStorage(e)},t.prototype._cacheItem=function(e,t){typeof this.blockedNotCachedYet[t]!="undefined"&&(e.isBlocked=this.blockedNotCachedYet[t],delete this.blockedNotCachedYet[t]),this.queueForSynchronizationIfNeeded(e)},t.prototype._emptyCache=function(){this.clean()},t}(l.CacheBase);t.ConversationsCache=N,t.build=C}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/utils/chat/conversationsFactory",["require","exports","../../../lib/modelHelpers/propertyValidator","../../../lib/modelHelpers/personsAndGroupsHelper","../../../lib/models/conversation","swx-mri"],e)}(function(e,t){var n=e("../../../lib/modelHelpers/propertyValidator"),r=e("../../../lib/modelHelpers/personsAndGroupsHelper"),i=e("../../../lib/models/conversation"),s=e("swx-mri"),o=function(){function e(e){var t=this;this.createById=function(e){var r;return n.isGroupConversation(e)?r=new i["default"](t.conversationAPIHandler,!0,e):r=t.getDialogConversationForKey(e),r||(r=new i["default"](t.conversationAPIHandler),r.conversationId=e),r},this.createByPerson=function(e){var n=s.getKey(e.id(),e._type()),r=new i["default"](t.conversationAPIHandler,!1,n);return r._addParticipant(e),r.avatarUrl=e.avatarUrl,r.topic=e.displayName,r},this.conversationAPIHandler=e}return e.prototype.getDialogConversationForKey=function(e){var t=r.getPersonByConversationId(e);return this.createByPerson(t)},e}();t.__esModule=!0,t["default"]=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/conversationsManager",["require","exports","lodash-compat","swx-enums","jskype-constants","jcafe-property-model","./conversation","./conversationsSearchQuery","../../lib/modelHelpers/contacts/contactActivityItemHelper","../../lib/modelHelpers/contacts/contactMessageFactory","../../lib/modelHelpers/personHelper","swx-chat-service","../../lib/modelHelpers/personsAndGroupsHelper","../../lib/modelHelpers/personsRegistry/instance","../../lib/modelHelpers/propertyValidator","../../lib/modelHelpers/contacts/authorizationChange","jskype-settings-instance","swx-constants","../../lib/modelHelpers/contacts/groupHelper","../../lib/services/webapiMapper/conversationApiHandler","../../lib/services/webapiMapper/conversationLiveStateHandler","../../lib/utils/chat/conversationsCache","../../lib/utils/chat/conversationsFactory","swx-mri","swx-mri/lib/mriMaps"],e)}(function(e,t){var n=e("lodash-compat"),r=e("swx-enums"),i=e("jskype-constants"),s=e("jcafe-property-model"),o=e("./conversation"),u=e("./conversationsSearchQuery"),a=e("../../lib/modelHelpers/contacts/contactActivityItemHelper"),f=e("../../lib/modelHelpers/contacts/contactMessageFactory"),l=e("../../lib/modelHelpers/personHelper"),c=e("swx-chat-service"),h=e("../../lib/modelHelpers/personsAndGroupsHelper"),p=e("../../lib/modelHelpers/personsRegistry/instance"),d=e("../../lib/modelHelpers/propertyValidator"),v=e("../../lib/modelHelpers/contacts/authorizationChange"),m=e("jskype-settings-instance"),g=e("swx-constants"),y=e("../../lib/modelHelpers/contacts/groupHelper"),b=e("../../lib/services/webapiMapper/conversationApiHandler"),w=e("../../lib/services/webapiMapper/conversationLiveStateHandler"),E=e("../../lib/utils/chat/conversationsCache"),S=e("../../lib/utils/chat/conversationsFactory"),x=e("swx-mri"),T=e("swx-mri/lib/mriMaps"),N=i.PEOPLE.authorizationStates,C=c.utils.conversationMetadataStore,k="skype://",L=function(){function e(){var e=this;this.conversationAPIHandler=new b["default"](this),this.getMoreConversationsCommandState=s.boolProperty(!0),this.conversationsStore=s.collection({get:this.getAllConversationsCommand.bind(this)}),this.allConversations=s.collection(),this.conversationsCacheInstance=E.build(this.conversationAPIHandler,this.addConversationsSync.bind(this)),this.conversationsFactory=new S["default"](this.conversationAPIHandler),this.previousContactFavorites=[],this.onManagerReadyForContactFavorites=n.once(this.initializeFavorites.bind(this)),this.conversations=this.conversationsStore.fork({add:this.addConversationCommand.bind(this),remove:this.removeConversationCommand.bind(this)}),this.getMoreConversations=s.command(this.getMoreConversationsCommand.bind(this),this.getMoreConversationsCommandState),this.unreadConversationsCount=this.conversationsCacheInstance.unreadConversationsCount,this._allConversations=this.conversationsCacheInstance.getAllItems,this._allUnreadConversationsCount=this.conversationsCacheInstance._allUnreadConversationsCount,this._unreadConversations=this.conversationsCacheInstance._getUnreadConversations,this._allUnreadConversations=this.conversationsCacheInstance._getAllUnreadConversations,this._conversationsSynced=this.conversationAPIHandler.addConversationsCollectionTask,this._unreadCounversationsCounters=this.conversationsCacheInstance.unreadCounversationsCounters,this._conversationBlockedUpdate=this.conversationsCacheInstance.conversationBlockedUpdate,this.createSearchQuery=function(){return new u["default"](e.conversationsCacheInstance)},this.createConversation=function(){var t=new o["default"](e.conversationAPIHandler,!0,null);t.historyService.getMoreActivityItems.enabled._set(!1);var n=function(n){t.historyService.getMoreActivityItems.enabled._set(!0),t.conversationId=n,t._topicSetEnabled(!0),t._conversationIdReady(!0),e.conversations.add(t,n),e.conversationAPIHandler.syncThread(n),t.selfParticipant.role._set(r.participantRole.Leader)},i=function(){};return e.conversationAPIHandler.createConversation(t,n,i),t},this.getConversation=function(t){e.registry.get(t.id())||e.registry.add(t);var n=function(){var n=x.getKey(t.id(),t._type()),r=e._getConversation(n);if(!r){r=e.conversationsFactory.createByPerson(t);var i=e.conversationsCacheInstance.getItem(n);i&&r._update(i),e.allConversations.add(r,r.conversationId)}return r},r=n();return e.addContactActivityItem(t,r),r},this.getConversationByUri=function(t){if(typeof t!="string")throw new TypeError("expected uri to be a string");var n=t.replace(k,"");if(d.is1to1Conversation(n))return undefined;var r=d.isPhoneNumber(n);if(!d.isGroupConversation(n)&&!r)throw new Error("expected valid conversation uri");var i=e.allConversations(n);if(!i){if(r)return e.createPstnConversation(n);i=new o["default"](e.conversationAPIHandler,!0,n),e.conversations.add(i),e.conversationAPIHandler.joinConversation(i)}else if(!i.leave.enabled()){var s=function(t){if(!!t.members){e.conversationAPIHandler.joinConversation(t);return}e.conversationAPIHandler.syncThread(t.conversationId,function(){t.leave.enabled()||e.conversationAPIHandler.joinConversation(t)})};s(i)}return i},this._getConversationByUri=function(t){var n;if(typeof t!="string")return Promise.reject(new TypeError("expected uri to be a string"));var r=t.replace(k,""),i=d.isPhoneNumber(r),s=d.isGroupConversation(r),u=d.is1to1Conversation(r),a=function(t,s){if(!n&&i){n=e.createPstnConversation(r),t();return}if(!n){n=new o["default"](e.conversationAPIHandler,!0,r),e.conversations.add(n),e.conversationAPIHandler.joinConversation(n,!0).then(t,s);return}if(!!n.members){e.conversationAPIHandler.joinConversation(n,!0).then(t,s);return}e.conversationAPIHandler.syncThread(n.conversationId).then(function(){n.leave.enabled()?t():e.conversationAPIHandler.joinConversation(n,!0).then(t,s)},s)};return s||i?(n=e.allConversations(r),new Promise(function(e,t){function r(){e(n)}a(r,t)})):u?new Promise(function(r){n=e._getOrCreateConversation(t),n.participants().length&&e.addContactActivityItem(n.participants(0).person,n),e.conversations.add(n),r(n)}):Promise.reject(new Error("expected valid conversation uri"))},this._onlineStateChanged=function(){e.conversationsStore().forEach(function(e){e._onlineStateChanged()})},this._init=function(){e.conversationAPIHandler.init(),e.conversationsCacheInstance._init(),e.conversationsCacheInstance.get(0),e.registry=p.build()},this._reset=function(){return e.conversationAPIHandler.reset().then(function(){e.conversationsCacheInstance=E.build(e.conversationAPIHandler,e.addConversationsSync.bind(e)),y.unsubscribeFromGroup(r.groupType.Favorites,e.updateFavoritesFromContactGroup),e.getMoreConversationsCommandState(!0),e.conversationsStore.empty(),e.allConversations.empty(),p.reset(),e.registry=null})},this._getConversation=function(t){return e.allConversations(t)},this._getOrCreateConversation=function(t){return e._getConversation(t)||e.createConversationInternal(t)},this._handleNewMessage=function(t,n){var r=e._getOrCreateConversation(t);e.addToConversationsStore(r),e.conversationsCacheInstance.handleNewMessage(t,n),r.historyService._processRawMessage(n)},this._handleUpdatedMessage=function(t,n){var r=e._getOrCreateConversation(t);e.addToConversationsStore(r),e.conversationsCacheInstance.handleUpdatedMessage(t,n),r.historyService._processRawMessage(n,!1,!0)},this._conversationPropertiesUpdated=function(t){e.updateConversation("_updateConversationProperties",t)},this._threadPropertiesUpdated=function(t){e.updateConversation("_updateThreadProperties",t)},this._setMessageCopiedToCache=function(t){m.isFeatureOn(g.COMMON.featureFlags.CONTEXT_MENU_COPY_MESSAGES_ENABLED)&&(e.cachedCopiedMessage=t)},this._getMessageCopiedToCache=function(){return m.isFeatureOn(g.COMMON.featureFlags.CONTEXT_MENU_COPY_MESSAGES_ENABLED)?e.cachedCopiedMessage:undefined},this.__processConversation=function(t,r){var i=e._getConversation(t.id),s=function(){if(!i.historyService._lastMessageFromServer||i.historyService._lastMessageFromServer._actualId!==t.lastMessage.id)C.clear(i.conversationId),i.historyService._reset();i._update(t)},o=function(){n.isEmpty(t.lastMessage)||i.historyService._processRawMessage(t.lastMessage,!0);if(!i.isGroupConversation()){var e=i.participants()[0].person;u(e)}},u=function(e){var t,n=i.lastModificationTimestamp(),r=new Date(n.getTime()+1e3);e.isBlocked()?(a.clearUnblockContactActivityItems(i),t=f.getUnblockContact(e,r),i.historyService._processRawMessage(t)):l.canRequestContactAuthorization(e)&&(e._authorization()===N.UNAUTHORIZED?(a.clearContactRequestActivityItems(i),t=f.getOutgoing(e,r),i.historyService._processRawMessage(t)):e._authorization()===N.PENDING_OUTGOING?(a.clearContactRequestActivityItems(i),t=f.getOutgoingResend(e,r),i.historyService._processRawMessage(t)):e._authorization()===N.SUGGESTED&&(a.clearContactRequestActivityItems(i),t=f.getSuggested(e,r),i.historyService._processRawMessage(t)))};i?s():i=e.createConversationInternal(t.id),e.conversationAPIHandler.addConversationsCollectionTask.promise.then(o),r?e.addConversationToCollection(e.allConversations,i):e.addToConversationsStore(i),w.updateNGCCallState(t.id,t.threadProperties)},this.updateFavoritesFromContactGroup=function(){var t=n.map(y.getPersonsFromGroup(r.groupType.Favorites),function(e){return{id:x.getKey(e.id(),e._type())}}),i=n.filter(e.previousContactFavorites,function(e){return!n.some(t,e)});e.onFavoriteConversationReceived(t,i),e.previousContactFavorites=t||[]}}return e.prototype.updateConversation=function(e,t){var n=this._getConversation(t.id);n&&n[e](t),this.conversationsCacheInstance.conversationUpdated(t)},e.prototype.addToConversationsStore=function(e){this.conversationsStore(e.conversationId)||this.conversationsStore.add(e,e.conversationId)},e.prototype.addConversationCommand=function(e){this.addConversationToCollection(this.conversationsStore,e),this.addConversationToCollection(this.allConversations,e)},e.prototype.addConversationToCollection=function(e,t){try{n.isNumber(e.index(t.conversationId))||e.add(t,t.conversationId)}catch(r){}},e.prototype.removeConversationCommand=function(e,t){var n=s.task();m.isFeatureOn(g.COMMON.featureFlags.FAVORITES_CONVERSATION_ENABLED)&&e._isFavorited()&&e._isFavorited(!1);if(t===r.activityType.ContactRequestIncoming){var i=e.participants()[0].person;v.sendDeclineRequest(i).then(n.resolve.bind(n),n.reject.bind(n))}else this.conversationsStore.remove(e.conversationId),this.allConversations.remove(e.conversationId),this.conversationsCacheInstance.onItemRemoved(e.conversationId),n.resolve();return n.promise},e.prototype.getAllConversationsCommand=function(){var e=this;return this.getAllConversationsTask?this.getAllConversationsTask.promise:(this.getAllConversationsTask=s.task(),this.conversationsCacheInstance.syncFinished.once(!0,function(){e.getAllConversationsTask.resolve(e.conversationsStore()),e.onManagerReadyForContactFavorites()}),this.getAllConversationsTask.promise)},e.prototype.createConversationInternal=function(e){var t=this.conversationsFactory.createById(e),n=this.conversationsCacheInstance.getConversation(e);return n&&t._update(n),this.allConversations.add(t,t.conversationId),t},e.prototype.createPstnConversation=function(e){var t=T.contactMriTypes.pstn+":",n=e.replace(t,""),r=new o["default"](this.conversationAPIHandler,!1,e),i=h.getPerson(n,T.contactMriTypes.pstn);return r._addParticipant(i),r.topic=i.displayName,this.conversations.add(r),r},e.prototype.addConversationsSync=function(e,t){var n=this;e.reverse().forEach(function(e){n.__processConversation(e,t)})},e.prototype.handleReceivedConversations=function(e,t,n){var r=this.conversationsStore.size();this.addConversationsSync(n);var i=this.conversationsStore.size()-r,s=e-i;s>0&&this.conversationsCacheInstance.hasMoreItems()?this.getConversationsFromCache(s,t):t.resolve(),this.conversationsCacheInstance.hasMoreItems()||this.getMoreConversationsCommandState.set(!1)},e.prototype.getConversationsFromCache=function(e,t){this.conversationsCacheInstance.get(e).then(this.handleReceivedConversations.bind(this,e,t),t.reject.bind(t))},e.prototype.getMoreConversationsCommand=function(e){var t=this,n=this.getMoreConversationsTask;return n?n.promise:(n=this.getMoreConversationsTask=s.task(),this.getMoreConversationsTask.promise["finally"](function(){t.getMoreConversationsTask=null,t.onManagerReadyForContactFavorites()}),this.getConversationsFromCache(e,n),n.promise)},e.prototype.onFavoriteConversationReceived=function(e,t){var r=this,i=e||[],s=t||[];n.forEach(i,function(e){var t=r._getOrCreateConversation(e.id);t._isFavorited._set(!0),n.indexOf(r.conversations(),t)===-1&&r.conversations.add(t)}),n.forEach(s,function(e){var t=r._getOrCreateConversation(e.id);t._isFavorited._set(!1)})},e.prototype.filterFavorites=function(e,t){t(e.properties.favorite&&e.properties.favorite==="true")},e.prototype.initializeFavorites=function(){if(!m.isFeatureOn(g.COMMON.featureFlags.FAVORITES_CONVERSATION_ENABLED))return;this.conversationsCacheInstance.getItems(this.filterFavorites,this.onFavoriteConversationReceived.bind(this)),y.subscribeToGroup(r.groupType.Favorites,this.updateFavoritesFromContactGroup)},e.prototype.addContactActivityItem=function(e,t){var n=f.getActivityItemForInitialConversationLoad(e,t);n&&t.historyService._processRawMessage(n)},e}();t.__esModule=!0,t["default"]=L}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/calling/platformValidator",["require","exports","swx-browser-detect","swx-util-calling-stack","swx-enums","lodash-compat"],e)}(function(e,t){function o(){var e=b(),t=u(e.browserName);return t(e)}function u(e){switch(e){case n["default"].BROWSERS.CHROME:return c;case n["default"].BROWSERS.EDGE:return p;default:return d}}function a(e){return!e.isWindowsOS&&!e.isMacOSX?v():p()}function f(e){return e.isWindowsOS?e.browserMajorVersion<10?d():p():v()}function l(e){return!e.isMacOSX&&!e.isWindowsOS&&(!e.isLinux||!r.get().isPluginlessCallingSupported())?v():e.browserMajorVersion<25?d():p()}function c(e){return!e.isMacOSX&&!e.isWindowsOS&&(!e.isLinux||!r.get().isPluginlessCallingSupported())?v():p()}function h(e){return!e.isLinux&&!e.isMacOSX&&!e.isWindowsOS?v():p()}function p(){return{isSupported:!0}}function d(){return{isSupported:!1,reason:i.callingNotSupportedReasons.BrowserNotSupported}}function v(){return{isSupported:!1,reason:i.callingNotSupportedReasons.OSNotSupported}}function m(){try{return n["default"].getSystemInfo().osName===n["default"].OPERATING_SYSTEMS.WINDOWS}catch(e){return!1}}function g(){try{return n["default"].getSystemInfo().osName===n["default"].OPERATING_SYSTEMS.MACOSX}catch(e){return!1}}function y(){try{return n["default"].getSystemInfo().osName===n["default"].OPERATING_SYSTEMS.LINUX}catch(e){return!1}}function b(){var e=n["default"].getBrowserInfo();return s.extend(e,{isWindowsOS:m(),isMacOSX:g(),isLinux:y()})}var n=e("swx-browser-detect"),r=e("swx-util-calling-stack"),i=e("swx-enums"),s=e("lodash-compat");t.getPlatformSupport=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/pluginEmbed",["require","exports","swx-browser-globals","swx-browser-detect","swx-constants"],e)}(function(e,t){function s(e){var t=n.getDocument().createElement("embed");return t.setAttribute("type",i.PLUGIN_CONST.MIME_TYPE),t.setAttribute("tabindex","-1"),Object.keys(e).forEach(function(n){t.setAttribute(n,e[n])}),t}function o(e){var t=n.getDocument(),r=t.createElement("object");return Object.keys(e).forEach(function(n){var i=t.createElement("param");i.setAttribute("name",n),i.setAttribute("value",e[n]),r.appendChild(i)}),r.setAttribute("tabindex","-1"),r.setAttribute("type",i.PLUGIN_CONST.MIME_TYPE),r}function u(){return f()?"object":"embed"}function a(e){return f()?o(e):s(e)}function f(){return r["default"].getBrowserInfo().isIeEngine}function l(e){var t=e.getElementsByTagName(u())[0];t&&e.removeChild(t)}function c(e,t,r){var i=n.getDocument(),s=t?i.getElementById(t):i.getElementsByTagName("body")[0];s&&(r&&l(s),s.appendChild(e))}function h(e,t){t&&typeof t=="string"&&(e.className=t)}function p(e,t,n){var r=a(t||{});return n=n||{},r.id=e,h(r,n.cssClass),c(r,n.parentElementId,n.removePrevious),r}function d(e){var t=n.getDocument().getElementById(e);t&&t.parentNode&&t.parentNode.removeChild(t)}var n=e("swx-browser-globals"),r=e("swx-browser-detect"),i=e("swx-constants");t.createComponent=p,t.removeComponent=d}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/baseComponent",["require","exports","swx-utils-common","./pluginEmbed","swx-utils-common","swx-browser-detect","../../../lib/telemetry/logging/callingLogTracer","swx-browser-globals","jskype-settings-instance","swx-utils-common/lib/version","swx-utils-common","swx-constants"],e)}(function(e,t){var n=e("swx-utils-common"),r=e("./pluginEmbed"),i=e("swx-utils-common"),s=e("swx-browser-detect"),o=e("../../../lib/telemetry/logging/callingLogTracer"),u=e("swx-browser-globals"),a=e("jskype-settings-instance"),f=e("swx-utils-common/lib/version"),l=e("swx-utils-common"),c=e("swx-constants"),h=o.get(),p=function(){function e(e){this._loadDelayMilisec=0,this._loadDelayTimer=null,this._heartBeatTimer=null,this._pluginExistenceCheckTimer=null,this._useNativeArguments=!1,this._componentName=e}return e.prototype._init=function(e,t){var n=this;this.componentId=this.generateComponentId(this._componentName),this.plugin=this.createPlugin(e,this.componentId,t),this.whenUnloaded=new Promise(function(e){n.onUnLoadComplete=function(){r.removeComponent(n.componentId),n.isDisposed=!0,delete n.plugin,e()}}),this.applyEventHandlers(this),this.pluginExistenceCheck(this)},e.prototype.load=function(e){this.isLoaded(this)?(this._useNativeArguments=this.checkNativeArgumentsSupport(this.plugin.GetVersion()),this.plugin.Load(this._componentName,this._encodeArgs(e))):this.loadOnInterval(this)},e.prototype._invokeMethod=function(e,t,n,r){var i=this._componentName+"::"+e+", "+JSON.stringify(t)+" @"+this.componentId,s=l.settablePromise.build();if(!this.isLoaded(this))return h.log("Attempted to execute this operation while plugin is not loaded:",i),undefined;var o=this._encodeArgs(t),u,a=function(){};n=n||a,r=r||a;try{u=this.plugin.ProcessMethod(e,o)}catch(f){return h.warn("e",f.stack),r(f),s.reject(f),s}var p=this._decodeArgs(u),d=u===undefined?"undefined":JSON.stringify(u),v=i+" Result: "+(d.length>c.PLUGIN_CONST.MAX_RESPONSE_LOG_LENGTH?d.substring(0,c.PLUGIN_CONST.MAX_RESPONSE_LOG_LENGTH)+"...":d);return h.log(v),p.error?(r(p.error),s.reject(p.error)):(n(p),s.resolve(p)),s},e.prototype.getVersion=function(e){var t=this.plugin.GetVersion();return e&&e(t),Promise.resolve(t)},e.prototype.setLogLevel=function(e,t){var n=this.plugin.SetLogLevel(e);t&&t(n)},e.prototype.checkExistence=function(e){var t=this.plugin.CheckExistence();e&&e(t)},e.prototype.unload=function(e){try{this.whenUnloaded.then(e),this.plugin.UnLoad()}catch(t){h.warn("[BaseComponent] unable to unload component",t),this.onUnLoadComplete()}},e.prototype.dispose=function(e){var t=u.getWindow();this.isDisposed||(t.clearTimeout(this._loadDelayTimer),t.clearTimeout(this._heartBeatTimer),t.clearTimeout(this._pluginExistenceCheckTimer),this.unload(e))},e.prototype.isLoaded=function(e){return!!e.plugin&&(this.isIeEngine()||!!e.plugin.Load)},e.prototype.loadOnInterval=function(e){e._loadDelayMilisec<a.settings.plugin.maxTotalLoadDelayMilisec?e._loadDelayTimer=u.getWindow().setTimeout(function(){e._loadDelayMilisec+=a.settings.plugin.loadDelayMilisec,e.load()},a.settings.plugin.loadDelayMilisec):e.onError&&e.onError("Plugin Failed to Initialize")},e.prototype.generateComponentId=function(e){return e+"-"+i.guid.create()},e.prototype.applyEventHandlers=function(e){function t(){u.getWindow().clearTimeout(e._heartBeatTimer),e._heartBeatTimer=u.getWindow().setTimeout(function(){e.onComponentCrashed&&e.onComponentCrashed()},a.settings.plugin.pingHeartBeatTimeout)}function r(e,t,r){var i=e;i["on"+t]&&n.async.execute(i["on"+t].bind(null,r))}function i(t,n){var i=e._decodeArgs(n);h.log(e._componentName+" Event - "+t+": "+JSON.stringify(i)+" @"+e.componentId),t==="__FxLoadComplete"?t="LoadComplete":t==="__FxUnLoadComplete"&&(t="UnLoadComplete"),r(e,t,i)}function s(){e._pluginExistenceCheckTimer&&(u.getWindow().clearTimeout(e._pluginExistenceCheckTimer),e._pluginExistenceCheckTimer=null),t();try{return e.plugin.PingResponse(),!0}catch(n){}return!1}e.plugin.OnEvent=i,e.plugin.OnPing=s},e.prototype.createPlugin=function(e,t,n){var i={managerID:e,componentID:t,jsonMode:!0,windowless:!0,structuredArguments:!0};return r.createComponent(t,i,n)},e.prototype.isIeEngine=function(){return s["default"].getBrowserInfo().isIeEngine},e.prototype.checkNativeArgumentsSupport=function(e){var t=f.parse(e),n=f.parse(c.PLUGIN_CONST.NATIVE_ARGUMENTS_REQUIRED_VERSION);return t.compareTo(n)>=0},e.prototype.pluginExistenceCheck=function(e){var t;try{t=e.plugin.CheckExistence()}catch(n){t=!1}t?e._pluginExistenceCheckTimer=u.getWindow().setTimeout(this.pluginExistenceCheck.bind(this),a.settings.plugin.pingHeartBeatTimeout,e):e.onComponentCrashed&&e.onComponentCrashed()},e.prototype._encodeArgs=function(e){return this._useNativeArguments?e||{}:JSON.stringify(e||{})},e.prototype._decodeArgs=function(e){return this._useNativeArguments?e||{}:JSON.parse(e||"{}")},e}();t.__esModule=!0,t["default"]=p});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/managerComponent",["require","exports","./baseComponent"],e)})(function(e,t){function s(){window.navigator.plugins&&window.navigator.plugins.refresh&&window.navigator.plugins.refresh(!1)}var n=e("./baseComponent"),r="__pluginFx",i=function(e){function t(){var t=this;return s(),t=e.call(this,r)||this,t._init("_",{cssClass:"pluginNoSize"}),t}return __extends(t,e),t.prototype.runSoftwareUpdate=function(e,t,n,r){var i={minVersion:e,highVersion:t,pluginManifestKey:n,ecs:r};this._invokeMethod("RunSoftwareUpdate",i)},t}(n["default"]);t.__esModule=!0,t["default"]=i});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/skypeCoreComponent",["require","exports","../../../lib/services/plugin/baseComponent","jskype-settings-instance","swx-constants"],e)})(function(e,t){var n=e("../../../lib/services/plugin/baseComponent"),r=e("jskype-settings-instance"),i=e("swx-constants"),s="SkypeCore",o=function(e){function t(t){var n=e.call(this,s)||this;return n._init(t,{cssClass:"pluginNoSize"}),n}return __extends(t,e),t.prototype.loginWithPassword=function(e,t,n){var i={participantId:e,password:t,cacheCredentials:n,uicServiceUrl:r.settings.uicServiceUrl.byPassword};this._invokeMethod("LoginWithPassword",i)},t.prototype.loginWithSkypeToken=function(e,t,n,i){var s={participantId:e,accessToken:t,tokenExpiration:n,cacheCredentials:i,uicServiceUrl:r.settings.uicServiceUrl.bySkypeToken};this._invokeMethod("LoginWithSkypeToken",s)},t.prototype.selectCameraDevice=function(e){return this._invokeMethod("SelectCameraDevice",{deviceId:e})},t.prototype.selectMicrophoneDevice=function(e){return this._invokeMethod("SelectMicrophoneDevice",{deviceId:e})},t.prototype.selectSpeakerDevice=function(e){return this._invokeMethod("SelectSpeakerDevice",{deviceId:e})},t.prototype.placeCall=function(e,t,n){var r={calleeIds:e,identitiesToUse:t,withVideo:!!n&&!0};this._invokeMethod("PlaceCall",r)},t.prototype.awaitCall=function(e,t,n,r,i){var s={eventTypeId:e,convoIdentity:t,callId:n,nodeSpecificNotificationPayload:r,genericNotificationPayload:i};this._invokeMethod("AwaitCall",s)},t.prototype.joinCall=function(e,t,n,r){var i={convoIdentity:e,withVideo:!!t,hostId:"",accessToken:r};this._invokeMethod("JoinCall",i)},t.prototype.goLive=function(e,t){var n={convoIdentity:e,withVideo:!!t};this._invokeMethod("GoLive",n)},t.prototype.acceptCall=function(e,t){var n={convoIdentity:e,accept:!0,withVideo:!!t&&!0};this._invokeMethod("AnswerCall",n)},t.prototype.rejectCall=function(e){var t={convoIdentity:e,accept:!1,withVideo:!1};this._invokeMethod("AnswerCall",t)},t.prototype.extendCall=function(e){var t={newCalleeIds:e};this._invokeMethod("ExtendCall",t)},t.prototype.forgetCall=function(e,t,n){var r={callId:e};this._invokeMethod("ForgetCall",r,t,n)},t.prototype.concludeCall=function(e){this._invokeMethod("ConcludeCall",null,e)},t.prototype.muteMicrophone=function(e){e?this._invokeMethod("MuteMicrophone"):this._invokeMethod("UnmuteMicrophone")},t.prototype.sendLocalVideo=function(e,t,n){this._invokeMethod("SendLocalVideo",{send:!!e,mediaType:t},n)},t.prototype.getMonitorList=function(e,t){this._invokeMethod("GetMonitorList",null,e,t)},t.prototype.setScreenCaptureMonitor=function(e,t,n){this._invokeMethod("SetScreenCaptureMonitor",{monitorId:e},t,n)},t.prototype.getMonitorPreview=function(e,t,n,r,i){this._invokeMethod("GetMonitorPreview",{monitorId:e,width:t,height:n},r,i)},t.prototype.sendDtmf=function(e,t){this._invokeMethod("SendDtmf",{dtmfCode:e},t)},t.prototype.requestCallInfo=function(e,t){this._invokeMethod("RequestCallInfo",null,e,t)},t.prototype.isValidThreshold=function(e){return!isNaN(e)&&e>=0&&e<11},t.prototype.setSoundLevelEventMode=function(e,t,n){var r=i.CALLING.SOUND_LEVEL_EVENT_MODE;r[e.mode]||n("Sound level model not supported",e.mode),e.mode===i.CALLING.SOUND_LEVEL_EVENT_MODE.Boolean&&!this.isValidThreshold(e.threshold)&&n("Threshold value not supported",e.threshold);var s=typeof e.getLocalParticipantLevel=="boolean"?e.getLocalParticipantLevel:!0,o={mode:e.mode,threshold:e.threshold,myself:s};this._invokeMethod("SetSoundLevelEventMode",o,t,n)},t.prototype.setParticipantFrameSink=function(e,t,n,r){var i={participantId:e,frameSinkId:t,mediaType:n};this._invokeMethod("SetParticipantFrameSink",i,r)},t.prototype.setLocalFrameSink=function(e,t){var n={frameSinkId:e};this._invokeMethod("SetLocalFrameSink",n,t)},t.prototype.showLocalVideo=function(e,t){this._invokeMethod("ShowLocalVideo",{show:!!e&&!0},t)},t.prototype.showParticipantVideo=function(e,t,n,r){var i={participantId:e,show:!!t,mediaType:n};this._invokeMethod("ShowParticipantVideo",i,r)},t}(n["default"]);t.__esModule=!0,t["default"]=o});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/videoComponent",["require","exports","./baseComponent"],e)})(function(e,t){var n=e("./baseComponent"),r="VideoUI",i=function(e){function t(t,n){var i=e.call(this,r)||this;return i._init(t,{parentElementId:n,removePrevious:!0}),i}return __extends(t,e),t.prototype.setRenderingMode=function(e,t){var n={mode:e};this._invokeMethod("SetRenderingMode",n,t)},t.prototype.getFrameSink=function(e){this._invokeMethod("GetFrameSink",null,e)},t.prototype.setupVideo=function(e,t){var n=this;this.getFrameSink(function(r){var i=r.frameSinkId;n.setRenderingMode(e,function(){t(i)})})},t}(n["default"]);t.__esModule=!0,t["default"]=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/electron/electronBase",["require","exports","../../../../lib/services/electron","../../../../lib/telemetry/logging/callingLogTracer","swx-utils-common","swx-constants"],e)}(function(e,t){var n=e("../../../../lib/services/electron"),r=e("../../../../lib/telemetry/logging/callingLogTracer"),i=e("swx-utils-common"),s=e("swx-constants"),o=r.get(),u=function(){function e(){this.isDisposed=!1,this._skypeModule=n.getSkypeModule(),this.whenUnloaded=i.settablePromise.build()}return e.prototype.getVersion=function(e){var t=this._skypeModule.getVersion();e&&e(t)},e.prototype.checkExistence=function(e){e&&e(!0)},e.prototype.dispose=function(e){this.isDisposed=!0,e&&e(),this.whenUnloaded.resolve()},e.prototype._raiseEvent=function(e,t){o.log("ElectronBase Event - "+e+": "+JSON.stringify(t));var n=this;n["on"+e]&&n["on"+e](t)},e.prototype._raiseLoadComplete=function(e){this._raiseEvent("LoadComplete",{result:e?s.PLUGIN_CONST.LOAD_RESULT.LOAD_SUCCESSFUL:s.PLUGIN_CONST.LOAD_RESULT.COMPONENT_INIT_FAILED})},e}();t.__esModule=!0,t["default"]=u});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/electron/electronManager",["require","exports","./electronBase"],e)})(function(e,t){function i(){return new r}var n=e("./electronBase"),r=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.load=function(){this._raiseLoadComplete(!0)},t.prototype.runSoftwareUpdate=function(){this._raiseEvent("UpdateCheckComplete",{success:!0,updateVersion:null})},t}(n["default"]);t.ElectronManager=r,t.build=i});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/electron/electronSkypeCore",["require","exports","./electronBase","../../../../lib/services/plugin/skypeCoreComponent","../../../../lib/telemetry/logging/callingLogTracer"],e)})(function(e,t){function u(){return new o}var n=e("./electronBase"),r=e("../../../../lib/services/plugin/skypeCoreComponent"),i=e("../../../../lib/telemetry/logging/callingLogTracer"),s=i.get(),o=function(e){function t(){var n=e.call(this)||this,i=r["default"].prototype,s=t.prototype;for(var o in r["default"].prototype)r["default"].prototype.hasOwnProperty(o)&&(s[o]=i[o]);return n}return __extends(t,e),t.prototype.loginWithSkypeToken=function(e,t,n,r){},t.prototype.load=function(e){try{this._skypeModule.skypeCoreInit(e),this._skypeModule.skypeCoreSetEventHandler(this._raiseEvent.bind(this)),this._raiseLoadComplete(!0)}catch(t){s.warn(t),this._raiseLoadComplete(!1)}},t.prototype.dispose=function(t){try{this._skypeModule.skypeCoreDestroy()}catch(n){s.warn(n)}e.prototype.dispose.call(this,t)},t.prototype._invokeMethod=function(e,t,n,r){function i(){}s.log("ElectronSkypeCore::"+e+", "+JSON.stringify(t)),n=n||i,r=r||i;try{var o=this._skypeModule.skypeCoreMethod(e,t||{});n(o||{})}catch(u){s.warn(u),r(u)}},t}(n["default"]);t.ElectronSkypeCore=o,t.build=u});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/electron/electronVideoRenderer",["require","exports","./electronBase","../../../../lib/telemetry/logging/callingLogTracer","swx-browser-globals"],e)})(function(e,t){function u(e){return new o(e)}var n=e("./electronBase"),r=e("../../../../lib/telemetry/logging/callingLogTracer"),i=e("swx-browser-globals"),s=r.get(),o=function(e){function t(t){var n=e.call(this)||this;return n._parentElementId=t,n._renderer=new n._skypeModule.VideoRenderer,n._renderer.onVideoResolutionChanged=n._raiseVideoResolutionChanged.bind(n),n}return __extends(t,e),t.prototype.load=function(){var e=i.getDocument().getElementById(this._parentElementId);try{this._renderer.initialize(e),this._raiseLoadComplete(!0)}catch(t){s.warn(t),this._raiseLoadComplete(!1)}},t.prototype.dispose=function(t){try{this._renderer.dispose()}catch(n){s.warn(n)}delete this._parentElementId,delete this._renderer,e.prototype.dispose.call(this,t)},t.prototype.getFrameSink=function(e){var t=this._renderer.getFrameSinkId();e&&e({frameSinkId:t})},t.prototype.setRenderingMode=function(e,t){var n=this._skypeModule.VideoRenderer.SCALING_MODE,r={Stretch:n.STRETCH,Crop:n.CROP,Fit:n.FIT};this._renderer.setScalingMode(r[e]),t&&t()},t.prototype._raiseVideoResolutionChanged=function(e,t){this._raiseEvent("VideoResolutionChanged",{width:e,height:t})},t.prototype.setupVideo=function(e,t){var n=this;this.getFrameSink(function(r){var i=r.frameSinkId;n.setRenderingMode(e,function(){t(i)})})},t}(n["default"]);t.ElectronVideoRenderer=o,t.build=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/componentFactory",["require","exports","./managerComponent","./skypeCoreComponent","./videoComponent","../../../lib/services/plugin/electron/electronManager","../../../lib/services/plugin/electron/electronSkypeCore","../../../lib/services/plugin/electron/electronVideoRenderer","swx-browser-detect"],e)}(function(e,t){function f(){return a["default"].getBrowserInfo().isElectron}function l(){return f()?s.build():new n["default"]}function c(e){return f()?o.build():new r["default"](e)}function h(e,t){return f()?u.build(t):new i["default"](e,t)}var n=e("./managerComponent"),r=e("./skypeCoreComponent"),i=e("./videoComponent"),s=e("../../../lib/services/plugin/electron/electronManager"),o=e("../../../lib/services/plugin/electron/electronSkypeCore"),u=e("../../../lib/services/plugin/electron/electronVideoRenderer"),a=e("swx-browser-detect");t.createManagerComponent=l,t.createSkypeCoreComponent=c,t.createVideoComponent=h}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/pluginUpdate",["require","exports","jskype-settings-instance","jskype-constants","swx-browser-globals"],e)}(function(e,t){function o(e,r){function a(e){f(t.REASONS.TIMEOUT+e)}function f(e){o.pluginUpdateReason=e,p(!1,o)}function l(e){o.pluginUpdateSuccess=!0,p(e,e?o:undefined)}function c(e){s=i.getWindow().setTimeout(a.bind(null,e.name),e.timeout)}function h(){i.getWindow().clearTimeout(s)}function p(t,n){h(),e.onUpdateCheckComplete=null,e.onUpdateDownloadStarted=null,e.onUpdateDownloadComplete=null,e.onUpdateInstallStarted=null,e.onUpdateInstallComplete=null,r&&(r(Boolean(t),n),r=null)}function d(e){var r=n.settings.plugin.download.minVersion,i=n.settings.plugin.download.maxVersion,s=n.settings.plugin.manifestKey,o=n.settings.plugin.ecsService,u=e.runSoftwareUpdate(r,i,s,o);u instanceof Object&&u.error&&f(t.REASONS.RUN_SOFTWARE_UPDATE_ERROR+u.error)}function v(e){e.onUpdateCheckComplete=m,e.onUpdateDownloadStarted=g,e.onUpdateDownloadComplete=y,e.onUpdateInstallStarted=b,e.onUpdateInstallComplete=w}function m(e){h(),e&&e.success!==undefined?e.success?e.updateVersion?(o.pluginUpdateVersion=e.updateVersion,c(t.STEPS.DOWNLOAD_STARTED)):l(!1):f(t.REASONS.UPDATE_CHECK_FAILURE):f(t.REASONS.UPDATE_CHECK_ARGS_ERROR)}function g(){h(),c(t.STEPS.DOWNLOAD_COMPLETE)}function y(e){h(),e&&e.success!==undefined?e.success?c(t.STEPS.INSTALL_STARTED):f(t.REASONS.UPDATE_DOWNLOAD_FAILURE):f(t.REASONS.UPDATE_DOWNLOAD_ARGS_ERROR)}function b(){h(),c(t.STEPS.INSTALL_COMPLETE)}function w(e){h(),e&&e.success!==undefined?e.success?l(!0):f(t.REASONS.UPDATE_INSTALL_FAILURE):f(t.REASONS.UPDATE_INSTALL_ARGS_ERROR)}var o={pluginUpdateSuccess:!1,pluginUpdateReason:undefined,pluginUpdateVersion:undefined};if(!u()||t.wasTryingToUpdate){p();return}t.wasTryingToUpdate=!0,v(e),d(e),c(t.STEPS.CHECK_FOR_UPDATE)}function u(){return n.isFeatureOn(r.FEATURE_FLAGS.PLUGIN_AUTO_UPDATE)}var n=e("jskype-settings-instance"),r=e("jskype-constants"),i=e("swx-browser-globals"),s;t.STEPS={CHECK_FOR_UPDATE:{timeout:1e4,name:"check_update"},DOWNLOAD_STARTED:{timeout:1e4,name:"download_started"},DOWNLOAD_COMPLETE:{timeout:3e4,name:"download_complete"},INSTALL_STARTED:{timeout:1e4,name:"install_started"},INSTALL_COMPLETE:{timeout:1e4,name:"install_complete"}},t.REASONS={RUN_SOFTWARE_UPDATE_ERROR:"RunSoftwareUpdate: ",UPDATE_CHECK_FAILURE:"UpdateCheckComplete: check failure",UPDATE_CHECK_ARGS_ERROR:"UpdateCheckComplete: event error, missing args",UPDATE_DOWNLOAD_FAILURE:"UpdateDownloadComplete: download failure",UPDATE_DOWNLOAD_ARGS_ERROR:"UpdateDownloadComplete: event error, missing args",UPDATE_INSTALL_FAILURE:"UpdateInstallComplete: install failure",UPDATE_INSTALL_ARGS_ERROR:"UpdateInstallComplete: event error, missing args",TIMEOUT:"Timeout: "},t.wasTryingToUpdate=!1,t.updateLatest=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/device",["require","exports","jcafe-property-model","../../lib/services/calling/callingFacade"],e)}(function(e,t){var n=e("jcafe-property-model"),r=e("../../lib/services/calling/callingFacade"),i=function(){function e(e,t,i){this.name=n.property({get:function(){return r.getDeviceName(t,e)},value:e}),this.id=n.property({value:t}),this.type=n.property({value:i})}return e}();t.__esModule=!0,t["default"]=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/deviceHandlers",["require","exports","swx-jskype-internal-application-instance","../../../lib/models/device","swx-enums","swx-constants"],e)}(function(e,t){function o(e){var t=f(e);return function(n){if(n.deviceId){var i=new r["default"](n.deviceName,n.deviceId,e);t._add(i,n.deviceId)}}}function u(e){var t=f(e),n=l(e);return function(e){var r=t(e.deviceId);t._remove(e.deviceId),n()===r&&n._set(null)}}function a(e){var t=f(e),n=l(e);return function(e){var r=e.deviceId||s.COMMON.deviceSelection.DEFAULT_ID,i=t(r);if(n()&&n().id()===r)return;n._set(i)}}function f(e){switch(e){case i.deviceType.Camera:return n.get().devicesManager.cameras;case i.deviceType.Microphone:return n.get().devicesManager.microphones;case i.deviceType.Speaker:return n.get().devicesManager.speakers}}function l(e){switch(e){case i.deviceType.Camera:return n.get().devicesManager.selectedCamera;case i.deviceType.Microphone:return n.get().devicesManager.selectedMicrophone;case i.deviceType.Speaker:return n.get().devicesManager.selectedSpeaker}}var n=e("swx-jskype-internal-application-instance"),r=e("../../../lib/models/device"),i=e("swx-enums"),s=e("swx-constants");t.createOnDeviceAddedHandler=o,t.createOnDeviceRemovedHandler=u,t.createOnDeviceSelectedHandler=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/telemetry/pluginTelemetry",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","lodash-compat"],e)}(function(e,t){function o(e){return new s(e)}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("lodash-compat"),s=function(){function e(e){var t=this;this.logPluginCrashed=function(){t.sendBasicEvent("PluginCrashed")},this.logPluginAlreadyRunning=function(){t.sendBasicEvent("PluginAlreadyRunning")},this.logPluginInitializationTimeout=function(){t.sendBasicEvent("PluginInitializationTimeout")},this.logPluginUpdate=function(e){var n=t.createEvent("PluginUpdate");i.extend(n,e),t.sendEvent(n)},this.version=e,e?this.sendBasicEvent("PluginStarted"):this.version="Unknown"}return e.prototype.sendBasicEvent=function(e){var t=this.createEvent(e);this.sendEvent(t)},e.prototype.sendEvent=function(e){n.get()._telemetryManager.sendEvent(r.settings.telemetry.jSkypeTenantToken,"Calling",e)},e.prototype.createEvent=function(e){return{name:e,plugin_version:this.version}},e}();t.PluginTelemetry=s,t.getLogger=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/participantVoiceState",["require","exports"],e)}(function(e,t){t.__esModule=!0,t["default"]={speaking:"Speaking",listening:"Listening",hold:"OnHold",ringing:"Ringing",joining:"Joining",earlyMedia:"EarlyMedia",leaving:"Leaving",finished:"Finished"}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/participantVideoState",["require","exports"],e)}(function(e,t){t.__esModule=!0,t["default"]={available:"Available",starting:"Starting",rendering:"Rendering",stopping:"Stopping",notAvailable:"NotAvailable"}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/mappers/callStateMapper",["require","exports","swx-enums"],e)}(function(e,t){function i(e){return r[e]}var n=e("swx-enums"),r={RingingOut:n.callConnectionState.Connecting,InProgress:n.callConnectionState.Connected};t.CALL_STATES={ringingIn:"RingingIn",ringingOut:"RingingOut",initializing:"Initializing",inProgress:"InProgress",othersAreLive:"OthersAreLive",ringingForMe:"RingingForMe",transferring:"Transferring",downgraded:"Downgraded",onHold:"OnHold",inVoiceMail:"InVoiceMail",finished:"Finished",unknown:"Unknown"},t.toCafeState=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/mappers/callLeaveReasonMapper",["require","exports","swx-enums"],e)}(function(e,t){function i(e){return r[e]}var n=e("swx-enums"),r={Terminated:n.callDisconnectionReason.Terminated,FullSession:n.callDisconnectionReason.FullSession,Busy:n.callDisconnectionReason.Busy,Refused:n.callDisconnectionReason.Refused,Missed:n.callDisconnectionReason.Missed,Dropped:n.callDisconnectionReason.Dropped,InvalidNumber:n.callDisconnectionReason.InvalidNumber,ForbiddenNumber:n.callDisconnectionReason.ForbiddenNumber,EmergencyCallDenied:n.callDisconnectionReason.EmergencyCallDenied,VoiceMailFailed:n.callDisconnectionReason.VoiceMailFailed,TransferFailed:n.callDisconnectionReason.TransferFailed,InsufficientFunds:n.callDisconnectionReason.InsufficientFunds,Failed:n.callDisconnectionReason.Failed,AlreadyEnded:n.callDisconnectionReason.Missed,CallerUnreachable:n.callDisconnectionReason.Refused};t.CALL_LEAVE_REASONS={terminated:"Terminated",fullSession:"FullSession",busy:"Busy",refused:"Refused",missed:"Missed",dropped:"Dropped",invalidNumber:"InvalidNumber",forbiddenNumber:"ForbiddenNumber",emergencyCallDenied:"EmergencyCallDenied",voiceMailFailed:"VoiceMailFailed",transferFailed:"TransferFailed",insufficientFunds:"InsufficientFunds",failed:"Failed",alreadyEnded:"AlreadyEnded",callerUnreachable:"CallerUnreachable",unknown:"Unknown"},t.toCafeReason=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/calling/deviceHelper",["require","exports","swx-jskype-internal-application-instance","swx-enums","swx-constants"],e)}(function(e,t){function s(){return u(r.deviceType.Speaker)}function o(){return u(r.deviceType.Microphone)}function u(e){var t=a(e);return t().length>1||t().length===1&&t(0).id()!==i.COMMON.deviceSelection.DEFAULT_ID}function a(e){switch(e){case r.deviceType.Camera:return n.get().devicesManager.cameras;case r.deviceType.Microphone:return n.get().devicesManager.microphones;case r.deviceType.Speaker:return n.get().devicesManager.speakers}}var n=e("swx-jskype-internal-application-instance"),r=e("swx-enums"),i=e("swx-constants");t.isSpeakerAvailable=s,t.isMicrophoneAvailable=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/pluginDominantSpeaker",["require","exports","lodash-compat"],e)}(function(e,t){var n=e("lodash-compat"),r=function(){function e(e){this.id=e,this.startTimestamp=0,this.totalTime=0}return e}(),i=function(){function e(e,t){this.sources=[],this.timeToPromote=e&&e.timeToPromote,this.callback=t}return e.prototype.setSources=function(e,t){var n=this;this.conversation=t;var r=e&&e.audio.isSpeaking()?[e]:[],i=r.map(this.getOrCreateSource.bind(this)),s=this.excludeSources(this.sources,i);i.filter(function(e){return!n.isAlreadyActive(e)}).forEach(this.updateSourceTimestamp),s.forEach(function(e){n.updateTotalTime(e),n.resetStartTimestamp(e)}),this.ping||(this.ping=this.setupTimer())},e.prototype.dispose=function(){this.clearTimer(),this.sources=null,this.callback=null},e.prototype.excludeSources=function(e,t){return e.filter(function(e){return!t.some(function(t){return e.id===t.id})})},e.prototype.trigger=function(){var e=function(e,t){return t.totalTime-e.totalTime},t=function(e){return e.id};if(!this.hasAnyoneSpoken()){this.clearTimer();return}var r=this.sources.map(this.updateTotalTime).sort(e).map(t);r.length&&!n.isEqual(this.candidates,r)&&(this.candidates=r,this.callback&&this.callback(r[0],this.conversation)),this.sources.map(this.resetTotalTime).filter(this.isAlreadyActive).forEach(this.updateSourceTimestamp)},e.prototype.isAlreadyActive=function(e){return!!e.startTimestamp},e.prototype.setupTimer=function(){return setInterval(this.trigger.bind(this),this.timeToPromote)},e.prototype.clearTimer=function(){this.ping&&(clearInterval(this.ping),this.ping=null)},e.prototype.getOrCreateSource=function(e){if(!this.isExist(e)){var t=new r(e);return this.sources.push(t),t}return this.sourceById(e)},e.prototype.isExist=function(e){return this.sources.some(function(t){return e===t.id})},e.prototype.hasAnyoneSpoken=function(){return this.sources.some(function(e){return e.startTimestamp!==0||e.totalTime!==0})},e.prototype.sourceById=function(e){return n.find(this.sources,function(t){return e===t.id})},e.prototype.updateSourceTimestamp=function(e){e.startTimestamp=Date.now()},e.prototype.updateTotalTime=function(e){return e.startTimestamp&&(e.totalTime+=Date.now()-e.startTimestamp),e},e.prototype.resetStartTimestamp=function(e){return e.startTimestamp=0,e},e.prototype.resetTotalTime=function(e){return e.totalTime=0,e},e}();t.DominantSpeakerManager=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/pluginEventDispatcher",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","./participantVoiceState","./participantVideoState","../../../lib/services/plugin/mappers/callStateMapper","../../../lib/services/plugin/mappers/callLeaveReasonMapper","swx-constants","swx-enums","swx-constants","swx-constants","../../../lib/services/callRegister","../../../lib/modelHelpers/calling/participantHelper","../../../lib/modelHelpers/calling/deviceHelper","swx-utils-chat","swx-mri/lib/mriMaps","../../../lib/modelHelpers/propertyValidator","../../../lib/telemetry/logging/callingLogTracer","../../../lib/services/preferences/settingsUtils/privacySettingsUtil","./pluginDominantSpeaker"],e)}(function(e,t){function L(e){e.onCallStatusChanged=P(H),e.onParticipantVoiceStatusChanged=P(q),e.onParticipantVideoStatusChanged=P(U),e.onParticipantSoundLevelChanged=P(B),e.onParticipantSpeakerStatusChanged=P(I),e.onParticipantLeaveReasonChanged=P(R),e.onParticipantJoined=P(G),e.onParticipantLeft=P(Y),e.onMicrophoneMuted=P(Z),e.onMicrophoneUnmuted=P(et),e.onErrorOccured=P(V),e.onCallIsHostlessChanged=P(tt),e.onCallTechnologyChanged=P(nt),e.onTextMessage=P(J),e.onCallMoved=K,e.onConvoIdentityReceived=Q,e.onConnectionStatusChanged=$}function A(e){e.onLocalResolutionChanged=z,e.onResolutionChanged=W}function O(e,t,n){x[e]||(x[e]=[]),x[e].push({handlerFn:t,data:n})}function M(e){e?delete x[e]:x={}}function _(e,t){x[e]&&(x[e].forEach(function(e){e.data.convoIdentity=t,e.handlerFn(e.data)}),M(e))}function D(e){return/^#/.test(e)}function P(e){return function(t){if(D(t.convoIdentity)){O(t.convoIdentity,e,t);return}e(t)}}function H(e){var t=it(e),n=at(e.convoIdentity)||ct(e.callId);if(!n)return;n.audioService.callId._set(e.callId),n._callData.nodeId(S),ot(e.callStatus,n);switch(e.callStatus){case o.CALL_STATES.ringingForMe:n._internalCallTelemetry.recordStep(o.CALL_STATES.ringingForMe),n.isGroupConversation()&&n._callData.pluginOthersAreLive(!0),n._callData.pluginAwaitCall()?(n._callData.pluginAwaitCall(!1),p.updateParticipantAudioVideoState(n.selfParticipant,f.callConnectionState.Notified,t)):n._callData.pluginRingingForMe(!0);break;case o.CALL_STATES.othersAreLive:n._callData.pluginOthersAreLive(!0),n._callData.pluginAwaitCall()&&(n._callData.pluginAwaitCall(!1),p.updateParticipantAudioVideoState(n.selfParticipant,f.callConnectionState.Notified,t)),n.selfParticipant.audio.state()===f.callConnectionState.Disconnecting&&n.selfParticipant.audio.state.reason===f.callDisconnectionReason.Terminated&&p.handleParticipantLeavingStateTransition(n.selfParticipant,t),n.selfParticipant.audio.state()===f.callConnectionState.Connected&&!p.isAnyRemoteParticipantConnected(n.participants())&&p.handleParticipantLeavingStateTransition(n.selfParticipant,st());break;case o.CALL_STATES.finished:n._internalCallTelemetry.recordStep(o.CALL_STATES.finished),e.callLeaveReason===f.callDisconnectionReason.Terminated?n._callData.pluginOthersAreLive(!1):e.callLeaveReason===f.callDisconnectionReason.Failed&&n.selfParticipant.audio._isFailedCall(!0),p.handleParticipantLeavingStateTransition(n.selfParticipant,t),p.handleRemoteParticipantsLeavingStateTransition(n.participants(),t);break;default:o.toCafeState(e.callStatus)&&n.selfParticipant.audio.state()!==f.callConnectionState.Disconnected&&(n._internalCallTelemetry.recordStep("CallStatus_"+e.callStatus),p.updateParticipantAudioVideoState(n.selfParticipant,o.toCafeState(e.callStatus),t))}}function B(e){if(!e.convoIdentity)return;var t=at(e.convoIdentity),n=p.getOrCreateParticipantInConversation(t,e.participantId),i=r.SoundLevelEventMode||l.CALLING.SOUND_LEVEL_EVENT_MODE.Boolean,s=parseInt(e.soundLevel,10);if(!n){E.warn("Unable to get participant",e.participantId);return}if(i===l.CALLING.SOUND_LEVEL_EVENT_MODE.None)return;i===l.CALLING.SOUND_LEVEL_EVENT_MODE.Boolean?n.audio.isSpeaking._set(s===l.CALLING.PLUGIN_MAX_SOUND_LEVEL):i===l.CALLING.SOUND_LEVEL_EVENT_MODE.Full&&n.audio.isSpeaking._set(Boolean(s)),F().setSources(n,t)}function j(e,t){t.videoService.activeSpeaker.participant._set(e)}function F(){return k||(k=new w.DominantSpeakerManager(r.settings.pluginless.mediaAgent.activeSpeaker,j)),k}function I(e){var t=at(e.convoIdentity),n=p.getOrCreateParticipantInConversation(t,e.participantId);if(!n){E.warn("Unable to get participant",e.participantId);return}n.audio.isSpeaking._set(e.isActiveSpeaker),F().setSources(n,t)}function q(e){if(!e.convoIdentity)return undefined;var t=at(e.convoIdentity),r=p.getOrCreateParticipantInConversation(t,e.participantId),s=[i["default"].speaking,i["default"].listening,i["default"].hold];return r?C.isMeParticipant(r,n.get().personsAndGroupsManager)?!1:(t._internalCallTelemetry.recordStep("VoiceStatus_"+e.voiceStatus),e.voiceStatus===i["default"].ringing&&p.handleParticipantRingingStateTransition(r,t),e.voiceStatus===i["default"].joining&&t.isGroupConversation()&&p.handleParticipantRingingStateTransition(r,t),e.voiceStatus===i["default"].leaving&&p.handleParticipantLeavingStateTransition(r,e.callLeaveReason),e.voiceStatus===i["default"].earlyMedia&&p.updateParticipantAudioVideoState(r,f.callConnectionState.EarlyMedia),s.indexOf(e.voiceStatus)>-1&&p.handleParticipantJoiningStateTransition(r,t),undefined):(E.warn("Unable to get participant",e.participantId),undefined)}function R(e){if(!e.convoIdentity)return undefined;var t=at(e.convoIdentity),r=p.getOrCreateParticipantInConversation(t,e.participantId);return r?C.isMeParticipant(r,n.get().personsAndGroupsManager)?!1:((r.audio.state()===f.callConnectionState.Disconnecting||r.audio.state()===f.callConnectionState.Disconnected)&&e.callLeaveReason!==f.callDisconnectionReason.Unknown&&p.updateParticipantAudioVideoState(r,r.audio.state(),e.callLeaveReason),undefined):(E.warn("Unable to get participant",e.participantId),undefined)}function U(e){if(!e.convoIdentity||!e.participantId)return;if(e.mediaType===l.CALLING.PLUGIN_MEDIA_TYPES.SCREEN_SHARING&&!r.isFeatureOn(a.COMMON.featureFlags.INCOMING_SCREEN_SHARING))return;var t=at(e.convoIdentity),i=p.getOrCreateParticipantInConversation(t,e.participantId),o=e.mediaType===l.CALLING.PLUGIN_MEDIA_TYPES.SCREEN_SHARING,u=i.video.channels(0),c=u.stream,h=i.screenSharing.stream,d=C.isMeParticipant(i,n.get().personsAndGroupsManager);if(!i){E.warn("Unable to get participant",e.participantId);return}if(u&&h){var v=o?h:c;b.checkVideoPolicySettings(i).then(function(t){E.warn("Updating stream state : ",e.participantId,e.videoStatus," current state",v.state());switch(e.videoStatus){case s["default"].available:if(t||d)d?(v.state()!==f.mediaStreamState.Stopped&&o&&v.state._set(f.mediaStreamState.Stopped),o||u.isStarted.set._enabled(!0)):(o||u.isVideoOn._set(!0),v.state._set(f.mediaStreamState.Started));break;case s["default"].starting:t&&(d?v.state._set(f.mediaStreamState.Active):v.state._set(f.mediaStreamState.Inactive));break;case s["default"].rendering:t&&(v.state._set(f.mediaStreamState.Active),o||u.isStarted.set._enabled(!0),!d&&!o&&u.isVideoOn._set(!0));break;case s["default"].stopping:case s["default"].notAvailable:o||(u.isStarted.set._enabled(!0),d||u.isVideoOn._set(!1)),v.state._set(f.mediaStreamState.Stopped)}})}}function z(e){var t=h.get().activeCalls()[0];if(!t)return;var n=t.selfParticipant.video.channels(0);n.stream.width._set(e.width),n.stream.height._set(e.height)}function W(e,t,n){var r=h.get().activeCalls()[0];if(!r){E.warn("Unable to get active conversation, ignoring event");return}var i=p.getOrCreateParticipantInConversation(r,t);if(!i){E.warn("Unable to get participant",t,"ignoring event");return}var s=n===l.CALLING.PLUGIN_MEDIA_TYPES.SCREEN_SHARING?i.screenSharing.stream:i.video.channels(0).stream;s.state()!==f.mediaStreamState.Stopped&&s.state._set(f.mediaStreamState.Active),s.width._set(e.width),s.height._set(e.height)}function X(e){ht(function(t){var n=t.participants.subscribe();p.handleRemoteParticipantsLeavingStateTransition(t.participants(),e),M(),n.dispose(),p.handleParticipantLeavingStateTransition(t.selfParticipant,e),t._callData.pluginOthersAreLive(!1)})}function V(e){var t=n.get().devicesManager.selectedCamera();e.reason===c.PLUGIN_CONST.PLUGIN_ERRORS.REASON_CANNOT_CAPTURE&&t!==null&&ht(function(e){e.selfParticipant.video.channels(0).stream.state._set(f.mediaStreamState.Stopped)})}function $(e){e.nodeId&&(S=e.nodeId)}function J(e){if(e.senderIdentity==="sys"&&e.messageBody&&/CallInformation/.test(e.messageBody)){var t=at(e.convoIdentity);t._callData.pluginCallInfo(e.messageBody)}}function K(e){if(!r.isFeatureOn(a.COMMON.featureFlags.GVC_ESCALATION))return;var t=at(e.oldConvoIdentity);t.selfParticipant.video.channels(0).isStarted.set._enabled(!1),t.selfParticipant.audio.isMuted.set.enabled._set(!1);if(!D(e.newConvoIdentity)){var n=at(e.newConvoIdentity);t.spawnedConversation._set(n)}else T[e.newConvoIdentity]=e.oldConvoIdentity}function Q(e){var t=e.tempConvoIdentity,n=e.realConvoIdentity;if(!T[t])return;var r=at(T[t]),i=at(n);r.spawnedConversation._set(i),_(t,n)}function G(e){var t=at(e.convoIdentity);p.getOrCreateParticipantInConversation(t,e.participantId)}function Y(e){var t=at(e.convoIdentity),n=N.getParticipantFromConversation(t,e.participantId);if(!n){E.warn("Unable to get participant",e.participantId);return}p.handleParticipantLeavingStateTransition(n),t._removeParticipant(n.person)}function Z(e){var t=at(e.convoIdentity);if(!t){E.error("Trying to mute microphone but conversation does not exist",e.convoIdentity);return}ut(t,!0)}function et(e){var t=at(e.convoIdentity);if(!t){E.error("Trying to unmute microphone but conversation does not exist",e.convoIdentity);return}ut(t,!1)}function tt(e){var t=at(e.convoIdentity);if(!t){E.error("Call hostless flag changed for conversation that does not exist",e.convoIdentity);return}t._callData.isHostless=e.callIsHostless}function nt(e){var t=at(e.convoIdentity)||ct(e.callId);if(!t){E.error("Call technology changed for conversation that does not exist",e.convoIdentity);return}t._callData.callTechnology(e.callTechnology),t.mediaConnectionType(rt(e.callTechnology))}function rt(e){switch(e){case f.callTechnology.P2P:return f.mediaConnectionType.PluginBasedP2P;case f.callTechnology.NGC:return f.mediaConnectionType.PluginBasedNGC;default:return f.mediaConnectionType.Unknown}}function it(e){var t;return e.callLeaveReason&&(t=u.toCafeReason(e.callLeaveReason),t===f.callDisconnectionReason.Terminated&&(t=st())),t}function st(){return d.isSpeakerAvailable()?d.isMicrophoneAvailable()?f.callDisconnectionReason.Terminated:f.callDisconnectionReason.MissingMicrophone:f.callDisconnectionReason.MissingSpeaker}function ot(e,t){if(!t._callHandler){E.warn("Trying to update canMute in conversation without active call",t.conversationId);return}(e===o.CALL_STATES.ringingForMe||e===o.CALL_STATES.othersAreLive||e===o.CALL_STATES.inProgress||e===o.CALL_STATES.ringingIn||e===o.CALL_STATES.ringingOut)&&t._callHandler.canToggleMute(!0)}function ut(e,t){if(!e._callHandler){E.warn("[setMicrophoneMuted] Unable to find callHandler, ignoring event");return}var n=e._callHandler.toggleMuteTask;n&&n.promise.state()==="pending"&&n.resolve(t)}function at(e){if(!e)return;e=lt(e);if(!ft(e)){var t=g.isPhoneNumber(e)?m.contactMriTypes.pstn+":":m.contactMriTypes.skype+":";e=t+e}return n.get().conversationsManager._getOrCreateConversation(e)}function ft(e){return/^(?:1|19|8|4):/.test(e)}function lt(e){return e.replace(/#\w\//,"")}function ct(e){return e?h.get().getConversationByCallId(e):undefined}function ht(e){var t=h.get().activeCalls();t.forEach(e)}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("./participantVoiceState"),s=e("./participantVideoState"),o=e("../../../lib/services/plugin/mappers/callStateMapper"),u=e("../../../lib/services/plugin/mappers/callLeaveReasonMapper"),a=e("swx-constants"),f=e("swx-enums"),l=e("swx-constants"),c=e("swx-constants"),h=e("../../../lib/services/callRegister"),p=e("../../../lib/modelHelpers/calling/participantHelper"),d=e("../../../lib/modelHelpers/calling/deviceHelper"),v=e("swx-utils-chat"),m=e("swx-mri/lib/mriMaps"),g=e("../../../lib/modelHelpers/propertyValidator"),y=e("../../../lib/telemetry/logging/callingLogTracer"),b=e("../../../lib/services/preferences/settingsUtils/privacySettingsUtil"),w=e("./pluginDominantSpeaker"),E=y.get(),S=null,x={},T={},N=v.conversation,C=v.participant,k=null;t.startListeningOnSkypeCore=L,t.startListeningOnVideoManager=A,t.clearTempConversationEvents=M,t.onManagerComponentCrashed=X}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/pluginDetect",["require","exports","swx-browser-globals","swx-browser-detect","swx-constants"],e)}(function(e,t){function s(){var e=r["default"].getBrowserInfo();return e.isElectron?!0:e.isIeEngine?o(e):u()}function o(e){try{var t=n.getWindow().ActiveXObject;return new t(i.PLUGIN_CONST.PROGID_VERSION),!0}catch(r){return!1}}function u(){var e=n.getWindow();e.navigator.plugins&&e.navigator.plugins.refresh&&e.navigator.plugins.refresh();if(!e.navigator.mimeTypes)return!1;var t=e.navigator.mimeTypes;return t[i.PLUGIN_CONST.MIME_TYPE]?t[i.PLUGIN_CONST.MIME_TYPE].enabledPlugin!==undefined:!1}var n=e("swx-browser-globals"),r=e("swx-browser-detect"),i=e("swx-constants");t.isPluginInstalled=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/pluginCore",["require","exports","jcafe-property-model","jskype-settings-instance","swx-enums","../../../lib/services/internalPubSub","./componentFactory","./pluginUpdate","swx-constants","jskype-constants","swx-constants","./deviceHandlers","../../../lib/telemetry/pluginTelemetry","./pluginEventDispatcher","swx-jskype-internal-application-instance","swx-utils-common/lib/version","swx-browser-globals","./pluginDetect"],e)}(function(e,t){function b(){return g.isPluginInstalled()}function w(){return new y}var n=e("jcafe-property-model"),r=e("jskype-settings-instance"),i=e("swx-enums"),s=e("../../../lib/services/internalPubSub"),o=e("./componentFactory"),u=e("./pluginUpdate"),a=e("swx-constants"),f=e("jskype-constants"),l=e("swx-constants"),c=e("./deviceHandlers"),h=e("../../../lib/telemetry/pluginTelemetry"),p=e("./pluginEventDispatcher"),d=e("swx-jskype-internal-application-instance"),v=e("swx-utils-common/lib/version"),m=e("swx-browser-globals"),g=e("./pluginDetect"),y=function(){function e(){var e=this;this.shouldReinitialize=!1,this.get=function(){if(!g.isPluginInstalled())return Promise.reject(a.PLUGIN_CONST.PLUGIN_ERRORS.NOT_INSTALLED);var t=function(){return e.initTask||e.initialize()};return e.disposeTask?e.initTask=e.disposeTask.promise.then(t):e.initTask=t(),e.initTask},this.getManager=function(){return g.isPluginInstalled()?e.createManager():Promise.reject(a.PLUGIN_CONST.PLUGIN_ERRORS.NOT_INSTALLED)},this.isManagerLoaded=function(){return e.managerTask?e.managerTask.promise.state()==="resolved":!1},this.onCrash=function(t){e.crashCallback=t},this.dispose=function(t){return e.managerLoadTimeout&&m.getWindow().clearTimeout(e.managerLoadTimeout),e.initTask?e.isPluginPersistent&&!t?Promise.reject(null):e.disposeTask?e.disposeTask.promise:(e.disposeTask=n.task(),e.initTask.then(e.disposeInternals.bind(e))["catch"](e.disposeInternals.bind(e)).then(e.onDisposed.bind(e)),e.shouldReinitialize&&e.disposeTask.promise.then(e.get),e.disposeTask.promise):Promise.resolve()}}return e.prototype.initialize=function(){var e=this;return this.failedLoginAttempts=0,this.createManager().then(this.updatePlugin.bind(this)).then(this.createSkypeCore.bind(this)).then(this.login.bind(this)).then(function(){return e.shouldReinitialize=!0,{managerComponent:e.managerComponent,skypeCoreComponent:e.skypeCoreComponent}})},e.prototype.disposeInternals=function(){var e=[];return this.removeAllDevices(),this.managerComponent.onComponentCrashed=null,e.push(this.disposeComponent(this.skypeCoreComponent)),e.push(this.disposeComponent(this.managerComponent)),n.task.waitAll(e)},e.prototype.onDisposed=function(){this.initTask=null,this.managerTask=null,this.managerComponent=null,this.skypeCoreComponent=null,this.disposeTask.resolve(),this.disposeTask=null},e.prototype.createManager=function(){var e=this;return this.managerTask?this.managerTask.promise:(s.get().publish("internalPluginEvent","managerLoad"),this.managerTask=n.task(),this.managerComponent=o.createManagerComponent(),this.managerComponent.onLoadComplete=this.onManagerLoaded.bind(this),this.managerComponent.onComponentCrashed=this.onManagerCrashed.bind(this),this.managerLoadTimeout=m.getWindow().setTimeout(function(){e.managerComponent.onLoadComplete=null,e.managerTask.reject(a.PLUGIN_CONST.PLUGIN_ERRORS.MANAGER_LOAD_TIMEOUT),e.managerTask=null,e.disposeComponent(e.managerComponent)},r.settings.plugin.managerLoadTimeout),this.managerComponent.load(),this.managerTask.promise)},e.prototype.onManagerLoaded=function(e){m.getWindow().clearTimeout(this.managerLoadTimeout),e.result===a.PLUGIN_CONST.LOAD_RESULT.LOAD_SUCCESSFUL?(this.reportPluginVersion(),this.setIsPluginPeristentFlag(),this.attachPluginTelemetry(),s.get().publish("internalPluginEvent","managerLoadSuccess"),this.managerTask.resolve()):(s.get().publish("internalPluginEvent","managerLoadError"),this.managerTask.reject(a.PLUGIN_CONST.PLUGIN_ERRORS.MANAGER_LOAD_ERROR))},e.prototype.onAlreadyExists=function(){this.reportAlreadyExists(),this.dispose(!0)},e.prototype.onManagerCrashed=function(){this.reportCrash(),this.dispose(!0)},e.prototype.reportCrash=function(){this.telemetryLogger&&this.telemetryLogger.logPluginCrashed(),this.crashCallback&&this.crashCallback()},e.prototype.reportAlreadyExists=function(){this.telemetryLogger&&this.telemetryLogger.logPluginAlreadyRunning(),this.crashCallback&&this.crashCallback()},e.prototype.attachPluginTelemetry=function(){var e=this;this.managerComponent.getVersion(function(t){e.telemetryLogger=h.getLogger(t)})},e.prototype.setIsPluginPeristentFlag=function(){var e=this;this.managerComponent.getVersion(function(t){var n=v.parse(t),i=v.parse(a.PLUGIN_CONST.PERSISTENT_REQUIRED_VERSION);n.compareTo(i)>=0&&r.isFeatureOn(l.COMMON.featureFlags.PERSISTENT_PLUGIN)?e.isPluginPersistent=!0:e.isPluginPersistent=!1})},e.prototype.reportPluginVersion=function(){this.managerComponent.getVersion(function(e){d.get()._telemetryManager.setCommonProperty(f.CALLING.eventProperties.PluginVersion,e)})},e.prototype.updatePlugin=function(){var e=this,t=n.task();return s.get().publish("internalPluginEvent","pluginUpdate"),u.updateLatest(this.managerComponent,function(n,r){e.telemetryLogger&&r&&e.telemetryLogger.logPluginUpdate(r),n?(s.get().publish("internalPluginEvent","pluginUpdateSucess"),e.reloadManagerComponent(t.resolve.bind(t))):(s.get().publish("internalPluginEvent","pluginUpdateSkipped"),t.resolve())}),t.promise},e.prototype.reloadManagerComponent=function(e){this.managerTask=null,this.disposeComponent(this.managerComponent).then(this.createManager.bind(this)).then(e)},e.prototype.createSkypeCore=function(){return this.skypeCoreTask=n.task(),s.get().publish("internalPluginEvent","skypeCoreLoad"),this.skypeCoreComponent=o.createSkypeCoreComponent(this.managerComponent.componentId),this.skypeCoreComponent.onErrorOccured=this.onSkypeCoreErrorOccured.bind(this),this.skypeCoreComponent.onLoadComplete=this.onSkypeCoreLoaded.bind(this),this.skypeCoreComponent.onLoginStatusChanged=this.onLoginStatusChanged.bind(this),this.attachDeviceEventHandlers(),this.skypeCoreComponent.load({biAppName:r.settings.biAppName}),this.skypeCoreTask.promise},e.prototype.attachDeviceEventHandlers=function(){this.skypeCoreComponent.onCameraDeviceAdded=c.createOnDeviceAddedHandler(i.deviceType.Camera),this.skypeCoreComponent.onCameraDeviceRemoved=c.createOnDeviceRemovedHandler(i.deviceType.Camera),this.skypeCoreComponent.onCameraDeviceSelected=c.createOnDeviceSelectedHandler(i.deviceType.Camera),this.skypeCoreComponent.onMicrophoneDeviceAdded=c.createOnDeviceAddedHandler(i.deviceType.Microphone),this.skypeCoreComponent.onMicrophoneDeviceRemoved=c.createOnDeviceRemovedHandler(i.deviceType.Microphone),this.skypeCoreComponent.onMicrophoneDeviceSelected=c.createOnDeviceSelectedHandler(i.deviceType.Microphone),this.skypeCoreComponent.onSpeakerDeviceAdded=c.createOnDeviceAddedHandler(i.deviceType.Speaker),this.skypeCoreComponent.onSpeakerDeviceRemoved=c.createOnDeviceRemovedHandler(i.deviceType.Speaker),this.skypeCoreComponent.onSpeakerDeviceSelected=c.createOnDeviceSelectedHandler(i.deviceType.Speaker)},e.prototype.addAndSelectDefaultAudioDevices=function(){this.skypeCoreComponent.onMicrophoneDeviceAdded({deviceId:l.COMMON.deviceSelection.DEFAULT_ID,deviceName:l.COMMON.deviceSelection.DEFAULT_NAME}),this.skypeCoreComponent.onSpeakerDeviceAdded({deviceId:l.COMMON.deviceSelection.DEFAULT_ID,deviceName:l.COMMON.deviceSelection.DEFAULT_NAME}),this.skypeCoreComponent.onMicrophoneDeviceSelected({deviceId:l.COMMON.deviceSelection.DEFAULT_ID}),this.skypeCoreComponent.onSpeakerDeviceSelected({deviceId:l.COMMON.deviceSelection.DEFAULT_ID})},e.prototype.onSkypeCoreLoaded=function(e){e.result===a.PLUGIN_CONST.LOAD_RESULT.LOAD_SUCCESSFUL?(p.startListeningOnSkypeCore(this.skypeCoreComponent),this.addAndSelectDefaultAudioDevices(),s.get().publish("internalPluginEvent","skypeCoreLoadSuccess"),this.skypeCoreTask.resolve()):s.get().publish("internalPluginEvent","skypeCoreLoadError")},e.prototype.onSkypeCoreErrorOccured=function(e){s.get().publish("internalPluginEvent",e.reason.toString()||"skypeCoreError"),e.reason===a.PLUGIN_CONST.PLUGIN_ERRORS.REASON_ALREADY_EXISTS&&(this.skypeCoreTask.reject(e.reason),this.shouldReinitialize=!1,this.dispose(!0),this.onAlreadyExists())},e.prototype.onLoginStatusChanged=function(e){if(e.loginStatus===a.PLUGIN_CONST.LOGIN_STATUS.LOGGED_IN){this.failedLoginAttempts=0,d.get().devicesManager._initializedDevices=!0,this.loginTask.promise.state()==="pending"&&(s.get().publish("internalPluginEvent","loginSuccess"),this.loginTask.resolve());return}e.loginStatus===a.PLUGIN_CONST.LOGIN_STATUS.LOGGED_OUT?(this.failedLoginAttempts++,this.failedLoginAttempts<a.PLUGIN_CONST.LOGIN_FAILURE_STOP_GAP?this.loginWithSkypeCore():this.abortLoginAttempts()):s.get().publish("internalPluginEvent",e.loginStatus.toString()||"unknownLoginStatusRaised")},e.prototype.login=function(){return this.loginTask=n.task(),this.loginWithSkypeCore(),this.loginTask.promise},e.prototype.abortLoginAttempts=function(){this.shouldReinitialize=!1,this.loginTask.promise.state()==="pending"&&this.loginTask.reject(a.PLUGIN_CONST.PLUGIN_ERRORS.LOGIN_ABORTED),this.onManagerCrashed()},e.prototype.loginWithSkypeCore=function(){var e=this,t=d.get().personsAndGroupsManager.mePerson.id();s.get().publish("internalPluginEvent","login");var n=d.get().signInManager,r=n._tokenExpiration?Math.round(n._tokenExpiration/1e3):0;n._skypeToken().then(function(n){e.skypeCoreComponent.loginWithSkypeToken(t,n,r)})},e.prototype.disposeComponent=function(e){var t=n.task();return e?e.dispose(function(){t.resolve()}):t.resolve(),t.promise},e.prototype.removeAllDevices=function(){var e=d.get().devicesManager;e.cameras._removeAll(),e.microphones._removeAll(),e.speakers._removeAll(),e.selectedCamera._set(undefined),e.selectedMicrophone._set(undefined),e.selectedSpeaker._set(undefined),delete d.get().devicesManager._initializedDevices},e}();t.PluginCore=y,t.isInstalled=b,t.build=w}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/videoManager",["require","exports","./componentFactory","swx-constants","swx-constants"],e)}(function(e,t){function o(e,t){return new s(e,t)}var n=e("./componentFactory"),r=e("swx-constants"),i=e("swx-constants"),s=function(){function e(e,t){this._localVideoMap={},this._participantVideos={},this._managerComponentId=e,this._skypeCore=t}return e.prototype.setupVideoContainer=function(e){e.id||(e.id="video-"+ +(new Date))},e.prototype.getParticipantVideo=function(e,t,n){var r=e._participantVideos;return r[t]||(r[t]={}),r[t][n]},e.prototype.showLocalPreview=function(e,t,i){var s=this,o=this._skypeCore,u=function(){return s._localVideoMap[t]&&(s._localVideoMap[t].embed||s._localVideoMap[t].creatingLocalVideo)};if(u())return;this._localVideoMap[t]={embed:null,creatingLocalVideo:!0,disposingLocalVideo:!1},this.setupVideoContainer(e);var a=n.createVideoComponent(this._managerComponentId,e.id);this._localVideoMap[t].embed=a;var f=function(e){o.setLocalFrameSink(e,function(){s._localVideoMap[t].creatingLocalVideo=!1,o.showLocalVideo(!0,i)})},l=a,c=function(){l.setupVideo(r.PLUGIN_CONST.VIDEO_MODE.CROP,f)},h=function(e){s.onLocalResolutionChanged&&s.onLocalResolutionChanged(e)};l.onLoadComplete=c,l.onVideoResolutionChanged=h,a.load(),l.whenUnloaded.then(function(){delete s._localVideoMap[t]})},e.prototype.startSendingLocalVideo=function(e,t){this._skypeCore.sendLocalVideo(!0,e,t)},e.prototype.hideLocalPreview=function(e,t){var n=this,r=function(){t&&t()},i=function(){delete n._localVideoMap[e],r()},s=function(){return n._localVideoMap[e]&&!n._localVideoMap[e].disposingLocalVideo};s()?(this._localVideoMap[e].disposingLocalVideo=!0,this._skypeCore.showLocalVideo(!1),this._localVideoMap[e].embed.whenUnloaded.then(i),this._localVideoMap[e].embed.dispose()):r()},e.prototype.stopSendingLocalVideo=function(e,t){this._skypeCore.sendLocalVideo(!1,e,t)},e.prototype.showParticipant=function(e,t,s){var o=this,u=this._skypeCore;if(!e||!t||this.getParticipantVideo(this,e,s))return;this.setupVideoContainer(t);var a=n.createVideoComponent(this._managerComponentId,t.id),f=function(t){o.onResolutionChanged&&o.onResolutionChanged(t,e,s)},l=function(t){u.setParticipantFrameSink(e,t,s,function(){u.showParticipantVideo(e,!0,s)})},c=function(){var e=s===i.CALLING.PLUGIN_MEDIA_TYPES.SCREEN_SHARING?r.PLUGIN_CONST.VIDEO_MODE.FIT:r.PLUGIN_CONST.VIDEO_MODE.CROP;a.setupVideo(e,l)};this._participantVideos[e][s]=a,a.onLoadComplete=c,a.onVideoResolutionChanged=f,a.load()},e.prototype.hideParticipant=function(e,t,n){var r=this.getParticipantVideo(this,e,t);r&&(n||(this._skypeCore.showParticipantVideo(e,!1,t),this._skypeCore.setParticipantFrameSink(e,0,t)),r.dispose(),delete this._participantVideos[e][t])},e.prototype.dispose=function(){var e=this,t=this._participantVideos;Object.keys(t).forEach(function(n){var r=t[n];Object.keys(r).forEach(function(t){e.hideParticipant(n,t)})}),Object.keys(this._localVideoMap).forEach(function(t){e.hideLocalPreview(t)})},e}();t.VideoManager=s,t.build=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/pluginLifecycleFacade",["require","exports","jcafe-property-model","swx-constants","../../../lib/modelHelpers/propertyModelHelper","./pluginCore","./videoManager","./pluginEventDispatcher","../../../lib/telemetry/pluginTelemetry","jskype-settings-instance","swx-browser-globals"],e)}(function(e,t){function y(){return T().get()}function b(){return s.isInstalled()?m?m:(m=x().then(C),m["catch"](k),m):i.createRejectedPromise(r.PLUGIN_CONST.PLUGIN_ERRORS.NOT_INSTALLED)}function w(){return T().getManager()}function E(){return T().isManagerLoaded()}function S(){return b().then(function(e){return e.skypeCore.getVersion()})}function x(){return new Promise(function(e,t){var n=l.getWindow().setTimeout(function(){t(r.PLUGIN_CONST.PLUGIN_ERRORS.INIT_TIMEOUT)},f.settings.plugin.pluginInitTimeout);return h.then(N).then(function(t){l.getWindow().clearTimeout(n),e(t)},t)})}function T(){return c||(c=s.build()),c}function N(){return T().get()}function C(e){return p=e.managerComponent,d=e.skypeCoreComponent,v=o.build(p.componentId,d),u.startListeningOnVideoManager(v),T().onCrash(k),{skypeCore:d,videoManager:v}}function k(e){e===r.PLUGIN_CONST.PLUGIN_ERRORS.INIT_TIMEOUT&&L(),u.onManagerComponentCrashed(e),t.dispose(!0)}function L(){g||(g=a.getLogger()),g.logPluginInitializationTimeout()}var n=e("jcafe-property-model"),r=e("swx-constants"),i=e("../../../lib/modelHelpers/propertyModelHelper"),s=e("./pluginCore"),o=e("./videoManager"),u=e("./pluginEventDispatcher"),a=e("../../../lib/telemetry/pluginTelemetry"),f=e("jskype-settings-instance"),l=e("swx-browser-globals"),c,h=i.createResolvedPromise(),p,d,v,m,g;t.initialize=y,t.createPlugin=b,t.createManager=w,t.isLoaded=E,t.getVersion=S,t.dispose=function(e){var t=n.task();return p=null,d=null,m=null,g=null,h=t.promise,v&&(v.dispose(),v=null),T().dispose(e).then(t.resolve.bind(t))["catch"](t.resolve.bind(t)),t.promise}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/electron/electronSupportDetector",["require","exports","../../../../lib/services/electron","../../../../lib/telemetry/logging/callingLogTracer","swx-enums"],e)}(function(e,t){function u(){try{return n.getSkypeModule(),!0}catch(e){return s.warn(e),!1}}function a(){return new o}var n=e("../../../../lib/services/electron"),r=e("../../../../lib/telemetry/logging/callingLogTracer"),i=e("swx-enums"),s=r.get(),o=function(){function e(){}return e.prototype.getCallingSupport=function(){return u()?Promise.resolve({isSupported:!0,reason:""}):Promise.resolve({isSupported:!1,reason:i.callingNotSupportedReasons.PluginBlocked})},e}();t.ElectronSupportDetector=o,t.build=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/pluginSupportDetector",["require","exports","jcafe-property-model","swx-browser-detect","./pluginLifecycleFacade","../../../lib/services/plugin/electron/electronSupportDetector","swx-enums","./pluginDetect"],e)}(function(e,t){function f(){return r["default"].getBrowserInfo().isElectron}function l(){return f()?s.build():new a}var n=e("jcafe-property-model"),r=e("swx-browser-detect"),i=e("./pluginLifecycleFacade"),s=e("../../../lib/services/plugin/electron/electronSupportDetector"),o=e("swx-enums"),u=e("./pluginDetect"),a=function(){function e(){var e=this;this.getCallingSupportTask=null,this.getCallingSupport=function(t){if(!e.getCallingSupportTask||e.getCallingSupportTask.promise.state()==="resolved")e.getCallingSupportTask=n.task(),e.checkForPluginInstall(t);return e.getCallingSupportTask.promise}}return e.prototype.checkForPluginInstall=function(e){var t=r["default"].getBrowserInfo(),n=u.isPluginInstalled();n?e&&t.isBrowserDefaultToBlockPlugin?this.loadPlugin():this.getCallingSupportTask.resolve({isSupported:!0,reason:""}):this.getCallingSupportTask.resolve({isSupported:!1,reason:o.callingNotSupportedReasons.PluginNotInstalled})},e.prototype.loadPlugin=function(){var e=this;i.createManager().then(function(){e.getCallingSupportTask.resolve({isSupported:!0,reason:""})})["catch"](function(){e.getCallingSupportTask.resolve({isSupported:!1,reason:o.callingNotSupportedReasons.PluginBlocked})})},e}();t.PluginSupportDetector=a,t.build=l}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/pluginless/pluginlessSupportDetector",["require","exports","jcafe-property-model"],e)}(function(e,t){function i(){return new r}var n=e("jcafe-property-model"),r=function(){function e(){var e=this;this.getCallingSupportTask=null,this.getCallingSupport=function(t){if(!e.getCallingSupportTask||e.getCallingSupportTask.promise.state()==="resolved")e.getCallingSupportTask=n.task(),e.getCallingSupportTask.resolve({isSupported:!0,reason:""});return e.getCallingSupportTask.promise}}return e}();t.PluginlessSupportDetector=r,t.build=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-extension-api/lib/SkypeExtensionAPI",["require","exports","global-portable"],e)}(function(e,t){function o(){return Math.random().toString(16).slice(2)}function u(){return o()+"@"+Date.now()}function a(){function e(e){return e in this._listeners||(this._listeners[e]=[]),this._listeners[e]}this._listeners={},this.add=function(t,n){var r=e.call(this,t),i=r.indexOf(n);i===-1&&r.push(n)},this.remove=function(t,n){var r=e.call(this,t),i=r.indexOf(n);i!==-1&&r.splice(i,1)},this.dispatchEvent=function(t){var n=e.call(this,t.type).slice();for(var r=0;r<n.length;r++)n[r].call(this,t);return!t.defaultPrevented},this.invokeHandlerWithMessage=function(t){var n=e.call(this,t.cookie).slice();if(n.length>0){for(var r=0;r<n.length;r++)n[r].call(this,t);return}n=e.call(this,t.name).slice();if(n.length>0){for(var r=0;r<n.length;r++)n[r].call(this,t.data);return}}}function l(e,t){return new Promise(function(r,s){function l(e){clearTimeout(a),f.remove(o,l),"error"in e?s(e.error):r(e.data)}function c(){f.remove(o,l),s(new Error("Chrome Extension reply timeout: ("+i+" ms passed)"))}var o=u(),a=null;a=setTimeout(c,i),f.add(o,l),t.cookie=o,e.postMessage({origin:n,message:t},"*")})}function c(e){this.nmHost=e,this.postMessage=function(e){return this.nmHost.postMessage({method:"messageToWindow",args:{message:e}})},this.addMessageHandler=function(e){this.nmHost.addMessageHandler("messageFromWindow",function(t){e(t.message)})}}function h(e,t){this.id=e,this.extension=t,this.hostWindow=null,this.postMessage=function(e){return this.extension.postMessage({name:"MessageToNativeMessagingHost",nmHostID:this.id,content:e})},this.invokeMethod=function(e,t){return t||(t={}),this.postMessage({method:e,args:t})},this.getVersion=function(){return this.invokeMethod("getVersion").then(function(e){return e.message.result})},this.openWindow=function(e){var t=this;return new Promise(function(n,r){t.invokeMethod("openWindow",e).then(function(){t.hostWindow=new c(t),n(t.hostWindow)})["catch"](r)})},this.addMessageHandler=function(e,t){this.extension.addMessageHandler("NMHostMessage",function(n){var r=n.message;r.event==e&&t(r.args)})},this.onDisconnected=function(e){var t=this;this.extension.addMessageHandler("NMHostConnectionChange",function(n){if(n.nmHostID!=t.id)return;if(n.isConnected)return;e(n.reason)})};var n=this;this.onDisconnected(function(e){n.hostWindow!=null&&(n.hostWindow.nmHost=null,n.hostWindow=null),n.extension!=null&&(n.extension.nmHost=null)}),this.disconnect=function(){return this.extension.postMessage({name:"DisconnectNativeMessagingHost",nmHostId:this.id})}}function p(e,t){this.id=e,this.version=t,this.nmHost=null,this.postMessage=function(e){return l(window,e)},this.addMessageHandler=function(e,t){f.add(e,t)},this.removeMessageHandler=function(e,t){f.remove(e,t)},this.onDisconnected=function(e){var t=this;this.addMessageHandler("ExtensionConnectionChange",function(n){if(n.extensionID!=t.id)return;if(n.isConnected)return;e()})};var n=this;this.onDisconnected(function(){n.nmHost!=null&&(n.nmHost.extension=null,n.nmHost=null),s=null}),this.connectNMHost=function(e){var t=this;return new Promise(function(n,r){t.postMessage({name:"ConnectNativeMessagingHost",nmHostId:e}).then(function(r){t.nmHost=new h(e,t),n(t.nmHost)})["catch"](r)})}}function d(e){this.nmHost=e,this.postMessage=function(e){return this.nmHost.extension.postMessage({method:"messageToWindow",args:e})},this.addMessageHandler=function(e){this.nmHost.extension.addMessageHandler("messageFromWindow",function(t){e(t.message)})}}function v(e,t){this.id=e,this.extension=t,this.hostWindow=null,this.invokeMethod=function(e,t){return t||(t={}),this.extension.invokeMethod(e,t)},this.getVersion=function(){return this.invokeMethod("getVersion")},this.openWindow=function(e){var t=this;return new Promise(function(n,r){t.invokeMethod("openWindow",e).then(function(){t.hostWindow=new d(t),n(t.hostWindow)})["catch"](r)})},this.addMessageHandler=function(e,t){f.add(e,t)},this.onDisconnected=function(e){},this.disconnect=function(){this.extension.port.Disconnect()}}function m(e,t,n){this.version=t,this.id=e,this.nmHost=null,this.port=n;var r=this;this.invokeMethod=function(e,t){return new Promise(function(n,s){function c(e){var t=e.data;t.cookie==a&&(clearTimeout(l),f.remove(o,c),"error"in t?s(t.error):n(t.result))}function h(){f.remove(o,c),s(new Error("EdgeActiveX reply timeout: ("+i+" ms passed)"))}var o="MessageReceived",a=u(),l=null;l=setTimeout(h,i),f.add(o,c);var p={cookie:a,method:e,args:t};r.port.PostMessage(p)})},this.postMessage=function(e){var t=e.name;if(t==undefined||t==null)t=e.method;return this.invokeMethod(t,{message:e.args})},this.addMessageHandler=function(e,t){f.add(e,t)},this.removeMessageHandler=function(e,t){f.remove(e,t)},this.onDisconnected=function(e){f.add("NMHostConnectionChange",e)},this.connectNMHost=function(e){var t=this;return new Promise(function(n,r){t.port.Connect(),t.nmHost=new v(e,t),n(t.nmHost)})},this.onPluginMessage=function(e){f.dispatchEvent({type:"MessageReceived",data:e});if(!e||!e.event)return;e.args&&e.args.message?f.dispatchEvent({type:e.event,message:e.args.message,data:e.args.message}):f.dispatchEvent({type:e.event})},this.onPluginDisconnected=function(){var e={type:"NMHostConnectionChange",data:{isConnected:!1}};f.dispatchEvent(e)}}var n="XwaWebSite",r="XwaContentScript",i=3e3,s=null,f=new a;typeof window!="undefined"&&window.addEventListener&&window.addEventListener("message",function(e){var t=window.location.protocol+"//"+window.location.host;if(e.origin!=t)return;var n=e.data;if(!n||n.origin!=r)return;f.invokeHandlerWithMessage(n.message)});var g={connect:function(e,t){return t!=undefined&&t!=null?new Promise(function(n,r){var i=document.createElement("object");i.setAttribute("type",e),i.setAttribute("class","pluginNoSize");var s=t;s.appendChild(i);var o=i.GetVersion(),u=new m(e,o,i);i.OnMessage=u.onPluginMessage,i.OnDisconnected=u.onPluginDisconnected,n(u)}):new Promise(function(t,n){l(window,{name:"ExtensionConnect",extensionId:e}).then(function(){return l(window,{name:"ExtensionVersion"})}).then(function(n){var r=new p(e,n);t(r)})["catch"](n)})},sharedExtension:function(e,t){var n=this;return new Promise(function(r,i){if(s!=null){r(s);return}n.connect(e,t).then(function(e){s=e,r(s)})["catch"](i)})},sharedNMHost:function(e,t,n){var r=this;return new Promise(function(i,o){if(s!=null&&s.nmHost!=null){i(s.nmHost);return}r.sharedExtension(e,n).then(function(e){return e.connectNMHost(t)}).then(i,o)})},sharedNMHostWindow:function(e,t,n,r){var i=this;return new Promise(function(o,u){if(s!=null&&s.nmHost!=null&&s.nmHost.hostWindow!=null){o(s.nmHost.hostWindow);return}i.sharedNMHost(e,t,r).then(function(e){return e.openWindow(n)}).then(o,u)})},cleanupCallbacks:function(){f._listeners={}}};t.SkypeExtension=g;var y=e("global-portable");y["default"].SkypeExtension=g}),define("swx-extension-api",["swx-extension-api/lib/SkypeExtensionAPI"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/outOfBrowser/extension",["require","exports","jskype-settings-instance","../../../lib/telemetry/logging/callingLogTracer","swx-constants","swx-browser-detect","swx-browser-globals","swx-extension-api"],e)}(function(e,t){function l(e){return new f(e)}var n=e("jskype-settings-instance"),r=e("../../../lib/telemetry/logging/callingLogTracer"),i=e("swx-constants"),s=e("swx-browser-detect"),o=e("swx-browser-globals"),u=e("swx-extension-api"),a=r.get();t.extensionConstants={SHELL_APP_SIZE_FACTOR:1.6,SHELL_APP_MIN_DIMENSIONS:{WIDTH:345,HEIGHT:460},ERRORS:{MISSING_EXTENSION:"MISSING_EXTENSION",MISSING_PLUGIN:"MISSING_PLUGIN"},CONNECTION_CHANGE_EVENT:"NMHostConnectionChange"};var f=function(){function e(e){var n=this;this.openShellApp=function(e){return n.openShellAppPromise||(n.openShellAppPromise=new Promise(function(e,t){n.openShellAppPromiseResolve=e,n.openShellAppPromiseReject=t}),n.loadSkypeExtension()),n.onDisconnectedCallback=e,n.openShellAppPromise},this.getAppHost=function(){return n.loadAppHostPromise||(n.loadAppHostPromise=new Promise(function(e,t){n.loadAppHostPromiseResolve=e,n.loadAppHostPromiseReject=t}),n.loadAppHost()),n.loadAppHostPromise},this.postMessage=function(e){return n.openShellAppPromise.then(function(){return a.log("Extension::postMessage",e),n.shellAppWindow.postMessage(e)})},this.addMessageHandler=function(e){a.log("Extension::addMessageHandler"),n.shellAppHost.addMessageHandler("messageFromWindow",e)},this.addEventHandler=function(e,t){n.shellAppHost.addMessageHandler(e,t)},this.disconnect=function(){return n.shellAppHost&&n.shellAppHost.disconnect(),Promise.resolve()},this.dispose=function(){a.log("Extension::dispose"),n.loadAppHostPromise=null,n.loadAppHostPromiseReject=null,n.loadAppHostPromiseResolve=null,n.openShellAppPromise=null,n.openShellAppPromiseReject=null,n.openShellAppPromiseResolve=null,n.extensionInstance&&n.extensionInstance.removeMessageHandler(t.extensionConstants.CONNECTION_CHANGE_EVENT,n.onDisconnectedCallback)},this.shellAppUrl=e}return e.prototype.checkExtensionAvailability=function(){return this.getExtensionConnection().then(function(){return!0},function(){return!1})},e.prototype.loadSkypeExtension=function(){a.log("Extension - loading shell app"),u.SkypeExtension&&u.SkypeExtension.sharedExtension?this.getAppHost().then(this.openShellAppWindow.bind(this)).then(this.onShellAppWindowOpened.bind(this))["catch"](this.onShellAppInitError.bind(this)):this.onShellAppInitError("SkypeExtension is not available")},e.prototype.getExtensionId=function(){var e=o.getDocument().querySelector(i.OUT_OF_BROWSER.shellAppMetaSelector);return e?e.getAttribute("id"):n.settings.shellApp.chromeExtensionId},e.prototype.getExtensionConnection=function(){return s["default"].getBrowserInfo().browserName===s["default"].BROWSERS.CHROME?u.SkypeExtension.sharedExtension(this.getExtensionId()):u.SkypeExtension.sharedExtension(i.OUT_OF_BROWSER.SHELL_APP_MIME_TYPE,o.getDocument().body)},e.prototype.loadAppHost=function(){this.getExtensionConnection().then(this.openShellAppHost.bind(this)).then(this.onAppHostInitCompleted.bind(this))["catch"](this.onAppHostInitFailed.bind(this))},e.prototype.openShellAppHost=function(e){var t=this;this.extensionInstance=e;var r=function(e){return a.log("Extension - Connect app host, max retries:",e),t.extensionInstance.connectNMHost(i.OUT_OF_BROWSER.SHELL_APP_ID)["catch"](function(t){return t&&t.message&&/reply timeout/.test(t.message)&&e>0?r(e-1):Promise.reject(t)})};return r(n.settings.shellApp.connectShellAppHostRetries)},e.prototype.openShellAppWindow=function(e){return e.openWindow({url:this.shellAppUrl,minWidth:345,minHeight:460,disableHotKeys:!0,hidden:!0})},e.prototype.onShellAppWindowOpened=function(e){this.shellAppWindow=e,this.onDisconnectedCallback&&this.extensionInstance.addMessageHandler(t.extensionConstants.CONNECTION_CHANGE_EVENT,this.onDisconnectedCallback),this.openShellAppPromiseResolve()},e.prototype.onShellAppInitError=function(e){a.warn("Extension - Error loading shell app: ",e),this.openShellAppPromiseReject(e)},e.prototype.onAppHostInitFailed=function(e){var n=Boolean(this.extensionInstance);a.log("Extension - App host init failed, error:",e&&e.message?e.message:e),n?this.loadAppHostPromiseReject(t.extensionConstants.ERRORS.MISSING_PLUGIN):this.loadAppHostPromiseReject(t.extensionConstants.ERRORS.MISSING_EXTENSION)},e.prototype.onAppHostInitCompleted=function(e){this.shellAppHost=e,this.loadAppHostPromiseResolve(e)},e}();t.Extension=f,t.build=l}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/outOfBrowser/outOfBrowserSupportDetector",["require","exports","jcafe-property-model","./extension","swx-enums"],e)}(function(e,t){function o(){return new s}var n=e("jcafe-property-model"),r=e("./extension"),i=e("swx-enums"),s=function(){function e(){var e=this;this.getCallingSupportTask=null,this.getCallingSupport=function(t){if(!e.getCallingSupportTask||e.getCallingSupportTask.promise.state()==="resolved")e.getCallingSupportTask=n.task(),r.build().getAppHost().then(e.onGetAppHostCompleted.bind(e))["catch"](e.onGetAppHostFailed.bind(e));return e.getCallingSupportTask.promise}}return e.prototype.onGetAppHostCompleted=function(e){this.getCallingSupportTask.resolve({isSupported:!0,reason:""})},e.prototype.onGetAppHostFailed=function(){this.getCallingSupportTask.resolve({isSupported:!1,reason:i.callingNotSupportedReasons.PluginNotInstalled})},e}();t.OutOfBrowserSupportDetector=s,t.build=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/calling/supportDetectorFactory",["require","exports","swx-util-calling-stack","../../../lib/services/plugin/pluginSupportDetector","../../../lib/services/pluginless/pluginlessSupportDetector","../../../lib/services/outOfBrowser/outOfBrowserSupportDetector"],e)}(function(e,t){function o(){return n.get().isPluginlessCallingSupported()?i.build():n.get().isInBrowserPluginSupported()?r.build():s.build()}var n=e("swx-util-calling-stack"),r=e("../../../lib/services/plugin/pluginSupportDetector"),i=e("../../../lib/services/pluginless/pluginlessSupportDetector"),s=e("../../../lib/services/outOfBrowser/outOfBrowserSupportDetector");t.buildSupportDetector=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/calling/environmentInspector",["require","exports","../../../lib/telemetry/logging/callingLogTracer","../../../lib/services/calling/platformValidator","../../../lib/services/calling/supportDetectorFactory","jskype-settings-instance","jcafe-property-model"],e)}(function(e,t){function c(e){f=!0,l=e,t.isCallingSupported(!1,e)}function h(e){if(!a||a.promise.state()==="resolved")a=o.task(),p(e);return a.promise}function p(e){var t=r.getPlatformSupport();t.isSupported?v(e).then(function(e){d(e.isSupported,e.reason)}):d(!1,t.reason)}function d(e,n){u.log("[EnvInspector] check for calling support",e,n),t.isCallingSupported.set(e,n),a.resolve(e)}function v(e){var t=i.buildSupportDetector();return t.getCallingSupport(e)}var n=e("../../../lib/telemetry/logging/callingLogTracer"),r=e("../../../lib/services/calling/platformValidator"),i=e("../../../lib/services/calling/supportDetectorFactory"),s=e("jskype-settings-instance"),o=e("jcafe-property-model"),u=n.get(),a=null,f=!1,l="";t.disableCalling=c,t.isCallingSupported=o.property({get:function(){return f?(t.isCallingSupported.reason=l,!1):h(s.settings.plugin.loadDuringDetection)}}),t.checkForCallingSupport=h}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/devicesManager",["require","exports","jcafe-property-model","../../lib/telemetry/logging/callingLogTracer","../../lib/modelHelpers/propertyModelHelper","../../lib/services/calling/environmentInspector","../../lib/services/calling/callingFacade"],e)}(function(e,t){function f(){return new a}var n=e("jcafe-property-model"),r=e("../../lib/telemetry/logging/callingLogTracer"),i=e("../../lib/modelHelpers/propertyModelHelper"),s=e("../../lib/services/calling/environmentInspector"),o=e("../../lib/services/calling/callingFacade"),u=r.get(),a=function(){function e(){var e=this;this.camerasInternal=n.collection(),this.microphonesInternal=n.collection(),this.speakersInternal=n.collection(),this.selectedCameraSetterEnabled=n.property({value:!0,readOnly:!0}),this.selectedMicrophoneSetterEnabled=n.property({value:!0,readOnly:!0}),this.selectedSpeakerSetterEnabled=n.property({value:!0,readOnly:!0}),this.selectedCamera=n.property({set:n.command(function(t){return e.selectedCameraSetterEnabled._set(!1),o.selectCameraDevice(t.id()).then(function(){return e.selectedCameraSetterEnabled._set(!0),t},function(t){e.selectedCameraSetterEnabled._set(!0),u.log("Failed to set camera",t)})},this.selectedCameraSetterEnabled)}),this.selectedMicrophone=n.property({set:n.command(function(t){return e.selectedMicrophoneSetterEnabled._set(!1),o.selectMicrophoneDevice(t.id()).then(function(){return e.selectedMicrophoneSetterEnabled._set(!0),t},function(t){e.selectedMicrophoneSetterEnabled._set(!0),u.log("Failed to set microphone",t)})},this.selectedMicrophoneSetterEnabled)}),this.selectedSpeaker=n.property({set:n.command(function(t){return e.selectedSpeakerSetterEnabled._set(!1),o.selectSpeakerDevice(t.id()).then(function(){return e.selectedSpeakerSetterEnabled._set(!0),t},function(t){e.selectedSpeakerSetterEnabled._set(!0),u.log("Failed to set speaker",t)})},this.selectedSpeakerSetterEnabled)}),this.cameras=i.exposeReadOnlyCollection(this.camerasInternal),this.microphones=i.exposeReadOnlyCollection(this.microphonesInternal),this.speakers=i.exposeReadOnlyCollection(this.speakersInternal),this.checkMediaCapabilities=n.enabledCommand(function(){return s.checkForCallingSupport(!0)}),this.mediaCapabilities={installedVersion:n.property({get:o.getPluginVersion}),isMicrophoneEnabled:n.property({value:!0,readOnly:!0}),isCameraEnabled:n.property({value:!0,readOnly:!0})},this._reset=function(){e.selectedCamera._set(null),e.selectedMicrophone._set(null),e.selectedSpeaker._set(null),e.camerasInternal.empty(),e.microphonesInternal.empty(),e.speakersInternal.empty()}}return e}();t.DevicesManager=a,t.build=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/group",["require","exports","jcafe-property-model","swx-enums"],e)}(function(e,t){function s(e,t){var n,i=Boolean(r.groupType[e]);if(!e||i)n=t;else{if(!!i||!o(t))throw new Error("Invalid type/name combination");n=e}return n}function o(e){return e===r.groupType.Custom}var n=e("jcafe-property-model"),r=e("swx-enums"),i=function(){function e(e,t){this.uri=n.property({readOnly:!0}),this.avatarUrl=n.property(),this.relationshipLevel=n.property({readOnly:!0,value:r.groupPrivacyRelationshipLevel.None}),this.persons=n.collection(),this.groups=n.collection(),e=e||r.groupType.Root,this.type=n.property({readOnly:!0,value:e}),this.name=n.property({value:s(t,e)})}return e}();t.__esModule=!0,t["default"]=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataHandlers/meProfile",["require","exports","swx-jskype-internal-application-instance","../../../modelHelpers/propertyModelHelper","../../../modelHelpers/contacts/dataMappers/profileToPerson","jskype-settings-instance","swx-constants"],e)}(function(e,t){function a(e){var t=n.get()._telemetryManager,r={name:o.COMMON.telemetry.contacts.name.GET_PROFILES,batchCount:1,source:e};t.sendEvent(s.settings.telemetry.jSkypeTenantToken,o.COMMON.telemetry.contacts.type.CONTACTS,r)}function f(){return new u(i)}var n=e("swx-jskype-internal-application-instance"),r=e("../../../modelHelpers/propertyModelHelper"),i=e("../../../modelHelpers/contacts/dataMappers/profileToPerson"),s=e("jskype-settings-instance"),o=e("swx-constants"),u=function(){function e(e){var t=this;this.onSuccess=function(e){return t.mapProfile(e,o.COMMON.telemetry.contacts.source.INITIALIZED,!1)},this.onUpdate=function(e){return t.mapProfile(e,o.COMMON.telemetry.contacts.source.UPDATED,!0)},this.dataMapper=e}return e.prototype.onError=function(e){return r.createRejectedPromise(e)},e.prototype.mapProfile=function(e,t,i){return this.dataMapper.map(e.response,n.get().personsAndGroupsManager.mePerson,i),a(t),r.createResolvedPromise()},e}();t.build=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataMappers/userInfo",["require","exports","../../../modelHelpers/contacts/dataMappers/mappers"],e)}(function(e,t){function r(e,t){n.mapRegistrationDate(e.registrationDate,t)}var n=e("../../../modelHelpers/contacts/dataMappers/mappers");t.map=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataHandlers/userInfo",["require","exports","swx-jskype-internal-application-instance","../../../../lib/modelHelpers/propertyModelHelper","../../../../lib/modelHelpers/contacts/dataMappers/userInfo"],e)}(function(e,t){function o(){return new s}var n=e("swx-jskype-internal-application-instance"),r=e("../../../../lib/modelHelpers/propertyModelHelper"),i=e("../../../../lib/modelHelpers/contacts/dataMappers/userInfo"),s=function(){function e(){}return e.prototype.onSuccess=function(e){return i.map(e.response,n.get().personsAndGroupsManager.mePerson),r.createResolvedPromise()},e.prototype.onError=function(e){return r.createRejectedPromise(e)},e}();t.UserInfoHandlers=s,t.build=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataHandlers/peopleSettings",["require","exports"],e)}(function(e,t){function i(){return new r}var n="skype.autobuddy",r=function(){function e(){var e=this;this.onSuccess=function(t){return new Promise(function(n){n(e.getSettingValue(t))})},this.onError=function(e){return new Promise(function(t,n){n(e)})}}return e.prototype.hasData=function(e){return e.response&&e.response.Settings&&e.response.Settings.length>0},e.prototype.getSettingValue=function(e){var t=this,r=!1;return this.hasData(e)?(e.response.Settings.some(function(e){if(e.Name.toLowerCase()===n){r=t.extractValue(e);return}}),r):r},e.prototype.extractValue=function(e){var t;try{t=JSON.parse(e.Value.toLowerCase())}catch(n){t=!1}return t},e}();t.build=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataHandlers/ABCHProfileService",["require","exports","lodash-compat","swx-constants"],e)}(function(e,t){function f(){return new a}var n=e("lodash-compat"),r=e("swx-constants"),i={EMAIL:"PersonalContactProfile.Emails",PHONES:"PersonalContactProfile.Phones"},s={VERIFIED:"Verified"},o={SKYPE:"Skype",MSA:"Msa"},u={Name:"Skype"},a=function(){function e(){var e=this;this.onSuccess=function(t){return e.hasErrors(t)?Promise.reject(e.getErrorMessage(t)):Promise.resolve(e.getValues(t))},this.onError=function(e){return Promise.reject(e)}}return e.prototype.getValues=function(e){var t,r=[];if(!e.response||!e.response.Views)return r;var i=n.bind(this.extractProofs,this);return t=n.map(e.response.Views,"Attributes")[0],t.filter(this.filterByEmailPhone).reduce(i,r),n.sortBy(r,this.sortEmailFirst)},e.prototype.hasErrors=function(e){return!!(e.response&&e.response.Errors&&e.response.Errors.length>0)},e.prototype.getErrorMessage=function(e){return e.response.Errors[0].Message},e.prototype.filterByEmailPhone=function(e){return e.Name===i.EMAIL||e.Name===i.PHONES},e.prototype.sortEmailFirst=function(e){return e.type},e.prototype.isSkypeSearchable=function(e){switch(e.Source){case o.SKYPE:return!0;case o.MSA:return!!e.HasSearchableApplications&&n.some(e.SearchableApplications,u);default:return!1}},e.prototype.extractProofs=function(e,t){var o=this;return t.Name===i.PHONES&&n.forEach(t.Value,function(t){if(t.State!==s.VERIFIED||!n.bind(o.isSkypeSearchable,o)(t))return;e.push({type:r.COMMON.proofTypes.PHONE,cc:t.Country,number:t.Name,value:t.Country.replace(/\w+-(\d+)/,"+$1")+t.Name,isSearchable:t.Searchable})}),t.Name===i.EMAIL&&n.forEach(t.Value,function(t){if(t.State!==s.VERIFIED||!n.bind(o.isSkypeSearchable,o)(t))return;e.push({type:r.COMMON.proofTypes.EMAIL,value:t.Name,isSearchable:t.Searchable})}),e},e}();t.build=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataHandlers/phoneUpdate",["require","exports"],e)}(function(e,t){function r(){return new n}var n=function(){function e(){var e=this;this.onSuccess=function(t){return e.hasErrors(t)?Promise.reject(e.getErrorMessage(t)):Promise.resolve()},this.onError=function(e){return Promise.reject(e)}}return e.prototype.hasErrors=function(e){return!!(e.response&&e.response.Errors&&e.response.Errors.length>0)},e.prototype.getErrorMessage=function(e){return e.response.Errors[0].Message},e}();t.build=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/presence/cache/local",["require","exports","lodash-compat","../../../services/cache/instance","../../../modelHelpers/contacts/presenceHelper","../../personsAndGroupsHelper","swx-mri","jskype-constants/lib/data"],e)}(function(e,t){function l(e,t){var i=d(e),s=r.get();return s.getItem(i).then(function(e){var r=n.merge(e||{},t);return s.setItem(i,r)})}function c(e){return r.get().removeItem(d(e))}function h(){return v().then(function(e){var t=e.reduce(function(e,t){var n=t.split("|")[1];return e.concat(Promise.all([n,r.get().getItem(t)]))},[]);return Promise.all(t).then(m)})}function p(){return v().then(function(e){var t=e.reduce(function(e,t){return e.concat(r.get().removeItem(t))},[]);return Promise.all(t)})}function d(e){return a.CONTACT_PRESENCE+"|"+e}function v(){return r.get().getAllKeys(f.CONTACT_PRESENCE)}function m(e){return e.forEach(function(e){var t=e[1],n=s.getPerson(o.getId(e[0]));if(t.status){var r=i.getDefaultPresence(n);n.status._set(r?r:t.status)}t.lastSeenAt&&n.lastSeenAt(t.lastSeenAt),t.endpointType&&n.endpointType._set(t.endpointType)}),e}var n=e("lodash-compat"),r=e("../../../services/cache/instance"),i=e("../../../modelHelpers/contacts/presenceHelper"),s=e("../../personsAndGroupsHelper"),o=e("swx-mri"),u=e("jskype-constants/lib/data"),a=u["default"].storageKeys,f=u["default"].storageKeyRegExp;t.set=l,t.remove=c,t.restore=h,t.destroy=p}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/presence/cache/session",["require","exports","lodash-compat","swx-jskype-internal-application-instance","swx-utils-common","../../personsAndGroupsHelper","../../../modelHelpers/contacts/presenceHelper","jcafe-property-model","swx-mri","jskype-constants/lib/data","jskype-constants/lib/people"],e)}(function(e,t){function p(){var e=r.get().personsAndGroupsManager.mePerson,t=w(),n=x(t);return E(n,e),S(n,e),t}function d(e){var t=w(),n=delete t[e];return i.sessionStorage.set(h,JSON.stringify(t)),n}function v(){i.sessionStorage.remove(h)}function m(){i.sessionStorage.set(h,"{}")}function g(e,t,n,r,i){e[t]={status:n,lastSeenAt:r,endpointType:i}}function y(e,t,n,r,i){e[t].endpointType=i||e[t].endpointType,e[t].lastSeenAt=r||e[t].lastSeenAt,e[t].status=n||e[t].status}function b(e){return function(t,n){var r=!!n&&!!(n.status||n.lastSeenAt||n.endpointType);r&&e.call(null,t,n)}}function w(){var e=i.sessionStorage.get(h);return e?JSON.parse(e):(m(),{})}function E(e,t){var n=e[t.id()];n&&n.status&&t.status(n.status,u.property.sUpdated)}function S(e,t){n.forIn(n.omit(e,[t.id(),c]),function(e,t){var n=s.getPerson(a.getId(t));if(e.status){var r=o.getDefaultPresence(n);n.status._set(r?r:e.status)}e.lastSeenAt&&n.lastSeenAt(e.lastSeenAt),e.endpointType&&n.endpointType._set(e.endpointType)})}function x(e){function r(t,n){return t[n]={status:e[n]},t}if(!n.isEmpty(e)&&T(e)){var t=Object.keys(e).reduce(r,{});i.sessionStorage.set(h,JSON.stringify(t)),e=t}return e}function T(e){return Object.keys(e).every(function(t){return n.isString(e[t])})}var n=e("lodash-compat"),r=e("swx-jskype-internal-application-instance"),i=e("swx-utils-common"),s=e("../../personsAndGroupsHelper"),o=e("../../../modelHelpers/contacts/presenceHelper"),u=e("jcafe-property-model"),a=e("swx-mri"),f=e("jskype-constants/lib/data"),l=e("jskype-constants/lib/people"),c=l["default"].SELF,h=f["default"].storageKeys.PRESENCE_DATA;t.restore=p,t.set=b(function(e,t){var n=w(),r=t.status,s=t.lastSeenAt,o=t.endpointType;n[e]?y(n,e,r,s,o):g(n,e,r,s,o),i.sessionStorage.set(h,JSON.stringify(n))}),t.remove=d,t.destroy=v}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/presence/presenceDataStorage",["require","exports","lodash-compat","./cache/local","./cache/session"],e)}(function(e,t){function s(){return r}function o(){var e=i.restore();if(!n.isEmpty(e)){var t=Object.keys(e).map(function(t){return r.set(t,e[t])});return Promise.all(t).then(function(){return u()})}return u()}function u(){return i.destroy(),r.restore()}var n=e("lodash-compat"),r=e("./cache/local"),i=e("./cache/session");t.getCache=s,t.restoreData=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataHandlers/contactDeleted",["require","exports","../../../../lib/modelHelpers/contacts/authorizationChange","../../../../lib/modelHelpers/presence/presenceDataStorage","jskype-constants"],e)}(function(e,t){function u(){return new o}var n=e("../../../../lib/modelHelpers/contacts/authorizationChange"),r=e("../../../../lib/modelHelpers/presence/presenceDataStorage"),i=e("jskype-constants"),s=i.PEOPLE.authorizationStates,o=function(){function e(){}return e.prototype.onSuccess=function(e){r.getCache().remove(e.id()),n.setAuthorization(e,s.UNAUTHORIZED)},e.prototype.onError=function(e){},e}();t.ContactDeletedHandlers=o,t.build=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataHandlers/contactRequestAccepted",["require","exports","../../../modelHelpers/contacts/authorizationChange","jskype-constants"],e)}(function(e,t){function o(){return new s}var n=e("../../../modelHelpers/contacts/authorizationChange"),r=e("jskype-constants"),i=r.PEOPLE.authorizationStates,s=function(){function e(){}return e.prototype.onSuccess=function(e){n.setAuthorization(e,i.AUTHORIZED)},e.prototype.onError=function(e){},e}();t.ContactRequestAcceptedHandlers=s,t.build=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataHandlers/contactRequestSent",["require","exports","swx-jskype-internal-application-instance","../../../modelHelpers/contacts/authorizationChange","../../../modelHelpers/contacts/contactMessageFactory","jskype-settings-instance","jskype-constants","swx-constants","swx-mri"],e)}(function(e,t){function c(){return new l}var n=e("swx-jskype-internal-application-instance"),r=e("../../../modelHelpers/contacts/authorizationChange"),i=e("../../../modelHelpers/contacts/contactMessageFactory"),s=e("jskype-settings-instance"),o=e("jskype-constants"),u=e("swx-constants"),a=e("swx-mri"),f=o.PEOPLE.authorizationStates,l=function(){function e(){}return e.prototype.onSuccess=function(e){var t=n.get().conversationsManager.getConversation(e);if(e.isAgent()||a.isPstnId(e.id()))r.setAuthorization(e,f.AUTHORIZED);else if(e._authorization()===f.PENDING_OUTGOING){var s=i.getOutgoingResend(e);t.historyService._processRawMessage(s)}else r.setAuthorization(e,f.PENDING_OUTGOING)},e.prototype.onError=function(e,t){t&&t.isAgent()&&n.get()._telemetryManager.sendEvent(s.settings.telemetry.jSkypeTenantToken,"ServiceFault",{serviceName:"agents-addToContacts",faultCode:e.status,faultContext:u.COMMON.telemetry.NOT_AVAILABLE,errorCode:e.status||u.COMMON.telemetry.NOT_AVAILABLE,errorMessage:e.responseText||u.COMMON.telemetry.NOT_AVAILABLE,verb:"PUT",host:s.settings.agentProvisioningService.host,contextId:u.COMMON.telemetry.NOT_AVAILABLE})},e}();t.ContactRequestSentHandlers=l,t.build=c}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataHandlers/contactAutoBuddy",["require","exports","../../../modelHelpers/contacts/authorizationChange","../../../modelHelpers/personsAndGroupsHelper","jskype-constants"],e)}(function(e,t){function u(){return new o}var n=e("../../../modelHelpers/contacts/authorizationChange"),r=e("../../../modelHelpers/personsAndGroupsHelper"),i=e("jskype-constants"),s=i.PEOPLE.authorizationStates,o=function(){function e(){}return e.prototype.onSuccess=function(e){var t=r.getPersonByConversationId(e);n.setAuthorization(t,s.AUTHORIZED)},e}();t.ContactAutoBuddyHandlers=o,t.build=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataHandlers/factory",["require","exports","../../../../lib/modelHelpers/contacts/dataHandlers/meProfile","../../../../lib/modelHelpers/contacts/dataHandlers/userInfo","../../../../lib/modelHelpers/contacts/dataHandlers/peopleSettings","../../../../lib/modelHelpers/contacts/dataHandlers/ABCHProfileService","../../../../lib/modelHelpers/contacts/dataHandlers/phoneUpdate","../../../../lib/modelHelpers/contacts/dataHandlers/contactDeleted","../../../../lib/modelHelpers/contacts/dataHandlers/contactRequestAccepted","../../../../lib/modelHelpers/contacts/dataHandlers/contactRequestSent","../../../../lib/modelHelpers/contacts/dataHandlers/contactAutoBuddy"],e)}(function(e,t){function c(){return n.build()}function h(){return r.build()}function p(){return i.build()}function d(){return s.build()}function v(){return o.build()}function m(){return u.build()}function g(){return a.build()}function y(){return f.build()}function b(){return l.build()}var n=e("../../../../lib/modelHelpers/contacts/dataHandlers/meProfile"),r=e("../../../../lib/modelHelpers/contacts/dataHandlers/userInfo"),i=e("../../../../lib/modelHelpers/contacts/dataHandlers/peopleSettings"),s=e("../../../../lib/modelHelpers/contacts/dataHandlers/ABCHProfileService"),o=e("../../../../lib/modelHelpers/contacts/dataHandlers/phoneUpdate"),u=e("../../../../lib/modelHelpers/contacts/dataHandlers/contactDeleted"),a=e("../../../../lib/modelHelpers/contacts/dataHandlers/contactRequestAccepted"),f=e("../../../../lib/modelHelpers/contacts/dataHandlers/contactRequestSent"),l=e("../../../../lib/modelHelpers/contacts/dataHandlers/contactAutoBuddy");t.getMeProfileHandlers=c,t.getUserInfoHandlers=h,t.getPeopleSettingsHandlers=p,t.getABCHProfileServiceHandlers=d,t.getProfilePhoneNumberUpdateHandlers=v,t.getContactDeletedHandlers=m,t.getContactRequestAcceptedHandlers=g,t.getContactRequestSentHandlers=y,t.getContactAutoBuddyHandlers=b}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/telemetry/people/contactTelemetryHelper",["require","exports","lodash-compat","swx-jskype-internal-application-instance","jskype-settings-instance","jskype-constants","../../modelHelpers/contacts/groupHelper","swx-enums"],e)}(function(e,t){function f(e){r.get()._telemetryManager.traceStart(e)}function l(e){return r.get()._telemetryManager.traceDump(e)||{}}function c(e,t,r){if(n.isNumber(r)||n.isString(r)||n.isBoolean(r))e[t]=r}function h(e,t){if(n.isEmpty(e))return;r.get()._telemetryManager.sendEvent(i.settings.telemetry.jSkypeTenantToken,t,e)}function p(){var e=r.get().personsAndGroupsManager.all.persons(),t={total:0,agents:0,suggested:0,pending:0,blocked:0,favorites:0};return n.isArray(e)&&(t.total=e.length,e.forEach(function(e){var n=e._authorization();if(n===a.PENDING_OUTGOING||n===a.PENDING_INCOMING)t.pending+=1;n===a.SUGGESTED&&(t.suggested+=1),e.isBlocked()&&(t.blocked+=1),e.isAgent()&&(t.agents+=1)}),t.favorites=o.getPersonsFromGroup(u.groupType.Favorites).length),t}var n=e("lodash-compat"),r=e("swx-jskype-internal-application-instance"),i=e("jskype-settings-instance"),s=e("jskype-constants"),o=e("../../modelHelpers/contacts/groupHelper"),u=e("swx-enums"),a=s.PEOPLE.authorizationStates;t.setStart=f,t.getTrace=l,t.addIfDefined=c,t.send=h,t.getAllContactTypes=p}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/telemetry/people/contactList",["require","exports","./contactTelemetryHelper","swx-constants"],e)}(function(e,t){function o(){n.setStart(i.LIST_LOAD)}function u(e){var t=a(i.LIST_LOAD,s.names.QUERY_CONTACT_LIST,e);n.send(t,s.TYPE)}function a(e,t,r){var i=n.getTrace(e),r=r||{},o={};o[s.fields.NAME]=t,o[s.fields.SUCCESS]=r.success,o[s.fields.INITIAL_LOAD]=r.firstLoad,n.addIfDefined(o,s.fields.SERVICE_ELAPSED,r.serviceElapsed),n.addIfDefined(o,s.fields.BEGIN_TIMESTAMP,i.startTime),n.addIfDefined(o,s.fields.ELAPSED,i.duration);if(r.success){var u=n.getAllContactTypes();o[s.fields.FULL_FETCH]=r.isFullFetch,o[s.fields.NUM_CONTACTS]=u.total,o[s.fields.NUM_AGENTS]=u.agents,o[s.fields.NUM_SUGGESTED]=u.suggested,o[s.fields.NUM_PENDING]=u.pending,o[s.fields.NUM_BLOCKED]=u.blocked,o[s.fields.NUM_FAVOURITES]=u.favorites}return o}var n=e("./contactTelemetryHelper"),r=e("swx-constants"),i=r.COMMON.telemetry.performanceMarks.CONTACTS,s=r.COMMON.telemetry.contactsV2.contactList;t.onQueryContactListStart=o,t.onQueryContactListEnd=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/groupCleaner",["require","exports","swx-jskype-internal-application-instance","../../../lib/modelHelpers/personsAndGroupsHelper","../../../lib/modelHelpers/contacts/authorizationChange","../../../lib/modelHelpers/personsRegistry/instance","jskype-constants","swx-mri","lodash-compat"],e)}(function(e,t){function c(){return new l}var n=e("swx-jskype-internal-application-instance"),r=e("../../../lib/modelHelpers/personsAndGroupsHelper"),i=e("../../../lib/modelHelpers/contacts/authorizationChange"),s=e("../../../lib/modelHelpers/personsRegistry/instance"),o=e("jskype-constants"),u=e("swx-mri"),a=e("lodash-compat"),f=o.PEOPLE.authorizationStates,l=function(){function e(){var e=this;this.registry=s.build(),this.filter=function(t){var n=e.getContactsToRemove(e.getAllPersonsIdsFromRegistry(),t);return n.reduce(function(t,n){return e.removeContact(n)?t.concat(n):t},[])}}return e.prototype.getContactsToRemove=function(e,t){var n=a.map(t,function(e){return u.getId(e.mri)});return a.difference(e,n)},e.prototype.removeContact=function(e){var t=r.getPersonById(e);return t?(i.setAuthorization(t,f.UNAUTHORIZED),!0):!1},e.prototype.getAllPersonsIdsFromRegistry=function(){return this.registry.filter(this.keepKnownPersons.bind(this)).map(function(e){return e.id()})},e.prototype.keepKnownPersons=function(e){return!!n.get().personsAndGroupsManager.all.persons(e.id())},e}();t.GroupCleaner=l,t.build=c}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataProcessors/authorization",["require","exports","../../../modelHelpers/contacts/authorizationChange","../../../modelHelpers/personsRegistry/instance","jskype-constants"],e)}(function(e,t){function u(){return new o}var n=e("../../../modelHelpers/contacts/authorizationChange"),r=e("../../../modelHelpers/personsRegistry/instance"),i=e("jskype-constants"),s=i.PEOPLE.authorizationStates,o=function(){function e(){var e=this;this.registry=r.build(),this.process=function(t){t.forEach(function(t){t._authorization()===s.UNKNOWN&&(n.setAuthorization(t,s.UNAUTHORIZED),e.registry.add(t))})}}return e}();t.AuthorizationProcessor=o,t.build=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataMappers/contactToPerson",["require","exports","../../../modelHelpers/contacts/authorizationChange","../../../modelHelpers/contacts/presenceHelper","../../../modelHelpers/contacts/groupHelper","../../../modelHelpers/contacts/dataMappers/mappers","jskype-constants","swx-mri/lib/mriMaps","swx-enums","lodash-compat"],e)}(function(e,t){function v(e,t,o){var u=e.profile||{},l=f.result(u.name,"first"),v=f.result(u.name,"surname"),S=f.result(u.name,"title"),T=w(e),N=g(e),C=[];s.mapAvatarUrl(u.avatar_url,t),s.mapDisplayName(e.display_name,t),s.mapFirstName(l,t),s.mapLastName(v,t),s.mapTitle(S,t),s.mapPhoneNumbers(u.phones,t,p),s.mapPhoneNumbers(e.phones,t,d),s.mapActivity(N,t),s.mapBirthday(u.birthday,t),E(t,e)&&s.mapCapabilities(b(t,e),t),m(u.locations)&&y(u.locations[0],t),t.displayName()===t.id()&&s.mapDisplayNameFallback(l,v,t),o&&t.status._set(r.getDefaultPresence(t,T)),n.setAuthorization(t,T,c),e.blocked?n.setBlocked(t,c):n.setUnblocked(t,c),e.favorite&&C.push(a.groupType.Favorites),x(t,e)&&t.agentDetails.certification._set(e.agent.trust===h),i.updateGroups(t,C)}function m(e){return f.isArray(e)&&f.isPlainObject(e[0])}function g(e){return e.suggested?o.PEOPLE.SUGGESTED_CONTACT_ACTIVITY_MESSAGE:!!e.profile&&e.profile.mood}function y(e,t){s.mapCity(e.city,t),s.mapCountry(e.country,t)}function b(e,t){return e._type()===u.contactMriTypes.agent?t.agent.capabilities:e._type()===u.contactMriTypes.pstn?["audio.receive","group.add"]:[]}function w(e){return e.authorized===!0?l.AUTHORIZED:e.suggested===!0?l.SUGGESTED:l.PENDING_OUTGOING}function E(e,t){return e._type()===u.contactMriTypes.agent&&S(t)||e._type()===u.contactMriTypes.pstn}function S(e){return!!e.agent&&!!e.agent.capabilities}function x(e,t){return e._type()===u.contactMriTypes.agent&&T(t)}function T(e){return!!e.agent&&e.agent.trust!==undefined}var n=e("../../../modelHelpers/contacts/authorizationChange"),r=e("../../../modelHelpers/contacts/presenceHelper"),i=e("../../../modelHelpers/contacts/groupHelper"),s=e("../../../modelHelpers/contacts/dataMappers/mappers"),o=e("jskype-constants"),u=e("swx-mri/lib/mriMaps"),a=e("swx-enums"),f=e("lodash-compat"),l=o.PEOPLE.authorizationStates,c=!1,h="trusted",p=!0,d=!1;t.map=v}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/contactAdder",["require","exports","../../../lib/modelHelpers/contacts/dataMappers/contactToPerson","../../../lib/modelHelpers/personsAndGroupsHelper","../../../lib/modelHelpers/presence/presenceDataStorage","../../../lib/modelHelpers/contacts/dataProcessors/agents","swx-constants","swx-mri","swx-mri/lib/mriMaps","jskype-settings-instance","lodash-compat"],e)}(function(e,t){function h(){return new c}var n=e("../../../lib/modelHelpers/contacts/dataMappers/contactToPerson"),r=e("../../../lib/modelHelpers/personsAndGroupsHelper"),i=e("../../../lib/modelHelpers/presence/presenceDataStorage"),s=e("../../../lib/modelHelpers/contacts/dataProcessors/agents"),o=e("swx-constants"),u=e("swx-mri"),a=e("swx-mri/lib/mriMaps"),f=e("jskype-settings-instance"),l=e("lodash-compat"),c=function(){function e(){var e=this;this.dataMapper=n,this.cache=i.getCache(),this.add=function(t){var n=l.reduce(t,e.createPersonsAndReturnAgents.bind(e),[]);return l.forEach(n,e.savePresenceToCache.bind(e)),s.process(n)}}return e.prototype.addContact=function(e){var t=u.getId(e.mri),n=u.getTypeFromKey(e.mri),i=r.getPersonById(t);return i?this.dataMapper.map(e,i,!1):(i=r.getPerson(t,n),this.dataMapper.map(e,i,!0)),i},e.prototype.createPersonsAndReturnAgents=function(e,t){if(this.shouldProcess(t)){var n=u.getTypeFromKey(t.mri),r=this.addContact(t);n===a.contactMriTypes.agent&&e.push(r)}return e},e.prototype.shouldProcess=function(e){var t=u.getId(e.mri),n=u.getTypeFromKey(e.mri);return r.isMePerson(t)?!1:n===a.contactMriTypes.pstn&&!f.isFeatureOn(o.COMMON.featureFlags.PSTN_ENABLED)?!1:n===a.contactMriTypes.agent&&!f.isFeatureOn(o.COMMON.featureFlags.AGENTS_ENABLED)?!1:!0},e.prototype.savePresenceToCache=function(e){this.cache.set(e.id(),{status:e.status()})},e}();t.ContactAdder=c,t.build=h}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataMappers/cacheToPerson",["require","exports","../../../modelHelpers/contacts/groupHelper","../../../models/phoneNumber","jcafe-property-model","lodash-compat"],e)}(function(e,t){function o(e,t){a(e,t),a(e.note,t.note),a(e.location,t.location),a(e.capabilities,t.capabilities),a(e.agentDetails,t.agentDetails),f(e,t.phoneNumbers)}function u(e){var t=l(e);return t.note=l(e.note),t.location=l(e.location),t.capabilities=l(e.capabilities),t.agentDetails=l(e.agentDetails),t.affiliatedGroups=n.getAffiliatedGroupUris(e),t}function a(e,t){for(var n in e)e.hasOwnProperty(n)&&i.isProperty(e[n])&&e[n]._set(t[n])}function f(e,t){var n=e.phoneNumbers(0);s.forEach(t,function(t){if(n&&n.telUri()===t.telUri)a(n,t);else{var i=new r["default"];a(i,t),e.phoneNumbers.add(i,t.telUri)}})}function l(e){function n(e,t,n){var r=i.isProperty(t),o=!r&&i.isCollection(t),u=r||o?t():t;r&&!s.isUndefined(u)?n[e]=u:o&&(n[e]=u.reduce(function(e,t){return e.concat(l(t))},[]))}var t={};return s.forIn(e,function(e,r){n(r,e,t)}),t}var n=e("../../../modelHelpers/contacts/groupHelper"),r=e("../../../models/phoneNumber"),i=e("jcafe-property-model"),s=e("lodash-compat");t.mapCacheDataToPerson=o,t.mapPersonToCacheData=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataProcessors/contactListDataProcessor",["require","exports","swx-jskype-internal-application-instance","../../../../lib/services/cache/instance","../../../../lib/modelHelpers/contacts/groupCleaner","../../../../lib/modelHelpers/contacts/dataProcessors/authorization","../../../../lib/modelHelpers/contacts/contactAdder","../../../../lib/modelHelpers/personsRegistry/instance","../../../../lib/modelHelpers/contacts/dataMappers/cacheToPerson","../../../../lib/services/internalPubSub","swx-mri","jskype-constants","jskype-constants","swx-constants","lodash-compat"],e)}(function(e,t){function y(){return new g}var n=e("swx-jskype-internal-application-instance"),r=e("../../../../lib/services/cache/instance"),i=e("../../../../lib/modelHelpers/contacts/groupCleaner"),s=e("../../../../lib/modelHelpers/contacts/dataProcessors/authorization"),o=e("../../../../lib/modelHelpers/contacts/contactAdder"),u=e("../../../../lib/modelHelpers/personsRegistry/instance"),a=e("../../../../lib/modelHelpers/contacts/dataMappers/cacheToPerson"),f=e("../../../../lib/services/internalPubSub"),l=e("swx-mri"),c=e("jskype-constants"),h=e("jskype-constants"),p=e("swx-constants"),d=e("lodash-compat"),v=h.DATA.storageKeys,m=c.PEOPLE.authorizationStates,g=function(){function e(){var e=this;this.registry=u.build(),this.handleFirstResponseData=d.once(this.updateGlobalPersonsState.bind(this)),this.process=function(t,n){var r=e.getUpdatedPersonsCollection(t);return e.handleFirstResponseData(r),n?e.updateContactsCache(r):Promise.resolve()}}return e.prototype.getUpdatedPersonsCollection=function(e){var t=d.reduce(e.contacts,function(e,t){return t.deleted?(i.build().removeContact(l.getId(t.mri)),e):e.concat(t)},[]);return t.length>0&&(o.build().add(t),e.scope===p.PEOPLE.scopes.FULL&&i.build().filter(t)),n.get().personsAndGroupsManager.all.persons()},e.prototype.updateContactsCache=function(e){var t=e.map(a.mapPersonToCacheData);return r.get().setSensitiveItem(v.CONTACT_PROFILES,t)},e.prototype.updateGlobalPersonsState=function(e){this.registry.defaultPersonAuthorization=m.UNAUTHORIZED,s.build().process(this.registry.toArray()),f.get().publish("contacts:loaded",e.filter(function(e){return e._authorization()===m.AUTHORIZED&&!e.isBlocked()})),n.get().personsAndGroupsManager._initialized(!0)},e}();t.ContactListDataProcessor=g,t.build=y}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/blockedGroupCleaner",["require","exports","../../../lib/modelHelpers/contacts/groupHelper","../../../lib/modelHelpers/contacts/authorizationChange","lodash-compat","swx-mri"],e)}(function(e,t){function o(e){var t=n.getBlockedGroup(),s=u(t.persons(),e);i.forEach(s,function(e){r.setUnblocked(e)})}function u(e,t){var n=[];return i.forEach(e,function(e){var r=i.find(t,function(t){var n=s.getKey(e.id(),e._type());return n===t.mri});r||n.push(e)}),n}var n=e("../../../lib/modelHelpers/contacts/groupHelper"),r=e("../../../lib/modelHelpers/contacts/authorizationChange"),i=e("lodash-compat"),s=e("swx-mri");t.clean=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataProcessors/blocklistDataProcessor",["require","exports","../../../../lib/modelHelpers/personsRegistry/instance","../../../../lib/modelHelpers/contacts/blockedGroupCleaner","../../../../lib/modelHelpers/contacts/authorizationChange","swx-mri","jskype-constants","swx-constants","lodash-compat"],e)}(function(e,t){function l(e){return!e||!e.blocklist?Promise.resolve():e.scope===u.PEOPLE.scopes.FULL?c(e):h(e)}function c(e){return p(e).then(function(){r.clean(e.blocklist)})}function h(e){return p(e)}function p(e){var t=[];return a.forEach(e.blocklist,function(e){var r=s.getId(e.mri),o=s.getTypeFromKey(e.mri),u=n.build().get(r);u||(u=n.build().create(r,o,f.UNAUTHORIZED),n.build().add(u,!0)),e.deleted?i.setUnblocked(u):t.push(i.setBlocked(u))}),Promise.all(t)}var n=e("../../../../lib/modelHelpers/personsRegistry/instance"),r=e("../../../../lib/modelHelpers/contacts/blockedGroupCleaner"),i=e("../../../../lib/modelHelpers/contacts/authorizationChange"),s=e("swx-mri"),o=e("jskype-constants"),u=e("swx-constants"),a=e("lodash-compat"),f=o.PEOPLE.authorizationStates;t.process=l}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataHandlers/rawViewCacheDataHandler",["require","exports","swx-jskype-internal-application-instance","jskype-constants","../../../../lib/services/cache/instance","../../../../lib/modelHelpers/contacts/dataMappers/cacheToPerson","../../../../lib/modelHelpers/contacts/groupHelper","swx-mri","../../../../lib/modelHelpers/personsAndGroupsHelper","../../../../lib/modelHelpers/personsRegistry/instance","../../../../lib/modelHelpers/contacts/dataProcessors/agents","../../../../lib/modelHelpers/contacts/authorizationChange","lodash-compat","jskype-constants"],e)}(function(e,t){function m(){var e={},t=y(),n=b();return e.contacts=t||[],e.blocklist=n||[],i.get().setSensitiveItem(d.CONTACTS_RAW_VIEW_DATA,e)}function g(){return i.get().getSensitiveItem(d.CONTACTS_RAW_VIEW_DATA).then(function(e){if(!w(e))throw new Error("Empty raw view data cache; force service delta ETag reset");var t=h.reduce(e.contacts,E,[]);return S(e.blocklist).then(function(){return l.process(t).then(function(){return m()})})})}function y(){var e=n.get().personsAndGroupsManager.all.persons()||[];return e.map(s.mapPersonToCacheData)}function b(){var e=o.getBlockedGroup().persons()||[];return e.map(function(e){return{mri:u.getKey(e.id(),e._type())}})}function w(e){if(!e||!e.contacts||!e.contacts.length)return!1;var t=h.reject(e.contacts,{isAgent:!0});return!!t.length}function E(e,t){var n=a.getPerson(t.id,t._type);return s.mapCacheDataToPerson(n,t),o.updateGroups(n,t.affiliatedGroups),t.isAgent&&e.push(n),e}function S(e){var t=[];return h.forEach(e,function(e){var n=u.getId(e.mri),r=u.getTypeFromKey(e.mri),i=f.build().getOrCreate(n,r,v.UNAUTHORIZED,!0);t.push(c.setBlocked(i))}),Promise.all(t)}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-constants"),i=e("../../../../lib/services/cache/instance"),s=e("../../../../lib/modelHelpers/contacts/dataMappers/cacheToPerson"),o=e("../../../../lib/modelHelpers/contacts/groupHelper"),u=e("swx-mri"),a=e("../../../../lib/modelHelpers/personsAndGroupsHelper"),f=e("../../../../lib/modelHelpers/personsRegistry/instance"),l=e("../../../../lib/modelHelpers/contacts/dataProcessors/agents"),c=e("../../../../lib/modelHelpers/contacts/authorizationChange"),h=e("lodash-compat"),p=e("jskype-constants"),d=r.DATA.storageKeys,v=p.PEOPLE.authorizationStates;t.update=m,t.restore=g}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataHandlers/rawViewDataHandlers",["require","exports","swx-jskype-internal-application-instance","../../../../lib/telemetry/people/contactList","../../../../lib/modelHelpers/contacts/dataProcessors/contactListDataProcessor","../../../../lib/modelHelpers/contacts/dataProcessors/blocklistDataProcessor","../../../../lib/modelHelpers/contacts/dataHandlers/rawViewCacheDataHandler","../../../../lib/services/cache/instance","swx-browser-globals","../../../../lib/services/contactsV2/instance","swx-constants/lib/people","jskype-constants/lib/data","jskype-constants/lib/people","lodash-compat"],e)}(function(e,t){function g(){return new m}var n=e("swx-jskype-internal-application-instance"),r=e("../../../../lib/telemetry/people/contactList"),i=e("../../../../lib/modelHelpers/contacts/dataProcessors/contactListDataProcessor"),s=e("../../../../lib/modelHelpers/contacts/dataProcessors/blocklistDataProcessor"),o=e("../../../../lib/modelHelpers/contacts/dataHandlers/rawViewCacheDataHandler"),u=e("../../../../lib/services/cache/instance"),a=e("swx-browser-globals"),f=e("../../../../lib/services/contactsV2/instance"),l=e("swx-constants/lib/people"),c=e("jskype-constants/lib/data"),h=e("jskype-constants/lib/people"),p=e("lodash-compat"),d=c["default"].storageKeys,v=h["default"].contactList.retry.TIMEOUT,m=function(){function e(){var e=this;this.contactListDataProcessor=i.build(),this.firstLoad=!0,this.onSuccess=function(t){var n=e,i=n.contactListDataProcessor.process(t.response),u=s.process(t.response);return r.onQueryContactListEnd({firstLoad:n.firstLoad,isFullFetch:n.isFullFetch(t.response),success:!0,serviceElapsed:t.duration}),n.firstLoad=!1,Promise.all([i,u]).then(o.update).then(function(t){if(t){var r=t.getResponseHeader("ETag");r&&n.resetEtag(r)}}.bind(null,t.request))},this.onError=function(t){return t.status===404&&!e.contactListTimeOut&&(n.get().personsAndGroupsManager._initialized(!0),e.contactListTimeOut=a.getWindow().setTimeout(e.retryGetRawView.bind(e),v)),r.onQueryContactListEnd({firstLoad:e.firstLoad,success:!1}),e.firstLoad=!1,Promise.reject(t)}}return e.prototype.resetEtag=function(e){u.get().setItem(d.CONTACTS_RAW_VIEW_ETAG,e)},e.prototype.retryGetRawView=function(){var e=this,t=n.get().personsAndGroupsManager.mePerson.id();u.get().getItem(d.CONTACTS_RAW_VIEW_ETAG).then(function(n){f.get().getRawViewDelta(t,n).then(e.onSuccess,e.onError),e.contactListTimeOut=undefined})},e.prototype.isFullFetch=function(e){function t(e){return p.isString(e)?e.toLowerCase():""}return!e||!e.scope?!1:t(e.scope)===l["default"].scopes.FULL},e}();t.RawViewDataHandlers=m,t.build=g});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/allGroup",["require","exports","jcafe-property-model","swx-jskype-internal-application-instance","swx-enums","../services/contactsV2/instance","../modelHelpers/contacts/dataHandlers/factory","swx-i18n","./group","swx-enums","../modelHelpers/personHelper","swx-utils-common/lib/settablePromise","../telemetry/people/contactList","../services/cache/instance","swx-constants/lib/people","swx-mri","jskype-constants/lib/data","../modelHelpers/contacts/dataHandlers/rawViewDataHandlers"],e)})(function(e,t){function S(e){var t=g.build(),u=n.collection({get:function(){function n(i){i&&(l.isGuest(e)?t.onSuccess({response:{contacts:[],blocklist:[]}}).then(u):o(),r.get().personsAndGroupsManager._contactsCacheRestored.changed.off(n))}function o(){return h.onQueryContactListStart(),p.get().getItem(b.CONTACTS_RAW_VIEW_ETAG).then(function(n){s.get().getRawViewDelta(e.id(),n).then(t.onSuccess,t.onError).then(u,a)})}function u(){w&&(w.resolve(),w=null)}function a(e){w&&(w.reject(e),w=null)}return r.get().signInManager.state()!==i.loginState.SignedIn?Promise.reject("signed out"):r.get().personsAndGroupsManager._initialized()?Promise.resolve():w?w:(w=c.build(),r.get().personsAndGroupsManager._contactsCacheRestored.changed(n),w)}});return u.asWritable({add:function(t,n,r,i){function l(){return t.isAgent()&&i===f.activityType.ContactRequestOutgoingAgent&&t._authorization._set(y.PENDING_OUTGOING),i===f.activityType.ContactRequestOutgoingPSTN?s.get().addPSTNContact(e.id(),v.getKey(n,t._type()),n).then(h,p):s.get().addContact(e.id(),v.getKey(n,t._type()),N(t)).then(h,p)}function c(){return s.get().acceptContactInvite(e.id(),v.getKey(n,t._type())).then(d,m)}function h(){o.getContactRequestSentHandlers().onSuccess(t)}function p(e){o.getContactRequestSentHandlers().onError(e,t)}function d(){o.getContactRequestAcceptedHandlers().onSuccess(t)}function m(e){o.getContactRequestAcceptedHandlers().onError(e)}var a;return i&&!v.isGuestId(n)&&(x(i)?a=l():T(i)&&(a=c())),u(n)||u.add(t,n,r),a||Promise.resolve()},remove:function(t,n){function a(){o.getContactDeletedHandlers().onSuccess(r)}function f(e){o.getContactDeletedHandlers().onError(e)}var r=u(t),i;return n||v.isGuestId(t)?(u.remove(t),i=Promise.resolve()):i=s.get().deleteContact(e.id(),v.getKey(t,r._type())).then(a,f),i}})}function x(e){return e===f.activityType.ContactRequestOutgoing||e===f.activityType.ContactRequestOutgoingResend||e===f.activityType.ContactRequestOutgoingAgent||e===f.activityType.ContactRequestOutgoingPSTN||e===f.activityType.SuggestedContact}function T(e){return e===f.activityType.ContactRequestIncoming}function N(e){return u.localization.fetch({key:"message_text_contactRequestGreeting",params:{displayName:e.displayName()}})}var n=e("jcafe-property-model"),r=e("swx-jskype-internal-application-instance"),i=e("swx-enums"),s=e("../services/contactsV2/instance"),o=e("../modelHelpers/contacts/dataHandlers/factory"),u=e("swx-i18n"),a=e("./group"),f=e("swx-enums"),l=e("../modelHelpers/personHelper"),c=e("swx-utils-common/lib/settablePromise"),h=e("../telemetry/people/contactList"),p=e("../services/cache/instance"),d=e("swx-constants/lib/people"),v=e("swx-mri"),m=e("jskype-constants/lib/data"),g=e("../modelHelpers/contacts/dataHandlers/rawViewDataHandlers"),y=d["default"].authorizationStates,b=m["default"].storageKeys,w,E=function(e){function t(t){var n=e.call(this)||this;return n.name._set(i.groupType.Root),n.type._set(i.groupType.Root),n.relationshipLevel._set(i.groupPrivacyRelationshipLevel.None),n.uri._set(i.groupType.Root),n.persons=S(t),w=null,n}return __extends(t,e),t.prototype._reset=function(){this.persons.empty(),w=null},t}(a["default"]);t.__esModule=!0,t["default"]=E});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/favoritesGroup",["require","exports","jcafe-property-model","swx-enums","../services/contactsV2/instance","./group","swx-mri","../modelHelpers/contacts/dataHandlers/rawViewCacheDataHandler"],e)})(function(e,t){function f(e){var t=n.collection();return t.asWritable({add:function(n,r,s,a){var f;return!t(r)&&!o.isGuestId(r)&&(a||(f=i.get().addContactToFavorites(e.id(),o.getKey(r,n._type())).then(u.update)),t.add(n,r)),f||Promise.resolve()},remove:function(n,r){var s,a=t(n);return!o.isGuestId(n)&&a&&(r||(s=i.get().removeContactFromFavorites(e.id(),o.getKey(n,a._type())).then(u.update)),t.remove(n)),s||Promise.resolve()}})}var n=e("jcafe-property-model"),r=e("swx-enums"),i=e("../services/contactsV2/instance"),s=e("./group"),o=e("swx-mri"),u=e("../modelHelpers/contacts/dataHandlers/rawViewCacheDataHandler"),a=function(e){function t(t){var n=e.call(this)||this;return n.name._set(r.groupType.Favorites),n.type._set(r.groupType.Favorites),n.relationshipLevel._set(r.groupPrivacyRelationshipLevel.None),n.uri._set(r.groupType.Favorites),n.persons=f(t),n}return __extends(t,e),t}(s["default"]);t.__esModule=!0,t["default"]=a});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/blockedGroup",["require","exports","jcafe-property-model","swx-enums","../modelHelpers/personsRegistry/instance","./group"],e)})(function(e,t){function u(){var e=n.collection();return e.asWritable({add:function(t,n){if(!e(n)){var r=i.build(),s=!0;r.get(n)||r.add(t,s),e.add(t,n)}return Promise.resolve()},remove:function(t){return e.remove(t),Promise.resolve()}})}var n=e("jcafe-property-model"),r=e("swx-enums"),i=e("../modelHelpers/personsRegistry/instance"),s=e("./group"),o=function(e){function t(){var t=e.call(this)||this;return t.persons=u(),t.name._set(r.groupPrivacyRelationshipLevel.Blocked),t.type._set(r.groupType.PrivacyRelationship),t.relationshipLevel._set(r.groupPrivacyRelationshipLevel.Blocked),t.uri._set(r.groupPrivacyRelationshipLevel.Blocked),t}return __extends(t,e),t}(s["default"]);t.__esModule=!0,t["default"]=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/entitlement",["require","exports","jcafe-property-model"],e)}(function(e,t){var n=e("jcafe-property-model"),r=function(){function e(){this.name=n.property({readOnly:!0}),this.active=n.property({readOnly:!0})}return e}();t.__esModule=!0,t["default"]=r});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/subscription",["require","exports","jcafe-property-model","./entitlement"],e)})(function(e,t){var n=e("jcafe-property-model"),r=e("./entitlement"),i=function(e){function t(){var t=e!==null&&e.apply(this,arguments)||this;return t.type=n.property({readOnly:!0}),t}return __extends(t,e),t}(r["default"]);t.__esModule=!0,t["default"]=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/account/dataHandlers/entitlements",["require","exports","../../propertyModelHelper","lodash-compat","../../../models/subscription","../../../services/entitlement/serviceSettings","swx-enums","swx-jskype-internal-application-instance"],e)}(function(e,t){function a(){function t(t){var i=[];return r.forEach(t.response,f),r.forEach(e.entitlements(),function(e){d(e,t.response)||i.push(e)}),r.forEach(i,function(t){e.entitlements.remove(t.name())}),n.createResolvedPromise()}function a(e){return n.createRejectedPromise(e)}function f(t){if(l(t)){h(t);return}if(c(t)){e.displayBalance._set(t.balanceFormatted),e._balance._set(t.balance),e._currency._set(t.attributes.currency);return}}function l(e){return e.service===o.subscriptionType.Package||e.service===o.subscriptionType.Plan}function c(e){return e.service===s.serviceNames.credit}function h(t){var n=e.entitlements(t.id);n?p(n,t):(n=new i["default"],p(n,t),e.entitlements.add(n,n.name()))}function p(e,t){e.name._set(t.id),e.type._set(t.service),e.active._set(t.active)}function d(e,t){return r.some(t,function(t){return e.name()===t.id})}var e=u.get().personsAndGroupsManager.mePerson.account;return{onSuccess:t,onError:a}}var n=e("../../propertyModelHelper"),r=e("lodash-compat"),i=e("../../../models/subscription"),s=e("../../../services/entitlement/serviceSettings"),o=e("swx-enums"),u=e("swx-jskype-internal-application-instance");t.build=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/account",["require","exports","jcafe-property-model","swx-jskype-internal-application-instance","../modelHelpers/account/dataHandlers/entitlements","../services/serviceFactory"],e)}(function(e,t){var n=e("jcafe-property-model"),r=e("swx-jskype-internal-application-instance"),i=e("../modelHelpers/account/dataHandlers/entitlements"),s=e("../services/serviceFactory"),o=function(){function e(){var e=this;this.entitlements=n.collection({get:function(){var t=r.get().personsAndGroupsManager.mePerson,n=i.build(),o=s.getEntitlementService();return o.getEntitlementListingData(t.id()).then(n.onSuccess,n.onError).then(function(){return e.entitlements()})}}),this.displayBalance=n.property({readOnly:!0}),this._currency=n.property({readOnly:!0}),this._balance=n.property({readOnly:!0})}return e}();t.__esModule=!0,t["default"]=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/presence/presenceMapper",["require","exports","lodash-compat","swx-enums"],e)}(function(e,t){function s(e){if(n.isString(e)){var t=i[e.toLowerCase()];return t===r.onlineStatus.Unknown?undefined:t}return undefined}function o(e){var t=r.onlineStatus.Offline.toString().toLowerCase(),n=r.onlineStatus.Idle.toString().toLowerCase(),i=e.toString().toLowerCase();return t===i||n===i}function u(e){if(!n.isString(e))return r.onlineStatus.Hidden;var t=i[e.toString().toLowerCase()];return t===undefined||t===r.onlineStatus.Unknown||t===r.onlineStatus.Offline?r.onlineStatus.Hidden:t}var n=e("lodash-compat"),r=e("swx-enums"),i={online:r.onlineStatus.Online,offline:r.onlineStatus.Offline,hidden:r.onlineStatus.Hidden,away:r.onlineStatus.Away,idle:r.onlineStatus.Idle,busy:r.onlineStatus.DoNotDisturb,unknown:r.onlineStatus.Unknown,berightback:r.onlineStatus.Away,donotdisturb:r.onlineStatus.DoNotDisturb,onthephone:r.onlineStatus.DoNotDisturb,outtolunch:r.onlineStatus.Away};t.map=s,t.canMapToOnline=o,t.mapToSelf=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-avatar-web-service/lib/avatarWebService",["require","exports","lodash-compat","swx-utils-common","swx-xhr-dispatcher"],e)}(function(e,t){function s(e,t){function o(n){return e().then(function(e){return{headers:{"X-Skypetoken":e,"X-Skype-Caller":t.appName,"X-Skype-Request-Id":r.guid.create().substring(0,8)},reporting:{serviceName:n}}})}function u(e,t,r){return o("updateAvatarV1").then(function(i){var o="avatars/"+encodeURIComponent(e),u=n.merge(i,{contentType:r,payload:t,processData:!1});return s.put(o,u)})}function a(e){return o("deleteAvatarV1").then(function(t){var n="avatars/"+encodeURIComponent(e);return s.remove(n,t)})}var s=i.build(t);return{updateAvatar:u,deleteAvatar:a}}var n=e("lodash-compat"),r=e("swx-utils-common"),i=e("swx-xhr-dispatcher");t.build=s}),define("swx-avatar-web-service",["swx-avatar-web-service/lib/avatarWebService"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/avatar/instance",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","swx-client-info","../serviceAccessLayer/decorations/reporting","swx-avatar-web-service"],e)}(function(e,t){function a(){var e;return u||(e=n.get().signInManager._skypeToken,u=o.build(e,{host:r.settings.avatarService.host,appName:i.getBIAppName(),decorations:[s]})),u}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("swx-client-info"),s=e("../serviceAccessLayer/decorations/reporting"),o=e("swx-avatar-web-service"),u;t.get=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/telemetry/people/contactInvitation",["require","exports","./contactTelemetryHelper","swx-constants"],e)}(function(e,t){function o(){n.setStart(i.QUERY_INVITATION_LIST)}function u(e){var t=a(i.QUERY_INVITATION_LIST,s.names.QUERY_INVITATION_LIST,e);n.send(t,s.TYPE)}function a(e,t,r){var i=n.getTrace(e),r=r||{},o={};return o[s.fields.NAME]=t,o[s.fields.SUCCESS]=r.success,n.addIfDefined(o,s.fields.BEGIN_TIMESTAMP,i.startTime),n.addIfDefined(o,s.fields.ELAPSED,i.duration),n.addIfDefined(o,s.fields.SERVICE_ELAPSED,r.serviceElapsed),n.addIfDefined(o,s.fields.INVITATION_COUNT,r.invitationCount),o}var n=e("./contactTelemetryHelper"),r=e("swx-constants"),i=r.COMMON.telemetry.performanceMarks.CONTACTS,s=r.COMMON.telemetry.contactsV2.invitation;t.onQueryInvitationListStart=o,t.onQueryInvitationListEnd=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/inviteMessage",["require","exports","swx-jskype-internal-application-instance","swx-utils-chat","swx-i18n"],e)}(function(e,t){function s(e){return u(e.message)}function o(e){return u(e.greeting)}function u(e){if(e)return r.messageSanitizer.escapeIncomingHTML(r.messageSanitizer.removeAnchorTags(e));var t=n.get().personsAndGroupsManager.mePerson.displayName();return t||(t=n.get().personsAndGroupsManager.mePerson.id()),i.localization.fetch({key:"message_text_contactRequestGreeting",params:{displayName:t}})}var n=e("swx-jskype-internal-application-instance"),r=e("swx-utils-chat"),i=e("swx-i18n");t.getSanitizedInviteMessage=s,t.getSanitizedInviteGreeting=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataProcessors/contactInvitesList",["require","exports","swx-jskype-internal-application-instance","jskype-constants","swx-mri","swx-enums","lodash-compat","../../../../lib/modelHelpers/contacts/contactActivityItemHelper","../../../../lib/modelHelpers/contacts/contactMessageFactory","../../../../lib/modelHelpers/personsRegistry/instance","../../../../lib/modelHelpers/contacts/inviteMessage"],e)}(function(e,t){function h(e){function t(){var t=e&&e.invite_list||[];o.forEach(t,function(e){p(e)})}return n.get().conversationsManager._conversationsSynced.promise.then(t)}function p(e){if(d(e)){var t=g(e.mri),r=n.get().conversationsManager.getConversation(t);t._authorization._set(c.PENDING_INCOMING),n.get().conversationsManager.conversations.add(r);var i=m(e.invites);i&&v(i,t,r)}}function d(e){return e&&e.mri&&e.invites&&e.invites.length}function v(e,t,n){var r=u.getContactRequestIncomingActivityItem(n),i=(new Date(e.time)).getTime();if(!r||r._id!==i){t.status._set(s.onlineStatus.Unknown),u.clearContactRequestActivityItems(n);var o=l.getSanitizedInviteMessage(e),f=a.getIncoming(t,i,o);n.historyService._processRawMessage(f)}}function m(e){var t=o.sortBy(e,function(e){return(new Date(e.time)).getTime()});return t.length&&t[t.length-1]}function g(e){var t=i.getId(e),n=i.getTypeFromKey(e);return f.build().getOrCreate(t,n,c.PENDING_INCOMING)}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-constants"),i=e("swx-mri"),s=e("swx-enums"),o=e("lodash-compat"),u=e("../../../../lib/modelHelpers/contacts/contactActivityItemHelper"),a=e("../../../../lib/modelHelpers/contacts/contactMessageFactory"),f=e("../../../../lib/modelHelpers/personsRegistry/instance"),l=e("../../../../lib/modelHelpers/contacts/inviteMessage"),c=r.PEOPLE.authorizationStates;t.process=h}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataHandlers/contactInvitesList",["require","exports","../../../../lib/modelHelpers/contacts/dataProcessors/contactInvitesList","../../../../lib/telemetry/people/contactInvitation","swx-utils-common","../../../../lib/services/contactsV2/instance","swx-jskype-internal-application-instance","swx-constants","lodash-compat"],e)}(function(e,t){function c(e){var t;return e&&e.response&&(t=n.process(e.response),r.onQueryInvitationListEnd({success:!0,invitationCount:a.size(e.response),serviceElapsed:e.duration}),p(e)),t||Promise.resolve()}function h(e){r.onQueryInvitationListEnd({success:!1})}function p(e){if(v(e)){var t=m(e);t&&a.delay(d,t*1e3)}}function d(){r.onQueryInvitationListStart(),s.get().getInvites(o.get().personsAndGroupsManager.mePerson.id()).then(c,h)}function v(e){return e.request.status===f.OK}function m(e){var n;try{n=l.getResponseHeader(e,t.RETRY_AFTER_HEADER),n=n&&parseInt(n,10)}catch(r){}return n||null}var n=e("../../../../lib/modelHelpers/contacts/dataProcessors/contactInvitesList"),r=e("../../../../lib/telemetry/people/contactInvitation"),i=e("swx-utils-common"),s=e("../../../../lib/services/contactsV2/instance"),o=e("swx-jskype-internal-application-instance"),u=e("swx-constants"),a=e("lodash-compat"),f=u.COMMON.httpStatusCodes,l=i.http;t.RETRY_AFTER_HEADER="Retry-after",t.onSuccess=c,t.onError=h}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/invitesListGetter",["require","exports","swx-jskype-internal-application-instance","../../../lib/services/contactsV2/instance","../../../lib/modelHelpers/personHelper","../../../lib/telemetry/people/contactInvitation","../../../lib/modelHelpers/contacts/dataHandlers/contactInvitesList"],e)}(function(e,t){function u(){var e;return i.isGuest(n.get().personsAndGroupsManager.mePerson)||(s.onQueryInvitationListStart(),e=r.get().getInvites(n.get().personsAndGroupsManager.mePerson.id()),e.then(o.onSuccess,o.onError)),e||Promise.resolve()}var n=e("swx-jskype-internal-application-instance"),r=e("../../../lib/services/contactsV2/instance"),i=e("../../../lib/modelHelpers/personHelper"),s=e("../../../lib/telemetry/people/contactInvitation"),o=e("../../../lib/modelHelpers/contacts/dataHandlers/contactInvitesList");t.get=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/meData",["require","exports","./contacts/dataHandlers/factory","./contacts/invitesListGetter","../services/stratus/instance","jcafe-property-model"],e)}(function(e,t){function o(){var e=n.getMeProfileHandlers(),t,o;return t=i.get().getProfile().then(e.onSuccess,e.onError),o=r.get(),s.task.waitAll([t,o])}var n=e("./contacts/dataHandlers/factory"),r=e("./contacts/invitesListGetter"),i=e("../services/stratus/instance"),s=e("jcafe-property-model");t.initialize=o});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/mePerson",["require","exports","jcafe-property-model","./person","./account","swx-enums","../modelHelpers/presence/presenceMapper","../services/serviceFactory","../services/stratus/instance","../services/avatar/instance","../modelHelpers/presence/presenceDataStorage","swx-jskype-internal-application-instance","../modelHelpers/personsAndGroupsHelper","../modelHelpers/meData","swx-utils-common","../modelHelpers/contacts/dataHandlers/factory"],e)})(function(e,t){function g(){var e;return function(){return e||(e=y()),e}}function y(){var e=v.getUserInfoHandlers();return a.get().getUserInfo().then(e.onSuccess,e.onError)}function b(e){return e&&e!==s.onlineStatus.Unknown}function w(e,t){var n=u.getPresenceService(),r=t===s.onlineStatus.DoNotDisturb?s.onlineStatus.Busy:t;n.setUserPresence(r),l.getCache().set(e,{status:t})}var n=e("jcafe-property-model"),r=e("./person"),i=e("./account"),s=e("swx-enums"),o=e("../modelHelpers/presence/presenceMapper"),u=e("../services/serviceFactory"),a=e("../services/stratus/instance"),f=e("../services/avatar/instance"),l=e("../modelHelpers/presence/presenceDataStorage"),c=e("swx-jskype-internal-application-instance"),h=e("../modelHelpers/personsAndGroupsHelper"),p=e("../modelHelpers/meData"),d=e("swx-utils-common"),v=e("../modelHelpers/contacts/dataHandlers/factory"),m=function(e){function t(t){var r=e.call(this,t)||this;return r.getUserInfo=g(),r._msaId=n.property({readOnly:!0}),r.account=new i["default"],r.id=n.property({readOnly:!0,get:function(){var e=n.task(),t=c.get().signInManager;return t.state.once(s.loginState.SignedIn,function(){t._skypeToken().then(function(t){if(t===r.lastSkypeToken){e.resolve(r.lastSkypeId);return}r.lastSkypeToken=t;try{var n=h.extractSkypeIdFromToken(t);!n||(r.lastSkypeId=n,r.id._set(n),r.displayName._set(n)),e.resolve(r.id())}catch(i){e.reject(i)}})}),e.promise}}),r.displayName=n.property({readOnly:!0,get:function(){return r.getMeProfileTask||(r.getMeProfileTask=n.task(),r.id.get().then(function(){p.initialize().then(function(){return r.getMeProfileTask.resolve(r.displayName())},function(){return r.getMeProfileTask.reject()})})),r.getMeProfileTask.promise}}),r.preferences=n.collection(),r.status=n.property({set:function(e){var t=n.task("setting ME status",e),i=o.map(e);return b(i)?(w(r.id(),i),t.resolve(i)):t.reject(new Error("new status value was invalid")),t.promise}}),r.activity=n.property({set:function(e){var t=r.activity(),i=n.task("setting ME activity");return a.get().setMoodMessage(r.id(),e).then(function(){return i.resolve(e)},function(){return i.resolve(t)}),i.promise}}),r.registeredAt=n.property({readOnly:!0,get:function(){var e=n.task();return r.getUserInfo().then(function(){return e.resolve(r.registeredAt())},function(t){return e.reject(t)}),e.promise}}),r._isLinkedMsaAutoGenerated=n.property({readOnly:!0,get:function(){var e=n.task(),t=/^\d+:cid-\(-?\d+\)@outlook.*$/i;return r._msaId()!==undefined?e.resolve(t.test(r._msaId())):r._msaId.once(function(e){return e!==undefined},function(){return e.resolve(t.test(r._msaId()))}),e.promise}}),r.active=n.boolProperty(!0),r.id._set(t),r.displayName._set(t),r.status._set(s.onlineStatus.Offline),r.status.reset=function(){},r.activity._set(""),r}return __extends(t,e),t.prototype.updateAvatar=function(e,t){return f.get().updateAvatar(this.id(),e,t)},t.prototype.updateAvatarUrl=function(){var e=this.avatarUrl();e=d.url.removeQueryParameter(e,"cachebust"),e=d.url.appendQueryParameter(e,"cachebust",(new Date).getTime().toString()),this.avatarUrl._set(e)},t.prototype._reset=function(){this.id._set(this.id()),this.displayName._set(this.id()),this.getMeProfileTask=null,this.status._set(s.onlineStatus.Offline),this.callingCapabilities&&this.callingCapabilities.setup()},t.prototype._addCallingCapabilities=function(e){this.callingCapabilities=e,this.capabilities.audio=this.callingCapabilities.audioCapability,this.capabilities.video=this.callingCapabilities.videoCapability,this.callingCapabilities.setup()},t}(r["default"]);t.__esModule=!0,t["default"]=m}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/search/match/multiWord",["require","exports","swx-utils-common"],e)}(function(e,t){function s(e,t){function l(e,t){return o(e,a)?(f={rank:t/r},!0):!1}var s=n.stringUtils.removeNonWordCharacters(t),u=n.stringUtils.removeNonWordCharacters(e);if(!t||!o(u,s))return null;var a=s.split(i)[0],f=null;return u.split(i).some(l),f}function o(e,t){var n=new RegExp("(^|\\s|\\b)"+t,"i");return e.match(n)}var n=e("swx-utils-common"),r=10,i=/\s?\b\s?/;t.func=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/search/match/singleWord",["require","exports","lodash-compat"],e)}(function(e,t){function r(e,t){var r=new RegExp(n.escapeRegExp(t),"i");return!!e.match(r)}var n=e("lodash-compat");t.func=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/search/match",["require","exports","swx-utils-common","./match/multiWord","./match/singleWord","../propertyValidator"],e)}(function(e,t){function u(e,r){var i=null;return s.isPhoneNumber(r)?e.phoneNumbers().some(function(s){t.phoneNumberRule.property=s;var o=f(t.phoneNumberRule,n.stringUtils.normalize(s.displayString()),n.stringUtils.normalize(r),e);return o?(i=o,!0):!1}):o.some(function(t){var s=e[t.property](),o=f(t,n.stringUtils.normalize(s),n.stringUtils.normalize(r),e);return o?(i=o,!0):!1}),i}function a(e,t){return e.rank?t.rank+e.rank:t.rank}function f(e,t,r,i){var s=e.method.func(n.stringUtils.normalize(t),n.stringUtils.normalize(r));return s?{rank:a(s,e),property:e.property,sortString:i.displayName(),person:i}:null}var n=e("swx-utils-common"),r=e("./match/multiWord"),i=e("./match/singleWord"),s=e("../propertyValidator");t.displayNameRule={property:"displayName",rank:1,method:r},t.idRule={property:"id",rank:2,method:i},t.phoneNumberRule={property:"phoneNumber",rank:0,method:i};var o=[t.displayNameRule,t.idRule];t.get=u,t.getMatch=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/search/sort",["require","exports","swx-utils-common"],e)}(function(e,t){function r(e){var t=i(e);return t=s(t),o(t)}function i(e){var t={};return e.forEach(function(e){t[e.rank]||(t[e.rank]=[]),t[e.rank].push(e)}),t}function s(e){return Object.keys(e).forEach(function(t){e[t]=n.array.sortByProperty(e[t],"sortString")}),e}function o(e){var t=[];return Object.keys(e).sort().forEach(function(n){t=t.concat(e[n])}),t}var n=e("swx-utils-common");t.run=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-contact-search-web-service/lib/contactSearchService",["require","exports","lodash-compat","swx-xhr-dispatcher","swx-utils-common"],e)}(function(e,t){function s(e,t){function a(r){return e().then(function(e){var u=[t.appName,t.appVersion,i.guid.create()].join("-"),a={headers:{"X-SkypeToken":e},reporting:{serviceName:"contactSearch"}},f="?requestid="+u+"&searchstring="+encodeURIComponent(r)+"&locale="+t.locale;t.includeLync&&(f+="&includeLync=true");if(o){var l=n.cloneDeep(a);l.reporting.serviceName="contactSearchMirror",o.get(f,l)}return s.get(f,a)})}var s=r.build(t),o;if(t.mirroringHost){var u=n.clone(t);u.host=u.mirroringHost,o=r.build(u)}return{searchDirectory:a}}var n=e("lodash-compat"),r=e("swx-xhr-dispatcher"),i=e("swx-utils-common");t.build=s}),define("swx-contact-search-web-service",["swx-contact-search-web-service/lib/contactSearchService"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/contactSearch/instance",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","swx-constants","../../services/serviceAccessLayer/decorations/reporting","swx-contact-search-web-service"],e)}(function(e,t){function a(){var e,t;return u||(e=n.get().signInManager._skypeToken,t={host:r.settings.contactSearchWebService.host,appName:r.settings.biAppName,appVersion:r.settings.version,locale:r.settings.initParams.locale,includeLync:r.isFeatureOn(i.COMMON.featureFlags.DIRECTORY_SEARCH_SKYPE_AND_LYNC),decorations:[s]},r.isFeatureOn(i.COMMON.featureFlags.GRAPH_SEARCH_MIRRORING_ENABLED)&&(t.mirroringHost=r.settings.contactSearchWebService.mirroringHost),u=o.build(e,t)),u}function f(){u=null}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("swx-constants"),s=e("../../services/serviceAccessLayer/decorations/reporting"),o=e("swx-contact-search-web-service"),u;t.get=a,t.reset=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataMappers/graphResultToPerson",["require","exports","../../../modelHelpers/contacts/dataMappers/mappers","jskype-settings-instance","swx-constants","lodash-compat"],e)}(function(e,t){function o(e,t){var o=e.nodeProfileData,u=e.nodeAnnotation;n.mapDisplayName(s.result(o,"name"),t),n.mapCity(s.result(o,"city"),t),n.mapState(s.result(o,"state"),t),n.mapCountry(s.result(o,"countryCode"),t),r.isFeatureOn(i.COMMON.featureFlags.USE_GRAPH_SEARCH_ANNOTATIONS)&&n.mapActivity(u,t)}var n=e("../../../modelHelpers/contacts/dataMappers/mappers"),r=e("jskype-settings-instance"),i=e("swx-constants"),s=e("lodash-compat");t.map=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/search/directoryDataHandler",["require","exports","lodash-compat","../personsAndGroupsHelper","../contacts/dataMappers/graphResultToPerson"],e)}(function(e,t){function s(e){return e&&e.response&&e.response.results?n.reduce(e.response.results,function(e,t){return o(t,e)},[]):[]}function o(e,t){var n=r.getUnknownPerson(e.nodeProfileData.skypeId);return!e||!n?t:(i.map(e,n),t.push(n),t)}var n=e("lodash-compat"),r=e("../personsAndGroupsHelper"),i=e("../contacts/dataMappers/graphResultToPerson");t.onResult=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/search/main",["require","exports","lodash-compat","jcafe-property-model","../../services/agents/instance","../../modelHelpers/contacts/dataMappers/agentToPerson","./match","./sort","../../services/contactSearch/instance","../../models/searchResult","./directoryDataHandler","../../modelHelpers/propertyModelHelper","../personsRegistry/instance","../personsAndGroupsHelper","jskype-constants"],e)}(function(e,t){function g(e){var t=b(e);return t.length>0?c.createResolvedPromise(t):y(e)}function y(e){var t=r.task(),n=a.get();return n.searchDirectory(e).then(function(e){var n=l.onResult(e);t.resolve(n.map(x))},function(e){return t.reject(e)}),t.promise}function b(e){var t=h.build().get(e);return t?[x(t)]:[]}function w(e){var t={};for(var n in e.keywords)e.keywords.hasOwnProperty(n)&&e.supportedKeywords(n)&&(t[n]=e.keywords[n]);return t}function E(e){var t=e.text();return n.isString(t)&&(S(t).forEach(function(t){return e.keywords[t[0].trim()]=t[1].trim()}),e.text(t.replace(m,"").trim())),e}function S(e){function n(e){return e.split(":")}var t=e.match(m);return t?t.map(n):[]}function x(e){var t;return e.person?(t=new f["default"](e.person),t.relevance=e.rank,t.matches[e.property]=e.sortString):t=new f["default"](e),t}function T(e){switch(e.result._authorization()){case v.AUTHORIZED:case v.PENDING_OUTGOING:case v.SUGGESTED:return!0;default:return!1}}function N(){return i.get().search().then(function(e){return e.response.agentDescriptions.map(function(e){var t=p.getPersonById(e.agentId);return t||(t=p.createDefaultPerson(e.agentId)),new f["default"](s.map(e,t))})})}function C(e,n){var i=r.task();return t.addressBook(e,n).then(function(e){e.length===0?t.skypeDirectory(n).then(function(e){i.resolve(e)}):i.resolve(e)}),i.promise}var n=e("lodash-compat"),r=e("jcafe-property-model"),i=e("../../services/agents/instance"),s=e("../../modelHelpers/contacts/dataMappers/agentToPerson"),o=e("./match"),u=e("./sort"),a=e("../../services/contactSearch/instance"),f=e("../../models/searchResult"),l=e("./directoryDataHandler"),c=e("../../modelHelpers/propertyModelHelper"),h=e("../personsRegistry/instance"),p=e("../personsAndGroupsHelper"),d=e("jskype-constants"),v=d.PEOPLE.authorizationStates,m=/((?!live)\b\S+:\S+){1,}/gi;t.agents=N,t.addressBook=function(e,t){if(!t)return c.createResolvedPromise([]);var i=r.task(),s=w(E(t)),a=t.text(),f=[],l=[];if(s.id){var h=e(s.id);h&&(l.push(o.getMatch(o.idRule,h.id(),s.id,h)),f.push(h))}else if(s.phoneNumber)for(var p=0,d=e();p<d.length;p++){var v=d[p];for(var m=0,g=v.phoneNumbers();m<g.length;m++){var y=g[m];y.displayString()===s.phoneNumber&&l.push(o.getMatch(o.phoneNumberRule,y.displayString(),s.phoneNumber,v))}}else f=e();return n.isString(a)&&a.length&&(l=[],f.forEach(function(e){var t=o.get(e,a);t&&l.push(t)})),i.resolve(u.run(l).map(x).filter(T)),i.promise},t.skypeDirectory=function(e){if(!e)return c.createResolvedPromise([]);var t=w(E(e)),n=e.text();return!t.id&&!n?c.createResolvedPromise([]):t.id?g(t.id):y(n)},t.all=C});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/personSearchQuery",["require","exports","swx-jskype-internal-application-instance","jcafe-property-model","./searchQuery","swx-enums","../modelHelpers/search/main","../modelHelpers/propertyModelHelper"],e)})(function(e,t){function f(e){var t=n.get().personsAndGroupsManager;if(!t._initialized())return l(e);var r=e.sources(),i=t.all.persons,u;switch(r){case s.searchScope.Agent:u=o.agents();break;case s.searchScope.AddressBook:u=o.addressBook(i,e);break;case s.searchScope.SkypeDirectory:u=o.skypeDirectory(e);break;case s.searchScope.All:u=o.all(i,e);break;default:return Promise.reject(new Error("Required property sources was not valid."))}return u.then(function(t){for(var n=0,r=t;n<r.length;n++){var i=r[n];e.results._add(i)}})}function l(e){var t=n.get().personsAndGroupsManager;return new Promise(function(n){t._initialized.changed(function(t){t&&n(f(e))})})}var n=e("swx-jskype-internal-application-instance"),r=e("jcafe-property-model"),i=e("./searchQuery"),s=e("swx-enums"),o=e("../modelHelpers/search/main"),u=e("../modelHelpers/propertyModelHelper"),a=function(e){function t(){var t=e.call(this)||this;t.getMore=r.command(f.bind(null,t),t.moreResultsAvailable);var n=r.collection();return n.add("id","id"),n.add("phoneNumber","phoneNumber"),t.supportedKeywords=u.exposeReadOnlyCollection(n),t}return __extends(t,e),t}(i["default"]);t.__esModule=!0,t["default"]=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-invite-web-service/lib/inviteWebService",["require","exports","swx-xhr-dispatcher"],e)}(function(e,t){function r(e,t){function i(i){return e().then(function(e){var s={headers:{"X-SkypeToken":e,Version:"1.0","X-Skype-Caller":t.skypeCaller},contentType:n.contentTypes.JSON_V1_0,payload:JSON.stringify({Id:i}),reporting:{serviceName:"invite"}};return r.post("/contact/add",s)})}var r=n.build(t);return{autoBuddy:i}}var n=e("swx-xhr-dispatcher");t.build=r}),define("swx-invite-web-service",["swx-invite-web-service/lib/inviteWebService"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/invite/instance",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","../serviceAccessLayer/decorations/reporting","swx-invite-web-service"],e)}(function(e,t){function u(){return o||(o=s.build(n.get().signInManager._skypeToken,{host:r.settings.inviteWebService.host,decorations:[i],skypeCaller:r.settings.biAppName})),o}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("../serviceAccessLayer/decorations/reporting"),s=e("swx-invite-web-service"),o;t.get=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/personsAndGroupsManager",["require","exports","swx-enums","jcafe-property-model","./group","./allGroup","./favoritesGroup","./blockedGroup","./mePerson","./personSearchQuery","swx-constants","jskype-settings-instance","jskype-constants","../services/invite/instance","../modelHelpers/contacts/dataHandlers/factory"],e)}(function(e,t){var n=e("swx-enums"),r=e("jcafe-property-model"),i=e("./group"),s=e("./allGroup"),o=e("./favoritesGroup"),u=e("./blockedGroup"),a=e("./mePerson"),f=e("./personSearchQuery"),l=e("swx-constants"),c=e("jskype-settings-instance"),h=e("jskype-constants"),p=e("../services/invite/instance"),d=e("../modelHelpers/contacts/dataHandlers/factory"),v=function(){function e(){this._contactsCacheRestored=r.property({value:!1}),this._initialized=r.property({value:!1}),this.mePerson=new a["default"](h.PEOPLE.SELF),this.all=new s["default"](this.mePerson);var e=new u["default"];this.all.groups.add(e,e.uri());if(c.isFeatureOn(l.COMMON.featureFlags.FAVORITE_CONTACTS_ENABLED)){var t=new o["default"](this.mePerson);this.all.groups.add(t,t.uri())}}return e.prototype.createPersonSearchQuery=function(){return new f["default"]},e.prototype.createGroupSearchQuery=function(){throw new Error("Not implemented!")},e.prototype.createGroup=function(){return new i["default"](n.groupType.Custom)},e.prototype._autoBuddyFromInvite=function(e,t){return p.get().autoBuddy(e).then(function(){return d.getContactAutoBuddyHandlers().onSuccess(t),Promise.resolve()})},e.prototype._reset=function(){this._initialized(!1),this.mePerson._reset(),this.all._reset(),this.all.groups().forEach(function(e){return e.persons.empty()})},e}();t.__esModule=!0,t["default"]=v}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/trouter/handlers/messageHandlerUtilities",["require","exports","swx-constants"],e)}(function(e,t){function i(e){return e.eventId?e.eventId:e.body&&e.body.eventId}var n=e("swx-constants"),r=n.COMMON.httpStatusCodes;t.HANDLER_RESULT_STATUS_UNHANDLED={isHandled:!1},t.HANDLER_RESULT_STATUS_OK={isHandled:!0,resultCode:r.OK},t.getEventId=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/trouter/handlers/contactChangesMessageHandler",["require","exports","swx-constants","./messageHandlerUtilities"],e)}(function(e,t){function s(e){function t(t){var n=r.getEventId(t);switch(n){case i.CONTACTLIST_CHANGE:return e.onContactListChangedNotification(t.body),r.HANDLER_RESULT_STATUS_OK;case i.INCOMING_CONTACT_INVITE:return e.onIncomingContactInviteNotification(t.body),r.HANDLER_RESULT_STATUS_OK;case i.OUTGOING_CONTACT_INVITE_ACCEPTED:return e.onOutgoingContactInviteAcceptedNotification(t.body),r.HANDLER_RESULT_STATUS_OK;case i.CONTACT_INVITES_LIST_CHANGE:return e.onIncomingInvitesListChangedNotification(t.body),r.HANDLER_RESULT_STATUS_OK}return r.HANDLER_RESULT_STATUS_UNHANDLED}return{handleMessage:t}}var n=e("swx-constants"),r=e("./messageHandlerUtilities"),i=n.COMMON.events.trouter;t.build=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataMappers/incomingInviteToPerson",["require","exports","../../../modelHelpers/contacts/dataMappers/mappers"],e)}(function(e,t){function r(e,t){n.mapDisplayName(e.displayName,t),n.mapAvatarUrl(e.avatarUrl,t),n.mapCity(e.city,t),n.mapCountry(e.country,t)}var n=e("../../../modelHelpers/contacts/dataMappers/mappers");t.map=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataProcessors/incomingInvite",["require","exports","swx-jskype-internal-application-instance","../../../../lib/modelHelpers/contacts/contactActivityItemHelper","../../../../lib/modelHelpers/contacts/contactMessageFactory","../../../../lib/modelHelpers/contacts/inviteMessage","../../../../lib/modelHelpers/contacts/dataMappers/incomingInviteToPerson","../../../../lib/modelHelpers/personsRegistry/instance","swx-mri","swx-utils-chat","jskype-constants","swx-enums"],e)}(function(e,t){function p(e){function t(){var t=e&&e.parameters;t&&t.inviterMri&&d(t)}return n.get().conversationsManager._conversationsSynced.promise.then(t)}function d(e){var t=v(e.inviterMri),u=n.get().conversationsManager.getConversation(t),a=f.dateTime.now();t._authorization._set(h.PENDING_INCOMING),o.map(e,t),n.get().conversationsManager.conversations.add(u);var l=r.getContactRequestIncomingActivityItem(u);if(!l||l._id!==a){t.status._set(c.onlineStatus.Unknown),r.clearContactRequestActivityItems(u);var p=s.getSanitizedInviteGreeting(e),d=i.getIncoming(t,a,p);u.historyService._processRawMessage(d)}}function v(e){var t=a.getId(e),n=a.getTypeFromKey(e);return u.build().getOrCreate(t,n,h.PENDING_INCOMING)}var n=e("swx-jskype-internal-application-instance"),r=e("../../../../lib/modelHelpers/contacts/contactActivityItemHelper"),i=e("../../../../lib/modelHelpers/contacts/contactMessageFactory"),s=e("../../../../lib/modelHelpers/contacts/inviteMessage"),o=e("../../../../lib/modelHelpers/contacts/dataMappers/incomingInviteToPerson"),u=e("../../../../lib/modelHelpers/personsRegistry/instance"),a=e("swx-mri"),f=e("swx-utils-chat"),l=e("jskype-constants"),c=e("swx-enums"),h=l.PEOPLE.authorizationStates;t.process=p}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataProcessors/outgoingInviteAccepted",["require","exports","swx-jskype-internal-application-instance","../../../modelHelpers/personsRegistry/instance","../../../modelHelpers/contacts/authorizationChange","swx-mri","jskype-constants"],e)}(function(e,t){function a(e){function t(){var t=e&&e.parameters;t&&t.inviteeMri&&f(t)}return n.get().conversationsManager._conversationsSynced.promise.then(t)}function f(e){var t=l(e.inviteeMri);t&&i.setAuthorization(t,u.AUTHORIZED)}function l(e){var t=s.getId(e),n=s.getTypeFromKey(e);return r.build().getOrCreate(t,n,u.PENDING_OUTGOING)}var n=e("swx-jskype-internal-application-instance"),r=e("../../../modelHelpers/personsRegistry/instance"),i=e("../../../modelHelpers/contacts/authorizationChange"),s=e("swx-mri"),o=e("jskype-constants"),u=o.PEOPLE.authorizationStates;t.process=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataProcessors/incomingInvitesListChanged",["require","exports","swx-jskype-internal-application-instance","../../../modelHelpers/personsRegistry/instance","../../../modelHelpers/contacts/authorizationChange","swx-mri","jskype-constants"],e)}(function(e,t){function a(e){function t(){var t=e&&e.parameters;f(t)&&l(t)}return n.get().conversationsManager._conversationsSynced.promise.then(t)}function f(e){return e&&e.inviterMri&&e.context}function l(e){var t=c(e.inviterMri);t&&(e.context==="accept"?i.setAuthorization(t,u.AUTHORIZED):e.context==="decline"&&i.setAuthorization(t,u.UNAUTHORIZED))}function c(e){var t=s.getId(e),n=s.getTypeFromKey(e);return r.build().getOrCreate(t,n,u.PENDING_INCOMING)}var n=e("swx-jskype-internal-application-instance"),r=e("../../../modelHelpers/personsRegistry/instance"),i=e("../../../modelHelpers/contacts/authorizationChange"),s=e("swx-mri"),o=e("jskype-constants"),u=o.PEOPLE.authorizationStates;t.process=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataHandlers/contactNotification",["require","exports","swx-jskype-internal-application-instance","../../../services/contactsV2/instance","../../../services/trouter/trouter","../../../services/trouter/handlers/contactChangesMessageHandler","../invitesListGetter","../../../services/contacts/serviceSettings","../../../services/cache/instance","../dataProcessors/incomingInvite","../dataProcessors/outgoingInviteAccepted","../dataProcessors/incomingInvitesListChanged","jskype-constants/lib/data","../../../modelHelpers/contacts/dataHandlers/rawViewDataHandlers"],e)}(function(e,t){function v(){function h(){var t=n.get().personsAndGroupsManager.mePerson.id();return a.get().getItem(d.CONTACTS_RAW_VIEW_ETAG).then(function(n){r.get().getRawViewDelta(t,n,u.reasons.notification).then(e.onSuccess,e.onError)})}var e=p.build(),t={onContactListChangedNotification:h,onInvitesListChangedNotification:o.get,onIncomingContactInviteNotification:f.process,onOutgoingContactInviteAcceptedNotification:l.process,onIncomingInvitesListChangedNotification:c.process};return i.registerMessageHandler(s.build(t)),t}var n=e("swx-jskype-internal-application-instance"),r=e("../../../services/contactsV2/instance"),i=e("../../../services/trouter/trouter"),s=e("../../../services/trouter/handlers/contactChangesMessageHandler"),o=e("../invitesListGetter"),u=e("../../../services/contacts/serviceSettings"),a=e("../../../services/cache/instance"),f=e("../dataProcessors/incomingInvite"),l=e("../dataProcessors/outgoingInviteAccepted"),c=e("../dataProcessors/incomingInvitesListChanged"),h=e("jskype-constants/lib/data"),p=e("../../../modelHelpers/contacts/dataHandlers/rawViewDataHandlers"),d=h["default"].storageKeys;t.build=v}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/trouter/handlers/profileChangesMessageHandler",["require","exports","swx-constants","./messageHandlerUtilities"],e)}(function(e,t){function s(e){function t(t){var n=r.getEventId(t);switch(n){case i.USER_PROFILE_CHANGE:return e.onUserProfileChangeNotification(t.body),r.HANDLER_RESULT_STATUS_OK;case i.USER_AVATAR_CHANGE:return e.onUserAvatarChangeNotification(t.body),r.HANDLER_RESULT_STATUS_OK;default:return r.HANDLER_RESULT_STATUS_UNHANDLED}}return{handleMessage:t}}var n=e("swx-constants"),r=e("./messageHandlerUtilities"),i=n.COMMON.events.trouter;t.build=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/contacts/dataHandlers/profileNotification",["require","exports","swx-jskype-internal-application-instance","../../../services/stratus/instance","../../../services/trouter/trouter","../../../services/trouter/handlers/profileChangesMessageHandler","./factory"],e)}(function(e,t){function u(){function t(){n.get().personsAndGroupsManager.mePerson.updateAvatarUrl()}function u(){var e=o.getMeProfileHandlers();return r.get().getProfile().then(e.onUpdate,e.onError)}var e={onUserProfileChangeNotification:u,onUserAvatarChangeNotification:t};return i.registerMessageHandler(s.build(e)),e}var n=e("swx-jskype-internal-application-instance"),r=e("../../../services/stratus/instance"),i=e("../../../services/trouter/trouter"),s=e("../../../services/trouter/handlers/profileChangesMessageHandler"),o=e("./factory");t.build=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/trouter/handlers/accountChangesMessageHandler",["require","exports","swx-constants","./messageHandlerUtilities"],e)}(function(e,t){function s(e){function t(t){var n=r.getEventId(t);return n===i.USER_SERVICES_CHANGE?(e.onUserServicesChange(t.body),r.HANDLER_RESULT_STATUS_OK):r.HANDLER_RESULT_STATUS_UNHANDLED}return{handleMessage:t}}var n=e("swx-constants"),r=e("./messageHandlerUtilities"),i=n.COMMON.events.trouter;t.build=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/account/dataHandlers/account",["require","exports","swx-jskype-internal-application-instance","../../../services/entitlement/serviceSettings"],e)}(function(e,t){function s(){return new i}var n=e("swx-jskype-internal-application-instance"),r=e("../../../services/entitlement/serviceSettings"),i=function(){function e(){var e=this;this.account=n.get().personsAndGroupsManager.mePerson.account,this.onSuccess=function(t){return t.response.forEach(e.updateCreditBalance.bind(e)),Promise.resolve()}}return e.prototype.updateCreditBalance=function(e){this.isCredit(e)&&(this.account.displayBalance._set(e.balanceFormatted),this.account._balance._set(e.balance),this.account._currency._set(e.attributes.currency))},e.prototype.isCredit=function(e){return e.service===r.serviceNames.credit},e.prototype.onError=function(e){return Promise.reject(e)},e}();t.AccountDataHandler=i,t.build=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/account/dataHandlers/factory",["require","exports","./account"],e)}(function(e,t){function r(){return n.build()}var n=e("./account");t.getAccountChangedHandler=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/account/notificationHandlers",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","jskype-constants","../../services/serviceFactory","../../services/trouter/trouter","../../services/trouter/handlers/accountChangesMessageHandler","./dataHandlers/factory"],e)}(function(e,t){function f(){function r(){if(!l())return;var t=n.get().personsAndGroupsManager.mePerson.id();s.getEntitlementService().getEntitlementListingData(t).then(e.onSuccess,e.onError)}var e=a.getAccountChangedHandler(),t={onUserServicesChange:r};return o.registerMessageHandler(u.build(t)),t}function l(){return r.isFeatureOn(i.FEATURE_FLAGS.CREDIT_BALANCE_AUTO_UPDATE_ENABLED)}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("jskype-constants"),s=e("../../services/serviceFactory"),o=e("../../services/trouter/trouter"),u=e("../../services/trouter/handlers/accountChangesMessageHandler"),a=e("./dataHandlers/factory");t.build=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/presence/presenceDataHandler",["require","exports","lodash-compat","swx-jskype-internal-application-instance","swx-constants","swx-chat-service/lib/constants","jskype-constants","swx-enums","jskype-settings-instance","../../services/serviceFactory","./presenceDataStorage","../../modelHelpers/presence/presenceMapper","../../modelHelpers/personHelper","../personsAndGroupsHelper","swx-mri/lib/mriMaps","swx-mri"],e)}(function(e,t){function m(){return new g}function y(e,t){return function(){e(t)}}function b(e){if(!a.isFeatureOn(i.COMMON.featureFlags.DO_NOT_SEND_CONTACTS_TO_CHAT_SERVICE)){var t=n.filter(e,w);if(t.length>0){var r=f.getPresenceService(),s=n.map(t,function(e){return v.getKey(e.id(),e._type())});r.sendContactsList(s)}}}function w(e){return!!e&&h.canAddToChatServiceContactList(e)}function E(e){var t=/\/users\/(.+)\/presenceDocs/,n=e.match(t);return n&&n[1]}function S(e){var t=r.get().personsAndGroupsManager.mePerson,n;c.canMapToOnline(e)?t.status(u.onlineStatus.Online):(n=c.mapToSelf(e),t.status._set(n),l.getCache().set(t.id(),{status:n}))}function x(e,t,n,r){var i=p.getPersonById(e);if(i){var s=c.map(t);T(s,i)&&i.status._set(s),i.endpointType._set(r),i.lastSeenAt(n),l.getCache().set(e,{status:s,lastSeenAt:n,endpointType:r})}}function T(e,t){return e&&!t.isAgent()&&!h.isPstn(t)&&!h.isEchoContact(t)}function N(e){var t=e.capabilities;return t?t.split("|").map(function(e){return e.toLowerCase().trim()}):[]}function C(e){var t=o.PEOPLE.endpoints.MOBILE.toLowerCase();return e.indexOf(t)!==-1?u.endpointType.Mobile:u.endpointType.Desktop}function k(e){var t=r.get().personsAndGroupsManager.mePerson,n=v.getKey(t.id());return e===n||e===t._msaId()}var n=e("lodash-compat"),r=e("swx-jskype-internal-application-instance"),i=e("swx-constants"),s=e("swx-chat-service/lib/constants"),o=e("jskype-constants"),u=e("swx-enums"),a=e("jskype-settings-instance"),f=e("../../services/serviceFactory"),l=e("./presenceDataStorage"),c=e("../../modelHelpers/presence/presenceMapper"),h=e("../../modelHelpers/personHelper"),p=e("../personsAndGroupsHelper"),d=e("swx-mri/lib/mriMaps"),v=e("swx-mri");t.build=m;var g=function(){function e(){this.onMePresenceSet=function(e){if(e.selfLink&&e.status){var t=r.get()._telemetryManager,n={name:i.COMMON.telemetry.presence.name.SET_ME_PRESENCE,presence:e.status};t.sendEvent(a.settings.telemetry.jSkypeTenantToken,i.COMMON.telemetry.presence.TYPE,n)}},this.onSelfProperties=function(e){var t=r.get().personsAndGroupsManager,n=t.mePerson,i=e.primaryMemberName,s=e.skypeName;if(!s||!i)return;s!==i&&n._msaId._set(v.getKey(i,d.contactMriTypes.msn))},this.onPresence=function(e){if(e.selfLink&&e.status){var t=E(e.selfLink),n=v.getId(t),r=N(e),i=C(r);k(t)?S(e.status):x(n,e.status,e.lastSeenAt,i)}},this.onServiceError=function(e){e.actionName===s.SERVICE_CALLS.SET_USER_PRESENCE&&S(u.onlineStatus.Hidden)},this.onOnlineStateChanged=function(e){var t=r.get().personsAndGroupsManager,n=t.all.persons(),s=t.mePerson;e===i.COMMON.onlineStates.OFFLINE?(s.status._set(u.onlineStatus.Hidden),n.forEach(function(e){!h.isPstn(e)&&e.status()!==u.onlineStatus.Unknown&&e.status._set(u.onlineStatus.Hidden)})):e===i.COMMON.onlineStates.ONLINE&&l.getCache().restore()};var e=!0,t={serviceStarted:!1,sendContacts:null};this.onInitialContacts=function(e){t.serviceStarted?b(e):t.sendContacts=y(b,e)},this.onBatchPresenceUpdated=function(t){if(t&&e){var n=r.get()._telemetryManager,s={name:i.COMMON.telemetry.presence.name.GET_CONTACTS_PRESENCE,batchCount:t};n.sendEvent(a.settings.telemetry.jSkypeTenantToken,i.COMMON.telemetry.presence.TYPE,s),e=!1}},this.onServiceStarted=function(){t.serviceStarted=!0,t.sendContacts&&t.sendContacts()}}return e}()}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/presence/presenceDataEvents",["require","exports","swx-constants","jskype-constants","./presenceDataHandler","../../services/internalPubSub"],e)}(function(e,t){function o(){function o(e){function i(e){u(e)&&(t.onPresence(e.resource),r++)}var n=e.eventMessages,r=0;n?(n.forEach(i),t.onBatchPresenceUpdated(r)):a(e)}function a(e){var n=e.actionName.toLowerCase(),i=r.EVENTS.actions;if(n===i.subscriptionCreation)return t.onServiceStarted();if(n===i.setUserPresence)return t.onMePresenceSet(e);if(n===i.getSelfProperties)return t.onSelfProperties(e)}var e=s.get(),t=i.build();e.subscribe("webapi:data",o),e.subscribe("webapi:error",t.onServiceError),e.subscribe("contacts:loaded",t.onInitialContacts),e.subscribe(n.COMMON.events.system.ONLINE_STATE_CHANGED,t.onOnlineStateChanged)}function u(e){return e.resourceType.toLowerCase()===r.EVENTS.resourceTypes.USER_PRESENCE}var n=e("swx-constants"),r=e("jskype-constants"),i=e("./presenceDataHandler"),s=e("../../services/internalPubSub");t.init=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/oneToOneConversationFavoritesProcessor",["require","exports","lodash-compat","swx-jskype-internal-application-instance","../modelHelpers/contacts/groupHelper","jskype-settings-instance","swx-constants","swx-enums"],e)}(function(e,t){function f(){var e=[];return s.isFeatureOn(o.COMMON.featureFlags.FAVORITES_CONVERSATION_ENABLED)&&s.isFeatureOn(o.COMMON.featureFlags.FAVORITE_CONTACTS_ENABLED)&&n.forEach(r.get().conversationsManager.conversations(),function(t){if(l(t)){var n=t._isFavorited.set(!1,a);n.then(function(){var e=c(t);return i.addPersonToGroup(u.groupType.Favorites,e)}),e.push(n)}}),Promise.all(e)}function l(e){var t;return e.isGroupConversation()||!e._isFavorited||!e._isFavorited()?!1:(t=c(e),!!t&&!i.isPersonInGroup(u.groupType.Favorites,t))}function c(e){var t=e.participants();return t&&t.length&&t[0].person}var n=e("lodash-compat"),r=e("swx-jskype-internal-application-instance"),i=e("../modelHelpers/contacts/groupHelper"),s=e("jskype-settings-instance"),o=e("swx-constants"),u=e("swx-enums"),a=!0;t.process=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/dataOrchestrator",["require","exports","../services/cache/instance","./contacts/dataHandlers/contactNotification","./contacts/dataHandlers/profileNotification","./account/notificationHandlers","./presence/presenceDataEvents","./presence/presenceDataStorage","./contacts/dataHandlers/rawViewCacheDataHandler","swx-jskype-internal-application-instance","jskype-settings-instance","swx-constants","./oneToOneConversationFavoritesProcessor","jskype-constants/lib/data"],e)}(function(e,t){function v(){return f.get().personsAndGroupsManager.mePerson.id.get().then(function(){return r.build(),s.build(),l.isFeatureOn(c.COMMON.featureFlags.PROFILE_UPDATE_NOTIFICATIONS_ENABLED)&&i.build(),o.init(),f.get().conversationsManager._init(),a.restore().then(function(){return y().then(m,m)},function(){return g().then(m,m).then(y,y)}).then(h.process)})}function m(){return f.get().personsAndGroupsManager._contactsCacheRestored(!0),f.get().personsAndGroupsManager.all.persons.get()}function g(){return n.get().removeItem(d.CONTACTS_RAW_VIEW_ETAG)}function y(){return u.restoreData()}var n=e("../services/cache/instance"),r=e("./contacts/dataHandlers/contactNotification"),i=e("./contacts/dataHandlers/profileNotification"),s=e("./account/notificationHandlers"),o=e("./presence/presenceDataEvents"),u=e("./presence/presenceDataStorage"),a=e("./contacts/dataHandlers/rawViewCacheDataHandler"),f=e("swx-jskype-internal-application-instance"),l=e("jskype-settings-instance"),c=e("swx-constants"),h=e("./oneToOneConversationFavoritesProcessor"),p=e("jskype-constants/lib/data"),d=p["default"].storageKeys;t.initialize=v}),define("experience/defaultInitParams",[],function(){return{apiKey:"<REQUIRED>",correlationIds:{experienceId:"",hostProperty:"",sessionId:"",tabId:"",userAppId:"",userId:""},fingerprint:"",flags:"",locale:"en-us",variant:"swx",jsonp:!0,disableTelemetry:!1}}),define("experience/settings",["require","experience/defaultInitParams"],function(e){var t=e("experience/defaultInitParams"),n={enabled:!0,limit:3,delay:1e3,strategy:"fixed"},r={version:"1.115.27",biAppName:"swx-local",biClientName:"Web",platformId:"908",productName:"SWX",API:{version:1,exposeCafe:!1},ecsHosts:["https://a.config.skype.com","https://b.config.skype.com"],ecsSpacesKey:"SWG",ecsPesKey:"SkypePersonalization",ecsTrapKey:"MDN_TRAP",ecsCqfKey:"SkypeRealTimeMedia",ecsSkypeCallingT1Key:"SkypeCallingT1",ecsTrouterKey:"TrouterJScriptClient",ecsClientCobrandTag:"0",webApiServiceHost:"https://client-s.gateway.messenger.live.com",amdServiceHost:"https://api.asm.skype.com",assetsServiceHost:"https://apps.skypeassets.com/rates/skypeout",urlPServiceHost:"https://urlp.asm.skype.com",xmmFallbackUrl:"https://login.skype.com/login/sso",keyEncryptionServiceHost:"https://kes.skype.com/v1/swx",keyEncryptionServiceHostV2:"https://kes.skype.com/v2/swx",locationHost:"https://www.bing.com/maps",faqPageUrl:"https://www.skype.com/go/help.faq.skype.for.web",oneAccountSupportUrl:"https://go.skype.com/one.account.for.skype.and.microsoft",feedbackPageUrl:"https://feedback.skype.com",pollFallbackUrl:"https://login.skype.com/login/sso?go=webclient",meProfileUrl:"https://go.skype.com/myaccount?intsrc=client-_-webapp-_-production-_-go-myaccount",listParticipantNamesInConversationTopic:!0,isPollingEnabled:!0,maximumParticipantsAudio:25,maximumParticipantsVideo:10,mentionsTreshold:4,startConversationMaxParticipantCount:0,defaultBusinessContactsGroup:"Web Contacts",businessNotificationPersistence:{persistWhenConnectedElsewhere:{enabled:!1,timeout:9e5},persistWhenAutoAccepted:{enabled:!1,timeout:9e5}},youtubeWrapDelay:500,youtubeApiUrl:"https://www.youtube.com/iframe_api",mapsApiUrl:"https://ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=7.0",flagsApiUrl:"https://flagsapi.skype.com/flags/v1",calendarUrl:"https://outlook.live.com/owa/?path=/calendar/action/compose&",legacyCalendarUrl:"https://calendar.live.com/?rru=addevent&",webLoginUrl:"https://login.skype.com/login",webLoginClientId:"680081",cookiesPrivacyUrl:"https://go.skype.com/privacy/",loginPopup:{loginUrl:"https://login.microsoftonline.com/common/oauth2/authorize",clientId:"e48d4214-364e-4731-b2b6-47dabf529218",redirectUrl:"https://latest-swx.cdn.skype.com/swx4b/aad/externalSignInHandler.html",resourceUrl:"https://webdir.online.lync.com",defaultWidth:800,defaultHeight:600},maxSilentLoginRetries:3,application:{endpointId:"d97583cc-9781-4a59-9628-06c4e609c65b"},shellApp:{contactPollingInterval:15e3,chromeExtensionId:"blakpkgjpemejpbmfiglncklihnhjkij",chromeExtensionWebstoreUrl:"https://chrome.google.com/webstore/detail/blakpkgjpemejpbmfiglncklihnhjkij",bootstrapperUrl:"https://swx.cdn.skype.com/shared/v/1.2.9/SkypeBootstrap.min.js",indexPageUrl:undefined,connectShellAppHostRetries:2},images:{skypeLogo:"https://swx.cdn.skype.com/assets/skype_logo_white.png",relativeToAppBase:{defaultProfileAvatarSvg:"/assets/images/avatars/default-avatar-contact.svg",defaultGroupAvatarSvg:"/assets/images/avatars/default-avatar-group.svg",defaultPstnAvatarSvg:"/assets/images/avatars/avatar-pstn.svg"}},uicServiceUrl:{byPassword:"https://rtc-uic.cloudapp.net/v0/getuic-jsonp",bySkypeToken:"https://uic.login.skype.com/login/uic"},autoCalling:{waitTimeOut:6e3,callTimeout:12e4,serviceFailureTimeout:3e3},cqf:{skypeCallPercentage:10,groupCallPercentage:10,pstnCallPercentage:10,minimumCallLengthSec:5,inactivityTimeout:6e4},unansweredUI:{minCallDuration:5e3,defaultGreenButtons:{chatButton:!0,retryButton:!1}},avatarService:{host:"https://avatar.skype.com/v1/",contactAvatarEndpoint:"avatars/${contactId}?auth_key=${authKey}&returnDefaultImage=false&cacheHeaders=true",publicAvatarEndpoint:"avatars/${contactId}/public?returnDefaultImage=false&cacheHeaders=true"},agentProvisioningService:{host:"https://api.aps.skype.com/v1/"},contactSearchWebService:{host:"https://skypegraph.skype.com/search/v1.1/namesearch/swx",mirroringHost:"https://skypegraphprodcanary2.cloudapp.net/search/v1.1/namesearch/swx"},inviteWebService:{host:"https://inviteconnector.skype.com"},stratusService:{host:"https://profile.skype.com/profile/v1/",retry:n},contactsService:{host:"https://contacts.skype.com/",myContactsEndpoint:"contacts/${version}/users/${id}/contacts?delta&$filter=type eq 'skype' or type eq 'msn' or type eq 'pstn' or type eq 'agent' or type eq 'lync'&reason=${reason}",retry:n},entitlementService:{host:"https://consumer.entitlement.skype.com/",listingEndpoint:"/users/${username}/services",serviceEndpoint:"/users/${username}/services/${service}",retry:n},abchUserWebService:{appId:"f9606e30-ea4c-4cc2-b655-082b97e630ed",host:"https://people.directory.live-int.com/"},profileService:{appId:"f9606e30-ea4c-4cc2-b655-082b97e630ed",host:"https://pf.directory.live-int.com/",profileEndpoint:"profile/mine/System.ShortCircuitProfile.json"},pnvService:{host:"https://a.qalogin.skype.net/",pnvEndpoint:"shortcircuit/phonenumberverification",clientId:"580081"},commerce:{purchaseCreditUrl:"https://go.skype.com/store.buy.skypecredit",purchaseSubscriptionUrl:"https://go.skype.com/rates"},skypeFromOutlook:{host:"https://support.skype.com/",page:"/faq/FA12247/how-do-i-use-skype-from-my-outlook-com-account"},userOptionsService:{host:"https://options.skype.com",optionsEndpoint:"/options/v1/users/${userId}/options/${optionName}"},messageSearchService:{host:"https://scsquerycontroltower.cloudapp.net/",endpoints:{query:"v1/query"}},smsPriceWebService:{host:"https://skypesmssfe.trafficmanager.net"},controls:{sidebar:"Sidebar",content:"Content",me:"Me"},plugin:{pingHeartBeatTimeout:5e3,loadDelayMilisec:250,loadDuringDetection:!0,maxTotalLoadDelayMilisec:6e5,managerLoadTimeout:4e3,pluginInitTimeout:25e3,manifestKey:"SkypePluginManifestProd",ecsService:"prod",download:{msi:"https://swx.cdn.skype.com/plugin/SkypeWebPlugin.msi",pkg:"https://swx.cdn.skype.com/plugin/SkypeWebPlugin.pkg",minVersion:"7.0.0.5",maxVersion:"99.99.99.99"}},pluginless:{conversationServiceUrl:"https://api.conv.skype.com/conv/",mediaAgent:{numVideoChannelsGvc:5,renegotiationAttempts:3,enableReconnectChrome:!0,enableReconnectEdge:!0,reconnectGlareCallDropTimeout:1e4,preferSdesSrtp:!0,iceDisconnectedTimeoutMs:3e4,webrtcVideoCapabilityMaxFS:1200,webrtcVideoCapabilityMaxFPS:3e3,webrtcScreensharingCapabilityMaxFS:8160,webrtcScreensharingCapabilityMaxFPS:1500,webrtcVideoCapabilityCheckIntervalMin:2e4,webrtcVideoCapabilityCheckIntervalMax:3e4,webrtcScreensharingCapabilityCheckIntervalMin:0,webrtcScreensharingCapabilityCheckIntervalMax:0,enableLocalVideoConstraints:!0,webrtcAudioChannelSignalingFeedback:"app recv:dsh",webrtcVideoChannelSignalingFeedback:"app send:src recv:src",webrtcNativeCpuOveruseDisabled:!1,ortcVideoCapabilityMaxFS:1200,ortcVideoCapabilityMaxFPS:3e3,ortcVideoCapabilityCheckIntervalMin:2e4,ortcVideoCapabilityCheckIntervalMax:3e4,ortcPreferBundling:!0,webrtcResolutionManagerCooldownTimeout:15e3,webrtcResolutionManagerRetryDelay:5e3,webrtcMultiPartyVideoScaling:!1,capabilities:{webrtc:{screensharing:!1}},dtmf:{toneDuration:200,toneGap:100},activeSpeaker:{timeToPromote:3e3}},allowedMinEdgeVersion:13},unreadMessageReminderType:"emphasized",featureFlags:{agentsDiscoverable:!1,agentsEnabled:!1,showAgentIdOnProfile:!1,showAgentRatingOnProfile:!1,showAgentExtraInfoOnProfile:!1,newChat:!1,pinningToDogfoodCloud:!1,resizeCallAndChat:!1,creditBalanceAutoUpdateEnabled:!1,contactListChangeNotification:!1,deactivateCache:!1,skypeDirectorySearch:!1,muteNotifications:!1,muteNotificationsWithClosedSidebar:!1,muteSpecificConversationsEnabled:!1,browserNativeNotificationsEnabled:!1,useDarkThemeForBrowserNotificationsOptInFlow:!1,browserNotificationEducationalToastEnabled:!1,notifyHostEvenWhenMeNotAvailable:!1,newConversationV2:!1,spaces:!1,lastSeen:!1,mobileIndicator:!1,hasBetaLabel:!1,hasFeedbackLink:!1,hasFeedbackLinkOnError:!1,hasTimelineBadge:!1,showContactsPageHint:!1,showContactsPageInformationalMessage:!1,showFirstRunLandingExperience:!1,includeSelfInParticipantsCount:!1,showAlternateShareDialogExperience:!1,canNotifyWithoutVideo:!1,silentLinking:!1,showDefaultAvatarInNotifications:!1,directorySearchSkypeAndLync:!1,fetchContactsByPageEnabled:!1,contactPageFilterTabs:!1,doNotSendContactsToChatService:!1,supportStandbyMode:!1,disablePollingOnKahuna:!1,unreadMessageReminderToast:!1,profileUpdateNotificationsEnabled:!1,skypeUriNavigationEnabled:!0,timezoneInChatServiceRequest:!1,addHighPriorityScript:!1,calling:!0,autoCalling:!1,NGCalling:!1,PSTN:!1,disableCallingOnIE:!1,disableCallingOnEdge:!1,disableCallingOnChrome:!1,disableCallingOnFirefox:!1,disableCallingOnSafari:!1,pluginAutoUpdate:!1,persistentPlugin:!1,persistentShellApp:!1,preloadPlugin:!1,preloadShellApp:!1,GVCEscalation:!1,GVCLocalEscalation:!1,GVCJoining:!1,GVCOutgoing:!1,callingFullScreen:!1,CQF:!1,unansweredCallUIEnabled:!1,deviceDisabledDialogEnabled:!1,pluginlessCallingFirefox:!1,pluginlessCallingChrome:!1,pluginlessCallingEdge:!1,pluginlessCallingElectron:!1,pluginlessCallingChromeLinux:!1,pluginlessVideoCallingChromeLinux:!1,pluginlessVideoCallingFirefox:!1,pluginlessGroupVideoCallingChromeLinux:!1,pluginlessPSTNCalling:!1,pluginlessIncomingScreenSharingEdge:!1,pluginlessRemoteEscalation:!1,pluginlessLocalEscalation:!1,hostlessGroupCallingPluginless:!0,swiftCardCommand:!1,swiftCardRendering:!1,swiftCardRenderingMediaCards:!1,botMessagesModeV2enabled:!1,suggestedActionsEnabled:!1,issueReporting:!1,callInfoCommand:!1,serviceFailureReporting:!1,skypeDataTelemetry:!1,shellAppLogs:!1,consoleLogging:!1,errorLogReporting:!1,enableUnreadMessagesLogging:!1,contextMenuQuoteMessagesEnabled:!1,contextMenuSaveVideoMessagesEnabled:!1,contextMenuMarkAsReadEnabled:!1,contextMenuCopyMessagesEnabled:!1,alternativeSidebarLayout:!1,formatQuotesEnabled:!1,skypeCallPolicySupport:!1,skypeVideoCallingPolicySupport:!1,spaceTopicEditor:!1,markReadMessagesV2Enabled:!1,copySelectionAsQuoteKeyboard:!1,GDPRwebApi:!1,userSettingsEnabled:!1,alternativeSettingsPositionEnabled:!1,showUnlistedSettings:!1,aboutPageEnabled:!1,moodMessageEditEnabled:!1,inviteFree:!1,inviteFreeImplicitIncomingContactRequest:!1,shortCircuit:!1,pesCDNAuthUrlFallbackEnabled:!1,pesFetchSmallAssetsOnDemand:!1,pesFetchMediumAssetsOnDemand:!1,pesFetchLargeAssetsOnDemand:!1,pesFetchMojiAssetsOnDemand:!1,pesCDNAuthEnabled:!1,pesUseExtraLargeEmoticons:!1,hideEmoticonPickerButton:!1,pesBingImageSearchEnabled:!1,pesGiphyImageSearchEnabled:!1,pesLocalSearchEnabled:!1,emoticonSettingsEnabled:!1,emoticonSuggestionEnabled:!1,emoticonImplicitSuggestionDisabled:!1,showEmoticonSuggestionsSetting:!1,suggestHiddenEmoticons:!1,pesStoreEnabled:!1,canvasEmoticonsEnabled:!1,urlPreviews:!1,youtubePlayer:!1,urlPreviewLoadYoutubePlayer:!1,incomingScreenSharing:!1,outgoingScreenSharing:!1,outgoingScreenSharingPreview:!1,transferCall:!1,incomingWikiMarkup:!1,isCloudVideoMessageEnabled:!1,isCloudAudioMessageEnabled:!1,isFlikMessageEnabled:!1,newUrlPreviewDomainEnabled:!1,contactCardRenderingEnabled:!1,sendContactCardEnabled:!1,aggressiveImplicitMentionsMatching:!1,enableAggressiveMentionsToast:!1,mentionsEnabled:!1,mentionsPeopleEnabled:!1,codeSnippetEnabled:!1,notificationsCenter:!1,supportMessageProperties:!1,enablePingEcsConfig:!0,enableEndpointEcsConfig:!0,heartsEnabled:!1,heartsNotificationEnabled:!1,showChatIntroText:!1,pollsEnabled:!1,translatorSendingEnabled:!1,showTimestampsInNarrowMode:!1,reactionsSupportEnabled:!1,photoSharingEnabled:!1,fileTransferEnabled:!1,mediaBarEnabled:!1,mediaBarV2Enabled:!1,fileDragDropEnabled:!1,filePasteEnabled:!1,showMessageDeliveryIndicator:!1,showMessageDeliveryStatus:!1,readReceiptEnabled:!1,isTypingIndicator:!1,showWhenIamTyping:!1,creditGifting:!1,failInitializationOnIE:!1,searchEducationBubble:!1,callEducationBubble:!1,chatEducationBubble:!1,scheduleCallEducationBubble1:!1,scheduleCallEducationBubble2:!1,scheduleCallFromConversation:!1,useLegacySchedulerUriFormat:!1,welcomeDialog:!1,useAzureBasedSilentLogin:!1,enableRawEmoticonsRendering:!1,fullScreenModeFromSidepane:!1,contentSearch:!1,giphy:!1,meCommandEnabled:!1,telemetrySearchEnabled:!1,uiActionPerfTelemetryEnabled:!1,runtimeErrorsTelemetryEnabled:!1,captureSourceInAllTelemetryEnabled:!1,idleUsersAnalytics:!1,usersAnalytics:!1,enhancedNotification:!1,sidebarReopenEnabled:!1,keyEncryptionServiceV2Enabled:!1,navigationMenuIconsEnabled:!1,favoritesConversationsEnabled:!1,favoriteContactsEnabled:!1,useGraphSearchAnnotations:!1,graphSearchMirroringEnabled:!1,syncThreadBeforeJoinConversationEnabled:!1,audioVideoSettingsSupport:!1,useWhiteThemeForSplashScreen:!1,showSignInButtonOnTimeout:!1,showSignInButtonOnSignout:!1,notificationsSettingsEnabled:!1,notificationsSoundsSettingsEnabled:!1,ringingDeferring:!1,chatNotificationsSettingsEnabled:!1,chatNotificationsSoundSettingsEnabled:!1,callNotificationsSettingsEnabled:!1,callNotificationsSoundSettingsEnabled:!1,incomingCallToastNotifications:!1,unreadMessageToastNotifications:!1,contactRequestToastNotifications:!1,chatRequestToastNotifications:!1,unreadMessageToastForActiveEndpoint:!1,chatMessageTypeNotificationEnabled:!1,useAvatarCache:!1,useAvatarInitials:!1,avatarServiceSupportsSizeParameter:!1,showOneAccountLink:!1,initPreferencesAfterSignin:!1,darkThemeEnabled:!1,videoAutoPlaybackSettingsEnabled:!1,askToUnblockPlugin:!0,smsSupportEnabled:!1,unreadConversationDebugger:!1,groupAvatarUpdateEnabled:!1,hideSystemMessages:!1,hideSidebarOnStart:!1,messageEnforceTextFormat:!1,removeConversationHistory:!1,headerControlsDisabled:!1,singleConversationMode:!1,skipChatCapabilityCheck:!1,lowFocusImportanceContactRequest:!1,enableBusinessContactManagement:!1,useBusinessWording:!1,searchEducationBubbleBusiness:!1,chatEducationBubbleBusiness:!1,notificationsToggleEnabled:!1,disableConcurrentActiveCalls:!1,disableContactCardMenu:!1,disableKes:!1,disableLeaveConversation:!1,disableOpenConversationWithAuthor:!1,disablePersistentContactPresenceSubscription:!1,optimizeSpaceForCC:!1,disableRemoveConversationConfirmation:!1,disableCallScreenChatOption:!1,showEducationalCarousel:!1,hasFeedbackIcon:!1,showPickerSpinner:!1,showSearchQueryMoreResultsAvailable:!1,callscreenMinMax:!1,showTeamsAlert:!1},retry:n,webApiService:{retry:{limit:5,delay:100,strategy:"exponential"},overrides:{ping:{strategy:"fixed"}},pingDelayTime:{min:30,max:60},endpointRetry:{base:5,limit:120,noiseFactor:.5},standbyPollingDelayTime:{min:30,max:30}},swift:{urlPrefixBlacklist:["http","file","smb"]},giphy:{apiKey:"x4Rn0SRIjjXEc",rating:"pg-13"},contactsPageInformationalMessage:{key:"",link:""},conversationHistoryPageSize:30,incomingCalls:{notificationTimeout:3e4,trouterServiceUrl:"https://go.trouter.io/v2/a",tpcServiceUrl:"https://prod.tpc.skype.com/v1/policies",registrarServiceUrl:"https://prod.registrar.skype.com/v2/registrations",registrarTtlInSeconds:3600,registrarRefreshTimeoutInMs:354e4,trouterReadyTimeoutInMs:2e4,trouterConnectTimeoutInMs:1e4,maxRegistrationTimeInMs:864e5,pnhAppId:"skype",pnhTemplate:"SkypeWeb_1.5",pnhNGCTemplate:"SkypeWebNGC_1.7",p2pToNgcNotificationTimeout:2e3,connectTimeout:9e4,trouterTelemetryEnvironment:"int"},telemetry:{uiTenantToken:"bb15b8f2b7f446d4af2e245fc3b07e79-31d92fdb-e7a5-4be8-b14f-c48048f67a59-7685",jSkypeTenantToken:"bb15b8f2b7f446d4af2e245fc3b07e79-31d92fdb-e7a5-4be8-b14f-c48048f67a59-7685",skypeConcoreToken:"53fdaa090eb946b5a1d6cbdeb4f2ef66-bcbf6380-2590-41cc-ae60-9e467cd51835-7413",chatTenantToken:"b1e7805369ba4b5eaff1c894e532d32e-8ea4e021-e32f-4ba5-82ec-c1c980641d31-7035",trouterTenantToken:"19fbe91e74c64280aade16524a7fe51f-e0eb76a5-68df-4e5c-8ce3-6d33e395df6c-7043",mdscToken:"695e6c4def6c4847b178d16c83b926c4-51ac8017-8fbb-4069-9bf4-3e9cc75ebad8-7393",logReportingToken:"695e6c4def6c4847b178d16c83b926c4-51ac8017-8fbb-4069-9bf4-3e9cc75ebad8-7393",logThrottleInterval:1e4,issueReportUrl:"",issueReportScript:"",upnCorrelationIdEnabled:!1},serviceQosReporter:{iterationCountBeforeFlushingQoSMetrics:50},URLSanitizer:{securedResources:{allowedDomains:["**.skypeassets.com","**.skype.com"],allowedProtocols:["http","https"]}},initParams:t,applicationLanguage:"en-us",pesCDNAuthentication:{skypeServiceHost:"static.asm.skype.com",tokenSourceEndpoint:"/pes/v1/petoken",cdnServiceHost:"static-asm.secure.skypeassets.com",cookieSourceEndpoint:"/token/token_to_cookies",securedPathsPattern:"static[.]asm[.]skype[.]com",cdnTokenTtlMs:3e5,rewriteRules:[{from:"static.asm.skype.com",to:"static-asm.secure.skypeassets.com"},{from:"api.asm.skype.com",to:"static-asm.secure.skypeassets.com"}]},pesSearchServices:{bingApiKey:"aGt3dUhqZkFrbnZyU2doM1FqQ0RPQUdEUTFTbzNqc0FmYlFWMEFSSytMVTpoa3d1SGpmQWtudnJTZ2gzUWpDRE9BR0RRMVNvM2pzQWZiUVYwQVJLK0xV",bingAuthMethod:"Basic",bingServiceURL:"https://api.datamarket.azure.com/Bing/Search/v1/Image",bingTriggerWords:["bing","meme","gif"],bingDefaultSearchTerm:"popular",bingPickFirst:"gif",bingMergeItems:!0,bingBorderStyle:"thin",giphy:{withQuerySources:["translate","random","search"],withoutQuerySources:["trending"],serviceUrl:"https://api.giphy.com",apiKey:"x4Rn0SRIjjXEc",rating:"pg-13"},localSearchCategories:["Greetings","Happy","Love","Angry","Confused","Disgust"],localSearchGroupByType:!0},pesPicker:{useSelectedTabIconForPicker:!1,tabPlacementOverrides:{bing:-1,giphyImages:4}},pesStoreServices:{catalogApiHost:"apps.skypeassets.com",catalogServiceEndpoint:"/personal-expression?expansion=full&language=${lang}",catalogItemByIdServiceEndpoint:"/offers/sticker-pack/skus/${offerId}",catalogPurchaseEndpoint:"/purchase",catalogDogfoodContentEnabled:!1,catalogPurchaseApiHost:"api.skype.com",catalogServiceVersion:"3.0",catalogPurchaseApiVersion:"1.0"},splashScreen:{learnMoreUrl:"",signInNotificationEnabled:!1},authentication:{anonymousMode:!1},messageFilters:{outgoingMessageFilter:null,chatLogMessageFilter:null},xcoEnv:"qa",translatorClientAppId:"FF63883DDDED40068EC45030A601460C",translatorServiceURI:{TRANSLATE:"https://dev.microsofttranslator.com/api/skype/translate",LANGUAGES:"https://dev.microsofttranslator.com/api/languages"},userSettings:{hiddenCategories:[],hiddenPreferences:[],privacySettingsFetchTimeout:1e3},displayAppVersion:!1,cloudFileSharing:{unsafeFileTypes:".ade,.adp,.app,.asp,.bas,.bat,.cer,.chm,.cmd,.com,.cpl,.crt,.csh,.der,.exe,.fxp,.gadget,.hlp,.hta,.inf,.ins,.isp,.its,.js,.jse,.ksh,.lnk,.mad,.maf,.mag,.mam,.maq,.mar,.mas,.mat,.mau,.mav,.maw,.mda,.mdb,.mde,.mdt,.mdw,.mdz,.msc,.msh,.msh1,.msh2,.mshxml,.msh1xml,.msh2xml,.msi,.msp,.mst,.ops,.pcd,.pif,.plg,.prf,.prg,.pst,.reg,.scf,.scr,.sct,.shb,.shs,.ps1,.ps1xml,.ps2,.ps2xml,.psc1,.psc2,.tmp,.url,.vb,.vbe,.vbs,.vsmacros,.vsw,.ws,.wsc,.wsf,.wsh,.xnk"},flags:"",welcomeExperience:{enabled:!1,minDelayBeforeFirstMessage:0,maxDelayBeforeFirstMessage:3e5,toastPersistenceTimeout:3e5,whitelist:[]},avatarCacheDuration:36e5,greenId:{iframeUrl:"https://fpt.skype.com",registerUrl:"https://register.greenid.skype.com/api/register",timeout:2e4},s4bTeamsAlert:{notificationUrl:"https://aka.ms/weblearnmore",migartedUrl:"https://aka.ms/weblaunchclient"}};return r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/calling/handlers/plugin/pluginCallingHandler",["require","exports","swx-constants","../../../../../lib/services/plugin/pluginLifecycleFacade"],e)}(function(e,t){function i(e){return r.createPlugin().then(function(t){return t.skypeCore.selectCameraDevice(e)})}function s(e){return r.createPlugin().then(function(t){var r=e===n.COMMON.deviceSelection.DEFAULT_ID?"":e;return t.skypeCore.selectMicrophoneDevice(r)})}function o(e){return r.createPlugin().then(function(t){var r=e===n.COMMON.deviceSelection.DEFAULT_ID?"":e;return t.skypeCore.selectSpeakerDevice(r)})}function u(){return r.getVersion()}function a(){return new Promise(function(e,t){r.createPlugin().then(function(n){n.skypeCore.getMonitorList(e,t)},t)})}function f(e){return new Promise(function(t,n){r.createPlugin().then(function(r){r.skypeCore.setScreenCaptureMonitor(e,t,n)},n)})}function l(e,t,n){return new Promise(function(i,s){r.createPlugin().then(function(r){r.skypeCore.getMonitorPreview(e,t,n,i,s)},s)})}function c(e,t){return Promise.resolve(t)}var n=e("swx-constants"),r=e("../../../../../lib/services/plugin/pluginLifecycleFacade");t.selectCameraDevice=i,t.selectMicrophoneDevice=s,t.selectSpeakerDevice=o,t.getPluginVersion=u,t.getMonitorList=a,t.setScreenCaptureMonitor=f,t.getMonitorPreview=l,t.getDeviceName=c}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/calling/handlers/pluginless/pluginlessCallingHandler",["require","exports"],e)}(function(e,t){function r(e){n=e}function i(e){var t=n.getDeviceManager();return t.selectDevices({camera:e,microphone:t.getSelectedDevices().microphone}),Promise.resolve(undefined)}function s(e){var t=n.getDeviceManager();return t.selectDevices({microphone:e,camera:t.getSelectedDevices().camera}),Promise.resolve(undefined)}function o(){return Promise.reject(undefined)}function u(){return Promise.reject(undefined)}function a(){return Promise.reject(undefined)}function f(){return Promise.reject(undefined)}function l(){return Promise.reject(undefined)}function c(e,t){var r=n.getDeviceManager();return r.getDeviceNameAsync(e,t)}var n;t.initialize=r,t.selectCameraDevice=i,t.selectMicrophoneDevice=s,t.selectSpeakerDevice=o,t.getPluginVersion=u,t.getMonitorList=a,t.setScreenCaptureMonitor=f,t.getMonitorPreview=l,t.getDeviceName=c}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/outOfBrowser/messagingChannel",["require","exports","jcafe-property-model","swx-constants","swx-log-tracer"],e)}(function(e,t){function u(e){return new o(e)}var n=e("jcafe-property-model"),r=e("swx-constants"),i=e("swx-log-tracer"),s=i.getLogger("MessagingChannel"),o=function(){function e(e){var t=this;this.sendCommandTasks={},this.commandHandlers={},this.eventHandlers={},this.sendCommand=function(e,r){var i=n.task();if(!t.sendCommandTasks[e]){var o=t.buildCommand(e,r);t.sendCommandTasks[e]=i,t.send(o)}else i.reject("Command "+e+" is already awaiting response."),s.warn("Command ",e," is already awaiting response.");return i.promise},this.registerCommandHandler=function(e,n){t.commandHandlers[e]=n},this.registerEventHandler=function(e,n){t.eventHandlers[e]=n},this.unregisterEventHandler=function(e){delete t.eventHandlers[e]},this.unregisterCommandHandler=function(e){delete t.commandHandlers[e]},this.skypeExtension=e,this.skypeExtension.addMessageHandler(this.onMessageReceived.bind(this)),this.skypeExtension.addEventHandler(r.OUT_OF_BROWSER.shellAppEvents.WindowHidden,this.onWindowHidden.bind(this))}return e.prototype.dispose=function(){for(var e in this.commandHandlers)delete this.commandHandlers[e];for(var t in this.eventHandlers)delete this.eventHandlers[t]},e.prototype.buildCommand=function(e,t){return{name:e,type:r.OUT_OF_BROWSER.commandTypes.REQUEST,data:t}},e.prototype.send=function(e){var t=this;this.skypeExtension.postMessage(e)["catch"](function(){var n=t.sendCommandTasks[e.name];t.sendCommandTasks[e.name]=undefined,n.reject("Failed to post command "+e.name)})},e.prototype.onWindowHidden=function(){var e=this.eventHandlers[r.OUT_OF_BROWSER.shellAppEvents.WindowHidden];e&&e()},e.prototype.onMessageReceived=function(e){var t=e.message;t&&t.name&&t.type&&(t.type===r.OUT_OF_BROWSER.commandTypes.REQUEST?this.onRequestCommandReceived(t):t.type===r.OUT_OF_BROWSER.commandTypes.RESPONSE&&this.onResponseCommandReceived(t))},e.prototype.onRequestCommandReceived=function(e){var t=this.commandHandlers[e.name];t&&t(e.data)},e.prototype.onResponseCommandReceived=function(e){var t=this.sendCommandTasks[e.name];t&&(e.error?t.reject(e.error):t.resolve(e.data),this.sendCommandTasks[e.name]=undefined)},e}();t.MessagingChannel=o,t.build=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/outOfBrowser/extensionCommandHandler",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","swx-constants","../../../lib/services/calling/environmentInspector","swx-enums","../../../lib/telemetry/logging/callingLogTracer","swx-constants","../../../lib/modelHelpers/calling/participantHelper","swx-constants","swx-log-tracer"],e)}(function(e,t){function d(e){return new p(e)}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("swx-constants"),s=e("../../../lib/services/calling/environmentInspector"),o=e("swx-enums"),u=e("../../../lib/telemetry/logging/callingLogTracer"),a=e("swx-constants"),f=e("../../../lib/modelHelpers/calling/participantHelper"),l=e("swx-constants"),c=e("swx-log-tracer"),h=c.getLogger("ExtensionCommandHandler"),p=function(){function e(e){this.messagingChannel=e,e.registerCommandHandler(l.OUT_OF_BROWSER.commands.PLUGIN_ERROR,this.onPluginError.bind(this)),e.registerCommandHandler(l.OUT_OF_BROWSER.commands.CHANGE_STATE,this.onCallStateChanged.bind(this)),e.registerCommandHandler(l.OUT_OF_BROWSER.commands.UPDATE_PARTICIPANT_STATE,this.onParticipantStateChanged.bind(this)),e.registerCommandHandler(l.OUT_OF_BROWSER.commands.PSTN_EVENT,this.onPstnEvent.bind(this)),e.registerCommandHandler(l.OUT_OF_BROWSER.commands.MUTE,this.createMuteHandler(!0)),e.registerCommandHandler(l.OUT_OF_BROWSER.commands.UNMUTE,this.createMuteHandler(!1)),e.registerCommandHandler(l.OUT_OF_BROWSER.commands.CALL_INFO,this.onCallInfoMessage.bind(this)),e.registerCommandHandler(l.OUT_OF_BROWSER.commands.CONTACTS_DATA_REQUEST,this.onContactsDataRequested.bind(this)),r.isFeatureOn(i.COMMON.featureFlags.SHELL_APP_LOGS)&&e.registerCommandHandler(l.OUT_OF_BROWSER.commands.SHELL_APP_LOG,this.onShellAppLog.bind(this))}return e.prototype.onPluginError=function(e){e===a.PLUGIN_CONST.PLUGIN_ERRORS.REASON_ALREADY_EXISTS&&s.disableCalling(o.callingNotSupportedReasons.PluginAlreadyRunning)},e.prototype.onContactsDataRequested=function(){var e={};n.get().personsAndGroupsManager.all.persons().forEach(function(t){e[t.id()]={status:t.status()}}),u.get().log("[ExtensionCommand] updating shell with contacts"),this.messagingChannel.sendCommand(l.OUT_OF_BROWSER.commands.CONTACTS_DATA_RESPONSE,{contactsData:e})},e.prototype.onShellAppLog=function(e){try{var t=JSON.parse(window.atob(e.logs)),n=["ShellAppLog"].concat(t),r=u.get();r[e.method].apply(null,n)}catch(i){h.log("Unable to process shellApp log",e)}},e.prototype.onCallStateChanged=function(e){var t=this.getOrCreateConversation(e.conversationId);t.selfParticipant.audio.state._set(e.state,e.reason)},e.prototype.onParticipantStateChanged=function(e){if(!e.conversationId)return;var t=this.getOrCreateConversation(e.conversationId),n=f.getOrCreateParticipantInConversation(t,e.personId);if(!n)return;f.updateParticipantAudioVideoState(n,e.state,e.reason)},e.prototype.onPstnEvent=function(e){if(!e.conversationId)return;var t=this.getOrCreateConversation(e.conversationId),n=f.getOrCreateParticipantInConversation(t,e.participantId);if(!n)return;f.updateParticipantAudioVideoState(n,e.state,e.reason)},e.prototype.onCallInfoMessage=function(e){if(!e.conversationId||!e.messageBody)return;var t=this.getOrCreateConversation(e.conversationId);t._callData.pluginCallInfo(e.messageBody)},e.prototype.createMuteHandler=function(e){return function(r){var i=n.get().conversationsManager._getOrCreateConversation(r.conversationId);i._callHandler&&i._callHandler.toggleMuteTask&&i._callHandler.toggleMuteTask.promise.state()==="pending"?i._callHandler.toggleMuteTask.resolve(e):(i.selfParticipant.audio.isMuted._set(e),i.selfParticipant.audio.isMuted.set._enabled(!0))}},e.prototype.getOrCreateConversation=function(e){return n.get().conversationsManager._getOrCreateConversation(e)},e}();t.ExtensionCommandHandler=p,t.build=d}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/outOfBrowser/extensionLifecycleFacade",["require","exports","jcafe-property-model","../../../lib/services/outOfBrowser/extension","../../../lib/services/outOfBrowser/messagingChannel","../../../lib/services/outOfBrowser/extensionCommandHandler","swx-constants","jskype-settings-instance"],e)}(function(e,t){function f(e){return new a(e)}var n=e("jcafe-property-model"),r=e("../../../lib/services/outOfBrowser/extension"),i=e("../../../lib/services/outOfBrowser/messagingChannel"),s=e("../../../lib/services/outOfBrowser/extensionCommandHandler"),o=e("swx-constants"),u=e("jskype-settings-instance"),a=function(){function e(e){var t=this;this.extension=null,this.messagingChannel=null,this.getMessagingChannelTask=null,this.getMessagingChannel=function(){return t.getMessagingChannelTask||(t.getMessagingChannelTask=n.task(),t.extension.getAppHost().then(function(){return t.subscribeToMessagesFromExtension(),t.extension.openShellApp(t.notifyOnExtensionDisconnected.bind(t))})["catch"](function(e){t.getMessagingChannelTask.reject(e)})),t.getMessagingChannelTask.promise},this.disconnect=function(){return t.extension?t.extension.disconnect():Promise.resolve()},this.getVersion=function(){return t.extension?t.extension.getAppHost().then(function(e){return e.getVersion()}):Promise.reject(new Error("The object was disposed."))},this.dispose=function(){t.messagingChannel&&(t.messagingChannel.dispose(),t.messagingChannel=null),t.getMessagingChannelTask=null,t.onShellAppWindowHiddenCallback=null,t.onExtensionDisconnectedCallback=null,t.onShellAppCallEscalatedCallback=null,t.extension&&(t.extension.disconnect(),t.extension.dispose(),t.extension=null)},this.onExtensionDisconnected=function(e){t.onExtensionDisconnectedCallback=e},this.onShellAppWindowHidden=function(e){t.onShellAppWindowHiddenCallback=e},this.onShellAppCallEscalated=function(e){t.onShellAppCallEscalatedCallback=e},this.extension=r.build(e)}return e.prototype.notifyOnExtensionDisconnected=function(){this.onExtensionDisconnectedCallback&&this.onExtensionDisconnectedCallback()},e.prototype.notifyOnShellAppWindowHidden=function(){this.onShellAppWindowHiddenCallback&&this.onShellAppWindowHiddenCallback()},e.prototype.notifyOnShellAppCallEscalated=function(e){this.onShellAppCallEscalatedCallback&&this.onShellAppCallEscalatedCallback(e)},e.prototype.subscribeToMessagesFromExtension=function(){this.messagingChannel=i.build(this.extension),this.messagingChannel.registerCommandHandler(o.OUT_OF_BROWSER.commands.SHELL_APP_READY_FOR_BOOTSTRAP,this.onShellAppReadyForBootstrap.bind(this)),this.messagingChannel.registerCommandHandler(o.OUT_OF_BROWSER.commands.SHELL_APP_INITIALISED,this.onShellAppInitialised.bind(this)),this.messagingChannel.registerEventHandler(o.OUT_OF_BROWSER.shellAppEvents.WindowHidden,this.notifyOnShellAppWindowHidden.bind(this)),this.messagingChannel.registerCommandHandler(o.OUT_OF_BROWSER.commands.ESCALATE_CONVERSATION,this.notifyOnShellAppCallEscalated.bind(this))},e.prototype.onShellAppInitialised=function(){s.build(this.messagingChannel),this.getMessagingChannelTask.resolve(this.messagingChannel)},e.prototype.onShellAppReadyForBootstrap=function(){this.messagingChannel.sendCommand(o.OUT_OF_BROWSER.commands.BOOTSTRAP,{url:u.settings.shellApp.bootstrapperUrl})},e}();t.ExtensionLifecycleFacade=a,t.build=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/calling/handlers/shell/shellCallingHandler",["require","exports","../../../../../lib/services/outOfBrowser/extensionLifecycleFacade"],e)}(function(e,t){function r(){return Promise.reject(undefined)}function i(){return Promise.reject(undefined)}function s(){return Promise.reject(undefined)}function o(){var e=n.build();return e.getVersion()}function u(){return Promise.reject(undefined)}function a(){return Promise.reject(undefined)}function f(){return Promise.reject(undefined)}function l(e,t){return Promise.resolve(t)}var n=e("../../../../../lib/services/outOfBrowser/extensionLifecycleFacade");t.selectCameraDevice=r,t.selectMicrophoneDevice=i,t.selectSpeakerDevice=s,t.getPluginVersion=o,t.getMonitorList=u,t.setScreenCaptureMonitor=a,t.getMonitorPreview=f,t.getDeviceName=l}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/plugin/pluginCallHandler",["require","exports","jskype-settings-instance","swx-constants","swx-constants","../../../lib/utils/chat/conversation","swx-enums","../../../lib/telemetry/logging/callingLogTracer","jcafe-property-model","./pluginLifecycleFacade","../../../lib/modelHelpers/calling/participantHelper","swx-utils-common","swx-browser-globals"],e)}(function(e,t){function v(){return n.isFeatureOn(r.COMMON.featureFlags.PRELOAD_PLUGIN)?f.initialize():undefined}function m(e){return new d(e)}var n=e("jskype-settings-instance"),r=e("swx-constants"),i=e("swx-constants"),s=e("../../../lib/utils/chat/conversation"),o=e("swx-enums"),u=e("../../../lib/telemetry/logging/callingLogTracer"),a=e("jcafe-property-model"),f=e("./pluginLifecycleFacade"),l=e("../../../lib/modelHelpers/calling/participantHelper"),c=e("swx-utils-common"),h=e("swx-browser-globals"),p=u.get(),d=function(){function e(e){var t=this;this.callEnded=!1,this.wasAcknowledged=!1,this.wasAcceptPromiseFulfilled=!1,this.isAttachingLocalVideo=!1,this.isDetachingLocalVideo=!1,this.localVideoOperationPromise=c.settablePromise.build(),this.isPSTNEnabled=n.isFeatureOn(r.COMMON.featureFlags.PSTN_ENABLED),this.startVideoOnChannel=function(e){t.conversation.selfParticipant.video.channels.added.off(t.startVideoOnChannel),e.isStarted()||(t.startVideoSubscription=e.isStarted.set.enabled.once(!0,function(){e.isStarted.set(!0)}))},this.placeCall=function(e){return t.resetLocalPreviewState(),p.log("[PluginCallHandler] place call",e),f.createPlugin().then(function(n){var r=t.getParticipantIdentities(t.conversation),i=[t.conversation.conversationId];p.log("[PluginCallHandler] placing call, plugin ready"),p.log("[PluginCallHandler] isGroupConversation",t.conversation.isGroupConversation()),p.log("[PluginCallHandler] autoCall",t.conversation.autoCall()),p.log("[PluginCallHandler] activeModalities.audio",t.conversation.activeModalities.audio());if(t.callEnded){p.log("[PluginCallHandler] call was already ended, ignoring");return}t.conversation.isGroupConversation()?t.conversation.autoCall()?t.handleAutoCall(n):t.conversation.activeModalities.audio()?t.joinConversation(n):n.skypeCore.placeCall(i,r,t.getVideoState()):(t.conversation._internalCallTelemetry.setCallDirection("outgoing"),t.conversation._internalCallTelemetry.recordStep("placeCall"),n.skypeCore.placeCall(i,r,t.getVideoState())),e&&t.enableVideoWhenAvailable()})},this.acknowledge=function(){return t.wasAcknowledged=!0,f.createPlugin().then(function(e){p.log("[PluginCallHandler:acknowledge]"),t.conversation._internalCallTelemetry.setCallDirection("incoming"),t.conversation.selfParticipant.audio.state()===o.callConnectionState.Notified?(p.log("[PluginCallHandler:acknowledge] state is Notified, do not pass payload to plugin"),t.conversation._callData.markAllIncomingPayloadsAsProcessed()):t.conversation._callData.pluginRingingForMe()?(p.log("[PluginCallHandler:acknowledge] plugin already ringing, updating state to Notified"),t.conversation._callData.pluginRingingForMe(!1),l.updateParticipantAudioVideoState(t.conversation.selfParticipant,o.callConnectionState.Notified),t.conversation._callData.markAllIncomingPayloadsAsProcessed()):t.conversation.selfParticipant.audio.state()===o.callConnectionState.Disconnected&&(p.log("[PluginCallHandler:acknowledge] processing incoming call"),t.conversation._internalCallTelemetry.recordStep("acknowledge"),t.processIncomingPayloads(e),t.conversation._callData.pluginAwaitCall(!0))})},this.setSoundLevelEventMode=function(e){return new Promise(function(n,r){function i(t){t.skypeCore.setSoundLevelEventMode(e,n,r)}f.createPlugin().then(i,t.getPluginCreationFailureHandler(r))})},this.acceptCall=function(e){var n=function(n){t.conversation._internalCallTelemetry.recordStep("acceptCall"),n.skypeCore.acceptCall(t.getConversationId(),t.getVideoState()),e&&t.enableVideoWhenAvailable()};return t.resetLocalPreviewState(),t.wasAcknowledged?f.createPlugin().then(n):(t.acceptCallPromise=c.settablePromise.build(),f.createPlugin().then(function(e){var r=function(){t.wasAcceptPromiseFulfilled||(n(e),t.acceptCallPromise.resolve(),t.wasAcceptPromiseFulfilled=!0)};t.processIncomingPayloads(e),t.pluginRingingForMeSubscription=t.conversation._callData.pluginRingingForMe.once(!0,r),t.pluginOthersAreLiveSubscription=t.conversation._callData.pluginOthersAreLive.once(!0,r)})["catch"](function(){t.acceptCallPromise.reject(),t.wasAcceptPromiseFulfilled=!0}),t.acceptCallPromise)},this.rejectCall=function(){return t.disposeSubscription(t.joinSubscription),f.createPlugin().then(function(e){t.conversation._internalCallTelemetry.recordStep("rejectCall"),e.skypeCore.rejectCall(t.getConversationId()),t.disconnectAllParticipants(o.callDisconnectionReason.Busy)})["catch"](t.disconnectAllParticipants.bind(t,o.callDisconnectionReason.Busy))},this.extendCall=function(e){return f.createPlugin().then(function(t){t.skypeCore.extendCall(e)})},this.endCall=function(e){t.callEnded=!0,t.disposeSubscription(t.joinSubscription);var n=function(n){t.conversation._internalCallTelemetry.recordStep("concludeCall"),n.skypeCore.concludeCall(),t.disconnectAllParticipants(e)},r=f.createPlugin().then(n)["catch"](t.disconnectAllParticipants.bind(t));return r},this.cancelCall=function(){t.disposeSubscription(t.joinSubscription);var e=a.task();return f.createPlugin().then(function(n){return t.conversation._internalCallTelemetry.recordStep("cancelCall"),n.skypeCore.forgetCall(t.conversation._callData.getFirstPayload().convoCallId,e.resolve.bind(e),e.reject.bind(e)),e.promise})},this.mute=function(){return t.toggleMute(!0)},this.unmute=function(){return t.toggleMute(!1)},this.sendDtmf=function(e){var t=a.task();return f.createPlugin().then(function(n){return n.skypeCore.sendDtmf(e,t.resolve.bind(t)),t.promise})},this.startScreenSharing=function(e){return t.isSelfParticipant(e)?t.startSendingLocalVideo(i.CALLING.PLUGIN_MEDIA_TYPES.SCREEN_SHARING):Promise.resolve(!0)},this.stopScreenSharing=function(e){return t.isSelfParticipant(e)?t.stopSendingLocalVideo(i.CALLING.PLUGIN_MEDIA_TYPES.SCREEN_SHARING):Promise.resolve(!0)},this.attachParticipantVideo=function(e,n,r){return t.isSelfParticipant(e)?t.startSendingLocalVideo(r).then(function(){return t.attachLocalVideo(n)}):t.showParticipantVideo(e,n,r)},this.detachParticipantVideo=function(e,n){return t.isSelfParticipant(e)?t.stopSendingLocalVideo(n).then(function(){return t.detachLocalVideo()}):t.hideParticipantVideo(e,n)},this.requestCallInfo=function(){var e=a.task(),n=t.conversation._callData.oncePluginCallInfoReady(function(){h.getWindow().clearTimeout(r),e.resolve(t.conversation._callData.pluginCallInfo())}),r=h.getWindow().setTimeout(function(){n.dispose(),e.reject("Call info request timeout")},5e3);return f.createPlugin().then(function(t){t.skypeCore.requestCallInfo(null,function(){n.dispose(),h.getWindow().clearTimeout(r),e.reject("Failed to send command to plugin")})}),e.promise},this.transferFrom=function(e){return},this.dispose=function(){t.canToggleMute(!1),t.toggleMuteTask=null,t.disposeSubscription(t.startVideoSubscription),t.disposeSubscription(t.joinSubscription),t.disposeSubscription(t.canMuteSubscription),t.disposeSubscription(t.pluginRingingForMeSubscription),t.disposeSubscription(t.pluginOthersAreLiveSubscription),t.disposeVideoChannelSubscription(),t.callEscalated()||f.dispose(!1),t.acceptCallPromise&&!t.wasAcceptPromiseFulfilled&&t.acceptCallPromise.reject(),t.conversation.mediaConnectionType(o.mediaConnectionType.Unknown)},this.conversation=e,this.canToggleMute=a.property({value:e._callData.pluginRingingForMe()}),this.localVideoOperationPromise.resolve()}return e.prototype.isPluginless=function(){return!1},e.prototype.processIncomingPayloads=function(e){var t=this;this.conversation._callData.getUnprocessedIncomingCallPayloads().forEach(function(n){p.log("[awaitCall] payload: ",n),e.skypeCore.awaitCall(n.evt,t.getConversationId(),n.convoCallId,n.nsp,n.body.gp)})},e.prototype.resetLocalPreviewState=function(){this.isAttachingLocalVideo=!1,this.isDetachingLocalVideo=!1,this.localVideoOperationPromise=c.settablePromise.build(),this.localVideoOperationPromise.resolve()},e.prototype.disconnectAllParticipants=function(e){l.handleParticipantLeavingStateTransition(this.conversation.selfParticipant,e),l.handleRemoteParticipantsLeavingStateTransition(this.conversation.participants())},e.prototype.disposeSubscription=function(e){e&&e.dispose()},e.prototype.handleConversationJoining=function(e){p.log("[PluginCallHandler] handleConversationJoining",this.conversation.activeModalities.audio()),this.conversation.activeModalities.audio()?e.skypeCore.joinCall(this.conversation.conversationId,this.getVideoState(),this.conversation._callHostId,this.conversation._callPayload.AccessToken):(this.updateSelfParticipantAVState(o.callConnectionState.Disconnecting,o.callDisconnectionReason.Terminated),this.updateSelfParticipantAVState(o.callConnectionState.Disconnected,o.callDisconnectionReason.Terminated))},e.prototype.joinConversation=function(e){p.log("[PluginCallHandler] join conversation, pluginOthersAreLive:",this.conversation._callData.pluginOthersAreLive()),this.joinSubscription=this.conversation._callData.pluginOthersAreLive.once(!0,this.handleConversationJoining.bind(this,e))},e.prototype.handleAutoCall=function(e){p.log("[PluginCallHandler] handleAutoCall"),e.skypeCore.goLive(this.conversation.conversationId,this.getVideoState())},e.prototype.enableVideoWhenAvailable=function(){this.conversation.selfParticipant.video.channels.added(this.startVideoOnChannel)},e.prototype.disposeVideoChannelSubscription=function(){this.conversation.selfParticipant.video.channels.added.off(this.startVideoOnChannel)},e.prototype.getVideoState=function(){return this.isPSTNEnabled&&s.isPstnOnlyConversation(this.conversation)?!1:this.conversation.selfParticipant.video.channels(0)?this.conversation.selfParticipant.video.channels(0).isStarted():!1},e.prototype.updateSelfParticipantAVState=function(e,t){this.conversation.selfParticipant.audio.state._set(e,t),this.conversation.selfParticipant.video.state._set(e,t)},e.prototype.pluginSkypeCoreToggleMic=function(e){f.createPlugin().then(function(t){t.skypeCore.muteMicrophone(e)},this.logPluginCreationFailure)},e.prototype.toggleMute=function(e){return this.toggleMuteTask&&this.toggleMuteTask.promise.state()==="pending"?this.toggleMuteTask.promise:(this.toggleMuteTask=a.task(),this.canToggleMute()?this.pluginSkypeCoreToggleMic(e):this.canMuteSubscription=this.canToggleMute.once(!0,this.pluginSkypeCoreToggleMic.bind(this,e)),this.toggleMuteTask.promise)},e.prototype.isSelfParticipant=function(e){return this.conversation.selfParticipant.person.id()===e},e.prototype.updateLocalVideoStreamState=function(e){this.conversation.selfParticipant.video.channels(0).stream.state._set(e)},e.prototype.startSendingLocalVideo=function(e){var t=this;return new Promise(function(n,r){e===i.CALLING.PLUGIN_MEDIA_TYPES.VIDEO&&(t.resetLocalPreviewState(),t.disposeVideoChannelSubscription()),f.createPlugin().then(function(t){t.videoManager.startSendingLocalVideo(e,n)},t.getPluginCreationFailureHandler(r))})},e.prototype.stopSendingLocalVideo=function(e){var t=this;return this.resetLocalPreviewState(),new Promise(function(n,r){if(t.callEscalated()){n(!0);return}var s,u=function(){t.updateLocalVideoStreamState(o.mediaStreamState.Stopped),n(!0)},a=function(){n(!0)};e===i.CALLING.PLUGIN_MEDIA_TYPES.SCREEN_SHARING?s=a:(t.disposeVideoChannelSubscription(),s=u),f.createPlugin().then(function(t){t.videoManager.stopSendingLocalVideo(e,s)},t.getPluginCreationFailureHandler(r))})},e.prototype.attachLocalVideo=function(e){var t=this;return this.isAttachingLocalVideo?this.attachingLocalVideoPromise:(this.attachingLocalVideoPromise=c.settablePromise.build(),this.isAttachingLocalVideo=!0,this.localVideoOperationPromise.then(f.createPlugin).then(function(n){t.localVideoOperationPromise=c.settablePromise.build(),n.videoManager.showLocalPreview(e,t.conversation.conversationId,function(){t.conversation.selfParticipant.audio.state()===o.callConnectionState.Connecting&&t.updateLocalVideoStreamState(o.mediaStreamState.Active),t.isAttachingLocalVideo=!1,t.attachingLocalVideoPromise.resolve(),t.localVideoOperationPromise.resolve()})},function(e){t.isAttachingLocalVideo=!1,t.logPluginCreationFailure(),t.attachingLocalVideoPromise.reject(e)}),this.attachingLocalVideoPromise)},e.prototype.detachLocalVideo=function(){var e=this;return this.isDetachingLocalVideo?this.detachingLocalVideoPromise:(this.detachingLocalVideoPromise=c.settablePromise.build(),this.isDetachingLocalVideo=!0,this.localVideoOperationPromise.then(f.createPlugin).then(function(t){e.localVideoOperationPromise=c.settablePromise.build(),t.videoManager.hideLocalPreview(e.conversation.conversationId,function(){e.isDetachingLocalVideo=!1,e.detachingLocalVideoPromise.resolve(),e.localVideoOperationPromise.resolve()})},function(t){e.isDetachingLocalVideo=!1,e.logPluginCreationFailure(),e.detachingLocalVideoPromise.reject(t)}),this.detachingLocalVideoPromise)},e.prototype.showParticipantVideo=function(e,t,n){var r=this;return new Promise(function(i,s){f.createPlugin().then(function(r){r.videoManager.showParticipant(e,t,n),i()},r.getPluginCreationFailureHandler(s))})},e.prototype.hideParticipantVideo=function(e,t){var n=this;return new Promise(function(r,i){f.createPlugin().then(function(i){i.videoManager.hideParticipant(e,t,n.callEscalated()),r(!0)},n.getPluginCreationFailureHandler(i))})},e.prototype.getConversationId=function(){var e=this.conversation.conversationId;return this.conversation.isGroupConversation()||(e=e.replace(/^\d+:/,"")),e},e.prototype.getParticipantIdentities=function(e){if(!this.isPSTNEnabled)return undefined;var t={};return e.participants().forEach(function(e){var n=e.person.id(),r=e.audio.endpoint();n!==r&&(t[n]=r)}),t},e.prototype.callEscalated=function(){var e=this.conversation.selfParticipant.audio.state;return e.reason===o.callDisconnectionReason.CallEscalated&&(e()===o.callConnectionState.Disconnecting||e()===o.callConnectionState.Disconnected)},e.prototype.logPluginCreationFailure=function(e){this.isDetachingLocalVideo=!1,this.resetLocalPreviewState(),p.log("[PluginCallHandler] Failed to create plugin:",e)},e.prototype.getPluginCreationFailureHandler=function(e){var t=this;return function(n){t.logPluginCreationFailure(n),e&&e(n)}},e}();t.PluginCallHandler=d,t.initialize=v,t.build=m}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("green-id/lib/greenId",["require","exports","swx-browser-globals","reqwest","swx-utils-common","msr-crypto"],e)}(function(e,t){function o(e,t){var n=s.aes.utilities.stringToBytes(e),r=s.aes.sha512.computeHash(n),i=s.aes.utilities.bytesToHexString(r);return u(t.registerUrl,e).then(function(){})["catch"](function(){}),a(e,i,t)}function u(e,t,n){var s={method:"POST",url:i.url.buildUrl(e,n?{location:n}:{}),headers:{"X-Skypetoken":t},crossOrigin:!0};return r.compat(s)}function a(e,t,r){return new Promise(function(s,o){function p(t){c&&t.origin===r.iframeUrl&&(f.removeEventListener("message",p),l=u(r.registerUrl,e,t.data),l.then(s)["catch"](o).always(d))}function d(){h&&(f.clearTimeout(h),h=null),f.removeEventListener("message",p),c&&(a.body.removeChild(c),c=null),l&&(l.abort(),l=null)}var a=n.getDocument(),f=n.getWindow(),l=null,c=null,h=null;h=f.setTimeout(r.timeout,function(){d(),o(new Error("timeout"))}),c=a.createElement("iframe"),c.style.cssText="display: none",a.body.appendChild(c),f.addEventListener("message",p),c.src=i.url.buildUrl(r.iframeUrl,"tags",{session_id:t})})}var n=e("swx-browser-globals"),r=e("reqwest"),i=e("swx-utils-common"),s=e("msr-crypto");t.registerGreenId=o}),define("green-id",["green-id/lib/greenId"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/modelHelpers/calling/fallbackMessageHelper",["require","exports","swx-enums","swx-utils-chat"],e)}(function(e,t){function i(e){a(e,n.activityType.PluginFreeFallbackScreenSharing)}function s(e){a(e,n.activityType.PluginFreeFallbackMicrophoneAccess)}function o(e){a(e,n.activityType.PluginFreeNoVideoCapability)}function u(e){a(e,n.activityType.PluginFreeVideoCompatibility)}function a(e,t){var n=f(t);e.historyService._processRawMessage(n)}function f(e){var t=r.dateTime.getDate();return{id:+t,timestamp:t,isOutgoing:!0,pluginFreeMessageType:e}}var n=e("swx-enums"),r=e("swx-utils-chat");t.sendScreenSharingFallbackMessage=i,t.sendMicrophoneAccessFallbackMessage=s,t.sendNoVideoCapabilityMessage=o,t.sendVideoCompatibilityMessage=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("web-calling/lib/services/pluginlessTelemetry",["require","exports","lodash-compat"],e)}(function(e,t){function i(e){return new r(e)}var n=e("lodash-compat"),r=function(){function e(e){var t=this;this.sendMediaSessionStats=function(e){t.sendEvent("mdsc_conference",e.media.data.metrics,e.signaling),e.media.type==="OrtcMediaStats"?t.sendEvent("mdsc_ortc_reports",e.media.data):e.media.type==="WebRtcMediaStats"&&t.sendEvent("mdsc_webrtc_session",e.media.data)},this.flush=function(){t.telemetryManager.flush()},this.telemetryManager=e.telemetryManager,this.mdscToken=e.mdscToken,this.logger=e.logger.createChild("Telemetry")}return e.prototype.sendEvents=function(e){throw new Error("PluginlessTelemetry.sendEvents(events) not yet implemented!")},e.prototype.sendEvent=function(e){var t=this,n=[];for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i={DataVersion:"3"};n.forEach(function(e){t.flattenAndNormalize(e,i)});try{this.telemetryManager.sendEvent(this.mdscToken,e,i)}catch(s){this.logger.error("failed to send event",e,s)}},e.prototype.flattenAndNormalize=function(e,t,r){var i=this;r=r||"";var s=function(e){return e.replace(/[^a-zA-Z0-9._]/g,"_")},o=function(e){return typeof e=="boolean"?e?"1":"0":e.toString()};n.forOwn(e,function(e,n){var u=s(r+n);if(Array.isArray(e)){var a=e.length>0?e[0].type:0;t[u]=[o(e.map(function(e){return o(e.value)})),a]}else e&&typeof e=="object"?e.__VALUE__?t[u]=[o(e.value),e.type]:i.flattenAndNormalize(e,t,r+n+"_"):t[u]=o(e)})},e}();t.Telemetry=r,t.build=i});var __assign=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("web-calling/lib/services/relayManager",["require","exports","lodash-compat"],e)})(function(e,t){function s(e){return{expires:e.expires,username:e.username,password:e.password,realm:e.realm}}function u(e){return new o(e)}var n=e("lodash-compat"),r='"rtcmedia"',i={Service:{url:"https://trap.skype.com/",tokenUrl:"https://trap.skype.com/tokens",disabled:!1},Relay:{addresses:["13.107.8.2"],tcpPort:443,udpPort:3478,Lync:{addresses:["mr.skype.net"],tcpPort:443,udpPort:3478},Skype:{addresses:["13.107.8.2"],tcpPort:443,udpPort:3478},Turn:{addresses:["104.44.195.106"],tcpPort:443,udpPort:3478,url:"https://world.turn.skype.com/relay"}},Token:{earlyRefreshMinutes:60,earlyRefreshPercentage:50}},o=function(){function e(e){var t=this;this.updateRelaysPromise=null,this.config=n.cloneDeep(i),this.trapTokens={},this.$unit={enforceUpdate:function(){t.updateRelaysPromise=null}},this.queryRelaysAsync=function(e,n){return t.updateRelaysPromise||(t.updateRelaysPromise=t.updateRelaysFromConfigAsync()),t.updateRelaysPromise.then(function(n){return t.fetchTurnRelayAddresses(e,n)}).then(function(t){return t?"turn"===e?t.Turn:n?t.Lync:t.Skype:[]})},this.context=e,this.logger=e.logger.createChild("RM"),this.request=e.request}return e.prototype.initialize=function(){this.updateRelaysPromise||(this.updateRelaysPromise=this.updateRelaysFromConfigAsync())},e.prototype.fetchTurnRelayAddresses=function(e,t){var r=this;if("turn"===e){var i=this.config.Relay.Turn.url;return this.request.get(i).then(function(e){var i=e.response,o=JSON.parse(JSON.stringify(i));return t.Turn[0].addresses=o.relay?[o.relay]:t.Turn[0].addresses,n.assign(t.Turn[0],s(r.getTrapToken(o.realm))),Promise.resolve(t)})["catch"](function(e){return r.logger.error("failed to retreive turn relay addresses",e),Promise.resolve(t)})}return Promise.resolve(t)},e.prototype.updateRelaysFromConfigAsync=function(e){var t=this,n=this.getConfigAsync().then(function(){return t.updateRelaysAsync()}).then(function(e){return t.updateRelaysPromise=n,e})["catch"](function(n){return t.updateRelaysPromise=null,e?t.logger.warn("failed to retrieve relays",n):t.logger.error("failed to retrieve relays",n),null});return n},e.prototype.refreshRelaysFromConfig=function(){this.request.isOnline()?this.updateRelaysFromConfigAsync():(this.updateRelaysPromise=null,this.logger.warn("not refreshing relays due to no network connection"))},e.prototype.updateRelaysAsync=function(){var e=this,t=this.config.Service.tokenUrl;return this.context.tokenProvider().then(function(n){return e.request.get(t,{headers:{"X-Skypetoken":n,"api-version":2}})}).then(function(t){var n=t.response,i=0,o=e.config.Token.earlyRefreshMinutes,u=e.config.Token.earlyRefreshPercentage;e.storeTrapTokens(n),i=Math.max(n.expires-o*60,n.expires*u/100),window.setTimeout(e.refreshRelaysFromConfig.bind(e),1e3*i);var a=s(e.getTrapToken(r)),f=__assign({addresses:e.config.Relay.Skype.addresses,tcpPort:e.config.Relay.Skype.tcpPort,udpPort:e.config.Relay.Skype.udpPort,type:"msturn"},a),l=__assign({addresses:e.config.Relay.Lync.addresses,tcpPort:e.config.Relay.Lync.tcpPort,udpPort:e.config.Relay.Lync.udpPort,type:"msturn"},a),c=__assign({addresses:e.config.Relay.Turn.addresses,tcpPort:e.config.Relay.Turn.tcpPort,udpPort:e.config.Relay.Turn.udpPort,type:"turn"},a),h={Skype:[f],Lync:[l],Turn:[c]};return e.logger.log("relays from trap",h),h})},e.prototype.storeTrapTokens=function(e){if(!e||!e.tokens){this.logger.error("failed to get tokens from trap response");return}var t={};e.tokens.forEach(function(n){t[n.realm]={expires:e.expires,username:n.username,password:n.password,realm:n.realm}}),this.trapTokens=t},e.prototype.getTrapToken=function(e){if(typeof e=="string"){var t=e.replace(/^"|"$/g,""),n='"'+t+'"',r=this.trapTokens[n];if(r)return r}throw new Error("token for relay not found, realm: "+e)},e.prototype.getConfigAsync=function(){var e=this;return this.logger.log("retrieving configuration"),Promise.resolve(this.context.configProvider()).then(function(t){e.logger.log("retrieved configuration:",t),e.config=n.cloneDeep(i),n.merge(e.config,t),e.logger.log("applied configuration:",e.config)})["catch"](function(t){e.logger.warn("failed to retrieve configuration",t)})},e}();t.RelayManager=o,t.build=u}),function(e){if(typeof exports=="object"&&typeof module!="undefined")module.exports=e();else if(typeof define=="function"&&define.amd)define("pako/dist/pako",[],e);else{var t;typeof window!="undefined"?t=window:typeof global!="undefined"?t=global:typeof self!="undefined"?t=self:t=this,t.pako=e()}}(function(){var e,t,n;return function r(e,t,n){function i(o,u){if(!t[o]){if(!e[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=t[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return i(n?n:t)},l,l.exports,r,e,t,n)}return t[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){function g(e){if(!(this instanceof g))return new g(e);this.options=i.assign({level:d,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:v,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==c)throw new Error(o[n]);t.header&&r.deflateSetHeader(this.strm,t.header);if(t.dictionary){var f;typeof t.dictionary=="string"?f=s.string2buf(t.dictionary):a.call(t.dictionary)==="[object ArrayBuffer]"?f=new Uint8Array(t.dictionary):f=t.dictionary,n=r.deflateSetDictionary(this.strm,f);if(n!==c)throw new Error(o[n]);this._dict_set=!0}}function y(e,t){var n=new g(t);n.push(e,!0);if(n.err)throw n.msg||o[n.err];return n.result}function b(e,t){return t=t||{},t.raw=!0,y(e,t)}function w(e,t){return t=t||{},t.gzip=!0,y(e,t)}var r=e("./zlib/deflate"),i=e("./utils/common"),s=e("./utils/strings"),o=e("./zlib/messages"),u=e("./zlib/zstream"),a=Object.prototype.toString,f=0,l=4,c=0,h=1,p=2,d=-1,v=0,m=8;g.prototype.push=function(e,t){var n=this.strm,o=this.options.chunkSize,u,d;if(this.ended)return!1;d=t===~~t?t:t===!0?l:f,typeof e=="string"?n.input=s.string2buf(e):a.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;do{n.avail_out===0&&(n.output=new i.Buf8(o),n.next_out=0,n.avail_out=o),u=r.deflate(n,d);if(u!==h&&u!==c)return this.onEnd(u),this.ended=!0,!1;if(n.avail_out===0||n.avail_in===0&&(d===l||d===p))this.options.to==="string"?this.onData(s.buf2binstring(i.shrinkBuf(n.output,n.next_out))):this.onData(i.shrinkBuf(n.output,n.next_out))}while((n.avail_in>0||n.avail_out===0)&&u!==h);return d===l?(u=r.deflateEnd(this.strm),this.onEnd(u),this.ended=!0,u===c):d===p?(this.onEnd(c),n.avail_out=0,!0):!0},g.prototype.onData=function(e){this.chunks.push(e)},g.prototype.onEnd=function(e){e===c&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=g,n.deflate=y,n.deflateRaw=b,n.gzip=w},{"./utils/common":3,"./utils/strings":4,"./zlib/deflate":8,"./zlib/messages":13,"./zlib/zstream":15}],2:[function(e,t,n){function c(e){if(!(this instanceof c))return new c(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&(!e||!e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15)===0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,t.windowBits);if(n!==o.Z_OK)throw new Error(u[n]);this.header=new f,r.inflateGetHeader(this.strm,this.header)}function h(e,t){var n=new c(t);n.push(e,!0);if(n.err)throw n.msg||u[n.err];return n.result}function p(e,t){return t=t||{},t.raw=!0,h(e,t)}var r=e("./zlib/inflate"),i=e("./utils/common"),s=e("./utils/strings"),o=e("./zlib/constants"),u=e("./zlib/messages"),a=e("./zlib/zstream"),f=e("./zlib/gzheader"),l=Object.prototype.toString;c.prototype.push=function(e,t){var n=this.strm,u=this.options.chunkSize,a=this.options.dictionary,f,c,h,p,d,v,m=!1;if(this.ended)return!1;c=t===~~t?t:t===!0?o.Z_FINISH:o.Z_NO_FLUSH,typeof e=="string"?n.input=s.binstring2buf(e):l.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;do{n.avail_out===0&&(n.output=new i.Buf8(u),n.next_out=0,n.avail_out=u),f=r.inflate(n,o.Z_NO_FLUSH),f===o.Z_NEED_DICT&&a&&(typeof a=="string"?v=s.string2buf(a):l.call(a)==="[object ArrayBuffer]"?v=new Uint8Array(a):v=a,f=r.inflateSetDictionary(this.strm,v)),f===o.Z_BUF_ERROR&&m===!0&&(f=o.Z_OK,m=!1);if(f!==o.Z_STREAM_END&&f!==o.Z_OK)return this.onEnd(f),this.ended=!0,!1;n.next_out&&(n.avail_out===0||f===o.Z_STREAM_END||n.avail_in===0&&(c===o.Z_FINISH||c===o.Z_SYNC_FLUSH))&&(this.options.to==="string"?(h=s.utf8border(n.output,n.next_out),p=n.next_out-h,d=s.buf2string(n.output,h),n.next_out=p,n.avail_out=u-p,p&&i.arraySet(n.output,n.output,h,p,0),this.onData(d)):this.onData(i.shrinkBuf(n.output,n.next_out))),n.avail_in===0&&n.avail_out===0&&(m=!0)}while((n.avail_in>0||n.avail_out===0)&&f!==o.Z_STREAM_END);return f===o.Z_STREAM_END&&(c=o.Z_FINISH),c===o.Z_FINISH?(f=r.inflateEnd(this.strm),this.onEnd(f),this.ended=!0,f===o.Z_OK):c===o.Z_SYNC_FLUSH?(this.onEnd(o.Z_OK),n.avail_out=0,!0):!0},c.prototype.onData=function(e){this.chunks.push(e)},c.prototype.onEnd=function(e){e===o.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=c,n.inflate=h,n.inflateRaw=p,n.ungzip=h},{"./utils/common":3,"./utils/strings":4,"./zlib/constants":6,"./zlib/gzheader":9,"./zlib/inflate":11,"./zlib/messages":13,"./zlib/zstream":15}],3:[function(e,t,n){var r=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";n.assign=function(e){var t=Array.prototype.slice.call(arguments,1);while(t.length){var n=t.shift();if(!n)continue;if(typeof n!="object")throw new TypeError(n+"must be non-object");for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray){e.set(t.subarray(n,n+r),i);return}for(var s=0;s<r;s++)e[i+s]=t[n+s]},flattenChunks:function(e){var t,n,r,i,s,o;r=0;for(t=0,n=e.length;t<n;t++)r+=e[t].length;o=new Uint8Array(r),i=0;for(t=0,n=e.length;t<n;t++)s=e[t],o.set(s,i),i+=s.length;return o}},s={arraySet:function(e,t,n,r,i){for(var s=0;s<r;s++)e[i+s]=t[n+s]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,i)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,s))},n.setTyped(r)},{}],4:[function(e,t,n){function f(e,t){if(t<65537)if(e.subarray&&s||!e.subarray&&i)return String.fromCharCode.apply(null,r.shrinkBuf(e,t));var n="";for(var o=0;o<t;o++)n+=String.fromCharCode(e[o]);return n}var r=e("./common"),i=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(o){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(o){s=!1}var u=new r.Buf8(256);for(var a=0;a<256;a++)u[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;u[254]=u[254]=1,n.string2buf=function(e){var t,n,i,s,o,u=e.length,a=0;for(s=0;s<u;s++)n=e.charCodeAt(s),(n&64512)===55296&&s+1<u&&(i=e.charCodeAt(s+1),(i&64512)===56320&&(n=65536+(n-55296<<10)+(i-56320),s++)),a+=n<128?1:n<2048?2:n<65536?3:4;t=new r.Buf8(a);for(o=0,s=0;o<a;s++)n=e.charCodeAt(s),(n&64512)===55296&&s+1<u&&(i=e.charCodeAt(s+1),(i&64512)===56320&&(n=65536+(n-55296<<10)+(i-56320),s++)),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|n&63):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|n&63):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|n&63);return t},n.buf2binstring=function(e){return f(e,e.length)},n.binstring2buf=function(e){var t=new r.Buf8(e.length);for(var n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,r,i,s,o=t||e.length,a=new Array(o*2);for(r=0,n=0;n<o;){i=e[n++];if(i<128){a[r++]=i;continue}s=u[i];if(s>4){a[r++]=65533,n+=s-1;continue}i&=s===2?31:s===3?15:7;while(s>1&&n<o)i=i<<6|e[n++]&63,s--;if(s>1){a[r++]=65533;continue}i<65536?a[r++]=i:(i-=65536,a[r++]=55296|i>>10&1023,a[r++]=56320|i&1023)}return f(a,r)},n.utf8border=function(e,t){var n;t=t||e.length,t>e.length&&(t=e.length),n=t-1;while(n>=0&&(e[n]&192)===128)n--;return n<0?t:n===0?t:n+u[e[n]]>t?n:t}},{"./common":3}],5:[function(e,t,n){function r(e,t,n,r){var i=e&65535|0,s=e>>>16&65535|0,o=0;while(n!==0){o=n>2e3?2e3:n,n-=o;do i=i+t[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0}t.exports=r},{}],6:[function(e,t,n){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],7:[function(e,t,n){function r(){var e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=e&1?3988292384^e>>>1:e>>>1;t[n]=e}return t}function s(e,t,n,r){var s=i,o=r+n;e^=-1;for(var u=r;u<o;u++)e=e>>>8^s[(e^t[u])&255];return e^-1}var i=r();t.exports=s},{}],8:[function(e,t,n){function Y(e,t){return e.msg=u[t],t}function Z(e){return(e<<1)-(e>4?9:0)}function et(e){var t=e.length;while(--t>=0)e[t]=0}function tt(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out);if(n===0)return;r.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0)}function nt(e,t){i._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,tt(e.strm)}function rt(e,t){e.pending_buf[e.pending++]=t}function it(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255}function st(e,t,n,i){var u=e.avail_in;return u>i&&(u=i),u===0?0:(e.avail_in-=u,r.arraySet(t,e.input,e.next_in,u,n),e.state.wrap===1?e.adler=s(e.adler,t,u,n):e.state.wrap===2&&(e.adler=o(e.adler,t,u,n)),e.next_in+=u,e.total_in+=u,u)}function ot(e,t){var n=e.max_chain_length,r=e.strstart,i,s,o=e.prev_length,u=e.nice_match,a=e.strstart>e.w_size-F?e.strstart-(e.w_size-F):0,f=e.window,l=e.w_mask,c=e.prev,h=e.strstart+j,p=f[r+o-1],d=f[r+o];e.prev_length>=e.good_match&&(n>>=2),u>e.lookahead&&(u=e.lookahead);do{i=t;if(f[i+o]!==d||f[i+o-1]!==p||f[i]!==f[r]||f[++i]!==f[r+1])continue;r+=2,i++;do;while(f[++r]===f[++i]&&f[++r]===f[++i]&&f[++r]===f[++i]&&f[++r]===f[++i]&&f[++r]===f[++i]&&f[++r]===f[++i]&&f[++r]===f[++i]&&f[++r]===f[++i]&&r<h);s=j-(h-r),r=h-j;if(s>o){e.match_start=t,o=s;if(s>=u)break;p=f[r+o-1],d=f[r+o]}}while((t=c[t&l])>a&&--n!==0);return o<=e.lookahead?o:e.lookahead}function ut(e){var t=e.w_size,n,i,s,o,u;do{o=e.window_size-e.lookahead-e.strstart;if(e.strstart>=t+(t-F)){r.arraySet(e.window,e.window,t,t,0),e.match_start-=t,e.strstart-=t,e.block_start-=t,i=e.hash_size,n=i;do s=e.head[--n],e.head[n]=s>=t?s-t:0;while(--i);i=t,n=i;do s=e.prev[--n],e.prev[n]=s>=t?s-t:0;while(--i);o+=t}if(e.strm.avail_in===0)break;i=st(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=i;if(e.lookahead+e.insert>=B){u=e.strstart-e.insert,e.ins_h=e.window[u],e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+1])&e.hash_mask;while(e.insert){e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+B-1])&e.hash_mask,e.prev[u&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=u,u++,e.insert--;if(e.lookahead+e.insert<B)break}}}while(e.lookahead<F&&e.strm.avail_in!==0)}function at(e,t){var n=65535;n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);for(;;){if(e.lookahead<=1){ut(e);if(e.lookahead===0&&t===a)return $;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if(e.strstart===0||e.strstart>=r){e.lookahead=e.strstart-r,e.strstart=r,nt(e,!1);if(e.strm.avail_out===0)return $}if(e.strstart-e.block_start>=e.w_size-F){nt(e,!1);if(e.strm.avail_out===0)return $}}e.insert=0;if(t===c)return nt(e,!0),e.strm.avail_out===0?K:Q;if(e.strstart>e.block_start){nt(e,!1);if(e.strm.avail_out===0)return $}return $}function ft(e,t){var n,r;for(;;){if(e.lookahead<F){ut(e);if(e.lookahead<F&&t===a)return $;if(e.lookahead===0)break}n=0,e.lookahead>=B&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+B-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-F&&(e.match_length=ot(e,n));if(e.match_length>=B){r=i._tr_tally(e,e.strstart-e.match_start,e.match_length-B),e.lookahead-=e.match_length;if(e.match_length<=e.max_lazy_match&&e.lookahead>=B){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+B-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask}else r=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r){nt(e,!1);if(e.strm.avail_out===0)return $}}e.insert=e.strstart<B-1?e.strstart:B-1;if(t===c)return nt(e,!0),e.strm.avail_out===0?K:Q;if(e.last_lit){nt(e,!1);if(e.strm.avail_out===0)return $}return J}function lt(e,t){var n,r,s;for(;;){if(e.lookahead<F){ut(e);if(e.lookahead<F&&t===a)return $;if(e.lookahead===0)break}n=0,e.lookahead>=B&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+B-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=B-1,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-F&&(e.match_length=ot(e,n),e.match_length<=5&&(e.strategy===b||e.match_length===B&&e.strstart-e.match_start>4096)&&(e.match_length=B-1));if(e.prev_length>=B&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-B,r=i._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-B),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+B-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);e.match_available=0,e.match_length=B-1,e.strstart++;if(r){nt(e,!1);if(e.strm.avail_out===0)return $}}else if(e.match_available){r=i._tr_tally(e,0,e.window[e.strstart-1]),r&&nt(e,!1),e.strstart++,e.lookahead--;if(e.strm.avail_out===0)return $}else e.match_available=1,e.strstart++,e.lookahead--}e.match_available&&(r=i._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<B-1?e.strstart:B-1;if(t===c)return nt(e,!0),e.strm.avail_out===0?K:Q;if(e.last_lit){nt(e,!1);if(e.strm.avail_out===0)return $}return J}function ct(e,t){var n,r,s,o,u=e.window;for(;;){if(e.lookahead<=j){ut(e);if(e.lookahead<=j&&t===a)return $;if(e.lookahead===0)break}e.match_length=0;if(e.lookahead>=B&&e.strstart>0){s=e.strstart-1,r=u[s];if(r===u[++s]&&r===u[++s]&&r===u[++s]){o=e.strstart+j;do;while(r===u[++s]&&r===u[++s]&&r===u[++s]&&r===u[++s]&&r===u[++s]&&r===u[++s]&&r===u[++s]&&r===u[++s]&&s<o);e.match_length=j-(o-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}}e.match_length>=B?(n=i._tr_tally(e,1,e.match_length-B),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++);if(n){nt(e,!1);if(e.strm.avail_out===0)return $}}e.insert=0;if(t===c)return nt(e,!0),e.strm.avail_out===0?K:Q;if(e.last_lit){nt(e,!1);if(e.strm.avail_out===0)return $}return J}function ht(e,t){var n;for(;;){if(e.lookahead===0){ut(e);if(e.lookahead===0){if(t===a)return $;break}}e.match_length=0,n=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n){nt(e,!1);if(e.strm.avail_out===0)return $}}e.insert=0;if(t===c)return nt(e,!0),e.strm.avail_out===0?K:Q;if(e.last_lit){nt(e,!1);if(e.strm.avail_out===0)return $}return J}function pt(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function vt(e){e.window_size=2*e.w_size,et(e.head),e.max_lazy_match=dt[e.level].max_lazy,e.good_match=dt[e.level].good_length,e.nice_match=dt[e.level].nice_length,e.max_chain_length=dt[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=B-1,e.match_available=0,e.ins_h=0}function mt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=N,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(P*2),this.dyn_dtree=new r.Buf16((2*_+1)*2),this.bl_tree=new r.Buf16((2*D+1)*2),et(this.dyn_ltree),et(this.dyn_dtree),et(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(H+1),this.heap=new r.Buf16(2*M+1),et(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*M+1),et(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function gt(e){var t;return!e||!e.state?Y(e,v):(e.total_in=e.total_out=0,e.data_type=T,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?q:X,e.adler=t.wrap===2?0:1,t.last_flush=a,i._tr_init(t),p)}function yt(e){var t=gt(e);return t===p&&vt(e.state),t}function bt(e,t){return!e||!e.state?v:e.state.wrap!==2?v:(e.state.gzhead=t,p)}function wt(e,t,n,i,s,o){if(!e)return v;var u=1;t===y&&(t=6),i<0?(u=0,i=-i):i>15&&(u=2,i-=16);if(s<1||s>C||n!==N||i<8||i>15||t<0||t>9||o<0||o>S)return Y(e,v);i===8&&(i=9);var a=new mt;return e.state=a,a.strm=e,a.wrap=u,a.gzhead=null,a.w_bits=i,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=s+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+B-1)/B),a.window=new r.Buf8(a.w_size*2),a.head=new r.Buf16(a.hash_size),a.prev=new r.Buf16(a.w_size),a.lit_bufsize=1<<s+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new r.Buf8(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=t,a.strategy=o,a.method=n,yt(e)}function Et(e,t){return wt(e,t,N,k,L,x)}function St(e,t){var n,r,s,u;if(!e||!e.state||t>h||t<0)return e?Y(e,v):v;r=e.state;if(!e.output||!e.input&&e.avail_in!==0||r.status===V&&t!==c)return Y(e,e.avail_out===0?g:v);r.strm=e,n=r.last_flush,r.last_flush=t;if(r.status===q)if(r.wrap===2)e.adler=0,rt(r,31),rt(r,139),rt(r,8),r.gzhead?(rt(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),rt(r,r.gzhead.time&255),rt(r,r.gzhead.time>>8&255),rt(r,r.gzhead.time>>16&255),rt(r,r.gzhead.time>>24&255),rt(r,r.level===9?2:r.strategy>=w||r.level<2?4:0),rt(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(rt(r,r.gzhead.extra.length&255),rt(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=o(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=R):(rt(r,0),rt(r,0),rt(r,0),rt(r,0),rt(r,0),rt(r,r.level===9?2:r.strategy>=w||r.level<2?4:0),rt(r,G),r.status=X);else{var m=N+(r.w_bits-8<<4)<<8,y=-1;r.strategy>=w||r.level<2?y=0:r.level<6?y=1:r.level===6?y=2:y=3,m|=y<<6,r.strstart!==0&&(m|=I),m+=31-m%31,r.status=X,it(r,m),r.strstart!==0&&(it(r,e.adler>>>16),it(r,e.adler&65535)),e.adler=1}if(r.status===R)if(r.gzhead.extra){s=r.pending;while(r.gzindex<(r.gzhead.extra.length&65535)){if(r.pending===r.pending_buf_size){r.gzhead.hcrc&&r.pending>s&&(e.adler=o(e.adler,r.pending_buf,r.pending-s,s)),tt(e),s=r.pending;if(r.pending===r.pending_buf_size)break}rt(r,r.gzhead.extra[r.gzindex]&255),r.gzindex++}r.gzhead.hcrc&&r.pending>s&&(e.adler=o(e.adler,r.pending_buf,r.pending-s,s)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=U)}else r.status=U;if(r.status===U)if(r.gzhead.name){s=r.pending;do{if(r.pending===r.pending_buf_size){r.gzhead.hcrc&&r.pending>s&&(e.adler=o(e.adler,r.pending_buf,r.pending-s,s)),tt(e),s=r.pending;if(r.pending===r.pending_buf_size){u=1;break}}r.gzindex<r.gzhead.name.length?u=r.gzhead.name.charCodeAt(r.gzindex++)&255:u=0,rt(r,u)}while(u!==0);r.gzhead.hcrc&&r.pending>s&&(e.adler=o(e.adler,r.pending_buf,r.pending-s,s)),u===0&&(r.gzindex=0,r.status=z)}else r.status=z;if(r.status===z)if(r.gzhead.comment){s=r.pending;do{if(r.pending===r.pending_buf_size){r.gzhead.hcrc&&r.pending>s&&(e.adler=o(e.adler,r.pending_buf,r.pending-s,s)),tt(e),s=r.pending;if(r.pending===r.pending_buf_size){u=1;break}}r.gzindex<r.gzhead.comment.length?u=r.gzhead.comment.charCodeAt(r.gzindex++)&255:u=0,rt(r,u)}while(u!==0);r.gzhead.hcrc&&r.pending>s&&(e.adler=o(e.adler,r.pending_buf,r.pending-s,s)),u===0&&(r.status=W)}else r.status=W;r.status===W&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&tt(e),r.pending+2<=r.pending_buf_size&&(rt(r,e.adler&255),rt(r,e.adler>>8&255),e.adler=0,r.status=X)):r.status=X);if(r.pending!==0){tt(e);if(e.avail_out===0)return r.last_flush=-1,p}else if(e.avail_in===0&&Z(t)<=Z(n)&&t!==c)return Y(e,g);if(r.status===V&&e.avail_in!==0)return Y(e,g);if(e.avail_in!==0||r.lookahead!==0||t!==a&&r.status!==V){var b=r.strategy===w?ht(r,t):r.strategy===E?ct(r,t):dt[r.level].func(r,t);if(b===K||b===Q)r.status=V;if(b===$||b===K)return e.avail_out===0&&(r.last_flush=-1),p;if(b===J){t===f?i._tr_align(r):t!==h&&(i._tr_stored_block(r,0,0,!1),t===l&&(et(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),tt(e);if(e.avail_out===0)return r.last_flush=-1,p}}return t!==c?p:r.wrap<=0?d:(r.wrap===2?(rt(r,e.adler&255),rt(r,e.adler>>8&255),rt(r,e.adler>>16&255),rt(r,e.adler>>24&255),rt(r,e.total_in&255),rt(r,e.total_in>>8&255),rt(r,e.total_in>>16&255),rt(r,e.total_in>>24&255)):(it(r,e.adler>>>16),it(r,e.adler&65535)),tt(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?p:d)}function xt(e){var t;return!e||!e.state?v:(t=e.state.status,t!==q&&t!==R&&t!==U&&t!==z&&t!==W&&t!==X&&t!==V?Y(e,v):(e.state=null,t===X?Y(e,m):p))}function Tt(e,t){var n=t.length,i,o,u,a,f,l,c,h;if(!e||!e.state)return v;i=e.state,a=i.wrap;if(a===2||a===1&&i.status!==q||i.lookahead)return v;a===1&&(e.adler=s(e.adler,t,n,0)),i.wrap=0,n>=i.w_size&&(a===0&&(et(i.head),i.strstart=0,i.block_start=0,i.insert=0),h=new r.Buf8(i.w_size),r.arraySet(h,t,n-i.w_size,i.w_size,0),t=h,n=i.w_size),f=e.avail_in,l=e.next_in,c=e.input,e.avail_in=n,e.next_in=0,e.input=t,ut(i);while(i.lookahead>=B){o=i.strstart,u=i.lookahead-(B-1);do i.ins_h=(i.ins_h<<i.hash_shift^i.window[o+B-1])&i.hash_mask,i.prev[o&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=o,o++;while(--u);i.strstart=o,i.lookahead=B-1,ut(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=B-1,i.match_available=0,e.next_in=l,e.input=c,e.avail_in=f,i.wrap=a,p}var r=e("../utils/common"),i=e("./trees"),s=e("./adler32"),o=e("./crc32"),u=e("./messages"),a=0,f=1,l=3,c=4,h=5,p=0,d=1,v=-2,m=-3,g=-5,y=-1,b=1,w=2,E=3,S=4,x=0,T=2,N=8,C=9,k=15,L=8,A=29,O=256,M=O+1+A,_=30,D=19,P=2*M+1,H=15,B=3,j=258,F=j+B+1,I=32,q=42,R=69,U=73,z=91,W=103,X=113,V=666,$=1,J=2,K=3,Q=4,G=3,dt;dt=[new pt(0,0,0,0,at),new pt(4,4,8,4,ft),new pt(4,5,16,8,ft),new pt(4,6,32,32,ft),new pt(4,4,16,16,lt),new pt(8,16,32,32,lt),new pt(8,16,128,128,lt),new pt(8,32,128,256,lt),new pt(32,128,258,1024,lt),new pt(32,258,258,4096,lt)],n.deflateInit=Et,n.deflateInit2=wt,n.deflateReset=yt,n.deflateResetKeep=gt,n.deflateSetHeader=bt,n.deflate=St,n.deflateEnd=xt,n.deflateSetDictionary=Tt,n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./messages":13,"./trees":14}],9:[function(e,t,n){function r(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=r},{}],10:[function(e,t,n){var r=30,i=12;t.exports=function(t,n){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A;s=t.state,o=t.next_in,L=t.input,u=o+(t.avail_in-5),a=t.next_out,A=t.output,f=a-(n-t.avail_out),l=a+(t.avail_out-257),c=s.dmax,h=s.wsize,p=s.whave,d=s.wnext,v=s.window,m=s.hold,g=s.bits,y=s.lencode,b=s.distcode,w=(1<<s.lenbits)-1,E=(1<<s.distbits)-1;e:do{g<15&&(m+=L[o++]<<g,g+=8,m+=L[o++]<<g,g+=8),S=y[m&w];t:for(;;){x=S>>>24,m>>>=x,g-=x,x=S>>>16&255;if(x===0)A[a++]=S&65535;else{if(!(x&16)){if((x&64)===0){S=y[(S&65535)+(m&(1<<x)-1)];continue t}if(x&32){s.mode=i;break e}t.msg="invalid literal/length code",s.mode=r;break e}T=S&65535,x&=15,x&&(g<x&&(m+=L[o++]<<g,g+=8),T+=m&(1<<x)-1,m>>>=x,g-=x),g<15&&(m+=L[o++]<<g,g+=8,m+=L[o++]<<g,g+=8),S=b[m&E];n:for(;;){x=S>>>24,m>>>=x,g-=x,x=S>>>16&255;if(!(x&16)){if((x&64)===0){S=b[(S&65535)+(m&(1<<x)-1)];continue n}t.msg="invalid distance code",s.mode=r;break e}N=S&65535,x&=15,g<x&&(m+=L[o++]<<g,g+=8,g<x&&(m+=L[o++]<<g,g+=8)),N+=m&(1<<x)-1;if(N>c){t.msg="invalid distance too far back",s.mode=r;break e}m>>>=x,g-=x,x=a-f;if(N>x){x=N-x;if(x>p&&s.sane){t.msg="invalid distance too far back",s.mode=r;break e}C=0,k=v;if(d===0){C+=h-x;if(x<T){T-=x;do A[a++]=v[C++];while(--x);C=a-N,k=A}}else if(d<x){C+=h+d-x,x-=d;if(x<T){T-=x;do A[a++]=v[C++];while(--x);C=0;if(d<T){x=d,T-=x;do A[a++]=v[C++];while(--x);C=a-N,k=A}}}else{C+=d-x;if(x<T){T-=x;do A[a++]=v[C++];while(--x);C=a-N,k=A}}while(T>2)A[a++]=k[C++],A[a++]=k[C++],A[a++]=k[C++],T-=3;T&&(A[a++]=k[C++],T>1&&(A[a++]=k[C++]))}else{C=a-N;do A[a++]=A[C++],A[a++]=A[C++],A[a++]=A[C++],T-=3;while(T>2);T&&(A[a++]=A[C++],T>1&&(A[a++]=A[C++]))}break}}break}}while(o<u&&a<l);T=g>>3,o-=T,g-=T<<3,m&=(1<<g)-1,t.next_in=o,t.next_out=a,t.avail_in=o<u?5+(u-o):5-(o-u),t.avail_out=a<l?257+(l-a):257-(a-l),s.hold=m,s.bits=g;return}},{}],11:[function(e,t,n){function it(e){return(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24)}function st(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ot(e){var t;return!e||!e.state?g:(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=S,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(et),t.distcode=t.distdyn=new r.Buf32(tt),t.sane=1,t.back=-1,d)}function ut(e){var t;return!e||!e.state?g:(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,ot(e))}function at(e,t){var n,r;return!e||!e.state?g:(r=e.state,t<0?(n=0,t=-t):(n=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15)?g:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,ut(e)))}function ft(e,t){var n,r;return e?(r=new st,e.state=r,r.window=null,n=at(e,t),n!==d&&(e.state=null),n):g}function lt(e){return ft(e,rt)}function dt(e){if(ct){var t;ht=new r.Buf32(512),pt=new r.Buf32(32),t=0;while(t<144)e.lens[t++]=8;while(t<256)e.lens[t++]=9;while(t<280)e.lens[t++]=7;while(t<288)e.lens[t++]=8;u(f,e.lens,0,288,ht,0,e.work,{bits:9}),t=0;while(t<32)e.lens[t++]=5;u(l,e.lens,0,32,pt,0,e.work,{bits:5}),ct=!1}e.lencode=ht,e.lenbits=9,e.distcode=pt,e.distbits=5}function vt(e,t,n,i){var s,o=e.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new r.Buf8(o.wsize)),i>=o.wsize?(r.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(s=o.wsize-o.wnext,s>i&&(s=i),r.arraySet(o.window,t,n-i,s,o.wnext),i-=s,i?(r.arraySet(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0}function mt(e,t){var n,et,tt,nt,rt,st,ot,ut,at,ft,lt,ct,ht,pt,mt=0,gt,yt,bt,wt,Et,St,xt,Tt,Nt=new r.Buf8(4),Ct,kt,Lt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0)return g;n=e.state,n.mode===D&&(n.mode=P),rt=e.next_out,tt=e.output,ot=e.avail_out,nt=e.next_in,et=e.input,st=e.avail_in,ut=n.hold,at=n.bits,ft=st,lt=ot,Tt=d;e:for(;;)switch(n.mode){case S:if(n.wrap===0){n.mode=P;break}while(at<16){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}if(n.wrap&2&&ut===35615){n.check=0,Nt[0]=ut&255,Nt[1]=ut>>>8&255,n.check=s(n.check,Nt,2,0),ut=0,at=0,n.mode=x;break}n.flags=0,n.head&&(n.head.done=!1);if(!(n.wrap&1)||(((ut&255)<<8)+(ut>>8))%31){e.msg="incorrect header check",n.mode=G;break}if((ut&15)!==E){e.msg="unknown compression method",n.mode=G;break}ut>>>=4,at-=4,xt=(ut&15)+8;if(n.wbits===0)n.wbits=xt;else if(xt>n.wbits){e.msg="invalid window size",n.mode=G;break}n.dmax=1<<xt,e.adler=n.check=1,n.mode=ut&512?M:D,ut=0,at=0;break;case x:while(at<16){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.flags=ut;if((n.flags&255)!==E){e.msg="unknown compression method",n.mode=G;break}if(n.flags&57344){e.msg="unknown header flags set",n.mode=G;break}n.head&&(n.head.text=ut>>8&1),n.flags&512&&(Nt[0]=ut&255,Nt[1]=ut>>>8&255,n.check=s(n.check,Nt,2,0)),ut=0,at=0,n.mode=T;case T:while(at<32){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.head&&(n.head.time=ut),n.flags&512&&(Nt[0]=ut&255,Nt[1]=ut>>>8&255,Nt[2]=ut>>>16&255,Nt[3]=ut>>>24&255,n.check=s(n.check,Nt,4,0)),ut=0,at=0,n.mode=N;case N:while(at<16){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.head&&(n.head.xflags=ut&255,n.head.os=ut>>8),n.flags&512&&(Nt[0]=ut&255,Nt[1]=ut>>>8&255,n.check=s(n.check,Nt,2,0)),ut=0,at=0,n.mode=C;case C:if(n.flags&1024){while(at<16){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.length=ut,n.head&&(n.head.extra_len=ut),n.flags&512&&(Nt[0]=ut&255,Nt[1]=ut>>>8&255,n.check=s(n.check,Nt,2,0)),ut=0,at=0}else n.head&&(n.head.extra=null);n.mode=k;case k:if(n.flags&1024){ct=n.length,ct>st&&(ct=st),ct&&(n.head&&(xt=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,et,nt,ct,xt)),n.flags&512&&(n.check=s(n.check,et,ct,nt)),st-=ct,nt+=ct,n.length-=ct);if(n.length)break e}n.length=0,n.mode=L;case L:if(n.flags&2048){if(st===0)break e;ct=0;do xt=et[nt+ct++],n.head&&xt&&n.length<65536&&(n.head.name+=String.fromCharCode(xt));while(xt&&ct<st);n.flags&512&&(n.check=s(n.check,et,ct,nt)),st-=ct,nt+=ct;if(xt)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=A;case A:if(n.flags&4096){if(st===0)break e;ct=0;do xt=et[nt+ct++],n.head&&xt&&n.length<65536&&(n.head.comment+=String.fromCharCode(xt));while(xt&&ct<st);n.flags&512&&(n.check=s(n.check,et,ct,nt)),st-=ct,nt+=ct;if(xt)break e}else n.head&&(n.head.comment=null);n.mode=O;case O:if(n.flags&512){while(at<16){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}if(ut!==(n.check&65535)){e.msg="header crc mismatch",n.mode=G;break}ut=0,at=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=D;break;case M:while(at<32){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}e.adler=n.check=it(ut),ut=0,at=0,n.mode=_;case _:if(n.havedict===0)return e.next_out=rt,e.avail_out=ot,e.next_in=nt,e.avail_in=st,n.hold=ut,n.bits=at,m;e.adler=n.check=1,n.mode=D;case D:if(t===h||t===p)break e;case P:if(n.last){ut>>>=at&7,at-=at&7,n.mode=J;break}while(at<3){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.last=ut&1,ut>>>=1,at-=1;switch(ut&3){case 0:n.mode=H;break;case 1:dt(n),n.mode=R;if(t===p){ut>>>=2,at-=2;break e}break;case 2:n.mode=F;break;case 3:e.msg="invalid block type",n.mode=G}ut>>>=2,at-=2;break;case H:ut>>>=at&7,at-=at&7;while(at<32){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}if((ut&65535)!==(ut>>>16^65535)){e.msg="invalid stored block lengths",n.mode=G;break}n.length=ut&65535,ut=0,at=0,n.mode=B;if(t===p)break e;case B:n.mode=j;case j:ct=n.length;if(ct){ct>st&&(ct=st),ct>ot&&(ct=ot);if(ct===0)break e;r.arraySet(tt,et,nt,ct,rt),st-=ct,nt+=ct,ot-=ct,rt+=ct,n.length-=ct;break}n.mode=D;break;case F:while(at<14){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.nlen=(ut&31)+257,ut>>>=5,at-=5,n.ndist=(ut&31)+1,ut>>>=5,at-=5,n.ncode=(ut&15)+4,ut>>>=4,at-=4;if(n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=G;break}n.have=0,n.mode=I;case I:while(n.have<n.ncode){while(at<3){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.lens[Lt[n.have++]]=ut&7,ut>>>=3,at-=3}while(n.have<19)n.lens[Lt[n.have++]]=0;n.lencode=n.lendyn,n.lenbits=7,Ct={bits:n.lenbits},Tt=u(a,n.lens,0,19,n.lencode,0,n.work,Ct),n.lenbits=Ct.bits;if(Tt){e.msg="invalid code lengths set",n.mode=G;break}n.have=0,n.mode=q;case q:while(n.have<n.nlen+n.ndist){for(;;){mt=n.lencode[ut&(1<<n.lenbits)-1],gt=mt>>>24,yt=mt>>>16&255,bt=mt&65535;if(gt<=at)break;if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}if(bt<16)ut>>>=gt,at-=gt,n.lens[n.have++]=bt;else{if(bt===16){kt=gt+2;while(at<kt){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}ut>>>=gt,at-=gt;if(n.have===0){e.msg="invalid bit length repeat",n.mode=G;break}xt=n.lens[n.have-1],ct=3+(ut&3),ut>>>=2,at-=2}else if(bt===17){kt=gt+3;while(at<kt){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}ut>>>=gt,at-=gt,xt=0,ct=3+(ut&7),ut>>>=3,at-=3}else{kt=gt+7;while(at<kt){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}ut>>>=gt,at-=gt,xt=0,ct=11+(ut&127),ut>>>=7,at-=7}if(n.have+ct>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=G;break}while(ct--)n.lens[n.have++]=xt}}if(n.mode===G)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=G;break}n.lenbits=9,Ct={bits:n.lenbits},Tt=u(f,n.lens,0,n.nlen,n.lencode,0,n.work,Ct),n.lenbits=Ct.bits;if(Tt){e.msg="invalid literal/lengths set",n.mode=G;break}n.distbits=6,n.distcode=n.distdyn,Ct={bits:n.distbits},Tt=u(l,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Ct),n.distbits=Ct.bits;if(Tt){e.msg="invalid distances set",n.mode=G;break}n.mode=R;if(t===p)break e;case R:n.mode=U;case U:if(st>=6&&ot>=258){e.next_out=rt,e.avail_out=ot,e.next_in=nt,e.avail_in=st,n.hold=ut,n.bits=at,o(e,lt),rt=e.next_out,tt=e.output,ot=e.avail_out,nt=e.next_in,et=e.input,st=e.avail_in,ut=n.hold,at=n.bits,n.mode===D&&(n.back=-1);break}n.back=0;for(;;){mt=n.lencode[ut&(1<<n.lenbits)-1],gt=mt>>>24,yt=mt>>>16&255,bt=mt&65535;if(gt<=at)break;if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}if(yt&&(yt&240)===0){wt=gt,Et=yt,St=bt;for(;;){mt=n.lencode[St+((ut&(1<<wt+Et)-1)>>wt)],gt=mt>>>24,yt=mt>>>16&255,bt=mt&65535;if(wt+gt<=at)break;if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}ut>>>=wt,at-=wt,n.back+=wt}ut>>>=gt,at-=gt,n.back+=gt,n.length=bt;if(yt===0){n.mode=$;break}if(yt&32){n.back=-1,n.mode=D;break}if(yt&64){e.msg="invalid literal/length code",n.mode=G;break}n.extra=yt&15,n.mode=z;case z:if(n.extra){kt=n.extra;while(at<kt){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.length+=ut&(1<<n.extra)-1,ut>>>=n.extra,at-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=W;case W:for(;;){mt=n.distcode[ut&(1<<n.distbits)-1],gt=mt>>>24,yt=mt>>>16&255,bt=mt&65535;if(gt<=at)break;if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}if((yt&240)===0){wt=gt,Et=yt,St=bt;for(;;){mt=n.distcode[St+((ut&(1<<wt+Et)-1)>>wt)],gt=mt>>>24,yt=mt>>>16&255,bt=mt&65535;if(wt+gt<=at)break;if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}ut>>>=wt,at-=wt,n.back+=wt}ut>>>=gt,at-=gt,n.back+=gt;if(yt&64){e.msg="invalid distance code",n.mode=G;break}n.offset=bt,n.extra=yt&15,n.mode=X;case X:if(n.extra){kt=n.extra;while(at<kt){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.offset+=ut&(1<<n.extra)-1,ut>>>=n.extra,at-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=G;break}n.mode=V;case V:if(ot===0)break e;ct=lt-ot;if(n.offset>ct){ct=n.offset-ct;if(ct>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=G;break}ct>n.wnext?(ct-=n.wnext,ht=n.wsize-ct):ht=n.wnext-ct,ct>n.length&&(ct=n.length),pt=n.window}else pt=tt,ht=rt-n.offset,ct=n.length;ct>ot&&(ct=ot),ot-=ct,n.length-=ct;do tt[rt++]=pt[ht++];while(--ct);n.length===0&&(n.mode=U);break;case $:if(ot===0)break e;tt[rt++]=n.length,ot--,n.mode=U;break;case J:if(n.wrap){while(at<32){if(st===0)break e;st--,ut|=et[nt++]<<at,at+=8}lt-=ot,e.total_out+=lt,n.total+=lt,lt&&(e.adler=n.check=n.flags?s(n.check,tt,lt,rt-lt):i(n.check,tt,lt,rt-lt)),lt=ot;if((n.flags?ut:it(ut))!==n.check){e.msg="incorrect data check",n.mode=G;break}ut=0,at=0}n.mode=K;case K:if(n.wrap&&n.flags){while(at<32){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}if(ut!==(n.total&4294967295)){e.msg="incorrect length check",n.mode=G;break}ut=0,at=0}n.mode=Q;case Q:Tt=v;break e;case G:Tt=y;break e;case Y:return b;case Z:default:return g}e.next_out=rt,e.avail_out=ot,e.next_in=nt,e.avail_in=st,n.hold=ut,n.bits=at;if(n.wsize||lt!==e.avail_out&&n.mode<G&&(n.mode<J||t!==c))if(vt(e,e.output,e.next_out,lt-e.avail_out))return n.mode=Y,b;return ft-=e.avail_in,lt-=e.avail_out,e.total_in+=ft,e.total_out+=lt,n.total+=lt,n.wrap&&lt&&(e.adler=n.check=n.flags?s(n.check,tt,lt,e.next_out-lt):i(n.check,tt,lt,e.next_out-lt)),e.data_type=n.bits+(n.last?64:0)+(n.mode===D?128:0)+(n.mode===R||n.mode===B?256:0),(ft===0&&lt===0||t===c)&&Tt===d&&(Tt=w),Tt}function gt(e){if(!e||!e.state)return g;var t=e.state;return t.window&&(t.window=null),e.state=null,d}function yt(e,t){var n;return!e||!e.state?g:(n=e.state,(n.wrap&2)===0?g:(n.head=t,t.done=!1,d))}function bt(e,t){var n=t.length,r,s,o;if(!e||!e.state)return g;r=e.state;if(r.wrap!==0&&r.mode!==_)return g;if(r.mode===_){s=1,s=i(s,t,n,0);if(s!==r.check)return y}return o=vt(e,t,n,n),o?(r.mode=Y,b):(r.havedict=1,d)}var r=e("../utils/common"),i=e("./adler32"),s=e("./crc32"),o=e("./inffast"),u=e("./inftrees"),a=0,f=1,l=2,c=4,h=5,p=6,d=0,v=1,m=2,g=-2,y=-3,b=-4,w=-5,E=8,S=1,x=2,T=3,N=4,C=5,k=6,L=7,A=8,O=9,M=10,_=11,D=12,P=13,H=14,B=15,j=16,F=17,I=18,q=19,R=20,U=21,z=22,W=23,X=24,V=25,$=26,J=27,K=28,Q=29,G=30,Y=31,Z=32,et=852,tt=592,nt=15,rt=nt,ct=!0,ht,pt;n.inflateReset=ut,n.inflateReset2=at,n.inflateResetKeep=ot,n.inflateInit=lt,n.inflateInit2=ft,n.inflate=mt,n.inflateEnd=gt,n.inflateGetHeader=yt,n.inflateSetDictionary=bt,n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./inffast":10,"./inftrees":12}],12:[function(e,t,n){var r=e("../utils/common"),i=15,s=852,o=592,u=0,a=1,f=2,l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],c=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],p=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(t,n,d,v,m,g,y,b){var w=b.bits,E=0,S=0,x=0,T=0,N=0,C=0,k=0,L=0,A=0,O=0,M,_,D,P,H,B=null,j=0,F,I=new r.Buf16(i+1),q=new r.Buf16(i+1),R=null,U=0,z,W,X;for(E=0;E<=i;E++)I[E]=0;for(S=0;S<v;S++)I[n[d+S]]++;N=w;for(T=i;T>=1;T--)if(I[T]!==0)break;N>T&&(N=T);if(T===0)return m[g++]=20971520,m[g++]=20971520,b.bits=1,0;for(x=1;x<T;x++)if(I[x]!==0)break;N<x&&(N=x),L=1;for(E=1;E<=i;E++){L<<=1,L-=I[E];if(L<0)return-1}if(L>0&&(t===u||T!==1))return-1;q[1]=0;for(E=1;E<i;E++)q[E+1]=q[E]+I[E];for(S=0;S<v;S++)n[d+S]!==0&&(y[q[n[d+S]]++]=S);t===u?(B=R=y,F=19):t===a?(B=l,j-=257,R=c,U-=257,F=256):(B=h,R=p,F=-1),O=0,S=0,E=x,H=g,C=N,k=0,D=-1,A=1<<N,P=A-1;if(t===a&&A>s||t===f&&A>o)return 1;for(;;){z=E-k,y[S]<F?(W=0,X=y[S]):y[S]>F?(W=R[U+y[S]],X=B[j+y[S]]):(W=96,X=0),M=1<<E-k,_=1<<C,x=_;do _-=M,m[H+(O>>k)+_]=z<<24|W<<16|X|0;while(_!==0);M=1<<E-1;while(O&M)M>>=1;M!==0?(O&=M-1,O+=M):O=0,S++;if(--I[E]===0){if(E===T)break;E=n[d+y[S]]}if(E>N&&(O&P)!==D){k===0&&(k=N),H+=x,C=E-k,L=1<<C;while(C+k<T){L-=I[C+k];if(L<=0)break;C++,L<<=1}A+=1<<C;if(t===a&&A>s||t===f&&A>o)return 1;D=O&P,m[D]=N<<24|C<<16|H-g|0}}return O!==0&&(m[H+O]=E-k<<24|64<<16|0),b.bits=N,0}},{"../utils/common":3}],13:[function(e,t,n){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],14:[function(e,t,n){function a(e){var t=e.length;while(--t>=0)e[t]=0}function F(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function U(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function z(e){return e<256?P[e]:P[256+(e>>>7)]}function W(e,t){e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255}function X(e,t,n){e.bi_valid>E-n?(e.bi_buf|=t<<e.bi_valid&65535,W(e,e.bi_buf),e.bi_buf=t>>E-e.bi_valid,e.bi_valid+=n-E):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function V(e,t,n){X(e,n[t*2],n[t*2+1])}function $(e,t){var n=0;do n|=e&1,e>>>=1,n<<=1;while(--t>0);return n>>>1}function J(e){e.bi_valid===16?(W(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)}function K(e,t){var n=t.dyn_tree,r=t.max_code,i=t.stat_desc.static_tree,s=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,u=t.stat_desc.extra_base,a=t.stat_desc.max_length,f,l,c,h,p,d,v=0;for(h=0;h<=w;h++)e.bl_count[h]=0;n[e.heap[e.heap_max]*2+1]=0;for(f=e.heap_max+1;f<b;f++){l=e.heap[f],h=n[n[l*2+1]*2+1]+1,h>a&&(h=a,v++),n[l*2+1]=h;if(l>r)continue;e.bl_count[h]++,p=0,l>=u&&(p=o[l-u]),d=n[l*2],e.opt_len+=d*(h+p),s&&(e.static_len+=d*(i[l*2+1]+p))}if(v===0)return;do{h=a-1;while(e.bl_count[h]===0)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[a]--,v-=2}while(v>0);for(h=a;h!==0;h--){l=e.bl_count[h];while(l!==0){c=e.heap[--f];if(c>r)continue;n[c*2+1]!==h&&(e.opt_len+=(h-n[c*2+1])*n[c*2],n[c*2+1]=h),l--}}}function Q(e,t,n){var r=new Array(w+1),i=0,s,o;for(s=1;s<=w;s++)r[s]=i=i+n[s-1]<<1;for(o=0;o<=t;o++){var u=e[o*2+1];if(u===0)continue;e[o*2]=$(r[u]++,u)}}function G(){var e,t,n,r,i,s=new Array(w+1);n=0;for(r=0;r<d-1;r++){B[r]=n;for(e=0;e<1<<k[r];e++)H[n++]=r}H[n-1]=r,i=0;for(r=0;r<16;r++){j[r]=i;for(e=0;e<1<<L[r];e++)P[i++]=r}i>>=7;for(;r<g;r++){j[r]=i<<7;for(e=0;e<1<<L[r]-7;e++)P[256+i++]=r}for(t=0;t<=w;t++)s[t]=0;e=0;while(e<=143)_[e*2+1]=8,e++,s[8]++;while(e<=255)_[e*2+1]=9,e++,s[9]++;while(e<=279)_[e*2+1]=7,e++,s[7]++;while(e<=287)_[e*2+1]=8,e++,s[8]++;Q(_,m+1,s);for(e=0;e<g;e++)D[e*2+1]=5,D[e*2]=$(e,5);I=new F(_,k,v+1,m,w),q=new F(D,L,0,g,w),R=new F(new Array(0),A,0,y,S)}function Y(e){var t;for(t=0;t<m;t++)e.dyn_ltree[t*2]=0;for(t=0;t<g;t++)e.dyn_dtree[t*2]=0;for(t=0;t<y;t++)e.bl_tree[t*2]=0;e.dyn_ltree[x*2]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Z(e){e.bi_valid>8?W(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function et(e,t,n,i){Z(e),i&&(W(e,n),W(e,~n)),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}function tt(e,t,n,r){var i=t*2,s=n*2;return e[i]<e[s]||e[i]===e[s]&&r[t]<=r[n]}function nt(e,t,n){var r=e.heap[n],i=n<<1;while(i<=e.heap_len){i<e.heap_len&&tt(t,e.heap[i+1],e.heap[i],e.depth)&&i++;if(tt(t,r,e.heap[i],e.depth))break;e.heap[n]=e.heap[i],n=i,i<<=1}e.heap[n]=r}function rt(e,t,n){var r,i,s=0,o,u;if(e.last_lit!==0)do r=e.pending_buf[e.d_buf+s*2]<<8|e.pending_buf[e.d_buf+s*2+1],i=e.pending_buf[e.l_buf+s],s++,r===0?V(e,i,t):(o=H[i],V(e,o+v+1,t),u=k[o],u!==0&&(i-=B[o],X(e,i,u)),r--,o=z(r),V(e,o,n),u=L[o],u!==0&&(r-=j[o],X(e,r,u)));while(s<e.last_lit);V(e,x,t)}function it(e,t){var n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,s=t.stat_desc.elems,o,u,a=-1,f;e.heap_len=0,e.heap_max=b;for(o=0;o<s;o++)n[o*2]!==0?(e.heap[++e.heap_len]=a=o,e.depth[o]=0):n[o*2+1]=0;while(e.heap_len<2)f=e.heap[++e.heap_len]=a<2?++a:0,n[f*2]=1,e.depth[f]=0,e.opt_len--,i&&(e.static_len-=r[f*2+1]);t.max_code=a;for(o=e.heap_len>>1;o>=1;o--)nt(e,n,o);f=s;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],nt(e,n,1),u=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=u,n[f*2]=n[o*2]+n[u*2],e.depth[f]=(e.depth[o]>=e.depth[u]?e.depth[o]:e.depth[u])+1,n[o*2+1]=n[u*2+1]=f,e.heap[1]=f++,nt(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],K(e,t),Q(n,a,e.bl_count)}function st(e,t,n){var r,i=-1,s,o=t[1],u=0,a=7,f=4;o===0&&(a=138,f=3),t[(n+1)*2+1]=65535;for(r=0;r<=n;r++){s=o,o=t[(r+1)*2+1];if(++u<a&&s===o)continue;u<f?e.bl_tree[s*2]+=u:s!==0?(s!==i&&e.bl_tree[s*2]++,e.bl_tree[T*2]++):u<=10?e.bl_tree[N*2]++:e.bl_tree[C*2]++,u=0,i=s,o===0?(a=138,f=3):s===o?(a=6,f=3):(a=7,f=4)}}function ot(e,t,n){var r,i=-1,s,o=t[1],u=0,a=7,f=4;o===0&&(a=138,f=3);for(r=0;r<=n;r++){s=o,o=t[(r+1)*2+1];if(++u<a&&s===o)continue;if(u<f){do V(e,s,e.bl_tree);while(--u!==0)}else s!==0?(s!==i&&(V(e,s,e.bl_tree),u--),V(e,T,e.bl_tree),X(e,u-3,2)):u<=10?(V(e,N,e.bl_tree),X(e,u-3,3)):(V(e,C,e.bl_tree),X(e,u-11,7));u=0,i=s,o===0?(a=138,f=3):s===o?(a=6,f=3):(a=7,f=4)}}function ut(e){var t;st(e,e.dyn_ltree,e.l_desc.max_code),st(e,e.dyn_dtree,e.d_desc.max_code),it(e,e.bl_desc);for(t=y-1;t>=3;t--)if(e.bl_tree[O[t]*2+1]!==0)break;return e.opt_len+=3*(t+1)+5+5+4,t}function at(e,t,n,r){var i;X(e,t-257,5),X(e,n-1,5),X(e,r-4,4);for(i=0;i<r;i++)X(e,e.bl_tree[O[i]*2+1],3);ot(e,e.dyn_ltree,t-1),ot(e,e.dyn_dtree,n-1)}function ft(e){var t=4093624447,n;for(n=0;n<=31;n++,t>>>=1)if(t&1&&e.dyn_ltree[n*2]!==0)return s;if(e.dyn_ltree[18]!==0||e.dyn_ltree[20]!==0||e.dyn_ltree[26]!==0)return o;for(n=32;n<v;n++)if(e.dyn_ltree[n*2]!==0)return o;return s}function ct(e){lt||(G(),lt=!0),e.l_desc=new U(e.dyn_ltree,I),e.d_desc=new U(e.dyn_dtree,q),e.bl_desc=new U(e.bl_tree,R),e.bi_buf=0,e.bi_valid=0,Y(e)}function ht(e,t,n,r){X(e,(f<<1)+(r?1:0),3),et(e,t,n,!0)}function pt(e){X(e,l<<1,3),V(e,x,_),J(e)}function dt(e,t,n,r){var s,o,a=0;e.level>0?(e.strm.data_type===u&&(e.strm.data_type=ft(e)),it(e,e.l_desc),it(e,e.d_desc),a=ut(e),s=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=s&&(s=o)):s=o=n+5,n+4<=s&&t!==-1?ht(e,t,n,r):e.strategy===i||o===s?(X(e,(l<<1)+(r?1:0),3),rt(e,_,D)):(X(e,(c<<1)+(r?1:0),3),at(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),rt(e,e.dyn_ltree,e.dyn_dtree)),Y(e),r&&Z(e)}function vt(e,t,n){return e.pending_buf[e.d_buf+e.last_lit*2]=t>>>8&255,e.pending_buf[e.d_buf+e.last_lit*2+1]=t&255,e.pending_buf[e.l_buf+e.last_lit]=n&255,e.last_lit++,t===0?e.dyn_ltree[n*2]++:(e.matches++,t--,e.dyn_ltree[(H[n]+v+1)*2]++,e.dyn_dtree[z(t)*2]++),e.last_lit===e.lit_bufsize-1}var r=e("../utils/common"),i=4,s=0,o=1,u=2,f=0,l=1,c=2,h=3,p=258,d=29,v=256,m=v+1+d,g=30,y=19,b=2*m+1,w=15,E=16,S=7,x=256,T=16,N=17,C=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],L=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],M=512,_=new Array((m+2)*2);a(_);var D=new Array(g*2);a(D);var P=new Array(M);a(P);var H=new Array(p-h+1);a(H);var B=new Array(d);a(B);var j=new Array(g);a(j);var I,q,R,lt=!1;n._tr_init=ct,n._tr_stored_block=ht,n._tr_flush_block=dt,n._tr_tally=vt,n._tr_align=pt},{"../utils/common":3}],15:[function(e,t,n){function r(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=r},{}],"/":[function(e,t,n){var r=e("./lib/utils/common").assign,i=e("./lib/deflate"),s=e("./lib/inflate"),o=e("./lib/zlib/constants"),u={};r(u,i,s,o),t.exports=u},{"./lib/deflate":1,"./lib/inflate":2,"./lib/utils/common":3,"./lib/zlib/constants":6}]},{},[])("/")}),define("pako",["pako/dist/pako"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/utilities/constants",["require","exports"],e)}(function(e,t){var n={INCOMING_MESSAGE_ORIGIN:{TROUTER:"Trouter",BROKER:"Broker"},KNOWN_PAYLOAD_ENCODINGS:{GZIP:!0},WEBRTC_NOTIFICATION_TYPE:{CONTROL_VIDEO_STREAMING:"ControlVideoStreaming",DOMINANT_SPEAKER_INFO:"DominantSpeakerInfo",CSRC_INFO:"CsrcInfo"},PARTICIPANT_AUDIO_STATE:{CONNECTING:"Connecting",CONNECTED:"Connected",OTHER:"Other"},HEADERS:{MESSAGE_ID:"X-Microsoft-Skype-Message-ID",ORIGINAL_MESSAGE_ID:"X-Microsoft-Skype-Original-Message-ID",CONTENT_ENCODING:"X-Microsoft-Skype-Content-Encoding",CORRELATION_ID:"X-Microsoft-Skype-Chain-ID",CONTENT_SHARING_CORRELATION_ID:"X-Microsoft-Skype-ContentSharing-Chain-ID",CLIENT_USER_AGENT:"X-Microsoft-Skype-Client",SKYPE_TOKEN:"X-Skypetoken",BROKER_USE_BATCHING_HEADER_NAME:"X-UseBatching",CONTENT_TYPE:"Content-Type"},KNOWN_BOTS:{VOICEMAIL_BOT_ID:"28:14524421-25b4-403a-a0f7-e62d4379cabc"},HTTP_STATUS_CODES:{OK:200,CREATED:201,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,FORBIDDEN:403,PRECONDITION_FAILED:412,UNPROCESSABLE_ENTITY:422,INTERNAL_SERVER_ERROR:500,CONFLICT:409},CALL_END_SKYPE_TOKEN_ERROR:{code:495,subCode:4507,phrase:"CallEndReasonSkypeTokenFetchError"},CALL_END_LOCAL_HTTP_STACK_ERROR:{code:496,subCode:4520,phrase:"LocalHTTPStackError"},CALL_END_NETWORK_ERROR:{code:490,subCode:4502,phrase:"CallEndReasonNetworkError"},CALL_END_LOCAL_DECLINE:{code:486,subCode:4508,phrase:"LocalDecline"},RESOURCE_NOT_FOUND_ERROR:{code:404,subCode:404,phrase:"ResourceNotFound"},CALL_STATUS:{IDLE:"Idle",RINGING:"Ringing",CONNECTING:"Connecting",CONNECTED:"Connected",CONNECTED_FOR_ROSTER_ONLY:"ConnectedForRosterOnly",LOCAL_TERMINATED:"LocalTerminated",REMOTE_TERMINATED:"RemoteTerminated"},MEDIA_TYPES:{AUDIO:"Audio",VIDEO:"Video",SCREEN_SHARER:"ScreenSharer",SCREEN_VIEWER:"ScreenViewer"},MUTE_SCOPE:{MYSELF:"Myself",EVERYONE_ELSE:"EveryoneElse",SPECIFIED_PARTICIPANTS:"SpecifiedParticipants"},URL_BASE:{CALLAGENT:"callAgent"},URL_PATH:{MEDIA_ACKNOWLEDGEMENT:"/call/mediaAcknowledgement/",MEDIA_REJECTION:"/call/rejection/",ACKNOWLEDGEMENT:"/call/acknowledgement/",MEDIA_RENEGOTIATION:"/call/mediaRenegotiation/",REPLACE:"/call/replacement/",PROGRESS:"/call/progress/",MEDIA_ANSWER:"/call/mediaAnswer/",REDIRECTION:"/call/redirection/",BALANCE_UPDATE:"/call/balanceUpdate/",ACCEPT:"/call/acceptance/",CONTROL_VIDEO_STREAMING:"/call/controlVideoStreaming/",DOMINANT_SPEAKER_INFO:"/call/dominantSpeakerInfo/",CSRC_INFO:"/call/csrcInfo/",END:"/call/end/",RETARGET_COMPLETION:"/call/retargetCompletion/",TRANSFER:"/call/transfer/",TRANSFER_ACCEPTANCE:"/call/transferAcceptance/",TRANSFER_COMPLETION:"/call/transferCompletion/",CONV_END:"/conversation/end/",CONV_UPDATE:"/conversation/update/",CONV_ROSTER_UPDATE:"/conversation/rosterUpdate/",CONV_ADD_PARTICIPANT_SUCCESS:"/conversation/addParticipantSuccess/",CONV_ADD_PARTICIPANT_FAILURE:"/conversation/addParticipantFailure/",CONV_ADMIT_PARTICIPANT_SUCCESS:"/conversation/admitParticipantSuccess/",CONV_ADMIT_PARTICIPANT_FAILURE:"/conversation/admitParticipantFailure/",CONV_REMOVE_PARTICIPANT_SUCCESS:"/conversation/removeParticipantSuccess/",CONV_REMOVE_PARTICIPANT_FAILURE:"/conversation/removeParticipantFailure/",CONV_ADD_MODALITY_SUCCESS:"/conversation/addModalitySuccess/",CONV_ADD_MODALITY_FAILURE:"/conversation/addModalityFailure/",CONV_CONTENT_SHARING_UPDATE:"/conversation/contentSharingUpdate/",CONV_CONTENT_SHARING_END:"/conversation/contentSharingEnd/",CONV_LIGHT_WEIGHT_MEETING_UPDATE:"/conversation/lightWeightMeetingUpdate/",CONV_LIGHT_WEIGHT_MEETING_END:"/conversation/lightWeightMeetingEnd/",CONV_BROADCAST_UPDATE:"/conversation/broadcastUpdate/",CONV_CONFIRM_UNMUTE:"/conversation/confirmUnmute/",CONV_UNMUTE_SUCCESS:"/conversation/unmuteSuccess/",CONV_UNMUTE_FAILURE:"/conversation/unmuteFailure/"},PAYLOAD_PROPERTY:{CALL_NOTIFICATION:"callNotification",MEDIA_ANSWER:"mediaAnswer",MEDIA_ACKNOWLEDGEMENT:"mediaAcknowledgement",CALL_ACCEPTANCE:"callAcceptance",CALL_END:"callEnd",CALL_PROGRESS:"callProgress",CALL_ACCEPTANCE_ACKNOWLEDGEMENT:"callAcceptanceAcknowledgement",MEDIA_NEGOTIATION:"mediaNegotiation",MEDIA_NEGOTIATION_FAILURE:"mediaNegotiationFailure",BALANCE_UPDATE:"balanceUpdate",RETARGET_COMPLETED:"retargetCompleted",CALL_TRANSFER:"callTransfer",TRANSFER_COMPLETION:"transferCompletion",TRANSFER_ACCEPTANCE:"transferAcceptance"},LINKS:{HANGUP:"hangup",MEDIA_REJECTION:"mediaRejection",MEDIA_ANSWER:"mediaAnswer",MEDIA_RENEGOTIATION:"mediaRenegotiation",ACCEPT:"accept",ATTACH:"attach",REJECT:"reject",REDIRECT:"redirect",REPLACE:"replace",TRANSFER:"transfer",TRANSFER_ACCEPTANCE:"transferAcceptance",TRANSFER_COMPLETION:"transferCompletion",CONVERSATION_CONTROLLER:"conversationController",ADD_PARTICIPANT:"addParticipant",ADD_PARTICIPANT_AND_MODALITY:"addParticipantAndModality",LEAVE:"leave",NOTIFICATION_LINKS:"notificationLinks",REMOVE_PARTICIPANT:"removeParticipant",KEEPALIVE:"keepAlive",ADD_MODALITY:"AddModality",REMOVE_MODALITY:"RemoveModality",CONTENT_SHARING_CONTROLLER:"contentSharingController",CONTENT_SHARING_TAKE_CONTROL:"contentSharingTakeControl",CONTENT_SHARING_UPDATE_SESSION_STATE:"contentSharingUpdateSessionState",CONTENT_SHARING_UPDATE_PARTICIPANT_STATE:"contentSharingUpdateParticipantState",CONTENT_SHARING_NOTIFICATION_LINKS:"contentSharingNotificationLinks",CONTENT_SHARING_LEAVE:"contentSharingLeave",LIGHT_WEIGHT_MEETING_CONTROLLER:"lightWeightMeetingController",MUTE:"mute",UNMUTE:"unmute",ADMIT:"admit",CONTROL_VIDEO_STREAMING:"controlVideoStreaming",UPDATE_ENDPOINT_STATE:"updateEndpointState"},CONTENT_TYPE:{JSON:"application/json",SDP:"application/sdp"},TROUTER_EVENT_TYPE:{SKYPE_SKYPE_CALL:107,LYNC_SKYPE_CALL:105},MISC:{CONVERSATION:"conversation",LOBBY_CALL_CONTROLLER:"lobby"},SIGNALING_FSM_STATE:{IDLE:"Idle",INCOMING:"Incoming",WAITING_CALL_ACCEPTANCE_ACK:"WaitingCallAcceptanceAck",OUTGOING:"Outgoing",CONNECTED:"Connected",OUTGOING_FOR_ROSTER_ONLY:"OutgoingForRosterOnly",CONNECTED_FOR_ROSTER_ONLY:"ConnectedForRosterOnly"},MEDIA_RENEGOTIATION_FSM_STATE:{IDLE:"Idle",CALL_CONNECTED:"Connected",INCOMING_RENEGOTIATION:"IncomingRenegotiation",OUTGOING_RENEGOTIATION:"OutgoingRenegotiation",RENEGOTIATION_GLARE:"RenegotiationGlare"},CONTENT_SHARING_FSM_STATE:{IDLE:"Idle",CONTENT_SHARING_START_INITIATED:"ContentSharingStartInitiated",CONTENT_SHARING_JOIN_INITIATED:"ContentSharingJoinInitiated",CONTENT_SHARING_LEAVE_INITIATED:"ContentSharingLeaveInitiated",CONTENT_SHARING_DELETE_INITIATED:"ContentSharingDeleteInitiated",CONTENT_SHARING_CONNECTED:"ContentSharingConnected"},LIGHT_WEIGHT_MEETING_FSM_STATE:{IDLE:"Idle",LIGHT_WEIGHT_MEETING_JOIN_INITIATED:"LightWeightMeetingJoinInitiated",LIGHT_WEIGHT_MEETING_CONNECTING:"LightWeightMeetingConnecting",LIGHT_WEIGHT_MEETING_CONNECTED:"LightWeightMeetingConnected"},TIMEOUT_OPERATIONS:{ADD_PARTICIPANT:"AddParticipant",REMOVE_PARTICIPANT:"RemoveParticipant",ADMIT_PARTICIPANT:"AdmitParticipant",CALL_ME_BACK:"CallMeBack",INCOMING_CALL_ESTABLISHMENT:"IncomingCallEstablishment",OUTGOING_CALL_ESTABLISHMENT:"OutgoingCallEstablishment",MEDIA_ANSWER:"MediaAnswer",MEDIA_ANSWER_ACKNOWLEDGEMENT:"MediaAnswerAcknowledgement",ADD_MODALITY:"AddModality",UNMUTE:"Unmute",LIGHT_WEIGHT_MEETING_JOIN:"LightWeightMeetingJoin"},TIMEOUT_VALUES_IN_SECONDS:{ADD_PARTICIPANT_TIMEOUT:130,REMOVE_PARTICIPANT_TIMEOUT:60,INCOMING_CALL_ESTABLISHMENT_TIMEOUT:75,OUTGOING_CALL_ESTABLISHMENT_TIMEOUT:90,MEDIA_ANSWER_TIMEOUT:35,MEDIA_ANSWER_ACKNOWLEDGEMENT_TIMEOUT:15,ADD_MODALITY_TIMEOUT:65,UNMUTE_TIMEOUT:35,LIGHT_WEIGHT_MEETING_JOIN_TIMEOUT:45,ADMIT_PARTICIPANT_TIMEOUT:30},CALL_END_CODE:{REJECT:603,SUCCESS:0,CANCEL:487,TIMEOUT:408,SERVICE_UNAVAILABLE:500,BAD_REQUEST:406,NO_NGC_ENDPOINT:480,P2P_FALLBACK_FOR_SCREENSHARING:460,CONFLICT:409,MEDIA_ERROR:410,CALL_DOES_NOT_EXIST:481,CALL_ACCEPTED:450,CALL_FORWARDED:451,CALL_FORWARDED_TO_VOICEMAIL:452,P2P_REJECT_CALL:453,P2P_FALLBACK_DUE_TO_GROUPCALL:461,CALL_LEG_ENDED_ON_SERVICE:470,NOT_ACCEPTABLE_HERE:488,NETWORK_ERROR:490,UNKNOWN_ERROR:497,LOCAL_ERROR:498,CALL_MODALITY_FAILURE:580,ATC_CONTROLLER_FAILURE:581,GLARE_ERROR:491,NOT_FOUND:404,SKYPE_TOKEN_ERROR:495,LOCAL_HTTP_STACK_ERROR:496,DECODING_FAILED:407},CALL_END_SUB_CODE:{SUCCESS:0,CALL_NOT_ATTEMPTED:4500,CONV_URL_NOT_SET:4501,FAILED_TO_REACH_SERVICE:4502,PLACE_CALL_FAILED:4503,ATTACH_CALL_FAILED:4504,BAD_NOTIFICATION_PAYLOAD:4505,CALL_ESTABLISHMENT_TIMEOUT:4506,SKYPE_TOKEN_ERROR:4507,CONVERSATION_RESOLUTION_CONFLICT:5704,CALL_PARTICIPANT_REMOVAL_TIMEOUT:4507,UNMUTE_REQUEST_TIMEOUT:4509,UNMUTE_REQUEST_REJECTED:4510,CONFLICT_IN_NG:4090,CONFLICT_WITH_P2P:4091,CONVERSATION_END_RECEIVED_FROM_SERVICE:4100,TRANSFER_COMPLETE_TIMEOUT:4101,ATTACH_TO_NON_EXISTENT_CALL:4102,ATTACH_ACTION_FAILED:4103,ATTACH_FAILED:4105,CONVERSATION_ESTABLISHMENT_FAILED:4106,BEFORE_CONNECT:4107,AFTER_CONNECT:4108,AFTER_ACCEPT:4109,TROUTER_CONNECTION_DROPPED:4111,DUE_TO_CALL_ASSIMILATION:4112,GLARE_ERROR:10029,CONVERSATION_ENDED_NO_NEW_OWNER_FOUND:5014,UNABLE_TO_GENERATE_MEETUP_ID:5015,CALL_ENDED_BY_PLATFORM_AGENT:7e3,LOCAL_HTTP_STACK_ERROR:4520,BEACON:4521,MEDIA_DROP_DURING_CONNECT:3100,MEDIA_DROP_AFTER_CONNECT:3101,MEDIA_ANSWER_PROCESSING_ERROR:3102,MEDIA_FINAL_ANSWER_PROCESSING_ERROR:3103,MEDIA_OFFER_TIMEOUT:3104,MEDIA_FINAL_ANSWER_TIMEOUT:3105,MEDIA_OFFER_NULL:3106,MEDIA_AUDIO_DEVICE_ERROR:3107,MEDIA_RENEGOTIATION_ERROR:3108,MEDIA_PERMISSION_ERROR:3109,MEDIA_UNKNOWN_ERROR:3110,LIGHTWEIGHTMEETING_JOIN_FAILED:3200,LIGHTWEIGHTMEETING_JOIN_TIMEOUT:3201,LIGHTWEIGHTMEETING_START_CALL_FAILED:3202},CALL_END_PHRASE:{UNKNOWN:"CallEndReasonUnknown",MEDIA_ERROR:"CallEndReasonMediaError",MEDIA_OFFER_TIMEOUT:"CallEndReasonMediaOfferTimeout",MEDIA_FINAL_ANSWER_TIMEOUT:"CallEndReasonMediaFinalAnswerTimeout",MEDIA_ANSWER_ERROR:"CallEndReasonMediaAnswerError",MEDIA_FINAL_ANSWER_ERROR:"CallEndReasonFinalAnswerError",MEDIA_PERMISSION_ERROR:"CallEndReasonMediaPermissionError",MEDIA_RENEGOTIATION_ERROR:"CallEndReasonRenegotiationError",MEDIA_DROP_DURING_CONNECT:"CallEndReasonMediaDropDuringConnectError",MEDIA_DROP_AFTER_CONNECT:"CallEndReasonMediaDropAfterConnectError",AUDIO_ERROR:"CallEndReasonAudioDeviceError",BAD_NOTIFICATION_PAYLOAD:"BadCallNotificationPayload",NETWORK_ERROR:"CallEndReasonNetworkError",LOCAL_USER_INITIATED:"CallEndReasonLocalUserInitiated",REMOTE_USER_INITIATED:"CallEndReasonRemoteUserInitiated",ESTABLISHMENT_TIMEOUT:"CallEndReasonEstablishmentTimeout",PARTICIPANT_REMOVAL_TIMEOUT:"CallParticipantRemovalTimeout",LOCAL_ERROR:"CallEndReasonLocalError",CALL_UPDATE_ERROR:"CallEndReasonCallUpdateError",P2P_FORK_CONNECTED:"CallEndReasonP2pForkConnected",P2P_FORK_FORWARDED:"CallEndReasonP2pForkForwarded",P2P_FORK_FORWARDED_TO_VOICEMAIL:"CallEndReasonP2pForkForwardedToVoiceMail",P2P_FALLBACK_FOR_SCREENSHARING:"CallEndReasonP2pFallbackForScreensharing",P2P_FALLBACK_FOR_GROUPCALL:"CallEndReasonP2pFallbackForGroupCall",P2P_FALLBACK_FOR_CALL_ASSIMILATION:"CallEndReasonP2pFallbackForCallAssimilation",P2P_FALLBACK_FOR_TRANSLATION:"CallEndReasonP2pFallbackForCallTranslation",P2P_FORK_REJECTED:"CallEndReasonP2pForkRejected",TROUTER_CONNECTION_DROPPED:"CallEndReasonTrouterConnectionDropped",REMOVED_FROM_CALL:"CallEndReasonRemovedFromCall",TRANSFER_COMPLETION_TIMEOUT:"CallEndReasonTransferCompletionTimeout",CALL_DOES_NOT_EXIST:"CallEndReasonCallDoesNotExist",ATTACH_ACTION_FAILED:"CallEndReasonAttachActionFailed",ATTACH_FAILED:"CallEndReasonAttachFailed",CONVERSATION_ESTABLISHMENT_FAILED:"CallEndReasonConversationEstablishmentFailed",CONV_END_FROM_SERVICE:"CallEndReasonConversationEndReceivedFromService",CONV_END_FROM_SERVICE_WITH_ERROR:"CallEndReasonConversationEndReceivedFromServiceWithError",SERVICE_ERROR:"CallEndReasonServiceError",CONFLICT:"CallEndReasonConflict",CALL_ALREADY_IN_P2P:"CallEndReasonCallAlreadyExistsInP2p",CONV_END_NO_MODALITY:"ConversationEndNoModalityConnected",CONV_END_FOR_ALL_INITIATED:"ConversationEndForAllInitiated",RENEGOTIATION_IN_PROGRESS:"NegotiationIsInProgress",ADD_PARTICIPANT_URL_MISSING:"AddParticipantUrlMissing",ADMIT_PARTICIPANT_URL_MISSING:"AdmitParticipantUrlMissing",UNABLE_TO_GENERATE_MEETUP_ID:"Unable to generate GroupChat meetup id.",ENDED_BY_PMA:"Call ended by media agent.",OWNERSHIP_RESOLUTION_CONFLICT:"Conversation cannot be created due to a failure to resolve ownership.",CONVERSATION_ENDED_NO_NEW_OWNER_FOUND:"This conversation has ended since we were unable to determine a potential host for the group call.",UNMUTE_REQUEST_TIMEOUT:"UnmuteRequestTimeout",UNMUTE_REQUEST_REJECTED:"UnmuteRequestRejected",LIGHT_WEIGHT_MEETING_JOIN_FAILED:"LightWeightMeetingJoinFailed",LIGHT_WEIGHT_MEETING_END_RECEIVED_FROM_SERVICE:"LightWeightMeetingEndReasonEndReceivedFromService",LIGHT_WEIGHT_MEETING_TIMEOUT:"LightWeightMeetingTimeout",LIGHT_WEIGHT_MEETING_START_FAILED:"LightWeightMeetingStartFailed"}};t.__esModule=!0,t["default"]=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/utilities/utils",["require","exports","pako","./constants"],e)}(function(e,t){function s(e){var t=e.toString(16),n=4-t.length;for(var r=0;r<n;r+=1)t="0"+t;return t}function o(e){return!!e.match(/^8:/)}function u(e){return e.replace(/^\d+:/,"")}function a(){var e=new Array(8);for(var t=0;t<e.length;t+=2){var n=Math.floor(Math.random()*4294967296);e[t]=s(n&65535),e[t+1]=s(n>>>16),t+1===3&&(e[t+1]="4"+e[t+1].substring(1))}return e[0]+e[1]+"-"+e[2]+"-"+e[3]+"-"+e[4]+"-"+e[5]+e[6]+e[7]}function f(e,t){if(!e)throw new Error("Assert failed"+(typeof t!="undefined"?":"+t:""))}function l(e,t){if(!e||e===" ")throw new Error("AssertNotNullOrEmpty failed. "+(typeof t!="undefined"?": "+t:""))}function c(e,t){if(!e)throw new Error("AssertNotNull failed. "+(typeof t!="undefined"?": "+t:""))}function h(e){l(e,"callEndReason cannot be null or empty");if(typeof e.code=="undefined"||typeof e.subCode=="undefined"||typeof e.phrase=="undefined"||e.code<0||e.subCode<0||e.phrase===" ")throw new Error("callEndReason must specify code, subCode and phrase. Invalid reason : "+g(e))}function p(e){c(e,"MediaTypes passed cannot be null"),f(e.length>0,"Atleast one mediaType must be specified");var t=[],n=r["default"].MEDIA_TYPES;for(var i in n)m(e,n[i])&&t.push(n[i]);return t}function d(e,t){return e.indexOf(t)>-1}function v(e,t){return e.length>=t.length&&e.indexOf(t,e.length-t.length)>-1}function m(e,t){var n=t.toString().toLowerCase();return-1<e.map(function(e){return e.toString().toLowerCase()}).indexOf(n)}function g(e,t){return t===void 0&&(t=!1),t?JSON.stringify(e):JSON.stringify(e,i,4)}function y(e,t,n){return e.hasOwnProperty(t)?!1:(e[t]=n,!0)}function b(e,t){return e.hasOwnProperty(t)?(delete e[t],!0):!1}function w(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&t++;return t}function E(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function S(e){return e.status&&e.status===r["default"].CALL_END_CODE.NOT_FOUND?{telemetryEndSubCode:r["default"].CALL_END_CODE.NOT_FOUND,error:r["default"].RESOURCE_NOT_FOUND_ERROR}:e.skypeTokenError?{telemetryEndSubCode:r["default"].CALL_END_CODE.SKYPE_TOKEN_ERROR,error:r["default"].CALL_END_SKYPE_TOKEN_ERROR}:e.response&&e.response.operationFailure?{telemetryEndSubCode:e.response.operationFailure.code,error:e.response.operationFailure}:e.response&&e.response.code?{telemetryEndSubCode:e.response.code,error:e.response}:e.status&&e.status===0?{telemetryEndSubCode:r["default"].CALL_END_CODE.LOCAL_HTTP_STACK_ERROR,error:r["default"].CALL_END_LOCAL_HTTP_STACK_ERROR}:{telemetryEndSubCode:r["default"].CALL_END_CODE.NETWORK_ERROR,error:r["default"].CALL_END_NETWORK_ERROR}}function x(e,t){if(e&&t){var n=e[r["default"].HEADERS.ORIGINAL_MESSAGE_ID]||null,i=e[r["default"].HEADERS.MESSAGE_ID]||null;if(i&&m(t,i)||n&&m(t,n))return!0;t.length>9&&t.shift(),t.push(n||i)}return!1}function T(e,t,n){if(e&&t){var i=e[r["default"].HEADERS.ORIGINAL_MESSAGE_ID]||e[r["default"].HEADERS.MESSAGE_ID]||null;i&&(t[i]=n)}}function N(e,t){if(e){var n=e[r["default"].HEADERS.ORIGINAL_MESSAGE_ID]||e[r["default"].HEADERS.MESSAGE_ID]||null;return t[n]||null}return null}function C(e){return e&&e.hasOwnProperty(r["default"].HEADERS.CONTENT_ENCODING)}function k(e){return e&&r["default"].KNOWN_PAYLOAD_ENCODINGS.hasOwnProperty(e[r["default"].HEADERS.CONTENT_ENCODING].toUpperCase())}function L(e){var t=e.split(/\r?\n/),n=t.shift(),r=n.split(" "),i=r[0],s=r[1]||"",o,u={};while(o=t.shift().trim())try{var a=_.chain(o.split(":")).map(function(e){return _.trim(e)}).value(),f=a[0],l=a[1];u[f]=l}catch(c){throw new Error("Malformed header: "+o+c)}return{url:s,headers:u,method:i,body:t.join("")}}function A(e){var t=atob(e);return n.inflate(t,{to:"string"})}function O(){var e,t,n=!0,r=new Promise(function(n,r){e=n,t=r});return{isPending:function(){return n},promise:r,resolve:function(t){n&&(e(t),n=!1)},reject:function(e){n&&(t(e),n=!1)}}}var n=e("pako"),r=e("./constants"),i=["response","responseText","responseURL","status","statusText","timeout","withCredentials","stack","message","name"];t.is1to1Mri=o,t.stripMri=u,t.newGuid=a,t.assert=f,t.assertNotNullOrEmpty=l,t.assertNotNull=c,t.assertCallEndReason=h,t.getMediaTypes=p,t.stringContains=d,t.stringEndsWith=v,t.arrayContains=m,t.getPrintableObject=g,t.tryAddNewKeyToHashTable=y,t.tryRemoveKeyFromHashTable=b,t.getHashTableCount=w,t.escapeRegExp=E,t.getErrorForXHRFailure=S,t.isDuplicateMessage=x,t.cacheMessageResult=T,t.getMessageResultFromCache=N,t.isEncodedMessage=C,t.isMessageEncodingSupported=k,t.parseRawHttpMessage=L,t.decodeMessage=A,t.defer=O}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/participant",["require","exports","./utilities/utils"],e)}(function(e,t){var n=e("./utilities/utils"),r=function(){function e(e){this.id=e.id,this.displayName=e.displayName||" ",this.languageId=e.languageId||null,this.endpointDetails=e.endpointDetails||[],this.acceptedBy=e.acceptedBy,this.role=e.role,this.tenantId=e.tenantId}return e.isServerMuted=function(e,t){for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i.endpointId===t&&i.mediaStreams){for(var s=0,o=i.mediaStreams;s<o.length;s++){var u=o[s];if(u.type==="audio")return u.serverMuted===undefined?!1:u.serverMuted}break}}return!1},e.fromWireParticipant=function(t){n.assertNotNull(t,"invalid wireParticipant"),n.assertNotNullOrEmpty(t.id,"participant must have valid Id");var r=new e({id:t.id,displayName:t.displayName,languageId:t.languageId,acceptedBy:t.acceptedBy});return r},e.fromRoster=function(t){n.assertNotNull(t,"invalid rosterParticipant"),n.assertNotNullOrEmpty(t.details.id,"participant must have valid Id");var r=!1,i=!1,s=!1,o=[],u=t.endpoints;o=Object.keys(u).map(function(e){var t=[];return u[e].call&&(r=!0,t=u[e].call.mediaStreams?u[e].call.mediaStreams:null),u[e].lwj&&(i=!0),u[e].lobby&&(s=!0,t=u[e].lobby.mediaStreams?u[e].lobby.mediaStreams:null),{endpointId:e,participantId:u[e].participantId||null,clientVersion:u[e].clientVersion||null,endpointMetadata:u[e].endpointMetadata||null,originalId:u[e].originalId||null,contentSharing:u[e].contentSharing||null,capabilities:u[e].capabilities||null,endpointType:u[e].endpointType||"default",mediaStreams:t,lightWeightMeeting:u[e].lwj||null,isLobby:s,endpointState:u[e].endpointState||null}});if(!r&&!i&&!s)return null;var a=new e({id:t.details.id,displayName:t.details.displayName,languageId:t.details.languageId,role:t.role||"",tenantId:t.details.tenantId||"",endpointDetails:o||[],acceptedBy:t.acceptedBy||""});return a},e}();t.__esModule=!0,t["default"]=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/utilities/enums",["require","exports"],e)}(function(e,t){var n;(function(e){e[e.Desktop=1]="Desktop",e[e.Mobile=2]="Mobile",e[e.Tablet=8]="Tablet"})(n=t.DeviceType||(t.DeviceType={}))}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/telemetry/telemetryConstants",["require","exports"],e)}(function(e,t){t.EVENTS={HANDLE_MEDIA_ACKNOWLEDGEMENT:"HandleMediaAcknowledgement",HANDLE_MEDIA_NEGOTIATION_FAILURE:"HandleMediaNegotiationFailure",HANDLE_MEDIA_ANSWER:"HandleMediaAnswer",HANDLE_MEDIA_ANSWER_FAILED:"HandleMediaAnswerFailed",HANDLE_MEDIA_OFFER:"HandleMediaOffer",REJECT_RENEGOTIATION:"RejectRenegotiation",HANDLE_RETARGET_COMPLETED:"HandleRetargetCompleted",HANDLE_MEDIA_ANSWER_TIMEOUT:"HandleMediaAnswerTimeout",HANDLE_MEDIA_ACKNOWLEDGEMENT_TIMEOUT:"HandleMediaAcknowledgementTimeout",ACCEPT_RENEGOTIATION:"AcceptRenegotiation",START_RENEGOTIATION:"StartRenegotiation",ADD_MODALITY_TIMEOUT:"AddModalityTimeout",ADD_PARTICIPANT:"AddParticipant",ADD_PARTICIPANT_TIMEOUT:"AddParticipantTimeout",ADMIT_PARTICIPANT:"AdmitParticipant",ADMIT_PARTICIPANT_TIMEOUT:"AdmitParticipantTimeout",CALL_ME_BACK:"CallMeBack",CALL_ME_BACK_TIMEOUT:"CallMeBackTimeout",REMOVE_PARTICIPANT:"RemoveParticipant",REMOVE_PARTICIPANT_TIMEOUT:"RemoveParticipantTimeout",HANDLE_ADD_PARTICIPANT_SUCCESS:"HandleAddParticipantSuccess",HANDLE_ADD_PARTICIPANT_FAILURE:"HandleAddParticipantFailure",HANDLE_ADMIT_PARTICIPANT_SUCCESS:"HandleAdmitParticipantSuccess",HANDLE_ADMIT_PARTICIPANT_FAILURE:"HandleAdmitParticipantFailure",HANDLE_ADD_PARTICIPANT_MODALITY_FAILURE:"HandleAddParticipantModalityFailure",HANDLE_REMOVE_PARTICIPANT_SUCCESS:"HandleRemoveParticipantSuccess",HANDLE_REMOVE_PARTICIPANT_FAILURE:"HandleRemoveParticipantFailure",HANDLE_ROSTER_UPDATE:"HandleRosterUpdate",HANDLE_CONVERSATION_UPDATE:"HandleConversationUpdate",SET_SUBJECT:"SetSubject",SET_THREADID:"SetThreadId",SET_CALLOPTIONS:"SetCallOptions",SET_TRANSFER_CONTEXT:"SetTransferContext",START_CALL:"StartCall",JOIN_CALL:"JoinCall",JOIN_CONVERSATION_WITHOUT_CALL_MODALITY:"JoinConversationWithoutCallModality",HANDLE_INCOMING_CALL:"HandleIncomingCall",END_CALL:"EndCall",END_WITH_BEACON:"EndWithBeacon",CONFLICTED_CALL:"ConflictedCall",SET_PROVISIONAL_ANSWER:"SetProvisionalAnswer",SET_PROVISIONAL_ANSWER_FAILED:"SetProvisionalAnswerFailed",ACCEPT_CALL:"AcceptCall",HANDLE_CALL_ACCEPTANCE_ACK:"HandleCallAcceptanceAck",HANDLE_CALL_ACCEPTANCE:"HandleCallAcceptance",HANDLE_CALL_ACCEPTANCE_SYNC:"HandleCallAcceptanceSync",HANDLE_CALL_ACCEPTANCE_FAILED:"HandleCallAcceptanceFailed",HANDLE_CALL_ESTABLISHMENT_TIMEOUT:"HandleCallEstablishmentTimeout",HANDLE_CALL_END:"HandleCallEnd",HANDLE_CALL_PROGRESS:"HandleCallProgress",TROUTER_URL_CHANGED:"TrouterUrlChanged",TROUTER_URL_CHANGED_TO_INVALID:"TrouterUrlChangedToInvalid",TROUTER_URL_UPDATE_FAILED:"TrouterUrlUpdateFailed",ADD_CONTENT_SHARING_MODALITY:"AddContentSharingModality",ACCEPTED_BEFORE_RINGING:"AcceptedBeforeRinging",LEAVE_CONTENT_SHARING:"LeaveContentSharing",DELETE_CONTENT_SHARING:"DeleteContentSharing",TAKE_CONTROL_CONTENT_SHARING:"TakeControlContentSharing",UPDATE_SESSION_STATE_CONTENT_SHARING:"UpdateSessionStateContentSharing",JOIN_CONTENT_SHARING:"JoinContentSharing",UPDATE_PARTICIPANT_STATE_CONTENT_SHARING:"UpdateParticipantStateContentSharing",HANDLE_CONTENT_SHARING_UPDATE:"HandleContentSharingUpdate",HANDLE_CONTENT_SHARING_END:"HandleContentSharingEnd",CONTENT_SHARING_START_FROM_ROSTER:"ContentSharingStartFromRoster",CONTENT_SHARING_END_FROM_ROSTER:"ContentSharingEndFromRoster",HANDLE_ADD_MODALITY_SUCCESS:"HandleAddModalitySuccess",HANDLE_ADD_MODALITY_FAILURE:"HandleAddModalityFailure",START_LIGHT_WEIGHT_MEETING:"StartLightWeightMeeting",JOIN_LIGHT_WEIGHT_MEETING:"JoinLightWeightMeeting",HANDLE_LIGHT_WEIGHT_MEETING_UPDATE:"HandleLightWeightMeetingUpdate",HANDLE_LIGHT_WEIGHT_MEETING_END:"HandleLightWeightMeetingEnd",HANDLE_LIGHT_WEIGHT_MEETING_UPDATE_FAILURE:"HandleLightWeightMeetingUpdateFailure",HANDLE_LIGHT_WEIGHT_MEETING_JOIN_TIMEOUT:"HandleLightWeightMeetingJoinTimeout",UPDATE_BROADCAST_DETAILS:"UpdateBroadcastDetails",MUTE:"Mute",UNMUTE:"Unmute",UNMUTE_TIMEOUT:"UnmuteTimeout",HANDLE_UNMUTE_CONFIRM:"HandleUnmuteConfirm",HANDLE_UNMUTE_SUCCESS:"HandleUnmuteSuccess",HANDLE_UNMUTE_FAILURE:"HandleUnmuteFailure",APPROVE_UNMUTE:"ApproveUnmute",REJECT_UNMUTE:"RejectUnmute",HANDLE_CONTROL_VIDEO_STREAMING:"HandleControlVideoStreaming",HANDLE_DOMINANT_SPEAKER_INFO:"HandleDominantSpeakerInfo",HANDLE_CSRC_INFO:"HandleCsrcInfo",SEND_WEBRTC_MEDIA_NOTIFICATION:"SendWebRtcMediaNotification",HANDLE_BALANCE_UPDATE:"HandleBalanceUpdate",TRANSFER_CALL:"TransferCall",HANDLE_TRANSFER_ACCEPTANCE:"HandleTransferAcceptance",HANDLE_TRANSFER_ACCEPTANCE_FAILED:"HandleTransferAcceptanceFailed",HANDLE_TRANSFER_COMPLETION:"HandleTransferCompletion",HANDLE_TRANSFER_COMPLETION_FAILED:"HandleTransferCompletionFailed",HANDLE_TRANSFER_REQUESTED:"HandleTransferRequested",HANDLE_CALL_TRANSFER_TIMEOUT:"HandleCallTransferTimeout",DUPLICATE_MESSAGE_IGNORED:"DuplicateMessageIgnored",UNKNOWN_MESSAGE_TYPE:"UnkownMessageType",FAILED_TO_HANDLE_MESSAGE:"FailedToHandleMessage",TROUTER_DECODE_PAYLOAD_FAILURE:"TrouterDecodePayloadFailure",UPDATE_ENDPOINT_STATE:"UpdateEndpointState",BROKER_DECODE_PAYLOAD_FAILURE:"BrokerDecodePayloadFailure",BROKER_SUBSCRIPTION_TIMEOUT:"BrokerSubscriptionTimeout",BROKER_SUBSCRIPTION_SUCCESSFUL:"BrokerSubscriptionSuccessful",BROKER_SUBSCRIPTION_FAILED:"BrokerSubscriptionFailed",FAILED_TO_HANDLE_TROUTER_MESSAGE:"FailedToHandleTrouterMessage",FAILED_TO_HANDLE_BROKER_MESSAGE:"FailedToHandleBrokerMessage",BROKER_DISABLED_SUBSCRIBE_URL_PRESENT:"BrokerDisabledSubscribeUrlPresent",CONNECTED:"Connected",IN_LOBBY:"InLobby",MESSAGE_MISSING_BODY:"MessageMissingBody",BROADCAST_STATE_CHANGED:"BroadcastStateChanged",HANDLE_CALL_NOTIFICATION:"HandleCallNotification",HANDLE_INCOMING_CALL_REPLACEMENT:"HandleIncomingCallReplacement",HANDLE_PSTN_BALANCE_UPDATE:"HandlePstnBalanceUpdate",IGNORE_OLD_ROSTER:"IgnoreOldRoster",HANDLE_MEDIA_ACK:"HandleMediaAck",HANDLE_MEDIA_PROVISIONAL_ACK:"HandleMediaProvisionalAck",UPDATE_CALL_STATUS:"UpdateCallStatus",SEND_ATTACH:"SendAttach",UPDATE_CONVERSATION_LINKS:"UpdateConversationLinks",UPDATE_CONVERSATION_LINKS_SUCCESS:"UpdateConversationLinksSuccess",UPDATE_CONVERSATION_LINKS_FAILED:"UpdateConversationLinksFailed",PROCESS_INITIAL_OFFER:"ProcessInitialOffer",SEND_PROGRESS:"SendProgress",SEND_PROGRESS_FAILED:"SendProgressFailed",PROCESS_CALL_ACCEPTANCE:"ProcessCallAcceptance",REJECT_INCOMING_CALL:"RejectIncomingCall",SEND_KEEP_ALIVE:"SendKeepAlive",SEND_KEEP_ALIVE_FAILED:"SendKeepAliveFailed"},t.NETWORK_REQUESTS={SEND_MEDIA_ANSWER:"SendMediaAnswer",START_RENEGOTIATION:"StartRenegotiation",SEND_MEDIA_ACKNOWLEDGEMENT:"SendMediaAcknowledgement",SEND_MEDIA_REJECTION:"SendMediaRejection",ADD_PARTICIPANT:"AddParticipant",REMOVE_PARTICIPANT:"RemoveParticipant",ADMIT_PARTICIPANT:"AdmitParticipant",BROKER_SUBSCRIBE:"BrokerSubscribe",CALL_ME_BACK:"CallMeBack",SEND_ACCEPTANCE:"SendAcceptance",SEND_ACCEPTANCE_ACKNOWLEDGEMENT:"SendAcceptanceAcknowledgement",END_CALL:"EndCall",CANCEL_CALL:"CancelCall",REJECT_CALL:"RejectCall",JOIN_CONVERSATION:"JoinConversation",JOIN_CONVERSATION_WITHOUT_CALL_MODALITY:"JoinConversationWithoutCallModality",LEAVE_CONVERSATION:"LeaveConversation",DELETE_CONVERSATION:"DeleteConversation",PLACE_CALL:"PlaceCall",UPDATE_CONVERSATION_LINKS:"UpdateConversationLinks",SEND_CALL_ATTACH:"SendCallAttach",SEND_CALL_PROGRESS:"SendCallProgress",SEND_KEEP_ALIVE:"SendKeepAlive",ADD_CONTENT_SHARING_MODALITY:"AddContentSharingModality",DELETE_CONTENT_SHARING:"DeleteContentSharing",TAKE_CONTROL_CONTENT_SHARING:"TakeControlContentSharing",UPDATE_SESSION_STATE_CONTENT_SHARING:"UpdateSessionStateContentSharing",PLACE_LIGHT_WEIGHT_MEETING_CALL:"PlaceLightWeightMeetingCall",JOIN_CONTENT_SHARING:"JoinContentSharing",JOIN_LIGHT_WEIGHT_MEETING:"JoinLightWeightMeeting",UPDATE_PARTICIPANT_STATE_CONTENT_SHARING:"UpdateParticipantStateContentSharing",UPDATE_CONTENT_SHARING_NOTIFICATION_LINKS:"UpdateContentSharingNotificationLinks",MUTE:"Mute",UNMUTE:"Unmute",SEND_CONTROL_VIDEO_STREAMING:"SendControlVideoStreaming",APPROVE_UNMUTE:"ApproveUnmute",REJECT_UNMUTE:"RejectUnmute",SEND_TRANSFER_REQUEST:"SendTransferRequest",TRANSFER_ACCEPTANCE:"TransferAcceptance",TRANSFER_COMPLETION:"TransferCompletion",UPDATE_ENDPOINT_STATE:"UpdateEndpointState"};var n={EVENT_SOURCE:{TROUTER:"Trouter",BROKER:"Broker",UDP:"UDP",LOCAL:"Local"},SOURCE:{NGC_SOURCE:"SkypeConcore"},EVENT_TYPE:{CONVERSATION_CALL_MODALITY:"skypecosi_concore_web_csa_conversation_callmodality",CONVERSATION_CONTENT_SHARING:"skypecosi_concore_web_csa_conversation_contentsharing",CONVERSATION_HTTP_REQUEST:"skypecosi_concore_web_csa_conversation_httprequest"},EXTENSIONS:{DATA_VERSION:"DataVersion",DIRECTION:"Direction",CONTENT_SHARING_DIRECTION:"ContentSharingDirection",CONNECTED_DURATION_IN_MS:"ConnectedDurationInMsecs",TIME_TO_RING_IN_MS:"TimeToRingInMsecs",CALL_TERMINATING_END:"CallTerminatingEnd",NETWORK_REQUESTS_PENDING:"NetworkRequestsPending",NETWORK_REQUESTS_COMPLETED:"NetworkRequestsCompleted",LOCAL_OPERATIONS_PERFORMED:"LocalOperationsPerformed",TROUTER_WAIT_OPERATIONS:"TrouterWaitOperations",CALL_START_TIME:"CallStartTime",CALL_END_TIME:"CallEndTime",IS_GROUP_CALL:"IsGroupCall",IS_HOSTLESS_CALL:"IsHostLessCall",IS_CAST_CALL:"IsCastCall",IS_MEETUP_CALL:"IsMeetupCall",IS_ON_BEHALF_OF_CALL:"IsOnBehalfOfCall",CALL_END_CODE:"Code",CALL_END_SUB_CODE:"SubCode",CONTENT_SHARING_END_CODE:"ContentSharingEndReasonServiceCode",CONTENT_SHARING_END_SUB_CODE:"ContentSharingEndReasonServiceSubCode",CONVERSATION_SERVICE_URL:"ConversationServiceUrl",CONTENT_SHARING_SERVICE_URL:"ContentSharingServiceUrl",MEETING_INFO:"MeetingInfo",RESULT_VALUE:"ResultValue",RESULT_DETAIL:"ResultDetail",RESULT_CODE:"ResultCode",LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS:"LocalOfferAnswerGenerationTimestamps",SELF_PARTICIPANT_ROLE:"SelfParticipantRole",CALLER_TYPE:"Caller_Type",CALLEE_TYPE:"Callee_Type",CALL_TYPE:"Call_Type",TEST_CONTEXT_ID:"Test_Context_Id",OUTGOING_MODALITIES:"Outgoing_Modalities",INCOMING_MODALITIES:"Incoming_Modalities",VBSS_OPERATIONS:"VBSS_Operations",CHANGING_CORRELATION_ID_NEW_ID:"ChangingCorrelationId_NewId",CHANGING_CORRELATION_ID_OLD_ID:"ChangingCorrelationId_OldId",MESSAGING_CHANNEL:"MessagingChannel",EVENT_TIMESTAMP_BAG:"EventTimestampBag",NETWORK_REQUESTS_BAG:"NetworkRequestBag"},MESSAGING_CHANNEL:{TROUTER:"Trouter",BROKER:"Broker"},SIGNALING_CONFIG:{BROKER_OUTGOING_ENABLED:"BrokerOutgoingEnabled",BROKER_INCOMING_ENABLED:"BrokerIncomingEnabled",BROKER_REQUEST_BATCHING_ENABLED:"BrokerRequestBatchingEnabled",BROKER_EXCLUSIVELY_ENABLED:"BrokerExclusivelyEnabled",SUPPORTS_COMPRESSED_PAYLOAD:"SupportsCompressedPayload"},CONTEXT_ID:{CORRELATIONID:"CorrelationId",THREADID:"ThreadId",TEAMS_MESSAGEID:"TeamsMessageId",TEAMS_MEETINGINFO:"TeamsMeetingInfo",ENDPOINTID:"EndpointId",PARTICIPANTID:"ParticipantId",DATA_VERSION:"DataVersion",CONTENTSHARINGID:"ContentSharingSessionId",CONTENTSHARINGCORRELATIONID:"ContentSharingCorrelationId"},CALL_TERMINATING_END:{LOCAL:"Local",REMOTE:"Remote"},RESULT_VALUE:{SUCCESS:"Success",FAILURE:"Failure"},DIRECTION:{INCOMING:"Incoming",OUTGOING:"Outgoing"},ROLE:{CALLER:"caller",CALLEE:"callee",JOIN:"join",JOIN_FOR_ROSTER_ONLY:"joinForRosterOnly",JOIN_FOR_LIGHT_WEIGHT_MEETING:"joinForLightWeightMeeting",START_FOR_LIGHT_WEIGHT_MEETING:"startForLightWeightMeeting"},VBSS_OPERATION:{START:"Start",STOP:"Stop",REJECTED:"Rejected",REMOTE_START:"RemoteStart",TIMEOUT:"Timeout",CALL_END:"CallEnd"},LOCAL_OFFER_ANSWER_OPERATIONS:{INITIAL_OFFER_GENERATION_STARTED:"InitialOfferGenerationStarted",INITIAL_OFFER_GENERATION_ENDED:"InitialOfferGenerationEnded",FINAL_ANSWER_PROCESSING_STARTED:"FinalAnswerProcessingStarted",FINAL_ANSWER_PROCESSING_ENDED:"FinalAnswerProcessingEnded",PROVISIONAL_ANSWER_PROCESSING_STARTED:"ProvisonalAnswerProcessingStarted",PROVISIONAL_ANSWER_PROCESSING_ENDED:"ProvisonalAnswerProcessingEnded",NEGOTIATION_COMPLETED:"NegotiationCompleted",INITIAL_OFFER_PROCESSING_STARTED:"InitialOfferProcessingStarted",INITIAL_OFFER_PROCESSING_ENDED:"InitialOfferProcessingEnded",FINAL_ANSWER_GENERATION_STARTED:"FinalAnswerGenerationStarted",FINAL_ANSWER_GENERATION_ENDED:"FinalAnswerGenerationEnded",PROVISIONAL_ANSWER_GENERATION_STARTED:"ProvisionalAnswerGenerationStarted",PROVISIONAL_ANSWER_GENERATION_ENDED:"ProvisionalAnswerGenerationEnded",RENEGOTIATION_OFFER_GENERATION_STARTED:"RenegotiationOfferGenerationStarted",RENEGOTIATION_OFFER_GENERATION_ENDED:"RenegotiationOfferGenerationEnded",RENEGOTIATION_ANSWER_PROCESSING_STARTED:"RenegotiationAnswerProcessingStarted",RENEGOTIATION_ANSWER_PROCESSING_ENDED:"RenegotiationAnswerProcessingEnded",RENEGOTIATION_OFFER_PROCESSING_STARTED:"RenegotiationOfferProcessingStarted",RENEGOTIATION_OFFER_PROCESSING_ENDED:"RenegotiationOfferProcessingEnded",RENEGOTIATION_ANSWER_GENERATION_STARTED:"RenegotiationAnswerGenerationStarted",RENEGOTIATION_ANSWER_GENERATION_ENDED:"RenegotiationAnswerGenerationEnded"},TROUTER_WAIT_OPERATION:{STARTED:"Started",ENDED:"Ended",FAILED:"Failed"}};t.__esModule=!0,t["default"]=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/incomingNotificationMessageHandler",["require","exports","./utilities/constants"],e)}(function(e,t){var n=e("./utilities/constants"),r=function(){function e(e){var t=this;this.handleMessage=function(e){if(!t.isMessageForExistingCall(e))return{isHandled:!1};if(e.url.search(new RegExp("/"+n["default"].URL_BASE.CALLAGENT+"/","i"))>-1){var r=t.signalingAgent.handleIncomingNotification(e);return typeof r=="number"?{isHandled:!0,resultCode:r}:{isHandled:!0,resultCode:r.resultCode,responseBody:r.responseBody,responseHeaders:r.responseHeaders}}return{isHandled:!1}},this.signalingAgent=e}return e.prototype.isMessageForExistingCall=function(e){return!e.eventId},e}();t.__esModule=!0,t["default"]=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/defaultSignalingAgentConfig",["require","exports","./utilities/utils","./utilities/enums"],e)}(function(e,t){var n=e("./utilities/utils"),r=e("./utilities/enums"),i=function(){function e(e){this.cloudScreenSharingFlag="enabled",this.isWebRtcEnabled=typeof RTCIceGatherer=="undefined",this.doHostlessCalling=!1,this.shouldServiceSendCallEventMessages=!1,this.shouldServiceSendNGCUpgradeMessages=!0,this.supportsCompressedServicePayload=!0,this.supportsSynchronousTrouterResponse=!0,this.endConflictedCall=!1,this.autoResolveConflictedCall=!1,this.supportsHostlessGroupCalls=!1,this.autoJoinOnConflict=!1,this.serverMuteUnmute=!1,this.brokerEnabledOutgoing=!0,this.brokerEnabledIncoming=!0,this.brokerRequestBatching=!0,this.brokerExclusively=!1,n.assertNotNull(e.logger,"logger should be a non null value"),n.assertNotNull(e.httpRequestDispatcher,"httpRequestDispatcher should be a non null value"),n.assertNotNull(e.telemetryManager,"telemetryManager should be a non null value"),this.skypeTokenProvider=e.skypeTokenProvider,this.logger=e.logger,this.httpRequestDispatcher=e.httpRequestDispatcher,this.telemetryManager=e.telemetryManager,this.browserDetect=e.browserDetect,this.conversationServiceUrl=e.conversationServiceUrl,this.trouterUrlGetter=e.trouterUrlGetter,this.languageCode=e.languageCode,this.isGVCOutgoingEnabled=e.isGVCOutgoingEnabled,this.isGVCJoiningEnabled=e.isGVCJoiningEnabled,this.doHostlessCalling=e.doHostlessCalling,this.supportsHostlessGroupCalls=e.supportsHostlessGroupCalls,this.shouldServiceSendCallEventMessages=e.shouldServiceSendCallEventMessages,this.supportsCompressedServicePayload=typeof e.supportsCompressedServicePayload=="boolean"?e.supportsCompressedServicePayload:this.supportsCompressedServicePayload,this.supportsSynchronousTrouterResponse=typeof e.supportsSynchronousTrouterResponse=="boolean"?e.supportsSynchronousTrouterResponse:this.supportsSynchronousTrouterResponse,this.endConflictedCall=e.endConflictedCall,this.autoResolveConflictedCall=e.autoResolveConflictedCall,this.brokerEnabledOutgoing=typeof e.brokerEnabledOutgoing=="boolean"?e.brokerEnabledOutgoing:this.brokerEnabledOutgoing,this.brokerEnabledIncoming=typeof e.brokerEnabledIncoming=="boolean"?e.brokerEnabledIncoming:this.brokerEnabledIncoming,this.brokerRequestBatching=typeof e.brokerRequestBatching=="boolean"?e.brokerRequestBatching:this.brokerRequestBatching,this.brokerExclusively=e.brokerExclusively;var t=e.browserDetect.getSystemInfo(),r=n.stringContains(e.clientInfo.getBIAppName(),"swx-local")?"Test/":"",i="/os="+t.osName+"; osVer="+t.osVersion+"; proc="+t.platform;i+="; deviceType="+this.getDeviceType(t.deviceType)+"; browser="+this.browserDetect.getBrowserInfo().browserName,i+="; browserVer="+this.browserDetect.getBrowserInfo().browserVersion,this.clientInformation="Web CallSignalingAgent(PluginLess/"+r+e.clientInfo.getBIVersion()+i+")",this.testCall=r===""?!1:!0,this.emergencyCallCountry=e.emergencyCallCountry}return e.prototype.skypeToken=function(){return this.skypeTokenProvider()},e.prototype.getDeviceType=function(e){switch(e){case r.DeviceType.Desktop:return"Desktop";case r.DeviceType.Mobile:return"Mobile";case r.DeviceType.Tablet:return"Tablet"}return undefined},e}();t.__esModule=!0,t["default"]=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/utilities/stopwatch",["require","exports"],e)}(function(e,t){function r(){return new n}var n=function(){function e(){var e=this;this.msElapsed=0,this.isPaused=!1,this.startTime=(new Date).getTime(),this.pause=function(){e.isPaused||(e.msElapsed+=(new Date).getTime()-e.startTime,e.isPaused=!0)},this.resume=function(){e.isPaused&&(e.isPaused=!1,e.startTime=(new Date).getTime())},this.duration=function(){return e.isPaused?e.msElapsed:e.msElapsed+(new Date).getTime()-e.startTime},this.durationInMinutes=function(){var t=e.duration()/6e4;return Math.ceil(t)},this.durationInSeconds=function(){var t=e.duration()/1e3;return Math.ceil(t)}}return e}();t.Stopwatch=n,t.build=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/telemetry/ngcTelemetry",["require","exports","./telemetryConstants"],e)}(function(e,t){function i(e){return new r(e)}var n=e("./telemetryConstants"),r=function(){function e(e){var t=this;this.logConversationCallModalityEvent=function(e){var r=t.createCallModalityEvent(e);t.signalingSession.signalingAgentConfig.telemetryManager.sendEvent(n["default"].EVENT_TYPE.CONVERSATION_CALL_MODALITY,r)},this.logConversationContentSharingEvent=function(e){e[n["default"].CONTEXT_ID.CORRELATIONID]=t.signalingSession.correlationId,t.signalingSession.signalingAgentConfig.telemetryManager.sendEvent(n["default"].EVENT_TYPE.CONVERSATION_CONTENT_SHARING,e)},this.logHttpTelemetryEvent=function(e){t.signalingSession.signalingAgentConfig.telemetryManager.sendEvent(n["default"].EVENT_TYPE.CONVERSATION_HTTP_REQUEST,e)},this.signalingSession=e}return e.prototype.createCallModalityEvent=function(e){var t={};return t.Type=n["default"].SOURCE.NGC_SOURCE,t.ResultDetail=e[n["default"].EXTENSIONS.RESULT_DETAIL],t.ResultValue=e[n["default"].EXTENSIONS.RESULT_VALUE],t.ResultCode=e[n["default"].EXTENSIONS.CALL_END_CODE],t[n["default"].CONTEXT_ID.CORRELATIONID]=this.signalingSession.correlationId,t[n["default"].CONTEXT_ID.ENDPOINTID]=e[n["default"].CONTEXT_ID.ENDPOINTID],t[n["default"].CONTEXT_ID.PARTICIPANTID]=e[n["default"].CONTEXT_ID.PARTICIPANTID],t[n["default"].EXTENSIONS.CONVERSATION_SERVICE_URL]=e[n["default"].EXTENSIONS.CONVERSATION_SERVICE_URL],t[n["default"].EXTENSIONS.CALL_START_TIME]=JSON.stringify(e[n["default"].EXTENSIONS.CALL_START_TIME]),t[n["default"].EXTENSIONS.CALL_END_TIME]=JSON.stringify(e[n["default"].EXTENSIONS.CALL_END_TIME]),t[n["default"].EXTENSIONS.MESSAGING_CHANNEL]=JSON.stringify(e[n["default"].EXTENSIONS.MESSAGING_CHANNEL]),t[n["default"].EXTENSIONS.IS_GROUP_CALL]=this.signalingSession.multiParty?"true":"false",t[n["default"].EXTENSIONS.IS_HOSTLESS_CALL]=this.signalingSession.isHostLessCall?"true":"false",t[n["default"].EXTENSIONS.IS_CAST_CALL]=this.signalingSession.isCastCall?"true":"false",t[n["default"].EXTENSIONS.IS_ON_BEHALF_OF_CALL]=this.signalingSession.onBehalfOf?"true":"false",t[n["default"].EXTENSIONS.CALL_TERMINATING_END]=e[n["default"].EXTENSIONS.CALL_TERMINATING_END],t[n["default"].EXTENSIONS.CALL_END_CODE]=JSON.stringify(e[n["default"].EXTENSIONS.CALL_END_CODE]),t[n["default"].EXTENSIONS.CALL_END_SUB_CODE]=JSON.stringify(e[n["default"].EXTENSIONS.CALL_END_SUB_CODE]),e.hasOwnProperty(n["default"].EXTENSIONS.DIRECTION)&&(t[n["default"].EXTENSIONS.DIRECTION]=e[n["default"].EXTENSIONS.DIRECTION],t[n["default"].EXTENSIONS.SELF_PARTICIPANT_ROLE]=e[n["default"].EXTENSIONS.SELF_PARTICIPANT_ROLE]),e.hasOwnProperty(n["default"].EXTENSIONS.CONNECTED_DURATION_IN_MS)&&(t[n["default"].EXTENSIONS.CONNECTED_DURATION_IN_MS]=JSON.stringify(e[n["default"].EXTENSIONS.CONNECTED_DURATION_IN_MS])),e.hasOwnProperty(n["default"].EXTENSIONS.TIME_TO_RING_IN_MS)&&(t[n["default"].EXTENSIONS.TIME_TO_RING_IN_MS]=JSON.stringify(e[n["default"].EXTENSIONS.TIME_TO_RING_IN_MS])),e.hasOwnProperty(n["default"].EXTENSIONS.NETWORK_REQUESTS_COMPLETED)&&(t[n["default"].EXTENSIONS.NETWORK_REQUESTS_COMPLETED]=e[n["default"].EXTENSIONS.NETWORK_REQUESTS_COMPLETED]),e.hasOwnProperty(n["default"].EXTENSIONS.NETWORK_REQUESTS_PENDING)&&(t[n["default"].EXTENSIONS.NETWORK_REQUESTS_PENDING]=e[n["default"].EXTENSIONS.NETWORK_REQUESTS_PENDING]),e.hasOwnProperty(n["default"].EXTENSIONS.LOCAL_OPERATIONS_PERFORMED)&&(t[n["default"].EXTENSIONS.LOCAL_OPERATIONS_PERFORMED]=e[n["default"].EXTENSIONS.LOCAL_OPERATIONS_PERFORMED]),e.hasOwnProperty(n["default"].EXTENSIONS.EVENT_TIMESTAMP_BAG)&&(t[n["default"].EXTENSIONS.EVENT_TIMESTAMP_BAG]=e[n["default"].EXTENSIONS.EVENT_TIMESTAMP_BAG]),e.hasOwnProperty(n["default"].EXTENSIONS.NETWORK_REQUESTS_BAG)&&(t[n["default"].EXTENSIONS.NETWORK_REQUESTS_BAG]=e[n["default"].EXTENSIONS.NETWORK_REQUESTS_BAG]),e.hasOwnProperty(n["default"].EXTENSIONS.TROUTER_WAIT_OPERATIONS)&&(t[n["default"].EXTENSIONS.TROUTER_WAIT_OPERATIONS]=e[n["default"].EXTENSIONS.TROUTER_WAIT_OPERATIONS]),e.hasOwnProperty(n["default"].EXTENSIONS.LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS)&&(t[n["default"].EXTENSIONS.LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS]=e[n["default"].EXTENSIONS.LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS]),e.hasOwnProperty(n["default"].EXTENSIONS.OUTGOING_MODALITIES)&&(t[n["default"].EXTENSIONS.OUTGOING_MODALITIES]=e[n["default"].EXTENSIONS.OUTGOING_MODALITIES]),e.hasOwnProperty(n["default"].EXTENSIONS.INCOMING_MODALITIES)&&(t[n["default"].EXTENSIONS.INCOMING_MODALITIES]=e[n["default"].EXTENSIONS.INCOMING_MODALITIES]),e.hasOwnProperty(n["default"].EXTENSIONS.VBSS_OPERATIONS)&&(t[n["default"].EXTENSIONS.VBSS_OPERATIONS]=e[n["default"].EXTENSIONS.VBSS_OPERATIONS]),e.hasOwnProperty(n["default"].EXTENSIONS.CALLER_TYPE)&&(t[n["default"].EXTENSIONS.CALLER_TYPE]=e[n["default"].EXTENSIONS.CALLER_TYPE]),e.hasOwnProperty(n["default"].EXTENSIONS.CALLEE_TYPE)&&(t[n["default"].EXTENSIONS.CALLEE_TYPE]=e[n["default"].EXTENSIONS.CALLEE_TYPE]),this.signalingSession.callType&&(t[n["default"].EXTENSIONS.CALL_TYPE]=this.signalingSession.callType),this.signalingSession.signalingAgentConfig.testCall&&(t[n["default"].EXTENSIONS.TEST_CONTEXT_ID]="Test"),this.signalingSession.threadId&&(t[n["default"].CONTEXT_ID.THREADID]=this.signalingSession.threadId),this.signalingSession.teamsMessageId&&(t[n["default"].CONTEXT_ID.TEAMS_MESSAGEID]=this.signalingSession.teamsMessageId),this.signalingSession.getMeetingInfo()&&(t[n["default"].CONTEXT_ID.TEAMS_MEETINGINFO]=JSON.stringify(this.signalingSession.getMeetingInfo())),this.signalingSession.multiParty&&this.signalingSession.numberOfOriginalInvitees===0&&e.hasOwnProperty(n["default"].EXTENSIONS.SELF_PARTICIPANT_ROLE)&&e[n["default"].EXTENSIONS.SELF_PARTICIPANT_ROLE]===n["default"].ROLE.CALLER&&(t[n["default"].EXTENSIONS.IS_MEETUP_CALL]="true"),t},e}();t.NGCTelemetry=r,t.getLogger=i});var __assign=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/telemetry/telemetryHelper",["require","exports","../utilities/constants","../utilities/utils","../utilities/stopwatch","./ngcTelemetry","./telemetryConstants"],e)})(function(e,t){var n=e("../utilities/constants"),r=e("../utilities/utils"),i=e("../utilities/stopwatch"),s=e("./ngcTelemetry"),o=e("./telemetryConstants"),u=function(){function e(e){var t=this;this.callStartTime=(new Date).getTime(),this.networkRequestsCompleted=[],this.networkRequestsStarted={},this.networkRequests=[],this.localOperationsPerformed=[],this.recordedEvents=[],this.contentSharingOperationsPerformed={},this.outgoingModalities=[],this.incomingModalities=[],this.vbssOperations=[],this.vbssStarted=!1,this.localOfferAnswerGenerationTimestamps=[],this.trouterWaitOperations=[],this.telemetryData={},this.contentSharingBaseTelemetryData={},this.httpRequestTelemetryData={},this.connectedStopWatch=null,this.timeToRingStopWatch=null,this.addBrokerChannel=function(){t.setMessagingChannel(o["default"].MESSAGING_CHANNEL.BROKER)},this.addTrouterChannel=function(){t.setMessagingChannel(o["default"].MESSAGING_CHANNEL.TROUTER)},this.addTrouterWaitOperation=function(e){t.trouterWaitOperations.push(t.recordOperation(e))},this.recordIncomingEvent=function(e,r){var i="";r.headers&&typeof r.headers[n["default"].HEADERS.MESSAGE_ID]=="string"&&(i=r.headers[n["default"].HEADERS.MESSAGE_ID].split("-")[0]),t.recordEvent(e,{origin:r.origin,messageId:i})},this.recordEvent=function(e,n){t.logger.debug("Event:",e,n),t.localOperationsPerformed.push(t.recordOperation(e));var r={};r[e]=t.timeSinceCallStart(),n&&(r.data=n),t.recordedEvents.push(r)},this.addOutgoingModalities=function(e){e&&t.outgoingModalities.push(e)},this.addIncomingModalities=function(e){e&&t.incomingModalities.push(e)},this.addVbssOperations=function(e){e&&(e===o["default"].VBSS_OPERATION.START?t.vbssStarted=!0:t.vbssStarted=!1,t.vbssOperations.push(t.recordOperation(e)))},this.addNetworkOperationStarted=function(e){r.tryAddNewKeyToHashTable(t.networkRequestsStarted,e,t.recordOperation(e))},this.addNetworkOperationCompleted=function(e,n,i){var s=n?o["default"].RESULT_VALUE.SUCCESS:o["default"].RESULT_VALUE.FAILURE;t.networkRequestsCompleted.push(t.recordOperation(e+":"+s+":"+i)),r.tryRemoveKeyFromHashTable(t.networkRequestsStarted,e)},this.recordNetworkRequest=function(e){t.networkRequests.push(e)},this.addContentSharingOperation=function(e,n,r){t.contentSharingOperationsPerformed[e]||(t.contentSharingOperationsPerformed[e]=[]);var i=(o={},o[n]=t.timeSinceCallStart(),o);t.contentSharingOperationsPerformed[e].push(i);var s=t.contentSharingOperationsPerformed[e].length-1;r&&t.updateContentSharingOperation(e,s,r);return s;var o},this.updateContentSharingOperation=function(e,n,r){var i=t.contentSharingOperationsPerformed[e][n],s=[];for(var o in r)s.push(o+": "+r[o]);i.data=s.join(", ")},this.setDirection=function(e){t.telemetryData[o["default"].EXTENSIONS.DIRECTION]=e},this.setEndPointId=function(e){t.telemetryData[o["default"].CONTEXT_ID.ENDPOINTID]=e,t.contentSharingBaseTelemetryData[o["default"].CONTEXT_ID.ENDPOINTID]=e,t.httpRequestTelemetryData[o["default"].CONTEXT_ID.ENDPOINTID]=e},this.setParticipantId=function(e){t.telemetryData[o["default"].CONTEXT_ID.PARTICIPANTID]=e,t.contentSharingBaseTelemetryData[o["default"].CONTEXT_ID.PARTICIPANTID]=e,t.httpRequestTelemetryData[o["default"].CONTEXT_ID.PARTICIPANTID]=e},this.setConversationServiceUrl=function(e){t.telemetryData[o["default"].EXTENSIONS.CONVERSATION_SERVICE_URL]=e},this.setMeetingInfo=function(e){e||(t.telemetryData[o["default"].EXTENSIONS.MEETING_INFO]=e)},this.setRole=function(e){t.telemetryData[o["default"].EXTENSIONS.SELF_PARTICIPANT_ROLE]=e},this.setCallSignalingConfiguration=function(e){t.telemetryData[o["default"].SIGNALING_CONFIG.SUPPORTS_COMPRESSED_PAYLOAD]=e.supportsCompressedServicePayload,t.telemetryData[o["default"].SIGNALING_CONFIG.BROKER_OUTGOING_ENABLED]=e.brokerEnabledOutgoing,t.telemetryData[o["default"].SIGNALING_CONFIG.BROKER_INCOMING_ENABLED]=e.brokerEnabledIncoming,t.telemetryData[o["default"].SIGNALING_CONFIG.BROKER_REQUEST_BATCHING_ENABLED]=e.brokerRequestBatching,t.telemetryData[o["default"].SIGNALING_CONFIG.BROKER_EXCLUSIVELY_ENABLED]=e.brokerExclusively},this.setCallerType=function(e){if(!e)return;t.telemetryData[o["default"].EXTENSIONS.CALLER_TYPE]=e.split(":",1)[0]},this.setCalleeType=function(e){if(!e)return;t.telemetryData[o["default"].EXTENSIONS.CALLEE_TYPE]=e.split(":",1)[0]},this.setTerminatingData=function(e){t.telemetryData[o["default"].EXTENSIONS.CALL_TERMINATING_END]=e.terminatingEnd,t.telemetryData[o["default"].EXTENSIONS.CALL_END_CODE]=e.endCode||n["default"].CALL_END_CODE.SUCCESS,t.telemetryData[o["default"].EXTENSIONS.CALL_END_SUB_CODE]=e.endSubCode||n["default"].CALL_END_SUB_CODE.SUCCESS,t.telemetryData[o["default"].EXTENSIONS.RESULT_VALUE]=e.resultValue||o["default"].RESULT_VALUE.SUCCESS,t.telemetryData[o["default"].EXTENSIONS.RESULT_DETAIL]=e.resultDetail||"Call gracefully hungup"},this.startCallInitializationWatch=function(e){t.timeToRingStopWatch=i.build(),e&&(t.timeToRingStopWatch.msElapsed+=e)},this.startCallConnectedWatch=function(){t.connectedStopWatch=i.build()},this.setOfferAnswerGenerationTimestamps=function(e){t.localOfferAnswerGenerationTimestamps.push(t.recordOperation(e))},this.setTimeToRingDuration=function(){t.timeToRingStopWatch&&(t.telemetryData[o["default"].EXTENSIONS.TIME_TO_RING_IN_MS]=t.timeToRingStopWatch.duration(),t.timeToRingStopWatch=null)},this.dispose=function(){t.sendCallModalityTelemetryData(),t.sendHttpTelemetryData()},this.setMessagingChannel=function(e){t.telemetryData[o["default"].EXTENSIONS.MESSAGING_CHANNEL]||(t.telemetryData[o["default"].EXTENSIONS.MESSAGING_CHANNEL]=[]);var n=t.telemetryData[o["default"].EXTENSIONS.MESSAGING_CHANNEL].some(function(t){return t.indexOf(e)!==-1});n||t.telemetryData[o["default"].EXTENSIONS.MESSAGING_CHANNEL].push(t.recordOperation(e))},this.sendHttpTelemetryData=function(){var e=__assign({},t.httpRequestTelemetryData);e[o["default"].CONTEXT_ID.CORRELATIONID]=t.signalingSession.correlationId;if(t.networkRequests.length>0){var n=JSON.stringify({eventStart:t.callStartTime,events:t.networkRequests});e[o["default"].EXTENSIONS.NETWORK_REQUESTS_BAG]=n}t.logger.log("sending http request telemetry:",e),t.telemetryLogger.logHttpTelemetryEvent(e)},this.signalingSession=e,this.telemetryLogger=s.getLogger(e),this.logger=e.logger,this.telemetryData[o["default"].EXTENSIONS.CALL_START_TIME]=this.callStartTime,this.telemetryData[o["default"].EXTENSIONS.CONVERSATION_SERVICE_URL]=e.signalingAgentConfig.conversationServiceUrl}return e.prototype.addChangingCorrelationId=function(e,t){this.telemetryData[o["default"].EXTENSIONS.CHANGING_CORRELATION_ID_OLD_ID]=e,this.telemetryData[o["default"].EXTENSIONS.CHANGING_CORRELATION_ID_NEW_ID]=t},e.prototype.sendContentSharingTelemetryData=function(e,t,n,r,i){var s=__assign({},this.contentSharingBaseTelemetryData),u=this.contentSharingOperationsPerformed[e];u&&(s[o["default"].EXTENSIONS.EVENT_TIMESTAMP_BAG]=JSON.stringify(u)),s[o["default"].CONTEXT_ID.CONTENTSHARINGCORRELATIONID]=e,s[o["default"].CONTEXT_ID.CONTENTSHARINGID]=i||"",s[o["default"].EXTENSIONS.CONTENT_SHARING_SERVICE_URL]=r,s[o["default"].EXTENSIONS.CONTENT_SHARING_DIRECTION]=t?o["default"].DIRECTION.OUTGOING:o["default"].DIRECTION.INCOMING,s[o["default"].EXTENSIONS.CALL_END_CODE]=n.code,s[o["default"].EXTENSIONS.CALL_END_SUB_CODE]=n.subCode,delete this.contentSharingOperationsPerformed[e],this.telemetryLogger.logConversationContentSharingEvent(s)},e.prototype.recordOperation=function(e){return e+":"+this.timeSinceCallStart()},e.prototype.timeSinceCallStart=function(){return(new Date).getTime()-this.callStartTime},e.prototype.sendCallModalityTelemetryData=function(){this.vbssStarted&&this.addVbssOperations(o["default"].VBSS_OPERATION.CALL_END),this.telemetryData[o["default"].EXTENSIONS.CALL_END_TIME]=(new Date).getTime(),this.connectedStopWatch&&(this.telemetryData[o["default"].EXTENSIONS.CONNECTED_DURATION_IN_MS]=this.connectedStopWatch.duration()),this.networkRequestsCompleted.length>0&&(this.telemetryData[o["default"].EXTENSIONS.NETWORK_REQUESTS_COMPLETED]=JSON.stringify(this.networkRequestsCompleted)),this.localOperationsPerformed.length>0&&(this.telemetryData[o["default"].EXTENSIONS.LOCAL_OPERATIONS_PERFORMED]=JSON.stringify(this.localOperationsPerformed)),this.trouterWaitOperations.length>0&&(this.telemetryData[o["default"].EXTENSIONS.TROUTER_WAIT_OPERATIONS]=JSON.stringify(this.trouterWaitOperations)),this.localOfferAnswerGenerationTimestamps.length>0&&(this.telemetryData[o["default"].EXTENSIONS.LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS]=JSON.stringify(this.localOfferAnswerGenerationTimestamps)),this.incomingModalities.length>0&&(this.telemetryData[o["default"].EXTENSIONS.INCOMING_MODALITIES]=JSON.stringify(this.incomingModalities)),this.outgoingModalities.length>0&&(this.telemetryData[o["default"].EXTENSIONS.OUTGOING_MODALITIES]=JSON.stringify(this.outgoingModalities)),this.vbssOperations.length>0&&(this.telemetryData[o["default"].EXTENSIONS.VBSS_OPERATIONS]=JSON.stringify(this.vbssOperations));if(this.recordedEvents.length>0){var e=JSON.stringify({eventStart:this.callStartTime,events:this.recordedEvents});this.telemetryData[o["default"].EXTENSIONS.EVENT_TIMESTAMP_BAG]=e}var t=[];for(var n in this.networkRequestsStarted)this.networkRequestsStarted.hasOwnProperty(n)&&t.push(this.networkRequestsStarted[n]);t.length>0&&(this.telemetryData[o["default"].EXTENSIONS.NETWORK_REQUESTS_PENDING]=JSON.stringify(t)),this.logger.log("sending modality telemetry:",this.telemetryData),this.logger.log("isMultiPartyCall = "+this.signalingSession.multiParty+" isHostLessCall = "+this.signalingSession.isHostLessCall),this.telemetryLogger.logConversationCallModalityEvent(this.telemetryData)},e}();t.__esModule=!0,t["default"]=u});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/utilities/async",["require","exports"],e)})(function(e,t){function n(e){return new Promise(function(t){t(e())})}function o(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e}function u(e,t){t===void 0&&(t="deferred timed out after "+e+"ms");var n={},i=new s(function(){return n.reject(new r(t))});return n.promise=new Promise(function(e,t){n.resolve=function(t){i.stop(),e(t)},n.reject=function(e){i.stop(),t(e)}}),i.start(e),n}t.asap=n;var r=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return __extends(t,e),t}(Error);t.TimeoutError=r;var i=function(){function e(){}return e.build=function(e){return new s(e)},e}();t.TimerFactory=i;var s=function(){function e(e){this.ontimeout=e}return e.prototype.start=function(e){if(this.timeoutId)throw new Error("Timer already started");return this.timeoutId=setTimeout(this.ontimeout,e),this},e.prototype.stop=function(){if(!this.timeoutId)throw new Error("Timer is not defined");clearTimeout(this.timeoutId),this.timeoutId=null},e}();t.Timer=s,t.defer=o,t.timedDefer=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/brokerService",["require","exports","./utilities/async","./utilities/constants","./utilities/utils","./utilities/stopwatch","./telemetry/telemetryConstants"],e)}(function(e,t){var n=e("./utilities/async"),r=e("./utilities/constants"),i=e("./utilities/utils"),s=e("./utilities/stopwatch"),o=e("./telemetry/telemetryConstants"),u="http://broker.invalid/",a=30,f=5,l=7,c=6,h=function(){function e(e){var t=this;this._signalingSession=e,this.baseUrl=u,this._currentSubscriptionTimeoutInSec=a,this._subscribers=[],this._disposed=!1,this._reportedResultCount=0,this._subscriptionAttemptCount=0,this._subscriptionRetryBackoffInSec=f,this._notifySubscribers=function(e){t._logger.log("_notifySubscribers"),Promise.resolve().then(function(){var n=e.split(",");n.forEach(function(e){var n=i.decodeMessage(e),r=i.parseRawHttpMessage(n),s=r.body;i.isEncodedMessage(r.headers)&&i.isMessageEncodingSupported(r.headers)&&(s=i.decodeMessage(s));var o={url:r.url,body:JSON.parse(s),headers:r.headers};t._logger.log("_notifySubscribers, parsed request",o,", n. of subscribers",t._subscribers.length),t._subscribers.forEach(function(e){return e(o)})})})["catch"](function(e){t._logger.error("_notifySubscribers, failed to decode message",e),t._signalingSession.telemetryHelper.recordEvent(o.EVENTS.BROKER_DECODE_PAYLOAD_FAILURE)})},this._subscribeToBroker=function(e,n){if(t._disposed){t._logger.warn("_subscribeToBroker, disposed, ignore subscription");return}t._logger.log("_subscribeToBroker, url: ",e,",timeout in sec",n),t._currentSubscriptionUrl=e,t._currentSubscriptionTimeoutInSec=n,t._subscribeStopWatch=s.build(),t._subscriptionAttemptCount++,t._clearAllPendingTimeouts(),t._setSubscriptionTimeout(n),t._signalingSession.http.sendGetRequest({url:t._currentSubscriptionUrl,requestName:o.NETWORK_REQUESTS.BROKER_SUBSCRIBE,customHeaders:t._getBrokerRequestHeaders(),payload:null,retryIntervals:[100,200,500]}).then(t._handleSubscriptionSuccess)["catch"](t._handleSubscriptionFailure)},this._clearAllPendingTimeouts=function(){t._cancelRequestTimer&&(t._cancelRequestTimer.stop(),t._cancelRequestTimer=null),t._retryRequestTimer&&(t._retryRequestTimer.stop(),t._retryRequestTimer=null)},this._abortPendingRequest=function(){t._signalingSession.http.cancelRequestIfPending(o.NETWORK_REQUESTS.BROKER_SUBSCRIBE)},this._setSubscriptionTimeout=function(e){t._cancelRequestTimer=n.TimerFactory.build(function(){if(t._disposed)return;t._signalingSession.http.hasPendingRequest(o.NETWORK_REQUESTS.BROKER_SUBSCRIBE)?(t._logger.warn("timeout subscription"),t._signalingSession.telemetryHelper.recordEvent(o.EVENTS.BROKER_SUBSCRIPTION_TIMEOUT),t._signalingSession.http.cancelRequestIfPending(o.NETWORK_REQUESTS.BROKER_SUBSCRIBE)):t._logger.error("Unable to resolve timeout deferred, it is not defined!")}).start(e*1e3)},this._handleSubscriptionSuccess=function(e){t._logger.log("_handleSubscriptionSuccess");if(t._disposed){t._logger.warn("_handleSubscriptionSuccess, disposed, ignore subscription success");return}t._reportSubscriptionInTelemetry(e)&&t._signalingSession.telemetryHelper.recordEvent(o.EVENTS.BROKER_SUBSCRIPTION_SUCCESSFUL),t._subscriptionAttemptCount=0;if(e&&e.response){var n=e.response;t._logger.log("_handleSubscriptionSuccess, response",n),n.message&&t._notifySubscribers(n.message);var r=n.nextSubscribeUrl||t._currentSubscriptionUrl,i=n.expirationTimeInSec||t._currentSubscriptionTimeoutInSec;t._subscribeToBroker(r,i)}},this._handleSubscriptionFailure=function(e){if(t._disposed){t._logger.warn("_handleSubscriptionFailure, disposed, ignore subscription");return}if(t._subscriptionAttemptCount>c){t._logger.warn("_handleSubscriptionFailure, reached max subscription attempt, stop subscribing");return}var r=i.getPrintableObject(e);t._logger.error("_handleSubscriptionFailure failed",r),t._reportSubscriptionInTelemetry()&&t._signalingSession.telemetryHelper.recordEvent(o.EVENTS.BROKER_SUBSCRIPTION_FAILED),t._retryRequestTimer=n.TimerFactory.build(function(){t._subscribeToBroker(t._currentSubscriptionUrl,t._currentSubscriptionTimeoutInSec)}).start(t._subscriptionRetryBackoffInSec*1e3)},this._reportSubscriptionInTelemetry=function(e){return t._reportedResultCount++,t._reportedResultCount<=l},this._getBrokerRequestHeaders=function(){var e={};return e[r["default"].HEADERS.CORRELATION_ID]=t._signalingSession.correlationId,e[r["default"].HEADERS.MESSAGE_ID]=i.newGuid(),e[r["default"].HEADERS.CLIENT_USER_AGENT]=t._signalingSession.signalingAgentConfig.clientInformation,e[r["default"].HEADERS.CONTENT_TYPE]=r["default"].CONTENT_TYPE.JSON,t._signalingSession.signalingAgentConfig.brokerRequestBatching&&(e[r["default"].HEADERS.BROKER_USE_BATCHING_HEADER_NAME]="1"),e},this._logger=this._signalingSession.logger.createChild("Broker"),this._signalingSession.signalingAgentConfig.brokerRetryBackoffInSec&&(this._subscriptionRetryBackoffInSec=this._signalingSession.signalingAgentConfig.brokerRetryBackoffInSec)}return e.prototype.subscribeToBroker=function(e){this._abortPendingRequest(),this._clearAllPendingTimeouts(),this._subscribeToBroker(e,this._currentSubscriptionTimeoutInSec)},e.prototype.onBrokerMessage=function(e){this._logger.log("onBrokerMessage",e),this._subscribers.push(e)},e.prototype.dispose=function(){this._disposed=!0,this._logger.log("dispose"),this._subscribers=[],this._clearAllPendingTimeouts(),this._abortPendingRequest()},e}();t.__esModule=!0,t["default"]=h}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/utilities/urlBuilder",["require","exports","./utils","./constants"],e)}(function(e,t){function i(e,t){return n.assertNotNullOrEmpty(t,"trailingPath cannot be null"),n.assertNotNull(e,"signalingSession cannot be null"),n.assertNotNull(e.baseMessagingChannelUrl,"messaging channel url is not set"),e.baseMessagingChannelUrl+r["default"].URL_BASE.CALLAGENT+"/"+e.urlIdentifier+t}var n=e("./utils"),r=e("./constants");t.get=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/createConversationRequest",["require","exports","../utilities/utils","../utilities/urlBuilder","../utilities/constants"],e)}(function(e,t){function s(e,t,s,o){n.assertNotNull(e,"signalingSession cannot be null");var u=e.participantManager.getParticipantsToInitiateCallWith();e.signalingAgentConfig.doHostlessCalling||n.assert(u.length>0,"remoteParticipants need to be set before a call can be made");var a={type:"multiPartyEndpoint",rosterUpdate:r.get(e,i["default"].URL_PATH.CONV_ROSTER_UPDATE)},f=e.threadId?{threadId:e.threadId,messageId:e.teamsMessageId||null}:null,l=e.contentSharingManager.getContentSharingInfoToStartSharing(),c=l===null?null:{identifier:l.contentIdentifier,subject:l.subject,sessionState:l.sessionState,sessionUpdateSequenceNumber:l.sequenceNumber,links:{sessionUpdate:r.get(e,i["default"].URL_PATH.CONV_CONTENT_SHARING_UPDATE),sessionEnd:r.get(e,i["default"].URL_PATH.CONV_CONTENT_SHARING_END)}},h=o.enableLightWeightMeeting?e.lightWeightMeetingSession.getLightWeightMeetingInfoToStartViewing():null,p=e.broadcastSession.getContext();u.length!==1?n.assertNotNullOrEmpty(e.threadId,"threadId should be set prior to making a multiparty call"):e.telemetryHelper.setCalleeType(u[0].id),e.numberOfOriginalInvitees=u.length;var d=[];u.forEach(function(e){var t={id:e.id,displayName:e.displayName};o.callToVoicemail&&(t.endpointType="voicemail"),d.push(t)});var v=o.enableLightWeightMeeting&&s.length===0?null:n.getMediaTypes(s);e.telemetryHelper.addOutgoingModalities(v);var m=e.transferContext?e.transferContext.transferor:null,g={};o.callToVoicemail&&(o.voicemailResourcePath&&(g.localResourcePath=o.voicemailResourcePath),o.voicemailItemId&&(g.voicemailItemId=o.voicemailItemId));var y={payload:{callInvitation:{callModalities:v,replaces:null,transferor:m||null,links:{progress:r.get(e,i["default"].URL_PATH.PROGRESS),mediaAnswer:r.get(e,i["default"].URL_PATH.MEDIA_ANSWER),acceptance:r.get(e,i["default"].URL_PATH.ACCEPT),redirection:r.get(e,i["default"].URL_PATH.REDIRECTION),end:r.get(e,i["default"].URL_PATH.END)},clientContentForMediaController:e.webRtcSignalingManager.getClientUrls(),mediaContent:t,pstnContent:e.pstnContent,emergencyContent:e.getEmergencyContent(),voicemailSettings:g},conversationRequest:{conversationType:o.castCall?"cast":null,subject:e.convSubject,suppressDialout:o.suppressDialout,roster:a,properties:{allowConversationWithoutHost:e.signalingAgentConfig.doHostlessCalling,enableGroupCallEventMessages:e.signalingAgentConfig.shouldServiceSendCallEventMessages,enableGroupCallUpgradeMessage:e.signalingAgentConfig.shouldServiceSendNGCUpgradeMessages,enableGroupCallMeetupGeneration:e.enableGroupCallMeetupGeneration},links:{conversationEnd:r.get(e,i["default"].URL_PATH.CONV_END),conversationUpdate:r.get(e,i["default"].URL_PATH.CONV_UPDATE),addParticipantSuccess:r.get(e,i["default"].URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:r.get(e,i["default"].URL_PATH.CONV_ADD_PARTICIPANT_FAILURE),addModalitySuccess:r.get(e,i["default"].URL_PATH.CONV_ADD_MODALITY_SUCCESS),addModalityFailure:r.get(e,i["default"].URL_PATH.CONV_ADD_MODALITY_FAILURE),confirmUnmute:r.get(e,i["default"].URL_PATH.CONV_CONFIRM_UNMUTE)}},lwj:h,broadcast:p,contentSharing:c,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},to:d},capabilities:{implicitCallback:e.signalingAgentConfig.brokerEnabledOutgoing?"enabled":"disabled",cloudAudioVideoConference:e.signalingAgentConfig.isGVCOutgoingEnabled?"enabled":"disabled",cloudScreenSharing:e.signalingAgentConfig.cloudScreenSharingFlag,hostlessConference:e.signalingAgentConfig.supportsHostlessGroupCalls?"enabled":"disabled",autoJoinOnConflict:e.signalingAgentConfig.autoJoinOnConflict?"enabled":"disabled",serverMuteUnmute:e.signalingAgentConfig.serverMuteUnmute?"enabled":"disabled",supportsCompressedServicePayload:e.signalingAgentConfig.supportsCompressedServicePayload?"enabled":"disabled"},groupChat:f,meetingInfo:e.getMeetingInfo()}};return o.onBehalfOf&&(y.payload.callInvitation.onBehalfOf={id:o.onBehalfOf}),y}var n=e("../utilities/utils"),r=e("../utilities/urlBuilder"),i=e("../utilities/constants");t.getPayload=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/joinGivenConversationRequest",["require","exports","../utilities/utils","../utilities/urlBuilder","../utilities/constants"],e)}(function(e,t){function s(e,t,s,o){n.assertNotNull(e,"signalingSession cannot be null");var u=o.enableLightWeightMeeting&&s.length==0?null:n.getMediaTypes(s);e.telemetryHelper.addOutgoingModalities(u);var a=e.threadId?{threadId:e.threadId,messageId:e.teamsMessageId||null}:null,f=o.enableLightWeightMeeting?e.lightWeightMeetingSession.getLightWeightMeetingInfoToStartViewing():null,l={payload:{callInvitation:{callModalities:u,replaces:null,transferor:null,links:{progress:r.get(e,i["default"].URL_PATH.PROGRESS),mediaAnswer:r.get(e,i["default"].URL_PATH.MEDIA_ANSWER),acceptance:r.get(e,i["default"].URL_PATH.ACCEPT),redirection:r.get(e,i["default"].URL_PATH.REDIRECTION),end:r.get(e,i["default"].URL_PATH.END)},clientContentForMediaController:e.webRtcSignalingManager.getClientUrls(),mediaContent:t,pstnContent:e.pstnContent},conversationRequest:{conversationType:o.castCall?"cast":null,subject:e.convSubject,suppressDialout:o.suppressDialout,roster:{type:"multiPartyEndpoint",rosterUpdate:r.get(e,i["default"].URL_PATH.CONV_ROSTER_UPDATE)},properties:{allowConversationWithoutHost:e.signalingAgentConfig.doHostlessCalling,enableGroupCallEventMessages:e.signalingAgentConfig.shouldServiceSendCallEventMessages,enableGroupCallUpgradeMessage:e.signalingAgentConfig.shouldServiceSendNGCUpgradeMessages,enableGroupCallMeetupGeneration:e.enableGroupCallMeetupGeneration},links:{conversationEnd:r.get(e,i["default"].URL_PATH.CONV_END),conversationUpdate:r.get(e,i["default"].URL_PATH.CONV_UPDATE),addParticipantSuccess:r.get(e,i["default"].URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:r.get(e,i["default"].URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}},lwj:f,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},capabilities:{implicitCallback:e.signalingAgentConfig.brokerEnabledIncoming?"enabled":"disabled",cloudAudioVideoConference:e.signalingAgentConfig.isGVCJoiningEnabled?"enabled":"disabled",cloudScreenSharing:e.signalingAgentConfig.cloudScreenSharingFlag,hostlessConference:e.signalingAgentConfig.supportsHostlessGroupCalls?"enabled":"disabled",serverMuteUnmute:e.signalingAgentConfig.serverMuteUnmute?"enabled":"disabled",supportsCompressedServicePayload:e.signalingAgentConfig.supportsCompressedServicePayload?"enabled":"disabled"},groupChat:a,meetingInfo:e.getMeetingInfo()}};return l}var n=e("../utilities/utils"),r=e("../utilities/urlBuilder"),i=e("../utilities/constants");t.getPayload=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/subscribeToCallRequest",["require","exports","../utilities/utils","../utilities/urlBuilder","../utilities/constants"],e)}(function(e,t){function s(e){n.assertNotNull(e,"signalingSession cannot be null");var t=e.threadId?{threadId:e.threadId,messageId:e.teamsMessageId||null}:null,s={payload:{conversationRequest:{roster:{type:"multiPartyEndpoint",rosterUpdate:r.get(e,i["default"].URL_PATH.CONV_ROSTER_UPDATE)},links:{conversationEnd:r.get(e,i["default"].URL_PATH.CONV_END),conversationUpdate:r.get(e,i["default"].URL_PATH.CONV_UPDATE)}},participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},capabilities:{implicitCallback:e.signalingAgentConfig.brokerEnabledIncoming?"enabled":"disabled",cloudAudioVideoConference:e.signalingAgentConfig.isGVCJoiningEnabled?"enabled":"disabled",cloudScreenSharing:e.signalingAgentConfig.cloudScreenSharingFlag,hostlessConference:e.signalingAgentConfig.supportsHostlessGroupCalls?"enabled":"disabled",serverMuteUnmute:e.signalingAgentConfig.serverMuteUnmute?"enabled":"disabled"},groupChat:t,meetingInfo:e.getMeetingInfo()}};return s}var n=e("../utilities/utils"),r=e("../utilities/urlBuilder"),i=e("../utilities/constants");t.getPayload=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/leaveConversationRequest",["require","exports","../utilities/utils","../utilities/constants"],e)}(function(e,t){function i(e,t){n.assertNotNull(e,"signalingSession cannot be null"),n.assertCallEndReason(t);var i={payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,languageId:e.participantManager.localParticipant.languageId}},conversationTransactionEnd:{reason:"noError",code:r["default"].CALL_END_CODE.SUCCESS,phrase:r["default"].CALL_END_PHRASE.CONV_END_NO_MODALITY},callTransactionEnd:t}};return i}var n=e("../utilities/utils"),r=e("../utilities/constants");t.getPayload=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/deleteConversationRequest",["require","exports","../utilities/utils","../utilities/constants"],e)}(function(e,t){function i(e,t){n.assertNotNull(e,"signalingSession cannot be null"),n.assertCallEndReason(t);var i={payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,languageId:e.participantManager.localParticipant.languageId}},conversationTransactionEnd:{reason:"noError",code:r["default"].CALL_END_CODE.SUCCESS,phrase:r["default"].CALL_END_PHRASE.CONV_END_FOR_ALL_INITIATED},callTransactionEnd:t}};return i}var n=e("../utilities/utils"),r=e("../utilities/constants");t.getPayload=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/cancelCallRequest",["require","exports","../utilities/utils","../utilities/constants"],e)}(function(e,t){function i(e,t){n.assertNotNull(e,"signalingSession cannot be null"),n.assertCallEndReason(t);var i={payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,languageId:e.participantManager.localParticipant.languageId}},conversationTransactionEnd:{reason:"noError",code:r["default"].CALL_END_CODE.SUCCESS,phrase:r["default"].CALL_END_PHRASE.CONV_END_NO_MODALITY},callTransactionEnd:t}};return i}var n=e("../utilities/utils"),r=e("../utilities/constants");t.getPayload=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/endCallRequest",["require","exports","../utilities/utils"],e)}(function(e,t){function r(e,t){n.assertNotNull(e,"signalingSession cannot be null"),n.assertCallEndReason(t);var r={payload:{callEnd:t}};return r}var n=e("../utilities/utils");t.getPayload=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/callAcceptanceRequest",["require","exports","../utilities/utils","../utilities/urlBuilder","../utilities/constants"],e)}(function(e,t){function s(e,t,s){n.assertNotNull(e,"signalingSession cannot be null");var o=n.getMediaTypes(s);e.telemetryHelper.addOutgoingModalities(o);var u={payload:{callAcceptance:{acceptedBy:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},acceptedCallModalities:o,capabilities:{cloudAudioVideoConference:e.signalingAgentConfig.isGVCJoiningEnabled?"enabled":"disabled",cloudScreenSharing:e.signalingAgentConfig.cloudScreenSharingFlag,hostlessConference:e.signalingAgentConfig.supportsHostlessGroupCalls?"enabled":"disabled",serverMuteUnmute:e.signalingAgentConfig.serverMuteUnmute?"enabled":"disabled"},links:{mediaRenegotiation:r.get(e,i["default"].URL_PATH.MEDIA_RENEGOTIATION),transfer:r.get(e,i["default"].URL_PATH.TRANSFER),replacement:r.get(e,i["default"].URL_PATH.REPLACE),balanceUpdate:r.get(e,i["default"].URL_PATH.BALANCE_UPDATE),retargetCompletion:r.get(e,i["default"].URL_PATH.RETARGET_COMPLETION),controlVideoStreaming:r.get(e,i["default"].URL_PATH.CONTROL_VIDEO_STREAMING)},clientContentForMediaController:e.webRtcSignalingManager.getClientUrls(),mediaContent:t,pstnContent:e.pstnContent,callKeepAliveInterval:null}}};return u}var n=e("../utilities/utils"),r=e("../utilities/urlBuilder"),i=e("../utilities/constants");t.getPayload=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/rejectCallRequest",["require","exports","../utilities/utils"],e)}(function(e,t){function r(e,t){n.assertNotNull(e,"signalingSession cannot be null"),n.assertCallEndReason(t);var r={payload:{callEnd:t}};return r}var n=e("../utilities/utils");t.getPayload=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/attachAndJoinRequest",["require","exports","../utilities/utils","../utilities/urlBuilder","../utilities/constants"],e)}(function(e,t){function s(e,t){n.assertNotNull(e,"signalingSession cannot be null"),n.assertNotNull(t,"joinUrl cannot be null");var s={type:"multiPartyEndpoint",rosterUpdate:r.get(e,i["default"].URL_PATH.CONV_ROSTER_UPDATE)},o={payload:{attach:{requireMediaContent:!0,links:{end:r.get(e,i["default"].URL_PATH.END)}},capabilities:{implicitCallback:e.signalingAgentConfig.brokerEnabledIncoming?"enabled":"disabled",cloudAudioVideoConference:e.signalingAgentConfig.isGVCJoiningEnabled?"enabled":"disabled",cloudScreenSharing:e.signalingAgentConfig.cloudScreenSharingFlag,hostlessConference:e.signalingAgentConfig.supportsHostlessGroupCalls?"enabled":"disabled",serverMuteUnmute:e.signalingAgentConfig.serverMuteUnmute?"enabled":"disabled"},additionalActions:[{input:{capabilities:{cloudAudioVideoConference:e.signalingAgentConfig.isGVCJoiningEnabled?"enabled":"disabled",cloudScreenSharing:e.signalingAgentConfig.cloudScreenSharingFlag,hostlessConference:e.signalingAgentConfig.supportsHostlessGroupCalls?"enabled":"disabled",serverMuteUnmute:e.signalingAgentConfig.serverMuteUnmute?"enabled":"disabled"},conversationRequest:{roster:s,links:{conversationEnd:r.get(e,i["default"].URL_PATH.CONV_END),conversationUpdate:r.get(e,i["default"].URL_PATH.CONV_UPDATE),addParticipantSuccess:r.get(e,i["default"].URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:r.get(e,i["default"].URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}},participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}},name:"join",url:t,waitForResponse:!0}]}};return o}var n=e("../utilities/utils"),r=e("../utilities/urlBuilder"),i=e("../utilities/constants");t.getPayload=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/callProgressRequest",["require","exports","../utilities/utils"],e)}(function(e,t){function r(e){n.assertNotNull(e,"signalingSession cannot be null");var t={payload:{callProgress:{sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},status:"ringing",phrase:"ringing"}}};return t}var n=e("../utilities/utils");t.getPayload=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/callAcceptanceAcknowledgementRequest",["require","exports","../utilities/utils","../utilities/urlBuilder","../utilities/constants"],e)}(function(e,t){function s(e){n.assertNotNull(e,"signalingSession cannot be null");var t={payload:{callAcceptanceAcknowledgement:{links:{mediaRenegotiation:r.get(e,i["default"].URL_PATH.MEDIA_RENEGOTIATION),transfer:r.get(e,i["default"].URL_PATH.TRANSFER),replacement:r.get(e,i["default"].URL_PATH.REPLACE),balanceUpdate:r.get(e,i["default"].URL_PATH.BALANCE_UPDATE),retargetCompletion:r.get(e,i["default"].URL_PATH.RETARGET_COMPLETION),controlVideoStreaming:r.get(e,i["default"].URL_PATH.CONTROL_VIDEO_STREAMING)}}}};return t}var n=e("../utilities/utils"),r=e("../utilities/urlBuilder"),i=e("../utilities/constants");t.getPayload=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/participantUpdateRequest",["require","exports","../utilities/utils","../utilities/urlBuilder","../utilities/constants"],e)}(function(e,t){function s(e){n.assertNotNull(e,"signalingSession cannot be null");var t={payload:{callParticipantUpdate:{links:{mediaRenegotiation:r.get(e,i["default"].URL_PATH.MEDIA_RENEGOTIATION),transfer:r.get(e,i["default"].URL_PATH.TRANSFER),replacement:r.get(e,i["default"].URL_PATH.REPLACE),end:r.get(e,i["default"].URL_PATH.END),balanceUpdate:r.get(e,i["default"].URL_PATH.BALANCE_UPDATE),retargetCompletion:r.get(e,i["default"].URL_PATH.RETARGET_COMPLETION)},clientContentForMediaController:e.webRtcSignalingManager.getClientUrls()}}};return t}var n=e("../utilities/utils"),r=e("../utilities/urlBuilder"),i=e("../utilities/constants");t.getPayload=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/updateEndpointState",["require","exports","../utilities/utils"],e)}(function(e,t){function r(e,t){n.assertNotNull(t,"clientStateJson cannot be null");var r={payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},endpointState:t}};return r}var n=e("../utilities/utils");t.getPayload=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/updateParticipantConversationLinksRequest",["require","exports","../utilities/utils","../utilities/urlBuilder","../utilities/constants"],e)}(function(e,t){function s(e){n.assertNotNull(e,"signalingSession cannot be null");var t={payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}},roster:{type:"multiPartyEndpoint",rosterUpdate:r.get(e,i["default"].URL_PATH.CONV_ROSTER_UPDATE)},links:{conversationEnd:r.get(e,i["default"].URL_PATH.CONV_END),conversationUpdate:r.get(e,i["default"].URL_PATH.CONV_UPDATE),confirmUnmute:r.get(e,i["default"].URL_PATH.CONV_CONFIRM_UNMUTE)}}};return t}var n=e("../utilities/utils"),r=e("../utilities/urlBuilder"),i=e("../utilities/constants");t.getPayload=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/responses/provisionalMediaResponse",["require","exports","../utilities/utils"],e)}(function(e,t){function r(e,t){n.assertNotNull(e,"signalingSession cannot be null");var r={payload:{mediaAnswer:{sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},mediaContent:t,pstnContent:e.pstnContent}}};return r}var n=e("../utilities/utils");t.getPayload=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/transferCallRequest",["require","exports","../utilities/utils","../utilities/urlBuilder","../utilities/constants"],e)}(function(e,t){function s(e,t,s){n.assertNotNull(t,"signalingSession cannot be null"),n.assertNotNullOrEmpty(e,"transferTarget cannot be null OR empty");var o=s?{replaces:s.replaces}:null,u={payload:{callTransfer:{target:{id:e},transferor:{details:{id:t.participantManager.localParticipant.id,endpointId:t.participantManager.localParticipant.endpointId,participantId:t.participantManager.localParticipant.participantId,languageId:t.participantManager.localParticipant.languageId},authorizationToken:null},links:{transferAcceptance:r.get(t,i["default"].URL_PATH.TRANSFER_ACCEPTANCE),transferCompletion:r.get(t,i["default"].URL_PATH.TRANSFER_COMPLETION)},replacementDetails:o}}};return u}var n=e("../utilities/utils"),r=e("../utilities/urlBuilder"),i=e("../utilities/constants");t.getPayload=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/transferAcceptanceRequest",["require","exports"],e)}(function(e,t){function n(){var e={payload:{transferAcceptance:{}}};return e}t.getPayload=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/transferCompletionRequest",["require","exports"],e)}(function(e,t){function n(e){var t={payload:{transferCompletion:e}};return t}t.getPayload=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/addParticipantRequest",["require","exports","../utilities/utils","../utilities/urlBuilder","../utilities/constants"],e)}(function(e,t){function s(e,t,s){n.assertNotNull(e,"signalingSession cannot be null"),n.assertNotNull(t,"remoteParticipant cannot be null");var o={payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},to:[{id:t.id,assertedId:t.assertedId,displayName:t.displayName}]},participantInvitationData:s,links:{addParticipantSuccess:r.get(e,i["default"].URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:r.get(e,i["default"].URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}}};return o}var n=e("../utilities/utils"),r=e("../utilities/urlBuilder"),i=e("../utilities/constants");t.getPayload=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/addParticipantAndModalityRequest",["require","exports","../utilities/utils","../utilities/urlBuilder","../utilities/constants"],e)}(function(e,t){function s(e,t,s,o,u){n.assertNotNull(e,"signalingSession cannot be null"),n.assertNotNull(t,"remoteParticipant cannot be null"),n.assertNotNullOrEmpty(s,"threadId should be set prior to adding participant");var a={payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},to:[{id:t.id,assertedId:t.assertedId,displayName:t.displayName}]},participantInvitationData:u,groupChat:{threadId:s,messageId:o},links:{addParticipantSuccess:r.get(e,i["default"].URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:r.get(e,i["default"].URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}}};return a}var n=e("../utilities/utils"),r=e("../utilities/urlBuilder"),i=e("../utilities/constants");t.getPayload=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/admitParticipantRequest",["require","exports","../utilities/utils","../utilities/urlBuilder","../utilities/constants"],e)}(function(e,t){function s(e,t){n.assertNotNull(e,"signalingSession cannot be null"),n.assertNotNull(t,"remoteParticipant cannot be null"),n.assertNotNullOrEmpty(e.threadId,"threadId should be set prior to adding participant");var s={payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},to:[{id:t.id,displayName:t.displayName}]},links:{admitFailure:r.get(e,i["default"].URL_PATH.CONV_ADMIT_PARTICIPANT_FAILURE),admitSuccess:r.get(e,i["default"].URL_PATH.CONV_ADMIT_PARTICIPANT_SUCCESS)}}};return s}var n=e("../utilities/utils"),r=e("../utilities/urlBuilder"),i=e("../utilities/constants");t.getPayload=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/removeParticipantRequest",["require","exports","../utilities/utils","../utilities/urlBuilder","../utilities/constants"],e)}(function(e,t){function s(e,t){n.assertNotNull(e,"signalingSession cannot be null"),n.assertNotNull(t,"remoteParticipant cannot be null");var s={payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},to:[{id:t.id,displayName:t.displayName}]},links:{removeParticipantSuccess:r.get(e,i["default"].URL_PATH.CONV_REMOVE_PARTICIPANT_SUCCESS),removeParticipantFailure:r.get(e,i["default"].URL_PATH.CONV_REMOVE_PARTICIPANT_FAILURE)}}};return s}var n=e("../utilities/utils"),r=e("../utilities/urlBuilder"),i=e("../utilities/constants");t.getPayload=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/muteRequest",["require","exports","../utilities/utils"],e)}(function(e,t){function r(e,t,r){n.assertNotNull(e,"signalingSession cannot be null"),n.assertNotNull(t,"muteScope be null"),n.assertNotNull(r,"participantList cannot be null");var i={payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},scope:t,muteParticipants:r,mediaTypes:["audio"]}};return i}var n=e("../utilities/utils");t.getPayload=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/unmuteRequest",["require","exports","../utilities/utils","../utilities/urlBuilder","../utilities/constants"],e)}(function(e,t){function s(e){n.assertNotNull(e,"signalingSession cannot be null");var t={payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},mediaTypes:["audio"],links:{unmuteSuccess:r.get(e,i["default"].URL_PATH.CONV_UNMUTE_SUCCESS),unmuteFailure:r.get(e,i["default"].URL_PATH.CONV_UNMUTE_FAILURE)}}};return t}var n=e("../utilities/utils"),r=e("../utilities/urlBuilder"),i=e("../utilities/constants");t.getPayload=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/approveUnmuteRequest",["require","exports","../utilities/utils"],e)}(function(e,t){function r(e){n.assertNotNull(e,"signalingSession cannot be null");var t={payload:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},mediaTypes:["audio"]}};return t}var n=e("../utilities/utils");t.getPayload=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/rejectUnmuteRequest",["require","exports","../utilities/utils"],e)}(function(e,t){function r(e,t){n.assertNotNull(e,"signalingSession cannot be null"),n.assertCallEndReason(t);var r={payload:{transactionEnd:t}};return r}var n=e("../utilities/utils");t.getPayload=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/participantManager",["require","exports","./utilities/constants","./telemetry/telemetryConstants","./utilities/utils","./participant","./requests/addParticipantRequest","./requests/addParticipantAndModalityRequest","./requests/admitParticipantRequest","./requests/removeParticipantRequest","./requests/muteRequest","./requests/unmuteRequest","./requests/approveUnmuteRequest","./requests/rejectUnmuteRequest"],e)}(function(e,t){var n=e("./utilities/constants"),r=e("./telemetry/telemetryConstants"),i=e("./utilities/utils"),s=e("./participant"),o=e("./requests/addParticipantRequest"),u=e("./requests/addParticipantAndModalityRequest"),a=e("./requests/admitParticipantRequest"),f=e("./requests/removeParticipantRequest"),l=e("./requests/muteRequest"),c=e("./requests/unmuteRequest"),h=e("./requests/approveUnmuteRequest"),p=e("./requests/rejectUnmuteRequest"),d=function(){function e(e,t,s){var o=this;this.connectedRemoteParticipantIds={},this.disposed=!1,this.localAddParticipantRequests={},this.localRemoveParticipantRequests={},this.localAdmitParticipantRequests={},this.localCallMeBackRequests={},this.unmuteApprovalLinks={},this.setLocalParticipantId=function(e){e&&(o.localParticipant.participantId=e)},this.admitParticipantAsync=function(e,t){o.logger.log("admitParticipantAsync called for : "+e.id);var n=i.defer();return o.connectedRemoteParticipantIds.hasOwnProperty(e.id)===!1?(o.logger.error("unable to admit a participant that is not found in roster"+e.id),n.reject(new Error("the given participant is not found in roster"))):o.localAdmitParticipantRequests.hasOwnProperty(e.id)?(o.logger.error("there is an existing pending request to admit the participant : "+e.id),n.reject(new Error("there is an existing pending request to admit the participant"))):(i.tryAddNewKeyToHashTable(o.localAdmitParticipantRequests,e.id,{participant:e,promise:n}),o.sendNetworkRequestForAdmittingParticipant(e,t)),n.promise},this.addParticipantAsync=function(e,t,n,r,s,u){o.logger.log("addParticipantAsync called for : "+e.id);var a=i.defer();return o.connectedRemoteParticipantIds.hasOwnProperty(e.id)?(o.logger.error("the given participant is already connected to the call : "+e.id),a.reject(new Error("the given participant is already connected to the call"))):o.localAddParticipantRequests.hasOwnProperty(e.id)?(o.logger.error("there is an existing pending request to add the participant : "+e.id),a.reject(new Error("there is an existing pending request to add the participant"))):(i.tryAddNewKeyToHashTable(o.localAddParticipantRequests,e.id,{participant:e,promise:a}),n&&o.sendNetworkRequestForAddingParticipant(e,t,r,s,u)),a.promise},this.callMeBackAsync=function(e,t,n){o.logger.log("callMeBackAsync called for : "+e.id);var r=i.defer();return o.connectedRemoteParticipantIds.hasOwnProperty(e.id)?(o.logger.error("the given participant is already connected to the call : "+e.id),r.reject(new Error("the given participant is already connected to the call"))):o.localCallMeBackRequests.hasOwnProperty(e.id)?(o.logger.error("there is an existing pending request to call back the participant : "+e.id),r.reject(new Error("there is an existing pending request to call back the participant"))):(i.tryAddNewKeyToHashTable(o.localCallMeBackRequests,e.id,{participant:e,promise:r}),o.sendNetworkRequestForCallMeBack(e,t)),r.promise},this.removeParticipantAsync=function(e,t){o.logger.log("removeParticipantAsync called for : "+e.id),i.assertNotNullOrEmpty(t,"correct removeParticipantUrl is not provided");var s=i.defer();i.tryAddNewKeyToHashTable(o.localRemoveParticipantRequests,e.id,{participant:e,promise:s});var u=function(){o.signalingSession.timeoutManager.startTimer(n["default"].TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,function(){o.signalingSession.telemetryHelper.recordEvent(r.EVENTS.REMOVE_PARTICIPANT_TIMEOUT),o.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,e.id),o.rejectPromiseAndDeleteFromHashTable(o.localRemoveParticipantRequests,e.id,"timed out waiting for participant to not show up in roster",{code:n["default"].CALL_END_CODE.TIMEOUT,subCode:n["default"].CALL_END_SUB_CODE.CALL_PARTICIPANT_REMOVAL_TIMEOUT,phrase:n["default"].CALL_END_PHRASE.PARTICIPANT_REMOVAL_TIMEOUT})},e.id)};return o.signalingSession.http.sendPostRequest({url:t,payload:f.getPayload(o.signalingSession,e),requestName:r.NETWORK_REQUESTS.REMOVE_PARTICIPANT,onceTrouterReady:function(){return u()}})["catch"](function(t){o.logger.error("removeParticipantAsync failed because: "+i.getPrintableObject(t)),o.disposed||(o.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,e.id),o.rejectPromiseAndDeleteFromHashTable(o.localRemoveParticipantRequests,e.id,i.getPrintableObject(t),n["default"].CALL_END_NETWORK_ERROR))}),s.promise},this.getParticipantsToInitiateCallWith=function(){o.logger.log("getParticipantsToInitiateCallWith");var e=[];for(var t in o.localAddParticipantRequests)o.localAddParticipantRequests.hasOwnProperty(t)&&e.push(o.localAddParticipantRequests[t].participant);return e},this.initializeForIncomingCall=function(e){o.logger.log("initializeForIncomingCall"),o.rejectLocalQueuedOperations("incoming calls cannot add/remove participants until call is connected")},this.handleAddParticipantSuccess=function(e){var t=e.body;o.logger.log("handleAddParticipantSuccess : ",i.getPrintableObject(t)),o.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_ADD_PARTICIPANT_SUCCESS,e),o.hasPendingCallMeBackOperation(t)?o.internalHandleCallMeBackSuccess(t):o.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_ADD_PARTICIPANT_SUCCESS)},this.handleAddParticipantFailure=function(e){var t=e.body;o.logger.log(r.EVENTS.HANDLE_ADD_PARTICIPANT_FAILURE,i.getPrintableObject(t)),t.modalityFailure?(o.logger.error("handleAddParticipantFailure - got modalityFailure : "+i.getPrintableObject(t)),o.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_ADD_PARTICIPANT_MODALITY_FAILURE,e)):t.participants&&(o.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_ADD_PARTICIPANT_FAILURE,e),o.internalHandleAddParticipantFailure(t))},this.handleAdmitParticipantSuccess=function(e){var t=e.body;o.logger.log(r.EVENTS.HANDLE_ADMIT_PARTICIPANT_SUCCESS,i.getPrintableObject(t)),o.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_ADMIT_PARTICIPANT_SUCCESS,e)},this.handleAdmitParticipantFailure=function(e){var t=e.body;o.logger.log(r.EVENTS.HANDLE_ADMIT_PARTICIPANT_FAILURE,i.getPrintableObject(t)),t.participants&&(o.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_ADMIT_PARTICIPANT_FAILURE,e),o.internalHandleAdmitParticipantFailure(t))},this.handleRemoveParticipantFailure=function(e){var t=e.body;o.logger.log(r.EVENTS.HANDLE_REMOVE_PARTICIPANT_FAILURE,i.getPrintableObject(t)),o.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_REMOVE_PARTICIPANT_FAILURE,e);for(var n in t.participants)t.participants.hasOwnProperty(n)&&o.internalHandleRemoveParticipantFailure(n,t.participants[n])},this.handleRemoveParticipantSuccess=function(e){var t=e.body;o.logger.log(r.EVENTS.HANDLE_REMOVE_PARTICIPANT_SUCCESS,i.getPrintableObject(t)),o.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_REMOVE_PARTICIPANT_SUCCESS,e)},this.handleUnmuteConfirmRequest=function(e){var t=e.body;o.logger.log(r.EVENTS.HANDLE_UNMUTE_CONFIRM,i.getPrintableObject(t)),o.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_UNMUTE_CONFIRM,e),o.unmuteApprovalLinks[t.from.id]={approve:t.links.approveUnmute,reject:t.links.rejectUnmute},o.signalingSessionCallback.onUnmuteRequested(t.from.id)},this.approveUnmuteRequestAsync=function(e){o.logger.log("approveUnmuteRequestAsync");var t=i.defer();return o.unmuteApprovalLinks.hasOwnProperty(e)?(o.signalingSession.ensureMessageChannelReady(r.NETWORK_REQUESTS.APPROVE_UNMUTE).then(function(){o.muteUnmute(r.NETWORK_REQUESTS.APPROVE_UNMUTE,h.getPayload(o.signalingSession),t,o.unmuteApprovalLinks[e].approve)})["catch"](function(e){var n=i.getPrintableObject(e);o.logger.error("approveUnmuteRequestAsync failed because : "+n),t.reject(new Error(e))}),t.promise):(t.reject(new Error("no unmute links found for given participant")),t.promise)},this.rejectUnmuteRequestAsync=function(e,t){o.logger.log("rejectUnmuteRequestAsync");var s=i.defer();if(!o.unmuteApprovalLinks.hasOwnProperty(e))return s.reject(new Error("no unmute links found for given participant")),s.promise;var u=t||{code:n["default"].CALL_END_CODE.REJECT,subCode:n["default"].CALL_END_SUB_CODE.UNMUTE_REQUEST_REJECTED,phrase:n["default"].CALL_END_PHRASE.UNMUTE_REQUEST_REJECTED};return o.signalingSession.ensureMessageChannelReady(r.NETWORK_REQUESTS.REJECT_UNMUTE).then(function(){o.muteUnmute(r.NETWORK_REQUESTS.REJECT_UNMUTE,p.getPayload(o.signalingSession,u),s,o.unmuteApprovalLinks[e].reject)})["catch"](function(e){var t=i.getPrintableObject(e);o.logger.error("rejectUnmuteRequestAsync failed because : "+t),s.reject(new Error(e))}),s.promise},this.handleUnmuteFailure=function(e){var t=e.body;o.logger.log(r.EVENTS.HANDLE_UNMUTE_FAILURE,i.getPrintableObject(t)),o.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_UNMUTE_FAILURE,e)},this.handleUnmuteSuccess=function(e){var t=e.body;o.logger.log(r.EVENTS.HANDLE_UNMUTE_SUCCESS,i.getPrintableObject(t)),o.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_UNMUTE_SUCCESS,e)},this.handleRosterUpdate=function(e){o.logger.log("handleRosterUpdate : ",i.getPrintableObject(e));var t=o.getCurrentParticipantsInCallModality(!1);for(var n in e.participants)e.participants.hasOwnProperty(n)&&o.handleRosterParticipant(e.participants[n],t);o.checkForRemovedParticipants(t,e.participants)},this.muteAsync=function(e,t,s){o.logger.log("muteAsync called with :"+t);var u="specified",a=[];switch(t){case n["default"].MUTE_SCOPE.MYSELF:a.push({id:o.localParticipant.id});break;case n["default"].MUTE_SCOPE.EVERYONE_ELSE:u="all";break;case n["default"].MUTE_SCOPE.SPECIFIED_PARTICIPANTS:i.assertNotNullOrEmpty(s,"array of participantIds must be specified for SPECIFIED_PARTICIPANTS mute scope"),s.forEach(function(e){a.push({id:e})});break;default:i.assert(!1,"muteScope is a required param. please pass in a valid value.")}var f=i.defer();if(t===n["default"].MUTE_SCOPE.SPECIFIED_PARTICIPANTS){var c=o.areParticipantsConnectedToCall(s);if(!c.result)return f.reject(new Error("specified participant is not connected to call yet. Id = "+c.participant)),f.promise}return o.signalingSession.ensureMessageChannelReady(r.NETWORK_REQUESTS.MUTE).then(function(){o.muteUnmute(r.NETWORK_REQUESTS.MUTE,l.getPayload(o.signalingSession,u,a),f,e)})["catch"](function(e){var t=i.getPrintableObject(e);o.logger.error("muteAsync failed because : "+t),f.reject(new Error(e))}),f.promise},this.unmuteAsync=function(e){o.logger.log("unmuteAsync");var t=i.defer();return o.signalingSession.ensureMessageChannelReady(r.NETWORK_REQUESTS.UNMUTE).then(function(){o.muteUnmute(r.NETWORK_REQUESTS.UNMUTE,c.getPayload(o.signalingSession),t,e,!0)})["catch"](function(e){var n=i.getPrintableObject(e);o.logger.error("unmuteAsync failed because : "+n),t.reject(new Error(e))}),t.promise},this.dispose=function(e){o.logger.log("participantManager :: dispose"),o.disposed=!0,o.rejectLocalQueuedOperations("call ended",e),o.signalingSession.telemetryHelper.setParticipantId(o.localParticipant.participantId)},this.hasPendingCallMeBackOperation=function(e){if(e&&e.participants)for(var t=0;t<e.participants.length;t++)if(o.localCallMeBackRequests.hasOwnProperty(e.participants[t]))return!0;return!1},this.internalHandleCallMeBackSuccess=function(e){for(var t=0;t<e.participants.length;t++){var r=e.participants[t];if(o.localCallMeBackRequests.hasOwnProperty(r)){var i={id:r};o.logger.log("participant : "+r+" was successfully added. Resolving CallMeBack request"),o.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.CALL_ME_BACK,r),o.resolvePromiseAndDeleteFromHashTable(o.localCallMeBackRequests,i)}}},this.signalingSession=e,this.signalingSessionCallback=t,this.localParticipant=s,this.logger=e.logger,this.localParticipant.endpointId||(this.localParticipant.endpointId=i.newGuid()),this.localParticipant.participantId||(this.localParticipant.participantId=i.newGuid()),e.signalingAgentConfig.languageCode&&(this.localParticipant.languageId=e.signalingAgentConfig.languageCode),e.telemetryHelper.setEndPointId(this.localParticipant.endpointId)}return e.prototype.areParticipantsConnectedToCall=function(e){this.logger.log("areParticipantsConnectedToCall : "+i.getPrintableObject(e));var t=this.getCurrentParticipantsInCallModality(!0);for(var n=0;n<e.length;n++)if(!t.hasOwnProperty(e[n]))return this.logger.log("areParticipantsConnectedToCall : returning false for :"+e[n]),{result:!1,participant:e[n]};return this.logger.log("areParticipantsConnectedToCall : returning true"),{result:!0}},e.prototype.muteUnmute=function(e,t,s,o,u){var a=this;this.logger.log("muteUnmute called with operation : "+e),o?(u&&this.signalingSession.timeoutManager.startTimer(n["default"].TIMEOUT_OPERATIONS.UNMUTE,function(){a.signalingSession.telemetryHelper.recordEvent(r.EVENTS.UNMUTE_TIMEOUT),a.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.UNMUTE);var e=new Error("timed out waiting for response to request");e.endCode={code:n["default"].CALL_END_CODE.TIMEOUT,subCode:n["default"].CALL_END_SUB_CODE.UNMUTE_REQUEST_TIMEOUT,phrase:n["default"].CALL_END_PHRASE.UNMUTE_REQUEST_TIMEOUT},s.reject(e)}),this.signalingSession.http.sendPostRequest({url:o,payload:t,requestName:e,withoutTrouter:!0}).then(function(){a.disposed||s.resolve()})["catch"](function(e){var t=i.getPrintableObject(e);a.logger.error("mute/unmute failed because : "+t);if(!a.disposed){u&&a.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.UNMUTE);var r=new Error(e);r.endCode=n["default"].CALL_END_NETWORK_ERROR,s.reject(r)}})):s.reject(new Error("mute/unmute operation cannot be performed now, the link is not yet available"))},e.prototype.sendNetworkRequestForAddingParticipant=function(e,t,s,a,f){var l=this;if(t){var c=function(){l.signalingSession.timeoutManager.startTimer(n["default"].TIMEOUT_OPERATIONS.ADD_PARTICIPANT,function(){l.signalingSession.telemetryHelper.recordEvent(r.EVENTS.ADD_PARTICIPANT_TIMEOUT),l.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.ADD_PARTICIPANT,e.id),l.rejectPromiseAndDeleteFromHashTable(l.localAddParticipantRequests,e.id,"timed out waiting for participant to show up in roster",{code:n["default"].CALL_END_CODE.TIMEOUT,subCode:n["default"].CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:n["default"].CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT})},e.id)},h=a?u.getPayload(this.signalingSession,e,a,f,s):o.getPayload(this.signalingSession,e,s);this.signalingSession.http.sendPostRequest({url:t,payload:h,requestName:r.NETWORK_REQUESTS.ADD_PARTICIPANT,onceTrouterReady:function(){return c()}})["catch"](function(t){var r=i.getPrintableObject(t);l.logger.error("sendNetworkRequestForAddingParticipant failed because : "+r),l.disposed||(l.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.ADD_PARTICIPANT,e.id),l.rejectPromiseAndDeleteFromHashTable(l.localAddParticipantRequests,e.id,r,n["default"].CALL_END_NETWORK_ERROR))})}else this.logger.error("sendNetworkRequestForAddingParticipant failed because correct addParticipantUrl is not provided"),this.rejectPromiseAndDeleteFromHashTable(this.localAddParticipantRequests,e.id,"correct addParticipantUrl is not provided",{code:n["default"].CALL_END_CODE.LOCAL_ERROR,subCode:n["default"].CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:n["default"].CALL_END_PHRASE.ADD_PARTICIPANT_URL_MISSING})},e.prototype.sendNetworkRequestForCallMeBack=function(e,t){var s=this;if(t){var o=function(){s.signalingSession.timeoutManager.startTimer(n["default"].TIMEOUT_OPERATIONS.CALL_ME_BACK,function(){s.signalingSession.telemetryHelper.recordEvent(r.EVENTS.CALL_ME_BACK_TIMEOUT),s.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.CALL_ME_BACK,e.id),s.rejectPromiseAndDeleteFromHashTable(s.localCallMeBackRequests,e.id,"timed out waiting for call me back success response",{code:n["default"].CALL_END_CODE.TIMEOUT,subCode:n["default"].CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:n["default"].CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT})},e.id)};this.signalingSession.http.sendPostRequest({url:t,payload:u.getPayload(this.signalingSession,e,this.signalingSession.threadId,this.signalingSession.teamsMessageId),requestName:r.NETWORK_REQUESTS.CALL_ME_BACK,onceTrouterReady:function(){return o()}})["catch"](function(t){var r=i.getPrintableObject(t);s.logger.error("sendNetworkRequestForCallMeBack failed because : "+r),s.disposed||(s.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.CALL_ME_BACK,e.id),s.rejectPromiseAndDeleteFromHashTable(s.localCallMeBackRequests,e.id,r,n["default"].CALL_END_NETWORK_ERROR))})}else this.logger.error("sendNetworkRequestForCallMeBack failed because correct addParticipantUrl is not provided"),this.rejectPromiseAndDeleteFromHashTable(this.localCallMeBackRequests,e.id,"correct addParticipantUrl is not provided",{code:n["default"].CALL_END_CODE.LOCAL_ERROR,subCode:n["default"].CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:n["default"].CALL_END_PHRASE.ADD_PARTICIPANT_URL_MISSING})},e.prototype.sendNetworkRequestForAdmittingParticipant=function(e,t){var s=this;if(t){var o=function(){s.signalingSession.timeoutManager.startTimer(n["default"].TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,function(){s.signalingSession.telemetryHelper.recordEvent(r.EVENTS.ADMIT_PARTICIPANT_TIMEOUT),s.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,e.id),s.rejectPromiseAndDeleteFromHashTable(s.localAdmitParticipantRequests,e.id,"timed out waiting for participant to show up in roster",{code:n["default"].CALL_END_CODE.TIMEOUT,subCode:n["default"].CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:n["default"].CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT})},e.id)};this.signalingSession.http.sendPostRequest({url:t,payload:a.getPayload(this.signalingSession,e),requestName:r.NETWORK_REQUESTS.ADMIT_PARTICIPANT,onceTrouterReady:function(){return o()}})["catch"](function(t){var r=i.getPrintableObject(t);s.logger.error("sendNetworkRequestForAdmittingParticipant failed because : "+r),s.disposed||(s.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,e.id),s.rejectPromiseAndDeleteFromHashTable(s.localAdmitParticipantRequests,e.id,r,n["default"].CALL_END_NETWORK_ERROR))})}else this.logger.error("sendNetworkRequestForAdmittingParticipant failed because correct admitParticipantUrl is not provided"),this.rejectPromiseAndDeleteFromHashTable(this.localAdmitParticipantRequests,e.id,"correct admitParticipantUrl is not provided",{code:n["default"].CALL_END_CODE.LOCAL_ERROR,subCode:n["default"].CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:n["default"].CALL_END_PHRASE.ADMIT_PARTICIPANT_URL_MISSING})},e.prototype.handleRosterParticipant=function(e,t){this.logger.log("handleRosterParticipant for : "+e.details.id);if(e.details.id===this.localParticipant.id){this.updateLocalParticipant(e);return}var r=s["default"].fromRoster(e);if(r){i.tryAddNewKeyToHashTable(this.connectedRemoteParticipantIds,e.details.id,!0);var o=t.hasOwnProperty(r.id);o&&(t[r.id]=!1),this.localAddParticipantRequests.hasOwnProperty(r.id)&&this.isParticipantInCall(r)?(this.logger.log("participant : "+r.id+" appears in roster. Resolving AddParticipant request"),this.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.ADD_PARTICIPANT,r.id),this.resolvePromiseAndDeleteFromHashTable(this.localAddParticipantRequests,r)):this.localAdmitParticipantRequests.hasOwnProperty(r.id)&&this.isParticipantInCall(r)?(this.logger.log("participant : "+r.id+" appears in roster. Resolving AdmitParticipant request"),this.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,r.id),this.resolvePromiseAndDeleteFromHashTable(this.localAdmitParticipantRequests,r),this.checkForJoinedOrUpdatedParticipants(r,o)):this.checkForJoinedOrUpdatedParticipants(r,o)}},e.prototype.isParticipantInCall=function(e){return e.endpointDetails&&e.endpointDetails[0]&&!e.endpointDetails[0].isLobby},e.prototype.updateLocalParticipant=function(e){var t=this,n=s["default"].fromRoster(e);this.logger.log("updateLocalParticipant");if(n&&n.endpointDetails){var i=_.find(n.endpointDetails,function(e){return t.localParticipant.endpointId===e.endpointId}),o=_.find(this.localParticipant.endpointDetails,function(e){return t.localParticipant.endpointId===e.endpointId});i&&i.isLobby&&(!o||!o.isLobby)?this.signalingSession.telemetryHelper.recordEvent(r.EVENTS.IN_LOBBY):i&&!i.isLobby&&(!o||o.isLobby)&&this.signalingSession.telemetryHelper.recordEvent(r.EVENTS.CONNECTED)}n&&(this.localParticipant.displayName=n.displayName,this.localParticipant.languageId=n.languageId,this.localParticipant.endpointDetails=n.endpointDetails,this.localParticipant.acceptedBy=n.acceptedBy,this.localParticipant.role=n.role,this.localParticipant.tenantId=n.tenantId,this.signalingSessionCallback.onSelfParticipantUpdated(this.localParticipant))},e.prototype.checkForRemovedParticipants=function(e,t){this.logger.log("checkForRemovedParticipants");for(var r in e)e.hasOwnProperty(r)&&e[r]!==!1&&!this.localAddParticipantRequests.hasOwnProperty(r)&&(i.tryRemoveKeyFromHashTable(this.connectedRemoteParticipantIds,r),this.logger.log("firing onParticipantRemoved for : "+r),this.signalingSessionCallback.onParticipantRemoved({id:r}));var o=[];for(var u in t){var a=s["default"].fromRoster(t[u]);a&&a.endpointDetails&&a.endpointDetails.forEach(function(e){e.originalId&&o.push(e.originalId)})}for(var f in this.localRemoveParticipantRequests)this.localRemoveParticipantRequests.hasOwnProperty(f)&&o.indexOf(f)===-1&&!t.hasOwnProperty(f)&&(this.logger.log("participant : "+f+" no longer appears in roster. Resolving RemoveParticipant request"),i.tryRemoveKeyFromHashTable(this.connectedRemoteParticipantIds,f),this.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,f),this.resolvePromiseAndDeleteFromHashTable(this.localRemoveParticipantRequests,{id:f}))},e.prototype.checkForJoinedOrUpdatedParticipants=function(e,t){t?(this.logger.log("firing onParticipantUpated for : "+e.id),this.signalingSessionCallback.onParticipantUpdated(e)):this.localRemoveParticipantRequests.hasOwnProperty(e.id)?this.logger.log("ignoring participant : "+e.id+" who has been requested to be removed"):(this.logger.log("firing onParticipantJoined for : "+e.id),this.signalingSessionCallback.onParticipantJoined(e))},e.prototype.getCurrentParticipantsInCallModality=function(e){var t={};return this.signalingSessionCallback.getRemoteParticipantCollection().forEach(function(r){if(r.audioState===n["default"].PARTICIPANT_AUDIO_STATE.CONNECTED||!e&&r.audioState===n["default"].PARTICIPANT_AUDIO_STATE.CONNECTING)t[r.mri]=!0}),t},e.prototype.resolvePromiseAndDeleteFromHashTable=function(e,t){this.logger.log("resolvePromiseAndDeleteFromHashTable for : "+t.id);if(e.hasOwnProperty(t.id)){var n=e[t.id].promise;delete e[t.id],n.resolve(t)}},e.prototype.rejectPromiseAndDeleteFromHashTable=function(e,t,n,r){this.logger.log("rejectPromiseAndDeleteFromHashTable for : "+t+" reason : "+n);var i=new Error(n);r&&(i.endCode=r);if(e.hasOwnProperty(t)){var s=e[t].promise;delete e[t],s.reject(i)}},e.prototype.internalHandleRemoveParticipantFailure=function(e,t){if(this.localRemoveParticipantRequests.hasOwnProperty(e)){this.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,e),this.logger.log("participantRemove failed for : "+e+" reason : "+i.getPrintableObject(t));var r=this.getCallEndGivenParticipantFailure(t);this.rejectPromiseAndDeleteFromHashTable(this.localRemoveParticipantRequests,e,r.phrase,r)}},e.prototype.internalHandleAddParticipantFailure=function(e){for(var t in e.participants)if(e.participants.hasOwnProperty(t)&&this.localAddParticipantRequests.hasOwnProperty(t)){this.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.ADD_PARTICIPANT,t);var r=e.participants[t];this.logger.log("participantAdd failed for : "+t+" reason : "+i.getPrintableObject(r));var s=this.getCallEndGivenParticipantFailure(r);this.rejectPromiseAndDeleteFromHashTable(this.localAddParticipantRequests,t,s.phrase,s)}else if(e.participants.hasOwnProperty(t)&&this.localCallMeBackRequests.hasOwnProperty(t)){this.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.CALL_ME_BACK,t);var r=e.participants[t];this.logger.log("callMeBack failed for : "+t+" reason : "+i.getPrintableObject(r));var s=this.getCallEndGivenParticipantFailure(r);this.rejectPromiseAndDeleteFromHashTable(this.localCallMeBackRequests,t,s.phrase,s)}},e.prototype.internalHandleAdmitParticipantFailure=function(e){for(var t in e.participants)if(e.participants.hasOwnProperty(t)&&this.localAdmitParticipantRequests.hasOwnProperty(t)){this.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,t);var r=e.participants[t];this.logger.log("Admit participant failed for : "+t+" reason : "+i.getPrintableObject(r));var s=this.getCallEndGivenParticipantFailure(r);this.rejectPromiseAndDeleteFromHashTable(this.localAdmitParticipantRequests,t,s.phrase,s)}},e.prototype.getCallEndGivenParticipantFailure=function(e){var t={code:e.code,subCode:e.subCode,phrase:e.phrase};return e.code===n["default"].CALL_END_CODE.CALL_MODALITY_FAILURE&&e.callControllerTransactionEnd?t={code:e.callControllerTransactionEnd.code,subCode:e.callControllerTransactionEnd.subCode,phrase:e.callControllerTransactionEnd.phrase}:e.code===n["default"].CALL_END_CODE.ATC_CONTROLLER_FAILURE&&e.atcControllerTransactionEnd&&(t={code:e.atcControllerTransactionEnd.code,subCode:e.atcControllerTransactionEnd.subCode,phrase:e.atcControllerTransactionEnd.phrase}),t},e.prototype.rejectLocalQueuedOperations=function(e,t){this.logger.log("rejectLocalQueuedOperations");var r=t||{code:n["default"].CALL_END_CODE.SUCCESS,subCode:n["default"].CALL_END_SUB_CODE.SUCCESS,phrase:n["default"].CALL_END_PHRASE.LOCAL_USER_INITIATED};for(var i in this.localAddParticipantRequests)this.localAddParticipantRequests.hasOwnProperty(i)&&this.rejectPromiseAndDeleteFromHashTable(this.localAddParticipantRequests,i,e,r);for(var s in this.localCallMeBackRequests)this.localCallMeBackRequests.hasOwnProperty(s)&&this.rejectPromiseAndDeleteFromHashTable(this.localCallMeBackRequests,s,e,r);for(var o in this.localRemoveParticipantRequests)this.localRemoveParticipantRequests.hasOwnProperty(o)&&this.rejectPromiseAndDeleteFromHashTable(this.localRemoveParticipantRequests,o,e,r);this.localAddParticipantRequests={},this.localRemoveParticipantRequests={},this.connectedRemoteParticipantIds={}},e}();t.__esModule=!0,t["default"]=d}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/mediaRenegotiationRequest",["require","exports","../utilities/utils","../utilities/urlBuilder","../utilities/constants"],e)}(function(e,t){function s(e,t,s){n.assertNotNull(e,"signalingSession cannot be null");var o=[];s&&(o=n.getMediaTypes(s),e.telemetryHelper.addOutgoingModalities(o));var u={payload:{mediaNegotiation:{callModalities:o,sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},links:{mediaAnswer:r.get(e,i["default"].URL_PATH.MEDIA_ANSWER),rejection:r.get(e,i["default"].URL_PATH.MEDIA_REJECTION)},mediaContent:t}}};return u}var n=e("../utilities/utils"),r=e("../utilities/urlBuilder"),i=e("../utilities/constants");t.getPayload=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/responses/mediaRenegotiationResponse",["require","exports","../utilities/utils","../utilities/urlBuilder","../utilities/constants"],e)}(function(e,t){function s(e,t,s){n.assertNotNull(e,"signalingSession cannot be null");var o=[];s&&(o=n.getMediaTypes(s),e.telemetryHelper.addOutgoingModalities(o));var u={payload:{mediaAnswer:{callModalities:o,sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},links:{mediaAcknowledgement:r.get(e,i["default"].URL_PATH.MEDIA_ACKNOWLEDGEMENT)},clientContentForMediaController:e.webRtcSignalingManager.getClientUrls(),mediaContent:t},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId}}};return u}var n=e("../utilities/utils"),r=e("../utilities/urlBuilder"),i=e("../utilities/constants");t.getPayload=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/responses/mediaRenegotiationRejectionResponse",["require","exports","../utilities/utils"],e)}(function(e,t){function r(e,t){n.assertNotNull(e,"signalingSession cannot be null"),n.assertCallEndReason(t);var r={payload:{mediaNegotiationFailure:{sender:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},code:t.code,subCode:t.subCode,phrase:t.phrase},debugContent:{callId:e.correlationId,endpointId:e.participantManager.localParticipant.endpointId}}};return r}var n=e("../utilities/utils");t.getPayload=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/mediaRenegotiationManager",["require","exports","./utilities/constants","./telemetry/telemetryConstants","./utilities/utils","./requests/mediaRenegotiationRequest","./responses/mediaRenegotiationResponse","./responses/mediaRenegotiationRejectionResponse"],e)}(function(e,t){var n=e("./utilities/constants"),r=e("./telemetry/telemetryConstants"),i=e("./utilities/utils"),s=e("./requests/mediaRenegotiationRequest"),o=e("./responses/mediaRenegotiationResponse"),u=e("./responses/mediaRenegotiationRejectionResponse"),a=function(){function e(e,t){var u=this;this.vbssInitiated=!1,this.disposed=!1,this.fsmState=n["default"].MEDIA_RENEGOTIATION_FSM_STATE.IDLE,this.glareError={code:n["default"].CALL_END_CODE.GLARE_ERROR,subCode:n["default"].CALL_END_SUB_CODE.GLARE_ERROR,phrase:n["default"].CALL_END_PHRASE.RENEGOTIATION_IN_PROGRESS},this.links={},this.renegotiationOffersSeenSoFar=[],this.isOutgoingRenegotiationInProgress=function(){return u.fsmState===n["default"].MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION||u.fsmState===n["default"].MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE},this.isIncomingRenegotiationInProgress=function(){return u.fsmState===n["default"].MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION||u.fsmState===n["default"].MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE},this.acceptRenegotiationAsync=function(e,t){u.logger.log("acceptRenegotiationAsync"),t&&u.logger.log("acceptRenegotiationAsync called with mediaTypes : "+i.getPrintableObject(t)),u.signalingSession.telemetryHelper.recordEvent(r.EVENTS.ACCEPT_RENEGOTIATION),i.assertNotNullOrEmpty(u.links[n["default"].LINKS.MEDIA_ANSWER],"MediaAnswer link not set");var s=i.defer();switch(u.fsmState){case n["default"].MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:u.fsmState=n["default"].MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED;break;case n["default"].MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:u.fsmState=n["default"].MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION;break;default:return u.logger.log("there is no incoming media renegotiation offer to accept "),s.reject(new Error("there is no incoming media renegotiation offer to accept")),s.promise}var a=function(){u.signalingSession.timeoutManager.startTimer(n["default"].TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT,u.handleMediaAnswerAcknowledgmentTimeout.bind(u))};return u.signalingSession.http.sendPostRequest({url:u.links[n["default"].LINKS.MEDIA_ANSWER],payload:o.getPayload(u.signalingSession,e,t),requestName:r.NETWORK_REQUESTS.SEND_MEDIA_ANSWER,onceTrouterReady:function(){return a()}}).then(function(e){s.resolve(e.response)})["catch"](function(e){var t=i.getPrintableObject(e);u.logger.error("acceptRenegotiationAsync failed because : "+t),u.disposed||u.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT),s.reject(new Error("acceptRenegotiationAsync failed because : "+t))}),s.promise},this.startRenegotiationAsync=function(e,t,o){u.logger.log("startRenegotiationAsync called "),u.signalingSession.telemetryHelper.recordEvent(r.EVENTS.START_RENEGOTIATION),i.assertNotNullOrEmpty(t,"MediaRenegotiation link not set");var a=i.defer();switch(u.fsmState){case n["default"].MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED:u.fsmState=n["default"].MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION;break;case n["default"].MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:case n["default"].MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:case n["default"].MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:return u.logger.log("media renegotiation can only be performed with no current outstanding renegotiations."),u.signalingSessionCallback.onMediaRenegotiationRejection(u.glareError),Promise.resolve(null);default:return u.logger.log("media renegotiation can only be performed on an established call"),a.reject(new Error("media renegotiation can only be performed on an established call")),a.promise}var f=o&&i.arrayContains(o,n["default"].MEDIA_TYPES.SCREEN_SHARER);f?(u.vbssInitiated=!0,u.signalingSession.telemetryHelper.addVbssOperations(r["default"].VBSS_OPERATION.START)):!f&&u.vbssInitiated&&(u.vbssInitiated=!1,u.signalingSession.telemetryHelper.addVbssOperations(r["default"].VBSS_OPERATION.STOP));var l=function(){u.signalingSession.timeoutManager.startTimer(n["default"].TIMEOUT_OPERATIONS.MEDIA_ANSWER,u.handleMediaAnswerTimeout.bind(u))};return u.signalingSession.http.sendPostRequest({url:t,payload:s.getPayload(u.signalingSession,e,o),requestName:r.NETWORK_REQUESTS.START_RENEGOTIATION,onceTrouterReady:function(){return l()}}).then(function(e){a.resolve(e.response)})["catch"](function(e){var t=i.getPrintableObject(e);u.logger.error("startRenegotiationAsync failed because : "+t);if(!u.disposed){switch(u.fsmState){case n["default"].MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:u.fsmState=n["default"].MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED;break;case n["default"].MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:u.fsmState=n["default"].MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION;break;default:}u.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.MEDIA_ANSWER)}a.reject(new Error("startRenegotiationAsync failed because : "+t))}),a.promise},this.handleMediaAcknowledgment=function(e){u.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_MEDIA_ACKNOWLEDGEMENT),u.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT),u.signalingSession.saveMediaControllerLinksIfAny(e),u.signalingSession.saveUpdatedCallLinksIfAny(e),u.signalingSessionCallback.onMediaAcknowledgementSuccess(!0)},this.onCallConnected=function(){u.logger.log("onCallConnected"),u.fsmState=n["default"].MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED},this.handleMediaNegotiationFailure=function(e){u.handleMediaNegotiationFailureInternal(e.body.mediaNegotiationFailure,e.origin)},this.handleMediaAnswer=function(e){u.logger.log("handleMediaAnswer called"),u.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_MEDIA_ANSWER);switch(u.fsmState){case n["default"].MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:u.fsmState=n["default"].MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED;break;case n["default"].MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:u.fsmState=n["default"].MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION;break;default:return}u.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.MEDIA_ANSWER);var t=[];e.mediaAnswer.callModalities&&e.mediaAnswer.callModalities.length>0&&(t=i.getMediaTypes(e.mediaAnswer.callModalities),u.signalingSession.telemetryHelper.addIncomingModalities(t));var s={provisional:!1,renegotiation:!0,mediaTypes:t,remoteParticipantId:u.signalingSession.getParticipantIdForOfferAnswer(e.mediaAnswer.mediaContent),mediaContent:e.mediaAnswer.mediaContent};u.signalingSession.http.sendPostRequest({url:e.mediaAnswer.links.mediaAcknowledgement,payload:null,requestName:r.NETWORK_REQUESTS.SEND_MEDIA_ACKNOWLEDGEMENT})["catch"](function(e){u.logger.error("handleMediaAnswer failed because: "+i.getPrintableObject(e)),u.signalingSession.disposed||u.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_MEDIA_ANSWER_FAILED)}),u.signalingSessionCallback.onAnswer(s)},this.handleMediaNegotiationOffer=function(e){var t=e.body,s=e.headers;u.logger.log(r.EVENTS.HANDLE_MEDIA_OFFER),u.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_MEDIA_OFFER,{origin:e.origin});var o=i.isDuplicateMessage(s,u.renegotiationOffersSeenSoFar);switch(u.fsmState){case n["default"].MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:u.fsmState=n["default"].MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE,u.raiseMediaRenegotiationOffer(t);break;case n["default"].MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED:u.fsmState=n["default"].MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION,u.raiseMediaRenegotiationOffer(t);break;default:u.logger.error("Cannot handle the incoming mediaRenegotiation offer in present callstate. Either call not connected or renegotiation in progress. isDuplicateOffer = "+o),o||u.rejectMediaRenegotiation(t.mediaNegotiation.links.rejection,u.glareError)}},this.rejectRenegotiationAsync=function(e){u.logger.log("rejectRenegotiationAsync called"),u.signalingSession.telemetryHelper.recordEvent(r.EVENTS.REJECT_RENEGOTIATION),i.assertNotNullOrEmpty(u.links[n["default"].LINKS.MEDIA_REJECTION],"MediaRejection link not set");var t=e||{code:n["default"].CALL_END_CODE.NOT_ACCEPTABLE_HERE,subCode:n["default"].CALL_END_SUB_CODE.MEDIA_ANSWER_PROCESSING_ERROR,phrase:n["default"].CALL_END_PHRASE.MEDIA_ANSWER_ERROR};switch(u.fsmState){case n["default"].MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:return u.fsmState=n["default"].MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,u.rejectMediaRenegotiation(u.links[n["default"].LINKS.MEDIA_REJECTION],t);case n["default"].MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:return u.fsmState=n["default"].MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION,u.rejectMediaRenegotiation(u.links[n["default"].LINKS.MEDIA_REJECTION],t);default:return u.logger.error("There is no incoming media renegotiation offer to reject"),Promise.resolve(null)}},this.handleRetargetCompleted=function(e){var t=e.body.retargetCompleted;u.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_RETARGET_COMPLETED,e);var n=i.getPrintableObject(t);u.logger.log("handleRetargetCompleted called with : "+n),t.code===0?u.signalingSessionCallback.onReTargetCompletedSuccess():u.signalingSessionCallback.onReTargetCompletedFailure(n)},this.dispose=function(){u.logger.log("mediaRenegotiationManager :: dispose"),u.disposed=!0},this.handleMediaNegotiationFailureInternal=function(e,t){u.logger.log(r.EVENTS.HANDLE_MEDIA_NEGOTIATION_FAILURE,i.getPrintableObject(e)),u.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_MEDIA_NEGOTIATION_FAILURE,{origin:t}),u.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.MEDIA_ANSWER);switch(u.fsmState){case n["default"].MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:u.fsmState=n["default"].MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED;break;case n["default"].MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:u.fsmState=n["default"].MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION;break;default:return}u.vbssInitiated&&(u.vbssInitiated=!1,u.signalingSession.telemetryHelper.addVbssOperations(r["default"].VBSS_OPERATION.REJECTED)),u.signalingSession.telemetryHelper.addIncomingModalities(["Rejected"]),u.signalingSessionCallback.onMediaRenegotiationRejection({code:e.code,subCode:e.subCode,phrase:e.phrase})},this.signalingSession=e,this.signalingSessionCallback=t,this.logger=e.logger.createChild(function(){return"["+u.fsmState+"]"})}return e.prototype.raiseMediaRenegotiationOffer=function(e){this.logger.log("raiseMediaRenegotiationOffer"),this.links[n["default"].LINKS.MEDIA_ANSWER]=e.mediaNegotiation.links.mediaAnswer,this.links[n["default"].LINKS.MEDIA_REJECTION]=e.mediaNegotiation.links.rejection;var t=[];e.mediaNegotiation.callModalities&&e.mediaNegotiation.callModalities.length>0&&(t=i.getMediaTypes(e.mediaNegotiation.callModalities),this.signalingSession.telemetryHelper.addIncomingModalities(t),i.arrayContains(t,n["default"].MEDIA_TYPES.SCREEN_SHARER)&&this.signalingSession.telemetryHelper.addVbssOperations(r["default"].VBSS_OPERATION.REMOTE_START));var s={mediaTypes:t,remoteParticipantId:this.signalingSession.getParticipantIdForOfferAnswer(e.mediaNegotiation.mediaContent),mediaContent:e.mediaNegotiation.mediaContent,renegotiation:!0};this.signalingSessionCallback.onOffer(s)},e.prototype.rejectMediaRenegotiation=function(e,t){this.logger.log("rejectMediaRenegotiation");var n=i.defer();return this.signalingSession.http.sendPostRequest({url:e,payload:u.getPayload(this.signalingSession,t),requestName:r.NETWORK_REQUESTS.SEND_MEDIA_REJECTION}).then(function(e){n.resolve(e.response)})["catch"](function(e){n.reject(new Error("rejectMediaRenegotiation failed because : "+i.getPrintableObject(e)))}),n.promise},e.prototype.handleMediaAnswerTimeout=function(){this.logger.log("handleMediaAnswerTimeout"),this.vbssInitiated&&(this.vbssInitiated=!1,this.signalingSession.telemetryHelper.addVbssOperations(r["default"].VBSS_OPERATION.TIMEOUT)),this.signalingSession.telemetryHelper.addIncomingModalities(["Timeout"]),this.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_MEDIA_ANSWER_TIMEOUT),this.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.MEDIA_ANSWER),this.handleMediaNegotiationFailureInternal({code:n["default"].CALL_END_CODE.TIMEOUT,subCode:n["default"].CALL_END_SUB_CODE.MEDIA_FINAL_ANSWER_TIMEOUT,phrase:n["default"].CALL_END_PHRASE.MEDIA_FINAL_ANSWER_TIMEOUT},r["default"].EVENT_SOURCE.LOCAL)},e.prototype.handleMediaAnswerAcknowledgmentTimeout=function(){this.logger.log("handleMediaAnswerAcknowledgmentTimeout"),this.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_MEDIA_ACKNOWLEDGEMENT_TIMEOUT),this.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT),this.signalingSessionCallback.onMediaAcknowledgementFailure(!0,new Error("timed out waiting for Media Answer Acknowledgement"))},e}();t.__esModule=!0,t["default"]=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/addContentSharingModalityRequest",["require","exports","../utilities/constants","../utilities/utils","../utilities/urlBuilder"],e)}(function(e,t){function s(e,t){r.assertNotNull(e,"signalingSession cannot be null"),r.assertNotNull(t,"content cannot be null");var s={payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId},to:[]},contentSharing:{identifier:t.contentIdentifier,subject:t.subject,sessionState:t.sessionState,sequenceNumber:t.sequenceNumber,links:{sessionUpdate:i.get(e,n["default"].URL_PATH.CONV_CONTENT_SHARING_UPDATE),sessionEnd:i.get(e,n["default"].URL_PATH.CONV_CONTENT_SHARING_END)}},links:{addModalitySuccess:i.get(e,n["default"].URL_PATH.CONV_ADD_MODALITY_SUCCESS),addModalityFailure:i.get(e,n["default"].URL_PATH.CONV_ADD_MODALITY_FAILURE)}}};return s}var n=e("../utilities/constants"),r=e("../utilities/utils"),i=e("../utilities/urlBuilder");t.getPayload=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/joinContentSharingRequest",["require","exports","../utilities/utils","../utilities/urlBuilder","../utilities/constants"],e)}(function(e,t){function s(e){n.assertNotNull(e,"signalingSession cannot be null");var t={payload:{contentSharing:{links:{sessionUpdate:r.get(e,i["default"].URL_PATH.CONV_CONTENT_SHARING_UPDATE),sessionEnd:r.get(e,i["default"].URL_PATH.CONV_CONTENT_SHARING_END)}},participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}};return t}var n=e("../utilities/utils"),r=e("../utilities/urlBuilder"),i=e("../utilities/constants");t.getPayload=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/leaveContentSharingRequest",["require","exports","../utilities/utils"],e)}(function(e,t){function r(e,t){n.assertNotNull(e,"signalingSession cannot be null"),n.assertCallEndReason(t);var r={payload:{contentSharingTransactionEnd:t,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}};return r}var n=e("../utilities/utils");t.getPayload=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/takeControlContentSharingRequest",["require","exports","../utilities/utils"],e)}(function(e,t){function r(e){n.assertNotNull(e,"signalingSession cannot be null");var t={payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}};return t}var n=e("../utilities/utils");t.getPayload=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/updateContentSharingNotificationLinksRequest",["require","exports","../utilities/utils","../utilities/urlBuilder","../utilities/constants"],e)}(function(e,t){function s(e){n.assertNotNull(e,"signalingSession cannot be null");var t={payload:{links:{sessionUpdate:r.get(e,i["default"].URL_PATH.CONV_CONTENT_SHARING_UPDATE),sessionEnd:r.get(e,i["default"].URL_PATH.CONV_CONTENT_SHARING_END)}}};return t}var n=e("../utilities/utils"),r=e("../utilities/urlBuilder"),i=e("../utilities/constants");t.getPayload=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/updateContentSharingParticipantStateRequest",["require","exports","../utilities/utils"],e)}(function(e,t){function r(e){n.assertNotNull(e,"signalingSession cannot be null");var t={payload:{participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}};return t}var n=e("../utilities/utils");t.getPayload=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/updateContentSharingSessionStateRequest",["require","exports","../utilities/utils"],e)}(function(e,t){function r(e,t,r){n.assertNotNull(e,"signalingSession cannot be null"),n.assertNotNull(t,"sessionState cannot be null"),n.assertNotNull(r,"sequenceNumber cannot be null");var i={payload:{sessionUpdateSequenceNumber:r,sessionState:t,participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}};return i}var n=e("../utilities/utils");t.getPayload=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/contentSharingSession",["require","exports","./requests/addContentSharingModalityRequest","./requests/joinContentSharingRequest","./requests/leaveContentSharingRequest","./utilities/stopwatch","./requests/takeControlContentSharingRequest","./requests/updateContentSharingNotificationLinksRequest","./requests/updateContentSharingParticipantStateRequest","./requests/updateContentSharingSessionStateRequest","./utilities/utils","./utilities/constants","./telemetry/telemetryConstants"],e)}(function(e,t){var n=e("./requests/addContentSharingModalityRequest"),r=e("./requests/joinContentSharingRequest"),i=e("./requests/leaveContentSharingRequest"),s=e("./utilities/stopwatch"),o=e("./requests/takeControlContentSharingRequest"),u=e("./requests/updateContentSharingNotificationLinksRequest"),a=e("./requests/updateContentSharingParticipantStateRequest"),f=e("./requests/updateContentSharingSessionStateRequest"),l=e("./utilities/utils"),c=e("./utilities/constants"),h=e("./telemetry/telemetryConstants"),p=function(){function e(e,t,n,r){var i=this;this.signalingSession=e,this.correlationId=t,this.sessionId=null,this.fsmState=c["default"].CONTENT_SHARING_FSM_STATE.IDLE,this.addSessionPromise=null,this.removeSessionPromise=null,this.links={},this.lastUpdateSequenceNumber=-1,this.nextClientSequenceNumberToUse=1,this.disposed=!1,this.isPresenter=!1,this.FSM_STATES=c["default"].CONTENT_SHARING_FSM_STATE,this.logger=e.logger.createChild(function(){return"["+i.fsmState+"]"+"[cs="+i.sessionId+"]"+"[cc="+i.correlationId+"]"}),n&&(this.sessionId=n),r&&(this.links=r)}return e.prototype.start=function(e,t,r){var i=this;return this.logger.log("start"),l.assertNotNullOrEmpty(e,"Correct addModality url is not provided"),this.checkState("start",this.FSM_STATES.IDLE,this.addSessionPromise)?(this.addSessionPromise=r,this.fsmState=this.FSM_STATES.CONTENT_SHARING_START_INITIATED,this.addTelemetryOperation(h.NETWORK_REQUESTS.ADD_CONTENT_SHARING_MODALITY),this.signalingSession.http.sendPostRequest({url:e,payload:n.getPayload(this.signalingSession,t),requestName:h.NETWORK_REQUESTS.ADD_CONTENT_SHARING_MODALITY,contentSharingCorrelationId:this.correlationId,onceTrouterReady:function(){return i.startContentSharingTimer()}}).then(function(){i.disposed||(i.isPresenter=!0)})["catch"](function(e){return i.logger.error("start failed because: "+l.getPrintableObject(e)),i.disposed||(i.signalingSession.timeoutManager.stopTimer(c["default"].TIMEOUT_OPERATIONS.ADD_MODALITY),i.rejectPendingPromise(e,l.getErrorForXHRFailure(e).error)),Promise.reject(null)})):Promise.reject(null)},e.prototype["delete"]=function(e){var t=this;this.logger.log("delete");var n=!1;if(this.fsmState===this.FSM_STATES.IDLE)return this.logger.log("delete skipped because state is already "+this.fsmState),e.resolve(),Promise.resolve();if(this.fsmState===this.FSM_STATES.CONTENT_SHARING_START_INITIATED)n=!0,this.rejectPendingPromise("Session delete called before start was finished");else if(!this.checkState("delete",this.FSM_STATES.CONTENT_SHARING_CONNECTED,e))return Promise.reject(null);n||l.assertNotNullOrEmpty(this.links[c["default"].LINKS.CONTENT_SHARING_CONTROLLER],"Correct controller url is not set"),this.removeSessionPromise=e,this.fsmState=this.FSM_STATES.CONTENT_SHARING_DELETE_INITIATED;var r=s.build(),o=this.addTelemetryOperation(h.NETWORK_REQUESTS.DELETE_CONTENT_SHARING),u=n?Promise.resolve():this.signalingSession.http.sendDeleteRequest({url:this.links[c["default"].LINKS.CONTENT_SHARING_CONTROLLER],requestName:h.NETWORK_REQUESTS.DELETE_CONTENT_SHARING,payload:i.getPayload(this.signalingSession,{code:c["default"].CALL_END_CODE.SUCCESS,subCode:c["default"].CALL_END_SUB_CODE.SUCCESS,phrase:c["default"].CALL_END_PHRASE.LOCAL_USER_INITIATED})});return u.then(function(){if(!t.disposed){var e={success:!0,duration:r.duration()};n&&(e.skipReason="Session delete called before start was finished"),t.updateTelemetryOperation(o,e),t.fsmState=t.FSM_STATES.IDLE,t.resolvePendingPromise()}})["catch"](function(e){t.logger.error("delete failed because: "+l.getPrintableObject(e));if(!t.disposed){var n={success:!1,duration:r.duration()};t.updateTelemetryOperation(o,n),t.fsmState=t.FSM_STATES.IDLE,t.resolvePendingPromise()}return Promise.reject(null)})},e.prototype.join=function(e){var t=this;this.logger.log("join"),l.assertNotNullOrEmpty(this.links[c["default"].LINKS.CONTENT_SHARING_CONTROLLER],"Correct joinContentSharing url is not provided");if(!this.checkState("join",this.FSM_STATES.IDLE,e))return;this.lastUpdateSequenceNumber=-1,this.nextClientSequenceNumberToUse=1,this.addSessionPromise=e,this.fsmState=this.FSM_STATES.CONTENT_SHARING_JOIN_INITIATED;var n=s.build(),i=this.addTelemetryOperation(h.NETWORK_REQUESTS.JOIN_CONTENT_SHARING);this.signalingSession.http.sendPostRequest({url:this.links[c["default"].LINKS.CONTENT_SHARING_CONTROLLER],payload:r.getPayload(this.signalingSession),requestName:h.NETWORK_REQUESTS.JOIN_CONTENT_SHARING}).then(function(e){if(!t.disposed){var r={success:!0,duration:n.duration()};t.updateTelemetryOperation(i,r),t.processStartOrJoinSuccess(e.response),t.resolvePendingPromise(e.response)}})["catch"](function(e){t.logger.error("join failed because: "+l.getPrintableObject(e));if(!t.disposed){var r={success:!1,duration:n.duration()};t.updateTelemetryOperation(i,r);var s=l.getErrorForXHRFailure(e).error;t.rejectPendingPromise(e,s)}})},e.prototype.takeControl=function(e){var t=this;this.logger.log("takeControl"),l.assertNotNullOrEmpty(this.links[c["default"].LINKS.CONTENT_SHARING_TAKE_CONTROL],"correct contentSharingTakeControl url is not provided");if(!this.checkState("takeControl",this.FSM_STATES.CONTENT_SHARING_CONNECTED,e))return;var n=s.build(),r=this.addTelemetryOperation(h.NETWORK_REQUESTS.TAKE_CONTROL_CONTENT_SHARING);this.signalingSession.http.sendPostRequest({url:this.links[c["default"].LINKS.CONTENT_SHARING_TAKE_CONTROL],payload:o.getPayload(this.signalingSession),requestName:h.NETWORK_REQUESTS.TAKE_CONTROL_CONTENT_SHARING,withoutTrouter:!0}).then(function(i){if(!t.disposed){var s={success:!0,duration:n.duration()};t.updateTelemetryOperation(r,s),e.resolve({contentIdentifier:i.response.identifier,presenter:i.response.presenter.id,subject:i.response.subject||null,sessionState:i.response.sessionState||null})}})["catch"](function(i){t.logger.error("takeControl failed because: "+l.getPrintableObject(i));if(!t.disposed){var s={success:!1,duration:n.duration()};t.updateTelemetryOperation(r,s);var o=new Error(i);o.endCode=l.getErrorForXHRFailure(i).error,e.reject(o)}})},e.prototype.updateSessionState=function(e,t){var n=this;this.logger.log("updateSessionState"),l.assertNotNullOrEmpty(this.links[c["default"].LINKS.CONTENT_SHARING_UPDATE_SESSION_STATE],"Correct sendUpdateSessionState url is not provided");if(!this.checkState("updateSessionState",this.FSM_STATES.CONTENT_SHARING_CONNECTED,t))return;var r=s.build(),i=this.addTelemetryOperation(h.NETWORK_REQUESTS.UPDATE_SESSION_STATE_CONTENT_SHARING);this.signalingSession.http.sendPostRequest({url:this.links[c["default"].LINKS.CONTENT_SHARING_UPDATE_SESSION_STATE],payload:f.getPayload(this.signalingSession,e,this.nextClientSequenceNumberToUse++),requestName:h.NETWORK_REQUESTS.UPDATE_SESSION_STATE_CONTENT_SHARING}).then(function(){if(!n.disposed){var e={success:!0,duration:r.duration()};n.updateTelemetryOperation(i,e),t.resolve()}})["catch"](function(e){n.logger.error("updateSessionState failed because: "+l.getPrintableObject(e));if(!n.disposed){var s={success:!1,duration:r.duration()};n.updateTelemetryOperation(i,s);var o=new Error(e);o.endCode=l.getErrorForXHRFailure(e).error,t.reject(o)}})},e.prototype.updateParticipantState=function(e){var t=this;this.logger.log("updateParticipantState"),l.assertNotNullOrEmpty(this.links[c["default"].LINKS.CONTENT_SHARING_UPDATE_PARTICIPANT_STATE],"correct confirmContentSharingView url is not provided");if(!this.checkState("updateParticipantState",this.FSM_STATES.CONTENT_SHARING_CONNECTED,e))return;var n=s.build(),r=this.addTelemetryOperation(h.NETWORK_REQUESTS.UPDATE_PARTICIPANT_STATE_CONTENT_SHARING);this.signalingSession.http.sendPostRequest({url:this.links[c["default"].LINKS.CONTENT_SHARING_UPDATE_PARTICIPANT_STATE],payload:a.getPayload(this.signalingSession),requestName:h.NETWORK_REQUESTS.UPDATE_PARTICIPANT_STATE_CONTENT_SHARING,withoutTrouter:!0}).then(function(){if(!t.disposed){var i={success:!0,duration:n.duration()};t.updateTelemetryOperation(r,i),e.resolve()}})["catch"](function(i){t.logger.error("updateParticipantState failed because: "+l.getPrintableObject(i));if(!t.disposed){var s={success:!1,duration:n.duration()};t.updateTelemetryOperation(r,s);var o=new Error(i);o.endCode=l.getErrorForXHRFailure(i).error,e.reject(o)}})},e.prototype.updateNotificationLinks=function(){var e=this;this.logger.log("updateNotificationLinks"),l.assertNotNullOrEmpty(this.links[c["default"].LINKS.CONTENT_SHARING_NOTIFICATION_LINKS],"correct notificationLinks url is not provided");if(!this.checkState("updateState",this.FSM_STATES.CONTENT_SHARING_CONNECTED))return;var t=s.build(),n=this.addTelemetryOperation(h.NETWORK_REQUESTS.UPDATE_CONTENT_SHARING_NOTIFICATION_LINKS);this.signalingSession.http.sendPostRequest({url:this.links[c["default"].LINKS.CONTENT_SHARING_NOTIFICATION_LINKS],payload:u.getPayload(this.signalingSession),requestName:h.NETWORK_REQUESTS.UPDATE_CONTENT_SHARING_NOTIFICATION_LINKS,withoutTrouter:!0}).then(function(){if(!e.disposed){var r={success:!0,duration:t.duration()};e.updateTelemetryOperation(n,r)}})["catch"](function(r){e.logger.error("updateNotificationLinks failed because: "+l.getPrintableObject(r));if(!e.disposed){var i={success:!1,duration:t.duration()};e.updateTelemetryOperation(n,i)}})},e.prototype.handleAddModalitySuccess=function(e){return this.logger.log("handleAddModalitySuccess"),this.checkState("handleAddModalitySuccess",this.FSM_STATES.CONTENT_SHARING_START_INITIATED)?!e.modalitySuccess||!e.modalitySuccess.contentSharing?(this.addTelemetryOperation(h.EVENTS.HANDLE_ADD_MODALITY_SUCCESS,{skipReason:"no content sharing blob"}),!1):(this.addTelemetryOperation(h.EVENTS.HANDLE_ADD_MODALITY_SUCCESS),this.processStartOrJoinSuccess(e.modalitySuccess.contentSharing),this.resolvePendingPromise(e.modalitySuccess.contentSharing),this.signalingSession.timeoutManager.stopTimer(c["default"].TIMEOUT_OPERATIONS.ADD_MODALITY),!0):!1},e.prototype.handleAddModalityFailure=function(e){this.logger.log("handleAddModalityFailure");var t=this.checkState("handleAddModalityFailure",[this.FSM_STATES.CONTENT_SHARING_START_INITIATED,this.FSM_STATES.CONTENT_SHARING_CONNECTED]);if(!t)return!1;if(!e.modalityFailure||!e.modalityFailure.contentSharing)return this.addTelemetryOperation(h.EVENTS.HANDLE_ADD_MODALITY_FAILURE,{skipReason:"no content sharing blob"}),!1;var n=e.modalityFailure.contentSharing;this.addTelemetryOperation(h.EVENTS.HANDLE_ADD_MODALITY_FAILURE,{reason:n});var r={code:n.code,subCode:n.subCode,phrase:n.phrase};return this.sendTelemetryData(r),this.rejectPendingPromise(r.phrase,r),this.signalingSession.timeoutManager.stopTimer(c["default"].TIMEOUT_OPERATIONS.ADD_MODALITY),!0},e.prototype.handleStartFromRoster=function(e){this.logger.log("handleStartFromRoster"),this.addTelemetryOperation(h.EVENTS.CONTENT_SHARING_START_FROM_ROSTER)},e.prototype.handleStopFromRoster=function(e){this.logger.log("handleStopFromRoster"),this.addTelemetryOperation(h.EVENTS.CONTENT_SHARING_END_FROM_ROSTER),this.sendTelemetryData(e)},e.prototype.handleStop=function(e){this.logger.log("handleStop");if(this.isSelfInitiatedAction(e))return this.logger.log("handleStop skipped because session was ended by self"),!1;var t={code:e.contentSharingTransactionEnd.code,subCode:e.contentSharingTransactionEnd.subCode,phrase:e.contentSharingTransactionEnd.phrase};return this.addTelemetryOperation(h.EVENTS.HANDLE_CONTENT_SHARING_END),this.sendTelemetryData(t),!0},e.prototype.handleUpdate=function(e){return this.logger.log("handleUpdate"),e.sequenceNumber<=this.lastUpdateSequenceNumber?(this.logger.log("handleUpdate skipped because of old sequence number: last received "+this.lastUpdateSequenceNumber+", update contained "+e.sequenceNumber),this.addTelemetryOperation(h.EVENTS.HANDLE_CONTENT_SHARING_UPDATE,{skipReason:"old sequence number"}),!1):(this.lastUpdateSequenceNumber=e.sequenceNumber,this.isPresenter=e.presenter.id===this.signalingSession.participantManager.localParticipant.id,this.isSelfInitiatedAction(e)?(this.logger.log("handleUpdate skipped because update came from self"),!1):(this.addTelemetryOperation(h.EVENTS.HANDLE_CONTENT_SHARING_UPDATE),!0))},e.prototype.dispose=function(e){this.logger.log("dispose"),this.disposed=!0,this.rejectPendingPromise("call ended",e||{code:c["default"].CALL_END_CODE.SUCCESS,subCode:c["default"].CALL_END_SUB_CODE.SUCCESS,phrase:c["default"].CALL_END_PHRASE.LOCAL_USER_INITIATED}),this.addTelemetryOperation(h.EVENTS.HANDLE_CALL_END),this.sendTelemetryData(e)},e.prototype.rejectPendingPromise=function(e,t){this.logger.log("rejectPendingPromise");var n=new Error(e);t&&(n.endCode=t),this.removeSessionPromise&&(this.removeSessionPromise.reject(n),this.removeSessionPromise=null),this.addSessionPromise&&(this.addSessionPromise.reject(n),this.addSessionPromise=null)},e.prototype.resolvePendingPromise=function(e){this.logger.log("resolvePendingPromise");var t=null;e&&(t={sessionId:e.sessionId,correlationId:e.contentSharingCorrelationId,contentIdentifier:e.identifier,presenter:e.presenter.id,subject:e.subject||null,sessionState:e.sessionState||null}),this.removeSessionPromise&&(this.removeSessionPromise.resolve(t),this.removeSessionPromise=null),this.addSessionPromise&&(this.addSessionPromise.resolve(t),this.addSessionPromise=null)},e.prototype.processStartOrJoinSuccess=function(e){this.logger.log("processStartOrJoinSuccess"),this.sessionId=e.sessionId,this.fsmState=this.FSM_STATES.CONTENT_SHARING_CONNECTED,this.lastUpdateSequenceNumber=-1,this.links[c["default"].LINKS.CONTENT_SHARING_CONTROLLER]=e.links.contentSharingController,this.links[c["default"].LINKS.CONTENT_SHARING_TAKE_CONTROL]=e.links.takeControl,this.links[c["default"].LINKS.CONTENT_SHARING_UPDATE_SESSION_STATE]=e.links.updateSessionState,this.links[c["default"].LINKS.CONTENT_SHARING_UPDATE_PARTICIPANT_STATE]=e.links.sync,this.links[c["default"].LINKS.CONTENT_SHARING_NOTIFICATION_LINKS]=e.links.notificationLinks,this.links[c["default"].LINKS.CONTENT_SHARING_LEAVE]=e.links.leave},e.prototype.checkState=function(e,t,n){var r;typeof t=="string"?r=this.fsmState===t:r=t.indexOf(this.fsmState)>-1;if(r)return!0;var i=e+" requires state "+t+", but state is "+this.fsmState;return this.logger.error(i),n&&n.reject(i),!1},e.prototype.isSelfInitiatedAction=function(e){return e.presenter.participantId===this.signalingSession.participantManager.localParticipant.participantId},e.prototype.startContentSharingTimer=function(){var e=this;this.logger.log("startContentSharingTimer"),this.signalingSession.timeoutManager.startTimer(c["default"].TIMEOUT_OPERATIONS.ADD_MODALITY,function(){e.addTelemetryOperation(h.EVENTS.ADD_MODALITY_TIMEOUT),e.signalingSession.timeoutManager.stopTimer(c["default"].TIMEOUT_OPERATIONS.ADD_MODALITY),e.rejectPendingPromise("timed out waiting for ContentSharing to start",{code:c["default"].CALL_END_CODE.TIMEOUT,subCode:c["default"].CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:c["default"].CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT})})},e.prototype.addTelemetryOperation=function(e,t){return this.signalingSession.telemetryHelper.addContentSharingOperation(this.correlationId,e,t)},e.prototype.updateTelemetryOperation=function(e,t){this.signalingSession.telemetryHelper.updateContentSharingOperation(this.correlationId,e,t)},e.prototype.sendTelemetryData=function(e){this.signalingSession.telemetryHelper.sendContentSharingTelemetryData(this.correlationId,this.isPresenter,e,this.links[c["default"].LINKS.CONTENT_SHARING_CONTROLLER],this.sessionId)},e}();t.ContentSharingSession=p}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/contentSharingManager",["require","exports","./utilities/constants","./utilities/utils","./contentSharingSession"],e)}(function(e,t){var n=e("./utilities/constants"),r=e("./utilities/utils"),i=e("./contentSharingSession"),s=function(){function e(e,t){var i=this;this.disposed=!1,this.contentSharingToStartCallWith=null,this.contentSharingSessions={},this.DEFAULT_STOP_REASON={code:n["default"].CALL_END_CODE.SUCCESS,subCode:n["default"].CALL_END_SUB_CODE.SUCCESS,phrase:n["default"].CALL_END_PHRASE.REMOTE_USER_INITIATED},this.DEFAULT_STOP_ID="8:unknown",this.deleteContentSharingAsync=function(e){i.logger.log("deleteContentSharingAsync");var t=r.defer(),n=i.contentSharingSessions[e];i.pendingSessionToStart&&i.pendingSessionToStart.correlationId===e&&(n=i.pendingSessionToStart);if(n){var s=function(){i.contentSharingSessions[e]&&delete i.contentSharingSessions[e]};n["delete"](t).then(s,s)}else i.rejectBecauseOfMissingSession(e,t);return t.promise},this.signalingSession=e,this.signalingSessionCallback=t,this.logger=e.logger.createChild(function(){return"[ContentSharingManager]"})}return e.prototype.startContentSharingAsync=function(e,t,s,o,u,a){var f=this;this.logger.log("startContentSharingAsync called for: "+e);if(this.pendingSessionToStart){var l="There is already a ContentSharing session start pending";return this.logger.error(l),Promise.reject(new Error(l))}var c={contentIdentifier:e,subject:s||null,sessionState:t||null,sequenceNumber:1},h=r.defer(),p=new i.ContentSharingSession(this.signalingSession,a||r.newGuid());return this.pendingSessionToStart=p,u?(this.logger.log("Call connected, send content sharing request out immediately"),p.start(o,c,h)["catch"](function(){f.pendingSessionToStart=null})):(this.logger.log("Content sharing is to be started when startOutgoingCall is called"),p.addSessionPromise=h,p.fsmState=n["default"].CONTENT_SHARING_FSM_STATE.CONTENT_SHARING_START_INITIATED,this.contentSharingToStartCallWith=c),h.promise},e.prototype.joinContentSharingAsync=function(e){this.logger.log("joinContentSharingAsync");var t=r.defer(),n=this.contentSharingSessions[e];return n?n.join(t):this.rejectBecauseOfMissingSession(e,t),t.promise},e.prototype.updateContentSharingSessionStateAsync=function(e,t){this.logger.log("updateContentSharingSessionStateAsync: sessionState = "+JSON.stringify(t));var n=r.defer(),i=this.contentSharingSessions[e];return i?i.updateSessionState(t,n):this.rejectBecauseOfMissingSession(e,n),n.promise},e.prototype.takeContentSharingControlAsync=function(e){this.logger.log("takeContentSharingControlAsync");var t=r.defer(),n=this.contentSharingSessions[e];return n?n.takeControl(t):this.rejectBecauseOfMissingSession(e,t),t.promise},e.prototype.updateContentSharingParticipantStateAsync=function(e){this.logger.log("updateContentSharingParticipantStateAsync");var t=r.defer(),n=this.contentSharingSessions[e];return n?n.updateParticipantState(t):this.rejectBecauseOfMissingSession(e,t),t.promise},e.prototype.updateContentSharingNotificationLinksAsync=function(){this.logger.log("updateContentSharingNotificationLinksAsync");for(var e in this.contentSharingSessions)if(this.contentSharingSessions.hasOwnProperty(e)){var t=this.contentSharingSessions[e];t&&t.updateNotificationLinks()}},e.prototype.getContentSharingInfoToStartSharing=function(){if(this.contentSharingToStartCallWith){var e=this.pendingSessionToStart,t=n["default"].CONTENT_SHARING_FSM_STATE.CONTENT_SHARING_START_INITIATED;if(!e||e.fsmState!==t)this.contentSharingToStartCallWith=null,this.pendingSessionToStart=null}return this.contentSharingToStartCallWith},e.prototype.dispose=function(e){this.logger.log("dispose"),this.disposed=!0;for(var t in this.contentSharingSessions)if(this.contentSharingSessions.hasOwnProperty(t)){var n=this.contentSharingSessions[t];n&&n.dispose(e)}},e.prototype.handleContentSharingUpdate=function(e){var t=e.body;this.logger.log("handleContentSharingUpdate :",r.getPrintableObject(t));var n=this.contentSharingSessions[t.contentSharingCorrelationId];if(!n){this.logger.log("Ignoring contentSharingUpdate: no session with correlation ID "+t.correlationId);return}if(!n.handleUpdate(t))return;this.signalingSessionCallback.onContentSharingUpdated({sessionId:t.sessionId,correlationId:t.contentSharingCorrelationId,contentIdentifier:t.identifier,presenter:t.presenter.id,subject:t.subject||null,sessionState:t.sessionState||null})},e.prototype.handleAddModalitySuccess=function(e){this.logger.log("handleAddModalitySuccess");var t=this.pendingSessionToStart;this.pendingSessionToStart=null,t&&t.handleAddModalitySuccess(e)?this.contentSharingSessions[t.correlationId]=t:this.logger.log("Ignoring handleAddModalitySuccess because not waiting for one")},e.prototype.handleAddModalityFailure=function(e){this.logger.log("handleAddModalityFailure");var t=this.pendingSessionToStart;this.pendingSessionToStart=null,t?t.handleAddModalityFailure(e):this.logger.log("Ignoring handleAddModalityFailure because not waiting for one")},e.prototype.handleIncomingContentSharingFromRoster=function(e){this.logger.log("handleIncomingContentSharingFromRoster");var t=this.parseSessionsFromRoster(e);this.stopSessionsFromRoster(t),this.startSessionsFromRoster(t)},e.prototype.handleContentSharingEnd=function(e){var t=e.body;this.logger.log("handleContentSharingEnd : ",r.getPrintableObject(t));var n=this.contentSharingSessions[t.contentSharingCorrelationId];if(!n){this.logger.log("Ignoring contentSharingEnd since there is no corresponding sharing ongoing");return}if(!n.handleStop(t))return;var i={code:t.contentSharingTransactionEnd.code,subCode:t.contentSharingTransactionEnd.subCode,phrase:t.contentSharingTransactionEnd.phrase};this.raiseContentSharingStopped(t.contentSharingCorrelationId,t.presenter.id,i)},e.prototype.parseSessionsFromRoster=function(e){var t=function(e){return e.contentSharing&&e.contentSharing.sessionInformation&&e.contentSharing.sessionInformation.role==="presenter"},n={};for(var r in e.participants){var i=void 0,s=void 0,o=!1,u=this.signalingSession.participantManager.localParticipant.participantId,a=e.participants[r];if(!a.endpoints)continue;for(var f in a.endpoints){var l=a.endpoints[f];if(t(l)){i=a.details.id,s=l.contentSharing.sessionInformation,o=l.participantId===u;if(o)break}}i&&(n[s.contentSharingCorrelationId]={presenterId:i,sessionInfo:s,selfEndpointIsPresenter:o})}return n},e.prototype.stopSessionsFromRoster=function(e){for(var t in this.contentSharingSessions){var n=this.contentSharingSessions[t],r=e[t];n&&!r&&(this.logger.log("An ongoing content sharing session was stopped. Raising ContentSharingStopped"),n.handleStopFromRoster(this.DEFAULT_STOP_REASON),this.raiseContentSharingStopped(n.correlationId))}},e.prototype.startSessionsFromRoster=function(e){for(var t in e){var n=this.contentSharingSessions[t],r=e[t];if(r&&!n){if(r.selfEndpointIsPresenter){this.logger.log("This endpoint is presenting, dont fire callback");continue}this.logger.log("New sharing session found. Raising ContentSharingStarted");var i=this.raiseContentSharingStarted(r.presenterId,r.sessionInfo);i.handleStartFromRoster(r.presenterId)}else r&&n&&this.logger.log("Ignoring session because it is already present locally")}},e.prototype.raiseContentSharingStopped=function(e,t,n){this.logger.log("raiseContentSharingStopped"),this.signalingSessionCallback.onContentSharingStopped({sessionId:this.contentSharingSessions[e].sessionId,correlationId:e,endedBy:t||this.DEFAULT_STOP_ID,reason:n||this.DEFAULT_STOP_REASON}),delete this.contentSharingSessions[e]},e.prototype.raiseContentSharingStarted=function(e,t){this.logger.log("raiseContentSharingStarted");var r=new i.ContentSharingSession(this.signalingSession,t.contentSharingCorrelationId,t.contentSharingSessionId,(o={},o[n["default"].LINKS.CONTENT_SHARING_CONTROLLER]=t.contentSharingController,o));this.contentSharingSessions[r.correlationId]=r;var s={sessionId:t.contentSharingSessionId,correlationId:t.contentSharingCorrelationId,contentIdentifier:t.identifier,presenter:e,subject:t.subject||null,sessionState:t.sessionState||null};this.signalingSessionCallback.onContentSharingStarted(s);return r;var o},e.prototype.rejectBecauseOfMissingSession=function(e,t){var n="There is no ContentSharing session with the correlation ID "+e;this.logger.error(n),t&&t.reject(new Error(n))},e}();t.__esModule=!0,t["default"]=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/requests/joinLightWeightMeetingControllerRequest",["require","exports","../utilities/urlBuilder","../utilities/utils","../utilities/constants"],e)}(function(e,t){function s(e){r.assertNotNull(e,"signalingSession cannot be null");var t={payload:{lwj:{sessionUpdate:n.get(e,i["default"].URL_PATH.CONV_LIGHT_WEIGHT_MEETING_UPDATE),sessionEnd:n.get(e,i["default"].URL_PATH.CONV_LIGHT_WEIGHT_MEETING_END)},participants:{from:{id:e.participantManager.localParticipant.id,displayName:e.participantManager.localParticipant.displayName,endpointId:e.participantManager.localParticipant.endpointId,participantId:e.participantManager.localParticipant.participantId,languageId:e.participantManager.localParticipant.languageId}}}};return t}var n=e("../utilities/urlBuilder"),r=e("../utilities/utils"),i=e("../utilities/constants");t.getPayload=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/lightWeightMeetingSession",["require","exports","./utilities/constants","./telemetry/telemetryConstants","./utilities/utils","./requests/joinLightWeightMeetingControllerRequest"],e)}(function(e,t){var n=e("./utilities/constants"),r=e("./telemetry/telemetryConstants"),i=e("./utilities/utils"),s=e("./requests/joinLightWeightMeetingControllerRequest"),o=function(){function e(e,t){var s=this;this.disposed=!1,this.lastSeenServerSeqNo=-1,this.fsmState=n["default"].LIGHT_WEIGHT_MEETING_FSM_STATE.IDLE,this.links={},this.getLightWeightMeetingInfoToStartViewing=function(){return s.fsmState=n["default"].LIGHT_WEIGHT_MEETING_FSM_STATE.LIGHT_WEIGHT_MEETING_JOIN_INITIATED,{}},this.handleIncomingLightWeightMeeting=function(e){if(s.fsmState===n["default"].LIGHT_WEIGHT_MEETING_FSM_STATE.IDLE)return;s.logger.log("LightWeightMeetingSession :: handleIncomingLightWeightMeeting");if(!e.activeModalities||!e.activeModalities.lwj||!e.activeModalities.lwj.lwjControllerUri){s.links[n["default"].LINKS.LIGHT_WEIGHT_MEETING_CONTROLLER]&&s.handleLightWeightMeetingEnd(!1,{code:n["default"].CALL_END_CODE.SUCCESS,subCode:n["default"].CALL_END_SUB_CODE.SUCCESS,phrase:n["default"].CALL_END_PHRASE.LIGHT_WEIGHT_MEETING_END_RECEIVED_FROM_SERVICE});return}s.links[n["default"].LINKS.LIGHT_WEIGHT_MEETING_CONTROLLER]=e.activeModalities.lwj.lwjControllerUri;switch(s.fsmState){case n["default"].LIGHT_WEIGHT_MEETING_FSM_STATE.LIGHT_WEIGHT_MEETING_CONNECTING:case n["default"].LIGHT_WEIGHT_MEETING_FSM_STATE.LIGHT_WEIGHT_MEETING_CONNECTED:break;case n["default"].LIGHT_WEIGHT_MEETING_FSM_STATE.LIGHT_WEIGHT_MEETING_JOIN_INITIATED:s.internalJoinLightWeightMeeting();break;default:}return},this.handleLightWeightMeetingUpdate=function(e){var t=e.body;s.logger.log("handleLightWeightMeetingUpdate : ",i.getPrintableObject(t)),s.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_LIGHT_WEIGHT_MEETING_UPDATE,e),s.internalHandleLightWeightMeetingUpdate(t)},this.dispose=function(e){s.logger.log("LightWeightMeetingSession :: dispose"),s.fsmState!==n["default"].LIGHT_WEIGHT_MEETING_FSM_STATE.IDLE&&s.signalingSessionCallback.onLightWeightMeetingEnded(e),s.disposed=!0,s.clearFlags()},this.internalHandleLightWeightMeetingUpdate=function(e){if(s.fsmState!==n["default"].LIGHT_WEIGHT_MEETING_FSM_STATE.LIGHT_WEIGHT_MEETING_CONNECTED)return;if(!e||!e.lwj){s.logger.log("decoding failed, ending light weight meeting"),s.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_LIGHT_WEIGHT_MEETING_UPDATE_FAILURE),s.handleLightWeightMeetingEnd(!0,{code:n["default"].CALL_END_CODE.DECODING_FAILED,subCode:n["default"].CALL_END_SUB_CODE.LIGHTWEIGHTMEETING_JOIN_FAILED,phrase:n["default"].CALL_END_PHRASE.LIGHT_WEIGHT_MEETING_JOIN_FAILED});return}e.sequenceNumber<=s.lastSeenServerSeqNo?s.logger.log("ignoring lightWeightMeetingUpdate. Last seen seq = "+s.lastSeenServerSeqNo):(s.logger.log("LightWeightMeetingSession :: handleLightWeightMeetingUpdate raising event"),s.lastSeenServerSeqNo=e.sequenceNumber,s.signalingSessionCallback.onLightWeightMeetingUpdated(e.lwj))},this.signalingSession=e,this.signalingSessionCallback=t,this.logger=e.logger.createChild(function(){return"["+s.fsmState+"]"})}return e.prototype.handleLightWeightMeetingJoinTimeout=function(){this.logger.log("handleLightWeightMeetingJoinTimeout"),this.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_LIGHT_WEIGHT_MEETING_JOIN_TIMEOUT),this.handleLightWeightMeetingEnd(!0,{code:n["default"].CALL_END_CODE.TIMEOUT,subCode:n["default"].CALL_END_SUB_CODE.LIGHTWEIGHTMEETING_JOIN_TIMEOUT,phrase:n["default"].CALL_END_PHRASE.LIGHT_WEIGHT_MEETING_TIMEOUT})},e.prototype.handleLightWeightMeetingEndByService=function(e){this.logger.log("handleLightWeightMeetingEndByService"),this.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_LIGHT_WEIGHT_MEETING_END,{byService:!0}),this.handleLightWeightMeetingEnd(!1)},e.prototype.handleLightWeightMeetingEnd=function(e,t){this.logger.log("handleLightWeightMeetingEnd",e),this.signalingSession.telemetryHelper.recordEvent(r.EVENTS.HANDLE_LIGHT_WEIGHT_MEETING_END),t||(t={code:n["default"].CALL_END_CODE.SUCCESS,subCode:n["default"].CALL_END_SUB_CODE.SUCCESS,phrase:n["default"].CALL_END_PHRASE.CONV_END_FROM_SERVICE}),this.signalingSessionCallback.onLightWeightMeetingEnded(t),this.clearFlags(),this.signalingSession.onLightWeightMeetingEnded(t,e)},e.prototype.internalJoinLightWeightMeeting=function(){var e=this;this.logger.log("LightWeightMeetingSession :: internalJoinLightWeightMeeting"),i.assertNotNullOrEmpty(this.links[n["default"].LINKS.LIGHT_WEIGHT_MEETING_CONTROLLER],"correct light weight meeting url is not provided!"),this.fsmState=n["default"].LIGHT_WEIGHT_MEETING_FSM_STATE.LIGHT_WEIGHT_MEETING_CONNECTING,this.signalingSession.http.sendPostRequest({url:this.links[n["default"].LINKS.LIGHT_WEIGHT_MEETING_CONTROLLER],payload:s.getPayload(this.signalingSession),requestName:r.NETWORK_REQUESTS.JOIN_LIGHT_WEIGHT_MEETING}).then(function(t){e.disposed||(e.fsmState=n["default"].LIGHT_WEIGHT_MEETING_FSM_STATE.LIGHT_WEIGHT_MEETING_CONNECTED,e.signalingSession.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.LIGHT_WEIGHT_MEETING_JOIN),e.internalHandleLightWeightMeetingUpdate(t.response),e.logger.log("LightWeightMeetingSession :: internalJoinLightWeightMeeting connected"))})["catch"](function(t){var r=i.getPrintableObject(t);e.logger.error("internalJoinLightWeightMeeting failed because : "+r);if(!e.disposed){var s=i.getErrorForXHRFailure(t).error;e.handleLightWeightMeetingEnd(!0,{code:s,subCode:n["default"].CALL_END_SUB_CODE.LIGHTWEIGHTMEETING_JOIN_FAILED,phrase:n["default"].CALL_END_PHRASE.LIGHT_WEIGHT_MEETING_JOIN_FAILED})}})},e.prototype.clearFlags=function(){this.lastSeenServerSeqNo=-1,this.fsmState=n["default"].LIGHT_WEIGHT_MEETING_FSM_STATE.IDLE},e}();t.__esModule=!0,t["default"]=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/broadcastSession",["require","exports","./utilities/constants","./telemetry/telemetryConstants","./utilities/urlBuilder"],e)}(function(e,t){var n=e("./utilities/constants"),r=e("./telemetry/telemetryConstants"),i=e("./utilities/urlBuilder"),s=function(){function e(e,t){var n=this;this.broadcastContext=null,this.broadcastControllerUrl="",this.broadcastCallbackUrl="",this.broadcastState=null,this.setContext=function(e){e===void 0&&(e=null),n.logger.log("BroadcastSession :: set broadcast context",e),n.broadcastContext=e},this.getContext=function(){return n.logger.log("BroadcastSession :: get broadcast context",n.broadcastContext||null),n.broadcastContext||null},this.signalingSession=e,this.signalingSessionCallback=t,this.logger=e.logger.createChild(function(){return"[Broadcast]"})}return e.prototype.handleBroadcastStateChanged=function(e){var t=e.body;this.broadcastState=t,this.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.BROADCAST_STATE_CHANGED,e),this.logger.log("BroadcastSession :: broadcast state changed",this.broadcastState),this.updateBroadcastMetadata()},e.prototype.updateBroadcastCallbackUrl=function(){var e=i.get(this.signalingSession,n["default"].URL_PATH.CONV_BROADCAST_UPDATE);this.broadcastCallbackUrl!==e&&(this.broadcastCallbackUrl=e,this.logger.log("BroadcastSession :: broadcast callback url changed",this.broadcastCallbackUrl),this.updateBroadcastMetadata())},e.prototype.handleBroadcastDetailsChanged=function(e){e.activeModalities&&e.activeModalities.broadcast&&e.activeModalities.broadcast.controller!==this.broadcastControllerUrl&&(this.broadcastControllerUrl=e.activeModalities.broadcast.controller,this.logger.log("BroadcastSession :: broadcast controller changed",this.broadcastControllerUrl),this.updateBroadcastMetadata()),this.broadcastControllerUrl&&(!e.activeModalities||!e.activeModalities.broadcast)&&(this.broadcastControllerUrl="",this.logger.log("BroadcastSession :: broadcast controller changed",this.broadcastControllerUrl),this.updateBroadcastMetadata())},e.prototype.updateBroadcastMetadata=function(){var e={broadcastControllerUrl:this.broadcastControllerUrl,broadcastStateCallbackUrl:this.broadcastCallbackUrl,broadcastState:this.broadcastState};this.logger.log("BroadcastSession :: update broadcast metadata",e),this.signalingSessionCallback.onBroadcastDetailsUpdated&&this.signalingSessionCallback.onBroadcastDetailsUpdated(e)},e}();t.__esModule=!0,t["default"]=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/timeoutManager",["require","exports","./utilities/constants","./utilities/utils"],e)}(function(e,t){var n=e("./utilities/constants"),r=e("./utilities/utils"),i=function(){function e(e){var t=this;this.timers={},this.startTimer=function(e,i,s){t.logger.log("startTimer called for : "+e);var o=0;switch(e){case n["default"].TIMEOUT_OPERATIONS.ADD_PARTICIPANT:r.assertNotNullOrEmpty(s,"remoteParticipantId must be specified for : "+e),o=n["default"].TIMEOUT_VALUES_IN_SECONDS.ADD_PARTICIPANT_TIMEOUT*1e3,e=e+"_"+s;break;case n["default"].TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT:r.assertNotNullOrEmpty(s,"remoteParticipantId must be specified for : "+e),o=n["default"].TIMEOUT_VALUES_IN_SECONDS.REMOVE_PARTICIPANT_TIMEOUT*1e3,e=e+"_"+s;break;case n["default"].TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT:r.assertNotNullOrEmpty(s,"remoteParticipantId must be specified for : "+e),o=n["default"].TIMEOUT_VALUES_IN_SECONDS.ADMIT_PARTICIPANT_TIMEOUT*1e3,e=e+"_"+s;break;case n["default"].TIMEOUT_OPERATIONS.INCOMING_CALL_ESTABLISHMENT:o=n["default"].TIMEOUT_VALUES_IN_SECONDS.INCOMING_CALL_ESTABLISHMENT_TIMEOUT*1e3;break;case n["default"].TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT:o=n["default"].TIMEOUT_VALUES_IN_SECONDS.OUTGOING_CALL_ESTABLISHMENT_TIMEOUT*1e3;break;case n["default"].TIMEOUT_OPERATIONS.MEDIA_ANSWER:o=n["default"].TIMEOUT_VALUES_IN_SECONDS.MEDIA_ANSWER_TIMEOUT*1e3;break;case n["default"].TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT:o=n["default"].TIMEOUT_VALUES_IN_SECONDS.MEDIA_ANSWER_ACKNOWLEDGEMENT_TIMEOUT*1e3;break;case n["default"].TIMEOUT_OPERATIONS.ADD_MODALITY:o=n["default"].TIMEOUT_VALUES_IN_SECONDS.ADD_MODALITY_TIMEOUT*1e3;break;case n["default"].TIMEOUT_OPERATIONS.UNMUTE:o=n["default"].TIMEOUT_VALUES_IN_SECONDS.UNMUTE_TIMEOUT*1e3;break;case n["default"].TIMEOUT_OPERATIONS.LIGHT_WEIGHT_MEETING_JOIN:o=n["default"].TIMEOUT_VALUES_IN_SECONDS.LIGHT_WEIGHT_MEETING_JOIN_TIMEOUT*1e3;break;default:return}var u=setTimeout(i,o);t.timers[e]=u},this.stopTimer=function(e,i){switch(e){case n["default"].TIMEOUT_OPERATIONS.ADD_PARTICIPANT:case n["default"].TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT:r.assertNotNullOrEmpty(i,"remoteParticipantId must be specified for : "+e),e=e+"_"+i;break;default:}t.logger.log("stopTimer called for : "+e),t.timers.hasOwnProperty(e)&&(clearTimeout(t.timers[e]),delete t.timers[e])},this.dispose=function(){t.logger.log("timeoutManager :: dispose");for(var e in t.timers)t.timers.hasOwnProperty(e)&&t.stopTimer(e)},this.logger=e.logger}return e}();t.__esModule=!0,t["default"]=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/webRtcSignalingManager",["require","exports","./utilities/constants","./telemetry/telemetryConstants","./utilities/urlBuilder","./utilities/utils"],e)}(function(e,t){var n=e("./utilities/constants"),r=e("./telemetry/telemetryConstants"),i=e("./utilities/urlBuilder"),s=e("./utilities/utils"),o=function(){function e(e,t){var o=this;this.disposed=!1,this.lastSeenSeqNumbers={},this.getClientUrls=function(){var e=null;return o.isWebRtcCall&&(e={controlVideoStreaming:i.get(o.signalingSession,n["default"].URL_PATH.CONTROL_VIDEO_STREAMING),dominantSpeakerInfo:i.get(o.signalingSession,n["default"].URL_PATH.DOMINANT_SPEAKER_INFO),csrcInfo:i.get(o.signalingSession,n["default"].URL_PATH.CSRC_INFO)}),e},this.handleDominantSpeakerInfo=function(e){var t=e.body;o.logger.debug("handleDominantSpeakerInfo : ",s.getPrintableObject(t)),o.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_DOMINANT_SPEAKER_INFO,e),o.handleWebRtcNotification(n["default"].WEBRTC_NOTIFICATION_TYPE.DOMINANT_SPEAKER_INFO,t.dominantSpeakerInformation)},this.handleControlVideoStreaming=function(e){var t=e.body;o.logger.debug("handleControlVideoStreaming: ",s.getPrintableObject(t)),o.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_CONTROL_VIDEO_STREAMING,e),o.handleWebRtcNotification(n["default"].WEBRTC_NOTIFICATION_TYPE.CONTROL_VIDEO_STREAMING,t.controlVideoStreaming)},this.handleCsrcInfo=function(e){var t=e.body;o.logger.debug("handleCsrcInfo : ",s.getPrintableObject(t)),o.signalingSession.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_CSRC_INFO,e),o.handleWebRtcNotification(n["default"].WEBRTC_NOTIFICATION_TYPE.CSRC_INFO,t.csrcInfo)},this.sendControlVideoStreamingAsync=function(e,t){o.logger.log("sendControlVideoStreamingAsync"),s.assert(o.isWebRtcCall,"this is not a webrtc call"),s.assertNotNullOrEmpty(e,"correct controlVideoStreaming requestUrl is not provided"),s.assertNotNullOrEmpty(t,"controlVideoStreaming requestBody cannot be null or empty");var i=s.defer(),u=r.NETWORK_REQUESTS.SEND_CONTROL_VIDEO_STREAMING,a={payload:t};return o.signalingSession.http.sendPostRequest({url:e,payload:a,requestName:u,withoutTrouter:!0}).then(function(){o.disposed||i.resolve()})["catch"](function(e){var t=s.getPrintableObject(e);o.logger.error("sendControlVideoStreamingAsync failed because : "+t);if(!o.disposed){var r=new Error(e);r.endCode=n["default"].CALL_END_NETWORK_ERROR,i.reject(r)}}),i.promise},this.dispose=function(){o.logger.log("WebRtcSignalingManager :: dispose"),o.disposed=!0},this.signalingSession=e,this.signalingSessionCallback=t,this.isWebRtcCall=e.signalingAgentConfig.isWebRtcEnabled,this.logger=e.logger,this.lastSeenSeqNumbers[n["default"].WEBRTC_NOTIFICATION_TYPE.CONTROL_VIDEO_STREAMING]=-1,this.lastSeenSeqNumbers[n["default"].WEBRTC_NOTIFICATION_TYPE.DOMINANT_SPEAKER_INFO]=-1,this.lastSeenSeqNumbers[n["default"].WEBRTC_NOTIFICATION_TYPE.CSRC_INFO]=-1}return e.prototype.handleWebRtcNotification=function(e,t){s.assert(this.isWebRtcCall,"ignoring message in non-webrtc call");var n=this.lastSeenSeqNumbers[e];if(t.sequenceNumber<=n){this.logger.log("ignoring "+e+" . Last seen seq = "+n+" current seq = "+t.sequenceNumber);return}this.lastSeenSeqNumbers[e]=t.sequenceNumber,this.signalingSessionCallback.onWebRtcMediaNotification(e,t)},e}();t.__esModule=!0,t["default"]=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/utilities/requestDispatcher",["require","exports","../utilities/async"],e)}(function(e,t){function r(e,t,n,r,s,o){return new i(e,t,n,r,s,o)}var n=e("../utilities/async");t.build=r;var i=function(){function e(e,t,n,r,i,s){this.dispatcher=e,this.requestType=t,this.url=n,this.request=r,this.delaySeconds=i,this.requestFailureCallback=s,this.attempts=0}return e.prototype.sendRequestWithRetry=function(){var e=this;return this.isCancelled=!1,new Promise(function(t,n){e.resolve=t,e.reject=n,e.queueAttempt()})},e.prototype.cancelFurtherRetries=function(){this.isCancelled=!0,this.attemptTimer&&(this.attemptTimer.stop(),this.attemptTimer=null)},e.prototype.getRequestMethod=function(e){switch(e){case 0:return this.dispatcher.getAsync.bind(this.dispatcher);case 1:return this.dispatcher.postAsync.bind(this.dispatcher);case 2:return this.dispatcher.putAsync.bind(this.dispatcher);case 3:return this.dispatcher.removeAsync.bind(this.dispatcher);default:return null}},e.prototype.queueAttempt=function(e){var t=this,r=e&&e.status&&!this.isStatusRetryable(e.status);if(r||this.isCancelled||this.attempts>this.delaySeconds.length){this.reject(e);return}this.attemptTimer=n.TimerFactory.build(function(){return t.attempt()}),this.attemptTimer.start(this.getNextDelay())},e.prototype.attempt=function(){var e=this;this.attempts++,this.attemptTimer=null;var t=(new Date).getTime();this.getRequestMethod(this.requestType)(this.url,this.request).then(function(n){return n?e.resolve({request:n.request,response:n.response,attempt:e.attempts,requestSendTimestamp:t,requestResponseTimestamp:(new Date).getTime()}):Promise.reject("Invalid response")})["catch"](function(n){e.requestFailureCallback({request:n,attempt:e.attempts,requestSendTimestamp:t,requestResponseTimestamp:(new Date).getTime()}),e.queueAttempt(n)})},e.prototype.getNextDelay=function(){var e;return this.attempts?this.attempts<=this.delaySeconds.length&&(e=this.delaySeconds[this.attempts-1]):e=0,e},e.prototype.isStatusRetryable=function(e){var t=[500,502,503,504];return t.indexOf(e)>-1},e}();t.RequestDispatcher=i});var __assign=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/utilities/requestBuilder",["require","exports","./constants","./utils"],e)})(function(e,t){function i(e,t,i,s,o,u){return s===void 0&&(s={}),e.disposed?Promise.reject("Session already disposed"):e.signalingAgentConfig.skypeToken().then(function(a){if(e.disposed)throw"skypeToken Getter returned too late. Object is already disposed";var f={};f[n["default"].HEADERS.CORRELATION_ID]=e.correlationId,f[n["default"].HEADERS.MESSAGE_ID]=r.newGuid(),f[n["default"].HEADERS.CLIENT_USER_AGENT]=e.signalingAgentConfig.clientInformation,f[n["default"].HEADERS.SKYPE_TOKEN]=a,u&&(f[n["default"].HEADERS.CONTENT_SHARING_CORRELATION_ID]=u);var l=i&&i.payload?JSON.stringify(i.payload):null,c=e.signalingAgentConfig.httpRequestDispatcher.getRequestOptions(t,__assign({},f,s),l,o);return e.telemetryHelper.addNetworkOperationStarted(t),c},function(e){throw typeof e=="string"&&(e=new Error(e)),e.skypeTokenError=!0,e})}var n=e("./constants"),r=e("./utils");t.get=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/httpStack",["require","exports","./utilities/constants","./utilities/requestDispatcher","./utilities/utils","./utilities/requestBuilder","./utilities/stopwatch"],e)}(function(e,t){var n=e("./utilities/constants"),r=e("./utilities/requestDispatcher"),i=e("./utilities/utils"),s=e("./utilities/requestBuilder"),o=e("./utilities/stopwatch"),u={HTTP:"HTTP",HTTPS:"HTTPS"},a=(l={},l[1]="POST",l[0]="GET",l[2]="PUT",l[3]="DELETE",l),f=function(){function e(e){var t=this;this.signalingSession=e,this.pendingRequests={},this.sendGetRequest=function(e){return t.sendRequest(0,e)},this.sendPostRequest=function(e){return t.sendRequest(1,e)},this.sendDeleteRequest=function(e){return t.sendRequest(3,e)},this.cancelRequestIfPending=function(e,n){if(!t.pendingRequests[e])return;n?t.hasPendingRequest(e,n)&&t.cancelRequest(e,n):Object.keys(t.pendingRequests[e]).forEach(function(n){return t.cancelRequest(e,n)})},this.cancelAllRequests=function(){Object.keys(t.pendingRequests).forEach(function(e){Object.keys(t.pendingRequests[e]).forEach(function(n){return t.cancelRequest(e,n)})})},this.hasPendingRequest=function(e,n){return t.pendingRequests[e]?Boolean(n?t.pendingRequests[e][n]:t.pendingRequests[e]):!1},this.cancelRequest=function(e,n){try{t.pendingRequests[e][n].timeoutDeferred.resolve(),t.pendingRequests[e][n].dispatcher&&t.pendingRequests[e][n].dispatcher.cancelFurtherRetries(),t.pendingRequests[e][n].aborted=!0,t.logger.log("Request",e,"aborted")}catch(r){t.logger.warn("Unable to cancel request",e,n)}},this.buildRequestTelemetry=function(e,t){return{name:a[e]+"-"+t.requestName,eventStart:(new Date).getTime(),trouterReady:0,requestReady:0,messageId:"",attempts:[]}},this.addPendingRequest=function(e,n){return t.pendingRequests[e.requestName]||(t.pendingRequests[e.requestName]={}),t.pendingRequests[e.requestName][e.requestId]={dispatcher:null,timeoutDeferred:n,requestPromise:null,aborted:!1},t.pendingRequests[e.requestName][e.requestId]},this.extractMessageIdPrefix=function(e){return e.headers&&typeof e.headers[n["default"].HEADERS.MESSAGE_ID]=="string"?e.headers[n["default"].HEADERS.MESSAGE_ID].split("-")[0]:""},this.sendRequest=function(e,n){if(!n.url)return t.logger.error(n.requestName,"Link does not exist"),Promise.reject("Link does not exist");n.requestId||(n.requestId=i.newGuid()),n.retryIntervals||(n.retryIntervals=[200,500,1e3]);var a,f,l=o.build(),c=(new Date).getTime(),h=i.defer(),p=t.buildRequestTelemetry(e,n),d=function(e){if(!e||!e.request){t.logger.warn(n.requestName,"missing request details, unable to record for telemetry!");return}t.logger.warn("Request",n.requestName,"finished, status:",e.request.status,"statusText",e.request.statusText,"retry count",e.attempt),p.attempts.push({protocol:a,status:e.request.status,statusText:e.request.statusText,attempt:e.attempt,start:e.requestSendTimestamp-c,end:e.requestResponseTimestamp-c,online:navigator.onLine,aborted:t.pendingRequests[n.requestName][n.requestId].aborted})};if(t.hasPendingRequest(n.requestName,n.requestId))return t.logger.warn(n.requestName,n.requestId,"is already pending request!!"),t.pendingRequests[n.requestName][n.requestId].requestPromise;f=t.addPendingRequest(n,h);var v=function(e,r,i){t.hasPendingRequest(n.requestName,n.requestId)?(delete t.pendingRequests[r][i],Object.keys(t.pendingRequests[r]).length||delete t.pendingRequests[r]):t.logger.warn("Unable to clean up!"),t.signalingSession.disposed||(t.signalingSession.telemetryHelper.addNetworkOperationCompleted(n.requestName,e,l.duration()),t.signalingSession.telemetryHelper.recordNetworkRequest(p))},m=function(e){return function(){var r=[];for(var i=0;i<arguments.length;i++)r[i]=arguments[i];if(t.signalingSession.disposed)throw new Error("Session disposed");if(t.hasPendingRequest(n.requestName,n.requestId)&&t.pendingRequests[n.requestName][n.requestId].aborted)throw new Error("Request canceled");return e.apply(void 0,r)}},g=m(function(){return n.withoutTrouter?Promise.resolve():t.signalingSession.ensureMessageChannelReady(n.requestName)}),y=m(function(){return p.trouterReady=l.duration(),n.onceTrouterReady&&n.onceTrouterReady(),Promise.resolve()}),b=m(function(){return s.get(t.signalingSession,n.requestName,n.payload,n.customHeaders,h.promise,n.contentSharingCorrelationId)}),w=m(function(e){return p.requestReady=l.duration(),p.messageId=t.extractMessageIdPrefix(e),Promise.resolve(e)}),E=m(function(i){a=u.HTTPS;var s=r.build(t.signalingSession.signalingAgentConfig.httpRequestDispatcher,e,n.url,i,n.retryIntervals,d);return f.dispatcher=s,s.sendRequestWithRetry()}),S=m(function(e){return d(e),t.logger.log("Request",n.requestName,"success"),v(!0,n.requestName,n.requestId),e}),x=function(e){v(!1,n.requestName,n.requestId);var r=i.getPrintableObject(e);return t.logger.error("Request",n.requestName,"failed :",r),Promise.reject(e)},T=Promise.resolve().then(g).then(y).then(b).then(w).then(E).then(S)["catch"](x);return f.requestPromise=T,T},this.logger=this.signalingSession.logger.createChild("HTTP_STACK")}return e}();t.HttpStack=f;var l});var __assign=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/signalingSession",["require","exports","./utilities/constants","./telemetry/telemetryConstants","./telemetry/telemetryHelper","./participant","./brokerService","./utilities/utils","./requests/createConversationRequest","./requests/joinGivenConversationRequest","./requests/subscribeToCallRequest","./requests/leaveConversationRequest","./requests/deleteConversationRequest","./requests/cancelCallRequest","./requests/endCallRequest","./requests/callAcceptanceRequest","./requests/rejectCallRequest","./requests/attachAndJoinRequest","./requests/callProgressRequest","./requests/callAcceptanceAcknowledgementRequest","./requests/participantUpdateRequest","./requests/updateEndpointState","./requests/updateParticipantConversationLinksRequest","./responses/provisionalMediaResponse","./requests/transferCallRequest","./requests/transferAcceptanceRequest","./requests/transferCompletionRequest","./participantManager","./mediaRenegotiationManager","./contentSharingManager","./lightWeightMeetingSession","./broadcastSession","./timeoutManager","./webRtcSignalingManager","./httpStack","./utilities/stopwatch"],e)})(function(e,t){function F(e,t,n,r,i){return new j(e,t,n,r,i)}var n=e("./utilities/constants"),r=e("./telemetry/telemetryConstants"),i=e("./telemetry/telemetryHelper"),s=e("./participant"),o=e("./brokerService"),u=e("./utilities/utils"),a=e("./requests/createConversationRequest"),f=e("./requests/joinGivenConversationRequest"),l=e("./requests/subscribeToCallRequest"),c=e("./requests/leaveConversationRequest"),h=e("./requests/deleteConversationRequest"),p=e("./requests/cancelCallRequest"),d=e("./requests/endCallRequest"),v=e("./requests/callAcceptanceRequest"),m=e("./requests/rejectCallRequest"),g=e("./requests/attachAndJoinRequest"),y=e("./requests/callProgressRequest"),b=e("./requests/callAcceptanceAcknowledgementRequest"),w=e("./requests/participantUpdateRequest"),E=e("./requests/updateEndpointState"),S=e("./requests/updateParticipantConversationLinksRequest"),x=e("./responses/provisionalMediaResponse"),T=e("./requests/transferCallRequest"),N=e("./requests/transferAcceptanceRequest"),C=e("./requests/transferCompletionRequest"),k=e("./participantManager"),L=e("./mediaRenegotiationManager"),A=e("./contentSharingManager"),O=e("./lightWeightMeetingSession"),M=e("./broadcastSession"),D=e("./timeoutManager"),P=e("./webRtcSignalingManager"),H=e("./httpStack"),B=e("./utilities/stopwatch"),j=function(){function e(e,t,a,f,c){var h=this;this.disposed=!1,this.convSubject=null,this.threadId=null,this.incomingCallCallerId=null,this.incomingCallPayload=null,this.multiParty=!1,this.isIncomingCall=!1,this.isHostLessCall=!1,this.isCastCall=!1,this.numberOfOriginalInvitees=0,this.teamsMessageId=null,this.enableGroupCallMeetupGeneration=!1,this.meetingInfo=null,this.meetingDetails=null,this.emergencyContent=null,this.transferContext=null,this.callType="default",this.transferor=null,this.onBehalfOf=null,this.links={},this.provisionalMediaAnswersSeenSoFar=[],this.incomingTrouterMessagesSeenSoFar=[],this.incomingBrokerMessagesSeenSoFar=[],this.currentCallStatus=null,this.fsmState=n["default"].SIGNALING_FSM_STATE.IDLE,this.convJoined=!1,this.keepAliveTimer=null,this.keepAliveInterval=null,this.keepAliveCount=1,this.remoteCallerOrCallee=null,this.mediaTypesToUse=null,this.lastUsedOutgoingMediaContent=null,this.endpointStateSequenceNumber=0,this.linkUpdateRequested={conversationLinks:!1,keepAliveLinks:!1},this.incomingMessageSyncResponseCache={},this.lastRosterUpdateSeqNumber=-1,this.updateEndpointState=function(e){h.logger.log("updateEndpointState: ",JSON.stringify(e.state));var t=h.links[n["default"].LINKS.UPDATE_ENDPOINT_STATE];return h.fsmState!==n["default"].SIGNALING_FSM_STATE.CONNECTED?(h.logger.log("updateEndpointState will be queued as we are not connected!"),h.pendingEndpointStateWhileConnecting=e,Promise.resolve()):h.endpointStateOnServer&&h.endpointStateOnServer.state&&_.isEqual(e.state,h.endpointStateOnServer.state)&&!h.http.hasPendingRequest(r.NETWORK_REQUESTS.UPDATE_ENDPOINT_STATE)?(h.logger.log("updateEndpointState will ignore current update as there is nothing new to send."),Promise.reject("Ignored")):t?(h.http.cancelRequestIfPending(r.NETWORK_REQUESTS.UPDATE_ENDPOINT_STATE),h.telemetryHelper.recordEvent(r.EVENTS.UPDATE_ENDPOINT_STATE,{state:e.state}),e.endpointStateSequenceNumber=++h.endpointStateSequenceNumber,h.http.sendPostRequest({url:t,requestName:r.NETWORK_REQUESTS.UPDATE_ENDPOINT_STATE,payload:E.getPayload(h,e),retryIntervals:[0,300,450,600]}).then(function(){h.disposed||(h.endpointStateOnServer=e,h.pendingEndpointStateWhileConnecting=null)})):(h.logger.error("updateEndpointState operation cannot be performed now, the link is not yet available"),Promise.reject("No link"))},this.getParticipantIdForOfferAnswer=function(e){u.assertNotNull(e,"mediaContent should be a non null value"),h.logger.log("getParticipantIdForOfferAnswer");var t=null;return h.remoteCallerOrCallee&&!h.threadId&&!e.newOffer&&!e.escalationOccurring&&(t=h.remoteCallerOrCallee.id),t},this.getMeetingInfo=function(){return h.meetingInfo},this.getEmergencyContent=function(){return h.emergencyContent},this.setSubject=function(e){h.disposed||(h.telemetryHelper.recordEvent(r.EVENTS.SET_SUBJECT),u.assertNotNull(e,"subject should be a non null value"),h.convSubject=e)},this.setMultiParty=function(){h.multiParty=!0},this.setOfferAnswerGenerationTimestamps=function(e){h.disposed||h.telemetryHelper.setOfferAnswerGenerationTimestamps(e)},this.setTimeToRingDuration=function(){h.disposed||h.telemetryHelper.setTimeToRingDuration()},this.startLightWeightMeeting=function(e){if(h.disposed){h.logger.log("startLightWeightMeeting canceled");return}h.telemetryHelper.recordEvent(r.EVENTS.START_LIGHT_WEIGHT_MEETING),h.telemetryHelper.setDirection(r["default"].DIRECTION.OUTGOING),h.telemetryHelper.setRole(r["default"].ROLE.START_FOR_LIGHT_WEIGHT_MEETING),h.telemetryHelper.setMeetingInfo(h.getMeetingInfo()),h.isBrokerEnabledForOutgoingCall()&&h.setupBrokerChannel();var t={newCall:!0,suppressDialout:e?e.suppressDialout||!1:!1,castCall:e?e.castCall||!1:!1,conversationServiceUrl:h.signalingAgentConfig.conversationServiceUrl,onBehalfOf:e?e.onBehalfOf:null,enableLightWeightMeeting:!0};h.isCastCall=t.castCall,h.onBehalfOf=t.onBehalfOf,h.placeLightWeightMeetingCall(t)},this.joinLightWeightMeeting=function(e,t){u.assertNotNull(t,"correlationId should be a non null value"),u.assertNotNullOrEmpty(e,"conversationUrl should be a non null value"),h.logger.log("joinLightWeightMeeting with url = "+e+" , correlationId = "+t);if(h.disposed){h.logger.log("joinLightWeightMeeting canceled");return}h.telemetryHelper.recordEvent(r.EVENTS.JOIN_LIGHT_WEIGHT_MEETING),h.telemetryHelper.setDirection(r["default"].DIRECTION.INCOMING),h.telemetryHelper.setRole(r["default"].ROLE.JOIN_FOR_LIGHT_WEIGHT_MEETING),h.isBrokerEnabledForIncomingCall()&&h.setupBrokerChannel(),h.correlationId=t;var n={newCall:!1,suppressDialout:!0,castCall:!1,conversationServiceUrl:e,enableLightWeightMeeting:!0};h.isCastCall=n.castCall,h.placeLightWeightMeetingCall(n)},this.setThreadId=function(e){h.telemetryHelper.recordEvent(r.EVENTS.SET_THREADID),u.assertNotNull(e,"threadId should be a non null value"),h.threadId!==e&&(u.assert(!h.threadId,"conversation threadId has already been set. It cannot be overwritten"),h.threadId=e)},this.setCallOptions=function(e){u.assertNotNull(e,"callOptions should be a non null value"),h.logger.log("setCallOptions",JSON.stringify(e)),h.telemetryHelper.recordEvent(r.EVENTS.SET_CALLOPTIONS),e&&(h.teamsMessageId=e.teamsMessageId||null,h.meetingInfo=e.meetingInfo||null,h.emergencyContent=e.emergencyContent||null,h.enableGroupCallMeetupGeneration=e.enableGroupCallMeetupGeneration||!1,h.broadcastSession.setContext(e.broadcastContext))},this.setTransferContext=function(e){u.assertNotNull(e,"transferContext should not be null"),h.logger.log("Transfer: setTransferContext",e),h.telemetryHelper.recordEvent(r.EVENTS.SET_TRANSFER_CONTEXT),h.transferContext=e},this.muteAsync=function(e,t){return h.logger.log("muteAsync",e,t),h.telemetryHelper.recordEvent(r.EVENTS.MUTE),e===n["default"].MUTE_SCOPE.MYSELF?h.updateEndpointStateForMute(!0):(u.assert(h.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED,"mute operation for all or specified only allowed in a connected call"),h.participantManager.muteAsync(h.links[n["default"].LINKS.MUTE],e,t))},this.unmuteAsync=function(){var e=s["default"].isServerMuted(h.participantManager.localParticipant.endpointDetails,h.participantManager.localParticipant.endpointId);return h.logger.log("unmuteAsync, isServerMuted:",e),h.telemetryHelper.recordEvent(r.EVENTS.UNMUTE),!e||h.links[n["default"].LINKS.UNMUTE]==null?h.updateEndpointStateForMute(!1):(u.assert(h.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED,"unmute operation only allowed in a connected call"),h.participantManager.unmuteAsync(h.links[n["default"].LINKS.UNMUTE]).then(function(){return h.updateEndpointStateForMute(!1)}))},this.rejectUnmuteRequestAsync=function(e,t){return u.assert(h.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED,"rejectUnmute operation only allowed in a connected call"),u.assertNotNullOrEmpty(e,"requestor must be specified"),h.telemetryHelper.recordEvent(r.EVENTS.REJECT_UNMUTE),h.participantManager.rejectUnmuteRequestAsync(e,t)},this.approveUnmuteRequestAsync=function(e){return u.assert(h.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED,"approveUnmute operation only allowed in a connected call"),u.assertNotNullOrEmpty(e,"requestor must be specified"),h.telemetryHelper.recordEvent(r.EVENTS.APPROVE_UNMUTE),h.participantManager.approveUnmuteRequestAsync(e)},this.sendWebRtcMediaNotificationAsync=function(e){return u.assert(h.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED,"webRtc media notification can only be sent in a connected call"),h.telemetryHelper.recordEvent(r.EVENTS.SEND_WEBRTC_MEDIA_NOTIFICATION),h.webRtcSignalingManager.sendControlVideoStreamingAsync(h.links[n["default"].LINKS.CONTROL_VIDEO_STREAMING],e)},this.addParticipantAsync=function(e,t,i,s){u.assertNotNull(e,"remoteParticipant should be a non null value"),u.assert(h.isCallOngoing(),"remoteParticipants can only be added before starting an outgoing call or to an ongoing call"),h.logger.log("addParticipantAsync",e.id,t,i),h.telemetryHelper.recordEvent(r.EVENTS.ADD_PARTICIPANT);var o=h.threadId||i,a=h.teamsMessageId||s,f=o?h.links[n["default"].LINKS.ADD_PARTICIPANT_AND_MODALITY]:h.links[n["default"].LINKS.ADD_PARTICIPANT];return h.participantManager.addParticipantAsync(e,f,h.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED,t,o,a)},this.callMeBackAsync=function(e){return u.assertNotNull(e,"remoteParticipant should be a non null value"),u.assert(h.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED,"call me back can only be called during an ongoing call"),h.logger.log("callMeBackAsync",e.id),h.telemetryHelper.recordEvent(r.EVENTS.CALL_ME_BACK),h.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED&&u.assertNotNullOrEmpty(h.threadId,"threadId must be set before using call me back"),h.participantManager.callMeBackAsync(e,h.links[n["default"].LINKS.ADD_PARTICIPANT_AND_MODALITY],h.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED)},this.removeParticipantAsync=function(e){return u.assertNotNull(e,"remoteParticipant should be a non null value"),u.assert(h.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED,"participants can only be removed from an ongoing call"),h.logger.log("removeParticipantAsync",e.id),h.telemetryHelper.recordEvent(r.EVENTS.REMOVE_PARTICIPANT),h.participantManager.removeParticipantAsync(e,h.links[n["default"].LINKS.REMOVE_PARTICIPANT])},this.admitParticipantAsync=function(e){return u.assertNotNull(e,"remoteParticipant should be a non null value"),u.assert(h.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED,"remoteParticipants can only be admitted to an ongoing call"),u.assertNotNullOrEmpty(h.threadId,"threadId must be set before admitting more participants to connected call"),h.logger.log("admitParticipantAsync",e.id),h.telemetryHelper.recordEvent(r.EVENTS.ADMIT_PARTICIPANT),h.participantManager.admitParticipantAsync(e,h.links[n["default"].LINKS.ADMIT])},this.startContentSharingAsync=function(e,t,i,s){return u.assertNotNull(e,"contentIdentifier should be a non null value"),u.assert(h.isCallOngoing(),"contentSharing can only be added before starting an outgoing call or to an ongoing call"),h.logger.log("ContentSharing: start",e,t),h.telemetryHelper.recordEvent(r.EVENTS.ADD_CONTENT_SHARING_MODALITY),h.contentSharingManager.startContentSharingAsync(e,t,i,h.links[n["default"].LINKS.ADD_MODALITY],h.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED,s)},this.deleteContentSharingAsync=function(e){return h.telemetryHelper.recordEvent(r.EVENTS.DELETE_CONTENT_SHARING),h.contentSharingManager.deleteContentSharingAsync(e)},this.joinContentSharingAsync=function(e){return h.telemetryHelper.recordEvent(r.EVENTS.JOIN_CONTENT_SHARING),h.contentSharingManager.joinContentSharingAsync(e)},this.updateContentSharingSessionStateAsync=function(e,t){return u.assertNotNull(t,"sessionState should be a non null value"),h.telemetryHelper.recordEvent(r.EVENTS.UPDATE_SESSION_STATE_CONTENT_SHARING),h.logger.log("ContentSharing: update session state",t),h.contentSharingManager.updateContentSharingSessionStateAsync(e,t)},this.takeContentSharingControlAsync=function(e){return h.telemetryHelper.recordEvent(r.EVENTS.TAKE_CONTROL_CONTENT_SHARING),h.contentSharingManager.takeContentSharingControlAsync(e)},this.updateContentSharingParticipantStateAsync=function(e){return h.telemetryHelper.recordEvent(r.EVENTS.UPDATE_PARTICIPANT_STATE_CONTENT_SHARING),h.contentSharingManager.updateContentSharingParticipantStateAsync(e)},this.startOutgoingCall=function(e,t,i,s){u.assertNotNull(e,"mediaContent should be a non null value"),u.assertNotNull(e.blob,"outgoingSdp should be a non null value"),u.assert(h.fsmState===n["default"].SIGNALING_FSM_STATE.IDLE,"a call is already in progress"),h.logger.log("startOutgoingCall");if(h.disposed){h.logger.warn("startOutgoingCall canceled");return}h.telemetryHelper.recordEvent(r.EVENTS.START_CALL),h.telemetryHelper.setDirection(r["default"].DIRECTION.OUTGOING),h.telemetryHelper.setRole(r["default"].ROLE.CALLER),h.telemetryHelper.startCallInitializationWatch(s),h.telemetryHelper.setMeetingInfo(h.getMeetingInfo()),h.isBrokerEnabledForOutgoingCall()&&h.setupBrokerChannel(),h.fsmState=n["default"].SIGNALING_FSM_STATE.OUTGOING;var o={newCall:!0,suppressDialout:i?i.suppressDialout||!1:!1,castCall:i?i.castCall||!1:!1,conversationServiceUrl:h.signalingAgentConfig.conversationServiceUrl,onBehalfOf:i?i.onBehalfOf:null,enableLightWeightMeeting:!1,callToVoicemail:i?i.callToVoicemail:!1,voicemailResourcePath:i?i.voicemailResourcePath:null,voicemailItemId:i?i.voicemailItemId:null};h.isCastCall=o.castCall,h.onBehalfOf=o.onBehalfOf,h.placeCall(o,e,t)},this.joinGivenConversation=function(e,t,i,s,o){u.assertNotNull(i,"mediaContent should be a non null value"),u.assertNotNull(i.blob,"outgoingSdp should be a non null value"),u.assertNotNull(t,"correlationId should be a non null value"),u.assertNotNullOrEmpty(e,"conversationUrl should be a non null value"),u.assert(h.isCallInProgress(),"a call is already in progress"),h.logger.log("joinGivenConversation with url = "+e+" , correlationId = "+t);if(h.disposed){h.logger.warn("joinGivenConversation canceled");return}h.telemetryHelper.recordEvent(r.EVENTS.JOIN_CALL),h.telemetryHelper.setDirection(r["default"].DIRECTION.INCOMING),h.telemetryHelper.setRole(r["default"].ROLE.JOIN),h.telemetryHelper.startCallInitializationWatch(o),h.isBrokerEnabledForIncomingCall()&&h.setupBrokerChannel(),h.fsmState=n["default"].SIGNALING_FSM_STATE.OUTGOING,h.correlationId=t;var a={newCall:!1,suppressDialout:!0,castCall:!1,conversationServiceUrl:e,enableLightWeightMeeting:!1};h.isCastCall=a.castCall,h.placeCall(a,i,s)},this.subscribeToCall=function(e,t){u.assertNotNull(t,"correlationId should be a non null value"),u.assertNotNullOrEmpty(e,"conversationUrl should be a non null value"),u.assert(h.fsmState===n["default"].SIGNALING_FSM_STATE.IDLE,"a call is already in progress"),h.logger.log("subscribeToCall with url = "+e+" , correlationId = "+t);if(h.disposed){h.logger.warn("subscribeToCall canceled");return}h.telemetryHelper.recordEvent(r.EVENTS.JOIN_CONVERSATION_WITHOUT_CALL_MODALITY),h.telemetryHelper.setDirection(r["default"].DIRECTION.INCOMING),h.telemetryHelper.setRole(r["default"].ROLE.JOIN_FOR_ROSTER_ONLY),h.telemetryHelper.setConversationServiceUrl(e),h.telemetryHelper.setCallerType(h.participantManager.localParticipant.id),h.isBrokerEnabledForIncomingCall()&&h.setupBrokerChannel(),h.fsmState=n["default"].SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY,h.correlationId=t,h.http.sendPostRequest({url:e,requestName:r.NETWORK_REQUESTS.JOIN_CONVERSATION_WITHOUT_CALL_MODALITY,payload:l.getPayload(h)}).then(function(e){if(!h.disposed){if(!e.response.roster)throw new Error("response does not contain a roster");h.fsmState=n["default"].SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY,h.processConversationServiceResponse(e.response),h.onCallStatusChanged(n["default"].CALL_STATUS.CONNECTED_FOR_ROSTER_ONLY),h.internalHandleRosterUpdate(e.response.roster)}})["catch"](function(e){if(!h.disposed){h.fsmState=n["default"].SIGNALING_FSM_STATE.IDLE;var t=u.getErrorForXHRFailure(e);h.telemetryHelper.setTerminatingData({terminatingEnd:r["default"].CALL_TERMINATING_END.LOCAL,resultValue:r["default"].RESULT_VALUE.FAILURE,endCode:t.telemetryEndSubCode,endSubCode:t.error.subCode,resultDetail:"Subscribe to call failed:"+u.getPrintableObject(e)}),h.onCallStatusChanged(n["default"].CALL_STATUS.LOCAL_TERMINATED,t.error),h.dispose(t.error)}})},this.transferCallAsync=function(e,t){u.assert(h.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED,"call is not connected yet"),h.logger.log("Transfer: transferCallAsync",e,t),h.telemetryHelper.recordEvent(r.EVENTS.TRANSFER_CALL),h.timeoutManager.startTimer(n["default"].TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT,function(){return h.handleCallTransferTimeout()}),h.http.sendPostRequest({url:h.links[n["default"].LINKS.TRANSFER],requestName:r.NETWORK_REQUESTS.SEND_TRANSFER_REQUEST,payload:T.getPayload(e,h,t)})["catch"](function(e){h.logger.error("transferCallAsync failed because: "+u.getPrintableObject(e)),h.disposed||h.signalingSessionCallback.onTransferCompleted({code:n["default"].CALL_END_CODE.NETWORK_ERROR,reason:u.getPrintableObject(e)})})},this.getCallStatus=function(){return h.currentCallStatus},this.processIncomingCallRequest=function(e){u.assertNotNull(e,"request should be a non null value"),u.assertNotNullOrEmpty(e.body,"request should have a valid body"),u.assertNotNullOrEmpty(e.body.gp,"request does not look valid"),u.assert(h.isCallInProgress(),"a call is already in progress"),h.logger.log("processIncomingCallRequest");if(h.disposed){h.logger.warn("processIncomingCallRequest canceled");return}h.telemetryHelper.recordEvent(r.EVENTS.HANDLE_INCOMING_CALL),h.telemetryHelper.setDirection(r["default"].DIRECTION.INCOMING),h.telemetryHelper.setRole(r["default"].ROLE.CALLEE),h.telemetryHelper.setCalleeType(h.participantManager.localParticipant.id),h.telemetryHelper.startCallInitializationWatch(),h.isIncomingCall=!0,h.isBrokerEnabledForIncomingCall()&&h.setupBrokerChannel(),h.fsmState=n["default"].SIGNALING_FSM_STATE.INCOMING,h.participantManager.initializeForIncomingCall();try{var t=atob(e.body.gp),i=JSON.parse(t);if(!i.callNotification)throw"CallNotification is missing";h.processIncomingCallPayload(i),h.incomingCallPayload=i}catch(s){h.endIncomingCallBecauseOfInvalidPayload()}},this.handleIncomingCall=function(){return h.logger.log("handleIncomingCall"),h.incomingCallPayload?(h.onCallStatusChanged(n["default"].CALL_STATUS.IDLE),h.sendAttachToCall()):(h.endIncomingCallBecauseOfInvalidPayload(),Promise.reject(n["default"].CALL_END_SUB_CODE.BAD_NOTIFICATION_PAYLOAD))},this.endAsync=function(e,t){h.logger.log("endAsync",e&&JSON.stringify(e));if(h.disposed)return h.logger.warn("endAsync canceled but session already disposed"),Promise.resolve(null);h.telemetryHelper.recordEvent(r.EVENTS.END_CALL,e?{code:e.code,subCode:e.subCode}:undefined);if(h.fsmState===n["default"].SIGNALING_FSM_STATE.INCOMING)return h.rejectIncomingCall(e);if(h.fsmState===n["default"].SIGNALING_FSM_STATE.OUTGOING||h.fsmState===n["default"].SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY)return h.cancelOutgoingCall(e);if(h.fsmState===n["default"].SIGNALING_FSM_STATE.WAITING_CALL_ACCEPTANCE_ACK)return h.rejectIncomingCall(e);if((h.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED||h.mediaRenegotiationManager.isIncomingRenegotiationInProgress()||h.mediaRenegotiationManager.isOutgoingRenegotiationInProgress())&&t)return h.deleteConversation(e);if(h.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED||h.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY||h.mediaRenegotiationManager.isIncomingRenegotiationInProgress()||h.mediaRenegotiationManager.isOutgoingRenegotiationInProgress())return h.terminateEstablishedCall(e);h.logger.log("endAsync, there is no call to cancel or end or reject in current state");var i=e||{code:n["default"].CALL_END_CODE.NOT_FOUND,subCode:n["default"].CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:n["default"].CALL_END_PHRASE.CALL_DOES_NOT_EXIST};return h.telemetryHelper.setTerminatingData({terminatingEnd:r["default"].CALL_TERMINATING_END.LOCAL,resultDetail:"There is no call to cancel or end or reject",endCode:i.code,endSubCode:i.subCode}),h.onCallStatusChanged(n["default"].CALL_STATUS.LOCAL_TERMINATED,i),h.dispose(i),Promise.resolve(null)},this.handleIncomingMsgAsync=function(e,t){t===void 0&&(t=n["default"].INCOMING_MESSAGE_ORIGIN.TROUTER),u.assertNotNull(e,"incoming message should be a non null value");var i=e.headers?e.headers[n["default"].HEADERS.ORIGINAL_MESSAGE_ID]:"unknown",s=u.defer(),o=e.body,a=e.url,f=__assign({},e,{origin:t});h.logger.log("handleIncomingMsg","message id:",i,"message url:",a);if(!o)return h.logger.error("handleIncomingMsg : received message with no body to : "+e.url),h.telemetryHelper.recordEvent(r.EVENTS.MESSAGE_MISSING_BODY,{origin:t,messageId:i}),s.reject(new Error("received message with no body")),s.promise;if(h.disposed)return h.logger.log("handleIncomingMsg : received message after call is disposed"),s.reject(new Error("received message after call is disposed")),s.promise;if(h.isDuplicatedIncomingMessage(f))return h.logger.info("handleIncomingMsg : message was already handled",f),h.telemetryHelper.recordEvent(r.EVENTS.DUPLICATE_MESSAGE_IGNORED,{origin:t,messageId:i}),s.resolve(new Error("Message was already handled")),s.promise;var l=(m={},m[n["default"].PAYLOAD_PROPERTY.CALL_NOTIFICATION]=function(e){return h.handleCallNotification(e)},m[n["default"].PAYLOAD_PROPERTY.MEDIA_ANSWER]=function(e){return h.handleMediaAnswer(e)},m[n["default"].PAYLOAD_PROPERTY.MEDIA_ACKNOWLEDGEMENT]=function(e){return h.handleMediaAcknowledgement(e)},m[n["default"].PAYLOAD_PROPERTY.CALL_ACCEPTANCE]=function(e){return h.handleCallAcceptance(e)},m[n["default"].PAYLOAD_PROPERTY.CALL_END]=function(e){return h.handleCallEnd(e)},m[n["default"].PAYLOAD_PROPERTY.CALL_PROGRESS]=function(e){return h.handleCallProgress(e)},m[n["default"].PAYLOAD_PROPERTY.CALL_ACCEPTANCE_ACKNOWLEDGEMENT]=function(e){return h.handleCallAcceptanceAck(e)},m[n["default"].PAYLOAD_PROPERTY.MEDIA_NEGOTIATION]=function(e){return h.mediaRenegotiationManager.handleMediaNegotiationOffer(e)},m[n["default"].PAYLOAD_PROPERTY.MEDIA_NEGOTIATION_FAILURE]=function(e){return h.mediaRenegotiationManager.handleMediaNegotiationFailure(e)},m[n["default"].PAYLOAD_PROPERTY.BALANCE_UPDATE]=function(e){return h.handlePSTNBalanceUpdate(e)},m[n["default"].PAYLOAD_PROPERTY.RETARGET_COMPLETED]=function(e){return h.mediaRenegotiationManager.handleRetargetCompleted(e)},m[n["default"].PAYLOAD_PROPERTY.CALL_TRANSFER]=function(e){return h.handleTransferRequested(e)},m[n["default"].PAYLOAD_PROPERTY.TRANSFER_COMPLETION]=function(e){return h.handleTransferCompletion(e)},m[n["default"].PAYLOAD_PROPERTY.TRANSFER_ACCEPTANCE]=function(e){return h.handleTransferAcceptance(e)},m),c=(g={},g[n["default"].URL_PATH.CONTROL_VIDEO_STREAMING]=function(e){return h.webRtcSignalingManager.handleControlVideoStreaming(e)},g[n["default"].URL_PATH.DOMINANT_SPEAKER_INFO]=function(e){return h.webRtcSignalingManager.handleDominantSpeakerInfo(e)},g[n["default"].URL_PATH.CSRC_INFO]=function(e){return h.webRtcSignalingManager.handleCsrcInfo(e)},g[n["default"].URL_PATH.CONV_ROSTER_UPDATE]=function(e){return h.handleRosterUpdate(e)},g[n["default"].URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS]=function(e){return h.participantManager.handleAddParticipantSuccess(e)},g[n["default"].URL_PATH.CONV_ADD_PARTICIPANT_FAILURE]=function(e){return h.participantManager.handleAddParticipantFailure(e)},g[n["default"].URL_PATH.CONV_ADMIT_PARTICIPANT_SUCCESS]=function(e){return h.participantManager.handleAdmitParticipantSuccess(e)},g[n["default"].URL_PATH.CONV_ADMIT_PARTICIPANT_FAILURE]=function(e){return h.participantManager.handleAdmitParticipantFailure(e)},g[n["default"].URL_PATH.CONV_REMOVE_PARTICIPANT_SUCCESS]=function(e){return h.participantManager.handleRemoveParticipantSuccess(e)},g[n["default"].URL_PATH.CONV_REMOVE_PARTICIPANT_FAILURE]=function(e){return h.participantManager.handleRemoveParticipantFailure(e)},g[n["default"].URL_PATH.CONV_CONFIRM_UNMUTE]=function(e){return h.participantManager.handleUnmuteConfirmRequest(e)},g[n["default"].URL_PATH.CONV_UNMUTE_FAILURE]=function(e){return h.participantManager.handleUnmuteFailure(e)},g[n["default"].URL_PATH.CONV_UNMUTE_SUCCESS]=function(e){return h.participantManager.handleUnmuteSuccess(e)},g[n["default"].URL_PATH.CONV_UPDATE]=function(e){return h.handleConversationUpdate(e)},g[n["default"].URL_PATH.CONV_ADD_MODALITY_SUCCESS]=function(e){return h.handleAddModalitySuccess(e)},g[n["default"].URL_PATH.CONV_ADD_MODALITY_FAILURE]=function(e){return h.handleAddModalityFailure(e)},g[n["default"].URL_PATH.CONV_LIGHT_WEIGHT_MEETING_UPDATE]=function(e){return h.lightWeightMeetingSession.handleLightWeightMeetingUpdate(e)},g[n["default"].URL_PATH.CONV_LIGHT_WEIGHT_MEETING_END]=function(e){return h.lightWeightMeetingSession.handleLightWeightMeetingEndByService(e)},g[n["default"].URL_PATH.CONV_BROADCAST_UPDATE]=function(e){return h.broadcastSession.handleBroadcastStateChanged(e)},g[n["default"].URL_PATH.CONV_CONTENT_SHARING_UPDATE]=function(e){return h.contentSharingManager.handleContentSharingUpdate(e)},g[n["default"].URL_PATH.CONV_CONTENT_SHARING_END]=function(e){return h.contentSharingManager.handleContentSharingEnd(e)},g[n["default"].URL_PATH.CONV_END]=function(e){return h.handleCallEnd(e)},g);try{var p=Object.keys(l).filter(function(e){return o.hasOwnProperty(e)})[0],d=Object.keys(c).filter(function(e){return f.url&&u.stringEndsWith(f.url,e)})[0];p?l[p](f):d?c[d](f):(h.telemetryHelper.recordEvent(r.EVENTS.UNKNOWN_MESSAGE_TYPE,{messageId:i}),h.logger.error("handleIncomingMsg : received unknown message to : "+a+"  with body : "+u.getPrintableObject(o))),s.resolve(!0)}catch(v){h.telemetryHelper.recordEvent(r.EVENTS.FAILED_TO_HANDLE_MESSAGE,{messageId:i}),h.logger.error("handleIncomingMsg failed with error : "+v.message+"stack trace : "+v.stack),s.reject(new Error(v.message))}return s.promise;var m,g},this.canHandleIncomingMsgSync=function(e){if(h.signalingAgentConfig.supportsSynchronousTrouterResponse){var t=e.body;return Boolean(t.callAcceptance)}return!1},this.handleIncomingMsgSync=function(e){var t=e.headers?e.headers[n["default"].HEADERS.ORIGINAL_MESSAGE_ID]:"unknown",i=e.body,s=e.url,o=n["default"].INCOMING_MESSAGE_ORIGIN.TROUTER,a=__assign({},e,{origin:o});h.logger.log("handleIncomingMsg","message id:",t,"message url:",s);var f,l=n["default"].HTTP_STATUS_CODES.OK,c="",p={};if(u.isDuplicateMessage(a.headers,h.incomingTrouterMessagesSeenSoFar)){h.logger.warn("handleIncomingMsgSync : received message was already handled");var d=u.getMessageResultFromCache(a.headers,h.incomingMessageSyncResponseCache);if(d)return h.logger.warn("handleIncomingMsgSync : returning previous result",d),d;h.telemetryHelper.recordEvent(r.EVENTS.DUPLICATE_MESSAGE_IGNORED,{origin:o,messageId:t}),h.logger.warn("handleIncomingMsgSync : previous result not found, returning error code:",n["default"].HTTP_STATUS_CODES.BAD_REQUEST),l=n["default"].HTTP_STATUS_CODES.BAD_REQUEST}else if(!i)h.logger.error("handleIncomingMsgSync : received message with no body to : "+a.url),h.telemetryHelper.recordEvent(r.EVENTS.MESSAGE_MISSING_BODY,{origin:o,messageId:t}),l=n["default"].HTTP_STATUS_CODES.BAD_REQUEST;else if(i.callAcceptance)try{var v=h.handleCallAcceptanceSync(a);c=JSON.stringify(v)}catch(m){h.telemetryHelper.recordEvent(r.EVENTS.FAILED_TO_HANDLE_MESSAGE,{messageId:t,origin:o}),h.logger.error("handleIncomingMsgSync failed with error : "+m.message+"stack trace : "+m.stack),l=n["default"].HTTP_STATUS_CODES.BAD_REQUEST}return a.headers&&(a.headers[n["default"].HEADERS.CORRELATION_ID]&&(p[n["default"].HEADERS.CORRELATION_ID]=a.headers[n["default"].HEADERS.CORRELATION_ID]),a.headers[n["default"].HEADERS.MESSAGE_ID]&&(p[n["default"].HEADERS.MESSAGE_ID]=a.headers[n["default"].HEADERS.MESSAGE_ID])),f={resultCode:l,responseBody:c,responseHeaders:p},u.cacheMessageResult(a.headers,h.incomingMessageSyncResponseCache,f),h.logger.log("handleIncomingMsgSync : message handled with resultCode : ",l,"responseBody",c),f},this.acceptRenegotiationAsync=function(e,t){return u.assertNotNull(e.blob,"finalSdp should be a non null value"),u.assert(h.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED,"Renegotation operations are only allowed when the call is connected and no disconnect operation is in flight"),h.logger.log("acceptRenegotiationAsync",t),h.mediaRenegotiationManager.acceptRenegotiationAsync(e,t)},this.setProvisionalAnswerAsync=function(e){u.assertNotNull(e.blob,"sdp should be a non null value"),h.telemetryHelper.recordEvent(r.EVENTS.SET_PROVISIONAL_ANSWER);var t=u.defer();return h.fsmState!==n["default"].SIGNALING_FSM_STATE.INCOMING?(h.logger.log("there is no incoming call to set provisional answer on."),t.reject(new Error("there is no incoming call to set provisional answer on.")),t.promise):(h.http.sendPostRequest({url:h.links[n["default"].LINKS.MEDIA_ANSWER],requestName:r.NETWORK_REQUESTS.SEND_MEDIA_ANSWER,payload:x.getPayload(h,e)}).then(function(e){h.disposed||h.onCallStatusChanged(n["default"].CALL_STATUS.CONNECTING),t.resolve(e.response),h.disposed||(h.telemetryHelper.recordEvent(r.EVENTS.HANDLE_MEDIA_ACKNOWLEDGEMENT),h.telemetryHelper.setTimeToRingDuration(),h.onCallStatusChanged(n["default"].CALL_STATUS.RINGING),h.signalingSessionCallback.onMediaAcknowledgementSuccess(!1))})["catch"](function(e){h.logger.error("setProvisionalAnswerAsync failed because: "+u.getPrintableObject(e)),h.disposed||h.telemetryHelper.recordEvent(r.EVENTS.SET_PROVISIONAL_ANSWER_FAILED),t.reject(r.EVENTS.SET_PROVISIONAL_ANSWER_FAILED)}),t.promise)},this.startRenegotiationAsync=function(e,t){return u.assertNotNull(e,"mediaContent should be a non null value"),u.assert(h.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED,"Renegotation operations are only allowed when the call is connected and no disconnect operation is in flight"),h.logger.log("startRenegotiationAsync"),h.mediaRenegotiationManager.startRenegotiationAsync(e,h.links[n["default"].LINKS.MEDIA_RENEGOTIATION],t)},this.acceptAsync=function(e,t){u.assertNotNull(e,"mediaContent should be a non null value"),u.assertNotNull(e.blob,"outgoingSdp should be a non null value"),h.logger.log("acceptAsync"),h.telemetryHelper.recordEvent(r.EVENTS.ACCEPT_CALL);var i=u.defer();return h.fsmState!==n["default"].SIGNALING_FSM_STATE.INCOMING?(h.logger.warn("acceptAsync, there is no incoming call to accept"),i.reject(new Error("there is no incoming call to accept")),i.promise):(h.fsmState=n["default"].SIGNALING_FSM_STATE.WAITING_CALL_ACCEPTANCE_ACK,h.http.sendPostRequest({url:h.links[n["default"].LINKS.ACCEPT],requestName:r.NETWORK_REQUESTS.SEND_ACCEPTANCE,payload:v.getPayload(h,e,t)}).then(function(e){h.disposed||(h.currentCallStatus===n["default"].CALL_STATUS.IDLE&&(h.telemetryHelper.setTimeToRingDuration(),h.telemetryHelper.recordEvent(r.EVENTS.ACCEPTED_BEFORE_RINGING),h.onCallStatusChanged(n["default"].CALL_STATUS.CONNECTING)),e.response.callAcceptanceAcknowledgement&&(h.logger.log("acceptAsync, handling inlined callAcceptanceAcknowledgement"),h.internalHandleCallAcceptanceAck(e.response))),i.resolve(e.response)})["catch"](function(e){h.disposed||(h.fsmState=n["default"].SIGNALING_FSM_STATE.INCOMING),i.reject(new Error("acceptAsync, failed because : "+u.getPrintableObject(e)))}),i.promise)},this.rejectRenegotiationAsync=function(e){return u.assert(h.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED,"Renegotation operations are only allowed when the call is connected and no disconnect operation is in flight"),h.logger.error("rejectRenegotiationAsync",e),h.mediaRenegotiationManager.rejectRenegotiationAsync(e)},this.saveMediaControllerLinksIfAny=function(e){e.links&&e.links.controlVideoStreaming&&(h.links[n["default"].LINKS.CONTROL_VIDEO_STREAMING]=e.links.controlVideoStreaming)},this.endIncomingCallBecauseOfInvalidPayload=function(){h.fsmState=n["default"].SIGNALING_FSM_STATE.IDLE,h.telemetryHelper.setTerminatingData({terminatingEnd:r["default"].CALL_TERMINATING_END.LOCAL,resultValue:r["default"].RESULT_VALUE.FAILURE,endCode:n["default"].CALL_END_CODE.BAD_REQUEST,endSubCode:n["default"].CALL_END_SUB_CODE.BAD_NOTIFICATION_PAYLOAD,resultDetail:"Invalid callNotification request"});var e={code:n["default"].CALL_END_CODE.BAD_REQUEST,subCode:n["default"].CALL_END_SUB_CODE.BAD_NOTIFICATION_PAYLOAD,phrase:n["default"].CALL_END_PHRASE.BAD_NOTIFICATION_PAYLOAD};h.onCallStatusChanged(n["default"].CALL_STATUS.LOCAL_TERMINATED,e),h.dispose(e)},this.isDuplicatedIncomingMessage=function(e){return e.origin===n["default"].INCOMING_MESSAGE_ORIGIN.BROKER&&u.isDuplicateMessage(e.headers,h.incomingBrokerMessagesSeenSoFar)||e.origin===n["default"].INCOMING_MESSAGE_ORIGIN.TROUTER&&u.isDuplicateMessage(e.headers,h.incomingTrouterMessagesSeenSoFar)},this.updateEndpointStateForMute=function(e){if(!h.signalingAgentConfig.serverMuteUnmute)return Promise.resolve(null);var t=h.getEndpointState();return!e&&t.state.isMuted===undefined?Promise.resolve(null):(t.state.isMuted=e,h.updateEndpointState(t),Promise.resolve(null))},this.getEndpointState=function(){var e;return h.currentCallStatus===n["default"].CALL_STATUS.CONNECTED?e=_.cloneDeep(h.endpointStateOnServer):e=_.cloneDeep(h.pendingEndpointStateWhileConnecting),_.isEmpty(e)&&(e={endpointStateSequenceNumber:h.endpointStateSequenceNumber,state:{}}),e},this.setupTrouterChannel=function(){h.logger.log("Broker config: outgoing="+h.signalingAgentConfig.brokerEnabledOutgoing?"enabled":"disabledincoming="+h.signalingAgentConfig.brokerEnabledIncoming?"enabled":"disabledbatching="+h.signalingAgentConfig.brokerRequestBatching?"enabled":"disabledexclusive="+h.signalingAgentConfig.brokerExclusively?"enabled":"disabled");if(!h.brokerExclusiveEnabled()){var e=h.signalingAgentConfig.trouterUrlGetter.trouterUrl();e&&typeof e=="string"&&e.trim()&&(h.baseMessagingChannelUrl=h.previousTrouterUrl=h.currentTrouterUrl=e.trim(),h.telemetryHelper.addTrouterChannel()),h.signalingAgentConfig.trouterUrlGetter.trouterUrl.changed(h.onTrouterUrlChanged)}},this.brokerExclusiveEnabled=function(){return h.signalingAgentConfig.brokerEnabledOutgoing&&h.signalingAgentConfig.brokerEnabledIncoming&&h.signalingAgentConfig.brokerExclusively},this.isBrokerEnabledForOutgoingCall=function(){return h.signalingAgent.signalingAgentConfig.brokerEnabledOutgoing},this.isBrokerEnabledForIncomingCall=function(){return h.signalingAgent.signalingAgentConfig.brokerEnabledIncoming},this.setupBrokerChannel=function(){h.brokerService||(h.logger.log("setupBrokerChannel, Enable broker"),h.brokerService=new o["default"](h),h.brokerService.onBrokerMessage(function(e){h.logger.log("setupBrokerChannel, message from broker",e),h.handleIncomingMsgAsync(e,n["default"].INCOMING_MESSAGE_ORIGIN.BROKER)["catch"](function(e){h.telemetryHelper.recordEvent(r.EVENTS.FAILED_TO_HANDLE_BROKER_MESSAGE),h.logger.info("setupBrokerChannel, Failed to handle message from broker",e)})}),h.baseMessagingChannelUrl||(h.telemetryHelper.addBrokerChannel(),h.baseMessagingChannelUrl=h.brokerService.baseUrl))},this.onTrouterUrlChanged=function(){h.logger.log("onTrouterUrlChanged");if(h.disposed){h.logger.log("onTrouterUrlChanged ignored");return}h.telemetryHelper.recordEvent(r.EVENTS.TROUTER_URL_CHANGED,{url:h.signalingAgentConfig.trouterUrlGetter.trouterUrl()}),h.telemetryHelper.addTrouterChannel(),h.updateLinksToTrouter()},this.updateLinksToTrouter=function(){h.logger.log("updateLinksToTrouter"),h.ensureLatestTrouterUrl(r.EVENTS.TROUTER_URL_CHANGED).then(function(){h.previousTrouterUrl!==h.currentTrouterUrl?(h.previousTrouterUrl=h.currentTrouterUrl,h.updateConversationLinks(),h.updateKeepAliveUrl(),h.contentSharingManager.updateContentSharingNotificationLinksAsync(),h.broadcastSession.updateBroadcastCallbackUrl()):h.logger.info("updateLinksToTrouter, skip updating links, url did not change")})["catch"](function(e){h.disposed||h.telemetryHelper.recordEvent(r.EVENTS.TROUTER_URL_UPDATE_FAILED),h.logger.warn("updateLinksToTrouter, failed to update links to trouter")})},this.updateLinks=function(e){h.ensureLatestTrouterUrl(r.EVENTS.TROUTER_URL_CHANGED).then(function(){return e()})["catch"](function(e){h.disposed||h.telemetryHelper.recordEvent(r.EVENTS.TROUTER_URL_UPDATE_FAILED),h.logger.warn("Failed to update links")})},this.updateKeepAliveUrl=function(){h.logger.log("updateKeepAliveUrl"),h.links.hasOwnProperty(n["default"].LINKS.KEEPALIVE)?(h.linkUpdateRequested.keepAliveLinks=!1,h.logger.log("updateKeepAliveUrl, sending request"),h.sendToKeepAliveUrl(w.getPayload(h))):h.linkUpdateRequested.keepAliveLinks=!0},this.updateConversationLinks=function(){h.logger.log("updateConversationLinks"),h.telemetryHelper.recordEvent(r.EVENTS.UPDATE_CONVERSATION_LINKS),h.links.hasOwnProperty(n["default"].LINKS.NOTIFICATION_LINKS)?(h.linkUpdateRequested.conversationLinks=!1,h.logger.log("sending conversation service UpdateNotificationLinks request"),h.http.sendPostRequest({url:h.links[n["default"].LINKS.NOTIFICATION_LINKS],retryIntervals:[500,1e3,2e3,3e3],payload:S.getPayload(h),withoutTrouter:!0,requestName:r.NETWORK_REQUESTS.UPDATE_CONVERSATION_LINKS}).then(function(e){h.disposed||(h.telemetryHelper.recordEvent(r.EVENTS.UPDATE_CONVERSATION_LINKS_SUCCESS),h.processConversationServiceResponse(e.response))})["catch"](function(e){h.logger.error("updateConversationLinks failed because: "+u.getPrintableObject(e)),h.disposed||h.telemetryHelper.recordEvent(r.EVENTS.UPDATE_CONVERSATION_LINKS_FAILED)})):h.linkUpdateRequested.conversationLinks=!0},this.sendAttachToCall=function(){return h.telemetryHelper.recordEvent(r.EVENTS.SEND_ATTACH),h.http.sendPostRequest({url:h.incomingCallPayload.callNotification.links.attach,requestName:r.NETWORK_REQUESTS.SEND_CALL_ATTACH,payload:g.getPayload(h,h.incomingCallPayload.conversationInvitation.conversationController)}).then(function(e){if(!h.disposed){h.processInitialOffer(h.incomingCallPayload,e);var t=e.response.additionalActionResponses;t&&t.length>0&&(h.processConversationServiceResponse(t[0].output),t[0].output.roster&&(h.logger.log("sendAttachToCall, handling roster update from join response"),h.internalHandleRosterUpdate(t[0].output.roster))),h.onCallStatusChanged(n["default"].CALL_STATUS.RINGING),h.telemetryHelper.setTimeToRingDuration(),h.handleBrokerSubscription(e.response.callInvitation)}})["catch"](function(e){h.logger.error("sendAttachToCall failed because: "+u.getPrintableObject(e));if(!h.disposed){h.fsmState=n["default"].SIGNALING_FSM_STATE.IDLE;var t=u.getErrorForXHRFailure(e);h.telemetryHelper.setTerminatingData({terminatingEnd:r["default"].CALL_TERMINATING_END.LOCAL,resultValue:r["default"].RESULT_VALUE.FAILURE,endCode:t.telemetryEndSubCode,endSubCode:t.error.subCode,resultDetail:"Failed to attach to call. Error = "+u.getPrintableObject(e)}),h.onCallStatusChanged(n["default"].CALL_STATUS.LOCAL_TERMINATED,t.error),h.dispose(t.error)}})},this._processCallAcceptance=function(e){h.fsmState===n["default"].SIGNALING_FSM_STATE.OUTGOING&&(h.processCallAcceptance(e.body),h.telemetryHelper.setTimeToRingDuration(),h.multiParty||h.participantManager.handleRosterUpdate(h.getFakeRoster(e.body)))},this.restartKeepAliveInterval=function(e){e===void 0&&(e=!1),h.disposed||(e&&h.telemetryHelper.recordEvent(r.EVENTS.SEND_KEEP_ALIVE_FAILED),h.keepAliveTimer=window.setInterval(h.sendKeepAlive.bind(h),h.keepAliveInterval))},this.isCallOngoing=function(){return h.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED||h.fsmState===n["default"].SIGNALING_FSM_STATE.IDLE},this.isCallInProgress=function(){return h.fsmState===n["default"].SIGNALING_FSM_STATE.IDLE||h.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY},this.signalingSessionCallback=t,this.signalingAgentConfig=a,this.signalingAgent=c,this.urlIdentifier=f,this.correlationId=f,this.logger=a.logger.createChild(function(){return"SignalingAgent::["+h.correlationId+"]["+f+"]["+h.fsmState+"]"},this.correlationId,!0),this.http=new H.HttpStack(this),this.telemetryHelper=new i["default"](this),this.telemetryHelper.setCallSignalingConfiguration(this.signalingAgentConfig),this.mediaRenegotiationManager=new L["default"](this,t),this.participantManager=new k["default"](this,t,e),this.timeoutManager=new D["default"](this),this.contentSharingManager=new A["default"](this,t),this.lightWeightMeetingSession=new O["default"](this,t),this.broadcastSession=new M["default"](this,t),this.webRtcSignalingManager=new P["default"](this,t),this.pstnContent={emergencyCallCountry:a.emergencyCallCountry||"",platformName:a.clientInformation,publicApiCall:!1},this.setupTrouterChannel()}return e.prototype.getCallReplacementDetails=function(){return{replaces:this.links[n["default"].LINKS.REPLACE]}},e.prototype.onLightWeightMeetingEnded=function(e,t){this.logger.log("onLightWeightMeetingEnded");if(this.isCallOngoing()){this.logger.log("onLightWeightMeetingEnded, canceled, call is not ongoing");return}this.telemetryHelper.setTerminatingData({terminatingEnd:t?r["default"].CALL_TERMINATING_END.LOCAL:r["default"].CALL_TERMINATING_END.REMOTE,resultValue:e.code===n["default"].CALL_END_CODE.SUCCESS?r["default"].RESULT_VALUE.SUCCESS:r["default"].RESULT_VALUE.FAILURE,resultDetail:e.phrase,endCode:e.code,endSubCode:e.subCode}),this.fsmState=n["default"].SIGNALING_FSM_STATE.IDLE,this.onCallStatusChanged(t?n["default"].CALL_STATUS.LOCAL_TERMINATED:n["default"].CALL_STATUS.REMOTE_TERMINATED,e),this.dispose(e)},e.prototype.saveUpdatedCallLinksIfAny=function(e){e.links&&(this.logger.log("saveUpdatedCallLinksIfAny, updated call links found, update to new links"),this.links[n["default"].LINKS.MEDIA_RENEGOTIATION]=e.links.mediaRenegotiation||this.links[n["default"].LINKS.MEDIA_RENEGOTIATION],this.links[n["default"].LINKS.TRANSFER]=e.links.transfer||this.links[n["default"].LINKS.TRANSFER],this.links[n["default"].LINKS.REPLACE]=e.links.replacement||this.links[n["default"].LINKS.REPLACE],this.links[n["default"].LINKS.HANGUP]=e.links.callLeg||this.links[n["default"].LINKS.HANGUP],this.links[n["default"].LINKS.KEEPALIVE]=e.links.callLeg||this.links[n["default"].LINKS.KEEPALIVE])},e.prototype.ensureMessageChannelReady=function(e){return this.disposed?Promise.reject(new Error("Session already disposed")):this.brokerService?(this.telemetryHelper.addTrouterWaitOperation(r["default"].TROUTER_WAIT_OPERATION.STARTED+":"+e),this.telemetryHelper.addTrouterWaitOperation(r["default"].TROUTER_WAIT_OPERATION.ENDED+":"+e),Promise.resolve()):this.ensureLatestTrouterUrl(e)},e.prototype.ensureLatestTrouterUrl=function(e){var t=this;return this.telemetryHelper.addTrouterWaitOperation(r["default"].TROUTER_WAIT_OPERATION.STARTED+":"+e),this.signalingAgentConfig.trouterUrlGetter.getTrouterUrlAsync().then(function(n){if(!n||typeof n=="string"&&!n.trim())throw t.telemetryHelper.recordEvent(r.EVENTS.TROUTER_URL_CHANGED_TO_INVALID),t.telemetryHelper.addTrouterWaitOperation(r["default"].TROUTER_WAIT_OPERATION.ENDED+":"+e),"Invalid trouter url";if(t.disposed)throw"ensureLatestTrouterUrl, trouterUrlGetter returned too late. Object is already disposed";t.telemetryHelper.addTrouterWaitOperation(r["default"].TROUTER_WAIT_OPERATION.ENDED+":"+e),t.baseMessagingChannelUrl=t.currentTrouterUrl=n})["catch"](function(n){throw t.disposed||t.telemetryHelper.addTrouterWaitOperation(r["default"].TROUTER_WAIT_OPERATION.FAILED+":"+e),t.logger.error("ensureLatestTrouterUrl, failed because : "+n),n})},e.prototype.signalTransferAcceptedAsync=function(){return this.logger.log("Transfer: signalTransferAcceptedAsync"),this.disposed?(this.logger.log("Transfer: Call already ended, skip acceptance request"),Promise.reject({code:n["default"].CALL_END_CODE.CALL_DOES_NOT_EXIST,reason:null})):this.http.sendPostRequest({url:this.links[n["default"].LINKS.TRANSFER_ACCEPTANCE],requestName:r.NETWORK_REQUESTS.TRANSFER_ACCEPTANCE,payload:N.getPayload()})},e.prototype.signalTransferCompletedAsync=function(e){return this.logger.log("Transfer: signalTransferCompletedAsync"),this.disposed?(this.logger.log("Transfer: Call already ended by transferor, skip completion request"),Promise.reject({code:n["default"].CALL_END_CODE.CALL_DOES_NOT_EXIST,reason:null})):this.http.sendPostRequest({url:this.links[n["default"].LINKS.TRANSFER_COMPLETION],requestName:r.NETWORK_REQUESTS.TRANSFER_COMPLETION,payload:C.getPayload(e)})},e.prototype.endWithBeacon=function(){if(navigator&&navigator.sendBeacon&&!this.disposed){var e={code:n["default"].CALL_END_CODE.SUCCESS,subCode:n["default"].CALL_END_SUB_CODE.BEACON,phrase:n["default"].CALL_END_PHRASE.LOCAL_USER_INITIATED};this.telemetryHelper.recordEvent(r.EVENTS.END_WITH_BEACON);var t=JSON.stringify(c.getPayload(this,e).payload),i=this.links[n["default"].LINKS.LEAVE].indexOf("?")===-1?"?":"&",s="skypeToken="+this.signalingAgentConfig.lastSkypeToken;return navigator.sendBeacon(""+this.links[n["default"].LINKS.LEAVE]+i+s,t)}return!1},e.prototype.placeLightWeightMeetingCall=function(e){var t=this;this.logger.log("placeLightWeightMeetingCall"),this.telemetryHelper.setConversationServiceUrl(e.conversationServiceUrl);var i=B.build();if(!this.isCallInProgress()){u.assert(!1,"a call is already in progress"),this.telemetryHelper.addNetworkOperationCompleted(r.NETWORK_REQUESTS.PLACE_LIGHT_WEIGHT_MEETING_CALL,!1,i.duration()),this.onLightWeightMeetingEnded({code:n["default"].CALL_END_CODE.LOCAL_ERROR,subCode:n["default"].CALL_END_SUB_CODE.LIGHTWEIGHTMEETING_START_CALL_FAILED,phrase:n["default"].CALL_END_PHRASE.LIGHT_WEIGHT_MEETING_START_FAILED},!0);return}this.fsmState=n["default"].SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY;var s=e.newCall?a.getPayload(this,null,[],e):f.getPayload(this,null,[],e);this.timeoutManager.startTimer(n["default"].TIMEOUT_OPERATIONS.LIGHT_WEIGHT_MEETING_JOIN,this.lightWeightMeetingSession.handleLightWeightMeetingJoinTimeout.bind(this.lightWeightMeetingSession)),this.http.sendPostRequest({url:e.conversationServiceUrl,requestName:r.NETWORK_REQUESTS.PLACE_LIGHT_WEIGHT_MEETING_CALL,payload:s}).then(function(e){t.disposed||(t.processConversationServiceResponse(e.response),t.fsmState=n["default"].SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY,t.onCallStatusChanged(n["default"].CALL_STATUS.CONNECTED_FOR_ROSTER_ONLY))})["catch"](function(e){if(!t.disposed){t.fsmState=n["default"].SIGNALING_FSM_STATE.IDLE;var i=u.getErrorForXHRFailure(e);t.telemetryHelper.setTerminatingData({terminatingEnd:r["default"].CALL_TERMINATING_END.LOCAL,resultValue:r["default"].RESULT_VALUE.FAILURE,endCode:i.telemetryEndSubCode,endSubCode:i.error.subCode,resultDetail:"Failed to place light weight meeting call. Error = "+u.getPrintableObject(e)}),t.onCallStatusChanged(n["default"].CALL_STATUS.LOCAL_TERMINATED,i.error),t.dispose(i.error)}})},e.prototype.processConversationServiceResponse=function(e){this.logger.log("processConversationServiceResponse"),this.convJoined=!0,this.links[n["default"].LINKS.CONVERSATION_CONTROLLER]=e.conversationController,this.links[n["default"].LINKS.ADD_PARTICIPANT]=e.links.addParticipant,this.links[n["default"].LINKS.ADD_PARTICIPANT_AND_MODALITY]=e.links.addParticipantAndModality,this.links[n["default"].LINKS.LEAVE]=e.links.leave,this.links[n["default"].LINKS.NOTIFICATION_LINKS]=e.links.notificationLinks,this.links[n["default"].LINKS.REMOVE_PARTICIPANT]=e.links.removeParticipant,this.links[n["default"].LINKS.ADD_MODALITY]=e.links.addModality,this.links[n["default"].LINKS.REMOVE_MODALITY]=e.links.removeModality,this.links[n["default"].LINKS.MUTE]=e.links.mute||null,this.links[n["default"].LINKS.UNMUTE]=e.links.unmute||null,this.links[n["default"].LINKS.ADMIT]=e.links.admit||null,this.links[n["default"].LINKS.UPDATE_ENDPOINT_STATE]=e.links.updateEndpointState||null,this.convSubject=e.subject,e.activeModalities&&e.activeModalities.groupChat&&(this.threadId=e.activeModalities.groupChat.threadId,this.teamsMessageId=e.activeModalities.groupChat.messageId||null),e.state&&(this.multiParty=e.state.isMultiParty||!1,this.isHostLessCall=e.state.isHostless||!1,this.isCastCall=e.state.conversationType?e.state.conversationType==="cast":!1),this.handleMeetingDetailsChanged(e),this.handleBrokerSubscription(e),this.linkUpdateRequested.conversationLinks&&(this.logger.log("processConversationServiceResponse, Updating CS links as requested"),this.updateLinks(this.updateConversationLinks))},e.prototype.handleMeetingDetailsChanged=function(e){this.logger.log("handleMeetingDetailsChanged"),e.meetingDetails&&!_.isEqual(e.meetingDetails,this.meetingDetails)&&this.signalingSessionCallback.onMeetingDetailsUpdated&&(this.meetingDetails=e.meetingDetails,this.signalingSessionCallback.onMeetingDetailsUpdated(this.meetingDetails))},e.prototype.handleBrokerSubscription=function(e){e.links.subscribe&&(this.brokerService?this.brokerService.subscribeToBroker(e.links.subscribe):this.telemetryHelper.recordEvent(r.EVENTS.BROKER_DISABLED_SUBSCRIBE_URL_PRESENT))},e.prototype.cancelOutgoingCall=function(e){var t=this,i=u.defer(),s=e||{code:n["default"].CALL_END_CODE.CANCEL,subCode:n["default"].CALL_END_SUB_CODE.SUCCESS,phrase:n["default"].CALL_END_PHRASE.LOCAL_USER_INITIATED};return this.links.hasOwnProperty(n["default"].LINKS.LEAVE)?(this.logger.log("cancelOutgoingCall, cancelling outgoing call"),this.fsmState=n["default"].SIGNALING_FSM_STATE.IDLE,this.http.sendPostRequest({url:this.links[n["default"].LINKS.LEAVE],requestName:r.NETWORK_REQUESTS.CANCEL_CALL,payload:p.getPayload(this,s)}).then(function(e){t.disposed||(t.telemetryHelper.setTerminatingData({terminatingEnd:r["default"].CALL_TERMINATING_END.LOCAL,resultDetail:"User cancelled call",endCode:s.code,endSubCode:s.subCode}),t.onCallStatusChanged(n["default"].CALL_STATUS.LOCAL_TERMINATED,s),t.dispose(s)),i.resolve(e.response)})["catch"](function(e){t.logger.error("cancelOutgoingCall failed because: "+u.getPrintableObject(e)),t.disposed||(t.telemetryHelper.setTerminatingData({terminatingEnd:r["default"].CALL_TERMINATING_END.LOCAL,endCode:s.code,endSubCode:s.subCode,resultDetail:"Failed to Cancel Call. Error = "+u.getPrintableObject(e)}),t.onCallStatusChanged(n["default"].CALL_STATUS.LOCAL_TERMINATED,s),t.dispose(s)),i.resolve(null)})):(this.logger.log("cancelOutgoingCall, Conversation Service Leave Url is not yet set. Cannot leave conversation. Disposing anyways."),this.telemetryHelper.setTerminatingData({terminatingEnd:r["default"].CALL_TERMINATING_END.LOCAL,resultDetail:"Conversation Service Leave Url is not yet set",endCode:s.code,endSubCode:n["default"].CALL_END_SUB_CODE.CONV_URL_NOT_SET}),s.subCode=n["default"].CALL_END_SUB_CODE.CONV_URL_NOT_SET,this.onCallStatusChanged(n["default"].CALL_STATUS.LOCAL_TERMINATED,s),this.dispose(s),i.resolve(null)),i.promise},e.prototype.terminateEstablishedCall=function(e){var t=this;this.logger.log("terminateEstablishedCall");var i=u.defer();this.fsmState=n["default"].SIGNALING_FSM_STATE.IDLE;var s=this.convJoined?r.NETWORK_REQUESTS.LEAVE_CONVERSATION:r.NETWORK_REQUESTS.END_CALL,o=B.build(),a=e||{code:n["default"].CALL_END_CODE.SUCCESS,subCode:n["default"].CALL_END_SUB_CODE.SUCCESS,phrase:n["default"].CALL_END_PHRASE.LOCAL_USER_INITIATED};return this.endCallAndLeaveConversation(a).then(function(){t.logger.log("terminateEstablishedCall, success"),t.disposed||(t.telemetryHelper.setTerminatingData({terminatingEnd:r["default"].CALL_TERMINATING_END.LOCAL,endCode:a.code,endSubCode:a.subCode,resultDetail:a.phrase}),t.telemetryHelper.addNetworkOperationCompleted(s,!0,o.duration()),t.onCallStatusChanged(n["default"].CALL_STATUS.LOCAL_TERMINATED,a),t.dispose(a)),i.resolve(null)})["catch"](function(e){var f=u.getPrintableObject(e);t.logger.error("terminateEstablishedCall, failed:"+f),t.disposed||(t.telemetryHelper.setTerminatingData({terminatingEnd:r["default"].CALL_TERMINATING_END.LOCAL,endCode:a.code,endSubCode:a.subCode,resultDetail:"Failed to end Call. Error = "+f}),t.telemetryHelper.addNetworkOperationCompleted(s,!1,o.duration()),t.onCallStatusChanged(n["default"].CALL_STATUS.LOCAL_TERMINATED,a),t.dispose(a)),i.resolve(null)}),i.promise},e.prototype.deleteConversation=function(e){var t=this;this.logger.log("deleteConversation");var i=u.defer();this.fsmState=n["default"].SIGNALING_FSM_STATE.IDLE;var s=r.NETWORK_REQUESTS.DELETE_CONVERSATION,o=B.build(),a=e||{code:n["default"].CALL_END_CODE.SUCCESS,subCode:n["default"].CALL_END_SUB_CODE.SUCCESS,phrase:n["default"].CALL_END_PHRASE.CONV_END_FOR_ALL_INITIATED};return this.deleteConversationController(a).then(function(){t.logger.log("deleteConversation success"),t.disposed||(t.telemetryHelper.setTerminatingData({terminatingEnd:r["default"].CALL_TERMINATING_END.LOCAL,endCode:a.code,endSubCode:a.subCode,resultDetail:a.phrase}),t.telemetryHelper.addNetworkOperationCompleted(s,!0,o.duration()),t.onCallStatusChanged(n["default"].CALL_STATUS.LOCAL_TERMINATED,a),t.dispose(a)),i.resolve(null)})["catch"](function(e){var f=u.getPrintableObject(e);t.logger.error("deleteConversation, failed:"+f),t.disposed||(t.telemetryHelper.setTerminatingData({terminatingEnd:r["default"].CALL_TERMINATING_END.LOCAL,endCode:a.code,endSubCode:a.subCode,resultDetail:"Failed to end call for all. Error = "+f}),t.telemetryHelper.addNetworkOperationCompleted(s,!1,o.duration()),t.onCallStatusChanged(n["default"].CALL_STATUS.LOCAL_TERMINATED,a),t.dispose(a)),i.resolve(null)}),i.promise},e.prototype.endCallAndLeaveConversation=function(e){var t=this,n=this.deleteCall(e),r=this.leaveConversation(e);return Promise.all([n,r]).then(function(e){t.logger.log("endedCall and left conversation")})["catch"](function(e){t.logger.log("ignoring error encountered by endCallAndLeaveConversation. error = "+u.getPrintableObject(e))})},e.prototype.deleteCall=function(e){return this.links[n["default"].LINKS.HANGUP]?(this.logger.log("deleteCall"),this.http.sendDeleteRequest({url:this.links[n["default"].LINKS.HANGUP],requestName:r.NETWORK_REQUESTS.END_CALL,payload:d.getPayload(this,e),withoutTrouter:!0})):(this.logger.log("deleteCall ignored, ending call link on CallController not available"),Promise.resolve())},e.prototype.leaveConversation=function(e){return this.convJoined?(this.logger.log("leaveConversation"),this.http.sendPostRequest({url:this.links[n["default"].LINKS.LEAVE],requestName:r.NETWORK_REQUESTS.LEAVE_CONVERSATION,payload:c.getPayload(this,e),withoutTrouter:!0})):(this.logger.log("leaveConversation, ignore, not joined to conversation"),Promise.resolve())},e.prototype.deleteConversationController=function(e){return this.convJoined?(this.logger.log("deleteConversationController"),this.http.sendDeleteRequest({url:this.links[n["default"].LINKS.CONVERSATION_CONTROLLER],requestName:r.NETWORK_REQUESTS.DELETE_CONVERSATION,payload:h.getPayload(this,e),withoutTrouter:!0})):(this.logger.log("deleteConversationController, ignored, not joined to conversation"),Promise.resolve())},e.prototype.rejectIncomingCall=function(e){var t=this;this.telemetryHelper.recordEvent(r.EVENTS.REJECT_INCOMING_CALL);var i=u.defer();this.fsmState=n["default"].SIGNALING_FSM_STATE.IDLE;var s=e||{code:n["default"].CALL_END_CODE.REJECT,subCode:n["default"].CALL_END_SUB_CODE.SUCCESS,phrase:n["default"].CALL_END_PHRASE.LOCAL_USER_INITIATED};return this.http.sendDeleteRequest({url:this.links[n["default"].LINKS.REJECT],requestName:r.NETWORK_REQUESTS.REJECT_CALL,payload:m.getPayload(this,s)}).then(function(e){t.disposed||(t.telemetryHelper.setTerminatingData({terminatingEnd:r["default"].CALL_TERMINATING_END.LOCAL,endCode:s.code,endSubCode:s.subCode,resultDetail:"User rejected call"}),t.onCallStatusChanged(n["default"].CALL_STATUS.LOCAL_TERMINATED,s),t.dispose(s)),i.resolve(e.response)})["catch"](function(e){t.logger.error("rejectIncomingCall failed because: "+u.getPrintableObject(e));var o=u.getPrintableObject(e);t.disposed||(t.telemetryHelper.setTerminatingData({terminatingEnd:r["default"].CALL_TERMINATING_END.LOCAL,endCode:s.code,endSubCode:s.subCode,resultDetail:"Failed to reject call. Error = "+o}),t.onCallStatusChanged(n["default"].CALL_STATUS.LOCAL_TERMINATED,s),t.dispose(s)),i.resolve(null)}),i.promise},e.prototype.onCallStatusChanged=function(e,t){this.logger.log("onCallStatusChanged",this.currentCallStatus+" => "+e),this.disposed&&this.logger.warn("Call is already disposed!!"),t&&this.logger.log("onCallStatusChanged: statusCode = "+u.getPrintableObject(t)),this.orderOfCallState(e)>this.orderOfCallState(this.currentCallStatus)&&this.currentCallStatus!==e&&(this.currentCallStatus=e,this.telemetryHelper.recordEvent(r.EVENTS.UPDATE_CALL_STATUS,{callStatus:e,statusCode:t}),this.signalingSessionCallback.onCallStatusChanged(e,t),this.currentCallStatus===n["default"].CALL_STATUS.CONNECTED&&this.pendingEndpointStateWhileConnecting&&(this.logger.log("onCallStatusChanged sending pending endpoint state now that we are connected."),this.updateEndpointState(this.pendingEndpointStateWhileConnecting)))},e.prototype.orderOfCallState=function(e){switch(e){case n["default"].CALL_STATUS.IDLE:return 0;case n["default"].CALL_STATUS.CONNECTED_FOR_ROSTER_ONLY:return 0;case n["default"].CALL_STATUS.CONNECTING:return 1;case n["default"].CALL_STATUS.RINGING:return 2;case n["default"].CALL_STATUS.CONNECTED:return 3;case n["default"].CALL_STATUS.LOCAL_TERMINATED:case n["default"].CALL_STATUS.REMOTE_TERMINATED:return 4;default:return-1}},e.prototype.handlePSTNBalanceUpdate=function(e){var t=e.body.balanceUpdate;this.logger.log(r.EVENTS.HANDLE_PSTN_BALANCE_UPDATE),this.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_PSTN_BALANCE_UPDATE,e),t.updateBalance?this.signalingSessionCallback.onPSTNBalanceUpdate(t):this.logger.log(r.EVENTS.HANDLE_PSTN_BALANCE_UPDATE,"this was a pstn keepAlive message - ignore")},e.prototype.handleCallAcceptanceAck=function(e){var t=e.body;this.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_CALL_ACCEPTANCE_ACK,e),this.internalHandleCallAcceptanceAck(t)},e.prototype.internalHandleCallAcceptanceAck=function(e){if(this.fsmState===n["default"].SIGNALING_FSM_STATE.CONNECTED)return;this.links[n["default"].LINKS.MEDIA_RENEGOTIATION]=e.callAcceptanceAcknowledgement.links.mediaRenegotiation,this.links[n["default"].LINKS.TRANSFER]=e.callAcceptanceAcknowledgement.links.transfer,this.links[n["default"].LINKS.REPLACE]=e.callAcceptanceAcknowledgement.links.replacement,this.links[n["default"].LINKS.HANGUP]=e.callAcceptanceAcknowledgement.links.callLeg,this.links[n["default"].LINKS.KEEPALIVE]=e.callAcceptanceAcknowledgement.links.callLeg,this.saveMediaControllerLinksIfAny(e.callAcceptanceAcknowledgement),this.scheduleKeepAlives(e.callAcceptanceAcknowledgement.callKeepAliveInterval),this.fsmState=n["default"].SIGNALING_FSM_STATE.CONNECTED,this.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.INCOMING_CALL_ESTABLISHMENT),this.telemetryHelper.startCallConnectedWatch(),this.mediaRenegotiationManager.onCallConnected(),this.onCallStatusChanged(n["default"].CALL_STATUS.CONNECTED),this.linkUpdateRequested.keepAliveLinks&&(this.logger.log("handleCallAcceptanceAck, updating CC links as requested"),this.updateLinks(this.updateKeepAliveUrl))},e.prototype.placeCall=function(e,t,i){var s=this;this.logger.log("placeCall");if(this.disposed){this.logger.log("placeCall, session already disposed, ignore");return}this.multiParty||(this.multiParty=this.participantManager.getParticipantsToInitiateCallWith().length!==1),this.telemetryHelper.setConversationServiceUrl(e.conversationServiceUrl),this.mediaTypesToUse=i,this.lastUsedOutgoingMediaContent=t,this.telemetryHelper.setCallerType(this.participantManager.localParticipant.id);var o=e.newCall?a.getPayload(this,t,i,e):f.getPayload(this,t,i,e);this.http.sendPostRequest({url:e.conversationServiceUrl,requestName:r.NETWORK_REQUESTS.PLACE_CALL,payload:o}).then(function(e){s.disposed||(s.processConversationServiceResponse(e.response),s.onCallStatusChanged(n["default"].CALL_STATUS.CONNECTING))})["catch"](function(e){s.logger.error("placeCall failed because: "+u.getPrintableObject(e));if(!s.disposed){s.fsmState=n["default"].SIGNALING_FSM_STATE.IDLE;var t=u.getErrorForXHRFailure(e);s.telemetryHelper.setTerminatingData({terminatingEnd:r["default"].CALL_TERMINATING_END.LOCAL,resultValue:r["default"].RESULT_VALUE.FAILURE,endCode:t.telemetryEndSubCode,endSubCode:t.error.subCode,resultDetail:"Failed to place call. Error = "+u.getPrintableObject(e)}),s.onCallStatusChanged(n["default"].CALL_STATUS.LOCAL_TERMINATED,t.error),s.dispose(t.error)}})},e.prototype.processIncomingCallPayload=function(e){this.remoteCallerOrCallee=s["default"].fromWireParticipant(e.callNotification.from),this.participantManager.setLocalParticipantId(e.callNotification.to.participantId),this.links[n["default"].LINKS.CONVERSATION_CONTROLLER]=e.conversationInvitation.conversationController,this.links[n["default"].LINKS.ATTACH]=e.callNotification.links.attach,this.correlationId=e.debugContent.callId,this.multiParty=!!e.conversationInvitation.isMultiParty,this.isHostLessCall=!!e.conversationInvitation.isHostless,this.onBehalfOf=e.callNotification.onBehalfOf?e.callNotification.onBehalfOf.id:null,this.callType=e.callNotification.callType,this.incomingCallCallerId=e.callNotification.from.id,e.callNotification.transferor&&(this.transferor=e.callNotification.transferor.details?e.callNotification.transferor.details.id:null),e.groupChat&&e.groupChat.threadId&&(this.threadId=e.groupChat.threadId,this.teamsMessageId=e.groupChat.messageId||null)},e.prototype.processInitialOffer=function(e,t){this.telemetryHelper.recordEvent(r.EVENTS.PROCESS_INITIAL_OFFER),this.links[n["default"].LINKS.MEDIA_ANSWER]=t.response.callInvitation.links.mediaAnswer,this.links[n["default"].LINKS.ACCEPT]=t.response.callInvitation.links.acceptance,this.links[n["default"].LINKS.REJECT]=t.response.callInvitation.links.callLeg,this.links[n["default"].LINKS.REDIRECT]=t.response.callInvitation.links.redirection,this.sendProgress(t),this.telemetryHelper.setCallerType(this.getParticipantIdForOfferAnswer(t.response.callInvitation.mediaContent));var i=u.getMediaTypes(t.response.callInvitation.callModalities);this.telemetryHelper.addIncomingModalities(i),this.signalingSessionCallback.onOffer({subject:e.conversationInvitation.subject,remoteParticipantId:this.getParticipantIdForOfferAnswer(t.response.callInvitation.mediaContent),remoteEndpointId:t.response.participants.from.endpointId,transferor:t.response.callInvitation.transferor,mediaTypes:i,mediaContent:t.response.callInvitation.mediaContent,renegotiation:!1})},e.prototype.sendProgress=function(e){var t=this;this.telemetryHelper.recordEvent(r.EVENTS.SEND_PROGRESS),this.http.sendPostRequest({url:e.response.callInvitation.links.progress,requestName:r.NETWORK_REQUESTS.SEND_CALL_PROGRESS,payload:y.getPayload(this)})["catch"](function(e){t.logger.error("sendProgress failed because: "+u.getPrintableObject(e)),t.disposed||t.telemetryHelper.recordEvent(r.EVENTS.SEND_PROGRESS_FAILED)})},e.prototype.handleCallNotification=function(e){this.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_CALL_NOTIFICATION,e);if(!u.stringEndsWith(e.url,n["default"].URL_PATH.REPLACE))throw new Error("IncomingCallNotification should not be received in handleIncomingMsg");this.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_INCOMING_CALL_REPLACEMENT,e),this.logger.log("handleIncomingMsg : received replacementCallNotification"),this.signalingSessionCallback&&this.signalingSessionCallback.onIncomingCallReplacement(e.body)},e.prototype.handleMediaAnswer=function(e){this.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_MEDIA_ANSWER,e);var t=e.body;if(this.mediaRenegotiationManager.isOutgoingRenegotiationInProgress()){this.mediaRenegotiationManager.handleMediaAnswer(t);return}if(this.fsmState!==n["default"].SIGNALING_FSM_STATE.CONNECTED&&this.fsmState===n["default"].SIGNALING_FSM_STATE.OUTGOING){if(u.isDuplicateMessage(e.headers,this.provisionalMediaAnswersSeenSoFar)){this.logger.log("handleMediaAnswer, ignoring provisional answer retried by service");return}t.mediaAnswer.sender&&(this.remoteCallerOrCallee=t.mediaAnswer.sender),this.resetCallEstablishmentTimeout(),t.mediaAnswer.noRingBack||(this.telemetryHelper.setTimeToRingDuration(),this.onCallStatusChanged(n["default"].CALL_STATUS.RINGING)),this.signalingSessionCallback.onAnswer({provisional:!0,renegotiation:!1,remoteEndpointId:t.mediaAnswer.sender?t.mediaAnswer.sender.endpointId:u.newGuid(),remoteParticipantId:this.getParticipantIdForOfferAnswer(t.mediaAnswer.mediaContent),mediaContent:t.mediaAnswer.mediaContent})}},e.prototype.handleCallAcceptance=function(e){var t=this;this.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_CALL_ACCEPTANCE,e),this._processCallAcceptance(e),this.http.sendPostRequest({url:e.body.callAcceptance.links.acknowledgement,requestName:r.NETWORK_REQUESTS.SEND_ACCEPTANCE_ACKNOWLEDGEMENT,payload:b.getPayload(this)})["catch"](function(e){t.logger.error("handleCallAcceptance failed because: "+u.getPrintableObject(e)),t.disposed||t.telemetryHelper.recordEvent(r.EVENTS.HANDLE_CALL_ACCEPTANCE_FAILED)})},e.prototype.handleCallAcceptanceSync=function(e){return this.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_CALL_ACCEPTANCE_SYNC,e),this._processCallAcceptance(e),b.getPayload(this).payload},e.prototype.getFakeRoster=function(e){var t=this.participantManager.getParticipantsToInitiateCallWith(),n;t.length===1?n=t[0].id:n=e.callAcceptance.acceptedBy.id;var r={id:n,displayName:e.callAcceptance.acceptedBy.id===n?e.callAcceptance.acceptedBy.displayName:"",endpointId:e.callAcceptance.acceptedBy.endpointId,participantId:e.callAcceptance.acceptedBy.participantId,languageId:e.callAcceptance.acceptedBy.languageId},i=e.callAcceptance.acceptedBy.endpointId,s={participants:(o={},o[n]={acceptedBy:e.callAcceptance.acceptedBy.id,details:r,endpoints:(u={},u[i]={call:{},contentSharing:{},capabilities:e.callAcceptance.capabilities},u)},o)};return s;var o,u},e.prototype.processCallAcceptance=function(e){this.telemetryHelper.recordEvent(r.EVENTS.PROCESS_CALL_ACCEPTANCE),this.fsmState=n["default"].SIGNALING_FSM_STATE.CONNECTED,this.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT),this.telemetryHelper.startCallConnectedWatch(),this.mediaRenegotiationManager.onCallConnected();var t=!1;e.callAcceptance.controllerName===n["default"].MISC.LOBBY_CALL_CONTROLLER&&(this.logger.log("Controller name is lobby so putting user in lobby"),this.participantManager.localParticipant.endpointDetails.push({isLobby:!0,endpointId:this.participantManager.localParticipant.endpointId}),t=!0);var i=this.mediaTypesToUse,o=u.newGuid();e.callAcceptance.acceptedBy&&(this.remoteCallerOrCallee=s["default"].fromWireParticipant(e.callAcceptance.acceptedBy),o=e.callAcceptance.acceptedBy.endpointId),e.callAcceptance.acceptedCallModalities&&e.callAcceptance.acceptedCallModalities.length>0&&(i=e.callAcceptance.acceptedCallModalities);var a=u.getMediaTypes(i);this.telemetryHelper.addIncomingModalities(a),this.links[n["default"].LINKS.MEDIA_RENEGOTIATION]=e.callAcceptance.links.mediaRenegotiation,this.links[n["default"].LINKS.TRANSFER]=e.callAcceptance.links.transfer,this.links[n["default"].LINKS.REPLACE]=e.callAcceptance.links.replacement,this.links[n["default"].LINKS.HANGUP]=e.callAcceptance.links.callLeg,this.links[n["default"].LINKS.KEEPALIVE]=e.callAcceptance.links.callLeg,this.saveMediaControllerLinksIfAny(e.callAcceptance),this.scheduleKeepAlives(e.callAcceptance.callKeepAliveInterval);var f=this.getParticipantIdForOfferAnswer(e.callAcceptance.mediaContent);this.signalingSessionCallback.onAnswer({provisional:!1,renegotiation:!1,remoteEndpointId:o,remoteParticipantId:f,callAcceptedByNGCVoicemail:f===n["default"].KNOWN_BOTS.VOICEMAIL_BOT_ID,mediaTypes:a,mediaContent:e.callAcceptance.mediaContent}),this.onCallStatusChanged(n["default"].CALL_STATUS.CONNECTED),t&&this.signalingSessionCallback.onSelfParticipantUpdated(this.participantManager.localParticipant),this.linkUpdateRequested.keepAliveLinks&&(this.logger.log("Updating CC links as requested"),this.updateLinks(this.updateKeepAliveUrl))},e.prototype.handleCallEnd=function(e){var t=e.body.callEnd||e.body;this.logger.log("handleCallEnd:",u.getPrintableObject(t)),this.telemetryHelper.recordEvent(r.EVENTS.HANDLE_CALL_END,{origin:e.origin,code:t?t.code:"unknown",subCode:t?t.subCode:"unknown"});if(this.fsmState===n["default"].SIGNALING_FSM_STATE.IDLE){this.logger.log("handleCallEnd, not handling incoming callEnd since fsmstate = SIGNALING_FSM_STATE.IDLE");return}if(t.code===n["default"].CALL_END_CODE.CONFLICT&&this.multiParty&&t.conversationUrl&&t.conversationUrl.Location)this.handleConversationResolutionConflict(t);else{t.callControllerTransactionEnd&&(this.logger.log("handleCallEnd: using CC end details specified in CS end"),t=t.callControllerTransactionEnd);var i=t.code===n["default"].CALL_END_CODE.SUCCESS||t.code===n["default"].CALL_END_CODE.CANCEL||t.code===n["default"].CALL_END_CODE.REJECT;this.telemetryHelper.setTerminatingData({terminatingEnd:r["default"].CALL_TERMINATING_END.REMOTE,resultDetail:t.phrase,resultValue:i?r["default"].RESULT_VALUE.SUCCESS:r["default"].RESULT_VALUE.FAILURE,endCode:t.code,endSubCode:t.subCode});var s={code:t.code,subCode:t.subCode,phrase:t.phrase};this.fsmState=n["default"].SIGNALING_FSM_STATE.IDLE,this.onCallStatusChanged(n["default"].CALL_STATUS.REMOTE_TERMINATED,s),this.dispose(s)}},e.prototype.handleConversationResolutionConflict=function(e){this.logger.log("handleConversationResolutionConflict"),this.fsmState=n["default"].SIGNALING_FSM_STATE.IDLE,this.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT),this.joinGivenConversation(e.conversationUrl.Location,e.correlationId,this.lastUsedOutgoingMediaContent,this.mediaTypesToUse)},e.prototype.handleCallProgress=function(e){this.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_CALL_PROGRESS,e);var t=e.body.callProgress;this.fsmState===n["default"].SIGNALING_FSM_STATE.OUTGOING&&(this.telemetryHelper.setTimeToRingDuration(),this.resetCallEstablishmentTimeout(),this.onCallStatusChanged(n["default"].CALL_STATUS.RINGING),t.status==="forwarded"&&this.signalingSessionCallback.onCallForwarded({destinationType:t.forwardingDestinationType||"user"}))},e.prototype.resetCallEstablishmentTimeout=function(){this.logger.log("resetCallEstablishmentTimeout"),this.timeoutManager.stopTimer(n["default"].TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT),this.timeoutManager.startTimer(n["default"].TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT,this.handleCallEstablishmentTimeout.bind(this))},e.prototype.handleMediaAcknowledgement=function(e){this.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_MEDIA_ACK,e);var t=e.body;this.currentCallStatus!==n["default"].CALL_STATUS.CONNECTED?this.telemetryHelper.recordEvent(r.EVENTS.HANDLE_MEDIA_PROVISIONAL_ACK):this.mediaRenegotiationManager.handleMediaAcknowledgment(t)},e.prototype.handleConversationUpdate=function(e){var t=e.body,n=e.headers,i=this.threadId,s=this.teamsMessageId;this.logger.log(r.EVENTS.HANDLE_CONVERSATION_UPDATE,u.getPrintableObject(t)),this.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_CONVERSATION_UPDATE,e),this.processConversationServiceResponse(t),this.updateCorrelationId(n),(this.threadId!==i||this.teamsMessageId!==s)&&this.signalingSessionCallback.onConversationUpdated({threadId:this.threadId,teamsMessageId:this.teamsMessageId}),this.lightWeightMeetingSession.handleIncomingLightWeightMeeting(t),this.broadcastSession.handleBroadcastDetailsChanged(t)},e.prototype.handleAddModalityFailure=function(e){var t=e.body;this.logger.log(r.EVENTS.HANDLE_ADD_MODALITY_FAILURE,u.getPrintableObject(t)),this.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_ADD_MODALITY_FAILURE,e),t.modalityFailure.contentSharing?this.contentSharingManager.handleAddModalityFailure(t):t.modalityFailure.groupChat&&this.signalingSessionCallback.onChatModalitySetupFailed({code:t.modalityFailure.groupChat.code,subCode:t.modalityFailure.groupChat.subCode,phrase:t.modalityFailure.groupChat.phrase})},e.prototype.handleAddModalitySuccess=function(e){var t=e.body;this.logger.log(r.EVENTS.HANDLE_ADD_MODALITY_SUCCESS,u.getPrintableObject(t)),this.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_ADD_MODALITY_SUCCESS,e),t.modalitySuccess.contentSharing&&this.contentSharingManager.handleAddModalitySuccess(t)},e.prototype.handleTransferRequested=function(e){var t=e.body.callTransfer;this.logger.log("Transfer:",r.EVENTS.HANDLE_TRANSFER_REQUESTED,t),this.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_TRANSFER_REQUESTED,e),this.links[n["default"].LINKS.TRANSFER_ACCEPTANCE]=t.links.transferAcceptance,this.links[n["default"].LINKS.TRANSFER_COMPLETION]=t.links.transferCompletion,this.signalingSessionCallback.onTransferRequested?this.signalingSessionCallback.onTransferRequested(t):this.logger.warn("Transfer:",r.EVENTS.HANDLE_TRANSFER_REQUESTED,"failed, no callback defined")},e.prototype.handleTransferAcceptance=function(e){var t=e.body;this.logger.log("Transfer:",r.EVENTS.HANDLE_TRANSFER_ACCEPTANCE,t),this.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_TRANSFER_ACCEPTANCE,e),this.signalingSessionCallback.onTransferAccepted?this.signalingSessionCallback.onTransferAccepted():this.logger.warn("Transfer:",r.EVENTS.HANDLE_TRANSFER_ACCEPTANCE,"failed, no callback defined")},e.prototype.handleTransferCompletion=function(e){var t=e.body.transferCompletion;this.logger.log("Transfer:",r.EVENTS.HANDLE_TRANSFER_COMPLETION,t),this.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_TRANSFER_COMPLETION,e),this.signalingSessionCallback.onTransferCompleted?this.signalingSessionCallback.onTransferCompleted(t):this.logger.warn("Transfer:",r.EVENTS.HANDLE_TRANSFER_COMPLETION,"failed, no callback defined")},e.prototype.handleRosterUpdate=function(e){var t=e.body;this.logger.debug(r.EVENTS.HANDLE_ROSTER_UPDATE,u.getPrintableObject(t)),this.telemetryHelper.recordIncomingEvent(r.EVENTS.HANDLE_ROSTER_UPDATE,e),this.internalHandleRosterUpdate(t)},e.prototype.internalHandleRosterUpdate=function(e){this.logger.debug(r.EVENTS.HANDLE_ROSTER_UPDATE,u.getPrintableObject(e));var t=e.sequenceNumber;t>this.lastRosterUpdateSeqNumber?(this.lastRosterUpdateSeqNumber=t,this.participantManager.handleRosterUpdate(e),this.contentSharingManager.handleIncomingContentSharingFromRoster(e)):(this.telemetryHelper.recordEvent(r.EVENTS.IGNORE_OLD_ROSTER,{lastRosterUpdateSeqNumber:this.lastRosterUpdateSeqNumber,sequenceNumber:t}),this.logger.log("Ignoring old roster update: received "+t+", but already handled "+this.lastRosterUpdateSeqNumber))},e.prototype.scheduleKeepAlives=function(e){var t=.9*e*1e3;this.logger.log("scheduleKeepAlives: every "+t+" milliseconds"),this.keepAliveInterval=t,this.keepAliveTimer=window.setInterval(this.sendKeepAlive.bind(this),this.keepAliveInterval)},e.prototype.sendKeepAlive=function(){this.logger.log("sendKeepAlive");if(this.disposed){this.logger.log("sendKeepAlive ignored");return}this.logger.log("sendKeepAlive keepAlive count = "+this.keepAliveCount++),this.sendToKeepAliveUrl(null)},e.prototype.sendToKeepAliveUrl=function(e){var t=this;window.clearInterval(this.keepAliveTimer),this.disposed||(this.telemetryHelper.recordEvent(r.EVENTS.SEND_KEEP_ALIVE),this.http.sendPostRequest({url:this.links[n["default"].LINKS.KEEPALIVE],payload:e,requestName:r.NETWORK_REQUESTS.SEND_KEEP_ALIVE,retryIntervals:[100,300,600,1e3],withoutTrouter:!0}).then(function(){return t.restartKeepAliveInterval()})["catch"](function(){return t.restartKeepAliveInterval(!0)}))},e.prototype.handleCallEstablishmentTimeout=function(){this.telemetryHelper.recordEvent(r.EVENTS.HANDLE_CALL_ESTABLISHMENT_TIMEOUT),this.telemetryHelper.setTerminatingData({terminatingEnd:r["default"].CALL_TERMINATING_END.LOCAL,resultValue:r["default"].RESULT_VALUE.FAILURE,resultDetail:n["default"].CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,endCode:n["default"].CALL_END_CODE.TIMEOUT,endSubCode:n["default"].CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT});var e={code:n["default"].CALL_END_CODE.TIMEOUT,subCode:n["default"].CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:n["default"].CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT};this.fsmState=n["default"].SIGNALING_FSM_STATE.IDLE,this.onCallStatusChanged(n["default"].CALL_STATUS.LOCAL_TERMINATED,e),this.dispose(e)},e.prototype.handleCallTransferTimeout=function(){this.telemetryHelper.recordEvent(r.EVENTS.HANDLE_CALL_TRANSFER_TIMEOUT);if(this.disposed){this.logger.log("Transfer: handleCallTransferTimeout ignored");return}var e={code:n["default"].CALL_END_CODE.TIMEOUT,phrase:n["default"].CALL_END_PHRASE.TRANSFER_COMPLETION_TIMEOUT};this.signalingSessionCallback.onTransferCompleted&&this.signalingSessionCallback.onTransferCompleted(e)},e.prototype.updateCorrelationId=function(e){e&&e[n["default"].HEADERS.CORRELATION_ID]&&e[n["default"].HEADERS.CORRELATION_ID].length&&this.correlationId!==e[n["default"].HEADERS.CORRELATION_ID]&&(this.logger.log("updateCorrelationId:",this.correlationId,"=>",e[n["default"].HEADERS.CORRELATION_ID]),this.telemetryHelper.addChangingCorrelationId(this.correlationId,e[n["default"].HEADERS.CORRELATION_ID]),this.correlationId=e[n["default"].HEADERS.CORRELATION_ID])},e.prototype.dispose=function(e){this.disposed||(this.logger.log("dispose"),this.disposed=!0,this.keepAliveTimer&&window.clearInterval(this.keepAliveTimer),this.brokerService&&this.brokerService.dispose(),this.http.cancelAllRequests(),this.signalingAgent.onCallCompleted(this.urlIdentifier),this.signalingAgentConfig.trouterUrlGetter.trouterUrl.changed.off(this.onTrouterUrlChanged),this.timeoutManager.dispose(),this.timeoutManager=null,this.participantManager.dispose(e),this.participantManager=null,this.mediaRenegotiationManager.dispose(),this.mediaRenegotiationManager=null,this.contentSharingManager.dispose(e),this.contentSharingManager=null,this.lightWeightMeetingSession.dispose(e),this.lightWeightMeetingSession=null,this.telemetryHelper.dispose(),this.telemetryHelper=null,this.webRtcSignalingManager.dispose(),this.webRtcSignalingManager=null)},e}();t.SignalingSession=j,t.build=F}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/signalingAgent",["require","exports","./signalingSession","./utilities/constants","./telemetry/telemetryConstants","./utilities/utils"],e)}(function(e,t){var n=e("./signalingSession"),r=e("./utilities/constants"),i=e("./telemetry/telemetryConstants"),s=e("./utilities/utils"),o=function(){function e(e){var t=this;this.signalingSessions={},this.getNewSignalingSession=function(e,r,i){s.assertNotNull(e,"selfParticipant should be a non null value"),s.assertNotNull(r,"signalingSessionCallback should be a non null value");var o=i||s.newGuid();s.assertNotNullOrEmpty(o,"signalingSession id generated cannot be null or empty");var u=n.build(e,r,t.signalingAgentConfig,o,t);return t.signalingSessions[o]=u,t.logger.log("created new signalingSession with id "+o),u},this.resolvePotentialCallConflict=function(e){var n;return e.multiParty?undefined:(Object.keys(t.signalingSessions).forEach(function(r){t.isSessionInConflictingState(t.signalingSessions[r],!e.isIncomingCall)&&(e.isIncomingCall?n=t.compareAndGetConflictingSession(e,t.signalingSessions[r]):n=t.compareAndGetConflictingSession(t.signalingSessions[r],e))}),n?(t.logger.info("Call conflict done, conflicting session callId=",n.correlationId,"urlIdentifier=",n.urlIdentifier),n.telemetryHelper.recordEvent(i.EVENTS.CONFLICTED_CALL),t.signalingAgentConfig.endConflictedCall?(t.endConflictedSession(n),n):undefined):undefined)},this.handleIncomingNotification=function(e){s.assertNotNull(e,"request should be a non null value"),t.logger.log("handleIncomingNotification to : "+e.url);if(!e.body&&!e.rawBody)return t.logger.error("request has no body"),t.buildNotificationResponse(r["default"].HTTP_STATUS_CODES.BAD_REQUEST);var n=r["default"].HTTP_STATUS_CODES.OK,o=t.getSignalingSessionId(e);if(o)if(t.signalingSessions.hasOwnProperty(o)){if(s.isEncodedMessage(e.headers))try{if(!s.isMessageEncodingSupported(e.headers))throw"Unsupported encoding";var u=s.decodeMessage(e.rawBody),a=JSON.parse(u);e.body=a}catch(f){return t.signalingSessions[o].telemetryHelper.recordEvent(i.EVENTS.TROUTER_DECODE_PAYLOAD_FAILURE),t.buildNotificationResponse(r["default"].HTTP_STATUS_CODES.BAD_REQUEST)}if(t.signalingSessions[o].canHandleIncomingMsgSync(e))return t.signalingSessions[o].handleIncomingMsgSync(e);setTimeout(function(){t.signalingSessions.hasOwnProperty(o)&&t.signalingSessions[o].handleIncomingMsgAsync(e)["catch"](function(e){t.signalingSessions[o]&&t.signalingSessions[o].telemetryHelper&&t.signalingSessions[o].telemetryHelper.recordEvent(i.EVENTS.FAILED_TO_HANDLE_TROUTER_MESSAGE),t.logger.error("handling IncomingMsg failed with error: "+e)})},0)}else t.logger.log("Incoming message for call id "+o+". But call not found !"),n=r["default"].HTTP_STATUS_CODES.NOT_FOUND;else t.logger.error("could not retrieve callId from Url path . Path = "+e.url),n=r["default"].HTTP_STATUS_CODES.BAD_REQUEST;return t.buildNotificationResponse(n)},this.onCallCompleted=function(e){t.signalingSessions.hasOwnProperty(e)?(delete t.signalingSessions[e],t.logger.log("Call id "+e+" found. Deleted from signalingSession table")):t.logger.error("Call id "+e+" not found. Could not delete from signalingSession table")},this.endConflictedSession=function(e){t.logger.log("Call conflict, ending signalingSession with callId=",e.correlationId,"urlIdentifier=",e.urlIdentifier),e.endAsync({code:r["default"].CALL_END_CODE.CONFLICT,subCode:r["default"].CALL_END_SUB_CODE.CONFLICT_IN_NG,phrase:r["default"].CALL_END_PHRASE.CONFLICT},!1)},this.compareAndGetConflictingSession=function(e,t){if(!s.is1to1Mri(e.incomingCallCallerId)||!s.is1to1Mri(t.participantManager.localParticipant.id))return undefined;var n=s.stripMri(e.incomingCallCallerId),r=s.stripMri(t.participantManager.getParticipantsToInitiateCallWith().length&&t.participantManager.getParticipantsToInitiateCallWith()[0].id),i=s.stripMri(t.participantManager.localParticipant.id);return r!==n?undefined:i>n?e:t},this.isSessionInConflictingState=function(e,n){if(!e)return t.logger.log("Call conflict, ignore, session already disposed"),!1;var i=[r["default"].CALL_STATUS.IDLE,r["default"].CALL_STATUS.CONNECTING,r["default"].CALL_STATUS.RINGING];return!e.multiParty&&i.indexOf(e.getCallStatus())>-1&&(n&&e.isIncomingCall||!n&&!e.isIncomingCall)},this.buildNotificationResponse=function(e,n){return t.signalingAgentConfig.supportsSynchronousTrouterResponse?{resultCode:e,responseBody:n}:e},this.signalingAgentConfig=e,this.logger=e.logger.createChild("SignalingAgent"),s.assertNotNull(e,"signalingAgentConfig should be a non null value"),this.logger.log(e.isWebRtcEnabled?"webRTC enabled":"ORTC enabled"),this.addSkypeTokenCaching()}return e.prototype.getSignalingSessionId=function(e){var t=e.url.match(new RegExp("/"+s.escapeRegExp(r["default"].URL_BASE.CALLAGENT)+"/+([^/]+)","i"));return t?t[1]:null},e.prototype.addSkypeTokenCaching=function(){var e=this,t=this.signalingAgentConfig.skypeToken,n=function(){return t.apply(e.signalingAgentConfig).then(function(t){return e.signalingAgentConfig.lastSkypeToken=t,t})};this.signalingAgentConfig.skypeToken=n},e}();t.__esModule=!0,t["default"]=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/utilities/httpRequestDispatcher",["require","exports"],e)}(function(e,t){var n=function(){function e(e,t){var n=this;this.getRequestOptions=function(e,t,r,i){var s={headers:t||{},timeout:i,retry:{delay:1e3,enabled:!0,limit:3,strategy:"fixed",isTransientCheck:n.transientFaultPolicy.isTransientFailure,isSuccessCheck:n.transientFaultPolicy.isWebApiSuccess},reporting:{serviceName:"ngcCallController-"+(e||"")},payload:r||null};return s},this.getAsync=function(e,t){return n.salRequestDispatcher.get(e,t)},this.postAsync=function(e,t){return n.salRequestDispatcher.post(e,t)},this.putAsync=function(e,t){return n.salRequestDispatcher.put(e,t)},this.removeAsync=function(e,t){return n.salRequestDispatcher.remove(e,t)},this.salRequestDispatcher=e,this.transientFaultPolicy=t}return e}();t.__esModule=!0,t["default"]=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/telemetry/skypeConCoreTelemetryManager",["require","exports"],e)}(function(e,t){var n=function(){function e(e,t){this.appTelemetryManager=e,this.skypeConcoreToken=t}return e.prototype.sendEvent=function(e,t){this.appTelemetryManager.sendEvent(this.skypeConcoreToken,e,t)},e}();t.__esModule=!0,t["default"]=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("signaling-agent/lib/public",["require","exports","./participant","../lib/utilities/enums","../lib/utilities/constants","../lib/telemetry/telemetryConstants","../lib/incomingNotificationMessageHandler","../lib/defaultSignalingAgentConfig","../lib/signalingAgent","../lib/utilities/httpRequestDispatcher","../lib/telemetry/skypeConCoreTelemetryManager"],e)}(function(e,t){function c(e){return new n["default"](e)}var n=e("./participant"),r=e("../lib/utilities/enums");t.DeviceType=r.DeviceType;var i=e("../lib/utilities/constants");t.CA_CONSTANTS=i["default"];var s=e("../lib/telemetry/telemetryConstants");t.TM_CONSTANTS=s["default"];var o=e("../lib/incomingNotificationMessageHandler");t.IncomingNotificationMessageHandler=o["default"];var u=e("../lib/defaultSignalingAgentConfig");t.DefaultSignalingAgentConfig=u["default"];var a=e("../lib/signalingAgent");t.SignalingAgent=a["default"];var f=e("../lib/utilities/httpRequestDispatcher");t.HttpRequestDispatcher=f["default"];var l=e("../lib/telemetry/skypeConCoreTelemetryManager");t.SkypeConCoreTelemetryManager=l["default"],t.createParticipant=c}),define("signaling-agent",["signaling-agent/lib/public"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("web-calling/lib/utilities/negotiationInfo",["require","exports","signaling-agent"],e)}(function(e,t){var n=e("signaling-agent"),r=1e4,i=function(){function e(e,t,n){this.isOfferer=!1,this.isRenegotiation=!1,this.mediaLegId="",this.timeStamps={},this.negotiationCounter=0,this.callsModel=e,this.signalingSession=t,this.logger=n}return e.prototype.incrementAttemps=function(){++this.negotiationCounter},e.prototype.sendStats=function(){var e={},t=(new Date).getTime();e[n.TM_CONSTANTS.CONTEXT_ID.DATA_VERSION]="3",e[n.TM_CONSTANTS.CONTEXT_ID.CORRELATIONID]=String(this.signalingSession.correlationId),e.CallNumber="0",e.NegotiationNumber=String(this.negotiationCounter),e.NegotiationRequiredTime=String(t),e.MediaLegId=String(this.mediaLegId),e.Status=String(this.status),e.Retarget="false",e.ReInvite=this.isRenegotiation?"true":"false",e.CreationTime=String(this.timeStamps.created*r),e.StartTime=String(this.timeStamps.started*r),e.CompleteTime=String(t*r);if(!this.isOfferer)e.Type="answering",e.ProcessOfferTime=String(this.timeStamps.initialOfferArrived*r),e.CreateAnswerFinalTime=String(this.timeStamps.finalAnswerCreated*r),e.AnswerReadyProvisionalTime=String(this.timeStamps.offerProcessed*r),e.AnswerReadyFinalTime=String(this.timeStamps.modalitiesConfigured*r);else{var i="0";e.Type="offering",e.OfferReadyTime=String(this.timeStamps.offerCreated*r),e["ProcessAnswer_"+i+"_Final_Time"]=String(this.timeStamps.finalAnswerProcessed*r),e["ProcessAnswer_"+i+"_Final_Accepted"]="true"}e.isGroupConversation=this.signalingSession.multiParty?"1":"0",this.result&&(e.isComplete=this.result.isComplete?"1":"0",e.activeVideoModalities=String(this.result.activeModalities.video),e.activeAudioModalities=String(this.result.activeModalities.audio),e.configuredVideoModalities=String(this.result.configuredModalities.video),e.configuredAudioModalities=String(this.result.configuredModalities.audio)),e.timeCompleted=String((t-this.timeStamps.created)*r);var s=this.timeStamps;for(var o in this.timeStamps)this.timeStamps.hasOwnProperty(o)&&(e["time_"+o]=String((s[o]-this.timeStamps.created)*r));try{this.callsModel.telemetryManager.sendEvent(this.callsModel.mdscToken,"mdsc_negotiation",e)}catch(u){this.logger.error("sendNegotiationStats sendEvent failed","error:",u.toString())}},e}();t.__esModule=!0,t["default"]=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("web-calling/lib/utilities/typeDefs",["require","exports"],e)}(function(e,t){var n;(function(e){e[e.Pending=0]="Pending",e[e.Resolved=1]="Resolved",e[e.Rejected=2]="Rejected"})(n=t.SettablePromiseState||(t.SettablePromiseState={}));var r;(function(e){e[e.None=0]="None",e[e.Ringing=10]="Ringing",e[e.Notified=1]="Notified",e[e.Connecting=2]="Connecting",e[e.Connected=3]="Connected",e[e.LocalHold=4]="LocalHold",e[e.RemoteHold=5]="RemoteHold",e[e.Disconnecting=6]="Disconnecting",e[e.Disconnected=7]="Disconnected",e[e.Observing=8]="Observing",e[e.Voicemail=9]="Voicemail"})(r=t.CallState||(t.CallState={}));var i;(function(e){e[e.None=0]="None",e[e.Connecting=1]="Connecting",e[e.Ringing=2]="Ringing",e[e.Connected=3]="Connected",e[e.Disconnected=4]="Disconnected",e[e.OnHold=5]="OnHold"})(i=t.ParticipantState||(t.ParticipantState={}));var s;(function(e){e[e.None=0]="None",e[e.AddingFailed=1]="AddingFailed",e[e.NoResponse=2]="NoResponse",e[e.Declined=3]="Declined",e[e.NotReachable=4]="NotReachable",e[e.Blocked=5]="Blocked",e[e.NotFriendOrAuthorized=6]="NotFriendOrAuthorized",e[e.CallLimitReached=7]="CallLimitReached",e[e.OtherError=8]="OtherError"})(s=t.ParticipantStateReason||(t.ParticipantStateReason={}));var o;(function(e){e[e.None=0]="None",e[e.Connecting=1]="Connecting",e[e.Available=2]="Available",e[e.StreamPreparing=3]="StreamPreparing",e[e.Streaming=4]="Streaming"})(o=t.StreamState||(t.StreamState={}));var u;(function(e){e[e.Supported=0]="Supported",e[e.BrowserNotSupported=1]="BrowserNotSupported",e[e.IncompatibleVersions=2]="IncompatibleVersions"})(u=t.CallSupport||(t.CallSupport={}));var a;(function(e){e[e.CallSetupFailed=0]="CallSetupFailed",e[e.CallDropped=1]="CallDropped",e[e.Undefined=2]="Undefined"})(a=t.FailureType||(t.FailureType={}));var f;(function(e){e[e.Audio=0]="Audio",e[e.Video=1]="Video",e[e.ScreenSharing=2]="ScreenSharing"})(f=t.StreamType||(t.StreamType={}));var l;(function(e){e[e.Undefined=0]="Undefined",e[e.Success=1]="Success",e[e.NoNgcEndpoint=2]="NoNgcEndpoint",e[e.NetworkError=3]="NetworkError",e[e.MediaError=4]="MediaError",e[e.BadRequest=5]="BadRequest",e[e.CallEstablismentTimeout=6]="CallEstablismentTimeout",e[e.CallSetupError=7]="CallSetupError",e[e.NoPermission=8]="NoPermission",e[e.Missed=9]="Missed",e[e.Declined=10]="Declined",e[e.Busy=11]="Busy",e[e.Cancelled=12]="Cancelled",e[e.Dropped=13]="Dropped"})(l=t.TerminatedReason||(t.TerminatedReason={})),t.StreamDirections={send:"sendonly",receive:"recvonly",sendReceive:"sendrecv"},t.StreamTypes={audio:"audio",video:"video",sharing:"applicationsharing-video"}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/constants",["require","exports"],e)}(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default={MEDIA_STATE:{send:"sendonly",receive:"recvonly",sendReceive:"sendrecv",inactive:"inactive"},MEDIA_DEVICE_KIND:{audioInput:"audioinput",audioOutput:"audiooutput",videoInput:"videoinput"},MEDIA_DEVICE:{camera:"camera",microphone:"microphone",speaker:"speaker",defaultId:"default",communicationsId:"communications",defaultDeviceLabel:"Default"},MEDIA_ERROR:{constraintNotSatisfiedError:"ConstraintNotSatisfiedError",iceConnectionError:"iceConnectionError",srtpError:"srtpError",permissionDeniedError:"permissionDeniedError",internalError:"internalError",sourceUnavailableError:"SourceUnavailableError",devicesNotFoundError:"DevicesNotFoundError",noNetworkError:"noNetworkError",incompatibleOffer:"IncompatibleOffer"},RENEGOTIATION_ERROR:{local:"local",glare:"glare",signaling:"signaling",media:"media",escalation:"escalation"},MSI:{unsubscribe:-1,subscribeAny:-2},MEDIA_LABEL:{audio:"main-audio",video:"main-video",sharing:"applicationsharing-video",data:"data"},MEDIA_TYPE:{audio:"audio",video:"video",data:"x-data"},MODALITY:{audio:"audio",video:"video",sharing:"sharing",data:"data"},ICE_TRANSPORT_POLICY:{all:"all",relay:"relay"},EXTENSION_TYPE:{dominantSpeakerHistory:"dominantSpeakerHistory",videoStreamControl:"videoStreamControl"},RENDERER_TYPE:{video:"video",sharing:"sharing"},CONTENT_TYPE:{SDP:"application/sdp"},ALLOWED_CONTENT_TYPES:{SDP_ONLY:["application/sdp"]},STREAMING_STATE:{created:"created",started:"started",active:"active",inactive:"inactive",stopped:"stopped",removed:"removed",failed:"failed"}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/utils",["require","exports","../constants"],e)}(function(e,t){function r(e,t){for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)}function i(e,t){for(var n in e)e.hasOwnProperty(n)&&(typeof e[n]=="object"?i(e[n],t):t(e[n],n,e))}function s(e){var t=0;return e.forEach(function(e){return t+=e}),t/=e.length,t}function o(e,t){var n;return e.some(function(r,i){return t(r,i,e)?(n=r,!0):!1}),n}function u(e,t){var n;return e.some(function(r,i){return t(r,i,e)?(n=i,!0):!1}),n}function a(e,t){var n=!1;for(var r=e.length;r-->0;)t(e[r],r,e)&&(e.splice(r,1),n=!0);return n}function f(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}function l(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function c(e){return!Object.keys(e).length}function h(e){var t={};return r(e,function(e,n){t[n]=e}),t}function p(e){var t;if(!e||typeof e!="object")return e;if(e instanceof Date)return t=new Date,t.setTime(e.getTime()),t;if(e instanceof Array){t=[];for(var n=0,i=e.length;n<i;n++)t[n]=p(e[n]);return t}if(e instanceof Object)return t={},r(e,function(e,n){t[n]=p(e)}),t;throw new Error("Unable to copy: "+e)}function d(){var e=function(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)};return e()+e()+e()+"4"+e().substring(1)+"b"+e().substring(1)+e()+e()+e()}function v(e,t){var n,r=typeof e,i=typeof t;if(e===t)return!0;if(r!==i||r!=="object"&&r!=="function")return!1;if(e===null||t===null)return e===t;if(e instanceof Date&&t instanceof Date)return+e==+t;for(n in e)if(!(n in t)||!v(e[n],t[n]))return!1;for(n in t)if(!(n in e)||!v(e[n],t[n]))return!1;return!0}function m(e,t){return JSON.stringify(e)===JSON.stringify(t)}function g(e,t){var n=t.reduce(function(t,n){var r=e.includes(n)?n.length:0;return t.length<r?n:t},"");return n}function y(e,t){if(t.indexOf(e)===-1){var r=new Error(e+" mediaContent.contentType is not supported");throw r.name=n.default.MEDIA_ERROR.incompatibleOffer,r}}var n=e("../constants");t.forOwn=r,t.forOwnRec=i,t.average=s,t.find=o,t.findIndex=u,t.remove=a,t.values=f,t.assign=l,t.isEmpty=c,t.shallowClone=h,t.deepClone=p,t.uniqueId=d,t.deepEqual=v,t.weakCompareObject=m,t.getMaxSubstring=g,t.throwIfNotSupported=y,t.noop=Function.prototype}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/helper",["require","exports","./constants","./common/utils"],e)}(function(e,t){function i(e){switch(e){case n.default.MEDIA_STATE.send:return n.default.MEDIA_STATE.receive;case n.default.MEDIA_STATE.receive:return n.default.MEDIA_STATE.send;default:return e}}function s(e,t){var r=a(e)&&a(t),i=f(e)&&f(t);return r&&i?n.default.MEDIA_STATE.sendReceive:r?n.default.MEDIA_STATE.send:i?n.default.MEDIA_STATE.receive:e===n.default.MEDIA_STATE.inactive&&t||e&&t===n.default.MEDIA_STATE.inactive?n.default.MEDIA_STATE.inactive:void 0}function o(e){var t={},n=i(e.audio);n&&(t.audio=n);var r=i(e.video);r&&(t.video=r);var s=i(e.sharing);s&&(t.sharing=s);var o=i(e.data);return o&&(t.data=o),t}function u(e){return e===n.default.MEDIA_STATE.sendReceive?n.default.MEDIA_STATE.receive:void 0}function a(e){return e===n.default.MEDIA_STATE.send||e===n.default.MEDIA_STATE.sendReceive}function f(e){return e===n.default.MEDIA_STATE.receive||e===n.default.MEDIA_STATE.sendReceive}function l(e){return e.audio===n.default.MEDIA_STATE.inactive}function c(e,t){var n={},r=s(e.audio,t.audio);r&&(n.audio=r);var i=s(e.video,t.video);i&&(n.video=i);var o=s(e.sharing,t.sharing);o&&(n.sharing=o);var u=s(e.data,t.data);return u&&(n.data=u),n}function h(e,t,n){var r=a(e)&&a(t)||!a(e)&&!a(n),i=f(e)&&f(t)||!f(e)&&!f(n);return r&&i}function p(e,t,n){return h(e.audio,t.audio,n.audio)&&h(e.video,t.video,n.video)&&h(e.sharing,t.sharing,n.sharing)}function d(e,t){function n(e,t){var n=a(e)===a(t),r=f(e)===f(t);return n&&r}return n(e.audio,t.audio)&&n(e.video,t.video)&&n(e.sharing,t.sharing)}function v(e){var t={dtls:!1,sdes:!1};return t.dtls=!!e.fingerprint,e.media.forEach(function(e){t.dtls=t.dtls||!!e.fingerprint,t.sdes=t.sdes||!!e.crypto}),t}function m(e,t,n,r){if(!t[n])return!0;if(e){if(!a(r)&&(!e[n]||e[n]!==r))return!1}else if(t[n]===r)return!1;return!0}function g(e,t,n){if(!t||r.isEmpty(t))return e;var i={};return r.forOwn(e,function(r,s){m(n,t,s,r)&&(i[s]=e[s])}),i}var n=e("./constants"),r=e("./common/utils");t.negotiateDirectionality=s,t.invertModalities=o,t.removeSendDirectionality=u,t.hasSendDirectionality=a,t.hasReceiveDirectionality=f,t.isOnHold=l,t.negotiateModalities=c,t.areNegotiatedDirectionsAcceptable=p,t.areNegotiatedDirectionsFulfilled=d,t.getSrtpInfo=v,t.excludePassiveModalities=g}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/statistics/sessionStatistics",["require","exports","./../common/utils","../helper"],e)}(function(e,t){function s(){function Z(e){var t=0;if(j.test(e))t=13;else if(F.test(e)||I.test(e))t=4;return{type:t,value:e,__VALUE__:!0}}function et(){return{started:function(){s="Offering",nt()}}}function tt(){return{started:function(){s="Answering",nt()}}}function nt(){t=t||s,++o}function rt(){return{completed:function(){o===1&&(u=!0)},rejected:function(){++D}}}function it(e){return e*1e4}var e=(new Date).getTime(),t,s,o=0,u=!1,a=!1,f=0,l=0,c=0,h=0,p=0,d=0,v=0,m=0,g=0,y=0,b=0,w=0,E=0,S=0,x=0,T=0,N=0,C=0,k=0,L=0,A,O=0,M=0,_="0",D=0,P={type:"none",detail:"none"},H=0,B=0,j=RegExp(/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\:[0-9]{2,5})?$/),F=RegExp(/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/),I=RegExp(/^\[(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\](\:[0-9]{2,5})$/),q=0,R=!1,U=!1,z=!1,W=0,X=0,V=0,$=null,J=0,K=new i,Q=new i,G=new i,Y=new i;this.negotiation={offering:et(),answering:tt(),current:rt()},this.terminated=function(){M=(new Date).getTime(),O=M-e,Q.stop(),Y.stop(),G.stop(),K.stop()},this.setMultiParty=function(){a=!0},this.updateCommonMute=function(){Y.isRunning()||Q.isRunning()?K.start():!Y.isRunning()&&!Q.isRunning()&&K.stop()},this.setSwMute=function(e){e?Y.start():Y.stop(),this.updateCommonMute()},this.setHwSilent=function(e){e?G.start():G.stop()},this.registerQualityStateChangedEvent=function(e){switch(e.type){case 37:e.value===1?f++:l++;break;case 32:e.value===1?c++:h++;break;case 39:e.value===1?m++:v++;break;case 33:e.value===1?d++:p++;break;case 25:e.value===3?Q.start():Q.stop(),this.updateCommonMute()}},this.registerRetargetIncoming=function(){g++},this.registerRetargetOutgoing=function(){y++},this.registerRetargetCompleted=function(){b++},this.registerRetargetRejected=function(){w++},this.registerEscalationStart=function(){x++},this.registerEscalationCompleted=function(){T++},this.registerEscalationRejected=function(){N++},this.registerReconnectAttempted=function(){E++},this.registerReconnectConnected=function(){S++},this.registerSSIncomingDecoderFailed=function(){C++},this.registerSSIncomingDecoderActive=function(){k++},this.registerSSIncomingDecoderReset=function(){L++},this.setMediaLegId=function(e){A=e},this.setId=function(e){_=e},this.setError=function(e){P.type=e.type||"internalError",P.detail=e.detail||e.toString()},this.setRelayCount=function(e){q=e},this.setSendModalities=function(e){R=e.audio.some(function(e){return r.hasSendDirectionality(e)}),U=e.video.some(function(e){return r.hasSendDirectionality(e)}),z=e.sharing.some(function(e){return r.hasSendDirectionality(e)})},this.setIceInitTimestamp=function(e){if(W)return;W=e},this.setFinalAnswerTimestamp=function(e){if(X)return;X=e},this.setIceConnectedStateTimestamp=function(e){if(V)return;V=e},this.dtmfResult=function(e){e?++H:++B},this.setUsedDevices=function(e){$&&!n.weakCompareObject(e,$)&&J++,$=e},this.getReport=function(){var n=$||{microphone:"none",speaker:"none",camera:"none"};return{CorrelationId:_,CallNumber:0,NoIceCandidatesBadEventCount:l,NoIceCandidatesGoodEventCount:f,NoRelayIceCandidatesBadEventCount:h,NoRelayIceCandidatesGoodEventCount:c,CameraInUseBadEventCount:p,CameraInUseGoodEventCount:d,MicrophoneInUseBadEventCount:v,MicrophoneInUseGoodEventCount:m,RetargetIncomingCount:g,RetargetOutgoingCount:y,RetargetCompletedCount:b,RetargetRejectedCount:w,ReconnectAttemptedCount:E,ReconnectConnectedCount:S,EscalationAttemptedCount:x,EscalationCompletedCount:T,EscalationRejectedCount:N,ScreenSharingIncomingDecoderFailureCount:C,ScreenSharingIncomingDecoderFailureRecoverDelta:C-k,ScreenSharingIncomingDecoderResetCount:L,CreationTime:it(e),InitTime:it(e),TerminationTime:it(M),CallDuration:it(O),InitialNegotiationType:t||"none",InitialNegotiationCompleted:u,NegotiationCount:o,RejectedNegotiationCount:D,MediaLegId:A,MultiParty:a,ErrorType:P.type,ErrorDetail:P.detail,DtmfSuccess:H,DtmfFailure:B,RelayCount:q,AllowedAudioSend:R,AllowedVideoSend:U,AllowedScreensharingSend:z,IceInitTime:it(W),FinalAnswerTime:it(X),IceConnectedStateTime:it(V),UsedMicrophone:n.microphone,UsedSpeaker:n.speaker,UsedCamera:n.camera,DeviceSelectionChangeCount:J,CallMutedRatio:O>0?K.getElapsed()/O:0,CallOsMuted:it(Q.getElapsed()),CallHwSilent:it(G.getElapsed()),CallSwMuted:it(Y.getElapsed())}},this.generateStatistics=function(e,t){this.setMediaLegId(t.process());if(e.type!=="OrtcMediaStats"&&e.type!=="WebRtcMediaStats")throw new Error("Unknown stats type - "+e.type);return e.data.metrics=this.getReport(),n.forOwnRec(e.data,function(e,t,n){n[t]=Z(e)}),e}}var n=e("./../common/utils"),r=e("../helper"),i=function(){function e(){this.startTime=0,this.elapsed=0}return e.prototype.start=function(){this.startTime||(this.startTime=Date.now())},e.prototype.stop=function(){this.startTime&&(this.elapsed+=Date.now()-this.startTime,this.startTime=0)},e.prototype.isRunning=function(){return!!this.startTime},e.prototype.getElapsed=function(){return this.startTime?this.elapsed+Date.now()-this.startTime:this.elapsed},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(){return new s}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/statistics/mediaLegId",["require","exports","../common/utils"],e)}(function(e,t){function r(){var e;this.process=function(t){return e||(e=t||n.uniqueId().toUpperCase()),e}}var n=e("../common/utils");Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(){return new r}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/settablePromise",["require","exports"],e)}(function(e,t){var n;(function(e){e[e.Pending=0]="Pending",e[e.Rejected=1]="Rejected",e[e.Resolved=2]="Resolved"})(n=t.SettablePromiseState||(t.SettablePromiseState={}));var r=function(){function e(){var e=this;this.stateInt=n.Pending,this.resolve=function(t){e.stateInt=n.Resolved,e.resolveInt(t)},this.reject=function(t){e.stateInt=n.Rejected,e.rejectInt(t)},this.promiseInt=new Promise(function(t,n){e.resolveInt=t,e.rejectInt=n})}return Object.defineProperty(e.prototype,"state",{get:function(){return this.stateInt},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"promise",{get:function(){return this.promiseInt},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPending",{get:function(){return this.stateInt==n.Pending},enumerable:!0,configurable:!0}),e}();t.SettablePromise=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/promiseQueue",["require","exports","./settablePromise"],e)}(function(e,t){var n=e("./settablePromise"),r=function(){function e(e){this.logger=e,this.queue=Promise.resolve()}return e.prototype.add=function(e){var t=this,r;e instanceof n.SettablePromise?r=function(){return e.promise}:r=e;var i=this.queue.then(r);return this.queue=i.catch(function(e){t.logger&&t.logger.error("Error! ",e)}),i},e}();t.PromiseQueue=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/sessionOperationQueue",["require","exports","./promiseQueue","./settablePromise"],e)}(function(e,t){var n=e("./promiseQueue"),r=e("./settablePromise"),i=function(){function e(e){this.logger=e,this.operationQueue=null,this.currentOperationDeferred=null,this.operationQueue=new n.PromiseQueue(this.logger)}return e.prototype.queueOperation=function(e){var t=this;this.logger.log("queueing operation");var n=new r.SettablePromise,i=this.operationQueue.add(function(){return t.currentOperationDeferred=n,e()});return this.operationQueue.add(n),i},e.prototype.completeCurrentOperation=function(){this.currentOperationDeferred&&(this.logger.log("completing operation"),this.currentOperationDeferred.resolve())},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/reconnectManagerMessageQueue",["require","exports"],e)}(function(e,t){var n=function(){function e(e){this.initialCallbacks=e,this.queue=[],this.queueCallbacks={onTerminated:this.genCallback(this.initialCallbacks.onTerminated),onSessionErrorOccurred:this.genCallback(this.initialCallbacks.onSessionErrorOccurred),onNegotiationRequired:this.genCallback(this.initialCallbacks.onNegotiationRequired),onAudioStateChanged:this.genCallback(this.initialCallbacks.onAudioStateChanged),onAudioQualityChanged:this.genCallback(this.initialCallbacks.onAudioQualityChanged),onAudioHwSilentChanged:this.genCallback(this.initialCallbacks.onAudioHwSilentChanged),onTransportConnected:this.genCallback(this.initialCallbacks.onTransportConnected),onTransportInitialized:this.genCallback(this.initialCallbacks.onTransportInitialized),onScreenSharingIncomingDecoderFailed:this.genCallback(this.initialCallbacks.onScreenSharingIncomingDecoderFailed),onScreenSharingIncomingDecoderActive:this.genCallback(this.initialCallbacks.onScreenSharingIncomingDecoderActive),onScreenSharingIncomingDecoderReset:this.genCallback(this.initialCallbacks.onScreenSharingIncomingDecoderReset)}}return e.prototype.flush=function(){this.queue.forEach(function(e){e.method.apply(null,e.args)}),this.clear()},e.prototype.clear=function(){this.queue=[]},e.prototype.genCallback=function(e){var t=this;return function(){var n=[];for(var r=0;r<arguments.length;r++)n[r]=arguments[r];return t.queue.push({method:e,args:n})}},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/reconnectManager",["require","exports","./../public","./reconnectManagerMessageQueue","./../constants"],e)}(function(e,t){var n=e("./../public"),r=e("./reconnectManagerMessageQueue"),i=e("./../constants"),s=function(){function e(e,t,n,i,s,o){this.session=e,this.context=t,this.statistics=n,this.sessionOperationQueue=i,this.callback=s,this.sessionCallbacks=o,this.reconnectGlare=!1,this.isEscalation=!1,this.reconnectQualityLevel=1,this.logger=t.getLogger(),this.settings=t.maContext.settings,this.session.callbacks=o,this.reconnectManagerMessageQueue=new r.default(o)}return e.prototype.getCurrentSession=function(){return this.reconnectSession||this.session},e.prototype.getMainSession=function(){return this.session},e.prototype.getReconnectSession=function(){return this.reconnectSession},e.prototype.onIceDisconnect=function(){return this.logger.info("reconnect attempt after iceDisconnect error"),this.raiseReconnectEvent(3),this.statistics.registerReconnectAttempted(),this.reconnectAsync()},e.prototype.onTransportConnected=function(){this.raiseReconnectEvent(1),this.statistics.registerReconnectConnected()},e.prototype.onNegotiationCompletedAsync=function(){this.glareTimer&&(clearTimeout(this.glareTimer),this.glareTimer=null);if(this.isReconnecting())return this.reconnectGlare=!1,this.statistics.registerRetargetCompleted(),this.isEscalation?Promise.resolve():this.completeReconnect();if(this.reconnectGlare)return this.reconnectGlare=!1,this.reconnectAsync(),Promise.resolve()},e.prototype.onNegotiationRejectedAsync=function(e,t){var n=this;return this.statistics.registerRetargetRejected(),this.rejectReconnect().then(function(){t?n.reconnectAsync():e===i.default.RENEGOTIATION_ERROR.glare?(n.reconnectGlare=!0,n.glareTimer=setTimeout(function(){n.callback.onSessionErrorOccurred({type:i.default.MEDIA_ERROR.iceConnectionError,detail:"Reconnect failed, error - "+e})},n.settings.reconnectGlareCallDropTimeout||1e4)):n.callback.onSessionErrorOccurred({type:i.default.MEDIA_ERROR.iceConnectionError,detail:"Reconnect failed, error - "+e})})},e.prototype.reconnectCloneSession=function(e){e===void 0&&(e=!1),this.reconnectSession=this.session.clone(e),this.reconnectSession.callbacks=this.sessionCallbacks,this.session.callbacks=this.reconnectManagerMessageQueue.queueCallbacks},e.prototype.raiseReconnectEvent=function(e){if(this.reconnectQualityLevel===e)return;this.reconnectQualityLevel=e;var t={type:5,value:e,isLocalSource:!0,mediaType:0};this.callback&&this.callback.onAudioQualityChanged&&this.callback.onAudioQualityChanged(t)},e.prototype.reconnectAsync=function(){var e=this;return this.logger.log("queueing reconnect"),this.sessionOperationQueue.queueOperation(function(){return e.logger.log("starting reconnect"),e.reconnectCloneSession(),e.reconnectSession.muteInputAsync().then(function(){return e.reconnectSession.configureModalitiesAsync(e.session.getConfiguredModalities())}).then(function(){e.sessionOperationQueue.completeCurrentOperation()})})},e.prototype.acceptReconnectStartAsync=function(e){return this.logger.log("accepting reconnect"),this.statistics.registerRetargetIncoming(),e&&(this.isEscalation=!0,this.statistics.registerEscalationStart()),this.reconnectCloneSession(e),this.reconnectSession.muteInputAsync()},e.prototype.acceptReconnectFinish=function(){var e=this.session.getConfiguredModalities();return this.reconnectSession.configureModalitiesAsync(e).then(function(){return e})},e.prototype.isReconnecting=function(){return!!this.reconnectSession},e.prototype.reset=function(){this.glareTimer&&(clearTimeout(this.glareTimer),this.glareTimer=null),this.reconnectGlare=!1,this.session.callbacks=this.sessionCallbacks},e.prototype.cleanUp=function(){this.sessionCallbacks={},this.reset()},e.prototype.terminateAsync=function(){var e=this,t=function(){return e.terminateReconnectSessionAsync().then(function(){return e.cleanUp()},function(){return e.cleanUp()})};return this.session.terminate().then(t,t)},e.prototype.terminateReconnectSessionAsync=function(){return this.reconnectSession?this.reconnectSession.terminate():Promise.resolve()},e.prototype.completeReconnect=function(){this.logger.log("completing reconnect"),this.isEscalation&&(this.statistics.registerEscalationCompleted(),this.isEscalation=!1);if(this.reconnectSession){this.reconnectManagerMessageQueue.clear();var e=this.session;return this.session=this.reconnectSession,e.move(this.session),this.reconnectSession=null,e.terminate()}return Promise.resolve()},e.prototype.rejectReconnect=function(){this.logger.log("rejecting reconnect"),this.isEscalation&&(this.statistics.registerEscalationRejected(),this.isEscalation=!1);if(this.reconnectSession){this.reconnectManagerMessageQueue.flush();var e=this.reconnectSession;return this.reconnectSession=null,e.terminate()}return Promise.resolve()},e.prototype.configureModalitiesAsync=function(e){return this.isReconnecting()?Promise.all([this.session.configureModalitiesAsync(e),this.reconnectSession.configureModalitiesAsync(e)]).then(function(){return Promise.resolve()}):this.session.configureModalitiesAsync(e)},e.prototype.canSendDtmf=function(){return this.session.canSendDtmf()},e.prototype.getExtensionsManager=function(){return this.session.getExtensionsManager()},e.prototype.muteInputAsync=function(){return this.session.muteInputAsync()},e.prototype.unmuteInputAsync=function(){return this.session.unmuteInputAsync()},e.prototype._deviceSelectionChanged=function(){this.session._deviceSelectionChanged(),this.isReconnecting()&&this.reconnectSession._deviceSelectionChanged()},e.prototype._devicePermissionsChanged=function(e){this.session._devicePermissionsChanged(e)},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/session",["require","exports","./../statistics/sessionStatistics","./../statistics/mediaLegId","./utils","./sessionOperationQueue","./reconnectManager","./../public"],e)}(function(e,t){var n=e("./../statistics/sessionStatistics"),r=e("./../statistics/mediaLegId"),i=e("./utils"),s=e("./sessionOperationQueue"),o=e("./reconnectManager"),u=e("./../public"),a=function(){function e(e,t){this.relayManager=e,this.sessionStatictics=t}return e.prototype.initialize=function(){},e.prototype.queryRelaysAsync=function(e,t){var n=this;return this.relayManager.queryRelaysAsync(e,t).then(function(e){return n.sessionStatictics.setRelayCount(e.length),e})},e}(),f=function(){function e(e,t,i,a){this.context=t,this.id=i,this.callback=a,this.audioStreamStates=(c={},c[u.Constants.STREAMING_STATE.inactive]=[u.Constants.STREAMING_STATE.active,u.Constants.STREAMING_STATE.failed],c[u.Constants.STREAMING_STATE.active]=[u.Constants.STREAMING_STATE.removed,u.Constants.STREAMING_STATE.stopped,u.Constants.STREAMING_STATE.failed],c),this.rejectedNegotiations=0,this.negotiationState=null,this.iceDisconnectedRetried=!1,this.audioStreamState=u.Constants.STREAMING_STATE.inactive,this.logger=t.getLogger(),this.statistics=n.default.build(),this.mediaLegId=r.default.build(),this.settings=t.maContext.settings,this.sessionOperationQueue=new s.default(this.logger),this.statistics.setId(i),t.config.isConference&&this.statistics.setMultiParty();var f=this.getSessionCallbacks();e.callbacks=f,e.relayManagerProvider=this;var l=this.getReconnectManagerCallbacks();this.reconnectManager=new o.default(e,t,this.statistics,this.sessionOperationQueue,l,f);var c}return e.prototype.createOfferAsync=function(){var e=this;return this.sessionOperationQueue.queueOperation(function(){return e.statistics.negotiation.offering.started(),e.getCurrentSession().createOfferAsync().then(function(t){return e.updateSelectedDevices(),t.mediaLegId=e.mediaLegId.process(t.mediaLegId),e.reconnectManager.isReconnecting()&&(e.statistics.registerRetargetOutgoing(),t.newOffer=!0),t}).catch(function(t){throw e.statistics.setError(t),t})}).then(function(e){return e})},e.prototype.processOfferAsync=function(e){var t=this;return this.sessionOperationQueue.queueOperation(function(){t.statistics.negotiation.answering.started(),t.mediaLegId.process(e.mediaLegId);var n;return e.newOffer?n=t.reconnectManager.acceptReconnectStartAsync(e.escalationOccurring):n=Promise.resolve(),n.then(function(){return t.getCurrentSession().processOfferAsync(e)}).then(function(n){return e.newOffer?t.reconnectManager.acceptReconnectFinish():Promise.resolve(n)}).catch(function(e){throw t.statistics.setError(e),e})})},e.prototype.processAnswerAsync=function(e,t){var n=this;return this.getCurrentSession().processAnswerAsync(e,t).catch(function(e){throw n.statistics.setError(e),e})},e.prototype.completeNegotiationAsync=function(){var e=this;return this.rejectedNegotiations=0,this.getCurrentSession().completeNegotiationAsync().then(function(t){return e.negotiationState=t,e.statistics.setFinalAnswerTimestamp((new Date).getTime()),e.statistics.negotiation.current.completed(),e.reconnectManager.onNegotiationCompletedAsync()}).then(function(){return e.sessionOperationQueue.completeCurrentOperation(),e.negotiationState}).catch(function(t){throw e.statistics.setError(t),t})},e.prototype.rejectNegotiationAsync=function(e){var t=this,n=++this.rejectedNegotiations<=this.settings.renegotiationAttempts&&this.isRetriableError(e);this.statistics.negotiation.current.rejected(),this.reconnectManager.reset();var r;return this.reconnectManager.isReconnecting()?r=this.reconnectManager.onNegotiationRejectedAsync(e,n).then(function(){return t.negotiationState}):r=this.getCurrentSession().rejectNegotiationAsync(e,n),r.then(function(e){return t.negotiationState=e,t.sessionOperationQueue.completeCurrentOperation(),e}).catch(function(e){throw t.statistics.setError(e),e})},e.prototype.completeEscalationAsync=function(){return this.reconnectManager.completeReconnect()},e.prototype.rejectEscalationAsync=function(e){return this.reconnectManager.rejectReconnect()},e.prototype.terminate=function(){var e=this;this.statistics.terminated();var t=function(){return e.cleanUp()};return this.reconnectManager.terminateAsync().then(t,t)},e.prototype.getStatsAsync=function(){var e=this;return this.getMainSession().getStatsAsync().then(function(t){return e.statistics.generateStatistics(t,e.mediaLegId)})},e.prototype.getLastKnownStats=function(){return this.statistics.generateStatistics(this.getMainSession().getLastKnownStats(),this.mediaLegId)},e.prototype.createAnswerAsync=function(e){var t=this;return this.getCurrentSession().createAnswerAsync(e).then(function(e){return t.updateSelectedDevices(),e.mediaLegId=t.mediaLegId.process(e.mediaLegId),e}).catch(function(e){throw t.statistics.setError(e),e})},e.prototype.configureModalitiesAsync=function(e){return i.forOwn(e,function(t,n){t||delete e[n]}),this.statistics.setSendModalities(this.getMainSession().getAllowedModalities()),this.reconnectManager.configureModalitiesAsync(e)},e.prototype.getAllowedModalities=function(){return this.getMainSession().getAllowedModalities()},e.prototype.createRemoteRenderer=function(e,t){return this.getMainSession().createRemoteRenderer(e,t)},e.prototype.sendDtmf=function(e){var t=this;return this.getMainSession().sendDtmf(e).then(function(e){return t.statistics.dtmfResult(!0),e}).catch(function(e){throw t.statistics.dtmfResult(!1),e})},e.prototype.canSendDtmf=function(){return this.reconnectManager.canSendDtmf()},e.prototype.getExtensionsManager=function(){return this.reconnectManager.getExtensionsManager()},e.prototype.muteInputAsync=function(){return this.statistics.setSwMute(!0),this.reconnectManager.muteInputAsync()},e.prototype.unmuteInputAsync=function(){return this.statistics.setSwMute(!1),this.reconnectManager.unmuteInputAsync()},e.prototype.getAcceptedTypes=function(){return this.reconnectManager.getCurrentSession().getAcceptedTypes()},e.prototype.updateSelectedDevices=function(){var e=this,t=this.context.getDeviceManager(),n=t.getSelectedDevices(),r=function(e){return e?t.getDeviceNameAsync(e).then(function(e){return e||"unknown"}):Promise.resolve("none")};Promise.all([r(n.microphone),r(n.speaker),r(n.camera)]).then(function(t){var n=t[0],r=t[1],i=t[2];e.statistics.setUsedDevices({microphone:n,speaker:r,camera:i})})},e.prototype._deviceSelectionChanged=function(){this.updateSelectedDevices(),this.reconnectManager._deviceSelectionChanged()},e.prototype._qualityChanged=function(e){this.statistics.registerQualityStateChangedEvent(e),this.callback&&this.callback.onAudioQualityChanged&&this.callback.onAudioQualityChanged(e)},e.prototype._devicePermissionsChanged=function(e){this.reconnectManager._devicePermissionsChanged(e)},e.prototype.reconnectAsync=function(){return this.reconnectManager.reconnectAsync()},e.prototype.isReconnecting=function(){return this.reconnectManager.isReconnecting()},e.prototype.getRelayManager=function(){return new a(this.context.maContext.getRelayManager(),this.statistics)},e.prototype.cleanUp=function(){this.callback=null},e.prototype.isRetriableError=function(e){return u.Constants.RENEGOTIATION_ERROR.signaling===e||u.Constants.RENEGOTIATION_ERROR.media===e},e.prototype.getCurrentSession=function(){return this.reconnectManager.getCurrentSession()},e.prototype.getMainSession=function(){return this.reconnectManager.getMainSession()},e.prototype.setAudioStreamState=function(e){this.isAudioStateValid(e)?this.raiseAudioStateChanged(e):this.logger.error("audio state transition is invalid: "+this.audioStreamState+" -> "+e)},e.prototype.isAudioStateValid=function(e){return this.audioStreamStates[this.audioStreamState].indexOf(e)>=-1},e.prototype.raiseAudioStateChanged=function(e){this.logger.log("audio state changed to",e);if(this.callback.onAudioStateChanged){var t={content:"audio",direction:"receive",stream:e};this.callback.onAudioStateChanged(t)}},e.prototype.getReconnectManagerCallbacks=function(){var e=this;return{onAudioQualityChanged:function(t){e.callback.onAudioQualityChanged&&e.callback.onAudioQualityChanged(t)},onSessionErrorOccurred:function(t){e.setAudioStreamState(u.Constants.STREAMING_STATE.failed),e.callback.onSessionErrorOccurred&&e.callback.onSessionErrorOccurred(t)}}},e.prototype.getSessionCallbacks=function(){var e=this;return{onTerminated:function(){e.onTerminated&&e.onTerminated()},onSessionErrorOccurred:function(t){return e.statistics.setError(t),e.getCurrentSession().isReconnectSupported()&&t.type===u.Constants.MEDIA_ERROR.iceConnectionError?e.iceDisconnectedRetried?(e.setAudioStreamState(u.Constants.STREAMING_STATE.failed),e.callback.onSessionErrorOccurred(t),e.reconnectManager.rejectReconnect()):(e.iceDisconnectedRetried=!0,e.reconnectManager.onIceDisconnect()):(e.setAudioStreamState(u.Constants.STREAMING_STATE.failed),e.callback.onSessionErrorOccurred(t),Promise.resolve())},onNegotiationRequired:this.callback.onNegotiationRequired,onAudioQualityChanged:function(t){e.statistics.registerQualityStateChangedEvent(t),e.callback&&e.callback.onAudioQualityChanged&&e.callback.onAudioQualityChanged(t)},onAudioHwSilentChanged:function(t){e.statistics.setHwSilent(t)},onAudioStateChanged:function(t){e.setAudioStreamState(t)},onTransportConnected:function(){e.iceDisconnectedRetried&&(e.iceDisconnectedRetried=!1,e.reconnectManager.onTransportConnected()),e.statistics.setIceConnectedStateTimestamp((new Date).getTime())},onTransportInitialized:function(){e.statistics.setIceInitTimestamp((new Date).getTime())},onScreenSharingIncomingDecoderFailed:function(){e.statistics.registerSSIncomingDecoderFailed()},onScreenSharingIncomingDecoderActive:function(){e.statistics.registerSSIncomingDecoderActive()},onScreenSharingIncomingDecoderReset:function(){e.statistics.registerSSIncomingDecoderReset()}}},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/detect",["require","exports","./common/userAgentAdapter"],e)}(function(e,t){function r(){return typeof RTCIceGatherer!="undefined"}function i(){return n.default.window.HTMLAudioElement.prototype.setSinkId!==undefined}var n=e("./common/userAgentAdapter");t.isEdge=r,t.isAudioOutputSelectionSupported=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/userAgentAdapter",["require","exports","../detect"],e)}(function(e,t){var n=e("../detect"),r=undefined;if(typeof window!="undefined"&&typeof navigator!="undefined"){r=window,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,window.MediaStream=window.MediaStream||window.webkitMediaStream||window.mozMediaStream||window.msMediaStream,window.attachMediaStream=function(e,t){typeof e.srcObject!="undefined"?e.srcObject=t:typeof e.src!="undefined"&&(e.src=window.URL.createObjectURL(t))},window.detachMediaStream=function(e){if(typeof e.srcObject!="undefined")e.srcObject=null;else if(typeof e.src!="undefined"&&e.src){var t=e.src;e.src="",window.URL.revokeObjectURL(t)}},typeof navigator.mozGetUserMedia!="undefined"&&typeof window.mozRTCPeerConnection!="undefined"?navigator.getUserMedia=function(e,t,n){return navigator.mediaDevices.getUserMedia(e).then(t).catch(n)}:typeof navigator.webkitGetUserMedia!="undefined"&&typeof webkitRTCPeerConnection!="undefined"&&(window.RTCPeerConnection=webkitRTCPeerConnection,navigator.getUserMedia=function(e,t,n){var r=function(e){e&&e.deviceId&&e.deviceId.exact&&(e.mandatory||(e.mandatory={}),e.mandatory.sourceId=e.deviceId.exact,delete e.deviceId)};return e&&(r(e.audio),r(e.video)),navigator.webkitGetUserMedia(e,t,n)});if(n.isEdge()){var i=function(){return Promise.resolve()};RTCRtpSender.prototype.getStats||(RTCRtpSender.prototype.getStats=i),RTCRtpSender.prototype.msGetStats||(RTCRtpSender.prototype.msGetStats=i),RTCRtpReceiver.prototype.getStats||(RTCRtpReceiver.prototype.getStats=i),RTCRtpReceiver.prototype.msGetStats||(RTCRtpReceiver.prototype.msGetStats=i),RTCIceTransport.prototype.getStats||(RTCIceTransport.prototype.getStats=i),RTCIceTransport.prototype.msGetStats||(RTCIceTransport.prototype.msGetStats=i),RTCRtpReceiver.prototype.getContributingSources||(RTCRtpReceiver.prototype.getContributingSources=function(){return[]}),RTCRtpReceiver.prototype.requestSendCSRC||(RTCRtpReceiver.prototype.requestSendCSRC=function(){})}}Object.defineProperty(t,"__esModule",{value:!0}),t.default={window:r}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/stream/local/mediaStreamClient",["require","exports"],e)}(function(e,t){var n=function(){function e(e,t){this.mediaStream=e,this.isHold=!1,this.isMuted=this.mediaStream.isMuted(),this.updateStream(t)}return e.prototype.updateStream=function(e){e&&(this.originalId=e.id,this.gumStream=e,this.enableDisableTracks())},e.prototype.dispose=function(){return this.mediaStream.dispose(this)},e.prototype.clone=function(){return this.mediaStream.getClient()},e.prototype.getObject=function(){return this.gumStream},e.prototype.applyConstraints=function(e){return this.mediaStream.applyConstraints(e)},e.prototype.setMute=function(e){this.isMuted=e||this.mediaStream.isMuted(),this.enableDisableTracks()},e.prototype.setHold=function(e){this.isHold=e,this.enableDisableTracks()},e.prototype.start=function(){return this.mediaStream.start()},e.prototype.hasAudio=function(){return this.mediaStream.hasAudio()},e.prototype.hasVideo=function(){return this.mediaStream.hasVideo()},e.prototype.getOriginalId=function(){return this.originalId},e.prototype.isSameStream=function(e){return this.originalId===e.getOriginalId()},e.prototype.enableDisableTracks=function(){var e=this;this.gumStream&&this.gumStream.getTracks().forEach(function(t){typeof t.enabled!="undefined"&&(t.enabled=(t.kind!=="audio"||!e.isMuted)&&!e.isHold)})},e}();t.MediaStreamClient=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/resolutionTable",["require","exports"],e)}(function(e,t){var n=16,r=function(){function e(e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=0),this.width=e,this.height=t,this.minBitrate=r,this.maxBitrate=i,this.fs=Math.ceil(e/n)*Math.ceil(t/n)}return e.prototype.toString=function(){return this.height+"p"},e}();t.ResolutionInfo=r;var i=function(){function e(){this.resolutions=[new r(320,180,2e4,2e5),new r(426,240,16e4,35e4),new r(480,270,25e4,5e5),new r(640,360,4e5,1e6),new r(852,480,8e5,14e5),new r(960,540,12e5,18e5),new r(1280,720,15e5,2e6),new r(1920,1080,18e5,1e8)]}return e.prototype.getResolution=function(e){for(var t=this.resolutions.length-1;t>=0;t--)if(this.resolutions[t].fs<=e)return this.resolutions[t];return this.resolutions[0]},e.prototype.getMaxFS=function(e,t){var n=Math.max(e,t),r=Math.min(e,t);for(var i=0,s=this.resolutions;i<s.length;i++){var o=s[i];if(o.width>=n&&o.height>=r)return o.fs}return this.resolutions.slice(-1)[0].fs},e.prototype.getResolutionForBitrate=function(e){var t=this.resolutions.filter(function(t){return t.maxBitrate&&t.maxBitrate>=e}).shift(),n=this.resolutions.filter(function(t){return t.minBitrate&&t.minBitrate<=e}).pop();return{lowRes:t,highRes:n}},e.prototype.getResolutions=function(){return this.resolutions},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/stream/local/constraintsObject",["require","exports"],e)}(function(e,t){var n=function(){function e(e,t){this.audio=e,this.video=t}return e}();t.ConstraintsObject=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/ortc/ortcConstraintsAdapter",["require","exports","../constants"],e)}(function(e,t){var n=e("../constants"),r=function(){function e(){}return e.prototype.toGumConstraints=function(e){var t={};return e.audio&&(t.audio={},e.audio.deviceId&&e.audio.deviceId!==n.default.MEDIA_DEVICE.defaultId&&(t.audio.deviceId={exact:e.audio.deviceId})),e.video&&(t.video={},e.video.deviceId&&(t.video.deviceId={exact:e.video.deviceId}),e.video.minWidth&&(t.video.minWidth=e.video.minWidth),e.video.maxWidth&&(t.video.maxWidth=e.video.maxWidth),e.video.minHeight&&(t.video.minHeight=e.video.minHeight),e.video.maxHeight&&(t.video.maxHeight=e.video.maxHeight),e.video.fps&&(t.video.fps=e.video.fps)),t},e}();t.OrtcConstraintsAdapter=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/adapter/webkitConstraintsAdapter",["require","exports","../../constants","../../common/utils"],e)}(function(e,t){var n=e("../../constants"),r=e("../../common/utils"),i=function(){function e(){}return e.prototype.toGumConstraints=function(e){var t={};return e.audio&&(t.audio={},e.audio.deviceId&&e.audio.deviceId!==n.default.MEDIA_DEVICE.defaultId&&(t.audio.deviceId=e.audio.deviceId)),e.video&&(t.video={mandatory:{}},e.video.deviceId&&(t.video.mandatory.sourceId=e.video.deviceId),e.video.minWidth&&(t.video.mandatory.minWidth=e.video.minWidth),e.video.maxWidth&&(t.video.mandatory.maxWidth=e.video.maxWidth),e.video.minHeight&&(t.video.mandatory.minHeight=e.video.minHeight),e.video.maxHeight&&(t.video.mandatory.maxHeight=e.video.maxHeight),e.video.fps&&(t.video.mandatory.maxFrameRate=e.video.fps),r.isEmpty(t.video.mandatory)&&delete t.video.mandatory),t},e}();t.WebkitConstraintsAdapter=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/stream/local/constraintsAdapter",["require","exports","../../../detect","../../../ortc/ortcConstraintsAdapter","../../../webrtc/adapter/webkitConstraintsAdapter"],e)}(function(e,t){var n=e("../../../detect"),r=e("../../../ortc/ortcConstraintsAdapter"),i=e("../../../webrtc/adapter/webkitConstraintsAdapter"),s=function(){function e(){}return e.getAdapter=function(){return n.isEdge()?new r.OrtcConstraintsAdapter:new i.WebkitConstraintsAdapter},e}();t.ConstraintsAdapterFactory=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/stream/local/constraintsManager",["require","exports","../../resolutionTable","./constraintsObject","./constraintsAdapter","../../utils"],e)}(function(e,t){var n=e("../../resolutionTable"),r=e("./constraintsObject"),i=e("./constraintsAdapter"),s=e("../../utils"),o=function(){function e(e){this.logger=e,this.initialConstraints={maxWidth:1920,minWidth:1920,maxHeight:1080,minHeight:1080,fps:30},this.resTable=new n.default,this.adapter=i.ConstraintsAdapterFactory.getAdapter()}return e.prototype.createConstraintsObject=function(e){var t=this.convertConstraints(e.audio,{}),n=this.convertConstraints(e.video,this.initialConstraints);return new r.ConstraintsObject(t,n)},e.prototype.updateVideoDeviceId=function(e,t){if(!e.video||e.video.deviceId===t)return e;var n=this.cloneConstraints(e);return n.video.deviceId=t,n},e.prototype.updateVideoConstraints=function(e,t){if(!t.maxFS||!t.maxFPS)return e;var n=this.resTable.getResolution(t.maxFS),r=!this.isInRange(n.width,e.video.minWidth,e.video.maxWidth)||!this.isInRange(n.height,e.video.minHeight,e.video.maxHeight)||e.video.fps!==t.maxFPS;if(r){var i=this.cloneConstraints(e);return i.video.maxWidth=n.width,i.video.minWidth=n.width,i.video.maxHeight=n.height,i.video.minHeight=n.height,i.video.fps=t.maxFPS,i}return e},e.prototype.getKey=function(e){return e.video?s.isEmpty(e.video)?"video":e.video.deviceId&&e.video.minWidth&&e.video.minHeight?e.video.deviceId+"x"+e.video.minWidth+"x"+e.video.minHeight:e.video.minWidth&&e.video.minHeight?e.video.minWidth+"x"+e.video.minHeight:e.video.deviceId?""+e.video.deviceId:(this.logger.error("Cannot create key for constraints: "+e),""):"audio"},e.prototype.generatePolicies=function(e){var t=this;if(!e.video)return[e];var n=this.resTable.getResolutions().filter(function(t){return t.width<=e.video.maxWidth&&t.height<=e.video.maxHeight}).reverse(),i=n.map(function(n){var r=t.cloneConstraints(e);return r.video.minWidth=n.width,r.video.minHeight=n.height,r}),s=e.audio,o={deviceId:e.video.deviceId},u=new r.ConstraintsObject(s,o);return i.push(u),this.logger.log("Setting mandatory constraints: "+JSON.stringify(i)),i},e.prototype.toGumConstraints=function(e){return this.adapter.toGumConstraints(e)},e.prototype.convertConstraints=function(e,t){if(!e)return null;var n=s.deepClone(t),r=e.deviceId;return e&&r&&(n.deviceId=r),n},e.prototype.isInRange=function(e,t,n){return t<=e&&e<=n},e.prototype.cloneConstraints=function(e){var t=s.deepClone(e.video),n=s.deepClone(e.audio);return new r.ConstraintsObject(n,t)},e}();t.ConstraintsManager=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/stream/local/mediaStream",["require","exports","../../../constants","../../utils","../../userAgentAdapter","../../../detect","./mediaStreamClient","./constraintsManager","../../settablePromise"],e)}(function(e,t){var n=e("../../../constants"),r=e("../../utils"),i=e("../../userAgentAdapter"),s=e("../../../detect"),o=e("./mediaStreamClient"),u=e("./constraintsManager"),a=e("../../settablePromise"),f=function(){function e(e,t){this.context=e,this.logger=this.context.logger.createChild("MediaStream"),this.clients=[],this.gumStreams={},this.clientGumStreams=[],this.streamsDump=[],this.isMutedInternal=!1,this.isHold=!1,this.constraintsManager=new u.ConstraintsManager(this.logger),this.selfGlobal=e.global.mediaStream=e.global.mediaStream||{},this.currentConstraints=this.constraintsManager.createConstraintsObject(t)}return e.prototype.getObject=function(){return this.currentGumStream},e.prototype.applyConstraints=function(e){if(this.currentGumStream){var t=this.constraintsManager.updateVideoConstraints(this.currentConstraints,e);if(!t)return Promise.resolve(!1);if(this.currentConstraints!==t)return this.currentConstraints=t,this.applyConstraintsInternal().then(function(){return!0})}return Promise.resolve(!1)},e.prototype.getClient=function(){var e;this.currentGumStream?(e=this.currentGumStream.clone(),this.clientGumStreams.push((n={},n[this.constraintsManager.getKey(this.currentConstraints)]=e,n))):this.clientGumStreams.push({});var t=new o.MediaStreamClient(this,e);this.clients.push(t);return t;var n},e.prototype.setMute=function(e){this.isMutedInternal=e,this.clients.forEach(function(t){t.setMute(e)}),this.enableDisableTracks()},e.prototype.isMuted=function(){return this.isMutedInternal},e.prototype.setHold=function(e){this.isHold=e,this.clients.forEach(function(t){t.setHold(e)}),this.enableDisableTracks()},e.prototype.dispose=function(e){var t=this.clients.indexOf(e);if(t>=0){this.clients.splice(t,1),this.streamsDump.push(this.clientGumStreams[t]),this.clientGumStreams.splice(t,1);if(this.clients.length===0)return this.onDisposed&&this.onDisposed(),this.stopGumStream()}return Promise.resolve()},e.prototype.start=function(){return this.gumPromise||(this.currentConstraints.video&&!s.isEdge()?this.gumPromise=this.applyConstraintsInternal():this.gumPromise=this.updateGumStreamInternal(this.currentConstraints)),this.gumPromise},e.prototype.hasAudio=function(){return!!this.currentGumStream&&this.currentGumStream.getAudioTracks().length!==0},e.prototype.hasVideo=function(){return!!this.currentGumStream&&this.currentGumStream.getVideoTracks().length!==0},e.prototype.getVideoDeviceId=function(){return this.currentConstraints.video.deviceId},e.prototype.asGumOperation=function(e){var t=this;this.selfGlobal.gumSerializer=this.selfGlobal.gumSerializer||Promise.resolve();var n=this.selfGlobal.gumSerializer.then(e);return this.selfGlobal.gumSerializer=n.catch(function(e){t.logger.warn("previous gum operation failed:",e)}),n},e.prototype.updateClients=function(e){var t=this,n=this.constraintsManager.getKey(e);this.clients.forEach(function(e,r){t.clientGumStreams[r][n]||(t.clientGumStreams[r][n]=t.currentGumStream.clone()),e.updateStream(t.clientGumStreams[r][n])})},e.prototype.applyConstraintsInternal=function(){var e=this;return new Promise(function(t,r){e.logger.log("applying stream constraints:",JSON.stringify(e.currentConstraints));var i=new a.SettablePromise;e.clients.forEach(function(e){e.onApplyConstraints&&e.onApplyConstraints(i.promise)});var s=e.asGumOperation(function(){var t=e.constraintsManager.generatePolicies(e.currentConstraints);return e.gumPromise=e.updateGumStreamInternal(t[0]),t.slice(1).forEach(function(t){e.gumPromise=e.gumPromise.catch(function(r){if(n.default.MEDIA_ERROR.constraintNotSatisfiedError===r.type)return e.logger.warn("could not obtain constrained media stream, will attempt weaker policy"),e.updateGumStreamInternal(t);throw r.constraints=t,r})}),e.gumPromise}).then(i.resolve).catch(function(t){throw e.logger.error("failed to apply constraints:",JSON.stringify(t.constraints),"error:",t),i.reject(t),t});t(s)})},e.prototype.enableDisableTracks=function(){var e=this;this.currentGumStream&&this.currentGumStream.getTracks().forEach(function(t){typeof t.enabled!="undefined"&&(t.enabled=(t.kind!=="audio"||!e.isMutedInternal)&&!e.isHold,e.logger.log("control media stream track","kind:",t.kind,"enabled:",t.enabled,"muted:",t.muted))})},e.prototype.updateGumStreamInternal=function(e){var t=this;return(new Promise(function(n,r){t.logger.log("querying user media for stream:",JSON.stringify(e));var s=t.gumStreams[t.constraintsManager.getKey(e)];if(s)n(s);else{var o=t.constraintsManager.toGumConstraints(e);i.default.window.navigator.getUserMedia(o,n,r)}})).catch(function(n){throw t.decorateMediaStreamError(n,e)}).then(function(n){t.onMediaStreamAcquired&&t.onMediaStreamAcquired(n,e),!e.audio&&n.getAudioTracks().length>0&&(n.getAudioTracks()[0].stop(),n=new i.default.window.MediaStream(n.getVideoTracks())),n.getAudioTracks().forEach(function(e){e.onended=function(e){t.logger.log("Audio stream track ended: "+JSON.stringify(e.error&&e.error.name||e)),t.onTrackEnded&&t.onTrackEnded(e)},e.onmute=function(){t.logger.log("Audio stream track muted"),t.onTrackMuted&&t.onTrackMuted(!0)},e.onunmute=function(){t.logger.log("Audio stream track unmuted"),t.onTrackMuted&&t.onTrackMuted(!1)},e.muted&&t.onTrackMuted&&t.onTrackMuted(!0)});var r=n.getVideoTracks()[0];if(r&&r.getSettings&&r.getSettings()){t.logger.log("updating deviceID",t.getVideoDeviceId());var s=r.getSettings().deviceId;e=t.constraintsManager.updateVideoDeviceId(e,s)}t.currentConstraints=e,t.gumStreams[t.constraintsManager.getKey(e)]=n,t.currentGumStream=n,t.updateClients(e),r&&(r.onmute=function(){t.logger.error("Video stream track muted: "+JSON.stringify(e))},r.onended=function(n){t.logger.log("Video stream track ended: "+JSON.stringify(e)+"; "+JSON.stringify(n.error&&n.error.name||n))}),t.enableDisableTracks(),t.logger.log("media stream updated")})},e.prototype.decorateMediaStreamError=function(e,t){var r;return"SourceUnavailableError"===e.name||"TrackStartError"===e.name||"NotReadableError"===e.name?r={type:n.default.MEDIA_ERROR.sourceUnavailableError,detail:"media device is already used by another process: "+e.toString()}:"ConstraintNotSatisfiedError"===e.name||"OverconstrainedError"===e.name?r={type:n.default.MEDIA_ERROR.constraintNotSatisfiedError,detail:"could not obtain constrained media stream: "+e.toString()}:"DevicesNotFoundError"===e.name||"NotFoundError"===e.name?r={type:n.default.MEDIA_ERROR.devicesNotFoundError,detail:"specified device not found: "+e.toString()}:r={type:n.default.MEDIA_ERROR.permissionDeniedError,detail:"permission to use media device was denied: "+e.toString()},r.isAudio=!!t.audio,r},e.prototype.stopGumStream=function(){var e=this;return this.gumPromise?(this.logger.log("queueing media stream stop"),this.asGumOperation(function(){return e.stopGumStreamInternal()})):Promise.resolve()},e.prototype.stopOneGumStream=function(e){try{e.getTracks().forEach(function(e){e.onended=null,e.onmute=null,e.stop()}),this.logger.log("media stream stopped")}catch(t){this.logger.warn("failed to stop media stream:",t)}},e.prototype.stopGumStreamInternal=function(){var e=this;this.currentGumStream&&(this.clientGumStreams.concat(this.streamsDump,[this.gumStreams]).forEach(function(t){return r.forOwn(t,function(t){return e.stopOneGumStream(t)})}),this.gumStreams={},this.clientGumStreams=[],this.streamsDump=[],this.currentGumStream=null)},e}();t.MediaStreamInternal=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/stream/local/cachedStream",["require","exports","./mediaStream"],e)}(function(e,t){var n=e("./mediaStream"),r=function(){function e(t,n,r,i,s){var o=this;this.streamConstraints=t,this.deviceIds=n,this.context=r,this.logger=i,this.observer=s,this.isOutDated=!1,this.isAudioEnabled=!1,this.isVideoEnabled=!1,this.stream=this.createMediaStream(),this.stream.onDisposed=function(){return o.observer.onStreamDisposed(o)},this.stream.onTrackEnded=function(e){return o.observer.onStreamTrackEnded(o,e)},this.stream.onTrackMuted=function(e){return o.observer.onStreamTrackMuted(o,e)},this.stream.onMediaStreamAcquired=function(e,t){return o.observer.onMediaStreamAcquired(o,e,t)},this.isAudioEnabled=!!t.audio,this.isVideoEnabled=!!t.video,this.streamId=e.streamGeneration++}return Object.defineProperty(e.prototype,"isStreamOutDated",{get:function(){return this.isOutDated},enumerable:!0,configurable:!0}),e.prototype.getStream=function(){return this.stream},e.prototype.getId=function(){return this.streamId},e.prototype.isSuitable=function(e,t){return!this.isOutDated&&!!e.audio===this.isAudioEnabled&&!!e.video===this.isVideoEnabled&&(!e.audio||this.deviceIds.microphone===t.microphone)&&(!e.video||t.camera===(this.deviceIds.camera||this.stream.getVideoDeviceId()))},e.prototype.outdateIfAnyDeviceRemoved=function(e){if(!this.isOutDated){var t=this.isDeviceOutdated(this.deviceIds.microphone,e),n=this.isDeviceOutdated(this.deviceIds.camera,e);this.isOutDated=n||t}},e.prototype.isDeviceOutdated=function(e,t){return e&&!t.some(function(t){return t.deviceId===e})},e.prototype.createMediaStream=function(){return new n.MediaStreamInternal({global:this.context,logger:this.logger},this.streamConstraints)},e}();r.streamGeneration=0,t.CachedStream=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/render/videoRenderer",["require","exports","../../detect","../userAgentAdapter"],e)}(function(e,t){function i(e){switch(e){case"crop":return"cover";case"stretch":return"fill";case"fit":default:return"contain"}}var n=e("../../detect"),r=e("../userAgentAdapter"),s=function(){function e(e){var t=this;this.window=r.default.window,this.lastNotifiedVideoWidth=0,this.lastNotifiedVideoHeight=0,this.onVideoDataUpdated=function(){if(t.sizeChangedListener){var e=t.video.videoWidth,n=t.video.videoHeight;if(e<32||n<32)e=n=0;if(t.lastNotifiedVideoWidth!==e||t.lastNotifiedVideoHeight!==n)t.lastNotifiedVideoWidth=e,t.lastNotifiedVideoHeight=n,t.sizeChangedListener(e,n)}},this.onVideoError=function(){t.errorListener&&t.errorListener(t.video.error||"no video")},this.onVideoPaused=function(){n.isEdge()&&(t.window.attachMediaStream(t.video,null),t.window.attachMediaStream(t.video,t.stream)),t.video.play()},this.onContextMenu=function(e){e.preventDefault()},this.container=e,this.video=this.window.document.createElement("video"),this.video.style.width="100%",this.video.style.height="100%",this.initialize()}return e.prototype.onSizeChanged=function(e){this.sizeChangedListener=e},e.prototype.onError=function(e){this.errorListener=e},e.prototype.getVideoElement=function(){return this.video},e.prototype.getType=function(){return 0},e.prototype.dispose=function(){this.detachEventListeners(),this.video=null,this.stream=null},e.prototype.reattachEventListeners=function(){this.detachEventListeners(),this.attachEventListeners()},e.prototype.attachMediaStream=function(e){if(this.stream===e)return;this.stream&&(e||this.container.removeChild(this.video),this.window.detachMediaStream(this.video)),e&&(this.video.hidden=e.getVideoTracks().length===0,this.window.attachMediaStream(this.video,e),this.stream||this.container.appendChild(this.video)),this.stream=e},e.prototype.setScalingMode=function(e){this.video.style.objectFit=i(e)},e.prototype.getMediaStream=function(){return this.stream},e.prototype.initialize=function(){this.video.autoplay=!0,this.video.muted=!0,this.attachEventListeners()},e.prototype.attachEventListeners=function(){this.video.addEventListener("loadedmetadata",this.onVideoDataUpdated),this.video.addEventListener("timeupdate",this.onVideoDataUpdated),this.video.addEventListener("error",this.onVideoError),this.video.addEventListener("pause",this.onVideoPaused),this.video.addEventListener("contextmenu",this.onContextMenu)},e.prototype.detachEventListeners=function(){this.video.removeEventListener("loadedmetadata",this.onVideoDataUpdated),this.video.removeEventListener("timeupdate",this.onVideoDataUpdated),this.video.removeEventListener("error",this.onVideoError),this.video.removeEventListener("pause",this.onVideoPaused),this.video.removeEventListener("contextmenu",this.onContextMenu),this.attachMediaStream(null)},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=s});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/render/localVideoRenderer",["require","exports","./videoRenderer","../../common/promiseQueue"],e)})(function(e,t){var n=e("./videoRenderer"),r=e("../../common/promiseQueue"),i=function(e){function t(t,n,i,s){var o=e.call(this,t)||this;return o.observer=i,o.mediaStreamProvider=s,o.isDisposed=!1,o.serialQueue=new r.PromiseQueue,o.onSizeChanged(n?n.onVideoSizeChanged:null),o}return __extends(t,e),t.prototype.dispose=function(){this.isDisposed=!0,this.observer.onDisposed(this),e.prototype.dispose.call(this),this.mediaStream&&(this.mediaStream.dispose(),this.mediaStream=null)},t.prototype.startVideoAsync=function(){var e=this;return this.observer.onRenderingStarted(this),this.serialQueue.add(function(){return e.startVideo()})},t.prototype.attachStreamAsync=function(e){var t=this;return this.serialQueue.add(function(){return t.attachStream(e)})},t.prototype.startVideo=function(){var e=this,t=this.mediaStreamProvider.getAudioVideoStream();return t.start().then(function(){if(e.isDisposed)return t.dispose().then(function(){throw new Error("disposed")});e.attachStream(t)})},t.prototype.attachStream=function(t){var n=this;if(this.mediaStream===t)return;try{this.mediaStream&&(e.prototype.reattachEventListeners.call(this),this.mediaStream.dispose(),this.mediaStream=null),t&&(t.onApplyConstraints=function(r){e.prototype.attachMediaStream.call(n,null),r.then(function(){e.prototype.attachMediaStream.call(n,t.getObject())})},e.prototype.attachMediaStream.call(this,t.getObject())),this.mediaStream=t}catch(r){throw t&&t.dispose(),r}},t}(n.default);t.LocalVideoRenderer=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/device/deviceListConverter",["require","exports","../constants","../common/utils"],e)}(function(e,t){var n=e("../constants"),r=e("../common/utils"),i=function(){function e(){}return e.prototype.getDefaultDeviceCandidate=function(e,t){if(e.length===1)return e[0];var r,i=e.find(function(e){return e.isSystemDefault&&e.deviceId===n.default.MEDIA_DEVICE.defaultId});return i&&(r=this.deductDefaultDeviceFromDeviceAmount(e,i)||this.deductDefaultDeviceFromGroupId(e,i)||this.deductDefaultDeviceFromLabel(e,i)),r||this.deductDefaultDeviceFromPreviousDefaultDevice(e,t)},e.prototype.deductDefaultDeviceFromDeviceAmount=function(e,t){var n=e.filter(function(e){return e!==t});return n.length===1&&n[0]},e.prototype.deductDefaultDeviceFromGroupId=function(e,t){return e.find(function(e){return e!==t&&e.groupId===t.groupId})},e.prototype.deductDefaultDeviceFromLabel=function(e,t){var n=e.map(function(e){return e!==t&&e.label}),i=r.getMaxSubstring(t.label,n);return e.find(function(e){return e!==t&&e.label&&e.label===i})},e.prototype.deductDefaultDeviceFromPreviousDefaultDevice=function(e,t){if(!t||!t.length)return null;var n=t.find(function(e){return e.isSystemDefault});return n&&e.find(function(e){return e.deviceId===n.deviceId})},e}(),s=function(){function e(e,t){this.deviceProvider=e,this.logger=t,this.deductor=new i}return e.prototype.convertDevices=function(e,t){var n=this.createDeviceList(e,t);return n},e.prototype.createDeviceList=function(e,t){if(!e||!e.length)return[];var n=this.filterOutCommunicationsDevices(e);return n=this.deductDefaultDevice(n,t),n=this.filterOutDevicesWithDefaultId(n),n=this.addSyntheticDefaultDeviceIfNeeded(n),n},e.prototype.deductDefaultDevice=function(e,t){var n=this.deductor.getDefaultDeviceCandidate(e,t);return n?(n.isSystemDefault=!0,this.logger.log("["+n.type+"] Default device is set to "+n.guid+" "+n.label)):this.logger.log("["+JSON.stringify(e&&e[0].type)+"] Default device is not set}"),e},e.prototype.filterOutDevicesWithDefaultId=function(e){var t=e.filter(function(e){return e.deviceId!==n.default.MEDIA_DEVICE.defaultId});return t.find(function(e){return e.isSystemDefault})||this.logger.log("["+JSON.stringify(t&&t[0].type)+"] No default devices left"),t},e.prototype.filterOutCommunicationsDevices=function(e){return e.filter(function(e){return e.deviceId!==n.default.MEDIA_DEVICE.communicationsId})},e.prototype.addSyntheticDefaultDeviceIfNeeded=function(e){var t=e.find(function(e){return e.isSystemDefault});return t||(t=this.deviceProvider.createDefaultDevice(e[0].type),e.push(t)),e},e}();t.DeviceListConverter=s});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/device/deviceProvider",["require","exports","../constants"],e)})(function(e,t){var n=e("../constants"),r=function(){function e(e,t,n,r){this.deviceId=e,this.label=t,this.kind=n,this.groupId=r,this.type=this.getType(this.kind),this.guid=this.getDeviceGuid(this.deviceId,this.type),this.isSystemDefault=this.isDefault(this.deviceId)}return e.prototype.toDeviceDesc=function(){return{id:this.guid,label:this.label,kind:this.type}},e.prototype.getType=function(e){switch(e){case n.default.MEDIA_DEVICE_KIND.audioInput:return n.default.MEDIA_DEVICE.microphone;case n.default.MEDIA_DEVICE_KIND.audioOutput:return n.default.MEDIA_DEVICE.speaker;case n.default.MEDIA_DEVICE_KIND.videoInput:return n.default.MEDIA_DEVICE.camera;default:throw new Error("Device kind to recognized: "+e)}},e.prototype.isDefault=function(e){return e===n.default.MEDIA_DEVICE.defaultId},e.prototype.getDeviceGuid=function(e,t){return t+":"+e},e}(),i=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i)||this}return __extends(t,e),t.prototype.toDeviceDesc=function(){var t=e.prototype.toDeviceDesc.call(this);return t.isSystemDefault=this.isSystemDefault,t},t}(r);t.AudioDevice=i;var s=function(e){function t(t,n,r,i){var s=e.call(this,t,n,r,i)||this;return s.position="unknown",s}return __extends(t,e),t.prototype.toDeviceDesc=function(){var t=e.prototype.toDeviceDesc.call(this);return t.position=this.position,t},t}(r);t.VideoDevice=s;var o=function(){function e(e){this.logger=e}return e.prototype.createDevice=function(e){switch(e.kind){case n.default.MEDIA_DEVICE_KIND.audioInput:case n.default.MEDIA_DEVICE_KIND.audioOutput:return new i(e.deviceId,e.label,e.kind,e.groupId);case n.default.MEDIA_DEVICE_KIND.videoInput:return new s(e.deviceId,e.label,e.kind,e.groupId);default:this.logger.error("Device kind is not recognized: "+JSON.stringify(e))}},e.prototype.createDefaultDevice=function(e){var t={deviceId:n.default.MEDIA_DEVICE.defaultId,label:n.default.MEDIA_DEVICE.defaultDeviceLabel,kind:this.getKind(e),groupId:""};return this.createDevice(t)},e.prototype.getKind=function(e){switch(e){case n.default.MEDIA_DEVICE.microphone:return n.default.MEDIA_DEVICE_KIND.audioInput;case n.default.MEDIA_DEVICE.speaker:return n.default.MEDIA_DEVICE_KIND.audioOutput;case n.default.MEDIA_DEVICE.camera:return n.default.MEDIA_DEVICE_KIND.videoInput;default:throw new Error("Device type to recognized: "+e)}},e}();t.DeviceProvider=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/events",["require","exports","../common/utils"],e)}(function(e,t){var n=e("../common/utils"),r=function(){function e(){this.subscriptions=[]}return e.prototype.subscribe=function(e){return new i(this.subscriptions,e)},e.prototype.dispose=function(){this.subscriptions=[]},e.prototype.raiseEvents=function(e){var t=this.subscriptions.slice();t.forEach(function(t){return t.eventHandler&&e(t.eventHandler)})},e}();t.EventSourceImpl=r;var i=function(){function e(e,t){this.subscriptions=e,this.eventHandler=t,this.subscriptions.push(this)}return e.prototype.dispose=function(){var e=this;n.remove(this.subscriptions,function(t){return t===e}),this.eventHandler=null},e}()});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/observableBase",["require","exports","./events"],e)})(function(e,t){var n=e("./events"),r=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.changed=function(e){return this.subscribe({changed:e,on:null})},t.prototype.on=function(e,t){return this.subscribe({changed:null,on:{name:e,handler:this._toEventCallback(t)}})},t.prototype.once=function(e,t){var n=this,r,i=function(){var e=[];for(var i=0;i<arguments.length;i++)e[i]=arguments[i];r.dispose(),n._toEventCallback(t).apply(void 0,e)};return r=this.on(e,this._fromEventCallback(i))},t.prototype.raiseChanged=function(){this.raiseEvents(function(e){return e.changed&&e.changed()})},t.prototype.event=function(e){var t=this;return{raise:this._fromEventCallback(function(){var n=[];for(var r=0;r<arguments.length;r++)n[r]=arguments[r];return t._raiseEventImpl.apply(t,[e].concat(n))})}},t.prototype._raiseEventImpl=function(e){var t=[];for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.raiseEvents(function(n){return n.on&&n.on.name===e&&(r=n.on).handler.apply(r,t);var r})},t.prototype._toEventCallback=function(e){return e},t.prototype._fromEventCallback=function(e){return e},t}(n.EventSourceImpl);Object.defineProperty(t,"__esModule",{value:!0}),t.default=r});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/device/deviceList",["require","exports","../common/utils","../common/observableBase"],e)})(function(e,t){var n=e("../common/utils"),r=e("../common/observableBase"),i=function(e){function t(t,n){var r=e.call(this)||this;return r.deviceListConverter=t,r.logger=n,r.isSelectedAutomatically=!0,r}return __extends(t,e),t.prototype.updateDevices=function(e){var t=e;this.deviceListConverter&&(t=this.prioritizeDevices(this.deviceListConverter.convertDevices(e,this.list)));var n=this.updateList(t);if(n){var r=this.getDeviceToSelect();this.updateSelectedDevice(r)}},t.prototype.getDevices=function(){return this.list},t.prototype.selectDeviceId=function(e){this.isSelectedAutomatically=!1;var t=this.getDeviceToSelect(e);this.updateSelectedDevice(t)},t.prototype.getSelectedDevice=function(){return this.selectedDevice},t.prototype.updateActiveDevice=function(e){if(!e)return;if(e.isMarkedDefault){var t=this.list.find(function(e){return e.isSystemDefault});t!==e.device&&(this.updateDefaultDevice(e.device,t),this.selectDeviceId(e.device.guid))}else this.checkSelectedDeviceIsActive(e.device)},t.prototype.setSelectionStrategy=function(e){this.selectionStrategy=e},t.prototype.isUpdateNeeded=function(){return this.list.some(function(e){return!e.label})},t.prototype.updateList=function(e){this.list&&this.migrateDeviceData(this.list,e);var t=!n.deepEqual(this.list,e);return t&&(this.list=e,this.event("onDevicesChanged").raise()),t},t.prototype.migrateDeviceData=function(e,t){e.forEach(function(e){var n=t.find(function(t){return t.guid===e.guid});n&&e.label&&!n.label&&(n.label=e.label)})},t.prototype.updateSelectedDevice=function(e){this.isSameDevice(e,this.selectedDevice)||(this.logger.log("update selected device "+(this.selectedDevice&&this.selectedDevice.guid)+" -> "+(e&&e.guid)),this.selectedDevice=e,this.event("onSelectedDevicesChanged").raise())},t.prototype.getDeviceToSelect=function(e){var t=this,n=e&&this.list.find(function(t){return t.guid===e});if(!n){var r=this.list.some(function(e){return t.isSameDevice(e,t.selectedDevice)});!this.isSelectedAutomatically&&r?n=this.selectedDevice:(n=this.selectionStrategy.getSelectedDevice(this.list),this.isSelectedAutomatically=!0)}return n},t.prototype.prioritizeDevices=function(e){var t=e.find(function(e){return e.isSystemDefault});return t&&(e.splice(e.indexOf(t),1),e.unshift(t)),e},t.prototype.updateDefaultDevice=function(e,t){this.logger.log("Swithing to new default device "+e.guid),e.isSystemDefault=!0,t&&this.list.splice(this.list.indexOf(t),1),this.list=this.prioritizeDevices(this.list),this.event("onDevicesChanged").raise()},t.prototype.checkSelectedDeviceIsActive=function(e){this.selectedDevice!==e&&(!this.selectedDevice||!e||this.selectedDevice.guid!==e.guid)&&this.logger.error("Selected device is not active!","selected: "+(this.selectedDevice&&this.selectedDevice.guid)+", active: "+(e&&e.guid))},t.prototype.isSameDevice=function(e,t){return!e&&!t||e&&t&&e.guid===t.guid},t}(r.default);t.DeviceList=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/device/deviceSelectionStrategy",["require","exports"],e)}(function(e,t){var n;(function(e){e[e.Manual=0]="Manual",e[e.Automatic=1]="Automatic"})(n=t.SelectionType||(t.SelectionType={}));var r=function(){function e(){}return e.prototype.getSelectedDevice=function(e){return null},e}(),i=function(){function e(){}return e.prototype.getSelectedDevice=function(e){return e&&(e.find(function(e){return e.isSystemDefault})||e[0])},e}(),s=function(){function e(){}return e.getStrategy=function(e){switch(e){case n.Manual:return new r;case n.Automatic:return new i;default:return null}},e}();t.DeviceSelectionStrategyFactory=s});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/device/composedDeviceList",["require","exports","./deviceList","./deviceSelectionStrategy","../common/observableBase","../constants","../detect","../common/utils"],e)})(function(e,t){var n=e("./deviceList"),r=e("./deviceSelectionStrategy"),i=e("../common/observableBase"),s=e("../constants"),o=e("../detect"),u=e("../common/utils"),a=function(e){function t(t,r){var i=e.call(this)||this;return i.logger=r,i.deviceLists=new Map,i.subs=[],i.isDeviceListChanged=!1,i.isSelectedDeviceChanged=!1,i.configureList(s.default.MEDIA_DEVICE.camera,new n.DeviceList(null,i.logger.createChild("Cameras"))),i.configureList(s.default.MEDIA_DEVICE.microphone,new n.DeviceList(t,i.logger.createChild("Microphones"))),o.isAudioOutputSelectionSupported()&&i.configureList(s.default.MEDIA_DEVICE.speaker,new n.DeviceList(t,i.logger.createChild("Speakers"))),i}return __extends(t,e),t.prototype.updateDevices=function(e){this.deviceLists.forEach(function(t,n){var r=e.filter(function(e){return e.type===n});t.updateDevices(r)}),this.raiseEventsIfChanged()},t.prototype.getDevices=function(){var e=[];return this.deviceLists.forEach(function(t,n){t.getDevices()&&e.push.apply(e,t.getDevices())}),e},t.prototype.selectDevices=function(e){this.logger.log("SelectDevices called with "+JSON.stringify(e)),this.deviceLists.forEach(function(t,n){e[n]&&t.selectDeviceId(e[n])}),this.raiseEventsIfChanged()},t.prototype.getSelectedDevices=function(){var e={camera:null,microphone:null,speaker:null};return this.deviceLists.forEach(function(t,n){e[n]=t.getSelectedDevice()}),e},t.prototype.updateActiveDevices=function(e){this.deviceLists.forEach(function(t,n){e[n]&&t.updateActiveDevice(e[n])}),this.raiseEventsIfChanged()},t.prototype.setCameraSelectionStrategy=function(e){this.deviceLists.get(s.default.MEDIA_DEVICE.camera).setSelectionStrategy(e)},t.prototype.isUpdateNeeded=function(){var e=!1;return this.deviceLists.forEach(function(t,n){t.isUpdateNeeded()&&(e=!0)}),e},t.prototype.configureList=function(e,t){var n=this;t.setSelectionStrategy(r.DeviceSelectionStrategyFactory.getStrategy(r.SelectionType.Automatic)),this.subs.push(t.on("onDevicesChanged",function(){return n.onDevicesChanged()})),this.subs.push(t.on("onSelectedDevicesChanged",function(){return n.onSelectedDevicesChanged()})),this.deviceLists.set(e,t)},t.prototype.raiseEventsIfChanged=function(){if(this.isSelectedDeviceChanged){var e=this.getSelectedDevices(),t=u.values(e).map(function(e){return e&&e.guid});this.logger.log("Event onSelectedDevicesChanged with guids: "+JSON.stringify(t)),this.event("onSelectedDevicesChanged").raise(this,e),this.isSelectedDeviceChanged=!1}if(this.isDeviceListChanged){var n=this.getDevices();this.logger.log("Event onDevicesChanged with: "+JSON.stringify(n)),this.event("onDevicesChanged").raise(this,n),this.isDeviceListChanged=!1}},t.prototype.onDevicesChanged=function(){this.isDeviceListChanged||(this.isDeviceListChanged=!0)},t.prototype.onSelectedDevicesChanged=function(){this.isSelectedDeviceChanged||(this.isSelectedDeviceChanged=!0)},t}(i.default);t.ComposedDeviceList=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/device/deviceEnumerator",["require","exports","../common/userAgentAdapter","./deviceListConverter","./deviceProvider","./composedDeviceList","../common/settablePromise"],e)}(function(e,t){var n=e("../common/userAgentAdapter"),r=e("./deviceListConverter"),i=e("./deviceProvider"),s=e("./composedDeviceList"),o=e("../common/settablePromise"),u=3e3,a=function(){function e(e,t){var u=this;this.settings=e,this.logger=t,this.window=n.default.window,this.deviceProvider=new i.DeviceProvider(this.logger),this.isInitializedPromise=new o.SettablePromise;var a=new r.DeviceListConverter(this.deviceProvider,this.logger.createChild("DeviceListConverter"));this.deviceList=new s.ComposedDeviceList(a,this.logger.createChild("DeviceList")),this.window.navigator.mediaDevices&&(this.window.navigator.mediaDevices.ondevicechange=function(){u.enableOnDeviceChangeCallbackSupport(),u.enumerateDevices()})}return Object.defineProperty(e.prototype,"list",{get:function(){return this.deviceList},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this.isInitializedPromise},enumerable:!0,configurable:!0}),e.prototype.initialize=function(){var e=this;this.enumerateDevices().then(function(){return e.isInitializedPromise.resolve()}).catch(function(){return e.isInitializedPromise.reject()})},e.prototype.enumerateDevices=function(){var e=this;return!this.window.navigator||!this.window.navigator.mediaDevices||!this.window.navigator.mediaDevices.enumerateDevices?Promise.reject(new Error("device enumeration unsupported")):(this.enumerateDevicesPromise||(this.enumerateDevicesPromise=Promise.resolve().then(function(){return e.window.navigator.mediaDevices.enumerateDevices()}).catch(function(t){throw e.enumerateDevicesPromise=null,e.logger.warn("error with enumerating devices:",t),t}).then(function(t){e.enumerateDevicesPromise=null;var n=t.map(function(t){return e.deviceProvider.createDevice(t)});e.deviceList.updateDevices(n)})),this.enumerateDevicesPromise)},e.prototype.getDeviceName=function(e){var t=this.deviceList.getDevices().find(function(t){return t.guid===e});return Promise.resolve(t?t.label:"")},e.prototype.startDevicePolling=function(){var e=this,t=typeof this.settings.devicePollingInterval!="undefined"?this.settings.devicePollingInterval:u;if(t===0||this.onDeviceChangeCallbackSupported||this.pollingTimer)return;var n=function(){e.logger.log("Polling devices"),e.enumerateDevices().then(function(){e.pollingTimer=e.window.setTimeout(n,t)})};this.logger.log("starting device polling"),n()},e.prototype.stopDevicePolling=function(){this.pollingTimer&&(this.logger.log("stopping device polling"),this.window.clearTimeout(this.pollingTimer),this.pollingTimer=void 0)},e.prototype.enableOnDeviceChangeCallbackSupport=function(){this.onDeviceChangeCallbackSupported=!0,this.stopDevicePolling()},e}();t.DeviceEnumerator=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/device/deviceManager",["require","exports","../common/stream/local/cachedStream","../common/render/localVideoRenderer","./deviceEnumerator","./deviceSelectionStrategy","../constants","../detect","../common/utils"],e)}(function(e,t){var n=e("../common/stream/local/cachedStream"),r=e("../common/render/localVideoRenderer"),i=e("./deviceEnumerator"),s=e("./deviceSelectionStrategy"),o=e("../constants"),u=e("../detect"),a=e("../common/utils"),f=function(){function e(e,t){var n=this;this.context=e,this.observer=t,this.cachedStreams=[],this.activeRenderers=[],this.globalAudioEnable=!0,this.audioDeviceInUseQualityLevel=1,this.videoDeviceInUseQualityLevel=1,this.selectedDevices={camera:null,microphone:null,speaker:null},this.logger=e.logger,this.deviceEnumerator=new i.DeviceEnumerator(e.settings,this.logger.createChild("DeviceEnumerator")),this.deviceList=this.deviceEnumerator.list,this.deviceList.on("onDevicesChanged",function(e,t){return n.onDevicesChanged(e,t)}),this.deviceList.on("onSelectedDevicesChanged",function(e,t){return n.onSelectedDevicesChanged(e,t)}),this.deviceEnumerator.initialize()}return Object.defineProperty(e.prototype,"devices",{get:function(){return this.deviceList.getDevices()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this.deviceEnumerator.isInitialized},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAudioOutputSelectionSupported",{get:function(){return u.isAudioOutputSelectionSupported()},enumerable:!0,configurable:!0}),e.prototype.createPreviewRenderer=function(e,t){return new r.LocalVideoRenderer(e,t,this,this)},e.prototype.askDevicePermission=function(e){var t=this,n;return Promise.resolve().then(function(){return e||(e={audio:!0,video:t.hasCamera()}),n=t.getMediaStream(e),n.start()}).catch(function(){t.logger.warn("askDevicePermission: media stream not started")}).then(function(){var e={audio:!1,video:!1};return n&&(e.audio=n.hasAudio(),e.video=n.hasVideo(),t.disposeMediaStreamLater(n)),t.devicePermissionsChanged&&t.devicePermissionsChanged(e),e})},e.prototype.getAudioStream=function(){return this.getMediaStream({audio:!0})},e.prototype.getVideoStream=function(){return this.getMediaStream({video:!0})},e.prototype.getAudioVideoStream=function(){return this.getMediaStream({audio:!0,video:!0})},e.prototype.enumerateDevicesAsync=function(){var e=this;return this.isInitialized.promise.then(function(){return e.getDevicesDesc(e.devices)})},e.prototype.getDeviceNameAsync=function(e){var t=this.devices.find(function(t){return t.guid===e}),n="",r=t&&t.label?t.label:n;return Promise.resolve(r)},e.prototype.selectDevices=function(e){this.deviceList.selectDevices(e)},e.prototype.getSelectedDevices=function(){return this.toSelectedDevices(this.deviceList.getSelectedDevices())},e.prototype.getOutputDeviceId=function(){return this.selectedDevices.speaker&&this.selectedDevices.speaker.deviceId},e.prototype.muteInputAsync=function(){return this.controlAudioAsync(!1)},e.prototype.unmuteInputAsync=function(){return this.controlAudioAsync(!0)},e.prototype.enumerateDevices=function(){return this.deviceEnumerator.enumerateDevices()},e.prototype.toSelectedDevices=function(e){var t={};return Object.keys(e).forEach(function(n){e[n]&&(t[n]=e[n].guid)}),t},e.prototype.getDevicesDesc=function(e){return e.map(function(e){return e.toDeviceDesc()})},e.prototype.onStreamDisposed=function(e){this.logger.log("release media stream","generation:",e.getId(),"cached:",this.cachedStreams.length),a.remove(this.cachedStreams,function(t){return t===e}),this.cachedStreams.length||this.deviceEnumerator.stopDevicePolling(),e.getStream().hasVideo()&&this.updateCameraSelectionStrategy(s.SelectionType.Automatic)},e.prototype.onStreamTrackEnded=function(e,t){t.error&&t.error.name==="SourceUnavailableError"&&this.handleAudioDeviceInUse(3)},e.prototype.onStreamTrackMuted=function(e,t){this.raiseQualityChanged(25,t?3:1)},e.prototype.onMediaStreamAcquired=function(e,t,n){var r=this.getActiveDevices(t,n);this.deviceList.updateActiveDevices(r),e.getStream().hasVideo()&&this.updateCameraSelectionStrategy(s.SelectionType.Manual),this.deviceList.isUpdateNeeded()&&this.enumerateDevices()},e.prototype.getActiveDevices=function(e,t){var n=e.getAudioTracks()&&e.getAudioTracks()[0],r=e.getVideoTracks()&&e.getVideoTracks()[0];return{microphone:this.getActiveDevice(n,t.audio),camera:this.getActiveDevice(r,t.video)}},e.prototype.getActiveDevice=function(e,t){var n=t&&(!t.deviceId||t.deviceId===o.default.MEDIA_DEVICE.defaultId);if(e&&e.getSettings){var r=e.getSettings();if(r){var i=this.devices.find(function(e){return e.deviceId===r.deviceId});return i?(this.logger.log("Active device found "+JSON.stringify(i)+" with id: "+r.deviceId),{device:i,isMarkedDefault:n}):(this.logger.error("Active device not found","Device id from track: '"+r.deviceId+"', known devices: "+this.devices.map(function(e){return"["+e.label+" "+e.deviceId+"]"}),JSON.stringify(r),JSON.stringify(t)),null)}}return null},e.prototype.onDisposed=function(e){a.remove(this.activeRenderers,function(t){return t===e})},e.prototype.onRenderingStarted=function(e){this.activeRenderers.push(e)},e.prototype.handleDevicesPermissionChanged=function(e,t){this.observer&&this.observer.onDevicesPermissionChanged({hasMicrophonePermission:e,hasCameraPermission:t})},e.prototype.getCachedStream=function(e){var t={camera:this.selectedDevices.camera&&this.selectedDevices.camera.deviceId,microphone:this.selectedDevices.microphone&&this.selectedDevices.microphone.deviceId};return a.find(this.cachedStreams,function(n){return n.isSuitable(e,t)})},e.prototype.hasCamera=function(){return a.values(this.devices).some(function(e){return e.type===o.default.MEDIA_DEVICE.camera})},e.prototype.getMediaStream=function(e){var t={audio:e.audio,video:e.video};this.logger.log("retrieving media stream: ",JSON.stringify(t));var n=this.selectedDevices.microphone,r=this.selectedDevices.camera,i=this.getCachedStream(t);if(!i){var s={};t.audio&&(n?(s.audio={},n&&n.deviceId!==o.default.MEDIA_DEVICE.defaultId&&(s.audio.deviceId=n.deviceId)):this.logger.warn("ignoring audio modality due to missing microphone selection")),t.video&&(r?(s.video={},r&&r.deviceId!==o.default.MEDIA_DEVICE.defaultId&&(s.video.deviceId=r.deviceId)):this.logger.warn("ignoring video modality due to missing camera selection"));if(!s.audio&&!s.video)throw new Error("requesting nothing");return this.createCachedStream(s,this.selectedDevices.microphone&&this.selectedDevices.microphone.deviceId,this.selectedDevices.camera&&this.selectedDevices.camera.deviceId).getStream().getClient()}return i.getStream().getClient()},e.prototype.controlAudioAsync=function(e){return this.globalAudioEnable=e,this.cachedStreams.forEach(function(t){return t.getStream().setMute(!e)}),Promise.resolve()},e.prototype.updateRenderersAsync=function(){var e=this;if(this.activeRenderers.length)try{var t=this.getMediaStream({video:!0});return t.start().then(function(){e.activeRenderers.forEach(function(e){return e.attachStreamAsync(t)})})}catch(n){this.logger.error("Cannot update renderer: "+n)}return Promise.resolve()},e.prototype.createCachedStream=function(e,t,r){var i=this,s=new n.CachedStream(e,{microphone:t,camera:r},this.context,this.logger,this);return s.getStream().start().then(function(){i.deviceEnumerator.startDevicePolling(),s.getStream().setMute(!i.globalAudioEnable);var e=s.getStream().hasAudio(),t=s.getStream().hasVideo();i.logger.log("created media stream","generation:",s.getId(),"cached:",i.cachedStreams.length,"audio:",e,"video:",t),i.handleDevicesPermissionChanged(!0,!0),e&&i.handleAudioDeviceInUse(1),t&&i.handleVideoDeviceInUse(1)}).catch(function(e){e&&(e.type===o.default.MEDIA_ERROR.permissionDeniedError?i.handleDevicesPermissionChanged(s.getStream().hasAudio(),s.getStream().hasVideo()):e.type===o.default.MEDIA_ERROR.sourceUnavailableError&&(e.isAudio?i.handleAudioDeviceInUse(3):i.handleVideoDeviceInUse(3))),a.remove(i.cachedStreams,function(e){return e===s}),i.cachedStreams.length||i.deviceEnumerator.stopDevicePolling()}),this.cachedStreams.push(s),s},e.prototype.raiseQualityChanged=function(e,t,n){n===void 0&&(n=0);var r={type:e,value:t,isLocalSource:!0,mediaType:0};this.qualityChanged(r)},e.prototype.handleAudioDeviceInUse=function(e){this.qualityChanged&&(e!==1||this.audioDeviceInUseQualityLevel!==e)&&(this.audioDeviceInUseQualityLevel=e,this.raiseQualityChanged(39,e))},e.prototype.handleVideoDeviceInUse=function(e){this.qualityChanged&&(e!==1||this.videoDeviceInUseQualityLevel!==e)&&(this.videoDeviceInUseQualityLevel=e,this.raiseQualityChanged(33,e,1))},e.prototype.disposeMediaStreamLater=function(e){var t=this.context.settings.mediaStreamHoldInterval||5e3;setTimeout(function(){e.dispose()},t)},e.prototype.updateCameraSelectionStrategy=function(e){var t=s.DeviceSelectionStrategyFactory.getStrategy(e);this.deviceList.setCameraSelectionStrategy(t)},e.prototype.onDevicesChanged=function(e,t){this.cachedStreams.forEach(function(e){return e.outdateIfAnyDeviceRemoved(t)}),this.observer&&this.observer.onDevicesChanged(this.getDevicesDesc(t))},e.prototype.onSelectedDevicesChanged=function(e,t){var n=this.selectedDevices;this.selectedDevices=t;var r="camera"in n^"camera"in this.selectedDevices||"microphone"in n^"microphone"in this.selectedDevices;this.deviceSelectionChanged&&(r||this.deviceSelectionChanged()),this.updateRenderersAsync()},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/ortc/ortcHelper",["require","exports","../constants","../helper","../common/utils"],e)}(function(e,t){function s(e,t){return e.toLowerCase()===t.toLowerCase()}function o(e){return e.enabled?e.send&&e.recv?n.default.MEDIA_STATE.sendReceive:e.send?n.default.MEDIA_STATE.send:e.recv?n.default.MEDIA_STATE.receive:n.default.MEDIA_STATE.inactive:null}function u(e){if(e===n.default.MEDIA_LABEL.audio)return n.default.MEDIA_TYPE.audio;if(e===n.default.MEDIA_LABEL.video)return n.default.MEDIA_TYPE.video;if(e===n.default.MEDIA_LABEL.sharing)return n.default.MEDIA_TYPE.video;throw new Error("unsupported label: "+e)}function a(e,t){return t===n.default.MEDIA_LABEL.audio?e.audio:t===n.default.MEDIA_LABEL.video?e.video:t===n.default.MEDIA_LABEL.sharing?e.sharing:null}function f(e,t,n){var i=a(e,t);return{enabled:!!i,mediaId:n,type:u(t),label:t,send:r.hasSendDirectionality(i),recv:r.hasReceiveDirectionality(i),needsTransport:!1}}function l(e,t){for(var n=0;n<e.length;n++)if(e[n].descr.label===t)return e[n].descr;return{enabled:!1,type:u(t),label:t,send:!1,recv:!1}}function c(e){var t={},r=l(e,n.default.MEDIA_LABEL.audio),i=l(e,n.default.MEDIA_LABEL.video),s=l(e,n.default.MEDIA_LABEL.sharing);return r.enabled&&(t.audio=o(r)),i.enabled&&(t.video=o(i)),s.enabled&&(t.sharing=o(s)),t}function h(e,t){return i.find(t,function(t){if(t.preferredPayloadType===+e)return!0})}function p(e,t){return i.findIndex(t,function(t){if(t.preferredPayloadType===e)return!0})}function d(e,t){return i.find(t,function(t){if(s(t.name,e))return!0})}function v(e,t){return h(e,t).name}function m(e,t){return i.findIndex(e,function(e){if(e.transportId===t)return!0})}function g(e,t){function n(e){return{send:/send:(\S+)/.exec(e)[1].split(","),recv:/recv:(\S+)/.exec(e)[1].split(",")}}var r={send:[],recv:[]},i=n(t);n(e).send.forEach(function(e){i.send.indexOf(e)!==-1&&r.send.push(e)}),n(e).recv.forEach(function(e){i.recv.indexOf(e)!==-1&&r.recv.push(e)});if(!r.send.length&&!r.recv.length)return null;var s="app";return s=r.send.length?s+" send:"+r.send.join(","):s,s=r.recv.length?s+" recv:"+r.recv.join(","):s,s}function y(e,t){var n=[];return e.forEach(function(e){t.forEach(function(t){if(e.type===t.type)if(e.type==="x-message"){var r=g(e.parameter,t.parameter);r&&n.push({type:"x-message",parameter:r})}else e.parameter===t.parameter&&n.push(e)})}),n}function b(e,t,n,r){var o=[];if(e&&t)return e.filter(function(e){return!s(e.name,"rtx")}).forEach(function(e){for(var u=0;u<t.length;u++){var a=t[u];if(s(e.name,a.name)&&s(e.kind,a.kind)&&e.numChannels===a.numChannels&&e.clockRate===a.clockRate){var f=i.shallowClone(r?a:e);f.preferredPayloadType=n?e.preferredPayloadType:a.preferredPayloadType,f.rtcpFeedback=y(e.rtcpFeedback,a.rtcpFeedback),o.push(f);break}}}),e.filter(function(e){return s(e.name,"rtx")}).forEach(function(u){for(var a=0;a<t.length;a++){var f=t[a];if(s(u.name,f.name)&&s(u.kind,f.kind)&&u.numChannels===f.numChannels&&u.clockRate===f.clockRate&&s(v(u.parameters.apt,e),v(f.parameters.apt,t))){var l=i.shallowClone(r?f:u);l.preferredPayloadType=n?u.preferredPayloadType:f.preferredPayloadType,l.parameters.apt=d(h(u.parameters.apt,e).name,o).preferredPayloadType,o.push(l);break}}}),o}function w(e,t){function n(e,t){var n=e.keyParams[0],r=t.keyParams[0];return e.cryptoSuite===t.cryptoSuite&&n.mkiLength===r.mkiLength&&n.mkiValue===r.mkiValue}for(var r=0;r<t.length;++r){var s=t[r];for(var o=0;o<e.length;++o){var u=e[o];if(n(s,u))return{localSdesParams:i.shallowClone(u),remoteSdesParams:i.shallowClone(s)}}}return null}function E(e,t){var n=[];return e&&t&&e.forEach(function(e){for(var r=0;r<t.length;r++){var i=t[r];e.kind===i.kind&&e.uri===i.uri&&n.push(e)}}),n}function S(e,t,n,r){var i=null;return e&&t&&(i={codecs:b(e.codecs,t.codecs,n,r),headerExtensions:E(e.headerExtensions,t.headerExtensions),fecMechanisms:e.fecMechanisms.filter(function(e){return t.fecMechanisms.indexOf(e)!==-1})}),i}function x(e,t,n,r,i,s){return L("",N(e.codecs),C(e.headerExtensions),k(t,s),M(n,"",r,i))}function T(e,t,n,r,i,s){return x(e,t,n,r,i,s)}function N(e){var t=[];return e.forEach(function(e){t.push(A(e.name,e.preferredPayloadType,e.clockRate,e.numChannels,e.rtcpFeedback,e.parameters,e.ptime,e.maxptime))}),t}function C(e){var t=[];return e.forEach(function(e){t.push(O(e.uri,e.preferredId,e.preferredEncrypt))}),t}function k(e,t){var n=[];return n.push(H(e,0,0,t,1)),n}function L(e,t,n,r,i){return{muxId:e||"",codecs:t,headerExtensions:n,encodings:r,rtcp:i,degradationPreference:"balanced"}}function A(e,t,n,r,i,s,o,u){return{name:e,payloadType:t,clockRate:n,numChannels:r,rtcpFeedback:i,parameters:s,ptime:o,maxptime:u}}function O(e,t,n){return{uri:e,id:t,encrypt:n}}function M(e,t,n,r){return{ssrc:e,cname:t,reducedSize:n,mux:r}}function _(e){return e.some(function(e){return s(e.name,"rtx")})}function D(e,t,n,r){return _(e.codecs)?r?t.rtxSsrc:n.rtxSsrc:0}function P(e){return e.groups&&e.groups.length!==0?[{mids:e.groups.join(" "),type:"BUNDLE"}]:null}function H(e,t,n,r,i,s,o,u,a,f,l,c,h,p){return{ssrc:e.min,ssrcRange:e,codecPayloadType:t,fec:n,rtx:r?{ssrc:r}:0,priority:i||1,maxBitrate:s,minQuality:o||0,framerateBias:u||.5,resolutionScale:a||1,framerateScale:f||1,active:c||!0,encodingId:h,dependencyEncodingId:p}}var n=e("../constants"),r=e("../helper"),i=e("../common/utils");Object.defineProperty(t,"__esModule",{value:!0}),t.default={groupsToSdp:P,getStateFromDescr:o,getDescrFromState:f,getCodecIndexByPayload:p,getTransportIndexById:m,findDescrFromMedia:l,getModalitiesFromMedia:c,findMatchingSdesParams:w,matchXMessage:g,matchRtpCaps:S,matchRtcpFeedback:y,getSendParams:x,getRecvParams:T,RTCRtpCodecParameters:A,RTCRtpHeaderExtensionParameters:O,RTCRtcpParameters:M,hasRtx:_,getRtxSsrc:D,RTCRtpEncodingParameters:H,getCodecByName:d}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/ortc/ortcTransport",["require","exports","../constants","../common/utils","./ortcHelper","../common/settablePromise"],e)}(function(e,t){function o(e,t,r,i,o,u,a){var f=this,l=new s.SettablePromise,c,h;this.nominatedCandidatePair=null,t.log("create RTCIceGatherer","options:",JSON.stringify(o.iceGathererOptions)),u?this.iceGatherer=u.createAssociatedGatherer():this.iceGatherer=new RTCIceGatherer(o.iceGathererOptions),t.log("create RTCIceTransport"),a?this.iceTransport=a.createAssociatedTransport():this.iceTransport=new RTCIceTransport,this.getLocalCandidatesAsync=function(){return l.promise},this.start=function(e,n){if(h)throw new Error("icetransport already started!");h=!0,c=r.createCb(o.iceRole),t.log("RTCIceTransport setRemoteCandidates","candidates:",JSON.stringify(e)),f.iceTransport.setRemoteCandidates(e),t.log("RTCIceTransport start","remoteIceParams:",JSON.stringify(n),"role:",o.iceRole),f.iceTransport.start(f.iceGatherer,n,o.iceRole),t.log("RTCIceTransport start","role:",f.iceTransport.role)},this.dispose=function(){t.log("dispose"),f.iceTransport.stop(),f.iceTransport=null,f.iceGatherer=null,l.isPending&&l.reject(new Error("operation canceled due to stop")),c&&c.dispose()},this.iceGatherer.onlocalcandidate=function(e){t.log("RTCIceGatherer.onlocalcandidate","candidate:",JSON.stringify(e.candidate)),Object.keys(e.candidate).length===0&&l.resolve()},this.iceGatherer.onerror=function(e){t.error("RTCIceGatherer.onerror","event:",e),l.reject(new Error("IceGatherer failed!"))},this.iceTransport.onicestatechange=function(){f.iceTransport&&(t.log("RTCIceTransport.onicestatechange","state:",f.iceTransport.state),f.iceTransport.state==="completed"?(t.log("pair:",JSON.stringify(f.iceTransport.getNominatedCandidatePair())),f.nominatedCandidatePair=f.iceTransport.getNominatedCandidatePair(),c.iceCompleted(),i.onConnected(e)):f.iceTransport.state==="connected"?i.onConnected(e):f.iceTransport.state==="disconnected"&&(t.error("audio ICE transport disconnected, ending call!"),i.onError({type:n.default.MEDIA_ERROR.iceConnectionError,detail:"ice transport disconnected"},e)))},this.iceTransport.oncandidatepairchange=function(e){t.log("RTCIceTransport.oncandidatepairchange","event:",e)}}function u(e,t,r,i){var s=this,o=!1;this.dtlsTransport=new RTCDtlsTransport(r),this.dtlsTransport.ondtlsstatechange=function(){t.log("RTCDtlsTransport.ondtlsstatechange","state:",event.state,"role:",s.dtlsTransport?s.dtlsTransport.getLocalParameters().role:"")},this.dtlsTransport.onerror=function(r){t.error("RTCDtlsTransport.onerror","event:",r),i.onError({type:n.default.MEDIA_ERROR.srtpError,detail:r},e)},this.startAsync=function(e){if(o)throw new Error("dtlstransport already started!");return o=!0,t.log("RTCDtlsTransport.start","params:",JSON.stringify(e)),s.dtlsTransport.start(e),Promise.resolve()},this.dispose=function(){o&&s.dtlsTransport.stop(),s.dtlsTransport=null}}function f(e,t,r,i,s,f,l){function g(e){var t=e;if(s.iceCandidateType||s.iceCandidateTransport)t=t.filter(function(e){var t=!0,n=!0;return s.iceCandidateType&&(t=e.type.match(new RegExp(s.iceCandidateType),"i")),s.iceCandidateTransport&&(n=e.protocol.match(new RegExp(s.iceCandidateTransport,"i"))),t&&n});return s.iceGathererOptions.gatherPolicy===n.default.ICE_TRANSPORT_POLICY.relay&&t.forEach(function(e){e.relatedAddress=e.ip,e.relatedPort=e.port}),t}function y(){return{transportId:v.transportId,iceParams:c.iceGatherer.getLocalParameters(),iceCandidates:g(c.iceGatherer.getLocalCandidates()),iceCandidatePair:c.nominatedCandidatePair,sdesParamsList:l,dtlsParams:p?p.dtlsTransport.getLocalParameters():null,rtcpIceParams:h?h.iceGatherer.getLocalParameters():null,rtcpIceCandidates:h?g(h.iceGatherer.getLocalCandidates()):null,rtcpIceCandidatePair:h?h.nominatedCandidatePair:null}}var c,h,p,d,v=this,m=!1;this.transportId=a++,c=new o(this.transportId,t.createChild("IceT"),r,i,s),p=new u(this.transportId,t.createChild("DtlsT"),c.iceTransport,i),f&&(h=new o(this.transportId,t.createChild("RtcpIceT"),r,i,s,c.iceGatherer,c.iceTransport)),Object.defineProperty(this,"transport",{get:function(){return!e.disableSdes&&d?d:p?p.dtlsTransport:null}}),this.isStarted=function(){return m},this.getLocalParamsAsync=function(){var e;return h?e=Promise.all([c.getLocalCandidatesAsync(),h.getLocalCandidatesAsync()]):e=c.getLocalCandidatesAsync(),e.then(function(){return y()})},this.startAsync=function(e){if(m)throw new Error("mediaTransport already started!");var r=Promise.resolve();return m=!0,c.start(e.iceCandidates,e.iceParams),h&&(e.doRtcpMux?(h.dispose(),h=null):h.start(e.rtcpIceCandidates,e.rtcpIceParams)),e.enableDtls?r=p.startAsync(e.dtlsParams):d||(t.debug("RTCSrtpSdesTransport","local:",JSON.stringify(e.sdesParamsList[0]),"remote:",JSON.stringify(e.remoteSdesParams)),d=new RTCSrtpSdesTransport(c.iceTransport,e.sdesParamsList[0],e.remoteSdesParams),d.onerror=function(e){t.log("RTCSrtpSdesTransport.onerror","event:",e),i.onError({type:n.default.MEDIA_ERROR.srtpError,detail:e},v.transportId)}),r},this.dispose=function(){t.log("dispose"),c.dispose(),c=null,h&&(h.dispose(),h=null),p&&(p.dispose(),p=null)}}function l(e,t){function a(s){this.dispose=function(){r.remove(n,function(e){return e===this})},this.gotCallback=!1,this.iceCompleted=function(){this.gotCallback=!0,this.gotCallbackFromControlling=s==="controlling";var r=0,a=0;for(var f=0;f<n.length;f++)n[f].gotCallback&&r++,n[f].gotCallbackFromControlling&&a++;a&&a===u&&!i&&(e.log("IceCompletionMonitor REINVITE"),i=!0,t.triggerIceReinvite()),r&&r===n.length&&(e.log("IceCompletionMonitor ALL COMPLETE"),o.resolve())}}var n=[],i=!1,o=new s.SettablePromise,u=0;this.createCb=function(e){var t=new a(e);return n.push(t),e==="controlling"&&(i=!1,u++),o.reject(undefined),o=new s.SettablePromise,t},this.waitAllCallbacksAsync=function(){return o.promise}}function c(e,t,r,s,o,u){function m(e){return e.cryptoSuite!=="SCALE_AES_CM_128_HMAC_SHA1_80"}function g(){if(!d){if(!a.relayManagerProvider)throw new Error("relay manager provider is not set!");d=a.relayManagerProvider.getRelayManager().queryRelaysAsync("msturn",s)}return d}function y(e){return e.reduce(function(e,t){return t.addresses.map(function(n){e.push({urls:t.type+":"+n+":"+t.udpPort+"?transport=udp",credential:t.password,username:t.username}),e.push({urls:t.type+":"+n+":"+t.tcpPort+"?transport=tcp",credential:t.password,username:t.username})}),e},[])}function b(e,t){return t===0?{min:e.audioMin,max:e.audioMax}:{min:e.videoMin,max:e.videoMax}}function w(e,t){return e.find(function(e){return e.transportId===t})}var a=this,c=[],h=!1,o=o?o:n.default.ICE_TRANSPORT_POLICY.all,p=new l(e,r),d,v=null;this.relayManagerProvider=null,t.disableSdes||(v=RTCSrtpSdesTransport.getLocalParameters().filter(m)),this.getTransportById=function(e){return c[i.default.getTransportIndexById(c,e)]},this.assureInitAsync=function(n,i){return new Promise(function(s){e.log("assureInitAsync",i);var a=g().then(function(s){var a={iceRole:n,iceCandidateType:t.iceCandidateType,iceCandidateTransport:t.iceCandidateTransport,iceGathererOptions:{gatherPolicy:o,iceServers:y(s)}};for(var l=c.length;l<i;l++){e.log("assureInitAsync "+l+a.iceRole),t.mediaPortRanges&&(a.iceGathererOptions.portRange=b(t.mediaPortRanges,l));var h={onError:r.onError,onConnected:r.onConnected},d=new f(t,e.createChild("MT"+l),p,h,a,u,v);c.push(d)}});s(a)})},this.getLocalParamsAsync=function(){return e.log("getLocalParamsAsync"),new Promise(function(e){var t=c.map(function(e){return e.getLocalParamsAsync()});e(Promise.all(t))})},this.hasIceCandidates=function(e){return e.some(function(e){return!!e.iceCandidates&&e.iceCandidates.length>0})},this.hasRelayIceCandidates=function(e){return this.hasIceCandidates(e)&&e.some(function(e){return!!e.iceCandidates&&e.iceCandidates.some(function(e){return e.type==="relay"})})},this.waitIceCompletionIfNeededAsync=function(t){return new Promise(function(n){var r="";if(t[0]&&t[0].iceCandidatePair||t[1]&&t[1].iceCandidatePair)e.log("waiting ICE completed state!"),r=p.waitAllCallbacksAsync();n(r)})},this.configureTransportAsync=function(e,t){return new Promise(function(n){var r=[],i=e.transportParams;c=c.filter(function(e){return t.findIndex(function(t){return t===e.transportId})!==-1?(e.isStarted()||r.push(e.startAsync(w(i,e.transportId))),!0):(e.dispose(),!1)}),n(Promise.all(r))})},this.stop=function(){c.forEach(function(e){e.dispose()}),c=[]}}var n=e("../constants"),r=e("../common/utils"),i=e("./ortcHelper"),s=e("../common/settablePromise"),a=0;Object.defineProperty(t,"__esModule",{value:!0}),t.default=c}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/ortc/ortcConstants",["require","exports"],e)}(function(e,t){var n;(function(e){e[e.SSRC_UPDATED=0]="SSRC_UPDATED",e[e.CODEC_PARAMS_UPDATED=1]="CODEC_PARAMS_UPDATED"})(n=t.VideoCapabilitiesEventType||(t.VideoCapabilitiesEventType={}));var r;(function(e){e[e.Audio=0]="Audio",e[e.Video=1]="Video"})(r=t.MediaChannelType||(t.MediaChannelType={}))});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/async",["require","exports"],e)})(function(e,t){function n(e){return new Promise(function(t){t(e())})}function s(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e}function o(e,t){t===void 0&&(t="deferred timed out after "+e+"ms");var n={},s=new i(function(){return n.reject(new r(t))});return n.promise=new Promise(function(e,t){n.resolve=function(t){s.stop(),e(t)},n.reject=function(e){s.stop(),t(e)}}),s.start(e),n}function u(e){return new Promise(function(t){return setTimeout(t,e)})}function a(e,t,n){var r=new Promise(function(e,r){setTimeout(r.bind(null,new Error("Promise timed out"+(n?": "+n:"")+" after "+t+"ms")),t)});return Promise.race([e,r])}t.asap=n;var r=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return __extends(t,e),t}(Error);t.TimeoutError=r;var i=function(){function e(e){this.ontimeout=e}return e.prototype.start=function(e){this.timeoutId!==undefined&&this.stop(),this.timeoutId=setTimeout(this.ontimeout,e)},e.prototype.stop=function(){clearTimeout(this.timeoutId),this.timeoutId=undefined},e}();t.Timer=i,t.defer=s,t.timedDefer=o,t.delay=u,t.timeout=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/ortc/ortcChannelStats",["require","exports","../async","../common/utils"],e)}(function(e,t){function i(e,t,i,s){function u(){if(!t)return"CheckNotCompleted";var e=t.state;return e==="new"||e==="checking"||e==="connected"?"CheckNotCompleted":e==="completed"?"CheckSucceed":e==="failed"||e==="closed"?"CheckFailed":e==="disconnected"?"MediaTimeout":"Unknown DiagnosticReason"}var o=e.logger.createChild("ChannelStats");this.getReport=function(){function a(t,i,s){if(!t)return;var u=i+"."+(s?"msGetStats":"getStats"),a=(new Promise(function(e){o.log(u,"start"),e(s?t.msGetStats():t.getStats())})).then(function(t){o.log(u,"complete"),e[i]=e[i]||{},r.forOwn(t,function(t){e[i][t.type||t.msType]=t})}).catch(function(e){o.warn(u,"failed:",e)});return n.timeout(a,5e3,u).catch(function(e){o.warn(u,"failed:",e)})}var e={};return e.extended={mediaDiagnostic:{reason:u()}},new Promise(function(n){Promise.all([a(t,"iceTransport",!1),a(t,"iceTransport",!0),a(i,"sender",!1),a(i,"sender",!0),a(s,"receiver",!1),a(s,"receiver",!0)]).then(function(){n(e)}).catch(function(t){o.error("getting statistics should never fail",t),n(e)})})}}var n=e("../async"),r=e("../common/utils");Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e,t,n,r){return new i(e,t,n,r)}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/dtmfUtils",["require","exports"],e)}(function(e,t){t.defaultSettings={toneDuration:200,toneGap:100};var n=function(){function e(e){this.queue=[],this.logger=e}return e.prototype.cleanup=function(){this.queue.forEach(function(e){e.reject({notSent:e.tones})}),this.queue=[]},e.prototype.waitForNotification=function(e){var t=this;return e?(this.logger.log("sending dtmf tones: ",e),new Promise(function(n,r){t.queue.push({tones:e,resolve:n,reject:r})})):Promise.reject(new Error("invalid input"))},e.prototype.toneSent=function(e){this.queue[0]&&(e===this.queue[0].tones[0]?(this.queue[0].tones=this.queue[0].tones.substr(1),this.queue[0].tones===""&&(this.queue[0].resolve(),this.queue.shift())):(this.queue[0].reject(new Error("sent tone does not match: expected '"+this.queue[0].tones[0]+"' got '"+e+"'")),this.queue.shift(),this.toneSent(e)))},e}();t.DTMFQueue=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/ortc/ortcDtmfSender",["require","exports","../common/dtmfUtils"],e)}(function(e,t){var n=e("../common/dtmfUtils"),r=function(){function e(e,t){this.queue=new n.DTMFQueue(e),this.settings=t?t:n.defaultSettings}return e.prototype.sendDtmf=function(e,t){return e?(this.syncSender(e),this.ortcSender.canInsertDTMF?(this.ortcSender.insertDTMF(this.ortcSender.toneBuffer+t,this.settings.toneDuration,this.settings.toneGap),this.queue.waitForNotification(t)):Promise.reject(new Error("not available"))):Promise.reject(new Error("bad sender"))},e.prototype.canSendDtmf=function(e){return e?(this.syncSender(e),this.ortcSender?this.ortcSender.canInsertDTMF:!1):!1},e.prototype.dispose=function(){this.queue.cleanup()},e.prototype.syncSender=function(e){if(!this.ortcSender||this.ortcSender.sender!==e)this.ortcSender&&(this.ortcSender.ontonechange=null,this.queue.cleanup(),this.ortcSender=null),this.ortcSender=new RTCDtmfSender(e),this.ortcSender.ontonechange=this.onToneChange.bind(this)},e.prototype.onToneChange=function(e){e.tone&&this.queue.toneSent(e.tone)},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/videoCapabilities",["require","exports"],e)}(function(e,t){var n=function(){function e(e,t){this.maxFS=e,this.maxFPS=t}return e.prototype.setMaxFS=function(e,t){if(this.maxFS!==e){this.maxFS=e;if(t)return t(this),!0}return!1},e.prototype.getMaxFS=function(){return this.maxFS},e.prototype.getMaxFPS=function(){return this.maxFPS},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/ortc/ortcMediaChannel",["require","exports","./ortcHelper","../constants","./ortcConstants","./ortcChannelStats","../common/utils","./ortcDtmfSender","../common/videoCapabilities","../common/resolutionTable"],e)}(function(e,t){var n=e("./ortcHelper"),r=e("../constants"),i=e("./ortcConstants"),s=e("./ortcChannelStats"),o=e("../common/utils"),u=e("./ortcDtmfSender"),a=e("../common/videoCapabilities"),f=e("../common/resolutionTable"),l="h264",c="opus",h="vp8",p="rtx",d=1200,v=3e3,m=function(){function e(e,t,n,i,s,o,l,c){this.contributingSourcesPollingInterval=1e3,this.doMute=!1,this.sendActive=!1,this.recvActive=!1,this.lastSources=[],this.resolutionTable=new f.default,this.maintainResolution=!1,this.subscribedMsi=r.default.MSI.unsubscribe,this.isSsrcUpdated=!1,this.channelId=e,this.logger=t,this.settings=n,this.channelType=i,this.label=s,this.observer=o,this.ssrcGenerator=l,this.maintainResolution=c;var h=this.settings.ortcVideoCapabilityMaxFS||d,p=this.settings.ortcVideoCapabilityMaxFPS||v;this.videoCapabilities=new a.default(h,p),this.dtmfSender=new u.default(this.logger,this.settings.dtmf),this.ssrcRange=this.generateSsrcRange()}return e.prototype.setTransportId=function(e){this.transportId=e},e.prototype.getTransportId=function(){return this.transportId},e.prototype.getLabel=function(){return this.label},e.prototype.getType=function(){return this.channelType},e.prototype.getSubscrbedMsi=function(){return this.subscribedMsi},e.prototype.getMediaParameters=function(){return this.mediaParams},e.prototype.getLocalParameters=function(){var e=o.deepClone(this.getLocalRtpCaps());this.updateCodecParameters(e);var t={rtpCaps:e,rtxSsrc:this.getRtxSsrc(this.ssrcRange),ssrcRange:this.ssrcRange};return{sender:t,receiver:o.deepClone(t)}},e.prototype.configureChannel=function(e,t,n){this.logger.log("configureChannel","type:",this.channelType,"descr:",JSON.stringify(e.descr)),this.mediaParams=e,e.descr.enabled?(this.configureSsrc(e.receiver,e.sender),this.configureReceiver(e.descr,e.receiver,t),this.configureSender(e.descr,e.sender,t,n)):this.disable()},e.prototype.updateLocalMediaStream=function(e){this.rtpSender&&this.replaceMediaStreamIfDifferent(e)},e.prototype.canSubscribe=function(){return this.recvActive&&this.rtpReceiver&&this.subscribedMsi===r.default.MSI.unsubscribe&&this.isVideo()},e.prototype.subscribe=function(e){if(this.subscribedMsi===r.default.MSI.unsubscribe&&this.isVideo())return this.subscribedMsi=e,this.requestSendCsrc(this.subscribedMsi);throw new Error("invalid call for subscribe:"+this.subscribedMsi+"type:"+this.channelType)},e.prototype.unsubscribe=function(){if(this.subscribedMsi===r.default.MSI.unsubscribe||!this.isVideo())throw new Error("invalid call for unsubscribe:"+this.subscribedMsi+"type:"+this.channelType);this.subscribedMsi=r.default.MSI.unsubscribe,this.requestSendCsrc(this.subscribedMsi)},e.prototype.getReportsAsync=function(){var e=this.recvActive?this.rtpReceiver:null,t=this.sendActive?this.rtpSender:null,n=e?e.transport.transport:t?t.transport.transport:null,r=s.default.build({logger:this.logger},n,t,e);return r.getReport()},e.prototype.getSendTrack=function(){return this.sendActive&&this.rtpSender?this.rtpSender.track:null},e.prototype.getRecvTrack=function(){return this.recvActive&&this.rtpReceiver?this.recvTrack:null},e.prototype.terminate=function(){this.disable(),this.logger.log("terminated")},e.prototype.sendDtmf=function(e){return this.dtmfSender.sendDtmf(this.rtpSender,e)},e.prototype.canSendDtmf=function(){return this.dtmfSender.canSendDtmf(this.rtpSender)},e.prototype.videoSizeChanged=function(e,t){var n=this,r=this.resolutionTable.getMaxFS(e,t);if(!this.videoCapabilities){this.logger.error("no capabilities for provided modality:",self);return}this.videoCapabilities.setMaxFS(r,function(e){var t=n.mediaParams.receiver.rtpCaps.codecs[0];t.name.toLowerCase()===l&&n.observer.onMediaCapabilitiesChanged(i.VideoCapabilitiesEventType.CODEC_PARAMS_UPDATED,{mediaId:n.channelId,codecName:t.name,capabilities:{"max-fs":e.getMaxFS(),"max-fps":e.getMaxFPS()}})})},e.prototype.setMute=function(e){this.doMute=e,this.currMediaStreamRef&&this.currMediaStreamRef.setMute(e)},e.prototype.preconfigureChannel=function(e){if(!e)return;this.logger.debug("Preconfigure with remote ssrc:",e.remoteSsrcRange),this.logger.debug("Preconfigure label",this.label,"to",e.label),this.label=e.label;var t=this.rtpReceiver&&this.hasSsrcChanged(e.remoteSsrcRange,this.recvRemoteSsrc),n=this.rtpSender&&this.hasSsrcChanged(e.remoteSsrcRange,this.sendRemoteSsrc);if(!t&&!n)return;this.isSsrcUpdated=!0,this.updateSsrcRange()},e.prototype.getLocalRtpCaps=function(){return this.localRtpCaps||(this.localRtpCaps=this.gatherLocalRtpCaps()),this.localRtpCaps},e.prototype.gatherLocalRtpCaps=function(){var e=this,t=this.typeToString(this.channelType),n=RTCRtpReceiver.getCapabilities(t);if(!n.codecs)return n;if(this.channelType===i.MediaChannelType.Audio&&this.settings.audioCodec){var r=["cn","red"];o.remove(n.codecs,function(t){var n=t.name.toLowerCase();return n!==e.settings.audioCodec.toLowerCase()&&r.indexOf(n)===-1})}else this.channelType===i.MediaChannelType.Video&&this.settings.videoCodec&&o.remove(n.codecs,function(t){return t.name.toLowerCase()!==e.settings.videoCodec.toLowerCase()});if(this.channelType===i.MediaChannelType.Audio)for(var s=n.codecs.length-1;s>=0;s--)n.codecs[s].name.toLowerCase()===c&&(n.codecs[s].preferredPayloadType=111,this.logger.log("Opus payloadType fix, change payload type to 111 for",n.codecs[s].name));if(this.channelType===i.MediaChannelType.Video){var u=o.find(n.codecs,function(e){return e.name.toLowerCase()===h});u&&o.remove(n.codecs,function(e){return e.name.toLowerCase()===h||e.name.toLowerCase()===p&&u.preferredPayloadType===+e.parameters.apt})}return n},e.prototype.getRtxSsrc=function(e){var t=this.getLocalRtpCaps();return n.default.hasRtx(t.codecs)?this.ssrcRange.min+50:0},e.prototype.replaceMediaStreamIfDifferent=function(e){var t,n;this.isAudio()?(n=this.currMediaStreamRef.getObject().getAudioTracks()[0],t=e.getObject().getAudioTracks()):(n=this.currMediaStreamRef.getObject().getVideoTracks()[0],t=e.getObject().getVideoTracks());var r=t.length?t[0]:null;if(r===null){this.logger.error("media track is not available");return}var i=n.getSettings().deviceId,s=r.getSettings().deviceId;if(i!==s){this.logger.log("replacing media track","currDevID:",i,"newDevID:",s,"currTrackID:",n.id,"newTrackID:",r.id);var o=e.clone();o.setMute(this.doMute),this.isAudio()?this.rtpSender.setTrack(o.getObject().getAudioTracks()[0]):this.rtpSender.setTrack(o.getObject().getVideoTracks()[0]),this.currMediaStreamRef.dispose(),this.currMediaStreamRef=o}else this.logger.log("NOT replacing media track","currDevID:",i,"newDevID:",s,"currTrackID:",n.id,"newTrackID:",r.id)},e.prototype.isAudio=function(){return this.channelType===i.MediaChannelType.Audio},e.prototype.isVideo=function(){return this.channelType===i.MediaChannelType.Video},e.prototype.updateContributingSources=function(){var e=this;if(this.recvActive&&this.rtpReceiver){var t=void 0;try{t=this.rtpReceiver.getContributingSources()}catch(n){this.logger.error("failed to retrieve contributing sources from receiver","error:",n);return}if(!t){this.logger.warn("could not retrieve contributing sources from receiver");return}var r=t.map(function(e){return e.csrc}),i=this.lastSources.length===r.length&&r.every(function(t,n){return t===e.lastSources[n]});i||(this.logger.debug("contributing sources changed","sources:",r),this.observer.onContributingSourcesChanged(r)),this.lastSources=r,setTimeout(this.updateContributingSources.bind(this),this.contributingSourcesPollingInterval)}else this.logger.debug("receiver is missing, stop polling for contributing sources")},e.prototype.requestSendCsrc=function(e){if(this.recvActive&&this.rtpReceiver){this.logger.log("_requestSendCsrc","csrc:",e);try{this.rtpReceiver.requestSendCSRC(e)}catch(t){this.logger.error("failed to request send csrc","error:",t)}return!0}return!1},e.prototype.createReceiver=function(e,t){var n=this;this.logger.log("_rtpReceiver create");var i=this.typeToString(this.channelType);this.rtpReceiver=new RTCRtpReceiver(e.transport,i),this.recvTrack=this.rtpReceiver.track,this.rtpReceiver.onerror=function(e){n.logger.error("_rtpReceiver.onerror","event:",e),n.observer.onError({type:r.default.MEDIA_ERROR.internalError,detail:e})}},e.prototype.createSender=function(e,t,n){var i=this,s;this.isAudio()?s=t.getObject().getAudioTracks()[0]:s=t.getObject().getVideoTracks()[0],this.logger.log("this.rtpSender create trackID:",s.id),this.rtpSender=new RTCRtpSender(s,e.transport),this.rtpSender.onerror=function(e){i.logger.error("this.rtpSender.onerror","event:",e),i.observer.onError({type:r.default.MEDIA_ERROR.internalError,detail:e})},this.rtpSender.onssrcconflict=function(e){i.logger.error("this.rtpSender.onssrcconflict","event:",e)}},e.prototype.getRecvParams=function(e){var t=n.default.getRecvParams(e.rtpCaps,e.remoteSsrcRange,this.ssrcRange.min,e.rtcpReducedSize,e.rtcpMux,e.rtxSsrc);return this.maintainResolution&&(t.degradationPreference="maintain-resolution"),t.encodings[0].active=this.recvActive,t},e.prototype.getSendParams=function(e){var t=n.default.getSendParams(e.rtpCaps,this.ssrcRange,e.remoteSsrcRange.min,e.rtcpReducedSize,e.rtcpMux,e.rtxSsrc);return t.encodings[0].active=this.sendActive,t},e.prototype.configureSsrc=function(e,t){var n=this.rtpReceiver&&this.hasSsrcChanged(e.remoteSsrcRange,this.recvRemoteSsrc)||this.rtpSender&&this.hasSsrcChanged(t.remoteSsrcRange,this.sendRemoteSsrc);if(!n||this.isSsrcUpdated){this.isSsrcUpdated=!1;return}this.updateSsrcRange()},e.prototype.updateSsrcRange=function(){var e=this.generateSsrcRange();this.logger.debug("SSRC updating: ",this.ssrcRange," -> ",e),this.ssrcRange=e,this.observer.onMediaCapabilitiesChanged(i.VideoCapabilitiesEventType.SSRC_UPDATED,{mediaId:this.channelId,ssrcRange:this.ssrcRange,rtxSsrc:this.getRtxSsrc(this.ssrcRange)})},e.prototype.configureReceiver=function(e,t,n){this.rtpReceiver&&this.hasSsrcChanged(t.remoteSsrcRange,this.recvRemoteSsrc)&&(this.logger.log("SSRC changed, resetting receiver"),this.stopReceiver()),this.rtpReceiver||(this.createReceiver(n,t),this.recvRemoteSsrc=t.remoteSsrcRange),this.recvActive=!!e.recv;var i=this.getRecvParams(t);this.logger.debug("rtpReceiver.receive:",JSON.stringify(i)),this.rtpReceiver.receive(i),this.recvActive&&(this.isAudio()?this.updateContributingSources():this.subscribedMsi!==r.default.MSI.unsubscribe&&this.requestSendCsrc(this.subscribedMsi))},e.prototype.stopReceiver=function(){this.rtpReceiver&&(this.logger.log("_rtpReceiver stop & destroy"),this.recvActive=!1,this.recvTrack=null,this.rtpReceiver.stop(),this.rtpReceiver=null)},e.prototype.configureSender=function(e,t,n,r){this.rtpSender&&this.hasSsrcChanged(t.remoteSsrcRange,this.sendRemoteSsrc)&&(this.logger.log("SSRC changed, resetting sender"),this.stopSender()),this.sendActive=!!e.send;if(this.sendActive&&r){this.currMediaStreamRef?this.replaceMediaStreamIfDifferent(r):(this.currMediaStreamRef=r.clone(),this.currMediaStreamRef.setMute(this.doMute)),this.rtpSender||(this.createSender(n,this.currMediaStreamRef,t),this.sendRemoteSsrc=t.remoteSsrcRange);var i=this.getSendParams(t);this.logger.debug("this.rtpSender.send:",JSON.stringify(i)),this.rtpSender.send(i)}else this.stopSender(),this.disposeLocalStream()},e.prototype.stopSender=function(){this.dtmfSender&&(this.dtmfSender.dispose(),this.dtmfSender=null),this.rtpSender&&(this.logger.log("this.rtpSender stop & destroy"),this.sendActive=!1,this.rtpSender.stop(),this.rtpSender=null)},e.prototype.disposeLocalStream=function(){this.currMediaStreamRef&&(this.currMediaStreamRef.dispose(),this.currMediaStreamRef=null)},e.prototype.hasSsrcChanged=function(e,t){return t&&e&&!o.deepEqual(e,t)},e.prototype.updateCodecParameters=function(e){var t=o.find(e.codecs,function(e){return e.name.toLowerCase()===l});t&&t.parameters&&(t.parameters["max-fs"]=this.videoCapabilities.getMaxFS(),t.parameters["max-fps"]=this.videoCapabilities.getMaxFPS())},e.prototype.disable=function(){this.stopReceiver(),this.stopSender(),this.disposeLocalStream()},e.prototype.generateSsrcRange=function(){return this.channelType===i.MediaChannelType.Audio?this.ssrcGenerator.nextAudioStreamSsrc():this.channelType===i.MediaChannelType.Video?this.ssrcGenerator.nextVideoStreamSsrc():null},e.prototype.typeToString=function(e){return i.MediaChannelType[e].toLowerCase()},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=m}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/ortc/ortcNegotiation",["require","exports","./ortcHelper","../constants","./ortcConstants","../common/utils"],e)}(function(e,t){function o(e,t,o){function h(e,n){return n||t.ortcPreferBundling||e&&e.bundledOnly?e&&e.groups&&e.groups.length>0:c}function p(t){a=t,e.debug("PROCESS OFFER","params:",JSON.stringify(a))}function d(e,t){var n=t.descr;n||(n={enabled:!0,send:!0,recv:!0});var r=e.send&&e.enabled&&n.recv&&n.enabled,i=e.recv&&e.enabled&&n.send&&n.enabled,s=e.enabled&&n.enabled&&(r||i||!e.send&&!e.recv||!n.send&&!n.recv),o=t.receiver.ssrcRange;return{enabled:s,mediaId:e.mediaId,mid:n.mid||null,type:e.type,transportId:e.transportId,needsTransport:e.needsTransport,label:e.label,send:r,recv:i,remoteSsrcRange:o}}function v(e){if(l&&l.media.length>a.media.length)throw new Error("Invalid remote offer - removed media lines");var t=[],i,s=!1,o=!1,f=0;c=h(a,!1);for(var p=0;p<a.media.length;p++){if(l&&l.media[p]){if(l.media[p].type!==a.media[p].type)throw new Error("Changing media type not supported");if(l.media[p].label&&a.media[p].label&&l.media[p].label!==a.media[p].label)throw new Error("Changing media label not supported")}a.media[p].descr.label===r.default.MEDIA_LABEL.audio&&!s?(i=d(n.default.getDescrFromState(e,r.default.MEDIA_LABEL.audio,p),a.media[p]),i.needsTransport=!0,t.push(i),s=!0):a.media[p].descr.label===r.default.MEDIA_LABEL.video&&f<u?(i=d(n.default.getDescrFromState(e,r.default.MEDIA_LABEL.video,p),a.media[p]),i.needsTransport=!0,f>0&&(i.send=!1,i.needsTransport=!1),t.push(i),f++):a.media[p].descr.label===r.default.MEDIA_LABEL.sharing&&!o?(i=d(n.default.getDescrFromState(e,r.default.MEDIA_LABEL.sharing,p),a.media[p]),i.needsTransport=!0,t.push(i),o=!0):t.push({enabled:!1,type:a.media[p].descr.type,label:l&&l.media[p]?l.media[p].descr.label:a.media[p].descr.label})}if(c){var v=!1;t.forEach(function(e){!v&&e.needsTransport?v=!0:e.needsTransport=!1})}return t}function m(e,r,i){for(var s=0;s<e.length;s++){e[s]&&(e[s].doRtcpMux=r[s]&&!r[s].doRtcpMux?!1:!0);if(e[s]&&r[s]){var o=!1;for(var u=0;!t.disableSdes&&u<r.length;u++)r[u]&&r[u].sdesParamsList&&r[u].sdesParamsList.length&&(o=!0);r[s].doRtcpMux&&(e[s].rtcpIceParams=null,e[s].rtcpIceCandidates=null),e[s].dtlsParams&&r[s].dtlsParams&&(e[s].dtlsParams.role=r[s].dtlsParams.role==="client"?"server":"client");if(o||!r[s].dtlsParams)e[s].dtlsParams=null;o||(e[s].sdesParamsList=[]);var a=null;e[s].sdesParamsList&&r[s].sdesParamsList&&(a=n.default.findMatchingSdesParams(e[s].sdesParamsList,r[s].sdesParamsList),a&&(a.localSdesParams.tag=a.remoteSdesParams.tag,e[s].sdesParamsList=[a.localSdesParams],e[s].remoteSdesParams=a.remoteSdesParams))}else e[s]&&e[s].dtlsParams&&(e[s].dtlsParams.role=null)}return e}function g(e,t,r,i){var s=i?e.sender:e.receiver,o=i?t.receiver:t.sender,u=n.default.matchRtpCaps(s.rtpCaps,o.rtpCaps,r,i);return{mid:r?s.mid:o.mid,transportId:s.transportId,ssrcRange:s.ssrcRange,remoteSsrcRange:o.ssrcRange,rtxSsrc:n.default.getRtxSsrc(u,s,o,i),rtpCaps:u}}function y(e,t,n,r,i){if(!e.enabled)return{descr:e};var s=t;return s.sender.rtcpReducedSize=i,s.receiver.rtcpReducedSize=i,s.descr=e,s.justAdded=n,s.bundledWithOther=r,s}function b(t,n,i,o){var u={isOffer:!1,sessionVersion:a.sessionVersion,transportParams:m(n,a.transportParams,!1),media:[],bundled:c,groups:[]},l=!1,h=!1,p,d=0,v=0;for(var b=0;b<t.length;b++){var w=h&&t[b].label===r.default.MEDIA_LABEL.video||l&&u.bundled,E={},S=s.shallowClone(t[b]);if(S.enabled){l=!0;var T=g(i[b],a.media[b],!1,!1),N=g(i[b],a.media[b],!1,!0);E.receiver=T,E.sender=N,p=S.needsTransport?n[d]:n[v],S.transportId=p.transportId,S.needsTransport&&(v=d,d++),S.label===r.default.MEDIA_LABEL.video&&(S.firstVideoChannel=!h,h=!0);if(!x(S,p,E.receiver)||!x(S,p,E.sender))S.enabled=!1,e.warn("Rejecting media since unable to match parameters")}u.media.push(y(S,E,!1,w,a.media[b].receiver.rtcpReducedSize))}e.debug(o?"CREATE PRANSWER":"CREATE ANSWER","params:",JSON.stringify(u)),o||(f=C(u,a,!1));var k=[];return u.media.forEach(function(e){c&&e.descr.enabled&&e.descr.mid&&k.push(e.descr.mid)}),u.groups=k,u}function w(e){var t=[],i=!1,s=!1,a=0,f=0;if(l)for(var h=0;h<l.media.length;h++){var p=void 0;l.media[h].descr.label===r.default.MEDIA_LABEL.audio&&!i?(p=n.default.getDescrFromState(e,r.default.MEDIA_LABEL.audio,f++),p.needsTransport=!0,i=!0):l.media[h].descr.label===r.default.MEDIA_LABEL.video&&a<u?(p=n.default.getDescrFromState(e,r.default.MEDIA_LABEL.video,f++),p.needsTransport=!0,a>0&&(p.send=!1,p.needsTransport=!1),a++):l.media[h].descr.label===r.default.MEDIA_LABEL.sharing&&!s?(p=n.default.getDescrFromState(e,r.default.MEDIA_LABEL.sharing,f++),p.needsTransport=!0,s=!0):p={enabled:!1,type:l.media[h].descr.type,label:l.media[h].descr.label},p.enabled&&(p.mid=l.media[h].descr.mid),t.push(p)}if(!i&&e.audio){var p=n.default.getDescrFromState(e,r.default.MEDIA_LABEL.audio,f++);p.needsTransport=!0,t.push(p)}for(var d=a;d<u&&e.video;d++){var p=n.default.getDescrFromState(e,r.default.MEDIA_LABEL.video,f++);d>0?(p.send=!1,p.needsTransport=!1):p.needsTransport=!0,t.push(p)}if(!s&&e.sharing){var p=n.default.getDescrFromState(e,r.default.MEDIA_LABEL.sharing,f++);p.needsTransport=!0,t.push(p)}for(var h=0;h<t.length;h++)t[h].mid||(t[h].mid="m"+h);o&&(c=!0);if(c){var v=!1;t.forEach(function(e){!v&&e.needsTransport?v=!0:e.needsTransport=!1})}return t}function E(t,n,i){var s={isOffer:!0,sessionVersion:l?l.sessionVersion:0,transportParams:m(n,l?l.transportParams:[],!0),groups:[],bundled:c,media:[]},o=!1,u=!1,f=0,h=0;for(var p=0;p<t.length;p++){var d=l&&l.media[p]&&l.media[p].descr.enabled,v=!d&&t[p].enabled,g,b=u&&t[p].label===r.default.MEDIA_LABEL.video||s.bundled&&o;t[p].enabled&&t[p].mid&&s.groups.push(t[p].mid),v?g=i[p]:g=l.media[p],t[p].transportId=t[p].needsTransport?n[f].transportId:n[h].transportId,t[p].needsTransport&&(h=f,f++),o=o||d||v,t[p].label===r.default.MEDIA_LABEL.video&&(t[p].firstVideoChannel=!u,u=!0),s.media.push(y(t[p],g,v,b,!0))}return a=s,e.debug("CREATE OFFER","params:",JSON.stringify(a)),a}function S(t){e.debug("PROCESS ANSWER","params:",JSON.stringify(t)),f=C(a,t,!0)}function x(t,n,r){if(t.enabled){if(!n.sdesParamsList&&!n.dtlsParams)return e.warn("no sdes nor dtls params:",n.sdesParamsList,n.dtlsParams),!1;if(!r.rtpCaps.codecs.length)return e.warn("no common codecs!",r.rtpCaps),!1}return!0}function T(e,t,r){var i=[];for(var o=0;o<Math.max(e.length,t.length);o++){var u=null;if(e[o]&&t[o]){u=s.shallowClone(t[o]),u.doRtcpMux=e[o].doRtcpMux&&t[o].doRtcpMux,u.enableDtls=e[o].dtlsParams&&t[o].dtlsParams,u.transportId=e[o].transportId;var a=null;e[o].sdesParamsList&&t[o].sdesParamsList&&(a=n.default.findMatchingSdesParams(e[o].sdesParamsList,t[o].sdesParamsList),a&&(a.localSdesParams.tag=a.remoteSdesParams.tag,u.sdesParamsList=[a.localSdesParams],u.remoteSdesParams=a.remoteSdesParams))}i.push(u)}return i}function N(e,t,r,i,s){function o(n){var r=n?e.sender:e.receiver,s=n?t.sender:t.receiver,o=g(e,t,i,n);return o.rtcpMux=l.doRtcpMux,o.rtcpReducedSize=r.rtcpReducedSize&&s.rtcpReducedSize,o.enableDtls=l.enableDtls,o}var u=d(e.descr,t),a={descr:u};if(u.enabled){u.transportId=s?r[0].transportId:u.transportId;var f=n.default.getTransportIndexById(r,u.transportId),l=s?r[0]:r[f];a.descr=u,a.sender=o(!0),a.receiver=o(!1);if(!x(u,l,a.sender)||!x(u,l,a.receiver))throw new Error("Failed to verify negotiated parameters!")}return a}function C(e,t,n){if(e.media.length!==t.media.length)throw new Error("Number of media lines doesn't match in offer & answer l:"+e.media.length+" r: "+t.media.length);c=h(t,n);var r={sessionVersion:n?e.sessionVersion:t.sessionVersion,transportParams:T(e.transportParams,t.transportParams,n),bundle:n?e.groups:t.groups,bundled:c,media:[]};for(var i=0;i<e.media.length;i++)r.media.push(N(e.media[i],t.media[i],r.transportParams,n,r.bundled));return r}function k(){return f.sessionVersion++,l=f,e.debug("NEGOTIATED","params:",JSON.stringify(l)),l}function L(e,t){if(e===i.VideoCapabilitiesEventType.CODEC_PARAMS_UPDATED)return A(t);if(e===i.VideoCapabilitiesEventType.SSRC_UPDATED)return O(t)}function A(t){var r=s.find(l.media,function(e){return e.descr.mediaId===t.mediaId});if(!r){e.warn("mediaCaps not found for mediaId: ",t.mediaId);return}var i=n.default.getCodecByName(t.codecName,r.receiver.rtpCaps.codecs);if(!i||!i.parameters){e.warn("codec not found for codecName: ",t.codecName);return}s.forOwn(t.capabilities,function(n,r){e.log("changing ",r," for ",t.codecName," from ",i.parameters[r]," to ",n),i.parameters[r]=n})}function O(t){var n=s.find(l.media,function(e){return e.descr.mediaId===t.mediaId});if(!n){e.warn("mediaCaps not found for mediaType: ",t.mediaId,l);return}e.log("SSRC changing: ",n.receiver.ssrcRange," -> ",t.ssrcRange),e.log("rtxSSRC changing: ",n.receiver.rtxSsrc," -> ",t.rtxSsrc),n.receiver.ssrcRange=s.shallowClone(t.ssrcRange),n.sender.ssrcRange=s.shallowClone(t.ssrcRange),n.receiver.rtxSsrc=t.rtxSsrc,n.sender.rtxSsrc=t.rtxSsrc}var u=o&&t.numVideoChannelsGvc?t.numVideoChannelsGvc:1;this.processOffer=p,this.createMediaDescriptorsForAnswer=v,this.createAnswer=b,this.createMediaDescriptorsForOffer=w,this.createOffer=E,this.processAnswer=S,this.completeNegotiation=k,this.onMediaCapabilitiesChanged=L,this.supportsBundling=h;var a=null,f=null,l=null,c=!1}var n=e("./ortcHelper"),r=e("../constants"),i=e("./ortcConstants"),s=e("../common/utils");Object.defineProperty(t,"__esModule",{value:!0}),t.default=o}),function(e){if(typeof exports=="object"&&typeof module!="undefined")module.exports=e();else if(typeof define=="function"&&define.amd)define("microsoft-sdp-transform/lib/sdp-transform",[],e);else{var t;typeof window!="undefined"?t=window:typeof global!="undefined"?t=global:typeof self!="undefined"?t=self:t=this,t.sdpTransform=e()}}(function(){var e,t,n;return function r(e,t,n){function i(o,u){if(!t[o]){if(!e[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=t[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return i(n?n:t)},l,l.exports,r,e,t,n)}return t[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){var r=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\S*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbXMessage",reg:/^rtcp-fb:(\*|\d*) x-message ([\S| ]*)/,names:["payload","param"],format:function(e){var t=e.payload==="*"?"%s":"%d";return"rtcp-fb:"+t+" x-message %s"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["value","uri","config"],format:function(e){return e.config!=null?"extmap:%s %s %s":"extmap:%s %s"}},{push:"cryptoscale",reg:/^cryptoscale:(\d*) (client|server) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","flavor","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"cryptoscale:%d %s %s %s %s":"cryptoscale:%d %s %s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=e.raddr!=null?" raddr %s rport %d":"%v%v",t+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(t+=" generation %d"),t}},{push:"xCandidatesIpv6",reg:/^x-candidate-ipv6:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=e.raddr!=null?" raddr %s rport %d":"%v%v",t+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(t+=" generation %d"),t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*):(.*)/,names:["id","attribute","value"],format:"ssrc:%d %s:%s"},{push:"ssrcGroups",reg:/^ssrc-group:(\w*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/,format:"rtcp-mux"},{name:"rtcpRsize",reg:/^(rtcp-rsize)/,format:"rtcp-rsize"},{name:"xMediaBw",reg:/^x-mediabw:(\S*) send=(\d*);recv=(\d*)/,names:["label","sendBw","receiveBw"],format:"x-mediabw:%s send=%d;recv=%d"},{name:"xSsrcRange",reg:/^x-ssrc-range:(\d*)-(\d*)/,names:["ssrcMin","ssrcMax"],format:"x-ssrc-range:%d-%d"},{name:"label",reg:/^label:(\S*)/,format:"label:%s"},{name:"xSource",reg:/^x-source:(\S*)/,format:"x-source:%s"},{name:"xSourceStreamId",reg:/^x-source-streamid:(\S*)/,format:"x-source-streamid:%s"},{name:"xCaps",reg:/^x-caps:(\d*) (\S*)/,names:["payloadType","value"],format:"x-caps:%d %s"},{name:"signalingFbXMessage",reg:/^x-signaling-fb:(\*|\d*) x-message ([\S| ]*)/,names:["payload","param"],format:function(e){var t=e.payload==="*"?"%s":"%d";return"x-signaling-fb:"+t+" x-message %s"}},{push:"xMediaSettings",reg:/^x-mediasettings:([\S| ]*)/,names:["settings"],format:"x-mediasettings:%s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach(function(e){var t=r[e];t.forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},{}],2:[function(e,t,n){var r=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,n,i){if(i&&!n)t[i]=r(e[1]);else for(var s=0;s<n.length;s+=1)e[s+1]!=null&&(t[n[s]]=r(e[s+1]))},s=function(e,t,n){var r=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:r&&!t[e.name]&&(t[e.name]={});var s=e.push?{}:r?t[e.name]:t;i(n.match(e.reg),s,e.names,e.name),e.push&&t[e.push].push(s)},o=e("./grammar"),u=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(e){var t={},n=[],r=t;return e.split(/(\r\n|\r|\n)/).filter(u).forEach(function(e){var t=e[0],i=e.slice(2);t==="m"&&(n.push({rtp:[],fmtp:[]}),r=n[n.length-1]);for(var u=0;u<(o[t]||[]).length;u+=1){var a=o[t][u];if(a.reg.test(i))return s(a,r,i)}}),t.media=n,t};var a=function(e,t){var n=t.split("=");return n.length===2&&(e[n[0]]=r(n[1])),e};n.parseFmtpConfig=function(e){return e.split(/\;\s?/).reduce(a,{})},n.parsePayloads=function(e){return e.split(" ").map(Number)},n.parseRemoteCandidates=function(e){var t=[],n=e.split(" ").map(r);for(var i=0;i<n.length;i+=3)t.push({component:n[i],ip:n[i+1],port:n[i+2]});return t}},{"./grammar":1}],3:[function(e,t,n){var r=e("./grammar"),i=/%[sdv%]/g,s=function(e){var t=1,n=arguments,r=n.length;return e.replace(i,function(e){if(t>=r)return e;var i=n[t];t+=1;switch(e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}})},o=function(e,t,n){var r=t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format,i=[e+"="+r];if(t.names)for(var o=0;o<t.names.length;o+=1){var u=t.names[o];t.name?i.push(n[t.name][u]):i.push(n[t.names[o]])}else i.push(n[t.name]);return s.apply(null,i)},u=["v","o","s","i","u","e","p","c","b","t","r","z","a"],a=["i","c","b","a"];t.exports=function(e,t){t=t||{},e.version==null&&(e.version=0),e.name==null&&(e.name=" "),e.media.forEach(function(e){e.payloads==null&&(e.payloads="")});var n=t.outerOrder||u,i=t.innerOrder||a,s=[];return n.forEach(function(t){r[t].forEach(function(n){n.name in e&&e[n.name]!=null?s.push(o(t,n,e)):n.push in e&&e[n.push]!=null&&e[n.push].forEach(function(e){s.push(o(t,n,e))})})}),e.media.forEach(function(e){s.push(o("m",r.m[0],e)),i.forEach(function(t){r[t].forEach(function(n){n.name in e&&e[n.name]!=null?s.push(o(t,n,e)):n.push in e&&e[n.push]!=null&&e[n.push].forEach(function(e){s.push(o(t,n,e))})})})}),s.join("\r\n")+"\r\n"}},{"./grammar":1}],"sdp-transform":[function(e,t,n){var r=e("./parser"),i=e("./writer");n.write=i,n.parse=r.parse,n.parseFmtpConfig=r.parseFmtpConfig,n.parsePayloads=r.parsePayloads,n.parseRemoteCandidates=r.parseRemoteCandidates},{"./parser":2,"./writer":3}]},{},[])("sdp-transform")}),define("microsoft-sdp-transform",["microsoft-sdp-transform/lib/sdp-transform"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/formatParameters",["require","exports","./utils"],e)}(function(e,t){var n=e("./utils"),r=function(){function e(e){var t=this;this.fmtpString=e,this.parameters={},e&&e.split(";").forEach(function(e){var n=e.split("=");t.parameters[n[0]]=n[1]})}return e.prototype.setIfMissing=function(e,t){this.contains(e)||(this.parameters[e]=t)},e.prototype.get=function(e){return this.parameters[e]},e.prototype.names=function(){return Object.keys(this.parameters)},e.prototype.contains=function(e){return this.parameters.hasOwnProperty(e)},e.prototype.toString=function(){var e="";return n.forOwn(this.parameters,function(t,n){e+=(e?";":"")+n,typeof t!="undefined"&&(e+="="+t)}),e},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e){return new r(e)}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/ortc/ortcSdp",["require","exports","microsoft-sdp-transform","../constants","./ortcHelper","../common/utils","../common/formatParameters"],e)}(function(e,t){function u(){function e(e,t){return t?e.replace(/\\/g,"/"):e.replace(/\//g,"\\")}function t(e,t){return e.toLowerCase()===t.toLowerCase()}function u(e){return e.indexOf(":")===-1}function a(e){var t=e.iceCandidates.slice(0).sort(function(e,t){return t.priority-e.priority});for(var n=0;n<t.length;n++)if(t[n].type==="host")return t[n].ip;return"0.0.0.0"}function f(e,t){return e&&t?"sendrecv":e?"sendonly":t?"recvonly":"inactive"}function l(e,t){var n=e.toUpperCase();if(n==="TCP")switch(t.toLowerCase()){case"active":return"TCP-ACT";case"passive":return"TCP-PASS";case"so":return"TCP-SO"}return n}function c(e,n,r){r.push({foundation:e.foundation,component:n,transport:l(e.protocol,e.tcpType),priority:e.priority,ip:e.ip,port:e.port,type:e.type,raddr:t(e.type,"host")?void 0:e.relatedAddress,rport:t(e.type,"host")?void 0:e.relatedPort})}function h(e,t,n,r){e&&e.forEach(function(e){u(e.ip)?c(e,t,n):c(e,t,r)})}function p(e){if(e.iceCandidatePair)return{0:e.iceCandidatePair.local,1:e.rtcpIceCandidatePair?e.rtcpIceCandidatePair.local:null};var t=e.iceCandidates.slice(0).sort(function(e,t){return t.priority-e.priority}),n=t[0],r=null;if(e.rtcpIceCandidates)for(var i=0;i<e.rtcpIceCandidates.length;++i){var s=e.rtcpIceCandidates[i];if(s.foundation===n.foundation){r=s;break}}return{0:n,1:r}}function d(n,i,o,a,l,c){function E(e){return e.mkiLength!==0?"|"+e.mkiValue+":"+e.mkiLength:""}var d=i.receiver,v={rtp:[],fmtp:[],rtcpFb:[],ext:[],type:i.descr.type,port:0,protocol:"RTP/SAVP",payloads:"",cryptoscale:[],crypto:[],candidates:[],xCandidatesIpv6:[]};if(!i.descr.enabled)return v.type===r.default.MEDIA_TYPE.video?v.payloads="34":v.payloads="9",v;i.descr.mid&&(v.mid=i.descr.mid);var m=p(n);v.port=m[0].port;var g,y;if(l&&v.mid===c[0]||!l)g=m[0],y=m[1],a.ip!==g.ip&&(v.connection={version:u(g.ip)?4:6,ip:g.ip});v.iceUfrag=n.iceParams.usernameFragment,v.icePwd=n.iceParams.password;if(v.type===r.default.MEDIA_TYPE.audio){var b=C(d.rtpCaps.codecs);v.maxptime=b.maxptime,v.ptime=b.ptime}v.direction=f(i.descr.send,i.descr.recv),v.xSsrcRange={ssrcMin:d.ssrcRange.min,ssrcMax:d.ssrcRange.max},v.ssrcGroups=T(i.sender.rtxSsrc,i.sender.ssrcRange.min),v.label=i.descr.label;if(v.label!==r.default.MEDIA_LABEL.video||i.descr.firstVideoChannel)v.xSource=v.label;d.rtcpReducedSize&&(v.rtcpRsize=!0),o&&i.justAdded?(n.doRtcpMux&&(v.rtcpMux=!0),v.rtcp={port:y&&y.port||v.port+1}):n.doRtcpMux?v.rtcpMux=!0:v.rtcp={port:y&&y.port||v.port+1};var w=null;d.rtpCaps&&d.rtpCaps.codecs&&(d.rtpCaps.codecs.forEach(function(e){v.rtp.push({payload:e.preferredPayloadType,codec:e.name,rate:e.clockRate,encoding:e.numChannels>1?e.numChannels:void 0});var n="";s.forOwn(e.parameters,function(e,t){n!==""&&(n+=";"),n+=t==="events"?e:t+"="+e}),n!==""&&v.fmtp.push({payload:e.preferredPayloadType,config:n}),v.payloads+=(v.payloads?" ":"")+e.preferredPayloadType;for(var r=0;r<e.rtcpFeedback.length;r++)t(e.rtcpFeedback[r].type,"x-message")?w=e.rtcpFeedback[r].parameter:v.rtcpFb.push({payload:e.preferredPayloadType,type:e.rtcpFeedback[r].type,subtype:e.rtcpFeedback[r].parameter})}),w&&v.rtcpFb.push({payload:"*",type:"x-message",subtype:w})),d.rtpCaps&&d.rtpCaps.headerExtensions&&d.rtpCaps.headerExtensions.forEach(function(t){v.ext.push({value:t.preferredId,uri:e(t.uri,!1)})});if(n.sdesParamsList)for(var S=0;S<n.sdesParamsList.length;++S){var x=n.sdesParamsList[S];t(x.cryptoSuite,"AES_CM_128_HMAC_SHA1_80")?v.crypto.push({id:x.tag,suite:"AES_CM_128_HMAC_SHA1_80",config:x.keyParams[0].keyMethod+":"+x.keyParams[0].keySalt+"|"+x.keyParams[0].lifetime+E(x.keyParams[0])}):t(x.cryptoSuite,"SCALE_AES_CM_128_HMAC_SHA1_80")&&v.cryptoscale.push({id:x.tag,flavor:"client",suite:"AES_CM_128_HMAC_SHA1_80",config:x.keyParams[0].keyMethod+":"+x.keyParams[0].keySalt+"|"+x.keyParams[0].lifetime+E(x.keyParams[0])})}i.bundledWithOther||(n.iceCandidatePair?(h([n.iceCandidatePair.local],1,v.candidates,v.xCandidatesIpv6),n.rtcpIceCandidatePair&&!n.doRtcpMux&&h([n.rtcpIceCandidatePair.local],2,v.candidates,v.xCandidatesIpv6),v.remoteCandidates="1 "+n.iceCandidatePair.remote.ip+" "+n.iceCandidatePair.remote.port,n.doRtcpMux?v.remoteCandidates+=" 2 "+n.iceCandidatePair.remote.ip+" "+n.iceCandidatePair.remote.port:v.remoteCandidates+=" 2 "+n.rtcpIceCandidatePair.remote.ip+" "+n.rtcpIceCandidatePair.remote.port):(h(n.iceCandidates,1,v.candidates,v.xCandidatesIpv6),(o&&i.justAdded||!n.doRtcpMux)&&h(n.rtcpIceCandidates,2,v.candidates,v.xCandidatesIpv6)),v.candidates.sort(function(e,t){return+e.foundation- +t.foundation||e.foundation===t.foundation&&e.component-t.component}),v.xCandidatesIpv6.sort(function(e,t){return+e.foundation- +t.foundation||e.foundation===t.foundation&&e.component-t.component}));if(n.dtlsParams){v.fingerprint={type:n.dtlsParams.fingerprints[0].algorithm,hash:n.dtlsParams.fingerprints[0].value};switch(n.dtlsParams.role){case"auto":v.setup="actpass";break;case"client":v.setup="active";break;case"server":v.setup="passive"}}return v}function v(e){var t=e.toLowerCase();switch(t){case"tcp-act":case"tcp-pass":case"tcp-so":return"tcp";default:return t}}function m(e){switch(e.toLowerCase()){case"tcp-act":return"active";case"tcp-pass":return"passive";case"tcp-so":return"so";default:return void 0}}function g(e){var n={foundation:e.foundation,priority:e.priority,ip:e.ip,protocol:v(e.transport),port:e.port,type:e.type};return t(e.type,"host")||(n.tcpType=m(e.transport),n.relatedAddress=e.raddr,n.relatedPort=e.rport),n}function y(e,t,n){e.candidates&&e.candidates.forEach(function(e){e.component===t&&n.push(g(e))}),e.xCandidatesIpv6&&e.xCandidatesIpv6.forEach(function(e){e.component===t&&n.push(g(e))})}function b(e){var t=/(\w+):([a-zA-Z0-9+\/]+={0,2})(\|([0-9\^]+))?(\|([0-9]+):([0-9]+))?/,n=e.match(t);if(!n)return void 0;var r={keyMethod:n[1],keySalt:n[2],mkiValue:0,mkiLength:0};return typeof n[4]!="undefined"&&(r.lifetime=n[4]),typeof n[7]!="undefined"&&(r.mkiValue=+n[6],r.mkiLength=+n[7]),r}function w(e,n){function s(e,t,n,r){i.push({tag:e,cryptoSuite:t,keyParams:n,sessionParams:r})}var r={},i=[];n.cryptoscale&&n.cryptoscale.forEach(function(e){var n=t(e.flavor,"server")?b(e.config):void 0;n&&s(e.id,"SCALE_"+e.suite,[n],[])}),n.crypto&&n.crypto.forEach(function(e){var t=b(e.config);t&&s(e.id,e.suite,[t],[])}),r.iceParams={usernameFragment:n.iceUfrag,password:n.icePwd},r.sdesParamsList=i,r.iceCandidates=[],y(n,1,r.iceCandidates),r.doRtcpMux=!!n.rtcpMux,n.rtcpMux||(r.rtcpIceParams={usernameFragment:n.iceUfrag,password:n.icePwd},r.rtcpIceCandidates=[],y(n,2,r.rtcpIceCandidates),e.icelite&&(r.rtcpIceParams.iceLite=!0)),n.remoteCandidates&&(r.iceCandidatePair={});if(e.fingerprint||n.fingerprint){var o=n.fingerprint?n.fingerprint:e.fingerprint,u=n.setup?n.setup:e.setup,a="auto";switch(u){case"actpass":a="auto";break;case"active":a="client";break;case"passive":a="server"}r.dtlsParams={role:a,fingerprints:[{algorithm:o.type,value:o.hash}]}}return e.icelite&&(r.iceParams.iceLite=!0),r}function E(t){var n=[],s=[];return t.rtp.forEach(function(e){var i={name:e.codec,kind:t.type,clockRate:e.rate,preferredPayloadType:e.payload,numChannels:e.encoding?e.encoding:1,rtcpFeedback:[],parameters:{}};t.type===r.default.MEDIA_TYPE.audio&&(i.ptime=t.ptime,i.maxptime=t.maxptime),t.rtcpFbXMessage&&t.rtcpFbXMessage.length&&t.rtcpFbXMessage.forEach(function(e){(e.payload==="*"||i.preferredPayloadType===+e.payload)&&i.rtcpFeedback.push({type:"x-message",parameter:e.param})}),t.rtcpFb&&t.rtcpFb.length&&t.rtcpFb.forEach(function(e){(e.payload==="*"||i.preferredPayloadType===+e.payload)&&i.rtcpFeedback.push({type:e.type,parameter:e.subtype||""})}),n.push(i)}),t.fmtp&&t.fmtp.forEach(function(e){var t=o.default.build(e.config),r=i.default.getCodecIndexByPayload(e.payload,n);t.names().forEach(function(e){n[r].parameters[e]=t.get(e)})}),t.ext&&t.ext.forEach(function(n){s.push({kind:t.type,uri:e(n.uri,!0),preferredId:n.value})}),{codecs:n,headerExtensions:s,fecMechanisms:[]}}function S(e){e.direction||(e.direction="sendrecv");var t=e.direction.toLowerCase(),n=parseInt(e.port,10)!==0;e.type!==r.default.MEDIA_TYPE.audio&&e.type!==r.default.MEDIA_TYPE.video&&(n=!1);var i=function(){if(n&&!e.label){if(r.default.MEDIA_TYPE.audio===e.type)return r.default.MEDIA_LABEL.audio;if(r.default.MEDIA_TYPE.video===e.type)return r.default.MEDIA_LABEL.video}return e.label};return{enabled:n,type:e.type,label:i(),mid:e.mid,send:n?t==="sendrecv"||t==="sendonly":!1,recv:n?t==="sendrecv"||t==="recvonly":!1}}function x(e){if(e){var t=s.find(e,function(e){return e.semantics==="FID"});if(t)return+t.ssrcs.split(" ")[1]}return 0}function T(e,t){return e?[{semantics:"FID",ssrcs:t+" "+e}]:[]}function N(e){var t=S(e);if(!t.enabled){var n={rtpCaps:null,ssrcRange:null,rtcpReducedSize:!1};return{descr:t,receiver:n,sender:n}}var r={rtpCaps:E(e),ssrcRange:{min:e.xSsrcRange?e.xSsrcRange.ssrcMin:0,max:e.xSsrcRange?e.xSsrcRange.ssrcMax:0},mid:e.mid||void 0,rtxSsrc:x(e.ssrcGroups),rtcpReducedSize:e.rtcpRsize?!0:!1};return{descr:S(e),receiver:r,sender:s.deepClone(r)}}function C(e){if(e.length===0)return{ptime:0,maxptime:0};var t=e[0].ptime,n=e[0].maxptime;return e.forEach(function(e){n>e.maxptime&&e.maxptime>0&&(n=e.maxptime)}),{ptime:t,maxptime:n}}function k(e){return!e||!e.groups?[]:s.find(e.groups,function(e){return e.type==="BUNDLE"}).mids.toString().split(" ")}function L(e){for(var t=0;t<e.media.length;t++)if(e.media[t].signalingFbXMessage)return!0;var n=k(e);return n&&n[1]?e.media.some(function(e){return e.mid===n[1]&&(!e.candidates||e.candidates.length===0)}):!1}this.paramsToSdp=function(e){var t={},s=e.transportParams[0]||e.transportParams[1]||e.transportParams[2],o=a(s),f=p(s),l=f[0];t.groups=i.default.groupsToSdp(e),t.version=0,t.origin={username:"-",sessionId:0,sessionVersion:e.sessionVersion,netType:"IN",ipVer:u(o)?4:6,address:o},t.bandwidth=[{type:"CT",limit:99980}],t.timing={start:0,stop:0},t.name="session",t.connection={version:u(l.ip)?4:6,ip:l.ip},t.xMediaBw={label:r.default.MEDIA_LABEL.video,sendBw:8100,receiveBw:8e3},t.media=[];for(var c=0;c<e.media.length;c++){var h=e.bundled?0:i.default.getTransportIndexById(e.transportParams,e.media[c].descr.transportId),v=e.transportParams[h];t.media.push(d(v,e.media[c],e.isOffer,l,e.bundled,e.groups))}return n.write(t)},this.sdpToParams=function(e){var t=n.parse(e),r={sessionVersion:t.origin.sessionVersion,transportParams:[],groups:k(t),bundledOnly:L(t),media:[]};for(var i=0;i<t.media.length;i++){var s=t.media[i],o=N(s);r.media.push(o);if(o.descr.enabled){var u=w(t,s);u.iceCandidates.length>0&&r.transportParams.push(w(t,s))}}return r}}var n=e("microsoft-sdp-transform"),r=e("../constants"),i=e("./ortcHelper"),s=e("../common/utils"),o=e("../common/formatParameters");Object.defineProperty(t,"__esModule",{value:!0}),t.default=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/ssrcGenerator",["require","exports"],e)}(function(e,t){var n=4294967040,r=function(){function e(){this.ssrc=Math.floor(Math.random()*(n-1))+1}return e.prototype.nextAudioStreamSsrc=function(){return this.nextSsrc(0)},e.prototype.nextVideoStreamSsrc=function(){return this.nextSsrc(99)},e.prototype.nextSsrc=function(e){var t;do t=this.ssrc,this.ssrc=(this.ssrc+e+1)%n,this.ssrc===0&&(this.ssrc=1);while(t+e>n);return{min:t,max:t+e}},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/render/videoSizeTracker",["require","exports","../userAgentAdapter"],e)}(function(e,t){var n=e("../userAgentAdapter"),r=function(){function e(e,t){this.window=n.default.window,this.videoElement=e,this.config=t,this.originalVideoElementSize={width:e.offsetWidth,height:e.offsetHeight}}return e.prototype.onSizeChange=function(e){var t=this;if(this.elementSizeTrackingRef)return;var n=Math.floor(Math.random()*Math.abs(this.config.interval.max-this.config.interval.min))+this.config.interval.min;this.elementSizeTrackingRef=this.window.setInterval(function(){t.videoElementSizeChanged()&&(t.saveCurrentVideoElementSize(),e(t.videoElement.offsetWidth,t.videoElement.offsetHeight))},n)},e.prototype.dispose=function(){this.elementSizeTrackingRef&&this.window.clearInterval(this.elementSizeTrackingRef)},e.prototype.videoElementSizeChanged=function(){return this.originalVideoElementSize.width!==this.videoElement.offsetWidth||this.originalVideoElementSize.height!==this.videoElement.offsetHeight},e.prototype.saveCurrentVideoElementSize=function(){this.originalVideoElementSize.width=this.videoElement.offsetWidth,this.originalVideoElementSize.height=this.videoElement.offsetHeight},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/ortc/ortcVideoRendererGroup",["require","exports","../common/render/videoRenderer","../common/utils","../constants","../common/render/videoSizeTracker","../common/userAgentAdapter","../common/settablePromise"],e)}(function(e,t){function f(e){function p(e,o){function S(){w||(t.log("starting video tag periodic refresh"),w=h.setInterval(function(){p.getVideoElement().play()},a))}function x(){w&&(t.log("stopping video tag periodic refresh"),h.clearInterval(w),w=null)}function T(){var e=p.getMediaStream();return e?e.getVideoTracks()[0]:null}function N(){g&&(g.remove(p),g=void 0),y=void 0}function C(e,t){if(!k(e,t)){var n=new u.SettablePromise,i=[],s,o=!1,a=function(){o||(i=[],n.isPending&&n.reject(new Error("disposing renderer")),s&&s.unsubscribe(),r.remove(f,function(n){return n.rendererType===e&&n.msi===t}),o=!0,f.forEach(function(e){e.update()}))},l=function(){n=new u.SettablePromise},c=function(){if(n.isPending){var r=L(e);r&&(r.subscribe(t),s=r,n.resolve())}if(s){var o=s.getRecvTrack();i.forEach(function(e){e.updateRecvTrack(t,o)})}};f.push({rendererType:e,msi:t,add:function(e,t){n.promise.then(t.resolve,t.reject),i.push(e),c()},remove:function(e){r.remove(i,function(t){return t===e}),i.length===0&&a()},getChannel:function(){return s},update:c,dispose:a,reset:l})}g=k(e,t),g.add(p,m)}function k(e,t){return r.find(f,function(n){return n.rendererType===e&&n.msi===t})}function L(e){return r.find(c,function(t){return t.canSubscribe()&&t.label===A(e)})}function A(e){switch(e){case i.default.MODALITY.video:return i.default.MEDIA_LABEL.video;case i.default.MODALITY.sharing:return i.default.MEDIA_LABEL.sharing}}function O(){if(!l.ortcVideoCapabilityCheckIntervalMin||!l.ortcVideoCapabilityCheckIntervalMax){t.info("skipping video size tracking");return}if(b)return;b=new s.default(p.getVideoElement(),{interval:{min:l.ortcVideoCapabilityCheckIntervalMin,max:l.ortcVideoCapabilityCheckIntervalMax}}),b.onSizeChange(function(e,n){t.info("video renderer size changed, updating capabilities"),g.getChannel()&&g.getChannel().videoSizeChanged(e,n)})}n.default.call(this,e);var p=this,d=this.dispose.bind(this),v=!1,m=new u.SettablePromise,g,y,b,w;this.onSizeChanged(function(e,t){e&&t&&x(),o&&o.onVideoSizeChanged&&o.onVideoSizeChanged(e,t)}),this.onError(o?o.onError:null),this.updateRecvTrack=function(e,n){var r=T();if(n!==r){var i=n?new MediaStream([n]):null;t.log("updating renderer media stream to",i),p.attachMediaStream(i),y!==e&&(y=e,t.log("renderer subscribed msi updated to",e))}};var E=this.attachMediaStream.bind(this);this.attachMediaStream=function(e){return l.ortcVideoRendererAggressiveStreamRefresh&&(e?S():x()),E(e)},this.subscribeVideoAsync=function(e,n){e=e||i.default.MSI.subscribeAny;var r=n?i.default.RENDERER_TYPE.sharing:i.default.RENDERER_TYPE.video;return t.info("subscribing renderer to type:",r,"msi:",e),new Promise(function(t){if(!v){var n=y!==e;n&&N(),m.isPending&&(m.resolve(),m=new u.SettablePromise),e===i.default.MSI.unsubscribe||!n?m.resolve():(C(r,e),O())}t(m.promise)})},this.dispose=function(){t.debug("disposing remote renderer"),b&&(b.dispose(),b=null),x(),N(),m.isPending&&m.reject(new Error("disposing renderer")),v=!0,d()}}var t=e.logger.createChild("OrtcVideoRendererGroup"),f=[],l=e.settings,c=[],h=o.default.window;this.create=function(e,t){return new p(e,t)},this.reset=function(){f.forEach(function(e){e.reset()})},this.update=function(e){c=e,f.forEach(function(e){e.update()})},this.terminate=function(){f.forEach(function(e){e.dispose()})},p.prototype=Object.create(n.default.prototype)}var n=e("../common/render/videoRenderer"),r=e("../common/utils"),i=e("../constants"),s=e("../common/render/videoSizeTracker"),o=e("../common/userAgentAdapter"),u=e("../common/settablePromise"),a=1e3;Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e){return new f(e)}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/extensions/extensionBase",["require","exports"],e)}(function(e,t){var n=function(){function e(e){this.manager=null,this.extensionType=e}return e.prototype.initialize=function(e){e.manager&&(this.manager=e.manager),e.logger&&(this.logger=e.logger.createChild(this.extensionType),this.logger.log("initialized"))},e.prototype.dispose=function(){this.manager&&(this.manager=null),this.logger&&(this.logger.log("disposed"),this.logger=null)},e.prototype.configure=function(e){this.options=e},e.prototype.getOptions=function(){return this.options},e.prototype.getType=function(){return this.extensionType},e}();t.ExtensionBase=n});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/extensions/dominantSpeakerHistoryExtension",["require","exports","../constants","./extensionBase"],e)})(function(e,t){var n=e("../constants"),r=e("./extensionBase"),i="DominantSpeakerInfo",s=function(e){function t(){var t=e.call(this,n.default.EXTENSION_TYPE.dominantSpeakerHistory)||this;return t.callback=null,t}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.manager.addNotificationListener(this,i),t&&t.callback&&(this.callback=t.callback)},t.prototype.dispose=function(){this.manager.removeNotificationListener(this,i),this.callback=null,e.prototype.dispose.call(this)},t.prototype.onNotification=function(e,t){if(i!==e)return;var n=t;this.processInfo(n)},t.prototype.processInfo=function(e){if(!this.callback)return;this.callback(e.previousDominantSpeakerHistory)},t}(r.ExtensionBase);Object.defineProperty(t,"__esModule",{value:!0}),t.default=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/extensions/descriptionModifier",["require","exports","microsoft-sdp-transform","../common/formatParameters"],e)}(function(e,t){var n=e("microsoft-sdp-transform"),r=e("../common/formatParameters"),i=function(){function e(e){this.logger=e,this.logger=this.logger.createChild("rembModifier")}return e.prototype.getControlItem=function(){return this.controlItem},e.prototype.setControlItem=function(e){this.controlItem=e},e.prototype.dispose=function(){this.controlItem=null},e.prototype.setVideoControlMessage=function(e){this.controlItem=this.messageToControlItem(e)},e.prototype.modifyDescriptor=function(e){if(!this.controlItem)return;var t=n.parse(e.sdp);if(!t.media[1]){this.logger.warn("video modality is disabled, skipping sdp modification, ",e);return}if(!t.media[1].bandwidth){var r={limit:this.controlItem.bandwidth,type:"AS"};t.media[1].bandwidth=[r]}else t.media[1].bandwidth[0].limit=this.controlItem.bandwidth;return e.sdp=n.write(t),e},e.prototype.messageToControlItem=function(e){var t=r.default.build(e.controlVideoStreaming.controlInfo[0].fmtParams),n="max-br",i=1.2;if(!t.contains(n))return;var s=Math.round(+t.get(n)*i);return{sourceId:e.controlVideoStreaming.controlInfo[0].sourceId,streamMsid:e.controlVideoStreaming.controlInfo[0].streamMsid,bandwidth:s}},e}();t.BandwidthControlModifier=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/extensions/videoStreamConfigurator",["require","exports","./descriptionModifier","../common/formatParameters"],e)}(function(e,t){var n=e("./descriptionModifier"),r=e("../common/formatParameters"),i="max-fs",s="max-fps",o=function(){function e(e,t,r){this.logger=e,this.emulator=t,this.qualityManager=r,this.logger=e.createChild("Configurator"),this.modifiers=[new n.BandwidthControlModifier(this.logger)]}return e.prototype.dispose=function(){this.modifiers&&(this.modifiers.forEach(function(e){return e.dispose()}),this.modifiers=null),this.emulator=null,this.logger=null},e.prototype.configureResolution=function(e){var t=e.controlVideoStreaming.controlInfo[0].fmtParams;this.logger.log("Signaling FMTP: "+t);var n=r.default.build(t);if(!n.contains(i))return;this.qualityManager.setMaxCapabilities({maxFS:+n.get(i),maxFPS:+n.get(s)/100})},e.prototype.handleMessage=function(e){var t={controlVideoStreaming:e};return this.modifiers.forEach(function(e){return e.setVideoControlMessage(t)}),this.configureResolution(t),this.emulator.renegotiate(this.modifiers)},e}();t.VideoStreamConfigurator=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/extensions/sourceRequester",["require","exports"],e)}(function(e,t){var n=function(){function e(){this.sequence=0}return e.prototype.getVideoControlMessage=function(e,t){return{controlVideoStreaming:{sequenceNumber:++this.sequence,globalTimestamp:(new Date).toString(),controlInfo:[{control:"start",sourceId:t,streamMsid:e}]}}},e}();t.VideoControlMessageGenerator=n;var r=function(){function e(e,t){this.logger=e,this.controlMessageGenerator=t}return e.prototype.dispose=function(){this.sender=null},e.prototype.configure=function(e){var t=e;this.sender=t.sender},e.prototype.requestSource=function(e,t){var n=this;return Promise.resolve().then(function(){if(!n.checkConfigured()){n.logger.warn("extension not configured with sender");return}var r=n.controlMessageGenerator.getVideoControlMessage(e,t);return n.logger.log("sending video control message:",r),n.sender.send(r)})},e.prototype.checkConfigured=function(){return!!this.sender},e}();t.SourceRequester=r});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/extensions/videoStreamControlExtension",["require","exports","./extensionBase","../constants","./videoStreamConfigurator","./sourceRequester"],e)})(function(e,t){var n=e("./extensionBase"),r=e("../constants"),i=e("./videoStreamConfigurator"),s=e("./sourceRequester"),o="ControlVideoStreaming",u=function(e){function t(){return e.call(this,r.default.EXTENSION_TYPE.videoStreamControl)||this}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.subscribeListeners(),this.sourceRequester=new s.SourceRequester(this.logger,new s.VideoControlMessageGenerator),this.streamConfigurator=new i.VideoStreamConfigurator(this.logger,t.negotiationEmulator,t.qualityManager)},t.prototype.configure=function(t){e.prototype.configure.call(this,t),this.sourceRequester.configure(t)},t.prototype.requestSource=function(e,t){return this.sourceRequester.requestSource(e,t)},t.prototype.dispose=function(){this.unsubscribeListeners(),this.streamConfigurator.dispose(),this.sourceRequester.dispose(),e.prototype.dispose.call(this)},t.prototype.onNotification=function(e,t){o===e&&this.streamConfigurator.handleMessage(t)},t.prototype.subscribeListeners=function(){this.manager.addNotificationListener(this,o)},t.prototype.unsubscribeListeners=function(){this.manager.removeNotificationListener(this,o)},t}(n.ExtensionBase);Object.defineProperty(t,"__esModule",{value:!0}),t.default=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/extensions/extensionFactory",["require","exports","./dominantSpeakerHistoryExtension","./videoStreamControlExtension","../constants"],e)}(function(e,t){var n=e("./dominantSpeakerHistoryExtension"),r=e("./videoStreamControlExtension"),i=e("../constants"),s=function(){function e(){}return e.getExtension=function(e){if(i.default.EXTENSION_TYPE.dominantSpeakerHistory===e)return new n.default;if(i.default.EXTENSION_TYPE.videoStreamControl===e)return new r.default;throw new Error("Extension of type "+e+" is not found")},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/extensions/extensionsManager",["require","exports","./extensionFactory","../common/utils"],e)}(function(e,t){var n=e("./extensionFactory"),r=e("../common/utils"),i=function(){function e(){this.extensions=[],this.listeners={}}return e.prototype.dispose=function(){this.extensions.map(function(e){return e.dispose()}),this.extensions=[],this.listeners={}},e.prototype.addExtension=function(e,t){t.manager||(t.manager=this);var r=n.default.getExtension(e);r.initialize(t),this.extensions.push(r)},e.prototype.getExtension=function(e){return r.find(this.extensions,function(t){return t.getType()===e})},e.prototype.configureExtension=function(e,t){var n=this.getExtension(e);n&&n.configure(t)},e.prototype.processNotification=function(e,t){var n=this.listeners[e];n&&n.forEach(function(n){n.onNotification(e,t)})},e.prototype.addNotificationListener=function(e,t){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},e.prototype.removeNotificationListener=function(e,t){var n=this.listeners[t];if(!n)return;var r=n.indexOf(e);r>=0&&n.splice(r,1),n.length||delete this.listeners[t]},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/activeSpeaker/activeSpeakerManager",["require","exports"],e)}(function(e,t){var n=function(){function e(e,t){this.onActiveSpeakersChanged=e,this.onDominantSpeakersChanged=t}return e.prototype.setStrategy=function(e){this.dshStrategy=e,this.dshStrategy&&this.dshStrategy.setOnDominantSpeakerChanged(this.onDominantSpeakerHistoryChanged.bind(this))},e.prototype.onContributingSourcesChanged=function(e){this.onActiveSpeakersChanged(e),this.dshStrategy&&this.dshStrategy.setSources(e)},e.prototype.onDominantSpeakerHistoryChanged=function(e){this.onDominantSpeakersChanged(e)},e.prototype.dispose=function(){this.dshStrategy&&(this.dshStrategy.dispose(),this.dshStrategy=null),this.onActiveSpeakersChanged=null,this.onDominantSpeakersChanged=null},e}();t.ActiveSpeakerManager=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/activeSpeaker/dshGeneratingStrategy",["require","exports","../utils"],e)}(function(e,t){var n=e("../utils"),r=3e3,i=function(){function e(e){this.id=e,this.startTimestamp=0,this.totalTime=0}return e}(),s=function(){function e(e){this.sources=[],this.timeToPromote=e&&e.timeToPromote||r,this.ping=this.setupTimer()}return e.prototype.setSources=function(e){var t=this;e=e||[];var n=e.map(this.getOrCreateSource.bind(this)),r=this.excludeSources(this.sources,n);n.filter(function(e){return!t.isAlreadyActive(e)}).forEach(this.updateSourceTimestamp),r.forEach(function(e){t.updateTotalTime(e),t.resetStartTimestamp(e)}),this.ping||(this.ping=this.setupTimer())},e.prototype.setOnDominantSpeakerChanged=function(e){this.callback=e},e.prototype.dispose=function(){this.clearTimer(),this.sources=null,this.callback=null},e.prototype.excludeSources=function(e,t){return e.filter(function(e){return!t.some(function(t){return e.id===t.id})})},e.prototype.trigger=function(){var e=function(e,t){return t.totalTime-e.totalTime},t=function(e){return e.id};if(!this.hasAnyoneSpoken()){this.clearTimer();return}var r=this.sources.map(this.updateTotalTime).sort(e).map(t);r.length&&!n.deepEqual(this.candidates,r)&&(this.candidates=r,this.callback&&this.callback(r)),this.sources.map(this.resetTotalTime).filter(this.isAlreadyActive).forEach(this.updateSourceTimestamp)},e.prototype.isAlreadyActive=function(e){return!!e.startTimestamp},e.prototype.setupTimer=function(){return setInterval(this.trigger.bind(this),this.timeToPromote)},e.prototype.clearTimer=function(){this.ping&&(clearInterval(this.ping),this.ping=null)},e.prototype.getOrCreateSource=function(e){if(!this.isExist(e)){var t=new i(e);return this.sources.push(t),t}return this.sourceById(e)},e.prototype.isExist=function(e){return this.sources.some(function(t){return e===t.id})},e.prototype.hasAnyoneSpoken=function(){return this.sources.some(function(e){return e.startTimestamp!==0||e.totalTime!==0})},e.prototype.sourceById=function(e){return n.find(this.sources,function(t){return e===t.id})},e.prototype.updateSourceTimestamp=function(e){e.startTimestamp=Date.now()},e.prototype.updateTotalTime=function(e){return e.startTimestamp&&(e.totalTime+=Date.now()-e.startTimestamp),e},e.prototype.resetStartTimestamp=function(e){return e.startTimestamp=0,e},e.prototype.resetTotalTime=function(e){return e.totalTime=0,e},e}();t.DSHGeneratingStrategy=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/ortc/ortcSession",["require","exports","./ortcTransport","./ortcMediaChannel","./ortcNegotiation","./ortcSdp","../common/ssrcGenerator","./ortcVideoRendererGroup","./ortcHelper","../constants","./ortcConstants","../helper","../common/utils","../extensions/extensionsManager","../common/activeSpeaker/activeSpeakerManager","../common/activeSpeaker/dshGeneratingStrategy"],e)}(function(e,t){function m(){function t(t){throw new Error("Invalid state change:"+e.state+" "+t+" changing: "+e.changing)}var e=this;this.STABLE="stable",this.NEGOTIATION_REQUESTED="negotiation_requested",this.HAVE_LOCAL_OFFER="have_local_offer",this.HAVE_REMOTE_PRANSWER="have_remote_pranswer",this.HAVE_REMOTE_ANSWER="have_remote_answer",this.HAVE_REMOTE_OFFER="have_remote_offer",this.HAVE_LOCAL_PRANSWER="have_local_pranswer",this.HAVE_LOCAL_ANSWER="have_local_answer",this.TERMINATED="terminated",this.state=e.STABLE,this.changing=!1,this.change=function(n,r){e.busy&&t(n),r&&(e.changing=r);switch(n){case e.STABLE:e.state!==e.HAVE_REMOTE_ANSWER&&e.state!==e.HAVE_LOCAL_ANSWER&&t(n);break;case e.NEGOTIATION_REQUESTED:e.state!==e.STABLE&&t(n);break;case e.HAVE_LOCAL_OFFER:e.state!==e.STABLE&&e.state!==e.NEGOTIATION_REQUESTED&&t(n);break;case e.HAVE_REMOTE_PRANSWER:case e.HAVE_REMOTE_ANSWER:e.state!==e.HAVE_LOCAL_OFFER&&e.state!==e.HAVE_REMOTE_PRANSWER&&t(n);break;case e.HAVE_REMOTE_OFFER:e.state!==e.STABLE&&e.state!==e.NEGOTIATION_REQUESTED&&t(n);break;case e.HAVE_LOCAL_PRANSWER:case e.HAVE_LOCAL_ANSWER:e.state!==e.HAVE_REMOTE_OFFER&&e.state!==e.HAVE_LOCAL_PRANSWER&&t(n);break;case e.TERMINATED:break;default:t(n)}e.state=n},this.complete=function(){e.changing=!1}}function g(e,t,y){function V(e,t){e.type=e.type||f.default.MEDIA_ERROR.iceConnectionError,e.detail=e.detail||"none";var n=ut(P,f.default.MEDIA_LABEL.audio)||P[0];n&&n.getTransportId()===t&&(S.error("primary transport disconnected, ending call"),ft(e))}function $(e){var t=ut(P,f.default.MEDIA_LABEL.audio);t&&t.getTransportId()===e&&(S.log("audio channel transport connected"),N.callbacks.onAudioStateChanged(f.default.STREAMING_STATE.active)),N.callbacks.onTransportConnected&&N.callbacks.onTransportConnected()}function nt(e){if(e===f.default.MEDIA_TYPE.audio)return l.MediaChannelType.Audio;if(e===f.default.MEDIA_TYPE.video)return l.MediaChannelType.Video;throw new Error("Error in media descriptors descr.type: "+e)}function rt(n){n===void 0&&(n=!1);var r=h.shallowClone(e);r.config=h.shallowClone(e.config),n&&(r.config.isConference=!0);var i=new g(r,t,y);return b&&(i.relayManagerProvider=b),i.callbacks.onNegotiationRequired=this.callbacks.onNegotiationRequired,i}function it(e){e.allowedModalities&&(I=e.allowedModalities),e.renderers&&(Q&&Q.terminate(),Q=e.renderers,Q.reset(),Mt())}function st(e){e.setInternals({renderers:Q,allowedModalities:I}),e.setMuteAsync(T),Q=null,this.callbacks.onTerminated=null}function ot(e){var t=0;for(var n=0;n<e.length;n++){if(e[n].label===f.default.MEDIA_LABEL.audio&&!P[n]){var i=S.createChild("AStrm_"+e[n].mediaId+":");P[n]=new r.default(e[n].mediaId,i,w,nt(e[n].type),e[n].label,N,G,!1)}else if(e[n].label===f.default.MEDIA_LABEL.video){if(!P[n]){var i=S.createChild("VStrm_"+e[n].mediaId+":");P[n]=new r.default(e[n].mediaId,i,w,nt(e[n].type),e[n].label,N,G,!1)}t++}else if(e[n].label===f.default.MEDIA_LABEL.sharing&&!P[n]){var i=S.createChild("SStrm_"+e[n].mediaId+":"),s=!e[n].send;P[n]=new r.default(e[n].mediaId,i,w,nt(e[n].type),e[n].label,N,G,s)}P[n]&&(P[n].setMute(T),P[n].preconfigureChannel(e[n]));if(P[n]&&P[n].getLabel()!==e[n].label)throw new Error("Error in media descriptors ch.label: "+P[n].getLabel()+" descr.label: "+e[n].label)}}function ut(e,t){for(var n=0;n<e.length;n++)if(e[n].getLabel()===t)return e[n];return null}function at(){var e=[];for(var t=0;t<P.length;t++)P[t]&&(e[t]=P[t].getLocalParameters());return e}function ft(e){S.error("Media error occurred","type:",e.type,"detail:",e.detail),N.callbacks.onSessionErrorOccurred&&N.callbacks.onSessionErrorOccurred(e)}function lt(e){if(e){var t={};return h.forOwn(e,function(e,n){try{t[n]=typeof e=="function"?t[n]=e():t[n]=e}catch(r){t[n]="error: "+r}}),JSON.stringify(t)}}function ct(e){e?S.error("_audio.onerror",lt(e)):S.error("_audio.onerror","error:",A?A.error:"<no audio element>")}function ht(e){A?(A.removeEventListener("error",ct),A.addEventListener("error",ct),window.detachMediaStream(A)):(A=document.createElement("audio"),document.body.appendChild(A),A.autoplay=!0,A.addEventListener("error",ct));var t=new MediaStream([e]);window.attachMediaStream(A,t)}function pt(){A&&(A.removeEventListener("error",ct),document.body.removeChild(A),window.detachMediaStream(A),A=null)}function dt(e){D.state===D.STABLE&&!D.changing?(D.change(D.NEGOTIATION_REQUESTED),S.log("triggerNegotiation","mods:",JSON.stringify(B),"force:",e),q=!1,N.callbacks.onNegotiationRequired&&N.callbacks.onNegotiationRequired()):e&&(q=!0)}function vt(e){var t=Y.then(function(){return new Promise(function(t){if(!e||!e.audio&&!e.video&&!e.sharing)throw new Error("Invalid parameters!"+JSON.stringify(e));var n=!B||!c.areNegotiatedDirectionsFulfilled(e,H);B=e,n&&dt(),t(B)})});return Y=t.catch(function(e){S.warn("Error during configuring modalities: ",e)}),t}function mt(){return B}function gt(e){I={audio:[f.default.MEDIA_STATE.inactive,f.default.MEDIA_STATE.receive],video:[f.default.MEDIA_STATE.inactive,f.default.MEDIA_STATE.receive],sharing:[f.default.MEDIA_STATE.inactive,f.default.MEDIA_STATE.receive]},e.audio&&(I.audio.push(f.default.MEDIA_STATE.send),I.audio.push(f.default.MEDIA_STATE.sendReceive)),e.video&&(I.video.push(f.default.MEDIA_STATE.send),I.video.push(f.default.MEDIA_STATE.sendReceive))}function yt(){return I}function bt(e){return new Promise(function(t){R=!1;var n=e.blob;S.debug("PROCESS OFFER","sdp:",n),h.throwIfNotSupported(e.contentType,X),D.change(D.HAVE_REMOTE_OFFER);var r;r=O.sdpToParams(n),L.processOffer(r),k=r.transportParams,j=c.invertModalities(a.default.getModalitiesFromMedia(r.media)),t(j)})}function wt(e){var t=0;return e.forEach(function(e){e.needsTransport&&t++}),t}function Et(e,t){N.callbacks.onAudioQualityChanged&&N.callbacks.onAudioQualityChanged({type:e,value:t?3:1,isLocalSource:!0,mediaType:0})}function St(e){if(J.hasIceCandidates(e)==M){M=!M,Et(37,M);if(M)throw{type:f.default.MEDIA_ERROR.noNetworkError,detail:"no ice candidates"}}J.hasIceCandidates(e)&&J.hasRelayIceCandidates(e)==_&&(_=!_,Et(32,_))}function xt(e){return new Promise(function(t){if(e){D.change(D.HAVE_LOCAL_PRANSWER,!0),t({blob:"",contentType:W,modalities:{audio:"sendrecv",video:"sendrecv",sharing:"sendrecv"}});return}D.change(D.HAVE_LOCAL_ANSWER,!0);if(!B)throw new Error("Modalities not configured for answer");F=c.excludePassiveModalities(B,Z,j);var n=L.createMediaDescriptorsForAnswer(F),r=J.assureInitAsync("controlled",wt(n)).then(function(){return J.waitIceCompletionIfNeededAsync(k).then(function(){return J.getLocalParamsAsync().then(function(t){St(t),ot(n);var r=L.createAnswer(n,t,at(),e);D.complete(),N.callbacks.onTransportInitialized&&N.callbacks.onTransportInitialized();var i=O.paramsToSdp(r);return S.debug(e?"CREATE PRANSWER":"CREATE ANSWER","sdp:",i),{blob:i,contentType:W,modalities:F}})})});t(r)})}function Tt(){return new Promise(function(e){R=!0,D.change(D.HAVE_LOCAL_OFFER,!0),F=c.excludePassiveModalities(B,Z,j),j&&j.video&&(j.video===f.default.MEDIA_STATE.send||j.video===f.default.MEDIA_STATE.sendReceive)&&(B.video===f.default.MEDIA_STATE.inactive||B.video===f.default.MEDIA_STATE.receive)&&P.forEach(function(e){e.getMediaParameters().descr.label===f.default.MEDIA_LABEL.video&&e.stopSender()}),j=F;if(c.hasSendDirectionality(F.sharing)&&!w.allowSendScreensharing)throw new Error("unsupported shreensharing send directionality in _negotiatingModalities"+JSON.stringify(F));var t=L.createMediaDescriptorsForOffer(F),n=J.assureInitAsync("controlling",wt(t)).then(function(){return J.getLocalParamsAsync().then(function(e){St(e),ot(t);var n=L.createOffer(t,e,at());D.complete();var r=O.paramsToSdp(n);return S.debug("CREATE OFFER","sdp:",r),{blob:r,contentType:W,modalities:F}})});e(n)})}function Nt(e,t){return new Promise(function(n){var r=e.blob;S.debug(t?"PROCESS PRANSWER":"PROCESS ANSWER","sdp:",r),h.throwIfNotSupported(e.contentType,X);if(t)D.change(D.HAVE_REMOTE_PRANSWER),S.log("ignoring provisional answer"),n();else{D.change(D.HAVE_REMOTE_ANSWER);var i;i=O.sdpToParams(r),L.processAnswer(i),N.callbacks.onTransportInitialized&&N.callbacks.onTransportInitialized(),n(c.invertModalities(a.default.getModalitiesFromMedia(i.media)))}})}function Ct(e){var t=e.audio,n=e.video,r,i;return t&&(r=x.getAudioStream()),n&&(i=x.getVideoStream()),{audioStream:r,videoStream:i}}function kt(e){var t=a.default.findDescrFromMedia(e,f.default.MEDIA_LABEL.audio),n=a.default.findDescrFromMedia(e,f.default.MEDIA_LABEL.video),r=a.default.findDescrFromMedia(e,f.default.MEDIA_LABEL.sharing);return Ct({audio:t.send,video:n.send||r.send})}function Lt(e){var t=[];return e.forEach(function(e){e.descr.enabled&&t.indexOf(e.descr.transportId)===-1&&t.push(e.descr.transportId)}),t}function At(e){P.forEach(function(t,n){t.setTransportId(e[n].descr.transportId)})}function Ot(){return new Promise(function(e){D.change(D.STABLE,!0);var t=L.completeNegotiation(),n=t.media,r=kt(n),i=r.audioStream,s=r.videoStream,o=function(e){var t=arguments[1];i&&i.dispose(),s&&s.dispose();if(e)return t;throw t};At(n),e(Promise.all([J.configureTransportAsync(t,Lt(n)),i?i.start():Promise.resolve(),s?s.start():Promise.resolve()]).then(function(){Ft();for(var e=0;e<n.length;e++){var t=void 0;P[e]&&(t=J.getTransportById(P[e].getTransportId()));if(n[e].descr.label===f.default.MEDIA_LABEL.audio){var r=P[e].getRecvTrack();P[e].configureChannel(n[e],t,i),P[e].getRecvTrack()&&P[e].getRecvTrack()!==r?ht(P[e].getRecvTrack()):!P[e].getRecvTrack()&&r&&pt()}else n[e].descr.label===f.default.MEDIA_LABEL.video?P[e].configureChannel(n[e],t,s):n[e].descr.label===f.default.MEDIA_LABEL.sharing&&P[e].configureChannel(n[e],t,s)}Mt(),D.complete(),H=a.default.getModalitiesFromMedia(n);var o=c.excludePassiveModalities(B,Z,j),u=q||!c.areNegotiatedDirectionsAcceptable(o,F,H);return u&&dt(),S.log("_completeNegotiationAsync: configured:",JSON.stringify(B),"_negotiatingModalities:",JSON.stringify(F),"activeModalities:",JSON.stringify(H)),{isComplete:!u,activeModalities:H,offeredModalities:j,attemptedModalities:F,configuredModalities:B,initiator:R}}).then(o.bind(null,!0),o.bind(null,!1)))})}function Mt(){Q.update(P.filter(function(e){return f.default.MEDIA_LABEL.video===e.getLabel()||f.default.MEDIA_LABEL.sharing===e.getLabel()}))}function _t(e,t){return new Promise(function(n){var r=e===f.default.RENEGOTIATION_ERROR.local;D.state=D.STABLE,S.error("negotiation failed","error:",e),t&&(S.log("retrying failed negotiation"),dt()),n({isComplete:r,activeModalities:H,offeredModalities:j,attemptedModalities:F,configuredModalities:B,initiator:R})})}function Dt(e,t){return Q.create(e,t)}function Pt(){S.log("_deviceSelectionChanged");var e=c.hasSendDirectionality(H.audio),t=c.hasSendDirectionality(H.video);if(!jt()&&(e||t)){var n=Ct({audio:e,video:t}),r=n.audioStream,i=n.videoStream;Promise.all([r?r.start():Promise.resolve(),i?i.start():Promise.resolve()]).then(function(){var n;e&&r&&(n=ut(P,f.default.MEDIA_LABEL.audio),n.updateLocalMediaStream(r)),t&&i&&(n=ut(P,f.default.MEDIA_LABEL.video),n.updateLocalMediaStream(i)),r&&r.dispose(),i&&i.dispose()}).catch(function(e){ft({type:f.default.MEDIA_ERROR.internalError,detail:e}),r&&r.dispose(),i&&i.dispose()})}}function Ht(){return{type:"OrtcMediaStats",data:{}}}function Bt(){return jt()?K:(K=new Promise(function(e){var n={type:"OrtcMediaStats",data:{}};n.localStreams=[{tracks:[]}],n.remoteStreams=[{tracks:[]}];var r=ut(P,f.default.MEDIA_LABEL.audio),i=ut(P,f.default.MEDIA_LABEL.video),s=ut(P,f.default.MEDIA_LABEL.sharing);r&&r.getSendTrack()&&n.localStreams[0].tracks.push({stream:null,track:r.getSendTrack()}),i&&i.getSendTrack()&&n.localStreams[0].tracks.push({stream:null,track:i.getSendTrack()}),s&&s.getSendTrack()&&n.localStreams[0].tracks.push({stream:null,track:s.getSendTrack()}),r&&r.getRecvTrack()&&n.remoteStreams[0].tracks.push({stream:null,track:r.getRecvTrack()}),i&&i.getRecvTrack()&&n.remoteStreams[0].tracks.push({stream:null,track:i.getRecvTrack()}),s&&s.getRecvTrack()&&n.remoteStreams[0].tracks.push({stream:null,track:s.getRecvTrack()}),Promise.all([r?r.getReportsAsync():{},i?i.getReportsAsync():{},s?s.getReportsAsync():{}]).then(function(r){n.data={CorrelationId:t,mainAudio:r[0],mainVideo:r[1],appsharingVideo:r[2]},e(n)}).catch(function(t){S.error("getting statistics should never fail:",t),e(n)})}),K)}function jt(){return D.state===D.TERMINATED}function Ft(){if(jt())throw new Error("session is already terminated")}function It(){return S.log("terminate"),Bt().then(function(){D.change(D.TERMINATED),qt()},qt)}function qt(){et.dispose(),tt.dispose(),J.stop(),pt(),Q&&Q.terminate(),P.forEach(function(e){e.terminate()}),N.callbacks.onTerminated&&N.callbacks.onTerminated(),y=null}function Rt(){return w.enableReconnectEdge}function Ut(){return Wt(!0)}function zt(){return Wt(!1)}function Wt(e){return T=e,P.forEach(function(t){t.setMute(e)}),Promise.resolve()}function Xt(e){var t=ut(P,f.default.MEDIA_LABEL.audio);return t?t.sendDtmf(e):Promise.reject(new Error("no audio channel"))}function Vt(){var e=ut(P,f.default.MEDIA_LABEL.audio);return e?e.canSendDtmf():!1}function $t(){return et}this.configureModalitiesAsync=vt,this.getConfiguredModalities=mt,this.getAllowedModalities=yt,this.processOfferAsync=bt,this.createAnswerAsync=xt,this.createOfferAsync=Tt,this.processAnswerAsync=Nt,this.completeNegotiationAsync=Ot,this.rejectNegotiationAsync=_t,this.createRemoteRenderer=Dt,this.sendDtmf=Xt,this.canSendDtmf=Vt,this.getLastKnownStats=Ht,this.getStatsAsync=Bt,this.terminate=It,this.isReconnectSupported=Rt,this.muteInputAsync=Ut,this.unmuteInputAsync=zt,this.setMuteAsync=Wt,this._deviceSelectionChanged=Pt,this._devicePermissionsChanged=gt,this.onContributingSourcesChanged=null,this.callbacks={},this.getExtensionsManager=$t,this.clone=rt,this.setInternals=it,this.move=st,this.getAcceptedTypes=function(){return X};var b,w=e.maContext.settings,E=e.config.iceTransportPolicy?e.config.iceTransportPolicy:f.default.ICE_TRANSPORT_POLICY.all,S=e.getLogger().createChild("ortc"),x=e.getDeviceManager(),T=e.config.muted,N=this,C=!e.config.isConference,k=null,L=new i.default(S,w,e.config.isConference),A=null,O=new s.default,M=!1,_=!1,D=new m,P=[],H={},B,j,F,I={audio:[f.default.MEDIA_STATE.inactive,f.default.MEDIA_STATE.receive,f.default.MEDIA_STATE.send,f.default.MEDIA_STATE.sendReceive],video:[f.default.MEDIA_STATE.inactive,f.default.MEDIA_STATE.receive,f.default.MEDIA_STATE.send,f.default.MEDIA_STATE.sendReceive],sharing:[f.default.MEDIA_STATE.inactive,f.default.MEDIA_STATE.receive,f.default.MEDIA_STATE.send,f.default.MEDIA_STATE.sendReceive]},q=!1,R=!1,U={triggerIceReinvite:function(){if(w.disableIceReinvite){S.log("ICE-reinvite disabled - triggerIceReinvite skipped");return}S.log("triggerIceReinvite"),dt(!0)},onConnected:$,onError:V},z=!1,W=w.ortcMediaContentType||f.default.CONTENT_TYPE.SDP,X=w.ortcAllowedMediaContentType||f.default.ALLOWED_CONTENT_TYPES.SDP_ONLY,J=new n.default(S,w,U,e.config.isRemoteClientLync,E,C),K=Promise.resolve({}),Q=u.default.build({logger:S,settings:w}),G=new o.default,Y=Promise.resolve(),Z=e.config.passiveModalities,et=new p.default,tt=new d.ActiveSpeakerManager(y.onContributingSourcesChanged,y.onDominantSpeakerChanged);Object.defineProperty(this,"relayManagerProvider",{set:function(e){b=e,J.relayManagerProvider=b}}),tt.setStrategy(new v.DSHGeneratingStrategy(e.maContext.settings.activeSpeaker)),S.log("create session","config:",e.config),this.onError=function(e){ft(e)},this.onMediaCapabilitiesChanged=function(e,t){L.onMediaCapabilitiesChanged(e,t),D.state!==D.HAVE_LOCAL_ANSWER&&dt(!0)},this.onContributingSourcesChanged=function(e){D.state===D.STABLE&&!D.changing&&tt.onContributingSourcesChanged(e)}}var n=e("./ortcTransport"),r=e("./ortcMediaChannel"),i=e("./ortcNegotiation"),s=e("./ortcSdp"),o=e("../common/ssrcGenerator"),u=e("./ortcVideoRendererGroup"),a=e("./ortcHelper"),f=e("../constants"),l=e("./ortcConstants"),c=e("../helper"),h=e("../common/utils"),p=e("../extensions/extensionsManager"),d=e("../common/activeSpeaker/activeSpeakerManager"),v=e("../common/activeSpeaker/dshGeneratingStrategy");Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e,t,n){return new g(e,t,n)}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/stream/videoStreamWatcher",["require","exports"],e)}(function(e,t){var n=function(){function e(e,t){this.callbacks=t,this.streamIsActive=!1,this.statsGathererSubscribed=!1,this.lastReceivedFps=0,this.lastFramesDecoded=0,this.statisticsGatherer=e.statsGatherer,this._logger=e.logger.createChild("streamWatcher"),this.recoverWaitTimeout=e.recoverWaitTimeout}return e.prototype.watchStream=function(e){if(this.currentStream==e)return;this.currentStream=e,this.startMonitoringStats(),this.disposeTimer()},e.prototype.stopWatchingStream=function(e){e==this.currentStream&&(this.currentStream=null,this.disposeTimer())},e.prototype.dispose=function(){this.callbacks=undefined,this.disposeTimer()},e.prototype.disposeTimer=function(){this.resetTimeoutId&&(clearTimeout(this.resetTimeoutId),this.resetTimeoutId=undefined)},e.prototype.startMonitoringStats=function(){var e=this;if(this.statsGathererSubscribed)return;this.statisticsGatherer.onStatisticsChanged(function(t){return e.onStatisticsChanged(t)}),this.statsGathererSubscribed=!0},e.prototype.onStatisticsChanged=function(e){if(!this.currentStream)return;var t=e.videoStreams[this.currentStream.id];if(!t){this._logger.warn("WebRTC Stats for video stream "+this.currentStream.id+" not found");return}this.lastReceivedFps=t.frameRateReceived;if(this.lastReceivedFps<=0)return;t.frameRateDecoded<=0?this.streamBroken||this.scheduleResetScreenShare():(this.streamIsActive||(this._logger.info("Video stream is active now"),this.callbacks.onStreamIncomingDecoderActive(),this.lastFramesDecoded>t.framesDecoded&&this.callbacks.onStreamIncomingDecoderReset()),this.streamIsActive=!0,this.disposeTimer()),this.lastFramesDecoded=t.framesDecoded},Object.defineProperty(e.prototype,"streamBroken",{get:function(){return this.resetTimeoutId!==undefined},enumerable:!0,configurable:!0}),e.prototype.scheduleResetScreenShare=function(){var e=this;this.resetTimeoutId=setTimeout(function(){e.resetTimeoutId=undefined,e.streamIsActive=!1,e._logger.error("Decoding 0 frameRate while receiving "+e.lastReceivedFps+", asking for recovery"),e.callbacks.onStreamIncomingDecoderFailed()},this.recoverWaitTimeout)},e}();t.VideoStreamWatcher=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/sessionDescriptorUtils",["require","exports","../constants","../common/utils"],e)}(function(e,t){function i(e,t,n){e.rtp&&e.rtp.some(function(r,i){var s=r.payload;if(t.name.toLowerCase()!==r.codec.toLowerCase()||t.rate!==r.rate||t.encoding!==r.encoding)return!1;var o={rtp:r};e.fmtp=e.fmtp||[];var u=e.fmtp.some(function(e){return r.payload!==e.payload?!1:(o.fmtp=e,!0)}),a=n(o);return a===null?(e.payloads=e.payloads.toString().split(" ").filter(function(e){return r.payload!==+e}).join(" "),e.fmtp=e.fmtp.filter(function(e){return r.payload!==e.payload}),e.rtp.splice(i,1)):(o.rtp.payload!==s&&(e.payloads=e.payloads.toString().split(" ").map(function(e){return+e===s?o.rtp.payload:+e}).join(" "),o.fmtp&&(o.fmtp.payload=o.rtp.payload)),!u&&o.fmtp&&e.fmtp.push(o.fmtp)),!0})}function s(e,t){var n=-1;e.rtp.forEach(function(e,r){t.codec.toLowerCase()===e.codec.toLowerCase()&&t.rate===e.rate&&t.encoding===e.encoding&&(n=r)});if(n>=0&&e.rtp.length>1){var r=e.rtp[n].payload;e.rtp.splice(n,1),e.payloads=e.payloads.split(" ").filter(function(e){return r!==+e}).join(" "),e.fmtp=e.fmtp.filter(function(e){return r!==e.payload})}}function o(e){if(e.label){if(n.default.MEDIA_LABEL.audio===e.label)return n.default.MODALITY.audio;if(n.default.MEDIA_LABEL.video===e.label)return n.default.MODALITY.video;if(n.default.MEDIA_LABEL.sharing===e.label)return n.default.MODALITY.sharing;if(n.default.MEDIA_LABEL.data===e.label)return n.default.MODALITY.data}else{if(n.default.MEDIA_TYPE.audio===e.type)return n.default.MODALITY.audio;if(n.default.MEDIA_TYPE.video===e.type)return n.default.MODALITY.video;if(n.default.MEDIA_TYPE.data===e.type)return n.default.MODALITY.data}return null}function u(e){return n.default.MODALITY.audio===e?n.default.MEDIA_LABEL.audio:n.default.MODALITY.video===e?n.default.MEDIA_LABEL.video:n.default.MODALITY.sharing===e?n.default.MEDIA_LABEL.sharing:n.default.MODALITY.data===e?n.default.MEDIA_LABEL.data:null}function a(e){return e.media.reduce(function(e,t){if(t.port!==0){var r=o(t);if(!(r in e)){var i=t.direction?t.direction.toLowerCase():n.default.MEDIA_STATE.sendReceive;e[r]=i}}return e},{})}function f(e){switch(e){case n.default.MODALITY.audio:return n.default.MEDIA_TYPE.audio;case n.default.MODALITY.video:case n.default.MODALITY.sharing:return n.default.MEDIA_TYPE.video;case n.default.MODALITY.data:return n.default.MEDIA_TYPE.data;default:return null}}function l(e){var t;if(e.groups){var n=r.find(e.groups,function(e){return"BUNDLE"===e.type});if(n){var i=n.mids.split(" ")[0];t=r.find(e.media,function(e){var t=typeof e.mid=="number"?e.mid.toString():e.mid;return i===t})}}return t||null}var n=e("../constants"),r=e("../common/utils");t.forCodec=i,t.removeCodec=s,t.getModality=o,t.getLabelForModality=u,t.getModalities=a,t.getTypeFromModality=f,t.getBundle=l}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/transform/candidateTransform",["require","exports","../sessionDescriptorUtils"],e)}(function(e,t){function r(){function t(e,t){if(e.port&&!e.candidates.length){var r=n.getBundle(t);r&&(e.port=r.port,e.connection=r.connection)}}function r(e,t){delete e.generation,e.transport.match(/tcp/i)&&i(e,t)}function i(t,n){e.some(function(e){if(n){if(e.msSdp===t.transport.toLowerCase())return t.transport="tcp",t.tcptype=e.jsep,!0}else if(t.tcptype&&e.jsep===t.tcptype.toLowerCase())return t.transport=e.msSdp,delete t.tcptype,!0;return!1})}function s(e,t,n){var r=t.connection||n.connection,i=function(e,t,n){return e.port===n&&e.ip===t};return r?1===e.component?i(e,r.ip,t.port):t.rtcp?i(e,t.rtcp.ip||r.ip,t.rtcp.port):!1:!1}var e=[{jsep:"active",msSdp:"tcp-act"},{jsep:"passive",msSdp:"tcp-pass"},{jsep:"so",msSdp:"tcp-so"}];this.fromMsSdp=function(e){e.candidates=e.candidates||[],e.xCandidatesIpv6&&(e.xCandidatesIpv6.forEach(function(t){e.candidates.push(t)}),delete e.xCandidatesIpv6),e.candidates.forEach(function(e){r(e,!0)})},this.toMsSdp=function(e,n){e.candidates=e.candidates||[],e.candidates.sort(function(t,r){return t.foundation!==r.foundation?t.foundation-r.foundation:t.component!==r.component?t.component-r.component:+s(r,e,n)- +s(t,e,n)}),e.candidates=e.candidates.filter(function(t,n){r(t,!1);var i=e.candidates[n-1];return!i||i.component!==t.component||i.foundation!==t.foundation}),t(e,n)}}var n=e("../sessionDescriptorUtils");Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(){return new r}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/webRtcConstants",["require","exports"],e)}(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default={STREAM_ID:{audio:"mainAudio",video:"mainVideo",sharing:"applicationsharingVideo"},STREAM_ID_DELIMITER:"-"}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/transform/streamTransform",["require","exports","../../constants","../../common/utils","../webRtcConstants"],e)}(function(e,t){function u(){function e(e){if(e.ssrcGroups){var t;e.ssrcGroups.some(function(e){return"FID"===e.semantics?(t=e,!0):!1});if(t)return t.ssrcs.split(" ").map(function(e){return+e})}return[]}function t(e,t,n,r){e.ssrcs=e.ssrcs||[],e.ssrcs.push({attribute:"cname",id:t,value:n}),e.ssrcs.push({attribute:"msid",id:t,value:r})}function n(e,t){e.filter(function(e){return"msid"===e.attribute}).forEach(function(e){var n=e.value.split(" ");e.value=t(n[0],n[1]||n[0])})}function r(e,t,n){var r=u(n);return r+e+" "+r+t}function u(e){return s[e]?s[e]+i.default.STREAM_ID_DELIMITER:""}function a(e){return"recvonly"===e.direction}this.fromMsSdp=function(i){if(0===i.port)return;if(!a(i)){if(i.msid){i.ssrcs&&i.ssrcs.length===1&&(t(i,i.ssrcs[0].id,i.ssrcs[0].value,i.msid),i.ssrcs.shift());var s=i.msid.split(" ");i.msid=r(s[0],s[1]||s[0],i.label)}if(i.ssrcs)n(i.ssrcs,function(e,t){return r(e,t,i.label)});else{var u=e(i);u.length>0?u.forEach(function(e){t(i,e,o,r(u[0],u[0],i.label))}):i.xSsrcRange&&t(i,i.xSsrcRange.ssrcMin,o,r(i.xSsrcRange.ssrcMin,i.xSsrcRange.ssrcMin,i.label))}}delete i.xSsrcRange},this.toMsSdp=function(e){if(0===e.port)return;var t;e.ssrcs&&e.ssrcs[0]&&(t=e.ssrcs[0].id),void 0!==t&&(e.xSsrcRange={ssrcMin:t,ssrcMax:t})}}var n=e("../../constants"),r=e("../../common/utils"),i=e("../webRtcConstants"),s=[{label:n.default.MEDIA_LABEL.audio,id:i.default.STREAM_ID.audio},{label:n.default.MEDIA_LABEL.video,id:i.default.STREAM_ID.video},{label:n.default.MEDIA_LABEL.sharing,id:i.default.STREAM_ID.sharing}].reduce(function(e,t){return e[t.label]=t.id,e},{}),o=r.uniqueId();Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(){return new u}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/transform/rtcpTransform",["require","exports"],e)}(function(e,t){function n(){this.toMsSdp=function(e,t,n){"offer"===n.type?e.rtcp&&(e.rtcp={port:e.port}):delete e.rtcp}}Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(){return new n}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/transform/msSdpTransform",["require","exports","./candidateTransform","./streamTransform","./rtcpTransform","../../helper","../../common/userAgentAdapter","../../constants"],e)}(function(e,t){function l(e){function v(e,n){return e.msidSemantic={semantic:"WMS",token:"*"},e.media.forEach(function(r){r.protocol=f.rtpSavp,r.label=r.label||b(r.type);if(r.port===0){for(var i in r)r.hasOwnProperty(i)&&["type","port","protocol","payloads"].indexOf(i)<0&&delete r[i];r.payloads=34}p.toMsSdp(r),r.crypto&&r.crypto.forEach(function(e){e.config+="|2^31"}),r.port!==0&&e.fingerprint&&(r.fingerprint=e.fingerprint),h.toMsSdp(r,e),d.toMsSdp(r,e,n),r.invalid&&(t.error("Unknown SDP attributes!",r.invalid),delete r.invalid),g(r,!1),r.port!==0&&(r.type===u.default.MEDIA_TYPE.audio&&l.webrtcAudioChannelSignalingFeedback?r.signalingFbXMessage={payload:"*",param:l.webrtcAudioChannelSignalingFeedback}:r.type===u.default.MEDIA_TYPE.video&&l.webrtcVideoChannelSignalingFeedback&&(r.signalingFbXMessage={payload:"*",param:l.webrtcVideoChannelSignalingFeedback}))}),delete e.fingerprint,e}function m(e,t){var n=s.getSrtpInfo(e);for(var r=e.media.length-1;r>=0;--r){var i=e.media[r];if(i.ssrcs&&i.ssrcs[0]||i.xSsrcRange)e.msidSemantic={semantic:"WMS",token:"*"};i.protocol=f.udpTlsRtpSavpf;if(!n.dtls||n.sdes&&l.preferSdesSrtp)i.protocol=f.rtpSavpf;if(i.port===0){i.direction||(i.direction="inactive");continue}p.fromMsSdp(i),delete i.cryptoscale,i.fingerprint&&y(t)&&(i.setup="actpass");if(i.crypto)for(var o=i.crypto.length-1;o>=0;--o){var u=i.crypto[o];if(u.config.match(/.*\|\d+:\d+/)){i.crypto.splice(o,1);continue}u.config=u.config.replace(/(.*)\|2\^\d+/,"$1")}i.remoteCandidates&&(delete i.candidates,delete i.xCandidatesIpv6,delete i.remoteCandidates),h.fromMsSdp(i),i.rtcpFbXMessage&&delete i.rtcpFbXMessage,g(i,!0)}return e}function g(e,t){var n=[{name:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",encoded:"http:\\\\www.webrtc.org\\experiments\\rtp-hdrext\\abs-send-time"}];e.ext&&e.ext.forEach(function(e){n.some(function(n){var r=t?n.encoded:n.name,i=t?n.name:n.encoded;return r===e.uri?(e.uri=i,!0):!1})})}function y(e){return"offer"===e.type}function b(e){return a.hasOwnProperty(e)&&a[e]||"undefined"}this.toMsSdp=v,this.fromMsSdp=m;var t=e.logger,l=e.settings,c=o.default.window,h=n.default.build(),p=r.default.build(),d=i.default.build()}var n=e("./candidateTransform"),r=e("./streamTransform"),i=e("./rtcpTransform"),s=e("../../helper"),o=e("../../common/userAgentAdapter"),u=e("../../constants"),a={audio:"main-audio",video:"main-video"},f={udpTlsRtpSavpf:"UDP/TLS/RTP/SAVPF",rtpSavpf:"RTP/SAVPF",rtpSavp:"RTP/SAVP"};Object.defineProperty(t,"__esModule",{value:!0}),t.default=l}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/webRtcSessionDescription",["require","exports","microsoft-sdp-transform","../constants","../helper","./transform/msSdpTransform","../common/formatParameters","./sessionDescriptorUtils"],e)}(function(e,t){function a(e,t,a,f){function b(e){e.media.forEach(function(e,t){var n=p.getMediaEntity(t);if(n.getType()!==r.default.MEDIA_TYPE.video)return;return u.forCodec(e,{name:"h264",rate:9e4},function(e){var t=n.getVideoCapabilities();if(!t)return;e.fmtp=e.fmtp||{payload:e.rtp.payload};var r=o.default.build(e.fmtp.config);r.setIfMissing("profile-level-id","42C02A"),r.setIfMissing("max-fs",t.getMaxFS()),r.setIfMissing("max-fps",t.getMaxFPS()),e.fmtp.config=r.toString()}),!0})}function w(e,t){return e.some(function(e){return e.settings.indexOf(t)!==-1})}function E(){t==="answer"&&m.groups&&(e.bundled=!0)}var l=e.settings,p=e.mediaManager,d=e.sdpTransform,v=e.logger,m=n.parse(a),g=new s.default(e),y;this.getModalities=function(){return y||u.getModalities(m)},this.updateModalities=function(e){y=e},this.getSrtpInfo=function(){return i.getSrtpInfo(m)},this.getVideoCodecs=function(){var e={};m.media.forEach(function(t){t.type==="video"&&t.rtp.map(function(e){return e.codec.toLowerCase()}).forEach(function(t){e[t]=!0})});var t=[];for(var n in e)t.push(n);return t},this.usePrimaryAudioCodecOnly=function(e){var t=["cn","telephone-event"];m.media.forEach(function(n){if(n.type===r.default.MEDIA_TYPE.audio){var i=n.rtp.filter(function(n){return e.indexOf(n.codec.toLowerCase())!==-1&&t.indexOf(n.codec.toLowerCase())===-1});if(i.length===0)throw new Error("there is no matching primary audio codec");var s=n.rtp.filter(function(e){return e!==i[0]&&t.indexOf(e.codec.toLowerCase())===-1});s.forEach(function(e){u.removeCodec(n,e)})}})},this.isCodecSwitchSupported=function(){return!m.media.some(function(e){return e.type===r.default.MEDIA_TYPE.audio&&e.xMediaSettings&&w(e.xMediaSettings,"codecswitchunsupported")})},this.toLocal=function(){return m=d.toLocal(m,p,y),n.write(m)},this.toOffer=function(){return h(m,function(e,t){c(l,t)}),p.isEmpty()&&p.fromOffer(m,y),p.syncModalities(y,!1),m=d.toOffer(m,p,y),l.disableMsSdp||g.toMsSdp(m,{type:t}),b(m),y=u.getModalities(m),n.write(m)},this.toAnswer=function(){return h(m,function(e,t){c(l,t)}),p.syncModalities(y,!0),m=d.toAnswer(m,p,y),l.disableMsSdp||g.toMsSdp(m,{type:t}),b(m),y=u.getModalities(m),n.write(m)},this.toRemote=function(e){return y=e,p.fromRemote(m,y),m=d.toRemote(m,p,y),n.write(m)},this.getVideoRecvCapabilities=function(){var e={};return m.media.filter(function(e){return e.type==="video"}).some(function(t){return u.forCodec(t,{name:"h264",rate:9e4},function(t){if(t.fmtp){var n=o.default.build(t.fmtp.config),r=+n.get("max-fs");!isNaN(r)&&r&&(e.maxFS=r);var i=+n.get("max-fps");!isNaN(i)&&i&&(e.maxFPS=i/100)}}),!0}),e},this.needToWaitIceCandidates=function(){if(e.bundled){var t=u.getBundle(m);return t&&t.port===9}return m.media.some(function(e){return e.port===9})},this.hasIceCandidates=function(){return!!m.media&&m.media.some(function(e){return!!e.candidates&&e.candidates.length!==0})},this.hasRelayIceCandidates=function(){return this.hasIceCandidates()&&m.media.some(function(e){return!!e.candidates&&e.candidates.some(function(e){return e.type==="relay"})})},function(){f&&!l.disableMsSdp&&g.fromMsSdp(m,{type:t}),E()}()}function f(e,t,r,i){var o=e.settings,u=new s.default(e),a=n.parse(r);return h(a,function(e,t){t.port!==0&&!i[e]&&l(t),t.direction="inactive",c(o,t)}),o.disableMsSdp||u.toMsSdp(a,{type:t}),n.write(a)}function l(e){e.port=0;for(var t in e)e.hasOwnProperty(t)&&["type","port","protocol","payloads","connection","direction"].indexOf(t)<0&&(delete e[t],e.direction="inactive")}function c(e,t){t.candidates&&(e.iceCandidateType||e.iceCandidateTransport)&&(t.candidates=t.candidates.filter(function(t){var n=!0,r=!0;return e.iceCandidateType&&(n=t.type.match(new RegExp(e.iceCandidateType),"i")),e.iceCandidateTransport&&(r=t.transport.match(new RegExp(e.iceCandidateTransport,"i"))),n&&r}))}function h(e,t){for(var n=0;n<e.media.length;n++)e.media[n].type==="audio"?t(r.default.MEDIA_TYPE.audio,e.media[n]):e.media[n].type==="video"&&t(r.default.MEDIA_TYPE.video,e.media[n])}var n=e("microsoft-sdp-transform"),r=e("../constants"),i=e("../helper"),s=e("./transform/msSdpTransform"),o=e("../common/formatParameters"),u=e("./sessionDescriptorUtils");Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e){return e=e||{},{createLocalOffer:function(t){return new a(e,"offer",t)},createRemoteOffer:function(t){return new a(e,"offer",t,!0)},createLocalAnswer:function(t){return new a(e,"answer",t)},createRemoteAnswer:function(t){return new a(e,"answer",t,!0)},createInactiveOfferSdp:f.bind(null,e,"offer"),createInactiveAnswerSdp:f.bind(null,e,"answer")}}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/adapter/webkitSessionDescription",["require","exports","../../common/userAgentAdapter"],e)}(function(e,t){function i(){var e=[].slice.apply(arguments),t=e[0]&&s(e[0].type);e.splice(0,t?1:0,null);var i=new(Function.prototype.bind.apply(n.default.window.RTCSessionDescription,e)),o=Object.getOwnPropertyDescriptor(n.default.window.RTCSessionDescription.prototype,"type");return Object.defineProperty(i,"type",{get:function(){return t?r:o.get.call(i)},set:function(e){t=s(e),t||o.set.call(i,e)}}),i}function s(e){return r===e}var n=e("../../common/userAgentAdapter"),r="rollback";Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(){return i}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/adapter/webkitPeerConnection",["require","exports","microsoft-sdp-transform","../sessionDescriptorUtils","../../common/formatParameters","./webkitSessionDescription","../../common/userAgentAdapter","../../common/utils"],e)}(function(e,t){function f(e){function p(e,n){t[1]&&t[1][e]&&(t[1][n]=t[1][e])}function d(){v(),w(),b(),E(),y(),g()}function v(){[{name:"createOffer",reverseArgs:!0},"createAnswer","setRemoteDescription","setLocalDescription"].forEach(function(e){var t=e.name||e,n=f[t];f[t]=function(){var t=arguments;return new Promise(function(r,i){var s=[r,i];t.length>0&&s.splice(e.reverseArgs?s.length:0,0,t[0]),n.apply(f,s)})}})}function m(e,t){var n;Object.defineProperty(this,"dtmf",{get:function(){return"audio"===e.kind?(n=n||f.createDTMFSender(e),n):null}}),this.track=e,this._stream=t}function g(){if(f.getSenders&&f.addTrack&&f.removeTrack&&(!f.getLocalStreams||!f.addStream||!f.removeStream||!f.createDTMFSender))return;f.getSenders=function(){return h.slice()},f.addTrack=function(e,t){if(!e||!t)throw new Error("both media track and stream need to be provided");var n=f.getLocalStreams().some(function(e){return e.id===t.id});n||f.addStream(t);var r=u.find(h,function(t){return t.track.id===e.id});return r||(r=new m(e,t),h.push(r)),r},f.removeTrack=function(e){f.getLocalStreams().filter(function(t){return t.id===e._stream.id}).forEach(function(e){f.removeStream(e)}),u.remove(h,function(t){return t===e})}}function y(){var e=f.createOffer;f.createOffer=function(t){var i=arguments;return t&&t.offerToReceiveVideo>1&&(t.offerToReceiveVideo=1),e.apply(f,i).then(function(e){var t=n.parse(e.sdp);return t.media.filter(function(e){return e.type=="audio"}).forEach(function(e){r.removeCodec(e,{codec:"CN",rate:16e3})}),new c({type:e.type,sdp:n.write(t)})})}}function b(){var e=f.setLocalDescription;f.setLocalDescription=function(t){var r=function(){if(!l||!f.remoteDescription||!f.remoteDescription.sdp)return Promise.reject(new Error("rollback requires having both remote and local descriptions set"));var t=n.parse(f.remoteDescription.sdp),r=n.parse(l.sdp);t.media.forEach(function(e,t){x(e)&&(r.media[t]&&r.media[t].setup&&r.media[t].setup!=="actpass"&&(e.setup=r.media[t].setup==="active"?"passive":"active"),e.crypto&&delete e.crypto)});var i=new c({type:"answer",sdp:n.write(t)});return r.media.forEach(function(e){e.setup&&(e.setup="actpass")}),e(new c({type:l.type,sdp:n.write(r)})).then(function(){return f.setRemoteDescription(i)})};return"rollback"===t.type?"have-local-offer"===f.signalingState?r():Promise.reject(new Error("rollback is supported only from have-local-offer state")):("stable"===f.signalingState&&f.localDescription&&f.localDescription.sdp&&(l=new c({type:"offer",sdp:f.localDescription.sdp})),e(t))}}function w(){["createOffer","createAnswer","setLocalDescription"].forEach(function(t){var n=f[t];f[t]=function(){var t=arguments;return e.gather("video").then(function(){return n.apply(n,t)})}});var t=f.setRemoteDescription;f.setRemoteDescription=function(i){return e.gather("video").then(function(e){var s=e.codecs,o=n.parse(i.sdp);return o.media.forEach(function(e){if("video"===e.type){var t=e.rtp.some(function(e){return s.some(function(t){return e.codec.toLowerCase()===t.mimeType})});t?S(e):e.port=0}if(!x(e)){var n=r.getBundle(o);n?e.crypto=n.crypto:e.port||o.media.some(function(t){return t.port?(e.crypto=t.crypto,!0):!1})}}),i.sdp=n.write(o),t(i)})}}function E(){var e=f.createAnswer;f.createAnswer=function(){var t=arguments;return e.apply(f,t).then(function(e){if(!f.localDescription||!f.localDescription.sdp)return e;var t=n.parse(f.localDescription.sdp),i=[];t.media.forEach(function(e){a.forEach(function(t){r.forCodec(e,t,function(e){i.push(e)})})});if(i.length){var s=n.parse(e.sdp),o=!1;s.media.forEach(function(e){i.forEach(function(t){r.forCodec(e,{name:t.rtp.codec,rate:t.rtp.rate},function(e){e.rtp.payload!==t.rtp.payload&&(e.rtp.payload=t.rtp.payload,o=!0)})})}),o&&(e=new c({type:e.type,sdp:n.write(s)}))}return e})}}function S(e){r.forCodec(e,{name:"h264",rate:9e4},function(e){if(e.fmtp){var t=i.default.build(),n=i.default.build(e.fmtp.config);["level-asymmetry-allowed","packetization-mode","profile-level-id"].forEach(function(e){if(n.contains(e)){var r=n.get(e);e=="profile-level-id"&&(r="42C02A"),t.setIfMissing(e,r)}}),e.fmtp.config=t.toString()}})}function x(e){return"RTP/SAVPF"!==e.protocol}var t,f,l,c,h=[];return c=s.default.build(),t=[].slice.apply(arguments),t.splice(0,1,null),p("iceTransportPolicy","iceTransports"),f=new(Function.prototype.bind.apply(o.default.window.webkitRTCPeerConnection,t)),d(),f}var n=e("microsoft-sdp-transform"),r=e("../sessionDescriptorUtils"),i=e("../../common/formatParameters"),s=e("./webkitSessionDescription"),o=e("../../common/userAgentAdapter"),u=e("../../common/utils"),a=[{name:"telephone-event",rate:8e3},{name:"cn",rate:16e3}];Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e){return f.bind(null,e)}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/adapter/webkitCapabilityGatherer",["require","exports","microsoft-sdp-transform","../../common/userAgentAdapter"],e)}(function(e,t){function i(e){var t=this,i=r.default.window.webkitRTCPeerConnection,s;this.gather=function(e){return"video"!==e&&"audio"!==e?Promise.reject(new Error("capabilities for "+e+" are not supported")):(s.gatherTask||(s.gatherTask=new Promise(function(e,t){var r=new i(null);r.createOffer(function(t){var i={},s=n.parse(t.sdp);return s.media.forEach(function(e){i[e.type]=e.rtp.map(function(e){return{mimeType:e.codec.toLowerCase()}})}),r.close(),e(i)},function(e){s.gatherTask=null,r.close(),t(e)},{offerToReceiveVideo:1,offerToReceiveAudio:1})})),s.gatherTask.then(function(t){return{codecs:t[e]}}))},function(){s=e.global.webkitCapabilityGatherer=e.global.webkitCapabilityGatherer||{},t.gather("video")}()}var n=e("microsoft-sdp-transform"),r=e("../../common/userAgentAdapter");Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e){return new i(e)}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/transform/webkitSdpTransform",["require","exports","../sessionDescriptorUtils","../../constants","../../common/utils","../../common/ssrcGenerator"],e)}(function(e,t){function u(e){n.removeCodec(e,{codec:"g722",rate:8e3,encoding:2})}function a(e){return e.groups?i.find(e.groups,function(e){return e.type==="BUNDLE"}):null}function f(e,t,n){return{type:e,port:0,label:t,payloads:"36",protocol:n}}function l(e){return e.split(" ")[1]}function c(e,t){return e===r.default.MEDIA_STATE.sendReceive||t===r.default.MEDIA_STATE.sendReceive?r.default.MEDIA_STATE.sendReceive:e===t?e:e&&t&&e!==t?r.default.MEDIA_STATE.sendReceive:e||t}var n=e("../sessionDescriptorUtils"),r=e("../../constants"),i=e("../../common/utils"),s=e("../../common/ssrcGenerator"),o=function(){function e(e){this.cname=i.uniqueId(),this.ssrcGenerator=new s.default,this.videoSSRCs=[],this.settings=e.settings}return e.prototype.toLocal=function(e,t,n){var r=this,s=i.deepClone(e);return s.media.forEach(function(e){if(e.type!=="audio"){var t=-1;if(e.ssrcs){e.ssrcs.forEach(function(n){n.attribute==="cname"&&t++,n.id=r.getVideoSSRC(e,t)});if(e.ssrcGroups){var n=e.ssrcs.filter(function(e){return e.attribute==="cname"}).map(function(e){return e.id});e.ssrcGroups.forEach(function(e,t){e.ssrcs=[n[t*2],n[t*2+1]].join(" ")})}}}}),s},e.prototype.toOffer=function(e,t,n){return this.fromNative(e,t,n,!0)},e.prototype.toAnswer=function(e,t,n){return this.fromNative(e,t,n,!1)},e.prototype.toRemote=function(e,t,s){var o=this,l=i.deepClone(e),h=null,p=null,d=a(l);l.media.forEach(function(e,n){var r=t.getMediaEntity(n);r.isDisabled()&&(e.port=0)}),l.media.forEach(function(e,t){e.type===r.default.MEDIA_TYPE.data&&(o.dataMedia=e,l.media[t]=f(e.type,e.label,e.protocol))});if(!d){var v={};l.media.forEach(function(e,n){var r=t.getMediaEntity(n);r.getType()in v?(r.disable(),e.port=0):v[r.getType()]=!0})}l.media.forEach(function(e){var t=n.getModality(e);s[t]===r.default.MEDIA_STATE.send&&(!e.direction||e.direction.toLowerCase()!==r.default.MEDIA_STATE.receive)&&(e.direction=r.default.MEDIA_STATE.receive)});var m=i.find(l.media,function(e){return e.type===r.default.MEDIA_TYPE.audio});m&&(m.port!==0?(h=i.deepClone(m),h.mid="audio",delete h.label,u(h)):h=f(r.default.MEDIA_TYPE.audio,undefined,m.protocol));var g=l.media.filter(function(e){return e.type===r.default.MEDIA_TYPE.video});if(g.length>0){var y=g.filter(function(e){return e.port!==0});y.length>0?(p=i.deepClone(y[0]),p.mid="video",p.direction=null,delete p.label,p.ssrcs=[],p.ssrcGroups=[],y.forEach(function(e){e.ssrcs&&(p.ssrcs=p.ssrcs.concat(e.ssrcs)),e.ssrcGroups&&(p.ssrcGroups=p.ssrcGroups.concat(e.ssrcGroups)),p.direction=c(p.direction,e.direction||r.default.MEDIA_STATE.sendReceive)})):p=f(r.default.MEDIA_TYPE.video,undefined,g[0].protocol)}return l.media=[h,p].filter(function(e){return e}),t.getMediaEntities()[0].getModality()!==r.default.MODALITY.audio&&l.media.reverse(),d&&(d.mids=l.media.map(function(e){return e.mid}).filter(function(e){return e}).join(" ")),this.settings.preferSdesSrtp||l.media.forEach(function(e,t){e.fingerprint&&e.crypto&&delete e.crypto}),l},e.prototype.splitMedia=function(e,t,s,o,u){var a=this,c=e.getMid(),h=e.getModality(),p=i.deepClone(t);p.label=n.getLabelForModality(h),p.direction=o,p.mid=c,p.ssrcs=[],p.ssrcGroups=[];if(o===r.default.MEDIA_STATE.send||o===r.default.MEDIA_STATE.sendReceive){var d=i.find(s,function(e){return e.modality===h});if(!d)return f(t.type,n.getLabelForModality(h),t.protocol);var v=[];t.ssrcs&&(v=t.ssrcs.filter(function(e){return e.attribute==="msid"&&d.track===l(e.value)}).map(function(e){return e.id}),p.ssrcs=t.ssrcs.filter(function(e){return v.indexOf(e.id)>-1}),p.ssrcs.forEach(function(e){e.attribute==="cname"&&(e.value=a.cname)})),t.ssrcGroups&&(p.ssrcGroups=t.ssrcGroups.filter(function(e){var t=e.ssrcs.split(" ");return i.find(t,function(e){return v.indexOf(+e)>-1})}))}else if(o==r.default.MEDIA_STATE.receive||o==r.default.MEDIA_STATE.inactive)u[t.type].ssrcs&&u[t.type].ssrcs[0]?p.ssrcs=[{id:u[t.type].ssrcs[0].id,attribute:"cname",value:this.cname}]:t.type===r.default.MEDIA_TYPE.audio?p.ssrcs=[{id:4195875351,attribute:"cname",value:this.cname}]:t.type===r.default.MEDIA_TYPE.video&&(p.ssrcs=[{id:1,attribute:"cname",value:this.cname}]);return p},e.prototype.fromNative=function(e,t,s,o){var u=this,l=i.deepClone(e),c=i.find(l.media,function(e){return e.type===r.default.MEDIA_TYPE.audio}),h=i.find(l.media,function(e){return e.type===r.default.MEDIA_TYPE.video}),p={};p[r.default.MODALITY.audio]=c,p[r.default.MODALITY.video]=h,p[r.default.MODALITY.sharing]=h,p[r.default.MODALITY.data]=this.dataMedia;var d={};d[r.default.MEDIA_TYPE.audio]=c,d[r.default.MEDIA_TYPE.video]=h,d[r.default.MEDIA_TYPE.data]=this.dataMedia;var v={};v[r.default.MODALITY.audio]=t.getMediaEntitiesByModality(r.default.MODALITY.audio)[0],v[r.default.MODALITY.video]=t.getMediaEntitiesByModality(r.default.MODALITY.video)[0],v[r.default.MODALITY.sharing]=t.getMediaEntitiesByModality(r.default.MODALITY.sharing)[0],v[r.default.MODALITY.data]=t.getMediaEntitiesByModality(r.default.MODALITY.data)[0],l.media=[],t.getMediaEntities().forEach(function(e){var i,a=s[e.getModality()];!e.isEnabled()||p[e.getModality()].port===0||e!==v[e.getModality()]&&a===r.default.MEDIA_STATE.send?i=f(e.getType(),n.getLabelForModality(e.getModality()),p[e.getModality()].protocol):(a!==r.default.MEDIA_STATE.inactive&&e!==v[e.getModality()]&&(a=r.default.MEDIA_STATE.receive),i=u.splitMedia(e,p[e.getModality()],t.getMediaTracks(),a,d),e!==v[e.getModality()]&&(i.candidates=[]));var c=p[e.getModality()].setup;c&&(c!=="actpass"?e.setExtension("setup",c):o&&e.getExtension("setup")!==undefined&&(i.setup=e.getExtension("setup")!=="actpass"?e.getExtension("setup"):c)),i.port===0&&e.disable(),l.media.push(i)});var m=a(l);return m&&(m.mids=l.media.map(function(e){return e.mid}).filter(function(e){return e}).join(" ")),l},e.prototype.getVideoSSRC=function(e,t){return this.videoSSRCs[e.mid]===undefined&&(this.videoSSRCs[e.mid]=[]),this.videoSSRCs[e.mid][t]===undefined&&(this.videoSSRCs[e.mid][t]=this.ssrcGenerator.nextVideoStreamSsrc().min),this.videoSSRCs[e.mid][t]},e.prototype.clearSSRCs=function(e){this.videoSSRCs[e.mid]&&delete this.videoSSRCs[e.mid]},e}();t.WebkitSdpTransform=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/adapter/webkitAdapter",["require","exports","./webkitPeerConnection","./webkitSessionDescription","./webkitCapabilityGatherer","../transform/webkitSdpTransform"],e)}(function(e,t){var n=e("./webkitPeerConnection"),r=e("./webkitSessionDescription"),i=e("./webkitCapabilityGatherer"),s=e("../transform/webkitSdpTransform"),o=function(){function e(e){var t=i.default.build(e);this.SdpTransform=s.WebkitSdpTransform,this.RTCPeerConnection=n.default.build(t),this.RTCRtpReceiver={getCapabilities:t.gather},this.RTCSessionDescription=r.default.build()}return e}();t.WebkitAdapter=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/adapter/mozPeerConnection",["require","exports","microsoft-sdp-transform","../../common/userAgentAdapter"],e)}(function(e,t){function i(e,t){return e.split(";").filter(function(e){return!t.some(function(t){return e.indexOf(t)>-1})}).join(";")}function s(e){if(e.type!="video"||!e.fmtp||e.fmtp.length==0)return;e.fmtp[0].config=i(e.fmtp[0].config,["max-mbps","max-br"])}var n=e("microsoft-sdp-transform"),r=e("../../common/userAgentAdapter"),o=function(){function e(e){return this.peerConnection=new r.default.window.RTCPeerConnection(e),this.shim(),this.peerConnection}return e.prototype.shim=function(){this.shimSetRemoteDescription(),this.shimStats()},e.prototype.shimStats=function(){var e=this,t=this.peerConnection.getStats;this.peerConnection.getStats=function(n,r){t.apply(e.peerConnection,null).then(n).catch(r)}},e.prototype.shimSetRemoteDescription=function(){var e=this,t=this.peerConnection.setRemoteDescription;this.peerConnection.setRemoteDescription=function(i){var o=n.parse(i.sdp),u,a;return o.media.forEach(function(e,t){t===0?(u=e.iceUfrag,a=e.icePwd):u!==undefined&&a!==undefined&&(e.iceUfrag=u,e.icePwd=a),s(e)}),i=new r.default.window.RTCSessionDescription({type:i.type,sdp:n.write(o)}),t.call(e.peerConnection,i)}},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/adapter/mozCapabilityGatherer",["require","exports","microsoft-sdp-transform","../../common/userAgentAdapter"],e)}(function(e,t){var n=e("microsoft-sdp-transform"),r=e("../../common/userAgentAdapter"),i=function(){function e(e){this.selfGlobal=e.global.mozCapabilityGatherer=e.global.mozCapabilityGatherer||{},this.getGatherer()("video")}return e.prototype.getGatherer=function(){var e=this;return function(t){return"video"!==t&&"audio"!==t?Promise.reject(new Error("capabilities for "+t+" are not supported")):(e.selfGlobal.gatherTask||(e.selfGlobal.gatherTask=new Promise(function(t,i){var s=new r.default.window.RTCPeerConnection(null);s.createOffer(function(e){var r={},i=n.parse(e.sdp);return i.media.forEach(function(e){r[e.type]=e.rtp.map(function(e){return{mimeType:e.codec.toLowerCase()}})}),s.close(),t(r)},function(t){e.selfGlobal.gatherTask=null,s.close(),i(t)},{offerToReceiveVideo:1,offerToReceiveAudio:1})})),e.selfGlobal.gatherTask.then(function(e){return{codecs:e[t]}}))}},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/transform/mozSdpTransform",["require","exports","../sessionDescriptorUtils"],e)}(function(e,t){var n=e("../sessionDescriptorUtils"),r=function(){function e(){}return e.prototype.fromNative=function(e,t,r,i){return e.media.forEach(function(e,i){var s=t.getMediaEntity(i);s&&s.isEnabled()&&e.port!==0?(e.label=n.getLabelForModality(s.getModality()),e.direction=r[s.getModality()]):e.port=0}),e},e.prototype.toLocal=function(e,t,n){return e},e.prototype.toOffer=function(e,t,n){return this.fromNative(e,t,n,!0)},e.prototype.toAnswer=function(e,t,n){return this.fromNative(e,t,n,!1)},e.prototype.toRemote=function(e,t,n){var r;return e.media.forEach(function(e,t){e.connection?r=e.connection:r&&(e.connection=r)}),e},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/adapter/mozAdapter",["require","exports","./mozPeerConnection","./mozCapabilityGatherer","../transform/mozSdpTransform","../../common/userAgentAdapter"],e)}(function(e,t){var n=e("./mozPeerConnection"),r=e("./mozCapabilityGatherer"),i=e("../transform/mozSdpTransform"),s=e("../../common/userAgentAdapter"),o=function(){function e(e){this._gatherer=new r.default(e)}return e.prototype.getCapabilities=function(e){return this._gatherer.getGatherer()(e)},e}(),u=function(){function e(e){this.SdpTransform=i.default,this.RTCPeerConnection=n.default,this.RTCSessionDescription=s.default.window.RTCSessionDescription,this.RTCRtpReceiver=new o(e)}return e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/adapter/webrtcAdapter",["require","exports","./webkitAdapter","./mozAdapter","../../common/userAgentAdapter"],e)}(function(e,t){function s(){function e(){throw new Error("unsupported platform")}this.SdpTransform=e,this.RTCPeerConnection=e,this.RTCSessionDescription=e,this.RTCRtpReceiver=e}function o(e,t,n){this.SdpTransform=u,this.RTCPeerConnection=e,this.RTCSessionDescription=t,this.RTCRtpReceiver=n}function u(){function e(e){return e}this.toOffer=e,this.toAnswer=e,this.toRemote=e}function a(){return typeof i.default.window.webkitRTCPeerConnection!="undefined"}function f(){return typeof i.default.window.mozRTCPeerConnection!="undefined"}var n=e("./webkitAdapter"),r=e("./mozAdapter"),i=e("../../common/userAgentAdapter");Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e){return a()?new n.WebkitAdapter(e):f()?new r.default(e):new s}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/mediaEntity",["require","exports","../common/videoCapabilities","./sessionDescriptorUtils","../constants"],e)}(function(e,t){var n=e("../common/videoCapabilities"),r=e("./sessionDescriptorUtils"),i=e("../constants"),s=1200,o=3e3,u=3600,a=1500,f=function(){function e(e,t,n,r,i,s,o,u){this.modality=e,this.mid=t,this.mtype=n,this.streamId=r,this.trackId=i,this.xSourceStreamId=s,this.videoCapabilities=o,this.extensions=u}return e.create=function(t,f,l){var c=r.getTypeFromModality(f),h=null;if(c===i.default.MEDIA_TYPE.video){var p=void 0,d=void 0;f===i.default.MODALITY.sharing?(p=t.webrtcScreensharingCapabilityMaxFS?t.webrtcScreensharingCapabilityMaxFS:u,d=t.webrtcScreensharingCapabilityMaxFPS?t.webrtcScreensharingCapabilityMaxFPS:a):(p=t.webrtcVideoCapabilityMaxFS?t.webrtcVideoCapabilityMaxFS:s,d=t.webrtcVideoCapabilityMaxFPS?t.webrtcVideoCapabilityMaxFPS:o),h=new n.default(p,d)}var v=new e(f,l,c,null,null,null,h,{});return v},e.prototype.clone=function(){return new e(this.modality,this.mid,this.mtype,this.streamId,this.trackId,this.xSourceStreamId,this.videoCapabilities,this.extensions)},e.prototype.getModality=function(){return this.modality},e.prototype.getType=function(){return this.mtype},e.prototype.getMid=function(){return this.mid},e.prototype.disable=function(){this.mid=null},e.prototype.enable=function(e,t){this.modality=e,this.mid=t},e.prototype.isDisabled=function(){return!this.mid},e.prototype.isEnabled=function(){return!!this.mid},e.prototype.getVideoCapabilities=function(){return this.videoCapabilities},e.prototype.getStreamId=function(){return this.streamId},e.prototype.setStreamId=function(e){this.streamId=e},e.prototype.getTrackId=function(){return this.trackId},e.prototype.setTrackId=function(e){this.trackId=e},e.prototype.getXSourceStreamId=function(){return this.xSourceStreamId},e.prototype.setXSourceStreamId=function(e){this.xSourceStreamId=e},e.prototype.getExtension=function(e){return this.extensions[e]},e.prototype.setExtension=function(e,t){this.extensions[e]=t},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=f}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/mediaManager",["require","exports","./sessionDescriptorUtils","../constants","../common/utils","./mediaEntity"],e)}(function(e,t){var n=e("./sessionDescriptorUtils"),r=e("../constants"),i=e("../common/utils"),s=e("./mediaEntity"),o=function(){function e(e){this.mediaEntities=[],this.mediaEntitiesBackup=[],this.midId=0,this.mediaTracks=[],this.logger=e.logger,this.settings=e.settings,this.numVideoChannels=e.numVideoChannels}return e.prototype.generateMid=function(e){return"media_"+e},e.prototype.fromOffer=function(e,t){var n=this;e.media.forEach(function(e){if(e.type===r.default.MEDIA_TYPE.audio)r.default.MODALITY.audio in t&&n.addMediaEntity(r.default.MODALITY.audio);else if(e.type===r.default.MEDIA_TYPE.video){if(r.default.MODALITY.video in t)for(var i=0;i<n.numVideoChannels;i++)n.addMediaEntity(r.default.MODALITY.video);r.default.MODALITY.sharing in t&&n.addMediaEntity(r.default.MODALITY.sharing)}else e.type===r.default.MEDIA_TYPE.data&&r.default.MODALITY.data in t&&n.addMediaEntity(r.default.MODALITY.data)})},e.prototype.fromRemote=function(e,t){var r=this;e.media.forEach(function(e,s){var o=n.getModality(e);if(e.port!==0&&o in t){r.mediaEntities[s]?r.mediaEntities[s].enable(o,e.mid||r.generateMid(s)):r.addMediaEntity(o,e.mid||r.generateMid(s));if(e.msid)r.mediaEntities[s].setStreamId(e.msid.split(" ")[0]),r.mediaEntities[s].setTrackId(e.msid.split(" ")[1]);else if(e.ssrcs){var u=i.find(e.ssrcs,function(e){return e.attribute==="msid"});u?(r.mediaEntities[s].setStreamId(u.value.split(" ")[0]),r.mediaEntities[s].setTrackId(u.value.split(" ")[1])):r.logger.warn("No ssrc msid for media of type "+e.type+" with mid "+e.mid)}r.mediaEntities[s].setXSourceStreamId(e.xSourceStreamId)}else r.mediaEntities[s]?r.mediaEntities[s].disable():r.addDisabledMediaEntity(o),r.mediaEntities[s].setStreamId(null),r.mediaEntities[s].setTrackId(null)})},e.prototype.isEmpty=function(){return this.mediaEntities.length===0},e.prototype.addMediaEntity=function(e,t){this.mediaEntities.push(s.default.create(this.settings,e,t||this.generateMid(this.mediaEntities.length)))},e.prototype.addDisabledMediaEntity=function(e){this.mediaEntities.push(s.default.create(this.settings,e,null))},e.prototype.getMediaEntities=function(){return this.mediaEntities},e.prototype.getMediaEntity=function(e){return this.mediaEntities[e]},e.prototype.getMediaEntityByMid=function(e){return i.find(this.mediaEntities,function(t){return t.getMid()===e})},e.prototype.getMediaEntitiesByModality=function(e){return this.mediaEntities.filter(function(t){return t.getModality()===e})},e.prototype.getMediaEntityByStreamId=function(e){return i.find(this.mediaEntities,function(t){return t.getStreamId()===e})},e.prototype.getMediaEntityByXSourceStreamId=function(e){return i.find(this.mediaEntities,function(t){return t.getXSourceStreamId()===e})},e.prototype.reset=function(){this.mediaEntities=[]},e.prototype.syncModalities=function(e,t){this.disableModalities(e),t||(this.enableModalities(e),this.addModalities(e))},e.prototype.enableModalities=function(e){var t=this;this.mediaEntities.forEach(function(n,r){n.getModality()in e&&n.isDisabled()&&n.enable(n.getModality(),t.generateMid(r))})},e.prototype.disableModalities=function(e){this.mediaEntities.forEach(function(t){t.getModality()in e||t.disable()})},e.prototype.addModalities=function(e){var t={};this.mediaEntities.map(function(e){return e.getModality()}).forEach(function(e){t[e]=!0});for(var n in e)n in t||this.addMediaEntity(n)},e.prototype.setMediaTracks=function(e){this.mediaTracks=e},e.prototype.getMediaTracks=function(){return this.mediaTracks},e.prototype.backup=function(){var e=this;this.mediaEntitiesBackup=[],this.mediaEntities.forEach(function(t){e.mediaEntitiesBackup.push(t.clone())})},e.prototype.commit=function(){this.mediaEntitiesBackup=[]},e.prototype.rollback=function(){this.mediaEntities=this.mediaEntitiesBackup},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/webRtcDtmfSender",["require","exports","../common/dtmfUtils"],e)}(function(e,t){var n=e("../common/dtmfUtils"),r=function(){function e(e,t){this.webRtcSender=null,this.queue=new n.DTMFQueue(e),this.settings=t?t:n.defaultSettings}return e.prototype.sendDtmf=function(e,t){return!e||!e.getSenders?Promise.reject(new Error("bad peerConnection")):(this.syncSender(e),this.webRtcSender?(this.webRtcSender.ontonechange=this.onToneChange.bind(this),this.webRtcSender.insertDTMF(this.webRtcSender.toneBuffer+t,this.settings.toneDuration,this.settings.toneGap),this.queue.waitForNotification(t)):Promise.reject(new Error("not available")))},e.prototype.canSendDtmf=function(e){return!e||!e.getSenders?!1:(this.syncSender(e),this.webRtcSender?this.webRtcSender.canInsertDTMF:!1)},e.prototype.dispose=function(){this.queue.cleanup()},e.prototype.syncSender=function(e){var t=e.getSenders().filter(function(e){return e.dtmf&&e.dtmf.canInsertDTMF})[0];this.webRtcSender&&t&&t.dtmf!=this.webRtcSender&&(this.webRtcSender.ontonechange=null,this.queue.cleanup()),this.webRtcSender=t?t.dtmf:null},e.prototype.onToneChange=function(e){e.tone&&this.queue.toneSent(e.tone)},e}();t.WebRtcDTMFSender=r,Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e,t){return new r(e,t)}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/stream/receiveStreamCollection",["require","exports","../utils"],e)}(function(e,t){var n=e("../utils"),r=function(){function e(e){this.streams=[],this.listener=e}return e.prototype.add=function(e){var t=this.streams.some(function(t){return t.getId()===e.getId()});t||(this.streams.push(e),this.listener.streamAdded(e))},e.prototype.remove=function(e){var t;if(n.remove(this.streams,function(n){return n.getId()===e?(t=n,!0):!1})){this.listener.streamRemoved(t);return}},e.prototype.getStreams=function(){return this.streams},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/render/remoteVideoRenderer",["require","exports","../../constants","./videoRenderer","./videoSizeTracker"],e)})(function(e,t){var n=e("../../constants"),r=e("./videoRenderer"),i=e("./videoSizeTracker"),s=function(e){function t(t,n,r,i){var s=e.call(this,n)||this;return s.disposed=!1,s.settings=t.settings,s.logger=t.logger,s.subscriptionManager=t.subscriptionManager,s.rendererSizeChangedListener=i,s.onSizeChanged(r?r.onVideoSizeChanged:null),s.onError(r?r.onError:null),s}return __extends(t,e),t.prototype.trackElementSizeChange=function(){var e=this,t=this.rendererType===n.default.RENDERER_TYPE.sharing,r=t?this.settings.webrtcScreensharingCapabilityCheckIntervalMin:this.settings.webrtcVideoCapabilityCheckIntervalMin,s=t?this.settings.webrtcScreensharingCapabilityCheckIntervalMax:this.settings.webrtcVideoCapabilityCheckIntervalMax;if(!r||!s){this.logger.info("skipping video size tracking");return}this.sizeTracker=new i.default(this.getVideoElement(),{interval:{min:r,max:s}}),this.sizeTracker.onSizeChange(function(t,n){e.logger.log("video renderer size changed to",t+"x"+n),e.rendererSizeChangedListener(e,t,n)})},t.prototype.unsubscribe=function(){this.subscription&&(this.subscription.dispose(),this.subscription=null)},t.prototype.subscribeVideoAsync=function(e,t){var r=this;return new Promise(function(i,s){r.rendererType=t?n.default.RENDERER_TYPE.sharing:n.default.RENDERER_TYPE.video,r.trackElementSizeChange(),r.unsubscribe();var o=r.subscriptionManager.subscribe(r.rendererType,e);r.subscription=o,r.logger.info("subscribing renderer to type:",o.getModality(),", msi:",o.getMsi()),o.onMediaStreamChanged(function(e){r.attachMediaStream(e),r.logger.info("subscribed renderer to type:",o.getModality(),", msi:",o.getMsi(),", on stream #",e?e.id:"none"),i()}),o.onError(function(e){r.logger.error("failed to subscribe renderer",e),s(e)})})},t.prototype.dispose=function(){this.disposed?this.logger.warn("renderer already disposed"):(this.disposed=!0,this.unsubscribe(),this.sizeTracker&&this.sizeTracker.dispose(),e.prototype.dispose.call(this))},t.prototype.getModality=function(){return this.rendererType},t}(r.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/stream/receiveStream",["require","exports"],e)}(function(e,t){var n=function(){function e(){}return e}();n.SourceNone=-1,n.SourceAny=-2,t.MediaSourceIdentifiers=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/stream/subscriptionManager",["require","exports","../utils","./receiveStream"],e)}(function(e,t){var n=e("../utils"),r=e("./receiveStream"),i=2e3,s=function(){function e(e){this.subscription=e}return e.prototype.getMsi=function(){return this.checkDisposed(),this.subscription.getMsi()},e.prototype.getModality=function(){return this.checkDisposed(),this.subscription.getModality()},e.prototype.onMediaStreamChanged=function(e){this.checkDisposed(),this.mediaStreamChanged=e,this.subscription.isStreamReady()&&this.notifyMediaStreamChanged()},e.prototype.onError=function(e){this.checkDisposed(),this.error=e},e.prototype.dispose=function(){this.subscription&&(this.subscription.dispose(this),this.subscription=null)},e.prototype.notifyMediaStreamChanged=function(){if(this.mediaStreamChanged){var e=this.subscription.getStream(),t=this.subscription.isStreamReady();this.mediaStreamChanged(e&&t?e.getMediaStream():null)}},e.prototype.notifyError=function(e){this.error&&this.error(e)},e.prototype.checkDisposed=function(){if(!this.subscription)throw new Error("subscription disposed")},e}(),o=function(){function e(e,t,n){this.clients=[],this.streamReady=!1,this.modality=e,this.msi=t,this.onDisposed=n}return e.prototype.client=function(){var e=new s(this);return this.clients.push(e),e},e.prototype.getMsi=function(){return this.msi},e.prototype.getStream=function(){return this.stream},e.prototype.isStreamReady=function(){return this.streamReady},e.prototype.getModality=function(){return this.modality},e.prototype.setStream=function(e){var t=this;if(e===this.stream)return;this.stream&&(this.releaseStream(),this.notifyStreamChanged()),this.stream=e,e&&(this.streamReady=!1,e.requestSource(this.msi).then(function(){t.streamReady=!0,t.notifyStreamChanged()}).catch(function(e){t.notifyError(e)}))},e.prototype.notifyStreamChanged=function(){this.clients.forEach(function(e){return e.notifyMediaStreamChanged()})},e.prototype.releaseStream=function(){this.stream&&(this.stream.requestSource(r.MediaSourceIdentifiers.SourceNone).catch(function(){}),this.streamReady=!1,this.stream=null)},e.prototype.notifyError=function(e){this.clients.forEach(function(t){return t.notifyError(e)})},e.prototype.disposeNow=function(){this.releaseStream(),this.onDisposed&&(this.onDisposed(),this.onDisposed=undefined)},e.prototype.disposeIfInactive=function(){this.clients.length||this.disposeNow()},e.prototype.dispose=function(e){var t=this;e?(n.remove(this.clients,function(t){return t===e}),this.clients.length||setTimeout(function(){return t.disposeIfInactive()},i)):(this.clients=[],this.disposeNow())},e}(),u=function(){function e(e,t){this.subscriptions=[],this.logger=e.logger.createChild("subs"),this.setStreamProvider(t),this.logger.log("created")}return e.prototype.setStreamProvider=function(e){var t=this;this.streamProvider=e,this.streamProvider.onStreamsChanged(function(){return t.streamsChanged()})},e.prototype.disposeInactiveSubscriptions=function(){this.subscriptions.concat().forEach(function(e){e.getStream()&&e.disposeIfInactive()})},e.prototype.subscribe=function(e,t){var i=this;t===void 0&&(t=r.MediaSourceIdentifiers.SourceAny);var s=n.find(this.subscriptions,function(n){return n.getMsi()===t&&n.getModality()===e});if(!s){this.disposeInactiveSubscriptions(),this.logger.log("creating new subscription #",t,"for modality",e),s=new o(e,t,function(){i.logger.log("disposing subscription #",t),n.remove(i.subscriptions,function(e){return e===s}),i.streamsChanged()}),this.subscriptions.push(s);var u=this.getAvailableStream(e);u&&this.assignStream(s,u)}return s.client()},e.prototype.dispose=function(){this.subscriptions.concat().forEach(function(e){return e.dispose()}),this.streamProvider.onStreamsChanged(null),this.logger.log("disposed")},e.prototype.streamsChanged=function(){var e=this;this.subscriptions.forEach(function(t){var n=!t.getStream()||e.isStreamRemoved(t.getStream());if(!n)return;var r=e.getAvailableStream(t.getModality());r?e.assignStream(t,r):e.resignStream(t)})},e.prototype.getAvailableStream=function(e){var t=this.streamProvider.getStreams(),i=n.find(t,function(t){return e===t.getModality()&&t.getMsi()===r.MediaSourceIdentifiers.SourceNone});return i},e.prototype.isStreamRemoved=function(e){var t=this.streamProvider.getStreams();return!t.some(function(t){return t===e})},e.prototype.assignStream=function(e,t){this.logger.log("assigning stream #",t.getId(),"to subscription #",e.getMsi()),e.setStream(t)},e.prototype.resignStream=function(e){var t=e.getStream();t&&(this.logger.log("removing stream from subscription #",e.getMsi()),e.setStream(null))},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/render/audioRenderer",["require","exports","../../common/userAgentAdapter","../../common/utils"],e)}(function(e,t){var n=e("../../common/userAgentAdapter"),r=e("../../common/utils"),i=function(){function e(e){this.window=n.default.window,this.logger=e.logger.createChild("audio")}return e.prototype.play=function(e){this.audio?this.window.detachMediaStream(this.audio):(this.audio=document.createElement("audio"),document.body.appendChild(this.audio),this.audio.autoplay=!0,this.audio.addEventListener("error",this.onAudioError)),this.logger.log("starting playout"),this.window.attachMediaStream(this.audio,e),this.stream=e},e.prototype.stop=function(){this.audio&&(this.logger.log("stopping playout"),this.audio.removeEventListener("error",this.onAudioError),document.body.removeChild(this.audio),this.window.detachMediaStream(this.audio),this.audio=null,this.stream=null)},e.prototype.setOutputDevice=function(e){this.audio.setSinkId&&this.audio&&e&&(this.logger.log("setting audio output device ID to",e),this.audio.setSinkId(e))},e.prototype.getStream=function(){return this.stream},e.prototype.dispose=function(){this.stop()},e.prototype.onAudioError=function(e){e?this.logger.error("error event occured:",this.toString(e)):this.logger.error("error event occured","error:",this.audio?this.audio.error:"<no audio element>")},e.prototype.toString=function(e){if(e){var t={};return r.forOwn(e,function(e,n){try{t[n]=typeof e=="function"?t[n]=e():t[n]=e}catch(r){t[n]="error: "+r}}),JSON.stringify(t)}},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/stream/webRtcReceiveStream",["require","exports","../../common/stream/receiveStream"],e)}(function(e,t){var n=e("../../common/stream/receiveStream"),r=function(){function e(e,t,r,i){this.msi=n.MediaSourceIdentifiers.SourceNone,this.operations=Promise.resolve(),this.mediaStream=e,this.modality=t,this.sourceStreamId=r,this.controller=i}return e.prototype.getId=function(){return this.mediaStream.id},e.prototype.getModality=function(){return this.modality},e.prototype.getMsi=function(){return this.msi},e.prototype.getMediaStream=function(){return this.mediaStream},e.prototype.requestSource=function(e){var t=this;this.msi=e;var n=this.operations.then(function(){return t.controller.requestSource(t.sourceStreamId,e)});return this.operations=n.catch(function(){}),n},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/quality/resolutionManager",["require","exports"],e)}(function(e,t){var n=15e3,r=5e3,i=function(){function e(e,t,i){var s=this;this.resolutionApplier=t,this.lastSendBW=0,this.coolingDown=!1,this.cooldownTimer=null,this.cooldownEnd=0,this.active=!1,this.maxFps=30,this.logger=e.logger.createChild("rm"),this.resolutionTable=e.resolutionTable;if(!e.settings.scalingEnabled){this.logger.log("Resolution management disabled: no resolution management for 1x1 calls");return}this.cooldownTimeout=e.settings.cooldownTimeout||n,this.retryDelay=e.settings.retryDelay||r,this.active=!0,i.onStatisticsChanged(function(e){return s.onStatisticsChanged(e)})}return e.prototype.applyRes=function(e){var t=this;this.pendingResolution=e;if(this.coolingDown&&(!this.currentResolution||e.fs>this.currentResolution.fs))return;this.coolingDown=!0,this.logger.log("Changing resolution to "+e),this.resolutionApplier.applyResolution(e,this.maxFps).then(function(n){n&&e==t.pendingResolution?(t.pendingResolution=null,t.coolingDown&&!t.currentResolution&&(t.coolingDown=!1)):n||(t.logger.log("Unable to apply resolution at the moment"),t.cooldown(r))}).catch(function(e){t.logger.error("Error while applying new resolution:",e),t.pendingResolution=null})},e.prototype.getActive=function(){return this.active},e.prototype.setMaxResolution=function(e){if(e==this.maxResolution)return;this.logger.log("New max resolution: "+e),this.maxResolution=e,this.lastSendBW&&this.processEstimatedBandwidth(this.lastSendBW)},e.prototype.setMaxCapabilities=function(e){var t=this.resolutionTable.getResolution(e.maxFS);e.maxFPS&&(this.maxFps=e.maxFPS),this.setMaxResolution(t)},e.prototype.setCurrentResolution=function(e){this.logger.log("New resolution: "+e),this.currentResolution=e,e&&this.cooldown()},e.prototype.getCurrentResolution=function(){return this.currentResolution},e.prototype.cooldown=function(e){var t=this;e===void 0&&(e=n);if(this.coolingDown&&this.cooldownEnd-Date.now()>n)return;this.cooldownTimer&&clearTimeout(this.cooldownTimer),this.coolingDown=!0,this.cooldownEnd=Date.now()+n,this.cooldownTimer=setTimeout(function(){t.logger.debug("Resolution changer cooled down"),t.coolingDown=!1,t.cooldownTimer=null,t.pendingResolution?t.proposeResolution(t.pendingResolution):t.processEstimatedBandwidth(t.lastSendBW)},e)},e.prototype.proposeResolution=function(e){this.maxResolution&&this.maxResolution.fs<e.fs&&(e=this.maxResolution);if(this.currentResolution&&e.fs==this.currentResolution.fs)return;this.applyRes(e)},e.prototype.processEstimatedBandwidth=function(e){var t=this.resolutionTable.getResolutionForBitrate(e),n=t.lowRes,r=t.highRes,i=e<this.lastSendBW?r:n;if(e<this.lastSendBW&&i&&this.currentResolution&&this.currentResolution.fs<i.fs)return;i&&this.proposeResolution(i),this.lastSendBW=e},e.prototype.onStatisticsChanged=function(e){var t=e.estimatedSendBandwidth;if(t==this.lastSendBW)return;this.logger.debug("Send BW: "+t),this.processEstimatedBandwidth(t)},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/quality/qualityManager",["require","exports","../../common/utils","./resolutionManager"],e)}(function(e,t){var n=e("../../common/utils"),r=e("./resolutionManager"),i=function(){function e(e,t,n){var i=this;this.slidingWindow=[],this.logger=e.logger.createChild("qm"),this.listener=t,this.settings=e.settings,this.optimalReceiversCount=this.settings.videoReceiversCount,this.settings.scalingEnabled&&(n.onStatisticsChanged(function(e){i.processEstimatedBandwidth(e.estimatedReceiveBandwidth)}),this.notifyOptimalReceiversCountChanged()),this.resolutionManager=new r.default(e,t,n)}return e.prototype.setCurrentResolution=function(e){this.resolutionManager.setCurrentResolution(e)},e.prototype.setMaxCapabilities=function(e){this.settings.maxResolution&&e.maxFS>this.settings.maxResolution.fs&&(e.maxFS=this.settings.maxResolution.fs),this.resolutionManager.setMaxCapabilities(e)},e.prototype.getCurrentResolution=function(){return this.resolutionManager.getCurrentResolution()},e.prototype.getActive=function(){return this.resolutionManager.getActive()},e.prototype.sample=function(e){this.slidingWindow.length>=this.settings.slidingWindowSamples?this.slidingWindow=this.slidingWindow.slice(1):this.slidingWindow.length===this.settings.slidingWindowSamples-1&&(this.slidingWindow=this.slidingWindow.map(function(t){return e})),this.slidingWindow.push(e);if(this.slidingWindow.length>=this.settings.slidingWindowSamples){var t=this.slidingWindow.slice().sort(),r=n.average(t);return t[t.length-1]-(t[t.length-1]-r*(1-this.settings.slidingWindowPercentile))}return e},e.prototype.processOptimalReceiversCount=function(){if(this.bandwidth<0)return;var e=Math.floor(this.sample(this.bandwidth)/this.settings.bandwidthPerVideoReceiver);this.optimalReceiversCount!==Math.max(e,1)&&(e?this.logger.log("optimal video receivers count changed to",e):(this.logger.warn("there is not enough bandwidth even for a single video receiver"),e=1),this.optimalReceiversCount=e,this.notifyOptimalReceiversCountChanged())},e.prototype.notifyOptimalReceiversCountChanged=function(){this.listener.onOptimalVideoReceiversCountChanged(this.optimalReceiversCount)},e.prototype.processEstimatedBandwidth=function(e){this.bandwidth=e,this.processOptimalReceiversCount()},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/statistics/statisticsAverage",["require","exports"],e)}(function(e,t){var n=function(){function e(){this.eventCount=0,this.eventValuesSummary=null,this.i=10}return e.prototype.getResult=function(){if(this.eventCount>0&&this.eventValuesSummary)return this.eventValuesSummary/this.eventCount},e.prototype.updateEventValue=function(e){e!==null&&(e===0&&this.i<10||e>0)&&(this.eventCount+=1,this.i=e>0?0:this.i+1,this.eventValuesSummary=this.eventValuesSummary?this.eventValuesSummary+e:e)},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/statistics/webrtcStatistics",["require","exports","../../helper","../../common/utils","../../statistics/statisticsAverage"],e)}(function(e,t){var n=e("../../helper"),r=e("../../common/utils"),i=e("../../statistics/statisticsAverage"),s=["googFrameHeightReceived","googFrameWidthReceived","googNacksSent","googPlisSent","framesDecoded","googFrameRateDecoded","googFrameRateReceived","packetsLost","packetsSent","packetsReceived","bytesReceived","bytesSent","googFrameHeightSent","googFrameWidthSent","googFrameRateInput","googFrameRateSent","googEncodeUsagePercent","audioInputLevel"],o=["bytesSent","bytesReceived","googRtt","packetsSent","requestsSent","consentRequestsSent","responsesSent","requestsReceived","responsesReceived"],u=["googAvailableReceiveBandwidth","googAvailableSendBandwidth","googTransmitBitrate"],a=function(){function e(e,t){this.sessionId=null,this.mediaEntities=[],this.terminated=!1,this.hwSilent=!1,this.jitterBuffer=new i.default,this.videoSendFrameRate=new i.default,this.videoRecvFrameRate=new i.default,this.sharingSendFrameRate=new i.default,this.sharingRecvFrameRate=new i.default,this.extensions={WebRTCStats:{},AudioTransportRecvBitrate:0,AudioTransportSendBitrate:0,AudioPayloadSendBitrate:0,AudioPayloadRecvBitrate:0,VideoPayloadSendBitrate:0,VideoPayloadRecvBitrate:0,TimerAudioTransportRecvBitrate:0,TimerAudioTransportSendBitrate:0,TimerAudioPayloadRecvBitrate:0,TimerAudioPayloadSendBitrate:0,TimerVideoPayloadRecvBitrate:0,TimerVideoPayloadSendBitrate:0,StartTime:(new Date).getTime(),EndTime:(new Date).getTime(),WebRTCStats_ssrc_audio_recv_jitterBufferAvgSize:0,WebRTCStats_ssrc_video_send_frameRateAvg:0,WebRTCStats_ssrc_video_recv_frameRateAvg:0,WebRTCStats_ssrc_sharing_send_frameRateAvg:0,WebRTCStats_ssrc_sharing_recv_frameRateAvg:0},this.report={type:"WebRtcMediaStats",data:{Extensions:this.extensions}},this.storedRecordsNumber=t.storedRecordsNumber,this.hwSilentDetectionDuration=t.hwSilentDetectionDuration,this.hwSilentDetectionLevel=t.hwSilentDetectionLevel,this.report.data.CorrelationId=e,this.sessionId=e,this.logger=t.logger.createChild("WebrtcStatistics"),this.sessionInfo=t.sessionInfo}return e.prototype.setStartTime=function(e){var t=this.extensions.WebRTCStats;if(!t.ssrc_audio_send||!t.ssrc_audio_recv)return!1;var r=function(e,t){return e&&(!t||t!==-1)?(new Date).getTime():t};return this.extensions.TimerAudioPayloadRecvBitrate=n.hasReceiveDirectionality(e.audio)?r(t.ssrc_audio_recv.bytesReceived,this.extensions.TimerAudioPayloadRecvBitrate):-1,this.extensions.TimerAudioPayloadSendBitrate=n.hasSendDirectionality(e.audio)?r(t.ssrc_audio_send.bytesSent,this.extensions.TimerAudioPayloadSendBitrate):-1,this.extensions.TimerAudioTransportRecvBitrate=n.hasReceiveDirectionality(e.audio)?r(t.ssrc_audio_recv.bytesReceived,this.extensions.TimerAudioTransportRecvBitrate):-1,this.extensions.TimerAudioTransportSendBitrate=n.hasSendDirectionality(e.audio)?r(t.ssrc_audio_send.bytesSent,this.extensions.TimerAudioTransportSendBitrate):-1,!t.ssrc_video_send||!t.ssrc_video_recv?!1:(this.extensions.TimerVideoPayloadRecvBitrate=n.hasReceiveDirectionality(e.video)?r(t.ssrc_video_recv.bytesReceived,this.extensions.TimerVideoPayloadRecvBitrate):-1,this.extensions.TimerVideoPayloadSendBitrate=n.hasSendDirectionality(e.video)?r(t.ssrc_video_send.bytesSent,this.extensions.TimerVideoSendBitrate):-1,this.extensions.TimerVideoPayloadRecvBitrate&&this.extensions.TimerVideoPayloadSendBitrate&&this.extensions.TimerAudioPayloadRecvBitrate&&this.extensions.TimerAudioPayloadSendBitrate&&this.extensions.TimerAudioTransportRecvBitrate&&this.extensions.TimerAudioTransportSendBitrate?!0:!1)},e.prototype.calculateAverages=function(){var e=this,t=this.extensions.EndTime,n=function(e,n){return e&&t-n>0&&n!==0&&n!==-1?Math.round(e*8/(t-n)):0},r=function(t){var n=t.split(".").reduce(function(e,t){return typeof e=="undefined"||e===null?e:e[t]},e.extensions.WebRTCStats);return Array.isArray(n)?n[n.length-1]:n};this.extensions.AudioPayloadRecvBitrate=n(r("ssrc_audio_recv.bytesReceived"),this.extensions.TimerAudioPayloadRecvBitrate),this.extensions.AudioPayloadSendBitrate=n(r("ssrc_audio_send.bytesSent"),this.extensions.TimerAudioPayloadSendBitrate),this.extensions.VideoPayloadRecvBitrate=n(r("ssrc_video_recv.bytesReceived"),this.extensions.TimerVideoPayloadRecvBitrate),this.extensions.VideoPayloadSendBitrate=n(r("ssrc_video_send.bytesSent"),this.extensions.TimerVideoPayloadSendBitrate),this.extensions.AudioTransportRecvBitrate=n(r("ssrc_audio_send.pair.bytesReceived"),this.extensions.TimerAudioTransportRecvBitrate),this.extensions.AudioTransportSendBitrate=n(r("ssrc_audio_send.pair.bytesSent"),this.extensions.TimerAudioTransportSendBitrate)},e.prototype.addFilteredFields=function(e,t,n){n===void 0&&(n=[]);for(var r in t)if(t.hasOwnProperty(r)&&r!=="type")if(n.indexOf(r)!==-1){var i=e[r]||[];i.push(t[r]),i.length>this.storedRecordsNumber&&i.shift(),e[r]||(e[r]=i)}else e[r]=t[r]},e.prototype.processSource=function(e,t,n){this.addFilteredFields(e,t,s);if(t.transportId){var r=n.googComponent[t.transportId];e.transport||(e.transport={}),this.addFilteredFields(e.transport,r);if(r.selectedCandidatePairId){var i=n.googCandidatePair[r.selectedCandidatePairId];e.pair||(e.pair={}),this.addFilteredFields(e.pair,i,o),this.lastKnownGoodPair=e.pair}}},e.prototype.getWebrtcReport=function(e,t){e.hasOwnProperty("getStatsError")&&delete e.getStatsError;if(!t.ssrc)return;var n=function(n){if(t.ssrc[n].hasOwnProperty("transportId")){var s=t.ssrc[n],o=r.find(i.mediaEntities,function(e){return e.trackId===s.googTrackId}),u=o?o.modality:s.mediaType,a=s.id.replace(/[0-9]+/,u);e[a]||(e[a]={}),i.processSource(e[a],s,t)}},i=this;for(var s in t.ssrc)n(s);t.VideoBwe&&t.VideoBwe.bweforvideo&&(e.bweStat||(e.bweStat={}),this.addFilteredFields(e.bweStat,t.VideoBwe.bweforvideo,u))},e.prototype.calculateHwSilentState=function(){var e=this.extensions.WebRTCStats.ssrc_audio_send&&this.extensions.WebRTCStats.ssrc_audio_send.audioInputLevel;if(!e||e.length<this.hwSilentDetectionDuration*2)return;var t=!0;for(var n=e.length-this.hwSilentDetectionDuration-1;n<e.length;n++)if(e[n]>this.hwSilentDetectionLevel){t=!1;break}this.hwSilent!=t&&(this.hwSilent=t,this.logger.info("HW silent changed to "+this.hwSilent))},e.prototype.setMediaEntities=function(e){this.mediaEntities=e},e.prototype.setTerminated=function(){this.extensions.EndTime=(new Date).getTime(),this.terminated=!0},e.prototype.startWaitingForStreamStart=function(e,t){this.streamStartDetection||this.sessionInfo.setOfferedModalities(e),this.streamStartDetection=!0},e.prototype.processStatsDict=function(e){try{this.getWebrtcReport(this.extensions.WebRTCStats,e),this.streamStartDetection&&(this.setStartTime(this.sessionInfo.offeredModalities)||this.terminated)&&(this.streamStartDetection=!1),this.calculateHwSilentState();if(this.extensions.WebRTCStats.ssrc_video_send&&this.extensions.WebRTCStats.ssrc_video_send.googFrameRateSent){var t=this.extensions.WebRTCStats.ssrc_video_send.googFrameRateSent;this.videoSendFrameRate.updateEventValue(parseInt(t[t.length-1]))}if(this.extensions.WebRTCStats.ssrc_video_recv&&this.extensions.WebRTCStats.ssrc_video_recv.googFrameRateReceived){var t=this.extensions.WebRTCStats.ssrc_video_recv.googFrameRateReceived;this.videoRecvFrameRate.updateEventValue(parseInt(t[t.length-1]))}if(this.extensions.WebRTCStats.ssrc_sharing_send&&this.extensions.WebRTCStats.ssrc_sharing_send.googFrameRateSent){var t=this.extensions.WebRTCStats.ssrc_sharing_send.googFrameRateSent;this.sharingSendFrameRate.updateEventValue(parseInt(t[t.length-1]))}if(this.extensions.WebRTCStats.ssrc_sharing_recv&&this.extensions.WebRTCStats.ssrc_sharing_recv.googFrameRateReceived){var t=this.extensions.WebRTCStats.ssrc_sharing_recv.googFrameRateReceived[0];this.sharingRecvFrameRate.updateEventValue(parseInt(t[t.length-1]))}this.extensions.WebRTCStats.ssrc_audio_recv&&this.extensions.WebRTCStats.ssrc_audio_recv.googJitterBufferMs&&this.jitterBuffer.updateEventValue(parseInt(this.extensions.WebRTCStats.ssrc_audio_recv.googJitterBufferMs[0]))}catch(n){this.extensions.WebRTCStats={getStatsError:n}}},e.prototype.getReport=function(){this.extensions.WebRTCStats_ssrc_audio_recv_jitterBufferAvgSize=this.jitterBuffer.getResult()?Math.round(this.jitterBuffer.getResult()):-1,this.extensions.WebRTCStats_ssrc_video_send_frameRateAvg=this.videoSendFrameRate.getResult()?this.videoSendFrameRate.getResult():-1,this.extensions.WebRTCStats_ssrc_video_recv_frameRateAvg=this.videoRecvFrameRate.getResult()?this.videoRecvFrameRate.getResult():-1,this.extensions.WebRTCStats_ssrc_sharing_send_frameRateAvg=this.sharingSendFrameRate.getResult()?this.sharingSendFrameRate.getResult():-1,this.extensions.WebRTCStats_ssrc_sharing_recv_frameRateAvg=this.sharingRecvFrameRate.getResult()?this.sharingRecvFrameRate.getResult():-1,this.sessionInfo.fillExtensionInfo(this.extensions);var e=Object.keys(this.extensions.WebRTCStats).length>0&&!this.extensions.WebRTCStats.getStatsError;return e&&this.calculateAverages(),this.report},e.prototype.getAudioHwSilent=function(){return this.hwSilent},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/statistics/sessionInfo",["require","exports","../../common/utils"],e)}(function(e,t){function r(e){var t="";return e.dtls&&(t+="dtls"),e.sdes&&(t+="sdes"),t}var n=e("../../common/utils"),i=function(){function e(){this.info={OfferedSrtp:"none",NegotiatedSrtp:"none",IceConnectionState:"none",IceConnectionStatePrevious:"none",SignalingState:"none",SignalingStatePrevious:"none"}}return e.prototype.setOfferedModalities=function(e){this.offeredModalities=e,this.activeModalities=e},e.prototype.setNegotiatedModalities=function(e){this.negotiatedModalities=e,this.activeModalities=e},e.prototype.setNegotiatedSrtpInfo=function(e){this.info.NegotiatedSrtp=r(e)},e.prototype.setOfferedSrtpInfo=function(e){this.info.OfferedSrtp=r(e)},e.prototype.setIceConnectionState=function(e){this.info.IceConnectionStatePrevious=this.info.IceConnectionState,this.info.IceConnectionState=e},e.prototype.setSignalingConnectionState=function(e){this.info.SignalingStatePrevious=this.info.SignalingState,this.info.SignalingState=e},e.prototype.fillExtensionInfo=function(e){n.assign(e,this.info)},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/statistics/statisticsGatherer",["require","exports","./webrtcStatistics","./sessionInfo","../../common/userAgentAdapter","../../common/utils","../../helper"],e)}(function(e,t){function m(e){var t={};return e.result().forEach(function(e){e.names().forEach(function(n){t[e.type]=t[e.type]||{},t[e.type][e.id]=t[e.type][e.id]||{},t[e.type][e.id][n]=e.stat(n)}),t[e.type][e.id].id=e.id}),t}var n=e("./webrtcStatistics"),r=e("./sessionInfo"),i=e("../../common/userAgentAdapter"),s=e("../../common/utils"),o=e("../../helper"),u="VideoBwe",a="bweforvideo",f="googAvailableReceiveBandwidth",l="googAvailableSendBandwidth",c="mediaType",h="framesDecoded",p="googFrameRateDecoded",d="googFrameRateReceived",v="googTrackId";t.unwrapResults=m;var g=function(){function e(e,t){this.window=i.default.window,this.statisticsChangedListener=s.noop,this.gatheringInterval=1e3,this._sessionInfo=new r.default,this._webRtcStatistics=new n.default(e,{logger:t.logger,sessionInfo:this._sessionInfo,storedRecordsNumber:t.storedRecordsNumber,hwSilentDetectionDuration:t.hwSilentDetectionDuration,hwSilentDetectionLevel:t.hwSilentDetectionLevel}),this.gatheringInterval=t.statGatheringInterval}return Object.defineProperty(e.prototype,"sessionInfo",{get:function(){return this._sessionInfo},enumerable:!0,configurable:!0}),e.prototype.onStatisticsChanged=function(e){var t=this.statisticsChangedListener;this.statisticsChangedListener=function(n){t(n),e(n)},this.startGathering()},e.prototype.initialize=function(e){this.pc=e,this.startGathering()},e.prototype.startWaitingForStreamStart=function(e,t){t===void 0&&(t=!1),this._webRtcStatistics.startWaitingForStreamStart(e,t)},e.prototype.setMediaEntities=function(e){this._webRtcStatistics.setMediaEntities(e)},e.prototype.setTerminated=function(){this._webRtcStatistics.setTerminated()},e.prototype.getReport=function(){var e=this;return this.processStatistics().then(function(){return e.getLastKnownReport()})},e.prototype.getLastKnownReport=function(){var e=this._webRtcStatistics.getReport();return this.addStreamInfoForE2ETests(e),e},e.prototype.dispose=function(){this.interval&&(this.window.clearInterval(this.interval),this.interval=0),this.pc=null},e.prototype.addStreamInfoForE2ETests=function(e){var t=this._sessionInfo.negotiatedModalities;if(!t)return;e.localStreams=this.getSendersReport(this.pc.getSenders(),{audio:o.hasSendDirectionality(t.audio),video:o.hasSendDirectionality(t.video)}),e.remoteStreams=this.getStreamsReport(this.pc.getRemoteStreams(),{audio:o.hasReceiveDirectionality(t.audio),video:o.hasReceiveDirectionality(t.video)})},e.prototype.getStreamsReport=function(e,t){var n=[];return e.forEach(function(e){var r={tracks:[]};n.push(r),e.getTracks().forEach(function(n){(n.kind==="audio"&&t.audio||n.kind==="video"&&t.video)&&r.tracks.push({stream:e,track:n})})}),n},e.prototype.getSendersReport=function(e,t){var n=[],r={tracks:[]};return n.push(r),e.forEach(function(e){!!e.track&&(e.track.kind==="audio"&&t.audio||e.track.kind==="video"&&t.video)&&r.tracks.push({stream:undefined,track:e.track})}),n},e.prototype.startGathering=function(){var e=this;this.isInitialized&&!this.interval&&(this.interval=this.window.setInterval(function(){e.processStatistics()},this.gatheringInterval))},Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this.pc&&this.pc.getStats},enumerable:!0,configurable:!0}),e.prototype.processStatistics=function(){var e=this;return new Promise(function(t){if(!e.pc){t();return}e.pc.getStats(function(n){if(!n.result){t();return}e.processStatsDict(m(n)),t()})})},e.prototype.processStatsDict=function(e){this._webRtcStatistics.processStatsDict(e);var t=0,n=0,r=e[u]?e[u][a]:null;r&&(t=Number(r[f]),n=Number(r[l]));var i=isNaN(t)?0:t,o=isNaN(n)?0:n,m={estimatedReceiveBandwidth:i,estimatedSendBandwidth:o,videoStreams:{},audioHwSilent:this._webRtcStatistics.getAudioHwSilent()};s.forOwn(e.ssrc,function(e){if(e.id.indexOf("_recv")===-1)return;var t=e[v],n=e[c];n==="video"&&(m.videoStreams[t]={trackId:t,frameRateReceived:Number(e[d]),frameRateDecoded:Number(e[p]),framesDecoded:Number(e[h])})}),s.deepEqual(this.statistics,m)||(this.statistics=m,this.notifyStatisticsChanged())},e.prototype.notifyStatisticsChanged=function(){this.statisticsChangedListener(this.statistics)},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=g}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/negotiationEmulator",["require","exports","microsoft-sdp-transform"],e)}(function(e,t){var n=e("microsoft-sdp-transform"),r=function(){function e(e,t,n,r){this.webRtcAdapter=e,this.sessionDescription=t,this.negotiationQueue=n,this.logger=r,this.logger.createChild("emul")}return e.prototype.dispose=function(){this.logger=null,this.peerConnection=null},e.prototype.configure=function(e){this.peerConnection=e},e.prototype.renegotiate=function(e){if(!this.peerConnection)throw new Error("trying to renegotiate during empty peerConnection");return this.negotiationQueue.add(this.createNegotiationTask(e))},e.prototype.normalizeSDESAnswer=function(e){var t=this.peerConnection.localDescription.sdp,r=n.parse(t),i=n.parse(e);if(!r.media[0].crypto)i.media.forEach(function(e){var t=r.media[0].setup;e.setup=="actpass"&&(e.setup=t=="active"?"passive":"active")});else{var s=r.media[0].crypto[0].id;i.media.forEach(function(e){delete e.fingerprint,delete e.setup,e.crypto=e.crypto.filter(function(e){return e.id==s})}),i.fingerprint&&delete i.fingerprint}return n.write(i)},e.prototype.createNegotiationTask=function(e){var t=this,n=function(){if(!t.peerConnection)throw new Error("trying to renegotiate during empty peerConnection")};return function(){var r=new t.webRtcAdapter.RTCSessionDescription({sdp:t.normalizeSDESAnswer(t.peerConnection.remoteDescription.sdp),type:"answer"});return e&&e.forEach(function(e){r=e.modifyDescriptor(r)}),Promise.resolve().then(function(){return n(),t.peerConnection.createOffer()}).then(function(e){n();var r=t.sessionDescription.createLocalOffer(e.sdp),i=new t.webRtcAdapter.RTCSessionDescription({sdp:r.toLocal(),type:"offer"});return t.peerConnection.setLocalDescription(i)}).then(function(){return n(),t.peerConnection.setRemoteDescription(r)})}},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/contributingSourcesHandler",["require","exports","../common/userAgentAdapter"],e)}(function(e,t){var n=e("../common/userAgentAdapter"),r;(function(e){e[e.Stopped=0]="Stopped",e[e.Started=1]="Started",e[e.Unsupported=2]="Unsupported"})(r=t.ContributingSourcesHandlerState||(t.ContributingSourcesHandlerState={}));var i=function(){function e(e){this.context=e,this._state=r.Stopped,this._lastSources=[],this._window=n.default.window,this._logger=e.logger.createChild("contributingSources")}return e.prototype.startPolling=function(){this._state===r.Stopped&&(this._state=r.Started,this._logger.log("polling started"),this._timer=this._window.setTimeout(this.poll.bind(this),this.context.settings.contributingSourcesPollingInterval))},e.prototype.stopPolling=function(){this._state===r.Started&&(this._timer&&(this._window.clearTimeout(this._timer),this._timer=undefined),this._state=r.Stopped,this._logger.log("polling stopped"))},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),e.prototype.poll=function(){var e=this;if(this._state===r.Started){var t=this.context.provider();t?(this.context.activeSpeakerManager.onContributingSourcesChanged(t.filter(function(t){var n=e._lastSources.filter(function(e){return e.source===t.source})[0];return!n||n.timestamp!==t.timestamp}).map(function(e){return e.source})),this.updateLastSources(t),this._timer=this._window.setTimeout(this.poll.bind(this),this.context.settings.contributingSourcesPollingInterval)):(this._logger.log("contributing sources are not supported on this client"),this._state=r.Unsupported,this.stopPolling())}},e.prototype.updateLastSources=function(e){var t=this;this._lastSources=[],e.forEach(function(e){t._lastSources.push({source:e.source,timestamp:e.timestamp})})},e}();t.ContributingSourcesHandler=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/webrtc/webRtcSession",["require","exports","./stream/videoStreamWatcher","../constants","../helper","../async","./webRtcSessionDescription","./adapter/webrtcAdapter","./mediaManager","../common/utils","./webRtcDtmfSender","../common/stream/receiveStreamCollection","../common/render/remoteVideoRenderer","../common/stream/subscriptionManager","../common/resolutionTable","../extensions/extensionsManager","../common/activeSpeaker/activeSpeakerManager","./render/audioRenderer","./stream/webRtcReceiveStream","./quality/qualityManager","./statistics/statisticsGatherer","../common/promiseQueue","../common/settablePromise","./negotiationEmulator","./contributingSourcesHandler"],e)}(function(e,t){var n=e("./stream/videoStreamWatcher"),r=e("../constants"),i=e("../helper"),s=e("../async"),o=e("./webRtcSessionDescription"),u=e("./adapter/webrtcAdapter"),a=e("./mediaManager"),f=e("../common/utils"),l=e("./webRtcDtmfSender"),c=e("../common/stream/receiveStreamCollection"),h=e("../common/render/remoteVideoRenderer"),p=e("../common/stream/subscriptionManager"),d=e("../common/resolutionTable"),v=e("../extensions/extensionsManager"),m=e("../common/activeSpeaker/activeSpeakerManager"),g=e("./render/audioRenderer"),y=e("./stream/webRtcReceiveStream"),b=e("./quality/qualityManager"),w=e("./statistics/statisticsGatherer"),E=e("../common/promiseQueue"),S=e("../common/settablePromise"),x=e("./negotiationEmulator"),T=e("./contributingSourcesHandler"),N=396,C=1e4,k=function(e,t,L){function wt(n){n===void 0&&(n=!1);var r=f.shallowClone(e);r.config=f.shallowClone(e.config),n&&(r.config.isConference=!0);var i=new k(r,t,L);return A.relayManagerProvider&&(i.relayManagerProvider=A.relayManagerProvider),i.callbacks.onNegotiationRequired=A.callbacks.onNegotiationRequired,i}function Et(e){e.allowedModalities&&(nt=e.allowedModalities);if(e.extensionsManager&&Pt){var t=e.extensionsManager.getExtension(r.default.EXTENSION_TYPE.videoStreamControl);t&&t.getOptions()&&Pt.configureExtension(r.default.EXTENSION_TYPE.videoStreamControl,t.getOptions())}e.subscriptionManager&&(vt&&vt.dispose(),vt=e.subscriptionManager,vt.setStreamProvider({getStreams:Bt,onStreamsChanged:jt}),Ft())}function St(e){e.setInternals({subscriptionManager:vt,extensionsManager:Pt,allowedModalities:nt}),e.setMuteAsync(z),vt=null,A.callbacks.onTerminated=null}function xt(e,t){if(Mt.isPending)return M.log("##### Renegotiation is in progress, no local resolution switch for now #####"),Mt.promise.then(function(){return Promise.resolve(!1)});if(!q)return M.log(e+" is ignored as no video is sent, no renegotiation"),Promise.resolve(!0);M.log("Queueing local renegotiation...");var n=!1;return _t.add(function(){return M.log("############# LOCAL RENEGOTIATION START #############"),gn(e,t).then(function(){n=!0})}),Dt.renegotiate().then(function(){return M.log("############# LOCAL RENEGOTIATION END. RESULT: "+n+"  #############"),n})}function Tt(e){L.onOptimalVideoReceiversCountChanged&&L.onOptimalVideoReceiversCountChanged(e)}function Ht(){var e=new v.default;return e.addExtension(r.default.EXTENSION_TYPE.dominantSpeakerHistory,{logger:M,callback:Nt.onDominantSpeakerHistoryChanged.bind(Nt)}),e.addExtension(r.default.EXTENSION_TYPE.videoStreamControl,{logger:M,negotiationEmulator:Dt,qualityManager:yt}),e}function Bt(){return pt.getStreams()}function jt(e){ut=e}function Ft(){if(dt)return;Mt.promise.catch(function(){}).then(function(){dt=!1,ut&&ut()})}function It(e,t,n){var r=e.getMediaStream();if(r){var i=B.getMaxFS(t,n),s=H.getMediaEntityByStreamId(r.id);if(!s||!s.getVideoCapabilities()){M.warn("no capabilities for provided modality:",e.getModality());return}s.getVideoCapabilities().setMaxFS(i,function(){M.log("updated max-fs video capability to",i),un(!0)})}else M.warn("renderer has no stream attached")}function qt(e){M.error("Media error occurred","type:",e.type,"detail:",e.detail),A.callbacks.onSessionErrorOccurred&&A.callbacks.onSessionErrorOccurred(e)}function Rt(){M.log("audio transport connected"),A.callbacks.onAudioStateChanged(r.default.STREAMING_STATE.active),A.callbacks.onTransportConnected&&A.callbacks.onTransportConnected()}function Ut(e){r.default.MODALITY.audio===e.getModality()&&(kt.play(e.getMediaStream()),kt.setOutputDevice(_.getOutputDeviceId())),r.default.MODALITY.sharing===e.getModality()&&bt.watchStream(e.getMediaStream()),Ft()}function zt(e){r.default.MODALITY.audio===e.getModality()&&kt.getStream()===e.getMediaStream()&&kt.stop(),r.default.MODALITY.sharing===e.getModality()&&bt.stopWatchingStream(e.getMediaStream()),Ft()}function Wt(e){Y=e,mt.sessionInfo.setNegotiatedModalities(e)}function Xt(){var e="webrtcIceGatheringTimeoutMs"in O?O.webrtcIceGatheringTimeoutMs:C;if(!e)return;X>0&&clearTimeout(X);var t=W;X=setTimeout(function(){X=0,t.isPending&&(M.warn("ICE candidates gathering terminated due to timeout "+e),t.resolve())},e)}function Vt(){M.log("reset candidate gathering"),W.promise.then(function(){},function(){}),W.reject(new Error("reset candidate gathering")),W=new S.SettablePromise}function $t(e,t){A.callbacks.onAudioQualityChanged&&A.callbacks.onAudioQualityChanged({type:e,value:t?3:1,isLocalSource:!0,mediaType:0})}function Jt(e){if(e.hasIceCandidates()==J){J=!J,$t(37,J);if(J)throw{type:r.default.MEDIA_ERROR.noNetworkError,detail:"no ice candidates"}}if(e.hasIceCandidates()&&e.hasRelayIceCandidates()==K){if(!e.hasRelayIceCandidates()&&(F.iceConnectionState==="connected"||F.iceConnectionState==="completed"))return;K=!K,$t(32,K)}}function Kt(){if(!W.isPending)return;M.info("ICE candidates gathered completely"),W.resolve()}function Qt(){M.log("reset peer connection"),kt&&kt.dispose(),lt&&(lt.dispose(),lt=null),F&&F.close(),Ln(),bt.dispose(),F=null,Ct.stopPolling(),Dt.configure(null),I=null,Vt(),$=!0,Y={}}function Gt(){if(!O.iceDisconnectedTimeoutMs)return;rt=setTimeout(function(){M.error("ice disconnected for ",O.iceDisconnectedTimeoutMs,"ms. Raise CONSTANTS.MEDIA_ERROR.iceConnectionError"),qt({type:r.default.MEDIA_ERROR.iceConnectionError,detail:"ice transport disconnected"})},O.iceDisconnectedTimeoutMs)}function Yt(){rt&&(clearTimeout(rt),rt=null)}function Zt(e){return e.reduce(function(e,t){return t.addresses.map(function(n){function r(e,r){return{urls:t.type+":"+n+":"+e+(r?"?transport="+r:""),credential:t.password,username:t.username}}t.udpPort===t.tcpPort?e.push(r(t.udpPort)):O.iceServerTransport?O.iceServerTransport==="udp"?e.push(r(t.udpPort,"udp")):O.iceServerTransport==="tcp"&&e.push(r(t.tcpPort,"tcp")):(e.push(r(t.udpPort,"udp")),e.push(r(t.tcpPort,"tcp")))}),e},[])}function en(e){var t;if(G){var n=G.getSrtpInfo();mt.sessionInfo.setOfferedSrtpInfo(n),t=!n.dtls||n.sdes&&O.preferSdesSrtp}else t=O.preferSdesSrtp;t&&(M.log("configuring peer connection to use sdes"),e.optional.push({DtlsSrtpKeyAgreement:!1})),mt.sessionInfo.setNegotiatedSrtpInfo({dtls:!t,sdes:!!t})}function tn(e){O.webrtcNativeCpuOveruseDisabled&&P&&e.optional.push({googCpuOveruseDetection:!1})}function nn(){if(!I){if(!A.relayManagerProvider)throw new Error("relay manager provider is not set!");I=A.relayManagerProvider.getRelayManager().queryRelaysAsync("turn",e.config.isRemoteClientLync).then(function(t){if(st)throw new Error("session already disposed");var n={optional:[]};en(n),tn(n),M.log("create peer connection"),F=new D.RTCPeerConnection({iceServers:Zt(t),rtcpMuxPolicy:"require",iceTransportPolicy:e.config.iceTransportPolicy?e.config.iceTransportPolicy:r.default.ICE_TRANSPORT_POLICY.all,bundlePolicy:e.config.bundlePolicy?e.config.bundlePolicy:"max-bundle"},n),Dt.configure(F),mt.initialize(F),Ct.startPolling(),F.onnegotiationneeded=function(e){var t=e.target;M.log("onnegotiationneeded","signalingState:",t.signalingState)},F.onsignalingstatechange=function(e){var t=e.target;mt.sessionInfo.setSignalingConnectionState(t.signalingState),M.log("onsignalingstatechange","signalingState:",t.signalingState)},F.onaddstream=function(e){var t=e.stream;M.log("onaddstream","stream:",t);var n=H.getMediaEntityByStreamId(t.id);n||(M.log("cannot find media entity with stream id"+t.id+", trying to fallback"),t.getAudioTracks()[0]&&(n=H.getMediaEntitiesByModality(r.default.MODALITY.audio)[0]));if(n){var i=rn(t,n.getModality(),+n.getXSourceStreamId());pt.add(i)}else M.error("could not find media entity for an added stream:",t.id)},F.ontrack=function(e){M.log("ontrack","track:",e.track)},F.onremovestream=function(e){M.log("onremovestream","stream:",e.stream),pt.remove(e.stream.id)},F.onicecandidate=function(e){M.log("onicecandidate","candidate:",e.candidate);if(!W.isPending)return;e.candidate?e.candidate.candidate.indexOf("typ relay")>-1&&s.delay(100).then(function(){return Kt()}):Kt()},F.onicegatheringstatechange=function(e){var t=e.target;M.log("onicegatheringstatechange","iceGatheringState:",t.iceGatheringState)},F.oniceconnectionstatechange=function(e){var t=e.target;if(st)return;mt.sessionInfo.setIceConnectionState(t.iceConnectionState),M.log("oniceconnectionstatechange","iceConnectionState:",t.iceConnectionState,"pc.signalingState:",t.signalingState),t.iceConnectionState==="connected"||t.iceConnectionState==="completed"?Rt():t.iceConnectionState==="failed"&&qt({type:r.default.MEDIA_ERROR.iceConnectionError,detail:"ice transport failed"}),t.iceConnectionState==="disconnected"?Gt():Yt()}})}return I}function rn(e,t,n){return new y.default(e,t,n,{requestSource:function i(e,n){return P?Y[t]==r.default.MEDIA_STATE.inactive?s.delay(10).then(function(){return i(e,n)}):Mt.isPending?Mt.promise.catch(function(){}).then(function(){return i(e,n)}):Promise.resolve().then(function(){var t=Pt.getExtension(r.default.EXTENSION_TYPE.videoStreamControl);return t.requestSource(e,n)}):Promise.resolve()}})}function sn(e){if(!et)throw new Error(e)}function on(e){function t(e){return!!e&&(i.hasReceiveDirectionality(e)||e==="inactive")}return{offerToReceiveAudio:+t(e.audio),offerToReceiveVideo:+t(e.video)+ +t(e.sharing)}}function un(e){$?($=!1,V=!1,M.log("triggering renegotiation"),H.backup(),A.callbacks.onNegotiationRequired&&A.callbacks.onNegotiationRequired()):e&&(M.log("renegotiation postponed"),V=!0)}function an(e){var t=Lt.then(function(){return new Promise(function(t){if(!e||!e.audio&&!e.video&&!e.sharing)throw new Error("Invalid parameters!"+JSON.stringify(e));var n=!et||!i.areNegotiatedDirectionsFulfilled(e,Y);et=e,M.log("configure modalities","audio:",e.audio,"video:",e.video,"sharing",e.sharing,"peerconnection:",!!F,"pc.signalingState:",F?F.signalingState:"-","needNewRenegotiation:",n),n&&un(),t(et)})});return Lt=t.catch(function(e){M.warn("Error during configuring modalities: ",e)}),t}function fn(){return et}function ln(e){nt={audio:[r.default.MEDIA_STATE.inactive,r.default.MEDIA_STATE.receive],video:[r.default.MEDIA_STATE.inactive,r.default.MEDIA_STATE.receive],sharing:[r.default.MEDIA_STATE.inactive,r.default.MEDIA_STATE.receive]},e.audio&&(nt.audio.push(r.default.MEDIA_STATE.send),nt.audio.push(r.default.MEDIA_STATE.sendReceive)),e.video&&(nt.video.push(r.default.MEDIA_STATE.send),nt.video.push(r.default.MEDIA_STATE.sendReceive))}function cn(){return nt}function hn(e,t,n){var s=i.hasSendDirectionality(Y.audio),o=i.hasSendDirectionality(Y.video),u=i.hasSendDirectionality(Y.sharing),a=i.isOnHold(Y),f=i.hasSendDirectionality(e.audio),l=i.hasSendDirectionality(e.video),c=i.hasSendDirectionality(e.sharing),h=i.isOnHold(e);return nn().then(function(){M.log("updatePeerConnectionStreamsAsync","pc state",F.signalingState,"hold","[",a,"->",h,"]","audio","[",s,"->",f,"]","video","[",o,"->",l,"]","sharing","[",u,"->",c,"]");if(a!==h){q&&q.setHold(h),R&&R.setHold(h),U&&U.setHold(h);if(h)return}if(s!==f||o!==l||u!==c||Q){n&&(Q=!1);var e=function(){d(r.default.MODALITY.audio)},i=function(){d(r.default.MODALITY.video)},p=function(){d(r.default.MODALITY.sharing)},d=function(e){e in Ot&&(M.log("remove sender","track kind:",Ot[e].track.kind,"track id:",Ot[e].track.id),F.removeTrack(Ot[e]),delete Ot[e])},v=function(e,t,n){if(!e)return;M.log("add media track","kind:",e.kind,"id:",e.id);if(Ot[n])throw new Error("track already created, modality:"+n+", kind:"+e.kind+", id:"+e.id);Ot[n]=F.addTrack(e,t)},m=function(){H.setMediaTracks(vn()),mt.setMediaEntities(H.getMediaEntities())};if(t){M.log("not using any media(track api) track, remove all senders"),f||(e(),On());if(!n||!l)i(),An();if(!n||!c)p(),Mn()}if(n){var g=[];if(l){var y=_.getVideoStream();g.push(y.start().then(function(){try{i(),An();if(!F){y.dispose();return}v(y.getObject().getVideoTracks()[0],y.getObject(),r.default.MODALITY.video),y.onApplyConstraints=function(e){i(),e.then(function(){v(y.getObject().getVideoTracks()[0],y.getObject(),r.default.MODALITY.video),m()})},q=y}catch(e){throw i(),An(),y.dispose(),e}}))}if(f){var b=_.getAudioStream();g.push(b.start().then(function(){try{!R||!b.isSameStream(R)?(e(),On(),v(b.getObject().getAudioTracks()[0],b.getObject(),r.default.MODALITY.audio),b.setMute(z),R=b):b.dispose()}catch(t){throw e(),On(),b.dispose(),t}}))}if(c){var w=_.getVideoStream();g.push(w.start().then(function(){try{v(w.getObject().getVideoTracks()[0],w.getObject(),r.default.MODALITY.sharing),t&&(p(),Mn()),U=w}catch(e){throw p(),Mn(),w.dispose(),e}}))}return Promise.all(g).then(function(){return m()})}}})}function pn(){Mt.reject("promise expired"),Mt=new S.SettablePromise,_t.add(Mt)}function dn(){var e=_t.add(function(){return new Promise(function(e){M.log("create [offer] configured:",et),ot=!0,sn("no configured modalities to create offer for"),$=!1,tt=i.excludePassiveModalities(et,At,Z),Z=tt;var t=i.negotiateModalities(Z,tt);e(hn(Z,!0,!0).then(function(){var e=on(Z);return M.log("create [offer]","offered:",Z,"constraints:",e),F.createOffer(e)}).then(function(e){M.debug("create [offer] offer from peer connection","sdp:",e.sdp);var t=j.createLocalOffer(e.sdp);t.needToWaitIceCandidates()&&Vt(),mt.startWaitingForStreamStart(Z);var n=new D.RTCSessionDescription({sdp:t.toLocal(),type:"offer"});return Xt(),Promise.all([F.setLocalDescription(n),W.promise])}).then(function(){var e=j.createLocalOffer(F.localDescription.sdp);e.updateModalities(Z),Jt(e);var n=e.toOffer();return M.debug("CREATE OFFER","sdp:",n),{blob:n,contentType:ct,modalities:t}}))})});return pn(),e}function vn(){var e=[];return f.forOwn(Ot,function(t,n){e.push({track:t.track.id,modality:n})}),e}function mn(e){var t=_t.add(function(){return new Promise(function(t){var n=e.blob;M.debug("process [offer]","sdp:",n),f.throwIfNotSupported(e.contentType,ht),ot=!1,G=j.createRemoteOffer(n),$=!1,Z=i.invertModalities(G.getModalities());var r=Promise.resolve(Z);if(i.hasSendDirectionality(Z.video)||i.hasReceiveDirectionality(Z.video)||i.hasSendDirectionality(Z.sharing)||i.hasReceiveDirectionality(Z.sharing)){var s=G.getVideoCodecs();r=D.RTCRtpReceiver.getCapabilities("video").then(function(e){var t=e.codecs.some(function(e){return s.some(function(t){return e.mimeType===t})});if(!t){M.warn("offer doesn't contain any supported video codecs");var n=f.shallowClone(Z);return n.video=void 0,n.sharing=void 0,n}return Z}).catch(function(e){return M.error("failed to get video capability",e),Z})}t(r.then(function(e){return M.log("process [offer]","offered:",Z,"acceptable:",e),e}))})});return pn(),t}function gn(e,t){return q?(M.log("Changing resolution to "+e+"@"+t),q.applyConstraints({maxFS:e.fs,maxFPS:t}).then(function(t){return yt.setCurrentResolution(e),t})):(M.log("Resolution "+e+"@"+t+" ignored, no video is being sent"),Promise.resolve(!1))}function yn(e){if(O.enableLocalVideoConstraints&&i.hasReceiveDirectionality(e.getModalities().video)){var t=e.getVideoRecvCapabilities();if(t.maxFS&&t.maxFPS){yt.setMaxCapabilities(t);var n=q&&q.hasVideo(),r=!at&&yt.getCurrentResolution()&&yt.getCurrentResolution().height==180;if(!n||yt.getActive()||r)return Promise.resolve(!1);var s=B.getResolution(t.maxFS);return!at&&s.height!=180&&(s=B.getResolution(N)),gn(s,t.maxFPS)}M.error("remote endpoint didn't specify video receive capability")}return Promise.resolve(!1)}function bn(e){return new Promise(function(t){if(e){t({blob:"",contentType:ct,modalities:{audio:"sendrecv",video:"sendrecv",sharing:"sendrecv"}});return}M.log("create [answer]","offered:",Z,"configured:",et),sn("no configured modalities to create answer for"),tt=i.excludePassiveModalities(et,At,Z);var n=i.negotiateModalities(Z,tt);t(hn(n,!0,!1).then(function(){return yn(G)}).then(function(){return wn()}).then(function(){var e=G.toRemote(n);return M.log("create [answer] set remote description","negotiated:",n,"sdp:",e),F.setRemoteDescription(new D.RTCSessionDescription({sdp:e,type:"offer"}))}).then(function(){return A.callbacks.onTransportInitialized&&A.callbacks.onTransportInitialized(),hn(n,!1,!0)}).then(function(){return F.createAnswer()}).then(function(e){M.debug("create [answer] answer from peer connection","sdp:",e.sdp);var t=j.createLocalAnswer(e.sdp);t.needToWaitIceCandidates()&&Vt(),mt.startWaitingForStreamStart(n);var r=new D.RTCSessionDescription({sdp:t.toLocal(),type:"answer"});return Xt(),Promise.all([F.setLocalDescription(r),W.promise])}).then(function(){var e=j.createLocalAnswer(F.localDescription.sdp);e.updateModalities(n),Jt(e);var t=e.toAnswer();return n=e.getModalities(),Wt(n),M.debug("CREATE ANSWER","sdp:",t),{blob:t,contentType:ct,modalities:Y}}))})}function wn(){return G.isCodecSwitchSupported()?Promise.resolve():D.RTCRtpReceiver.getCapabilities(r.default.MEDIA_TYPE.audio).then(function(e){var t=e.codecs.map(function(e){return e.mimeType});G.usePrimaryAudioCodecOnly(t)}).catch(function(e){M.error("failed to set primary codec based on audio capability",e)})}function En(e,t){return new Promise(function(n){var r=e.blob;M.debug(t?"PROCESS PRANSWER":"PROCESS ANSWER","sdp:",r),f.throwIfNotSupported(e.contentType,ht);if(t){M.log("process [pranswer]"),n({});return}var s=j.createRemoteAnswer(r),o=i.invertModalities(s.getModalities());Wt(o);var u=s.toRemote(Y);M.log("process [answer] set remote description","negotiated:",Y,"sdp:",u),n(F.setRemoteDescription(new D.RTCSessionDescription({sdp:u,type:"answer"})).then(function(){return A.callbacks.onTransportInitialized&&A.callbacks.onTransportInitialized(),Y}).then(function(){return yn(s)}).then(function(e){e&&un(!0)}).then(function(){return Y}))})}function Sn(){return new Promise(function(e){H.commit();var t=i.excludePassiveModalities(et,At,Z),n=Q&&!i.isOnHold(Y)||!i.areNegotiatedDirectionsAcceptable(t,tt,Y)||V,r=!n;$=!0,M.log("negotiation completed","isComplete:",r,"configured:",et,"negotiating:",tt,"offered:",Z,"negotiated:",Y),n&&un(),Mt.resolve(),e({isComplete:r,activeModalities:Y,offeredModalities:Z,attemptedModalities:tt,configuredModalities:et,initiator:ot})})}function xn(e,t){return new Promise(function(n){H.rollback();var r=!t,i=Promise.resolve();M.warn("negotiation rejected","isComplete:",r,"error:",e,"configured:",et,"negotiating:",tt,"offered:",Z,"negotiated:",Y),F&&("have-local-offer"===F.signalingState?(M.log("rolling back local description"),i=F.setLocalDescription(new D.RTCSessionDescription({type:"rollback"}))):M.error("cannot rollback local description in currrent state:",F.signalingState)),Mt.reject("negotiation rejected"),n(i.then(function(){return t&&(M.log("retrying failed negotiation"),un()),{isComplete:r,activeModalities:Y,offeredModalities:Z,attemptedModalities:tt,configuredModalities:et,initiator:ot}}))})}function Tn(e,t){var n=new h.default({settings:O,logger:M,subscriptionManager:vt},e,t,It);return n}function Nn(){F&&(kt&&kt.getStream()&&kt.setOutputDevice(_.getOutputDeviceId()),yt.setCurrentResolution(null),i.isOnHold(Y)||(Q=!0,un(!0)))}function Cn(){return M.log("terminate"),mt.setTerminated(),Bn().then(function(){st=!0,kn()},kn)}function kn(){mt.dispose(),Nt.dispose(),Qt(),vt&&vt.dispose(),Yt(),Pt&&Pt.dispose(),A.callbacks.onTerminated&&A.callbacks.onTerminated(),L=null}function Ln(){On(),An(),Mn()}function An(){q&&(q.dispose(),q=null),yt.setCurrentResolution(null)}function On(){R&&(R.dispose(),R=null)}function Mn(){U&&(U.dispose(),U=null)}function _n(){return O.enableReconnectChrome}function Dn(){return Hn(!0)}function Pn(){return Hn(!1)}function Hn(e){return z=e,R&&R.setMute(e),Promise.resolve()}function Bn(){return st||(it=it.then(function(){return mt.getReport()}).then(function(e){return e}).catch(function(e){return M.error("getting statistics should never fail:",e),{}})),it}function jn(){return mt.getLastKnownReport()}function Fn(e){return lt.sendDtmf(F,e)}function In(){return lt.canSendDtmf(F)}function qn(){return Pt}this.configureModalitiesAsync=an,this.getAllowedModalities=cn,this.createOfferAsync=dn,this.processOfferAsync=mn,this.createAnswerAsync=bn,this.processAnswerAsync=En,this.completeNegotiationAsync=Sn,this.rejectNegotiationAsync=xn,this.createRemoteRenderer=Tn,this.getStatsAsync=Bn,this.getLastKnownStats=jn,this.terminate=Cn,this.isReconnectSupported=_n,this.muteInputAsync=Dn,this.unmuteInputAsync=Pn,this.setMuteAsync=Hn,this.sendDtmf=Fn,this.canSendDtmf=In,this.callbacks={},this.getExtensionsManager=qn,this._deviceSelectionChanged=Nn,this._devicePermissionsChanged=ln,this.clone=wt,this.setInternals=Et,this.move=St,this.getConfiguredModalities=fn,this.relayManagerProvider=null,this.getAcceptedTypes=function(){return ht};var A=this,O=e.maContext.settings,M=e.getLogger().createChild("webrtc"),_=e.getDeviceManager(),D=u.default.build({global:e.maContext}),P=e.config&&e.config.isConference,H=new a.default({logger:M,settings:O,numVideoChannels:P&&O.numVideoChannelsGvc?O.numVideoChannelsGvc:1}),B=new d.default,j=o.default.build({sdpTransform:new D.SdpTransform(e.maContext),mediaManager:H,settings:O,logger:M}),F=null,I,q=null,R=null,U=null,z=e.config.muted,W=new S.SettablePromise,X=null,V=!1,$=!0,J=!1,K=!1,Q=!1,G,Y={},Z,et,tt,nt={audio:[r.default.MEDIA_STATE.inactive,r.default.MEDIA_STATE.receive,r.default.MEDIA_STATE.send,r.default.MEDIA_STATE.sendReceive],video:[r.default.MEDIA_STATE.inactive,r.default.MEDIA_STATE.receive,r.default.MEDIA_STATE.send,r.default.MEDIA_STATE.sendReceive],sharing:[r.default.MEDIA_STATE.inactive,r.default.MEDIA_STATE.receive,r.default.MEDIA_STATE.send,r.default.MEDIA_STATE.sendReceive]},rt=null,it=Promise.resolve({}),st=!1,ot=!1,ut=null,at=!P||O.webrtcMultiPartyVideoScaling,ft=O.webrtcVideoScaling,lt=l.default.build(M,O.dtmf),ct=O.webrtcMediaContentType||r.default.CONTENT_TYPE.SDP,ht=O.webrtcAllowedMediaContentType||r.default.ALLOWED_CONTENT_TYPES.SDP_ONLY,pt=new c.default({streamAdded:Ut,streamRemoved:zt}),dt=!1,vt=new p.default({logger:M},{getStreams:Bt,onStreamsChanged:jt}),mt=new w.default(t,{logger:M,storedRecordsNumber:Number(O.webrtcStatStoredRecordsNumber)||60,statGatheringInterval:Number(O.webrtcStatPollInterval)||1e3,hwSilentDetectionDuration:Number(O.webrtcStatHwSilentDetectionDuration)||5,hwSilentDetectionLevel:Number(O.webrtcStatHwSilentDetectionLevel)||7}),gt=!1;mt.onStatisticsChanged(function(e){gt!=e.audioHwSilent&&(gt=e.audioHwSilent,A.callbacks.onAudioHwSilentChanged&&A.callbacks.onAudioHwSilentChanged(gt))});var yt=new b.default({logger:M,resolutionTable:B,settings:{videoReceiversCount:O.webrtcVideoReceiversCount||1,bandwidthPerVideoReceiver:O.webrtcBandwidthPerVideoReceiver||2e5,cooldownTimeout:O.webrtcResolutionManagerCooldownTimeout,slidingWindowSamples:O.webrtcQualitySlidingWindowSamples||20,slidingWindowPercentile:O.webrtcQualitySlidingWindowPercentile||.3,retryDelay:O.webrtcResolutionManagerRetryDelay,scalingEnabled:ft||P,maxResolution:at?null:B.getResolution(N)}},{onOptimalVideoReceiversCountChanged:Tt,applyResolution:xt},{onStatisticsChanged:function(e){mt.onStatisticsChanged(e)}}),bt=new n.VideoStreamWatcher({statsGatherer:mt,logger:M,recoverWaitTimeout:O.webrtcVideoStreamRecoverWaitTimeout||2e4},{onStreamIncomingDecoderFailed:function(){M.warn("ScreenSharing stream decoding failed, attemping recovery"),un(),A.callbacks.onScreenSharingIncomingDecoderFailed&&A.callbacks.onScreenSharingIncomingDecoderFailed()},onStreamIncomingDecoderActive:function(){A.callbacks.onScreenSharingIncomingDecoderActive&&A.callbacks.onScreenSharingIncomingDecoderActive()},onStreamIncomingDecoderReset:function(){A.callbacks.onScreenSharingIncomingDecoderReset&&A.callbacks.onScreenSharingIncomingDecoderReset()}}),Nt=new m.ActiveSpeakerManager(L.onContributingSourcesChanged,L.onDominantSpeakerChanged),Ct=new T.ContributingSourcesHandler({activeSpeakerManager:Nt,logger:M,settings:{contributingSourcesPollingInterval:O.webrtcContributingSourcesPollingInterval||1e3},provider:function(){if(!F)return[];if(!F.getReceivers||!P)return undefined;var e=F.getReceivers().filter(function(e){return e.track.kind==="audio"})[0];return e?e.getContributingSources?e.getContributingSources():undefined:[]}}),kt=new g.default({logger:M}),Lt=Promise.resolve(),At=e.config.passiveModalities,Ot={},Mt=new S.SettablePromise;Mt.promise.catch(function(){}),Mt.reject("placeholder");var _t=new E.PromiseQueue(M),Dt=new x.default(D,j,_t,M),Pt=Ht()};Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e,t,n){return new k(e,t,n)}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/common/capabilities",["require","exports","./userAgentAdapter"],e)}(function(e,t){var n=e("./userAgentAdapter"),r=function(){function e(e){this.window=n.default.window,this.overrides=this.getCapabilityOverrides(e.settings),this.audio=this.getCapability("audio"),this.video=this.getCapability("video"),this.screensharing=this.getCapability("screensharing"),this.retargeting=this.getCapability("retargeting")}return e.prototype.hasWebRtc=function(){return typeof this.window.RTCPeerConnection!="undefined"},e.prototype.hasOrtc=function(){return typeof this.window.RTCIceGatherer!="undefined"},e.prototype.hasMediaCapture=function(){return!!this.window.navigator.getUserMedia},e.prototype.getCapabilityOverrides=function(e){var t;return e.capabilities&&(this.hasOrtc()?t=e.capabilities.ortc:this.hasWebRtc()&&(t=e.capabilities.webrtc)),t||{}},e.prototype.getCapability=function(e){return typeof this.overrides[e]!="undefined"?!!this.overrides[e]:this.hasMediaCapture()&&(this.hasOrtc()||this.hasWebRtc())},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e){return new r(e)}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/mediaAgent",["require","exports","./common/session","./device/deviceManager","./ortc/ortcSession","./webrtc/webRtcSession","./common/utils","./common/capabilities","./constants","./helper"],e)}(function(e,t){var n=e("./common/session"),r=e("./device/deviceManager"),i=e("./ortc/ortcSession"),s=e("./webrtc/webRtcSession"),o=e("./common/utils"),u=e("./common/capabilities"),a=e("./constants"),f=e("./helper"),l=function(e,t){function p(){return l}var a=e.getLogger().createChild("MA",undefined,e.settings.debug),f=a.createChild("DeviceManager"),l=new r.default({logger:f,settings:e.settings},t),c=[],h=u.default.build({settings:e.settings});l.deviceSelectionChanged=function(){c.forEach(function(e){return e._deviceSelectionChanged()})},l.qualityChanged=function(e){c.forEach(function(t){return t._qualityChanged(e)})},l.devicePermissionsChanged=function(e){c.forEach(function(t){return t._devicePermissionsChanged(e)})},this.createSession=function(t,r,u){var f=a.createChild("Session",r),l={getDeviceManager:p,getLogger:function(){return f},maContext:e,config:u?u:{}},h=typeof RTCIceGatherer=="undefined"?s.default:i.default,d=h.build(l,r,t),v=new n.default(d,l,r,t);return v.onTerminated=function(){o.remove(c,function(e){return e===v})},c.push(v),v},this.getDeviceManager=p,this.getCapabilities=function(){return h},this.getScreenSharingManager=function(){return{onScreensChanged:function(){return{dispose:function(){}}},enumerateScreensAsync:function(){return Promise.resolve([])},enumerateWindowsAsync:function(){return Promise.resolve([])}}}};Object.defineProperty(t,"__esModule",{value:!0}),t.default={build:function(e,t){return new l(e,t)},isPlatformSupported:function(){return navigator.getUserMedia&&(typeof RTCPeerConnection!="undefined"||typeof RTCIceGatherer!="undefined")},constants:a.default,helper:f}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("media-agent/lib/public",["require","exports","./constants","./helper","./mediaAgent"],e)}(function(e,t){var n=e("./constants"),r=e("./helper");t.Helper=r;var i=e("./mediaAgent");t.MediaAgent=i.default,t.Constants=n.default}),define("media-agent",["media-agent/lib/public"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("web-calling/lib/utilities/modelHelper",["require","exports","../utilities/typeDefs","media-agent","signaling-agent"],e)}(function(e,t){function s(e){if(!e||e.code===undefined)return n.TerminatedReason.Undefined;switch(e.code){case i.CA_CONSTANTS.CALL_END_CODE.REJECT:return n.TerminatedReason.Declined;case i.CA_CONSTANTS.CALL_END_CODE.SUCCESS:return n.TerminatedReason.Success;case i.CA_CONSTANTS.CALL_END_CODE.CANCEL:return n.TerminatedReason.Cancelled;case i.CA_CONSTANTS.CALL_END_CODE.TIMEOUT:return n.TerminatedReason.CallEstablismentTimeout;case i.CA_CONSTANTS.CALL_END_CODE.SERVICE_UNAVAILABLE:return n.TerminatedReason.CallSetupError;case i.CA_CONSTANTS.CALL_END_CODE.BAD_REQUEST:return n.TerminatedReason.BadRequest;case i.CA_CONSTANTS.CALL_END_CODE.NO_NGC_ENDPOINT:return n.TerminatedReason.NoNgcEndpoint;case i.CA_CONSTANTS.CALL_END_CODE.P2P_FALLBACK_FOR_SCREENSHARING:case i.CA_CONSTANTS.CALL_END_CODE.CONFLICT:return n.TerminatedReason.Undefined;case i.CA_CONSTANTS.CALL_END_CODE.MEDIA_ERROR:return n.TerminatedReason.MediaError;case i.CA_CONSTANTS.CALL_END_CODE.CALL_DOES_NOT_EXIST:case i.CA_CONSTANTS.CALL_END_CODE.CALL_ACCEPTED:case i.CA_CONSTANTS.CALL_END_CODE.CALL_FORWARDED:case i.CA_CONSTANTS.CALL_END_CODE.CALL_FORWARDED_TO_VOICEMAIL:return n.TerminatedReason.Undefined;case i.CA_CONSTANTS.CALL_END_CODE.P2P_REJECT_CALL:return n.TerminatedReason.Declined;case i.CA_CONSTANTS.CALL_END_CODE.P2P_FALLBACK_DUE_TO_GROUPCALL:case i.CA_CONSTANTS.CALL_END_CODE.CALL_LEG_ENDED_ON_SERVICE:case i.CA_CONSTANTS.CALL_END_CODE.NOT_ACCEPTABLE_HERE:return n.TerminatedReason.Undefined;case i.CA_CONSTANTS.CALL_END_CODE.NETWORK_ERROR:return n.TerminatedReason.NetworkError;case i.CA_CONSTANTS.CALL_END_CODE.UNKNOWN_ERROR:return n.TerminatedReason.Undefined;case i.CA_CONSTANTS.CALL_END_CODE.LOCAL_ERROR:return n.TerminatedReason.CallSetupError;case i.CA_CONSTANTS.CALL_END_CODE.CALL_MODALITY_FAILURE:case i.CA_CONSTANTS.CALL_END_CODE.GLARE_ERROR:case i.CA_CONSTANTS.CALL_END_CODE.NOT_FOUND:return n.TerminatedReason.Undefined;default:return n.TerminatedReason.Undefined}}function o(e){var t=[];return e.audio&&t.push(i.CA_CONSTANTS.MEDIA_TYPES.AUDIO),e.video&&t.push(i.CA_CONSTANTS.MEDIA_TYPES.VIDEO),r.Helper.hasSendDirectionality(e.sharing)&&t.push(i.CA_CONSTANTS.MEDIA_TYPES.SCREEN_SHARER),t}function u(e){var t=[];return r.Helper.hasReceiveDirectionality(e.audio)&&t.push(i.CA_CONSTANTS.MEDIA_TYPES.AUDIO),r.Helper.hasReceiveDirectionality(e.video)&&t.push(i.CA_CONSTANTS.MEDIA_TYPES.VIDEO),r.Helper.hasReceiveDirectionality(e.sharing)&&t.push(i.CA_CONSTANTS.MEDIA_TYPES.SCREEN_SHARER),t}function f(e,t){var i=[],s=t===a.receive?r.Helper.hasReceiveDirectionality:r.Helper.hasSendDirectionality;return s(e.audio)&&i.push(n.StreamType.Audio),s(e.video)&&i.push(n.StreamType.Video),s(e.sharing)&&i.push(n.StreamType.ScreenSharing),i}function l(e){var t={blob:e.blob,mediaLegId:e.mediaLegId,contentType:e.contentType||i.CA_CONSTANTS.CONTENT_TYPE.SDP};return e.newOffer&&(t.newOffer=!0),t}function c(e){switch(e){case r.Constants.MEDIA_STATE.sendReceive:return n.StreamDirections.sendReceive;case r.Constants.MEDIA_STATE.send:return n.StreamDirections.receive;case r.Constants.MEDIA_STATE.receive:return n.StreamDirections.send;default:return null}}function h(e,t){return t["catch"](function(t){throw{errorWrappedWithTag:!0,tag:e,value:t instanceof Error?t.toString():t}})}function p(e){return e&&e.hasOwnProperty("errorWrappedWithTag")}function d(e,t,n,r){e.telemetryService.sendMediaSessionStats({media:n,signaling:{TerminationRemote:t.remote,TerminationReasonCode:t.reasonCode,TerminationReasonSubCode:t.reasonSubCode,TerminationReasonPhrase:t.reasonPhrase,isNGCVoicemail:r}})}function v(e){var t=e.selectedDevicesProvider();return e.mediaAgent.getDeviceManager().selectDevices(t),t}var n=e("../utilities/typeDefs"),r=e("media-agent"),i=e("signaling-agent");t.ADD_PARTICIPANT_FAILURE_CODES={NO_RESPONSE:487,DECLINED:603,NOT_REACHABLE:480},t.ValidStateTransitions=(m={},m[n.CallState.None]=[n.CallState.Notified,n.CallState.Connecting,n.CallState.Observing],m[n.CallState.Notified]=[n.CallState.Ringing,n.CallState.Connecting,n.CallState.Disconnecting,n.CallState.Disconnected],m[n.CallState.Ringing]=[n.CallState.Connecting,n.CallState.Connected,n.CallState.Disconnecting,n.CallState.Disconnected],m[n.CallState.Connecting]=[n.CallState.Ringing,n.CallState.Connected,n.CallState.Disconnecting,n.CallState.Disconnected],m[n.CallState.Connected]=[n.CallState.Disconnecting,n.CallState.Disconnected],m[n.CallState.Disconnecting]=[n.CallState.Disconnected],m[n.CallState.Disconnected]=[],m[n.CallState.Observing]=[n.CallState.Disconnecting,n.CallState.Disconnected],m),t.CALL_SUCCESS_CODES=[n.TerminatedReason.Success,n.TerminatedReason.Declined,n.TerminatedReason.Busy,n.TerminatedReason.Cancelled],t.ngcReasonToTerminatedReason=s,t.toSignalingMediaTypes=o,t.toIncomingMediaTypes=u;var a;(function(e){e[e.receive=0]="receive",e[e.send=1]="send"})(a=t.ModalityDirection||(t.ModalityDirection={})),t.modalitiesToStreamTypes=f,t.toSignalingMediaContent=l,t.invertDirectionality=c,t.tagAnError=h,t.isTaggedError=p,t.sendMediaSessionStats=d,t.updateDeviceSelection=v;var m}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("web-calling/lib/utilities/settablePromise",["require","exports","./typeDefs"],e)}(function(e,t){function r(){var e,t,r=new Promise(function(n,r){e=n,t=r});return r.state=n.SettablePromiseState.Pending,r.resolve=function(t){r.state=n.SettablePromiseState.Resolved,e(t)},r.reject=function(e){r.state=n.SettablePromiseState.Rejected,t(e)},r}var n=e("./typeDefs");t.build=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("web-calling/lib/utilities/events",["require","exports","lodash-compat"],e)}(function(e,t){var n=e("lodash-compat"),r=function(){function e(){this.subscriptions=[]}return e.prototype.subscribe=function(e){return new i(this.subscriptions,e)},e.prototype.dispose=function(){this.subscriptions=[]},e.prototype.raiseEvents=function(e){var t=this.subscriptions.slice();t.forEach(function(t){return e(t.eventHandler)})},e}();t.EventSourceImpl=r;var i=function(){function e(e,t){this.subscriptions=e,this.eventHandler=t,this.subscriptions.push(this)}return e.prototype.dispose=function(){var e=this;n.remove(this.subscriptions,function(t){return t===e})},e}()});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("web-calling/lib/utilities/observableBase",["require","exports","./events"],e)})(function(e,t){var n=e("./events"),r=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.changed=function(e){return this.subscribe({changed:e,on:null})},t.prototype.on=function(e,t){return this.subscribe({changed:null,on:{name:e,handler:t}})},t.prototype.once=function(e,t){var n,r=function(e){n.dispose(),t(e)};return n=this.on(e,r),n},t.prototype.raiseChanged=function(e){this.raiseEvents(function(t){return t.changed&&t.changed(e)})},t.prototype.raiseEvent=function(e,t){this.raiseEvents(function(n){return n.on&&n.on.name===e&&n.on.handler(t)})},t}(n.EventSourceImpl);t.__esModule=!0,t["default"]=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("web-calling/lib/models/callEvents",["require","exports"],e)}(function(e,t){var n=function(){function e(){}return e}();n.callNegotiationFinished="callNegotiationFinished",n.mediaTypesOffered="mediaTypesOffered",n.renegotiationStarted="renegotiationStarted",n.renegotiationCompleted="renegotiationCompleted",n.renegotiationFailed="renegotiationFailed",n.activeSpeakersChanged="activeSpeakersChanged",n.dominantSpeakersChanged="dominantSpeakersChanged",n.optimalVideoReceiversCountChanged="optimalVideoReceiversCountChanged",n.noMicrophoneAccess="noMicrophoneAccess",n.startCameraFailed="startCameraFailed",n.participantJoined="participantJoined",n.participantRemoved="participantRemoved",n.localVideoSizeChanged="localVideoSizeChanged",n.localVideoStartedOrStopped="localVideoStartedOrStopped",n.retargetStarted="retargetStarted",n.retargetCompleted="retargetCompleted",n.retargetAborted="retargetAborted",n.callStateChanged="callStateChanged",n.conversationUpdated="conversationUpdated",n.localModalitiesConfigured="localModalitiesConfigured",n.userActivityChanged="userActivityChanged",t.CallEvents=n;var r=function(){function e(){}return e}();t.ParticipantEvents=r;var i=function(){function e(){}return e}();i.videoSizeChanged="videoSizeChanged",t.StreamEvents=i;var s=function(){function e(){}return e}();s.incomingCall="incomingCall",t.CallRegistryEvents=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("web-calling/lib/models/callExtension",["require","exports","media-agent"],e)}(function(e,t){var n=e("media-agent"),r=function(){function e(e){this.callSession=e,this.callSession.addSignalingSessionListener(this)}return e.prototype.configure=function(e){var t=this;if(!e)throw new Error("Call extension cannot be configured: "+e);this.extensionsManager=e.getExtensionsManager(),this.extensionsManager.configureExtension(n.Constants.EXTENSION_TYPE.videoStreamControl,{sender:{send:function(e){return t.callSession.signaling()?t.callSession.signaling().sendWebRtcMediaNotificationAsync(e):Promise.reject(new Error("no signaling session"))}}})},e.prototype.dispose=function(){this.callSession=null,this.extensionsManager=null},e.prototype.onWebRtcMediaNotification=function(e,t){if(!this.extensionsManager)return;this.extensionsManager.processNotification(e,t)},e.prototype.onOffer=function(e){},e.prototype.onAnswer=function(e){},e.prototype.onCallStatusChanged=function(e,t){},e.prototype.onSelfParticipantUpdated=function(e){},e.prototype.onParticipantJoined=function(e){},e.prototype.onParticipantRemoved=function(e){},e.prototype.onParticipantUpdated=function(e){},e.prototype.onMediaAcknowledgementSuccess=function(e){},e.prototype.onMediaAcknowledgementFailure=function(e,t){},e.prototype.onMediaRenegotiationRejection=function(e){},e.prototype.onConversationUpdated=function(e){},e.prototype.onReTargetCompletedSuccess=function(){},e.prototype.onReTargetCompletedFailure=function(e){},e.prototype.onContentSharingStarted=function(e){},e.prototype.onContentSharingUpdated=function(e){},e.prototype.onContentSharingStopped=function(e){},e.prototype.onLightWeightMeetingUpdated=function(e){},e.prototype.onLightWeightMeetingEnded=function(e){},e.prototype.onMeetingDetailsUpdated=function(e){},e.prototype.onBroadcastDetailsUpdated=function(e){},e.prototype.onChatModalitySetupFailed=function(e){},e.prototype.onUnmuteRequested=function(e){},e.prototype.onCallForwarded=function(e){},e.prototype.onPSTNBalanceUpdate=function(e){},e.prototype.getRemoteParticipantCollection=function(){return null},e.prototype.onTransferRequested=function(e){return null},e.prototype.onTransferAccepted=function(){return null},e.prototype.onTransferCompleted=function(){return null},e.prototype.onIncomingCallReplacement=function(e){},e}();t.__esModule=!0,t["default"]=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("web-calling/lib/models/callSession",["require","exports","./callEvents","../utilities/modelHelper","../utilities/settablePromise","media-agent","signaling-agent","./callExtension"],e)}(function(e,t){var n=e("./callEvents"),r=e("../utilities/modelHelper"),i=e("../utilities/settablePromise"),s=e("media-agent"),o=e("signaling-agent"),u=e("./callExtension"),a={remote:!1,reasonCode:o.CA_CONSTANTS.CALL_END_CODE.SUCCESS,reasonSubCode:o.CA_CONSTANTS.CALL_END_SUB_CODE.SUCCESS,reasonPhrase:"none"},f=function(){function e(){var e=this;this.signalingSessionActive=!1,this.isNGCVoicemailInternal=!1,this.isEscalationInProgress=!1,this.callbacksDuringEscalationMedia=[],this.doMute=!1,this.mediaSessionListeners=[],this.signalingSessionListeners=[],this.callOperationQueue=Promise.resolve(),this._beforeUnloadHandler=function(){e.terminateNow()},this.onOffer=function(t){e.signalingSessionListeners.forEach(function(e){return e.onOffer(t)})},this.onAnswer=function(t){!t.renegotiation&&!t.provisional&&(e.isNGCVoicemailInternal=t.callAcceptedByNGCVoicemail),e.signalingSessionListeners.forEach(function(e){return e.onAnswer(t)})},this.onCallStatusChanged=function(t,n){switch(t){case o.CA_CONSTANTS.CALL_STATUS.LOCAL_TERMINATED:case o.CA_CONSTANTS.CALL_STATUS.REMOTE_TERMINATED:e.signalingSessionActive=!1,e.signalingTerminationInfo||(e.signalingTerminationInfo=n?{remote:!1,reasonCode:n.code,reasonSubCode:n.subCode,reasonPhrase:n.phrase}:a,e.signalingTerminationInfo.remote=o.CA_CONSTANTS.CALL_STATUS.REMOTE_TERMINATED===t);break;default:}e.signalingSessionListeners.forEach(function(e){return e.onCallStatusChanged(t,n)})},this.onParticipantJoined=function(t){e.signalingSessionListeners.forEach(function(e){return e.onParticipantJoined(t)})},this.onParticipantRemoved=function(t){e.signalingSessionListeners.forEach(function(e){return e.onParticipantRemoved(t)})},this.onParticipantUpdated=function(t){e.signalingSessionListeners.forEach(function(e){return e.onParticipantUpdated(t)})},this.onMediaAcknowledgementSuccess=function(t){e.signalingSessionListeners.forEach(function(e){return e.onMediaAcknowledgementSuccess(t)})},this.onMediaAcknowledgementFailure=function(t,n){e.signalingSessionListeners.forEach(function(e){return e.onMediaAcknowledgementFailure(t,n)})},this.onMediaRenegotiationRejection=function(t){e.signalingSessionListeners.forEach(function(e){return e.onMediaRenegotiationRejection(t)})},this.onConversationUpdated=function(t){e.signalingSessionListeners.forEach(function(e){return e.onConversationUpdated(t)})},this.onReTargetCompletedSuccess=function(){e.isEscalationInProgress=!1,e.escalationTask.handleReTargetCompletedSuccess().then(function(){e.signalingSessionListeners.forEach(function(e){return e.onReTargetCompletedSuccess()}),e.params.eventRaiser(n.CallEvents.retargetCompleted),e.executePostponedCallbacks(!0)})["catch"](function(t){e.params.eventRaiser(n.CallEvents.retargetCompleted)})},this.onReTargetCompletedFailure=function(t){e.isEscalationInProgress=!1,e.escalationTask.handleReTargetCompletedFailure(t).then(function(){e.signalingSessionListeners.forEach(function(e){return e.onReTargetCompletedFailure(t)}),e.params.eventRaiser(n.CallEvents.retargetAborted),e.executePostponedCallbacks(!1)})["catch"](function(t){e.params.eventRaiser(n.CallEvents.retargetAborted)})},this.onWebRtcMediaNotification=function(t,n){e.signalingSessionListeners.forEach(function(e){return e.onWebRtcMediaNotification(t,n)})},this.onContentSharingStarted=function(t){e.signalingSessionListeners.forEach(function(e){return e.onContentSharingStarted(t)})},this.onContentSharingUpdated=function(t){e.signalingSessionListeners.forEach(function(e){return e.onContentSharingUpdated(t)})},this.onContentSharingStopped=function(t){e.signalingSessionListeners.forEach(function(e){return e.onContentSharingStopped(t)})},this.onChatModalitySetupFailed=function(t){e.signalingSessionListeners.forEach(function(e){return e.onChatModalitySetupFailed(t)})},this.onUnmuteRequested=function(t){e.signalingSessionListeners.forEach(function(e){return e.onUnmuteRequested(t)})},this.onCallForwarded=function(t){e.signalingSessionListeners.forEach(function(e){return e.onCallForwarded(t)})},this.onPSTNBalanceUpdate=function(t){e.signalingSessionListeners.forEach(function(e){return e.onPSTNBalanceUpdate(t)})},this.getRemoteParticipantCollection=function(){for(var t=0,n=e.signalingSessionListeners;t<n.length;t++){var r=n[t],i=r.getRemoteParticipantCollection();if(i!==null&&i!==undefined)return i}return[]},this.onNegotiationRequired=function(t){var n=function(){e.mediaSessionListeners.forEach(function(e){return e.onNegotiationRequired()})};e.handleMediaSessionCallback(n.bind(null),t)},this.onSessionErrorOccurred=function(t,n){var r=function(t){e.mediaSessionListeners.forEach(function(e){return e.onSessionErrorOccurred(t)})};e.handleMediaSessionCallback(r.bind(null,t),n)},this.onContributingSourcesChanged=function(t,n){var r=function(t){e.mediaSessionListeners.forEach(function(e){return e.onContributingSourcesChanged(t)})};e.handleMediaSessionCallback(r.bind(null,t),n)},this.onDominantSpeakerChanged=function(t,n){var r=function(t){e.mediaSessionListeners.forEach(function(e){return e.onDominantSpeakerChanged(t)})};e.handleMediaSessionCallback(r.bind(null,t),n)},this.onOptimalVideoReceiversCountChanged=function(t,n){var r=function(t){e.mediaSessionListeners.forEach(function(e){return e.onOptimalVideoReceiversCountChanged(t)})};e.handleMediaSessionCallback(r.bind(null,t),n)},this.executePostponedCallbacks=function(e){this.callbacksDuringEscalationMedia.forEach(function(t){t.execute(e)}),this.callbacksDuringEscalationMedia=[]},this.returnTranferNotSupportedPromise=function(){return Promise.resolve({code:405,subCode:405,reason:"Transfer not supported"})}}return e.prototype.initialize=function(e){var t=this;this.params=e,this.signalingAgent=e.callsModel.signalingAgent,this.signalingSession=e.callsModel.signalingAgent.getNewSignalingSession(e.selfParticipant,this),this.logger=e.logger.createChild("CallSession",function(){return t.signalingSession.correlationId||"0"}),e.threadId&&this.signalingSession.setThreadId(e.threadId),window&&window.addEventListener&&window.addEventListener("beforeunload",this._beforeUnloadHandler),this.signalingSessionActive=!0},e.prototype.initiateSignalingSession=function(e){if(e.joinUrl)this.logger.log("initiateSignalingSession: Join conversation"),this.signalingSession.joinGivenConversation(e.joinUrl,this.params.callId,r.toSignalingMediaContent(e.mediaContent),e.offeredMediaTypes,e.offerGenerationTime);else{this.logger.log("initiateSignalingSession: New call. ringOthers="+e.ringOthers);var t=this.signalingAgent.resolvePotentialCallConflict(this.signalingSession);if(t===this.signalingSession)throw"Call conflict, ending outgoing call";this.signalingSession.startOutgoingCall(r.toSignalingMediaContent(e.mediaContent),e.offeredMediaTypes,{suppressDialout:!e.ringOthers},e.offerGenerationTime)}},e.prototype.assureMediaSessionCreated=function(){this.mediaSession||(this.mediaSession=this.createMediaSession(!1),this.callExtension=new u["default"](this),this.callExtension.configure(this.mediaSession),this.params.notifications.onMediaSessionCreated(this.mediaSession))},e.prototype.createEscalationTask=function(){var e=this,t=this.mediaSession,r=this.createMediaSession(!0),s=i.build(),o={mediaSession:r,escalationCompletePromise:s,complete:function(){e.callExtension.configure(r),s.resolve()},abort:function(){e.mediaSession=t,r.terminate(),s.reject()},handleReTargetCompletedSuccess:function(){return s.then(function(){t.terminate()})["catch"](function(n){e.mediaSession=t,r.terminate()})},handleReTargetCompletedFailure:function(n){return e.mediaSession=t,s.then(function(){r.terminate()})["catch"](function(e){r.terminate()})}};return this.escalationTask=o,this.isEscalationInProgress=!0,this.mediaSession=r,this.params.eventRaiser(n.CallEvents.retargetStarted),o},e.prototype.media=function(){return this.mediaSession},e.prototype.signaling=function(){return this.signalingSession},e.prototype.getSignalingAgent=function(){return this.signalingAgent},e.prototype.toggleMuteAsync=function(e){return this.doMute=e,this.mediaSession?e?this.mediaSession.muteInputAsync():this.mediaSession.unmuteInputAsync():Promise.resolve()},e.prototype.isNGCVoicemail=function(){return this.isNGCVoicemailInternal},e.prototype.hasScreensharingCapability=function(){if(this.params.callsModel.mediaAgent.getCapabilities().screensharing){if(this.params.callsModel.browserDetect.getBrowserInfo().isEdge)return this.params.callsModel.featureFlags.isIncomingScreenSharingEdgeEnabled();if(this.params.callsModel.browserDetect.getBrowserInfo().isFirefox)return this.params.callsModel.featureFlags.isVideoCallingFirefoxEnabled();if(this.params.callsModel.browserDetect.getBrowserInfo().isChrome||this.params.callsModel.browserDetect.getBrowserInfo().isElectron)if(this.signalingSession.multiParty&&this.params.callsModel.browserDetect.getSystemInfo().osName==="Linux")return this.params.callsModel.featureFlags.isGroupVideoCallingChromeLinuxEnabled();return!0}return!1},e.prototype.hasVideoCapability=function(){if(this.params.callsModel.mediaAgent.getCapabilities().video){if(this.params.callsModel.browserDetect.getBrowserInfo().isEdge)return!0;if(this.params.callsModel.browserDetect.getBrowserInfo().isFirefox)return this.params.callsModel.featureFlags.isVideoCallingFirefoxEnabled();if(this.params.callsModel.browserDetect.getBrowserInfo().isChrome||this.params.callsModel.browserDetect.getBrowserInfo().isElectron)if(this.signalingSession.multiParty&&this.params.callsModel.browserDetect.getSystemInfo().osName==="Linux")return this.params.callsModel.featureFlags.isGroupVideoCallingChromeLinuxEnabled();return!0}return!1},e.prototype.addMediaSessionListener=function(e){this.mediaSessionListeners.push(e)},e.prototype.addSignalingSessionListener=function(e){this.signalingSessionListeners.push(e)},e.prototype.terminateNow=function(){if(!this.mediaSession)return;var e=this.signalingTerminationInfo||{remote:!1,reasonCode:o.CA_CONSTANTS.CALL_END_CODE.SUCCESS,reasonSubCode:o.CA_CONSTANTS.CALL_END_SUB_CODE.BEACON,reasonPhrase:o.CA_CONSTANTS.CALL_END_PHRASE.LOCAL_USER_INITIATED},t=this.mediaSession.getLastKnownStats();r.sendMediaSessionStats(this.params.callsModel,e,t,this.isNGCVoicemailInternal),this.params.callsModel.telemetryService.flush()},e.prototype.disposeAsync=function(e){var t=this;this.escalationTask&&(this.escalationTask.abort(),this.escalationTask=undefined,this.isEscalationInProgress=!1,this.callbacksDuringEscalationMedia=[]),this.callExtension&&(this.callExtension.dispose(),this.callExtension=undefined),window&&window.removeEventListener&&window.removeEventListener("beforeunload",this._beforeUnloadHandler);var n=this.mediaSession;this.mediaSession=undefined;var i=this.signalingSessionActive;this.signalingSessionActive=!1;var s=[];return this.signalingTerminationInfo||(this.signalingTerminationInfo=e?{remote:!1,reasonCode:e.code,reasonSubCode:e.subCode,reasonPhrase:e.phrase}:a),n&&s.push(n.terminate().then(function(){return n.getStatsAsync()}).then(function(e){t.mediaSessionListeners=[],r.sendMediaSessionStats(t.params.callsModel,t.signalingTerminationInfo,e,t.isNGCVoicemailInternal)})["catch"](function(e){t.mediaSessionListeners=[],t.logger.error("failed to obtain media session stats:",e)})),i&&s.push(this.signalingSession.endAsync(e).then(function(){t.signalingSessionListeners=[]})["catch"](function(e){t.signalingSessionListeners=[],t.logger.error("failed to end signaling session:",e)})),Promise.all(s)},e.prototype.onSelfParticipantUpdated=function(e){},e.prototype.onLightWeightMeetingUpdated=function(e){},e.prototype.onLightWeightMeetingEnded=function(e){},e.prototype.onMeetingDetailsUpdated=function(e){},e.prototype.onBroadcastDetailsUpdated=function(e){},e.prototype.onTransferRequested=function(e){return this.logger.log("onTransferRequested"),this.returnTranferNotSupportedPromise()},e.prototype.onTransferAccepted=function(){return this.logger.log("onTransferAccepted"),this.returnTranferNotSupportedPromise()},e.prototype.onTransferCompleted=function(){return this.logger.log("onTransferCompleted"),this.returnTranferNotSupportedPromise()},e.prototype.onIncomingCallReplacement=function(e){this.signalingSessionListeners.forEach(function(t){t.onIncomingCallReplacement(e)})},e.prototype.getIceTransportPolicy=function(){return this.signalingSession.multiParty||this.params.isRemotePersonAuthorized?s.Constants.ICE_TRANSPORT_POLICY.all:s.Constants.ICE_TRANSPORT_POLICY.relay},e.prototype.handleMediaSessionCallback=function(e,t){this.isEscalationInProgress?this.callbacksDuringEscalationMedia.push(new c(t,e)):e()},e.prototype.createMediaSession=function(e){var t={muted:this.doMute,isRemoteClientLync:this.params.isRemoteClientLync(),isConference:this.signalingSession.multiParty,iceTransportPolicy:this.getIceTransportPolicy(),passiveModalities:{}};return this.hasScreensharingCapability()&&(t.passiveModalities.sharing=s.Constants.MEDIA_STATE.receive),this.params.callsModel.mediaAgent.createSession(new l(e,this),this.signalingSession.correlationId,t)},e}();t.__esModule=!0,t["default"]=f;var l=function(){function e(e,t){var n=this;this.onNegotiationRequired=function(){n.callSession.onNegotiationRequired(n.isEscalatedSession)},this.onSessionErrorOccurred=function(e){n.callSession.onSessionErrorOccurred(e,n.isEscalatedSession)},this.onContributingSourcesChanged=function(e){n.callSession.onContributingSourcesChanged(e,n.isEscalatedSession)},this.onDominantSpeakerChanged=function(e){n.callSession.onDominantSpeakerChanged(e,n.isEscalatedSession)},this.onOptimalVideoReceiversCountChanged=function(e){n.callSession.onOptimalVideoReceiversCountChanged(e,n.isEscalatedSession)},this.isEscalatedSession=e,this.callSession=t}return e}(),c=function(){function e(e,t){this.isEscalatedSession=e,this.successCallback=t}return e.prototype.execute=function(e){(e&&this.isEscalatedSession||!e&&!this.isEscalatedSession)&&this.successCallback()},e}()}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("web-calling/lib/models/callNegotiator",["require","exports","../utilities/modelHelper","../utilities/settablePromise","../utilities/typeDefs","./callEvents","media-agent","signaling-agent"],e)}(function(e,t){var n=e("../utilities/modelHelper"),r=e("../utilities/settablePromise"),i=e("../utilities/typeDefs"),s=e("./callEvents"),o=e("media-agent"),u=e("signaling-agent");t.mediaFailure=0;var a=1,f=2,l=4,c=function(){function e(e,t){var n=this;this.offeredMediaTypes=[],this.callConnectedTask=r.build(),this.mediaAcknowledgementTask=r.build(),this.params=e,this.negotiationInfo=t,this.logger=e.logger.createChild("CallNegotiator",function(){return n.params.callSession&&n.params.callSession.signaling()&&n.params.callSession.signaling().correlationId||"0"}),this.params.callSession.addSignalingSessionListener(this)}return e.prototype.rejectAllPendingTasks=function(e){var t=[this.finalAnswerTask,this.renegotiationAnswerTask,this.callConnectedTask,this.mediaAcknowledgementTask];t.forEach(function(t){t&&t.state===i.SettablePromiseState.Pending&&(t["catch"](function(e){}),t.reject(e))})},e.prototype.negotiate=function(e){var r=this;return this.negotiateInternal({initialNegotiation:!0,callId:e.callId,ringOthers:e.ringOthers,joinUrl:e.joinUrl}).then(function(e){return r.negotiationInfo.sendStats(),e})["catch"](function(e){var i={rawError:e,ngcRejectReson:{code:u.CA_CONSTANTS.CALL_END_CODE.UNKNOWN_ERROR,subCode:u.CA_CONSTANTS.CALL_END_SUB_CODE.PLACE_CALL_FAILED,phrase:u.CA_CONSTANTS.CALL_END_PHRASE.UNKNOWN}};if(n.isTaggedError(e))switch(e.tag){case t.mediaFailure:i.ngcRejectReson={code:u.CA_CONSTANTS.CALL_END_CODE.MEDIA_ERROR,subCode:u.CA_CONSTANTS.CALL_END_SUB_CODE.MEDIA_DROP_DURING_CONNECT,phrase:u.CA_CONSTANTS.CALL_END_PHRASE.MEDIA_DROP_DURING_CONNECT};break;case a:case f:i.ngcRejectReson={code:e.code||u.CA_CONSTANTS.CALL_END_CODE.UNKNOWN_ERROR,subCode:e.subCode||u.CA_CONSTANTS.CALL_END_SUB_CODE.PLACE_CALL_FAILED,phrase:e.phrase||u.CA_CONSTANTS.CALL_END_PHRASE.UNKNOWN};break;default:}throw r.logger.error("end negotiation offer (FAILED). Call.start() failed","error:",e),r.negotiationInfo.status="ErrorLocalInternal-fatal",r.negotiationInfo.sendStats(),i})},e.prototype.renegotiate=function(e){var r=this;return this.negotiateInternal({initialNegotiation:!1,callId:null,ringOthers:!1}).then(function(e){return r.negotiationInfo.sendStats(),e})["catch"](function(e){var i={rawError:e,ngcRejectReson:{code:u.CA_CONSTANTS.CALL_END_CODE.UNKNOWN_ERROR,subCode:u.CA_CONSTANTS.CALL_END_SUB_CODE.AFTER_CONNECT,phrase:u.CA_CONSTANTS.CALL_END_PHRASE.UNKNOWN}};if(n.isTaggedError(e)&&!e.value.callHandlerTerminationInProgress||e.type===o.Constants.MEDIA_ERROR.sourceUnavailableError){var s=o.Constants.RENEGOTIATION_ERROR.local;r.logger.warn("end renegotiation offer (FAILED)","error:",e);switch(e.tag){case t.mediaFailure:break;case a:case f:e.value.code===491&&e.value.subCode===10029?s=o.Constants.RENEGOTIATION_ERROR.glare:e.value.code===415?s=o.Constants.RENEGOTIATION_ERROR.media:e.value.type===o.Constants.MEDIA_ERROR.permissionDeniedError?s=o.Constants.RENEGOTIATION_ERROR.escalation:s=o.Constants.RENEGOTIATION_ERROR.signaling;break;default:}return r.negotiationInfo.status="ErrorLocalInternal-"+s,r.rejectNegotiationAsync(s)}throw r.logger.warn("end renegotiation offer (FAILED)"),r.negotiationInfo.status="ErrorLocalInternal-untagged",r.negotiationInfo.sendStats(),i})},e.prototype.completeNegotiationAsync=function(e){var t=this;return e.completeNegotiationAsync().then(function(e){return t.params.eventRaiser(s.CallEvents.callNegotiationFinished,{callNegotiationResult:e,isMultiParty:t.params.callSession.signaling().multiParty}),e})},e.prototype.negotiateInternal=function(e){var i=this;return this.negotiationInfo.incrementAttemps(),this.negotiationInfo.isOfferer=!0,this.negotiationInfo.isRenegotiation=!e.initialNegotiation,this.negotiationInfo.mediaLegId="",this.negotiationInfo.timeStamps.created=(new Date).getTime(),this.logger.log("begin (re-)negotiation offer"),e.initialNegotiation&&(this.negotiationInfo.timeStamps.initialNegotiationRequested=(new Date).getTime()),this.params.callSession.signaling().setOfferAnswerGenerationTimestamps(e.initialNegotiation?u.TM_CONSTANTS.LOCAL_OFFER_ANSWER_OPERATIONS.INITIAL_OFFER_GENERATION_STARTED:u.TM_CONSTANTS.LOCAL_OFFER_ANSWER_OPERATIONS.RENEGOTIATION_OFFER_GENERATION_STARTED),n.tagAnError(t.mediaFailure,this.params.callSession.media().createOfferAsync()).then(function(t){return i.offeredMediaTypes=n.toSignalingMediaTypes(t.modalities),i.params.callSession.signaling().setOfferAnswerGenerationTimestamps(e.initialNegotiation?u.TM_CONSTANTS.LOCAL_OFFER_ANSWER_OPERATIONS.INITIAL_OFFER_GENERATION_ENDED:u.TM_CONSTANTS.LOCAL_OFFER_ANSWER_OPERATIONS.RENEGOTIATION_OFFER_GENERATION_ENDED),i.negotiationInfo.mediaLegId=t.mediaLegId,i.negotiationInfo.timeStamps.offerCreated=(new Date).getTime(),e.initialNegotiation?i.finalAnswerTask=r.build():i.renegotiationAnswerTask=r.build(),e.initialNegotiation?i.initiateSignalingSession({callId:e.callId,joinUrl:e.joinUrl,ringOthers:e.ringOthers,mediaContent:t,offeredMediaTypes:i.offeredMediaTypes,offerGenerationTime:i.negotiationInfo.timeStamps.offerCreated-i.negotiationInfo.timeStamps.created}):n.tagAnError(a,i.params.callSession.signaling().startRenegotiationAsync(n.toSignalingMediaContent(t),i.offeredMediaTypes))}).then(function(){return e.initialNegotiation||(i.negotiationInfo.timeStamps.renegotiationStarted=(new Date).getTime()),n.tagAnError(f,e.initialNegotiation?i.finalAnswerTask:i.renegotiationAnswerTask)}).then(function(r){return i.negotiationInfo.timeStamps.answerArrived=(new Date).getTime(),i.params.callSession.signaling().setOfferAnswerGenerationTimestamps(e.initialNegotiation?u.TM_CONSTANTS.LOCAL_OFFER_ANSWER_OPERATIONS.FINAL_ANSWER_PROCESSING_STARTED:u.TM_CONSTANTS.LOCAL_OFFER_ANSWER_OPERATIONS.RENEGOTIATION_ANSWER_PROCESSING_STARTED),n.tagAnError(t.mediaFailure,i.params.callSession.media().processAnswerAsync(r,!1))}).then(function(){return i.params.notifications.onAnswerProcessed(),e.initialNegotiation?(i.params.callSession.signaling().setOfferAnswerGenerationTimestamps(u.TM_CONSTANTS.LOCAL_OFFER_ANSWER_OPERATIONS.FINAL_ANSWER_PROCESSING_ENDED),i.negotiationInfo.timeStamps.finalAnswerProcessed=(new Date).getTime(),n.tagAnError(l,i.callConnectedTask).then(function(){return n.tagAnError(t.mediaFailure,i.completeNegotiationAsync(i.params.callSession.media()))})):(i.params.callSession.signaling().setOfferAnswerGenerationTimestamps(u.TM_CONSTANTS.LOCAL_OFFER_ANSWER_OPERATIONS.RENEGOTIATION_ANSWER_PROCESSING_ENDED),i.negotiationInfo.timeStamps.answerProcessed=(new Date).getTime(),n.tagAnError(f,i.completeNegotiationAsync(i.params.callSession.media())))}).then(function(e){return i.params.callSession.signaling().setOfferAnswerGenerationTimestamps(u.TM_CONSTANTS.LOCAL_OFFER_ANSWER_OPERATIONS.NEGOTIATION_COMPLETED),i.negotiationInfo.status="Succeeded",i.negotiationInfo.result=e,i.logger.log("end (re-)negotiation offer (succeeded)"),Promise.resolve(e)})},e.prototype.onOffer=function(e){var t=this;e.renegotiation&&(this.params.callSession.callOperationQueue=this.params.callSession.callOperationQueue.then(function(){return t.handleMediaRenegotiationOffer(e)}))},e.prototype.onAnswer=function(e){e.renegotiation?this.renegotiationAnswerTask.resolve(e.mediaContent):e.provisional||this.finalAnswerTask.resolve(e.mediaContent)},e.prototype.onCallStatusChanged=function(e,t){switch(e){case u.CA_CONSTANTS.CALL_STATUS.CONNECTED:this.callConnectedTask.resolve();break;default:}},e.prototype.onSelfParticipantUpdated=function(e){},e.prototype.onParticipantJoined=function(e){},e.prototype.onParticipantRemoved=function(e){},e.prototype.onParticipantUpdated=function(e){},e.prototype.onMediaAcknowledgementSuccess=function(e){this.logger.log("onMediaAcknowledgementSuccess","isRenegotiation:",e),this.mediaAcknowledgementTask.resolve()},e.prototype.onMediaAcknowledgementFailure=function(e,t){this.logger.log("onMediaAcknowledgementFailure","isRenegotiation:",e),this.mediaAcknowledgementTask.reject(t)},e.prototype.onMediaRenegotiationRejection=function(e){this.renegotiationAnswerTask.reject(e)},e.prototype.onConversationUpdated=function(e){},e.prototype.onReTargetCompletedSuccess=function(){},e.prototype.onReTargetCompletedFailure=function(e){},e.prototype.onWebRtcMediaNotification=function(e,t){},e.prototype.onContentSharingStarted=function(e){},e.prototype.onContentSharingUpdated=function(e){},e.prototype.onContentSharingStopped=function(e){},e.prototype.onLightWeightMeetingUpdated=function(e){},e.prototype.onLightWeightMeetingEnded=function(e){},e.prototype.onMeetingDetailsUpdated=function(e){},e.prototype.onBroadcastDetailsUpdated=function(e){},e.prototype.onChatModalitySetupFailed=function(e){},e.prototype.onUnmuteRequested=function(e){},e.prototype.onCallForwarded=function(e){},e.prototype.onPSTNBalanceUpdate=function(e){},e.prototype.getRemoteParticipantCollection=function(){return null},e.prototype.onTransferRequested=function(e){return null},e.prototype.onTransferAccepted=function(){return null},e.prototype.onTransferCompleted=function(){return null},e.prototype.onIncomingCallReplacement=function(e){},e.prototype.initiateSignalingSession=function(e){return e.joinUrl?(this.logger.log("initiateSignalingSession: Join conversation"),this.params.callSession.signaling().joinGivenConversation(e.joinUrl,e.callId,n.toSignalingMediaContent(e.mediaContent),e.offeredMediaTypes,e.offerGenerationTime)):(this.logger.log("initiateSignalingSession: New call. ringOthers="+e.ringOthers),this.params.callSession.signaling().startOutgoingCall(n.toSignalingMediaContent(e.mediaContent),e.offeredMediaTypes,{suppressDialout:!e.ringOthers},e.offerGenerationTime)),Promise.resolve(undefined)},e.prototype.handleMediaRenegotiationOffer=function(e){var t=this;return this.logger.log("start handleMediaRenegotiationOffer"),e.mediaContent.escalationOccurring?this.handleEscalatedMediaRenegotiationOffer(e):this.renegotiationProcessOffer(this.params.callSession.media(),e).then(function(e){return t.renegotiationCreateAnswer(t.params.callSession.media(),e)}).then(function(e){return t.renegotiationAccept(e)}).then(function(){return t.renegotiationMediaAcknowledgement()}).then(function(){return t.negotiationInfo.timeStamps.mediaAcknowledged=(new Date).getTime(),t.completeNegotiationAsync(t.params.callSession.media())}).then(function(e){return t.renegotiationHandleResult(e),t.params.notifications.onRenegotiationSuccess(e)})["catch"](function(e){return t.renegotiationHandleError(e)})["catch"](function(e){return t.negotiationInfo.status="ErrorLocalInternal-fatal",t.logger.error("handleMediaRenegotiationOffer failed","error:",e),t.params.notifications.onRenegotiationFatalError(e)}).then(function(){t.negotiationInfo.sendStats(),t.logger.log("end renegotiation answer")})},e.prototype.handleEscalatedMediaRenegotiationOffer=function(e){var r=this;this.logger.log("starting escalation"),e.mediaContent.newOffer=!1;if(!this.params.callsModel.featureFlags.isRemoteEscalationEnabled())return this.logger.error("renegotiation rejected: escalation scenario is not supported"),this.params.callSession.signaling().rejectRenegotiationAsync();var i=this.params.callSession.createEscalationTask();return this.renegotiationProcessOffer(i.mediaSession,e).then(function(){var e=r.params.callModalities.getLocalModalities(!0,r.params.isLocalVideoEnabled());return n.tagAnError(t.mediaFailure,r.params.callModalities.configureAsync(i.mediaSession,e))}).then(function(e){return r.renegotiationCreateAnswer(i.mediaSession,e)}).then(function(e){return r.renegotiationAccept(e)}).then(function(){return r.renegotiationMediaAcknowledgement()}).then(function(){return r.negotiationInfo.timeStamps.mediaAcknowledged=(new Date).getTime(),r.completeNegotiationAsync(i.mediaSession)}).then(function(e){r.renegotiationHandleResult(e)})["catch"](function(e){return r.renegotiationHandleError(e)})["catch"](function(e){return r.negotiationInfo.status="ErrorLocalInternal-fatal",r.logger.error("handleMediaRenegotiationOffer failed","error:",e),r.params.notifications.onRenegotiationFatalError(e)}).then(function(){r.renegotationComplete(),i.complete()})},e.prototype.renegotiationProcessOffer=function(e,r){var i=r.mediaContent;return this.negotiationInfo.incrementAttemps(),this.negotiationInfo.isOfferer=!1,this.negotiationInfo.isRenegotiation=!0,this.negotiationInfo.mediaLegId="",this.negotiationInfo.timeStamps.created=(new Date).getTime(),this.params.callSession.signaling().setOfferAnswerGenerationTimestamps(u.TM_CONSTANTS.LOCAL_OFFER_ANSWER_OPERATIONS.RENEGOTIATION_OFFER_PROCESSING_STARTED),n.tagAnError(t.mediaFailure,e.processOfferAsync(i))},e.prototype.renegotiationCreateAnswer=function(e,r){return this.offeredMediaTypes=n.toIncomingMediaTypes(r),this.params.callSession.signaling().setOfferAnswerGenerationTimestamps(u.TM_CONSTANTS.LOCAL_OFFER_ANSWER_OPERATIONS.RENEGOTIATION_OFFER_PROCESSING_ENDED),this.negotiationInfo.timeStamps.offerProcessed=(new Date).getTime(),this.params.eventRaiser(s.CallEvents.mediaTypesOffered,{offeredMediaTypes:n.modalitiesToStreamTypes(r,n.ModalityDirection.receive),isMultiParty:this.params.callSession.signaling().multiParty}),this.params.callSession.signaling().setOfferAnswerGenerationTimestamps(u.TM_CONSTANTS.LOCAL_OFFER_ANSWER_OPERATIONS.RENEGOTIATION_ANSWER_GENERATION_STARTED),n.tagAnError(t.mediaFailure,e.createAnswerAsync(!1))},e.prototype.renegotiationAccept=function(e){return this.params.callSession.signaling().setOfferAnswerGenerationTimestamps(u.TM_CONSTANTS.LOCAL_OFFER_ANSWER_OPERATIONS.RENEGOTIATION_ANSWER_GENERATION_ENDED),this.negotiationInfo.timeStamps.answerCreated=(new Date).getTime(),this.negotiationInfo.mediaLegId=e.mediaLegId,this.mediaAcknowledgementTask=r.build(),n.tagAnError(l,this.params.callSession.signaling().acceptRenegotiationAsync(n.toSignalingMediaContent(e),n.toSignalingMediaTypes(e.modalities)))},e.prototype.renegotiationMediaAcknowledgement=function(){return this.negotiationInfo.timeStamps.renegotiationAccepted=(new Date).getTime(),n.tagAnError(l,this.mediaAcknowledgementTask)},e.prototype.renegotiationHandleResult=function(e){this.params.callSession.signaling().setOfferAnswerGenerationTimestamps(u.TM_CONSTANTS.LOCAL_OFFER_ANSWER_OPERATIONS.NEGOTIATION_COMPLETED),this.negotiationInfo.status="Succeeded",this.negotiationInfo.result=e},e.prototype.renegotiationHandleError=function(e){var r=this;if(n.isTaggedError(e)&&!e.value.callHandlerTerminationInProgress){this.logger.warn("renegotiationHandleError","error:",e);var i=e.tag===t.mediaFailure?o.Constants.RENEGOTIATION_ERROR.local:o.Constants.RENEGOTIATION_ERROR.signaling;return this.negotiationInfo.status="ErrorLocalInternal-"+i,this.rejectNegotiationAsync(i).then(function(){return e.tag===t.mediaFailure?r.params.callSession.signaling().rejectRenegotiationAsync():Promise.resolve(undefined)})}return this.negotiationInfo.status="ErrorLocalInternal-untagged",Promise.resolve(undefined)},e.prototype.renegotationComplete=function(){this.negotiationInfo.sendStats(),this.logger.log("end renegotiation answer")},e.prototype.rejectNegotiationAsync=function(e){var t=this;return this.params.callSession.media()?this.params.callSession.media().rejectNegotiationAsync(e).then(function(e){return t.params.eventRaiser(s.CallEvents.callNegotiationFinished,{callNegotiationResult:e,isMultiParty:t.params.callSession.signaling().multiParty}),e}):undefined},e}();t.CallNegotiator=c});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("web-calling/lib/models/callParticipant",["require","exports","../utilities/observableBase","../utilities/typeDefs","./callEvents","lodash-compat"],e)})(function(e,t){var n=e("../utilities/observableBase"),r=e("../utilities/typeDefs"),i=e("./callEvents"),s=e("lodash-compat"),o=(c={},c[r.ParticipantState.None]=[r.ParticipantState.Connecting],c[r.ParticipantState.Connecting]=[r.ParticipantState.Ringing,r.ParticipantState.Connected,r.ParticipantState.Disconnected],c[r.ParticipantState.Ringing]=[r.ParticipantState.Connected,r.ParticipantState.Disconnected],c[r.ParticipantState.Connected]=[r.ParticipantState.Connecting,r.ParticipantState.Disconnected],c[r.ParticipantState.Disconnected]=[],c),u=function(e){function t(t,n,r){var i=e.call(this)||this;return i.mediaStreamAvailable=!1,i.participant=t,i.type=n,i.mediaSession=r,i}return __extends(t,e),t.prototype.dispose=function(){this.participant=undefined},t.prototype.state=function(){if(!this.participant)return r.StreamState.None;switch(this.participant.state){case r.ParticipantState.None:case r.ParticipantState.Disconnected:return r.StreamState.None;case r.ParticipantState.Connecting:case r.ParticipantState.Ringing:return this.mediaStreamAvailable?r.StreamState.Connecting:r.StreamState.None;case r.ParticipantState.Connected:case r.ParticipantState.OnHold:return this.mediaStreamAvailable?r.StreamState.Available:r.StreamState.None;default:throw new Error("Unknown ParticipantState!")}},t.prototype.updateStream=function(e){var t=e===void 0?{}:e,n=t.sourceId,i=n===void 0?undefined:n,s=t.direction,o=s===void 0?r.StreamDirections.receive:s;this.id=i,this.mediaStreamAvailable=o===r.StreamDirections.sendReceive||o===r.StreamDirections.send,this.raiseChanged()},t.prototype.notifyParticipantStateChanged=function(){this.raiseChanged()},t.prototype.setMediaSession=function(e){this.mediaSession=e},t}(n["default"]);t.BaseStream=u;var a=function(e){function t(t,n){return e.call(this,t,r.StreamType.Audio,n)||this}return __extends(t,e),t}(u);t.AudioStream=a;var f=function(e){function t(t,n,r,i){var s=e.call(this,t,n,r)||this;return s.size={width:0,height:0},s.renderStarted=!1,s.isAppSharing=!1,s.isAppSharing=i,s}return __extends(t,e),t.prototype.state=function(){var t=e.prototype.state.call(this);switch(t){case r.StreamState.None:case r.StreamState.Connecting:return t;case r.StreamState.Available:if(!this.videoRenderer)return r.StreamState.Available;return this.renderStarted?r.StreamState.Streaming:r.StreamState.StreamPreparing;default:throw new Error("Unexpected base stream state!")}},t.prototype.setMediaSession=function(t){t!==this.mediaSession&&this.stop(),e.prototype.setMediaSession.call(this,t)},t.prototype.dispose=function(){this.stop(),e.prototype.dispose.call(this)},t.prototype.start=function(e){var t=this;if(!this.videoRenderer){var n={onVideoSizeChanged:function(e,n){t.size={width:e,height:n},t.renderStarted=e>0&&n>0,t.raiseChanged(),t.raiseEvent(i.StreamEvents.videoSizeChanged,t)},onVideoStateChanged:function(e){t.renderStarted=e.stream==="active",t.raiseChanged()}},s=void 0;switch(this.type){case r.StreamType.Video:s=!1;break;case r.StreamType.ScreenSharing:s=!0;break;default:return Promise.reject("Unknown/unsupported stream type!")}return this.videoRenderer=this.mediaSession.createRemoteRenderer(e.container,n),this.videoRenderer.subscribeVideoAsync(this.id,s).then(function(){return Promise.resolve(t.videoRenderer)})}return Promise.resolve(this.videoRenderer)},t.prototype.stop=function(){return this.videoRenderer&&(this.videoRenderer.dispose(),this.videoRenderer=null,this.renderStarted=!1,this.raiseChanged()),Promise.resolve()},t}(u);t.VideoOrScreenSharingStream=f;var l=function(e){function t(t,n,i,s){var o=e.call(this)||this;return o.logger=s,o.voiceLevel=0,o.state=r.ParticipantState.None,o.id=t,o.displayName=n,o.audio=new a(o,i),o.video=new f(o,r.StreamType.Video,i,!1),o.screenShare=new f(o,r.StreamType.ScreenSharing,i,!0),o.mediaSession=i,o}return __extends(t,e),t.prototype.dispose=function(){this.audio.dispose(),this.video.dispose(),this.screenShare.dispose(),this.mediaSession=undefined},t.prototype.setMediaSession=function(e){this.mediaSession=e,this.audio.setMediaSession(e),this.video.setMediaSession(e),this.screenShare.setMediaSession(e)},t.prototype.updateStreams=function(e){var t=function(t){return s.find(e,function(e){return e.type===t})};this.audio.updateStream(t(r.StreamTypes.audio)),this.video.updateStream(t(r.StreamTypes.video)),this.screenShare.updateStream(t(r.StreamTypes.sharing)),this.raiseChanged(this)},t.prototype.updateVoiceLevel=function(e){if(this.voiceLevel===e)return;this.voiceLevel=e,this.raiseChanged(this)},t.prototype.setState=function(e,t){if(this.state===e)return;var n=o[this.state],r=n.indexOf(e)>=0;if(!r)throw new Error("Invalid state transition "+this.state+"->"+e+" attempted for participant "+this.id);this.state=e,this.stateReason=t,this.audio.notifyParticipantStateChanged(),this.video.notifyParticipantStateChanged(),this.screenShare.notifyParticipantStateChanged(),this.raiseChanged(this)},t}(n["default"]);t.__esModule=!0,t["default"]=l;var c}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("web-calling/lib/models/callModalities",["require","exports","./callEvents","../utilities/modelHelper","media-agent"],e)}(function(e,t){var n=e("./callEvents"),r=e("../utilities/modelHelper"),i=e("media-agent"),s=function(){function e(e,t,n){var r=this;this.callsModel=e,this.callSession=t,this.eventRaiser=n,this.logger=this.callsModel.logger.createChild("Modalities",function(){return r.callSession&&r.callSession.signaling()&&r.callSession.signaling().correlationId||"0"})}return e.prototype.getLocalModalities=function(e,t){var n=function(e){return e?i.Constants.MEDIA_STATE.sendReceive:i.Constants.MEDIA_STATE.receive},r={};return r.audio=n(e),this.callSession.hasVideoCapability()&&(r.video=n(t)),this.callSession.hasScreensharingCapability()&&(r.sharing=n(!1)),r},e.prototype.configureAsync=function(e,t){var s=r.updateDeviceSelection(this.callsModel);return s.microphone||(this.eventRaiser(n.CallEvents.noMicrophoneAccess),this.logger.warn("cannot configure modalities without microphone selection")),!s.camera&&i.Helper.hasSendDirectionality(t.video)&&(t.video=i.Helper.removeSendDirectionality(t.video),this.logger.warn("removed send direction from video modality due to missing camera selection")),e.configureModalitiesAsync(t)},e}();t.__esModule=!0,t["default"]=s});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("web-calling/lib/models/call",["require","exports","../utilities/negotiationInfo","../utilities/modelHelper","../utilities/settablePromise","../utilities/observableBase","../utilities/typeDefs","./callSession","./callNegotiator","./callParticipant","./callModalities","./callEvents","media-agent","signaling-agent","lodash-compat"],e)})(function(e,t){var n=e("../utilities/negotiationInfo"),r=e("../utilities/modelHelper"),i=e("../utilities/settablePromise"),s=e("../utilities/observableBase"),o=e("../utilities/typeDefs"),u=e("./callSession"),a=e("./callNegotiator"),f=e("./callParticipant"),l=e("./callModalities"),c=e("./callEvents"),h=e("media-agent"),p=e("signaling-agent"),d=e("lodash-compat"),v=function(e){function t(t,n,r){var s=e.call(this)||this;return s.participants=[],s.terminatedReason=o.TerminatedReason.Undefined,s.failureType=o.FailureType.Undefined,s.isHostlessCall=!1,s.isIncoming=!1,s.isVideoOn=!1,s.initialOfferTask=i.build(),s.callConnectedTask=i.build(),s.offeredMediaTypes=[],s.callSetupFailed=!1,s.callGotConnected=!1,s.beforeUnloadListener=function(){s.stopWithBeacon()},s.callsModel=t,s.threadId=n,s.callId=r,s.state=o.CallState.None,s.logger=s.callsModel.logger.createChild("Call",function(){return s.callSession&&s.callSession.signaling()&&s.callSession.signaling().correlationId||"0"}),s.retargetStartedSubscription=s.on(c.CallEvents.retargetStarted,s.onReTargetStarted.bind(s)),s}return __extends(t,e),t.prototype.correlationId=function(){return this.callSession.signaling()?this.callSession.signaling().correlationId:undefined},t.prototype.hasVideoCapability=function(){return this.callSession.hasVideoCapability()},t.prototype.hasScreensharingCapability=function(){return this.callSession.hasScreensharingCapability()},t.prototype.isMultiParty=function(){return this.callSession.signaling().multiParty},t.prototype.isNGCVoicemail=function(){return this.callSession.isNGCVoicemail()},t.prototype.initialize=function(e){var t=this;this.callSession=new u["default"],this.callSession.addMediaSessionListener(this),this.callSession.addSignalingSessionListener(this),this.callSession.initialize({callsModel:this.callsModel,callId:this.callId,threadId:this.threadId,selfParticipant:e.selfParticipant,isRemoteClientLync:this.isRemoteClientLync.bind(this),isRemotePersonAuthorized:e.callbacks.isRemotePersonAuthorized(),eventRaiser:this.raiseEvent.bind(this),logger:this.logger,notifications:{onMediaSessionCreated:function(e){t.participants.forEach(function(e){e.setMediaSession(t.callSession.media())})}}}),this.callModalities=new l["default"](this.callsModel,this.callSession,this.raiseEvent.bind(this)),this.negotiationInfo=new n["default"](this.callsModel,this.callSession.signaling(),this.logger),this.callNegotiator=new a.CallNegotiator({callsModel:this.callsModel,callSession:this.callSession,callModalities:this.callModalities,eventRaiser:this.raiseEvent.bind(this),isLocalVideoEnabled:function(){return t.isVideoOn},logger:this.logger,notifications:{onAnswerProcessed:function(){t.initialNegotiationTask=null},onRenegotiationSuccess:function(e){return t.updateParticipantStreams(e),Promise.resolve()},onRenegotiationFatalError:function(e){return t.endCallOnceWithMediaErrorAsync({subCode:p.CA_CONSTANTS.CALL_END_SUB_CODE.MEDIA_RENEGOTIATION_ERROR,phrase:p.CA_CONSTANTS.CALL_END_PHRASE.MEDIA_RENEGOTIATION_ERROR},e)}}},this.negotiationInfo),this.messageId=e.messageId,this.callbacks=e.callbacks,this.raiseChanged(),window.addEventListener&&window.addEventListener("beforeunload",this.beforeUnloadListener)},t.prototype.join=function(e,t){return this.logger.log("Call.join()"),this.startOrJoin({ringOthers:!1,withVideo:t,joinUrl:e.conversationUrl})},t.prototype.joinCallWithoutCallModality=function(e){this.logger.log("Call.joinCallWithoutCallModality()"),this.setCallState(o.CallState.Observing),this.callSession.signaling().subscribeToCall(e.conversationUrl,this.callId)},t.prototype.start=function(e){return this.logger.log("Call.start()"),this.isCast=e.isCast,this.label=e.label,this.startOrJoin({ringOthers:e.ringOthers,withVideo:e.withVideo})},t.prototype.acknowledge=function(e){var t=this;this.logger.log("Call.acknowledge()");var n=0;this.configureSignalingSession(!1),this.callSession.signaling().processIncomingCallRequest(e);var i=this.callSession.getSignalingAgent().resolvePotentialCallConflict(this.callSession.signaling());if(i===this.callSession.signaling())throw"Call conflict, ending incoming call";return this.callSession.callOperationQueue=this.callSession.callOperationQueue.then(function(){t.negotiationInfo.incrementAttemps(),t.negotiationInfo.isOfferer=!1,t.negotiationInfo.isRenegotiation=!1,t.negotiationInfo.mediaLegId="",t.negotiationInfo.timeStamps.created=(new Date).getTime(),t.negotiationInfo.timeStamps.started=(new Date).getTime(),t.callerMri=e.callerId,t.isIncoming=!0,t.raiseChanged(),t.setCallState(o.CallState.Notified),t.callSession.signaling().handleIncomingCall()}).then(function(){return t.negotiationInfo.timeStamps.incomingCallHandled=(new Date).getTime(),t.initialOfferTask}).then(function(e){var i=e.mediaContent;return t.offeredMediaTypes=e.mediaTypes||[],t.negotiationInfo.timeStamps.initialOfferArrived=(new Date).getTime(),t.callSession.assureMediaSessionCreated(),t.callSession.signaling().setOfferAnswerGenerationTimestamps(p.TM_CONSTANTS.LOCAL_OFFER_ANSWER_OPERATIONS.INITIAL_OFFER_PROCESSING_STARTED),r.tagAnError(n,t.callSession.media().processOfferAsync(i))}).then(function(){t.callSession.signaling().setOfferAnswerGenerationTimestamps(p.TM_CONSTANTS.LOCAL_OFFER_ANSWER_OPERATIONS.INITIAL_OFFER_PROCESSING_ENDED),t.negotiationInfo.timeStamps.offerProcessed=(new Date).getTime(),t.onCallStatusChanged(p.CA_CONSTANTS.CALL_STATUS.RINGING),t.callSession.signaling().setTimeToRingDuration()})["catch"](function(e){return t.logger.error("acknowledge failed","error:",e.toString()),r.isTaggedError(e)&&e.tag===n?t.endCallOnceWithMediaErrorAsync({subCode:p.CA_CONSTANTS.CALL_END_SUB_CODE.MEDIA_DROP_DURING_CONNECT,phrase:p.CA_CONSTANTS.CALL_END_PHRASE.MEDIA_DROP_DURING_CONNECT},e):t.cleanUp("Call.acknowledge() failure",{code:p.CA_CONSTANTS.CALL_END_CODE.UNKNOWN_ERROR,subCode:p.CA_CONSTANTS.CALL_END_SUB_CODE.PLACE_CALL_FAILED,phrase:p.CA_CONSTANTS.CALL_END_PHRASE.UNKNOWN},e)}),this.callSession.callOperationQueue},t.prototype.accept=function(e){var t=this;this.logger.log("Call.accept()");var n=0;return this.callSession.callOperationQueue=this.callSession.callOperationQueue.then(function(){t.setCallState(o.CallState.Connecting)}).then(function(){var i=t.callModalities.getLocalModalities(!0,e);return r.tagAnError(n,t.callModalities.configureAsync(t.callSession.media(),i))}).then(function(e){return t.isVideoOn=h.Helper.hasSendDirectionality(e.video),t.negotiationInfo.timeStamps.modalitiesConfigured=(new Date).getTime(),t.raiseEvent(c.CallEvents.localModalitiesConfigured,e),t.raiseEvent(c.CallEvents.mediaTypesOffered,{offeredMediaTypes:r.modalitiesToStreamTypes(e,r.ModalityDirection.receive),isMultiParty:t.callSession.signaling().multiParty}),t.callSession.signaling().setOfferAnswerGenerationTimestamps(p.TM_CONSTANTS.LOCAL_OFFER_ANSWER_OPERATIONS.FINAL_ANSWER_GENERATION_STARTED),r.tagAnError(n,t.callSession.media().createAnswerAsync(!1))}).then(function(e){return t.callSession.signaling().setOfferAnswerGenerationTimestamps(p.TM_CONSTANTS.LOCAL_OFFER_ANSWER_OPERATIONS.FINAL_ANSWER_GENERATION_ENDED),t.negotiationInfo.timeStamps.finalAnswerCreated=(new Date).getTime(),t.negotiationInfo.mediaLegId=e.mediaLegId,t.callSession.signaling().acceptAsync(r.toSignalingMediaContent(e),r.toSignalingMediaTypes(e.modalities))}).then(function(){return t.negotiationInfo.timeStamps.signalingSessionAccepted=(new Date).getTime(),t.callConnectedTask}).then(function(){return t.negotiationInfo.timeStamps.callConnected=(new Date).getTime(),r.tagAnError(n,t.callNegotiator.completeNegotiationAsync(t.callSession.media()))}).then(function(e){t.callSession.signaling().setOfferAnswerGenerationTimestamps(p.TM_CONSTANTS.LOCAL_OFFER_ANSWER_OPERATIONS.NEGOTIATION_COMPLETED),t.negotiationInfo.status="Succeeded",t.negotiationInfo.result=e,t.updateParticipantStreams(e),t.negotiationInfo.sendStats(),t.logger.log("Call.accept terminated successfully")})["catch"](function(e){return t.negotiationInfo.status="ErrorLocalInternal-fatal",t.negotiationInfo.sendStats(),t.logger.log("Call.accept failed","error:",e),r.isTaggedError(e)&&e.tag===n?t.endCallOnceWithMediaErrorAsync({subCode:p.CA_CONSTANTS.CALL_END_SUB_CODE.MEDIA_DROP_DURING_CONNECT,phrase:p.CA_CONSTANTS.CALL_END_PHRASE.MEDIA_DROP_DURING_CONNECT},e):t.cleanUp("Call.accept() failure",{code:p.CA_CONSTANTS.CALL_END_CODE.UNKNOWN_ERROR,subCode:p.CA_CONSTANTS.CALL_END_SUB_CODE.PLACE_CALL_FAILED,phrase:p.CA_CONSTANTS.CALL_END_PHRASE.UNKNOWN},e)}),this.callSession.callOperationQueue},t.prototype.reject=function(){var e=this;this.logger.log("Call.reject()");if(this.state!==o.CallState.Notified&&this.state!==o.CallState.Ringing)throw new Error("Only calls in Notified or Ringing state can be rejected");return this.setCallState(o.CallState.Disconnecting),this.cleanUp("user reject request",{code:p.CA_CONSTANTS.CALL_END_CODE.REJECT,subCode:p.CA_CONSTANTS.CALL_END_SUB_CODE.BEFORE_CONNECT,phrase:p.CA_CONSTANTS.CALL_END_PHRASE.LOCAL_USER_INITIATED})["catch"](function(t){e.logger.log("Call.stop failed with error "+t+"!")}).then(function(){e.setCallState(o.CallState.Disconnected)})},t.prototype.addParticipantForInitiation=function(e,t){this.logger.log("Call.addParticipantForInitiation()");var n=this.addParticipantInternal(e,t);return this.raiseChanged(),n},t.prototype.addParticipantsWhileConnected=function(e,t){var n=this;this.logger.log("Call.addParticipantsWhileConnected()"),t&&this.callSession.signaling().setThreadId(t);var r=[];return e.forEach(function(e){r.push(n.addParticipantInternal(e.id,e.displayName))}),this.raiseChanged(),Promise.all(r)},t.prototype.stop=function(){var e=this;this.logger.log("Call.stop()");var t=p.CA_CONSTANTS.CALL_END_CODE.SUCCESS,n=p.CA_CONSTANTS.CALL_END_SUB_CODE.SUCCESS;switch(this.state){case o.CallState.Ringing:case o.CallState.Connecting:case o.CallState.Notified:case o.CallState.Observing:t=p.CA_CONSTANTS.CALL_END_CODE.CANCEL,n=p.CA_CONSTANTS.CALL_END_SUB_CODE.BEFORE_CONNECT;break;case o.CallState.Connected:case o.CallState.LocalHold:case o.CallState.RemoteHold:case o.CallState.Voicemail:n=p.CA_CONSTANTS.CALL_END_SUB_CODE.AFTER_CONNECT;break;default:}return this.state!=o.CallState.Disconnected&&this.setCallState(o.CallState.Disconnecting),this.cleanUp("user stop request",{code:t,subCode:n,phrase:p.CA_CONSTANTS.CALL_END_PHRASE.LOCAL_USER_INITIATED})["catch"](function(t){e.logger.log("Call.stop failed with error "+t+"!")}).then(function(){e.setCallState(o.CallState.Disconnected)})},t.prototype.stopWithBeacon=function(){var e=o.CallState;if(this.state===e.Disconnecting||this.state===e.Disconnected)return;this.callSession.signaling().endWithBeacon()},t.prototype.mute=function(){return this.logger.log("Call.mute()"),this.toggleMuteAsync(!0)},t.prototype.unmute=function(){return this.logger.log("Call.unmute()"),this.toggleMuteAsync(!1)},t.prototype.hold=function(){return Promise.reject(new Error("hold/unhold not supported"))},t.prototype.unhold=function(){return Promise.reject(new Error("hold/unhold not supported"))},t.prototype.sendDtmf=function(e){return this.callSession.media()?this.callSession.media().sendDtmf(e):Promise.reject(new Error("no media session"))},t.prototype.sendLocalVideo=function(e){var t=this;if(this.callSession.media()){var n=this.callModalities.getLocalModalities(!0,e);return this.callModalities.configureAsync(this.callSession.media(),n).then(function(e){t.isVideoOn=h.Helper.hasSendDirectionality(e.video),t.raiseEvent(c.CallEvents.localVideoStartedOrStopped,t.isVideoOn)})["catch"](function(e){throw t.logger.error("sendLocalVideo failed","error:",e),e})}return Promise.reject(new Error("no media session"))},t.prototype.setVideoContainer=function(e){this.localVideoContainer=e},t.prototype.startVideo=function(e){var t=this;return this.sendLocalVideo(!0).then(function(){return t.localVideoRenderer&&t.disposeLocalVideoRenderer(),t.localVideoContainer?(t.localVideoRenderer=t.callsModel.mediaAgent.getDeviceManager().createPreviewRenderer(t.localVideoContainer,{onVideoSizeChanged:function(e,n){t.raiseEvent(c.CallEvents.localVideoSizeChanged,{width:e,height:n})}}),t.localVideoRenderer.startVideoAsync()):(t.logger.error("Local video container not set!"),Promise.reject("Local video container not set!"))})},t.prototype.stopVideo=function(){return this.disposeLocalVideoRenderer(),this.sendLocalVideo(!1).then(function(){},function(){}),Promise.resolve(undefined)},t.prototype.startScreenSharing=function(e){return Promise.resolve(undefined)},t.prototype.stopScreenSharing=function(){return Promise.resolve(undefined)},t.prototype.disposeLocalVideoRenderer=function(){return this.localVideoRenderer&&(this.localVideoRenderer.dispose(),this.localVideoRenderer=undefined),Promise.resolve(undefined)},t.prototype.onOffer=function(e){this.logger.log("onOffer"),e.renegotiation||this.handleInitialOffer(e)},t.prototype.onAnswer=function(e){this.logger.log("onAnswer","provisional:",e.provisional,"renegotiation:",e.renegotiation,"mediaTypes:",e.mediaTypes)},t.prototype.onCallStatusChanged=function(e,t){var n=!1;this.callSession.signaling().participantManager&&this.callSession.signaling().participantManager.localParticipant&&(this.endpointId=this.callSession.signaling().participantManager.localParticipant.endpointId,this.participantId=this.callSession.signaling().participantManager.localParticipant.participantId,this.raiseChanged());switch(e){case p.CA_CONSTANTS.CALL_STATUS.RINGING:this.participants.forEach(function(e){return e.setState(o.ParticipantState.Ringing)}),this.setCallState(o.CallState.Ringing);break;case p.CA_CONSTANTS.CALL_STATUS.CONNECTED:this.isHostlessCall=this.callSession.signaling().isHostLessCall,this.setCallState(o.CallState.Connected),this.callConnectedTask.resolve();break;case p.CA_CONSTANTS.CALL_STATUS.LOCAL_TERMINATED:case p.CA_CONSTANTS.CALL_STATUS.REMOTE_TERMINATED:t&&t.code!==p.CA_CONSTANTS.CALL_END_CODE.SUCCESS&&this.logger.error("Call terminated. Reject reason: "+JSON.stringify(t));var i=this.callSetupFailed?o.TerminatedReason.CallSetupError:r.ngcReasonToTerminatedReason(t);this.setCallState(o.CallState.Disconnected,i),this.participants.forEach(function(e){return e.setState(o.ParticipantState.Disconnected)}),n=!0;break;default:}n&&this.cleanUp("call termination")},t.prototype.onSelfParticipantUpdated=function(e){},t.prototype.onParticipantJoined=function(e){this.logger.log("participant joined:",e);var t=this.getOrCreateParticipant(e.id,e.displayName);t.ngcParticipant=e,t.state===o.ParticipantState.None&&t.setState(o.ParticipantState.Connecting),t.setState(this.state===o.CallState.Connected?o.ParticipantState.Connected:o.ParticipantState.Connecting),t.setMediaSession(this.callSession.media());if(this.isMultiParty()){var n=[];for(var r in e.endpointDetails)if(e.endpointDetails.hasOwnProperty(r))for(var i in e.endpointDetails[r].mediaStreams)e.endpointDetails[r].mediaStreams.hasOwnProperty(i)&&n.push(e.endpointDetails[r].mediaStreams[i]);t.updateStreams(n)}this.raiseEvent(c.CallEvents.participantJoined,t)},t.prototype.onParticipantRemoved=function(e){this.logger.log("participant removed:",e);var t=this.getOrCreateParticipant(e.id,e.displayName);this.removeParticipant(e),this.raiseEvent(c.CallEvents.participantRemoved,t)},t.prototype.onParticipantUpdated=function(e){this.logger.log("participant updated:",e);var t=this.getOrCreateParticipant(e.id,e.displayName);if(this.isMultiParty()){var n=[];for(var r in e.endpointDetails)if(e.endpointDetails.hasOwnProperty(r))for(var i in e.endpointDetails[r].mediaStreams)e.endpointDetails[r].mediaStreams.hasOwnProperty(i)&&n.push(e.endpointDetails[r].mediaStreams[i]);t.updateStreams(n)}t.setState(o.ParticipantState.Connected)},t.prototype.onMediaAcknowledgementSuccess=function(e){},t.prototype.onMediaAcknowledgementFailure=function(e,t){},t.prototype.onMediaRenegotiationRejection=function(e){this.logger.log("onMediaRenegotiationRejection","error:",e)},t.prototype.onConversationUpdated=function(e){this.threadId=e.threadId,this.messageId=e.teamsMessageId,this.raiseEvent(c.CallEvents.conversationUpdated,e)},t.prototype.updateParticipantsMediaSession=function(){var e=this;this.participants.forEach(function(t){t.setMediaSession(e.callSession.media())}),this.raiseChanged()},t.prototype.onReTargetStarted=function(){this.updateParticipantsMediaSession()},t.prototype.onReTargetCompletedSuccess=function(){this.threadId=this.callSession.signaling().threadId,this.raiseChanged()},t.prototype.onReTargetCompletedFailure=function(e){this.updateParticipantsMediaSession()},t.prototype.onWebRtcMediaNotification=function(e,t){this.logger.log("onWebRtcMediaNotification called with :"+JSON.stringify(t))},t.prototype.onContentSharingStarted=function(e){this.logger.log("onContentSharingStarted, details :"+e.contentIdentifier)},t.prototype.onContentSharingUpdated=function(e){this.logger.log("onContentSharingUpdated, details :"+e.contentIdentifier)},t.prototype.onContentSharingStopped=function(e){this.logger.log("onContentSharingStopped")},t.prototype.onLightWeightMeetingUpdated=function(e){this.logger.log("onLightWeightMeetingUpdated: "+e)},t.prototype.onLightWeightMeetingEnded=function(e){this.logger.log("onLightWeightMeetingStopped")},t.prototype.onMeetingDetailsUpdated=function(e){this.logger.log("onMeetingDetailsUpdated")},t.prototype.onBroadcastDetailsUpdated=function(e){this.logger.log("onBroadcastDetailsUpdated")},t.prototype.onChatModalitySetupFailed=function(e){this.logger.log("onChatModalitySetupFailed")},t.prototype.onUnmuteRequested=function(e){this.logger.log("onUnmuteRequested")},t.prototype.onCallForwarded=function(e){this.logger.log("onCallForwarded")},t.prototype.onPSTNBalanceUpdate=function(e){this.logger.log("onPSTNBalanceUpdate")},t.prototype.onTransferRequested=function(e){return this.logger.log("onTransferRequested"),Promise.resolve({code:405,subCode:405,reason:"Transfer not supported"})},t.prototype.onTransferAccepted=function(){return Promise.resolve({code:405,subCode:405,reason:"Transfer not supported"})},t.prototype.onTransferCompleted=function(){return Promise.resolve({code:405,subCode:405,reason:"Transfer not supported"})},t.prototype.onIncomingCallReplacement=function(e){this.logger.log("onIncomingCallReplacement")},t.prototype.getRemoteParticipantCollection=function(){var e=[];return this.participants.forEach(function(t){var n=p.CA_CONSTANTS.PARTICIPANT_AUDIO_STATE.OTHER;switch(t.audio.state()){case o.StreamState.Available:n=p.CA_CONSTANTS.PARTICIPANT_AUDIO_STATE.CONNECTED;break;case o.StreamState.Connecting:n=p.CA_CONSTANTS.PARTICIPANT_AUDIO_STATE.CONNECTING;break;default:n=p.CA_CONSTANTS.PARTICIPANT_AUDIO_STATE.OTHER}e.push({id:t.id,mri:t.id,audioState:n})}),e},t.prototype.onNegotiationRequired=function(){this.initialNegotiationTask?this.initialNegotiationTask.resolve():this.renegotiate()},t.prototype.onSessionErrorOccurred=function(e){e.detail.type===h.Constants.MEDIA_ERROR.sourceUnavailableError?this.sendLocalVideo(!1)["catch"](function(){}):this.endCallOnceWithMediaErrorAsync({subCode:p.CA_CONSTANTS.CALL_END_SUB_CODE.MEDIA_DROP_AFTER_CONNECT,phrase:p.CA_CONSTANTS.CALL_END_PHRASE.MEDIA_DROP_AFTER_CONNECT},e)},t.prototype.onContributingSourcesChanged=function(e){this.participants.forEach(function(t){var n=e.indexOf(t.audio.id)>=0,r=n?1:0;t.updateVoiceLevel(r)}),this.raiseEvent(c.CallEvents.activeSpeakersChanged,e)},t.prototype.onDominantSpeakerChanged=function(e){this.raiseEvent(c.CallEvents.dominantSpeakersChanged,e)},t.prototype.onOptimalVideoReceiversCountChanged=function(e){this.raiseEvent(c.CallEvents.optimalVideoReceiversCountChanged,e)},t.prototype.startOrJoin=function(e){var t=this;return this.setCallState(o.CallState.Connecting),this.callSession.callOperationQueue=this.callSession.callOperationQueue.then(function(){var n=t.callModalities.getLocalModalities(!0,e.withVideo);return t.initialNegotiationTask=i.build(),t.configureSignalingSession(e.ringOthers),t.callSession.assureMediaSessionCreated(),r.tagAnError(a.mediaFailure,t.callModalities.configureAsync(t.callSession.media(),n))}).then(function(e){return t.isVideoOn=h.Helper.hasSendDirectionality(e.video),t.negotiationInfo.timeStamps.modalitiesConfigured=(new Date).getTime(),t.raiseEvent(c.CallEvents.localModalitiesConfigured,e),t.initialNegotiationTask}).then(function(){return t.callNegotiator.negotiate({callId:t.callId,ringOthers:e.ringOthers,joinUrl:e.joinUrl})}).then(function(e){t.updateParticipantStreams(e)})["catch"](function(e){t.callSetupFailed=!0,e=e.rawError?e.rawError:e;var n=e.ngcRejectReson?e.ngcRejectReson:{code:p.CA_CONSTANTS.CALL_END_CODE.UNKNOWN_ERROR,subCode:p.CA_CONSTANTS.CALL_END_SUB_CODE.PLACE_CALL_FAILED,phrase:p.CA_CONSTANTS.CALL_END_PHRASE.UNKNOWN};return t.logger.error("Call.start() failed","error:",e),t.cleanUp("Call.start() failure",n,e)}),this.callSession.callOperationQueue},t.prototype.addParticipantInternal=function(e,t){var n=this,i=this.getOrCreateParticipant(e,t),s=[o.ParticipantState.None,o.ParticipantState.Disconnected];if(s.indexOf(i.state)===-1)return Promise.resolve(i);i.setState(o.ParticipantState.Connecting),this.logger.debug("starting adding participant to call, participantId = "+i.id);var u=this.callSession.signaling().addParticipantAsync(p.createParticipant({id:i.id,displayName:i.displayName})).then(function(e){return n.logger.debug("successfully added participant to call, participantId = "+i.id),i.ngcParticipant=e,n.callSession.onParticipantJoined(e),i})["catch"](function(e){var t;if(!e.endCode||!e.endCode.code)t=o.ParticipantStateReason.AddingFailed,n.logger.error("Error while adding participant to call, participantId = "+i.id+", error = "+e);else{n.logger.debug("Participant was not added to call, participantId = "+i.id+", error = "+e);switch(e.endCode.code){case r.ADD_PARTICIPANT_FAILURE_CODES.NO_RESPONSE:t=o.ParticipantStateReason.NoResponse;break;case r.ADD_PARTICIPANT_FAILURE_CODES.DECLINED:t=o.ParticipantStateReason.Declined;break;case r.ADD_PARTICIPANT_FAILURE_CODES.NOT_REACHABLE:t=o.ParticipantStateReason.NotReachable;break;default:t=o.ParticipantStateReason.AddingFailed,n.logger.error("Error while adding participant to call, participantId = "+i.id+", error = "+e)}}return n.removeParticipant(i,t),Promise.reject(e)});return u},t.prototype.configureSignalingSession=function(e){!this.isIncoming&&this.callbacks.isGroupConversation()&&(this.participants.length>1||!e)&&(this.logger.log("configuring outgoing call as multiparty"),this.callSession.signaling().setMultiParty())},t.prototype.toggleMuteAsync=function(e){var t=this;return this.callSession.toggleMuteAsync(e).then(function(){return t.isMuted=e,t.raiseChanged(),e})["catch"](function(n){return t.logger.error("failed to toggle microphone mute:",n),!e})},t.prototype.renegotiate=function(){var e=this;return this.callSession.callOperationQueue=this.callSession.callOperationQueue.then(function(){return e.callNegotiator.renegotiate(e.callsModel).then(function(t){e.updateParticipantStreams(t)})["catch"](function(t){t=t.rawError?t.rawError:t;var n=t.ngcRejectReson?t.ngcRejectReson:{subCode:p.CA_CONSTANTS.CALL_END_SUB_CODE.MEDIA_RENEGOTIATION_ERROR,phrase:p.CA_CONSTANTS.CALL_END_PHRASE.MEDIA_RENEGOTIATION_ERROR};return e.logger.log("renegotiation failed!","error:",t),e.endCallOnceWithMediaErrorAsync(n,t)})}),undefined},t.prototype.rejectAllPendingTasks=function(e){this.callSession.callOperationQueue["catch"](function(e){}),this.callNegotiator.rejectAllPendingTasks(e);var t=[this.initialOfferTask,this.initialNegotiationTask,this.callConnectedTask];t.forEach(function(t){t&&t.state===o.SettablePromiseState.Pending&&(t["catch"](function(e){}),t.reject(e))})},t.prototype.cleanUp=function(e,t,n){var r=this;return this.retargetStartedSubscription.dispose(),this.disposeLocalVideoRenderer(),this.rejectAllPendingTasks(e),window.removeEventListener&&window.removeEventListener("beforeunload",this.beforeUnloadListener),this.callSession.disposeAsync(t).then(function(){r.participants.forEach(function(e){e.dispose()});if(n)throw r.logger.log("cleanUp : Error.phrase="+n.message),n})},t.prototype.endCallOnceWithMediaErrorAsync=function(e,t){var n=function(e,t){return t.errorWrappedWithTag&&(t=t.value),e.code=p.CA_CONSTANTS.CALL_END_CODE.MEDIA_ERROR,t.type===h.Constants.MEDIA_ERROR.permissionDeniedError?(e.subCode=p.CA_CONSTANTS.CALL_END_SUB_CODE.MEDIA_PERMISSION_ERROR,e.phrase=p.CA_CONSTANTS.CALL_END_PHRASE.MEDIA_PERMISSION_ERROR,e):(e.subCode=e.subCode||p.CA_CONSTANTS.CALL_END_SUB_CODE.MEDIA_UNKNOWN_ERROR,e.phrase=e.phrase||p.CA_CONSTANTS.CALL_END_PHRASE.MEDIA_ERROR,e)};return this.cleanUp("media error",n(e,t),t)},t.prototype.isRemoteClientLync=function(){return!this.callSession.signaling().multiParty&&this.callbacks.isRemoteClientLync()},t.prototype.monitorCallStart=function(){this.state===o.CallState.Connected&&this.participants.length&&!this.callStartedAt&&(this.callStartedAt=new Date)},t.prototype.handleInitialOffer=function(e){this.initialOfferTask.resolve(e)},t.prototype.updateParticipantStreams=function(e){this.isMultiParty()||this.participants.forEach(function(t){t.updateStreams([{type:o.StreamTypes.audio,direction:r.invertDirectionality(e.activeModalities.audio),sourceId:undefined},{type:o.StreamTypes.video,direction:r.invertDirectionality(e.activeModalities.video),sourceId:undefined},{type:o.StreamTypes.sharing,direction:r.invertDirectionality(e.activeModalities.sharing),sourceId:undefined}])})},t.prototype.removeParticipant=function(e,t){t===void 0&&(t=o.ParticipantStateReason.None),this.logger.debug("removeParticipant: "+e.id);var n=d.remove(this.participants,function(t){return t.id===e.id})[0];n?(n.setState(o.ParticipantState.Disconnected,t),n.dispose()):this.logger.error("removeParticipant: unable to remove participant "+e.id),this.raiseChanged()},t.prototype.getOrCreateParticipant=function(e,t){var n=this.participants.filter(function(t){return t.id===e})[0];return n?n:(n=new f["default"](e,t,this.callSession.media(),this.logger),this.participants.push(n),this.monitorCallStart(),this.raiseChanged(),n)},t.prototype.setCallState=function(e,t){if(this.state===e)return;var n=r.ValidStateTransitions[this.state],i=n.indexOf(e)>=0;if(!i){this.logger.error("Invalid state transition "+this.state+"->"+e+" attempted");if(e!==o.CallState.Disconnected)return}this.state=e;var s=null;switch(e){case o.CallState.Connected:this.callGotConnected=!0,!this.isMultiParty()&&this.participants[0]&&this.participants[0].setState(o.ParticipantState.Connected);break;case o.CallState.Disconnected:this.terminatedReason=t,r.CALL_SUCCESS_CODES.indexOf(t)===-1&&(this.failureType=this.callGotConnected?o.FailureType.CallDropped:o.FailureType.CallSetupFailed),this.callSession.signalingTerminationInfo&&(s={remote:this.callSession.signalingTerminationInfo.remote,code:this.callSession.signalingTerminationInfo.reasonCode,subCode:this.callSession.signalingTerminationInfo.reasonSubCode});break;default:}this.monitorCallStart(),this.raiseEvent(c.CallEvents.callStateChanged,s),this.raiseChanged()},t}(s["default"]);t.__esModule=!0,t["default"]=v}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("web-calling/lib/models/calls",["require","exports"],e)}(function(e,t){var n=function(){function e(e){this.mediaAgent=e.mediaAgent,this.signalingAgent=e.signalingAgent,this.browserDetect=e.browserDetect,this.featureFlags=e.featureFlags,this.telemetryService=e.telemetryService,this.telemetryManager=e.telemetryManager,this.mdscToken=e.mdscToken,this.logger=e.logger,this.selectedDevicesProvider=e.selectedDevicesProvider}return e}();t.__esModule=!0,t["default"]=n});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("web-calling/lib/models/callRegistry",["require","exports","../utilities/typeDefs","./call","../utilities/observableBase","./callEvents"],e)})(function(e,t){var n=e("../utilities/typeDefs"),r=e("./call"),i=e("../utilities/observableBase"),s=e("./callEvents"),o=new RegExp("/callAgent/","i"),u={INCOMING_LYNC_NGC_CALL:105,INCOMING_SKYPE_NGC_CALL:107,INCOMING_SKYPE_NGC_GVC_CALL:109,INCOMING_SKYPE_NGC_PSTN_CALL:111,STOP_RINGING_SKYPE_NGC_CALL:110},a=function(){function e(e){this.signalingAgent=e}return e.prototype.handleMessage=function(e){if(e.url.search(o)>-1){var t=this.signalingAgent.handleIncomingNotification(e);return typeof t=="number"?{isHandled:!0,resultCode:t}:{isHandled:!0,resultCode:t.resultCode,responseBody:t.responseBody,responseHeaders:t.responseHeaders}}return{isHandled:!1}},e}(),f=function(){function e(e,t){this.logger=t.createChild("CallingMessageHandler"),this.callRegistry=e}return e.prototype.handleMessage=function(e){switch(e.eventId){case u.INCOMING_LYNC_NGC_CALL:case u.INCOMING_SKYPE_NGC_CALL:case u.INCOMING_SKYPE_NGC_GVC_CALL:case u.INCOMING_SKYPE_NGC_PSTN_CALL:this.handleIncomingCall(e);break;case u.STOP_RINGING_SKYPE_NGC_CALL:this.handleStopRinging(e);break;default:}return{isHandled:!1}},e.prototype.handleIncomingCall=function(e){var t=this.buildNGCCallPayload(e);if(!t)return!1;this.logger.debug("received trouter incoming call notification for callId="+t.convoCallId);if(this.callRegistry.calls.some(function(e){return t.convoCallId===e.callId}))return this.logger.debug("ignoring trouter incoming call notification for callId="+t.convoCallId+" since call exists"),!1;var n=this.callRegistry.createCall(t.isMultiParty?t.conversationId:undefined,t.callId);return n.initialize({selfParticipant:{id:this.callRegistry.identity.id,displayName:this.callRegistry.identity.displayName},callbacks:{isRemoteClientLync:function(){return e.eventId===u.INCOMING_LYNC_NGC_CALL},isRemotePersonAuthorized:function(){return!0},isGroupConversation:function(){return t.isMultiParty}}}),n.acknowledge(t),this.logger.debug("trouter incoming call notification processed, call created and acknowledged"),this.callRegistry.raiseIncomingCall(n,t.callerId),!0},e.prototype.buildNGCCallPayload=function(e){var t={},n;try{n=JSON.parse(atob(e.body.gp))}catch(r){return this.logger.error("Unable to parse incoming NGC call payload"),null}return n.callNotification?(t.conversationId=n.groupChat&&n.groupChat.threadId||n.callNotification.from.id,t.callerId=n.callNotification.from.id,t.isMultiParty=n.conversationInvitation.isMultiParty,t.callId=n.debugContent.callId,t.ngcCall=!0,t.body=e.body,this.logger.log("Incoming NGC payload",t),t):(this.logger.error("Missing callNotification in parsed incoming NGC call payload"),null)},e.prototype.handleStopRinging=function(e){var t=this.getCallId(e);this.logger.debug("received trouter stop ringing notification for callId="+t);var r=this.callRegistry.calls.filter(function(e){return e.callId===t})[0];return r?r.state!==n.CallState.Ringing?(this.logger.debug("ignoring trouter stop ringing notification for callId="+t+" since call is not in Ringing state anymore"),!1):(r.stop(),this.logger.debug("trouter stop ringing notification processed, call stopping"),!0):(this.logger.debug("ignoring trouter incoming call notification for callId="+t+" since call does not exist"),!1)},e.prototype.getCallId=function(e){try{return e.body.callId}catch(t){return this.logger.error("Unable to get callId from stop ringing NGC call payload"),null}},e}(),l=function(e){function t(t,n,r,i){var s=e.call(this)||this;return s.calls=[],s.identity=null,s.trouterService=t,s.services=n,s.model=r,s.logger=i.createChild("Callregistry"),s}return __extends(t,e),t.prototype.raiseIncomingCall=function(e,t){this.raiseEvent(s.CallRegistryEvents.incomingCall,{call:e,callerId:t})},t.prototype.init=function(e){var t=this;return this.identity=e,this.trouterService.registerMessageHandler(new a(this.services.signalingAgent)),this.trouterService.registerMessageHandler(new f(this,this.logger)),this.services.mediaAgent.getDeviceManager().enumerateDevicesAsync().then(function(e){t.logger.log("devices enumerated:",e)}),Promise.resolve(null)},t.prototype.createCall=function(e,t){var n=new r["default"](this.model,e,t);return this.calls.push(n),this.raiseChanged(),n},t.prototype.deleteCall=function(e){var t=this.calls.indexOf(e);return t!==-1?(this.calls.splice(t,1),this.raiseChanged(),!0):!1},t.prototype.debugInformation=function(e){var t=e?"CallInformation\n * CallId="+e.callId+"\n":"No CallInfo";return Promise.resolve(t)},t.prototype.updateSkypeToken=function(e){},t}(i["default"]);t.CallRegistry=l}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("web-calling/lib/public",["require","exports","./services/pluginlessTelemetry","./services/relayManager","./models/call","./models/calls","./utilities/modelHelper","media-agent","signaling-agent","./models/callRegistry","./utilities/typeDefs","./utilities/typeDefs","./utilities/typeDefs","./utilities/typeDefs","./utilities/typeDefs","./utilities/typeDefs","./utilities/typeDefs","./utilities/typeDefs","./utilities/typeDefs","./models/callEvents","./models/callEvents","./models/callEvents","./models/callEvents","media-agent","media-agent","signaling-agent","signaling-agent"],e)}(function(e,t){function L(e){if(k)return;var i=new a.DefaultSignalingAgentConfig({skypeTokenProvider:e.globalConfig.skypeTokenProvider,logger:e.globalConfig.logger,httpRequestDispatcher:new a.HttpRequestDispatcher(e.globalConfig.httpRequestDispatcher,e.ngcSignalingConfig.transientFaultPolicy),telemetryManager:new a.SkypeConCoreTelemetryManager(e.telemetryConfig.telemetryManager,e.telemetryConfig.skypeConcoreToken),clientInfo:e.ngcSignalingConfig.clientInformation,browserDetect:e.globalConfig.browserDetect,conversationServiceUrl:e.ngcSignalingConfig.conversationServiceUrl,trouterUrlGetter:e.ngcSignalingConfig.trouterUrlGetter,languageCode:e.ngcSignalingConfig.languageCode,emergencyCallCountry:e.ngcSignalingConfig.emergencyCallCountry,isGVCOutgoingEnabled:e.globalConfig.featureFlags.isGVCOutgoingEnabled(),isGVCJoiningEnabled:e.globalConfig.featureFlags.isGVCJoiningEnabled(),supportsHostlessGroupCalls:e.globalConfig.featureFlags.supportsHostlessGroupCalls(),doHostlessCalling:e.globalConfig.featureFlags.doHostlessCalling(),shouldServiceSendCallEventMessages:e.ngcSignalingConfig.shouldServiceSendCallEventMessages,supportsCompressedServicePayload:e.ngcSignalingConfig.supportsCompressedServicePayload,brokerEnabledOutgoing:e.ngcSignalingConfig.brokerEnabledOutgoing,brokerEnabledIncoming:e.ngcSignalingConfig.brokerEnabledIncoming,brokerRequestBatching:e.ngcSignalingConfig.brokerRequestBatching,brokerExclusively:e.ngcSignalingConfig.brokerExclusively,endConflictedCall:e.ngcSignalingConfig.endConflictedCall,autoResolveConflictedCall:e.ngcSignalingConfig.autoResolveConflictedCall,supportsSynchronousTrouterResponse:e.ngcSignalingConfig.supportsSynchronousTrouterResponse});t.services.signalingAgent=new a.SignalingAgent(i);var o={getLogger:function(){return e.globalConfig.logger},getRelayManager:function(){return t.services.relayManager},settings:e.mediaAgentConfig.settings};t.services.mediaAgent=u.MediaAgent.build(o,{onDevicesChanged:e.mediaAgentConfig.notifications.onDevicesChanged,onDevicesPermissionChanged:e.mediaAgentConfig.notifications.onDevicesPermissionChanged}),t.services.telemetry=n.build({telemetryManager:e.telemetryConfig.telemetryManager,mdscToken:e.telemetryConfig.mdscToken,logger:e.globalConfig.logger}),t.services.relayManager=r.build({tokenProvider:e.globalConfig.skypeTokenProvider,configProvider:e.relayManagerConfig.getRelayConfig,logger:e.globalConfig.logger,request:{get:function(t,n){return e.globalConfig.httpRequestDispatcher.get(t,n||{})},isOnline:function(){return e.globalConfig.isOnline()}}}),t.services.relayManager.initialize(),k=new s["default"]({mediaAgent:t.services.mediaAgent,signalingAgent:t.services.signalingAgent,browserDetect:e.globalConfig.browserDetect,featureFlags:e.globalConfig.featureFlags,telemetryService:t.services.telemetry,telemetryManager:e.telemetryConfig.telemetryManager,mdscToken:e.telemetryConfig.mdscToken,logger:e.globalConfig.logger,selectedDevicesProvider:e.globalConfig.selectedDevicesProvider})}function A(e,n){return L(n),new f.CallRegistry(e,t.services,k,n.globalConfig.logger)}function O(e,t){return new i["default"](k,e,t)}function M(){o.updateDeviceSelection(k)}function _(e){return a.createParticipant(e)}var n=e("./services/pluginlessTelemetry"),r=e("./services/relayManager"),i=e("./models/call"),s=e("./models/calls"),o=e("./utilities/modelHelper"),u=e("media-agent"),a=e("signaling-agent"),f=e("./models/callRegistry"),l=e("./utilities/typeDefs");t.CallState=l.CallState;var c=e("./utilities/typeDefs");t.CallSupport=c.CallSupport;var h=e("./utilities/typeDefs");t.FailureType=h.FailureType;var p=e("./utilities/typeDefs");t.ParticipantStateReason=p.ParticipantStateReason;var d=e("./utilities/typeDefs");t.ParticipantState=d.ParticipantState;var v=e("./utilities/typeDefs");t.SettablePromiseState=v.SettablePromiseState;var m=e("./utilities/typeDefs");t.StreamState=m.StreamState;var g=e("./utilities/typeDefs");t.StreamType=g.StreamType;var y=e("./utilities/typeDefs");t.TerminatedReason=y.TerminatedReason;var b=e("./models/callEvents");t.CallEvents=b.CallEvents;var w=e("./models/callEvents");t.CallRegistryEvents=w.CallRegistryEvents;var E=e("./models/callEvents");t.ParticipantEvents=E.ParticipantEvents;var S=e("./models/callEvents");t.StreamEvents=S.StreamEvents;var x=e("media-agent");t.MediaAgentHelper=x.Helper;var T=e("media-agent");t.MediaAgentConstants=T.Constants;var N=e("signaling-agent");t.IncomingNotificationMessageHandler=N.IncomingNotificationMessageHandler;var C=e("signaling-agent");t.DeviceType=C.DeviceType,t.services={mediaAgent:null,relayManager:null,signalingAgent:null,telemetry:null};var k;t.initialize=L,t.initializeForCallRegistryUsage=A,t.createCall=O,t.updateDeviceSelection=M,t.CSAcreateParticipant=_}),define("web-calling",["web-calling/lib/public"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-web-calling/lib/callEndReasonMapping",["require","exports","swx-constants","swx-enums","web-calling"],e)}(function(e,t){function s(e){return{local:o(e),remote:u(e)}}function o(e){if(e.explicitEndCallReason)return e.explicitEndCallReason;if(e.isIncoming){if(!e.wasConnected&&!e.info.remote&&e.endCallReason==="cancelCall")return r.callDisconnectionReason.Canceled;if(!e.wasConnected&&!e.info.remote&&e.endCallReason==="rejectCall")return r.callDisconnectionReason.Busy;if(f(e.reason))return r.callDisconnectionReason.Missed}return r.callDisconnectionReason.Terminated}function u(e){if(!e.isIncoming&&e.oneToOne){if(f(e.reason))return r.callDisconnectionReason.Missed;if(a(e.info.subCode))return l(e.info);if(!e.wasConnected&&e.info.remote)return r.callDisconnectionReason.Busy}return r.callDisconnectionReason.Terminated}function a(e){return e>=n.CALLING.PLUGINLESS_PSTN.END_REASONS.SUBCODE_RANGE.MIN&&e<=n.CALLING.PLUGINLESS_PSTN.END_REASONS.SUBCODE_RANGE.MAX}function f(e){return e===i.TerminatedReason.Cancelled||e===i.TerminatedReason.CallEstablismentTimeout}function l(e){var t=e.subCode-n.CALLING.PLUGINLESS_PSTN.END_REASONS.SUBCODE_RANGE.MIN,i=n.CALLING.PLUGINLESS_PSTN.END_REASONS.REASON_MAP;return i[e.code]&&i[e.code][t]?i[e.code][t]:r.callDisconnectionReason.Terminated}var n=e("swx-constants"),r=e("swx-enums"),i=e("web-calling");t.getCallEndReasons=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-web-calling/lib/callHandler",["require","exports","swx-jskype-internal-application-instance","swx-enums","swx-constants","swx-constants","jcafe-property-model","swx-mri/lib/mriMaps","swx-mri","swx-jskype-main/lib/modelHelpers/calling/fallbackMessageHelper","web-calling","lodash-compat","swx-jskype-main/lib/services/preferences/settingsUtils/privacySettingsUtil","./callEndReasonMapping","swx-jskype-main/lib/modelHelpers/personsAndGroupsHelper"],e)}(function(e,t){var n=e("swx-jskype-internal-application-instance"),r=e("swx-enums"),i=e("swx-constants"),s=e("swx-constants"),o=e("jcafe-property-model"),u=e("swx-mri/lib/mriMaps"),a=e("swx-mri"),f=e("swx-jskype-main/lib/modelHelpers/calling/fallbackMessageHelper"),l=e("web-calling"),c=e("lodash-compat"),h=e("swx-jskype-main/lib/services/preferences/settingsUtils/privacySettingsUtil"),p=e("./callEndReasonMapping"),d=e("swx-jskype-main/lib/modelHelpers/personsAndGroupsHelper"),v=function(){function e(e,t){var f=this;this._callRingingTask=o.task(),this._rosterUpdatePromise=Promise.resolve(),this._rosterUpdateSuspensionTask=null,this._wasConnected=!1,this._wasRinging=!1,this._endCallReason="unknown",this._noVideoCapabilityMessageSent=!1,this._videoCompatibilityMessageSent=!1,this._noScreensharingCapabilityMessageSent=!1,this._noMicrophoneMessageSent=!1,this._explicitEndCallReason=null,this._localParticipantVideoStarted=!1,this._callEventSubscriptions=[],this._participantEventSubscriptions={},this._participantActive={},this._newConversationThreadId=null,this._setCallToConnectedState=function(){f._wasConnected=!0,f._updateParticipantAVState(f.conversation.selfParticipant,r.callConnectionState.Connected)},this._isAnyParticipantConnectedToCall=function(){return f._webCallingCall.participants.some(function(e){return e.state===l.ParticipantState.Connected})},this.placeCall=function(e){if(f.conversation.isGroupConversation()&&f.conversation.activeModalities.audio()&&f.conversation._ngcJoinUrl)return f._logger.log("placeCall : joining existing conversation"),f._webCallingCall.join({conversationUrl:f.conversation._ngcJoinUrl,conversationId:f.conversation.conversationId,conversationType:null,groupCallInitiator:null,expiration:null,status:null,isHostless:null},e);var t=f.conversation.participants;return t().forEach(function(e){var t=a.getKey(e.audio.endpoint(),e.person._type()),n=e.person.displayName();f._logger.log("addParticipant",e.person.id()),f._updateParticipantAVState(e,r.callConnectionState.Connecting),f._callRingingTask.promise.then(function(){f._updateParticipantAVState(e,r.callConnectionState.Ringing)}),f._webCallingCall.addParticipantForInitiation(t,n)["catch"](function(t){f._updateParticipantAVState(e,r.callConnectionState.Disconnected,r.callDisconnectionReason.Refused)})}),f._webCallingCall.start({ringOthers:!f.conversation._autoCall,withVideo:e})},this.acknowledge=function(){if(f.conversation._callData.wasNGCPayloadProcessed())return f._logger.log("acknowledge, NGC payload was processed"),Promise.resolve();var e=f.conversation._callData.getIncomingNGCPayload();return f._webCallingCall.acknowledge(e)},this.acceptCall=function(e){return f._webCallingCall.accept(e)},this.extendCall=function(e,t){f._logger.log("extendCall with",e);var n=e.map(function(e){var t=d.getPerson(e),n=a.getKey(t.id(),t._type()),r=t.displayName();return{id:n,displayName:r}});return t&&(f._newConversationThreadId=t),f._webCallingCall.addParticipantsWhileConnected(n,t)["catch"](function(e){f._logger.log("participant could not be added to the call",e)})},this.rejectCall=function(){return f._logger.log("rejectCall"),f._endCallReason="rejectCall",f._rejectAllPendingTasks(new Error("call rejected by user")),f._webCallingCall.reject()["catch"](function(e){f._updateParticipantAVState(f.conversation.selfParticipant,r.callConnectionState.Disconnected,r.callDisconnectionReason.Failed),f._logger.error("rejectCall failed","error:",e)})},this.cancelCall=function(){return f._logger.log("cancelCall"),f._endCallReason="cancelCall",f._rejectAllPendingTasks(new Error("call canceled by user")),f._wasRinging?Promise.resolve():f._webCallingCall.stop()["catch"](function(e){f._updateParticipantAVState(f.conversation.selfParticipant,r.callConnectionState.Disconnected,r.callDisconnectionReason.Failed),f._logger.error("cancelCall failed","error:",e)})},this.endCall=function(e){return f._logger.log("endCall"),f._endCallReason="endCall",f._explicitEndCallReason=e,f._rejectAllPendingTasks(new Error("call ended by user")),f._webCallingCall.stop()["catch"](function(e){f._updateParticipantAVState(f.conversation.selfParticipant,r.callConnectionState.Disconnected,r.callDisconnectionReason.Failed),f._logger.error("endCall failed","error:",e)})},this.dispose=function(){f.conversation.selfParticipant.audio.state.reason===r.callDisconnectionReason.CallEscalated?f._logger.log("Call was escalated, do not dispose"):(f._disposeWebCallingEventSubscriptions(),f._logger.log("dispose"),f._rejectAllPendingTasks(new Error("terminated")),f._stopAllParticipantStreams()["catch"](function(){}),f._selectedCameraSubscription.dispose(),f._selectedMicrophoneSubscription.dispose(),f._camerasSubscription.dispose(),f.conversation.mediaConnectionType(r.mediaConnectionType.Unknown))},this.setSoundLevelEventMode=function(e){return f._logger.log("setSoundLevelEventMode","options:",e),o.task().resolve(null).promise},this.mute=function(){return f._webCallingCall.mute()},this.unmute=function(){return f._webCallingCall.unmute()},this.sendDtmf=function(e){return f._webCallingCall.sendDtmf(e)},this.startScreenSharing=function(e){return Promise.reject("ScreenSharing not supported")},this.stopScreenSharing=function(e){return Promise.reject("ScreenSharing not supported")},this.attachParticipantVideo=function(e,t,n){return f._logger.log("attachParticipantVideo",e,n,t,f._webCallingCall.hasVideoCapability(),f._isStreamRendering(e,n)),n!=i.CALLING.PLUGIN_MEDIA_TYPES.VIDEO&&n!=i.CALLING.PLUGIN_MEDIA_TYPES.SCREEN_SHARING?Promise.reject("unsupported mediatype"):f._webCallingCall.hasVideoCapability()&&!f._isStreamRendering(e,n)?f._startParticipantStream(e,n,{container:t})["catch"](function(e){f._updateChannelStreamState(i.CALLING.PLUGIN_MEDIA_TYPES.VIDEO,f.conversation.selfParticipant,f._mapMediaStreamState(!1)),f._logger.error("startParticipantStream failed","error:",e)}):Promise.resolve(!0)},this.detachParticipantVideo=function(e,t){return f._logger.log("detachParticipantVideo",e,t),f._stopParticipantStream(e,t)},this.requestCallInfo=function(){f._logger.log("requestCallInfo");var e=o.task();if(f._webCallingCall.correlationId()){var t="\r\nCallInformation\r\n * CallId="+f._webCallingCall.correlationId()+"\r\n"+" * Establishment Technology=NGC (plugin-free)";e.resolve(t)}else e.reject("CallInformation not available");return e.promise},this.updateConversation=function(e){f.conversation=e},this._handleParticipantJoined=function(e){f._logger.log("_handleParticipantJoined",e.id),!f._webCallingCall.isIncoming&&!f._wasConnected&&f._isAnyParticipantConnectedToCall()&&f._setCallToConnectedState(),f._rosterUpdatePromise=f._rosterUpdatePromise.then(function(){f._subscribeToParticipantAndStreamEvents(e);var t=f._getOrCreateParticipant(a.getId(e.id));f._syncParticipantState(t,e)})},this._handleParticipantUpdated=function(e){f._logger.log("_handleParticipantUpdated",e.id),f._rosterUpdatePromise=f._rosterUpdatePromise.then(function(){var t=f._getParticipantById(a.getId(e.id));f._syncParticipantState(t,e)})},this._handleParticipantRemoved=function(e){f._logger.log("_handleParticipantRemoved",e.id),f._rosterUpdatePromise=f._rosterUpdatePromise.then(function(){f._disposeParticipantSubscriptions(e.id);var t=f._getParticipantById(a.getId(e.id));t&&(t.video._sourceId(0),t.audio._sourceId(0),t.screenSharing._sourceId(0),f._updateChannelStreamState(i.CALLING.PLUGIN_MEDIA_TYPES.VIDEO,t,r.mediaStreamState.Stopped),f._updateChannelStreamState(i.CALLING.PLUGIN_MEDIA_TYPES.SCREEN_SHARING,t,r.mediaStreamState.Stopped),f._updateParticipantAVState(t,r.callConnectionState.Disconnected))})},this._handleConversationUpdated=function(e){f._logger.log("_handleConversationUpdated","threadId:",e.threadId),f._newConversationThreadId=e.threadId},this._handleCallStatusChanged=function(e){f._logger.log("_handleCallStatusChanged",f._webCallingCall.state),f._webCallingCall.correlationId()&&f.conversation.audioService.callId._set(f._webCallingCall.correlationId()),f._webCallingCall.participantId&&f.conversation._callData.ngcParticipantId(f._webCallingCall.participantId),f._webCallingCall.endpointId&&f.conversation._callData.ngcEndpointId(f._webCallingCall.endpointId);switch(f._webCallingCall.state){case l.CallState.Ringing:f._webCallingCall.isIncoming&&(f._updateParticipantAVState(f.conversation.selfParticipant,r.callConnectionState.Notified),f._wasRinging=!0),f._callRingingTask.resolve();break;case l.CallState.Connected:f.conversation._callData.isHostless=f._webCallingCall.isHostlessCall,!f._webCallingCall.isIncoming&&f._webCallingCall.isMultiParty()?f._callRingingTask.resolve():f._setCallToConnectedState();break;case l.CallState.Disconnected:f._handleCallTerminated(f._webCallingCall.terminatedReason,e)}},this.onTransferRequested=function(e){return f._logger.log("onTransferRequested"),null},this.conversation=t;var c=l.CSAcreateParticipant({displayName:t.selfParticipant.person.displayName(),id:a.getKey(t.selfParticipant.audio.endpoint(),t.selfParticipant.person._type())});this._webCallingCall=l.createCall(this.conversation.isGroupConversation()?this.conversation.conversationId:undefined,this.conversation._ngcCorrelationId),this._subscribeToCallEvents(),this._webCallingCall.initialize({selfParticipant:c,callbacks:{isRemoteClientLync:function(){return f.conversation.participants(0)&&f.conversation.participants(0).person._type()===u.contactTypes.lync},isRemotePersonAuthorized:function(){return f.conversation.participants(0)&&f.conversation.participants(0).person._authorization()===s.PEOPLE.authorizationStates.AUTHORIZED},isGroupConversation:function(){return f.conversation.isGroupConversation()}}}),this._logger=e.getLogger().createChild("CallHandler",function(){return f._webCallingCall.correlationId()}),this._logger.log("construct"),this._selectedCameraSubscription=n.get().devicesManager.selectedCamera.changed(this._selectedDeviceChanged.bind(this)),this._selectedMicrophoneSubscription=n.get().devicesManager.selectedMicrophone.changed(this._selectedDeviceChanged.bind(this)),this._camerasSubscription=n.get().devicesManager.cameras.removed(this._cameraRemoved.bind(this)),t.mediaConnectionType(r.mediaConnectionType.Pluginless),t.audioService.callHadNoMicrophone(!1)}return e.prototype._subscribeToCallEvents=function(){var e=this,t=function(t,n){e._callEventSubscriptions.push(e._webCallingCall.on(t,n.bind(e)))};t(l.CallEvents.noMicrophoneAccess,this._handleNoMicrophoneAccess),t(l.CallEvents.localModalitiesConfigured,this._handleLocalModalitiesConfigured),t(l.CallEvents.mediaTypesOffered,this._handleMediaTypesOffered),t(l.CallEvents.activeSpeakersChanged,this._handleActiveSpeakersChanged),t(l.CallEvents.dominantSpeakersChanged,this._handleDominantSpeakersChanged),t(l.CallEvents.optimalVideoReceiversCountChanged,this._handleOptimalVideoReceiversCountChanged),t(l.CallEvents.localVideoStartedOrStopped,this._handleLocalVideoStartedOrStopped),t(l.CallEvents.localVideoSizeChanged,this._handleLocalVideoSizeChanged),t(l.CallEvents.conversationUpdated,this._handleConversationUpdated),t(l.CallEvents.callNegotiationFinished,this._handleCallNegotiationFinished),t(l.CallEvents.callStateChanged,this._handleCallStatusChanged),t(l.CallEvents.participantJoined,this._handleParticipantJoined),t(l.CallEvents.participantRemoved,this._handleParticipantRemoved),t(l.CallEvents.retargetStarted,this._handleRetargetStarted),t(l.CallEvents.retargetCompleted,this._handleRetargetCompleted),t(l.CallEvents.retargetAborted,this._handleRetargetAborted)},e.prototype._subscribeToParticipantAndStreamEvents=function(e){var t=this,n=function(n,r,i){var s=n.type+"-"+r;t._participantEventSubscriptions[e.id][s]=n.on(r,i)};this._participantEventSubscriptions[e.id]||(this._participantEventSubscriptions[e.id]={}),this._participantEventSubscriptions[e.id][""]=e.changed(this._handleParticipantUpdated.bind(this)),n(e.video,l.StreamEvents.videoSizeChanged,this._handleParticipantVideoSizeChanged.bind(this)),n(e.screenShare,l.StreamEvents.videoSizeChanged,this._handleParticipantVideoSizeChanged.bind(this))},e.prototype._disposeParticipantSubscriptions=function(e){var t=this._participantEventSubscriptions[e];if(t){for(var n in t)t[n].dispose();this._participantEventSubscriptions[e][""].dispose()}delete this._participantEventSubscriptions[e]},e.prototype._disposeWebCallingEventSubscriptions=function(){this._callEventSubscriptions.forEach(function(e){e.dispose()}),this._callEventSubscriptions=[];for(var e in this._participantEventSubscriptions)this._disposeParticipantSubscriptions(e);this._participantEventSubscriptions={}},e.prototype._mapMediaStreamState=function(e){return e?r.mediaStreamState.Started:r.mediaStreamState.Stopped},e.prototype._rejectAllPendingTasks=function(e){e.callHandlerTerminationInProgress=!0;var t=[this._callRingingTask,this._rosterUpdateSuspensionTask];t.forEach(function(t){t&&t.promise.state()==="pending"&&t.reject(e)})},e.prototype._handleNoMicrophoneAccess=function(){this._noMicrophoneMessageSent||(this._noMicrophoneMessageSent=!0,f.sendMicrophoneAccessFallbackMessage(this.conversation)),this.conversation.audioService.callHadNoMicrophone(!0)},e.prototype._handleActiveSpeakersChanged=function(e){var t=this;this.conversation.participants().forEach(function(n){var r=e.indexOf(n.audio._sourceId())!==-1,i=n.audio.isSpeaking();if(i!==r)return t._logger.log("SPEAKING status for",t._fmtParticipant(n),"to",r?"active":"inactive"),n.audio.isSpeaking._set(r)})},e.prototype._handleDominantSpeakersChanged=function(e){var t=this,n;e.some(function(e){return n=c.find(t.conversation.participants(),function(t){return t.audio._sourceId()===e}),n});if(!n)return;var r=this.conversation.videoService.activeSpeaker.participant;n&&n!==r()&&(this._logger.log("DOMINANT status for",this._fmtParticipant(n)),r()?n.audio.importance=r().audio.importance+1:n.audio.importance=1,r._set(n))},e.prototype._handleOptimalVideoReceiversCountChanged=function(e){this._logger.log("optimal video receiver count changed to",e),this.conversation.videoService.maxVideos.set(e)},e.prototype._handleLocalVideoStartedOrStopped=function(e){var t=this.conversation.selfParticipant.video.channels(0);t&&t.isStarted.set._enabled(!0),this._updateChannelStreamState(i.CALLING.PLUGIN_MEDIA_TYPES.VIDEO,this.conversation.selfParticipant,this._mapMediaStreamState(e))},e.prototype._handleLocalVideoSizeChanged=function(e){var t=e.width>0&&e.height>0;t?this._updateChannelStreamStateAndSize(i.CALLING.PLUGIN_MEDIA_TYPES.VIDEO,this.conversation.selfParticipant,r.mediaStreamState.Active,e.width,e.height):this._participantActive[this.conversation.selfParticipant.person.id()]&&this._updateChannelStreamState(i.CALLING.PLUGIN_MEDIA_TYPES.VIDEO,this.conversation.selfParticipant,r.mediaStreamState.Inactive),this._participantActive[this.conversation.selfParticipant.person.id()]=t},e.prototype._handleParticipantVideoSizeChanged=function(e){var t=e.size.width>0&&e.size.height>0,n=this._getParticipantById(a.getId(e.participant.id)),i=this._getMediaTypeFromStreamType(e.type);t?this._updateChannelStreamStateAndSize(i,n,r.mediaStreamState.Active,e.size.width,e.size.height):this._participantActive[e.participant.id]&&this._updateChannelStreamState(i,n,r.mediaStreamState.Inactive),this._participantActive[e.participant.id]=t},e.prototype._getMediaTypeFromStreamType=function(e){switch(e){case l.StreamType.Video:return i.CALLING.PLUGIN_MEDIA_TYPES.VIDEO;case l.StreamType.ScreenSharing:return i.CALLING.PLUGIN_MEDIA_TYPES.SCREEN_SHARING}return this._logger.error("Unexpected stream type to map to media type!",e),""},e.prototype._handleCallTerminated=function(e,t){t.remote&&(this._endCallReason="remoteTerminated"),this._rejectAllPendingTasks(new Error("terminated"));var n=p.getCallEndReasons({reason:e,info:t,isIncoming:this._webCallingCall.isIncoming,wasConnected:this._wasConnected,oneToOne:!this._webCallingCall.isMultiParty()&&this.conversation.participants(0),endCallReason:this._endCallReason,explicitEndCallReason:this._explicitEndCallReason});this._disconnectAllRemoteParticipantsFromCall(n.remote),this._updateParticipantAVState(this.conversation.selfParticipant,r.callConnectionState.Disconnected,n.local)},e.prototype._handleCallNegotiationFinished=function(e){var t=this,n=e.callNegotiationResult;if(n.isComplete){if(!e.isMultiParty){var r=this.conversation.participants(0),s=l.MediaAgentHelper.hasReceiveDirectionality(n.activeModalities.video),o=l.MediaAgentHelper.hasReceiveDirectionality(n.activeModalities.sharing);h.checkVideoPolicySettings(r).then(function(e){s=e?s:!1,o=e?o:!1,t._updateChannelStreamState(i.CALLING.PLUGIN_MEDIA_TYPES.VIDEO,r,t._mapMediaStreamState(s)),t._updateChannelStreamState(i.CALLING.PLUGIN_MEDIA_TYPES.SCREEN_SHARING,r,t._mapMediaStreamState(o))});if(this._webCallingCall.hasVideoCapability()){var u=!0,a=l.MediaAgentHelper.hasSendDirectionality,f=l.MediaAgentHelper.hasReceiveDirectionality;n.initiator?u=!a(n.offeredModalities.video)||a(n.activeModalities.video):f(n.offeredModalities.video)?u=!f(n.attemptedModalities.video)||f(n.activeModalities.video):a(n.offeredModalities.video)&&(u=!a(n.attemptedModalities.video)||a(n.activeModalities.video)),!u&&!this._webCallingCall.isNGCVoicemail()&&(this._logger.warn("cannot negotiate incompatible video modality"),this._notifyVideoCompatibility())}}var c=l.MediaAgentHelper.hasSendDirectionality(n.activeModalities.video);this._updateChannelStreamState(i.CALLING.PLUGIN_MEDIA_TYPES.VIDEO,this.conversation.selfParticipant,this._mapMediaStreamState(c))}},e.prototype._stopAllParticipantStreams=function(){var e=this,t=[];return this._webCallingCall.participants.forEach(function(n){t.push(e._stopRemoteParticipantStream(n.id,i.CALLING.PLUGIN_MEDIA_TYPES.VIDEO)),t.push(e._stopRemoteParticipantStream(n.id,i.CALLING.PLUGIN_MEDIA_TYPES.SCREEN_SHARING))}),t.push(this._stopSelfParticipantStream(i.CALLING.PLUGIN_MEDIA_TYPES.VIDEO)),t.push(this._stopSelfParticipantStream(i.CALLING.PLUGIN_MEDIA_TYPES.SCREEN_SHARING)),Promise.all(t)},e.prototype._startParticipantStream=function(e,t,n){var r=this;if(this._isSelfParticipant(e)){switch(t){case i.CALLING.PLUGIN_MEDIA_TYPES.VIDEO:return this._webCallingCall.setVideoContainer(n.container),this._webCallingCall.startVideo().then(function(){r._localParticipantVideoStarted=!0})["catch"](function(e){r._logger.error("failed to start preview video renderer",e),r._localParticipantVideoStarted=!1,r._updateChannelStreamState(t,r.conversation.selfParticipant,r._mapMediaStreamState(!1))});case i.CALLING.PLUGIN_MEDIA_TYPES.SCREEN_SHARING:return this._webCallingCall.startScreenSharing()}return Promise.reject("Unknown media type!")}var s=this._getRemoteParticipantStream(e,t);return s?s.start(n):(this._logger.error("WebCalling stream not found for start!"),Promise.reject("WebCalling stream not found for start!"))},e.prototype._stopSelfParticipantStream=function(e){var t=this;switch(e){case i.CALLING.PLUGIN_MEDIA_TYPES.VIDEO:return this._webCallingCall.stopVideo().then(function(){t._localParticipantVideoStarted=!1});case i.CALLING.PLUGIN_MEDIA_TYPES.SCREEN_SHARING:return this._webCallingCall.stopScreenSharing()}return Promise.resolve()},e.prototype._stopRemoteParticipantStream=function(e,t){var n=this._getRemoteParticipantStream(e,t);return n?n.stop():Promise.reject(new Error("WebCalling stream not found to stop"))},e.prototype._stopParticipantStream=function(e,t){return this._isSelfParticipant(e)?this._stopSelfParticipantStream(t):this._stopRemoteParticipantStream(e,t)},e.prototype._isStreamRendering=function(e,t){if(this._isSelfParticipant(e))return this._localParticipantVideoStarted;var n=this._getRemoteParticipantStream(e,t);return n?n.state()===l.StreamState.Streaming:!1},e.prototype._getRemoteParticipantStream=function(e,t){var n=this._getParticipantById(e);if(!n)return undefined;var r=a.getKey(n.audio.endpoint(),n.person._type()),s=c.find(this._webCallingCall.participants,function(e){return e.id===r});if(!s)return undefined;var o;switch(t){case i.CALLING.PLUGIN_MEDIA_TYPES.VIDEO:o=s.video;break;case i.CALLING.PLUGIN_MEDIA_TYPES.SCREEN_SHARING:o=s.screenShare;break;default:}return o},e.prototype.isPluginless=function(){return!0},e._getCafeStreamState=function(e){if(e)switch(e.state()){case l.StreamState.None:case l.StreamState.Connecting:return r.mediaStreamState.Stopped;case l.StreamState.Available:return r.mediaStreamState.Started;case l.StreamState.StreamPreparing:return r.mediaStreamState.Inactive;case l.StreamState.Streaming:return r.mediaStreamState.Active}return r.mediaStreamState.Stopped},e._getCafeParticipantState=function(e){switch(e){case l.ParticipantState.None:return r.callConnectionState.Disconnected;case l.ParticipantState.Disconnected:return r.callConnectionState.Disconnected;case l.ParticipantState.Connecting:return r.callConnectionState.Connecting;case l.ParticipantState.Connected:return r.callConnectionState.Connected;case l.ParticipantState.Ringing:return r.callConnectionState.Ringing;case l.ParticipantState.OnHold:return r.callConnectionState.Connected}return r.callConnectionState.Disconnected},e.prototype._syncParticipantState=function(t,n){n&&t&&(t.video._sourceId(n.video.id),t.audio._sourceId(n.audio.id),t.screenSharing._sourceId(n.screenShare.id),this._updateParticipantAVState(t,e._getCafeParticipantState(n.state)),this._checkSupportedMedia(l.StreamType.Video,t.video.state())&&this._updateChannelStreamState(i.CALLING.PLUGIN_MEDIA_TYPES.VIDEO,t,e._getCafeStreamState(n.video)),this._checkSupportedMedia(l.StreamType.ScreenSharing,n.screenShare.state())&&this._updateChannelStreamState(i.CALLING.PLUGIN_MEDIA_TYPES.SCREEN_SHARING,t,e._getCafeStreamState(n.screenShare)))},e.prototype._handleRetargetStarted=function(){var e=this;this._logger.log("_handleRetargetStarted"),this._rosterUpdateSuspensionTask=o.task(),this._localParticipantVideoStarted=!1,this._rosterUpdatePromise=this._rosterUpdatePromise.then(function(){return e._rosterUpdateSuspensionTask.promise})["catch"](function(t){e._logger.log("roster update failed",t)}),this._newConversationThreadId=this._newConversationThreadId?this._newConversationThreadId:this._webCallingCall.threadId,this.conversation._setSpawnedConversation(this._newConversationThreadId),this._rosterUpdateSuspensionTask.resolve()},e.prototype._handleRetargetCompleted=function(){this._logger.log("_handleRetargetCompleted")},e.prototype._handleRetargetAborted=function(){this._logger.log("_handleRetargetAborted")},e.prototype._disconnectAllRemoteParticipantsFromCall=function(e){var t=this,n=this.conversation.participants,s=n.subscribe();n().forEach(function(n){t._updateChannelStreamState(i.CALLING.PLUGIN_MEDIA_TYPES.VIDEO,n,r.mediaStreamState.Stopped),t._updateChannelStreamState(i.CALLING.PLUGIN_MEDIA_TYPES.SCREEN_SHARING,n,r.mediaStreamState.Stopped),t._updateParticipantAVState(n,r.callConnectionState.Disconnected,e)}),s.dispose()},e.prototype._handleLocalModalitiesConfigured=function(e){l.MediaAgentHelper.hasSendDirectionality(e.video)&&this._enableVideoWhenVideoChannelAdded()},e.prototype._fmtParticipant=function(e){return(this.conversation.selfParticipant===e?"* ":"")+e.person.id()},e.prototype._isSelfParticipant=function(e){return this.conversation.selfParticipant.person.id()===e},e.prototype._getOrCreateParticipant=function(e){return this._getParticipantById(e)},e.prototype._getParticipantById=function(e){return this._isSelfParticipant(e)?this.conversation.selfParticipant:this._getParticipant(function(t){return t.person.id()===e})},e.prototype._getParticipant=function(e){var t=this.conversation.participants,n=t.subscribe(),r=null;return t().some(function(t){return e(t)?(r=t,!0):undefined}),n.dispose(),r},e.prototype._getChannelForMediaType=function(e,t){switch(e){case i.CALLING.PLUGIN_MEDIA_TYPES.VIDEO:return t.video.channels(0);case i.CALLING.PLUGIN_MEDIA_TYPES.SCREEN_SHARING:return t.screenSharing;default:this._logger.log("_getChannelForMediaType. Type does not exist: ",e)}return void 0},e.prototype._updateChannelStreamState=function(e,t,n){var s=this._getChannelForMediaType(e,t);if(s){var o=s.stream.state(),u=o===r.mediaStreamState.Active||o===r.mediaStreamState.Inactive;if(o===n||u&&n===r.mediaStreamState.Started)return;this._logger.log("updateChannelStreamState",this._fmtParticipant(t),"type: ",e," state:",o,"->",n);if(e===i.CALLING.PLUGIN_MEDIA_TYPES.VIDEO&&!this._isSelfParticipant(t.person.id())){var a=n!==r.mediaStreamState.Stopped;s.isVideoOn._set(a)}s.stream.state._set(n)}},e.prototype._updateChannelStreamStateAndSize=function(e,t,n,r,i){var s=this._getChannelForMediaType(e,t);if(s){var o=s.stream.state();this._logger.log("updateChannelStreamStateAndSize",this._fmtParticipant(t),"type: ",e,"state:",o,"->",n,"size:",r,i),s.stream.state._set(n),s.stream.width._set(r),s.stream.height._set(i)}},e.prototype._updateParticipantAVState=function(e,t,n){var i=this,s=e.audio.state(),o=function(t,n,r){return i._logger.log("updateParticipantAVState",i._fmtParticipant(e),"state:",t,"->",n,"reason",r),e.audio.state._set(n,r),e.video.state._set(n,r),e.screenSharing.state._set(n,r),n};s===t||s===r.callConnectionState.Disconnected&&t===r.callConnectionState.Disconnecting||s===r.callConnectionState.Connected&&t===r.callConnectionState.Notified||s===r.callConnectionState.Connected&&t===r.callConnectionState.Connecting||s===r.callConnectionState.Connected&&t===r.callConnectionState.Ringing||s===r.callConnectionState.Ringing&&t===r.callConnectionState.Connecting?this._logger.log("updateParticipantAVState ignored, invalid states",this._fmtParticipant(e),"currentState:",s,"newState",t):(t===r.callConnectionState.Disconnected&&s!==r.callConnectionState.Disconnecting?s=o(s,r.callConnectionState.Disconnecting,n):t===r.callConnectionState.Connected&&s!==r.callConnectionState.Connecting&&s!==r.callConnectionState.Ringing?s=o(s,r.callConnectionState.Connecting):t===r.callConnectionState.Ringing&&s!==r.callConnectionState.Connecting&&(s=o(s,r.callConnectionState.Connecting)),o(s,t,n))},e.prototype._enableVideoWhenVideoChannelAdded=function(){var e=this,t,n=this.conversation.selfParticipant,r=function(i){t||(e._logger.log("enableVideoWhenVideoChannelAdded",e._fmtParticipant(n),"state:",i.stream.state(),"isStarted:",i.isStarted()),t=i.isStarted(!0),n.video.channels.added.off(r))};this._logger.log("enableVideoWhenVideoChannelAdded",this._fmtParticipant(n)),n.video.channels.added(r)},e.prototype._selectedDeviceChanged=function(e,t){var n=this,r=function(){switch(n._webCallingCall.state){case l.CallState.None:case l.CallState.Disconnecting:case l.CallState.Disconnected:return!1;default:return!0}};r()&&(t==="UserSelection"||t==="ActiveDeviceUnplugged")&&l.updateDeviceSelection()},e.prototype._cameraRemoved=function(e){var t=this.conversation.selfParticipant.video.channels(0);if(t&&t.isStarted()){var r=n.get().devicesManager;e.id()===r.selectedCamera().id()}},e.prototype._checkVideoSupport=function(){return this._webCallingCall.hasVideoCapability()?!0:(this._noVideoCapabilityMessageSent||(this._logger.log("remote participant added video modality, reminding user of missing video capability"),this._webCallingCall.isMultiParty()?f.sendNoVideoCapabilityMessage(this.conversation):f.sendNoVideoCapabilityMessage(this.conversation),this._noVideoCapabilityMessageSent=!0),!1)},e.prototype._notifyVideoCompatibility=function(){this._videoCompatibilityMessageSent||(f.sendVideoCompatibilityMessage(this.conversation),this._videoCompatibilityMessageSent=!0)},e.prototype._checkScreensharingSupport=function(){return this._webCallingCall.hasScreensharingCapability()?!0:(this._noScreensharingCapabilityMessageSent||(this._logger.log("remote participant added screensharing modality, reminding user of missing screensharing capability"),f.sendScreenSharingFallbackMessage(this.conversation),this._noScreensharingCapabilityMessageSent=!0),!1)},e.prototype._checkSupportedMedia=function(e,t){if(t!==l.StreamState.None){switch(e){case l.StreamType.Audio:return!0;case l.StreamType.Video:return this._checkVideoSupport();case l.StreamType.ScreenSharing:return this._checkScreensharingSupport()}return!1}return!0},e.prototype._handleMediaTypesOffered=function(e){var t=this;e.isMultiParty||e.offeredMediaTypes.forEach(function(e){t._checkSupportedMedia(e,l.StreamState.Available)})},e}();t.__esModule=!0,t["default"]=v}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-web-calling/lib/callHandlerProxy",["require","exports"],e)}(function(e,t){var n=function(){function e(e){var t=this;this.callHandlerInstance=null,this.isPluginless=function(){return t.callHandlerInstance.isPluginless()},this.transferFrom=function(e){e.callHandlerInstance.updateConversation(t.callHandlerInstance.conversation),t.callHandlerInstance=e.callHandlerInstance},this.acceptCall=function(e){return t.callHandlerInstance.acceptCall(e)},this.placeCall=function(e){return t.callHandlerInstance.placeCall(e)},this.acknowledge=function(){return t.callHandlerInstance.acknowledge()},this.rejectCall=function(){return t.callHandlerInstance.rejectCall()},this.cancelCall=function(){return t.callHandlerInstance.cancelCall()},this.extendCall=function(e,n){return t.callHandlerInstance.extendCall(e,n)},this.endCall=function(e){return t.callHandlerInstance.endCall(e)},this.mute=function(){return t.callHandlerInstance.mute()},this.unmute=function(){return t.callHandlerInstance.unmute()},this.sendDtmf=function(e){return t.callHandlerInstance.sendDtmf(e)},this.setSoundLevelEventMode=function(e){return t.callHandlerInstance.setSoundLevelEventMode(e)},this.startScreenSharing=function(e){return t.callHandlerInstance.startScreenSharing(e)},this.stopScreenSharing=function(e){return t.callHandlerInstance.stopScreenSharing(e)},this.attachParticipantVideo=function(e,n,r){return t.callHandlerInstance.attachParticipantVideo(e,n,r)},this.detachParticipantVideo=function(e,n){return t.callHandlerInstance.detachParticipantVideo(e,n)},this.requestCallInfo=function(){return t.callHandlerInstance.requestCallInfo()},this.dispose=function(){t.callHandlerInstance.dispose()},this.callHandlerInstance=e}return e}();t.__esModule=!0,t["default"]=n}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-web-calling/lib/public",["require","exports","./callHandler","./callHandlerProxy"],e)}(function(e,t){function i(e,t){var i=new n["default"](e,t);return new r["default"](i)}var n=e("./callHandler"),r=e("./callHandlerProxy");t.buildCallHandler=i}),define("swx-web-calling",["swx-web-calling/lib/public"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/serviceAccessLayer/uriBuilder",["require","exports","swx-log-tracer"],e)}(function(e,t){function r(){function r(){var e=t.fqdn;return e+=t.resource!==null?t.resource:"",e+=t.queryParams!==null?o(t.queryParams):"",e}function i(n){var r=typeof n=="string";e.log("Setting domain to",n);if(!r||n==="")throw new TypeError("domain must be a string");t.fqdn=n}function u(n){t.fqdn===null&&e.error("FQDN was not set yet!",n),t.fqdn.substring(0,6)==="skype:"?t.resource=n:t.resource=s(t.fqdn,n)}function a(e){var n={}.toString.call(e)==="[object Object]";if(!n&&e!==undefined)throw new Error("queryParams must be an object");t.queryParams=e||{}}var e=n.getLogger("[serviceAccessLayer]"),t={fqdn:null,resource:null,queryParams:null};return{getUri:r,setDomain:i,setResource:u,setQueryParams:a}}function i(e){var t=/^ *$/;if(e!==null&&e!==undefined)return e.toString().replace(t,"")}function s(e,t){var n="/",r=t[0]===n;return e[e.length-1]===n?t=r?t.substring(1):t:t=r?t:n+t,t}function o(e){function r(n){var r=i(e[n]);r&&t.push(n+"="+r)}var t=[],n="";for(var s in e)e.hasOwnProperty(s)&&r(s);return t.length>0&&(n="?"+t.join("&")),n}var n=e("swx-log-tracer");t.build=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/index",["require","exports","./utils/batch","swx-jskype-internal-application-instance","./utils/chat/cacheBase","./utils/chat/parser","./services/serviceAccessLayer/decorations/reporting","./services/serviceAccessLayer/qos/reporter","./services/serviceAccessLayer/requestDispatcher","./services/serviceAccessLayer/transientFaultPolicy","./services/serviceAccessLayer/uriBuilder"],e)}(function(e,t){var n=e("./utils/batch"),r=e("swx-jskype-internal-application-instance"),i=e("./utils/chat/cacheBase"),s=e("./utils/chat/parser"),o=e("./services/serviceAccessLayer/decorations/reporting"),u=e("./services/serviceAccessLayer/qos/reporter"),a=e("./services/serviceAccessLayer/requestDispatcher"),f=e("./services/serviceAccessLayer/transientFaultPolicy"),l=e("./services/serviceAccessLayer/uriBuilder");t.client=r,t.utils={batch:n,chat:{cacheBase:i,parser:s}},t.services={serviceAccessLayer:{decorations:{reporting:o},qos:{reporter:u},requestDispatcher:a,transientFaultPolicy:f,uriBuilder:l}}}),define("swx-jskype-main",["swx-jskype-main/lib/index"],function(e){return e}),define("jSkype/services/swxWebCalling",["require","exports","module","swx-jskype-internal-application-instance","jskype-settings-instance","swx-client-info","ecs-client","swx-jskype-main/lib/utils/ecsUtils","swx-constants","swx-enums","swx-log-tracer","swx-browser-detect","swx-jskype-main/lib/services/trouter/trouter","swx-pubsub-instance","green-id","swx-web-calling","web-calling","swx-jskype-main/lib/models/device","swx-jskype-main","swx-jskype-main"],function(e,t){function T(){var e=n.get().devicesManager,t=l.getBrowserInfo().getUrlParams().microphoneIdx;return t?e.microphones(+t):e.microphones(e.microphones.index(E))}function N(){var e=n.get().devicesManager,t=l.getBrowserInfo().getUrlParams().cameraIdx;return t?e.cameras(+t):e.cameras(e.cameras.index(S))}function C(e,t){t.kind===v.MediaAgentConstants.MEDIA_DEVICE.camera?e.cameras._add(new m(t.label,t.id,b[t.kind]),t.id):t.kind===v.MediaAgentConstants.MEDIA_DEVICE.microphone&&e.microphones._add(new m(t.label,t.id,b[t.kind]),t.id)}function k(e,t){t.kind===v.MediaAgentConstants.MEDIA_DEVICE.camera?e.cameras._remove(t.id):t.kind===v.MediaAgentConstants.MEDIA_DEVICE.microphone&&e.microphones._remove(t.id)}function L(e){E="",S="",e.forEach(function(e){!E&&e.kind===v.MediaAgentConstants.MEDIA_DEVICE.microphone&&(E=e.id),!S&&e.kind===v.MediaAgentConstants.MEDIA_DEVICE.camera&&(S=e.id)})}function A(e){var t=n.get().devicesManager,r=t.selectedMicrophone(),i=t.selectedCamera(),s=!r||!e.some(function(e){return e.id===r.id()}),o=!i||!e.some(function(e){return e.id===i.id()});w.forEach(function(n){var r=!e.some(function(e){return e.id===n.id});r&&k(t,n)}),e.forEach(function(e){var n=!w.some(function(t){return t.id===e.id});n&&C(t,e)}),w=e,L(w),r&&s&&(t.microphones.size()===0?t.selectedMicrophone._set(null,"ActiveDeviceUnplugged"):t.selectedMicrophone._set(T(),"ActiveDeviceUnplugged")),!r&&t.microphones.size()>0&&t.selectedMicrophone._set(T(),"FirstDevicePlugged"),i&&o&&(t.cameras.size()===0?t.selectedCamera._set(null,"ActiveDeviceUnplugged"):t.selectedCamera._set(N(),"ActiveDeviceUnplugged")),!i&&t.cameras.size()>0&&t.selectedCamera._set(N(),"FirstDevicePlugged")}function O(e){var t=n.get().devicesManager;t.mediaCapabilities.isMicrophoneEnabled._set(e.hasMicrophonePermission),t.mediaCapabilities.isCameraEnabled._set(e.hasCameraPermission)}function M(){b[v.MediaAgentConstants.MEDIA_DEVICE.microphone]=a.deviceType.Microphone,b[v.MediaAgentConstants.MEDIA_DEVICE.camera]=a.deviceType.Camera,b[v.MediaAgentConstants.MEDIA_DEVICE.speaker]=a.deviceType.Speaker,v.services.mediaAgent.getDeviceManager().enumerateDevicesAsync().then(function(e){var t=n.get().devicesManager;t.cameras._removeAll(),t.microphones._removeAll(),e.forEach(function(e){C(t,e)}),w=e,L(w),t.cameras.size()>0?t.selectedCamera._set(N()):t.selectedCamera._set(null),t.microphones.size()>0?t.selectedMicrophone._set(T()):t.selectedMicrophone._set(null)})}function _(e){var t=o.getApiKey(e),h=new Promise(function(n,i){s.fetchConfig({clientName:a.ecsClientNames.Skype,clientVersion:o.getClientVersion(e),endpoints:o.getHosts(e),teamName:r.settings.ecsTrapKey,queryParams:t?{apikey:t}:undefined},n,i)}),p={trouterUrl:c.trouterUrl,getTrouterUrlAsync:c.getTrouterUrlAsync};v.initialize({globalConfig:{browserDetect:l,featureFlags:{doHostlessCalling:function(){return r.isFeatureOn(u.COMMON.featureFlags.HOSTLESS_GROUP_CALLING_PLUGINLESS)},isVideoCallingFirefoxEnabled:function(){return r.isFeatureOn(u.COMMON.featureFlags.PLUGINLESS_VIDEO_CALLING_FIREFOX)},isGroupVideoCallingChromeLinuxEnabled:function(){return r.isFeatureOn(u.COMMON.featureFlags.PLUGINLESS_GROUP_VIDEO_CALLING_CHROME_LINUX)},isGVCOutgoingEnabled:function(){return r.isFeatureOn(u.COMMON.featureFlags.GVC_OUTGOING)},isGVCJoiningEnabled:function(){return r.isFeatureOn(u.COMMON.featureFlags.GVC_JOINING)},isIncomingScreenSharingEdgeEnabled:function(){return r.isFeatureOn(u.COMMON.featureFlags.PLUGINLESS_INCOMING_SCREEN_SHARING_EDGE)},isRemoteEscalationEnabled:function(){return r.isFeatureOn(u.COMMON.featureFlags.PLUGINLESS_REMOTE_ESCALATION)},supportsHostlessGroupCalls:function(){return r.isFeatureOn(u.COMMON.featureFlags.HOSTLESS_GROUP_CALLING_PLUGINLESS)}},httpRequestDispatcher:g,logger:f.getLogger("WebCalling"),selectedDevicesProvider:P,skypeTokenProvider:n.get().signInManager._skypeToken,isOnline:function(){return n.get().signInManager.state()===a.loginState.SignedIn}},mediaAgentConfig:{settings:r.settings.pluginless.mediaAgent,notifications:{onDevicesChanged:A,onDevicesPermissionChanged:O}},ngcSignalingConfig:{conversationServiceUrl:r.settings.pluginless.conversationServiceUrl,languageCode:r.settings.initParams.locale,clientInformation:i,transientFaultPolicy:y,trouterUrlGetter:p,emergencyCallCountry:"",shouldServiceSendCallEventMessages:!0,supportsCompressedServicePayload:r.isFeatureOn(u.COMMON.featureFlags.SUPPORT_PAYLOAD_COMPRESSION),brokerEnabledOutgoing:r.isFeatureOn(u.COMMON.featureFlags.BROKER_ENABLED_OUTGOING),brokerEnabledIncoming:r.isFeatureOn(u.COMMON.featureFlags.BROKER_ENABLED_INCOMING),brokerRequestBatching:r.isFeatureOn(u.COMMON.featureFlags.BROKER_REQUEST_BATCHING),brokerExclusively:r.isFeatureOn(u.COMMON.featureFlags.BROKER_EXCLUSIVELY),supportsSynchronousTrouterResponse:r.isFeatureOn(u.COMMON.featureFlags.SYNC_TROUTER_RESPONSE)},relayManagerConfig:{getRelayConfig:function(){return h}},telemetryConfig:{mdscToken:r.settings.telemetry.mdscToken,skypeConcoreToken:r.settings.telemetry.skypeConcoreToken,telemetryManager:n.get()._telemetryManager}})}function D(){r.isFeatureOn(u.COMMON.featureFlags.PLUGINLESS_PSTN_CALLING)&&h.subscribe(u.COMMON.apiUIEvents.SWX_TIMELINE_LOADED,function(){n.get().signInManager._skypeToken.changed(function(e){e&&p.registerGreenId(e,r.settings.greenId).catch(function(){})})})}function P(){var e=n.get().devicesManager,t={};return e.selectedCamera()&&(t.camera=e.selectedCamera().id()),e.selectedMicrophone()&&(t.microphone=e.selectedMicrophone().id()),t}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("swx-client-info"),s=e("ecs-client"),o=e("swx-jskype-main/lib/utils/ecsUtils"),u=e("swx-constants"),a=e("swx-enums"),f=e("swx-log-tracer"),l=e("swx-browser-detect").default,c=e("swx-jskype-main/lib/services/trouter/trouter"),h=e("swx-pubsub-instance").default,p=e("green-id"),d=e("swx-web-calling"),v=e("web-calling"),m=e("swx-jskype-main/lib/models/device").default,g=e("swx-jskype-main").services.serviceAccessLayer.requestDispatcher,y=e("swx-jskype-main").services.serviceAccessLayer.transientFaultPolicy,b={},w=[],E="",S="",x=f.getLogger("NGC");t.initialize=function(e){D(),_(e),M(),c.registerMessageHandler(new v.IncomingNotificationMessageHandler(v.services.signalingAgent))},t.getMediaAgent=function(){return v.services.mediaAgent},t.callHandler={initialize:function(){return!0},build:function(e){var t={getLogger:function(){return x}};return d.buildCallHandler(t,e)}}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/outOfBrowser/outOfBrowserFacade",["require","exports","swx-jskype-internal-application-instance","swx-browser-detect","jskype-settings-instance","swx-constants","swx-enums","../../../lib/services/outOfBrowser/extensionLifecycleFacade","swx-constants","swx-utils-common/lib/version"],e)}(function(e,t){function c(e,t,n){return new l(e,t,n)}var n=e("swx-jskype-internal-application-instance"),r=e("swx-browser-detect"),i=e("jskype-settings-instance"),s=e("swx-constants"),o=e("swx-enums"),u=e("../../../lib/services/outOfBrowser/extensionLifecycleFacade"),a=e("swx-constants"),f=e("swx-utils-common/lib/version"),l=function(){function e(e,t,n){var r=this;this.subscribedSettingsKey=s.COMMON.userSettings.preferences.SKYPE_VIDEO_CALLING_POLICY_SUPPORT,this.initialize=function(){return r.initializePromise||(r.extensionLifecycleFacade=u.build(r.shellAppPageUrl),r.extensionLifecycleFacade.onExtensionDisconnected(r.dispose.bind(r)),r.extensionLifecycleFacade.onShellAppWindowHidden(r.onShellAppWindowHidden.bind(r)),r.extensionLifecycleFacade.onShellAppCallEscalated(r.onShellAppCallEscalated.bind(r)),r.initializePromise=r.extensionLifecycleFacade.getVersion().then(r.onShellAppVersionReceived.bind(r))),r.initializePromise},this.start=function(e){return r.setActiveConversation(e.conversation),r.initialize().then(r.openShellApp.bind(r)).then(r.subscribeToSettingsChange.bind(r)).then(r.subscribeToTopicChange.bind(r)).then(r.subscibeToParticipantsAuthorizedChange.bind(r)).then(r.syncParticipants.bind(r)).then(function(){var t=Boolean(e.callHostId||e.accessToken),n=Boolean(e.conversation.autoCall()),i=e.conversation._autoCallingService.autoCallingMode(),s=e.conversation._autoCallingService.partnerId(),o=e.conversation._autoCallingService.callId();return r.sendCommand(a.OUT_OF_BROWSER.commands.START,{withVideo:e.withVideo,joinCall:t,autoCall:n,autoCallMode:i,autoCallPartnerId:s,autoCallId:o,callHostId:e.callHostId,accessToken:e.accessToken,endpoint:e.endpoint})})},this.joinCall=function(e){return r.activeConversation||r.setActiveConversation(e.conversation),r.initialize().then(function(){var t=Boolean(e.callHostId||e.accessToken),n=Boolean(e.conversation.autoCall());return r.sendCommand(a.OUT_OF_BROWSER.commands.JOIN_CALL,{withVideo:e.withVideo,joinCall:t,autoCall:n,callHostId:e.callHostId,accessToken:e.accessToken,endpoint:e.endpoint})})},this.accept=function(e,t){return r.setActiveConversation(e),r.initialize().then(r.openShellApp.bind(r)).then(r.subscribeToSettingsChange.bind(r)).then(r.subscribeToTopicChange.bind(r)).then(r.subscibeToParticipantsAuthorizedChange.bind(r)).then(r.syncParticipants.bind(r)).then(function(){return r.sendCommand(a.OUT_OF_BROWSER.commands.ACCEPT,{incomingCallData:e._callData.getUnprocessedIncomingCallPayloads(),withVideo:t})})},this.updateIncomingCallPayload=function(e){return r.initialize().then(function(){return r.sendCommand(a.OUT_OF_BROWSER.commands.UPDATE_INCOMING_PAYLOAD,{incomingCallData:e._callData.getUnprocessedIncomingCallPayloads()})})},this.cancel=function(){return i.isFeatureOn(s.COMMON.featureFlags.PRELOAD_SHELL_APP)?r.initialize().then(function(e){return e.initializesAsHidden?r.sendCommand(a.OUT_OF_BROWSER.commands.HIDE):r.extensionLifecycleFacade.disconnect()}):Promise.resolve()},this.stop=function(){return r.sendCommand(a.OUT_OF_BROWSER.commands.STOP)},this.reject=function(e){return r.setActiveConversation(e),r.sendCommand(a.OUT_OF_BROWSER.commands.REJECT)},this.mute=function(){return r.sendCommand(a.OUT_OF_BROWSER.commands.MUTE)},this.unmute=function(){return r.sendCommand(a.OUT_OF_BROWSER.commands.UNMUTE)},this.requestCallInfo=function(){return r.activeConversation?r.sendCommand(a.OUT_OF_BROWSER.commands.CALL_INFO):Promise.reject(undefined)},this.updateSettings=function(e,t){return r.sendCommand(a.OUT_OF_BROWSER.commands.SETTINGS_UPDATE,{settingsType:e,value:t})},this.dispose=function(e){e=e||{},r.initShellAppPromise=null,r.initializePromise=null,r.extensionLifecycleFacade.onShellAppWindowHidden(null),r.extensionLifecycleFacade.onExtensionDisconnected(null),r.extensionLifecycleFacade.onShellAppCallEscalated(null),r.extensionLifecycleFacade.dispose(),r.activeConversation&&(r.activeConversation.topic.changed.off(r.onTopicChanged),r.activeConversation.selfParticipant.audio.state.changed.off(r.onActiveConversationStateChanged),r.activeConversation.selfParticipant.audio.state._set(o.callConnectionState.Disconnected)),!e.preventReinitialisation&&i.isFeatureOn(s.COMMON.featureFlags.PERSISTENT_SHELL_APP)&&r.initialize(),r.settingsSubscription&&r.settingsSubscription.dispose(),r.participantAuthorizeSubscription&&r.participantAuthorizeSubscription.dispose()},this.onActiveConversationStateChanged=function(e,t,n){n&&e===o.callConnectionState.Disconnected&&r.resetActiveConversation()},this.onTopicChanged=function(e){return r.sendCommand(a.OUT_OF_BROWSER.commands.TOPIC_UPDATE,{topic:e})},this.onParticipantAuthorizedChanged=function(e){return r.activeConversation?r.sendCommand(a.OUT_OF_BROWSER.commands.PARTICIPANT_AUTHORIZE,{authorized:e}):Promise.resolve()},this.onSettingsValueChanged=function(e){r.updateSettings(r.subscribedSettingsKey,e)},this.shellAppPageUrl=e,this.environment=t,this.locale=n}return e.prototype.initShellApp=function(){var e=this;return this.initShellAppPromise||(this.initShellAppPromise=n.get().signInManager._skypeToken().then(function(t){return e.sendCommand(a.OUT_OF_BROWSER.commands.INIT,{token:t,tokenExpiration:n.get().signInManager._tokenExpiration/1e3,environment:e.environment,locale:e.locale})})),this.initShellAppPromise},e.prototype.openShellApp=function(e){var t=this.initShellApp(),n={shellAppHost:r["default"].getBrowserInfo().browserName};return e.initializesAsHidden&&(t=t.then(this.sendCommand.bind(this,a.OUT_OF_BROWSER.commands.SHOW,n))),t},e.prototype.sendCommand=function(e,t){var n=[a.OUT_OF_BROWSER.commands.JOIN_CALL,a.OUT_OF_BROWSER.commands.START,a.OUT_OF_BROWSER.commands.ACCEPT,a.OUT_OF_BROWSER.commands.STOP,a.OUT_OF_BROWSER.commands.REJECT,a.OUT_OF_BROWSER.commands.MUTE,a.OUT_OF_BROWSER.commands.UNMUTE,a.OUT_OF_BROWSER.commands.CALL_INFO,a.OUT_OF_BROWSER.commands.TOPIC_UPDATE,a.OUT_OF_BROWSER.commands.SYNC_PARTICIPANTS,a.OUT_OF_BROWSER.commands.PARTICIPANT_AUTHORIZE],r=n.indexOf(e)>=0;return t=t||{},r&&(t.conversationId=this.activeConversation.conversationId),this.extensionLifecycleFacade.getMessagingChannel().then(function(n){return n.sendCommand(e,t)})},e.prototype.setActiveConversation=function(e){this.activeConversation=e,this.activeConversation.selfParticipant.audio.state.changed(this.onActiveConversationStateChanged)},e.prototype.onShellAppVersionReceived=function(e){function c(){t({version:e,initializesAsHidden:o})}var t,n=f.parse(e),r=f.parse(a.OUT_OF_BROWSER.shellAppPreloadEnabledVersion),o=n.compareTo(r)>=0,u=o&&i.isFeatureOn(s.COMMON.featureFlags.PRELOAD_SHELL_APP),l=new Promise(function(e){t=e});return u?this.initShellApp().then(c):c(),l},e.prototype.onShellAppWindowHidden=function(){if(i.isFeatureOn(s.COMMON.featureFlags.PERSISTENT_SHELL_APP))return;this.dispose()},e.prototype.resetActiveConversation=function(){this.activeConversation&&(this.activeConversation.topic.changed.off(this.onTopicChanged),this.activeConversation.selfParticipant.audio.state.changed.off(this.onActiveConversationStateChanged),this.activeConversation=null)},e.prototype.moveConversation=function(e,t){e.spawnedConversation._set(t),this.resetActiveConversation(),this.setActiveConversation(t),window.setTimeout(this.subscribeToTopicChange.bind(this),a.OUT_OF_BROWSER.ESCALATION_TOPIC_SUBSCRIPTION_DELAY)},e.prototype.onShellAppCallEscalated=function(e){var t=this,r=n.get().conversationsManager.conversations(e.oldConversationId),i=n.get().conversationsManager.conversations(e.newConversationId);if(!i)var s=n.get().conversationsManager.conversations.added(function(n){n.conversationId===e.newConversationId&&(t.moveConversation(r,n),s.dispose())});else this.moveConversation(r,i)},e.prototype.subscribeToTopicChange=function(){this.activeConversation.topic.changed(this.onTopicChanged)},e.prototype.subscibeToParticipantsAuthorizedChange=function(){this.activeConversation.isGroupConversation()||(this.participantAuthorizeSubscription=this.activeConversation.participants()[0].person._authorization.changed(this.onParticipantAuthorizedChanged))},e.prototype.syncParticipants=function(){if(!this.activeConversation.isGroupConversation())return undefined;var e=this.activeConversation.participants().map(function(e){return e.person.id()});return this.sendCommand(a.OUT_OF_BROWSER.commands.SYNC_PARTICIPANTS,{participantsData:e})},e.prototype.subscribeToSettingsChange=function(){if(!i.isFeatureOn(s.COMMON.featureFlags.SKYPE_VIDEO_CALLING_POLICY_SUPPORT))return;this.settingsSubscription||(this.settingsSubscription=n.get().personsAndGroupsManager.mePerson.preferences(this.subscribedSettingsKey).value.changed(this.onSettingsValueChanged))},e}();t.OutOfBrowserFacade=l,t.build=c}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/outOfBrowser/outOfBrowserCallHandler",["require","exports","../../../lib/services/outOfBrowser/outOfBrowserFacade","swx-constants","jcafe-property-model","swx-browser-detect","swx-enums","swx-constants","../../../lib/services/outOfBrowser/extension","jskype-settings-instance","../../../lib/modelHelpers/calling/participantHelper","../../../lib/telemetry/logging/callingLogTracer","swx-browser-globals"],e)}(function(e,t){function g(){if(!f.isFeatureOn(u.COMMON.featureFlags.PRELOAD_SHELL_APP))return;w()}function y(){d.log("[OutOfBrowserCallHandler] dispose"),v&&(v.dispose({preventReinitialisation:!0}),v=null)}function b(){return Promise.resolve()}function w(){if(v)return v;var e=E(),t=f.settings.environment||p,r=f.settings.initParams.locale;return v=n.build(e,t,r),v.initialize(),v}function E(){var e=s["default"].getBrowserInfo().getUrlParams().ecsoverride||S(),t=x()+"?apiKey="+f.settings.initParams.apiKey+"&fingerprint="+f.settings.initParams.fingerprint;return e&&(t+="&ecsoverride="+e),t}function S(){var e=document.cookie.match(/ecsoverride=(.*?)(;|$)/);return e&&e.length>1?e[1]:undefined}function x(){return f.settings.appBaseUrl+r.OUT_OF_BROWSER.shellAppIndexPagePath}function T(e){return new m(e)}var n=e("../../../lib/services/outOfBrowser/outOfBrowserFacade"),r=e("swx-constants"),i=e("jcafe-property-model"),s=e("swx-browser-detect"),o=e("swx-enums"),u=e("swx-constants"),a=e("../../../lib/services/outOfBrowser/extension"),f=e("jskype-settings-instance"),l=e("../../../lib/modelHelpers/calling/participantHelper"),c=e("../../../lib/telemetry/logging/callingLogTracer"),h=e("swx-browser-globals"),p="prod",d=c.get(),v,m=function(){function e(e){var t=this;this.isPstnEnabled=f.isFeatureOn(u.COMMON.featureFlags.PSTN_ENABLED),this.startScreenSharing=b,this.stopScreenSharing=b,this.attachParticipantVideo=b,this.detachParticipantVideo=b,this.dispose=b,this.setSoundLevelEventMode=b,this.placeCall=function(e){d.log("[OutOfBrowserCallHandler] placeCall");var n={conversation:t.conversation,withVideo:e};t.isPstnEnabled&&!t.conversation.isGroupConversation()?n.endpoint=t.conversation.participants(0).audio.endpoint():t.conversation.isGroupConversation()&&t.conversation.activeModalities.audio()&&(n.callHostId=t.conversation._callHostId,n.accessToken=t.conversation._callPayload.AccessToken);var r=t.outOfBrowserFacade.start(n);return r["catch"](function(e){if(e&&e.type===u.COMMON.callingErrors.AUTO_CALL_FAILED){d.log("[OutOfBrowserCallHandler] Auto call failed, ignore");return}l.handleParticipantLeavingStateTransition(t.conversation.selfParticipant),(e===a.extensionConstants.ERRORS.MISSING_EXTENSION||e===a.extensionConstants.ERRORS.MISSING_PLUGIN)&&y()}),r},this.joinCall=function(e){d.log("[OutOfBrowserCallHandler] joinCall");var n={conversation:t.conversation,withVideo:e};return t.conversation.isGroupConversation()&&t.conversation.activeModalities.audio()&&(n.callHostId=t.conversation._callHostId,n.accessToken=t.conversation._callPayload.AccessToken),t.outOfBrowserFacade.joinCall(n)},this.acceptCall=function(e){return d.log("[OutOfBrowserCallHandler] acceptCall"),t.outOfBrowserFacade.accept(t.conversation,e)},this.extendCall=function(e){return Promise.resolve()},this.endCall=function(){return t.outOfBrowserFacade.stop()},this.cancelCall=function(){return t.outOfBrowserFacade.cancel()},this.requestCallInfo=function(){d.log("[OutOfBrowserCallHandler] requestCallInfo");var e=i.task(),n=t.conversation._callData.oncePluginCallInfoReady(function(){h.getWindow().clearTimeout(r),e.resolve(t.conversation._callData.pluginCallInfo())}),r=h.getWindow().setTimeout(function(){n.dispose(),e.reject("Call info request timeout")},5e3);return t.outOfBrowserFacade.requestCallInfo()["catch"](function(){n.dispose(),h.getWindow().clearTimeout(r),e.reject("Shell app not initialized")}),e.promise},this.mute=function(){return d.log("[OutOfBrowserCallHandler] mute"),t.toggleMuteTask&&t.toggleMuteTask.promise.state()==="pending"?t.toggleMuteTask.promise:(t.toggleMuteTask=i.task(),t.outOfBrowserFacade.mute(),t.toggleMuteTask.promise)},this.unmute=function(){return d.log("[OutOfBrowserCallHandler] unmute"),t.toggleMuteTask&&t.toggleMuteTask.promise.state()==="pending"?t.toggleMuteTask.promise:(t.toggleMuteTask=i.task(),t.outOfBrowserFacade.unmute(),t.toggleMuteTask.promise)},this.acknowledge=function(){return d.log("[OutOfBrowserCallHandler] acknowledge"),t.conversation.selfParticipant.audio.state()===o.callConnectionState.Disconnected?(d.log("[OutOfBrowserCallHandler] acknowledge, setting Notified state"),l.updateParticipantAudioVideoState(t.conversation.selfParticipant,o.callConnectionState.Notified),d.log("[OutOfBrowserCallHandler] acknowledge, call is connecting, updating payload"),t.outOfBrowserFacade.updateIncomingCallPayload(t.conversation)):(d.log("[OutOfBrowserCallHandler] acknowledge, call not yet accepted/rejected, ignore update"),Promise.resolve())},this.rejectCall=function(){return d.log("[OutOfBrowserCallHandler] rejectCall"),l.handleParticipantLeavingStateTransition(t.conversation.selfParticipant,o.callDisconnectionReason.Busy),l.handleRemoteParticipantsLeavingStateTransition(t.conversation.participants()),t.outOfBrowserFacade.reject(t.conversation)},this.sendDtmf=function(e){return Promise.reject(new Error("not implemented"))},this.transferFrom=function(e){return},this.conversation=e,this.outOfBrowserFacade=w()}return e.prototype.isPluginless=function(){return!1},e}();t.OutOfBrowserCallHandler=m,t.initialize=g,t.dispose=y,t.build=T}),define("jSkype/services/callHandlerFactory",["require","exports","module","swx-jskype-main/lib/services/calling/handlers/plugin/pluginCallingHandler","swx-jskype-main/lib/services/calling/handlers/pluginless/pluginlessCallingHandler","swx-jskype-main/lib/services/calling/handlers/shell/shellCallingHandler","swx-jskype-main/lib/services/calling/callingFacade","swx-util-calling-stack","swx-jskype-main/lib/services/plugin/pluginCallHandler","jSkype/services/swxWebCalling","swx-jskype-main/lib/services/outOfBrowser/outOfBrowserCallHandler","swx-enums"],function(e,t){var n=e("swx-jskype-main/lib/services/calling/handlers/plugin/pluginCallingHandler"),r=e("swx-jskype-main/lib/services/calling/handlers/pluginless/pluginlessCallingHandler"),i=e("swx-jskype-main/lib/services/calling/handlers/shell/shellCallingHandler"),s=e("swx-jskype-main/lib/services/calling/callingFacade"),o=e("swx-util-calling-stack"),u=e("swx-jskype-main/lib/services/plugin/pluginCallHandler"),a=e("jSkype/services/swxWebCalling").callHandler,f=e("swx-jskype-main/lib/services/outOfBrowser/outOfBrowserCallHandler"),l=e("swx-enums"),c;t.createCallHandler=function(t){var c,h;return t.audioService._canHandlePluginlessCall()?(t._callData.callTechnology(l.callTechnology.NGC),c=a.build(t),h=r):o.get().isInBrowserPluginSupported()?(c=u.build(t),h=n):(c=f.build(t),h=i),s.setCallingHandler(h),c},t.initialize=function(t){var l;return o.get().isPluginlessCallingSupported()?(c=a,l=r,r.initialize(t)):o.get().isInBrowserPluginSupported()?(c=u,l=n):(c=f,l=i),s.setCallingHandler(l),c.initialize()},t.dispose=function(){c&&c.dispose&&c.dispose()}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/mePersonAudioVideoCapabilities",["require","exports","swx-jskype-internal-application-instance","swx-browser-detect","jskype-settings-instance","swx-util-calling-stack","../../lib/telemetry/logging/callingLogTracer","swx-constants","../../lib/services/calling/environmentInspector","swx-enums","jcafe-property-model"],e)}(function(e,t){function p(){return new h}var n=e("swx-jskype-internal-application-instance"),r=e("swx-browser-detect"),i=e("jskype-settings-instance"),s=e("swx-util-calling-stack"),o=e("../../lib/telemetry/logging/callingLogTracer"),u=e("swx-constants"),a=e("../../lib/services/calling/environmentInspector"),f=e("swx-enums"),l=e("jcafe-property-model"),c=o.get(),h=function(){function e(){var e=this;this.isChrome=r["default"].getBrowserInfo().browserName===r["default"].BROWSERS.CHROME,this.isFirefox=r["default"].getBrowserInfo().browserName===r["default"].BROWSERS.FIREFOX,this.isElectron=r["default"].getBrowserInfo().browserName===r["default"].BROWSERS.ELECTRON,this.isLinux=r["default"].getSystemInfo().osName===r["default"].OPERATING_SYSTEMS.LINUX,this.isCallingFeatureFlagDisabled=!i.isFeatureOn(u.COMMON.featureFlags.CALLING),this.audioCapability=l.property({readOnly:!0,get:this.getAudioCapability.bind(this)}),this.videoCapability=l.property({readOnly:!0,get:this.getVideoCapability.bind(this)}),this.setup=function(){e.supportsAudioFeature()||e.supportsVideoFeature()?(a.isCallingSupported.changed(function(t,n){c.log("[MePerson] calling support changed",t,n),e.setAudioCapability(t,n),e.setVideoCapability(t,n)}),e.handleSelectCameraChange()):(e.audioCapability._set(!1,f.callingNotSupportedReasons.FeatureDisabled),e.videoCapability._set(!1,f.callingNotSupportedReasons.FeatureDisabled))}}return e.prototype.supportsAudioFeature=function(){return this.isCallingFeatureFlagDisabled?!1:this.isLinux?this.isChrome||this.isElectron?i.isFeatureOn(u.COMMON.featureFlags.PLUGINLESS_CALLING_CHROME_LINUX):!1:!0},e.prototype.supportsVideoFeature=function(){return this.isCallingFeatureFlagDisabled?!1:this.isFirefox?i.isFeatureOn(u.COMMON.featureFlags.PLUGINLESS_VIDEO_CALLING_FIREFOX):this.isLinux?this.isChrome||this.isElectron?i.isFeatureOn(u.COMMON.featureFlags.PLUGINLESS_VIDEO_CALLING_CHROME_LINUX):!1:!0},e.prototype.setAudioCapability=function(e,t){var n=e,r=t;this.supportsAudioFeature()||(n=!1,r=f.callingNotSupportedReasons.FeatureDisabled),c.log("[MePerson] set audio capability",n,r),this.audioCapability._set(n,r)},e.prototype.setVideoCapability=function(e,t){var r=e,i=t;if(s.get().isPluginlessCallingSupported()){var o=Boolean(n.get().devicesManager.selectedCamera());e&&!o&&(i=f.callingNotSupportedReasons.CameraUnavailable),r=e&&o}this.supportsVideoFeature()||(r=!1,i=f.callingNotSupportedReasons.FeatureDisabled),c.log("[MePerson] set video capability",r,i),this.videoCapability._set(r,i)},e.prototype.handleSelectCameraChange=function(){var e=this;s.get().isPluginlessCallingSupported()&&this.supportsVideoFeature()&&n.get().devicesManager.selectedCamera.changed(function(){e.setVideoCapability(a.isCallingSupported(),a.isCallingSupported.reason)})},e.prototype.isCameraAvailable=function(){return s.get().isPluginlessCallingSupported()?n.get().devicesManager.selectedCamera():!0},e.prototype.getAudioCapability=function(){var e=this;return this.supportsAudioFeature()?a.isCallingSupported.get().then(function(t){return e.setAudioCapability(t,a.isCallingSupported.reason),t}):(this.setAudioCapability(!1,f.callingNotSupportedReasons.FeatureDisabled),Promise.resolve(!1))},e.prototype.getVideoCapability=function(){var e=this;return this.supportsVideoFeature()?a.isCallingSupported.get().then(function(t){return e.setVideoCapability(t,a.isCallingSupported.reason),Boolean(t&&e.isCameraAvailable())}):(this.setVideoCapability(!1,f.callingNotSupportedReasons.FeatureDisabled),Promise.resolve(!1))},e}();t.MePersonAudioVideoCapabilities=h,t.build=p}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/trouter/handlers/incomingCallMessageHandler",["require","exports","swx-constants","../../../../lib/telemetry/logging/callingLogTracer","../../callController","jskype-settings-instance","../../../../lib/modelHelpers/propertyValidator","swx-constants","swx-mri"],e)}(function(e,t){function p(e,t){return{isHandled:e,resultCode:t}}function d(){return new h}var n=e("swx-constants"),r=e("../../../../lib/telemetry/logging/callingLogTracer"),i=e("../../callController"),s=e("jskype-settings-instance"),o=e("../../../../lib/modelHelpers/propertyValidator"),u=e("swx-constants"),a=e("swx-mri"),f=r.get(),l=n.COMMON.events.trouter,c=n.COMMON.httpStatusCodes,h=function(){function e(){var e=this;this.handleMessage=function(t){var n;f.log("Incoming trouter notification",t);if(!e.isSupportedNotification(t))return p(!1);if(e.isPSTNNotification(t)&&!e.isPSTNSupported())return f.log("Rejecting due to PSTN incoming calls not enabled"),p(!0,c.preconditionFailed);if(e.isValidP2PNotification(t)){n=e.buildP2PCallPayload(t);if(!n)return p(!0,c.unprocessableEntity)}if(e.isValidNGCNotification(t)&&e.isNGCSupported()){n=e.buildNGCCallPayload(t);if(!n)return p(!0,c.badRequest)}return n?(i.handleIncoming(n),p(!0,c.OK)):p(!0,c.unprocessableEntity)}}return e.prototype.isValidP2PNotification=function(e){return e.eventId===l.INCOMING_SKYPE_P2P_CALL},e.prototype.isValidNGCNotification=function(e){return e.eventId===l.INCOMING_SKYPE_NGC_CALL||e.eventId===l.INCOMING_SKYPE_NGC_GVC_CALL||e.eventId===l.INCOMING_LYNC_NGC_CALL||e.eventId===l.INCOMING_SKYPE_NGC_PSTN_CALL},e.prototype.isSupportedNotification=function(e){return this.isValidP2PNotification(e)||this.isValidNGCNotification(e)},e.prototype.isPSTNNotification=function(e){return o.isPhoneNumber(e.body.callerId)},e.prototype.isNGCSupported=function(){return s.isFeatureOn(u.COMMON.featureFlags.NG_CALLING)},e.prototype.isPSTNSupported=function(){return s.isFeatureOn(u.COMMON.featureFlags.PSTN_ENABLED)},e.prototype.buildP2PCallPayload=function(e){var t={evt:e.body.evt,callerId:e.body.callerId,displayName:e.body.displayName,conversationId:undefined,convoCallId:e.body.convoCallId,nsp:e.body.nsp,body:{gp:e.body.gp}},n=e.body.conversationId||e.body.callerId;return n?(t.conversationId=a.getKey(n),f.log("Incoming P2P payload",t),t):(f.log("Rejecting due to missing conversationId in payload"),null)},e.prototype.buildNGCCallPayload=function(e){var t;try{var n=atob(e.body.gp);t=JSON.parse(n)}catch(r){return f.error("Error when parsing gp payload",e.body.gp),null}if(t.callNotification){var i={conversationId:t.groupChat&&t.groupChat.threadId?t.groupChat.threadId:t.callNotification.from.id,callerId:a.getId(t.callNotification.from.id),convoCallId:t.debugContent.callId,ngcCall:!0,nsp:e.body.nsp||"",body:e.body,evt:e.body.evt};return f.log("Incoming NGC payload",i),i}return f.log("Unable to create incoming NGC payload"),null},e}();t.MessageHandler=h,t.build=d}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/trouter/handlers/stopRingingMessageHandler",["require","exports","../../../../lib/services/callRegister","../../../../lib/services/callController","swx-constants"],e)}(function(e,t){function a(){return new u}var n=e("../../../../lib/services/callRegister"),r=e("../../../../lib/services/callController"),i=e("swx-constants"),s=i.COMMON.events.trouter,o=i.COMMON.httpStatusCodes,u=function(){function e(){}return e.prototype.handleMessage=function(e){if(e.eventId!==s.INCOMING_STOP_RINGER&&e.eventId!==s.INCOMING_SKYPE_NGC_STOP_RINGER)return{isHandled:!1};if(!e.body.callId)return{isHandled:!1};var t=n.get().getConversationByCallId(e.body.callId);return t&&r.cancelCall(t),{isHandled:!0,resultCode:o.OK}},e}();t.MessageHandler=u,t.build=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/outOfBrowser/shellApp/pstnEventsDispatcher",["require","exports","swx-constants"],e)}(function(e,t){var n=e("swx-constants"),r=function(){function e(e){var t=this;this.process=function(e,r,i,s){t.messagingChannel.sendCommand({name:n.OUT_OF_BROWSER.commands.PSTN_EVENT,type:n.OUT_OF_BROWSER.commandTypes.REQUEST,data:{state:s,conversationId:e.conversationId,participantId:r.person.id(),reason:i}})},this.messagingChannel=e}return e}();t.__esModule=!0,t["default"]=r}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/outOfBrowser/shellApp/browserCommandHandler",["require","exports","jcafe-property-model","swx-constants","../../../../lib/telemetry/logging/callingLogTracer","../../../../lib/services/callController","../../../../lib/services/callRegister","../../../../lib/modelHelpers/calling/deviceHelper","../../../../lib/modelHelpers/calling/pstnEventsHandler","../../../../lib/services/outOfBrowser/shellApp/pstnEventsDispatcher","swx-jskype-internal-application-instance","jskype-settings-instance","../../../../lib/modelHelpers/calling/participantHelper","swx-enums","swx-constants","../../../../lib/services/outOfBrowser/extension","swx-browser-globals"],e)}(function(e,t){function b(e){return new y(e)}var n=e("jcafe-property-model"),r=e("swx-constants"),i=e("../../../../lib/telemetry/logging/callingLogTracer"),s=e("../../../../lib/services/callController"),o=e("../../../../lib/services/callRegister"),u=e("../../../../lib/modelHelpers/calling/deviceHelper"),a=e("../../../../lib/modelHelpers/calling/pstnEventsHandler"),f=e("../../../../lib/services/outOfBrowser/shellApp/pstnEventsDispatcher"),l=e("swx-jskype-internal-application-instance"),c=e("jskype-settings-instance"),h=e("../../../../lib/modelHelpers/calling/participantHelper"),p=e("swx-enums"),d=e("swx-constants"),v=e("../../../../lib/services/outOfBrowser/extension"),m=e("swx-browser-globals"),g=i.get(),y=function(){function e(e){var t=this;this.isPstnEnabled=c.isFeatureOn(d.COMMON.featureFlags.PSTN_ENABLED),this.handlers={show:this.showHandler.bind(this),hide:this.hideHandler.bind(this),start:this.startHandler.bind(this),joinCall:this.joinCallHandler.bind(this),accept:this.acceptHandler.bind(this),updateIncomingCallPayload:this.updateIncomingCallPayload.bind(this),mute:this.createMuteHandler(!0),unmute:this.createMuteHandler(!1),stop:this.stopHandler.bind(this),reject:this.rejectHandler.bind(this),callInfo:this.callInfoHandler.bind(this),contactsData:this.contactsDataHandler.bind(this),topicUpdate:this.topicUpdateHandler.bind(this),syncParticipants:this.syncParticipantsHandler.bind(this),participantAuthorize:this.participantAuthorizeHandler.bind(this),settings:this.settingsHandler.bind(this)},this.onShellAppClosing=function(){var e=o.get().activeCalls(),n=!1;return e.length===0&&(n=!0),t.clearContactsPolling(),e.forEach(function(e){e.selfParticipant.audio.state()===p.callConnectionState.Disconnected?n=!0:e.audioService.stop()}),n},this.messagingChannel=e,this.pstnEventHandler=a.build(new f["default"](e)),e.registerCommandHandler(r.OUT_OF_BROWSER.commands.SHOW,this.handlers.show),e.registerCommandHandler(r.OUT_OF_BROWSER.commands.HIDE,this.handlers.hide),e.registerCommandHandler(r.OUT_OF_BROWSER.commands.START,this.handlers.start),e.registerCommandHandler(r.OUT_OF_BROWSER.commands.JOIN_CALL,this.handlers.joinCall),e.registerCommandHandler(r.OUT_OF_BROWSER.commands.ACCEPT,this.handlers.accept),e.registerCommandHandler(r.OUT_OF_BROWSER.commands.UPDATE_INCOMING_PAYLOAD,this.handlers.updateIncomingCallPayload),e.registerCommandHandler(r.OUT_OF_BROWSER.commands.MUTE,this.handlers.mute),e.registerCommandHandler(r.OUT_OF_BROWSER.commands.UNMUTE,this.handlers.unmute),e.registerCommandHandler(r.OUT_OF_BROWSER.commands.STOP,this.handlers.stop),e.registerCommandHandler(r.OUT_OF_BROWSER.commands.REJECT,this.handlers.reject),e.registerCommandHandler(r.OUT_OF_BROWSER.commands.CALL_INFO,this.handlers.callInfo),e.registerCommandHandler(r.OUT_OF_BROWSER.commands.CONTACTS_DATA_RESPONSE,this.handlers.contactsData),e.registerCommandHandler(r.OUT_OF_BROWSER.commands.TOPIC_UPDATE,this.handlers.topicUpdate),e.registerCommandHandler(r.OUT_OF_BROWSER.commands.SYNC_PARTICIPANTS,this.handlers.syncParticipants),e.registerCommandHandler(r.OUT_OF_BROWSER.commands.PARTICIPANT_AUTHORIZE,this.handlers.participantAuthorize),e.registerCommandHandler(r.OUT_OF_BROWSER.commands.SETTINGS_UPDATE,this.handlers.settings)}return e.prototype.topicUpdateHandler=function(e){var t=this;return this.waitForConversationSync().then(function(){if(e.conversationId&&e.topic){var n=t.getConversation(e.conversationId);n.topic._set(e.topic)}})},e.prototype.syncParticipantsHandler=function(e){var t=this;return this.waitForConversationSync().then(function(){if(e.conversationId&&e.participantsData)try{var n=t.getConversation(e.conversationId),r=n.participants().filter(function(t){return e.participantsData.indexOf(t.person.id())<0});r.forEach(function(e){n._removeParticipant(e.person)})}catch(i){g.warn("Unable to sync participants")}})},e.prototype.participantAuthorizeHandler=function(e){var t=this;return this.waitForConversationSync().then(function(){var n=t.getConversation(e.conversationId);n.participants()[0].person._authorization._set(e.authorized)})},e.prototype.contactsDataHandler=function(e){return e.contactsData&&l.get().personsAndGroupsManager.all.persons().forEach(function(t){try{e.contactsData[t.id()]&&t.status._set(e.contactsData[t.id()].status)}catch(n){g.warn("Unable to apply contact data")}}),this.isContactsDataPollingEnabled&&(this.contactsDataPollInterval=m.getWindow().setTimeout(this.pollForContats.bind(this),c.settings.shellApp.contactPollingInterval)),Promise.resolve()},e.prototype.clearContactsPolling=function(){this.contactsDataPollInterval&&m.getWindow().clearTimeout(this.contactsDataPollInterval),this.contactsDataPollInterval=null,this.isContactsDataPollingEnabled=!1},e.prototype.pollForContats=function(){this.messagingChannel.sendCommand({name:r.OUT_OF_BROWSER.commands.CONTACTS_DATA_REQUEST,type:r.OUT_OF_BROWSER.commandTypes.REQUEST})},e.prototype.showHandler=function(e){var t=this;l.get()._telemetryManager.setCommonProperty("shellAppHost",e.shellAppHost);var n=function(){g.log("[BrowserCommandHelper] creating hidePromise"),s.shellAppInfo.hidePromise=(new Promise(function(e,t){if(s.shellAppInfo.hidePromise||s.shellAppInfo.hidePromiseResolve){t("Previous shellApp visibility session is not resolved");return}s.shellAppInfo.hidePromiseResolve=e,s.setTimeout(i,100)})).then(function(){s.shellAppInfo.hidePromise=null,s.shellAppInfo.hidePromiseResolve=null,g.log("[BrowserCommandHelper] hidePromise resolved")})},i=function(){var e=c.isFeatureOn(d.COMMON.featureFlags.CALLING_FULL_SCREEN_ENABLED)?1:v.extensionConstants.SHELL_APP_SIZE_FACTOR,n={width:s.screen.width/e,height:s.screen.height/e},i=s.shellApp;i.invoke(r.OUT_OF_BROWSER.shellAppMethods.ShowWindow,n),i.addEventListener(r.OUT_OF_BROWSER.shellAppEvents.WindowClosing,t.onShellAppClosing),c.isFeatureOn(d.COMMON.featureFlags.GVC_LOCAL_ESCALATION)&&(t.isContactsDataPollingEnabled=!0,t.pollForContats())},s=m.getWindow();return s.shellAppInfo.hidePromise?s.shellAppInfo.hidePromise.then(n):(n(),Promise.resolve())},e.prototype.hideHandler=function(){var e=m.getWindow();return e.shellApp.removeEventListener(r.OUT_OF_BROWSER.shellAppEvents.WindowClosing,this.onShellAppClosing),e.shellApp.invoke(r.OUT_OF_BROWSER.shellAppMethods.HideWindow),this.clearContactsPolling(),n.task().resolve().promise},e.prototype.joinCallHandler=function(e){var t=this;return this.waitForConversationSync().then(function(){var n=t.getConversation(e.conversationId);return e.joinCall?n._setCanJoinCall(!0,e.callHostId,{AccessToken:e.accessToken}):n._setCanJoinCall(!1),n._autoCallingService.shellAppCanJoin(!0),Promise.resolve()})},e.prototype.startHandler=function(e){var t=this;return g.log("[BrowserCommandHelper] startHandler",e),this.waitForConversationSync().then(function(){g.log("[BrowserCommandHelper] startHandler, conversation synced",e.conversationId);var n=t.getConversation(e.conversationId),r=t.getCallingService(n,e.withVideo);return t.isPstnEnabled&&t.isOneToOnePstnConversation(e,n)&&n.participants(0).audio.endpoint(e.endpoint),h.updateParticipantsAudioVideoState(n,p.callConnectionState.Disconnected),t.pstnEventHandler.subscribeToConversation(n),e.autoCall?n._autoCallingService.setupAutoCalling(e.autoCallMode,e.autoCallPartnerId,e.autoCallId):e.joinCall?n._setCanJoinCall(!0,e.callHostId,{AccessToken:e.accessToken}):n._setCanJoinCall(!1),t.subscribeToConversationStates(n),r.start()})},e.prototype.acceptHandler=function(e){var t=this;return g.log("[BrowserCommandHelper] acceptHandler",e),this.waitForConversationSync().then(function(){var r=t.getConversation(e.conversationId),i=t.getCallingService(r,e.withVideo),o=n.task(),u,a;g.log("[BrowserCommandHelper] acceptHandler, conversation synced",e.conversationId);var f=function(){i.accept(),o.resolve()},l=function(e){e!==p.callDisconnectionReason.CallEscalated&&t.closeShellApp()},c=function(e,t,n){n&&e===p.callConnectionState.Disconnected&&(o.promise.state()==="pending"&&(o.reject(t),l(t)),u&&u.dispose(),a&&a.dispose())};return t.subscribeToConversationStates(r),e.incomingCallData.length||g.log("[BrowserCommandHandler] acceptHandler, incoming call payload already processed"),u=r.selfParticipant.audio.state.once(p.callConnectionState.Notified,f),a=r.selfParticipant.audio.state.changed(c),e.incomingCallData.forEach(function(e){s.handleIncoming(e)["catch"](o.reject.bind(o))}),o.promise})},e.prototype.updateIncomingCallPayload=function(e){return this.waitForConversationSync().then(function(){return e.incomingCallData.forEach(function(e){s.handleIncoming(e)}),Promise.resolve()})},e.prototype.createMuteHandler=function(e){var t=this;return function(n){var r=t.getConversation(n.conversationId);return r.selfParticipant.audio.isMuted.set(e)}},e.prototype.closeShellApp=function(){var e=m.getWindow();this.clearContactsPolling(),e.shellAppInfo.supportsPreloading?e.shellApp.invoke(r.OUT_OF_BROWSER.shellAppMethods.HideWindow):e.shellApp.invoke(r.OUT_OF_BROWSER.shellAppMethods.CloseWindow)},e.prototype.stopHandler=function(e){var t=m.getWindow();t.shellApp.removeEventListener(r.OUT_OF_BROWSER.shellAppEvents.WindowClosing,this.onShellAppClosing);var n=this.getConversation(e.conversationId);return this.pstnEventHandler.dispose(),n.audioService.stop()},e.prototype.rejectHandler=function(e){var t=this.getConversation(e.conversationId);return t._callHandler.rejectCall()},e.prototype.callInfoHandler=function(e){var t=this.getConversation(e.conversationId);return t._callHandler?t._callHandler.requestCallInfo():Promise.reject(undefined)},e.prototype.waitForConversationSync=function(){return l.get().conversationsManager._conversationsSynced.promise},e.prototype.isOneToOnePstnConversation=function(e,t){return e.endpoint&&e.endpoint!==t.conversationId&&!t.isGroupConversation()},e.prototype.subscribeToConversationStates=function(e){var t=this,n=[],i=function(n,i,s,o){if(!o)return;t.messagingChannel.sendCommand({name:r.OUT_OF_BROWSER.commands.UPDATE_PARTICIPANT_STATE,type:r.OUT_OF_BROWSER.commandTypes.REQUEST,data:{state:i,conversationId:e.conversationId,personId:n,reason:s}})},s=function(e){n.push(e.audio.state.changed(i.bind(null,e.person.id())))},o=function(i,h,d){if(!d)return;if(i===p.callConnectionState.Notified)return;i===p.callConnectionState.Disconnecting&&l.get().devicesManager._initializedDevices&&(u.isSpeakerAvailable()?u.isMicrophoneAvailable()||(h=p.callDisconnectionReason.MissingMicrophone):h=p.callDisconnectionReason.MissingSpeaker),i===p.callConnectionState.Disconnected&&(e.selfParticipant.audio.state.changed.off(o),e.selfParticipant.audio.isMuted.changed.off(a),e.spawnedConversation.changed.off(f),e._callData.pluginCallInfo.changed.off(c),n.forEach(function(e){e.dispose()}),e.participants.added.off(s));if(h===p.callDisconnectionReason.CallEscalated)return;t.messagingChannel.sendCommand({name:r.OUT_OF_BROWSER.commands.CHANGE_STATE,type:r.OUT_OF_BROWSER.commandTypes.REQUEST,data:{state:i,conversationId:e.conversationId,reason:h}})},a=function(n){var i;if(n===undefined)return;n?i=r.OUT_OF_BROWSER.commands.MUTE:i=r.OUT_OF_BROWSER.commands.UNMUTE,t.messagingChannel.sendCommand({name:i,type:r.OUT_OF_BROWSER.commandTypes.REQUEST,data:{conversationId:e.conversationId}})},f=function(n){t.messagingChannel.sendCommand({name:r.OUT_OF_BROWSER.commands.ESCALATE_CONVERSATION,type:r.OUT_OF_BROWSER.commandTypes.REQUEST,data:{newConversationId:n.conversationId,oldConversationId:e.conversationId}}),t.subscribeToConversationStates(n)},c=function(){t.messagingChannel.sendCommand({name:r.OUT_OF_BROWSER.commands.CALL_INFO,type:r.OUT_OF_BROWSER.commandTypes.REQUEST,data:{conversationId:e.conversationId,messageBody:e._callData.pluginCallInfo()}})};e.selfParticipant.audio.state.changed(o),e.participants.added(s),e.selfParticipant.audio.isMuted.changed(a),e.spawnedConversation.changed(f),e._callData.pluginCallInfo.changed(c)},e.prototype.getConversation=function(e){var t=l.get().conversationsManager._getOrCreateConversation(e);return l.get().conversationsManager.conversations.add(t),t},e.prototype.getCallingService=function(e,t){var n;return t?n=e.videoService:n=e.audioService,n},e.prototype.settingsHandler=function(e){var t=e.settingsType,n=e.value;l.get().personsAndGroupsManager.mePerson.preferences(t).value.set(n)},e}();t.BrowserCommandHandler=y,t.build=b}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/outOfBrowser/shellApp/messagingChannel",["require","exports","swx-constants"],e)}(function(e,t){function i(){return new r}var n=e("swx-constants"),r=function(){function e(){var e=this;this.commandHandlers={},this.sendCommand=function(e){window.shellApp.invoke(n.OUT_OF_BROWSER.shellAppMethods.PostMessage,{message:e})},this.registerCommandHandler=function(t,n){e.commandHandlers[t]=n},window.shellApp.addEventListener(n.OUT_OF_BROWSER.shellAppEvents.MessageReceived,this.onShellAppMessageEvent.bind(this))}return e.prototype.onShellAppMessageEvent=function(e){var t=this,r=e.data;if(r.type===n.OUT_OF_BROWSER.commandTypes.REQUEST){var i={name:r.name,type:n.OUT_OF_BROWSER.commandTypes.RESPONSE},s=function(){t.sendCommand(i)},o=function(e){i.error=e,t.sendCommand(i)},u=void 0;try{var a=this.commandHandlers[r.name];u=Promise.resolve(a(r.data))}catch(f){u=Promise.reject(f)}u.then(s,o)}},e}();t.MessagingChannel=r,t.build=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/outOfBrowser/shellApp/shellAppLogs",["require","exports","jskype-settings-instance","swx-constants","swx-constants","swx-browser-globals"],e)}(function(e,t){function o(e){var t=s.getWindow();if(!n.isFeatureOn(r.COMMON.featureFlags.SHELL_APP_LOGS))return;var o=["log","warn","info","error"];o.forEach(function(n){var r=t.console;t.console&&r[n]&&(r[n]=function(){try{var r={name:i.OUT_OF_BROWSER.commands.SHELL_APP_LOG,type:i.OUT_OF_BROWSER.commandTypes.REQUEST,data:{logs:t.btoa(JSON.stringify(Array.prototype.slice.call(arguments))),method:n}};e.sendCommand(r)}catch(s){}})})}var n=e("jskype-settings-instance"),r=e("swx-constants"),i=e("swx-constants"),s=e("swx-browser-globals");t.intercept=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/outOfBrowser/shellApp/shellAppExperience",["require","exports","../../../../lib/services/outOfBrowser/shellApp/browserCommandHandler","../../../../lib/services/outOfBrowser/shellApp/messagingChannel","../../../../lib/services/outOfBrowser/shellApp/shellAppLogs","swx-constants"],e)}(function(e,t){function o(){function t(t,n,r){var i={name:t,type:n};r&&(i.data=r),e.sendCommand(i)}var e=r.build();return n.build(e),i.intercept(e),t(s.OUT_OF_BROWSER.commands.INIT,s.OUT_OF_BROWSER.commandTypes.RESPONSE),{sendPluginErrorCommand:function(e){t(s.OUT_OF_BROWSER.commands.PLUGIN_ERROR,s.OUT_OF_BROWSER.commandTypes.REQUEST,e)}}}var n=e("../../../../lib/services/outOfBrowser/shellApp/browserCommandHandler"),r=e("../../../../lib/services/outOfBrowser/shellApp/messagingChannel"),i=e("../../../../lib/services/outOfBrowser/shellApp/shellAppLogs"),s=e("swx-constants");t.init=o}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/models/deviceCache",["require","exports","../../lib/services/cache/instance","jskype-constants","../../lib/services/callRegister","swx-constants"],e)}(function(e,t){function f(e){return o.CALLING_DEVICES+"."+e}function l(e,t){function n(e,t){e&&e(t,s.CALLING.DEVICE_SELECTION_REASON.CACHE)}switch(e){case s.CALLING.DEVICE_TYPE.CAMERA:n(a.selectedCamera,t);break;case s.CALLING.DEVICE_TYPE.MICROPHONE:n(a.selectedMicrophone,t);break;case s.CALLING.DEVICE_TYPE.SPEAKER:n(a.selectedSpeaker,t)}}function c(e){return n.get().getItem(f(e))}function h(e,t){n.get().setItem(f(e),t)}function p(e,t){i.get().hasConnectedCall()||c(e).then(function(n){return n&&n===t.id()&&l(e,t),1})}function d(e,t,n){t&&n===s.CALLING.DEVICE_SELECTION_REASON.USER&&h(e,t.id())}function v(e){a=e,u.push(a.cameras.added(p.bind(null,s.CALLING.DEVICE_TYPE.CAMERA))),u.push(a.microphones.added(p.bind(null,s.CALLING.DEVICE_TYPE.MICROPHONE))),u.push(a.speakers.added(p.bind(null,s.CALLING.DEVICE_TYPE.SPEAKER))),u.push(a.selectedCamera.changed(d.bind(null,s.CALLING.DEVICE_TYPE.CAMERA))),u.push(a.selectedMicrophone.changed(d.bind(null,s.CALLING.DEVICE_TYPE.MICROPHONE))),u.push(a.selectedSpeaker.changed(d.bind(null,s.CALLING.DEVICE_TYPE.SPEAKER)))}function m(){u.forEach(function(e){e.dispose()}),u=[]}var n=e("../../lib/services/cache/instance"),r=e("jskype-constants"),i=e("../../lib/services/callRegister"),s=e("swx-constants"),o=r.DATA.storageKeys,u=[],a;t.initialize=v,t.dispose=m}),define("jSkype/services/calling/callingInitializer",["require","exports","module","swx-jskype-internal-application-instance","swx-browser-detect","swx-util-calling-stack","jskype-settings-instance","jSkype/services/callHandlerFactory","swx-jskype-main/lib/services/callController","swx-jskype-main/lib/services/calling/environmentInspector","swx-jskype-main/lib/models/mePersonAudioVideoCapabilities","swx-enums","swx-jskype-main/lib/services/trouter/handlers/incomingCallMessageHandler","jSkype/services/swxWebCalling","swx-constants","swx-jskype-main/lib/services/trouter/handlers/stopRingingMessageHandler","swx-jskype-main/lib/services/outOfBrowser/shellApp/shellAppExperience","swx-jskype-main/lib/services/trouter/trouter","swx-jskype-main/lib/models/deviceCache"],function(e,t){var n=e("swx-jskype-internal-application-instance"),r=e("swx-browser-detect").default,i=e("swx-util-calling-stack"),s=e("jskype-settings-instance"),o=e("jSkype/services/callHandlerFactory"),u=e("swx-jskype-main/lib/services/callController"),a=e("swx-jskype-main/lib/services/calling/environmentInspector"),f=e("swx-jskype-main/lib/models/mePersonAudioVideoCapabilities"),l=e("swx-enums"),c=e("swx-jskype-main/lib/services/trouter/handlers/incomingCallMessageHandler"),h=e("jSkype/services/swxWebCalling"),p=e("swx-constants").PLUGIN_CONST,d=e("swx-jskype-main/lib/services/trouter/handlers/stopRingingMessageHandler"),v=e("swx-jskype-main/lib/services/outOfBrowser/shellApp/shellAppExperience"),m=e("swx-jskype-main/lib/services/trouter/trouter"),g=e("swx-jskype-main/lib/models/deviceCache");t.initialize=function(t){function b(e){if(!e)return;n.get().conversationsManager._conversationsSynced.promise.then(function(){o.initialize(h.getMediaAgent())}).then(function(){g.initialize(n.get().devicesManager)},function(e){e===p.PLUGIN_ERRORS.REASON_ALREADY_EXISTS&&a.disableCalling(l.callingNotSupportedReasons.PluginAlreadyRunning),r.getBrowserInfo().isShellApp&&y.sendPluginErrorCommand(e)})}var y;return u.initialize(o),i.get().initInfo().then(function(){i.get().isPluginlessCallingSupported()&&h.initialize(t),r.getBrowserInfo().isShellApp&&(y=v.init()),s.settings.isPollingEnabled&&m.initialize().then(function(e){e.registerMessageHandler(c.build()),e.registerMessageHandler(d.build()),e.start()}),n.get().personsAndGroupsManager.mePerson._addCallingCapabilities(f.build()),i.get().isPluginlessCallingSupported()&&n.get().devicesManager.selectedSpeaker.set.enabled._set(!1)}).then(function(){return a.checkForCallingSupport(!1)}).then(b)},t.destroy=function(){s.settings.isPollingEnabled&&m.stop(),o.dispose(),g.dispose()}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/keyEncryption/keyEncryption",["require","exports","../../../lib/services/serviceAccessLayer/decorations/reporting","../../../lib/services/optionsBuilder","swx-xhr-dispatcher","jskype-settings-instance","swx-constants"],e)}(function(e,t){var n=e("../../../lib/services/serviceAccessLayer/decorations/reporting"),r=e("../../../lib/services/optionsBuilder"),i=e("swx-xhr-dispatcher"),s=e("jskype-settings-instance"),o=e("swx-constants"),u=function(){function e(){var e=this;this.isVersion2=s.isFeatureOn(o.COMMON.featureFlags.KEY_ENCRYPTION_SERVICE_V2_ENABLED),this.serviceName="KES_"+(this.isVersion2?"V2_":"V1_"),this.keyEncryptionServiceHost=this.isVersion2?s.settings.keyEncryptionServiceHostV2:s.settings.keyEncryptionServiceHost,this.xhrDispatcher=i.build({host:this.keyEncryptionServiceHost,decorations:[n]}),this.decrypt=function(t){return e.buildOptions("decrypt",t).then(function(t){return e.xhrDispatcher.post("/key",t)})},this.encrypt=function(e){var t=this;return this.buildOptions("encrypt",e).then(function(e){return t.xhrDispatcher.post("/newkey",e)})}}return e.build=function(){return new e},e.prototype.buildOptions=function(e,t){var n=new r["default"];return n.setServiceName(this.serviceName+e),n.setOption("payload",JSON.stringify(t)),n.build()},e}();return u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/preferences/localStorageProvider",["require","exports","../../../lib/services/cache/instance"],e)}(function(e,t){function i(e){return new r(e)}var n=e("../../../lib/services/cache/instance"),r=function(){function e(e){this.keyName=e}return e.prototype.read=function(){return n.get().getSensitiveItem(this.keyName)},e.prototype.update=function(e){return n.get().setSensitiveItem(this.keyName,e,0)},e}();t.LocalStorageProvider=r,t.build=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-abch-user-web-service/lib/userWebService",["require","exports","lodash-compat","swx-xhr-dispatcher"],e)}(function(e,t){function i(e,i){function o(t){return e().then(function(e){return{headers:{Accept:r.contentTypes.JSON_V1_0,"X-SerializeAs":"purejson","X-Skypetoken":e,"X-AppId":i.appId},reporting:{serviceName:t}}})}function u(){return o("peopleServiceGetSettings").then(function(e){return s.get(t.SettingsEndpoint,e)})}function a(e){return o("peopleServiceSetSettings").then(function(r){return s.post(t.SettingsEndpoint,n.merge(r,{payload:JSON.stringify({Settings:[{Name:"Skype.AutoBuddy",Value:!!e}]})}))})}var s=r.build(i);return{getSettings:u,setSettings:a}}var n=e("lodash-compat"),r=e("swx-xhr-dispatcher");t.SettingsEndpoint="people/account/settings",t.build=i}),define("swx-abch-user-web-service",["swx-abch-user-web-service/lib/userWebService"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/ABCHUser/instance",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","../serviceAccessLayer/decorations/reporting","swx-abch-user-web-service"],e)}(function(e,t){function u(){var e=r.settings.abchUserWebService,t;return o||(t=n.get().signInManager._skypeToken,o=s.build(t,{host:e.host,appId:e.appId,decorations:[i]})),o}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("../serviceAccessLayer/decorations/reporting"),s=e("swx-abch-user-web-service"),o;t.get=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/preferences/autoBuddyProvider",["require","exports","../../../lib/services/ABCHUser/instance","../../../lib/modelHelpers/contacts/dataHandlers/factory"],e)}(function(e,t){function s(){return new i}var n=e("../../../lib/services/ABCHUser/instance"),r=e("../../../lib/modelHelpers/contacts/dataHandlers/factory"),i=function(){function e(){}return e.prototype.read=function(){var e=r.getPeopleSettingsHandlers();return n.get().getSettings().then(e.onSuccess,e.onError)},e.prototype.update=function(e){return n.get().setSettings(e)},e}();t.AutoBuddyProvider=i,t.build=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-abch-profile-web-service/lib/abchProfileService",["require","exports","lodash-compat","swx-xhr-dispatcher"],e)}(function(e,t){function i(e,t){function u(n){return e().then(function(e){return{headers:{Accept:r.contentTypes.JSON_V1_0,"X-Skypetoken":e,"PS-ApplicationId":t.appId},reporting:{serviceName:n}}})}function a(e,t){var n={Attributes:[{Name:"PersonalContactProfile.Phones",Add:null,Edit:null,Delete:null}]};return n.Attributes[0][e]=[t],JSON.stringify(n)}function f(){return u("profileServiceGetProfile").then(function(e){return i.get(s,e)})}function l(e){return u("profileServiceUpdatePhoneNumber").then(function(t){return i.post(s,n.merge(t,{payload:a("Edit",{Name:e.number,Searchable:e.isSearchable,Country:e.cc}),headers:o}))})}function c(e){return u("profileServiceDeletePhoneNumber").then(function(t){return i.post(s,n.merge(t,{payload:a("Delete",{Name:e.number,Country:e.cc}),headers:o}))})}var i=r.build(t),s="profile/mine/System.ShortCircuitProfile.json",o={"Content-Type":"application"};return{getProfile:f,updatePhoneNumber:l,deletePhoneNumber:c}}var n=e("lodash-compat"),r=e("swx-xhr-dispatcher");t.build=i}),define("swx-abch-profile-web-service",["swx-abch-profile-web-service/lib/abchProfileService"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/ABCHProfile/instance",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","../serviceAccessLayer/decorations/reporting","swx-abch-profile-web-service"],e)}(function(e,t){function u(){var e=r.settings.profileService,t;return o||(t=n.get().signInManager._skypeToken,o=s.build(t,{host:e.host,appId:e.appId,decorations:[i]})),o}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("../serviceAccessLayer/decorations/reporting"),s=e("swx-abch-profile-web-service"),o;t.get=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/telemetry/preferences",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","swx-constants","lodash-compat"],e)}(function(e,t){function o(e,t,n,r){var o={};return s.isObject(t)&&(t=Object.prototype.toString.call(t)),o[i.COMMON.telemetry.userSettings.property.ITEM_NAME]=(e==null?i.COMMON.telemetry.userSettings.UNKNOWN:e).toString(),o[i.COMMON.telemetry.userSettings.property.ITEM_VALUE]=(t==null?i.COMMON.telemetry.userSettings.UNKNOWN:t).toString(),o[i.COMMON.telemetry.userSettings.property.OPERATION_DURATION]=isNaN(parseInt(r))?i.COMMON.telemetry.userSettings.UNKNOWN:r,o[i.COMMON.telemetry.userSettings.property.OPERATION_OUTCOME]=n?i.COMMON.telemetry.userSettings.outcomeNames.SUCCESS:i.COMMON.telemetry.userSettings.outcomeNames.FAILURE,o}function u(e,t,s,u){var a=o(e,t,s,u);n.get()._telemetryManager.sendEvent(r.settings.telemetry.jSkypeTenantToken,i.COMMON.telemetry.userSettings.eventName.PREFERENCE_FETCHED,a)}function a(e,t,s,u){var a=o(e,t,s,u);n.get()._telemetryManager.sendEvent(r.settings.telemetry.jSkypeTenantToken,i.COMMON.telemetry.userSettings.eventName.PREFERENCE_CHANGED,a);if(e===i.COMMON.userSettings.preferences.DARK_THEME&&s){var f=i.COMMON.telemetry.themeEvent,l=t?f.theme.DARK:f.theme.DEFAULT;n.get()._telemetryManager.setCommonProperty(f.TYPE,l)}}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("swx-constants"),s=e("lodash-compat");t.fetchPreference=u,t.changePreference=a}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/utils/preferences/preference",["require","exports","../../telemetry/preferences","swx-enums","jskype-settings-instance","swx-constants","jcafe-property-model","swx-utils-common"],e)}(function(e,t){function l(e){return new f(e)}var n=e("../../telemetry/preferences"),r=e("swx-enums"),i=e("jskype-settings-instance"),s=e("swx-constants"),o=e("jcafe-property-model"),u=e("swx-utils-common"),a=r.preferenceValueState,f=function(){function e(e){this.state=o.property({readOnly:!0,value:a.Unknown}),this.params=e,this.id=e.id,this.preferenceType=e.type,this.provider=e.provider,this.defaultValue=e.defaultValue,this.telemetryName=e.telemetryName||e.id,this.areUserSettingsEnabled()||this.state._set(a.Unset),this.description={id:this.id,type:this.preferenceType};var t=o.command(this.getPreference.bind(this),o.property({value:!e.getDisabled}));this.value=o.property({readOnly:!this.areUserSettingsEnabled(),value:this.defaultValue,get:this.areUserSettingsEnabled()?t:undefined,set:this.areUserSettingsEnabled()?this.setPreference.bind(this):undefined}),this.value.state=this.state}return e.prototype.getPreference=function(){var e=this,t=u.stopwatch.build();return this.provider.read().then(function(n){var r=e.defaultValue;return n===null?e.state._set(a.Unset):(e.state._set(a.Defined),r=n),e.sendTelemetryOnGet(r,!0,t),r})["catch"](function(){var n=e.value();return e.state._set(a.Unset),e.sendTelemetryOnGet(n,!1,t),n})},e.prototype.setPreference=function(e){var t=this,n=u.stopwatch.build();return this.setValuePromise?this.setValuePromise:(this.state._set(a.Saving),this.setValuePromise=Promise.resolve(this.provider.update(e)).then(function(){return t.state._set(a.Defined),t.sendTelemetryOnSet(e,!0,n),t.setValuePromise=null,e})["catch"](function(){return t.state._set(a.Unset),t.sendTelemetryOnSet(e,!1,n),t.setValuePromise=null,e}),this.setValuePromise)},e.prototype.areUserSettingsEnabled=function(){return i.isFeatureOn(s.COMMON.featureFlags.USER_SETTINGS_ENABLED)},e.prototype.sendTelemetryOnGet=function(e,t,r){this.params.disableReporting||n.fetchPreference(this.telemetryName,e,t,r.duration())},e.prototype.sendTelemetryOnSet=function(e,t,r){this.params.disableReporting||n.changePreference(this.telemetryName,e,t,r.duration())},e}();t.Preference=f,t.build=l}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/preferences/proofProvider",["require","exports","../../../lib/services/ABCHProfile/instance","../../../lib/modelHelpers/contacts/dataHandlers/factory"],e)}(function(e,t){function s(e){return new i(e)}var n=e("../../../lib/services/ABCHProfile/instance"),r=e("../../../lib/modelHelpers/contacts/dataHandlers/factory"),i=function(){function e(e){var t=this;this.read=function(){return Promise.resolve(t.creationParams.isSearchable)},this.update=function(e){var i=r.getProfilePhoneNumberUpdateHandlers(),s=n.get();return e===null?s.deletePhoneNumber(t.creationParams).then(i.onSuccess,i.onError):(t.creationParams.isSearchable=e,s.updatePhoneNumber(t.creationParams).then(i.onSuccess,i.onError))},this.creationParams=e}return e}();t.ProofProvider=i,t.build=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/preferences/profileServiceProvider",["require","exports","lodash-compat","swx-enums","../../../lib/services/ABCHProfile/instance","swx-constants","../../../lib/utils/preferences/preference","../../../lib/services/preferences/proofProvider","../../../lib/modelHelpers/contacts/dataHandlers/factory"],e)}(function(e,t){function f(e){return e===s.COMMON.proofTypes.EMAIL?r.preferenceType.AutoBuddyDiscoveryEmail:e===s.COMMON.proofTypes.PHONE?r.preferenceType.AutoBuddyDiscoveryPhone:r.preferenceType.Boolean}function c(){return new l}var n=e("lodash-compat"),r=e("swx-enums"),i=e("../../../lib/services/ABCHProfile/instance"),s=e("swx-constants"),o=e("../../../lib/utils/preferences/preference"),u=e("../../../lib/services/preferences/proofProvider"),a=e("../../../lib/modelHelpers/contacts/dataHandlers/factory"),l=function(){function e(){}return e.prototype.read=function(){var e=a.getABCHProfileServiceHandlers();return i.get().getProfile().then(e.onSuccess,e.onError).then(function(e){return n.map(e,function(e){var t=f(e.type);return o.build({id:s.COMMON.userSettings.preferences.DYNAMIC_DISCOVERY+"-"+e.value,type:t,provider:u.build(e),defaultValue:!1,telemetryName:s.COMMON.userSettings.preferences.DYNAMIC_DISCOVERY+"-"+t})})})},e}();t.ProfileServiceProvider=l,t.build=c}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-flags-service-api/lib/flagsService",["require","exports","lodash-compat","reqwest","swx-browser-globals"],e)}(function(e,t){function u(e,t,n,r){var s=i.getWindow();return{dataType:"json",method:e,url:r.replace(/\/$/,"")+"/"+n,crossOrigin:!0,headers:{"X-Skypetoken":s.encodeURIComponent(t)}}}function a(e,t,n,i){return Promise.resolve(r.compat(u(e,t,n,i)))}function f(e){return new o(e)}var n=e("lodash-compat"),r=e("reqwest"),i=e("swx-browser-globals"),s=1e3,o=function(){function e(e){this.$unit={_resetGlobalState:this._resetGlobalState.bind(this)},this.apiUrl=e,this._resetGlobalState()}return e.prototype.read=function(e,t){return this.getAllFlags(t).then(function(t){return n.includes(t,e)})},e.prototype.update=function(e,t,n){var r=i.getWindow();return a(t?"PUT":"DELETE",n,r.encodeURIComponent(e.toString()),this.apiUrl)["catch"](function(e){if(e&&e.status&&e.status===404)return;throw e})},e.prototype._resetGlobalState=function(){var e=this;this.getAllFlags=n.throttle(function(t){return a("GET",t,"",e.apiUrl)},s,{trailing:!1})},e}();t.FlagsService=o,t.build=f}),define("swx-flags-service-api",["swx-flags-service-api/lib/flagsService"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/preferences/flagsServiceProvider",["require","exports","swx-flags-service-api","swx-jskype-internal-application-instance","jskype-settings-instance"],e)}(function(e,t){function u(e){return new o(e)}var n=e("swx-flags-service-api"),r=e("swx-jskype-internal-application-instance"),i=e("jskype-settings-instance");t.SYNC_INTERVAL=6e4;var s,o=function(){function e(t){this.flagId=t,s||e._resetGlobalState()}return e._resetGlobalState=function(){s=n.build(i.settings.flagsApiUrl)},e.prototype.read=function(){var e=this,t=Promise.resolve(r.get().signInManager._skypeToken());return t.then(function(t){return s.read(e.flagId,t)})},e.prototype.update=function(e){var t=this,n=r.get().signInManager._skypeToken();return n.then(function(n){return s.update(t.flagId,e,n)})},e}();o.$unit={_resetGlobalState:o._resetGlobalState},t.FlagsServiceProvider=o,t.build=u});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/preferences/defaultToTrueFlagProvider",["require","exports","../../../lib/services/preferences/flagsServiceProvider"],e)})(function(e,t){function i(e){return new r(e)}var n=e("../../../lib/services/preferences/flagsServiceProvider"),r=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.read=function(){return e.prototype.read.call(this).then(function(e){return!e})},t.prototype.update=function(t){return e.prototype.update.call(this,!t)},t}(n.FlagsServiceProvider);t.DefaultToTrueFlagProvider=r,t.build=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/preferences/optionsServiceProvider",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","reqwest","swx-browser-globals","swx-client-info","swx-utils-common"],e)}(function(e,t){function f(e){return new a(e)}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("reqwest"),s=e("swx-browser-globals"),o=e("swx-client-info"),u=e("swx-utils-common"),a=function(){function e(e){this.keyName=e,this.chainId=u.guid.create()}return e.prototype.read=function(){var e=this,t=s.getWindow(),a=Promise.all([n.get().signInManager._skypeToken(),n.get().personsAndGroupsManager.mePerson.id.get()]);return a.then(function(n){var s=n[0],a=n[1],f={dataType:"json",url:r.settings.userOptionsService.host+r.settings.userOptionsService.optionsEndpoint,crossOrigin:!0,headers:{"X-Skypetoken":t.encodeURIComponent(s),"X-Skype-Caller":o.getBIAppName(),"X-Microsoft-Skype-Chain-ID":e.chainId,"X-Microsoft-Skype-Message-ID":u.guid.create()}};return f.url=f.url.replace("${userId}","self").replace("${optionName}",t.encodeURIComponent(e.keyName)),Promise.resolve(i.compat(f)).then(function(e){if(e.status)return null;if(e.optionInt)return e.optionInt;if(e.optionStr)return e.optionStr;if(e.value)return e.value},function(){return null})})},e.prototype.update=function(e){var t=this,a=s.getWindow(),f=Promise.all([n.get().signInManager._skypeToken(),n.get().personsAndGroupsManager.mePerson.id.get()]),l=function(e){return JSON.stringify({value:e})};return f.then(function(n){var s=n[0],f=n[1],c={dataType:"json",url:r.settings.userOptionsService.host+r.settings.userOptionsService.optionsEndpoint,crossOrigin:!0,method:"PUT",headers:{"X-Skypetoken":a.encodeURIComponent(s),"X-Skype-Caller":o.getBIAppName(),"X-Microsoft-Skype-Chain-ID":t.chainId,"X-Microsoft-Skype-Message-ID":u.guid.create(),"Content-Type":"application/json; charset=utf-8"},data:l(e)};return c.url=c.url.replace("${userId}","self").replace("${optionName}",a.encodeURIComponent(t.keyName)),Promise.resolve(i.compat(c)).then(function(e){return e.status?Promise.reject(e):e})})},e}();t.OptionsServiceProvider=a,t.build=f});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/preferences/callPolicyProvider",["require","exports","../../../lib/services/preferences/optionsServiceProvider","swx-enums"],e)})(function(e,t){function s(){return new i}var n=e("../../../lib/services/preferences/optionsServiceProvider"),r=e("swx-enums"),i=function(e){function t(){return e.call(this,"calling.skype-call-policy")||this}return __extends(t,e),t.prototype.read=function(){return e.prototype.read.call(this).then(function(e){return e==="AUTHORIZED_CAN_CALL"?r.privacyPolicyValues.ContactsOnly:r.privacyPolicyValues.Anyone})},t.prototype.update=function(t){return e.prototype.update.call(this,t===r.privacyPolicyValues.ContactsOnly?"AUTHORIZED_CAN_CALL":"EVERYONE_CAN_CALL")},t}(n.OptionsServiceProvider);t.CallPolicyProvider=i,t.build=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/preferences/videoPolicyProvider",["require","exports","../../../lib/services/preferences/flagsServiceProvider","swx-enums"],e)}(function(e,t){function s(){return new i}var n=e("../../../lib/services/preferences/flagsServiceProvider"),r=e("swx-enums"),i=function(){function e(){this.allowVideoCallsFromContactsOnly=n.build(r.skypeFlagsApiMappings.ALLOW_VIDEO_CALLS_FROM_CONTACTS_ONLY),this.dontAllowVideoCalls=n.build(r.skypeFlagsApiMappings.DONT_ALLOW_VIDEO_CALLS),this.cachedValue=null}return e.prototype.read=function(){var e=this;return Promise.all([this.allowVideoCallsFromContactsOnly.read(),this.dontAllowVideoCalls.read()]).then(function(t){var n=t[0],i=t[1];return i?(n&&e.allowVideoCallsFromContactsOnly.update(!1),e.cachedValue=r.privacyPolicyValues.NoOne):n?e.cachedValue=r.privacyPolicyValues.ContactsOnly:e.cachedValue=r.privacyPolicyValues.Anyone})},e.prototype.update=function(e){var t=this,n=e===r.privacyPolicyValues.NoOne,i=e===r.privacyPolicyValues.ContactsOnly,s=[];return(i||this.cachedValue===r.privacyPolicyValues.ContactsOnly||this.cachedValue===null)&&s.push(this.allowVideoCallsFromContactsOnly.update(i)),(n||this.cachedValue===r.privacyPolicyValues.NoOne||this.cachedValue===null)&&s.push(this.dontAllowVideoCalls.update(n)),Promise.all([s]).then(function(){return t.cachedValue=e,undefined})},e}();t.VideoPolicyProvider=i,t.build=s});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/preferences/readReceiptsProvider",["require","exports","../../../lib/services/preferences/optionsServiceProvider"],e)})(function(e,t){function i(){return new r}var n=e("../../../lib/services/preferences/optionsServiceProvider"),r=function(e){function t(){return e.call(this,"service-settings.read-receipt-policy")||this}return __extends(t,e),t.prototype.read=function(){return e.prototype.read.call(this).then(function(e){return e==="NO_READ_RECEIPT"?!0:e==="REQUIRE_READ_RECEIPT"?!1:e})},t.prototype.update=function(t){return e.prototype.update.call(this,t?"NO_READ_RECEIPT":"REQUIRE_READ_RECEIPT")},t}(n.OptionsServiceProvider);t.ReadReceiptsProvider=r,t.build=i}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/utils/preferences/config",["require","exports","swx-enums","swx-jskype-internal-application-instance","swx-constants","../../../lib/services/preferences/localStorageProvider","../../../lib/services/preferences/autoBuddyProvider","../../../lib/services/preferences/profileServiceProvider","../../../lib/services/preferences/flagsServiceProvider","../../../lib/services/preferences/defaultToTrueFlagProvider","../../../lib/services/preferences/callPolicyProvider","../../../lib/services/preferences/videoPolicyProvider","../../../lib/services/preferences/readReceiptsProvider"],e)}(function(e,t){var n=e("swx-enums"),r=e("swx-jskype-internal-application-instance"),i=e("swx-constants"),s=e("../../../lib/services/preferences/localStorageProvider"),o=e("../../../lib/services/preferences/autoBuddyProvider"),u=e("../../../lib/services/preferences/profileServiceProvider"),a=e("../../../lib/services/preferences/flagsServiceProvider"),f=e("../../../lib/services/preferences/defaultToTrueFlagProvider"),l=e("../../../lib/services/preferences/callPolicyProvider"),c=e("../../../lib/services/preferences/videoPolicyProvider"),h=e("../../../lib/services/preferences/readReceiptsProvider"),p=i.COMMON.featureFlags,d=i.COMMON.userSettings.preferences,v=n.skypeFlagsApiMappings,m=n.preferenceType;t.preferences=[],t.preferences.push({featureFlag:p.URL_PREVIEWS,id:d.URL_PREVIEWS,type:m.Boolean,provider:{builder:f,args:[v.URL_PREVIEWS]},defaultValue:!0}),t.preferences.push({featureFlag:p.YOUTUBE_PLAYER_ENABLED,id:d.YOUTUBE_PLAYER,type:m.Boolean,provider:{builder:a,args:[v.YOUTUBE_PLAYER]},defaultValue:!1}),t.preferences.push({featureFlag:p.URL_PREVIEW_LOAD_YOUTUBE_PLAYER,id:d.YOUTUBE_PLAYER,type:m.Boolean,provider:{builder:a,args:[v.YOUTUBE_PLAYER]},defaultValue:!1}),t.preferences.push({featureFlag:p.MENTIONS_ENABLED,id:d.MENTIONS,type:m.Boolean,provider:{builder:f,args:[v.MENTIONS]},defaultValue:!0}),t.preferences.push({featureFlag:p.FILE_PASTE_ENABLED,id:d.FILE_PASTE,type:m.Boolean,provider:{builder:a,args:[v.FILE_PASTE]},defaultValue:!1}),t.preferences.push({featureFlag:p.TYPING_INDICATOR_ENABLED,id:d.TYPING_INDICATOR,type:m.Boolean,provider:{builder:f,args:[v.TYPING_INDICATOR]},defaultValue:!0}),t.preferences.push({featureFlag:p.SKYPE_CALL_POLICY_SUPPORT,id:d.SKYPE_CALL_POLICY_SUPPORT,type:m.CallPolicy,provider:{builder:l},defaultValue:n.privacyPolicyValues.Anyone}),t.preferences.push({featureFlag:p.SKYPE_VIDEO_CALLING_POLICY_SUPPORT,id:d.SKYPE_VIDEO_CALLING_POLICY_SUPPORT,type:m.VideoPolicy,provider:{builder:c},defaultValue:n.privacyPolicyValues.Anyone}),t.preferences.push({featureFlag:p.READ_RECEIPT_ENABLED,id:d.READ_RECEIPT,type:m.Boolean,provider:{builder:h},defaultValue:!1}),t.preferences.push({featureFlag:p.SHOW_EMOTICON_SUGGESTIONS_SETTINGS,id:d.EMOTICON_SUGGESTIONS,type:m.Boolean,provider:{builder:a,args:[n.skypeFlagsApiMappings.SHOW_EMOTICON_SUGGESTIONS_SETTINGS]},defaultValue:!0}),t.preferences.push({featureFlag:p.EMOTICON_SETTINGS_ENABLED,id:d.SHOW_EMOTICONS,type:m.Boolean,provider:{builder:f,args:[n.skypeFlagsApiMappings.SHOW_EMOTICONS]},defaultValue:!0}),t.preferences.push({featureFlag:p.SHORT_CIRCUIT_SUPPORT,id:d.AUTO_BUDDY,type:m.AutoBuddy,provider:{builder:o},isDisplayable:function(){return r.get().personsAndGroupsManager.mePerson._isLinkedMsaAutoGenerated.get().then(function(e){return Promise.resolve(!e)},function(){return Promise.resolve(!0)})},defaultValue:!1,getDisabled:!0}),t.preferences.push({featureFlag:p.SHORT_CIRCUIT_SUPPORT,id:d.AUTO_BUDDY_DISCOVERY,type:m.AutoBuddyDiscovery,provider:{builder:u},defaultValue:!1,disableReporting:!0,getDisabled:!0}),t.preferences.push({featureFlag:p.CHAT_NOTIFICATIONS_SETTINGS_ENABLED,id:d.NOTIFICATIONS,type:m.Notifications,provider:{builder:f,args:[n.skypeFlagsApiMappings.NOTIFICATIONS]}}),t.preferences.push({featureFlag:p.NOTIFICATIONS_SOUNDS_SETTING_ENABLED,id:d.NOTIFICATIONS_SOUND,type:m.Notifications,provider:{builder:f,args:[n.skypeFlagsApiMappings.NOTIFICATIONS_SOUND]}}),t.preferences.push({featureFlag:p.RINGING_DEFERRING,id:d.DEFER_RINGING_SOUND,type:m.RingingDeferrer,provider:{builder:s,args:[i.COMMON.storageKeys.RINGING_DEFERRER_SETTINGS_KEY]}}),t.preferences.push({featureFlag:p.CHAT_NOTIFICATIONS_SOUND_SETTINGS_ENABLED,id:d.CHAT_NOTIFICATIONS_SOUND,type:m.Notifications,provider:{builder:f,args:[n.skypeFlagsApiMappings.CHAT_NOTIFICATIONS_SOUND]}}),t.preferences.push({featureFlag:p.CALL_NOTIFICATIONS_SETTINGS_ENABLED,id:d.CALL_NOTIFICATIONS,type:m.Notifications,provider:{builder:f,args:[n.skypeFlagsApiMappings.CALL_NOTIFICATIONS]}}),t.preferences.push({featureFlag:p.CALL_NOTIFICATIONS_SOUND_SETTINGS_ENABLED,id:d.CALL_NOTIFICATIONS_SOUND,type:m.Notifications,provider:{builder:f,args:[n.skypeFlagsApiMappings.CALL_NOTIFICATIONS_SOUND]}}),t.preferences.push({featureFlag:p.EMOTICON_SETTINGS_ENABLED,id:d.SHOW_ANIMATED_EMOTICONS,type:m.Boolean,provider:{builder:f,args:[n.skypeFlagsApiMappings.SHOW_ANIMATED_EMOTICONS]},defaultValue:!0}),t.preferences.push({featureFlag:p.EMOTICON_SETTINGS_ENABLED,id:d.SHOW_LARGE_EMOTICONS,type:m.Boolean,provider:{builder:f,args:[n.skypeFlagsApiMappings.SHOW_LARGE_EMOTICONS]},defaultValue:!0}),t.preferences.push({featureFlag:p.DARK_THEME_ENABLED,id:d.DARK_THEME,type:m.Boolean,provider:{builder:a,args:[n.skypeFlagsApiMappings.DARK_THEME]},defaultValue:!1}),t.preferences.push({featureFlag:p.VIDEO_AUTOPLAY_SETTINGS_ENABLED,id:d.VIDEO_AUTOPLAY,type:m.Boolean,provider:{builder:f,args:[n.skypeFlagsApiMappings.VIDEO_AUTOPLAY]},defaultValue:!0})}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/utils/preferences",["require","exports","lodash-compat","jskype-settings-instance","../../lib/utils/preferences/config","../../lib/utils/preferences/preference"],e)}(function(e,t){function o(e){i.preferences.forEach(function(r){if(u(r.featureFlag)){var i=n.clone(r),s=r.provider;i.provider=s.builder.build.apply(s.builder,s.args),t.addPreference(i,e)}})}function u(e){return r.isFeatureOn(e)}var n=e("lodash-compat"),r=e("jskype-settings-instance"),i=e("../../lib/utils/preferences/config"),s=e("../../lib/utils/preferences/preference");t.addPreference=function(e,t){function n(e){return t(e.id)||t.add(s.build(e),e.id),Promise.resolve()}return e.isDisplayable?e.isDisplayable().then(function(t){return t?n(e):undefined}):n(e)},t.init=o}),define("jSkype/application",["require","swx-polyfill-initializer","lodash-compat","swx-constants","swx-enums","swx-jskype-internal-application-instance","jcafe-property-model","swx-jskype-main/lib/models/signInManager","swx-jskype-main/lib/models/translatorService","swx-jskype-main/lib/services/messageSearch/main","swx-jskype-main/lib/models/marketplaceManager","swx-jskype-main/lib/models/conversationsManager","swx-jskype-main/lib/models/devicesManager","swx-jskype-main/lib/models/personsAndGroupsManager","swx-jskype-main/lib/modelHelpers/dataOrchestrator","jskype-settings-instance","experience/settings","swx-jskype-main/lib/services/asyncMedia/main","jSkype/services/calling/callingInitializer","swx-jskype-main/lib/services/keyEncryption/keyEncryption","swx-jskype-main/lib/services/serviceFactory","swx-chat-service/lib/constants","swx-jskype-main/lib/services/spaces","swx-log-tracer","swx-jskype-main/lib/services/cache/instance","swx-jskype-main/lib/utils/preferences","swx-utils-common","swx-jskype-main/lib/services/preferences/flagsServiceProvider"],function(e){function k(e){var k=this;return e=t.defaults({},e,{settings:{}}),d.settings=e.settings,x.set(e.localStorage),N.remove("chat-4171"),S.configure({logToConsole:d.isFeatureOn(n.featureFlags.CONSOLE_LOGGING),logToBuffer:d.isFeatureOn(n.featureFlags.ISSUE_REPORTING),logUnhandled:d.isFeatureOn(n.featureFlags.ISSUE_REPORTING),reporting:{enabled:d.isFeatureOn(n.featureFlags.ERROR_LOG_REPORTING),throttleInterval:d.settings.telemetry?d.settings.telemetry.logThrottleInterval:0,telemetryManager:e.telemetryManager,telemetryToken:d.settings.telemetry?d.settings.telemetry.logReportingToken:null}}),k._standbyMode=s.property({value:d.isFeatureOn(n.featureFlags.SUPPORT_STANDBY_MODE)}),k._telemetryManager=e.telemetryManager,k._telemetry=e.telemetry,k._flagsServiceProvider=C,k.signInManager=o.build(e.linkingApi,e.authContext),k.personsAndGroupsManager=new h,k.conversationsManager=new l,k.devicesManager=c.build(),k.suspended=s.boolProperty(!1),k.marketplaceManager=new f,d.isFeatureOn(n.featureFlags.TRANSLATOR_SENDING_ENABLED)&&(k.translatorService=u.build()),d.isFeatureOn(n.featureFlags.CONTENT_SEARCH)&&(k._messagesSearchService=a.build()),k.signInManager.state.when(r.loginState.SignedIn,function(){x.get().init(y.build()),T.init(k.personsAndGroupsManager.mePerson.preferences),p.initialize(),g.initialize(v),E.initialize(v),E.fetchConfig()}),k.signInManager.state.when(r.loginState.SigningOut,function(){x.get().destroy(!0),g.destroy(),k.suspended(!1),k.devicesManager._reset(),k.conversationsManager._reset().then(function(){k.personsAndGroupsManager._reset(),k.signInManager.state._set(r.loginState.SignedOut)})}),k.signInManager._skypeToken.changed(function(e){m.get().authenticate(e)}),k.isEndpointActive=s.property({value:!1,set:function(){function n(){k.isEndpointActive(!1)}function r(){b.getPresenceService().activateEndpoint(),e&&clearTimeout(e),e=setTimeout(n,w.ACTIVATE_ENDPOINT_TIMEOUT)}var e=null,i=t.debounce(r,0,{leading:!0,trailing:!1,maxWait:w.ACTIVATE_ENDPOINT_TIMEOUT-w.ACTIVATE_ENDPOINT_TOLERANCE});return function(e){return e&&i(),e}}()}),i.set(k),k}e("swx-polyfill-initializer");var t=e("lodash-compat"),n=e("swx-constants").COMMON,r=e("swx-enums"),i=e("swx-jskype-internal-application-instance"),s=e("jcafe-property-model"),o=e("swx-jskype-main/lib/models/signInManager"),u=e("swx-jskype-main/lib/models/translatorService"),a=e("swx-jskype-main/lib/services/messageSearch/main"),f=e("swx-jskype-main/lib/models/marketplaceManager").default,l=e("swx-jskype-main/lib/models/conversationsManager").default,c=e("swx-jskype-main/lib/models/devicesManager"),h=e("swx-jskype-main/lib/models/personsAndGroupsManager").default,p=e("swx-jskype-main/lib/modelHelpers/dataOrchestrator"),d=e("jskype-settings-instance"),v=e("experience/settings"),m=e("swx-jskype-main/lib/services/asyncMedia/main"),g=e("jSkype/services/calling/callingInitializer"),y=e("swx-jskype-main/lib/services/keyEncryption/keyEncryption"),b=e("swx-jskype-main/lib/services/serviceFactory"),w=e("swx-chat-service/lib/constants"),E=e("swx-jskype-main/lib/services/spaces"),S=e("swx-log-tracer"),x=e("swx-jskype-main/lib/services/cache/instance"),T=e("swx-jskype-main/lib/utils/preferences"),N=e("swx-utils-common").sessionStorage,C=e("swx-jskype-main/lib/services/preferences/flagsServiceProvider");return k}),define("jSkype/root",["require","exports","module","jSkype/application","jskype-settings-instance"],function(e,t){var n=e("jSkype/application"),r=e("jskype-settings-instance");t.Application=n,t.version=r.version}),define("services/telemetry/common/telemetryContext",["require","swx-constants"],function(e){function r(){this.sentEmoticonsInfo=[],this.sentMessagesInfo=[],this.receivedMessagesInfo=[],this.currentConversation=null,this.timelineLoadOrigin=t.telemetry.NOT_AVAILABLE,this.historyLoadOrigin=t.telemetry.NOT_AVAILABLE,this.timelineInSearchMode=t.telemetry.NOT_AVAILABLE,this.timelineLoadStatusCode=t.telemetry.NOT_AVAILABLE,this.activeEndpoints=t.telemetry.NOT_AVAILABLE,this.isChatHistoryLoad404=t.telemetry.NOT_AVAILABLE,this.chatHistoryLoadResult={},this.statusCode=!1}var t=e("swx-constants").COMMON,n;return r.get=function(){return n||(n=new r),n},r}),define("services/telemetry/eventBus",["require","swx-pubsub-instance"],function(e){var t=e("swx-pubsub-instance").default;return{get:function(){return t}}}),define("telemetry/chat/activityItemHelper",["require","swx-constants","swx-encoder/lib/encoders/emoticonEncoder","swx-enums"],function(e){function s(){function e(e,t){return(e&t)!==0}function s(e){return e.originalContent||e.content}function o(n,r){e(r,t.telemetry.messageTypes.RICHTEXT_MASK)&&(e(r,t.telemetry.messageTypes.RICHTEXT_FORMAT)&&n.richtext.format++,e(r,t.telemetry.messageTypes.RICHTEXT_EMOTICONS)&&n.richtext.emoticons++,e(r,t.telemetry.messageTypes.RICHTEXT_ME)&&n.richtext.me++,n.richtext.total++)}this.updateResult=function(n,r){switch(r){case t.telemetry.messageTypes.MEDIA_VIDEO:n.media.video++;break;case t.telemetry.messageTypes.MEDIA_PICTURE:n.media.picture++;break;case t.telemetry.messageTypes.MEDIA_LOCATION:n.media.location++;break;case t.telemetry.messageTypes.CALLING_OTHER:n.calling.total++;break;case t.telemetry.messageTypes.FILES_PICTURE:n.files.picture++;break;case t.telemetry.messageTypes.FILES_VIDEO:n.files.video++;break;case t.telemetry.messageTypes.FILES_OFFICE:n.files.office++;break;case t.telemetry.messageTypes.FILES_ARCHIVE:n.files.zip++;break;case t.telemetry.messageTypes.FILES_BINARY:n.files.binary++;break;case t.telemetry.messageTypes.FILES_PDF:n.files.pdf++;break;case t.telemetry.messageTypes.CONTACT_OTHER:n.contact.total++;break;case t.telemetry.messageTypes.TEXT_ME:n.text.me++;break;case t.telemetry.messageTypes.OTHER_TYPES:n.other++;break;default:if(!e(r,t.telemetry.messageTypes.FILES_MASK|t.telemetry.messageTypes.RICHTEXT_MASK|t.telemetry.messageTypes.TEXT_MASK))throw new Error("Not supported:"+r)}e(r,t.telemetry.messageTypes.FILES_MASK)&&n.files.total++,e(r,t.telemetry.messageTypes.RICHTEXT_MASK)&&o(n,r),e(r,t.telemetry.messageTypes.TEXT_MASK)&&n.text.total++},this.getEmptyResult=function(){var e={media:{picture:0,video:0,location:0},files:{total:0,picture:0,video:0,office:0,zip:0,binary:0,pdf:0},richtext:{total:0,format:0,emoticons:0,me:0},text:{total:0,me:0},contact:{total:0},calling:{total:0},other:0};return e},this.getTelemetryMessageType=function(e){switch(e.type()){case r.activityType.VideoMessage:return t.telemetry.messageTypes.MEDIA_VIDEO;case r.activityType.PictureMessage:return t.telemetry.messageTypes.MEDIA_PICTURE;case r.activityType.CallStarted:case r.activityType.CallEnded:case r.activityType.CallMissed:return t.telemetry.messageTypes.CALLING_OTHER;case r.activityType.TextMessage:var i=0,s=e.html().indexOf("raw_pre")>-1;s&&(i|=t.telemetry.messageTypes.RICHTEXT_FORMAT);var o=n.build().hasEmoticons(e.html());return o&&(i|=t.telemetry.messageTypes.RICHTEXT_EMOTICONS),i===0?t.telemetry.messageTypes.RICHTEXT_OTHER:i;case r.activityType.CONTACTS:return t.telemetry.messageTypes.CONTACT_OTHER;default:return t.telemetry.messageTypes.OTHER_TYPES}},this.getTelemetryMessageTypeObsolete=function(e){switch(e.messagetype){case i.VIDEO:return t.telemetry.messageTypes.MEDIA_VIDEO;case i.PICTURE:return t.telemetry.messageTypes.MEDIA_PICTURE;case i.LOCATION:return t.telemetry.messageTypes.MEDIA_LOCATION;case i.CALL_EVENT:return t.telemetry.messageTypes.CALLING_OTHER;case i.FILE_TRANSFER:var n=new RegExp(".([a-z0-9]{1,4})<","i"),r=n.exec(s(e))[1];switch(r){case"png":case"jpg":case"gif":case"bmp":return t.telemetry.messageTypes.FILES_PICTURE;case"avi":case"mp4":case"mkv":return t.telemetry.messageTypes.FILES_VIDEO;case"xls":case"xlsx":case"doc":case"docx":case"ppt":case"pptx":return t.telemetry.messageTypes.FILES_OFFICE;case"zip":case"rar":case"ace":case"7z":return t.telemetry.messageTypes.FILES_ARCHIVE;case"exe":case"msi":case"iso":return t.telemetry.messageTypes.FILES_BINARY;case"pdf":return t.telemetry.messageTypes.FILES_PDF;default:return t.telemetry.messageTypes.FILES_OTHER}break;case i.RICH_TEXT:var o=0,u=s(e).indexOf("raw_pre")>-1;u&&(o|=t.telemetry.messageTypes.RICHTEXT_FORMAT);var a=s(e).indexOf("<ss")>-1;return a&&(o|=t.telemetry.messageTypes.RICHTEXT_EMOTICONS),e.skypeemoteoffset&&(o|=t.telemetry.messageTypes.RICHTEXT_ME),o===0?t.telemetry.messageTypes.RICHTEXT_OTHER:o;case i.CONTACTS:return t.telemetry.messageTypes.CONTACT_OTHER;case i.TEXT:if(e.skypeemoteoffset)return t.telemetry.messageTypes.TEXT_ME;return t.telemetry.messageTypes.TEXT_OTHER;default:return t.telemetry.messageTypes.OTHER_TYPES}},this.processConversation=function(e){var t=this.getEmptyResult(),n,r=e.historyService.activityItems();for(n=0;n<r.length;n++){var i=r[n],s=this.getTelemetryMessageType(i);this.updateResult(t,s)}return t}}var t=e("swx-constants").COMMON,n=e("swx-encoder/lib/encoders/emoticonEncoder"),r=e("swx-enums"),i={VIDEO:"Event/SkypeVideoMessage",PICTURE:"RichText/UriObject",LOCATION:"RichText/Location",CALL_EVENT:"Event/Call",FILE_TRANSFER:"RichText/Files",RICH_TEXT:"RichText",CONTACTS:"RichText/Contacts",TEXT:"Text"};return new s});var clienttelemetry_build;(function(e){e.version="2.7.1"})(clienttelemetry_build||(clienttelemetry_build={}));var Microsoft;(function(e){var t;(function(e){(function(e){e[e.BT_STOP=0]="BT_STOP",e[e.BT_STOP_BASE=1]="BT_STOP_BASE",e[e.BT_BOOL=2]="BT_BOOL",e[e.BT_UINT8=3]="BT_UINT8",e[e.BT_UINT16=4]="BT_UINT16",e[e.BT_UINT32=5]="BT_UINT32",e[e.BT_UINT64=6]="BT_UINT64",e[e.BT_FLOAT=7]="BT_FLOAT",e[e.BT_DOUBLE=8]="BT_DOUBLE",e[e.BT_STRING=9]="BT_STRING",e[e.BT_STRUCT=10]="BT_STRUCT",e[e.BT_LIST=11]="BT_LIST",e[e.BT_SET=12]="BT_SET",e[e.BT_MAP=13]="BT_MAP",e[e.BT_INT8=14]="BT_INT8",e[e.BT_INT16=15]="BT_INT16",e[e.BT_INT32=16]="BT_INT32",e[e.BT_INT64=17]="BT_INT64",e[e.BT_WSTRING=18]="BT_WSTRING",e[e.BT_UNAVAILABLE=127]="BT_UNAVAILABLE"})(e.BondDataType||(e.BondDataType={}));var t=e.BondDataType;(function(e){e[e.MARSHALED_PROTOCOL=0]="MARSHALED_PROTOCOL",e[e.MAFIA_PROTOCOL=17997]="MAFIA_PROTOCOL",e[e.COMPACT_PROTOCOL=16963]="COMPACT_PROTOCOL",e[e.JSON_PROTOCOL=21322]="JSON_PROTOCOL",e[e.PRETTY_JSON_PROTOCOL=20554]="PRETTY_JSON_PROTOCOL",e[e.SIMPLE_PROTOCOL=20563]="SIMPLE_PROTOCOL"})(e.ProtocolType||(e.ProtocolType={}));var n=e.ProtocolType})(t=e.Bond||(e.Bond={}))})(Microsoft||(Microsoft={}));var Microsoft;(function(e){var t;(function(e){var t;(function(e){var t=function(){function e(){this._buffer=[]}return e.prototype.Add=function(e){var t=0;for(;t<this._buffer.length;++t)if(this._buffer[t]==e)break;t==this._buffer.length&&this._buffer.push(e)},e.prototype.Count=function(){return this._buffer.length},e.prototype.GetBuffer=function(){return this._buffer},e}();e.Set=t;var n=function(){function e(){this._buffer=[]}return e.prototype.Add=function(e,t){this._getIndex(e)==-1&&this._buffer.push({Key:e,Value:t})},e.prototype.AddOrReplace=function(e,t){var n=this._getIndex(e);n>=0?this._buffer[n]={Key:e,Value:t}:this._buffer.push({Key:e,Value:t})},e.prototype.Remove=function(e){var t=this._getIndex(e);t>=0&&this._buffer.splice(t,1)},e.prototype.Count=function(){return this._buffer.length},e.prototype.GetBuffer=function(){return this._buffer},e.prototype.ContainsKey=function(e){return this._getIndex(e)>=0?!0:!1},e.prototype.Get=function(e){var t=this._getIndex(e);return t>=0?this._buffer[t].Value:null},e.prototype._getIndex=function(e){var t=0,n=-1;for(;t<this._buffer.length;++t)if(this._buffer[t].Key==e){n=t;break}return n},e}();e.Map=n})(t=e.Collections||(e.Collections={}))})(t=e.Bond||(e.Bond={}))})(Microsoft||(Microsoft={}));var Microsoft;(function(e){var t;(function(t){var n;(function(e){var n=function(){function e(){}return e.GetBytes=function(e){var t=[];for(var n=0;n<e.length;++n){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?t.push(192|r>>6,128|r&63):r<55296||r>=57344?t.push(224|r>>12,128|r>>6&63,128|r&63):(r=65536+((r&1023)<<10|e.charCodeAt(++n)&1023),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63))}return t},e}();e.Utf8=n;var r=function(){function e(){}return e.GetString=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=[],r=e.length%3,i,s,o,u=function(e){return[t.charAt(e>>18&63),t.charAt(e>>12&63),t.charAt(e>>6&63),t.charAt(e&63)].join("")};for(i=0,o=e.length-r;i<o;i+=3)s=(e[i]<<16)+(e[i+1]<<8)+e[i+2],n.push(u(s));switch(r){case 1:s=e[e.length-1],n.push(t.charAt(s>>2)),n.push(t.charAt(s<<4&63)),n.push("==");break;case 2:s=(e[e.length-2]<<8)+e[e.length-1],n.push(t.charAt(s>>10)),n.push(t.charAt(s>>4&63)),n.push(t.charAt(s<<2&63)),n.push("=")}return n.join("")},e}();e.Base64=r;var s=function(){function e(){}return e.GetBytes=function(e){var t=[];while(e&4294967168)t.push(e&127|128),e>>>=7;return t.push(e&127),t},e}();e.Varint=s;var o=function(){function e(){}return e.GetBytes=function(e){var t=e.low,n=e.high,r=[];while(n||4294967168&t)r.push(t&127|128),t=(n&127)<<25|t>>>7,n>>>=7;return r.push(t&127),r},e}();e.Varint64=o;var u=function(){function e(){}return e.GetBytes=function(e){if(t.BrowserChecker.IsDataViewSupport()){var n=new DataView(new ArrayBuffer(4));n.setFloat32(0,e,!0);var r=[];for(var s=0;s<4;++s)r.push(n.getUint8(s));return r}return i.ConvertNumberToArray(e,!1)},e}();e.Float=u;var a=function(){function e(){}return e.GetBytes=function(e){if(t.BrowserChecker.IsDataViewSupport()){var n=new DataView(new ArrayBuffer(8));n.setFloat64(0,e,!0);var r=[];for(var s=0;s<8;++s)r.push(n.getUint8(s));return r}return i.ConvertNumberToArray(e,!0)},e}();e.Double=a;var f=function(){function e(){}return e.EncodeZigzag16=function(e){return e=t.Number.ToInt16(e),e<<1^e>>15},e.EncodeZigzag32=function(e){return e=t.Number.ToInt32(e),e<<1^e>>31},e.EncodeZigzag64=function(e){var n=e.low,r=e.high,i=r<<1|n>>>31,s=n<<1;r&2147483648&&(i=~i,s=~s);var o=new t.UInt64("0");return o.low=s,o.high=i,o},e}();e.Zigzag=f})(n=t.Encoding||(t.Encoding={}));var r;(function(n){var r=function(){function e(){}return e.GetString=function(e){var t=[];for(var n=0;n<e.length;++n){var r=e[n];if(r<=191)t.push(String.fromCharCode(r));else if(r<=223){var i=e[++n];t.push(String.fromCharCode((r&31)<<6|i&63))}else if(r<=239){var i=e[++n],s=e[++n];t.push(String.fromCharCode((r&15)<<12|(i&63)<<6|s&63))}else{var i=e[++n],s=e[++n],o=e[++n];r=(r&7)<<18|(i&63)<<12|(s&63)<<6|o&63,r-=65536,t.push(String.fromCharCode(55296|r>>10&1023)),t.push(String.fromCharCode(56320|r&1023))}}return t.join("")},e}();n.Utf8=r;var s=function(){function e(){}return e.GetBytes=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=[];for(var r=0;r<e.length;++r){var i=t.indexOf(e.charAt(r++)),s=t.indexOf(e.charAt(r++)),o=t.indexOf(e.charAt(r++)),u=t.indexOf(e.charAt(r));n.push(i<<2|s>>4),o>=0&&(n.push(s<<4&240|o>>2),u>=0&&n.push(o<<6&192|u))}return n},e}();n.Base64=s;var o=function(){function t(){}return t.GetInt64=function(t){var n=new e.Bond.Int64("0"),r=this._Read(t);return n.low=r[0],r.length>1&&(n.high=r[1]),n},t.GetNumber=function(e){return this._Read(e)[0]},t._Read=function(e){var t=[],n=0,r=!0,i=0;while(r){var s=e.shift();r=(s&128)!=0,s&=127;if(!(i<28)){n|=s<<i,t.push(n),n=s>>4,i=3;break}n|=s<<i,i+=7}while(r){var s=e.shift();r=(s&128)!=0,s&=127,n|=s<<i,i+=7;if(i>=32)break}return t.push(n),t},t}();n.Varint=o;var u=function(){function e(){}return e.GetNumber=function(e){if(t.BrowserChecker.IsDataViewSupport()){var n=new DataView(new ArrayBuffer(4));for(var r=0;r<4;++r)n.setUint8(r,e[r]);return n.getFloat32(0,!0)}return i.ConvertArrayToNumber(e,!1)},e}();n.Float=u;var a=function(){function e(){}return e.GetNumber=function(e){if(t.BrowserChecker.IsDataViewSupport()){var n=new DataView(new ArrayBuffer(8));for(var r=0;r<8;++r)n.setUint8(r,e[r]);return n.getFloat64(0,!0)}return i.ConvertArrayToNumber(e,!0)},e}();n.Double=a;var f=function(){function t(){}return t.DecodeZigzag16=function(e){return((65535&e)>>>1^-(e&1))<<16>>16},t.DecodeZigzag32=function(e){return e>>>1^-(e&1)},t.DecodeZigzag64=function(t){var n=t.high&1,r=t.high>>>1,i=t.low&1,s=t.low>>>1;s=n<<31|s,i&&(s^=4294967295,r^=4294967295);var o=new e.Bond.UInt64("0");return o.low=s,o.high=r,o},t}();n.Zigzag=f})(r=t.Decoding||(t.Decoding={}));var i=function(){function e(){}return e.ConvertNumberToArray=function(e,t){if(!e)return t?this._doubleZero:this._floatZero;var n=t?11:8,r=t?52:23,i=(1<<n-1)-1,s=1-i,o=i,u=e<0?1:0;e=Math.abs(e);var a=Math.floor(e),f=e-a,l=2*(i+2)+r,c=new Array(l),h=0;while(h<l)c[h++]=0;h=i+2;while(h&&a)c[--h]=a%2,a=Math.floor(a/2);h=i+1;while(h<l-1&&f>0)f*=2,f>=1?(c[++h]=1,--f):c[++h]=0;var p=0;for(;p<l&&!c[p];++p);var d=i+1-p,v=p+r;if(c[v+1]){for(h=v;h>p;--h)if(c[h]=1-c[h])break;h==p&&++d}if(d>o||a)return u?t?this._doubleNegInifinity:this._floatNegInifinity:t?this._doubleInifinity:this._floatInifinity;if(d<s)return t?this._doubleZero:this._floatZero;if(t){var m=0;for(h=0;h<20;++h)m=m<<1|c[++p];var g=0;for(;h<52;++h)g=g<<1|c[++p];m|=d+i<<20,m=u<<31|m&2147483647;var y=[g&255,g>>8&255,g>>16&255,g>>>24,m&255,m>>8&255,m>>16&255,m>>>24];return y}var b=0;for(h=0;h<23;++h)b=b<<1|c[++p];b|=d+i<<23,b=u<<31|b&2147483647;var y=[b&255,b>>8&255,b>>16&255,b>>>24];return y},e.ConvertArrayToNumber=function(e,n){var r=n?11:8,i=(1<<r-1)-1,s=(e[n?7:3]&128)!=0,o=n?(e[7]&127)<<4|(e[6]&240)>>4:(e[3]&127)<<1|(e[2]&128)>>7;if(o==255)throw new t.Exception("Not a valid float/double buffer.");var u=1,a=1;if(n){var f=(e[6]&15)<<28|(e[5]&255)<<20|(e[4]&255)<<12,l=e[3]<<24|(e[2]&255)<<16|(e[1]&255)<<8|e[0]&255;if(!o&&!f&&!l)return 0;for(var c=0;c<20;++c)a/=2,f<0&&(u+=a),f<<=1;for(var c=0;c<32;++c)a/=2,l<0&&(u+=a),l<<=1}else{var h=(e[2]&127)<<25|(e[1]&255)<<17|(e[0]&255)<<9;if(!o&&!h)return 0;for(var c=0;c<23;++c)a/=2,h<0&&(u+=a),h<<=1}return u*=Math.pow(2,o-i),s?0-u:u},e._floatZero=[0,0,0,0],e._doubleZero=[0,0,0,0,0,0,0,0],e._floatInifinity=[0,0,128,127],e._floatNegInifinity=[0,0,128,255],e._doubleInifinity=[0,0,0,0,0,0,240,127],e._doubleNegInifinity=[0,0,0,0,0,0,240,255],e}()})(t=e.Bond||(e.Bond={}))})(Microsoft||(Microsoft={}));var Microsoft;(function(e){var t;(function(e){var t;(function(t){var n=function(){function t(){this._buffer=[]}return t.prototype.WriteByte=function(t){this._buffer.push(e.Number.ToByte(t))},t.prototype.Write=function(e,t,n){while(n--)this.WriteByte(e[t++])},t.prototype.GetBuffer=function(){return this._buffer},t}();t.MemoryStream=n})(t=e.IO||(e.IO={}))})(t=e.Bond||(e.Bond={}))})(Microsoft||(Microsoft={}));var Microsoft;(function(e){var t;(function(e){var t=function(){function e(e,t){this.Type=e,this.Id=t}return e}();e.FieldTag=t;var n=function(){function e(e,t){this.ElementType=e,this.Size=t}return e}();e.ContainerTag=n;var r=function(){function e(e,t,n){this.KeyType=e,this.ValueType=t,this.Size=n}return e}();e.KeyValueContainerTag=r;var i=function(){function e(){}return e}();e.Bonded=i;var s=function(){function e(e){this.low=0,this.high=0,this.low=parseInt(e),this.low<0&&(this.high=-1)}return e.prototype.Equals=function(t){var n=new e(t);return this.low==n.low&&this.high==n.high},e}();e.Int64=s;var o=function(){function e(e){this.low=0,this.high=0,this.low=parseInt(e)}return e.prototype.Equals=function(t){var n=new e(t);return this.low==n.low&&this.high==n.high},e}();e.UInt64=o;var u=function(){function e(){}return e.ToByte=function(e){return this.ToUInt8(e)},e.ToInt8=function(e){var t=(e&128)<<24>>24;return e&127|t},e.ToInt16=function(e){var t=(e&32768)<<16>>16;return e&32767|t},e.ToInt32=function(e){var t=e&2147483648;return e&2147483647|t},e.ToUInt8=function(e){return e&255},e.ToUInt16=function(e){return e&65535},e.ToUInt32=function(e){return e&4294967295},e}();e.Number=u;var a=function(){function e(e){this.Message=e}return e}();e.Exception=a;var f=function(){function e(){}return e}();e.KeyValuePair=f;var l=function(){function e(){}return e.IsDataViewSupport=function(){return typeof ArrayBuffer!="undefined"&&typeof DataView!="undefined"},e}();e.BrowserChecker=l})(t=e.Bond||(e.Bond={}))})(Microsoft||(Microsoft={}));var Microsoft;(function(e){var t;(function(e){var t=function(){function t(e){this._stream=e}return t.prototype.WriteBlob=function(e){this._stream.Write(e,0,e.length)},t.prototype.WriteBool=function(e){this._stream.WriteByte(e?1:0)},t.prototype.WriteContainerBegin=function(e,t){this.WriteUInt8(t),this.WriteUInt32(e)},t.prototype.WriteMapContainerBegin=function(e,t,n){this.WriteUInt8(t),this.WriteUInt8(n),this.WriteUInt32(e)},t.prototype.WriteContainerEnd=function(){},t.prototype.WriteDouble=function(t){var n=e.Encoding.Double.GetBytes(t);this._stream.Write(n,0,n.length)},t.prototype.WriteFloat=function(t){var n=e.Encoding.Float.GetBytes(t);this._stream.Write(n,0,n.length)},t.prototype.WriteFieldBegin=function(e,t,n){t<=5?this._stream.WriteByte(e|t<<5):t<=255?(this._stream.WriteByte(e|192),this._stream.WriteByte(t)):(this._stream.WriteByte(e|224),this._stream.WriteByte(t),this._stream.WriteByte(t>>8))},t.prototype.WriteFieldEnd=function(){},t.prototype.WriteFieldOmitted=function(e,t,n){},t.prototype.WriteInt16=function(t){t=e.Encoding.Zigzag.EncodeZigzag16(t),this.WriteUInt16(t)},t.prototype.WriteInt32=function(t){t=e.Encoding.Zigzag.EncodeZigzag32(t),this.WriteUInt32(t)},t.prototype.WriteInt64=function(t){this.WriteUInt64(e.Encoding.Zigzag.EncodeZigzag64(t))},t.prototype.WriteInt8=function(t){this._stream.WriteByte(e.Number.ToInt8(t))},t.prototype.WriteString=function(t){if(t=="")this.WriteUInt32(0);else{var n=e.Encoding.Utf8.GetBytes(t);this.WriteUInt32(n.length),this._stream.Write(n,0,n.length)}},t.prototype.WriteStructBegin=function(e,t){},t.prototype.WriteStructEnd=function(t){this.WriteUInt8(t?e.BondDataType.BT_STOP_BASE:e.BondDataType.BT_STOP)},t.prototype.WriteUInt16=function(t){var n=e.Encoding.Varint.GetBytes(e.Number.ToUInt16(t));this._stream.Write(n,0,n.length)},t.prototype.WriteUInt32=function(t){var n=e.Encoding.Varint.GetBytes(e.Number.ToUInt32(t));this._stream.Write(n,0,n.length)},t.prototype.WriteUInt64=function(t){var n=e.Encoding.Varint64.GetBytes(t);this._stream.Write(n,0,n.length)},t.prototype.WriteUInt8=function(t){this._stream.WriteByte(e.Number.ToUInt8(t))},t.prototype.WriteWString=function(e){this.WriteUInt32(e.length);for(var t=0;t<e.length;++t){var n=e.charCodeAt(t);this._stream.WriteByte(n),this._stream.WriteByte(n>>>8)}},t}();e.CompactBinaryProtocolWriter=t;var n=function(){function e(){}return e}();e.CompactBinaryProtocolReader=n})(t=e.Bond||(e.Bond={}))})(Microsoft||(Microsoft={}));var sct;(function(e){var t=function(){function t(){}return t.IsSafari=function(){if(t._isSafari===null)if(typeof navigator!="undefined"&&navigator.userAgent){var e=navigator.userAgent.toLowerCase();e.indexOf("safari")>=0&&e.indexOf("chrome")<0?t._isSafari=!0:t._isSafari=!1}else t._isSafari=!1;return t._isSafari},t.IsReactNative=function(){return t._isReactNative===null&&(typeof navigator!="undefined"&&navigator.product?t._isReactNative=navigator.product==="ReactNative":t._isReactNative=!1),t._isReactNative},t.IsUint8ArrSupported=function(){return!e.Utils.IsSafari()&&typeof Uint8Array!="undefined"&&!e.Utils.IsReactNative()},t.ajax=function(e,n){var r=t._createConnection();if(e.headers){var i="qsp=true";for(var s in e.headers)i+="&",i+=encodeURIComponent(s),i+="=",i+=encodeURIComponent(e.headers[s]);e.url.indexOf("?")<0?e.url+="?":e.url+="&",e.url+=i}r.open(e.type,e.url,!n),e.complete&&(r.onload=function(){typeof r.status=="undefined"&&(r.status=200),e.complete(r)},r.ontimeout=function(){typeof r.status=="undefined"&&(r.status=500),e.complete(r)},r.onerror=function(){e.complete(r)}),r.send(e.data)},t.keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},t.IsUsingXDomainRequest=function(){if(t._usingXDomainRequest==null){var e=new XMLHttpRequest;typeof e.withCredentials=="undefined"&&typeof XDomainRequest!="undefined"?t._usingXDomainRequest=!0:t._usingXDomainRequest=!1}return t._usingXDomainRequest},t._createConnection=function(){var e=new XMLHttpRequest;return t.IsUsingXDomainRequest()?new XDomainRequest:e},t._isSafari=null,t._isReactNative=null,t._usingXDomainRequest=null,t}();e.Utils=t})(sct||(sct={}));var microsoft;(function(e){var t;(function(e){var t;(function(e){var t;(function(t){var n=function(){function e(){}return e.GetGuid=function(){var e=function(){return Math.floor((1+Math.random())*65536).toString(16).substring(1,5)};return[e(),e(),"-",e(),"-",e(),"-",e(),"-",e(),e(),e()].join("")},e.GetTimeStamp=function(){var e=(new Date).getTime(),t=new Microsoft.Bond.Int64("0");return t.low=e&4294967295,t.high=Math.floor(e/4294967296),t},e.GetTimeStampWithValue=function(e){var t=new Microsoft.Bond.Int64("0");return t.low=e&4294967295,t.high=Math.floor(e/4294967296),t},e}();t.utils=n,function(e){e[e.NotSet=0]="NotSet",e[e.Event=1]="Event",e[e.PerformanceCounter=2]="PerformanceCounter",e[e.Anomaly=3]="Anomaly",e[e.Prediction=4]="Prediction",e[e.TraceLog=5]="TraceLog",e[e.EventSourceLog=6]="EventSourceLog",e[e.HttpLog=7]="HttpLog",e[e.PerformanceCounterAzure=8]="PerformanceCounterAzure",e[e.PerformanceCounterGfs=9]="PerformanceCounterGfs"}(t.RecordType||(t.RecordType={}));var r=t.RecordType;(function(e){e[e.NotSet=0]="NotSet",e[e.O365=1]="O365",e[e.SkypeBI=2]="SkypeBI",e[e.SkypeData=3]="SkypeData"})(t.PIIScrubber||(t.PIIScrubber={}));var i=t.PIIScrubber;(function(e){e[e.NotSet=0]="NotSet",e[e.DistinguishedName=1]="DistinguishedName",e[e.GenericData=2]="GenericData",e[e.IPV4Address=3]="IPV4Address",e[e.IPv6Address=4]="IPv6Address",e[e.MailSubject=5]="MailSubject",e[e.PhoneNumber=6]="PhoneNumber",e[e.QueryString=7]="QueryString",e[e.SipAddress=8]="SipAddress",e[e.SmtpAddress=9]="SmtpAddress",e[e.Identity=10]="Identity",e[e.Uri=11]="Uri",e[e.Fqdn=12]="Fqdn",e[e.IPV4AddressLegacy=13]="IPV4AddressLegacy"})(t.PIIKind||(t.PIIKind={}));var s=t.PIIKind;(function(e){e[e.Unknown=0]="Unknown",e[e.MSACID=1]="MSACID",e[e.MSAPUID=2]="MSAPUID",e[e.ANID=3]="ANID",e[e.OrgIdCID=4]="OrgIdCID",e[e.OrgIdPUID=5]="OrgIdPUID",e[e.UserObjectId=6]="UserObjectId",e[e.Skype=7]="Skype",e[e.Yammer=8]="Yammer",e[e.EmailAddress=9]="EmailAddress",e[e.PhoneNumber=10]="PhoneNumber",e[e.SipAddress=11]="SipAddress",e[e.MUID=12]="MUID"})(t.UserIdType||(t.UserIdType={}));var o=t.UserIdType,u=function(){function t(){this.ScrubType=e.datamodels.PIIScrubber.NotSet,this.Kind=e.datamodels.PIIKind.NotSet,this.RawContent=""}return t.prototype.Write=function(e){this.WriteImpl(e,!1)},t.prototype.WriteImpl=function(t,n){t.WriteStructBegin(null,n),this.ScrubType!=e.datamodels.PIIScrubber.NotSet?(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_INT32,1,null),t.WriteInt32(this.ScrubType),t.WriteFieldEnd()):t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_INT32,1,null),this.Kind!=e.datamodels.PIIKind.NotSet?(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_INT32,2,null),t.WriteInt32(this.Kind),t.WriteFieldEnd()):t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_INT32,2,null),this.RawContent!=""?(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_STRING,3,null),t.WriteString(this.RawContent),t.WriteFieldEnd()):t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_STRING,3,null),t.WriteStructEnd(n)},t.prototype.Read=function(e){this.ReadImpl(e,!1)},t.prototype.ReadImpl=function(e,t){},t}();t.PII=u;var a=function(){function t(){this.Id=n.GetGuid(),this.Timestamp=n.GetTimeStamp(),this.Type="",this.EventType="",this.Extension=new Microsoft.Bond.Collections.Map,this.RecordType=e.datamodels.RecordType.NotSet,this.PIIExtensions=new Microsoft.Bond.Collections.Map}return t.prototype.AddOrReplacePII=function(t,n,r){var i=new e.datamodels.PII;i.RawContent=n,i.Kind=r,i.ScrubType=e.datamodels.PIIScrubber.O365,this.PIIExtensions.AddOrReplace(t,i)},t.prototype.Write=function(e){this.WriteImpl(e,!1)},t.prototype.WriteImpl=function(t,n){t.WriteStructBegin(null,n),this.Id!=""?(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_STRING,1,null),t.WriteString(this.Id),t.WriteFieldEnd()):t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_STRING,1,null),this.Timestamp.Equals("0")?t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_INT64,3,null):(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_INT64,3,null),t.WriteInt64(this.Timestamp),t.WriteFieldEnd()),this.Type!=""?(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_STRING,5,null),t.WriteString(this.Type),t.WriteFieldEnd()):t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_STRING,5,null),this.EventType!=""?(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_STRING,6,null),t.WriteString(this.EventType),t.WriteFieldEnd()):t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_STRING,6,null);if(this.Extension.Count()){t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_MAP,13,null),t.WriteMapContainerBegin(this.Extension.Count(),Microsoft.Bond.BondDataType.BT_STRING,Microsoft.Bond.BondDataType.BT_STRING);for(var r=0;r<this.Extension.GetBuffer().length;++r)t.WriteString(this.Extension.GetBuffer()[r].Key),t.WriteString(this.Extension.GetBuffer()[r].Value);t.WriteContainerEnd(),t.WriteFieldEnd()}else t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_MAP,13,null);this.RecordType!=e.datamodels.RecordType.NotSet?(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_INT32,24,null),t.WriteInt32(this.RecordType),t.WriteFieldEnd()):t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_INT32,24,null);if(this.PIIExtensions.Count()){t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_MAP,30,null),t.WriteMapContainerBegin(this.PIIExtensions.Count(),Microsoft.Bond.BondDataType.BT_STRING,Microsoft.Bond.BondDataType.BT_STRUCT);for(var i=0;i<this.PIIExtensions.GetBuffer().length;++i)t.WriteString(this.PIIExtensions.GetBuffer()[i].Key),this.PIIExtensions.GetBuffer()[i].Value.WriteImpl(t,!1);t.WriteContainerEnd(),t.WriteFieldEnd()}else t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_MAP,30,null);t.WriteStructEnd(n)},t.prototype.Read=function(e){this.ReadImpl(e,!1)},t.prototype.ReadImpl=function(e,t){},t}();t.Record=a;var f=function(){function e(){this.Source="",this.DataPackageId="",this.Timestamp=new Microsoft.Bond.Int64("0"),this.Records=[]}return e.prototype.Write=function(e){this.WriteImpl(e,!1)},e.prototype.WriteImpl=function(e,t){e.WriteStructBegin(null,t),this.Source!=""?(e.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_STRING,2,null),e.WriteString(this.Source),e.WriteFieldEnd()):e.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_STRING,2,null),this.DataPackageId!=""?(e.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_STRING,5,null),e.WriteString(this.DataPackageId),e.WriteFieldEnd()):e.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_STRING,5,null),this.Timestamp.Equals("0")?e.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_INT64,6,null):(e.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_INT64,6,null),e.WriteInt64(this.Timestamp),e.WriteFieldEnd());if(this.Records.length){e.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_LIST,8,null),e.WriteContainerBegin(this.Records.length,Microsoft.Bond.BondDataType.BT_STRUCT);for(var n=0;n<this.Records.length;++n)this.Records[n].WriteImpl(e,!1);e.WriteContainerEnd(),e.WriteFieldEnd()}else e.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_LIST,8,null);e.WriteStructEnd(t)},e.prototype.Read=function(e){this.ReadImpl(e,!1)},e.prototype.ReadImpl=function(e,t){},e}();t.DataPackage=f;var l=function(){function e(){this.DataPackages=[],this.RequestRetryCount=0}return e.prototype.Write=function(e){this.WriteImpl(e,!1)},e.prototype.WriteImpl=function(e,t){e.WriteStructBegin(null,t);if(this.DataPackages.length){e.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_LIST,1,null),e.WriteContainerBegin(this.DataPackages.length,Microsoft.Bond.BondDataType.BT_STRUCT);for(var n=0;n<this.DataPackages.length;++n)this.DataPackages[n].WriteImpl(e,!1);e.WriteContainerEnd(),e.WriteFieldEnd()}else e.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_LIST,1,null);this.RequestRetryCount!=0?(e.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_INT32,2,null),e.WriteInt32(this.RequestRetryCount),e.WriteFieldEnd()):e.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_INT32,2,null),e.WriteStructEnd(t)},e.prototype.Read=function(e){this.ReadImpl(e,!1)},e.prototype.ReadImpl=function(e,t){},e}();t.ClientToCollectorRequest=l})(t=e.datamodels||(e.datamodels={}))})(t=e.telemetry||(e.telemetry={}))})(t=e.applications||(e.applications={}))})(microsoft||(microsoft={}));var microsoft;(function(e){var t;(function(e){var t;(function(e){var t;(function(t){(function(e){e[e.SENT=0]="SENT",e[e.SEND_FAILED=1]="SEND_FAILED"})(t.CallbackEventType||(t.CallbackEventType={}));var n=t.CallbackEventType;(function(e){e[e.DATARV_ERROR_OK=0]="DATARV_ERROR_OK",e[e.DATARV_ERROR_INVALID_EVENT=1]="DATARV_ERROR_INVALID_EVENT",e[e.DATARV_ERROR_INVALID_CONFIG=2]="DATARV_ERROR_INVALID_CONFIG",e[e.DATARV_ERROR_INVALID_DEPENDENCIES=3]="DATARV_ERROR_INVALID_DEPENDENCIES",e[e.DATARV_ERROR_INVALID_STATUS=4]="DATARV_ERROR_INVALID_STATUS",e[e.DATARV_ERROR_INVALID_ARG=5]="DATARV_ERROR_INVALID_ARG"})(t.DATARV_ERROR||(t.DATARV_ERROR={}));var r=t.DATARV_ERROR,i=function(){function e(e){this._errorCode=r.DATARV_ERROR_OK,this._errorCode=e}return e.prototype.ErrorCode=function(){return this._errorCode},e.prototype.toString=function(){switch(this._errorCode){case r.DATARV_ERROR_OK:return"DATARV_ERROR_OK";case r.DATARV_ERROR_INVALID_EVENT:return"Event is invalid. Either event.Id is empty, or event.Timestamp is empty, or event.EventType is empty.";case r.DATARV_ERROR_INVALID_CONFIG:return"Invalid configuration. CollectorUrl is missing.";case r.DATARV_ERROR_INVALID_DEPENDENCIES:return"DATARV_ERROR_INVALID_DEPENDENCIES";case r.DATARV_ERROR_INVALID_STATUS:return"Telemetry Manager is not initialized.";case r.DATARV_ERROR_INVALID_ARG:return"TenantToken is null or empty, or events is null.";default:return"Unknown error"}},e}();t.Exception=i;var s=function(){function e(){}return e}();t.TelemetryConfig=s;var o=function(){function e(){}return e.CreateTelemetryManager=function(){return new f},e}();t.TelemetryManagerFactory=o;var u=function(){function e(){}return e.MaxPackageSizeInBytes=function(){return 3e6},e.TimeIntervalForNextSendInMS=function(){return 1e3},e}(),a;(function(e){e[e.Created=0]="Created",e[e.Initialized=1]="Initialized",e[e.Started=2]="Started"})(a||(a={}));var f=function(){function t(){this._MaxPackageSizeInBytes=u.MaxPackageSizeInBytes(),this._listeners=[],this._status=a.Created,this._etag=null,this._testServerResponseHook=null,this._isPaused=!1}return t.prototype.Initialize=function(e){if(this._status!=a.Created)throw new i(r.DATARV_ERROR_INVALID_STATUS);if(!e||!e.collectorUrl)throw new i(r.DATARV_ERROR_INVALID_CONFIG);this._config=e,this._Reset(),this._status=a.Initialized,this._Verbose("Initialize() done")},t.prototype.AddListener=function(e){if(this._status<a.Initialized)throw new i(r.DATARV_ERROR_INVALID_STATUS);this._Verbose(["AddListener(), status: ",this._status," old length: ",this._listeners.length," func: ",e].join(""));for(var t=0;t<this._listeners.length;++t)if(this._listeners[t]==e){this._Verbose("the listener has been added already, index: "+t);return}this._listeners.push(e),this._Verbose("AddListener() done, the new length: "+this._listeners.length)},t.prototype.RemoveListener=function(e){if(this._status<a.Initialized)throw new i(r.DATARV_ERROR_INVALID_STATUS);this._Verbose(["RemoveListener(), status: ",this._status," old length: ",this._listeners.length," func: ",e].join(""));for(var t=0;t<this._listeners.length;++t)if(this._listeners[t]==e){this._listeners.length==1?this._listeners=[]:t==this._listeners.length-1?this._listeners.pop():this._listeners[t]=this._listeners.pop(),this._Verbose(["this listener has been found, index: ",t,"new length: ",this._listeners.length].join(""));return}this._Verbose("listener isn't been found, new length"+this._listeners.length)},t.prototype.Start=function(){if(this._status<a.Initialized)throw new i(r.DATARV_ERROR_INVALID_STATUS);this._Verbose(["Start(), status:",this._status,"tag:",t._tag].join(" ")),this._status>=a.Started&&this._Verbose("Start() already, ignore"),++t._tag,this._status=a.Started,this._Verbose(["Start() done, status: ",this._status,"tag: ",t._tag].join(""))},t.prototype.Stop=function(){if(this._status<a.Initialized)throw new i(r.DATARV_ERROR_INVALID_STATUS);this._Verbose("Stop(), status: "+this._status);if(this._status==a.Initialized){this._Verbose("Stop() already, ignore");return}this._Reset(),this._status=a.Initialized,this._Verbose("Stop() done, status: "+this._status)},t.prototype.Pause=function(){this._isPaused=!0,this._CleanTimer()},t.prototype.Resume=function(){this._isPaused=!1,!this._eventsCache.IsEmpty()&&!this._timer&&this._ScheduleTimer(!1)},t.prototype.Flush=function(e){this._eventsCache.IsEmpty()||this._WorkThread(e,!0)},t.prototype.SendAsync=function(e,n){if(this._status<a.Initialized)throw new i(r.DATARV_ERROR_INVALID_STATUS);this._Verbose(["SendAsync(), status:",this._status,"tenantToken:",e,"count:",n.length].join(" "));if(this._status<a.Started)return this._Info("SendAsync(), not started, ignore, return false"),!1;if(!e||!n)throw this._Error("SendAsync(), tenantToken or events is null or empty"),new i(r.DATARV_ERROR_INVALID_ARG);for(var s=0;s<n.length;++s)if(!n[s].Id||!t._eventTypeRegex.test(n[s].EventType)||n[s].Timestamp.Equals("0"))throw this._Error(["eventId:",n[s].Id,"eventType:",n[s].EventType,"timestamp high:",n[s].Timestamp.high,"timestamp low:",n[s].Timestamp.low].join("")),new i(r.DATARV_ERROR_INVALID_EVENT);return this._eventsCache.AddEvents(e,n),this._Verbose(["SendAsync(), currentTimer: ",this._timer,"eventsCacheIsEmpty",this._eventsCache.IsEmpty()].join(" ")),!this._eventsCache.IsEmpty()&&!this._timer&&this._ScheduleTimer(!1),this._Verbose("SendAsync() done"),!0},t.prototype._WorkThread=function(e,n){var r=this;try{this._Verbose("_WorkThread, status: "+this._status);if(this._status<a.Started){this._Verbose("_WorkThread, status is not started, return");return}var i=this._eventsCache.DequeuEvents();if(i==null){this._Verbose("_WorkThread, No events found, return"),this._CleanTimer();return}var s=this._PackEvents(i.tenantToken,i.events);this._eventsCache.AddEvents(i.tenantToken,s.remainedEvents);if(s.buffer==null||s.buffer.length==0){this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1));return}if(this._testServerResponseHook){var o=this._testServerResponseHook();setTimeout(this._SendCallback(f,i.tenantToken,s.sendEvents,o,!1,null),100);return}var u={type:"POST",url:this._config.collectorUrl,processData:!1,headers:{"content-type":"application/bond-compact-binary","client-id":"NO_AUTH","sdk-version":"ACT-Web-JS-"+clienttelemetry_build.version},complete:function(t){return r._SendCallback(f,i.tenantToken,s.sendEvents,t,n,e)}};sct.Utils.IsUint8ArrSupported()?(this._Verbose("Uint8Array is defined, send with binary format directly."),u.data=new Uint8Array(s.buffer)):(this._Verbose("Uint8Array is undefined, send with base64 encode."),u.data=Microsoft.Bond.Encoding.Base64.GetString(s.buffer),u.headers["content-encoding"]="base64"),i.tenantToken&&(u.headers["x-apikey"]=i.tenantToken);var f=t._tag;this._lastActiveTime=(new Date).getTime(),sct.Utils.ajax(u,n),this._Verbose("_Workthread, send via jquery, tag: "+f)}catch(l){this._Error("_WorkThread, exception: "+l)}},t.prototype._PackEvents=function(t,n){this._Verbose("_PackageEvents, total Count: "+n.length);var r=new e.datamodels.ClientToCollectorRequest,i=new e.datamodels.DataPackage;i.Source="JS_default_source",i.DataPackageId=e.datamodels.utils.GetGuid(),i.Timestamp=e.datamodels.utils.GetTimeStamp();var s,o=n;n=[];for(;;){i.Records=[],i.Records.push.apply(i.Records,o),r.DataPackages=[],r.DataPackages.push(i),s=this._Serialize(r),this._Verbose(["_PackageEvents, sendEvents.length:",o.length,"buffer.length:",s.length,"MaxPackageSize:",this._MaxPackageSizeInBytes].join(""));if(s.length<this._MaxPackageSizeInBytes)break;if(o.length==1){o=[],s=null;break}var u=o.splice(0,Math.floor(o.length/2));this._Verbose("_PackageEvents, too large, package again"),n.push.apply(n,o),o=u}return this._Verbose(["_PakcageEvents done, sendEventsCount:",o.length,"buffer.length:",s==null?0:s.length,"remained events:",n.length].join("")),{buffer:s,sendEvents:o,remainedEvents:n}},t.prototype._Serialize=function(e){var t=new Microsoft.Bond.IO.MemoryStream,n=new Microsoft.Bond.CompactBinaryProtocolWriter(t);return e.Write(n),t.GetBuffer()},t.prototype._SendCallback=function(e,r,i,s,o,u){this._Verbose(["_SendCallback","tag:",e,"current tag:",t._tag,"tenantToken:",r,"events count:",i.length,"jqXHR:",s].join("")),u&&u(s?s.status:0,r,i);if(o)return;var f=s!=null&&s.status>=200&&s.status<300;if(this._status<a.Started||e<t._tag){this._Verbose("_SendCallback, is not started, or tag is not the same, return");return}if(!f&&(!s||s.status&&s.status!=400)){this._Verbose("retry statusCode: "+(s?s.status:0)),this._eventsCache.AddEvents(r,i),this._ScheduleTimer(!0);return}for(var l=0;l<this._listeners.length;++l)this._listeners[l](f?n.SENT:n.SEND_FAILED,s?s.status:0,r,i);this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1))},t.prototype._CleanTimer=function(){this._Verbose("_CleanTimer(), timer: "+this._timer),this._timer&&(clearTimeout(this._timer),this._timer=null)},t.prototype._ScheduleTimer=function(e){var t=this;if(!this._isPaused){this._Verbose("_ScheduleTimer: isRetry: "+e),this._CleanTimer();if(!e){var n=0,r=(new Date).getTime(),i=r-this._lastActiveTime;i>u.TimeIntervalForNextSendInMS()?n=0:n=u.TimeIntervalForNextSendInMS()-i,this._timer=setTimeout(function(){return t._WorkThread(null,!1)},n),this._Verbose("_ScheduleTimer, next try: "+n),this._rescheduleFactor=1}else{this._Verbose("_ScheduleTimer, current factor: "+this._rescheduleFactor);var n=Math.floor(5*this._rescheduleFactor*(1+Math.random()));this._timer=setTimeout(function(){return t._WorkThread(null,!1)},n*1e3),this._Verbose("_ScheduleTimer, next try (s): "+n),this._rescheduleFactor<<=1,this._rescheduleFactor>64&&(this._rescheduleFactor=1)}}},t.prototype._Verbose=function(e){this._config.log&&this._config.log.Verbose("[TelemetryManagerImpl]: "+e)},t.prototype._Info=function(e){this._config.log&&this._config.log.Info("[TelemetryManagerImpl]: "+e)},t.prototype._Error=function(e){this._config.log&&this._config.log.Error("[TelemetryManagerImpl]: "+e)},t.prototype._Reset=function(){this._Verbose("Reset()"),this._CleanTimer(),this._lastActiveTime=0,this._rescheduleFactor=1,this._sendingEvents=[],this._eventsCache=new l},t.prototype.__GetListenerArray=function(){return this._listeners},t.prototype.__GetTotalEventsCount=function(){return this._eventsCache.GetTotalEventsCount()},t.prototype.__IsScheduled=function(){return this._timer!=null},t.prototype.__ChageMaxPackageSizeInKB=function(e){this._MaxPackageSizeInBytes=e*1024},t.prototype.__SetTestServerResponseHook=function(e){this._testServerResponseHook=e},t._eventTypeRegex=/^[a-zA-Z0-9]([a-zA-Z0-9]|_){2,98}[a-zA-Z0-9]$/,t._tag=0,t}(),l=function(){function e(){this._events={},this._tokens=[]}return e.prototype.AddEvents=function(e,t){if(!t.length)return;this._events[e]||(this._events[e]=[],this._tokens.push(e)),this._events[e].push.apply(this._events[e],t)},e.prototype.IsEmpty=function(){return this._tokens.length==0},e.prototype.DequeuEvents=function(){if(this._tokens.length==0)return null;var e=this._tokens.shift(),t=this._events[e];return delete this._events[e],{tenantToken:e,events:t}},e.prototype.GetTotalEventsCount=function(){var e=0;for(var t in this._events)e+=this._events[t].length;return e},e}()})(t=e._sender||(e._sender={}))})(t=e.telemetry||(e.telemetry={}))})(t=e.applications||(e.applications={}))})(microsoft||(microsoft={}));var microsoft;(function(e){var t;(function(t){var n;(function(t){var n=t._sender.TelemetryManagerFactory.CreateTelemetryManager(),r=function(){function e(){this.collectorUrl=null,this.enableAutoUserSession=!1,this.browserOverrides=new i}return e}();t.LogConfiguration=r;var i=function(){function e(){this.onSaveData=null,this.onGetData=null}return e}();t.LogConfigurationBrowserOverrides=i;var s=function(){function e(){this.value=null,this.pii=null}return e._isPii=function(e){return e===null||e===undefined||e===t.datamodels.PIIKind.NotSet||isNaN(e)?!1:t.datamodels.PIIKind[e]!==undefined},e}(),o=function(){function e(){this.name=null,this.timestamp=null,this.properties={},this.eventType=null}return e.prototype.setProperty=function(n,r,i){if(!n||!e._propertyNameRegex.test(n))throw new a(u.INVALID_PROPERTY_NAME);i?this.properties[n]={value:r,pii:i!=t.datamodels.PIIKind.NotSet?i:null}:this.properties[n]={value:r,pii:null}},e._propertyNameRegex=/^[a-zA-Z0-9](([a-zA-Z0-9|_|\.]){0,98}[a-zA-Z0-9])?$/,e}();t.EventProperties=o,function(e){e[e.INVALID_TENANT_TOKEN=1]="INVALID_TENANT_TOKEN",e[e.MISSING_EVENT_PROPERTIES_NAME=2]="MISSING_EVENT_PROPERTIES_NAME",e[e.INVALID_PROPERTY_NAME=3]="INVALID_PROPERTY_NAME",e[e.MISSING_FAILURE_SIGNATURE=5]="MISSING_FAILURE_SIGNATURE",e[e.MISSING_FAILURE_DETAIL=6]="MISSING_FAILURE_DETAIL",e[e.MISSING_PAGEVIEW_ID=7]="MISSING_PAGEVIEW_ID",e[e.MISSING_PAGEVIEW_NAME=8]="MISSING_PAGEVIEW_NAME",e[e.INVALID_SESSION_STATE=9]="INVALID_SESSION_STATE",e[e.INVALID_CONFIGURATION_USE_CUSTOM_GET_SET=10]="INVALID_CONFIGURATION_USE_CUSTOM_GET_SET"}(t.TelemetryError||(t.TelemetryError={}));var u=t.TelemetryError,a=function(){function e(e){this.errorCode=null,this.errorCode=e}return e.prototype.ErrorCode=function(){return this.errorCode},e.prototype.toString=function(){switch(this.errorCode){case u.INVALID_TENANT_TOKEN:return"Invalid tenant token";case u.MISSING_EVENT_PROPERTIES_NAME:return"Eventproperties.name can not be null or empty";case u.INVALID_PROPERTY_NAME:return"Invalid Key. Key does not conform to regular expression ^[a-zA-Z0-9](([a-zA-Z0-9|_|.]){0,98}[a-zA-Z0-9])?$";case u.MISSING_FAILURE_SIGNATURE:return"Failure signature can't be null or empty.";case u.MISSING_FAILURE_DETAIL:return"Failure detail can't be null or empty.";case u.MISSING_PAGEVIEW_ID:return"Pageview id can't be null or empty.";case u.MISSING_PAGEVIEW_NAME:return"Pageview name can't be null or empty.";case u.INVALID_SESSION_STATE:return"Session state has to be a value from the SessionState enum.";case u.INVALID_CONFIGURATION_USE_CUSTOM_GET_SET:return"Invalid configuration provided during initialization. Both onGetConfigData and onSaveConfigData must be provided together.  These are manditory when running in a non-brower enviornment";default:return"Unknown error"}},e}();t.Exception=a;var f=function(){function n(e){this.contextMap={},this.piiKind=t.datamodels.PIIKind.NotSet,this._allowDeviceInfoFields=!1,this._allowDeviceInfoFields=e}return n.prototype.setAppId=function(e){e&&(this.contextMap["AppInfo.Id"]=e)},n.prototype.setAppVersion=function(e){e&&(this.contextMap["AppInfo.Version"]=e)},n.prototype.setAppLanguage=function(e){e&&(this.contextMap["AppInfo.Language"]=e)},n.prototype.setDeviceId=function(e){e&&this._allowDeviceInfoFields&&(this.contextMap["DeviceInfo.Id"]=e,l.checkAndUpdateDeviceId(e))},n.prototype.setDeviceOsName=function(e){e&&this._allowDeviceInfoFields&&(this.contextMap["DeviceInfo.OsName"]=e)},n.prototype.setDeviceOsVersion=function(e){e&&this._allowDeviceInfoFields&&(this.contextMap["DeviceInfo.OsVersion"]=e)},n.prototype.setDeviceBrowserName=function(e){e&&this._allowDeviceInfoFields&&(this.contextMap["DeviceInfo.BrowserName"]=e)},n.prototype.setDeviceBrowserVersion=function(e){e&&this._allowDeviceInfoFields&&(this.contextMap["DeviceInfo.BrowserVersion"]=e)},n.prototype.setUserId=function(t,n,r){t&&(this.contextMap["UserInfo.Id"]=t);if(r)this.contextMap["UserInfo.IdType"]=r;else{var i;switch(n){case e.applications.telemetry.datamodels.PIIKind.SipAddress:i=e.applications.telemetry.datamodels.UserIdType.SipAddress;break;case e.applications.telemetry.datamodels.PIIKind.PhoneNumber:i=e.applications.telemetry.datamodels.UserIdType.PhoneNumber;break;case e.applications.telemetry.datamodels.PIIKind.SmtpAddress:i=e.applications.telemetry.datamodels.UserIdType.EmailAddress;break;default:i=e.applications.telemetry.datamodels.UserIdType.Unknown}this.contextMap["UserInfo.IdType"]=i}if(n)s._isPii(n)&&(this.piiKind=n);else{var o;switch(r){case e.applications.telemetry.datamodels.UserIdType.Skype:o=e.applications.telemetry.datamodels.PIIKind.Identity;break;case e.applications.telemetry.datamodels.UserIdType.EmailAddress:o=e.applications.telemetry.datamodels.PIIKind.SmtpAddress;break;case e.applications.telemetry.datamodels.UserIdType.PhoneNumber:o=e.applications.telemetry.datamodels.PIIKind.PhoneNumber;break;case e.applications.telemetry.datamodels.UserIdType.SipAddress:o=e.applications.telemetry.datamodels.PIIKind.SipAddress;break;default:o=e.applications.telemetry.datamodels.PIIKind.NotSet}s._isPii(o)&&(this.piiKind=o)}},n.prototype.setUserMsaId=function(e){e&&(this.contextMap["UserInfo.MsaId"]=e)},n.prototype.setUserANID=function(e){e&&(this.contextMap["UserInfo.ANID"]=e)},n.prototype.setUserAdvertisingId=function(e){e&&(this.contextMap["UserInfo.AdvertisingId"]=e)},n.prototype.setUserTimeZone=function(e){e&&(this.contextMap["UserInfo.TimeZone"]=e)},n.prototype.setUserLanguage=function(e){e&&(this.contextMap["UserInfo.Language"]=e)},n}();t.SemanticContext=f;var l=function(){function e(){}return e.initialize=function(n){this._overrides=n;var r=e._getAppLanguage();r&&e.semanticContext.setAppLanguage(r);var i=e._getUserLanguage();i&&e.semanticContext.setUserLanguage(i);var s=(new Date).getTimezoneOffset(),o=s%60,u=(s-o)/60,a="+";u>0&&(a="-"),u=Math.abs(u),o=Math.abs(o),e.semanticContext.setUserTimeZone(a+(u<10?"0"+u:u.toString())+":"+(o<10?"0"+o:o.toString()));var f=e._getUserAgent();f&&(e.semanticContext.setDeviceBrowserName(e._getBrowserName()),e.semanticContext.setDeviceBrowserVersion(e._getBrowserVersion()),e.semanticContext.setDeviceOsName(e._getOsName()),e.semanticContext.setDeviceOsVersion(e._getOsVersion()));var l=e._getData(e.DEVICE_ID_COOKIE);if(!l||l=="")l=t.datamodels.utils.GetGuid();e.semanticContext.setDeviceId(l)},e.checkAndUpdateDeviceId=function(t){var n=e._getData(e.DEVICE_ID_COOKIE);n!=t&&(e._saveData(e.DEVICE_ID_COOKIE,t),e._saveData(e.FIRST_LAUNCH_TIME_COOKIE,(new Date).getTime().toString()));var r=e._getData(e.FIRST_LAUNCH_TIME_COOKIE);e.firstLaunchTime=parseInt(r)},e._saveData=function(e,t){if(this._overrides.onSaveData)this._overrides.onSaveData(e,t);else if(typeof document!="undefined"&&document.cookie){var n="expires=Mon, 31 Dec 2029 23:59:59 GMT";document.cookie=e+"="+t+"; "+n}},e._getData=function(e){if(this._overrides.onGetData)return this._overrides.onGetData(e)||"";if(typeof document!="undefined"&&document.cookie){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r],s=0;while(i.charAt(s)==" ")s++;i=i.substring(s);if(i.indexOf(t)==0)return i.substring(t.length,i.length)}}return""},e._getUserAgent=function(){return typeof navigator!="undefined"?navigator.userAgent||"":""},e._getAppLanguage=function(){return typeof document!="undefined"&&document.documentElement?document.documentElement.lang:null},e._getUserLanguage=function(){return typeof navigator!="undefined"?navigator.userLanguage||navigator.language:null},e._userAgentContainsString=function(t){return e._getUserAgent().indexOf(t)>-1},e._isIe=function(){return e._userAgentContainsString("Trident")},e._isEdge=function(){return e._userAgentContainsString(e.BROWSERS.EDGE)},e._isOpera=function(){return e._userAgentContainsString("OPR/")},e._getBrowserName=function(){return e._isOpera()?e.BROWSERS.UNKNOWN:e._userAgentContainsString(e.BROWSERS.PHANTOMJS)?e.BROWSERS.PHANTOMJS:e._isEdge()?e.BROWSERS.EDGE:e._userAgentContainsString(e.BROWSERS.ELECTRON)?e.BROWSERS.ELECTRON:e._userAgentContainsString(e.BROWSERS.CHROME)?e.BROWSERS.CHROME:e._userAgentContainsString(e.BROWSERS.FIREFOX)?e.BROWSERS.FIREFOX:e._userAgentContainsString(e.BROWSERS.SAFARI)?e.BROWSERS.SAFARI:e._userAgentContainsString(e.BROWSERS.SKYPE_SHELL)?e.BROWSERS.SKYPE_SHELL:e._isIe()?e.BROWSERS.MSIE:e.BROWSERS.UNKNOWN},e._getBrowserVersion=function(){function t(){var t,n=e._getUserAgent(),r=n.match(new RegExp(e.BROWSERS.MSIE+" "+e.REGEX_VERSION));if(r)return r[1];t=n.match(new RegExp("rv:"+e.REGEX_VERSION));if(t)return t[1]}function n(t){var n;return t===e.BROWSERS.SAFARI&&(t="Version"),n=e._getUserAgent().match(new RegExp(t+"/"+e.REGEX_VERSION)),n?n[1]:e.UNKNOWN_VERSION}return e._isIe()?t():n(e._getBrowserName())},e._getOsName=function(){var t=/(windows|win32)/i,n=/ arm;/i,r=/windows\sphone\s\d+\.\d+/i,i=/(macintosh|mac os x)/i,s=/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i,o=/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,u=/android/i;return e._getUserAgent().match(r)?e.OPERATING_SYSTEMS.WINDOWS_PHONE:e._getUserAgent().match(n)?e.OPERATING_SYSTEMS.WINDOWS_RT:e._getUserAgent().match(s)?e.OPERATING_SYSTEMS.IOS:e._getUserAgent().match(u)?e.OPERATING_SYSTEMS.ANDROID:e._getUserAgent().match(o)?e.OPERATING_SYSTEMS.LINUX:e._getUserAgent().match(i)?e.OPERATING_SYSTEMS.MACOSX:e._getUserAgent().match(t)?e.OPERATING_SYSTEMS.WINDOWS:e.OPERATING_SYSTEMS.UNKNOWN},e._getOsVersion=function(){function t(){var t=e._getUserAgent().match(new RegExp("Windows NT "+e.REGEX_VERSION));return t&&e.VERSION_MAPPINGS[t[1]]?e.VERSION_MAPPINGS[t[1]]:e.UNKNOWN_VERSION}function n(){var t=e._getUserAgent().match(new RegExp(e.OPERATING_SYSTEMS.MACOSX+" "+e.REGEX_VERSION_MAC));if(t){var n=t[1].replace(/_/g,"."),i=[];if(n){var s=r(n);return s?(i=n.split(s),i[0]):n}}return e.UNKNOWN_VERSION}function r(e){return e.indexOf(".")>-1?".":e.indexOf("_")>-1?"_":null}return e._getOsName()===e.OPERATING_SYSTEMS.WINDOWS?t():e._getOsName()===e.OPERATING_SYSTEMS.MACOSX?n():e.UNKNOWN_VERSION},e.semanticContext=new f(!0),e.firstLaunchTime=-1,e.BROWSERS={MSIE:"MSIE",CHROME:"Chrome",FIREFOX:"Firefox",SAFARI:"Safari",EDGE:"Edge",ELECTRON:"Electron",SKYPE_SHELL:"SkypeShell",PHANTOMJS:"PhantomJS",UNKNOWN:"Unknown"},e.OPERATING_SYSTEMS={WINDOWS:"Windows",MACOSX:"Mac OS X",WINDOWS_PHONE:"Windows Phone",WINDOWS_RT:"Windows RT",IOS:"iOS",ANDROID:"Android",LINUX:"Linux",UNKNOWN:"Unknown"},e.VERSION_MAPPINGS={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"},e.REGEX_VERSION="([\\d,.]+)",e.REGEX_VERSION_MAC="([\\d,_,.]+)",e.UNKNOWN_VERSION="Unknown",e.DEVICE_ID_COOKIE="MicrosoftApplicationsTelemetryDeviceId",e.FIRST_LAUNCH_TIME_COOKIE="MicrosoftApplicationsTelemetryFirstLaunchTime",e}();(function(e){e[e.STARTED=0]="STARTED",e[e.ENDED=1]="ENDED"})(t.SessionState||(t.SessionState={}));var c=t.SessionState,h=function(){function e(){}return e.initialize=function(t,r){if(!e._initialized){if(!t)throw new a(u.INVALID_TENANT_TOKEN);e._defaultToken=t,e._tmConfig.collectorUrl="https://browser.pipe.aria.microsoft.com/Collector/3.0/",e._configuration=r;if(typeof window=="undefined"&&(!r||!r.browserOverrides||!r.browserOverrides.onGetData))throw new a(u.INVALID_CONFIGURATION_USE_CUSTOM_GET_SET);var s=new i;if(r){r.collectorUrl&&(e._tmConfig.collectorUrl=r.collectorUrl);if(r.browserOverrides){if(r.browserOverrides.onGetData?!r.browserOverrides.onSaveData:!!r.browserOverrides.onSaveData)throw new a(u.INVALID_CONFIGURATION_USE_CUSTOM_GET_SET);s.onGetData=r.browserOverrides.onGetData,s.onSaveData=r.browserOverrides.onSaveData}}n.Initialize(e._tmConfig),n.Start(),l.initialize(s),e._initialized=!0,typeof window!="undefined"&&window.addEventListener&&r&&r.enableAutoUserSession&&(e._logger=new p,e._logger.logSession(c.STARTED),window.addEventListener("beforeunload",e._teardown))}},e.pauseTransmission=function(){n.Pause()},e.resumeTransmission=function(){n.Resume()},e.flush=function(e){n.Flush(e)},e.addCallbackListener=function(t){e._initialized&&n.AddListener(t)},e.setContext=function(t,n,r){e._contextProperties.setProperty(t,n,r)},e.isInitialized=function(){return e._initialized},e.getDefaultToken=function(){return e._defaultToken},e.getSemanticContext=function(){return e._semanticContext},e._getInitIdForToken=function(n){return e._initIdMap[n]||(e._initIdMap[n]=t.datamodels.utils.GetGuid()),e._initIdMap[n]},e._getSequenceForToken=function(t){return e._sequenceMap[t]||(e._sequenceMap[t]=0),e._sequenceMap[t]++,e._sequenceMap[t]},e._teardown=function(){e._logger&&e._logger.logSession(c.ENDED),e.flush()},e.__backToUninitialized=function(){e._tmConfig=new t._sender.TelemetryConfig,e._semanticContext=new f(!0),e._contextProperties=new o,e._configuration=null,n=t._sender.TelemetryManagerFactory.CreateTelemetryManager(),e._initialized=!1,e._initIdMap={},e._sequenceMap={}},e._initialized=!1,e._defaultToken=null,e._tmConfig=new t._sender.TelemetryConfig,e._logger=null,e._initIdMap={},e._sequenceMap={},e._configuration=null,e._contextProperties=new o,e._semanticContext=new f(!0),e}();t.LogManager=h;var p=function(){function e(e){this._initId=null,this._tenantToken=null,this._contextProperties=new o,this._semanticContext=new f(!1),this._sessionStartTime=0,this._sessionId=null,e?this._tenantToken=e:this._tenantToken=h.getDefaultToken(),this._initId=h._getInitIdForToken(this._tenantToken)}return e.prototype.logEvent=function(e){if(!e.name)throw new a(u.MISSING_EVENT_PROPERTIES_NAME);var t=this._createEventRecord(e.name,e.eventType);this._addPropertiesAndSendEvent(t,e)},e.prototype.logFailure=function(e,t,n,r,i){if(!e)throw new a(u.MISSING_FAILURE_SIGNATURE);if(!t)throw new a(u.MISSING_FAILURE_DETAIL);var s=this._createEventRecord("failure","failure");s.Extension.Add("Failure.Signature",e),s.Extension.Add("Failure.Detail",t),n&&s.Extension.Add("Failure.Category",n),r&&s.Extension.Add("Failure.Id",r),this._addPropertiesAndSendEvent(s,i)},e.prototype.logPageView=function(e,t,n,r,i,s){if(!e)throw new a(u.MISSING_PAGEVIEW_ID);if(!t)throw new a(u.MISSING_PAGEVIEW_NAME);var o=this._createEventRecord("pageview","pageview");o.Extension.Add("PageView.Id",e),o.Extension.Add("PageView.Name",t),n&&o.Extension.Add("PageView.Category",n),r&&o.Extension.Add("PageView.Uri",r),i&&o.Extension.Add("PageView.ReferrerUri",i),this._addPropertiesAndSendEvent(o,s)},e.prototype.logSession=function(e,n){if(e!==c.STARTED&&e!==c.ENDED)throw new a(u.INVALID_SESSION_STATE);var r=this._createEventRecord("session","session");if(e===c.STARTED){if(this._sessionStartTime>0)return;this._sessionStartTime=(new Date).getTime(),this._sessionId=t.datamodels.utils.GetGuid(),r.Extension.Add("Session.Id",this._sessionId),r.Extension.Add("Session.State","Started")}else if(e===c.ENDED){if(this._sessionStartTime==0)return;var i=Math.floor(((new Date).getTime()-this._sessionStartTime)/1e3);r.Extension.Add("Session.Duration",i.toString()),r.Extension.Add("Session.DurationBucket",this._getSessionDurationFromTime(i)),r.Extension.Add("Session.Id",this._sessionId),r.Extension.Add("Session.State","Ended"),this._sessionId=null,this._sessionStartTime=0}r.Extension.Add("Session.FirstLaunchTime",this._getISOString(new Date(l.firstLaunchTime))),this._addPropertiesAndSendEvent(r,n)},e.prototype.getSessionId=function(){return this._sessionId},e.prototype.setContext=function(e,t,n){this._contextProperties.setProperty(e,t,n)},e.prototype.getSemanticContext=function(){return this._semanticContext},e.prototype._getSessionDurationFromTime=function(e){return e<0?"Undefined":e<=3?"UpTo3Sec":e<=10?"UpTo10Sec":e<=30?"UpTo30Sec":e<=60?"UpTo60Sec":e<=180?"UpTo3Min":e<=600?"UpTo10Min":e<=1800?"UpTo30Min":"Above30Min"},e.prototype._createEventRecord=function(e,n){var r=new t.datamodels.Record;n||(n="custom"),r.EventType=e.toLowerCase(),r.Type=n.toLowerCase(),r.Extension.Add("EventInfo.Source","JS_default_source"),r.Extension.Add("EventInfo.InitId",this._initId),r.Extension.Add("EventInfo.Sequence",h._getSequenceForToken(this._tenantToken).toString()),r.Extension.Add("EventInfo.Name",e.toLowerCase());var i=new Date;return r.Timestamp=t.datamodels.utils.GetTimeStampWithValue(i.getTime()),r.Extension.Add("EventInfo.Time",this._getISOString(i)),r.Extension.Add("EventInfo.SdkVersion","ACT-Web-JS-"+clienttelemetry_build.version),r},e.prototype._getISOString=function(e){function t(e){return e<10?"0"+e:e.toString()}function n(e){return e<10?"00"+e:e<100?"0"+e:e.toString()}return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+n(e.getUTCMilliseconds())+"Z"},e.prototype._addCustomPropertiesToEvent=function(e,t){this._addSemanticContext(e,l.semanticContext),this._addSemanticContext(e,h._semanticContext),this._addSemanticContext(e,this._semanticContext),this._sessionId&&e.Extension.Add("Session.Id",this._sessionId),this._addEventPropertiesToEvent(e,h._contextProperties),this._addEventPropertiesToEvent(e,this._contextProperties),this._addEventPropertiesToEvent(e,t)},e.prototype._addSemanticContext=function(e,n){if(n&&n.contextMap){var r=n.contextMap;for(var i in n.contextMap)i=="UserInfo.Id"&&n.piiKind!=t.datamodels.PIIKind.NotSet?e.AddOrReplacePII(i,r[i],n.piiKind):e.Extension.AddOrReplace(i,r[i])}},e.prototype._addEventPropertiesToEvent=function(e,n){if(n){n.timestamp&&n.timestamp>=(new Date("1/1/2000")).getTime()&&(e.Timestamp=t.datamodels.utils.GetTimeStampWithValue(n.timestamp),e.Extension.AddOrReplace("EventInfo.Time",this._getISOString(new Date(n.timestamp)))),n.name&&(e.EventType=n.name.toLowerCase(),e.Extension.AddOrReplace("EventInfo.Name",n.name.toLowerCase()));var r=n.properties;if(r)for(var i in r)i&&(r[i].value||r[i].value===!1||r[i].value==0||r[i].value=="")&&(s._isPii(r[i].pii)?(e.AddOrReplacePII(i,r[i].value.toString(),r[i].pii),e.Extension.Remove(i)):(e.Extension.AddOrReplace(i,r[i].value.toString()),e.PIIExtensions.Remove(i)))}},e.prototype._addPropertiesAndSendEvent=function(e,t){this._addCustomPropertiesToEvent(e,t),h.isInitialized()&&(this._sanitizeName(e),n.SendAsync(this._tenantToken,[e]))},e.prototype._sanitizeName=function(e){var t=e.EventType.replace(/\./g,"_");e.EventType=t,e.Extension.AddOrReplace("EventInfo.Name",t)},e}();t.Logger=p})(n=t.telemetry||(t.telemetry={}))})(t=e.applications||(e.applications={}))})(microsoft||(microsoft={})),define("microsoft-aria",["microsoft-aria/lib/aria"],function(e){return e}),define("microsoft-aria/lib/aria",function(){}),define("telemetry/manager/telemetryManager",["require","microsoft-aria","usertiming","lodash-compat","experience/settings"],function(e){function s(){function h(e){if(typeof e!="string")throw"Performance telemetry mark name must be a string";return{start:e+"_start",end:e+"_end",measurement:e+"_ttc",context:e+"_context"}}function p(e){t.clearMarks(e.start),t.clearMarks(e.end),t.clearMeasures(e.measurement)}function d(e){return t.getEntriesByName(e).length>0}function v(e,t){Object.keys(t).forEach(function(n){var r=t[n];if(Array.isArray(r)){if(!g(r[0]))throw new Error("Value should be string, number or boolean.");if(typeof r[1]!="number")throw new Error("PIIType should be number");e.setProperty(n,y(r[0]),r[1])}else g(r)&&e.setProperty(n,y(r),i.skypeTelemetryManager.PIIType.NotSet)})}function m(t){Object.keys(e).forEach(function(n){var r=e[n],i=typeof r[0]=="function"?r[0]():r[0];t.setProperty(n,y(i),r[1])})}function g(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"}function y(e){return e+""}var e={},s={},o={},u={},a,f=604800,l=!0,c=this;c.enabled=function(e){l=e},c.setCommonProperty=function(t,n,r){if(typeof t!="string")throw new Error("Property name should be string");if(typeof r!="undefined"&&typeof r!="number")throw new Error("PIIType should be number");if(!g(n)&&typeof n!="function")throw new Error("Value should be string, number, boolean or function.");var s=typeof r=="undefined"?i.skypeTelemetryManager.PIIType.NotSet:r;e[t]=[n,s]},c.setSkypeUserId=function(e){c.setCommonProperty("user_id",e,i.skypeTelemetryManager.PIIType.Identity),c.setCommonProperty("Skype_InitiatingUser_Username",e)},c.sendEvent=function(e,t,n){if(!l)return;if(typeof e!="string")throw new Error("Tenant ID should be string");if(typeof t!="string")throw new Error("Event name should be string");c._getLogger(e);var r=new microsoft.applications.telemetry.EventProperties;r.name=t,v(r,n),m(r),o[e].logEvent(r)},c.flush=function(){microsoft.applications.telemetry.LogManager.flush()},c.setAppProperties=function(e){a=e},c.traceStart=function(e,n){var r=h(e);(d(r.start)||d(r.end))&&p(r),t.mark(r.start),s[r.context]=n},c.traceEnd=function(e,r){var i=h(e);d(i.end)&&(t.clearMarks(i.end),t.clearMeasures(i.measurement)),d(i.start)&&(t.mark(i.end),t.measure(i.measurement,i.start,i.end),s[i.context]=s[i.context]||{},n.merge(s[i.context],r))},c.traceDump=function(e){var n=h(e),r={duration:undefined,startTime:undefined};d(n.start)&&!d(n.end)&&c.traceEnd(e);if(d(n.measurement)){var i=t.getEntriesByName(n.measurement)[0].duration,o=t.now()-t.getEntriesByName(n.end)[0].startTime,u=o+i;i>1&&u<f&&(r.duration=Math.round(i),r.startTime=Math.round(Date.now()-u),r.context=s[n.context])}return p(n),s[n.context]=undefined,r},c._getLogger=function(e){return o[e]||(microsoft.applications.telemetry.LogManager.initialize(e),o[e]=new microsoft.applications.telemetry.Logger(e),u[e]=o[e].getSemanticContext(),u[e].setAppVersion(a),o[e]._semanticContext.setAppLanguage(r.applicationLanguage)),o[e]},c._getEventProperties=function(){return new microsoft.applications.telemetry.EventProperties}}e("microsoft-aria");var t=e("usertiming"),n=e("lodash-compat"),r=e("experience/settings"),i=window;i.skypeTelemetryManager||(i.skypeTelemetryManager={}),i.skypeTelemetryManager.PIIType={NotSet:0,DistinguishedName:1,GenericData:2,IPV4Address:3,IPv6Address:4,MailSubject:5,PhoneNumber:6,QueryString:7,SipAddress:8,SmtpAddress:9,Identity:10,Uri:11,Fqdn:12,IPV4AddressLegacy:13},i.skypeTelemetryManager.create=function(){return new s}}),define("ui/session/localSession",["require","exports","module","swx-utils-common","swx-utils-common"],function(e,t){var n=e("swx-utils-common").guid,r=e("swx-utils-common").sessionStorage,i={},s,o=n.create(),u="swx-sessionid";t.getSessionId=function(){return s?s:(s=r.get(u),s||(s=n.create(),r.set(u,s)),s)},t.getTabSessionId=function(){return o},t.setTelemetrySessionValue=function(e,t){if(!t)throw new Error("You are trying to set session parameter with a null value. Key:"+e);i[e]=t},t.getTelemetrySessionKeyValuePairs=function(){var e={};for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t]);return e}}),define("ui/telemetry/telemetryClient",["require","exports","module","telemetry/manager/telemetryManager","experience/settings","swx-browser-globals","ui/session/localSession","swx-browser-detect","swx-constants/lib/common","swx-service-locator-instance"],function(e,t){function f(e){w(e,"session_id",i.getSessionId()),w(e,"tab_session_id",i.getTabSessionId())}function l(e){var t=s.getBrowserInfo();e.setCommonProperty("user_agent_name",t.browserName),e.setCommonProperty("user_agent_version",t.browserMajorVersion)}function c(e){var t=s.getSystemInfo();e.setCommonProperty("user_agent_OS",t.osName),e.setCommonProperty("user_agent_OS_version",t.osVersion),e.setCommonProperty("device_type",t.deviceType)}function h(e){var t=s.getScreenInfo();e.setCommonProperty("screen_width",t.width),e.setCommonProperty("screen_height",t.height)}function p(e){n.eTag&&e.setCommonProperty("etag",n.eTag),n.configIds&&n.configIds.length>0&&e.setCommonProperty("cfg_ids",n.configIds+"")}function d(e){return n.telemetry.upnCorrelationIdEnabled?-1:e.indexOf("upn")}function v(e){var t=0,r=128,i=10,s=-1,o=[];if(!n.initParams||!n.initParams.correlationIds)return;o=Object.keys(n.initParams.correlationIds),s=d(o),s>-1&&o.splice(s,1),o.forEach(function(s){t++;var o=n.initParams.correlationIds[s];o&&o!==""&&o.length<=r&&t<=i&&e.setCommonProperty("cid_"+s,o)})}function m(e){n.initParams&&(w(e,"environment_id",n.initParams.environment),w(e,"api_key",n.initParams.apiKey),w(e,"locale",n.initParams.locale)),e.setCommonProperty("ui_version",n.uiVersion),e.setCommonProperty("version",n.version),e.setCommonProperty("property",n.biAppName),e.setCommonProperty("Client_Name",n.biClientName)}function g(e){var t;if(!n.telemetry.selectedTargets)return;t=r.getWindow().location.hostname;for(var i=0;i<n.telemetry.selectedTargets.length;i++){var s=new RegExp(n.telemetry.selectedTargets[i]);if(s.test(t)){e.setCommonProperty("selected_target",!0);break}}}function y(e){function t(){var e=r.getWindow().Notification;return e&&e.permission==="granted"?!0:!1}e.setCommonProperty("browser_notifications_enabled",t)}function b(e){var t=u.resolve(o.serviceLocator.FEATURE_FLAGS);if(t.isFeatureOn(o.featureFlags.TELEMETRY_CAPTURE_SOURCE_ENABLED)){var n=s.getBrowserInfo().getUrlParams(),r=n&&n.source&&n.source.length<=20&&n.source.match(/^[a-z0-9]+$/i);r&&e.setCommonProperty("source",n.source.toLowerCase())}}function w(e,t,n){if(!n)return;e.setCommonProperty(t,n)}function E(e){e.setAppProperties(n.version),f(e),l(e),c(e),h(e),v(e),m(e),p(e),g(e),y(e),b(e)}e("telemetry/manager/telemetryManager");var n=e("experience/settings"),r=e("swx-browser-globals"),i=e("ui/session/localSession"),s=e("swx-browser-detect").default,o=e("swx-constants/lib/common").default,u=e("swx-service-locator-instance").default,a;t.reset=function(){a=null},t.get=function(){return a||(a=r.getWindow().skypeTelemetryManager.create(),E(a)),a}}),define("services/telemetry/skypeData",["require","exports","module","swx-log-tracer","experience/settings","ui/telemetry/telemetryClient"],function(e,t){function s(e,t){var n,r={},i=/([A-Z])/g;for(n in e.contextIds)if(e.contextIds.hasOwnProperty(n)){var s=n.replace(i,"_$1");o(t,s.toLowerCase(),e.contextIds[n])}return r}function o(e,t,n){var r=typeof n=="string"?n:String(n);e[t]=r}function u(e,t,n,r){typeof r=="object"?Object.keys(r).forEach(function(i){u(e,t,n+"_"+i,r[i])}):o(e,n,r)}function a(e,t){var n=e.data||{},r={};Object.keys(n).forEach(function(e){u(t,r,e,n[e])})}function f(e){return e.type?e.data?!0:(n.warn("Event "+e.type+" has an empty data payload. This is going to be ignored"),!1):(n.warn("An event was sent with no type defined. This is going to be ignored"),!1)}function l(e){var t={};return a(e,t),s(e,t),t}var n=e("swx-log-tracer").getLogger(),r=e("experience/settings"),i=e("ui/telemetry/telemetryClient");t.push=function(e,t){if(!f(e))return;t||(t=r.telemetry.uiTenantToken);var n=l(e);i.get().sendEvent(t,e.type,n)}}),function(){(function(n){var x=this||(0,eval)("this"),u=x.document,M=x.navigator,v=x.jQuery,F=x.JSON;(function(e){"function"==typeof define&&define.amd?define("vendor/knockout",["exports","require"],e):"object"==typeof exports&&"object"==typeof module?e(module.exports||exports):e(x.ko={})})(function(e,t){function r(e,t){return null===e||typeof e in h?e===t:!1}function i(e,t){var r;return function(){r||(r=c.a.setTimeout(function(){r=n,e()},t))}}function s(e,t){var n;return function(){clearTimeout(n),n=c.a.setTimeout(e,t)}}function o(e,t){t&&t!==p?"beforeChange"===t?this.Kb(e):this.Ha(e,t):this.Lb(e)}function a(e,t){null!==t&&t.k&&t.k()}function f(e,t){var n=this.Hc,r=n[b];r.R||(this.lb&&this.Ma[t]?(n.Pb(t,e,this.Ma[t]),this.Ma[t]=null,--this.lb):r.r[t]||n.Pb(t,e,r.s?{ia:e}:n.uc(e)))}function l(e,t,n,r){c.d[e]={init:function(e,i,s,o,u){var a,f;return c.m(function(){var s=c.a.c(i()),o=!n!=!s,l=!f;if(l||t||o!==a)l&&c.va.Aa()&&(f=c.a.ua(c.f.childNodes(e),!0)),o?(l||c.f.da(e,c.a.ua(f)),c.eb(r?r(u,s):u,e)):c.f.xa(e),a=o},null,{i:e}),{controlsDescendantBindings:!0}}},c.h.ta[e]=!1,c.f.Z[e]=!0}var c="undefined"!=typeof e?e:{};c.b=function(e,t){for(var n=e.split("."),r=c,i=0;i<n.length-1;i++)r=r[n[i]];r[n[n.length-1]]=t},c.G=function(e,t,n){e[t]=n},c.version="3.4.0",c.b("version",c.version),c.options={deferUpdates:!1,useOnlyNativeEvents:!1},c.a=function(){function e(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}function t(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function r(e,t){return e.__proto__=t,e}function i(e,t,n,r){var i=e[t].match(p)||[];c.a.q(n.match(p),function(e){c.a.pa(i,e,r)}),e[t]=i.join(" ")}var s={__proto__:[]}instanceof Array,o="function"==typeof Symbol,a={},f={};a[M&&/Firefox\/2/i.test(M.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"],a.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" "),e(a,function(e,t){if(t.length)for(var n=0,r=t.length;n<r;n++)f[t[n]]=e});var l={propertychange:!0},h=u&&function(){for(var e=3,t=u.createElement("div"),r=t.getElementsByTagName("i");t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->",r[0];);return 4<e?e:n}(),p=/\S+/g;return{cc:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],q:function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)},o:function(e,t){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},Sb:function(e,t,n){for(var r=0,i=e.length;r<i;r++)if(t.call(n,e[r],r))return e[r];return null},La:function(e,t){var n=c.a.o(e,t);0<n?e.splice(n,1):0===n&&e.shift()},Tb:function(e){e=e||[];for(var t=[],n=0,r=e.length;n<r;n++)0>c.a.o(t,e[n])&&t.push(e[n]);return t},fb:function(e,t){e=e||[];for(var n=[],r=0,i=e.length;r<i;r++)n.push(t(e[r],r));return n},Ka:function(e,t){e=e||[];for(var n=[],r=0,i=e.length;r<i;r++)t(e[r],r)&&n.push(e[r]);return n},ra:function(e,t){if(t instanceof Array)e.push.apply(e,t);else for(var n=0,r=t.length;n<r;n++)e.push(t[n]);return e},pa:function(e,t,n){var r=c.a.o(c.a.zb(e),t);0>r?n&&e.push(t):n||e.splice(r,1)},ka:s,extend:t,Xa:r,Ya:s?r:t,D:e,Ca:function(e,t){if(!e)return e;var n={},r;for(r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r],r,e));return n},ob:function(e){for(;e.firstChild;)c.removeNode(e.firstChild)},jc:function(e){e=c.a.V(e);for(var t=(e[0]&&e[0].ownerDocument||u).createElement("div"),n=0,r=e.length;n<r;n++)t.appendChild(c.$(e[n]));return t},ua:function(e,t){for(var n=0,r=e.length,i=[];n<r;n++){var s=e[n].cloneNode(!0);i.push(t?c.$(s):s)}return i},da:function(e,t){c.a.ob(e);if(t)for(var n=0,r=t.length;n<r;n++)e.appendChild(t[n])},qc:function(e,t){var n=e.nodeType?[e]:e;if(0<n.length){for(var r=n[0],i=r.parentNode,s=0,o=t.length;s<o;s++)i.insertBefore(t[s],r);s=0;for(o=n.length;s<o;s++)c.removeNode(n[s])}},za:function(e,t){if(e.length){for(t=8===t.nodeType&&t.parentNode||t;e.length&&e[0].parentNode!==t;)e.splice(0,1);for(;1<e.length&&e[e.length-1].parentNode!==t;)e.length--;if(1<e.length){var n=e[0],r=e[e.length-1];for(e.length=0;n!==r;)e.push(n),n=n.nextSibling;e.push(r)}}return e},sc:function(e,t){7>h?e.setAttribute("selected",t):e.selected=t},$a:function(e){return null===e||e===n?"":e.trim?e.trim():e.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},nd:function(e,t){return e=e||"",t.length>e.length?!1:e.substring(0,t.length)===t},Mc:function(e,t){if(e===t)return!0;if(11===e.nodeType)return!1;if(t.contains)return t.contains(3===e.nodeType?e.parentNode:e);if(t.compareDocumentPosition)return 16==(t.compareDocumentPosition(e)&16);for(;e&&e!=t;)e=e.parentNode;return!!e},nb:function(e){return c.a.Mc(e,e.ownerDocument.documentElement)},Qb:function(e){return!!c.a.Sb(e,c.a.nb)},A:function(e){return e&&e.tagName&&e.tagName.toLowerCase()},Wb:function(e){return c.onError?function(){try{return e.apply(this,arguments)}catch(t){throw c.onError&&c.onError(t),t}}:e},setTimeout:function(e,t){return setTimeout(c.a.Wb(e),t)},$b:function(e){setTimeout(function(){throw c.onError&&c.onError(e),e},0)},p:function(e,t,n){var r=c.a.Wb(n);n=h&&l[t];if(c.options.useOnlyNativeEvents||n||!v)if(n||"function"!=typeof e.addEventListener){if("undefined"==typeof e.attachEvent)throw Error("Browser doesn't support addEventListener or attachEvent");var i=function(t){r.call(e,t)},s="on"+t;e.attachEvent(s,i),c.a.F.oa(e,function(){e.detachEvent(s,i)})}else e.addEventListener(t,r,!1);else v(e).bind(t,r)},Da:function(e,t){if(!e||!e.nodeType)throw Error("element must be a DOM node when calling triggerEvent");var n;"input"===c.a.A(e)&&e.type&&"click"==t.toLowerCase()?(n=e.type,n="checkbox"==n||"radio"==n):n=!1;if(c.options.useOnlyNativeEvents||!v||n)if("function"==typeof u.createEvent){if("function"!=typeof e.dispatchEvent)throw Error("The supplied element doesn't support dispatchEvent");n=u.createEvent(f[t]||"HTMLEvents"),n.initEvent(t,!0,!0,x,0,0,0,0,0,!1,!1,!1,!1,0,e),e.dispatchEvent(n)}else if(n&&e.click)e.click();else{if("undefined"==typeof e.fireEvent)throw Error("Browser doesn't support triggering events");e.fireEvent("on"+t)}else v(e).trigger(t)},c:function(e){return c.H(e)?e():e},zb:function(e){return c.H(e)?e.t():e},bb:function(e,t,n){var r;t&&("object"==typeof e.classList?(r=e.classList[n?"add":"remove"],c.a.q(t.match(p),function(t){r.call(e.classList,t)})):"string"==typeof e.className.baseVal?i(e.className,"baseVal",t,n):i(e,"className",t,n))},Za:function(e,t){var r=c.a.c(t);if(null===r||r===n)r="";var i=c.f.firstChild(e);!i||3!=i.nodeType||c.f.nextSibling(i)?c.f.da(e,[e.ownerDocument.createTextNode(r)]):i.data=r,c.a.Rc(e)},rc:function(e,t){e.name=t;if(7>=h)try{e.mergeAttributes(u.createElement("<input name='"+e.name+"'/>"),!1)}catch(n){}},Rc:function(e){9<=h&&(e=1==e.nodeType?e:e.parentNode,e.style&&(e.style.zoom=e.style.zoom))},Nc:function(e){if(h){var t=e.style.width;e.style.width=0,e.style.width=t}},hd:function(e,t){e=c.a.c(e),t=c.a.c(t);for(var n=[],r=e;r<=t;r++)n.push(r);return n},V:function(e){for(var t=[],n=0,r=e.length;n<r;n++)t.push(e[n]);return t},Yb:function(e){return o?Symbol(e):e},rd:6===h,sd:7===h,C:h,ec:function(e,t){for(var n=c.a.V(e.getElementsByTagName("input")).concat(c.a.V(e.getElementsByTagName("textarea"))),r="string"==typeof t?function(e){return e.name===t}:function(e){return t.test(e.name)},i=[],s=n.length-1;0<=s;s--)r(n[s])&&i.push(n[s]);return i},ed:function(e){return"string"==typeof e&&(e=c.a.$a(e))?F&&F.parse?F.parse(e):(new Function("return "+e))():null},Eb:function(e,t,n){if(!F||!F.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return F.stringify(c.a.c(e),t,n)},fd:function(t,n,r){r=r||{};var i=r.params||{},s=r.includeFields||this.cc,o=t;if("object"==typeof t&&"form"===c.a.A(t))for(var o=t.action,a=s.length-1;0<=a;a--)for(var f=c.a.ec(t,s[a]),l=f.length-1;0<=l;l--)i[f[l].name]=f[l].value;n=c.a.c(n);var h=u.createElement("form");h.style.display="none",h.action=o,h.method="post";for(var p in n)t=u.createElement("input"),t.type="hidden",t.name=p,t.value=c.a.Eb(c.a.c(n[p])),h.appendChild(t);e(i,function(e,t){var n=u.createElement("input");n.type="hidden",n.name=e,n.value=t,h.appendChild(n)}),u.body.appendChild(h),r.submitter?r.submitter(h):h.submit(),setTimeout(function(){h.parentNode.removeChild(h)},0)}}}(),c.b("utils",c.a),c.b("utils.arrayForEach",c.a.q),c.b("utils.arrayFirst",c.a.Sb),c.b("utils.arrayFilter",c.a.Ka),c.b("utils.arrayGetDistinctValues",c.a.Tb),c.b("utils.arrayIndexOf",c.a.o),c.b("utils.arrayMap",c.a.fb),c.b("utils.arrayPushAll",c.a.ra),c.b("utils.arrayRemoveItem",c.a.La),c.b("utils.extend",c.a.extend),c.b("utils.fieldsIncludedWithJsonPost",c.a.cc),c.b("utils.getFormFields",c.a.ec),c.b("utils.peekObservable",c.a.zb),c.b("utils.postJson",c.a.fd),c.b("utils.parseJson",c.a.ed),c.b("utils.registerEventHandler",c.a.p),c.b("utils.stringifyJson",c.a.Eb),c.b("utils.range",c.a.hd),c.b("utils.toggleDomNodeCssClass",c.a.bb),c.b("utils.triggerEvent",c.a.Da),c.b("utils.unwrapObservable",c.a.c),c.b("utils.objectForEach",c.a.D),c.b("utils.addOrRemoveItem",c.a.pa),c.b("utils.setTextContent",c.a.Za),c.b("unwrap",c.a.c),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if(1===arguments.length)return function(){return t.apply(e,arguments)};var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice(0);return r.push.apply(r,arguments),t.apply(e,r)}}),c.a.e=new function(){function e(e,s){var o=e[r];if(!o||"null"===o||!i[o]){if(!s)return n;o=e[r]="ko"+t++,i[o]={}}return i[o]}var t=0,r="__ko__"+(new Date).getTime(),i={};return{get:function(t,r){var i=e(t,!1);return i===n?n:i[r]},set:function(t,r,i){if(i!==n||e(t,!1)!==n)e(t,!0)[r]=i},clear:function(e){var t=e[r];return t?(delete i[t],e[r]=null,!0):!1},I:function(){return t++ +r}}},c.b("utils.domData",c.a.e),c.b("utils.domData.clear",c.a.e.clear),c.a.F=new function(){function e(e,t){var i=c.a.e.get(e,r);return i===n&&t&&(i=[],c.a.e.set(e,r,i)),i}function t(n){var r=e(n,!1);if(r)for(var r=r.slice(0),i=0;i<r.length;i++)r[i](n);c.a.e.clear(n),c.a.F.cleanExternalData(n);if(s[n.nodeType])for(r=n.firstChild;n=r;)r=n.nextSibling,8===n.nodeType&&t(n)}var r=c.a.e.I(),i={1:!0,8:!0,9:!0},s={1:!0,9:!0};return{oa:function(t,n){if("function"!=typeof n)throw Error("Callback must be a function");e(t,!0).push(n)},pc:function(t,i){var s=e(t,!1);s&&(c.a.La(s,i),0==s.length&&c.a.e.set(t,r,n))},$:function(e){if(i[e.nodeType]&&(t(e),s[e.nodeType])){var n=[];c.a.ra(n,e.getElementsByTagName("*"));for(var r=0,o=n.length;r<o;r++)t(n[r])}return e},removeNode:function(e){c.$(e),e.parentNode&&e.parentNode.removeChild(e)},cleanExternalData:function(e){v&&"function"==typeof v.cleanData&&v.cleanData([e])}}},c.$=c.a.F.$,c.removeNode=c.a.F.removeNode,c.b("cleanNode",c.$),c.b("removeNode",c.removeNode),c.b("utils.domNodeDisposal",c.a.F),c.b("utils.domNodeDisposal.addDisposeCallback",c.a.F.oa),c.b("utils.domNodeDisposal.removeDisposeCallback",c.a.F.pc),function(){var e=[0,"",""],t=[1,"<table>","</table>"],r=[3,"<table><tbody><tr>","</tr></tbody></table>"],i=[1,"<select multiple='multiple'>","</select>"],s={thead:t,tbody:t,tfoot:t,tr:[2,"<table><tbody>","</tbody></table>"],td:r,th:r,option:i,optgroup:i},o=8>=c.a.C;c.a.ma=function(t,n){var r;if(v){if(v.parseHTML)r=v.parseHTML(t,n)||[];else if((r=v.clean([t],n))&&r[0]){for(var i=r[0];i.parentNode&&11!==i.parentNode.nodeType;)i=i.parentNode;i.parentNode&&i.parentNode.removeChild(i)}}else{(r=n)||(r=u);var i=r.parentWindow||r.defaultView||x,a=c.a.$a(t).toLowerCase(),f=r.createElement("div"),l;l=(a=a.match(/^<([a-z]+)[ >]/))&&s[a[1]]||e,a=l[0],l="ignored<div>"+l[1]+t+l[2]+"</div>","function"==typeof i.innerShiv?f.appendChild(i.innerShiv(l)):(o&&r.appendChild(f),f.innerHTML=l,o&&f.parentNode.removeChild(f));for(;a--;)f=f.lastChild;r=c.a.V(f.lastChild.childNodes)}return r},c.a.Cb=function(e,t){c.a.ob(e),t=c.a.c(t);if(null!==t&&t!==n)if("string"!=typeof t&&(t=t.toString()),v)v(e).html(t);else for(var r=c.a.ma(t,e.ownerDocument),i=0;i<r.length;i++)e.appendChild(r[i])}}(),c.b("utils.parseHtmlFragment",c.a.ma),c.b("utils.setHtml",c.a.Cb),c.M=function(){function e(t,n){if(t)if(8==t.nodeType){var r=c.M.lc(t.nodeValue);null!=r&&n.push({Lc:t,cd:r})}else if(1==t.nodeType)for(var r=0,i=t.childNodes,s=i.length;r<s;r++)e(i[r],n)}var t={};return{wb:function(e){if("function"!=typeof e)throw Error("You can only pass a function to ko.memoization.memoize()");var n=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);return t[n]=e,"<!--[ko_memo:"+n+"]-->"},xc:function(e,r){var i=t[e];if(i===n)throw Error("Couldn't find any memo with ID "+e+". Perhaps it's already been unmemoized.");try{return i.apply(null,r||[]),!0}finally{delete t[e]}},yc:function(t,n){var r=[];e(t,r);for(var i=0,s=r.length;i<s;i++){var o=r[i].Lc,u=[o];n&&c.a.ra(u,n),c.M.xc(r[i].cd,u),o.nodeValue="",o.parentNode&&o.parentNode.removeChild(o)}},lc:function(e){return(e=e.match(/^\[ko_memo\:(.*?)\]$/))?e[1]:null}}}(),c.b("memoization",c.M),c.b("memoization.memoize",c.M.wb),c.b("memoization.unmemoize",c.M.xc),c.b("memoization.parseMemoText",c.M.lc),c.b("memoization.unmemoizeDomNodeAndDescendants",c.M.yc),c.Y=function(){function e(){if(r)for(var e=r,t=0,i;s<r;)if(i=n[s++]){if(s>e){if(5e3<=++t){s=r,c.a.$b(Error("'Too much recursion' after processing "+t+" task groups."));break}e=r}try{i()}catch(o){c.a.$b(o)}}}function t(){e(),s=r=n.length=0}var n=[],r=0,i=1,s=0;return{scheduler:x.MutationObserver?function(e){var t=u.createElement("div");return(new MutationObserver(e)).observe(t,{attributes:!0}),function(){t.classList.toggle("foo")}}(t):u&&"onreadystatechange"in u.createElement("script")?function(e){var t=u.createElement("script");t.onreadystatechange=function(){t.onreadystatechange=null,u.documentElement.removeChild(t),t=null,e()},u.documentElement.appendChild(t)}:function(e){setTimeout(e,0)},Wa:function(e){return r||c.Y.scheduler(t),n[r++]=e,i++},cancel:function(e){e-=i-r,e>=s&&e<r&&(n[e]=null)},resetForTesting:function(){var e=r-s;return s=r=n.length=0,e},md:e}}(),c.b("tasks",c.Y),c.b("tasks.schedule",c.Y.Wa),c.b("tasks.runEarly",c.Y.md),c.ya={throttle:function(e,t){e.throttleEvaluation=t;var n=null;return c.B({read:e,write:function(r){clearTimeout(n),n=c.a.setTimeout(function(){e(r)},t)}})},rateLimit:function(e,t){var n,r,o;"number"==typeof t?n=t:(n=t.timeout,r=t.method),e.cb=!1,o="notifyWhenChangesStop"==r?s:i,e.Ta(function(e){return o(e,n)})},deferred:function(e,t){if(!0!==t)throw Error("The 'deferred' extender only accepts the value 'true', because it is not supported to turn deferral off once enabled.");e.cb||(e.cb=!0,e.Ta(function(t){var r;return function(){c.Y.cancel(r),r=c.Y.Wa(t),e.notifySubscribers(n,"dirty")}}))},notify:function(e,t){e.equalityComparer="always"==t?null:r}};var h={"undefined":1,"boolean":1,number:1,string:1};c.b("extenders",c.ya),c.vc=function(e,t,n){this.ia=e,this.gb=t,this.Kc=n,this.R=!1,c.G(this,"dispose",this.k)},c.vc.prototype.k=function(){this.R=!0,this.Kc()},c.J=function(){c.a.Ya(this,d),d.rb(this)};var p="change",d={rb:function(e){e.K={},e.Nb=1},X:function(e,t,n){var r=this;n=n||p;var i=new c.vc(r,t?e.bind(t):e,function(){c.a.La(r.K[n],i),r.Ia&&r.Ia(n)});return r.sa&&r.sa(n),r.K[n]||(r.K[n]=[]),r.K[n].push(i),i},notifySubscribers:function(e,t){t=t||p,t===p&&this.zc();if(this.Pa(t))try{c.l.Ub();for(var n=this.K[t].slice(0),r=0,i;i=n[r];++r)i.R||i.gb(e)}finally{c.l.end()}},Na:function(){return this.Nb},Uc:function(e){return this.Na()!==e},zc:function(){++this.Nb},Ta:function(e){var t=this,n=c.H(t),r,i,s;t.Ha||(t.Ha=t.notifySubscribers,t.notifySubscribers=o);var u=e(function(){t.Mb=!1,n&&s===t&&(s=t()),r=!1,t.tb(i,s)&&t.Ha(i=s)});t.Lb=function(e){t.Mb=r=!0,s=e,u()},t.Kb=function(e){r||(i=e,t.Ha(e,"beforeChange"))}},Pa:function(e){return this.K[e]&&this.K[e].length},Sc:function(e){if(e)return this.K[e]&&this.K[e].length||0;var t=0;return c.a.D(this.K,function(e,n){"dirty"!==e&&(t+=n.length)}),t},tb:function(e,t){return!this.equalityComparer||!this.equalityComparer(e,t)},extend:function(e){var t=this;return e&&c.a.D(e,function(e,n){var r=c.ya[e];"function"==typeof r&&(t=r(t,n)||t)}),t}};c.G(d,"subscribe",d.X),c.G(d,"extend",d.extend),c.G(d,"getSubscriptionsCount",d.Sc),c.a.ka&&c.a.Xa(d,Function.prototype),c.J.fn=d,c.hc=function(e){return null!=e&&"function"==typeof e.X&&"function"==typeof e.notifySubscribers},c.b("subscribable",c.J),c.b("isSubscribable",c.hc),c.va=c.l=function(){function e(e){n.push(r),r=e}function t(){r=n.pop()}var n=[],r,i=0;return{Ub:e,end:t,oc:function(e){if(r){if(!c.hc(e))throw Error("Only subscribable things can act as dependencies");r.gb.call(r.Gc,e,e.Cc||(e.Cc=++i))}},w:function(n,r,i){try{return e(),n.apply(r,i||[])}finally{t()}},Aa:function(){if(r)return r.m.Aa()},Sa:function(){if(r)return r.Sa}}}(),c.b("computedContext",c.va),c.b("computedContext.getDependenciesCount",c.va.Aa),c.b("computedContext.isInitial",c.va.Sa),c.b("ignoreDependencies",c.qd=c.l.w);var m=c.a.Yb("_latestValue");c.N=function(e){function t(){return 0<arguments.length?(t.tb(t[m],arguments[0])&&(t.ga(),t[m]=arguments[0],t.fa()),this):(c.l.oc(t),t[m])}return t[m]=e,c.a.ka||c.a.extend(t,c.J.fn),c.J.fn.rb(t),c.a.Ya(t,g),c.options.deferUpdates&&c.ya.deferred(t,!0),t};var g={equalityComparer:r,t:function(){return this[m]},fa:function(){this.notifySubscribers(this[m])},ga:function(){this.notifySubscribers(this[m],"beforeChange")}};c.a.ka&&c.a.Xa(g,c.J.fn);var y=c.N.gd="__ko_proto__";g[y]=c.N,c.Oa=function(e,t){return null===e||e===n||e[y]===n?!1:e[y]===t?!0:c.Oa(e[y],t)},c.H=function(e){return c.Oa(e,c.N)},c.Ba=function(e){return"function"==typeof e&&e[y]===c.N||"function"==typeof e&&e[y]===c.B&&e.Vc?!0:!1},c.b("observable",c.N),c.b("isObservable",c.H),c.b("isWriteableObservable",c.Ba),c.b("isWritableObservable",c.Ba),c.b("observable.fn",g),c.G(g,"peek",g.t),c.G(g,"valueHasMutated",g.fa),c.G(g,"valueWillMutate",g.ga),c.la=function(e){e=e||[];if("object"==typeof e&&"length"in e)return e=c.N(e),c.a.Ya(e,c.la.fn),e.extend({trackArrayChanges:!0});throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.")},c.la.fn={remove:function(e){for(var t=this.t(),n=[],r="function"!=typeof e||c.H(e)?function(t){return t===e}:e,i=0;i<t.length;i++){var s=t[i];r(s)&&(0===n.length&&this.ga(),n.push(s),t.splice(i,1),i--)}return n.length&&this.fa(),n},removeAll:function(e){if(e===n){var t=this.t(),r=t.slice(0);return this.ga(),t.splice(0,t.length),this.fa(),r}return e?this.remove(function(t){return 0<=c.a.o(e,t)}):[]},destroy:function(e){var t=this.t(),n="function"!=typeof e||c.H(e)?function(t){return t===e}:e;this.ga();for(var r=t.length-1;0<=r;r--)n(t[r])&&(t[r]._destroy=!0);this.fa()},destroyAll:function(e){return e===n?this.destroy(function(){return!0}):e?this.destroy(function(t){return 0<=c.a.o(e,t)}):[]},indexOf:function(e){var t=this();return c.a.o(t,e)},replace:function(e,t){var n=this.indexOf(e);0<=n&&(this.ga(),this.t()[n]=t,this.fa())}},c.a.ka&&c.a.Xa(c.la.fn,c.N.fn),c.a.q("pop push reverse shift sort splice unshift".split(" "),function(e){c.la.fn[e]=function(){var t=this.t();this.ga(),this.Vb(t,e,arguments);var n=t[e].apply(t,arguments);return this.fa(),n===t?this:n}}),c.a.q(["slice"],function(e){c.la.fn[e]=function(){var t=this();return t[e].apply(t,arguments)}}),c.b("observableArray",c.la),c.ya.trackArrayChanges=function(e,t){function n(){if(!r){r=!0;var t=e.notifySubscribers;e.notifySubscribers=function(e,n){return n&&n!==p||++o,t.apply(this,arguments)};var n=[].concat(e.t()||[]);i=null,s=e.X(function(t){t=[].concat(t||[]);if(e.Pa("arrayChange")){var r;if(!i||1<o)i=c.a.ib(n,t,e.hb);r=i}n=t,i=null,o=0,r&&r.length&&e.notifySubscribers(r,"arrayChange")})}}e.hb={},t&&"object"==typeof t&&c.a.extend(e.hb,t),e.hb.sparse=!0;if(!e.Vb){var r=!1,i=null,s,o=0,u=e.sa,a=e.Ia;e.sa=function(t){u&&u.call(e,t),"arrayChange"===t&&n()},e.Ia=function(t){a&&a.call(e,t),"arrayChange"!==t||e.Pa("arrayChange")||(s.k(),r=!1)},e.Vb=function(e,t,n){function s(e,t,n){return u[u.length]={status:e,value:t,index:n}}if(r&&!o){var u=[],a=e.length,f=n.length,l=0;switch(t){case"push":l=a;case"unshift":for(t=0;t<f;t++)s("added",n[t],l+t);break;case"pop":l=a-1;case"shift":a&&s("deleted",e[l],l);break;case"splice":t=Math.min(Math.max(0,0>n[0]?a+n[0]:n[0]),a);for(var a=1===f?a:Math.min(t+(n[1]||0),a),f=t+f-2,l=Math.max(a,f),h=[],p=[],d=2;t<l;++t,++d)t<a&&p.push(s("deleted",e[t],t)),t<f&&h.push(s("added",n[d],t));c.a.dc(p,h);break;default:return}i=u}}}};var b=c.a.Yb("_state");c.m=c.B=function(e,t,r){function i(){if(0<arguments.length){if("function"!=typeof s)throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return s.apply(o.pb,arguments),this}return c.l.oc(i),(o.S||o.s&&i.Qa())&&i.aa(),o.T}"object"==typeof e?r=e:(r=r||{},e&&(r.read=e));if("function"!=typeof r.read)throw Error("Pass a function that returns the value of the ko.computed");var s=r.write,o={T:n,S:!0,Ra:!1,Fb:!1,R:!1,Va:!1,s:!1,jd:r.read,pb:t||r.owner,i:r.disposeWhenNodeIsRemoved||r.i||null,wa:r.disposeWhen||r.wa,mb:null,r:{},L:0,bc:null};return i[b]=o,i.Vc="function"==typeof s,c.a.ka||c.a.extend(i,c.J.fn),c.J.fn.rb(i),c.a.Ya(i,w),r.pure?(o.Va=!0,o.s=!0,c.a.extend(i,E)):r.deferEvaluation&&c.a.extend(i,S),c.options.deferUpdates&&c.ya.deferred(i,!0),o.i&&(o.Fb=!0,o.i.nodeType||(o.i=null)),o.s||r.deferEvaluation||i.aa(),o.i&&i.ba()&&c.a.F.oa(o.i,o.mb=function(){i.k()}),i};var w={equalityComparer:r,Aa:function(){return this[b].L},Pb:function(e,t,n){if(this[b].Va&&t===this)throw Error("A 'pure' computed must not be called recursively");this[b].r[e]=n,n.Ga=this[b].L++,n.na=t.Na()},Qa:function(){var e,t,n=this[b].r;for(e in n)if(n.hasOwnProperty(e)&&(t=n[e],t.ia.Uc(t.na)))return!0},bd:function(){this.Fa&&!this[b].Ra&&this.Fa()},ba:function(){return this[b].S||0<this[b].L},ld:function(){this.Mb||this.ac()},uc:function(e){if(e.cb&&!this[b].i){var t=e.X(this.bd,this,"dirty"),n=e.X(this.ld,this);return{ia:e,k:function(){t.k(),n.k()}}}return e.X(this.ac,this)},ac:function(){var e=this,t=e.throttleEvaluation;t&&0<=t?(clearTimeout(this[b].bc),this[b].bc=c.a.setTimeout(function(){e.aa(!0)},t)):e.Fa?e.Fa():e.aa(!0)},aa:function(e){var t=this[b],n=t.wa;if(!t.Ra&&!t.R){if(t.i&&!c.a.nb(t.i)||n&&n()){if(!t.Fb){this.k();return}}else t.Fb=!1;t.Ra=!0;try{this.Qc(e)}finally{t.Ra=!1}t.L||this.k()}},Qc:function(e){var t=this[b],r=t.Va?n:!t.L,i={Hc:this,Ma:t.r,lb:t.L};c.l.Ub({Gc:i,gb:f,m:this,Sa:r}),t.r={},t.L=0,i=this.Pc(t,i),this.tb(t.T,i)&&(t.s||this.notifySubscribers(t.T,"beforeChange"),t.T=i,t.s?this.zc():e&&this.notifySubscribers(t.T)),r&&this.notifySubscribers(t.T,"awake")},Pc:function(e,t){try{var n=e.jd;return e.pb?n.call(e.pb):n()}finally{c.l.end(),t.lb&&!e.s&&c.a.D(t.Ma,a),e.S=!1}},t:function(){var e=this[b];return(e.S&&!e.L||e.s&&this.Qa())&&this.aa(),e.T},Ta:function(e){c.J.fn.Ta.call(this,e),this.Fa=function(){this.Kb(this[b].T),this[b].S=!0,this.Lb(this)}},k:function(){var e=this[b];!e.s&&e.r&&c.a.D(e.r,function(e,t){t.k&&t.k()}),e.i&&e.mb&&c.a.F.pc(e.i,e.mb),e.r=null,e.L=0,e.R=!0,e.S=!1,e.s=!1,e.i=null}},E={sa:function(e){var t=this,n=t[b];if(!n.R&&n.s&&"change"==e){n.s=!1;if(n.S||t.Qa())n.r=null,n.L=0,n.S=!0,t.aa();else{var r=[];c.a.D(n.r,function(e,t){r[t.Ga]=e}),c.a.q(r,function(e,r){var i=n.r[e],s=t.uc(i.ia);s.Ga=r,s.na=i.na,n.r[e]=s})}n.R||t.notifySubscribers(n.T,"awake")}},Ia:function(e){var t=this[b];t.R||"change"!=e||this.Pa("change")||(c.a.D(t.r,function(e,n){n.k&&(t.r[e]={ia:n.ia,Ga:n.Ga,na:n.na},n.k())}),t.s=!0,this.notifySubscribers(n,"asleep"))},Na:function(){var e=this[b];return e.s&&(e.S||this.Qa())&&this.aa(),c.J.fn.Na.call(this)}},S={sa:function(e){"change"!=e&&"beforeChange"!=e||this.t()}};c.a.ka&&c.a.Xa(w,c.J.fn);var T=c.N.gd;c.m[T]=c.N,w[T]=c.m,c.Xc=function(e){return c.Oa(e,c.m)},c.Yc=function(e){return c.Oa(e,c.m)&&e[b]&&e[b].Va},c.b("computed",c.m),c.b("dependentObservable",c.m),c.b("isComputed",c.Xc),c.b("isPureComputed",c.Yc),c.b("computed.fn",w),c.G(w,"peek",w.t),c.G(w,"dispose",w.k),c.G(w,"isActive",w.ba),c.G(w,"getDependenciesCount",w.Aa),c.nc=function(e,t){return"function"==typeof e?c.m(e,t,{pure:!0}):(e=c.a.extend({},e),e.pure=!0,c.m(e,t))},c.b("pureComputed",c.nc),function(){function e(i,s,o){o=o||new r,i=s(i);if("object"!=typeof i||null===i||i===n||i instanceof RegExp||i instanceof Date||i instanceof String||i instanceof Number||i instanceof Boolean)return i;var u=i instanceof Array?[]:{};return o.save(i,u),t(i,function(t){var r=s(i[t]);switch(typeof r){case"boolean":case"number":case"string":case"function":u[t]=r;break;case"object":case"undefined":var a=o.get(r);u[t]=a!==n?a:e(r,s,o)}}),u}function t(e,t){if(e instanceof Array){for(var n=0;n<e.length;n++)t(n);"function"==typeof e.toJSON&&t("toJSON")}else for(n in e)t(n)}function r(){this.keys=[],this.Ib=[]}c.wc=function(t){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return e(t,function(e){for(var t=0;c.H(e)&&10>t;t++)e=e();return e})},c.toJSON=function(e,t,n){return e=c.wc(e),c.a.Eb(e,t,n)},r.prototype={save:function(e,t){var n=c.a.o(this.keys,e);0<=n?this.Ib[n]=t:(this.keys.push(e),this.Ib.push(t))},get:function(e){return e=c.a.o(this.keys,e),0<=e?this.Ib[e]:n}}}(),c.b("toJS",c.wc),c.b("toJSON",c.toJSON),function(){c.j={u:function(e){switch(c.a.A(e)){case"option":return!0===e.__ko__hasDomDataOptionValue__?c.a.e.get(e,c.d.options.xb):7>=c.a.C?e.getAttributeNode("value")&&e.getAttributeNode("value").specified?e.value:e.text:e.value;case"select":return 0<=e.selectedIndex?c.j.u(e.options[e.selectedIndex]):n;default:return e.value}},ha:function(e,t,r){switch(c.a.A(e)){case"option":switch(typeof t){case"string":c.a.e.set(e,c.d.options.xb,n),"__ko__hasDomDataOptionValue__"in e&&delete e.__ko__hasDomDataOptionValue__,e.value=t;break;default:c.a.e.set(e,c.d.options.xb,t),e.__ko__hasDomDataOptionValue__=!0,e.value="number"==typeof t?t:""}break;case"select":if(""===t||null===t)t=n;for(var i=-1,s=0,o=e.options.length,u;s<o;++s)if(u=c.j.u(e.options[s]),u==t||""==u&&t===n){i=s;break}if(r||0<=i||t===n&&1<e.size)e.selectedIndex=i;break;default:if(null===t||t===n)t="";e.value=t}}}}(),c.b("selectExtensions",c.j),c.b("selectExtensions.readValue",c.j.u),c.b("selectExtensions.writeValue",c.j.ha),c.h=function(){function e(e){e=c.a.$a(e),123===e.charCodeAt(0)&&(e=e.slice(1,-1));var t=[],n=e.match(r),o,u=[],a=0;if(n){n.push(",");for(var f=0,l;l=n[f];++f){var h=l.charCodeAt(0);if(44===h){if(0>=a){t.push(o&&u.length?{key:o,value:u.join("")}:{unknown:o||u.join("")}),o=a=0,u=[];continue}}else if(58===h){if(!a&&!o&&1===u.length){o=u.pop();continue}}else 47===h&&f&&1<l.length?(h=n[f-1].match(i))&&!s[h[0]]&&(e=e.substr(e.indexOf(l)+1),n=e.match(r),n.push(","),f=-1,l="/"):40===h||123===h||91===h?++a:41===h||125===h||93===h?--a:o||u.length||34!==h&&39!==h||(l=l.slice(1,-1));u.push(l)}}return t}var t=["true","false","null","undefined"],n=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,r=RegExp("\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*'|/(?:[^/\\\\]|\\\\.)*/w*|[^\\s:,/][^,\"'{}()/:[\\]]*[^\\s,\"'{}()/:[\\]]|[^\\s]","g"),i=/[\])"'A-Za-z0-9_$]+$/,s={"in":1,"return":1,"typeof":1},o={};return{ta:[],ea:o,yb:e,Ua:function(r,i){function s(e,r){var i;if(!l){var h=c.getBindingHandler(e);if(h&&h.preprocess&&!(r=h.preprocess(r,e,s)))return;if(h=o[e])i=r,0<=c.a.o(t,i)?i=!1:(h=i.match(n),i=null===h?!1:h[1]?"Object("+h[1]+")"+h[2]:i),h=i;h&&a.push("'"+e+"':function(_z){"+i+"=_z}")}f&&(r="function(){return "+r+" }"),u.push("'"+e+"':"+r)}i=i||{};var u=[],a=[],f=i.valueAccessors,l=i.bindingParams,h="string"==typeof r?e(r):r;return c.a.q(h,function(e){s(e.key||e.unknown,e.value)}),a.length&&s("_ko_property_writers","{"+a.join(",")+" }"),u.join(",")},ad:function(e,t){for(var n=0;n<e.length;n++)if(e[n].key==t)return!0;return!1},Ea:function(e,t,n,r,i){e&&c.H(e)?!c.Ba(e)||i&&e.t()===r||e(r):(e=t.get("_ko_property_writers"))&&e[n]&&e[n](r)}}}(),c.b("expressionRewriting",c.h),c.b("expressionRewriting.bindingRewriteValidators",c.h.ta),c.b("expressionRewriting.parseObjectLiteral",c.h.yb),c.b("expressionRewriting.preProcessBindings",c.h.Ua),c.b("expressionRewriting._twoWayBindings",c.h.ea),c.b("jsonExpressionRewriting",c.h),c.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",c.h.Ua),function(){function e(e){return 8==e.nodeType&&s.test(i?e.text:e.nodeValue)}function t(e){return 8==e.nodeType&&o.test(i?e.text:e.nodeValue)}function n(n,r){for(var i=n,s=1,o=[];i=i.nextSibling;){if(t(i)&&(s--,0===s))return o;o.push(i),e(i)&&s++}if(!r)throw Error("Cannot find closing comment tag to match: "+n.nodeValue);return null}function r(e,t){var r=n(e,t);return r?0<r.length?r[r.length-1].nextSibling:e.nextSibling:null}var i=u&&"<!--test-->"===u.createComment("test").text,s=i?/^\x3c!--\s*ko(?:\s+([\s\S]+))?\s*--\x3e$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,o=i?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,a={ul:!0,ol:!0};c.f={Z:{},childNodes:function(t){return e(t)?n(t):t.childNodes},xa:function(t){if(e(t)){t=c.f.childNodes(t);for(var n=0,r=t.length;n<r;n++)c.removeNode(t[n])}else c.a.ob(t)},da:function(t,n){if(e(t)){c.f.xa(t);for(var r=t.nextSibling,i=0,s=n.length;i<s;i++)r.parentNode.insertBefore(n[i],r)}else c.a.da(t,n)},mc:function(t,n){e(t)?t.parentNode.insertBefore(n,t.nextSibling):t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n)},gc:function(t,n,r){r?e(t)?t.parentNode.insertBefore(n,r.nextSibling):r.nextSibling?t.insertBefore(n,r.nextSibling):t.appendChild(n):c.f.mc(t,n)},firstChild:function(n){return e(n)?!n.nextSibling||t(n.nextSibling)?null:n.nextSibling:n.firstChild},nextSibling:function(n){return e(n)&&(n=r(n)),n.nextSibling&&t(n.nextSibling)?null:n.nextSibling},Tc:e,pd:function(e){return(e=(i?e.text:e.nodeValue).match(s))?e[1]:null},kc:function(n){if(a[c.a.A(n)]){var i=n.firstChild;if(i)do if(1===i.nodeType){var s;s=i.firstChild;var o=null;if(s)do if(o)o.push(s);else if(e(s)){var u=r(s,!0);u?s=u:o=[s]}else t(s)&&(o=[s]);while(s=s.nextSibling);if(s=o)for(o=i.nextSibling,u=0;u<s.length;u++)o?n.insertBefore(s[u],o):n.appendChild(s[u])}while(i=i.nextSibling)}}}}(),c.b("virtualElements",c.f),c.b("virtualElements.allowedBindings",c.f.Z),c.b("virtualElements.emptyNode",c.f.xa),c.b("virtualElements.insertAfter",c.f.gc),c.b("virtualElements.prepend",c.f.mc),c.b("virtualElements.setDomNodeChildren",c.f.da),function(){c.Q=function(){this.Fc={}},c.a.extend(c.Q.prototype,{nodeHasBindings:function(e){switch(e.nodeType){case 1:return null!=e.getAttribute("data-bind")||c.g.getComponentNameForNode(e);case 8:return c.f.Tc(e);default:return!1}},getBindings:function(e,t){var n=this.getBindingsString(e,t),n=n?this.parseBindingsString(n,t,e):null;return c.g.Ob(n,e,t,!1)},getBindingAccessors:function(e,t){var n=this.getBindingsString(e,t),n=n?this.parseBindingsString(n,t,e,{valueAccessors:!0}):null;return c.g.Ob(n,e,t,!0)},getBindingsString:function(e){switch(e.nodeType){case 1:return e.getAttribute("data-bind");case 8:return c.f.pd(e);default:return null}},parseBindingsString:function(e,t,n,r){try{var i=this.Fc,s=e+(r&&r.valueAccessors||""),o;if(!(o=i[s])){var u,a="with($context){with($data||{}){return{"+c.h.Ua(e,r)+"}}}";u=new Function("$context","$element",a),o=i[s]=u}return o(t,n)}catch(f){throw f.message="Unable to parse bindings.\nBindings value: "+e+"\nMessage: "+f.message,f}}}),c.Q.instance=new c.Q}(),c.b("bindingProvider",c.Q),function(){function e(e){return function(){return e}}function t(e){return e()}function r(e){return c.a.Ca(c.l.w(e),function(t,n){return function(){return e()[n]}})}function i(t,n,i){return"function"==typeof t?r(t.bind(null,n,i)):c.a.Ca(t,e)}function s(e,t){return r(this.getBindings.bind(this,e,t))}function o(e,t,n){var r,i=c.f.firstChild(t),s=c.Q.instance,o=s.preprocessNode;if(o){for(;r=i;)i=c.f.nextSibling(r),o.call(s,r);i=c.f.firstChild(t)}for(;r=i;)i=c.f.nextSibling(r),u(e,r,n)}function u(e,t,n){var r=!0,i=1===t.nodeType;i&&c.f.kc(t);if(i&&n||c.Q.instance.nodeHasBindings(t))r=f(t,null,e,n).shouldBindDescendants;r&&!h[c.a.A(t)]&&o(e,t,!i)}function a(e){var t=[],n={},r=[];return c.a.D(e,function i(s){if(!n[s]){var o=c.getBindingHandler(s);o&&(o.after&&(r.push(s),c.a.q(o.after,function(t){if(e[t]){if(-1!==c.a.o(r,t))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+r.join(", "));i(t)}}),r.length--),t.push({key:s,fc:o})),n[s]=!0}}),t}function f(e,r,i,o){var u=c.a.e.get(e,p);if(!r){if(u)throw Error("You cannot apply bindings multiple times to the same element.");c.a.e.set(e,p,!0)}!u&&o&&c.tc(e,i);var f;if(r&&"function"!=typeof r)f=r;else{var l=c.Q.instance,h=l.getBindingAccessors||s,d=c.B(function(){return(f=r?r(i,e):h.call(l,e,i))&&i.P&&i.P(),f},null,{i:e});f&&d.ba()||(d=null)}var v;if(f){var m=d?function(e){return function(){return t(d()[e])}}:function(e){return f[e]},g=function(){return c.a.Ca(d?d():f,t)};g.get=function(e){return f[e]&&t(m(e))},g.has=function(e){return e in f},o=a(f),c.a.q(o,function(t){var r=t.fc.init,s=t.fc.update,o=t.key;if(8===e.nodeType&&!c.f.Z[o])throw Error("The binding '"+o+"' cannot be used with virtual elements");try{"function"==typeof r&&c.l.w(function(){var t=r(e,m(o),g,i.$data,i);if(t&&t.controlsDescendantBindings){if(v!==n)throw Error("Multiple bindings ("+v+" and "+o+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");v=o}}),"function"==typeof s&&c.B(function(){s(e,m(o),g,i.$data,i)},null,{i:e})}catch(u){throw u.message='Unable to process binding "'+o+": "+f[o]+'"\nMessage: '+u.message,u}})}return{shouldBindDescendants:v===n}}function l(e){return e&&e instanceof c.U?e:new c.U(e)}c.d={};var h={script:!0,textarea:!0,template:!0};c.getBindingHandler=function(e){return c.d[e]},c.U=function(e,t,r,i){var s=this,o="function"==typeof e&&!c.H(e),u,a=c.B(function(){var n=o?e():e,u=c.a.c(n);return t?(t.P&&t.P(),c.a.extend(s,t),a&&(s.P=a)):(s.$parents=[],s.$root=u,s.ko=c),s.$rawData=n,s.$data=u,r&&(s[r]=u),i&&i(s,t,u),s.$data},null,{wa:function(){return u&&!c.a.Qb(u)},i:!0});a.ba()&&(s.P=a,a.equalityComparer=null,u=[],a.Ac=function(e){u.push(e),c.a.F.oa(e,function(e){c.a.La(u,e),u.length||(a.k(),s.P=a=n)})})},c.U.prototype.createChildContext=function(e,t,n){return new c.U(e,this,t,function(e,t){e.$parentContext=t,e.$parent=t.$data,e.$parents=(t.$parents||[]).slice(0),e.$parents.unshift(e.$parent),n&&n(e)})},c.U.prototype.extend=function(e){return new c.U(this.P||this.$data,this,null,function(t,n){t.$rawData=n.$rawData,c.a.extend(t,"function"==typeof e?e():e)})};var p=c.a.e.I(),d=c.a.e.I();c.tc=function(e,t){if(2!=arguments.length)return c.a.e.get(e,d);c.a.e.set(e,d,t),t.P&&t.P.Ac(e)},c.Ja=function(e,t,n){return 1===e.nodeType&&c.f.kc(e),f(e,t,l(n),!0)},c.Dc=function(e,t,n){return n=l(n),c.Ja(e,i(t,n,e),n)},c.eb=function(e,t){1!==t.nodeType&&8!==t.nodeType||o(l(e),t,!0)},c.Rb=function(e,t){!v&&x.jQuery&&(v=x.jQuery);if(t&&1!==t.nodeType&&8!==t.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");t=t||x.document.body,u(l(e),t,!0)},c.kb=function(e){switch(e.nodeType){case 1:case 8:var t=c.tc(e);if(t)return t;if(e.parentNode)return c.kb(e.parentNode)}return n},c.Jc=function(e){return(e=c.kb(e))?e.$data:n},c.b("bindingHandlers",c.d),c.b("applyBindings",c.Rb),c.b("applyBindingsToDescendants",c.eb),c.b("applyBindingAccessorsToNode",c.Ja),c.b("applyBindingsToNode",c.Dc),c.b("contextFor",c.kb),c.b("dataFor",c.Jc)}(),function(e){function t(t,r){var o=i.hasOwnProperty(t)?i[t]:e,u;o?o.X(r):(o=i[t]=new c.J,o.X(r),n(t,function(e,n){var r=!!n&&!!n.synchronous;s[t]={definition:e,Zc:r},delete i[t],u||r?o.notifySubscribers(e):c.Y.Wa(function(){o.notifySubscribers(e)})}),u=!0)}function n(e,t){r("getConfig",[e],function(n){n?r("loadComponent",[e,n],function(e){t(e,n)}):t(null,null)})}function r(t,n,i,s){s||(s=c.g.loaders.slice(0));var o=s.shift();if(o){var u=o[t];if(u){var a=!1;if(u.apply(o,n.concat(function(e){a?i(null):null!==e?i(e):r(t,n,i,s)}))!==e&&(a=!0,!o.suppressLoaderExceptions))throw Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.")}else r(t,n,i,s)}else i(null)}var i={},s={};c.g={get:function(n,r){var i=s.hasOwnProperty(n)?s[n]:e;i?i.Zc?c.l.w(function(){r(i.definition)}):c.Y.Wa(function(){r(i.definition)}):t(n,r)},Xb:function(e){delete s[e]},Jb:r},c.g.loaders=[],c.b("components",c.g),c.b("components.get",c.g.get),c.b("components.clearCachedDefinition",c.g.Xb)}(),function(){function e(e,t,n,r){function i(){0===--u&&r(o)}var o={},u=2,a=n.template;n=n.viewModel,a?s(t,a,function(t){c.g.Jb("loadTemplate",[e,t],function(e){o.template=e,i()})}):i(),n?s(t,n,function(t){c.g.Jb("loadViewModel",[e,t],function(e){o[f]=e,i()})}):i()}function n(e,t,r){if("function"==typeof t)r(function(e){return new t(e)});else if("function"==typeof t[f])r(t[f]);else if("instance"in t){var i=t.instance;r(function(){return i})}else"viewModel"in t?n(e,t.viewModel,r):e("Unknown viewModel value: "+t)}function r(e){switch(c.a.A(e)){case"script":return c.a.ma(e.text);case"textarea":return c.a.ma(e.value);case"template":if(i(e.content))return c.a.ua(e.content.childNodes)}return c.a.ua(e.childNodes)}function i(e){return x.DocumentFragment?e instanceof DocumentFragment:e&&11===e.nodeType}function s(e,n,r){"string"==typeof n.require?t||x.require?(t||x.require)([n.require],r):e("Uses require, but no AMD loader is present"):r(n)}function o(e){return function(t){throw Error("Component '"+e+"': "+t)}}var a={};c.g.register=function(e,t){if(!t)throw Error("Invalid configuration for "+e);if(c.g.ub(e))throw Error("Component "+e+" is already registered");a[e]=t},c.g.ub=function(e){return a.hasOwnProperty(e)},c.g.od=function(e){delete a[e],c.g.Xb(e)},c.g.Zb={getConfig:function(e,t){t(a.hasOwnProperty(e)?a[e]:null)},loadComponent:function(t,n,r){var i=o(t);s(i,n,function(n){e(t,i,n,r)})},loadTemplate:function(e,t,n){e=o(e);if("string"==typeof t)n(c.a.ma(t));else if(t instanceof Array)n(t);else if(i(t))n(c.a.V(t.childNodes));else if(t.element)if(t=t.element,x.HTMLElement?t instanceof HTMLElement:t&&t.tagName&&1===t.nodeType)n(r(t));else if("string"==typeof t){var s=u.getElementById(t);s?n(r(s)):e("Cannot find element with ID "+t)}else e("Unknown element type: "+t);else e("Unknown template value: "+t)},loadViewModel:function(e,t,r){n(o(e),t,r)}};var f="createViewModel";c.b("components.register",c.g.register),c.b("components.isRegistered",c.g.ub),c.b("components.unregister",c.g.od),c.b("components.defaultLoader",c.g.Zb),c.g.loaders.push(c.g.Zb),c.g.Bc=a}(),function(){function e(e,n){var r=e.getAttribute("params");if(r){var r=t.parseBindingsString(r,n,e,{valueAccessors:!0,bindingParams:!0}),r=c.a.Ca(r,function(t){return c.m(t,null,{i:e})}),i=c.a.Ca(r,function(t){var n=t.t();return t.ba()?c.m({read:function(){return c.a.c(t())},write:c.Ba(n)&&function(e){t()(e)},i:e}):n});return i.hasOwnProperty("$raw")||(i.$raw=r),i}return{$raw:{}}}c.g.getComponentNameForNode=function(e){var t=c.a.A(e);if(c.g.ub(t)&&(-1!=t.indexOf("-")||"[object HTMLUnknownElement]"==""+e||8>=c.a.C&&e.tagName===t))return t},c.g.Ob=function(t,n,r,i){if(1===n.nodeType){var s=c.g.getComponentNameForNode(n);if(s){t=t||{};if(t.component)throw Error('Cannot use the "component" binding on a custom element matching a component');var o={name:s,params:e(n,r)};t.component=i?function(){return o}:o}}return t};var t=new c.Q;9>c.a.C&&(c.g.register=function(e){return function(t){return u.createElement(t),e.apply(this,arguments)}}(c.g.register),u.createDocumentFragment=function(e){return function(){var t=e(),n=c.g.Bc,r;for(r in n)n.hasOwnProperty(r)&&t.createElement(r);return t}}(u.createDocumentFragment))}(),function(e){function t(e,t,n){t=t.template;if(!t)throw Error("Component '"+e+"' has no template");e=c.a.ua(t),c.f.da(n,e)}function n(e,t,n,r){var i=e.createViewModel;return i?i.call(e,r,{element:t,templateNodes:n}):r}var r=0;c.d.component={init:function(i,s,o,u,a){function f(){var e=l&&l.dispose;"function"==typeof e&&e.call(l),h=l=null}var l,h,p=c.a.V(c.f.childNodes(i));return c.a.F.oa(i,f),c.m(function(){var o=c.a.c(s()),u,d;"string"==typeof o?u=o:(u=c.a.c(o.name),d=c.a.c(o.params));if(!u)throw Error("No component name specified");var v=h=++r;c.g.get(u,function(r){if(h===v){f();if(!r)throw Error("Unknown component '"+u+"'");t(u,r,i);var s=n(r,i,p,d);r=a.createChildContext(s,e,function(e){e.$component=s,e.$componentTemplateNodes=p}),l=s,c.eb(r,i)}})},null,{i:i}),{controlsDescendantBindings:!0}}},c.f.Z.component=!0}();var N={"class":"className","for":"htmlFor"};c.d.attr={update:function(e,t){var r=c.a.c(t())||{};c.a.D(r,function(t,r){r=c.a.c(r);var i=!1===r||null===r||r===n;i&&e.removeAttribute(t),8>=c.a.C&&t in N?(t=N[t],i?e.removeAttribute(t):e[t]=r):i||e.setAttribute(t,r.toString()),"name"===t&&c.a.rc(e,i?"":r.toString())})}},function(){c.d.checked={after:["value","attr"],init:function(e,t,r){function i(){var n=e.checked,i=d?o():n;if(!c.va.Sa()&&(!a||n)){var s=c.l.w(t);if(l){var u=h?s.t():s;p!==i?(n&&(c.a.pa(u,i,!0),c.a.pa(u,p,!1)),p=i):c.a.pa(u,i,n),h&&c.Ba(s)&&s(u)}else c.h.Ea(s,r,"checked",i,!0)}}function s(){var n=c.a.c(t());e.checked=l?0<=c.a.o(n,o()):u?n:o()===n}var o=c.nc(function(){return r.has("checkedValue")?c.a.c(r.get("checkedValue")):r.has("value")?c.a.c(r.get("value")):e.value}),u="checkbox"==e.type,a="radio"==e.type;if(u||a){var f=t(),l=u&&c.a.c(f)instanceof Array,h=!(l&&f.push&&f.splice),p=l?o():n,d=a||l;a&&!e.name&&c.d.uniqueName.init(e,function(){return!0}),c.m(i,null,{i:e}),c.a.p(e,"click",i),c.m(s,null,{i:e}),f=n}}},c.h.ea.checked=!0,c.d.checkedValue={update:function(e,t){e.value=c.a.c(t())}}}(),c.d.css={update:function(e,t){var n=c.a.c(t());null!==n&&"object"==typeof n?c.a.D(n,function(t,n){n=c.a.c(n),c.a.bb(e,t,n)}):(n=c.a.$a(String(n||"")),c.a.bb(e,e.__ko__cssValue,!1),e.__ko__cssValue=n,c.a.bb(e,n,!0))}},c.d.enable={update:function(e,t){var n=c.a.c(t());n&&e.disabled?e.removeAttribute("disabled"):n||e.disabled||(e.disabled=!0)}},c.d.disable={update:function(e,t){c.d.enable.update(e,function(){return!c.a.c(t())})}},c.d.event={init:function(e,t,n,r,i){var s=t()||{};c.a.D(s,function(s){"string"==typeof s&&c.a.p(e,s,function(e){var o,u=t()[s];if(u){try{var a=c.a.V(arguments);r=i.$data,a.unshift(r),o=u.apply(r,a)}finally{!0!==o&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}!1===n.get(s+"Bubble")&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())}})})}},c.d.foreach={ic:function(e){return function(){var t=e(),n=c.a.zb(t);return!n||"number"==typeof n.length?{foreach:t,templateEngine:c.W.sb}:(c.a.c(t),{foreach:n.data,as:n.as,includeDestroyed:n.includeDestroyed,afterAdd:n.afterAdd,beforeRemove:n.beforeRemove,afterRender:n.afterRender,beforeMove:n.beforeMove,afterMove:n.afterMove,templateEngine:c.W.sb})}},init:function(e,t){return c.d.template.init(e,c.d.foreach.ic(t))},update:function(e,t,n,r,i){return c.d.template.update(e,c.d.foreach.ic(t),n,r,i)}},c.h.ta.foreach=!1,c.f.Z.foreach=!0,c.d.hasfocus={init:function(e,t,n){function r(r){e.__ko_hasfocusUpdating=!0;var i=e.ownerDocument;if("activeElement"in i){var s;try{s=i.activeElement}catch(o){s=i.body}r=s===e}i=t(),c.h.Ea(i,n,"hasfocus",r,!0),e.__ko_hasfocusLastValue=r,e.__ko_hasfocusUpdating=!1}var i=r.bind(null,!0),s=r.bind(null,!1);c.a.p(e,"focus",i),c.a.p(e,"focusin",i),c.a.p(e,"blur",s),c.a.p(e,"focusout",s)},update:function(e,t){var n=!!c.a.c(t());e.__ko_hasfocusUpdating||e.__ko_hasfocusLastValue===n||(n?e.focus():e.blur(),!n&&e.__ko_hasfocusLastValue&&e.ownerDocument.body.focus(),c.l.w(c.a.Da,null,[e,n?"focusin":"focusout"]))}},c.h.ea.hasfocus=!0,c.d.hasFocus=c.d.hasfocus,c.h.ea.hasFocus=!0,c.d.html={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){c.a.Cb(e,t())}},l("if"),l("ifnot",!1,!0),l("with",!0,!1,function(e,t){return e.createChildContext(t)});var C={};c.d.options={init:function(e){if("select"!==c.a.A(e))throw Error("options binding applies only to SELECT elements");for(;0<e.length;)e.remove(0);return{controlsDescendantBindings:!0}},update:function(e,t,r){function i(){return c.a.Ka(e.options,function(e){return e.selected})}function s(e,t,n){var r=typeof t;return"function"==r?t(e):"string"==r?e[t]:n}function o(t,n){if(v&&l)c.j.ha(e,c.a.c(r.get("value")),!0);else if(d.length){var i=0<=c.a.o(d,c.j.u(n[0]));c.a.sc(n[0],i),v&&!i&&c.l.w(c.a.Da,null,[e,"change"])}}var u=e.multiple,a=0!=e.length&&u?e.scrollTop:null,f=c.a.c(t()),l=r.get("valueAllowUnset")&&r.has("value"),h=r.get("optionsIncludeDestroyed");t={};var p,d=[];l||(u?d=c.a.fb(i(),c.j.u):0<=e.selectedIndex&&d.push(c.j.u(e.options[e.selectedIndex]))),f&&("undefined"==typeof f.length&&(f=[f]),p=c.a.Ka(f,function(e){return h||e===n||null===e||!c.a.c(e._destroy)}),r.has("optionsCaption")&&(f=c.a.c(r.get("optionsCaption")),null!==f&&f!==n&&p.unshift(C)));var v=!1;t.beforeRemove=function(t){e.removeChild(t)},f=o,r.has("optionsAfterRender")&&"function"==typeof r.get("optionsAfterRender")&&(f=function(e,t){o(0,t),c.l.w(r.get("optionsAfterRender"),null,[t[0],e!==C?e:n])}),c.a.Bb(e,p,function(t,i,o){return o.length&&(d=!l&&o[0].selected?[c.j.u(o[0])]:[],v=!0),i=e.ownerDocument.createElement("option"),t===C?(c.a.Za(i,r.get("optionsCaption")),c.j.ha(i,n)):(o=s(t,r.get("optionsValue"),t),c.j.ha(i,c.a.c(o)),t=s(t,r.get("optionsText"),o),c.a.Za(i,t)),[i]},t,f),c.l.w(function(){l?c.j.ha(e,c.a.c(r.get("value")),!0):(u?d.length&&i().length<d.length:d.length&&0<=e.selectedIndex?c.j.u(e.options[e.selectedIndex])!==d[0]:d.length||0<=e.selectedIndex)&&c.a.Da(e,"change")}),c.a.Nc(e),a&&20<Math.abs(a-e.scrollTop)&&(e.scrollTop=a)}},c.d.options.xb=c.a.e.I(),c.d.selectedOptions={after:["options","foreach"],init:function(e,t,n){c.a.p(e,"change",function(){var r=t(),i=[];c.a.q(e.getElementsByTagName("option"),function(e){e.selected&&i.push(c.j.u(e))}),c.h.Ea(r,n,"selectedOptions",i)})},update:function(e,t){if("select"!=c.a.A(e))throw Error("values binding applies only to SELECT elements");var n=c.a.c(t()),r=e.scrollTop;n&&"number"==typeof n.length&&c.a.q(e.getElementsByTagName("option"),function(e){var t=0<=c.a.o(n,c.j.u(e));e.selected!=t&&c.a.sc(e,t)}),e.scrollTop=r}},c.h.ea.selectedOptions=!0,c.d.style={update:function(e,t){var r=c.a.c(t()||{});c.a.D(r,function(t,r){r=c.a.c(r);if(null===r||r===n||!1===r)r="";e.style[t]=r})}},c.d.submit={init:function(e,t,n,r,i){if("function"!=typeof t())throw Error("The value for a submit binding must be a function");c.a.p(e,"submit",function(n){var r,s=t();try{r=s.call(i.$data,e)}finally{!0!==r&&(n.preventDefault?n.preventDefault():n.returnValue=!1)}})}},c.d.text={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){c.a.Za(e,t())}},c.f.Z.text=!0,function(){if(x&&x.navigator)var e=function(e){if(e)return parseFloat(e[1])},t=x.opera&&x.opera.version&&parseInt(x.opera.version()),r=x.navigator.userAgent,i=e(r.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),s=e(r.match(/Firefox\/([^ ]*)/));if(10>c.a.C)var o=c.a.e.I(),u=c.a.e.I(),a=function(e){var t=this.activeElement;(t=t&&c.a.e.get(t,u))&&t(e)},f=function(e,t){var n=e.ownerDocument;c.a.e.get(n,o)||(c.a.e.set(n,o,!0),c.a.p(n,"selectionchange",a)),c.a.e.set(e,u,t)};c.d.textInput={init:function(e,r,o){function u(t,n){c.a.p(e,t,n)}function a(){var t=c.a.c(r());if(null===t||t===n)t="";v!==n&&t===v?c.a.setTimeout(a,4):e.value!==t&&(p=t,e.value=t)}function l(){d||(v=e.value,d=c.a.setTimeout(h,4))}function h(){clearTimeout(d),v=d=n;var t=e.value;p!==t&&(p=t,c.h.Ea(r(),o,"textInput",t))}var p=e.value,d,v,m=9==c.a.C?l:h;10>c.a.C?(u("propertychange",function(e){"value"===e.propertyName&&m(e)}),8==c.a.C&&(u("keyup",h),u("keydown",h)),8<=c.a.C&&(f(e,m),u("dragend",l))):(u("input",h),5>i&&"textarea"===c.a.A(e)?(u("keydown",l),u("paste",l),u("cut",l)):11>t?u("keydown",l):4>s&&(u("DOMAutoComplete",h),u("dragdrop",h),u("drop",h))),u("change",h),c.m(a,null,{i:e})}},c.h.ea.textInput=!0,c.d.textinput={preprocess:function(e,t,n){n("textInput",e)}}}(),c.d.uniqueName={init:function(e,t){if(t()){var n="ko_unique_"+ ++c.d.uniqueName.Ic;c.a.rc(e,n)}}},c.d.uniqueName.Ic=0,c.d.value={after:["options","foreach"],init:function(e,t,n){if("input"!=e.tagName.toLowerCase()||"checkbox"!=e.type&&"radio"!=e.type){var r=["change"],i=n.get("valueUpdate"),s=!1,o=null;i&&("string"==typeof i&&(i=[i]),c.a.ra(r,i),r=c.a.Tb(r));var u=function(){o=null,s=!1;var r=t(),i=c.j.u(e);c.h.Ea(r,n,"value",i)};!c.a.C||"input"!=e.tagName.toLowerCase()||"text"!=e.type||"off"==e.autocomplete||e.form&&"off"==e.form.autocomplete||-1!=c.a.o(r,"propertychange")||(c.a.p(e,"propertychange",function(){s=!0}),c.a.p(e,"focus",function(){s=!1}),c.a.p(e,"blur",function(){s&&u()})),c.a.q(r,function(t){var n=u;c.a.nd(t,"after")&&(n=function(){o=c.j.u(e),c.a.setTimeout(u,0)},t=t.substring(5)),c.a.p(e,t,n)});var a=function(){var r=c.a.c(t()),i=c.j.u(e);if(null!==o&&r===o)c.a.setTimeout(a,0);else if(r!==i)if("select"===c.a.A(e)){var s=n.get("valueAllowUnset"),i=function(){c.j.ha(e,r,s)};i(),s||r===c.j.u(e)?c.a.setTimeout(i,0):c.l.w(c.a.Da,null,[e,"change"])}else c.j.ha(e,r)};c.m(a,null,{i:e})}else c.Ja(e,{checkedValue:t})},update:function(){}},c.h.ea.value=!0,c.d.visible={update:function(e,t){var n=c.a.c(t()),r="none"!=e.style.display;n&&!r?e.style.display="":!n&&r&&(e.style.display="none")}},function(e){c.d[e]={init:function(t,n,r,i,s){return c.d.event.init.call(this,t,function(){var t={};return t[e]=n(),t},r,i,s)}}}("click"),c.O=function(){},c.O.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource")},c.O.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock")},c.O.prototype.makeTemplateSource=function(e,t){if("string"==typeof e){t=t||u;var n=t.getElementById(e);if(!n)throw Error("Cannot find template with ID "+e);return new c.v.n(n)}if(1==e.nodeType||8==e.nodeType)return new c.v.qa(e);throw Error("Unknown template type: "+e)},c.O.prototype.renderTemplate=function(e,t,n,r){return e=this.makeTemplateSource(e,r),this.renderTemplateSource(e,t,n,r)},c.O.prototype.isTemplateRewritten=function(e,t){return!1===this.allowTemplateRewriting?!0:this.makeTemplateSource(e,t).data("isRewritten")},c.O.prototype.rewriteTemplate=function(e,t,n){e=this.makeTemplateSource(e,n),t=t(e.text()),e.text(t),e.data("isRewritten",!0)},c.b("templateEngine",c.O),c.Gb=function(){function e(e,t,n,r){e=c.h.yb(e);for(var i=c.h.ta,s=0;s<e.length;s++){var o=e[s].key;if(i.hasOwnProperty(o)){var u=i[o];if("function"==typeof u){if(o=u(e[s].value))throw Error(o)}else if(!u)throw Error("This template engine does not support the '"+o+"' binding within its templates")}}return n="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+c.h.Ua(e,{valueAccessors:!0})+" } })()},'"+n.toLowerCase()+"')",r.createJavaScriptEvaluatorBlock(n)+t}var t=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'|[^>]*))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,n=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{Oc:function(e,t,n){t.isTemplateRewritten(e,n)||t.rewriteTemplate(e,function(e){return c.Gb.dd(e,t)},n)},dd:function(r,i){return r.replace(t,function(t,n,r,s,o){return e(o,n,r,i)}).replace(n,function(t,n){return e(n,"<!-- ko -->","#comment",i)})},Ec:function(e,t){return c.M.wb(function(n,r){var i=n.nextSibling;i&&i.nodeName.toLowerCase()===t&&c.Ja(i,e,r)})}}}(),c.b("__tr_ambtns",c.Gb.Ec),function(){c.v={},c.v.n=function(e){if(this.n=e){var t=c.a.A(e);this.ab="script"===t?1:"textarea"===t?2:"template"==t&&e.content&&11===e.content.nodeType?3:4}},c.v.n.prototype.text=function(){var e=1===this.ab?"text":2===this.ab?"value":"innerHTML";if(0==arguments.length)return this.n[e];var t=arguments[0];"innerHTML"===e?c.a.Cb(this.n,t):this.n[e]=t};var e=c.a.e.I()+"_";c.v.n.prototype.data=function(t){if(1===arguments.length)return c.a.e.get(this.n,e+t);c.a.e.set(this.n,e+t,arguments[1])};var t=c.a.e.I();c.v.n.prototype.nodes=function(){var e=this.n;if(0==arguments.length)return(c.a.e.get(e,t)||{}).jb||(3===this.ab?e.content:4===this.ab?e:n);c.a.e.set(e,t,{jb:arguments[0]})},c.v.qa=function(e){this.n=e},c.v.qa.prototype=new c.v.n,c.v.qa.prototype.text=function(){if(0==arguments.length){var e=c.a.e.get(this.n,t)||{};return e.Hb===n&&e.jb&&(e.Hb=e.jb.innerHTML),e.Hb}c.a.e.set(this.n,t,{Hb:arguments[0]})},c.b("templateSources",c.v),c.b("templateSources.domElement",c.v.n),c.b("templateSources.anonymousTemplate",c.v.qa)}(),function(){function e(e,t,n){var r;for(t=c.f.nextSibling(t);e&&(r=e)!==t;)e=c.f.nextSibling(r),n(r,e)}function t(t,n){if(t.length){var r=t[0],i=t[t.length-1],s=r.parentNode,o=c.Q.instance,u=o.preprocessNode;if(u){e(r,i,function(e,t){var n=e.previousSibling,s=u.call(o,e);s&&(e===r&&(r=s[0]||t),e===i&&(i=s[s.length-1]||n))}),t.length=0;if(!r)return;r===i?t.push(r):(t.push(r,i),c.a.za(t,s))}e(r,i,function(e){1!==e.nodeType&&8!==e.nodeType||c.Rb(n,e)}),e(r,i,function(e){1!==e.nodeType&&8!==e.nodeType||c.M.yc(e,[n])}),c.a.za(t,s)}}function r(e){return e.nodeType?e:0<e.length?e[0]:null}function i(e,n,i,s,u){u=u||{};var a=(e&&r(e)||i||{}).ownerDocument,f=u.templateEngine||o;c.Gb.Oc(i,f,a),i=f.renderTemplate(i,s,u,a);if("number"!=typeof i.length||0<i.length&&"number"!=typeof i[0].nodeType)throw Error("Template engine must return an array of DOM nodes");a=!1;switch(n){case"replaceChildren":c.f.da(e,i),a=!0;break;case"replaceNode":c.a.qc(e,i),a=!0;break;case"ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+n)}return a&&(t(i,s),u.afterRender&&c.l.w(u.afterRender,null,[i,s.$data])),i}function s(e,t,n){return c.H(e)?e():"function"==typeof e?e(t,n):e}var o;c.Db=function(e){if(!(e==n||e instanceof c.O))throw Error("templateEngine must inherit from ko.templateEngine");o=e},c.Ab=function(e,t,u,a,f){u=u||{};if((u.templateEngine||o)==n)throw Error("Set a template engine before calling renderTemplate");f=f||"replaceChildren";if(a){var l=r(a);return c.B(function(){var n=t&&t instanceof c.U?t:new c.U(c.a.c(t)),o=s(e,n.$data,n),n=i(a,f,o,n,u);"replaceNode"==f&&(a=n,l=r(a))},null,{wa:function(){return!l||!c.a.nb(l)},i:l&&"replaceNode"==f?l.parentNode:l})}return c.M.wb(function(n){c.Ab(e,t,u,n,"replaceNode")})},c.kd=function(e,r,o,u,a){function f(e,n){t(n,h),o.afterRender&&o.afterRender(n,e),h=null}function l(t,n){h=a.createChildContext(t,o.as,function(e){e.$index=n});var r=s(e,t,h);return i(null,"ignoreTargetNode",r,h,o)}var h;return c.B(function(){var e=c.a.c(r)||[];"undefined"==typeof e.length&&(e=[e]),e=c.a.Ka(e,function(e){return o.includeDestroyed||e===n||null===e||!c.a.c(e._destroy)}),c.l.w(c.a.Bb,null,[u,e,l,o,f])},null,{i:u})};var u=c.a.e.I();c.d.template={init:function(e,t){var n=c.a.c(t());if("string"==typeof n||n.name)c.f.xa(e);else{if("nodes"in n){if(n=n.nodes||[],c.H(n))throw Error('The "nodes" option must be a plain, non-observable array.')}else n=c.f.childNodes(e);n=c.a.jc(n),(new c.v.qa(e)).nodes(n)}return{controlsDescendantBindings:!0}},update:function(e,t,r,i,s){var o=t(),a;t=c.a.c(o),r=!0,i=null,"string"==typeof t?t={}:(o=t.name,"if"in t&&(r=c.a.c(t["if"])),r&&"ifnot"in t&&(r=!c.a.c(t.ifnot)),a=c.a.c(t.data)),"foreach"in t?i=c.kd(o||e,r&&t.foreach||[],t,e,s):r?(s="data"in t?s.createChildContext(a,t.as):s,i=c.Ab(o||e,s,t,e)):c.f.xa(e),s=i,(a=c.a.e.get(e,u))&&"function"==typeof a.k&&a.k(),c.a.e.set(e,u,s&&s.ba()?s:n)}},c.h.ta.template=function(e){return e=c.h.yb(e),1==e.length&&e[0].unknown||c.h.ad(e,"name")?null:"This template engine does not support anonymous templates nested within its templates"},c.f.Z.template=!0}(),c.b("setTemplateEngine",c.Db),c.b("renderTemplate",c.Ab),c.a.dc=function(e,t,n){if(e.length&&t.length){var r,i,s,o,u;for(r=i=0;(!n||r<n)&&(o=e[i]);++i){for(s=0;u=t[s];++s)if(o.value===u.value){o.moved=u.index,u.moved=o.index,t.splice(s,1),r=s=0;break}r+=s}}},c.a.ib=function(){function e(e,t,n,r,i){var s=Math.min,o=Math.max,u=[],a,f=e.length,l,h=t.length,p=h-f||1,d=f+h+1,v,m,g;for(a=0;a<=f;a++)for(m=v,u.push(v=[]),g=s(h,a+p),l=o(0,a-1);l<=g;l++)v[l]=l?a?e[a-1]===t[l-1]?m[l-1]:s(m[l]||d,v[l-1]||d)+1:l+1:a+1;s=[],o=[],p=[],a=f;for(l=h;a||l;)h=u[a][l]-1,l&&h===u[a][l-1]?o.push(s[s.length]={status:n,value:t[--l],index:l}):a&&h===u[a-1][l]?p.push(s[s.length]={status:r,value:e[--a],index:a}):(--l,--a,i.sparse||s.push({status:"retained",value:t[l]}));return c.a.dc(p,o,!i.dontLimitMoves&&10*f),s.reverse()}return function(t,n,r){return r="boolean"==typeof r?{dontLimitMoves:r}:r||{},t=t||[],n=n||[],t.length<n.length?e(t,n,"added","deleted",r):e(n,t,"deleted","added",r)}}(),c.b("utils.compareArrays",c.a.ib),function(){function e(e,t,r,i,s){var o=[],u=c.B(function(){var n=t(r,s,c.a.za(o,e))||[];0<o.length&&(c.a.qc(o,n),i&&c.l.w(i,null,[r,n,s])),o.length=0,c.a.ra(o,n)},null,{i:e,wa:function(){return!c.a.Qb(o)}});return{ca:o,B:u.ba()?u:n}}var t=c.a.e.I(),r=c.a.e.I();c.a.Bb=function(i,s,o,u,a){function f(e,t){S=p[t],y!==t&&(E[e]=S),S.qb(y++),c.a.za(S.ca,i),m.push(S),w.push(S)}function l(e,t){if(e)for(var n=0,r=t.length;n<r;n++)t[n]&&c.a.q(t[n].ca,function(r){e(r,n,t[n].ja)})}s=s||[],u=u||{};var h=c.a.e.get(i,t)===n,p=c.a.e.get(i,t)||[],d=c.a.fb(p,function(e){return e.ja}),v=c.a.ib(d,s,u.dontLimitMoves),m=[],g=0,y=0,b=[],w=[];s=[];for(var E=[],d=[],S,x=0,T,N;T=v[x];x++)switch(N=T.moved,T.status){case"deleted":N===n&&(S=p[g],S.B&&(S.B.k(),S.B=n),c.a.za(S.ca,i).length&&(u.beforeRemove&&(m.push(S),w.push(S),S.ja===r?S=null:s[x]=S),S&&b.push.apply(b,S.ca))),g++;break;case"retained":f(x,g++);break;case"added":N!==n?f(x,N):(S={ja:T.value,qb:c.N(y++)},m.push(S),w.push(S),h||(d[x]=S))}c.a.e.set(i,t,m),l(u.beforeMove,E),c.a.q(b,u.beforeRemove?c.$:c.removeNode);for(var x=0,h=c.f.firstChild(i),C;S=w[x];x++){S.ca||c.a.extend(S,e(i,o,S.ja,a,S.qb));for(g=0;v=S.ca[g];h=v.nextSibling,C=v,g++)v!==h&&c.f.gc(i,v,C);!S.Wc&&a&&(a(S.ja,S.ca,S.qb),S.Wc=!0)}l(u.beforeRemove,s);for(x=0;x<s.length;++x)s[x]&&(s[x].ja=r);l(u.afterMove,E),l(u.afterAdd,d)}}(),c.b("utils.setDomNodeChildrenFromArrayMapping",c.a.Bb),c.W=function(){this.allowTemplateRewriting=!1},c.W.prototype=new c.O,c.W.prototype.renderTemplateSource=function(e,t,n,r){return(t=(9>c.a.C?0:e.nodes)?e.nodes():null)?c.a.V(t.cloneNode(!0).childNodes):(e=e.text(),c.a.ma(e,r))},c.W.sb=new c.W,c.Db(c.W.sb),c.b("nativeTemplateEngine",c.W),function(){c.vb=function(){var e=this.$c=function(){if(!v||!v.tmpl)return 0;try{if(0<=v.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(e){}return 1}();this.renderTemplateSource=function(t,n,r,i){i=i||u,r=r||{};if(2>e)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var s=t.data("precompiled");return s||(s=t.text()||"",s=v.template(null,"{{ko_with $item.koBindingContext}}"+s+"{{/ko_with}}"),t.data("precompiled",s)),t=[n.$data],n=v.extend({koBindingContext:n},r.templateOptions),n=v.tmpl(s,t,n),n.appendTo(i.createElement("div")),v.fragments={},n},this.createJavaScriptEvaluatorBlock=function(e){return"{{ko_code ((function() { return "+e+" })()) }}"},this.addTemplate=function(e,t){u.write("<script type='text/html' id='"+e+"'>"+t+"</script>")},0<e&&(v.tmpl.tag.ko_code={open:"__.push($1 || '');"},v.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},c.vb.prototype=new c.O;var e=new c.vb;0<e.$c&&c.Db(e),c.b("jqueryTmplTemplateEngine",c.vb)}()})})()}(),define("browser/document",[],function(){return document}),define("ui/telemetry/actions/actionNames",{audioVideo:{videoCall:"av_call_with_video",audioCall:"av_call_with_audio",pstnCall:"av_call_with_pstn",apiVideoCall:"av_api_call_with_video",apiAudioCall:"av_api_call_with_audio",toggleMute:"av_mute_unmute",toggleVideo:"av_video_on_off",showChat:"av_show_chat",hideChat:"av_hide_chat",toggleFullScreen:"av_full_screen",toggleNarrowMenu:"av_narrow_menu",toggleDialpad:"av_dialpad_on_off",toggleGridView:"av_grid_view",zoomInOut:"av_zoom_in_out",endCall:"av_end_call",acceptWithAudio:"av_accept_with_audio",acceptWithVideo:"av_accept_with_video",reject:"av_reject_call",joinCall:"av_join_call",joinCallWithVideo:"av_join_call_with_video",moreActions:"av_more_actions",addParticipants:"av_add_participants",shareScreenPreview:"av_share_screen_preview",shareScreen:"av_share_screen",stopSharingScreen:"av_stop_sharing_screen",submitParticipantsIn1to1:"av_submit_participants_in_1_1",submitParticipantsInGroup:"av_submit_participants_in_group",participantMenu:{show:"av_participantMenu_show",chat:"av_participantMenu_chat",pin:"av_partcipantMenu_pin",zoom:"av_partcipantMenu_zoom"},pluginInstall:{start:"av_plugin_install_start",installExtension:"av_install_extension",installPlugin:"av_install_plugin",restart:"av_plugin_install_restart",leave:"av_plugin_install_leave",stayInFlow:"av_plugin_install_cancel_leave",firefoxUnableToCall:"av_plugin_firefox_unable_to_call"},timeline:{endCall:"av_timeline_end_call",toggleMute:"av_timeline_mute_unmute"}},deviceSelection:{callScreenPaneOpened:"callScreenPaneOpened",microphoneSelected:"microphoneSelected",speakerSelected:"speakerSelected",cameraSelected:"cameraSelected"},contacts:{openPage:"contacts_contactsPage_openPage",openConversation:"contacts_contactsPage_openConversation",showContextMenu:"contacts_contactsPage_showContextMenu",contactRequestSent:"contacts_contactRequest_sent",contactRequestSuggestedSent:"contacts_contactRequest_suggestedSent",contactRequestAccepted:"contacts_contactRequest_accepted",contactRequestDeclined:"contacts_contactRequest_declined",contactBlocked:"contactBlocked",contactUnblocked:"contactUnblocked",contactDeleted:"contactDeleted",informationButtonClicked:"contacts_informationButton_clicked"},discoverAgents:{openPage:"agents_discoverAgentsPage_openPage",openConversation:"agents_discoverAgentsPage_openConversation"},contextMenu:{shown:"contextMenuShown",hidden:"contextMenuHidden",recents:{notificationsMuted:"contextMenu_recents_notificationsMuted",notificationsUnmuted:"contextMenu_recents_notificationsUnmuted"}},search:{directorySearchActivated:"directorySearchActivated",started:"searchStarted",startedLocal:"searchStartedLocal",startedDirectory:"searchStartedDirectory",reset:"searchReset"},focusManager:{tryRestoreFocus:"tryRestoreFocus"},conversation:{addParticipantsButton:"conversation_addParticipants_button_clicked",scheduleCallButton:"conversation_scheduleCall_button_clicked",moreActionsButton:"conversation_moreActions_button_clicked",mute:"conversation_mute_notifications_setting_changed"},scheduleCall:{scheduleCallConfirmButton:"conversation_scheduleCall_confirm_clicked"},chat:{removeMessage:"removeMessage",sendMessageButton:"send_message_button_clicked",editMessageButton:"edit_message_button_clicked",sendMessageEnter:"send_message_enter_key",editMessageEnter:"edit_message_enter_key",saveVideoMessage:"save_video_message",notificationsDisabled:"chat_notifications_disabled",notificationsEnabled:"chat_notifications_enabled"},skypeOut:{openPage:"skypeOut_openPage"},invites:{shareButton:"invites_share_button_clicked",copyButton:"invites_copy_button_clicked",mailButton:"invites_mail_button_clicked"},presence:{change:"mepresence_change"},userSettings:{openPage:"user_settings_open_page"},educationBubbles:{educationBubbleShown:"education_bubble_shown"},me:{expanded:"me_expanded",collapsed:"me_collapsed",accountLinkClicked:"me_account_link_clicked",signOutClicked:"me_sign_out_clicked",installPluginLinkClicked:"me_install_plugin_link_clicked",avatarFilePickerClicked:"me_avatar_file_picker_clicked",presenceChanged:"me_presence_changed",presenceLoaded:"me_presence_loaded",activityChanged:"me_activity_changed"},externalSignIn:{signIn:"external_sign_in",signInRequest:"external_sign_in_request",signInRequestAfterTokenRefresh:"external_sign_in_request_after_token_refresh",openSignInWindow:"external_open_sign_in_window"},shortCircuit:{contactsPageOpen:"sc_open_contactsPage",manageAddressBooks:"sc_open_manageAddressBooks",addNewNumber:"sc_open_pnv",deleteNumber:"sc_delete_phoneProof",toggleAutoBuddy:"sc_toggle_autoBuddy",togglePhoneProof:"sc_toggle_phoneProof"},notificationsSettings:{toggleNotifications:"toggleNotifications",toggleSound:"toggleSound",changeRingingDeferrerSetting:"ringingDeferrer_settingChanged"},notificationBox:{shown:"notification_box_shown",requestPermission:"notification_box_request_permission",permissionResponse:"notification_box_permission_response"},browserNotificationsOptInToast:{shown:"browser_notifications_opt_in_toast_shown"},allowBrowserNotificationsModalDialog:{shown:"allow_browser_notifications_modal_dialog_shown"}}),define("browser/dom",["require","exports","module","lodash-compat","swx-browser-globals"],function(e,t){function s(e){return Boolean(e&&e.nodeType===1)}function o(e){return!(!e||!n.isString(e.tagName)&&!n.isString(e.nodeName))}function u(e,t){return n.isElement(e)?e.tagName.toLowerCase()===t:!1}function a(e){return Boolean(e.offsetParent)}function f(e,t){while(e&&!w(e,t))e=e.parentNode;return e}function l(e,t){while(e&&!c(e,t))e=e.parentNode;return e}function c(e,t){var n=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector;return n?n.call(e,t):!1}function h(e){return n.isString(e)?x(r.getDocument().createElement(e)):null}function p(e){return n.isString(e)?x(r.getDocument().querySelector(e)):null}function d(e,t){return t=t||r.getDocument(),n.isString(e)?x(t.querySelector(e)):o(e)?x(e):null}function v(e,n){return e?t.getElement("#"+e,n):null}function m(e,t,n){n?E(e,t):S(e,t)}function g(e,t){t=t||r.getDocument();var n=t.querySelectorAll(e);return Array.prototype.slice.call(n,0)}function y(e,t){return t?e.previousSibling:e.nextSibling}function b(e){return g(['[tabindex]:not([tabindex=""]):not([tabindex="-1"]):not([disabled])'],e)}function w(e,t){if(e.classList)return e.classList.contains(t);var n=e.className?e.className.split(" "):[];for(var r=0;r<n.length;r++)if(n[r]===t)return!0;return!1}function E(e,t){if(!n.isString(t))return;if(e.classList){e.classList.add(t);return}var r=" "+e.className+" ";r.indexOf(t)<0&&(r+=t+" "),e.className=r.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function S(e,t){if(e.classList){e.classList.remove(t);return}e.className=e.className.replace(t,"").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function x(e){return e!==null&&(e.removeClass=function(t){S(e,t)},e.addClass=function(t){E(e,t)},e.hasClass=function(t){return w(e,t)},e.setClass=function(t,n){m(e,t,n)}),e}function T(e,t){var n,i=r.getWindow(),s=i.MutationObserver||i.WebKitMutationObserver;return s?(n=new s(function(e){e&&e[0]&&(e[0].addedNodes&&e[0].addedNodes.length||e[0].removedNodes&&e[0].removedNodes.length)&&t()}),n.observe(e,{childList:!0,subtree:!0})):e.addEventListener("DOMSubtreeModified",t,!1),{dispose:function(){s?n.disconnect():e.removeEventListener("DOMSubtreeModified",t)}}}function N(e){var t={offsetLeft:0,offsetTop:0};while(e)t.offsetLeft+=e.offsetLeft+e.clientLeft-e.scrollLeft,t.offsetTop+=e.offsetTop+e.clientTop-e.scrollTop,e=e.offsetParent;return t}function C(e,t){var n=e;while(n&&!n.contains(t))n=n.parentNode;return n}function k(e){var t=e.lastChild;while(t&&t.nodeType!==i)t=t.previousSibling;return t}function L(){return r.getDocument().hidden}var n=e("lodash-compat"),r=e("swx-browser-globals"),i=1;t.createElement=h,t.findElement=p,t.isElement=s,t.getElement=d,t.getElementById=v,t.getElements=g,t.getSibling=y,t.getNavigableChildren=b,t.isA=u,t.isVisible=a,t.hasClass=w,t.getParentWithClass=f,t.getParentMatching=l,t.addClass=E,t.setClass=m,t.removeClass=S,t.extendObject=x,t.createDomObserverSubscription=T,t.getElementOffset=N,t.findFirstCommonAncestor=C,t.getLastChildElement=k,t.isDocumentHidden=L}),define("utils/common/applicationFocusManager",["require","exports","module","swx-service-locator-instance","swx-constants","ui/telemetry/actions/actionNames","browser/dom","browser/document","swx-browser-detect"],function(e,t){function m(e){if(t.focusTrackingEnabled){e.target!==t.getLastFocusedElement()&&(e.target.setAttribute("data-focusManager",v),p.push(v),v++);if(p.length>h){var n=p.shift();y(n)}}}function g(e){return o.querySelector("["+c+'="'+e+'"]')}function y(e){var t=g(e);t&&t.removeAttribute(c)}var n=e("swx-service-locator-instance").default,r=e("swx-constants").COMMON,i=e("ui/telemetry/actions/actionNames"),s=e("browser/dom"),o=e("browser/document"),u=e("swx-browser-detect").default,a=".swx .chat .inputField",f=".swx .search .inputField",l="#swxSplashScreen",c="data-focusManager",h=2,p=[],d=null,v=0;return t.focusTrackingEnabled=!1,t.reset=function(){p.forEach(y),p=[],v=0},t.setDefaultFocusElement=function(e){d=e},t.getDefaultFocusElement=function(){return d},t.getLastFocusedElement=function(){return p.length?g(p[p.length-1]):null},t.removeLastFocusedElement=function(){var e=p.pop();y(e)},t.registerContainer=function(e){e.addEventListener("focus",m,!0)},t.unregisterContainer=function(e){e.removeEventListener("focus",m,!0)},t.tryRestoreFocus=function(){if(!t.focusTrackingEnabled)return;var e=n.resolve(r.serviceLocator.ACTION_TELEMETRY);e.recordAction(i.focusManager.tryRestoreFocus);var s=t.getLastFocusedElement();s&&s.focus();if(s===o.activeElement)return;var u=o.querySelector(l);if(u)return;var c=o.querySelector(a),h=o.querySelector(f);c&&c.focus();if(c===o.activeElement)return;h&&h.focus()},t.isAnyElementFocused=function(){var e=o.activeElement;return!!(!u.getBrowserInfo().isIeEngine||e&&Object.keys(e).length)&&!s.isA(e,"body")},t}),define("utils/common/appVisibilityProvider",["require","exports","module","vendor/knockout","browser/document","browser/window","swx-browser-detect","utils/common/applicationFocusManager"],function(e,t){function u(e){t.hasFocus(e)}var n=e("vendor/knockout"),r=e("browser/document"),i=e("browser/window"),s=e("swx-browser-detect").default,o=e("utils/common/applicationFocusManager");t.hasFocus=n.observable(),t.isVisible=function(e){e&&o.tryRestoreFocus()},t.init=function(){var e=s.getBrowserInfo();e.browserName===s.BROWSERS.EDGE?(i.addEventListener("focusin",u.bind(null,!0)),i.addEventListener("focusout",u.bind(null,!1))):(i.addEventListener("focus",u.bind(null,!0)),i.addEventListener("blur",u.bind(null,!1))),t.hasFocus(r.hasFocus())}}),define("telemetry/chat/messagesReceived",["require","services/telemetry/skypeData","telemetry/chat/activityItemHelper","utils/common/appVisibilityProvider","swx-jskype-internal-application-instance","swx-jskype-main/lib/utils/chat/endpointsDataProvider"],function(e){function o(){var e=i.get().conversationsManager;this.publish=function(o){var u,a,f=0;if(o.length===0)return;var l=n.getEmptyResult();l.totalCount=o.length;for(u=0;u<o.length;u++)a=o[u],n.updateResult(l,a.typeId),a.appIsActive&&f++;l.inOpenedApp=f,l.appHasFocus=r.hasFocus(),l.numberOfUnreadConversations=e.unreadConversationsCount(),l.activeEndpoints=s.get();var c={type:"chat_IM_receiveBatch",data:l};t.push(c)}}var t=e("services/telemetry/skypeData"),n=e("telemetry/chat/activityItemHelper"),r=e("utils/common/appVisibilityProvider"),i=e("swx-jskype-internal-application-instance"),s=e("swx-jskype-main/lib/utils/chat/endpointsDataProvider");return o}),define("utils/common/styleModeHelper",["require","exports","module","lodash-compat","browser/window","vendor/knockout","swx-constants","experience/settings"],function(e,t){function c(){function v(){var e=0;return c.length===0?r.innerWidth:(c.forEach(function(t){e+=t.offsetWidth}),e)}function m(){var t=v();e.currentMode(g(t))}function g(e){return e<=u.breakpoint.MEDIUM?u.NARROW:e>u.breakpoint.MEDIUM&&e<=u.breakpoint.WIDE?u.MEDIUM:u.WIDE}function y(){var e=b(f);return e&&(h=e),!!e}function b(e){return n.find(e,function(e){return o.biAppName.toLowerCase().indexOf(e.toLowerCase())>-1})}var e=this,t=500,a=n.debounce(m,t),c=[],h,p=y(),d=!!b(l);e.currentMode=i.observable(g(v())),p||r.addEventListener(s.events.browser.RESIZE,a),e.addContainer=function(t){c.push(t),e.currentMode(g(v()))},e.appIsVisible=function(){return c.length>0&&v()>0},e.isIntegratedProperty=function(){return p},e.isConsumerIntegrated=function(){return d},e.host=function(){return h},e.dispose=function(){p||r.removeEventListener(s.events.browser.RESIZE,a),c=[]}}var n=e("lodash-compat"),r=e("browser/window"),i=e("vendor/knockout"),s=e("swx-constants").COMMON,o=e("experience/settings"),u=s.styleMode,a=null,f={kahuna:"kahuna",owa:"outlook",o365:"o365",wac:"wac"},l={kahuna:"kahuna",owa:"outlook"};t.get=function(){return a===null&&(a=new c),a},t.dispose=function(){a!==null&&(a.dispose(),a=null)}}),define("telemetry/chat/messagesCollector",["require","telemetry/chat/activityItemHelper","telemetry/chat/messagesReceived","services/telemetry/common/telemetryContext","utils/common/styleModeHelper"],function(e){function u(){function u(){function t(){o=new n,o.publish(e.receivedMessagesInfo),e.receivedMessagesInfo=[],window.setTimeout(t,s)}window.setTimeout(t,s)}var e=r.get(),o;this.enqueueReceivedMessageInfo=function(r){var s={cmid:r.clientmessageid};s.typeId=t.getTelemetryMessageTypeObsolete(r),s.appIsActive=i.get().appIsVisible(),s.unreadMessages=r.conversationModel.historyService.unreadActivityItemsCount(),e.receivedMessagesInfo.push(s)},u()}var t=e("telemetry/chat/activityItemHelper"),n=e("telemetry/chat/messagesReceived"),r=e("services/telemetry/common/telemetryContext"),i=e("utils/common/styleModeHelper"),s=3e4,o;return u.get=function(){return o||(o=new u),o},u}),define("ui/appOverlay/appOverlay",["require","exports","module","swx-browser-globals","browser/dom","swx-constants","swx-service-locator-instance"],function(e,t){function f(){var e=n.getDocument();if(!o){var t,f=s.resolve(i.serviceLocator.CONTROLS_BUILDER);f.registeredElements.length?t=e.querySelector(f.registeredElements[0].element):t=e.querySelector("body"),o=t.parentNode}u=r.createElement("div"),u.id=a,o.appendChild(u)}function l(){o.removeChild(n.getDocument().querySelector("#"+a)),u=null,o=undefined}var n=e("swx-browser-globals"),r=e("browser/dom"),i=e("swx-constants").COMMON,s=e("swx-service-locator-instance").default,o=null,u=null,a="swx-app-overlay";t.create=function(e){return u||f(),e&&e.content&&u.appendChild(e.content),e&&e.className&&u.classList.add(e.className),u},t.destroy=function(){l()}}),define("telemetry/authentication/linking",["require","exports","module","ui/telemetry/telemetryClient","experience/settings"],function(e,t){function i(){function e(e){var t="linking";n.get().sendEvent(r.telemetry.uiTenantToken,t,{flow:e})}return{send:e}}var n=e("ui/telemetry/telemetryClient"),r=e("experience/settings");t.build=function(){return new i}}),define("utils/common/localStorage",[],function(){function e(){try{return window&&window.localStorage}catch(e){}}return{set:function(t,n){if(e())try{window.localStorage.setItem(t,n)}catch(r){}},get:function(t){if(e())try{return window.localStorage.getItem(t)}catch(n){}},remove:function(t){if(e())try{window.localStorage.removeItem(t)}catch(n){}}}}),define("telemetry/chat/sidebarReopenedEvent",["require","exports","module","lodash-compat","swx-constants","experience/settings","ui/telemetry/telemetryClient","services/telemetry/common/telemetryContext","swx-browser-globals","swx-cafe-application-instance","swx-telemetry-buckets"],function(e,t){function h(){function m(e){return w(e),b(e),e.getDaysSinceLastSignIn=T(),e.numberOfContacts=y(),e.endpointsCount=u.get().activeEndpoints.length,e}function g(e,t){o.get().sendEvent(s.telemetry.chatTenantToken,e,t)}function y(){return f.get().personsAndGroupsManager&&f.get().personsAndGroupsManager.all.persons()?f.get().personsAndGroupsManager.all.persons().length:p}function b(e){var t={},n=a.getWindow().localStorage,i=n.getItem(r.telemetry.idleUsersAnalytics.localKeys.sidebarActivity);i&&(t=JSON.parse(i)),e.daysSinceSidebarOpened=N(t),e.isMau=l.isMau(t),e.isMauCandidate=l.isMauCandidate(t),e.isDauCandidate=l.isDauCandidate(t)}function w(e){var t,n,r;if(f.get().conversationsManager&&f.get().conversationsManager._allConversations){t=f.get().conversationsManager._allConversations(),e.numberOfConversations=t.length;for(n=0;n<t.length;n++)E(t[n],e);e.daysSinceLastConversation===undefined&&(e.daysSinceLastConversation=p),r=f.get().conversationsManager._unreadConversations(),e.numberOfUnreadConversations=r.length,e.numberOfUnreadNonGroups=0,e.numberOfUnreadGroups=0;for(n=0;n<r.length;n++)S(r[n],e)}}function E(e,t){var n,r=e.lastMessage;if(!r)return;n=l.getDays(new Date(r.composetime));if(t.daysSinceLastConversation===undefined||t.daysSinceLastConversation>n)t.daysSinceLastConversation=n}function S(e,t){var n=C(e.id);n?t.numberOfUnreadGroups=t.numberOfUnreadGroups+1:t.numberOfUnreadNonGroups=t.numberOfUnreadNonGroups+1}function x(e){function t(t){var n=t[0]||0,r=t[1]||0,s=p;return n===0&&r===0?s=i.unreadState.NONE:n>0&&r===0?s=i.unreadState.PASSIVE:n===0&&r>0?s=i.unreadState.ACTIVE:n>0&&r>0&&(s=i.unreadState.BOTH),e.pastUnreadMessages=n,e.activeUnreadMessages=r,e.unreadState=s,e}return d._unreadCounversationsCounters?d._unreadCounversationsCounters().then(t):Promise.reject(e)}function T(){try{var e,t=r.telemetry.idleUsersAnalytics.localKeys.signInData,n=a.getWindow().localStorage.getItem(t),i=n?JSON.parse(n):[];return!i||i.length<2?p:(e=i[i.length-2],l.getDays(new Date(e)))}catch(s){return p}}function N(e){return e&&e.sidebar&&e.sidebar.lastTimeOpened?l.getDays(new Date(e.sidebar.lastTimeOpened)):p}function C(e){return n.isString(e)&&/^19:/.test(e)}function k(){return a.getWindow().Date.now()}var e=this,t=k(),h,p=r.telemetry.NOT_AVAILABLE,d=f.get().conversationsManager,v;e.publishReopen=function(){h=a.getWindow().setTimeout(e.publishCloseTimeout,6e4);var t=r.telemetry.reopenSidebar.REOPENED,n={};return v=!0,x(n).then(m,m).then(g.bind(null,t),g.bind(null,t))},e.publishCloseTimeout=function(e){if(!v)return Promise.resolve();a.getWindow().clearTimeout(h);var n=r.telemetry.reopenSidebar.CLOSE_TIMEOUT,i={timeToClose:k()-t,closedByUser:!!e};return v=!1,x(i).then(m,m).then(g.bind(null,n),g.bind(null,n))},e.clear=function(){c=null}}var n=e("lodash-compat"),r=e("swx-constants").COMMON,i=r.telemetry.browserToast,s=e("experience/settings"),o=e("ui/telemetry/telemetryClient"),u=e("services/telemetry/common/telemetryContext"),a=e("swx-browser-globals"),f=e("swx-cafe-application-instance"),l=e("swx-telemetry-buckets"),c;t.build=function(){return c||(c=new h),c}}),define("telemetry/authentication/signIn",["require","exports","module","ui/telemetry/telemetryClient","experience/settings","swx-constants","swx-utils-common","utils/common/localStorage","swx-browser-globals","swx-utils-common","telemetry/chat/sidebarReopenedEvent","swx-service-locator-instance"],function(e,t){function h(){var e=a.get(i.storageKeys.AAD_TOKEN_EXPIRED);return e&&a.remove(i.storageKeys.AAD_TOKEN_EXPIRED),e}function p(){function t(t){var i="signIn",s={};s.duration=e.duration(),s.authType=t.authType,s.success=t.hasSucceed,s.hostname=location.hostname,s.retry=t.retry||!1,t.isExternalSignIn&&(s.isExternalSignIn=t.isExternalSignIn),h()&&(s.isExternalSignInAfterTokenRefresh=!0),t.hasSucceed||(s.error=t.error,s.jCafeStatus=t.jCafeStatus||"",t.details&&(s.reason=t.details.reason||"",s.request=t.details.request||"",s.response=t.details.response||"")),t.flow&&(s.flow=t.flow),n.get().sendEvent(r.telemetry.uiTenantToken,i,s),n.get().setAuthType&&n.get().setAuthType(t.authType)}d();var e=s.build();return{send:t}}function d(){var e=i.telemetry.idleUsersAnalytics.localKeys.signInData,t=i.telemetry.idleUsersAnalytics.localKeys.sidebarActivity,n,r,s;try{s=o.get(e),n=s?JSON.parse(s):[],n.length>=10&&n.splice(0,n.length-9),n.push(new Date),o.set(e,JSON.stringify(n)),s=o.get(t),r=s?JSON.parse(s):{sidebar:{}},r.sidebar.numberOfSignIns?r.sidebar.numberOfSignIns=r.sidebar.numberOfSignIns+1:r.sidebar.numberOfSignIns=1,o.set(t,JSON.stringify(r)),v(r)}catch(u){}}function v(e){var t=l.resolve(i.serviceLocator.FEATURE_FLAGS);if(!t.isFeatureOn(i.featureFlags.REOPEN_SIDEBAR))return;if(!e.sidebar.state||e.sidebar.state!=="opened")return;var n=u.getWindow(),r=function(){try{n.$ToggleSidebar&&(n.$ToggleSidebar(),f.build().publishReopen())}catch(e){}};n.$Do&&n.$Do.when&&n.$ToggleSidebar?n.$Do.when("$WLXIM.SidebarCreated",0,r):n.setTimeout(r,c)}var n=e("ui/telemetry/telemetryClient"),r=e("experience/settings"),i=e("swx-constants").COMMON,s=e("swx-utils-common").stopwatch,o=e("utils/common/localStorage"),u=e("swx-browser-globals"),a=e("swx-utils-common").sessionStorage,f=e("telemetry/chat/sidebarReopenedEvent"),l=e("swx-service-locator-instance").default,c=500;t.build=function(){return new p}}),define("experience/api/auth/authEventHandler",["require","exports","module","swx-constants","swx-pubsub-instance"],function(e,t){function s(e){return e&&e.name===n.api.auth.errorTypes.NOT_LINKED}function o(e){r.publish(n.events.auth.SIGNIN_FAILED,e)}function u(){i=!0,r.unsubscribe(n.apiUIEvents.SWX_SPLASHSCREEN_LOADED,u)}var n=e("swx-constants").COMMON,r=e("swx-pubsub-instance").default,i;t.init=function(){r.subscribe(n.apiUIEvents.SWX_SPLASHSCREEN_LOADED,u)},t.destroy=function(){r.unsubscribe(n.apiUIEvents.SWX_SPLASHSCREEN_LOADED,u)},t.deferActionOnSplashscreen=function(e,t){function s(){typeof e=="function"&&e(t)}i?(s(),r.unsubscribe(n.apiUIEvents.SWX_SPLASHSCREEN_LOADED,s)):r.subscribe(n.apiUIEvents.SWX_SPLASHSCREEN_LOADED,s)},t.setErrorType=function(e){e.message===n.silentLogin.errorMessages.NOT_LINKED&&(e.name=n.api.auth.errorTypes.NOT_LINKED,e.reason=n.api.auth.errorMessages.NOT_LINKED)},t.startAuthFailedFlow=function(e,n,r){if(!s(e)){t.deferActionOnSplashscreen(o,e);return}r?n():t.deferActionOnSplashscreen(n)}}),define("experience/api/auth/linking",["require","exports","module","swx-cafe-application-instance","experience/settings","ui/appOverlay/appOverlay","swx-xco","swx-constants","swx-enums","telemetry/authentication/linking","telemetry/authentication/signIn","experience/api/auth/authEventHandler"],function(e,t){function c(e){return e.relink?o.api.auth.accountLinking.RELINK_FLOW:e.createTechnical?o.api.auth.accountLinking.INLINE_NEW_USER_FLOW:o.api.auth.accountLinking.WELCOME_FLOW}function h(e){var t=a.build();t.send(e)}function p(e){var t=f.build();t.send(e)}function d(e){var t={authType:u.authType.ImplicitOAuth,hasSucceed:!0,flow:e};p(t)}function v(e,t,n){var r={authType:u.authType.ImplicitOAuth,hasSucceed:!1,error:t.error,flow:e};p(r),l.startAuthFailedFlow(t,n)}function m(e){function u(e){var t=n.get().signInManager;if(b(e)){var i=t.createTokenImplicitOAuthSignInParameter({skypetoken:e.skypetoken,rps_token:e.rps_token,expires_in:e.expires_in,client_id:r.implicitOAuthParams.client_id,site_name:e.site_name});return t.signIn(i)}return Promise.reject()}var t,o=c(e);if(!e.rps_token)throw"[XCO Linking] You have to provide an rps token!";if(e.welcome&&e.createTechnical)throw'[XCO Linking] You cannot start both "createTechnical" and "welcome" flows';t={client_id:"580081",clientVersion:r.uiVersion,rps_token:e.rps_token,microsoft:!0,env:r.xcoEnv,setlang:r.initParams.locale,createTechnical:e.createTechnical||!1,hidden:e.hidden||!1,welcome:e.welcome||!1,relink:e.relink||!1,theme:"skype-white",site_name:e.site_name||null,callback:function(t){function r(){g(e.onSuccess),i.destroy(),d(o)}function s(){g(e.onError,t),i.destroy()}var n=e.callback||u;return y(t)&&v(o,t,n),n(t).then(r,s)}},h(o),s.init(t),s.load(i.create())}function g(e,t){typeof e=="function"&&e(t)}function y(e){return e&&e.error}function b(e){return e&&e.skypetoken}var n=e("swx-cafe-application-instance"),r=e("experience/settings"),i=e("ui/appOverlay/appOverlay"),s=e("swx-xco").linking,o=e("swx-constants").COMMON,u=e("swx-enums"),a=e("telemetry/authentication/linking"),f=e("telemetry/authentication/signIn"),l=e("experience/api/auth/authEventHandler");t.start=m}),define("experience/authContext",["require","lodash-compat"],function(e){function i(){return r}function s(){t.assign(r,n)}var t=e("lodash-compat"),n={implicitSignIn:!1,implicitSignOut:!1},r=t.clone(n);return{get:i,reset:s}}),define("jCafe",["require","lodash-compat","jSkype/root","services/telemetry/common/telemetryContext","services/telemetry/eventBus","telemetry/chat/messagesCollector","experience/api/auth/linking","experience/authContext"],function(e){var t=e("lodash-compat"),n=e("jSkype/root"),r=e("services/telemetry/common/telemetryContext"),i=e("services/telemetry/eventBus"),s=e("telemetry/chat/messagesCollector"),o=e("experience/api/auth/linking"),u=e("experience/authContext"),a=t.clone(n);return a.Application=function(e){e=e||{};var a=t.clone(e);return t.assign(a,{linkingApi:o,authContext:u,telemetry:{context:r.get(),messagesCollector:s.get(),eventBus:i.get()}}),new n.Application(a)},a.Application.create=a.Application,a}),define("ui/modelHelpers/personHelper",["require","exports","module","lodash-compat","swx-cafe-application-instance","swx-constants"],function(e,t){function o(e){return n.isFunction(e.type)}function u(e){return n.isFunction(e.isAgent)}function a(e){return!!e._authorization&&n.isFunction(e._authorization)}function f(e){if(n.isString(e))return e.replace(s,"")}var n=e("lodash-compat"),r=e("swx-cafe-application-instance"),i=e("swx-constants").PEOPLE,s=/^(?:(\d+):)+/;t.isMePersonId=function(e){var t=r.get().personsAndGroupsManager.mePerson,n=f(e);return t.id()===n||t._msaId&&f(t._msaId())===n},t.isMePerson=function(e){return t.isMePersonId(e.id())},t.isGuestId=function(e){return/^guest:/.test(e)},t.isGuest=function(e){return t.isGuestId(e.id())},t.isTechnicalAccount=function(e){return/^live:/.test(e.id())},t.isEchoContact=function(e){return t.isEchoContactId(e.id())},t.isEchoContactId=function(e){return e===i.ECHO_CONTACT_ID},t.isAgent=function(e){return u(e)&&e.isAgent()},t.isAuthorizedContact=function(e){return a(e)?e._authorization()===i.authorizationStates.AUTHORIZED:!0},t.isSuggestedContact=function(e){return a(e)&&e._authorization()===i.authorizationStates.SUGGESTED},t.isPstn=function(e){return o(e)&&e.type()==="Phone"||!!e.phoneNumbers.size()&&e.id()===e.phoneNumbers(0).telUri()},t.hasPhoneNumbers=function(e){return!!e.phoneNumbers.size()},t.isKnownPerson=function(e){return!!e&&r.get().personsAndGroupsManager.all.persons().filter(function(t){return t.id()===e.id()}).length===1},t.isOrganizationContact=function(e){return n.isFunction(e._isOrganizationContact)?e._isOrganizationContact():!1},t.getId=f,t.isWelcomeAgent=function(e){return!!e&&!!o(e)&&e.type()==="ReplayBot"}}),define("utils/common/cafeObservable",["require","vendor/knockout"],function(e){function r(e,t){if(n[t])return n[t];for(var r in e)if(r!==t&&e[r]===e[t])return n[t]=r,r;return n[t]=t,t}function i(e){return t.utils.extend(e,t.observableArray.fn),e.extend({trackArrayChanges:!0})}function s(e,n){function l(){i.valueHasMutated()}function c(){var t;s.getSubscriptionsCount()||(e.observed()||(t=e.get.bind(e)),f&&(a=e.subscribe()),e.changed(l,t))}function h(){e.changed.off(l),a&&(a.dispose(),a=null)}var i=t.observable(),s,o,u,a,f;return n=n||{},f=n.keepAlive,s=t.pureComputed({deferEvaluation:!0,read:function(){return i(),e()}}),o=r(s,"subscribe"),u=s[o],s.subscribe=s[o]=function(){var e,t,n;return c(),t=r(s,"dispose"),e=u.apply(s,arguments),n=e[t].bind(e),e.dispose=e[t]=function(){n(),s.getSubscriptionsCount()||h()},e},s}function o(e,n){function c(){i.valueHasMutated()}function h(){var e;s&&!f&&u.getSubscriptionsCount()&&(s.observed()||(e=s.get.bind(s)),l&&(f=s.subscribe()),s.changed(c,e))}function p(){s&&!u.getSubscriptionsCount()&&(s.changed.off(c),f&&(f.dispose(),f=null))}var i=t.observable(),s,o,u,a,f,l;return n=n||{},l=n.keepAlive,u=t.pureComputed({deferEvaluation:!0,read:function(){return i(),s?s():e}}),o=r(u,"subscribe"),a=u[o],u.subscribe=u[o]=function(){var e,t,n;return t=r(u,"dispose"),e=a.apply(u,arguments),n=e[t].bind(e),h(),e.dispose=e[t]=function(){n(),p()},e},u.bindToProperty=function(e){s=e,h(),c()},u}function u(e,n){function h(){var t;o.getSubscriptionsCount()||(e.observed()||(t=e.get.bind(e)),c&&(l=e.subscribe()),f=f||e.observe(function(){s.valueHasMutated()}),t&&t())}function p(){f&&(f.dispose(),f=null),l&&(l.dispose(),l=null)}var s=t.observable(),o,u,a,f,l,c;return n=n||{},c=n.keepAlive,o=t.pureComputed({deferEvaluation:!0,read:function(){return s(),e()}}),u=r(o,"subscribe"),a=o[u].bind(o),o.subscribe=o[u]=function(){var e,t,n;return h(),t=r(o,"dispose"),e=a.apply(o,arguments),n=e[t].bind(e),e.dispose=e[t]=function(){n(),o.getSubscriptionsCount()===s.getSubscriptionsCount()&&p()},e},o=i(o),o}var t=e("vendor/knockout"),n={};return{newObservableProperty:s,newDeferredObservableProperty:o,newObservableCollection:u}}),define("ui/telemetry/actions/registry/traceableAction",["require","exports","module","lodash-compat","swx-utils-common","usertiming","experience/settings","swx-service-locator-instance","swx-constants","ui/telemetry/telemetryClient"],function(e,t){function f(e,t){function v(e){var t=e+"_mark_";return{start:t+"start",beforeRender:t+"before_render",afterRender:t+"after_render"}}function m(e){var t=e+"_duration_";return{beforeRenderDuration:t+"before_render",afterRenderDuration:t+"after_render"}}function g(){n.forIn(c,function(e){i.clearMarks(e)}),n.forIn(h,function(e){i.clearMeasures(e)})}function y(t){var n=i.getEntriesByName(t);n&&n[0]&&(e[b(t)]=n[0].duration)}function b(e){return e.replace(l+"_","")}function w(){return i.getEntriesByName(c.start).length>0}var f=this,l=r.create(),c=v(l),h=m(l),p=!1,d=o.resolve(u.serviceLocator.FEATURE_FLAGS);f.startTrace=function(){i.mark(c.start)},f.markBeforeRender=function(){w()&&(i.mark(c.beforeRender),i.measure(h.beforeRenderDuration,c.start,c.beforeRender),y(h.beforeRenderDuration),p=!0)},f.markAfterRender=function(){w()&&(i.mark(c.afterRender),i.measure(h.afterRenderDuration,c.start,c.afterRender),y(h.afterRenderDuration),p=!0)},f.addEventData=function(t){n.isPlainObject(t)&&n.merge(e,t)},f.endTrace=function(){p&&(d.isFeatureOn(u.featureFlags.TELEMETRY_UIACTIONPERF_ENABLED)&&a.get().sendEvent(s.telemetry.uiTenantToken,"ui_action_perf",e),g(),t())}}var n=e("lodash-compat"),r=e("swx-utils-common").guid,i=e("usertiming"),s=e("experience/settings"),o=e("swx-service-locator-instance").default,u=e("swx-constants").COMMON,a=e("ui/telemetry/telemetryClient");t.build=function(e,t){return new f(e,t)}}),define("ui/telemetry/actions/registry/api",["require","ui/telemetry/actions/registry/traceableAction"],function(e){function n(){function n(t){delete e[t]}var e={};this.createAction=function(r){return e[r.actionName]=t.build(r,n.bind(undefined,r.actionName)),e[r.actionName]},this.getAction=function(t){return e[t]}}var t=e("ui/telemetry/actions/registry/traceableAction");return n}),define("ui/telemetry/actions/registry/singleton",["require","exports","module","ui/telemetry/actions/registry/api"],function(e,t){var n=e("ui/telemetry/actions/registry/api"),r;t.getInstance=function(){return r||(r=new n),r}}),define("ui/telemetry/actions/actionTelemetryApi",["require","exports","module","lodash-compat","experience/settings","ui/telemetry/actions/registry/singleton","ui/telemetry/telemetryClient"],function(e,t){function o(){var e=this;e.recordAction=function(e,t){var i=n.merge({actionName:e},t);s.get().sendEvent(r.telemetry.uiTenantToken,"ui_action",i)},e.createTraceableAction=function(e){var t={actionName:e};return i.getInstance().createAction(t)},e.getTraceableAction=function(e){return i.getInstance().getAction(e)}}var n=e("lodash-compat"),r=e("experience/settings"),i=e("ui/telemetry/actions/registry/singleton"),s=e("ui/telemetry/telemetryClient");t.build=function(){return new o}}),define("experience/api/me",["require","exports","module","vendor/knockout","swx-cafe-application-instance","swx-enums","ui/modelHelpers/personHelper","utils/common/cafeObservable","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionTelemetryApi"],function(e,t){var n=e("vendor/knockout"),r=e("swx-cafe-application-instance"),i=e("swx-enums"),s=e("ui/modelHelpers/personHelper"),o=e("utils/common/cafeObservable"),u=e("ui/telemetry/actions/actionNames"),a=e("ui/telemetry/actions/actionTelemetryApi"),f=n.observable(!1);t.isExpanded=f,t.expose=function(){function v(){var e=[];return d()?(e=h().filter(function(e){return!s.isAgent(e)}),e.length):0}function m(t){e.status(t),p.recordAction(u.presence.change,{presence:t})}function g(){e.status.reset()}var e=r.get().personsAndGroupsManager.mePerson,t=n.observable(!1),l=o.newObservableProperty(e.status,{keepAlive:!0}),c={read:function(){return l()},write:m},h=o.newObservableCollection(r.get().personsAndGroupsManager.all.persons,{keepAlive:!0}),p=a.build(),d=n.observable(!1);return r.get().signInManager.state.changed(function(e){t(e===i.loginState.SignedIn||e===i.loginState.SigningOut)}),e.id.get().then(function(){d(!0)}),{authenticated:t,uri:o.newObservableProperty(e.id),displayName:o.newObservableProperty(e.displayName),avatar:o.newObservableProperty(e.avatarUrl),status:n.computed(c),resetStatus:g,mood:o.newObservableProperty(e.activity),note:{type:o.newObservableProperty(e.note.type),text:o.newObservableProperty(e.note.text)},numberOfNonAgentContacts:n.computed({read:v}),isExpanded:f}}}),define("experience/api/contact",["require","exports","module","swx-cafe-application-instance","swx-enums","swx-constants","ui/telemetry/actions/actionNames","utils/common/cafeObservable","swx-service-locator-instance"],function(e,t){var n=e("swx-cafe-application-instance"),r=e("swx-enums"),i=e("swx-constants").COMMON,s=e("ui/telemetry/actions/actionNames"),o=e("utils/common/cafeObservable"),u=e("swx-service-locator-instance").default;t.getByUri=function(e){function p(){var e=c.results().length,t=e?c.results(0).result:undefined;t&&(f.status.bindToProperty(t.status),f.displayName.bindToProperty(t.displayName),f.avatar.bindToProperty(t.avatarUrl),f.uri.bindToProperty(t.id)),l.markBeforeRender(),l.addEventData({source:"api_contact_search",results:e}),l.endTrace()}var t=u.resolve(i.serviceLocator.FEATURE_FLAGS),a=!t.isFeatureOn(i.featureFlags.DISABLE_PERSISTENT_CONTACT_PRESENCE_SUBSCRIPTION),f={status:o.newDeferredObservableProperty(null,{keepAlive:a}),displayName:o.newDeferredObservableProperty(),avatar:o.newDeferredObservableProperty(),uri:o.newDeferredObservableProperty()},l=u.resolve(i.serviceLocator.ACTION_TELEMETRY).createTraceableAction(s.search.started),c=n.get().personsAndGroupsManager.createPersonSearchQuery(),h=r.searchScope.AddressBook;return l.startTrace(),c.sources(h).keywords.id=e,c.getMore().then(p),f}}),define("constants/components",{calling:{CALL_SCREEN:"swx-call-screen",ROSTER:"swx-call-roster",CALL_ANIMATION:"swx-call-animation",END_CALL:"swx-end-call",CONTENT:"swx-call-content",HEADER:"swx-call-header",FOOTER:"swx-call-footer",PARTICIPANT_MENU:"swx-participant-menu",JOINCALL_BUTTON:"swx-joincall-button",START_CALL_BUTTON:"swx-start-call-button",SKYPEOUT_PAGE:"swx-skype-out",SKYPEOUT_HEADER:"swx-skype-out-header",SKYPEOUT_DIALPAD:"swx-dialpad",SKYPEOUT_COUNTRY_PICKER:"swx-countrypicker",CQF:"swx-cqf",CQF_STAR_RATING:"swx-star-rating",CQF_QUESTION:"swx-cqf-question",SCREEN_SHARING_PREVIEW:"swx-screen-sharing-preview",UNANSWERED_CALL:"swx-unanswered-call",CALL_SCREEN_MODAL:"swx-call-screen-modal",ADD_PARTICIPANTS:"swx-add-participants"},chat:{CHAT_LOG:"swx-chat-log",CHAT_INPUT:"swx-chat-input",CONVERSATION:"swx-conversation",GROUP_SEARCH:"swx-group-search",INVITE_LINK:"swx-invite-link",HEADER_NEW_CONVERSATION:"swx-header-new-conversation",MESSAGE:"swx-message",NAVIGATION:"swx-navigation",SIDEBAR:"swx-sidebar",NEW_CONVERSATION:"swx-new-conversation",CONTACT_PICKER_INPUT:"swx-contact-picker-input",SPACE_SETTINGS:"swx-space-settings",RECENTS:"swx-recents",TEXTAREA:"swx-textarea",CURRENT_CALL:"swx-current-call",UNREAD_MESSAGE_COUNTER:"swx-unread-message-counter",CURRENT_CALL_ACTIONS:"swx-current-call-actions",RECENT_ITEM:"swx-recent-item",CONTACT_PILL:"swx-contact-pill",CONTACT_CARD:"swx-contact-card",MENU_ITEM:"swx-menu-item",HEADER:"swx-header",HEADER_SINGLE_CONVERSATION:"swx-header-single-conversation",GROUP_PROFILE:"swx-group-profile",TYPING_INDICATOR:"swx-typing-indicator",EXPRESSION_PICKER:"swx-expression-picker",EXPRESSION_ITEMS_PICKER:"swx-expressionitems-picker",EXPRESSION_ITEM_ROSTER:"swx-expressionitem-roster",EXPRESSION_STORE_V2_BROWSE_PACKS:"swx-expressionstore-v2-browsepacks",CONVERSATION_SHARE_LINK:"swx-conversation-share-link",SELECTED_PARTICIPANTS_CONVERSATION:"swx-selected-participants-conversation",CONVERSATION_CARD:"swx-conversation-card",SHARE_DIALOG_INPUT:"swx-share-dialog-input",FILE_PICKER:"swx-file-picker",NOTIFICATIONS_CENTER:"swx-notifications-center",NOTIFICATIONS_MENU_ITEM:"swx-notifications-menu-item",NOTIFICATIONS_TOGGLE_BUTTON:"swx-notifications-toggle-button",UPLOAD_MANAGER:"swx-upload-manager",POLL_DESIGNER:"swx-poll-designer",STICKY_MESSAGE:"swx-sticky-message",FILE_TRANSFER_ACTIVITY_ACTIONS:"swx-filetransfer-activity-actions",CHAT_INPUT_ACTION_PICKER:"swx-chat-input-action-picker",CHAT_INPUT_SEND_CONTACT_CARD:"swx-chat-input-send-contact-card",CHAT_INPUT_POLL_BUTTON:"swx-chat-input-poll-button",SHARE_CONTROL:"swx-share-control",START_CONVERSATION_OVERLAY:"swx-start-conversation-overlay",SUGGESTION_LIST:"swx-suggestion-list",VIDEO_PLAYER:"swx-video-player",AUDIO_PLAYER:"swx-audio-player",GIFPLAYER:"swx-gif-player",HEART_TOAST:"swx-heart-toast",USER_LIST_POPUP:"swx-user-list-popup",TRANSLATOR_SETTINGS:"swx-translator-settings",TRANSLATOR_LANGUAGE_PICKER:"swx-translator-language-picker",MORE_ACTIONS_BUTTON:"swx-more-actions-button",HEART:"swx-heart",NARRATOR:"swx-narrator",MESSAGES_SEARCH:"swx-messages-search",MUTE_CONVERSATION_SETTING_ITEM:"swx-mute-conversation-setting-item",MESSAGE_DESTINATION_PICKER:"swx-message-destination-picker",SMS_PRICE:"swx-sms-price"},experience:{BUTTON:"swx-button",SEARCH_INPUT:"swx-search-input",SEARCH_RESULTS:"swx-search-results",LOADING_ANIMATION:"swx-loading-animation",RADIO_BUTTON:"swx-radio-button",SELECT_BOX:"swx-select-box",TOGGLE_BUTTON:"swx-toggle-button",AVATAR_FILE_PICKER:"swx-avatar-file-picker",EDUCATIONAL_CAROUSEL:"swx-edu-carousel",TEAMS_ALERT:"swx-teams-alert",TEAMS_MIGRATED:"swx-teams-migrated"},people:{AVATAR:"swx-avatar",AVATAR_DEPRECATED:"swx-avatar-deprecated",NAME:"swx-name",CONTACT_PICKER:"swx-contact-picker",PEOPLE_SEARCH:"swx-people-search",CONTACT_LIST_MENU_ITEM:"swx-contact-list-menu-item",DIRECTORY_SEARCH:"swx-directory-search",DISCOVER_AGENTS_PAGE:"swx-discover-agents",CONTACTS_PAGE:"swx-contacts",CONTACT_PROFILE:"swx-contact-profile",CONTACT_PROFILE_PHONE_NUMBER:"swx-contact-profile-phone-number",CONTACT_REQUEST_INCOMING:"swx-contact-request-incoming",CONTACT_REQUEST_OUTGOING:"swx-contact-request-outgoing",CONTACT_REQUEST_OUTGOING_RESEND:"swx-contact-request-outgoing-resend"},commerce:{CREDIT_BALANCE:"swx-credit-balance",SUBSCRIPTION_ENTITLEMENT:"swx-subscription-entitlement"},me:{AREA:"swx-me-area",PRESENCE_POPUP:"swx-me-presence-popup",MOOD_MESSAGE:"swx-me-mood-message"},userSettings:{USER_SETTINGS_PAGE:"swx-user-settings-page",SHORT_CIRCUIT:"swx-short-circuit",ABOUT:"swx-about",AUDIO_VIDEO_SETTINGS_PANE:"swx-audio-video-settings-pane"},notifications:{NOTIFICATION_BOX:"swx-notification-box"}}),define("ui/viewModels/chat/navigationHelper",["require","exports","module","lodash-compat","swx-pubsub-instance","swx-constants","constants/components"],function(e,t){var n=e("lodash-compat"),r=e("swx-pubsub-instance").default,i=e("swx-constants").COMMON,s=e("constants/components");t.navigateToContactsPage=function(t){function o(){r.publish(i.events.navigation.NAVIGATE,{page:s.people.CONTACTS_PAGE}),t()}t=n.isFunction(t)?t:n.noop,o()},t.navigateToConversation=function(t,n){r.publish(i.events.navigation.OPEN_CONVERSATION,{model:t,origin:n})}}),define("services/plugin/pluginDownload",["require","browser/dom","swx-browser-detect","experience/settings"],function(e){function i(){var e;n.getSystemInfo().osName===n.OPERATING_SYSTEMS.WINDOWS?e=r.plugin.download.msi:e=r.plugin.download.pkg,s(e)}function s(e){var n=t.createElement("iframe");n.src=e,n.width="0",n.height="0",n.style.border="0",n.style.position="absolute",n.style.top="0",n.style.left="0",document.body.appendChild(n)}var t=e("browser/dom"),n=e("swx-browser-detect").default,r=e("experience/settings");return{downloadPlatformSpecificInstaller:i}}),define("ui/viewModels/calling/helpers/browserInstallContent",["require","swx-browser-detect","experience/settings","swx-i18n","swx-constants","swx-service-locator-instance"],function(e){function f(){var e,n,r={osName:t.getSystemInfo().osName,browserName:t.getBrowserInfo().browserName};return r.osName!==t.OPERATING_SYSTEMS.MACOSX?n={osName:t.OPERATING_SYSTEMS.WINDOWS,browserName:t.BROWSERS.MSIE}:n={osName:t.OPERATING_SYSTEMS.MACOSX,browserName:t.BROWSERS.SAFARI},l(t.getSystemInfo().osName)?e=r:e=n,c(e.osName,e.browserName)}function l(e){return e===t.OPERATING_SYSTEMS.WINDOWS||e===t.OPERATING_SYSTEMS.MACOSX}function c(e,t){var n,i=a[e][t];return i||(i=a.Windows.Unknown),n={images:{closeScreen:d(i.closeScreen.image),download:d(i.download.image),install:d(i.install.image),enjoy:d(i.enjoy.image)},text:{closeScreen:r.fetch({key:i.closeScreen.text}),download:r.fetch({key:i.download.text}),install:r.fetch({key:i.install.text}),enjoy:g(i.enjoy.text)}},i.unblock&&h(n,i.unblock),i.extensionStart&&p(n,i),n}function h(e,t){e.images.unblock=d(t.image),e.text.unblock=r.fetch({key:t.text})}function p(e,t){e.images.extensionStart=d(t.extensionStart.image),e.text.extensionStart=r.fetch({key:t.extensionStart.text}),e.images.extensionInstallPlugin=d(t.extensionInstallPlugin.image),e.text.extensionInstallPlugin=r.fetch({key:t.extensionInstallPlugin.text}),e.images.extensionInstallFailed=d(t.extensionInstallFailed.image),e.text.extensionInstallFailed=r.fetch({key:t.extensionInstallFailed.text})}function d(e){return[n.assetsBaseUrl,o,e,u].join("")}function v(){return s.resolve(i.serviceLocator.FEATURE_FLAGS).isFeatureOn(i.featureFlags.USE_BUSINESS_WORDING)}function m(e){return e+"_4b"}function g(e){return v()?r.fetch({key:m(e)}):r.fetch({key:e})}var t=e("swx-browser-detect").default,n=e("experience/settings"),r=e("swx-i18n").localization,i=e("swx-constants").COMMON,s=e("swx-service-locator-instance").default,o="/images/components/av/installSteps/",u=".jpg",a={"Mac OS X":{Chrome:{closeScreen:{image:"CloseScreen",text:"pluginInstall_main_close_screen_subtitle"},download:{image:"Mac_01_Chrome",text:"pluginInstall_mac_chrome_text_download"},install:{image:"Mac_02_Install",text:"pluginInstall_mac_chrome_text_install"},enjoy:{image:"Mac_03_Skype",text:"pluginInstall_mac_chrome_text_enjoy"},unblock:{image:"Blocked_Chrome",text:"pluginInstall_unblock_text_chrome_subtitle"},extensionStart:{image:"PluginChromeIcon",text:"pluginInstall_extension_main_text_subtitle"},extensionInstallFailed:{image:"CloseScreen",text:"pluginInstall_extension_main_install_failed_text_subtitle"},extensionInstallPlugin:{image:"DownloadIcon",text:"pluginInstall_extension_main_installed_text_subtitle"}},Safari:{closeScreen:{image:"CloseScreen",text:"pluginInstall_main_close_screen_subtitle"},download:{image:"Mac_01_Safari",text:"pluginInstall_mac_safari_text_download"},install:{image:"Mac_02_Install",text:"pluginInstall_mac_safari_text_install"},enjoy:{image:"Mac_03_Skype",text:"pluginInstall_mac_safari_text_enjoy"}},Firefox:{closeScreen:{image:"CloseScreen",text:"pluginInstall_main_close_screen_subtitle"},download:{image:"Mac_01_Firefox",text:"pluginInstall_mac_firefox_text_download"},install:{image:"Mac_02_Install",text:"pluginInstall_mac_firefox_text_install"},enjoy:{image:"Mac_03_Skype",text:"pluginInstall_mac_firefox_text_enjoy"},unblock:{image:"Blocked_Firefox",text:"pluginInstall_unblock_text_firefox_subtitle"}},Unknown:{closeScreen:{image:"CloseScreen",text:"pluginInstall_main_close_screen_subtitle"},download:{image:"Mac_01_Safari",text:"pluginInstall_mac_unknown_text_download"},install:{image:"Mac_02_Install",text:"pluginInstall_mac_unknown_text_install"},enjoy:{image:"Mac_03_Skype",text:"pluginInstall_mac_unknown_text_enjoy"}}},Windows:{Chrome:{closeScreen:{image:"CloseScreen",text:"pluginInstall_main_close_screen_subtitle"},download:{image:"Windows_01_Chrome",text:"pluginInstall_windows_chrome_text_download"},install:{image:"Windows_02_Install",text:"pluginInstall_windows_chrome_text_install"},enjoy:{image:"Windows_03_Skype",text:"pluginInstall_windows_chrome_text_enjoy"},unblock:{image:"Blocked_Chrome",text:"pluginInstall_unblock_text_chrome_subtitle"},extensionStart:{image:"PluginChromeIcon",text:"pluginInstall_extension_main_text_subtitle"},extensionInstallFailed:{image:"CloseScreen",text:"pluginInstall_extension_main_install_failed_text_subtitle"},extensionInstallPlugin:{image:"DownloadIcon",text:"pluginInstall_extension_main_installed_text_subtitle"}},MSIE:{closeScreen:{image:"CloseScreen",text:"pluginInstall_main_close_screen_subtitle"},download:{image:"Windows_01_IE",text:"pluginInstall_windows_msie_text_download"},install:{image:"Windows_02_Install",text:"pluginInstall_windows_msie_text_install"},enjoy:{image:"Windows_03_Skype",text:"pluginInstall_windows_msie_text_enjoy"}},Firefox:{closeScreen:{image:"CloseScreen",text:"pluginInstall_main_close_screen_subtitle"},download:{image:"Windows_01_Firefox",text:"pluginInstall_windows_firefox_text_download"},install:{image:"Windows_02_Firefox",text:"pluginInstall_windows_firefox_text_install"},enjoy:{image:"Windows_03_Skype",text:"pluginInstall_windows_firefox_text_enjoy"},unblock:{image:"Blocked_Firefox",text:"pluginInstall_unblock_text_firefox_subtitle"}},Unknown:{closeScreen:{image:"CloseScreen",text:"pluginInstall_main_close_screen_subtitle"},download:{image:"Windows_01_IE",text:"pluginInstall_windows_unknown_text_download"},install:{image:"Windows_02_Install",text:"pluginInstall_windows_unknown_text_install"},enjoy:{image:"Windows_03_Skype",text:"pluginInstall_windows_unknown_text_enjoy"}}}};return{getInstallResources:f}}),define("constants/calling.resources",[],function(){return{notifications:{incomingCall:{linkTemplate:'<a href="http://skype.com/go/help.faq.skype.for.web" target="_blank">{notification_text_learnMore}</a>'}},fallbackMessages:{skypeUpgradeLink:'<a href="https://www.skype.com/en/download-skype" target="_blank">https://www.skype.com/en/download-skype</a>',ngcUpgradeLink:'<a href="https://go.skype.com/groupupgrade/" target="_blank">https://go.skype.com/groupupgrade/</a>'},pluginInstall:{terms:'<a href="https://www.skype.com/en/legal/tou/" target="_blank">{pluginInstall_steps_text_termsLink}</a>',privacy:'<a href="https://www.skype.com/en/legal/privacy/" target="_blank">{pluginInstall_steps_text_privacyLink}</a>'}}}),define("ui/viewModels/calling/plugin/downloadStepViewModel",["require","exports","module","swx-cafe-application-instance","services/plugin/pluginDownload","swx-constants","ui/viewModels/calling/helpers/browserInstallContent","swx-enums","swx-i18n","constants/calling.resources","ui/telemetry/actions/actionNames","swx-constants","swx-service-locator-instance"],function(e,t){var n=e("swx-cafe-application-instance"),r=e("services/plugin/pluginDownload"),i=e("swx-constants").CALLING,s=e("ui/viewModels/calling/helpers/browserInstallContent"),o=e("swx-enums"),u=e("swx-i18n").localization,a=e("constants/calling.resources").pluginInstall,f=e("ui/telemetry/actions/actionNames"),l=e("swx-constants").COMMON,c=e("swx-service-locator-instance").default,h=function(h){function w(){m.changed(S)}function E(){m.changed.off(S)}function S(e,t){t!==o.callingNotSupportedReasons.PluginNotInstalled&&(x(),E(),p())}function x(){!h.conversation&&!h.suppressEndedEvent&&h.onPluginInstallEnded(i.PLUGIN_INSTALL_EXIT_METHOD.PLUGIN_DETECTED,!0)}function T(){g.isPluginInstalled.changed(C)}function N(){g.isPluginInstalled.changed.off(C)}function C(e){e&&(x(),N(),p())}var p=h.next,d=h.close,v=s.getInstallResources(),m=n.get().personsAndGroupsManager.mePerson.capabilities.audio,g=n.get().devicesManager.mediaCapabilities,y={terms:"pluginInstall_steps_text_termsLink",privacy:"pluginInstall_steps_text_privacyLink"},b=c.resolve(l.serviceLocator.FEATURE_FLAGS);this.id=t.STEP_ID,this.label=u.fetch({key:"pluginInstall_label_text_download"}),this.downloadImage=v.images.download,this.downloadText=v.text.download,this.installImage=v.images.install,this.installText=v.text.install,this.enjoyImage=v.images.enjoy,this.enjoyText=v.text.enjoy,this.showAutoUpdateDisclaimer=!b.isFeatureOn(l.featureFlags.USE_BUSINESS_WORDING),this.showTermsAndPrivacy=!b.isFeatureOn(l.featureFlags.USE_BUSINESS_WORDING),h.conversation&&h.conversation.audioService.start.enabled.reason===o.callingNotSupportedReasons.PluginNotInstalled&&(m=h.conversation.audioService.start.enabled),this.show=function(){var e=c.resolve(l.serviceLocator.ACTION_TELEMETRY);if(g.isPluginInstalled){if(g.isPluginInstalled()){N(),p();return}T()}else{if(m.reason!==o.callingNotSupportedReasons.PluginNotInstalled){E(),p();return}w()}r.downloadPlatformSpecificInstaller(),e.recordAction(f.audioVideo.pluginInstall.installPlugin)},this.restartDownload=function(){var e=c.resolve(l.serviceLocator.ACTION_TELEMETRY);r.downloadPlatformSpecificInstaller(),e.recordAction(f.audioVideo.pluginInstall.restart)},this.close=function(){g.isPluginInstalled?N():E(),d()},this.getLink=function(e){var t=y[e],n=u.fetch({key:t}),r=a[e];return r.replace("{"+t+"}",n)}};t.STEP_ID=i.CALLING_SETUP_STEPS.OVERLAY_PLUGIN_STEPS,t.build=function(e){return new h(e)}}),define("constants/cssClasses",["require","exports","module"],function(e,t){t.HIDE="swx-hide",t.LIST_SELECTABLE="list-selectable",t.SEARCH_ITEM="searchItem",t.MODAL_DIALOG="swx-overlayModal",t.contextMenu={CONTEXT_MENU:"swxContextMenu",FLIPPED:"flipped",items:{BLOCK_CONTACT:"blockContactMenuItem",CALL_SKYPE:"callSkypeMenuItem",DELETE_CONTACT:"deleteContactMenuItem",START_PSTN_CALL:"startPSTNCallMenuItem",UNBLOCK_CONTACT:"unblockContactMenuItem",VIDEO_CALL:"videoCallMenuItem",SCHEDULE_CALL:"scheduleCallMenuItem"}},t.avatar={AVATAR:"Avatar",AVATAR_PRESENCE:"Avatar--presence",AVATAR_GROUP:"Avatar--group",AVATAR_SELECTED:"Avatar--selected",AVATAR_USE_DEFAULT:"Avatar--defaultAvatar",AVATAR_AGENT:"Avatar--agent",AVATAR_PSTN:"Avatar--pstn",AVATAR_SIZE:"Avatar--size",AVATAR_ABSOLUTE:"Avatar--absolute",AVATAR_FULL_SIZE:"Avatar--fullSize"},t.avatarDeprecated={GROUP_AVATAR:"group",SHOW_PRESENCE:"presence"},t.presence={BLOCKED:"blocked"},t.contacts={CONTACT_TILE:"contactTile",TILE_NAME:"tileName"},t.discoverAgents={PAGE:"DiscoverAgentsPage"},t.base={SWX:"swx",DESKTOP:"desktop",OVERLAY_CONTAINER:"overlayContainer"},t.educationBubbles={PREFIX:"EducationBubble--",LARGE:"EducationBubble--large"}}),define("utils/common/statusMapper",["require","exports","module","swx-enums","swx-i18n","swx-service-locator-instance","swx-constants"],function(e,t){function o(){return i.resolve(s.serviceLocator.FEATURE_FLAGS).isFeatureOn(s.featureFlags.USE_BUSINESS_WORDING)}function u(e,t){return e.toLowerCase()===t.toLowerCase()}function a(e,t){return e&&t===n.endpointType.Mobile}function f(e){return u(e,n.onlineStatus.Hidden)||u(e,n.onlineStatus.Offline)}function l(e){return u(e,n.onlineStatus.Busy)||u(e,n.onlineStatus.OnThePhone)}function c(e){return u(e,n.onlineStatus.DoNotDisturb)}function h(e){return u(e,n.onlineStatus.Idle)||u(e,n.onlineStatus.Away)||u(e,n.onlineStatus.BeRightBack)||u(e,n.onlineStatus.OutForLunch)}function p(e){return u(e,n.onlineStatus.Online)}var n=e("swx-enums"),r=e("swx-i18n").localization,i=e("swx-service-locator-instance").default,s=e("swx-constants").COMMON;t.getStatusIconClass=function(e,t,r){var i;return e?(p(e)?i=n.onlineStatus.Online.toLowerCase():f(e)?i=n.onlineStatus.Offline.toLowerCase():h(e)?i=a(r,t)?n.endpointType.Mobile.toLowerCase():n.onlineStatus.Idle.toLowerCase():l(e)?i=n.onlineStatus.Busy.toLowerCase():c(e)?i=n.onlineStatus.DoNotDisturb.toLowerCase():i=e.toLowerCase(),i):""},t.getAvailabilityText=function(e,t,i){switch(e){case n.onlineStatus.Online:return o()?r.fetch({key:"message_text_presenceAvailable"}):r.fetch({key:"message_text_presenceOnline"});case n.onlineStatus.Offline:case n.onlineStatus.Hidden:return r.fetch({key:"message_text_presenceOffline"});case n.onlineStatus.BeRightBack:case n.onlineStatus.OutForLunch:case n.onlineStatus.Away:case n.onlineStatus.Idle:return a(i,t)?r.fetch({key:"message_text_presenceMobile"}):r.fetch({key:"message_text_presenceAway"});case n.onlineStatus.DoNotDisturb:return r.fetch({key:"message_text_presenceDoNotDisturb"});case n.onlineStatus.OnThePhone:case n.onlineStatus.Busy:return r.fetch({key:"message_text_presenceBusy"});case n.onlineStatus.Unknown:return r.fetch({key:"message_text_presenceUnknown"});default:return null}},t.getMeAvailabilityText=function(e){switch(e){case n.onlineStatus.Online:return r.fetch({key:"message_text_presenceOnline"});case n.onlineStatus.Offline:return r.fetch({key:"message_text_presenceOffline"});case n.onlineStatus.Hidden:return r.fetch({key:"message_text_presenceHidden"});case n.onlineStatus.BeRightBack:case n.onlineStatus.OutForLunch:case n.onlineStatus.Away:case n.onlineStatus.Idle:return r.fetch({key:"message_text_presenceAway"});case n.onlineStatus.DoNotDisturb:return r.fetch({key:"message_text_presenceDoNotDisturb"});case n.onlineStatus.OnThePhone:case n.onlineStatus.Busy:return r.fetch({key:"message_text_presenceBusy"});default:return null}},t.isNotificationOn=function(e){return p(e)||h(e)}}),define("ui/modelHelpers/activities",{"in-a-meeting":"inAMeeting","urgent-interruptions-only":"urgentInterruptionsOnly","on-the-phone":"onThePhone","in-a-conference":"inAConference","off-work":"offWork","out-of-office":"outOfOffice",presenting:"presenting"}),define("ui/modelHelpers/activityMapper",["require","exports","module","swx-i18n","ui/modelHelpers/activities"],function(e,t){var n=e("swx-i18n").localization,r=e("ui/modelHelpers/activities");t.map=function(e){return r[e]?n.fetch({key:"message_text_activity_"+r[e]}):e}}),define("utils/people/lastSeenConverter",["require","lodash-compat","swx-g11n","swx-utils-chat","swx-utils-people"],function(e){var t=e("lodash-compat"),n=e("swx-g11n").globalization,r=e("swx-utils-chat").dateTime,i=e("swx-utils-people").lastSeenConverter.default,s=new i(r,n);return t.bindAll(s),s}),define("ui/viewModels/people/properties/locationText",["require","swx-utils-common","utils/common/cafeObservable"],function(e){function r(e){var t=this;return t.location={city:n.newObservableProperty(e.location.city),country:n.newObservableProperty(e.location.country)},t.compute=function(){return r.format({city:t.location.city(),country:t.location.country()})},t.dispose=function(){t.location.city.dispose(),t.location.country.dispose()},t}var t=e("swx-utils-common").stringUtils,n=e("utils/common/cafeObservable");return r.build=function(e){return new r(e)},r.format=function(e){if(e&&t.isNotEmpty(e.city)&&t.isNotEmpty(e.country))return e.city+", "+e.country},r}),define("ui/modelHelpers/conversationHelper",["require","exports","module","swx-enums","swx-cafe-application-instance","swx-browser-detect","swx-util-calling-stack","swx-i18n","ui/modelHelpers/personHelper","lodash-compat"],function(e,t){function f(e){return e.selfParticipant.audio.state()!==n.callConnectionState.Disconnected&&e.selfParticipant.audio.state()!==n.callConnectionState.Notified}function l(e){if(e&&!e.isGroupConversation()&&e.participants.size()>0)return e.participants()[0].person}var n=e("swx-enums"),r=e("swx-cafe-application-instance"),i=e("swx-browser-detect").default,s=e("swx-util-calling-stack"),o=e("swx-i18n").localization,u=e("ui/modelHelpers/personHelper"),a=e("lodash-compat");t.createSpaceTopic=function(){return o.fetch({key:"spaces_default_name"})},t.isCallingActive=function(e){return f(e)?s.get().isOutofBrowserCallingSupported()?!1:i.getBrowserInfo().isShellApp?!0:e.autoCall&&e.autoCall()?!0:!0:!1},t.isOneToOneConversationWithEcho=function(e){var t=l(e);return!!t&&u.isEchoContact(t)},t.isOneToOneConversationWithAgent=function(e){var t=l(e);return!!t&&u.isAgent(t)},t.isOneToOneConversationWithBlockedPerson=function(e){var t=l(e);return!!t&&t.isBlocked()},t.agentSupportsIm=function(e){var n;return t.isOneToOneConversationWithAgent(e)?(n=e.participants()[0],!!n.person.capabilities.chat()):!1},t.getExistingConversationWithPerson=function(e){var t=r.get().conversationsManager.conversations();return a.find(t,function(t){return!t.isGroupConversation()&&t.participants.size()===1&&t.participants()[0].person.id()===e.id()})},t.isPstnEndpoint=function(e){return/^(\+)?\d+$/.test(e)},t.isPstnParticipant=function(e){return!!e.audio.endpoint&&(t.isPstnEndpoint(e.audio.endpoint())||u.isPstn(e.person))},t.isPstnOnlyConversation=function(e){var n=e.participants.subscribe();if(!e.participants.size())return n.dispose(),!1;for(var r=0;r<e.participants.size();r++){var i=e.participants(r);if(!i.audio.endpoint||!u.isPstn(i.person)&&!t.isPstnEndpoint(i.audio.endpoint()))return n.dispose(),!1}return n.dispose(),!0},t.isConversationWithPstn=function(e){return e.participants().some(t.isPstnParticipant)},t.isAtLeastOnceParticipantOnline=function(e){return e.participants().some(function(e){var t=e.person.status();return t!==n.onlineStatus.Offline||t!==n.onlineStatus.Unknown})},t.isConversationWithWelcomeAgent=function(e){if(!e.isGroupConversation()){var t=e.participants(0);if(t&&u.isWelcomeAgent(t.person))return!0}return!1}}),define("ui/viewModels/people/properties/displayNameText",["require","swx-i18n","swx-utils-common","ui/modelHelpers/personHelper","ui/modelHelpers/conversationHelper","utils/common/cafeObservable"],function(e){function o(e){var t=this;return t.displayName=s.newObservableProperty(e.displayName),t.compute=function(){return o.format(e.id(),t.displayName())},t.dispose=function(){t.displayName.dispose()},t}var t=e("swx-i18n").localization,n=e("swx-utils-common").stringUtils,r=e("ui/modelHelpers/personHelper"),i=e("ui/modelHelpers/conversationHelper"),s=e("utils/common/cafeObservable");return o.build=function(e){return new o(e)},o.format=function(e,s){var o=s;return r.isGuestId(e)&&(o=t.fetch({key:"guest_user_displayname",params:{displayName:s}})),i.isPstnEndpoint(o)&&(o=n.forceLTREmbedding(o)),o},o}),define("ui/viewModels/people/properties/agentDetails",["require","lodash-compat","vendor/knockout","utils/common/cafeObservable","swx-constants","swx-service-locator-instance","swx-i18n"],function(e){function u(e){function l(){return a||(a={certification:r.newObservableProperty(e.agentDetails.certification),rating:r.newObservableProperty(e.agentDetails.rating),author:r.newObservableProperty(e.agentDetails.author),description:r.newObservableProperty(e.agentDetails.description),website:r.newObservableProperty(e.agentDetails.website),privacyStatement:r.newObservableProperty(e.agentDetails.privacyStatement),termsOfService:r.newObservableProperty(e.agentDetails.termsOfService),extraInfo:r.newObservableProperty(e.agentDetails.extraInfo),messagesModeAll:r.newObservableProperty(e.agentDetails.messages_mode_all)},a.capabilities=c(),a.capabilitiesText=n.computed(m),a.ratingStars=n.computed(g),a.descriptionWithLinks=n.computed(y),a.extraInfoWithLinks=n.computed(b)),a}function c(){var n={audio_send:r.newObservableProperty(e.capabilities.audio),video_send:r.newObservableProperty(e.capabilities.video),im_send:r.newObservableProperty(e.capabilities.chat),screen_sharing:r.newObservableProperty(e.capabilities.screenSharing),gvc:r.newObservableProperty(e.capabilities._gvc),group_chat:r.newObservableProperty(e.capabilities._groupChat),file_send:r.newObservableProperty(e.capabilities._fileSend),contact_send:r.newObservableProperty(e.capabilities._contactSend),videomessage_send:r.newObservableProperty(e.capabilities._videoMessageSend),audiomessage_send:r.newObservableProperty(e.capabilities._audioMessageSend),mediamessage_send:r.newObservableProperty(e.capabilities._mediaMessageSend),media_autoplay:r.newObservableProperty(e.capabilities._mediaAutoplay),photo_send:r.newObservableProperty(e.capabilities._photoSend),moji_send:r.newObservableProperty(e.capabilities._mojiSend),location_send:r.newObservableProperty(e.capabilities._locationSend)};return n.dispose=function(){t.invoke(n,"dispose")},n}function h(){a&&(t.invoke(a,"dispose"),a=undefined)}function p(e){return e&&(e=e.replace(/(https?\:\/\/)(\S+)(\w{2,4})(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi,d)),e}function d(e){var t=e;return t.match("^https?://")||(t="http://"+t),'<a href="'+t+'" target="_blank">'+e+"</a>"}function v(e,t){var n=a.messagesModeAll,r=" ";switch(t){case"group_chat":var i=n&&n()?f.GROUP_ALL:f.GROUP_PRIVATE;e+=r+o.fetch(i)}return e}function m(){var e=[],n=s.resolve(i.serviceLocator.FEATURE_FLAGS),r=n.isFeatureOn(i.featureFlags.BOT_MESSAGES_MODE_V2_ENABLED);return t.forOwn(a.capabilities,function(t,n){if(t()){var i=o.fetch({key:"label_text_agent_profile_capabilities_"+n});r&&(i=v(i,n)),e.push(i)}}),e.length?e.join(o.fetch({key:"label_text_agent_profile_capabilities_join_char"})):o.fetch({key:"label_text_agent_profile_capabilities_none"})}function g(){var e=[],t=a.rating()||0,n=(t%1).toFixed(1);for(var r=1;r<=t;r++)e.push(1);return n>=.5&&n<.75?e.push(.5):n>=.75&&e.push(1),e}function y(){return p(a.description())}function b(){return p(a.extraInfo())}var u=this,a,f={GROUP_PRIVATE:{key:"label_text_agent_profile_capabilities_group_chat_mention_only_mode",params:{botName:t.escape(e.displayName())}},GROUP_ALL:{key:"label_text_agent_profile_capabilities_group_chat_all_messages_mode"}};return t.isFunction(e.isAgent)?u.isAgent=r.newObservableProperty(e.isAgent):u.isAgent=n.observable(!1),u.compute=function(){return u.isAgent()?l():h()},u.dispose=function(){u.isAgent.dispose&&u.isAgent.dispose(),h()},u}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/cafeObservable"),i=e("swx-constants").COMMON,s=e("swx-service-locator-instance").default,o=e("swx-i18n").localization;return u.build=function(e){return new u(e)},u}),define("ui/viewModels/people/properties/pstnDetails",["require","vendor/knockout","ui/modelHelpers/personHelper"],function(e){function r(e){function i(){r.phoneNumbers(e.phoneNumbers())}var r=this;return r.isPstn=t.observable(n.isPstn(e)),r.phoneNumbers=t.observable([]),e.phoneNumbers.changed(i),r.dispose=function(){e.phoneNumbers.changed.off(i)},r}var t=e("vendor/knockout"),n=e("ui/modelHelpers/personHelper");return r.build=function(e){return new r(e)},r}),define("ui/viewModels/people/contact",["require","lodash-compat","vendor/knockout","swx-i18n","swx-constants","swx-service-locator-instance","swx-utils-common","swx-enums","constants/cssClasses","utils/common/statusMapper","ui/modelHelpers/activityMapper","utils/common/cafeObservable","utils/people/lastSeenConverter","ui/viewModels/people/properties/locationText","ui/viewModels/people/properties/displayNameText","ui/viewModels/people/properties/agentDetails","ui/viewModels/people/properties/pstnDetails","swx-utils-chat"],function(e){function y(e,y){function O(){return w.isBlocked()?a.presence.BLOCKED:f.getStatusIconClass(w.status(),w.endpointType(),k)}function M(){var e,n,r;if(L()===undefined)return;return e=t.isString(L())?(new Date(L())).getTime():L().getTime(),n=Math.floor((Date.now()-e)/1e3),r=Math.round(n/60),A.reset(w.id(),r),h.getMessage(r)}function D(){return w.displayName()+", "+w.id()+", "+f.getAvailabilityText(w.status())}function P(){L.notifySubscribers()}function H(){return w.endpointType()===u.endpointType.Mobile&&k}function B(){var e;if(w.isBlocked())return r.fetch({key:"message_text_contactBlocked"});if(w.isAgent()&&w.agentDetails()){var t=w.agentDetails().description();if(t)return t}if(w.isPstn()){var n=w.phoneNumbers();if(n.length===1)return n[0].displayString()===w.displayName()?"":o.forceLTREmbedding(n[0].displayString())}return y.moodMessageFirst?e=j()||F():e=F()||j(),e||w.locationText()||f.getAvailabilityText(w.status(),w.endpointType(),k)}function j(){return l.map(w.activity())}function F(){var e=w.status()===u.onlineStatus.Online;return e?f.getAvailabilityText(w.status()):w.lastSeen()}var b,w=this,E=d.build(e),S=p.build(e),x=v.build(e),T=m.build(e),N=s.resolve(i.serviceLocator.FEATURE_FLAGS),C=N.isFeatureOn(i.featureFlags.LAST_SEEN),k=N.isFeatureOn(i.featureFlags.MOBILE_INDICATOR),L=c.newObservableProperty(e.lastSeenAt,{keepAlive:y.keepLastSeenAtSubscription}),A=s.resolve(i.serviceLocator.PROGRESSIVE_TIMEOUT);w.id=n.observable(e.id()),w.avatar=c.newObservableProperty(e.avatarUrl,{keepAlive:!0}),w.status=c.newObservableProperty(e.status,{keepAlive:y.keepPresenceSubscription}),w.activity=c.newObservableProperty(e.activity,{keepAlive:y.keepActivitySubscription}),w.endpointType=c.newObservableProperty(e.endpointType,{keepAlive:y.keepEndpointTypeSubscription}),w.isAgent=x.isAgent,w.agentDetails=n.computed(x.compute),w.isBlocked=c.newObservableProperty(e.isBlocked),w.isActive=n.observable(!1),w.location=S.location,w.locationText=n.computed(S.compute),w.isPstn=T.isPstn,w.phoneNumbers=T.phoneNumbers,w.isMobile=n.computed(H),w.displayName=n.computed(E.compute),w.displayNameUnescaped=n.computed(function(){return t.unescape(w.displayName())}),w.lastSeen=C?n.computed(M):n.observable(null),w.statusClassName=n.computed(O),w.textDetails=n.computed(D),w.displayMessage=n.computed(B),w.ariaLabel=n.computed(function(){var e=f.getAvailabilityText(w.status()),t=g.stripHTML(w.displayMessage());return e===t?w.displayName()+" "+e:w.displayName()+" "+e+" "+t}),w.getPerson=function(){return e},w.dispose=function(){A.stop(w.id(),b),w.avatar.dispose(),w.status.dispose(),w.activity.dispose(),w.endpointType.dispose(),w.isBlocked.dispose(),w.locationText.dispose(),w.displayName.dispose(),w.displayNameUnescaped.dispose(),w.agentDetails.dispose(),L.dispose(),E.dispose(),S.dispose(),x.dispose(),T.dispose(),C&&w.lastSeen.dispose(),w.statusClassName.dispose(),w.displayMessage.dispose(),w.textDetails.dispose(),w.isMobile.dispose()},b=A.start(w.id(),P)}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-i18n").localization,i=e("swx-constants").COMMON,s=e("swx-service-locator-instance").default,o=e("swx-utils-common").stringUtils,u=e("swx-enums"),a=e("constants/cssClasses"),f=e("utils/common/statusMapper"),l=e("ui/modelHelpers/activityMapper"),c=e("utils/common/cafeObservable"),h=e("utils/people/lastSeenConverter"),p=e("ui/viewModels/people/properties/locationText"),d=e("ui/viewModels/people/properties/displayNameText"),v=e("ui/viewModels/people/properties/agentDetails"),m=e("ui/viewModels/people/properties/pstnDetails"),g=e("swx-utils-chat").messageSanitizer;return y.build=function(e,t){return new y(e,t)},y}),define("ui/viewModels/people/contactBuilder",["require","exports","module","ui/viewModels/people/contact","vendor/knockout","swx-constants","swx-enums","lodash-compat"],function(e,t){function u(e){function n(){return e.hideStrategy()===i.AVAILABLE_ONLY?!e.status()||e.status()===s.Offline||e.status()===s.Hidden||e.status()===s.Unknown:e.hideStrategy()===i.AGENTS_ONLY?!e.isAgent():!1}var t=e.dispose;return e.hideStrategy=r.observable(),e.isFavorite=r.observable(),e.isHidden=r.computed(n,e),e.dispose=function(){t.call(e),e.isHidden.dispose()},e}var n=e("ui/viewModels/people/contact"),r=e("vendor/knockout"),i=e("swx-constants").PEOPLE.showStrategies,s=e("swx-enums").onlineStatus,o=e("lodash-compat");t.build=function(e,t){var r;return t=t||{},o.defaults(t,{keepPresenceSubscription:!0,keepActivitySubscription:!0,keepLastSeenAtSubscription:!0,keepEndpointTypeSubscription:!0,moodMessageFirst:!1}),r=n.build(e,t),t.hideable&&(r=u(r)),r}}),define("ui/viewModels/chat/conversationTile",["require","vendor/knockout","ui/viewModels/people/contactBuilder","swx-utils-chat","utils/common/cafeObservable","swx-constants","swx-enums","swx-i18n","swx-service-locator-instance"],function(e){function f(e,f){function h(){var e=l.contact();return e?e.displayMessage():p(l.amInConversation(),l.participantCount())}function p(e,t){return e?(m()&&t++,u.fetch({key:"label_text_participant",count:t})):""}function d(){c&&(c.dispose(),c=null)}function v(){function t(e){setTimeout(d);var t=n.build(e.person,f.contactOptions);l.contact(t)}c=e.participants.added(t)}function m(){var e=a.resolve(s.serviceLocator.FEATURE_FLAGS);return e.isFeatureOn(s.featureFlags.INCLUDE_SELF_IN_PARTICIPANTS_COUNT)}var l=this,c;l.isGroup=i.newObservableProperty(e.isGroupConversation),l.participantCount=i.newObservableProperty(e.participantsCount),l.selfParticipantState=i.newObservableProperty(e.selfParticipant.state),l.amInConversation=t.computed(function(){return l.selfParticipantState()===o.participantState.Connected}),l.contact=t.observable(),l.isAgent=t.computed(function(){var e=l.contact();return!!e&&e.isAgent()}),l.isCertifiedAgent=t.computed(function(){var e=l.contact();return!!(l.isAgent()&&e.agentDetails()&&e.agentDetails().certification())}),l.isPstn=t.computed(function(){var e=l.contact();return!!e&&e.isPstn()}),l.id=t.computed(function(){var e=l.contact();return e?e.id():undefined}),l.statusClassName=t.computed(function(){var e=l.contact();return e?e.statusClassName():""}),l.isBlocked=t.computed(function(){var e=l.contact();return e?e.isBlocked():!1}),l.displayMessage=t.computed(h),l.displayMessageTitle=t.computed(function(){return r.stripHTML(h())}),l.dispose=function(){l.isAgent.dispose(),l.isCertifiedAgent.dispose(),l.isPstn.dispose(),l.id.dispose(),l.statusClassName.dispose(),l.isBlocked.dispose(),l.displayMessage.dispose(),l.displayMessageTitle.dispose(),l.amInConversation.dispose(),l.contact()&&l.contact().dispose(),d()},l.isGroup()||v()}var t=e("vendor/knockout"),n=e("ui/viewModels/people/contactBuilder"),r=e("swx-utils-chat").messageSanitizer,i=e("utils/common/cafeObservable"),s=e("swx-constants").COMMON,o=e("swx-enums"),u=e("swx-i18n").localization,a=e("swx-service-locator-instance").default;return{build:function(e,t){return t=t||{},new f(e,t)}}}),define("ui/viewModels/chat/conversationTopic",["require","exports","module","vendor/knockout","swx-i18n","swx-utils-common","swx-constants","utils/common/cafeObservable","ui/modelHelpers/conversationHelper","swx-utils-common","swx-utils-chat"],function(e,t){var n=e("vendor/knockout"),r=e("swx-i18n").localization,i=e("swx-utils-common").async,s=e("swx-constants").COMMON,o=e("utils/common/cafeObservable"),u=e("ui/modelHelpers/conversationHelper"),a=e("swx-utils-common").stringUtils,f=e("swx-utils-chat").messageSanitizer,l=function(e){function g(){v||(v=!0,i.execute(function(){if(!v)return;t.topic(b()),v=!1}))}function y(){E();if(!l.participants().length){t.topic(m);return}l.participants().slice(0,s.conversation.NUMBER_OF_PARTICIPANT_NAMES_IN_TOPIC).forEach(function(e){d.push({displayName:e.person.displayName,subscription:e.person.displayName.changed(g)})})}function b(){var e=d.map(function(e){return u.isPstnEndpoint(e.displayName())?a.forceLTREmbedding(e.displayName()):e.displayName()});return e.length<1?m:e.join(s.conversation.TOPIC_DELIMITER)}function w(){l.participants.changed(y)}function E(){d.forEach(function(e){e.subscription.dispose()}),d=[]}function S(){E(),l.participants.changed.off(y)}function x(e){function r(e){var t=e.replace(/<[^a\/].*?>(.*?)<\/[^a].*?>/gi,"$1"),n=t.replace(/(<.*?\.{3,})$/,"").trim(),r=n===""?"":f.validateUnescapedLink(n).replace(/&lt;/g,"<").replace(/&gt;/g,">");return r}var n=e?f.getSanitizedTopic(e):m;u.isPstnEndpoint(n)&&(n=a.forceLTREmbedding(n)),t.topic(r(n)),v=!1}function T(e){x(e),S()}var t=this,l=e,c=l.participants(0),h=o.newObservableProperty(l.topic),p=h.subscribe(T),d=[],v,m=r.fetch({key:"conversation_header_topic_untitled_conversation"});t.topic=n.observable(m),!l.isGroupConversation()&&c&&(t.displayName=o.newObservableProperty(c.person.displayName)),h()?x(h()):w(),t.dispose=function(){p.dispose(),S()}};t.build=function(e){return new l(e)}}),define("ui/viewModels/calling/plugin/startStepViewModel",["require","exports","module","swx-constants","utils/common/cafeObservable","swx-i18n","ui/telemetry/actions/actionNames","swx-constants","swx-service-locator-instance","ui/viewModels/chat/conversationTile","ui/viewModels/chat/conversationTopic"],function(e,t){var n=e("swx-constants").CALLING,r=e("utils/common/cafeObservable"),i=e("swx-i18n").localization,s=e("ui/telemetry/actions/actionNames"),o=e("swx-constants").COMMON,u=e("swx-service-locator-instance").default,a=e("ui/viewModels/chat/conversationTile"),f=e("ui/viewModels/chat/conversationTopic"),l=function(n){var l=n.next,c=n.conversation,h=u.resolve(o.serviceLocator.FEATURE_FLAGS),p=f.build(c),d=a.build(c);this.id=t.STEP_ID,this.label=i.fetch({key:"pluginInstall_label_text_start"}),this.avatar=r.newObservableProperty(c.avatarUrl),this.isGroupConversation=r.newObservableProperty(c.isGroupConversation),this.showAutoUpdateDisclaimer=!h.isFeatureOn(o.featureFlags.USE_BUSINESS_WORDING),this.topic=p.topic,this.isPstn=d.isPstn,this.show=function(){var e=u.resolve(o.serviceLocator.ACTION_TELEMETRY);e.recordAction(s.audioVideo.pluginInstall.start)},this.close=function(){n.close()},this.installClick=function(){l()}};t.STEP_ID=n.CALLING_SETUP_STEPS.OVERLAY_PLUGIN_START,t.build=function(e){return new l(e)}}),define("ui/viewModels/calling/plugin/closeStepViewModel",["require","exports","module","ui/viewModels/calling/helpers/browserInstallContent","swx-constants","ui/telemetry/actions/actionNames","swx-constants","swx-service-locator-instance"],function(e,t){var n=e("ui/viewModels/calling/helpers/browserInstallContent"),r=e("swx-constants").CALLING,i=e("ui/telemetry/actions/actionNames"),s=e("swx-constants").COMMON,o=e("swx-service-locator-instance").default,u=function(u){var a=u.next,f=u.close,l=n.getInstallResources();this.id=t.STEP_ID,this.closeScreenImageUrl=l.images.closeScreen,this.isFirefox=u.isFirefox,this.next=function(){var e=o.resolve(s.serviceLocator.ACTION_TELEMETRY);a(),e.recordAction(i.audioVideo.pluginInstall.stayInFlow)},this.close=function(){var e=o.resolve(s.serviceLocator.ACTION_TELEMETRY);u.onPluginInstallEnded(r.PLUGIN_INSTALL_EXIT_METHOD.CLOSE,!1),f(),e.recordAction(i.audioVideo.pluginInstall.leave)}};t.STEP_ID=r.CALLING_SETUP_STEPS.CLOSE_CALLING_SETUP,t.build=function(e){return new u(e)}}),define("ui/viewModels/calling/plugin/firefoxUnableToCallStepViewModel",["require","exports","module","swx-constants","utils/common/cafeObservable","swx-i18n","ui/telemetry/actions/actionNames","swx-constants","swx-service-locator-instance","ui/viewModels/chat/conversationTile","ui/viewModels/chat/conversationTopic"],function(e,t){var n=e("swx-constants").CALLING,r=e("utils/common/cafeObservable"),i=e("swx-i18n").localization,s=e("ui/telemetry/actions/actionNames"),o=e("swx-constants").COMMON,u=e("swx-service-locator-instance").default,a=e("ui/viewModels/chat/conversationTile"),f=e("ui/viewModels/chat/conversationTopic"),l=function(n){var l=n.conversation,c=f.build(l),h=a.build(l);this.id=t.STEP_ID,this.label=i.fetch({key:"pluginInstall_label_text_start"}),this.avatar=r.newObservableProperty(l.avatarUrl),this.isGroupConversation=r.newObservableProperty(l.isGroupConversation),this.topic=c.topic,this.isPstn=h.isPstn,this.show=function(){var e=u.resolve(o.serviceLocator.ACTION_TELEMETRY);e.recordAction(s.audioVideo.pluginInstall.firefoxUnableToCall)},this.close=function(){n.close()}};t.STEP_ID=n.CALLING_SETUP_STEPS.OVERLAY_PLUGIN_FIREFOX_UNABLE_TO_CALL,t.build=function(e){return new l(e)}}),define("browser/chrome",[],function(){return window.chrome||{}}),define("ui/viewModels/calling/plugin/extensionInstallHelper",["require","exports","module","browser/document","experience/settings"],function(e,t){var n=e("browser/document"),r=e("experience/settings"),i=function(){this.buildLinkElement=function(){var t=n.createElement("link");return t.setAttribute("rel","chrome-webstore-item"),t.setAttribute("href",r.shellApp.chromeExtensionWebstoreUrl),t},this.buildContentScriptElement=function(){var t=n.createElement("script"),i="chrome-extension://"+r.shellApp.chromeExtensionId+"/content-script.js";return t.setAttribute("src",i),t}};t.build=function(){return new i}}),define("ui/viewModels/calling/plugin/extensionInstallStepViewModel",["require","exports","module","browser/chrome","browser/document","experience/settings","swx-constants","ui/viewModels/calling/plugin/extensionInstallHelper","ui/viewModels/calling/helpers/browserInstallContent","ui/telemetry/actions/actionNames","swx-constants","swx-service-locator-instance"],function(e,t){var n=e("browser/chrome"),r=e("browser/document"),i=e("experience/settings"),s=e("swx-constants").CALLING,o=e("ui/viewModels/calling/plugin/extensionInstallHelper"),u=e("ui/viewModels/calling/helpers/browserInstallContent"),a=e("ui/telemetry/actions/actionNames"),f=e("swx-constants").COMMON,l=e("swx-service-locator-instance").default,c=function(s){function p(){m(),s.next()}function d(){s.nextOnFailed()}function v(){var e=h.buildLinkElement();r.head.appendChild(e)}function m(){var e=h.buildContentScriptElement();r.head.appendChild(e)}var c=u.getInstallResources(),h=o.build();this.id=t.STEP_ID,this.skypeChromeImageUrl=c.images.extensionStart,this.isFirefox=s.isFirefox,this.show=function(){var e=l.resolve(f.serviceLocator.ACTION_TELEMETRY);v(),e.recordAction(a.audioVideo.pluginInstall.installExtension)},this.close=function(){s.close()},this.installClick=function(){try{n.webstore.install(i.shellApp.chromeExtensionWebstoreUrl,p,d)}catch(e){d()}}};t.STEP_ID=s.CALLING_SETUP_STEPS.OVERLAY_EXTENSION_INSTALL,t.build=function(e){return new c(e)}}),define("ui/viewModels/calling/plugin/extensionInstallFailedStepViewModel",["require","exports","module","browser/document","browser/window","experience/settings","swx-constants","ui/viewModels/calling/plugin/extensionInstallHelper","ui/viewModels/calling/helpers/browserInstallContent"],function(e,t){var n=e("browser/document"),r=e("browser/window"),i=e("experience/settings"),s=e("swx-constants").CALLING,o=e("ui/viewModels/calling/plugin/extensionInstallHelper"),u=e("ui/viewModels/calling/helpers/browserInstallContent"),a=function(s){function c(){var e=n.querySelector("head"),t=f.buildContentScriptElement();t.onload=h,t.onerror=e.removeChild.bind(e,t),e.appendChild(t)}function h(){r.clearInterval(l),s.next()}var a=u.getInstallResources(),f=o.build(),l;this.id=t.STEP_ID,this.chromeWebstoreUrl=i.shellApp.chromeExtensionWebstoreUrl,this.imageUrl=a.images.extensionInstallFailed,this.isFirefox=s.isFirefox,this.show=function(){l=r.setInterval(c,1e3)},this.close=function(){l&&r.clearInterval(l),s.close()}};t.STEP_ID=s.CALLING_SETUP_STEPS.OVERLAY_EXTENSION_INSTALL_FAILED,t.build=function(e){return new a(e)}}),define("ui/viewModels/calling/plugin/extensionInstalledStepViewModel",["require","exports","module","swx-enums","swx-cafe-application-instance","swx-constants","ui/viewModels/calling/helpers/browserInstallContent"],function(e,t){var n=e("swx-enums"),r=e("swx-cafe-application-instance"),i=e("swx-constants").CALLING,s=e("ui/viewModels/calling/helpers/browserInstallContent"),o=function(i){function f(){a.changed(c)}function l(){a.changed.off(c)}function c(e,t){t!==n.callingNotSupportedReasons.PluginNotInstalled&&(l(),o())}var o=i.next,u=s.getInstallResources(),a=r.get().personsAndGroupsManager.mePerson.capabilities.audio;this.id=t.STEP_ID,this.getPluginImageUrl=u.images.extensionInstallPlugin,this.isFirefox=i.isFirefox,this.show=function(){a.reason===n.callingNotSupportedReasons.PluginNotInstalled?f():o()},this.close=function(){l(),i.close()},this.installClick=function(){l(),o()}};t.STEP_ID=i.CALLING_SETUP_STEPS.OVERLAY_EXTENSION_INSTALLED,t.build=function(e){return new o(e)}}),define("ui/viewModels/calling/plugin/unblockStepViewModel",["require","exports","module","swx-cafe-application-instance","ui/viewModels/calling/helpers/browserInstallContent","swx-enums","swx-i18n","swx-constants"],function(e,t){var n=e("swx-cafe-application-instance"),r=e("ui/viewModels/calling/helpers/browserInstallContent"),i=e("swx-enums"),s=e("swx-i18n").localization,o=e("swx-constants").CALLING,u=function(u){function h(){c.changed(d)}function p(){c.changed.off(d)}function d(e,t){t!==i.callingNotSupportedReasons.PluginBlocked&&(u.conversation||u.onPluginInstallEnded(o.PLUGIN_INSTALL_EXIT_METHOD.PLUGIN_DETECTED,!0,o.CALLING_SETUP_STEPS.OVERLAY_PLUGIN_UNBLOCK),p(),a())}var a=u.next,f=u.close,l=r.getInstallResources(),c=n.get().personsAndGroupsManager.mePerson.capabilities.audio;this.id=t.STEP_ID,this.label=s.fetch({key:"pluginInstall_label_text_unblock"}),this.unblockText=l.text.unblock,this.unblockImageUrl=l.images.unblock,this.isFirefox=u.isFirefox,this.show=function(){h()},this.close=function(){f()}};t.STEP_ID=o.CALLING_SETUP_STEPS.OVERLAY_PLUGIN_UNBLOCK,t.build=function(e){return new u(e)}}),define("ui/viewModels/calling/plugin/callbackStepViewModel",["require","exports","module","swx-constants","utils/common/cafeObservable","swx-i18n","ui/viewModels/chat/conversationTile","ui/viewModels/chat/conversationTopic"],function(e,t){var n=e("swx-constants").CALLING,r=e("utils/common/cafeObservable"),i=e("swx-i18n").localization,s=e("ui/viewModels/chat/conversationTile"),o=e("ui/viewModels/chat/conversationTopic"),u=function(u){var a=u.next,f=u.conversation,l=o.build(f),c=s.build(f);this.id=t.STEP_ID,this.label=i.fetch({key:"pluginInstall_label_text_continue"}),this.conversationModel=f,this.avatar=r.newObservableProperty(f.avatarUrl),this.isGroupConversation=r.newObservableProperty(f.isGroupConversation),this.topic=l.topic,this.isPstn=c.isPstn,this.placeCallTextKey=function(){return u.isOutgoing?"pluginInstall_callback_text_call":"pluginInstall_callback_text_accept"},this.placeCall=function(){u.onPluginInstallEnded(n.PLUGIN_INSTALL_EXIT_METHOD.CALL_STARTED,!0,n.CALLING_SETUP_STEPS.OVERLAY_PLUGIN_CALLBACK),a()},this.notNow=function(){u.onPluginInstallEnded(n.PLUGIN_INSTALL_EXIT_METHOD.CLOSE,!0,n.CALLING_SETUP_STEPS.OVERLAY_PLUGIN_CALLBACK),a()}};t.STEP_ID=n.CALLING_SETUP_STEPS.OVERLAY_PLUGIN_CALLBACK,t.build=function(e){return new u(e)}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-overlay/lib/helpers",["require","exports"],e)}(function(e,t){t.urlRedirect=function(e){window.location.href=e},t.platform=function(){var e=window.navigator.userAgent,t="";return e.match(/windows/i)?t="windows":e.match(/macintosh/i)?t="mac":e.match(/linux/i)?t="linux":e.match(/android/i)?t="android":e.match(/iphone|ipad|ipod/i)?t="ios":e.match(/blackberry/i)&&(t="blackberry"),t}(),t.onMobileBrowser=function(){var e=e,t=window.navigator.userAgent;return["android","ios","blackberry"].indexOf(e)!==-1?!0:e==="windows"&&t.match(/phone|iemobile/i)?!0:!1}(),t.extend=function(e,t){var n=Object.keys(t),r=n.length,i,s;for(s=0;s<r;s++)i=n[s],e[i]=t[i];return e},t.cssTransitionEndEventName=function(){function e(){var e=document.createElement("div"),t={transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},n;for(n in t)if(t.hasOwnProperty(n)&&e.style[n]!==undefined)return t[n];return""}return e()}(),t.cssTransitionsSupported=function(){return t.cssTransitionEndEventName!==""}(),t.hasClass=function(e,t){var n=new RegExp("(?:^|\\s)"+t+"(?!\\S)","g");return e.className.match(n)?!0:!1},t.addClass=function(e,n){return!e||t.hasClass(e,n)===!0?!1:(e.className+=" "+n,!0)},t.removeClass=function(e,n){var r;return!e||t.hasClass(e,n)===!1?!1:(r=new RegExp("(?:^|\\s)"+n+"(?!\\S)","g"),e.className=e.className.replace(r,""),!0)},t.bind=function(){function e(e,t,n){e.addEventListener(t,n,!1)}function t(e,t,n){e.attachEvent(t,n)}return document.addEventListener?e:t}(),t.unbind=function(){function e(e,t,n){e.removeEventListener(t,n,!1)}function t(e,t,n){e.detachEvent(t,n)}return document.removeEventListener?e:t}(),t.base64Decode=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n,r,i,s,o,u,a,f,l=0,c=0,h="",p=[];if(!e)return e;e+="";do s=t.indexOf(e.charAt(l++)),o=t.indexOf(e.charAt(l++)),u=t.indexOf(e.charAt(l++)),a=t.indexOf(e.charAt(l++)),f=s<<18|o<<12|u<<6|a,n=f>>16&255,r=f>>8&255,i=f&255,u===64?p[c++]=String.fromCharCode(n):a===64?p[c++]=String.fromCharCode(n,r):p[c++]=String.fromCharCode(n,r,i);while(l<e.length);return h=p.join(""),h.replace(/\0+$/,"")},t.murmurhash=function(e,t){var n=e.length&3,r=e.length-n,i=t,s=3432918353,o=461845907,u=0,a,f;while(u<r)f=e.charCodeAt(u)&255|(e.charCodeAt(++u)&255)<<8|(e.charCodeAt(++u)&255)<<16|(e.charCodeAt(++u)&255)<<24,++u,f=(f&65535)*s+(((f>>>16)*s&65535)<<16)&4294967295,f=f<<15|f>>>17,f=(f&65535)*o+(((f>>>16)*o&65535)<<16)&4294967295,i^=f,i=i<<13|i>>>19,a=(i&65535)*5+(((i>>>16)*5&65535)<<16)&4294967295,i=(a&65535)+27492+(((a>>>16)+58964&65535)<<16);f=0;switch(n){case 3:f^=(e.charCodeAt(u+2)&255)<<16;case 2:f^=(e.charCodeAt(u+1)&255)<<8;case 1:f^=e.charCodeAt(u)&255,f=(f&65535)*s+(((f>>>16)*s&65535)<<16)&4294967295,f=f<<15|f>>>17,f=(f&65535)*o+(((f>>>16)*o&65535)<<16)&4294967295,i^=f}return i^=e.length,i^=i>>>16,i=(i&65535)*2246822507+(((i>>>16)*2246822507&65535)<<16)&4294967295,i^=i>>>13,i=(i&65535)*3266489909+(((i>>>16)*3266489909&65535)<<16)&4294967295,i^=i>>>16,i>>>0},t.parseJSONString=function(e){var t;try{t=JSON.parse(e)}catch(n){return!1}return t}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-focus-handler/lib/focusHandler",["require","exports","lodash-compat"],e)}(function(e,t){function s(){return r||(r=u()),r}function o(){r=null}function u(){function o(t,n){return n===void 0&&(n=i.Low),r||(e=u()),n===i.Immediate?(a(t,n),f()):(!r||n<r.priority)&&a(t,n),s(),e}function u(){return new Promise(function(e){t=e})}function a(e,t){r={element:e,priority:t}}function f(){var e;r&&(e=r.element,e&&(e.focus(),t(e))),l()}function l(){s.cancel(),r=null}var e,t,r,s=n.debounce(f,50);return{addFocusRequestToQueue:o}}var n=e("lodash-compat"),r,i;(function(e){e[e.Immediate=0]="Immediate",e[e.High=1]="High",e[e.Low=2]="Low"})(i=t.Priorities||(t.Priorities={})),t.get=s,t.reset=o,t.build=u}),define("swx-focus-handler",["swx-focus-handler/lib/focusHandler"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-overlay/lib/overlay",["require","exports","./helpers","swx-focus-handler"],e)}(function(e,t){function c(){return!f.content||!f.contentParent?!1:(f.contentParent.appendChild(f.content),i.removeChild(f.slide),f={},!0)}function h(){var e=document.createElement("div"),t=document.createElement("div"),r=document.createElement("div"),i=document.createElement("div");n.addClass(e,"overlaySlide"),n.addClass(t,"table"),n.addClass(r,"tableCell"),n.addClass(i,"overlaySlideContent"),n.addClass(i,"themeWhite"),i.tabIndex=-1,i.setAttribute("role","dialog"),i.setAttribute("aria-label",""),r.appendChild(i),t.appendChild(r),e.appendChild(t),s=e}function p(){var e=document.createElement("div");n.addClass(e,"overlayContainer"),i=e}function d(e){var t={};return t.content=e,t.contentParent=e.parentNode,t.slide=s.cloneNode(!0),t.contentContainer=t.slide.querySelector(".overlaySlideContent"),t.contentContainer.appendChild(e),t}function v(e){var t=f.slide;if(o===!1){c();return}if(n.cssTransitionsSupported===!1||e===null){c();return}e.inactiveTransitionClass!==""&&(n.bind(t,n.cssTransitionEndEventName,function(){n.removeClass(t,e.inactiveTransitionClass)}),n.addClass(t,e.inactiveTransitionClass)),n.bind(t,n.cssTransitionEndEventName,c),n.addClass(t,e.inactiveClass)}function m(e){if(n.cssTransitionsSupported===!1||e===null){i.appendChild(a.slide);return}e.activeTransitionClass!==""&&(n.bind(a.slide,n.cssTransitionEndEventName,function(){n.removeClass(a.slide,e.activeTransitionClass)}),n.addClass(a.slide,e.activeTransitionClass)),n.addClass(a.slide,e.activeClass),window.setTimeout(function(){n.removeClass(a.slide,e.activeClass)},10),i.appendChild(a.slide)}function g(e){var t;if(o===!1)return;t=e.target,i.contains(t)===!1&&y()}function y(){r.get().addFocusRequestToQueue(a.contentContainer)}function b(e){e.keyCode===27&&t.hide()}function w(e){var t=e.length,r;for(r=0;r<t;r++)n.addClass(i,e[r])}function E(){p(),h(),n.bind(document,"focusin",g),u=!1}var n=e("./helpers"),r=e("swx-focus-handler"),i=null,s=null,o=!1,u=!1,a={},f={},l={next:{activeClass:"next",activeTransitionClass:"",inactiveClass:"prev",inactiveTransitionClass:"prevInTransition"},previous:{activeClass:"prev",activeTransitionClass:"prevInTransition",inactiveClass:"next",inactiveTransitionClass:""}};E(),t.display=function(e,t,r,s){var c,h=null;return s=s||{},u=s.skipSlideCreation?s.skipSlideCreation:!1,typeof e!="string"?!1:(typeof t!="string"&&(t=""),e.indexOf("#")===0&&(e=e.substr(1)),c=document.getElementById(e),c===null?!1:c===a.content?!1:(r!==undefined&&o===!0&&l[r]!==undefined&&(h=l[r]),u||(f=n.extend({},a),a=d(c),a.contentContainer.setAttribute("aria-label",t)),o===!1&&(document.body.appendChild(i),o=!0),h!==null&&(n.removeClass(i,h.activeClass),n.removeClass(i,h.inactiveClass),n.addClass(i,h.activeClass)),w(s.containerClasses),u?(n.unbind(document,"focusin",g),i.appendChild(c)):(v(h),m(h),y()),!0))},t.hide=function(){return f=n.extend({},a),!u&&c()===!1?!1:(i.parentNode.removeChild(i),o=!1,n.unbind(document,"keydown",b),a={},!0)},t.bindHide=function(e){return!e||typeof e!="object"?!1:(n.bind(e,"click",t.hide),n.bind(document,"keydown",b),!0)},t.isOverlayDisplayed=function(){return o},t.getOverlayContainer=function(){return i}}),define("swx-overlay",["swx-overlay/lib/overlay"],function(e){return e}),define("utils/common/accessibility",["require","exports","module","lodash-compat","swx-constants","browser/dom","vendor/knockout"],function(e,t){function u(){function i(e,r,i){t.hasOwnProperty(e)&&n.forEach(t[e],function(e){e(r,i)})}var e=this,t={};this.announce=function(t,n){i(r.events.browser.NARRATOR_ANNOUNCE,t,n)},this.on=function(i,s){if(!i||!s)return;t.hasOwnProperty(i)||(t[i]=[]),n.any(t[i],function(e){return e===s})||t[i].push(s);var o=n.partial(e.off,i,s);return{cancel:o,dispose:o}},this.off=function(r,i){return t.hasOwnProperty(r)?n.first(n.remove(t[r],function(e){return e===i})):null},this.removeAllListeners=function(n){if(!n){t={};return}if(!t.hasOwnProperty(n))return;delete t[n]}}var n=e("lodash-compat"),r=e("swx-constants").COMMON,i=e("browser/dom"),s=e("vendor/knockout"),o="showFocusRing";t.initFocusRing=function(e){e.addEventListener("keydown",function(){i.hasClass(e,o)||i.addClass(e,o)},!1),e.addEventListener("mousedown",function(){i.removeClass(e,o)},!1)},t.updateAriaLiveHtml=function(e,t){if(!s.isObservable(e))throw new Error("Parameter must be a ko.observable.");e(""),e("<span>"+t+"</span>")},t.narrator=new u}),define("ui/modalDialog/modalDialog",["require","exports","module","browser/dom","browser/document","vendor/knockout","swx-constants","swx-constants","swx-overlay","constants/cssClasses","utils/common/accessibility","swx-g11n"],function(e,t){function h(e,t){var s,o=n.getElementById(e);return o&&i.removeNode(o),s=n.createElement("div"),s.innerHTML=t,o=s.firstChild,r.body.appendChild(o),o}function p(){return n.findElement("."+a.MODAL_DIALOG+":not(."+a.HIDE+")")}function d(){r.addEventListener(o.events.browser.KEYDOWN,m,!1)}function v(){r.removeEventListener(o.events.browser.KEYDOWN,m,!1)}function m(e){e.keyCode===s.ESCAPE&&t.hide()}var n=e("browser/dom"),r=e("browser/document"),i=e("vendor/knockout"),s=e("swx-constants").KEYS,o=e("swx-constants").COMMON,u=e("swx-overlay"),a=e("constants/cssClasses"),f=e("utils/common/accessibility"),l=e("swx-g11n").globalization,c=!1;t.build=function(e,t,n){var r=h(e,n);return i.applyBindings(t,r),r},t.show=function(e,t,r,i){var s,o,h=u.isOverlayDisplayed();r=r||"",u.display(e,t,r,{containerClasses:[a.base.SWX,a.base.DESKTOP],skipSlideCreation:i}),h||f.initFocusRing(u.getOverlayContainer()),s=n.getElementById(e),o=n.getParentWithClass(s,a.base.OVERLAY_CONTAINER),l.initLocaleDirection(o),n.removeClass(s,a.HIDE),d(),c=!0},t.hide=function(e){var t=n.getElementById(e)||p();v(),u.hide(),t&&n.addClass(t,a.HIDE),c=!1},t.dispose=function(e){var r=n.getElementById(e)||p();t.hide(e),r&&i.removeNode(r)},t.isDisplayed=function(){return c}}),define("ui/viewModels/calling/plugin/pluginInstallViewModel",["require","exports","module","ui/viewModels/calling/plugin/downloadStepViewModel","ui/viewModels/calling/plugin/startStepViewModel","ui/viewModels/calling/plugin/closeStepViewModel","ui/viewModels/calling/plugin/firefoxUnableToCallStepViewModel","ui/viewModels/calling/plugin/extensionInstallStepViewModel","ui/viewModels/calling/plugin/extensionInstallFailedStepViewModel","ui/viewModels/calling/plugin/extensionInstalledStepViewModel","ui/viewModels/calling/plugin/unblockStepViewModel","ui/viewModels/calling/plugin/callbackStepViewModel","ui/telemetry/telemetryClient","browser/document","swx-utils-common","vendor/knockout","swx-constants","experience/settings","swx-utils-common","swx-browser-detect","ui/modalDialog/modalDialog","swx-cafe-application-instance","browser/window"],function(e,t){var n=e("ui/viewModels/calling/plugin/downloadStepViewModel"),r=e("ui/viewModels/calling/plugin/startStepViewModel"),i=e("ui/viewModels/calling/plugin/closeStepViewModel"),s=e("ui/viewModels/calling/plugin/firefoxUnableToCallStepViewModel"),o=e("ui/viewModels/calling/plugin/extensionInstallStepViewModel"),u=e("ui/viewModels/calling/plugin/extensionInstallFailedStepViewModel"),a=e("ui/viewModels/calling/plugin/extensionInstalledStepViewModel"),f=e("ui/viewModels/calling/plugin/unblockStepViewModel"),l=e("ui/viewModels/calling/plugin/callbackStepViewModel"),c=e("ui/telemetry/telemetryClient"),h=e("browser/document"),p=e("swx-utils-common").guid,d=e("vendor/knockout"),v=e("swx-constants"),m=e("experience/settings"),g=e("swx-utils-common").stopwatch,y=e("swx-browser-detect").default,b=e("ui/modalDialog/modalDialog"),w=e("swx-cafe-application-instance"),E=e("browser/window"),S=4e3,x=v.CALLING,T=v.OUT_OF_BROWSER,N=function(t,v){function q(){var e=s.build({close:Q,conversation:H});N.activeStep(e),b.show("closeCallingSetup",e.label,""),e.show()}function R(){var e=k.isBrowserDefaultToBlockPlugin,t=k.isInBrowserPluginSupported,n=k.browserName===y.BROWSERS.CHROME,r=Boolean(h.querySelector(T.shellAppMetaSelector)),i=v.onlyUnblock;B&&H&&!i&&z(),n&&!t&&!r&&!i&&(W(),X(),V()),i||$({isUnblockStepIncluded:e}),e&&J(),H&&K(),U()}function U(){var e={onPluginInstallEnded:rt,next:G,close:Q};D=i.build(e)}function z(){var e={onPluginInstallEnded:rt,next:Z,close:Y,conversation:H};O.push(r.build(e))}function W(){var e={isFirefox:L,onPluginInstallEnded:rt,next:et,nextOnFailed:Z,close:Y,conversation:H};O.push(o.build(e))}function X(){var e={isFirefox:L,onPluginInstallEnded:rt,next:Z,close:Y,conversation:H};O.push(u.build(e))}function V(){var e={isFirefox:L,onPluginInstallEnded:rt,next:Z,close:Y,conversation:H};O.push(a.build(e))}function $(e){var t;e=e||{},t={onPluginInstallEnded:rt,next:H||e.isUnblockStepIncluded?Z:Q,close:Y,conversation:H,suppressEndedEvent:e.isUnblockStepIncluded},O.push(n.build(t))}function J(){var e={isFirefox:L,onPluginInstallEnded:rt,next:H?Z:Q,close:Y,conversation:H};O.push(f.build(e))}function K(){var e={onPluginInstallEnded:rt,next:Q,close:Q,conversation:H,isVideo:v.isVideo,isOutgoing:B};O.push(l.build(e))}function Q(){ut(),b.hide()}function G(){M=_,tt("next")}function Y(){_=M,M=O.length-1,nt(D,"next")}function Z(){_=M,M++,tt("next")}function et(){_=M,M+=2,tt("next")}function tt(e){if(M>=O.length){Q();return}var t=O[M];nt(t,e)}function nt(e,t){N.activeStep(e),b.show(e.id,e.label,t),e.show&&e.show()}function rt(e,t,n){st(e,t,n),v.done&&v.done(e,t)}function it(){var e={name:x.TELEMETRY_EVENTS.PLUGIN_INSTALL_STARTED,plugin_install_context_id:A,source:t,installationReason:P,success:x.NA,exitMethod:x.NA,durationInMs:x.NA,closeScreen:x.NA};c.get().sendEvent(m.telemetry.uiTenantToken,"PluginInstall",e)}function st(e,t,n){var r={name:x.TELEMETRY_EVENTS.PLUGIN_INSTALL_ENDED,plugin_install_context_id:A,source:x.NA,installationReason:P,success:t.toString(),exitMethod:e,durationInMs:j.duration().toString(10),closeScreen:n||O[_].id};c.get().sendEvent(m.telemetry.uiTenantToken,"PluginInstall",r)}function ot(){var e=C.devicesManager.mediaCapabilities;e.isPluginInstalled?F=E.setInterval(function(){e.isPluginInstalled.get()},S):F=E.setInterval(function(){C.devicesManager.checkMediaCapabilities()},S)}function ut(){E.clearInterval(F)}if(typeof t!="string")throw new Error("source param is mandatory");v=v||{};var N=this,C=w.get(),k=y.getBrowserInfo(),L=k.browserName===y.BROWSERS.FIREFOX,A=p.create(),O=[],M=0,_=0,D,P=x.NA,H=v.conversation,B=v.isOutgoing,j,F,I=51;this.firefoxUnableToCall=d.observable(L&&k.browserMajorVersion>I),this.activeStep=d.observable(),this.start=function(){if(N.firefoxUnableToCall()){q();return}j=g.build(),R(),M=0,tt(""),ot(),it()}};t.build=function(e,t){return new N(e,t)}}),define("text",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("text!views/calling/pluginInstall.html",[],function(){return'<div id="overlayPluginSlides" class="swx-overlayModal swx-hide">\r\n    <!-- ko ifnot: firefoxUnableToCall -->\r\n    <!-- ko with: activeStep -->\r\n\r\n    <div id="overlayPluginStart" data-bind="if: $parent.activeStep().id === $element.id">\r\n        <div class="overlayControls">\r\n              <div class="right">\r\n                <button class="btn narrow transparent" data-bind="click: close" type="button">\r\n                    <span class="iconfont after cross pull3" data-bind="l10n: { \'key\': \'pluginInstall_main_text_close\' }"></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <div class="overlayMain">\r\n            <div class="title">\r\n                <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { \'key\': \'pluginInstall_main_text_title\' }"></h1>\r\n            </div>\r\n            <div class="subtitle">\r\n                <p class="fontSize-h2 fontSizeNarrow-h4" data-bind="l10n: { \'key\': \'pluginInstall_main_text_subtitle\' }"></p>\r\n            </div>\r\n            <swx-avatar params="isGroupAvatar: isGroupConversation, avatar: avatar, displayName: topic, isPstn: isPstn, size: 160" class="avatar"></swx-avatar>\r\n            <div class="buttonRow">\r\n                <button class="btn green narrow large" data-bind="click: installClick" type="button">\r\n                    <span class="iconfont after arrowRight pull2" data-bind="l10n: { \'key\': \'pluginInstall_main_text_install\' }"></span>\r\n                </button>\r\n            </div>\r\n            <!-- ko if: showAutoUpdateDisclaimer -->\r\n            <div class="autoUpdateDisclaimer">\r\n                <p data-bind="l10n: { \'key\': \'pluginInstall_label_text_autoUpdateDisclaimer\' }"></p>\r\n            </div>\r\n            <!-- /ko -->\r\n        </div>\r\n    </div>\r\n\r\n    <div id="overlayExtensionInstall" data-bind="if: $parent.activeStep().id === $element.id">\r\n        <div class="overlayControls">\r\n              <div class="right">\r\n                <button class="btn narrow transparent" data-bind="click: close" type="button">\r\n                    <span class="iconfont after cross pull3" data-bind="l10n: { \'key\': \'pluginInstall_main_text_close\' }"></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <div class="overlayMain">\r\n            <div class="title">\r\n                <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { \'key\': \'pluginInstall_extension_main_text_title\' }"></h1>\r\n            </div>\r\n            <div class="subtitle">\r\n                <p class="fontSize-h2 fontSizeNarrow-h4" data-bind="l10n: { \'key\': \'pluginInstall_extension_main_text_subtitle\' }"></p>\r\n            </div>\r\n            <div class="illustration">\r\n                <img data-bind="attr: { src: skypeChromeImageUrl }, css: { firefox: isFirefox }" alt="" role="presentation" aria-hidden="true"/>\r\n            </div>\r\n            <div class="buttonRow">\r\n                <button class="btn green narrow large" data-bind="click: installClick" type="button">\r\n                    <span class="iconfont after arrowRight pull2" data-bind="l10n: { \'key\': \'pluginInstall_extension_main_text_add_extension\' }"></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div id="overlayExtensionInstallFailed" data-bind="if: $parent.activeStep().id === $element.id">\r\n        <div class="overlayControls">\r\n              <div class="right">\r\n                <button class="btn narrow transparent" data-bind="click: close" type="button">\r\n                    <span class="iconfont after cross pull3" data-bind="l10n: { \'key\': \'pluginInstall_main_text_close\' }"></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <div class="overlayMain">\r\n            <div class="title">\r\n                <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { \'key\': \'pluginInstall_extension_main_install_failed_text_title\' }"></h1>\r\n            </div>\r\n            <div class="subtitle">\r\n                <p class="fontSize-h2 fontSizeNarrow-h4" data-bind="l10n: { \'key\': \'pluginInstall_extension_main_install_failed_text_subtitle\' }"></p>\r\n            </div>\r\n            <div class="illustration">\r\n                <img data-bind="attr: { src: imageUrl }, css: { firefox: isFirefox }" alt="" role="presentation" aria-hidden="true"/>\r\n            </div>\r\n            <div class="buttonRow">\r\n                <a class="btn green narrow large" target="_blank" data-bind="attr: { href: chromeWebstoreUrl }">\r\n                    <span class="iconfont after arrowRight pull2" data-bind="l10n: { \'key\': \'pluginInstall_extension_main_install_failed_go_to_chrome_webstore_text\' }"></span>\r\n                </a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div id="overlayExtensionInstalled" data-bind="if: $parent.activeStep().id === $element.id">\r\n        <div class="overlayControls">\r\n              <div class="right">\r\n                <button class="btn narrow transparent" data-bind="click: close" type="button">\r\n                    <span class="iconfont after cross pull3" data-bind="l10n: { \'key\': \'pluginInstall_main_text_close\' }"></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <div class="overlayMain">\r\n            <div class="title">\r\n                <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { \'key\': \'pluginInstall_extension_main_installed_text_title\' }"></h1>\r\n            </div>\r\n            <div class="subtitle">\r\n                <p class="fontSize-h2 fontSizeNarrow-h4" data-bind="l10n: { \'key\': \'pluginInstall_extension_main_installed_text_subtitle\' }"></p>\r\n            </div>\r\n            <div class="illustration">\r\n                <img data-bind="attr: { src: getPluginImageUrl }, css: { firefox: isFirefox }" alt="" role="presentation" aria-hidden="true"/>\r\n            </div>\r\n            <div class="buttonRow">\r\n                <button class="btn green narrow large" data-bind="click: installClick" type="button">\r\n                    <span class="iconfont after arrowRight pull2" data-bind="l10n: { \'key\': \'pluginInstall_extension_main_installed_get_plugin_text\' }"></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div id="closeCallingSetup" data-bind="if: $parent.activeStep().id === $element.id">\r\n        <div class="overlayMain">\r\n            <div class="title">\r\n                <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { \'key\': \'pluginInstall_main_close_screen_title\' }"></h1>\r\n            </div>\r\n            <div class="subtitle">\r\n                <p class="fontSize-h2 fontSizeNarrow-h4" data-bind="l10n: { \'key\': \'pluginInstall_main_close_screen_subtitle\' }"></p>\r\n            </div>\r\n            <div class="illustration">\r\n                <img data-bind="attr: { src: closeScreenImageUrl }, css: { firefox: isFirefox }" alt="" role="presentation" aria-hidden="true"/>\r\n            </div>\r\n            <div class="buttonRow">\r\n                <button class="btn green narrow large" data-bind="click: next" type="button">\r\n                    <span class="iconfont after arrowRight pull2" data-bind="l10n: { \'key\': \'pluginInstall_main_close_screen_finish_text\' }">\r\n                    </span>\r\n                </button>\r\n\r\n                <button class="btn narrow transparent" data-bind="click: close" type="button">\r\n                    <span data-bind="l10n: { \'key\': \'pluginInstall_main_close_screen_leave_text\' }"></span>\r\n                </button>\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div id="overlayPluginSteps" data-bind="if: $parent.activeStep().id === $element.id">\r\n        <div class="overlayControls">\r\n            <div class="left">\r\n                <button class="btn narrow transparent" data-bind="click: restartDownload" type="button">\r\n                    <span class="iconfont reload pull2" data-bind="l10n: { \'key\': \'pluginInstall_steps_text_restart\' }"></span>\r\n                </button>\r\n            </div>\r\n            <div class="right">\r\n                <button class="btn narrow transparent" data-bind="click: close" type="button">\r\n                    <span class="iconfont after cross pull3" data-bind="l10n: { \'key\': \'pluginInstall_main_text_close\' }"></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <div class="overlayMain">\r\n            <div class="title">\r\n                <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { \'key\': \'pluginInstall_steps_text_title\' }"></h1>\r\n            </div>\r\n            <div class="subtitle">\r\n                <p class="fontSize-h2 fontSizeNarrow-h4" data-bind="l10n: { \'key\': \'pluginInstall_steps_text_subtitle\' }"></p>\r\n            </div>\r\n            <div class="grid verticalGutter">\r\n                <div class="row">\r\n                    <div class="column unit4">\r\n                        <div class="icon">\r\n                            <img data-bind="attr: { src: downloadImage }" alt="" role="presentation" aria-hidden="true"/>\r\n                        </div>\r\n                        <div class="text">\r\n                            <p class="fontSize-h3 fontSizeNarrow-h4" data-bind="text: downloadText"></p>\r\n                        </div>\r\n                    </div>\r\n                    <div class="column unit4">\r\n                        <div class="icon">\r\n                            <img data-bind="attr: { src: installImage }" alt="" role="presentation" aria-hidden="true"/>\r\n                        </div>\r\n                        <div class="text">\r\n                            <p class="fontSize-h3 fontSizeNarrow-h4" data-bind="text: installText"></p>\r\n                        </div>\r\n                    </div>\r\n                    <div class="column unit4">\r\n                        <div class="icon">\r\n                            <img data-bind="attr: { src: enjoyImage }" alt="" role="presentation" aria-hidden="true"/>\r\n                        </div>\r\n                        <div class="text">\r\n                            <p class="fontSize-h3 fontSizeNarrow-h4" data-bind="text: enjoyText"></p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <!-- ko if: showTermsAndPrivacy -->\r\n            <div class="termsOfUse">\r\n                <p data-bind="l10n: { \'key\': \'pluginInstall_steps_text_termsAndPrivacy\', \'params\': { \'terms_link\': getLink(\'terms\'), \'privacy_link\': getLink(\'privacy\') } }"></p>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: showAutoUpdateDisclaimer -->\r\n            <div class="autoUpdateDisclaimer">\r\n                <p data-bind="l10n: { \'key\': \'pluginInstall_label_text_autoUpdateDisclaimer\' }"></p>\r\n            </div>\r\n            <!-- /ko -->\r\n        </div>\r\n    </div>\r\n\r\n    <div id="overlayPluginUnblock" data-bind="if: $parent.activeStep().id === $element.id">\r\n        <div class="overlayControls">\r\n            <div class="right">\r\n                <button class="btn narrow transparent" data-bind="click: close" type="button">\r\n                    <span class="iconfont after cross pull3" data-bind="l10n: { \'key\': \'pluginInstall_main_text_close\' }"></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <div class="overlayMain">\r\n            <div class="title">\r\n                <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { \'key\': \'pluginInstall_unblock_text_title\' }"></h1>\r\n            </div>\r\n            <div class="subtitle">\r\n                <p class="fontSize-h2 fontSizeNarrow-h4" data-bind="text: unblockText"></p>\r\n            </div>\r\n            <div class="illustration">\r\n                <img data-bind="attr: { src: unblockImageUrl }, css: { firefox: isFirefox }" alt="" role="presentation" aria-hidden="true"/>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div id="overlayPluginCallback" data-bind="if: $parent.activeStep().id === $element.id">\r\n        <div class="overlayMain">\r\n            <h1 class="ellipsis" data-bind="l10n: { \'key\': \'pluginInstall_callback_text_title\', params: { displayName: topic }  }"></h1>\r\n            <div class="subtitle">\r\n                <p class="fontSize-h2 fontSizeNarrow-h4" data-bind="l10n: { \'key\': \'pluginInstall_callback_text_subtitle\' }"></p>\r\n            </div>\r\n            <swx-avatar params="isGroupAvatar: isGroupConversation, avatar: avatar, displayName: topic, isPstn: isPstn, size: 160" class="avatar"></swx-avatar>\r\n            <div class="dual buttonRow">\r\n                <div class="column alignRight">\r\n                    <button class="btn primary large" data-bind="click: placeCall" type="button">\r\n                        <span data-bind="l10n: { \'key\': placeCallTextKey() }"></span>\r\n                    </button>\r\n                </div>\r\n                <div class="column alignLeft">\r\n                    <button class="btn secondary large" data-bind="click: notNow" type="button">\r\n                        <span data-bind="l10n: { \'key\': \'pluginInstall_callback_text_notNow\' }"></span>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: firefoxUnableToCall -->\r\n    <!-- ko with: activeStep -->\r\n    <div id="closeCallingSetup" data-bind="if: $parent.activeStep().id === \'overlayPluginFirefoxUnableToCall\'">\r\n        <div class="overlayControls">\r\n              <div class="right">\r\n                <button class="btn narrow transparent" data-bind="click: close" type="button">\r\n                    <span class="iconfont after cross pull3" data-bind="l10n: { \'key\': \'pluginInstall_main_text_close\' }"></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <div class="overlayMain">\r\n            <div class="title">\r\n                <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { \'key\': \'pluginInstall_firefox_unable_to_call_text_title\' }"></h1>\r\n            </div>\r\n            <div class="subtitle">\r\n                <p class="fontSize-h2 fontSizeNarrow-h4" data-bind="l10n: { \'key\': \'pluginInstall_firefox_unable_to_call_text_subtitle\' }"></p>\r\n            </div>\r\n            <swx-avatar params="isGroupAvatar: isGroupConversation, avatar: avatar, displayName: topic, isPstn: isPstn, size: 160" class="avatar"></swx-avatar>\r\n            <div class="buttonRow">\r\n                <button class="btn green narrow large" data-bind="click: close" type="button">\r\n                    <span class="iconfont after cross pull3" data-bind="l10n: { \'key\': \'pluginInstall_main_text_close\' }"></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("services/calling/pluginInstall",["require","exports","module","ui/viewModels/calling/plugin/pluginInstallViewModel","swx-cafe-application-instance","swx-enums","text!views/calling/pluginInstall.html","ui/modalDialog/modalDialog"],function(e,t){var n=e("ui/viewModels/calling/plugin/pluginInstallViewModel"),r=e("swx-cafe-application-instance"),i=e("swx-enums"),s=e("text!views/calling/pluginInstall.html"),o=e("ui/modalDialog/modalDialog"),u="overlayPluginSlides";t.startInstallFlow=function(t,r){o.isDisplayed()&&o.dispose();var i=n.build(t,r);return o.build(u,i,s),i.start(),i},t.isPluginInstalled=function(t,n){var s=r.get().devicesManager.mediaCapabilities;if(s.isPluginInstalled)return new Promise(function(e){s.isBrowserMediaSupported()||s.isPluginInstalled()?e(!0):s.isPluginInstalled.get().finally(function(){e(s.isPluginInstalled())})});var o=r.get().personsAndGroupsManager.mePerson.capabilities.audio,u=r.get().personsAndGroupsManager.mePerson.capabilities.video;return n?t.videoService.start.enabled.get().then(function(e){return u.reason!==i.callingNotSupportedReasons.PluginNotInstalled&&e}):t.audioService.start.enabled.get().then(function(e){return o.reason!==i.callingNotSupportedReasons.PluginNotInstalled&&e})}}),define("ui/controls/calling/sounds",["require","exports","module","experience/settings"],function(e,t){function o(e){var n;if(!u(e))throw new Error("Invalid sound: "+e);return n=r[e],n||(n=document.createElement("audio"),s.forEach(function(i){var s=document.createElement("source"),o=t.buildSoundAssetUrl(e,i.extension);s.setAttribute("type",i.mimeType),s.setAttribute("src",o),n.appendChild(s),r[e]=n}),n.id=i+e),n}function u(e){for(var n in t.KEYS)if(t.KEYS[n]===e)return!0;return!1}var n=e("experience/settings"),r={},i="skype_sounds_",s=[{mimeType:"audio/mp4",extension:"m4a"},{mimeType:"audio/ogg",extension:"ogg"}];t.KEYS={CALL_ANSWER:"call-answer",CALL_CONNECTING:"call-connecting-loop",CALL_DIALING:"call-dialing",CALL_END_CALL:"call-endcall",CALL_ERROR_1:"call-error-1",CALL_ERROR_2:"call-error-2",CALL_HOLD:"call-hold-loop",CALL_INCOMING:"call-incoming-loop",CALL_NO_ANSWER:"call-no-answer",CALL_OUTGOING:"call-outgoing-original-loop",CALL_OUTGOING_P1:"call-outgoing-p1",CALL_OUTGOING_P2:"call-outgoing-p2-loop",CALL_RECONNECT:"call-reconnect-loop",CALL_RESUME:"call-resume",CAM_SHUTTER_CLOSE:"cam-shutter-close",CAM_SHUTTER_OPEN:"cam-shutter-open",CONTACTS_ADDED:"contacts-added",CONTACTS_AVAILABLE:"contacts-available",CONTACTS_RECEIVED:"contacts-received",FILE_TRANSFER_COMPLETE:"file-transfer-complete",FILE_TRANSFER_FAILED:"file-transfer-failed",FILE_TRANSFER_INCOMING:"file-transfer-incoming",LOGIN:"login",LOGOUT:"logout",MESSAGE_RECEIVED_1:"message-received-1",MESSAGE_RECEIVED_2:"message-received-2",MESSAGE_RECEIVED_3:"message-received-3",MESSAGE_RECEIVED_4:"message-received-4",MESSAGE_SENT:"message-sent",VIDEO_MESSAGE_RECORD_START:"video-message-record-start",VIDEO_MESSAGE_RECORD_STOP:"video-message-record-stop",VOICEMAIL_RECEIVED:"voicemail-received"},t.playLoop=function(e){var t=o(e);t.setAttribute("loop",!0),t.play()},t.playOnce=function(e,t){var n=o(e),r="ended";n.addEventListener(r,function i(){t&&t(),n.removeEventListener(r,i)}),n.play()},t.stop=function(e){var t=o(e);t.pause(),t.load()},t.clearCache=function(){r={}},t.buildSoundAssetUrl=function(e,t){return[n.assetsBaseUrl,"/audio","/",t,"/",e,".",t].join("")}}),define("utils/common/disposableMixin",["require","swx-pubsub-instance","browser/window","swx-constants","vendor/knockout"],function(e){function s(e){if(e._dmDisposeExtended)return;var t=e.dispose;e.dispose=function(){e._dmDisposeAll(),t&&t.call(e)},e._dmDisposeExtended=!0}var t=e("swx-pubsub-instance").default,n=e("browser/window"),r=e("swx-constants").COMMON.disposableGroups,i=e("vendor/knockout");return{registerPubSubEvent:function(e,n){t.subscribe(e,n),this._dmRegisterDisposableItem(r.PUB_SUB,{eventName:e,callback:n})},unregisterPubSubEvent:function(e,n){t.unsubscribe(e,n),this._dmUnRegisterDisposableItem(r.PUB_SUB,function(t){return t.eventName===e&&t.callback===n})},registerComputed:function(e){var t=i.computed(e);return this.registerDisposable(t),t},observable:function(){return i.observable.apply(i,arguments)},observableArray:function(){return i.observableArray.apply(i,arguments)},registerDisposable:function(e){if(!e.dispose)throw new TypeError("Item does not implement Disposable");this._dmRegisterDisposableItem(r.GENERIC_DISPOSABLE,e)},unregisterDisposable:function(e){e.dispose(),this._dmUnRegisterDisposableItem(r.GENERIC_DISPOSABLE,function(t){return t===e})},registerInterval:function(e,t){var i=n.setInterval(e,t);return this._dmRegisterDisposableItem(r.INTERVAL,i),i},unregisterInterval:function(e){n.clearInterval(e),this._dmUnRegisterDisposableItem(r.INTERVAL,function(t){return t===e})},registerDOMEvent:function(e,t,n,i){e.addEventListener(t,n,i),this._dmRegisterDisposableItem(r.DOM_EVENT,{object:e,event:t,handler:n,useCapture:i})},unregisterDOMEvent:function(e,t,n,i){e.removeEventListener(t,n,i),this._dmUnRegisterDisposableItem(r.DOM_EVENT,function(r){return r.object===e&&r.event===t&&r.handler===n&&r.useCapture===i})},registerTimeout:function(e,t){var i=n.setTimeout(e,t);return this._dmRegisterDisposableItem(r.TIMEOUT,i),i},unregisterTimeout:function(e){n.clearTimeout(e),this._dmUnRegisterDisposableItem(r.TIMEOUT,function(t){return t===e})},_dmDisposeAll:function(){function i(e,i){switch(e){case r.PUB_SUB:i.forEach(function(e){t.unsubscribe(e.eventName,e.callback)});break;case r.GENERIC_DISPOSABLE:i.forEach(function(e){e.dispose()});break;case r.INTERVAL:i.forEach(n.clearInterval);break;case r.TIMEOUT:i.forEach(n.clearTimeout);break;case r.DOM_EVENT:i.forEach(function(e){e.object.removeEventListener(e.event,e.handler,e.useCapture)})}}if(!this._disposableItems)return;for(var e in this._disposableItems)this._disposableItems.hasOwnProperty(e)&&i(e,this._disposableItems[e]||[]);this._disposableItems=null},_dmRegisterDisposableItem:function(e,t){s(this),this._disposableItems=this._disposableItems||{},this._disposableItems[e]=this._disposableItems[e]||[],this._disposableItems[e].push(t)},_dmUnRegisterDisposableItem:function(e,t){this._disposableItems=this._disposableItems||{};var n=this._disposableItems[e]||[];for(var r=0;r<n.length;r++)if(t(n[r])){n.splice(r,1);break}}}}),define("services/ecs/jsonp",["require","swx-browser-globals","swx-utils-common","experience/settings"],function(e){function s(e,s,o,u,a){var f,l,c,h=t.getWindow();a=a||"callback";if(!e||!s)throw"mandatory options missing";c=function(){h.clearTimeout(l),u&&(u(),u=null,o=null)},f=e+(/\?/.test(e)?"&":"?")+a+"=Skype."+s,h.Skype[s]=function(){h.clearTimeout(l),o&&(o.apply(null,arguments),o=null),h.Skype[s]=null,u=null},n.loadScript(f,i,c),l=h.setTimeout(c,r.jsonpTimeout||2e4)}var t=e("swx-browser-globals"),n=e("swx-utils-common").loader,r=e("experience/settings"),i=function(){};return{request:s}}),define("services/ecs/configLoader",["require","lodash-compat","experience/settings","services/ecs/jsonp","reqwest"],function(e){function s(){function a(){var e=n.version.split(".",4);while(e.length<4)e.push("0");return e[3]=e[2],e[2]=n.ecsClientCobrandTag,u+"_"+e.join(".")}function f(e){function r(t,n){return e[n]?t.concat([n,e[n]].join("=")):t}var n=t.keys(e).reduce(r,[]);if(n.length>0)return n.join("&")}function l(e,t,n,r,i){var s=a(),o=f(r),u=t+"/config/v1/"+e+"/"+s+"/"+n,l="?";return n.indexOf(l)>-1&&(l="&"),o&&(u+=l+o,l="&"),i&&(u+=l+"id="+i),u}function c(e,t,r,i){var s,o=[],u={};n.initParams&&n.initParams.apiKey&&(u.apikey=n.initParams.apiKey);for(s=0;s<t.length;s++)o.push(l(e,t[s],r,u,i));return o}function h(){return t.isString(n.ecsHosts)?JSON.parse(n.ecsHosts):n.ecsHosts||[]}var e=this,s=2,o=1,u=908;e.loadConfig=function(e,t,u){var a=h(),f=c(e,a,t,u);return new Promise(function(e,t){function c(o){function h(t){e(t)}function p(){var e=u/f.length>=s,n;e?t(new Error("configuration service unreachable")):(a+=1,n=a%f.length,c(f[n]))}u++;if(n.initParams.jsonp===!1){var d={url:o,method:"GET",crossOrigin:!0,dataType:"json"};i.compat(d).then(h,p)}else r.request(o,"onConfigurationLoaded_"+l,h,p)}var u=0,a=0,l=o;o+=1,!f||!f.length?t(new Error("no configuration service endpoint")):(c(f[a]),a+=1)})}}var t=e("lodash-compat"),n=e("experience/settings"),r=e("services/ecs/jsonp"),i=e("reqwest");return new s}),define("ui/calling/unansweredCallHandler",["require","exports","module","lodash-compat","swx-constants","swx-constants","ui/modelHelpers/conversationHelper","utils/common/disposableMixin","services/ecs/configLoader","swx-enums","vendor/knockout","swx-log-tracer","swx-service-locator-instance","experience/settings"],function(e,t){function k(){if(!C||!N)N=u.loadConfig(a.ecsClientNames.Skype,h.ecsSkypeCallingT1Key);return N}function L(){t.newCallStartedInShellApp(null),t.previousCallEndedInShellApp(null),m=!1,g=!1,y=!1,w=!1,E=!1,x=null,T=0}function A(e){var t=e.audio.state.when(a.callConnectionState.Connected,function(){g=!0});p.registerDisposable(t)}var n=e("lodash-compat"),r=e("swx-constants").CALLING,i=e("swx-constants").COMMON,s=e("ui/modelHelpers/conversationHelper"),o=e("utils/common/disposableMixin"),u=e("services/ecs/configLoader"),a=e("swx-enums"),f=e("vendor/knockout"),l=e("swx-log-tracer").getLogger(),c=e("swx-service-locator-instance").default,h=e("experience/settings"),p={},d=!1,v,m=!1,g=!1,y=!1,b=!1,w=!1,E=!1,S=!1,x=null,T=0,N,C=null;t.init=function(){var e=c.resolve(i.serviceLocator.FEATURE_FLAGS);return d=!1,C=null,e.isFeatureOn(i.featureFlags.UNANSWERED_CALL_UI)?k().then(function(e){n.isEmpty(e)?(l.log("[Unanswered Call UI] ECS config empty"),d=!0):(C=e,d=C.UnansweredCallUIEnabled)}).catch(function(e){l.log("[Unanswered Call UI] failed to get ECS config",e),d=!0}):Promise.resolve()},t.newCallStartedInShellApp=f.observable(null),t.previousCallEndedInShellApp=f.observable(null),t.observe=function(e){if(!d)return;v=e,L();var n=v.selfParticipant.audio.state.when(a.callConnectionState.Connected,function(){m=!0});p.registerDisposable(n),e.participants.added(A),s.isCallingActive(v)||t.newCallStartedInShellApp(v),x=(new Date).getTime(),w=v.mediaConnectionType()===a.mediaConnectionType.Pluginless,E=s.isPstnEndpoint(v.participants(0).audio.endpoint())},t.callEnded=function(){if(!d||!v)return;b=v.audioService.callHadNoMicrophone(),T=(new Date).getTime()-x,t.newCallStartedInShellApp()&&t.previousCallEndedInShellApp(v),p.dispose&&p.dispose()},t.callHungUpByCaller=function(){y=!0},t.callStarting=function(e){S=e},t.setup=function(){if(!d)return Promise.reject(new Error("Unanswered call UI is disabled"));if(v.selfParticipant.audio.state.reason===a.callDisconnectionReason.CallEscalated)return Promise.reject(new Error("Unanswered call UI is ignoring call escalations"));var e=h.unansweredUI.minCallDuration,t=new Promise(function(t,s){function o(e){var n=c.resolve(i.serviceLocator.PUBSUB);n.publish(i.events.navigation.OPEN_CONVERSATION,{model:v,origin:i.telemetry.historyLoadOrigin.UNANSWERED_CALL_UI}),t({reason:e,wasVideoCall:S,ecsConfig:C}),L()}function u(){s(new Error("Unanswered call UI should not be shown in this scenario")),L()}function f(e){return e===a.callDisconnectionReason.Busy?r.UNANSWERED_CALL_REASONS.BUSY:r.UNANSWERED_CALL_REASONS.MISSED}function l(){if(m||E||b){u();return}var t=v.participants(0).audio.state.reason;!y||T>=e?o(f(t)):u()}function h(){g?u():!y||T>=e?o(r.UNANSWERED_CALL_REASONS.UNAVAILABLE):u()}function p(){return n.some(v.participants(),function(e){return!e.audio.state.reason})}!w&&p()&&(y=!0),v.isGroupConversation()?h():l()});return t},n.extend(p,o)}),define("ui/viewModels/calling/helpers/callingFacade",["require","exports","module","swx-constants","swx-constants","swx-util-calling-stack","swx-enums","ui/viewModels/chat/navigationHelper","services/calling/pluginInstall","swx-pubsub-instance","ui/controls/calling/sounds","swx-cafe-application-instance","swx-service-locator-instance","ui/calling/unansweredCallHandler"],function(e,t){function p(e,t,r,i){return a.publish(n.EVENTS.START_CALL,{conversation:e,isVideo:t,source:r}),h.callStarting(t),f.playLoop(f.KEYS.CALL_CONNECTING),i&&o.navigateToConversation(e,r),t?e.videoService.start():e.audioService.start()}function d(e,t){return a.publish(n.EVENTS.ANSWER,{conversation:e,isVideo:t}),t&&e.videoService.accept.enabled()?e.videoService.accept():e.audioService.accept()}function v(e,t,n,r){return u.isPluginInstalled(e,t).then(function(i){return i?p(e,t,n,r):m(e,t,!0,"outgoing",n,r)})}function m(e,t,i,a,f,h){var v=l.get().personsAndGroupsManager.mePerson.capabilities.audio.reason,m=c.resolve(r.serviceLocator.FEATURE_FLAGS),g=v===s.callingNotSupportedReasons.PluginBlocked;return!m.isFeatureOn(r.featureFlags.ASK_TO_UNBLOCK_PLUGIN)&&g?Promise.reject(Error(s.callingNotSupportedReasons.PluginBlocked)):new Promise(function(r,l){function c(i,u){if(e&&u&&i===n.PLUGIN_INSTALL_EXIT_METHOD.CALL_STARTED){var a;e.selfParticipant.audio.state()===s.callConnectionState.Notified?a=d(e,t):a=p(e,t,"pluginInstallCallback"),h&&o.navigateToConversation(e,f),r(a)}else l(Error("Plugin install result: "+u+", exitMethod: "+i))}u.startInstallFlow(a,{isOutgoing:i,conversation:e,isVideo:t,done:c,onlyUnblock:g})})}var n=e("swx-constants").CALLING,r=e("swx-constants").COMMON,i=e("swx-util-calling-stack"),s=e("swx-enums"),o=e("ui/viewModels/chat/navigationHelper"),u=e("services/calling/pluginInstall"),a=e("swx-pubsub-instance").default,f=e("ui/controls/calling/sounds"),l=e("swx-cafe-application-instance"),c=e("swx-service-locator-instance").default,h=e("ui/calling/unansweredCallHandler");t.placeCall=function(e,t,n,r){return f.playOnce(f.KEYS.CALL_DIALING),i.get().isPluginlessCallingSupported()?p(e,t,n,r):v(e,t,n,r)},t.acceptCall=d,t.rejectCall=function(e){a.publish(n.EVENTS.REJECT,{conversation:e}),e.audioService.reject()},t.installPlugin=function(e,t,n,r){r=r||!1,m(t,r,n,e)}}),define("experience/api/helpers/modality",["require","exports","module","lodash-compat","swx-constants","swx-enums","ui/viewModels/calling/helpers/callingFacade","ui/telemetry/actions/actionNames","swx-service-locator-instance"],function(e,t){function l(e){return n.contains(e,a.VIDEO)}function c(e){return n.contains(e,a.AUDIO)}function h(e){return n.contains(e,a.CHAT)}function p(e){return l(e)||c(e)||h(e)}var n=e("lodash-compat"),r=e("swx-constants").COMMON,i=e("swx-enums"),s=e("ui/viewModels/calling/helpers/callingFacade"),o=e("ui/telemetry/actions/actionNames"),u=e("swx-service-locator-instance").default,a=r.modalityType,f=r.api.modality.errorMessages;t.startModalities=function(e,t,a){function g(){n.isFunction(t)&&t()}function y(e){if(n.isFunction(a))try{a(e)}catch(t){}}function b(e){e.start.enabled.reason===i.callingNotSupportedReasons.PluginNotInstalled?w(e===v.videoService):m=f.MODALITY_START_FAILED}function w(e){var t=u.resolve(r.serviceLocator.ACTION_TELEMETRY),n=e?o.audioVideo.apiVideoCall:o.audioVideo.apiAudioCall;t.recordAction(n),s.placeCall(v,e,"integrationAPI")}var d=e.modalities,v=e.conversation,m="";if(!d||n.isEmpty(d)){g();return}if(!n.isArray(d)){y(f.INVALID_MODALITIES);return}if(!p(d)){y(f.MODALITY_TYPE_NOT_SUPPORTED);return}l(d)&&(v.videoService.start.enabled()?v.videoService.start():b(v.videoService)),c(d)&&(v.audioService.start.enabled()?v.audioService.start():b(v.audioService)),h(d)&&v.chatService.start.enabled()&&e.startChatService&&v.chatService.start(),m===""?g():y(m)}}),define("experience/api/error",["require","exports","module","lodash-compat"],function(e,t){var n=e("lodash-compat");t.asApiError=function(e,t){var r;return e instanceof Error?r=Object.create(e):n.isString(e)?r=new Error(e):(r=new Error("Unknown: please check *data* property for more info"),r.data=e),r.name=["SWXApi",t||"",r.name].join(":"),r}}),define("telemetry/chat/conversationJoined",["require","exports","module","experience/settings","ui/modelHelpers/personHelper","swx-utils-chat","ui/telemetry/telemetryClient","swx-browser-globals","swx-constants"],function(e,t){function c(){function t(e){return r.isGuestId(e)?a.result.SIGNED_OUT:a.result.SIGNED_IN}function u(t,r,i){r=r||a.result.INCONCLUSIVE;var u=a.TYPE,f=o.getWindow(),c={milestone:t,result:r.toString(),client_time:(new f.Date).getTime().toString(),Prefix:e._prefix,thread_id:e._threadId.toString(),conversationOrigin:l()};i&&(c.participantsCount=i),s.get().sendEvent(n.telemetry.chatTenantToken,u,c)}function l(){return i.isGuestHostConversation(e._threadId)?f.GUEST_HOST:f.NORMAL}function c(e){return/^(.*):/.exec(e)[1]}function h(){e._threadId=undefined,e._prefix=undefined}var e=this;return e._threadId=undefined,e._prefix=undefined,e.onJoinConversation=function(n){var r=n.prefix.indexOf(":")===-1,i=t(n.prefix);e._threadId=n.uri,e._prefix=r?"":c(n.prefix),u(a.milestoneType.CLIENT_INIT,i)},e.onJoinConversationError=function(t){if(!e.isTriggered())return;u(a.milestoneType.ERROR,t),h()},e.onConversationJoined=function(t){if(!e.isTriggered())return;u(a.milestoneType.END,a.result.SUCCESS,t?t.participantsCount+1:t),h()},e.isTriggered=function(){return e._threadId},e.isTriggeredFor=function(t){return e._threadId===t},e}var n=e("experience/settings"),r=e("ui/modelHelpers/personHelper"),i=e("swx-utils-chat").conversation,s=e("ui/telemetry/telemetryClient"),o=e("swx-browser-globals"),u=e("swx-constants").COMMON,a=u.telemetry.conversationJoined,f=u.telemetry.conversationOrigin,l;t.get=function(){return l||(l=new c),l}}),define("experience/api/helpers/conversationsSynchronizer",["require","exports","module","swx-cafe-application-instance"],function(e,t){var n=e("swx-cafe-application-instance");t.sync=function(){function r(e){var t=n.get().conversationsManager;return t.conversations.size()<1&&t.getMoreConversations.enabled()?t.getMoreConversations(1).then(s).catch(i):s(e)}function i(){return Promise.all([])}function s(e){e=e||n.get().conversationsManager.conversations();var t=e.reduce(function(e,t){return t.conversationId?e.concat([t.conversationId]):e.concat([t.uri()||t.uri.get()])},[]);return Promise.all(t)}var t=n.get().conversationsManager.conversations.get();return t.then(r)}}),define("experience/api/helpers/conversationFacade",["require","exports","module","vendor/knockout"],function(e,t){function r(e){function r(){t.participantsCount(e.participantsCount())}function i(){t.isJoiningEnabled(e.isJoiningEnabled())}var t=this;return t.participantsCount=n.observable(0),t.isJoiningEnabled=n.observable(!0),t.init=function(){e.participants.changed(r),e.isJoiningEnabled.changed(i)},t.dispose=function(){e.participants.changed.off(r),e.isJoiningEnabled.changed.off(i)},t.isJoinable=function(){return e.isJoiningEnabled.set.enabled()},t.makeJoinable=function(){e.isJoiningEnabled.set.enabled.once(!0,function(){e.isJoiningEnabled.set(!0)})},t.getJoinUrl=function(){return e.uri.get()},t}var n=e("vendor/knockout");t.build=function(e){return new r(e)}}),define("experience/api/helpers/contentNavigator",["require","exports","module","swx-constants","swx-service-locator-instance"],function(e,t){function i(e){function u(){return r.resolve(n.serviceLocator.PUBSUB)}function a(e){f(e.contentElementId)&&(u().unsubscribe(o,a),t=!0,i&&(i(),i=null))}function f(e){return s=s||l(),e===s}function l(){return e.firstChild?e.firstChild.getAttribute("id"):null}function c(e){u().publish(n.events.navigation.OPEN_CONVERSATION,{model:e,origin:n.telemetry.historyLoadOrigin.NEW_CHAT_API_START_CONVERSATION,contentElementId:s})}var t=!1,i=null,s=null,o=n.apiUIEvents.SWX_CONTENT_LOADED;u().subscribe(o,a),this.navigateToConversation=function(e){t?c(e):i=c.bind(undefined,e)}}var n=e("swx-constants").COMMON,r=e("swx-service-locator-instance").default;t.build=function(e){return new i(e)}}),define("experience/api/helpers/contentNavigatorStore",["require","exports","module","lodash-compat","experience/api/helpers/contentNavigator","browser/dom"],function(e,t){function o(){if(s.length>0)return s[0].navigator}var n=e("lodash-compat"),r=e("experience/api/helpers/contentNavigator"),i=e("browser/dom"),s=[];t.add=function(e){var t=i.getElement(e),n=r.build(t);s.push({contentContainer:t,navigator:n})},t.get=function(e){var t=i.getElement(e);return t?n.find(s,function(e){return e.contentContainer===t}).navigator:o()},t.clear=function(){s=[]}}),define("experience/api/helpers/conversation",["require","exports","module","lodash-compat","swx-cafe-application-instance","experience/api/auth/authEventHandler","experience/api/helpers/modality","experience/api/error","swx-utils-chat","swx-enums","swx-constants","telemetry/chat/conversationJoined","experience/api/helpers/conversationsSynchronizer","experience/api/helpers/conversationFacade","experience/settings","swx-service-locator-instance","experience/api/helpers/contentNavigatorStore"],function(e,t){function g(e,t,r){if(!n.isFunction(t))return;try{t(S(e))}catch(i){y(r,m.SUCCESS_CALLBACK_ERROR)}}function y(e,t){n.isFunction(e)&&e(o(t))}function b(e){var t=d.resolve(f.serviceLocator.FEATURE_FLAGS),n;if(!t.isFeatureOn(f.featureFlags.SINGLE_CONVERSATION_MODE))return;i.deferActionOnSplashscreen(function(e){n=d.resolve(f.serviceLocator.PUBSUB),n.publish(f.apiUIEvents.SWX_SINGLE_CONVERSATION,e)},e)}function w(e,t,r){var i=d.resolve(f.serviceLocator.PUBSUB);i.publish(f.apiUIEvents.SWX_CHAT_LOADED);if(!n.isFunction(t))return;try{t(S(e)),b()}catch(s){E(r,m.SUCCESS_CALLBACK_ERROR)}}function E(e,t){if(t instanceof XMLHttpRequest){var n;t.status===0?n="Timeout while joining converstation":n=t.response,t=new Error(n)}try{b(t)}catch(r){}l.get().onJoinConversationError(t),y(e,t)}function S(e){return p.API.version===2?e:h.build(e)}function x(e){var t,n=a.searchScope.All;return t=e.map(function(e){var t=r.get().personsAndGroupsManager.createPersonSearchQuery();return new Promise(function(r,i){function s(){t.results().length?r(t.results(0).result):i()}e.substring(0,4)==="tel:"?(t.sources(n),t.text(e)):t.sources(n).keywords.id=e,t.getMore().then(s,i)})}),Promise.all(t)}var n=e("lodash-compat"),r=e("swx-cafe-application-instance"),i=e("experience/api/auth/authEventHandler"),s=e("experience/api/helpers/modality"),o=e("experience/api/error").asApiError,u=e("swx-utils-chat").conversation,a=e("swx-enums"),f=e("swx-constants").COMMON,l=e("telemetry/chat/conversationJoined"),c=e("experience/api/helpers/conversationsSynchronizer"),h=e("experience/api/helpers/conversationFacade"),p=e("experience/settings"),d=e("swx-service-locator-instance").default,v=e("experience/api/helpers/contentNavigatorStore"),m=f.api.conversation.errorMessages;t.startConversation=function(e,t,n,i,o){function l(e,f){var l=r.get().conversationsManager,c=u.createConversation(e,l,f),h={modalities:t,conversation:c},p=v.get(o);s.startModalities(h,function(){p&&p.navigateToConversation(c),g(c,n,i)},a)}var a=y.bind(null,i),f;if(!Array.isArray(e)){a(m.URI_NOT_VALID);return}if(e.length===0){l([],!0);return}f=p.startConversationMaxParticipantCount,f>0&&e.length>f&&(e=e.slice(0,f));if(p.authentication&&p.authentication.anonymousMode){l(e);return}x(e).then(function(e){l(e)},function(){a(m.SEARCH_FAILED)}).catch(a)},t.joinConversation=function(e,t,i,o,u,a){function d(e){var n={modalities:t,conversation:e,startChatService:!0},r=v.get(a);s.startModalities(n,function(){r&&r.navigateToConversation(e),w(e,i,o)},f)}var f=E.bind(null,o),h=r.get().conversationsManager;if(!n.isString(e)){f(m.URI_NOT_VALID);return}try{r.get().personsAndGroupsManager.mePerson.id.get().then(function(t){l.get().onJoinConversation({uri:e,prefix:t}),c.sync().then(function(){if(u)h._getConversationByUri(e).then(d).catch(f);else{var t=h.getConversationByUri(e);d(t)}}).catch(f)}).catch(f)}catch(p){f(p)}}}),define("experience/api/conversation",["require","exports","module","swx-cafe-application-instance","experience/api/helpers/conversation","experience/api/helpers/modality","swx-utils-chat","swx-constants","constants/components","experience/settings","swx-service-locator-instance","swx-pubsub-instance","experience/api/helpers/contentNavigatorStore","ui/telemetry/telemetryClient"],function(e,t){function p(e,t){return new Promise(function(n,i){function u(t){var r=f.resolve(o.serviceLocator.CONTROLS_BUILDER);r.build(a.controls.content.toLowerCase(),e),n(t)}function l(e){i(e)}var s=t&&t.modalities?t.modalities:null;if(!e){l(o.api.renderConversation.errorMessages.CONTAINER_UNDEFINED);return}if(!(typeof e=="string"||e instanceof Node)){l(o.api.renderConversation.errorMessages.CONTAINER_NOT_ELEMENT_NOT_SELECTOR);return}c.add(e);if(t&&t.conversation){var h=c.get(e);h&&h.navigateToConversation(t.conversation),u(t.conversation);return}if(!t||!t.participants&&!t.conversationId){d(s,e,u,l);return}if(t.participants){Array.isArray(t.participants)?r.startConversation(t.participants,s,u,l,e):l(o.api.renderConversation.errorMessages.PARTICIPANTS_WRONG_FORMAT);return}t.conversationId&&(typeof t.conversationId=="string"?r.joinConversation(t.conversationId,s,u,l,!1,e):l(o.api.renderConversation.errorMessages.CONVERSATION_ID_WRONG_FORMAT))})}function d(e,t,r,o){function l(){var e=c.get(t);e&&e.navigateToConversation(a),r(a)}var u=n.get().conversationsManager,a=s.createConversation([],u,!0),f={modalities:e,conversation:a};i.startModalities(f,l,o)}function v(e,t){var r=n.get().personsAndGroupsManager;if(r._autoBuddyFromInvite)return new Promise(function(n,i){function s(){h.get().sendEvent(a.telemetry.uiTenantToken,o.telemetry.autoBuddy.SUCCESS,{}),n()}r._autoBuddyFromInvite(e,t).then(s,i)})}var n=e("swx-cafe-application-instance"),r=e("experience/api/helpers/conversation"),i=e("experience/api/helpers/modality"),s=e("swx-utils-chat").conversation,o=e("swx-constants").COMMON,u=e("constants/components"),a=e("experience/settings"),f=e("swx-service-locator-instance").default,l=e("swx-pubsub-instance").default,c=e("experience/api/helpers/contentNavigatorStore"),h=e("ui/telemetry/telemetryClient");t.newConversation=function(){var e={page:u.chat.NEW_CONVERSATION,origin:o.telemetry.historyLoadOrigin.NEW_CONVERSATION_API};l.publish(o.events.navigation.NAVIGATE,e)},t.startConversation=function(e,t,n,i){r.startConversation(e,t,n,i)},t.joinConversation=function(e,t,n,i,s){function a(){u.isFeatureOn(o.featureFlags.SYNC_THREAD_BEFORE_JOIN_CONVERSATION_FLOW_ENABLED)?r.joinConversation(e,t,n,i,!0):r.joinConversation(e,t,n,i,!1)}var u=f.resolve(o.serviceLocator.FEATURE_FLAGS);s&&s.inviteId?v(s.inviteId,e).then(a,a):a()},t.renderConversation=function(e,t){return p(e,t)}}),define("notifications/common/browserNativeNotification",["require","exports","module","swx-browser-globals","swx-i18n","swx-constants"],function(e,t){function s(e,t,r){var i,s=n.getWindow(),u,a=e.title()||e.sender.displayName();t.icon=e.sender.avatar(),e.active(!0),i=new s.Notification(a,t),u=e.active.subscribe(function(e){e===!1&&i.close()}),e.sound.play(),e.onshow&&e.onshow(),i.onclick=function(){i.close(),r||(e.open&&e.open(),o()),s.focus()},i.onclose=function(){u&&u.dispose()}}function o(){var e=n.getWindow();e.$WLXIM&&e.$WLXIM.showSidebar()}var n=e("swx-browser-globals"),r=e("swx-i18n").localization,i=e("swx-constants").COMMON;return t.create=function(e){var t=i.notifications,n,o=!1;switch(e.type){case t.CHAT:case t.UNREAD_MESSAGE:case t.CONTACT_REQUEST:n={body:e.description()},s(e,n,o);break;case t.AUDIO_WITHOUT_VIDEO:case t.AUDIO:case t.INCOMING_CALL:n={body:r.fetch({key:"toast_incoming_text_title"})},o=!0,s(e,n,o)}},t}),define("notifications/common/notificationHub",["require","swx-browser-globals","swx-service-locator-instance","swx-constants","utils/common/styleModeHelper","swx-browser-detect","notifications/common/browserNativeNotification"],function(e){function g(){return l.hasFocus()&&i.get().appIsVisible()?!0:!1}function y(){var e=n.resolve(r.serviceLocator.FEATURE_FLAGS);if(c)return;c=!0,e.isFeatureOn(r.featureFlags.ENHANCED_NOTIFICATION)&&(f.addEventListener(r.events.browser.FOCUS,b),f.addEventListener(r.events.browser.BLUR,w))}function b(){function t(){for(var t=0;t<v.length;t++){e=v[t];if(x(e))continue;E(e)}v=[]}var e;h=!0,p?setTimeout(t,a):v=[]}function w(){h=!1}function E(e){var t=n.resolve(r.serviceLocator.FEATURE_FLAGS),s=!i.get().isIntegratedProperty()||!i.get().appIsVisible(),o=e.type===d.UNREAD_MESSAGE||e.type===d.CHAT;if(e.active()===!1)return;if(!t.isFeatureOn(r.featureFlags.ENHANCED_NOTIFICATION)||h||!o){if(o&&i.get().isConsumerIntegrated()&&!s)return;e.active(!0);try{p(e)}catch(a){}e.publishUnreadMessageTelemetry&&s&&e.publishUnreadMessageTelemetry(S(e)),e.onshow&&s&&e.onshow(),e.autoDeactivation&&setTimeout(function(){e.active()&&e.active(!1)},u)}else e.wasDelayed=!0,v.push(e)}function S(e){return{isDelayedNotification:!!e.wasDelayed,notificationQueueLength:v.length,displayType:e.displayType}}function x(e){return e.displayType===r.telemetry.browserToast.displayType.REMINDER||!e.conversation||!e.conversation._consumptionHorizon||!e.activityOccurence?!1:e.conversation._consumptionHorizon.lastReadMessageTimestamp>=e.activityOccurence.getTime()}function T(){return m.areBrowserNotificationsSupported()&&f.Notification.permission===r.permission.GRANTED}var t=e("swx-browser-globals"),n=e("swx-service-locator-instance").default,r=e("swx-constants").COMMON,i=e("utils/common/styleModeHelper"),s=e("swx-browser-detect").default,o=e("notifications/common/browserNativeNotification"),u=7e3,a=100,f=t.getWindow(),l=t.getDocument(),c=!1,h=!0,p,d=r.notifications,v=[],m={};return m.notify=function(e){var t=e.type===d.AUDIO_WITHOUT_VIDEO||e.type===d.AUDIO||e.type===d.INCOMING_CALL;T()?(g()||o.create(e),t&&p&&E(e),e.publishUnreadMessageTelemetry&&!g()&&e.publishUnreadMessageTelemetry(S(e))):p&&E(e)},m.addNotificationListener=function(e){y(),p=e},m.removeNotificationListener=function(){var e=n.resolve(r.serviceLocator.FEATURE_FLAGS);p&&(p=null),c=!1,e.isFeatureOn(r.featureFlags.ENHANCED_NOTIFICATION)&&(f.removeEventListener(r.events.browser.FOCUS,b),f.removeEventListener(r.events.browser.BLUR,w))},m.areBrowserNotificationsSupported=function(){var e=n.resolve(r.serviceLocator.FEATURE_FLAGS);return e.isFeatureOn(r.featureFlags.BROWSER_NATIVE_NOTIFICATIONS_ENABLED)&&!!f.Notification&&s.getBrowserInfo().browserName==="Chrome"&&s.getSystemInfo().osName==="Windows"},m}),define("experience/api/notifications",["require","exports","module","notifications/common/notificationHub"],function(e,t){var n=e("notifications/common/notificationHub");t.setNotificationHandler=function(e){n.addNotificationListener(e)}}),define("utils/chat/unreadConversations",["require","vendor/knockout","swx-cafe-application-instance","utils/common/cafeObservable"],function(e){function s(){function u(n,r){t.utils.addOrRemoveItem(e(),n,!r),e.valueHasMutated()}function a(e){e.__subUnread&&e.__subUnread.dispose();var t=e.historyService.activityItems;t().length&&(e.__subUnread=t(t().length-1).isRead.changed(u.bind(null,e)))}function f(e){e.__subUnreadActivityItems=e.historyService.activityItems.changed(a.bind(null,e))}function l(e){e.__subUnreadActivityItems.dispose()}var e=t.observableArray(),i,s=r.newObservableProperty(n.get().conversationsManager.unreadConversationsCount).extend({rateLimit:300}),o=t.pureComputed({deferEvaluation:!0,read:function(){return i||(n.get().conversationsManager.conversations.added(f),n.get().conversationsManager.conversations.removed(l),i=!0),e()}});return{getUnread:o,getCount:s}}var t=e("vendor/knockout"),n=e("swx-cafe-application-instance"),r=e("utils/common/cafeObservable"),i;return{getInstance:function(){return i||(i=s()),i},destroy:function(){i=null}}}),define("experience/api/calling",["require","vendor/knockout","swx-cafe-application-instance","swx-constants","swx-pubsub-instance","ui/viewModels/calling/helpers/callingFacade","swx-constants","constants/components","swx-enums"],function(e){function h(){p(),d()}function p(){i.subscribe(r.EVENTS.FULLSCREEN_CHANGED,function(e){l(e)})}function d(){n.get().personsAndGroupsManager.mePerson.capabilities.audio.changed(function(e,t){var n=t!==a.callingNotSupportedReasons.PluginNotInstalled;c(n)})}function v(){s.installPlugin("callingApi")}function m(){var e={page:u.calling.SKYPEOUT_PAGE,origin:o.telemetry.historyLoadOrigin.SKYPEOUT_PAGE_API};i.publish(o.events.navigation.NAVIGATE,e)}function g(){return h(),{isPluginInstalled:t.computed(function(){return c()}),openPstnPage:m,startPluginInstall:v,isFullScreen:t.computed(function(){return l()})}}var t=e("vendor/knockout"),n=e("swx-cafe-application-instance"),r=e("swx-constants").CALLING,i=e("swx-pubsub-instance").default,s=e("ui/viewModels/calling/helpers/callingFacade"),o=e("swx-constants").COMMON,u=e("constants/components"),a=e("swx-enums"),f,l=t.observable(!1),c=t.observable(!1);return f={buildApi:g},f}),define("telemetry/authentication/setAuthProvider",["require","exports","module","ui/telemetry/telemetryClient","experience/settings"],function(e,t){function i(){function e(e){var t="setAuthProvider",i={};i.authType=e.authType,i.success=e.hasSucceed,i.implicitSignIn=e.implicitSignIn,i.hostname=location.hostname,e.hasSucceed||(i.error=e.error,e.details&&(i.details=e.details)),n.get().sendEvent(r.telemetry.uiTenantToken,t,i),n.get().setAuthType&&n.get().setAuthType(e.authType)}return{send:e}}var n=e("ui/telemetry/telemetryClient"),r=e("experience/settings");t.build=function(){return new i}}),define("experience/api/authentication",["require","swx-cafe-application-instance","swx-constants","experience/settings","experience/api/auth/linking","experience/api/error","telemetry/authentication/signIn","telemetry/authentication/setAuthProvider","experience/api/auth/authEventHandler","experience/authContext","swx-service-locator-instance","lodash-compat","swx-pubsub-instance","swx-enums"],function(e){function E(){y=!0,a.init()}function S(){y=!1,a.destroy()}function x(e){if(c.isFunction(e))try{e.apply(null,[].slice.call(arguments,1))}catch(t){}}function T(e,t,n){function s(){_(i,e,r),x(t)}function o(t){_(i,e,r,t),x(n,t)}var r=t!==!1,i=u.build();d=!1,v=e,r?(f.get().implicitSignIn=!0,N(s,o)):_(i,e,r)}function N(e,t,n){try{k(O(v),e,t,n)}catch(r){x(t,s(r,"signIn"))}}function C(e,r){function u(){y=!1,f.reset(),o.status(p.onlineStatus.Offline),x(e)}function a(e){f.reset(),x(r,s(e,"signOut"))}var i=t.get().signInManager,o=t.get().personsAndGroupsManager.mePerson;d=!1,i.signOut.enabled()?i.signOut().then(u,a):a(n.api.auth.errorMessages.ALREADY_SIGNED_OUT)}function k(e,i,u,l){function E(){f.reset(),window.clearTimeout(p),x(i)}function S(e){f.reset(),j(e)?D(e,i,u):(x(u,s(e)),a.deferActionOnSplashscreen(function(){h.publish(n.events.auth.SIGNIN_FAILED,e)},e)),d=!0}function T(){P(A(w)),i=null,u=null}function N(){var e=n.api.auth.DEFAULT_SIGNIN_TIMEOUT;return r.authentication&&r.authentication.signInTimeout&&(e=r.authentication.signInTimeout),e}function C(){p||(p=window.setTimeout(T,N()))}function k(){p&&(window.clearTimeout(p),p=undefined)}function O(){window.addEventListener(n.events.browser.FOCUS,C),window.addEventListener(n.events.browser.BLUR,k)}function _(){window.removeEventListener(n.events.browser.FOCUS,C),window.removeEventListener(n.events.browser.BLUR,k)}function P(t){if(b)return;b=!0,k(),_(),M(g,e.type,t,l.isExternalSignIn),t?S(t):E()}var p,v=t.get().signInManager,m=c.defaults(e,{id:r.application.endpointId,version:B()}),g=o.build(),b=!1,w;l=l||{};if(!y){S(new Error(n.api.auth.errorMessages.AUTH_DISABLED));return}if(!v.signIn.enabled()){S(new Error(n.api.auth.errorMessages.ALREADY_SIGNED_IN));return}C(),O(),v.signIn(m).then(function(){P(null)},function(t){P(L(t))},function(t){w=t})}function L(e){var t,r,i,s;e=e||{},m=e.rps_token,g=e.site_name,t=e.reason,r=e.req||e.request,i=e.rsp||e.response,s=new Error(e.error||e.code||e.message||""),a.setErrorType(s),s.details={},t&&(s.details.reason=JSON.stringify(t)),r&&(s.details.request=JSON.stringify(r));if(i){s.details.response=JSON.stringify(i);if(i.status===b||i.data&&i.data.subcode===w)s.name=n.api.auth.errorTypes.TOO_MANY_CONNECTIONS_ERROR}return s}function A(e){var t=new Error(n.silentLogin.errorMessages.TIMED_OUT);return t.jCafeStatus=e,t}function O(e){var i=t.get().signInManager,s,o=r.implicitOAuthParams&&{client_id:r.implicitOAuthParams.client_id}||{};if(e.type===n.api.auth.authProviderType.SKYPE_TOKEN)return c.merge({},o,i.createTokenSignInParameter({getToken:e.getToken,getExpiryTime:e.getExpiryTime}));if(e.type===n.api.auth.authProviderType.IMPLICIT_AUTH)return i.createImplicitOAuthSignInParameter(r.implicitOAuthParams);if(e.type===n.api.auth.authProviderType.PASSWORD)return c.merge({},o,i.createPasswordSignInParameter({username:e.username,password:e.password}));if(e.type===n.api.auth.authProviderType.ANONYMOUS)return s={type:"Anonymous",meeting:e.options.conferenceUri,name:e.options.displayName},e.options.useInternalAnonFlow&&(s.xmscwt=e.options.useInternalAnonFlow),e.options.discoverUri&&(s.root={user:e.options.discoverUri}),s;throw new Error("invalid auth type")}function M(e,t,n,r){var i;i={authType:t,hasSucceed:!0,retry:d,isExternalSignIn:Boolean(r)},n&&(i.hasSucceed=!1,i.error=n.message,i.details=n.details,n.jCafeStatus&&(i.jCafeStatus=n.jCafeStatus)),e.send(i)}function _(e,t,n,r){var i={authType:t.type,hasSucceed:!0,implicitSignIn:n};r&&(i.hasSucceed=!1,i.error=r.message||"Unknown error",r.data&&(i.details=r.data)),e.send(i)}function D(e,t,r){function u(e){return function(){var s={rps_token:m,onSuccess:t,onFailure:r};e===n.api.auth.accountLinking.WELCOME_FLOW&&(s.welcome=!0),e===n.api.auth.accountLinking.INLINE_NEW_USER_FLOW&&(s.createTechnical=!0,s.hidden=!0),P(s),i.start(s)}}var s=u(n.api.auth.accountLinking.WELCOME_FLOW),o=!1;H()&&(s=u(n.api.auth.accountLinking.INLINE_NEW_USER_FLOW),o=!0),a.startAuthFailedFlow(e,s,o)}function P(e){!g||(e.site_name=g)}function H(){var e=l.resolve(n.serviceLocator.FEATURE_FLAGS);return e.isFeatureOn(n.featureFlags.SILENT_LINKING)}function B(){return"{product}({version} - {workload})".replace("{product}",r.productName||"unknown").replace("{version}",r.version||"").replace("{workload}",r.initParams.correlationIds.hostProperty||"unknown")}function j(e){return e&&e.name===n.api.auth.errorTypes.NOT_LINKED}var t=e("swx-cafe-application-instance"),n=e("swx-constants").COMMON,r=e("experience/settings"),i=e("experience/api/auth/linking"),s=e("experience/api/error").asApiError,o=e("telemetry/authentication/signIn"),u=e("telemetry/authentication/setAuthProvider"),a=e("experience/api/auth/authEventHandler"),f=e("experience/authContext"),l=e("swx-service-locator-instance").default,c=e("lodash-compat"),h=e("swx-pubsub-instance").default,p=e("swx-enums"),d,v,m,g,y,b=410,w="LimitExceeded";return{init:E,destroy:S,setAuthProvider:T,signIn:N,signOut:C}}),define("experience/api/events",["require","exports","module","lodash-compat","swx-service-locator-instance","swx-constants"],function(e,t){var n=e("lodash-compat"),r=e("swx-service-locator-instance").default,i=e("swx-constants").COMMON;t.subscribeUI=function(e,t){var s=r.resolve(i.serviceLocator.PUBSUB);if(!n.isString(e)||!n.isFunction(t))throw new TypeError("invalid arguments; expected an event name (String) and callback (Function)");s.subscribe(e,t)}}),define("experience/api/visibility",["require","exports","module","utils/common/appVisibilityProvider"],function(e,t){var n=e("utils/common/appVisibilityProvider");t.setFocus=function(e){n.isVisible(e)}}),define("experience/api/focus",["require","exports","module","utils/common/applicationFocusManager"],function(e,t){var n=e("utils/common/applicationFocusManager");t.restoreFocus=function(){n.tryRestoreFocus()}}),define("experience/api/rendering",["require","exports","module","swx-constants","experience/settings","swx-service-locator-instance","experience/api/helpers/contentNavigatorStore"],function(e,t){function o(e,t,r){var s=i.resolve(n.serviceLocator.CONTROLS_BUILDER);return s.build(e,t,r)}var n=e("swx-constants").COMMON,r=e("experience/settings"),i=e("swx-service-locator-instance").default,s=e("experience/api/helpers/contentNavigatorStore");t.renderContent=function(e,t){s.add(e),o(r.controls.content.toLowerCase(),e,t)},t.renderSidebar=function(e,t){o(r.controls.sidebar.toLowerCase(),e,t)},t.renderMe=function(e,t){o(r.controls.me.toLowerCase(),e,t)}}),define("experience/api/messageFilter",["require","lodash-compat","experience/settings"],function(e){function r(e){if(!t.isFunction(e))throw"Message filter needs to be a valid function object";n.messageFilters.outgoingMessageFilter=e}function i(e){if(!t.isFunction(e))throw"Message filter needs to be a valid function object";n.messageFilters.chatLogMessageFilter=e}var t=e("lodash-compat"),n=e("experience/settings");return{setOutgoingMessageFilter:r,setChatLogMessageFilter:i}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-skypeuri-parser/lib/skypeUriParser",["require","exports","lodash-compat"],e)}(function(e,t){function s(e){if(!o(e))return;var t=a(e),s=t.queryString.split("&"),u=s[0],f=c(s),p,d=l(u);return n.has(r,t.queryString)&&(p=r[t.queryString],d=i.Navigate),{activityType:d,participants:t.resourceIdentifiers,navigationId:p,activityParameters:h(d,f)}}function o(e){return/^skype:\??([a-zA-Z0-9;:_\-\+]){1,}\??[a-zA-Z0-9=?&]*$/i.test(e)}function u(e){return/skype:\??(\S+;?){1,}\??.*/i.test(e)}function a(e){var t=f(e,":"),n=t[0],r=f(t[1],"?"),i=r[0],s=i.split(";").filter(function(e){return e!==""}),o=r[1]||"";return{scheme:n,resourceIdentifiers:s,queryString:o}}function f(e,t){var n=e.indexOf(t);return n>-1?[e.substr(0,n),e.substr(n+1)]:[e]}function l(e){switch(e){case"chat":return i.Chat;default:return i.Call}}function c(e){return e.reduce(function(e,t){var n=t.split("="),r=n[0],i=n[1];return e[r]=i,e},{})}function h(e,t){switch(e){case i.Call:return p(t);case i.Chat:return d(t);default:return null}}function p(e){var t=e.video,n=e.token,r=e.topic,i=e.origin;return{video:t==="true",token:n,topic:r,origin:i}}function d(e){var t=e.topic;return{topic:t}}var n=e("lodash-compat"),r={discoverbots:"swx-discover-agents"},i;(function(e){e[e.Call=0]="Call",e[e.Chat=1]="Chat",e[e.Navigate=2]="Navigate",e[e.Unknown=3]="Unknown"})(i=t.ActivityType||(t.ActivityType={})),t.parse=s,t.isValidSkypeUri=o,t.containsSkypeUri=u}),define("swx-skypeuri-parser",["swx-skypeuri-parser/lib/skypeUriParser"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-ui-navigation/lib/navigation",["require","exports","swx-browser-globals","swx-skypeuri-parser","swx-pubsub-instance","swx-constants","swx-cafe-application-instance","swx-service-locator-instance","swx-utils-chat","swx-enums"],e)}(function(e,t){function l(e,t){var n=u["default"].resolve(s.COMMON.serviceLocator.FEATURE_FLAGS),r=n.isFeatureOn(s.COMMON.featureFlags.SKYPE_URI_NAVIGATION_ENABLED);return r&&e.indexOf("skype:")===0?c(e,t):h(e)}function c(e,t){var n=r.parse(e);if(n)switch(n.activityType){case r.ActivityType.Call:return d(n,t,n.activityParameters.video);case r.ActivityType.Chat:return p(n);case r.ActivityType.Navigate:return v(n)}}function h(e){var t=n.getWindow(),r=t.open();return r.opener=null,r.location.href=e,Promise.resolve()}function p(e){return m(e.participants).then(function(e){if(e.length){var t=a.conversation.createConversation(e,o.get().conversationsManager),n={model:t,origin:e.length===1?s.COMMON.telemetry.navigation.ONE_TO_ONE_CHAT_SKYPE_URI:s.COMMON.telemetry.navigation.GROUP_CHAT_SKYPE_URI};i["default"].publish(s.COMMON.events.navigation.OPEN_CONVERSATION,n)}})}function d(e,t,n){return new Promise(function(r){m(e.participants).then(function(e){var i=e.length===1?s.COMMON.telemetry.navigation.ONE_TO_ONE_CALL_SKYPE_URI:s.COMMON.telemetry.navigation.GROUP_CALL_SKYPE_URI;if(!t||!e.length)r();else{var u=a.conversation.createConversation(e,o.get().conversationsManager);u._conversationIdReady&&u._conversationIdReady.once(!0,function(){t.placeCall(u,n,i).then(r,r)})}})})}function v(e){return m(e.participants).then(function(t){if(!!e.navigationId){var n={page:e.navigationId,origin:s.COMMON.telemetry.historyLoadOrigin.SKYPE_URI};i["default"].publish(s.COMMON.events.navigation.NAVIGATE,n)}})}function m(e){var t=e.map(function(e){var t=o.get().personsAndGroupsManager.createPersonSearchQuery();return new Promise(function(n){function r(){t.results().length&&n(t.results(0).result)}t.sources(f.searchScope.All),t.text(e),t.getMore().then(r)})});return Promise.all(t)}var n=e("swx-browser-globals"),r=e("swx-skypeuri-parser"),i=e("swx-pubsub-instance"),s=e("swx-constants"),o=e("swx-cafe-application-instance"),u=e("swx-service-locator-instance"),a=e("swx-utils-chat"),f=e("swx-enums");t.navigate=l}),define("swx-ui-navigation",["swx-ui-navigation/lib/navigation"],function(e){return e}),define("experience/api/navigation",["require","exports","module","swx-ui-navigation"],function(e,t){var n=e("swx-ui-navigation");t.navigateBySkypeUri=function(t){n.navigate(t)}}),define("experience/api/flagsObservable",["require","exports","module","lodash-compat","swx-constants","vendor/knockout","swx-service-locator-instance","experience/settings"],function(e,t){var n=e("lodash-compat"),r=e("swx-constants").COMMON,i=e("vendor/knockout"),s=e("swx-service-locator-instance").default,o=e("experience/settings");t.expose=function(){function a(e){e===""?o.flags="[]":o.flags=e}var e=i.observable(""),t=s.resolve(r.serviceLocator.PUBSUB),u={read:e,write:a};return t.subscribe(r.events.flags.SET_FLAG,function(t){if(!n.isString(t))throw new TypeError("invalid arguments; expected a flag name (String)");e(t)}),{flags:i.computed(u)}}}),define("experience/api/builder",["require","exports","module","jCafe","swx-cafe-application-instance","experience/api/me","experience/api/contact","experience/api/conversation","experience/api/notifications","utils/chat/unreadConversations","experience/api/calling","experience/api/authentication","experience/api/events","experience/api/visibility","experience/api/focus","experience/api/rendering","experience/settings","experience/api/messageFilter","experience/api/navigation","experience/api/flagsObservable"],function(e,t){function b(e){e.isAvailable=function(){return!0}}function w(e){e.setPluginAutoUpdate=function(e){v.featureFlags.pluginAutoUpdate=e}}function E(e){e.application=n.Application}function S(e){e.subscribeUI=c.subscribeUI}function x(e){e.renderContent=d.renderContent,e.renderSidebar=d.renderSidebar,e.renderMe=d.renderMe}function T(e){e.me=i.expose()}function N(e){e.contact=s.getByUri}function C(e){e.setNotificationHandler=u.setNotificationHandler}function k(e){e.startConversation=o.startConversation,e.joinConversation=o.joinConversation,e.newConversation=o.newConversation}function L(e){e.activity={unreadConversations:a.getInstance().getCount}}function A(e){e.setFocus=h.setFocus}function O(e){e.focus={restoreFocus:p.restoreFocus}}function M(e){e.calling=f.buildApi()}function _(e){l.init(),e.setAuthProvider=l.setAuthProvider,e.signIn=l.signIn,e.signOut=l.signOut}function D(e){e.getVersion=function(){return v.version}}function P(e){e.renderConversation=o.renderConversation}function H(e){e.setAnonymousUserMode=function(e){v.authentication.anonymousMode=!!e}}function B(e){e.UIApplicationInstance=r.get()}function j(e){e.setOutgoingMessageFilter=m.setOutgoingMessageFilter}function F(e){e.setChatLogMessageFilter=m.setChatLogMessageFilter}function I(e){e.flags=y.expose()}function q(e){e.navigateBySkypeUri=g.navigateBySkypeUri}var n=e("jCafe"),r=e("swx-cafe-application-instance"),i=e("experience/api/me"),s=e("experience/api/contact"),o=e("experience/api/conversation"),u=e("experience/api/notifications"),a=e("utils/chat/unreadConversations"),f=e("experience/api/calling"),l=e("experience/api/authentication"),c=e("experience/api/events"),h=e("experience/api/visibility"),p=e("experience/api/focus"),d=e("experience/api/rendering"),v=e("experience/settings"),m=e("experience/api/messageFilter"),g=e("experience/api/navigation"),y=e("experience/api/flagsObservable");t.get=function(){var t={};return v.API.version===1&&(_(t),T(t),N(t),C(t),x(t),k(t),L(t),A(t),O(t),S(t),D(t),M(t),w(t),b(t),I(t),q(t)),v.API.version===2&&(B(t),P(t),H(t),j(t),F(t)),v.API.exposeCafe&&E(t),t}}),define("experience/componentsInitializer",[],function(){function t(t,n,r){function o(){++i===t.length&&(window.clearTimeout(s),n&&(n(),u()))}function u(){t.forEach(function(e){e.load&&e.load()})}function a(){n=null,r("Initialization not completed by timeout period.")}var i=0,s=window.setTimeout(a,e);t.forEach(function(e){e.init(o)})}var e=3e3;return{init:t}}),define("text!views/experience/sidebar.html",[],function(){return'<swx-sidebar data-bind="event: { mousemove: handleUserAction, click: handleUserAction, mousewheel: handleUserAction, keydown: handleUserAction }"></swx-sidebar>\r\n'}),define("text!views/chat/shareDialog.html",[],function(){return'<div id="swx-share-dialog" data-bind="css:{ \'swx-hide\': isHidden }">\r\n    <div id="top-bar">\r\n        <div id="title-holder">\r\n            <span id="title"\r\n                  data-bind="l10n: { \'key\': \'share_on_skype_dialog_title\'}">\r\n            </span>\r\n        </div>\r\n    </div>\r\n\r\n    <div id="lower-pane">\r\n\r\n        <div id="link-preview-placeholder"></div>\r\n\r\n        <div class="conversationControl chat themeLight">\r\n            <swx-chat-input\r\n                class="input"\r\n                data-bind="css: { showCover: false, hide: false }"\r\n                params="conversationModel: null,\r\n                        alwaysHideExpressionPicker: true">\r\n            </swx-chat-input>\r\n        </div>\r\n\r\n        <div class="shareButtonHolder">\r\n            <swx-button params="cssClass: \'primary circle\',\r\n                                disabled: !shareButtonEnabled,\r\n                                textKey: \'share_on_skype_share_button\',\r\n                                titleKey: \'share_on_skype_share_button\',\r\n                                action: share">\r\n            </swx-button>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("utils/common/eventMixin",["require","lodash-compat","swx-log-tracer"],function(e){function r(){this.listeners=null,this._disposeExtended=!1,this._parentContext=null,this._childrenContexts=null}function i(e,t,n){return e.filter(function(e){return e.callback===t&&e.context===n})[0]}function s(e,t){e.splice(e.indexOf(t),1)}function o(e,t,n,r){var i=e&&e.listeners&&e.listeners[t],s=!1;return i?(i.forEach(function(e){e.direction&n&&(e.callback.call(e.context,r),s=!0)}),s):!1}function u(e){if(e._disposeExtended)return;var t=e.dispose;e.dispose=function(){t&&t.call(e),e.disposeEvents()},e._disposeExtended=!0}var t=e("lodash-compat"),n=e("swx-log-tracer").getLogger();return r.prototype.DIRECTION={PARENT:1,CHILD:2,ANY:3},r.prototype.dispatchEvent=function(t,i,s){var u=!1;return t?(s=s||r.DIRECTION.ANY,s&r.DIRECTION.PARENT&&(this._parentContext||n.error("Dispatching to parent, but parent context wasn't set !"),u=o(this._parentContext,t,r.DIRECTION.CHILD,i)),s&r.DIRECTION.CHILD&&this._childrenContexts&&this._childrenContexts.forEach(function(e){u=o(e,t,r.DIRECTION.PARENT,i)||u}),u):!1},r.prototype.addChildContext=function(t){this._childrenContexts=this._childrenContexts||[],this._childrenContexts.push(t),u(this)},r.prototype.removeChildContext=function(t){if(this._childrenContexts){var n=this._childrenContexts.indexOf(t);n!==-1&&this._childrenContexts.splice(n,1)}},r.prototype.setContext=function(t){this._parentContext=t,this._parentContext.addChildContext&&this._parentContext.addChildContext(this),u(this)},r.prototype.disposeEvents=function(){this.listeners=null,this._childrenContexts=null,this._parentContext&&this._parentContext.removeChildContext&&this._parentContext.removeChildContext(this),this._parentContext=null},r.prototype.registerEvent=function(t,n,o,a){var f,l,c;return!t||!n?null:(u(this),this.listeners=this.listeners||{},this.listeners[t]=this.listeners[t]||[],f=this.listeners[t],(o&r.DIRECTION.ANY)===0&&(a=o,o=r.DIRECTION.ANY),o=o||r.DIRECTION.ANY,l=i(f,n,a),l?null:(c={callback:n,direction:o,context:a},f.push(c),{dispose:function(){s(f,c)}}))},r.prototype.forwardEvent=function(t,n,i,s,o){(s&r.DIRECTION.ANY)===0&&(o=s,s=r.DIRECTION.ANY),this.registerEvent(t,function(e){i&&i.call(o,e),this.dispatchEvent(t,e,n,o)},s,this)},t.assign(r,r.prototype),r}),define("ui/viewModels/chat/shareDialog",["require","exports","module","lodash-compat","vendor/knockout","swx-constants","utils/common/eventMixin","swx-cafe-application-instance"],function(e,t){function u(e,t){function a(){return s.chatInputAsync.then(function(e){f().then(function(t){var r=e();n.forEach(t,function(e){l(e,r)})})})}function f(){var e=o.get().conversationsManager,t,r=e.conversations();return r.length>0?(t=n.max(r,function(e){return e.lastModificationTimestamp()}),Promise.resolve([t])):e.getMoreConversations.enabled()?e.getMoreConversations(1).then(function(){return[n.first(e.conversations())]}):Promise.resolve([])}function l(e,t){var n=e.chatService;t=t.trim(),t.length>0&&n.sendMessage(t),s.sharedUrl&&n.sendMessage(s.sharedUrl)}var s=this,u=[];s.sharedUrl=e,s.flowId=t,s.isHidden=r.observable(!0),s.show=function(){s.isHidden(!1)},s.dispose=function(){},s.shareButtonEnabled=r.observable(!0),s.chatInputAsync=new Promise(function(e){s.registerEvent(i.textarea.INITIALIZATION_COMPLETE,function(n){e(n.messageBody)})}),s.share=function(){var e=a();return u.push(e),e.then(function(){u.remove(e)}),e},s.whenAllSharingOpsCompleted=function(){return Promise.all(u)}}var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("swx-constants").COMMON.events,s=e("utils/common/eventMixin"),o=e("swx-cafe-application-instance");n.assign(u.prototype,s),t.build=function(e,t){return new u(e,t)}}),define("ui/controls/experience/shareDialogController",["require","exports","module","vendor/knockout","browser/dom","browser/window","swx-constants","swx-service-locator-instance","text!views/chat/shareDialog.html","ui/viewModels/chat/shareDialog"],function(e,t){function c(){h();var e=p(),t=a.build(e.sharedUrl,e.flowId),r=d();n.applyBindings(t,r),t.show()}function h(){var e=r.getElement("#"+l);if(e)throw new Error("Internal API error: Share Dialog should not be launched more than once")}function p(){var e=t.getRawQueryString()||"";e=e.replace(/^\??/,"");var n=e.split("&"),r={};for(var i=0;i<n.length;i++){var s=n[i].split("="),o=decodeURIComponent(s[0]||"").toLowerCase(),u=decodeURIComponent(s[1]||""),a=r[o];a||(a=[],r[o]=a),a.push(u)}return{sharedUrl:(r.sharedurl||[])[0],flowId:(r.flowid||[])[0]}}function d(){var e=r.createElement("div");e.innerHTML=u;var t=e.firstChild,n=r.getElement(f);return n.appendChild(t),t}var n=e("vendor/knockout"),r=e("browser/dom"),i=e("browser/window"),s=e("swx-constants").COMMON,o=e("swx-service-locator-instance").default,u=e("text!views/chat/shareDialog.html"),a=e("ui/viewModels/chat/shareDialog"),f=".swx",l="swx-share-dialog";t.getRawQueryString=function(){return i.location.search},t.conditionallyLaunchSharingExperience=function(){var e=o.resolve(s.serviceLocator.FEATURE_FLAGS),t=e.isFeatureOn(s.featureFlags.SHOW_ALTERNATE_SHARE_DIALOG_EXPERIENCE);t&&c()}}),define("utils/common/resizeHandler",["require","browser/dom"],function(e){function i(e){function o(){t.removeClass(e,r),clearTimeout(s),s=null}if(!e)throw new Error("Container must not be null");var i=this,s=null;i.resize=function(){s?clearTimeout(s):t.addClass(e,r),s=setTimeout(o,n)},i.dispose=function(){o()}}var t=e("browser/dom"),n=500,r="RESIZING";return i}),define("ui/viewModels/experience/sidebar",["require","lodash-compat","swx-cafe-application-instance","vendor/knockout","browser/window","swx-utils-common","swx-constants","swx-service-locator-instance","utils/common/styleModeHelper","utils/common/resizeHandler"],function(e){function y(e){function O(e){e(v.NAVIGATE,I),e(v.OPEN_CONVERSATION,I),e(d.SHOW_SIDEBAR,y.slideIn),e(d.HIDE_SIDEBAR,y.slideOut),e(g.MENU_SHOWN,j),e(g.MENU_HIDDEN,F)}function M(e){e(m.QUERY_CHANGED,H),e(m.RESET,B),e(m.INPUT_FOCUS,D),e(m.INPUT_BLUR,P)}function D(){T=!0,y.expand()}function P(e){T=!1,e===0&&y.collapse(y)}function H(e){e?N=!0:!e&&T?N=!1:I()}function B(){T&&(N=!1)}function j(){i.clearTimeout(L),C=!0}function F(e){C=!1,e||y.collapse()}function I(){T=!1,N=!1,C=!1,y.collapse(),i.clearTimeout(L)}function q(){!y.isExpanded()&&(N||T)&&y.expand(),A.resize()}function R(e){i.clearTimeout(L),e.timeout?L=i.setTimeout(y.isExpanded.bind(y,e.expanded),e.timeout):y.isExpanded(e.expanded)}function U(e){i.clearTimeout(k),k=i.setTimeout(y.showTooltips.bind(y,e),p)}function z(e){w.publish(d.SIDEBAR_STATE_CHANGED,e)}function W(e){O(e?w.subscribe.bind(w):w.unsubscribe.bind(w)),!e&&y.isExpanded()&&y.isExpanded(!1)}function X(e){C?i.clearTimeout(L):e()}function V(e){return function(){y.isActive()&&e.apply(y,arguments)}}var y=this,b=n.get(),w=u.resolve(o.serviceLocator.PUBSUB),E,S,x,T=!1,N=!1,C=!1,k=0,L=0,A;y.isActive=r.pureComputed(function(){return a.get().currentMode()===o.styleMode.NARROW}),y.isExpanded=r.observable(!1),y.showTooltips=r.observable(!1),y.showPreSlideClass=r.observable(!1),y.addSlideInClass=r.observable(!1),y.addSlideOutClass=r.observable(!1),y.init=function(){S=y.isActive.subscribe(W),x=y.isExpanded.subscribe(z),M(w.subscribe.bind(w)),E=t.debounce(q,l),i.addEventListener(o.events.browser.RESIZE,E),A=new f(e),s.execute(q),y.isActive()&&O(w.subscribe.bind(w))},y.dispose=function(){A.dispose(),S.dispose(),x.dispose(),O(w.unsubscribe.bind(w)),M(w.unsubscribe.bind(w)),i.removeEventListener(o.events.browser.RESIZE,E)},y.expand=V(function(e){function t(){y.isExpanded()||U(!0),R({expanded:!0,timeout:e&&h})}X(t)}),y.collapse=V(function(e){function t(){T||(U(!1),N||R({expanded:!1,timeout:e&&c}))}X(t)}),y.slideIn=V(function(){y.addSlideInClass(!0),y.addSlideOutClass(!1)}),y.slideOut=V(function(){y.addSlideInClass(!1),y.addSlideOutClass(!0)}),y.slideTransitionEnded=function(){w.publish(d.SIDEBAR_TRANSITION_ENDED)},y.handleUserAction=function(){return b.isEndpointActive&&b.isEndpointActive.set(!0),!0}}var t=e("lodash-compat"),n=e("swx-cafe-application-instance"),r=e("vendor/knockout"),i=e("browser/window"),s=e("swx-utils-common").async,o=e("swx-constants").COMMON,u=e("swx-service-locator-instance").default,a=e("utils/common/styleModeHelper"),f=e("utils/common/resizeHandler"),l=1e3,c=500,h=500,p=c,d=o.events.narrowMode,v=o.events.navigation,m=o.events.search,g=o.events.contextMenu;return y}),define("ui/controls/experience/sidebar",["require","exports","module","vendor/knockout","browser/dom","text!views/experience/sidebar.html","ui/controls/experience/shareDialogController","ui/viewModels/experience/sidebar","utils/common/styleModeHelper","swx-constants","lodash-compat","swx-service-locator-instance"],function(e,t){function p(e){return e&&f.has(e,"sidebarPosition")&&f.isString(e.sidebarPosition)&&e.sidebarPosition.toLowerCase()===a.sidebar.position.LEFT}function d(e){return a.sidebar.cssClasses[p(e)?"SLIDE_LEFT_TO_RIGHT":"SLIDE_RIGHT_TO_LEFT"]}function v(e){function n(){e.parentElement.style.display="none"}var t=l.resolve(a.serviceLocator.PUBSUB);t.subscribe(a.apiUIEvents.SWX_TIMELINE_LOADED,n)}function m(e){var t;return e.setAttribute("data-bind",g()),r.addClass(e,h),t=new o(e),t.init(),t}function g(){function t(){var t=["mouseover: expand","mouseout: collapse"].join(e);return"event:{"+t+"}"}function n(){var t=["active: isExpanded()","inactive: !isExpanded()","showTooltips: showTooltips()","slideIn: addSlideInClass()","slideOut: addSlideOutClass()"].join(e);return"css:{"+t+"}"}function r(){var t=['transitionEnd: {callback: slideTransitionEnded, moreElementsToWatch: ["aside.sideContainer"]}'].join(e);return t}var e=",";return[t(),n(),r()].join(e)}var n=e("vendor/knockout"),r=e("browser/dom"),i=e("text!views/experience/sidebar.html"),s=e("ui/controls/experience/shareDialogController"),o=e("ui/viewModels/experience/sidebar"),u=e("utils/common/styleModeHelper"),a=e("swx-constants").COMMON,f=e("lodash-compat"),l=e("swx-service-locator-instance").default,c="side themeWhite",h="inactive";t.name="sidebar",t.render=function(e,t){var o=r.createElement("div"),f=l.resolve(a.serviceLocator.FEATURE_FLAGS);o.className=c,r.addClass(o,d(e)),o.innerHTML=i,f.isFeatureOn(a.featureFlags.HIDE_SIDEBAR_ON_START)&&v(o),n.applyBindings(m(o),o),t(o),s.conditionallyLaunchSharingExperience(),u.get().addContainer(o)}}),define("text!views/experience/content.html",[],function(){return'<swx-notification-box></swx-notification-box>\r\n<swx-navigation></swx-navigation>\r\n\r\n<!-- content overlay used for masking chat area when sidebar is expanded -->\r\n<span class="swxContentOverlay" data-bind="css: { active: showOverlay }, click: hideOverlay"></span>\r\n\r\n<!-- named templates for various message types contents -->\r\n<script type="text/html" id="pictureMessageContentTemplate">\r\n    <p class="PictureSharing">\r\n        <a class="thumbnailHolder"\r\n           data-bind="click: open, attr: {href: pictureUrl}, l10n_attr: {\'aria-label\': \'media_picturesharing_label\', \'title\': \'media_picturesharing_label\'}"\r\n           target="_blank" tabindex="-1">\r\n\r\n            <span class="pictureIcon">\r\n                <span class="iconfont picture"></span>\r\n            </span>\r\n\r\n            <!-- ko if: hasFailed -->\r\n            <span class="failedIcon">\r\n                <span class="iconfont errorSad"></span>\r\n            </span>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: isPending -->\r\n            <span class="progressIndicatorContainer">\r\n                <span class="progressIndicator" data-bind="style: {backgroundImage: progressIndicatorBG}"></span>\r\n                <span class="fill"></span>\r\n            </span>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: thumbnailUrl -->\r\n            <span class="thumbnail" data-bind="style: { backgroundImage: \'url(\\\'\' + thumbnailUrl() + \'\\\')\' }"></span>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko ifnot: thumbnailUrl -->\r\n            <span class="thumbnail" style="display:none"></span>\r\n            <!-- /ko -->\r\n        </a>\r\n        <span class="offScreen" data-bind="text: content"></span>\r\n    </p>\r\n    <!-- ko if: reactionsVM.enabled && reactionsVM.reactionsCount() > 0 -->\r\n    <div class="reactionsBar">\r\n        <span data-bind="foreach: {data: reactionsVM.reactions(), as: \'reaction\'}">\r\n            <!-- ko if: reaction.key !== $parent.reactionsVM.dummyReaction -->\r\n            <span class="reactionItem">\r\n                <span class="emoticon" data-bind="\r\n                    attr: {\r\n                        title: $parent.reactionsVM.getUserListNames(reaction.key)\r\n                    },\r\n                    style: {\r\n                        \'background-image\' : $parent.reactionsVM.getEmoticonUrl(reaction.key)\r\n                    },\r\n                    css: {highDpi: $parent.reactionsVM.showHighDpiClass}">\r\n                </span>\r\n                <span class="counter smaller" data-bind="text: reaction.users.length"></span>\r\n            </span>\r\n            <!-- /ko -->\r\n        </span>\r\n    </div>\r\n    <!-- /ko -->\r\n</script>\r\n\r\n<script type="text/html" id="contactInfoMessageContentTemplate">\r\n    <span class="offScreen" data-bind="text: content"></span>\r\n    <div class ="contactsList" data-bind="foreach: contacts">\r\n        <div class="contact clickable">\r\n            <!--ko ifnot: ($parent.isMePersonContactMessage(name()) || $parent.isPSTNContactMessage(name())) -->\r\n            <a class="avatarLink" data-bind="click: $parent.openConversationWithUser.bind(this, name()), attr: {title: titleKey}" role="button">\r\n                <swx-avatar params="avatar: avatar, isFullSize: true, displayName: fullName"></swx-avatar>\r\n            </a>\r\n            <!-- /ko -->\r\n            <!--ko if: ($parent.isMePersonContactMessage(name()) && !$parent.isPSTNContactMessage(name())) -->\r\n            <swx-avatar params="avatar: avatar, isFullSize: true, displayName: fullName"></swx-avatar>\r\n            <!-- /ko -->\r\n            <!--ko if: (!$parent.isMePersonContactMessage(name()) && $parent.isPSTNContactMessage(name())) -->\r\n            <span class="iconfont callStart pstn"></span>\r\n            <!-- /ko -->\r\n            <div class="info">\r\n                <!--ko if: $parent.contactHasFullName(name()) -->\r\n                <div class="fullName" data-bind="css: {pstn: $parent.isPSTNContactMessage(name())}">\r\n                    <span class="strong fontSize-p" data-bind="text: fullName"></span>\r\n                </div>\r\n                <!-- /ko -->\r\n                <!--ko ifnot: $parent.isPSTNContactMessage(name()) -->\r\n                <div class="name">\r\n                    <span class="fontSize-p" data-bind="text: name"></span>\r\n                </div>\r\n                <!--ko ifnot: $parent.isMePersonContactMessage(name()) -->\r\n                <div class="action">\r\n                    <a role="button" class="actionLink clickable" data-bind="click: $parent.openConversationWithUser.bind(this, name()), l10n: {key: actionKey}" tabindex="-2">\r\n                    </a>\r\n                </div>\r\n                <!-- /ko -->\r\n                <!-- /ko -->\r\n            </div>\r\n        </div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="fileTransferMessageContentTemplate">\r\n    <p data-bind="css:typeClasses" data-bind="css:{aborted:isAborted}" class="FileTransfer">\r\n        <span class="icon iconfont file" data-bind="css:iconClasses"></span>\r\n\r\n        <span class="filename" data-bind="text:fileName"></span>\r\n\r\n        <!-- ko if: isAborted -->\r\n        <span class="aborted iconfont cancel" data-bind="l10n_attr: {\'title\': \'file_transfer_upload_canceled\' }"></span>\r\n        <span class="errorMessage" data-bind="l10n: {\'key\': \'file_transfer_upload_canceled\' }, l10n_attr: {\'title\':\'file_transfer_upload_canceled\'}, l10n_attr:{\'aria-label\':\'file_transfer_upload_canceled\'}"></span>\r\n        <span class="filesize" data-bind="text:fileSize"></span>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko ifnot: isAborted -->\r\n        <span class="filesize" data-bind="text:fileSize"></span>\r\n        <swx-filetransfer-activity-actions params="message:$data, onabort:abortUploading"></swx-filetransfer-activity-actions>\r\n        <!-- /ko -->\r\n    </p>\r\n\r\n    <!-- ko if: reactionsVM.enabled && reactionsVM.reactionsCount() > 0 -->\r\n    <div class="reactionsBar">\r\n        <span data-bind="foreach: {data: reactionsVM.reactions(), as: \'reaction\'}">\r\n            <!-- ko if: reaction.key !== $parent.reactionsVM.dummyReaction -->\r\n            <span class="reactionItem">\r\n                <span class="emoticon" data-bind="\r\n                    attr: {\r\n                        title: $parent.reactionsVM.getUserListNames(reaction.key)\r\n                    },\r\n                    style: {\r\n                        \'background-image\' : $parent.reactionsVM.getEmoticonUrl(reaction.key)\r\n                    },\r\n                    css: {highDpi: $parent.reactionsVM.showHighDpiClass}">\r\n                </span>\r\n                <span class="counter smaller" data-bind="text: reaction.users.length"></span>\r\n            </span>\r\n            <!-- /ko -->\r\n        </span>\r\n    </div>\r\n    <!-- /ko -->\r\n</script>\r\n\r\n<script type="text/html" id="videoMessageContentTemplate">\r\n    <div class="video-message">\r\n\r\n        <div class="media-holder" data-bind="css: orientationClass">\r\n            <div class="media-content">\r\n\r\n                <div class="videoIcon">\r\n                    <span class="iconfont videomail"></span>\r\n                </div>\r\n\r\n                <!-- ko if: hasFailed -->\r\n                <span class="failedIcon">\r\n                    <span class="iconfont errorSad"></span>\r\n                </span>\r\n                <!-- /ko -->\r\n\r\n                <!-- ko if: isLoaded() & !isPlaying() -->\r\n                <div class="thumbnail" data-bind="click: play, style: { backgroundImage: \'url(\\\'\' + thumbnailUrl + \'\\\')\' }"></div>\r\n                <a href="#" class="iconfont play playButton" data-bind="click: play, l10n_attr: { \'aria-label\': \'media_clicktoplay\' }" role="button" tabindex="-1"></a>\r\n                <!-- /ko -->\r\n\r\n                <!-- ko if: isPlaying -->\r\n                <swx-video-player params="media: mediaUrl, thumbnail: thumbnailUrl, autoplay: true, displayCurrentTime: true, displayTotalTime: true, messageId: $parent.clientmessageid, conversationId: $parent.conversationId"></swx-video-player>\r\n                <!-- /ko -->\r\n            </div>\r\n        </div>\r\n\r\n        <!-- ko if: hasExpired -->\r\n        <p class="errorMessage" data-bind="l10n: { key: \'media_videomessage_expired\' }"></p>\r\n        <!-- /ko -->\r\n    </div>\r\n\r\n    <!-- ko if: reactionsVM.enabled && reactionsVM.reactionsCount() > 0 -->\r\n    <div class="reactionsBar">\r\n        <span data-bind="foreach: {data: reactionsVM.reactions(), as: \'reaction\'}">\r\n            <!-- ko if: reaction.key !== $parent.reactionsVM.dummyReaction -->\r\n            <span class="reactionItem">\r\n                <span class="emoticon" data-bind="\r\n                    attr: {\r\n                        title: $parent.reactionsVM.getUserListNames(reaction.key)\r\n                    },\r\n                    style: {\r\n                        \'background-image\' : $parent.reactionsVM.getEmoticonUrl(reaction.key)\r\n                    },\r\n                    css: {highDpi: $parent.reactionsVM.showHighDpiClass}">\r\n                </span>\r\n                <span class="counter smaller" data-bind="text: reaction.users.length"></span>\r\n            </span>\r\n            <!-- /ko -->\r\n        </span>\r\n    </div>\r\n    <!-- /ko -->\r\n</script>\r\n\r\n<script type="text/html" id="audioMessageContentTemplate">\r\n    <div class="audio-message">\r\n        <!-- ko ifnot: hasExpired -->\r\n        <div class="media-holder">\r\n            <div class="media-content">\r\n\r\n                <div class="audioIcon">\r\n                    <span class="iconfont audiomail"></span>\r\n                </div>\r\n\r\n                <!-- ko if: hasFailed -->\r\n                <span class="failedIcon">\r\n                    <span class="iconfont errorSad"></span>\r\n                </span>\r\n                <!-- /ko -->\r\n                <!-- ko if: isLoaded() & !isPlaying() -->\r\n                <a href="#" class="iconfont play playButton" data-bind="click: play, l10n_attr: { \'aria-label\': \'media_clicktoplay\' }" role="button" tabindex="-1"></a>\r\n                <span class="voiceMessage" data-bind="l10n: { key: \'media_voice_message\' }"></span>\r\n\r\n                <!-- /ko -->\r\n                <!-- ko if: isPlaying -->\r\n                <swx-audio-player params="media: mediaUrl, autoplay: true, messageId: $parent.messageId, conversationId: $parent.conversationId"></swx-audio-player>\r\n                <!-- /ko -->\r\n            </div>\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: hasExpired -->\r\n        <p data-bind="l10n: { key: \'media_audiomessage_expired\' }"></p>\r\n        <!-- /ko -->\r\n    </div>\r\n\r\n    <!-- ko if: reactionsVM.enabled && reactionsVM.reactionsCount() > 0 -->\r\n    <div class="reactionsBar">\r\n        <span data-bind="foreach: {data: reactionsVM.reactions(), as: \'reaction\'}">\r\n            <!-- ko if: reaction.key !== $parent.reactionsVM.dummyReaction -->\r\n            <span class="reactionItem">\r\n                <span class="emoticon" data-bind="\r\n                    attr: {\r\n                        title: $parent.reactionsVM.getUserListNames(reaction.key)\r\n                    },\r\n                    style: {\r\n                        \'background-image\' : $parent.reactionsVM.getEmoticonUrl(reaction.key)\r\n                    },\r\n                    css: {highDpi: $parent.reactionsVM.showHighDpiClass}">\r\n                </span>\r\n                <span class="counter smaller" data-bind="text: reaction.users.length"></span>\r\n            </span>\r\n            <!-- /ko -->\r\n        </span>\r\n    </div>\r\n    <!-- /ko -->\r\n</script>\r\n\r\n<script type="text/html" id="mojiMessageContentTemplate">\r\n    <p data-bind="css: typeClasses">\r\n        <span class="mojiContent">\r\n            <span class="mojiplaceholder"></span>\r\n            <img class="mojithumbnail" data-bind="attr: { src: mojiThumbnailUrl}" alt="" role="presentation"\r\n                 aria-hidden="true"/>\r\n            <video class="moji" data-bind="css: {hide: !isMojiPlaying()}, attr: { src: mojiUrl }"></video>\r\n            <span class="mojimask" data-bind="click: stopMojiPlay"></span>\r\n            <a href="#" class="actionButtons iconfont play mojiplay clickable"\r\n               data-bind="css: {hide: isMojiPlaying}, click: playMoji,\r\n                          l10n_attr: { \'aria-label\': \'pes_moji_playbutton_label\' }"\r\n               role="button" tabindex="-1"></a>\r\n        </span>\r\n        <span class="mojitext" data-bind="visible: isMojiPlayed()">\r\n            <span class="mojiTitle" data-bind="css: {hide: !mojiTitle() && mojiTitle() === \'\'}, text: mojiTitle"></span>\r\n            <span class="mojiLink">\r\n                <a data-bind="css: {hide: !mojiLinkName() && mojiLinkName() === \'\'}, text: mojiLinkName,\r\n                              attr: {href: mojiLinkUrl}"\r\n                   target="_blank" tabindex="-1"></a>\r\n            </span>\r\n            <span class="mojiCopyright"\r\n                  data-bind="css: {hide: !mojiCopyright() || mojiCopyright() === \'\'}, text: mojiCopyright"></span>\r\n        </span>\r\n        <span class="moji-error-state ">\r\n            <span class="icon iconfont flikDeletedStroke"></span>\r\n            <span class="text" data-bind="text: mojiErrorText"></span>\r\n        </span>\r\n    </p>\r\n\r\n    <!-- ko if: reactionsVM.enabled && reactionsVM.reactionsCount() > 0 -->\r\n    <div class="reactionsBar">\r\n        <span data-bind="foreach: {data: reactionsVM.reactions(), as: \'reaction\'}">\r\n            <!-- ko if: reaction.key !== $parent.reactionsVM.dummyReaction -->\r\n            <span class="reactionItem">\r\n                <span class="emoticon" data-bind="\r\n                    attr: {\r\n                        title: $parent.reactionsVM.getUserListNames(reaction.key)\r\n                    },\r\n                    style: {\r\n                        \'background-image\' : $parent.reactionsVM.getEmoticonUrl(reaction.key)\r\n                    },\r\n                    css: {highDpi: $parent.reactionsVM.showHighDpiClass}">\r\n                </span>\r\n                <span class="counter smaller" data-bind="text: reaction.users.length"></span>\r\n            </span>\r\n            <!-- /ko -->\r\n        </span>\r\n    </div>\r\n    <!-- /ko -->\r\n</script>\r\n\r\n<script type="text/html" id="textMessageContentTemplate">\r\n    <!-- ko if: isCopySelectionAsQuoteEnabled -->\r\n    <p data-bind="html: content, css: typeClasses, visible: !translationItem.visible(), click: $parent.messageClicked.bind(this), event: {copy: onCopy}"></p>\r\n    <!-- /ko -->\r\n\r\n     <!-- ko if: !isCopySelectionAsQuoteEnabled -->\r\n    <p data-bind="html: content, css: typeClasses, visible: !translationItem.visible(), click: $parent.messageClicked.bind(this)"></p>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: translationItem.isEnabled -->\r\n    <p data-bind="html: translationItem.translationText, visible: translationItem.visible()"></p>\r\n    <p><a href="#" role="button" data-bind="text: translationItem.toggleText, attr: {title: translationItem.toggleText, \'aria-label\': translationItem.toggleText}, click: translationItem.toggle"></a></p>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: reactionsVM.enabled && reactionsVM.reactionsCount() > 0 -->\r\n    <div class="reactionsBar">\r\n        <span data-bind="foreach: {data: reactionsVM.reactions(), as: \'reaction\'}">\r\n            <!-- ko if: reaction.key !== $parent.reactionsVM.dummyReaction -->\r\n            <span class="reactionItem">\r\n                <span class="emoticon" data-bind="\r\n                    attr: {\r\n                        title: $parent.reactionsVM.getUserListNames(reaction.key)\r\n                    },\r\n                    style: {\r\n                        \'background-image\' : $parent.reactionsVM.getEmoticonUrl(reaction.key)\r\n                    },\r\n                    css: {highDpi: $parent.reactionsVM.showHighDpiClass}">\r\n                </span>\r\n                <span class="counter smaller" data-bind="text: reaction.users.length"></span>\r\n            </span>\r\n            <!-- /ko -->\r\n        </span>\r\n    </div>\r\n    <!-- /ko -->\r\n</script>\r\n\r\n\r\n<script type="text/html" id="callingMessageContentTemplate">\r\n    <p data-bind="html: content, css: typeClasses"></p>\r\n    <p class="liveSessionDuration small" data-bind="html: liveSessionDuration"></p>\r\n</script>\r\n\r\n<script type="text/html" id="ngcUpgradeMessageContentTemplate">\r\n    <p data-bind="html: content, css: typeClasses"></p>\r\n</script>\r\n\r\n<script type="text/html" id="pluginFreeMessageContentTemplate">\r\n    <p data-bind="html: content, css: typeClasses"></p>\r\n</script>\r\n\r\n<script type="text/html" id="pstnMessageContentTemplate">\r\n    <p data-bind="css: typeClasses"><span data-bind="html: content, click: addCreditTelemetry"></span><a data-bind="click: navigateToDialPad, visible: linkVisible" class="clickable"> <span data-bind="html: linkContent"></span></a></p>\r\n</script>\r\n\r\n<script type="text/html" id="contactRequestIncomingMessageContentTemplate">\r\n    <p data-bind="css: typeClasses">\r\n        <swx-avatar params="avatar: author.avatar, isAgent: author.isAgent, displayName: author.displayName, isPstn: author.isPstn, size: 65"></swx-avatar>\r\n    </p>\r\n    <div class="contactRequestMessage contactRequestIncomingMessage">\r\n        <p data-bind="l10n: { key: \'message_text_contactRequestIncomingMessage\', params: { displayName: author.displayName } }"></p>\r\n\r\n        <p data-bind="html: greeting"></p>\r\n\r\n        <p data-bind="html: setTimestamp" class="timestamp"></p>\r\n    </div>\r\n    <div class="triple buttonRow">\r\n        <div class="column">\r\n            <button type="button" class="btn primary clickable contactRequestAccept"\r\n                    data-bind="click: acceptContactRequest, disable: actionInProgress, css: { \'in-progress\': actionInProgress }, focusHandler: { priority: 1, callback: focusHandlerCallback }" tabindex="-1"><span\r\n                data-bind="l10n: { key: \'message_text_contactRequestAcceptAction\' }"></span></button>\r\n        </div>\r\n        <div class="column">\r\n            <button type="button" class="btn secondary clickable contactRequestDecline"\r\n                    data-bind="click: declineContactRequest, disable: actionInProgress, css: { \'in-progress\': actionInProgress }" tabindex="-1"><span\r\n                data-bind="l10n: { key: \'message_text_contactRequestDeclineAction\' }"></span></button>\r\n        </div>\r\n        <div class="column">\r\n            <button type="button" class="btn secondary clickable contactRequestBlock"\r\n                    data-bind="click: blockContactRequest, disable: actionInProgress, css: { \'in-progress\': actionInProgress }" tabindex="-1"><span\r\n                data-bind="l10n: { key: \'action_button_block\' }"></span></button>\r\n        </div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="contactRequestIncomingInviteFreeMessageContentTemplate">\r\n    <p class="contactRequestResendMessage" data-bind="css: typeClasses"><span\r\n        data-bind="html: content"></span>\r\n        <a data-bind="l10n: { key: \'invite_free_block_person\' }, click: blockContactRequest"\r\n           class="clickable" tabindex="-1"></a></p>\r\n</script>\r\n\r\n<script type="text/html" id="contactRequestOutgoingMessageContentTemplate">\r\n    <!-- ko if: !isBusinessContactMgmtEnabled -->\r\n    <p data-bind="css: typeClasses">\r\n        <swx-avatar params="avatar: author.avatar, isAgent: author.isAgent, displayName: author.displayName, isPstn: author.isPstn, size: 65"></swx-avatar>\r\n    </p>\r\n    <div class="contactRequestMessage contactRequestOutgoingMessage">\r\n        <p data-bind="l10n: { key: \'message_text_contactRequestOutgoingMessage\', params: { displayName: author.displayName } }"></p>\r\n    </div>\r\n    <div class="buttonRow">\r\n        <button type="button" class="btn primary clickable contactRequestSend" data-swx-testId="sendContactRequest"\r\n                data-bind="click: sendContactRequest, disable: actionInProgress, css: { \'in-progress\': actionInProgress }, focusHandler: { priority: focusImportance, callback: focusHandlerCallback }" tabindex="-1"><span\r\n            data-bind="l10n: { key: \'message_text_contactRequestSendAction\' }"></span></button>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- ko if: isBusinessContactMgmtEnabled -->\r\n    <div class="contactRequestMessage contactRequestOutgoingMessage">\r\n        <p data-bind="l10n: { key: \'message_text_contactRequestOutgoingMessage\', params: { displayName: author.displayName } }"></p>\r\n    </div>\r\n    <div class="contactRequestMessage">\r\n        <div class="ContactProfile--action-item fontSize-p">\r\n            <span>\r\n                <a href="#" role="button" data-bind="click: sendContactRequest, disable: actionInProgress, css: { \'in-progress\': actionInProgress }, focusHandler: { priority: focusImportance, callback: focusHandlerCallback }, l10n: {key: \'contact_information_add_to_contacts\'}" tabindex="-1"></a>\r\n            </span>\r\n        </div>\r\n    </div>\r\n   <!-- /ko -->\r\n</script>\r\n\r\n<script type="text/html" id="contactRequestOutgoingResendMessageContentTemplate">\r\n    <p class="contactRequestResendMessage" data-bind="css: typeClasses"><span\r\n        data-bind="l10n: { key: \'message_text_contactRequestOutgoingResendMessage\' }, css: { \'in-progress\': actionInProgress }"></span> - <a\r\n        data-bind="l10n: { key: \'message_text_contactRequestOutgoingResendAction\' }, click: sendContactRequest, css: { \'in-progress\': actionInProgress }"\r\n        class="clickable"></a></p>\r\n</script>\r\n\r\n<script type="text/html" id="contactRequestOutgoingAgentMessageContentTemplate">\r\n    <p data-bind="css: typeClasses">\r\n        <swx-avatar params="avatar: author.avatar, isAgent: author.isAgent, isPstn: author.isPstn, size: 65"></swx-avatar>\r\n    </p>\r\n    <div class="contactRequestMessage contactRequestOutgoingMessage">\r\n        <p data-bind="l10n: { key: \'message_text_contactRequestOutgoingMessage\', params: { displayName: author.displayName } }"></p>\r\n    </div>\r\n    <div class="buttonRow">\r\n        <button type="button" class="btn primary clickable contactRequestSend" data-swx-testId="sendContactRequest"\r\n                data-bind="click: sendContactRequest, disable: actionInProgress, css: { \'in-progress\': actionInProgress }, focusHandler: { priority: focusImportance, callback: focusHandlerCallback }" tabindex="-1"><span\r\n            class="contactRequestBtnText" data-bind="l10n: { key: \'message_text_contactRequestSendAction\' }"></span></button>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="suggestedContactMessageContentTemplate">\r\n    <p data-bind="css: typeClasses">\r\n        <swx-avatar params="avatar: author.avatar, isAgent: author.isAgent, displayName: author.displayName, size: 65"></swx-avatar>\r\n    </p>\r\n    <div class="contactRequestMessage suggestedContactMessage">\r\n        <p data-bind="l10n: { key: \'message_text_suggestedContactGreeting\', params: { displayName: author.displayName } }"></p>\r\n    </div>\r\n    <div class="buttonRow">\r\n        <button type="button" class="btn primary clickable contactRequestSend" data-bind="click: sendContactRequest, disable: actionInProgress, css: { \'in-progress\': actionInProgress }, focusHandler: { priority: 1, callback: focusHandlerCallback }" tabindex="-1"\r\n               ><span data-bind="l10n: { key: \'message_text_suggestedContactConnectAction\' }"></span>\r\n        </button>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="unblockContactMessageContentTemplate">\r\n    <div data-bind="css: typeClasses">\r\n        <div class="contactRequestMessage unblockContactMessage">\r\n            <p data-bind="l10n: { key: \'message_text_contactBlockedMessage\', params: { displayName: author.displayName } }"></p>\r\n        </div>\r\n        <div class="buttonRow">\r\n            <div class="column alignLeft">\r\n                <button type="button" class="btn primary clickable unblockContact"\r\n                        data-bind="click: unblockContact, disable: actionInProgress, css: { \'in-progress\': actionInProgress }, focusHandler: { priority: 1, callback: focusHandlerCallback }" tabindex="-1"\r\n                       ><span data-bind="l10n: { key: \'message_text_unblockContact\' }"></span></button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="spacesWelcomeMessageContentTemplate">\r\n    <div class="welcomeMessage">\r\n        <span class="emoticon hi large animated"><span class="emoSprite">(hi)</span><canvas data-item-id="hi" data-is-animated="true"></canvas></span>\r\n\r\n        <div data-bind="css: {clickable: spaceLink() || showSpacesCTA()}">\r\n            <div data-bind="l10n: { key: \'spaces_welcomeTitle\' }" class="title fontSize-h2"></div>\r\n            <div data-bind="text: welcomeMessage" class="fontSize-p"></div>\r\n        </div>\r\n        <!-- ko if: isJoiningEnabled -->\r\n        <swx-invite-link class="invite-link"\r\n                         params="topic: conversation.topic, uri: conversation.uri, isMessageContent: true">\r\n        </swx-invite-link>\r\n        <!-- /ko -->\r\n    </div>\r\n    <!-- ko if: showSpacesCTA -->\r\n    <div class="ctas">\r\n        <div class="cta clickable" data-bind="click: editTopicAction, enterKey: editTopicAction" tabindex="-1">\r\n            <div data-bind="l10n: { key: \'spaces_welcomeRenameBtnTitle\' }"\r\n                 class="title fontSize-h3 iconfont edit"></div>\r\n            <div data-bind="l10n: { key: \'spaces_welcomeRenameBtnMessage\' }" class="description fontSize-p"></div>\r\n        </div>\r\n        <div class="cta clickable" data-bind="click: settingsAction, enterKey: settingsAction" tabindex="-1">\r\n            <div data-bind="l10n: { key: \'spaces_welcomeSettingsBtnTitle\' }"\r\n                 class="title fontSize-h3 iconfont settings"></div>\r\n            <div data-bind="l10n: { key: \'spaces_welcomeSettingsBtnMessage\' }" class="description fontSize-p"></div>\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- ko if: othersAddedMessageContent -->\r\n    <div class="participantMessage clickable">\r\n        <p data-bind="html: othersAddedMessageContent, css: typeClasses"></p>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- ko if: agentsMessageContent -->\r\n    <div class="participantMessage">\r\n        <p data-bind="html: agentsMessageContent, css: typeClasses"></p>\r\n    </div>\r\n    <!-- /ko -->\r\n</script>\r\n\r\n<script type="text/html" id="urlMessageContentTemplate">\r\n    <!--ko if: !copyLinkEnabled() -->\r\n    <div  class="messageTextWrapper">\r\n        <p data-bind="html: content, visible: !translationItem.visible(), click: $parent.messageClicked.bind(this)" class="urlPreviewText"></p>\r\n        <!-- ko if: translationItem.isEnabled -->\r\n        <p data-bind="html: translationItem.translationText, visible: translationItem.visible()" class="urlPreviewText"></p>\r\n        <p><a href="#" role="button" data-bind="text: translationItem.toggleText, attr: {title: translationItem.toggleText, \'aria-label\': translationItem.toggleText}, click: translationItem.toggle"></a></p>\r\n        <!-- /ko -->\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- ko if: showGiphyMetadata -->\r\n    <span class="giphyMetadata fontSize-p" data-bind="text: giphyMetadata"></span>\r\n    <!-- /ko -->\r\n    <div data-bind="foreach: previews">\r\n        <!--ko if: !ytPlayer() -->\r\n        <div data-bind="css: typeClasses" class="urlPreview">\r\n            <a class="thumbnail"\r\n               data-bind="attr: { href: url, title: url, target: target, rel: rel}, event: {click: $parent.openUrlPreview.bind(this, url())}, css: {noScale: originalSize(), scaledByW: scaledByW(), scaledByH: scaledByH(), gif: isGif()}" tabindex="-1">\r\n                <!-- ko if: typeClasses.youtube -->\r\n                <span class="iconfont play"></span>\r\n                <!-- /ko -->\r\n\r\n                <img class="scaled" alt="" aria-hidden="true" role="presentation"\r\n                     data-bind="css: {scaledW: scaledByW(), scaledH: scaledByH(), originalSize: originalSize(), originalGif: isGif(), tall: tall, wide: wide}, attr: {src: thumbnail}"/>\r\n                <span class="mask"></span>\r\n                <div class="info" data-bind="css: {gif: isGif()}">\r\n                    <span class="title strong fontSize-p" data-bind="text: title"></span>\r\n                    <span class="description fontSize-p" data-bind="text: description"></span>\r\n                    <div class="domainName site fontSize-p">\r\n                        <img class="favicon" alt="" role="presentation" aria-hidden="true"\r\n                                                                              data-bind="attr: {src: favicon}, css: { hide: !favicon() }"/>\r\n                        <span data-bind="text: site"></span>\r\n                    </div>\r\n                </div>\r\n            </a>\r\n        </div>\r\n        <!-- /ko -->\r\n        <!--ko if: ytPlayer() -->\r\n        <div class="message-youtube-embed">\r\n            <iframe data-bind="attr: {\'id\': playerId, \'src\': youtubeUri }"\r\n                    type="text/html" allowfullscreen frameborder="0"\r\n                    class="chat-youtube-iframe" tabindex="-2"></iframe>\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n</script>\r\n\r\n\r\n<script type="text/html" id="pollMessageContentTemplate">\r\n    <div data-bind="css: { \'poll-message\': true, \'poll-message--disabled\': answerSent }">\r\n        <p class="poll-message-heading" data-bind="html: content"></p>\r\n\r\n        <fieldset class="poll-message-content" data-bind="template: { name: \'pollMessageAnswerTemplate\', foreach: pollAnswers, as: \'answer\' }"></fieldset>\r\n\r\n        <div data-bind="text: peopleVotedText" class="fontSize-p"></div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="pollMessageAnswerTemplate">\r\n    <label class="poll-message-answer">\r\n        <input type="radio" data-bind="value: $index, checked: $parent.checkedAnswer, disable: $parent.answerSent, click: $parent.onAnswerClick" tabindex="-1" />\r\n        <div class="poll-message-answer-box">\r\n            <div class="poll-message-answer-votes-bar" data-bind="style: { width: (answer.barWidth + \'%\') }"></div>\r\n            <span class="poll-message-answer-text" data-bind="html: answer.answerText"></span>\r\n            <span class="poll-message-answer-votes-count" data-bind="text: answer.users.length || \'\'"></span>\r\n        </div>\r\n    </label>\r\n    <div class="poll-message-answer-votes">\r\n        <div class="poll-message-answer-avatars" data-bind="foreach: answer.users">\r\n            <!-- ko if: ($index() < 2) -->\r\n                <!-- ko if: person -->\r\n                    <swx-avatar-deprecated params="avatar: person.avatarUrl(), isGroupAvatar: false, displayName: displayName" data-bind="attr: {title: displayName}"></swx-avatar-deprecated>\r\n                <!-- /ko -->\r\n                <!-- ko ifnot: person -->\r\n                    <swx-avatar-deprecated params="isGroupAvatar: false, displayName: displayName" data-bind="attr: {title: displayName}"></swx-avatar-deprecated>\r\n                <!-- /ko -->\r\n            <!-- /ko -->\r\n        </div>\r\n        <!-- ko if: (answer.users.length > 2) -->\r\n            <div class="poll-message-answer-ellipsis" data-bind="click: $parent.pollAvatarsVM.onEllipsisClick.bind($data, $index())"></div>\r\n            <swx-user-list-popup params="\r\n                eventContext: $parent,\r\n                isSelfPopup: $parent.pollAvatarsVM.isSelfPopup.bind(null, $index()),\r\n                title: $parent.pollAvatarsVM.votedByCount(answer.users.length),\r\n                users: $parent.pollAvatarsVM.users"></swx-user-list-popup>\r\n        <!-- /ko -->\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="swiftCardMessageContentTemplate">\r\n    <div class="swift">\r\n        <!-- ko if: !swift.isSupported() && swift.isValid()-->\r\n            <!-- ko template: { name: \'swiftUnsupported\', data: swift } --><!-- /ko -->\r\n        <!-- /ko -->\r\n        <!-- ko if: swift.isSupported() -->\r\n            <!-- ko if: swift.isCarousel -->\r\n                <!-- ko template: { name: \'swiftCarouselCard\', data: swift } --><!-- /ko -->\r\n            <!-- /ko -->\r\n            <!-- ko if: !swift.isCarousel -->\r\n                <!-- ko template: { name: \'swiftSingleCard\', data: swift.cards[0] } --><!-- /ko -->\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="swiftUnsupported">\r\n    <div class="card unsupported">\r\n        <span class="main emoticon hi animated">\r\n            <span class="emoSprite">(hi)</span>\r\n            <canvas data-item-id="hi" data-is-animated="true"></canvas>\r\n        </span>\r\n        <div class="text">\r\n            <div data-bind="l10n: { key: \'message_text_swift_unsupported\' }"></div>\r\n        </div>\r\n        <div class="buttons">\r\n            <div class="button" data-bind="attr: { tabindex: button.isValid() ? 0 : null, role: button.isValid() ? \'button\' : null, title: button.tooltip },\r\n                                        enterKey: button.isValid() ? button.action : null,\r\n                                        click: button.isValid() ? button.action : null, clickBubble: false">\r\n                <span class="normal" data-bind="text: button.title"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="swiftSingleCard">\r\n    <div class="card" data-bind="template: { name: contentType === \'Hero\' || contentType === \'Thumb\' ? \'swiftCard\' : \'swiftCard\' + contentType, data: content },\r\n                                 css: contentType.toLowerCase()"></div>\r\n</script>\r\n\r\n<script type="text/html" id="swiftCarouselCard">\r\n    <div class="carousel" data-bind="css: { first: isFirst, last: isLast, multiple: isMultiple }">\r\n        <div class="container" data-bind="css: { multiLine: areButtonsMultiLine },\r\n                                          foreach: {\r\n                                              data: cards,\r\n                                              as: \'card\',\r\n                                              afterRender: function(e, card) { e[1].addEventListener(\'focus\', function() { moveToCard(card); }, true); }\r\n                                          },\r\n                                          style: { left: carouselLeftPosition(), right: carouselRightPosition() }">\r\n            <div class="card" data-bind="template: { name: card.contentType === \'Hero\' || card.contentType === \'Thumb\' ? \'swiftCard\' : \'swiftCard\' + card.contentType, data: card.content },\r\n                                        css: card.contentType.toLowerCase()"></div>\r\n        </div>\r\n        <div class="prev" data-bind="click: prevCard, enterKey: prevCard, l10n_attr: { title: \'message_text_swift_prevCard\' }">\r\n            <div class="button iconfont" role="button" tabindex="0"></div>\r\n        </div>\r\n        <div class="next" data-bind="click: nextCard, enterKey: nextCard, l10n_attr: { title: \'message_text_swift_nextCard\' }">\r\n            <div class="button iconfont" role="button" tabindex="0"></div>\r\n        </div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="swiftCard">\r\n    <div class="cardContent" data-bind="attr: { tabindex: (tap && tap.isValid()) ? -1 : null, role: (tap && tap.isValid()) ? \'presentation\' : null, title: (tap && tap.isValid()) ? tap.tooltip : null },\r\n                                              css: { tap: tap && tap.isValid() },\r\n                                              enterKey: (tap && tap.isValid()) ? tap.action : null,\r\n                                              click: (tap && tap.isValid()) ? tap.action : null, clickBubble: false">\r\n        <!-- ko if: mainSection.isValid() -->\r\n            <!-- ko template: { name: \'swiftSection\', data: mainSection } --><!-- /ko -->\r\n        <!-- /ko -->\r\n        <div class="buttons" data-bind="foreach: { data: buttons, as: \'button\' }, css: { multiLine: areButtonsMultiLine}">\r\n            <!-- ko template: { name: \'swiftButton\', data: button } --><!-- /ko -->\r\n        </div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="swiftCardFlex">\r\n    <div class="cardContent" data-bind="attr: { tabindex: (tap && tap.isValid()) ? -1 : null, role: (tap && tap.isValid()) ? \'presentation\' : null, title: (tap && tap.isValid()) ? tap.tooltip : null },\r\n                                              css: { tap: tap && tap.isValid() },\r\n                                              enterKey: (tap && tap.isValid()) ? tap.action : null,\r\n                                              click: (tap && tap.isValid()) ? tap.action : null, clickBubble: false">\r\n        <div class="section">\r\n            <!-- ko if: title || subtitle || text -->\r\n            <div class="textContent">\r\n                <!-- ko if: title -->\r\n                <h1 data-bind="html: title, attr: { title: $element.textContent }"></h1>\r\n                <!-- /ko -->\r\n                <!-- ko if: subtitle -->\r\n                <h2 data-bind="html: subtitle, attr: { title: $element.textContent }"></h2>\r\n                <!-- /ko -->\r\n                <!-- ko if: text -->\r\n                <p class="normal" data-bind="html: text, attr: { title: $element.textContent }, css: expandedText() "></p>\r\n                <!-- /ko -->\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: images.length > 0 -->\r\n            <!-- ko with: images[0] -->\r\n            <div class="image" data-bind="attr: { tabindex: (tap && tap.isValid()) ? 0 : null, role: (tap && tap.isValid()) ? \'button\' : null, title: (tap && tap.isValid()) ? getTitleByType() : null },\r\n                                              css: { tap: tap && tap.isValid() },\r\n                                              enterKey: (tap && tap.isValid()) ? tap.action : null,\r\n                                              click: (tap && tap.isValid()) ? tap.action : null, clickBubble: false">\r\n                <img data-bind="attr: { src: url, alt: alt, width: uiSize().width, height: uiSize().height },\r\n                                    style: { left: leftAlignment(), bottom: bottomAlignment(), right: rightAlignment()}" />\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- /ko -->\r\n        </div>\r\n\r\n        <!-- ko if: buttons.length > 0 -->\r\n        <div class="buttons" data-bind="foreach: { data: buttons, as: \'button\' }, css: { multiLine: areButtonsMultiLine}">\r\n            <!-- ko template: { name: \'swiftButton\', data: button } --><!-- /ko -->\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="swiftCardReceipt">\r\n    <div data-bind="attr: { tabindex: (tap && tap.isValid()) ? 0 : null, role: (tap && tap.isValid()) ? \'button\' : null, title: (tap && tap.isValid()) ? tap.tooltip : null },\r\n                                              css: { tap: tap && tap.isValid() },\r\n                                              enterKey: (tap && tap.isValid()) ? tap.action : null,\r\n                                              click: (tap && tap.isValid()) ? tap.action : null, clickBubble: false">\r\n        <!-- ko if: title -->\r\n            <h1 data-bind="html: title"></h1>\r\n        <!-- /ko -->\r\n        <!-- ko if: facts.length !== 0 -->\r\n            <div class="facts" role="list" data-bind="foreach: { data: facts, as: \'fact\' }">\r\n                <!-- ko template: { name: \'swiftFact\', data: fact } --><!-- /ko -->\r\n            </div>\r\n        <!-- /ko -->\r\n        <!-- ko if: displayedItems().length !== 0 -->\r\n            <div class="items" role="list" data-bind="foreach: { data: displayedItems, as: \'item\' }">\r\n                <div class="item" role="listitem">\r\n                    <!-- ko template: { name: item.images.length !== 0 ? \'swiftSection\' : \'swiftItem\', data: item } --><!-- /ko -->\r\n                </div>\r\n            </div>\r\n        <!-- /ko -->\r\n        <!-- ko if: showFoldButton -->\r\n        <div class="button fold" data-bind="attr: { tabindex: -1, role: \'button\', title: foldButtonText() },\r\n                                   enterKey: triggerFoldAction,\r\n                                   click: triggerFoldAction, clickBubble: false">\r\n            <span class="normal" data-bind="text: foldButtonText()"></span>\r\n        </div>\r\n        <!-- /ko -->\r\n        <div class="summary">\r\n            <!-- ko if: vat -->\r\n                <div class="line">\r\n                    <span class="key normal" data-bind="l10n: { key: \'message_text_swift_vat\' }"></span>\r\n                    <span class="value normal" data-bind="text: vat"></span>\r\n                </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: tax -->\r\n                <div class="line">\r\n                    <span class="key normal" data-bind="l10n: { key: \'message_text_swift_tax\' }"></span>\r\n                    <span class="value normal" data-bind="text: tax"></span>\r\n                </div>\r\n            <!-- /ko -->\r\n            <div class="line">\r\n                <span class="key normal" data-bind="l10n: { key: \'message_text_swift_totalPrice\' }"></span>\r\n                <span class="value normal" data-bind="text: total"></span>\r\n            </div>\r\n        </div>\r\n        <div class="buttons" data-bind="foreach: { data: buttons, as: \'button\' }, css: { multiLine: areButtonsMultiLine}">\r\n            <!-- ko template: { name: \'swiftButton\', data: button } --><!-- /ko -->\r\n        </div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="swiftCardSignIn">\r\n    <span class="main emoticon hi animated">\r\n        <span class="emoSprite">(hi)</span>\r\n        <canvas data-item-id="hi" data-is-animated="true"></canvas>\r\n    </span>\r\n    <div class="text" data-bind="html: text"></div>\r\n    <div class="buttons" data-bind="foreach: { data: buttons, as: \'button\' }">\r\n        <!-- ko template: { name: \'swiftButton\', data: button } --><!-- /ko -->\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="swiftSection">\r\n    <div class="section" data-bind="attr: { tabindex: (tap && tap.isValid()) ? 0 : null, role: (tap && tap.isValid()) ? \'presentation\' : null, title: (tap && tap.isValid()) ? getTitleByType() : null },\r\n                css: { tap: tap && tap.isValid() },\r\n                enterKey: (tap && tap.isValid()) ? tap.action : null,\r\n                click: (tap && tap.isValid()) ? tap.action : null, clickBubble: false">\r\n        <div class="textContent">\r\n            <!-- ko if: title -->\r\n                <h1 data-bind="html: title, attr: { title: $element.textContent }"></h1>\r\n            <!-- /ko -->\r\n            <!-- ko if: price -->\r\n                <span class="price normal" data-bind="html: price, attr: { title: $element.textContent }"></span>\r\n            <!-- /ko -->\r\n            <!-- ko if: subtitle -->\r\n                <h2 data-bind="html: subtitle, attr: { title: $element.textContent }"></h2>\r\n            <!-- /ko -->\r\n            <!-- ko if: text -->\r\n                <p class="normal" data-bind="html: text, attr: { title: $element.textContent }, css: expandedText() "></p>\r\n            <!-- /ko -->\r\n        </div>\r\n        <!-- ko if: images.length > 0 -->\r\n            <!-- ko with: images[0] -->\r\n                <div class="image" data-bind="attr: { tabindex: (tap && tap.isValid()) ? 0 : null, role: (tap && tap.isValid()) ? \'button\' : null, title: (tap && tap.isValid()) ? getTitleByType() : null },\r\n                                              css: { tap: tap && tap.isValid() },\r\n                                              enterKey: (tap && tap.isValid()) ? tap.action : null,\r\n                                              click: (tap && tap.isValid()) ? tap.action : null, clickBubble: false">\r\n                    <img data-bind="attr: { src: url, alt: alt, width: uiSize().width, height: uiSize().height },\r\n                                    style: { left: leftAlignment(), bottom: bottomAlignment(), right: rightAlignment()}" />\r\n                </div>\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="swiftButton">\r\n    <div class="button" data-bind="attr: { tabindex: isValid() ? -1 : null, role: isValid() ? \'button\' : null, title: tooltip },\r\n                                   enterKey: isValid() ? action : null,\r\n                                   click: isValid() ? action : null, clickBubble: false">\r\n        <span class="normal" data-bind="text: title"></span>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="swiftFact">\r\n    <div class="fact" role="listitem">\r\n        <span class="key normal" data-bind="html: key"></span>\r\n        <span class="value normal" data-bind="html: value"></span>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="swiftItem">\r\n    <span class="title" data-bind="html: title"></span>\r\n    <span class="price normal" data-bind="text: price"></span>\r\n</script>\r\n\r\n<script type="text/html" id="swiftCardVideo">\r\n    <div class="cardContent" data-bind="css: aspect">\r\n        <div class="videoCard">\r\n            <swx-video-player params="media: media.video, thumbnail: image.url, showLoadingInfo: true, autoplay: autostart, muted: true, autoloop: false, displayMuteButton: true, messageId: $parent.messageId, conversationId: $parent.conversationId, title: title, subtitle: subtitle"></swx-video-player>\r\n        </div>\r\n        <div data-bind="template: \'mediaCardSection\', data: $data"></div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="swiftCardAudio">\r\n    <div class="cardContent">\r\n        <div class="audioCard">\r\n\r\n            <!-- ko if: hasThumbnail() -->\r\n            <img class="thumbnail" data-bind="attr: { src: image.url, alt: image.alt, width: image.uiSize().width, height: image.uiSize().height },\r\n                style: { left: image.leftAlignment(), bottom: image.bottomAlignment(), right: image.rightAlignment() }" />\r\n            <!-- /ko -->\r\n\r\n            <div class="audio-message" data-bind="css: {thumbnail: hasThumbnail()}">\r\n                <div class="media-holder">\r\n                    <div class="media-content">\r\n                        <div class="audioIcon">\r\n                            <span class="iconfont audiomail"></span>\r\n                        </div>\r\n                        <swx-audio-player params="media: media.audio, autoplay: autostart, showLoadingInfo: true, messageId: $parent.messageId, conversationId: $parent.conversationId"></swx-audio-player>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div data-bind="template: \'mediaCardSection\', data: $data"></div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="swiftCardAnimation">\r\n    <div class="cardContent">\r\n        <div class="animationCard">\r\n            <swx-gif-player params="media: media.animation"></swx-gif-player>\r\n        </div>\r\n        <div data-bind="template: \'mediaCardSection\', data: $data"></div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="mediaCardSection">\r\n    <!-- ko if: hasTextInfo() -->\r\n    <div class="section">\r\n        <div class="textContent">\r\n            <!-- ko if: title -->\r\n            <h1 data-bind="text: title, attr: { title: title }"></h1>\r\n            <!-- /ko -->\r\n            <!-- ko if: subtitle -->\r\n            <h2 data-bind="text: subtitle, attr: { title: subtitle }"></h2>\r\n            <!-- /ko -->\r\n            <!-- ko if: mediaSourceDomain -->\r\n            <h3 data-bind="text: mediaSourceDomain, attr: { title: mediaSourceDomain }"></h3>\r\n            <!-- /ko -->\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n    <div class="buttons" data-bind="foreach: { data: buttons, as: \'button\' }, css: { multiLine: areButtonsMultiLine}">\r\n        <!-- ko template: { name: \'swiftButton\', data: button } --><!-- /ko -->\r\n    </div>\r\n</script>\r\n'}),define("ui/telemetry/actions/actionSources",{contactRequestIncomingActivityItem:"ContactRequestIncomingActivityItem",unblockActivityItem:"UnblockActivityItem",recentItem:"recentItem",searchItem:{addressBook:"addressBookSearchItem",skypeDirectory:"skypeDirectorySearchItem"},callScreen:{participantMenu:"callScreenParticipantMenu"},contactsPage:{contact:"contactsPageContact"},discoverAgentsPage:{agent:"discoverAgentsPageAgent"},contextMenuItem:{block:"blockContactMenuItem",callSkype:"callSkypeMenuItem",deleteItem:"deleteContactMenuItem",removeMessage:"removeMessageMenuItem",startPSTNCall:"startPSTNCallMenuItem",unblock:"unblockContactMenuItem",addContactToFavorites:"addContactToFavoritesMenuItem",removeContactFromFavorites:"removeContactFromFavoritesMenuItem",videoCall:"videoCallMenuItem",quoteMessage:"quoteMessageMenuItem",copyMessage:"copyMessageMenuItem",copySelection:"copySelectionMenuItem",copySelectionText:"copySelectionTextMenuItem"},contactProfile:"contactProfile",search:{reset:{resetXButton:"resetXButton",content:"experienceContent",openConversation:"openConversation",escapeKey:"escapeKey",emptyQuery:"emptyQuery",queryChanged:"queryChanged",directoryActivated:"directoryActivated"}},conversation:{conversationItem:"conversationItem",messageItem:"messageItem",groupRoster:"groupRoster",header:{button:"conversationHeaderButton"}},invitesShareButtons:{header:"header",newConversation:"new_conversation_area",groupInformationPanel:"group_information_panel"},skypeOutPage:{skypeOutHeader:"skypeOutHeader"},me:{area:"me_area",avatar:"me_avatarFilePicker"},selectionCopyKeyboard:"selectionCopyKeyboard"}),define("ui/viewModels/experience/content",["require","vendor/knockout","swx-constants","swx-service-locator-instance","ui/telemetry/actions/actionSources","usertiming"],function(e){function a(){var e=this,a=r.resolve(n.serviceLocator.PUBSUB);e.showOverlay=t.observable(!1),e.init=function(){a.subscribe(o.narrowMode.SIDEBAR_STATE_CHANGED,e.showOverlay),s.mark(u.EXPERIENCE.CONTENT_INIT)},e.dispose=function(){a.unsubscribe(o.narrowMode.SIDEBAR_STATE_CHANGED,e.showOverlay)},e.hideOverlay=function(){var t={source:i.search.reset.content};e.showOverlay(!1),a.publish(o.search.RESET,t)}}var t=e("vendor/knockout"),n=e("swx-constants").COMMON,r=e("swx-service-locator-instance").default,i=e("ui/telemetry/actions/actionSources"),s=e("usertiming"),o=n.events,u=n.telemetry.performanceMarks;return a}),define("ui/controls/experience/content",["require","exports","module","vendor/knockout","text!views/experience/content.html","ui/viewModels/experience/content","utils/common/styleModeHelper","swx-browser-detect","swx-constants","swx-enums","swx-service-locator-instance","swx-cafe-application-instance"],function(e,t){var n=e("vendor/knockout"),r=e("text!views/experience/content.html"),i=e("ui/viewModels/experience/content"),s=e("utils/common/styleModeHelper"),o=e("swx-browser-detect").default,u=e("swx-constants").COMMON,a=e("swx-enums"),f=e("swx-service-locator-instance").default,l=e("swx-cafe-application-instance"),c=0;t.name="content",t.render=function(e,t){var h=f.resolve(u.serviceLocator.FEATURE_FLAGS),p=h.isFeatureOn(u.featureFlags.DARK_THEME_ENABLED);if(p){var d=l.get()._flagsServiceProvider,v=d.build(a.skypeFlagsApiMappings.DARK_THEME);v.read().then(function(e){!!e&&!s.get().isIntegratedProperty()&&document.body.classList.add("dark")})}var m=document.createElement("div"),g=new i;c++,m.id="swxContent"+c,m.className="swxContent",m.innerHTML=r,s.get().isIntegratedProperty()&&o.getBrowserInfo().browserName!=="SkypeShell"&&(m.className+=" "+s.get().host()),g.init(),n.applyBindings(g,m),t(m),s.get().addContainer(m)}}),define("ui/contextMenu/menuItemGroup",[],function(){function e(e,t){this.type=e,this.items=t}return e}),define("utils/common/eventHelper",["require","exports","module","swx-constants"],function(e,t){function i(){}function s(e){e.preventDefault()}function o(e){return e.which||e.keyCode}function u(e){return l(e)?r[o(e)]:!1}function a(e){var t=o(e);return t===n.ENTER||t===n.SPACE}function f(e){var t=o(e);return t>=n.NUMBER_0&&t<=n.NUMBER_9||t>=n.A&&t<=n.Z}function l(e){var t=o(e);return t>=n.NUMPAD_0&&t<=n.NUMPAD_9}function c(e){var t=o(e);return t===n.ESCAPE}var n=e("swx-constants").KEYS,r={96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9"};i.prototype.emit=function(){},i.prototype.done=function(){},t.swallow=s,t.getKeyCode=o,t.getNumpadKey=u,t.isActivation=a,t.isAlphaNumericKey=f,t.isNumPadKey=l,t.emptyEmitter=new i,t.isDeactivation=c}),define("ui/contextMenu/contextMenu",["require","exports","module","vendor/knockout","lodash-compat","constants/cssClasses","swx-constants","swx-service-locator-instance","browser/window","browser/dom","utils/common/accessibility","swx-focus-handler","swx-utils-common","ui/telemetry/actions/actionNames","browser/document","ui/contextMenu/menuItemGroup","swx-constants","utils/common/eventHelper","swx-enums"],function(e,t){function C(e){if(e&&!k(e)){var t=o.resolve(s.serviceLocator.ACTION_TELEMETRY);t.recordAction(h.contextMenu.hidden)}}function k(e){return L(e.target)}function L(e){return!!a.getParentWithClass(e,i.contextMenu.CONTEXT_MENU)}function A(e){var t,n;for(t=0;t<e.length;t++){n=e[t];if(H(n)&&A(n.items)||!H(n)&&n.isEnabled())return!0}return!1}function O(e){E=a.createElement("ul"),E.classList.add(i.contextMenu.CONTEXT_MENU),E.setAttribute("role","listbox"),E.setAttribute("aria-expanded","true"),M(),_(e),f.initFocusRing(E),E.setAttribute("data-bind",'focusHandler: { priority: 1 }, keyboardNavigation: { itemSelector: ".'+i.LIST_SELECTABLE+'" }'),n.applyBindings(b,E),p.body.appendChild(E)}function M(){y=a.createElement("div"),y.className="arrow",y.setAttribute("aria-hidden","true"),E.appendChild(y)}function _(e){var t,n;for(t=0;t<e.length;t++)n=e[t],!D(t)&&j(n)&&!B(e,t)&&q(),H(n)?F(n.items):n.isEnabled()&&I(n),j(n)&&P(e,t)&&q()}function D(e){return e===0}function P(e,t){return t<e.length-1}function H(e){return e instanceof d}function B(e,t){return!D(t)&&H(e[t-1])}function j(e){return H(e)&&A(e.items)}function F(e){e.forEach(function(e){e.isEnabled()&&I(e)})}function I(e){var n=a.createElement("li"),r=a.createElement("span");a.addClass(n,i.LIST_SELECTABLE),e.cssClass&&a.addClass(n,e.cssClass),r.textContent=e.label,n.appendChild(r),n.addEventListener(s.events.browser.CLICK,e.action,!0),b.itemActions.push(function(){e.action(),t.hide()}),n.setAttribute("data-bind","event:{mousemove: onMouseMove}, enterKey: itemActions["+(b.itemActions.length-1)+"]"),n.setAttribute("role","option"),E.appendChild(n)}function q(){var e=a.createElement("li");a.addClass(e,"separator"),E.appendChild(e)}function R(e){e.clientX===undefined&&(e.clientX=0),e.clientY===undefined&&(e.clientY=0);var t=U(e),n=e.customClientOptions||{};z(t),X(t,n)}function U(e){var t=e.customClientOptions||{};if(!t.offsetElement)return{left:e.clientX,top:e.clientY,bottom:e.clientY};var n=t.offsetElement,r=a.getElementOffset(n),i=n.offsetWidth/2;return{left:r.offsetLeft+i,top:r.offsetTop,bottom:r.offsetTop+n.offsetHeight}}function z(e){var n,r,i=e.left,s=E.offsetWidth/2,o=i+s,u=window.innerWidth-o>0;u?(r=i-s>t.MENU_BORDER_WIDTH,r?n=i-s:n=t.MENU_BORDER_WIDTH):n=window.innerWidth-E.offsetWidth-t.MENU_BORDER_WIDTH,E.style.left=n+"px",W(e,n)}function W(e,n){var r=e.left,i=r-n,s=i-t.ARROW_WIDTH/2,o=t.MENU_BORDER_WIDTH,u=E.offsetWidth-t.MENU_BORDER_WIDTH-t.ARROW_WIDTH;s=Math.max(o,Math.min(s,u)),y.style.left=s+"px"}function X(e,n){var r,s,o=n.position||g.contextMenuPosition.Bottom,u=n.offset||0,f=e.top<window.innerHeight/2;f&&o===g.contextMenuPosition.Bottom?(s=e.bottom,r=s+t.ARROW_HEIGHT+u):(s=e.top,r=s-t.ARROW_HEIGHT-E.offsetHeight-u,a.addClass(E,i.contextMenu.FLIPPED)),E.style.top=r+"px"}function V(e){var n=m.getKeyCode(e);n===v.ESCAPE&&t.hide(e)}function $(e,t){t.currentTarget&&l.get().addFocusRequestToQueue(t.currentTarget,l.Priorities.Immediate)}function J(e){e.preventDefault(),e.stopPropagation()}function K(){var e=o.resolve(s.serviceLocator.PUBSUB);c.execute(function(){p.addEventListener(s.events.browser.CLICK,t.hide),p.addEventListener(s.events.browser.KEYDOWN,V),u.addEventListener(s.events.browser.RESIZE,t.hide),e.subscribe(s.events.interaction.SCROLL_START,t.hide),E.addEventListener(s.events.browser.CONTEXTMENU,J)})}function Q(){var e=o.resolve(s.serviceLocator.PUBSUB);p.removeEventListener(s.events.browser.CLICK,t.hide),p.removeEventListener(s.events.browser.KEYDOWN,V),u.removeEventListener(s.events.browser.RESIZE,t.hide),e.unsubscribe(s.events.interaction.SCROLL_START,t.hide),E.removeEventListener(s.events.browser.CONTEXTMENU,J)}function G(){w&&r.forEach(w,function(e){e.dispose&&e.dispose()})}var n=e("vendor/knockout"),r=e("lodash-compat"),i=e("constants/cssClasses"),s=e("swx-constants").COMMON,o=e("swx-service-locator-instance").default,u=e("browser/window"),a=e("browser/dom"),f=e("utils/common/accessibility"),l=e("swx-focus-handler"),c=e("swx-utils-common").async,h=e("ui/telemetry/actions/actionNames"),p=e("browser/document"),d=e("ui/contextMenu/menuItemGroup"),v=e("swx-constants").KEYS,m=e("utils/common/eventHelper"),g=e("swx-enums"),y,b={itemActions:[],onMouseMove:$},w,E=null,S=null,x,T=0,N=200;t.MENU_BORDER_WIDTH=1,t.ARROW_WIDTH=40,t.ARROW_HEIGHT=11,t.isVisible=n.observable(!1),t.show=function(e,n,r,i){var u=o.resolve(s.serviceLocator.ACTION_TELEMETRY);t.hide(null,i),x=p.activeElement,w=e,r=r||{};if(A(e)){if(i){var a=o.resolve(s.serviceLocator.PUBSUB);a.publish(s.events.contextMenu.MENU_SHOWN)}T=Date.now(),S=n.target,O(e),R(n),K(),t.isVisible(!0),u.recordAction(h.contextMenu.shown,r)}},t.hide=function(e,n){function i(){return e&&e.type===s.events.browser.SCROLL?!0:e&&e.target?L(e.target):n||!1}function u(){var t;return E?(t=Date.now()-T,e&&e.type===s.events.browser.SCROLL?a(S,e.target):!e||e.type===s.events.browser.RESIZE||t>N):!1}function a(e,t){while(e){if(e===t)return!0;e=e.parentNode}return!1}if(e&&e.which===3)return;if(u()){var r=o.resolve(s.serviceLocator.PUBSUB);r.publish(s.events.contextMenu.MENU_HIDDEN,i()),C(e),Q(),G(),y=null,S=null,E.parentElement.removeChild(E),E=null,T=0,b.itemActions=[],e&&m.getKeyCode(e)===v.ESCAPE&&l.get().addFocusRequestToQueue(x),x=null,t.isVisible(!1)}},t.isShowing=function(){return E!==null}}),define("ui/viewModels/buttons/button",["require","vendor/knockout","swx-i18n","ui/contextMenu/contextMenu"],function(e){function i(e){function s(){var t="btn ";return i.disabled()&&(t+="disabled "),typeof e.cssClass=="function"?t+=e.cssClass():t+=e.cssClass,t}function o(){var n=t.utils.unwrapObservable(e.icon);return n?(n=n.split(" "),n.length?(n.unshift("iconfont"),n.join(" ")):{}):{}}function u(){return!i.disabled()&&i.hasMenuOptions()}function a(e){var t=i.menuOptions(),n={source:"button",isGroupConversation:!1};e.customClientOptions={offsetElement:e.target},r.show(t,e,n)}function f(e){r.hide(e)}function l(e){return typeof e=="function"?e:e===undefined||e===null?t.observable(!1):t.observable(e)}function c(e){if(e.text)throw new Error("You have to provide i18n enabled textKey param value or set already localized value to i18nText instead of text");if(e.title)throw new Error("You have to provide i18n enabled titleKey param value or set already localized value to i18nTitle instead of using title property");if(!e.textKey&&!e.i18nText)throw new Error("You have to set either textKey or i18nText parameters");e.cssClass=e.cssClass||[]}var i=this;c(e),i.ariaLabel=e.ariaLabel,i.title=e.title,i.disabled=l(e.disabled),i.tabindex=t.observable(e.tabindex),i.buttonCssClass=t.computed(s,i),i.spanCssClass=t.computed(o,i),i.hasMenuOptions=e.hasMenuOptions?e.hasMenuOptions:t.observable(!1),i.showMenuOptions=e.showMenuOptions?e.showMenuOptions:t.computed(u,i),i.menuOptions=e.menuOptions?e.menuOptions:t.observable([]),i.ariaHasPopup=t.observable(!1),i.hasFocus=e.hasFocus?e.hasFocus:t.observable(!1),i.dispose=function(){i.buttonCssClass.dispose(),i.spanCssClass.dispose(),i.showMenuOptions.dispose&&i.showMenuOptions.dispose()},i.onClickHandler=function(t,n){i.hasMenuOptions()?r.isShowing()?f(n):a(n):e.action(n)},e.textKey?i.text=n.fetch({key:e.textKey}):i.text=e.i18nText,e.titleKey?i.title=n.fetch({key:e.titleKey}):e.i18nTitle&&(i.title=e.i18nTitle),e.ariaLabelKey&&(i.ariaLabel=n.fetch({key:e.ariaLabelKey})),e.ariaHasPopup&&i.ariaHasPopup(!0)}var t=e("vendor/knockout"),n=e("swx-i18n").localization,r=e("ui/contextMenu/contextMenu");return i}),define("text!views/common/buttons/regular.html",[],function(){return'<button data-bind="click: onClickHandler, disable: disabled, attr: { class: buttonCssClass, title: title, \'aria-label\': ariaLabel, \'aria-haspopup\': ariaHasPopup }, hasFocus: hasFocus" type="button" role="button">\r\n    <span data-bind="css: spanCssClass, text: text"></span>\r\n    <!-- ko if: showMenuOptions -->\r\n    <div class="buttonMenuOptionsIcon">\r\n        <span class="iconfont chevronDown"></span>\r\n    </div>\r\n    <!-- /ko -->\r\n</button>\r\n'}),define("ui/components/experience/button",["require","exports","module","constants/components","ui/viewModels/buttons/button","text!views/common/buttons/regular.html"],function(e,t){t.name=e("constants/components").experience.BUTTON,t.viewModel=e("ui/viewModels/buttons/button"),t.template=e("text!views/common/buttons/regular.html")}),define("text!views/common/spinner.html",[],function(){return'<div class="circle one">\r\n    <div class="rotate">\r\n        <div class="position">\r\n            <div class="scale">\r\n                <div class="shape"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="circle two">\r\n    <div class="rotate">\r\n        <div class="position">\r\n            <div class="scale">\r\n                <div class="shape"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="circle three">\r\n    <div class="rotate">\r\n        <div class="position">\r\n            <div class="scale">\r\n                <div class="shape"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="circle four">\r\n    <div class="rotate">\r\n        <div class="position">\r\n            <div class="scale">\r\n                <div class="shape"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/experience/loadingAnimation",["require","exports","module","constants/components","text!views/common/spinner.html"],function(e,t){t.name=e("constants/components").experience.LOADING_ANIMATION,t.template=e("text!views/common/spinner.html")}),define("ui/viewModels/experience/radioButton",["require","vendor/knockout"],function(e){function n(e){var n=this;n.id=e.id,n.value=e.value?e.value:"",n.name=e.name?e.name:"",n.ariaLabel=e.ariaLabel?e.ariaLabel:"",n.labelKey=e.labelKey?e.labelKey:"",n.checked=e.checked,n.isInputChecked=t.pureComputed(function(){return n.checked()===n.value?"checked":""},n)}var t=e("vendor/knockout");return n}),define("text!views/common/buttons/radioButton.html",[],function(){return'<label class="RadioButton" data-bind="attr: {for: id}">\r\n    <div class="RadioButton-element">\r\n        <input class="RadioButton-input" type="radio" data-bind="checked: checked, attr: { id: id, name: name, value: value, \'aria-label\': ariaLabel}" />\r\n        <div class="RadioButton-outerCircle" data-bind="css: {RadioButton-outerCircle--checked : isInputChecked}">\r\n            <div class="RadioButton-innerCircle"></div>\r\n        </div>\r\n    </div>\r\n    <span class="text RadioButton-label" data-bind="l10n: {key: labelKey}"></span>\r\n</label>\r\n'}),define("ui/components/experience/radioButton",["require","exports","module","ui/viewModels/experience/radioButton","constants/components","text!views/common/buttons/radioButton.html"],function(e,t){function r(e){var t=new n(e);return t}var n=e("ui/viewModels/experience/radioButton");t.name=e("constants/components").experience.RADIO_BUTTON,t.template=e("text!views/common/buttons/radioButton.html"),t.viewModel={createViewModel:r}}),define("ui/telemetry/people/contactTelemetryHelper",["require","exports","module","lodash-compat","experience/settings","ui/telemetry/telemetryClient"],function(e,t){var n=e("lodash-compat"),r=e("experience/settings"),i=e("ui/telemetry/telemetryClient");t.setStart=function(e,t){i.get().traceStart(e,t)},t.getTrace=function(e){return i.get().traceDump(e)||{}},t.addIfDefined=function(e,t,r){if(n.isNumber(r)||n.isString(r)||n.isBoolean(r))e[t]=r},t.send=function(e,t){if(n.isEmpty(e))return;i.get().sendEvent(r.telemetry.uiTenantToken,t,e)}}),define("ui/telemetry/people/contactSearch",["require","exports","module","ui/telemetry/people/contactTelemetryHelper","swx-enums","swx-constants"],function(e,t){function u(e){var t=n.getTrace(s.SEARCH_CONTACT),r={};if(!a(t)||!f(e))return;r[o.fields.NAME]=l(e.searchScope),r[o.fields.SUCCESS]=e.success;if(!r[o.fields.NAME])return;return n.addIfDefined(r,o.fields.BEGIN_TIMESTAMP,t.startTime),n.addIfDefined(r,o.fields.ELAPSED,t.duration),n.addIfDefined(r,o.fields.QUERY_ID,e.queryId),n.addIfDefined(r,o.fields.RESULT_COUNT,e.resultCount),n.addIfDefined(r,o.fields.CLICK_POSITION,e.clickPosition),n.addIfDefined(r,o.fields.SOURCE,e.source),r}function a(e){return e&&e.startTime&&e.duration}function f(e){return e&&e.searchScope&&e.success!==undefined}function l(e){return e===r.searchScope.AddressBook?o.names.SEARCH_ADDRESSBOOK:e===r.searchScope.SkypeDirectory?o.names.SEARCH_DIRECTORY:e===r.searchScope.Groups?o.names.SEARCH_GROUPS:e}var n=e("ui/telemetry/people/contactTelemetryHelper"),r=e("swx-enums"),i=e("swx-constants").COMMON,s=i.telemetry.performanceMarks.CONTACTS,o=i.telemetry.contactsV2.contactSearch;t.onContactSearchStart=function(){n.setStart(s.SEARCH_CONTACT)},t.onContactSearchEnd=function(e){var t=u(e);n.send(t,o.TYPE)}}),define("ui/telemetry/people/contactSearchSession",["require","exports","module","ui/telemetry/people/contactTelemetryHelper","swx-constants"],function(e,t){function o(e,t){var r=n.getTrace(i.SESSION_SEARCH),o={};if(!u(r)||!a(e))return;return o[s.fields.NAME]=t,o[s.fields.SUCCESS]=e.success,n.addIfDefined(o,s.fields.BEGIN_TIMESTAMP,r.startTime),n.addIfDefined(o,s.fields.ELAPSED,r.duration),n.addIfDefined(o,s.fields.SESSION_ID,e.sessionId),n.addIfDefined(o,s.fields.QUERY_COUNT,e.queryCount),n.addIfDefined(o,s.fields.SUCCESS_CRITERIA,e.successCriteria),n.addIfDefined(o,s.fields.SOURCE,e.source),o}function u(e){return e&&e.startTime&&e.duration}function a(e){return e&&e.successCriteria&&e.success!==undefined}var n=e("ui/telemetry/people/contactTelemetryHelper"),r=e("swx-constants").COMMON,i=r.telemetry.performanceMarks.CONTACTS,s=r.telemetry.contactsV2.searchSession;t.onSearchSessionStart=function(){n.setStart(i.SESSION_SEARCH)},t.onSearchSessionEnd=function(e){var t=o(e,s.names.SEARCH_SESSION);n.send(t,s.TYPE)}}),define("ui/viewModels/search/input",["require","vendor/knockout","swx-constants","swx-service-locator-instance","swx-constants","utils/common/eventHelper","swx-i18n","swx-enums","browser/window","utils/common/applicationFocusManager","ui/telemetry/actions/actionSources","ui/telemetry/people/contactSearch","ui/telemetry/people/contactSearchSession","utils/common/accessibility"],function(e){function b(){function L(){e.isEnabled(!0)}function A(){e.isEnabled(!1),e.resetQuery()}function O(e){return w?e+"_4b":e}function M(t){e.query()&&t&&e.showMoreResultsAvailableMessage(N&&t.moreResultsAvailable)}function _(t){t.length===0&&(e.directorySearchActive=!1)}function D(){S={people:null,groups:null,SkypeDirectory:null}}function P(){var t=e.query(),n={source:t===d?l.search.reset.emptyQuery:l.search.reset.queryChanged},r=H(n.source);F(r),t===d?(b.publish(v.RESET,n),e.directorySearchActive=!1):(x.queryCount=x===null?1:x.queryCount+1,B(r),j(),b.publish(v.QUERY_CHANGED,t)),e.showSpinner(e.directorySearchActive),D()}function H(t){var n={searchScope:e.directorySearchActive?u.searchScope.SkypeDirectory:u.searchScope.AddressBook,resultCount:e.directorySearchActive?S.SkypeDirectory:S.people,source:t};return n.success=n.resultCount!==null,n}function B(e){c.onContactSearchStart(),k=a.setTimeout(function(){c.onContactSearchEnd(e),k=null},y)}function j(){x.searchTimeoutHandle||(h.onSearchSessionStart(),x.searchTimeoutHandle=a.setTimeout(function(){h.onSearchSessionEnd({success:!1,queryCount:x.queryCount}),x.queryCount=null,x.searchTimeoutHandle=null},y))}function F(e){c.onContactSearchEnd(e),k&&a.clearTimeout(k)}function I(t){t?b.publish(v.INPUT_FOCUS):b.publish(v.INPUT_BLUR,e.query().length)}function q(t){t||e.hasFocus(!1)}function R(){e.hasFocus(!0)}function U(){var t="";e.directorySearchActive?S.people===0&&S.groups===0&&S.SkypeDirectory===0?t=o.fetch({key:"accessibility_totalSearchNoResults"}):S.SkypeDirectory!==null&&(t=o.fetch({key:"accessibility_totalSearchUpdated",params:{totalSearchResults:S.people+S.groups+S.SkypeDirectory,peopleSearchResults:S.people,groupsSearchResults:S.groups,SkypeDirectorySearchResults:S.SkypeDirectory},count:S.people+S.groups+S.SkypeDirectory})):S.people===0&&S.groups===0&&!C?t=o.fetch({key:O("accessibility_localSearchNoResults")}):S.people===0&&S.groups===0&&C?t=o.fetch({key:O("accessibility_localSearchNoResults")})+o.fetch({key:"accessibility_searchSkypeDirectory"}):S.people!==null&&S.groups!==null&&(t=o.fetch({key:O("accessibility_localSearchUpdated"),params:{totalSearchResults:S.people+S.groups,peopleSearchResults:S.people,groupsSearchResults:S.groups},count:S.people+S.groups})),t!==""&&p.announce(t)}function z(e){S.people=e,U()}function W(e){S.groups=e,U()}function X(e){e&&p.announce({key:"accessibility_searching"})}function V(e){x.queryCount!==null&&(h.onSearchSessionEnd({success:!0,queryCount:x.queryCount,successCriteria:e.successCriteria,source:e.source}),a.clearTimeout(x.searchTimeoutHandle),x.queryCount=null,x.searchTimeoutHandle=null)}var e=this,b=r.resolve(n.serviceLocator.PUBSUB),w,E={inputFocus:null,inputValue:null,showSpinner:null,searchResults:null},S={people:null,groups:null,SkypeDirectory:null},x={searchTimeoutHandle:null,queryCount:null},T=[i.UP,i.DOWN,i.PAGE_UP,i.PAGE_DOWN,i.ENTER,i.F10],N,C,k;e.inputAriaLabel=t.observable(""),e.hasFocus=t.observable(!1),e.isEnabled=t.observable(!1),e.showSpinner=t.observable(!1),e.directorySearchActive=!1,e.query=t.observable(d).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:500}}),e.init=function(){var i=r.resolve(n.serviceLocator.FEATURE_FLAGS);N=i.isFeatureOn(n.featureFlags.SHOW_SEARCH_QUERY_MORE_RESULTS_AVAILABLE),C=i.isFeatureOn(n.featureFlags.SKYPE_DIRECTORY_SEARCH),w=i.isFeatureOn(n.featureFlags.USE_BUSINESS_WORDING),b.subscribe(v.DIRECTORY_SEARCH_ACTIVATED,e.onDirectorySearchActivated),b.subscribe(v.DIRECTORY_SEARCH_RESULTS,e.onDirectorySearchResults),b.subscribe(v.GROUPS_SEARCH_RESULTS,W),b.subscribe(v.LOCAL_SEARCH_RESULTS,z),b.subscribe(v.RESET,e.onReset),b.subscribe(g.SIDEBAR_STATE_CHANGED,q),b.subscribe(v.QUERY_EXECUTED,M),b.subscribe(m.SWX_TIMELINE_LOADED,L),b.subscribe(m.SWX_ON_SIGN_OUT,A),b.subscribe(v.SESSION_SUCCESS,V),b.subscribe(n.events.navigation.NAVIGATE_TO_SEARCH_INPUT,R),E.inputFocus=e.hasFocus.subscribe(I),E.inputValue=e.query.subscribe(P),E.searchResults=e.query.subscribe(_),E.showSpinner=e.showSpinner.subscribe(X),e.showMoreResultsAvailableMessage=t.observable(!1),e.inputAriaLabel(o.fetch({key:O("input_searchSkype_ariaLabel")}))},e.dispose=function(){b.unsubscribe(v.DIRECTORY_SEARCH_ACTIVATED,e.onDirectorySearchActivated),b.unsubscribe(v.DIRECTORY_SEARCH_RESULTS,e.onDirectorySearchResults),b.unsubscribe(v.GROUPS_SEARCH_RESULTS,W),b.unsubscribe(v.LOCAL_SEARCH_RESULTS,z),b.unsubscribe(v.RESET,e.onReset),b.unsubscribe(g.SIDEBAR_STATE_CHANGED,q),b.unsubscribe(v.QUERY_EXECUTED,M),b.unsubscribe(m.SWX_TIMELINE_LOADED,L),b.unsubscribe(m.SWX_ON_SIGN_OUT,A),b.unsubscribe(v.SESSION_SUCCESS,V),E.inputFocus.dispose(),E.inputValue.dispose(),E.searchResults.dispose(),E.showSpinner.dispose()},e.onDirectorySearchActivated=function(){e.directorySearchActive=!0,S.people&&(c.onContactSearchEnd({searchScope:u.searchScope.AddressBook,resultCount:S.people,success:!0,source:l.search.reset.directoryActivated}),c.onContactSearchStart()),X(e.directorySearchActive)},e.onDirectorySearchResults=function(t){S.SkypeDirectory=t,e.hasFocus(!0),e.showSpinner(!1),U()},e.activateDirectorySearch=function(){b.publish(v.ACTIVATE_DIRECTORY_SEARCH)},e.onKeyDown=function(t,n){var r=s.getKeyCode(n);if(r===i.ESCAPE){if(e.query()){var o={source:l.search.reset.escapeKey};b.publish(v.RESET,o),e.hasFocus(!0),n.stopPropagation();return}e.hasFocus(!1),n.stopPropagation(),f.removeLastFocusedElement(),f.tryRestoreFocus();return}if(T.indexOf(r)>-1){if(r===i.ENTER&&(S.people===null||S.groups===null))return!1;(r===i.UP||r===i.DOWN||r===i.ENTER)&&s.swallow(n)}return!0},e.resetQuery=function(t,n){var r={source:l.search.reset.resetXButton};e.hasFocus(!0),b.publish(v.RESET,r),n&&n.preventDefault()},e.onReset=function(){e.query(d),e.showMoreResultsAvailableMessage(!1)},e.setFocus=e.hasFocus.bind(null,!0)}var t=e("vendor/knockout"),n=e("swx-constants").COMMON,r=e("swx-service-locator-instance").default,i=e("swx-constants").KEYS,s=e("utils/common/eventHelper"),o=e("swx-i18n").localization,u=e("swx-enums"),a=e("browser/window"),f=e("utils/common/applicationFocusManager"),l=e("ui/telemetry/actions/actionSources"),c=e("ui/telemetry/people/contactSearch"),h=e("ui/telemetry/people/contactSearchSession"),p=e("utils/common/accessibility").narrator,d="",v=n.events.search,m=n.apiUIEvents,g=n.events.narrowMode,y=18e5;return b}),define("text!views/search/input.html",[],function(){return'<div class="input" data-bind="css: { active: hasFocus() }, click: setFocus">\r\n    <div class="icon" data-bind="css: { showSpinner: showSpinner }">\r\n        <div class="iconfont search"></div>\r\n        <swx-loading-animation class="spinner small blue"></swx-loading-animation>\r\n    </div>\r\n	<input role="search" type="text" data-bind="visible: isEnabled, hasFocus: hasFocus, textInput: query, event: { keydown: onKeyDown }, enterKey: activateDirectorySearch, l10n_attr: { \'placeholder\': \'input_placeholder_searchSkype\'}, attr: { \'aria-label\': inputAriaLabel}" maxlength="250" value="" name="query" class="inputField fontSize-h4"/>\r\n	<button data-bind="visible: query().length, click: resetQuery, l10n_attr: { \'aria-label\': \'clear_search_input_label\'}" type="button" class="btn primary circle small transparent searchReset">\r\n        <span class="iconfont cross"></span>\r\n    </button>\r\n</div>\r\n<!-- ko if: showMoreResultsAvailableMessage() -->\r\n<div class="moreSearchResults">\r\n    <p class="strong" data-bind="l10n: {key: \'message_more_search_results_available\'}"></p>\r\n</div>\r\n<!-- /ko-->\r\n'}),define("ui/components/experience/searchInput",["require","exports","module","ui/viewModels/search/input","constants/components","text!views/search/input.html"],function(e,t){function r(){var e=new n;return e.init(),e}var n=e("ui/viewModels/search/input");t.name=e("constants/components").experience.SEARCH_INPUT,t.template=e("text!views/search/input.html"),t.viewModel={createViewModel:r}}),define("utils/common/scroll",[],function(){function i(i){function x(e){e.preventDefault()}function T(){S?(g.style.width=p+e,g.style.left=y.scrollLeft*c+e):(g.style.height=p+e,g.style.top=y.scrollTop*c+e)}function N(){s.update()}function C(e){S?y.scrollLeft=(e.pageX-v)*h:y.scrollTop=(e.pageY-v)*h}function k(e){w||(window.addEventListener("mouseup",L),window.addEventListener("mousemove",C),i.classList.add("scrolling"),v=S?e.pageX-g.offsetLeft:e.pageY-g.offsetTop,w=!0),x(e)}function L(){i.classList.remove("scrolling"),window.removeEventListener("mouseup",L),window.removeEventListener("mousemove",C),w=!1}function A(e){S?y.scrollLeft=M(e)+y.scrollLeft:y.scrollTop=M(e)+y.scrollTop}function O(e){S?y.scrollLeft=(e.pageX-d)*h:y.scrollTop=(e.pageY-d)*h,x(e)}function M(e){if(e.deltaY!=null)return e.deltaY>0?100:-100;if(e.originalEvent&&e.originalEvent.wheelDelta)return e.originalEvent.wheelDelta}function _(){g.addEventListener("mousedown",k),m.addEventListener("wheel",A),S&&y.addEventListener("wheel",A),m.addEventListener("mousedown",O)}function D(){g.removeEventListener("mousedown",k),m.removeEventListener("wheel",A),m.removeEventListener("mousedown",O),S&&y.removeEventListener("wheel",A)}function P(){var e="rail";m=document.createElement("div"),m.className=e+" "+(S?"railH":"railV"),m.innerHTML='<div class="slider"></div>',i.appendChild(m),i.classList.add("hyperscroll",S?"hyperscrollH":"hyperscrollV"),y=i.querySelector(".scrollViewport"),g=i.querySelector("."+e+" .slider")}function H(){m.innerHTML="",i.removeChild(m)}if(!i)throw new Error("Container must not be null");var s=this,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w=!1,E=!1,S=!1;s.resize=function(){a=o,f=u;if(S){o=i.offsetWidth,u=y.scrollWidth;if(f===u&&a===o)return;d=y.getBoundingClientRect().left}else{o=i.offsetHeight,u=y.scrollHeight;if(f===u&&a===o)return;d=y.getBoundingClientRect().top}c=o/u,p=o*c;if(p<t){l=o-t+p,c=l/u,h=u/l;return}h=u/o},s.update=function(){s.resize(),u>o?(s.show(),T()):s.hide()},s.connect=function(e,t){!b&&window.MutationObserver&&(b=new MutationObserver(t),b.observe(e,{childList:!0,subtree:!0}))},s.disconnect=function(){b&&(b.disconnect(),b=null)},s.show=function(){E||(i.classList.add("active"),_(),E=!0)},s.hide=function(){E&&(i.classList.remove("active"),D(),E=!1)},s.scrollToBottom=function(){S||(y.scrollTop=y.scrollHeight)},s.scrollToElement=function(e){e.offsetTop&&(y.scrollTop=e.offsetTop)},s.adjustToRTLLayout=function(){var t=document.createElement("div");t.style.cssText="position: absolute; overflow-y: scroll; width: 30px; visibility: hidden;",t.innerHTML='<div class="probe"></div>',t.classList.add("adjustWebkitScrollBarsLegacy"),i.appendChild(t);var s=t.querySelector(".probe"),o=t.getBoundingClientRect(),u=s.getBoundingClientRect(),a=Math.abs(o.left-u.left)<1,f=Math.abs(o.right-u.right)<1,l=a&&f;i.classList.remove(r),i.classList.remove(n),l?i.classList.add(r):a&&i.classList.add(n),t.innerHTML="",i.removeChild(t)},s.init=function(e){e=e||{},e.connect&&s.connect(i,s.update),e.horizontal&&(S=!0),s.adjustToRTLLayout(),P(),s.show(),s.update(),i.addEventListener("mouseenter",s.update),y.addEventListener("scroll",N)},s.dispose=function(){L(),i.removeEventListener("mouseenter",s.update),y.removeEventListener("scroll",N),s.disconnect(),s.hide(),H()}}var e="px",t=15,n="ltroverride",r="neutraloverride";return{build:function(e){return new i(e)}}}),define("ui/viewModels/search/results",["require","lodash-compat","vendor/knockout","swx-i18n","swx-constants","swx-service-locator-instance","ui/telemetry/actions/actionSources","utils/common/scroll"],function(e){function d(){function g(t){m?e.showDirectoryButton(t):e.showDirectoryButton(!1)}function y(){d.publish(a.interaction.SCROLL_START)}function b(){e.showSpinner(!1)}var e=this,d=s.resolve(i.serviceLocator.PUBSUB),v=s.resolve(i.serviceLocator.FEATURE_FLAGS),m=v.isFeatureOn(i.featureFlags.SKYPE_DIRECTORY_SEARCH);e.cssClass=n.observable(l),e.showSpinner=n.observable(!1),e.showDirectoryButton=n.observable(m),e.directoryButtonText=r.fetch({key:"button_text_searchDirectory"}),e.directorySearchActive=!1,e.selectedItem=n.observable(""),e.init=function(t){d.subscribe(c.QUERY_CHANGED,e.onQueryChanged),d.subscribe(c.DIRECTORY_SEARCH_RESULTS,e.onDirectorySearchResults),d.subscribe(c.LOCAL_SEARCH_RESULTS,b),d.subscribe(c.RESET,e.hideView),d.subscribe(c.ACTIVATE_DIRECTORY_SEARCH,e.activateDirectorySearch),d.subscribe(h.OPEN_CONVERSATION,e.onOpenConversation),p=u.build(t),p.init()},e.dispose=function(){d.unsubscribe(c.QUERY_CHANGED,e.onQueryChanged),d.unsubscribe(c.DIRECTORY_SEARCH_RESULTS,e.onDirectorySearchResults),d.unsubscribe(c.LOCAL_SEARCH_RESULTS,b),d.unsubscribe(c.RESET,e.hideView),d.unsubscribe(c.ACTIVATE_DIRECTORY_SEARCH,e.activateDirectorySearch),d.unsubscribe(h.OPEN_CONVERSATION,e.onOpenConversation),p.dispose()},e.onScroll=t.debounce(y,1e3,{leading:!0,trailing:!1}),e.onQueryChanged=function(t){t!==f&&e.showView()},e.onOpenConversation=function(){if(e.cssClass()===f){var t={source:o.search.reset.openConversation};d.publish(c.RESET,t)}},e.onDirectorySearchResults=function(){e.showSpinner(!1),g(!1)},e.activateDirectorySearch=function(){if(!m)return;e.showSpinner(!0),g(!1),e.directorySearchActive=!0,d.publish(c.DIRECTORY_SEARCH_ACTIVATED,e.showSpinner())},e.deactivateDirectorySearch=function(){e.showSpinner(!1),g(!0),e.directorySearchActive=!1,d.publish(c.DIRECTORY_SEARCH_DEACTIVATED,e.showSpinner())},e.hideView=function(){e.selectedItem(""),e.cssClass(l),e.deactivateDirectorySearch()},e.showView=function(){e.cssClass(f),e.showSpinner(!0),g(!e.directorySearchActive)}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-i18n").localization,i=e("swx-constants").COMMON,s=e("swx-service-locator-instance").default,o=e("ui/telemetry/actions/actionSources"),u=e("utils/common/scroll"),a=i.events,f="",l="hide",c=a.search,h=a.navigation,p;return d}),define("text!views/search/results.html",[],function(){return'<div class="results scrollable scrollViewport scrollViewportV fixSmall hide" data-bind="css: cssClass, event: { scroll: onScroll }" tabindex="-1">\r\n    <div class="scrollViewport-inner">\r\n        <div class="offScreen" role="tooltip" aria-live="polite" data-bind="text: selectedItem"></div>\r\n        <swx-messages-search></swx-messages-search>\r\n        <swx-people-search></swx-people-search>\r\n        <swx-group-search></swx-group-search>\r\n        <!-- ko if: showSpinner -->\r\n        <div class="grid container">\r\n            <swx-loading-animation data-bind="visible: showSpinner" class="spinner fog"></swx-loading-animation>\r\n        </div>\r\n        <!-- /ko -->\r\n        <!-- ko if: showDirectoryButton -->\r\n        <div class="grid container">\r\n            <div class="button row">\r\n                <button data-bind="click: activateDirectorySearch, l10n_attr: { \'aria-label\': \'input_searchSkypeDirectory_ariaLabel\', \'data-title\': \'input_searchSkypeDirectory_ariaLabel\' }" class="btn primary searchDirectory list-selectable" type="button">\r\n                    <span><!-- ko text: directoryButtonText -->&nbsp;<!-- /ko --></span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n        <!-- /ko -->\r\n        <swx-directory-search></swx-directory-search>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/experience/searchResults",["require","exports","module","ui/viewModels/search/results","constants/components","text!views/search/results.html"],function(e,t){function r(e,t){var r=new n;return r.init(t.element),r}var n=e("ui/viewModels/search/results");t.name=e("constants/components").experience.SEARCH_RESULTS,t.template=e("text!views/search/results.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/experience/selectBox",["require","exports","module","lodash-compat","swx-utils-common","swx-constants","browser/dom","utils/common/eventHelper","utils/common/eventMixin","swx-focus-handler","swx-i18n","swx-constants","vendor/knockout","utils/common/scroll","utils/common/accessibility","swx-utils-common"],function(e,t){function v(e){function N(){g&&a.get().addFocusRequestToQueue(y,a.Priorities.High)}function C(e){function r(t){return(new RegExp("^"+e,"i")).test(d.normalize(t.name))}window.clearTimeout(E),e===v?w=w<u.length-1?w+1:0:(w=0,n?u=t.selectOptions().filter(r):(e=v+e,u=u.filter(r))),n=!1,v=e,E=window.setTimeout(function(){n=!0},S)}function k(){t.selectBoxOpened(!0),p.announce({key:"accessibility_selectBox_expanded"}),A()}function L(){t.selectBoxOpened(!1),p.announce({key:"accessibility_selectBox_collapsed"}),O(),v="",n=!0,window.clearTimeout(E),N()}function A(){r.execute(function(){document.addEventListener(i.events.browser.CLICK,L),window.addEventListener(i.events.browser.RESIZE,L)})}function O(){document.removeEventListener(i.events.browser.CLICK,L),window.removeEventListener(i.events.browser.RESIZE,L)}var t=this,n=!0,u=[],v="",m,g=e.autoFocusAfterSelection||!1,y,b,w,E,S=700,x=".SelectBox-header",T=".SelectBox-scrollWrapper";t.selectOptions=e.selectOptions?e.selectOptions:[],t.selectedOption=e.selectedOption?e.selectedOption:c.observable(),t.showArrow=e.showArrow?e.showArrow:!0,t.selectBoxOpened=c.observable(!1),t.tabindex=e.tabindex?e.tabindex:null,t.disabled=e.disabled?e.disabled:c.observable(!1),t.selectBoxId=e.selectBoxId||null,e.placeholderKey?c.isObservable(e.placeholderKey)?t.placeholder=c.pureComputed(function(){return f.fetch({key:e.placeholderKey()})}):t.placeholder=f.fetch({key:e.placeholderKey}):e.placeholder?t.placeholder=e.placeholder:t.placeholder="",t.selectValue=function(e){t.selectedOption(e),L()},t.toggleSelectBox=function(){if(t.disabled())return!1;t.selectBoxOpened()?L():k()},t.dispose=function(){t.placeholder.dispose&&t.placeholder.dispose(),m.dispose(),O()},t.init=function(e){y=s.getElement(x,e),b=s.getElement(T,e),m=h.build(b),m.init(),t.registerEvent(i.events.selectBox.TOGGLE,t.toggleSelectBox)},t.listKeyDown=function(e,n){var r=o.getKeyCode(n);if(r===l.TAB&&t.selectBoxOpened()){L(),n.stopPropagation();return}return o.isNumPadKey(n)&&(C(o.getNumpadKey(n)),n.stopPropagation()),o.isAlphaNumericKey(n)&&(C(String.fromCharCode(r)),n.stopPropagation()),!0},t.onKeyDown=function(e,n){var r=o.getKeyCode(n);return r===l.TAB&&n.shiftKey&&t.selectBoxOpened()&&L(),(r===l.ENTER||r===l.SPACE)&&t.toggleSelectBox(),!0},t.onBoxClick=function(e,t){t.stopPropagation()}}var n=e("lodash-compat"),r=e("swx-utils-common").async,i=e("swx-constants").COMMON,s=e("browser/dom"),o=e("utils/common/eventHelper"),u=e("utils/common/eventMixin"),a=e("swx-focus-handler"),f=e("swx-i18n").localization,l=e("swx-constants").KEYS,c=e("vendor/knockout"),h=e("utils/common/scroll"),p=e("utils/common/accessibility").narrator,d=e("swx-utils-common").stringUtils;n.assign(v.prototype,u),t.build=function(e){return new v(e)}}),define("text!views/common/selectBox.html",[],function(){return'<div class="SelectBox-header" data-bind="\r\n        click: toggleSelectBox,\r\n        event: { keydown: onKeyDown },\r\n        attr: { \'aria-label\': selectedOption() ? selectedOption().name : placeholder }"\r\n        tabindex="0" role="combobox">\r\n    <span class="SelectBox-selectedName" data-bind="text: selectedOption() ? selectedOption().name : placeholder, attr: {title: selectedOption() ? selectedOption().name : placeholder}"></span>\r\n    <span class="SelectBox-selectedDescription" data-bind="text: selectedOption() ? selectedOption().description : \'\'"></span>\r\n    <span class="SelectBox-arrowIcon iconfont chevronDown" data-bind="visible: showArrow"></span>\r\n</div>\r\n<div class="SelectBox-options" data-bind="visible: selectBoxOpened, click:onBoxClick">\r\n    <div class="SelectBox-arrow"></div>\r\n    <div class="SelectBox-scrollWrapper" data-bind="keyboardNavigation: { itemSelector: \'.list-selectable\' }">\r\n        <div class="scrollViewport scrollViewportV" tabindex="-1">\r\n            <ul role="listbox" data-bind="foreach: selectOptions">\r\n                <li role="option" class="SelectBox-option list-selectable" data-option\r\n                    data-bind="click: $parent.selectValue,\r\n                        enterKey: $parent.selectValue,\r\n                        css: {selected: $parent.selectedOption() === $data },\r\n                        attr: {title: name, \'data-value\': value},\r\n                        event: {keydown: $parent.listKeyDown}">\r\n                    <span class="SelectBox-optionName" data-bind="text: name"></span>\r\n                    <span class="SelectBox-optionDescription"data-bind="text: description"></span>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/experience/selectBox",["require","exports","module","vendor/knockout","ui/viewModels/experience/selectBox","constants/components","text!views/common/selectBox.html"],function(e,t){function i(e,t){var i=r.build(e),s=t.element,o=n.dataFor(s);return i.setContext(o),i.init(s),i}var n=e("vendor/knockout"),r=e("ui/viewModels/experience/selectBox");t.name=e("constants/components").experience.SELECT_BOX,t.template=e("text!views/common/selectBox.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/buttons/toggle",[],function(){function e(e){this.checked=e.checked,this.ariaLabel=e.ariaLabel,this.labelledById=e.labelledById,this.onClick=e.click||function(){},this.disabled=e.disabled}return e.build=function(t){return new e(t)},e}),define("text!views/common/buttons/toggleButton.html",[],function(){return'<button class="ToggleButton" type="button" role="checkbox" aria-relevant="all"\r\n        data-bind="disable: disabled, css: { \'ToggleButton--checked\': checked }, click: onClick, attr: {\'aria-label\': ariaLabel, \'aria-checked\': checked, \'aria-labelledby\': labelledById }">\r\n</button>\r\n'}),define("ui/components/experience/toggleButton",["require","exports","module","constants/components","ui/viewModels/buttons/toggle","text!views/common/buttons/toggleButton.html"],function(e,t){t.name=e("constants/components").experience.TOGGLE_BUTTON,t.viewModel=e("ui/viewModels/buttons/toggle"),t.template=e("text!views/common/buttons/toggleButton.html")}),define("notifications/settings",["require","exports","module","lodash-compat","vendor/knockout","swx-constants","swx-service-locator-instance","swx-cafe-application-instance"],function(e,t){function h(){var e=this,t;e.value=r.observable(!1),e.init=function(n){c&&(t=p(n),e.value(d(t)))}}function p(e){var t,r,i;return t=o.get().personsAndGroupsManager.mePerson,r=t.preferences(),i=n.find(r,{description:{id:e}}),i===void 0?void 0:i.value()}function d(e){return e===undefined?!1:!e}var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("swx-constants").COMMON,s=e("swx-service-locator-instance").default,o=e("swx-cafe-application-instance"),u=new h,a=new h,f=new h,l=new h,c;t.init=function(){var e=s.resolve(i.serviceLocator.FEATURE_FLAGS),t=i.userSettings.preferences;c=e.isFeatureOn(i.featureFlags.NOTIFICATIONS_SETTINGS_ENABLED),u.init(t.NOTIFICATIONS),a.init(t.NOTIFICATIONS_SOUND),f.init(t.CHAT_NOTIFICATIONS_SOUND),l.init(t.CALL_NOTIFICATIONS)},t.chatNotificationsMuted=u.value,t.notificationsSoundMuted=a.value,t.chatNotificationsSoundMuted=f.value,t.callNotificationsMuted=l.value}),define("telemetry/notifications/notificationActions",["require","exports","module","ui/telemetry/telemetryClient","experience/settings","swx-constants"],function(e,t){function s(){function e(e){var t=i.telemetry.notificationActionsEvent.TYPE,s={};s.type=e.type,s.action=e.action,n.get().sendEvent(r.telemetry.uiTenantToken,t,s)}return{send:e}}var n=e("ui/telemetry/telemetryClient"),r=e("experience/settings"),i=e("swx-constants").COMMON;t.build=function(){return new s}}),define("notifications/common/notification",["require","vendor/knockout","lodash-compat","ui/controls/calling/sounds","swx-constants","notifications/settings","swx-utils-common","telemetry/notifications/notificationActions"],function(e){var t=e("vendor/knockout"),n=e("lodash-compat"),r=e("ui/controls/calling/sounds"),i=e("swx-constants").COMMON,s=i.telemetry.notificationActionsEvent,o=e("notifications/settings"),u=e("swx-utils-common").url,a=e("telemetry/notifications/notificationActions");return function(e,f,l,c){function y(){return{isDelayedNotification:!!h.wasDelayed,displayType:h.displayType}}function b(e){return e=w(e),e}function w(e){if(!!e.avatar){var n=typeof e.avatar=="function"?e.avatar():e.avatar;n.indexOf("returnDefaultImage=false")>-1&&(n=u.removeQueryParameter(n,"returnDefaultImage")),e.avatar=typeof e.avatar=="function"?t.observable(n):n}return e}function E(){v=h.active.subscribe(function(e){v.dispose(),e||h.sound.stop()})}function S(e){return e&&e.key}function x(){return o.notificationsSoundMuted()?!1:!o.chatNotificationsSoundMuted()||e!==i.notifications.CHAT&&e!==i.notifications.UNREAD_MESSAGE?!0:!1}function T(){return!!h.isUnreadMessage}var h=this,p=S(c)?c.key:r.KEYS.MESSAGE_RECEIVED_1,d=S(c)?c.loop:!1,v,m=a.build(),g={type:e};this.type=e,this.sender=b(n.clone(f)||{}),l=l||{},this.title=t.observable(""),this.description=t.observable(""),this.active=t.observable(),this.canPlaySound=x(),this.accept=function(){g.action=s.action.accept,h.active()&&l.accept&&(T()&&(arguments[0]=y()),l.accept.apply(null,arguments),m.send(g)),h.active(!1)},this.decline=function(){g.action=s.action.decline,h.active()&&l.decline&&(l.decline(y()),m.send(g)),h.active(!1)},this.open=function(){g.action=s.action.open,h.active()&&l.open&&(l.open(y()),m.send(g)),h.active(!1)},this.sound={play:function(){h.active()&&h.canPlaySound&&(d?r.playLoop(p):r.playOnce(p),E())},stop:function(){r.stop(p)}}}}),define("notifications/common/sender",["require","exports","module","swx-utils-chat","utils/common/cafeObservable","vendor/knockout","lodash-compat","swx-utils-common","swx-enums","swx-i18n","experience/settings","swx-constants","swx-utils-common","swx-service-locator-instance"],function(e,t){function p(e){var t,r=a.fetch({key:"notification_text_group_conversation_from"});if(!e.topic()){var o=e.participants(0);o?t=r+" "+o.person.displayName():t=r}else t=n.getSanitizedTopic(e.topic());return i.observable(s.unescape(t))}function d(e){return e.isGroupConversation()?{uri:i.observable("local:"+o.create()),status:i.observable(u.Unknown),displayName:p(e),avatar:m(e.avatarUrl,f.assetsBaseUrl+"/images/avatars/default-avatar-group.png")}:v(e.participants(0).person)}function v(e){return{uri:r.newObservableProperty(e.id),status:r.newObservableProperty(e.status),displayName:i.observable(s.unescape(e.displayName())),avatar:m(e.avatarUrl,f.assetsBaseUrl+"/images/avatars/default-avatar-contact.png")}}function m(e,t){var n=h.resolve(l.serviceLocator.FEATURE_FLAGS),r=t;return!n.isFeatureOn(l.featureFlags.SHOW_DEFAULT_AVATAR_IN_NOTIFICATIONS)&&e()&&(r=c.removeQueryParameter(e(),"returnDefaultImage")),i.observable(r)}var n=e("swx-utils-chat").messageSanitizer,r=e("utils/common/cafeObservable"),i=e("vendor/knockout"),s=e("lodash-compat"),o=e("swx-utils-common").guid,u=e("swx-enums").onlineStatus,a=e("swx-i18n").localization,f=e("experience/settings"),l=e("swx-constants").COMMON,c=e("swx-utils-common").url,h=e("swx-service-locator-instance").default;t.fromConversation=d,t.fromPerson=v}),define("notifications/ringingDeferrer/ringingDeferrerSetting",["require","swx-enums"],function(e){function n(e,n){var r=this;r.option=e||t.Unset,r.untilTimestamp=n||0}var t=e("swx-enums").ringingDeferrerOptions;return n}),define("notifications/ringingDeferrer/ringingDeferrerUtil",["require","exports","module","lodash-compat","ui/telemetry/actions/actionNames","swx-cafe-application-instance","jskype-settings-instance","swx-constants","swx-enums","notifications/ringingDeferrer/ringingDeferrerSetting","swx-service-locator-instance"],function(e,t){function l(){if(t.isFeatureEnabled())return i.get().personsAndGroupsManager.mePerson.preferences(o.userSettings.preferences.DEFER_RINGING_SOUND)}function c(){var e=t.getCurrentSetting();return e&&e.option!==u.ringingDeferrerOptions.Unset?e.untilTimestamp:0}function h(e){var t=f.resolve(o.serviceLocator.ACTION_TELEMETRY);t.recordAction(r.notificationsSettings.changeRingingDeferrerSetting,{option:e})}var n=e("lodash-compat"),r=e("ui/telemetry/actions/actionNames"),i=e("swx-cafe-application-instance"),s=e("jskype-settings-instance"),o=e("swx-constants").COMMON,u=e("swx-enums"),a=e("notifications/ringingDeferrer/ringingDeferrerSetting"),f=e("swx-service-locator-instance").default;t.isFeatureEnabled=function(){return s.isFeatureOn(o.featureFlags.RINGING_DEFERRING)},t.getCurrentSetting=function(){var e=l();if(e){var t=e.value();if(n.has(t,"option")&&n.has(t,"untilTimestamp"))return t}},t.areRingingSoundsDeferred=function(){return(new Date).getTime()<c()},t.applyOption=function(e){function r(e){var t=36e5;return e?(new Date).getTime()+e*t:0}var t=l();if(!t)return Promise.reject();var n=t.value();return e===u.ringingDeferrerOptions.Unset&&n&&n.option===e?Promise.resolve():(n=new a(e,r(e)),h(e),t.value.set(n))}}),define("notifications/types/incomingCall",["require","ui/telemetry/actions/actionNames","swx-browser-detect","ui/viewModels/calling/helpers/callingFacade","swx-constants","notifications/common/notification","swx-pubsub-instance","notifications/common/sender","swx-service-locator-instance","ui/controls/calling/sounds","notifications/ringingDeferrer/ringingDeferrerUtil","swx-cafe-application-instance"],function(e){function h(e,h){function y(){var e=n.getBrowserInfo().browserName===n.BROWSERS.CHROME,t=n.getSystemInfo().osName===n.OPERATING_SYSTEMS.LINUX,r=p.isFeatureOn(i.featureFlags.PLUGINLESS_VIDEO_CALLING_CHROME_LINUX),s=p.isFeatureOn(i.featureFlags.CAN_NOTIFY_WITHOUT_VIDEO);return e&&t&&!r&&s?i.notifications.AUDIO_WITHOUT_VIDEO:i.notifications.AUDIO}function b(n,s){var o=s?t.audioVideo.acceptWithVideo:t.audioVideo.acceptWithAudio,u=a.resolve(i.serviceLocator.ACTION_TELEMETRY);u.recordAction(o),n?r.acceptCall(e,s):r.installPlugin(v,e,!1,s)}function w(){var n=a.resolve(i.serviceLocator.ACTION_TELEMETRY);n.recordAction(t.audioVideo.reject),r.rejectCall(e)}function E(){if(!p.isFeatureOn(i.featureFlags.CALL_NOTIFICATIONS_SOUND_SETTINGS_ENABLED))return!1;var e=c.get().personsAndGroupsManager.mePerson.preferences(i.userSettings.preferences.CALL_NOTIFICATIONS_SOUND);return e?!e.value():!1}var p=a.resolve(i.serviceLocator.FEATURE_FLAGS),d=y(),v="incoming",m={key:f.KEYS.CALL_INCOMING,loop:!0},g={accept:function(t){t===i.modalityType.AUDIO||!t?b(h,!1):t===i.modalityType.VIDEO?b(h,!0):t===i.modalityType.CHAT&&(w(),o.publish(i.events.navigation.OPEN_CONVERSATION,{model:e}))},decline:w},S=new s(d,u.fromConversation(e),g,m);return S.canPlaySound&&(l.areRingingSoundsDeferred()||E())&&(S.canPlaySound=!1),S}var t=e("ui/telemetry/actions/actionNames"),n=e("swx-browser-detect").default,r=e("ui/viewModels/calling/helpers/callingFacade"),i=e("swx-constants").COMMON,s=e("notifications/common/notification"),o=e("swx-pubsub-instance").default,u=e("notifications/common/sender"),a=e("swx-service-locator-instance").default,f=e("ui/controls/calling/sounds"),l=e("notifications/ringingDeferrer/ringingDeferrerUtil"),c=e("swx-cafe-application-instance");return{build:h}}),define("notifications/types/hardware",["require","notifications/common/notification"],function(e){function n(e,n){var r=new t(e);return r.title(n),r}var t=e("notifications/common/notification");return{build:n}}),define("notifications/types/avatar",["require","notifications/common/notification"],function(e){function n(e,n){var r=new t(e);return r.title(n),r}var t=e("notifications/common/notification");return{build:n}}),define("notifications/types/callingNotSupported",["require","notifications/common/notification","swx-constants","swx-utils-people","constants/calling.resources","swx-i18n"],function(e){function o(e,t){var n=i.linkTemplate,o=s.fetch({key:"notification_text_learnMore"}),u=r.stripAnchors(t),a=r.sanitizeXml(u);return e.replace("{callerName}",a)+" "+n.replace("{notification_text_learnMore}",o)}function u(e,r){var i,u;e?i=s.fetch({key:"notification_text_osNotSupported"}):i=s.fetch({key:"notification_text_browserNotSupported"}),u=o(i,r.topic());var a=new t(n.notifications.WARNING);return a.title(u),a}var t=e("notifications/common/notification"),n=e("swx-constants").COMMON,r=e("swx-utils-people").userDataProcessor,i=e("constants/calling.resources").notifications.incomingCall,s=e("swx-i18n").localization;return{build:u}}),define("notifications/telemetry/browserToastTelemetry",["require","swx-constants","experience/settings","ui/telemetry/telemetryClient","services/telemetry/common/telemetryContext","utils/common/appVisibilityProvider","swx-browser-globals","swx-cafe-application-instance"],function(e){function f(e){function h(){return{isGroupConversation:l,hasAvatar:l,activeEndpointsCount:l,currentUnreadMessageCount:l,timeInStale:l,isMau:l,isSeen:l,toastType:l,pastUnreadMessages:l,activeUnreadMessages:l,unreadState:l,DauCandidate:l,MauCandidate:l,isDelayedNotification:l,notificationQueueLength:l,notificationDisplayType:l,unreadConversationsCount:l,isDecline:l}}function p(e){for(var t in e)e.hasOwnProperty(t)&&!(typeof e[t]=="string"||e[t]instanceof String)&&(e[t]=e[t]+"");return e}function d(e,r){function p(){if(!e.historyService)return;var t=e.historyService.activityItems().filter(function(e){return!e.isRead()}).sort(function(e,t){return e.timestamp()>t.timestamp()});return t.length===0?l:g(t[0].timestamp())}function d(){return a?a.sidebar&&a.sidebar.lastTimeOpened?g(new Date(a.sidebar.lastTimeOpened))<=30:!1:l}function v(){return a?a.sidebar&&a.sidebar.lastTimeOpened?g(new Date(a.sidebar.lastTimeOpened))>30:!1:l}function m(){if(!a)return l;if(a.sidebar&&a.sidebar.lastTimeOpened){var e=g(new Date(a.sidebar.lastTimeOpened));return e>1&&e<=30}return!1}function g(e){var t=864e5;return Math.round(Math.abs((Date.now()-e)/t))}function y(){return c._unreadConversationsCount?c._unreadConversationsCount():l}var i=h(),a,f=u.getWindow().localStorage.getItem(t.telemetry.idleUsersAnalytics.localKeys.sidebarActivity);return f&&(a=JSON.parse(f)),!e.historyService||(i.isGroupConversation=e.isGroupConversation(),i.hasAvatar=!!e.avatarUrl()&&e.avatarUrl().length>0,i.currentUnreadMessageCount=e.historyService.unreadActivityItemsCount(),i.timeInStale=p()),i.activeEndpointsCount=s.get().activeEndpoints.length,i.isSeen=o.hasFocus(),i.isMau=d(),i.MauCandidate=v(),i.DauCandidate=m(),i.toastType=n.toastType.INDIVIDUAL,r.isDelayedNotification!==undefined&&(i.isDelayedNotification=!!r.isDelayedNotification),r.notificationQueueLength!==undefined&&(i.notificationQueueLength=r.notificationQueueLength),r.displayType!==undefined&&(i.notificationDisplayType=r.displayType),r.displayNameResolved!==undefined&&(i.displayNameResolved=r.displayNameResolved),r.isDecline!==undefined&&(i.isDecline=r.isDecline),i.unreadConversationsCount=y(),i}function v(e){function t(t){var r=t[0]||0,i=t[1]||0,s=l;return r===0&&i===0?s=n.unreadState.NONE:r>0&&i===0?s=n.unreadState.PASSIVE:r===0&&i>0?s=n.unreadState.ACTIVE:r>0&&i>0&&(s=n.unreadState.BOTH),e.pastUnreadMessages=r,e.activeUnreadMessages=i,e.unreadState=s,e}return c._unreadCounversationsCounters?c._unreadCounversationsCounters().then(t):Promise.reject(e)}var f=this,l=t.telemetry.NOT_AVAILABLE,c=a.get().conversationsManager;f.publish=function(t,n,s){function o(t){var n=p(t);i.get().sendEvent(r.telemetry.chatTenantToken,e,n),s&&s()}if(!t)return;if(!e)return;var u=d(t,n);v(u).then(o,o)}}var t=e("swx-constants").COMMON,n=t.telemetry.browserToast,r=e("experience/settings"),i=e("ui/telemetry/telemetryClient"),s=e("services/telemetry/common/telemetryContext"),o=e("utils/common/appVisibilityProvider"),u=e("swx-browser-globals"),a=e("swx-cafe-application-instance");return f.build=function(e){if(!e)return;return new f(e)},f}),define("notifications/types/unreadMessage",["require","notifications/common/notification","notifications/common/sender","swx-pubsub-instance","swx-constants","swx-i18n","swx-cafe-application-instance","swx-service-locator-instance","notifications/telemetry/browserToastTelemetry"],function(e){function f(e){function l(t){if(e.likeAdded)return t?n.fromConversation(d):n.fromPerson(p.person);var r=e.summary||{},i=r.secondTopicGoesFirst;if(t&&!i)return n.fromConversation(d);var s=i?r.secondConversation.participants()[0].person:p.person||p.sender;return n.fromPerson(s)}function c(){if(b&&m){var t=e.summary.unreadConversations||[d],n="",r,i,o,u=s.fetch({key:"label_text_agent_profile_capabilities_join_char"});return t.forEach(function(e){e.isGroupConversation()?n+=n===""?e.topic():u+e.topic():(r=e.participants&&e.participants()[0],i=r.person.firstName(),n+=n===""?i:u+i)}),o={key:"newSummaryOwaToast",params:{name:n}},s.fetch(o)}return e.likeAdded?v?s.fetch({key:"hearts_notification_messageGroup",params:{participantName:p.person.displayName(),messageText:p.text()}}):s.fetch({key:"hearts_notification_messageConv",params:{messageText:p.text()}}):p.text()}function N(t){h={model:d,origin:i.telemetry.historyLoadOrigin.NOTIFICATION_CONV},w&&E&&(h.origin=i.telemetry.historyLoadOrigin.MENTION_ME),e.likeAdded&&(h.messageId=p.id),r.publish(i.events.navigation.OPEN_CONVERSATION,h),f.publish(d,t||{})}var f=a.build(i.telemetry.browserToast.EVENTS.CLICKED),h,p=e.message,d=e.conversation,v=d.isGroupConversation(),m=e.summary&&e.summary.show,g=l(v),y=u.resolve(i.serviceLocator.FEATURE_FLAGS),b=y.isFeatureOn(i.featureFlags.CHAT_MESSAGE_TYPE_NOTIFICATION_ENABLED),w=y.isFeatureOn(i.featureFlags.MENTIONS_ENABLED),E=e.likeAdded?!1:i.mentions.meIdentifier.test(p.html()),S=w&&o.get().personsAndGroupsManager.mePerson.preferences(i.userSettings.preferences.MENTIONS).value(),x,T;b?(x=i.notifications.CHAT,T={accept:N,decline:function(e){e=e||{},e.isDecline=!0,f.publish(d,e)}},m&&g.displayName(c())):(x=i.notifications.UNREAD_MESSAGE,T={open:N});var C=new t(x,g,T);return b&&(C.autoDeactivation=!0),C.description(m?"":c()),E&&w&&S&&C.title(s.fetch({key:"mention_notification_title",params:{participant:g.displayName(),chat:d.topic()}})),C}var t=e("notifications/common/notification"),n=e("notifications/common/sender"),r=e("swx-pubsub-instance").default,i=e("swx-constants").COMMON,s=e("swx-i18n").localization,o=e("swx-cafe-application-instance"),u=e("swx-service-locator-instance").default,a=e("notifications/telemetry/browserToastTelemetry");return{build:f}}),define("notifications/types/unreadMessageReminder",["require","notifications/common/notification","swx-constants","swx-i18n","experience/settings","vendor/knockout","swx-service-locator-instance","notifications/telemetry/browserToastTelemetry","utils/common/localStorage"],function(e){function c(e){function h(e,t){return{uri:s.observable(""),status:s.observable(""),displayName:s.observable(t?b.description:""),avatar:s.observable(e)}}function p(){function t(e){return e?!/^19:/.test(e.id):!1}var n=e.length&&t(e[0])?e[0].id.replace(/^\d+:/,""):undefined,s=n?encodeURIComponent(n):"thread",o=i.avatarService.host+i.avatarService.publicAvatarEndpoint.replace("${contactId}",s);return{description:r.fetch({key:"newChatsSessionOwaToast",count:e.length}),avatar:o.replace("returnDefaultImage=false","returnDefaultImage=true")}}function d(t,n){var r=u.build(t);n?n.displayNameResolved=c:n={displayNameResolved:c},r.publish(e[0],n)}var c=f,v=o.resolve(n.serviceLocator.FEATURE_FLAGS),m=v.isFeatureOn(n.featureFlags.CHAT_MESSAGE_TYPE_NOTIFICATION_ENABLED),g,y,b=p(),w=h(b.avatar,m);m?(g=n.notifications.CHAT,y={accept:function(e){d(l.EVENTS.CLICKED,e||{})},decline:function(e){a.set(l.ignore.TIMEOUT_KEY,Date.now()+l.ignore.TIMEOUT),e=e||{},e.isDecline=!0,d(l.EVENTS.CLICKED,e)}}):(g=n.notifications.UNREAD_MESSAGE,y={open:function(e){d(l.EVENTS.CLICKED,e||{})}});var E=new t(g,w,y);return m||E.description(b.description),E.displayType=l.displayType.REMINDER,E.publishUnreadMessageTelemetry=d.bind(null,l.EVENTS.SHOWN),E.isUnreadMessage=!0,E}var t=e("notifications/common/notification"),n=e("swx-constants").COMMON,r=e("swx-i18n").localization,i=e("experience/settings"),s=e("vendor/knockout"),o=e("swx-service-locator-instance").default,u=e("notifications/telemetry/browserToastTelemetry"),a=e("utils/common/localStorage"),f="n/a",l=n.telemetry.browserToast;return{build:c}}),define("notifications/types/contactRequest",["require","swx-cafe-application-instance","notifications/common/notification","swx-pubsub-instance","swx-constants","swx-enums"],function(e){function o(e){function h(){r.publish(i.events.navigation.OPEN_CONVERSATION,{model:o,origin:i.telemetry.historyLoadOrigin.NOTIFICATION_CONV})}function p(){var e=u.sender;t.get().personsAndGroupsManager.all.persons.add(e,e.id(),undefined,s.activityType.ContactRequestIncoming),h()}function d(){t.get().conversationsManager.conversations.remove(o,s.activityType.ContactRequestIncoming)}var o=e.conversation,u=e.activityItem,a,f=i.notifications.CONTACT_REQUEST,l,c;return l={uri:u.sender.id,status:u.sender.status,displayName:u.sender.displayName,avatar:u.sender.avatarUrl,capabilities:u.sender.capabilities},c={accept:p,decline:d,open:h},a=new n(f,l,c),a.description(u.greeting()),a.title(u.sender.title()),a}var t=e("swx-cafe-application-instance"),n=e("notifications/common/notification"),r=e("swx-pubsub-instance").default,i=e("swx-constants").COMMON,s=e("swx-enums");return{build:o}}),define("notifications/types/chatRequest",["require","swx-cafe-application-instance","swx-constants","swx-pubsub-instance","notifications/common/notification","notifications/common/sender","swx-enums"],function(e){function u(e){var u=e.conversation,a,f={accept:function(){u.chatService.accept.enabled()?u.chatService.accept():u.chatService.start.enabled()&&u.chatService.start(),r.publish(n.events.navigation.OPEN_CONVERSATION,{model:u}),r.publish(n.events.narrowMode.SHOW_SIDEBAR)},decline:function(){u.chatService.reject.enabled()&&u.chatService.reject(),u.isGroupConversation()&&t.get().conversationsManager.conversations.remove(u)}};return a=new i(n.notifications.CHAT,s.fromConversation(u),f),u.historyService.activityItems.filter(function(e){e.type()===o.activityType.TextMessage&&(a.description(e.text()),a.title(e.sender.title()))}),a}var t=e("swx-cafe-application-instance"),n=e("swx-constants").COMMON,r=e("swx-pubsub-instance").default,i=e("notifications/common/notification"),s=e("notifications/common/sender"),o=e("swx-enums");return{build:u}}),define("notifications/types/education",["require","notifications/common/notification","swx-constants","experience/settings","vendor/knockout"],function(e){function s(e){if(!e||!e.educationalMessage)return;var s=n.notifications.UNREAD_MESSAGE,o=r.assetsBaseUrl+"/images/icons/skypeLogo.png",u={avatar:i.observable(e.iconUrl||o),uri:i.observable(""),displayName:i.observable("")},a=e.clickAction?{open:e.clickAction}:void 0,f=new t(s,u,a);return f.description(e.educationalMessage),e.showAction&&(f.onshow=e.showAction),f}var t=e("notifications/common/notification"),n=e("swx-constants").COMMON,r=e("experience/settings"),i=e("vendor/knockout");return{build:s}}),define("notifications/factory",["require","swx-constants","swx-i18n","notifications/types/incomingCall","notifications/types/hardware","notifications/types/avatar","notifications/types/callingNotSupported","notifications/types/unreadMessage","notifications/types/unreadMessageReminder","notifications/types/contactRequest","notifications/types/chatRequest","notifications/types/education"],function(e){function h(e,h){var p=t.notifications;switch(e){case p.INCOMING_CALL:return r.build(h.conversation,!0);case p.INCOMING_CALL_WITH_NO_PLUGIN:return r.build(h.conversation,!1);case p.DEVICE_MISSING_CAMERA:return i.build(p.WARNING,n.fetch({key:"notification_text_hardware_camera"}));case p.DEVICE_MISSING_MICROPHONE:return i.build(p.WARNING,n.fetch({key:"notification_text_hardware_mic"}));case p.DEVICE_MISSING_SPEAKER:return i.build(p.ERROR,n.fetch({key:"notification_text_hardware_speaker"}));case p.INCOMING_CALL_BROWSER_NOT_SUPPORTED:return o.build(!1,h.conversation);case p.INCOMING_CALL_OS_NOT_SUPPORTED:return o.build(!0,h.conversation);case p.UNREAD_MESSAGE:return h.isReminderToast?a.build(h.unreadConversations):h.educationalMessage?c.build(h):u.build(h);case p.CONTACT_REQUEST:return f.build(h);case p.CHAT:return l.build(h);case p.AVATAR_NOT_SUPPORTED_IMAGE_TYPE:return s.build(p.ERROR,n.fetch({key:"notification_text_avatar_not_supported_image_type"}));case p.AVATAR_TOO_LARGE:return s.build(p.ERROR,n.fetch({key:"notification_text_avatar_too_large"}));case p.AVATAR_UPLOAD_ERROR:return s.build(p.ERROR,n.fetch({key:"notification_text_avatar_upload_error"}))}}var t=e("swx-constants").COMMON,n=e("swx-i18n").localization,r=e("notifications/types/incomingCall"),i=e("notifications/types/hardware"),s=e("notifications/types/avatar"),o=e("notifications/types/callingNotSupported"),u=e("notifications/types/unreadMessage"),a=e("notifications/types/unreadMessageReminder"),f=e("notifications/types/contactRequest"),l=e("notifications/types/chatRequest"),c=e("notifications/types/education");return{build:h}}),define("ui/viewModels/experience/avatarFilePicker",["require","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","vendor/knockout","swx-constants","swx-cafe-application-instance","swx-i18n","notifications/factory","notifications/common/notificationHub","swx-service-locator-instance","browser/dom"],function(e){function c(e,c){function g(e){var t=new window.FileReader;b(e)&&(t.onload=function(){var e=t.result;y(e,function(e){h.conversation&&h.conversation.isGroupConversation()&&h.conversation._setGroupAvatar?S(e):x(e)})},t.readAsDataURL(e))}function y(e,t){var n=new window.Image;n.addEventListener("load",function(){var e=document.createElement("canvas"),r=e.getContext("2d"),i=n.height,s=n.width,o=256,u;e.width=o,e.height=o,s===i?r.drawImage(n,0,0,o,o):s>i?(s=Math.floor(o*s/i),i=o,u=Math.floor((s-o)/2),r.drawImage(n,-u,0,s,i)):s<i&&(i=Math.floor(o*i/s),s=o,u=Math.floor((i-o)/2),r.drawImage(n,0,-u,s,i)),e.toBlob(t,"image/jpeg",1)},!1),n.setAttribute("src",e)}function b(e){return e===null?!1:w(e.type)?E(e.size)?!0:(a.notify(u.build(i.notifications.AVATAR_TOO_LARGE)),!1):(a.notify(u.build(i.notifications.AVATAR_NOT_SUPPORTED_IMAGE_TYPE)),!1)}function w(e){var t=["image/gif","image/png","image/jpeg"];return t.indexOf(e)>-1}function E(e){return e/1048576<2}function S(e){h.avatarUploadDisabled(!0),h.conversation._setGroupAvatar(e).then(function(){h.avatarUploadDisabled(!1)},function(){a.notify(u.build(i.notifications.AVATAR_UPLOAD_ERROR)),h.avatarUploadDisabled(!1)})}function x(e){var t=new window.FileReader,n=e.type;t.onload=function(t){var r=t.target.result;h.avatarUploadDisabled(!0),p.updateAvatar(r,n).then(function(){var t=new window.FileReader;t.onload=function(e){p.updateAvatarUrl(e.target.result)},t.readAsDataURL(e),h.avatarUploadDisabled(!1)},function(){a.notify(u.build(i.notifications.AVATAR_UPLOAD_ERROR)),h.avatarUploadDisabled(!1)})},t.readAsArrayBuffer(e)}var h=this,p=s.get().personsAndGroupsManager.mePerson,d={source:n.me.avatar},v=f.resolve(i.serviceLocator.ACTION_TELEMETRY),m=l.getElement(".avatarFilePickerInput",c);h.conversation=e?e.conversationModel:null,h.avatarUploadSupported=!!window.FormData&&!!window.FileReader,h.avatarUploadDisabled=r.observable(!h.avatarUploadSupported),h.uploadProfilePictureText=h.conversation&&h.conversation.isGroupConversation()?o.fetch({key:"group_avatar_uploadProfilePictureText"}):o.fetch({key:"me_avatar_uploadProfilePictureText"}),h.uploadProfilePictureAriaLabel=o.fetch({key:"me_avatar_uploadProfilePictureAriaLabel"}),h.openFilePickerInput=function(){m.click()},h.checkUploadEnabled=function(e,n){return v.recordAction(t.me.avatarFilePickerClicked,d),n.stopPropagation(),!h.avatarUploadDisabled()},h.processFiles=function(e,t){g(t.target.files[0]),t.target.value=null}}var t=e("ui/telemetry/actions/actionNames"),n=e("ui/telemetry/actions/actionSources"),r=e("vendor/knockout"),i=e("swx-constants").COMMON,s=e("swx-cafe-application-instance"),o=e("swx-i18n").localization,u=e("notifications/factory"),a=e("notifications/common/notificationHub"),f=e("swx-service-locator-instance").default,l=e("browser/dom");return c.build=function(e,t){return new c(e,t)},c}),define("text!views/experience/avatarFilePicker.html",[],function(){return'<div data-bind="visible: avatarUploadSupported">\r\n    <input type="file" accept="image/*" class="avatarFilePickerInput"\r\n        data-bind="event: {click: checkUploadEnabled,\r\n                change: processFiles}"/>\r\n    <button class="avatarOpenFilePickerInput" data-bind="click: openFilePickerInput,\r\n            attr: {\r\n                title: uploadProfilePictureText,\r\n                \'aria-label\': uploadProfilePictureAriaLabel\r\n            }"></button>\r\n    <span class="avatarFilePickerButton">\r\n        <span class="btn primary circle protected picturePickerBtn">\r\n            <span class="iconfont picturePicker picture"></span>\r\n        </span>\r\n    </span>\r\n</div>\r\n'}),define("ui/components/experience/avatarFilePicker",["require","exports","module","ui/viewModels/experience/avatarFilePicker","constants/components","text!views/experience/avatarFilePicker.html"],function(e,t){function r(e,t){var r=n.build(e,t.element);return r}var n=e("ui/viewModels/experience/avatarFilePicker");t.name=e("constants/components").experience.AVATAR_FILE_PICKER,t.template=e("text!views/experience/avatarFilePicker.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/experience/eduCarousel",["require","exports","module","vendor/knockout","swx-service-locator-instance","swx-constants","experience/settings","swx-i18n","utils/common/localStorage","ui/telemetry/telemetryClient"],function(e,t){function l(){function v(e,t){a.get().sendEvent(s.telemetry.uiTenantToken,e,t||{})}function m(e){var t=e===null||e===h.length?0:e;return h[t]}function g(){var e=u.get(p),t=parseInt(e,10);return e===null||isNaN(t)?null:t}var e=this,t=r.resolve(i.serviceLocator.FEATURE_FLAGS),l=t.isFeatureOn(i.featureFlags.SHOW_EDU_CAROUSEL),c=r.resolve(i.serviceLocator.PUBSUB),h=[{id:"1",name:"conversation",header:o.fetch({key:"splashScreen_eduCarousel_conversation_header"}),text:o.fetch({key:"splashScreen_eduCarousel_conversation_text"})},{id:"2",name:"findFriends",header:o.fetch({key:"splashScreen_eduCarousel_find_friends_header"}),text:o.fetch({key:"splashScreen_eduCarousel_find_friends_text"})}],p="eduCarouselLastSeenId",d;e.isVisible=n.observable(!1),e.itemName=n.observable(),e.itemHeader=n.observable(),e.itemText=n.observable(),e.init=function(){if(!l)return;var t=g();e.showItem(m(t)),c.subscribe(f.action.HIDE,e.hideCarousel)},e.showItem=function(t){if(!t)return;e.itemName(t.name),e.itemHeader(t.header),e.itemText(t.text),e.isVisible(!0),d=new Date,v(f.telemetry.START,{displayed:t.name}),u.set(p,t.id)},e.hideCarousel=function(t){e.isVisible(!1),c.unsubscribe(f.action.HIDE,e.hideCarousel),d&&(v(f.telemetry.FINISH,{displayedTimeSeconds:Math.round((new Date-d)/1e3),origin:t}),d=null)},e.dispose=function(){e.isVisible(!1)}}var n=e("vendor/knockout"),r=e("swx-service-locator-instance").default,i=e("swx-constants").COMMON,s=e("experience/settings"),o=e("swx-i18n").localization,u=e("utils/common/localStorage"),a=e("ui/telemetry/telemetryClient"),f=i.telemetry.eduCarouselEvents;t.build=function(){return new l}}),define("text!views/experience/eduCarousel.html",[],function(){return'<div data-bind="css: \'EduCarousel-item \' + itemName(), visible: isVisible()">\r\n    <div class="EduCarousel-overlay">\r\n        <div class="EduCarousel-overlay--infoMessage">\r\n            <h1 data-bind="text: itemHeader()"></h1>\r\n            <p data-bind="text: itemText()"></p>\r\n            <div class="spinnerHolder">\r\n                <swx-loading-animation class="spinner white"></swx-loading-animation>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/experience/eduCarousel",["require","exports","module","ui/viewModels/experience/eduCarousel","constants/components","text!views/experience/eduCarousel.html"],function(e,t){function r(){var e=n.build();return e.init(),e}var n=e("ui/viewModels/experience/eduCarousel");t.name=e("constants/components").experience.EDUCATIONAL_CAROUSEL,t.template=e("text!views/experience/eduCarousel.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/experience/teamsAlert",["require","exports","module","experience/settings","swx-constants","swx-service-locator-instance","ui/telemetry/telemetryClient","swx-i18n"],function(e,t){function a(e){function f(){return e.teamsAsDefaultClient&&(e.teamsAsDefaultClient()===r.teamsAsDefaultClient.CHAT||e.teamsAsDefaultClient()===r.teamsAsDefaultClient.CALLING||e.teamsAsDefaultClient()===r.teamsAsDefaultClient.CHAT_AND_CALLING)}function l(t,r){var i=r?{action:r}:{},o=u.teamsMigration.EVENT_NAME,a=u.teamsMigration.eventType[t];f()&&(o=u.teamsAsDefaultClient.EVENT_NAME,a=u.teamsAsDefaultClient.eventType[t],i.teamsAsDefaultClient=e.teamsAsDefaultClient()),i.type=a,s.get().sendEvent(n.telemetry.uiTenantToken,o,i)}function c(e){var t=e.querySelector(r.teamsMigration.TEAMS_ALERT_ACTION_CLASS),n=e.querySelector(r.teamsMigration.TEAMS_ALERT_HIDE_NOTIFICATION_CLASS);t.addEventListener("click",h.bind(null,r.teamsMigration.EXPIRATION_MULTIPLIER_NEVER,!1,u.teamsMigration.eventAction.CLICK_CTA)),n.addEventListener("click",h.bind(n,r.teamsMigration.EXPIRATION_MULTIPLIER_24H,!0,u.teamsMigration.eventAction.CLOSE_ALERT))}function h(e,t,n,i){var s=+(new Date)+e;t&&i.preventDefault(),a.setItem(r.teamsMigration.LOCAL_STORAGE_KEY,s),l("ALERT_CLOSED",n),p()}function p(){e.showTeamsAlert&&e.showTeamsAlert(!1),e.canShowInformationalMessage&&e.showInformationalMessage&&e.showInformationalMessage(!0),e.teamsAsDefaultClient&&e.teamsAsDefaultClient(r.teamsAsDefaultClient.NONE)}var t=this,a=i.resolve(r.serviceLocator.LOCAL_STORAGE);t.teamsAlertUrl=n.s4bTeamsAlert.notificationUrl,t.closeIconUrl=n.appBaseUrl+"/assets/images/components/teamsMigrated/x.svg";if(f()){t.actionString=o.fetch({key:"owa_default_client_notification_action"});switch(e.teamsAsDefaultClient()){case r.teamsAsDefaultClient.CHAT_AND_CALLING:t.alertMessage=o.fetch({key:"owa_default_chat_and_calling_client_message"});break;case r.teamsAsDefaultClient.CALLING:t.alertMessage=o.fetch({key:"owa_default_calling_client_message"});break;case r.teamsAsDefaultClient.CHAT:t.alertMessage=o.fetch({key:"owa_default_chat_client_message"});break;default:t.actionString=o.fetch({key:"owa_deprecation_notification_action"}),t.alertMessage=o.fetch({key:"owa_deprecation_notification_message"})}}else t.actionString=o.fetch({key:"owa_deprecation_notification_action"}),t.alertMessage=o.fetch({key:"owa_deprecation_notification_message"});t.init=function(e){c(e),l("ALERT_DISPLAYED")}}var n=e("experience/settings"),r=e("swx-constants").COMMON,i=e("swx-service-locator-instance").default,s=e("ui/telemetry/telemetryClient"),o=e("swx-i18n").localization,u=r.telemetry;t.build=function(e){return new a(e)}}),define("text!views/experience/teamsAlert.html",[],function(){return'<a href="" class="TeamsAlert-hide">\r\n    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r\n        <title>2_out</title>\r\n        <path d="M19.64,5.063a.768.768,0,0,1-.211.527l-6.363,6.363,6.363,6.363a.768.768,0,0,1,.211.527.76.76,0,0,1-.75.75.768.768,0,0,1-.527-.211L12,13.02,5.636,19.384a.768.768,0,0,1-.527.211.76.76,0,0,1-.75-.75.768.768,0,0,1,.211-.527l6.363-6.363L4.57,5.591a.768.768,0,0,1-.211-.527.76.76,0,0,1,.75-.75.768.768,0,0,1,.527.211L12,10.887l6.363-6.363a.768.768,0,0,1,.527-.211.76.76,0,0,1,.75.75Z"/>\r\n    </svg>\r\n</a>\r\n<div class="TeamsAlert-messageContainer">\r\n    <span class="TeamsAlert-message" data-bind="text: alertMessage"></span>\r\n    <a target="_blank" class="TeamsAlert-action" data-bind="attr: { href: teamsAlertUrl }, text: actionString"></a>\r\n</div>'}),define("ui/components/experience/teamsAlert",["require","exports","module","ui/viewModels/experience/teamsAlert","constants/components","text!views/experience/teamsAlert.html"],function(e,t){function r(e,t){var r=n.build(e);return r.init(t.element),r}var n=e("ui/viewModels/experience/teamsAlert");t.name=e("constants/components").experience.TEAMS_ALERT,t.template=e("text!views/experience/teamsAlert.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/experience/teamsMigrated",["require","exports","module","experience/settings","swx-constants","ui/telemetry/telemetryClient"],function(e,t){function o(){var e=this;e.teamsMigratedUrl=n.s4bTeamsAlert.migartedUrl,e.init=function(){i.get().sendEvent(n.telemetry.uiTenantToken,s.teamsMigration.EVENT_NAME,{type:s.teamsMigration.eventType.MIGRATION_UI_SHOWN})},e.clickCta=function(){return i.get().sendEvent(n.telemetry.uiTenantToken,s.teamsMigration.EVENT_NAME,{type:s.teamsMigration.eventType.MIGRATION_UI_ACTION_INVOKED}),!0}}var n=e("experience/settings"),r=e("swx-constants").COMMON,i=e("ui/telemetry/telemetryClient"),s=r.telemetry;t.build=function(e){return new o(e)}}),define("text!views/experience/teamsMigrated.html",[],function(){return'<span class="TeamsMigrated-message" data-bind="l10n: { \'key\': \'owa_deprecation_header\' }"></span>\r\n<div class="TeamsMigrated-image"></div>\r\n<span class="TeamsMigrated-body" data-bind="l10n: { \'key\': \'owa_deprecation_body\' }"></span>\r\n<a target="_blank" class="TeamsMigrated-action" data-bind="click: clickCta, attr: { href: teamsMigratedUrl }, l10n: { \'key\': \'owa_deprecation_action\' }"></a>\r\n'}),define("ui/components/experience/teamsMigrated",["require","exports","module","ui/viewModels/experience/teamsMigrated","constants/components","text!views/experience/teamsMigrated.html"],function(e,t){function r(){var e=n.build();return e.init(),e}var n=e("ui/viewModels/experience/teamsMigrated");t.name=e("constants/components").experience.TEAMS_MIGRATED,t.template=e("text!views/experience/teamsMigrated.html"),t.viewModel={createViewModel:r}}),define("ui/components/experience/index",["require","ui/components/experience/button","ui/components/experience/loadingAnimation","ui/components/experience/radioButton","ui/components/experience/searchInput","ui/components/experience/searchResults","ui/components/experience/selectBox","ui/components/experience/toggleButton","ui/components/experience/avatarFilePicker","ui/components/experience/eduCarousel","ui/components/experience/teamsAlert","ui/components/experience/teamsMigrated"],function(e){return[e("ui/components/experience/button"),e("ui/components/experience/loadingAnimation"),e("ui/components/experience/radioButton"),e("ui/components/experience/searchInput"),e("ui/components/experience/searchResults"),e("ui/components/experience/selectBox"),e("ui/components/experience/toggleButton"),e("ui/components/experience/avatarFilePicker"),e("ui/components/experience/eduCarousel"),e("ui/components/experience/teamsAlert"),e("ui/components/experience/teamsMigrated")]}),define("ui/components/registrar",["require","exports","module","vendor/knockout"],function(e,t){var n=e("vendor/knockout");t.register=function(e){e.forEach(function(e){n.components.isRegistered(e.name)||n.components.register(e.name,e)})}}),define("experience/components/experience",["require","exports","module","swx-constants","swx-service-locator-instance","ui/controls/experience/sidebar","ui/controls/experience/content","ui/components/experience/index","ui/components/registrar"],function(e,t){var n=e("swx-constants").COMMON,r=e("swx-service-locator-instance").default,i=e("ui/controls/experience/sidebar"),s=e("ui/controls/experience/content"),o=e("ui/components/experience/index"),u=e("ui/components/registrar");t.init=function(e){var t=r.resolve(n.serviceLocator.CONTROLS_BUILDER);t.register(s),t.register(i),u.register(o),e()}}),define("text!views/people/avatar.html",[],function(){return'<div role="button" class="Avatar" data-bind="css: containerClass, attr: {tabindex: tabindex}">\r\n    <img class="Avatar-image" data-bind="fallBackOnDefaultAvatarOnError: avatarUrl, isPstn: isPstn, isGroupAvatar: isGroupAvatar, displayName: displayName, useDefaultAvatar: useDefaultAvatar" alt="" aria-hidden="true" role="presentation">\r\n</div>\r\n'}),define("utils/common/ko",["require","exports","module","vendor/knockout","lodash-compat","swx-utils-common"],function(e,t){function s(e,t){return t(e()),e.subscribe(t)}function o(e,t,n){var i=r.isFunction(t)?t:function(e){return e===t},o=!1,u={dispose:function(){o=!0}};return u=s(e,function(e){i(e)&&n.call(u,e)}),o&&u.dispose(),u}var n=e("vendor/knockout"),r=e("lodash-compat"),i=e("swx-utils-common").array;t.disposeAndClearArray=function(e){var t=e();t.forEach(function(e){e.dispose&&e.dispose()}),t.splice(0)},t.wrapObservable=function(e){return e===null||r.isUndefined(e)?n.observable():n.isObservable(e)?e:n.observable(e)},t.changed=s,t.when=o,t.once=function(e,t,n){return o(e,t,function(e){this.dispose(),n(e)})},t.handleArrayChanges=function(e,t,n,r){function f(e){return o.filter(function(t){return t.key===e})[0]}function l(t){t.moved>=0?(a=f(t.value),i.insertAt(e,t.index,a?a.value:e[t.moved+s])):n(t.index,t.value),s++}function c(t){var n=t.index+s;t.moved>=0&&o.push({key:t.value,value:e[n]}),r(n,t.value),s--}var s=0,o=[],u,a;n=n||i.insertAt.bind(null,e),r=r||i.removeFrom.bind(null,e);for(var h=0;h<t.length;h++)u=t[h],u.status==="added"?l(u):c(u)}}),define("ui/viewModels/people/avatar",["require","vendor/knockout","utils/common/ko","lodash-compat","swx-constants","constants/cssClasses","swx-service-locator-instance","swx-utils-common","swx-utils-common"],function(e){function f(e){function g(){return typeof e.useDefaultAvatar!="undefined"?e.useDefaultAvatar:!1}function y(){var t=f._avatar()||"",n;return typeof e.size!="number"&&(e.size=u.tryParseInt(e.size,0)),t&&m?(e.isFullSize?n="l":n=b(e.size),a.appendQueryParameter(t,"size",n)):t}function b(e){var t="s";return e>=256?t="l":e>96&&(t="m"),t}function w(e){return s.AVATAR_PRESENCE+" "+s.AVATAR+"--"+e}var f=this,l=t.utils.unwrapObservable(e.isAgent),c=e.status||r.noop,h=e.isSelected||r.noop,p=e.isFullSize||!1,d=e.size,v=o.resolve(i.serviceLocator.FEATURE_FLAGS),m=v.isFeatureOn(i.featureFlags.AVATAR_SERVICE_SUPPORTS_SIZE_PARAMETER);f.isPstn=n.wrapObservable(e.isPstn),f.isGroupAvatar=n.wrapObservable(e.isGroupAvatar),f._avatar=n.wrapObservable(e.avatar),f.avatarUrl=t.computed(y),f.tabindex=e.tabindex||"",f.displayName=n.wrapObservable(e.displayName),f.useDefaultAvatar=n.wrapObservable(g()),f.useAbsolutePosition=n.wrapObservable(e.useAbsolutePosition),f.containerClass=t.computed(function(){return r.filter([d&&s.AVATAR_SIZE+d,f.isGroupAvatar()&&s.AVATAR_GROUP,l&&s.AVATAR_AGENT,p&&s.AVATAR_FULL_SIZE,f.isPstn()&&s.AVATAR_PSTN,c()&&w(c()),h()&&s.AVATAR_SELECTED,f.useDefaultAvatar()&&s.AVATAR_USE_DEFAULT,f.useAbsolutePosition()&&s.AVATAR_ABSOLUTE],r.isString).join(" ")}),f.dispose=function(){f.containerClass.dispose(),f.avatarUrl.dispose()}}var t=e("vendor/knockout"),n=e("utils/common/ko"),r=e("lodash-compat"),i=e("swx-constants").COMMON,s=e("constants/cssClasses").avatar,o=e("swx-service-locator-instance").default,u=e("swx-utils-common").stringUtils,a=e("swx-utils-common").url;return f}),define("ui/components/people/avatar",["require","exports","module","constants/components","text!views/people/avatar.html","ui/viewModels/people/avatar"],function(e,t){t.name=e("constants/components").people.AVATAR,t.template=e("text!views/people/avatar.html"),t.viewModel=e("ui/viewModels/people/avatar")}),define("text!views/people/avatarDeprecated.html",[],function(){return'<span class="tile" data-bind="css: containerClass">\r\n    <span role=\'button\' class="tileAvatar circle" data-bind="css: presenceClass">\r\n        <span class="tileImage" data-bind="css: {agent: isAgent, pstn: isPstn}">\r\n            <img data-bind="fallBackOnDefaultAvatarOnError: avatarUrl, isPstn: isPstn, isGroupAvatar: isGroupAvatar, displayName: displayName" alt="" aria-hidden="true" role="presentation">\r\n        </span>\r\n    </span>\r\n</span>\r\n'}),define("ui/viewModels/people/avatarDeprecated",["require","vendor/knockout","utils/common/ko","lodash-compat","constants/cssClasses"],function(e){function o(e){function i(){var t=a(e.status);return r.isGroupAvatar()?s.GROUP_AVATAR:t}function o(){return!r.isGroupAvatar()&&!e.isCalling?s.SHOW_PRESENCE:""}var r=this;if(u(e.isGroupAvatar)||u(e.status))throw new Error("[AvatarDeprecated] Passing incorrect parameter, did you used property instead of ko observable ?");r.isPstn=n.wrapObservable(e.isPstn),r.isGroupAvatar=n.wrapObservable(e.isGroupAvatar),r.isAgent=e.isAgent,r.avatarUrl=n.wrapObservable(e.avatar),r.containerClass=t.computed(i),r.presenceClass=t.computed(o),r.tabindex=e.tabindex||"",r.displayName=n.wrapObservable(e.displayName),this.dispose=function(){r.containerClass.dispose(),r.presenceClass.dispose()}}function u(e){return r.isFunction(e)&&!t.isObservable(e)}function a(e){return e?t.utils.unwrapObservable(e):""}var t=e("vendor/knockout"),n=e("utils/common/ko"),r=e("lodash-compat"),i=e("constants/cssClasses"),s=i.avatarDeprecated;return o}),define("ui/components/people/avatarDeprecated",["require","exports","module","constants/components","text!views/people/avatarDeprecated.html","ui/viewModels/people/avatarDeprecated"],function(e,t){t.name=e("constants/components").people.AVATAR_DEPRECATED,t.template=e("text!views/people/avatarDeprecated.html"),t.viewModel=e("ui/viewModels/people/avatarDeprecated")}),define("text!views/people/contactListMenuItem.html",[],function(){return'<p>\r\n	<a href="#" class="strong MenuItem-link" data-bind="text: text, click: onClick, css: { \'MenuItem-link--selected\': selected }"></a>\r\n</p>'}),define("ui/components/people/contactListMenuItem",["require","exports","module","text!views/people/contactListMenuItem.html","constants/components"],function(e,t){function i(e){return e.viewModel}var n=e("text!views/people/contactListMenuItem.html"),r=e("constants/components");t.name=r.people.CONTACT_LIST_MENU_ITEM,t.viewModel={createViewModel:i},t.template=n}),define("services/telemetry/common/afterRenderHandler",[],function(){return function(t,n){var r=0;return function(){r++,r===t&&(n(),r=0)}}}),define("ui/viewModels/people/contactListHelper",["require","exports","module","lodash-compat","swx-utils-people","ui/viewModels/people/contactBuilder","ui/modelHelpers/personHelper"],function(e,t){function o(e){return e.isBlocked()}function u(e,t,n){var i=r.getBucketName(t);n.contactGroups().some(function(n){if(n.name===i)return n.contacts().some(function(n){if(n.id()===t.id())return n.isActive(e),!0}),!0})}var n=e("lodash-compat"),r=e("swx-utils-people").organizePersons,i=e("ui/viewModels/people/contactBuilder"),s=e("ui/modelHelpers/personHelper");t.deselectContactFromDefaultList=function(e,t){u(!1,e,t)},t.selectContactFromDefaultList=function(e,t){u(!0,e,t)},t.filterSearchResults=function(e,n){return e.reduce(function(e,r){var s=r.result;return t.shouldPersonBeIncluded(s,n)?e.concat([i.build(s)]):e},[])},t.organizeByAlphabet=function(e){return e=e||[],r.byAlphabet(e)},t.setObservablePropertyOnContacts=function(e,r,i){function s(n){t.setObservablePropertyOnContact(e,r,n)}if(!(n.isArray(i)&&i.length>0))return;n.isFunction(i[0].contacts)?i.forEach(function(e){e.contacts().forEach(s)}):i.forEach(s)},t.setObservablePropertyOnContact=function(e,t,r){if(!r.hasOwnProperty(e))return;n.isFunction(t)&&t.bind(r),r[e](t)},t.personExistsInCollection=function(e,t){function n(t){return e.id()===t.id()}return t?Boolean(t.filter(n).length):!1},t.shouldPersonBeIncluded=function(e,n){var r=t.personExistsInCollection(e,n),i=s.isEchoContact(e);return!r&&!o(e)&&!i}}),define("ui/contextMenu/menuItem",[],function(){function e(e,n,r){this.type=e,this.label=n,this.action=r||t,this.isEnabled=function(){return!0}}function t(){}return e}),define("ui/modelHelpers/groupHelper",["require","exports","module","lodash-compat","swx-cafe-application-instance","ui/modelHelpers/personHelper"],function(e,t){function s(e){return!i.isEchoContact(e)}function o(e){return!i.isAgent(e)}function u(e){return r.get().personsAndGroupsManager.all.uri()===e?r.get().personsAndGroupsManager.all:r.get().personsAndGroupsManager.all.groups(e)}var n=e("lodash-compat"),r=e("swx-cafe-application-instance"),i=e("ui/modelHelpers/personHelper");t.getPersonsOtherThanEcho=function(){var e=r.get().personsAndGroupsManager.all.persons();return n.filter(e,s)},t.getPersonsOtherThanEchoAndAgents=function(){return n.filter(t.getPersonsOtherThanEcho(),o)},t.getPersonsFromGroup=function(e){var t=u(e);return t&&n.isFunction(t.persons)?t.persons():[]},t.isPersonInGroup=function(e,t){var r=u(e);return r&&n.isFunction(r.persons)?!!r.persons(t.id()):!1},t.addPersonToGroup=function(e,t){var r=u(e);return r&&n.isFunction(r.persons)?r.persons.add(t,t.id()):Promise.resolve()},t.removePersonFromGroup=function(e,t){var r=u(e);return r&&n.isFunction(r.persons)?r.persons.remove(t):Promise.resolve()},t.subscribeToGroup=function(e,t){var r=u(e);return r&&n.isFunction(r.persons)?r.persons.changed(t):Promise.resolve()},t.unsubscribeFromGroup=function(e,t){var n=u(e);n&&n.persons.changed.off(t)}}),define("ui/telemetry/people/contactInvitation",["require","exports","module","ui/telemetry/people/contactTelemetryHelper","swx-constants"],function(e,t){function o(e,t,r){var i=n.getTrace(e),r=r||{},o={};return o[s.fields.NAME]=t,o[s.fields.SUCCESS]=r.success,n.addIfDefined(o,s.fields.BEGIN_TIMESTAMP,i.startTime),n.addIfDefined(o,s.fields.ELAPSED,i.duration),n.addIfDefined(o,s.fields.RESEND,r.resend),n.addIfDefined(o,s.fields.SOURCE,r.source),o}var n=e("ui/telemetry/people/contactTelemetryHelper"),r=e("swx-constants").COMMON,i=r.telemetry.performanceMarks.CONTACTS,s=r.telemetry.contactsV2.invitation;t.onSendContactRequestStart=function(){n.setStart(i.SEND_REQUEST)},t.onSendContactRequestEnd=function(e){var t=o(i.SEND_REQUEST,s.names.SEND_CONTACT_REQUEST,e);n.send(t,s.TYPE)},t.onAcceptContactRequestStart=function(){n.setStart(i.ACCEPT_REQUEST)},t.onAcceptContactRequestEnd=function(e){var t=o(i.ACCEPT_REQUEST,s.names.ACCEPT_CONTACT_REQUEST,e);n.send(t,s.TYPE)},t.onDeclineContactRequestStart=function(){n.setStart(i.DECLINE_REQUEST)},t.onDeclineContactRequestEnd=function(e){var t=o(i.DECLINE_REQUEST,s.names.DECLINE_CONTACT_REQUEST,e);n.send(t,s.TYPE)}}),define("ui/telemetry/people/contactManagement",["require","exports","module","ui/telemetry/people/contactTelemetryHelper","swx-constants"],function(e,t){function o(e,t,r){var i=n.getTrace(e),r=r||{},o={};return o[s.fields.NAME]=t,o[s.fields.SUCCESS]=r.success,n.addIfDefined(o,s.fields.BEGIN_TIMESTAMP,i.startTime),n.addIfDefined(o,s.fields.ELAPSED,i.duration),n.addIfDefined(o,s.fields.CONTACT_TYPE,r.contactType),n.addIfDefined(o,s.fields.SOURCE,r.source),o}var n=e("ui/telemetry/people/contactTelemetryHelper"),r=e("swx-constants").COMMON,i=r.telemetry.performanceMarks.CONTACTS,s=r.telemetry.contactsV2.contactManagement;t.onRemoveContactStart=function(){n.setStart(i.REMOVE_CONTACT)},t.onRemoveContactEnd=function(e){var t=o(i.REMOVE_CONTACT,s.names.REMOVE_CONTACT,e);n.send(t,s.TYPE)},t.onAddContactStart=function(){n.setStart(i.ADD_CONTACT)},t.onAddContactEnd=function(e){var t=o(i.ADD_CONTACT,s.names.ADD_CONTACT,e);n.send(t,s.TYPE)}}),define("ui/telemetry/people/contactActions",["require","exports","module","ui/telemetry/people/contactTelemetryHelper","swx-constants"],function(e,t){function o(e,t,r){var i=n.getTrace(e),r=r||{},o={};return o[s.fields.NAME]=t,o[s.fields.SUCCESS]=r.success,n.addIfDefined(o,s.fields.BEGIN_TIMESTAMP,i.startTime),n.addIfDefined(o,s.fields.ELAPSED,i.duration),n.addIfDefined(o,s.fields.CONTACT_TYPE,r.contactType),n.addIfDefined(o,s.fields.REASON,r.reason),n.addIfDefined(o,s.fields.REPORT_ABUSE,r.reportAbuse),n.addIfDefined(o,s.fields.SOURCE,r.source),o}var n=e("ui/telemetry/people/contactTelemetryHelper"),r=e("swx-constants").COMMON,i=r.telemetry.performanceMarks.CONTACTS,s=r.telemetry.contactsV2.contactAction;t.onBlockContactStart=function(){n.setStart(i.BLOCK_CONTACT)},t.onBlockContactEnd=function(e){var t=o(i.BLOCK_CONTACT,s.names.BLOCK_CONTACT,e);n.send(t,s.TYPE)},t.onUnblockContactStart=function(){n.setStart(i.UNBLOCK_CONTACT)},t.onUnblockContactEnd=function(e){var t=o(i.UNBLOCK_CONTACT,s.names.UNBLOCK_CONTACT,e);n.send(t,s.TYPE)},t.onAddToFavoritesStart=function(){n.setStart(i.ADD_TO_FAVORITES)},t.onAddToFavoritesEnd=function(e){var t=o(i.ADD_TO_FAVORITES,s.names.ADD_TO_FAVORITES,e);n.send(t,s.TYPE)},t.onRemoveFromFavoritesStart=function(){n.setStart(i.REMOVE_FROM_FAVORITES)},t.onRemoveFromFavoritesEnd=function(e){var t=o(i.REMOVE_FROM_FAVORITES,s.names.REMOVE_FROM_FAVORITES,e);n.send(t,s.TYPE)}}),define("ui/modelHelpers/personActionsHelper",["require","exports","module","lodash-compat","swx-cafe-application-instance","swx-service-locator-instance","swx-constants","swx-enums","utils/common/accessibility","ui/modelHelpers/groupHelper","ui/telemetry/people/contactInvitation","ui/telemetry/people/contactManagement","ui/telemetry/people/contactActions","experience/settings"],function(e,t){function d(e,t){function u(e,t,n){function o(r){r.name()===h.defaultBusinessContactsGroup&&(i.added.off(o),a(r,e,t,n))}var s;s=r.get().personsAndGroupsManager.createGroup(),s.name.set(h.defaultBusinessContactsGroup),i.add(s).then(function(){i.added(o)},n)}function a(e,n,r,i){e.persons.add(n.id()).then(function(){t&&(t.historyService.removeCustomActivityItem(o.activityType.ContactRequestOutgoing),t.historyService.removeCustomActivityItem(o.activityType.ContactRequestIsNowContact),t.historyService.addCustomActivityItem(o.activityType.ContactRequestIsNowContact,{sender:n})),r()},i)}var n,i=r.get().personsAndGroupsManager.all.groups,s;return n=new Promise(function(t,n){i.get().then(function(r){s=r.filter(function(e){return e.name()===h.defaultBusinessContactsGroup}),s.length>0?a(s[0],e,t,n):u(e,t,n)},n)}),n}function v(e){return n.isFunction(e._type)?e._type():undefined}function m(e){return n.isString(e)?e={source:e}:e||(e=e||{}),e}var n=e("lodash-compat"),r=e("swx-cafe-application-instance"),i=e("swx-service-locator-instance").default,s=e("swx-constants").COMMON,o=e("swx-enums"),u=e("utils/common/accessibility").narrator,a=e("ui/modelHelpers/groupHelper"),f=e("ui/telemetry/people/contactInvitation"),l=e("ui/telemetry/people/contactManagement"),c=e("ui/telemetry/people/contactActions"),h=e("experience/settings"),p="8";t.blockPerson=function(e,t,r,o,a){function p(){return l.isFeatureOn(s.featureFlags.USE_BUSINESS_WORDING)?e.isBlocked.set(!0,t.value):e.isBlocked.set(!0,t)}function d(){u.announce({key:"accessibility_contact_blocked_success"}),n.isFunction(o)&&o(),c.onBlockContactEnd({success:!0,contactType:f,reason:t.reason,reportAbuse:t.value,source:r.source})}function g(){u.announce({key:"accessibility_contact_blocked_failure"}),n.isFunction(a)&&a(),c.onBlockContactEnd({success:!1,contactType:f,reason:t.reason,reportAbuse:t.value,source:r.source})}var f=v(e),l=i.resolve(s.serviceLocator.FEATURE_FLAGS),h;return t=t||{},r=m(r),e.isBlocked.set.enabled()?(c.onBlockContactStart(),h=p(),h.then(d,g)):h=Promise.resolve(!0),h},t.unblockPerson=function(e,t,r,i){function a(){u.announce({key:"accessibility_contact_unblocked_success"}),n.isFunction(r)&&r(),c.onUnblockContactEnd({success:!0,source:t.source,contactType:s})}function f(){u.announce({key:"accessibility_contact_unblocked_failure"}),n.isFunction(i)&&i(),c.onUnblockContactEnd({success:!1,source:t.source,contactType:s})}var s=v(e),o;return t=m(t),e.isBlocked.set.enabled()?(c.onUnblockContactStart(),o=e.isBlocked.set(!1),o.then(a,f)):o=Promise.resolve(),o},t.removePerson=function(e,t,i,s){function c(){u.announce({key:"accessibility_contact_deleted_success"}),n.isFunction(i)&&i(),l.onRemoveContactEnd({success:!0,source:t.source,contactType:o})}function h(){u.announce({key:"accessibility_contact_deleted_failure"}),n.isFunction(s)&&s(),l.onRemoveContactEnd({success:!1,source:t.source,contactType:o})}var o=v(e),a=r.get().personsAndGroupsManager.all,f;return t=m(t),l.onRemoveContactStart(),f=a.persons.remove(e.id()),f.then(c,h),f},t.addPerson=function(e,t,a,c,h,g){function T(){var r="accessibility_contact_request_sent_success";w||e.activity._set(undefined),t===o.activityType.ContactRequestIncoming&&(r="accessibility_contact_request_accepted_success"),u.announce({key:r}),n.isFunction(h)&&h(),n.isFunction(S)&&S(!0)}function N(){var e="accessibility_contact_request_sent_failure";t===o.activityType.ContactRequestIncoming&&(e="accessibility_contact_request_accepted_failure"),u.announce({key:e}),n.isFunction(g)&&g(),n.isFunction(S)&&S(!1)}function C(e){l.onAddContactEnd({success:e,contactType:y,source:c.source}),b&&f.onSendContactRequestEnd({success:e,resend:E,source:c.source})}function k(e){f.onAcceptContactRequestEnd({success:e,source:c.source})}var y=v(e),b=y?y===p:!1,w=i.resolve(s.serviceLocator.FEATURE_FLAGS).isFeatureOn(s.featureFlags.ENABLE_BUSINESS_CONTACT_MANAGEMENT),E=!1,S,x;c=m(c);switch(t){case o.activityType.ContactRequestOutgoingResend:E=!0;case o.activityType.ContactRequestOutgoing:case o.activityType.ContactRequestOutgoingAgent:case o.activityType.ContactRequestOutgoingPSTN:case o.activityType.SuggestedContact:l.onAddContactStart(),b&&f.onSendContactRequestStart(),S=C;break;case o.activityType.ContactRequestIncoming:f.onAcceptContactRequestStart(),S=k;break;default:}return w?x=d(e,a):x=r.get().personsAndGroupsManager.all.persons.add(e,e.id(),undefined,t),x.then(T,N),x},t.declinePerson=function(e,t,i,s,a){function h(){u.announce({key:"accessibility_contact_request_declined_success"}),n.isFunction(s)&&s(),f.onDeclineContactRequestEnd({success:!0,source:i.source,contactType:l})}function p(){u.announce({key:"accessibility_contact_request_declined_failure"}),n.isFunction(a)&&a(),f.onDeclineContactRequestEnd({success:!1,source:i.source,contactType:l})}var l=v(e),c;return i=m(i),f.onDeclineContactRequestStart(),c=r.get().conversationsManager.conversations.remove(t,o.activityType.ContactRequestIncoming),c.then(h,p),c},t.addFavorite=function(e,t,r,i){function l(){u.announce({key:"accessibility_contact_add_favorite_success"}),n.isFunction(r)&&r(),c.onAddToFavoritesEnd({success:!0,source:t.source,contactType:s})}function h(){u.announce({key:"accessibility_contact_add_favorite_failure"}),n.isFunction(i)&&i(),c.onAddToFavoritesEnd({success:!1,source:t.source,contactType:s})}var s=v(e),f;return t=m(t),c.onAddToFavoritesStart(),f=a.addPersonToGroup(o.groupType.Favorites,e),f.then(l,h),f},t.removeFavorite=function(e,t,r,i){function l(){u.announce({key:"accessibility_contact_remove_favorite_success"}),n.isFunction(r)&&r(),c.onRemoveFromFavoritesEnd({success:!0,source:t.source,contactType:s})}function h(){u.announce({key:"accessibility_contact_remove_favorite_failure"}),n.isFunction(i)&&i(),c.onRemoveFromFavoritesEnd({success:!1,source:t.source,contactType:s})}var s=v(e),f;return t=m(t),c.onRemoveFromFavoritesStart(),f=a.removePersonFromGroup(o.groupType.Favorites,e.id()),f.then(l,h),f}}),define("ui/viewModels/people/blockContactModal",["require","lodash-compat","vendor/knockout","swx-i18n","utils/common/eventMixin","ui/modalDialog/modalDialog","swx-constants","ui/modelHelpers/personHelper","ui/viewModels/people/properties/displayNameText","ui/modelHelpers/personActionsHelper","swx-service-locator-instance"],function(e){function h(e,t){function y(){s.hide(c),i.actionsInProgress(!1)}function b(){i.actionsInProgress(!1)}function w(){var e={key:i.isAgent?"modal_block_agent_text_reportAbuse":"modal_blockContact_text_reportAbuse"};return r.fetch(e)}function E(){return!h.isFeatureOn(o.featureFlags.USE_BUSINESS_WORDING)&&i.reportAbuse()}var i=this,h=l.resolve(o.serviceLocator.FEATURE_FLAGS),p={value:"spam",name:r.fetch({key:"report_abuse_reason_option_spam"}),description:""},d={value:"pornography",name:r.fetch({key:"report_abuse_reason_option_pornography"}),description:""},v={value:"child-exploitation",name:r.fetch({key:"report_abuse_reason_option_child_exploitation"}),description:""},m={value:"harassment",name:r.fetch({key:"report_abuse_reason_option_harassment"}),description:""},g=[p,d,v,m];t=t||{},i.isAgent=u.isAgent(e),i.displayName=a.format(e.id(),e.displayName()),i.avatar=e.avatarUrl(),i.reportAbuse=n.observable(!1),i.reportAbuseText=n.computed(w),i.showReportAbuseReason=n.computed(E),i.reason=n.observable(p),i.reasons=n.observableArray(g),i.actionsInProgress=n.observable(!1),i.cancel=function(){s.hide(c)},i.blockContact=function(){var n,r={value:i.reportAbuse()};return r.value&&(r.reason=i.reason().value),i.actionsInProgress(!0),n=f.blockPerson(e,r,t,y,b),n},i.dispose=function(){i.reportAbuseText.dispose(),i.showReportAbuseReason.dispose()}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-i18n").localization,i=e("utils/common/eventMixin"),s=e("ui/modalDialog/modalDialog"),o=e("swx-constants").COMMON,u=e("ui/modelHelpers/personHelper"),a=e("ui/viewModels/people/properties/displayNameText"),f=e("ui/modelHelpers/personActionsHelper"),l=e("swx-service-locator-instance").default,c="swx-overlayBlockContact";return h.ELEMENT_ID=c,t.assign(h.prototype,i),h}),define("text!views/people/blockContactModal.html",[],function(){return'<div id="swx-overlayBlockContact" class="swx-overlayModal swx-hide" tabindex="-1">\r\n\r\n    <div class="overlayMain">\r\n        <div class="title">\r\n            <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { \'key\': \'modal_blockContact_text_title\', params: { displayName: displayName } }"></h1>\r\n        </div>\r\n\r\n        <swx-avatar params="avatar: avatar, isAgent: isAgent, displayName: displayName, size: 160" class="avatar"></swx-avatar>\r\n\r\n        <p class="subtitle" data-bind="l10n: { \'key\': \'modal_blockContact_text_message\', params: { displayName: displayName } }" data-swx-testId="modalBlockContactText"></p>\r\n\r\n        <p class="subtitle ReportAbuse"><label><input type="checkbox" name="reportAbuse" data-bind="checked: reportAbuse"/><strong data-bind="text: reportAbuseText"></strong></label></p>\r\n        <!-- ko if: showReportAbuseReason -->\r\n        <p class="subtitle ReportAbuseReason"><swx-select-box class="SelectBox" params="selectOptions: reasons, selectedOption: reason, placeholderKey: \'select_placeholder_report_abuse_reason\'"></swx-select-box></p>\r\n        <!-- /ko -->\r\n\r\n        <div class="dual buttonRow">\r\n            <div class="column alignRight">\r\n                <button type="button" class="btn primary" data-swx-testId="modalBlockContact" data-bind="click: blockContact, disable: actionsInProgress, css: { \'in-progress\': actionsInProgress }, focusHandler: { priority: 1 }"><span data-bind="l10n: { key: \'action_button_block\' }"></span></button>\r\n            </div>\r\n            <div class="column alignLeft">\r\n                <button type="button" class="btn secondary cancel" data-bind="click: cancel, disable: actionsInProgress, css: { \'in-progress\': actionsInProgress }"><span data-bind="l10n: { key: \'action_button_cancel\' }" class="clickable"></span></button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n</div>\r\n'}),define("ui/contextMenu/items/blockContact",["require","swx-i18n","ui/contextMenu/menuItem","ui/modalDialog/modalDialog","ui/viewModels/people/blockContactModal","text!views/people/blockContactModal.html","ui/telemetry/actions/actionSources","constants/cssClasses"],function(e){function a(e,f){function c(){var t=new i(e.getPerson(),f);r.build(i.ELEMENT_ID,t,s),r.show(i.ELEMENT_ID,p())}function h(){return e.isAgent()?t.fetch({key:"label_text_block_agent"}):t.fetch({key:"label_text_blockContact"})}function p(){return e.isAgent()?t.fetch({key:"modal_block_agent_text_aria_label"}):t.fetch({key:"modal_blockContact_text_aria_label"})}var l;f=f||{source:o.contextMenuItem.block};if(!e)throw new Error("Parameter missing: contactVM is required");l=h(),n.call(this,a.TYPE,l,c),this.cssClass=u.contextMenu.items.BLOCK_CONTACT,this.isEnabled=function(){return e.getPerson().isBlocked.set.enabled()&&!e.isBlocked()&&!e.isPstn()}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("ui/modalDialog/modalDialog"),i=e("ui/viewModels/people/blockContactModal"),s=e("text!views/people/blockContactModal.html"),o=e("ui/telemetry/actions/actionSources"),u=e("constants/cssClasses");return a.prototype=Object.create(n.prototype),a.TYPE="BlockContactMenuItem",a}),define("ui/contextMenu/items/baseCallingMenuItem",["require","ui/contextMenu/menuItem","swx-service-locator-instance","swx-constants","swx-enums","ui/viewModels/calling/helpers/callingFacade","ui/modelHelpers/personHelper","swx-cafe-application-instance","ui/modelHelpers/conversationHelper"],function(e){function f(e,o,f,c,h,p){function m(e){return!v.getCallingService(e).start.enabled()&&v.getCallingService(e).start.enabled.reason===i.callingNotSupportedReasons.PluginNotInstalled}function g(){var e=n.resolve(r.serviceLocator.MODEL_UI_OBSERVER).conversationsCallStateObserver;return e.activeCalls().length>0}function y(){function i(){return v.setCallingServiceEndpoint(t),s.placeCall(t,v.isVideoCall(),h,!0)}function o(){var e=n.resolve(r.serviceLocator.ACTION_TELEMETRY);p=p||{source:v.getDefaultTelemetrySource()},v.addTelemetryContextData(p),e.recordAction(v.getTelemetryActionName(),p)}var e,t;return o(),v.sendFeatureTelemetry(),e=u.get().conversationsManager,t=e.getConversation(d),e.conversations.add(t),i()}var d,v=this;t.call(v,e,o,y),d=c.getPerson(),v.cssClass=f,v.featuresAreEnabled=function(){return!1},v.mePersonHasCallingCapability=function(){return!1},v.conversationHasCallingCapability=function(e){return v.getCallingService(e).start.enabled()},v.personHasSkypeCallingCapability=function(){return!1},v.getCallingService=function(){},v.isVideoCall=function(){return!1},v.getDefaultTelemetrySource=function(){},v.getTelemetryActionName=function(){},v.addTelemetryContextData=function(){},v.sendFeatureTelemetry=function(){},v.setCallingServiceEndpoint=function(e){var t=n.resolve(r.serviceLocator.FEATURE_FLAGS);if(t.isFeatureOn(r.featureFlags.PSTN_ENABLED)){var i=e.participants(0);i.audio.endpoint(i.person.id())}},v.isEnabled=function(){var e=a.getExistingConversationWithPerson(d);return!v.featuresAreEnabled()||l()||d.isBlocked()||!v.personHasSkypeCallingCapability(d)||g()?!1:!e||m(e)?!0:v.conversationHasCallingCapability(e)&&v.mePersonHasCallingCapability()}}function l(){return o.isGuest(u.get().personsAndGroupsManager.mePerson)}var t=e("ui/contextMenu/menuItem"),n=e("swx-service-locator-instance").default,r=e("swx-constants").COMMON,i=e("swx-enums"),s=e("ui/viewModels/calling/helpers/callingFacade"),o=e("ui/modelHelpers/personHelper"),u=e("swx-cafe-application-instance"),a=e("ui/modelHelpers/conversationHelper");return f.prototype=Object.create(t.prototype),f}),define("ui/contextMenu/items/callSkype",["require","ui/contextMenu/items/baseCallingMenuItem","swx-i18n","swx-service-locator-instance","swx-constants","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","constants/cssClasses","ui/modelHelpers/personHelper","swx-cafe-application-instance"],function(e){function l(e,c,h){var p,d,v=this;p=n.fetch({key:"label_text_call_skype_audio"}),d=u.contextMenu.items.CALL_SKYPE,t.call(v,l.TYPE,p,d,e,c,h),v.featuresAreEnabled=function(){var e=r.resolve(i.serviceLocator.FEATURE_FLAGS);return e.isFeatureOn(i.featureFlags.CALLING)},v.mePersonHasCallingCapability=function(){return f.get().personsAndGroupsManager.mePerson.capabilities.audio()},v.personHasSkypeCallingCapability=function(e){return!a.isPstn(e)&&e.capabilities.audio()},v.getCallingService=function(e){return e.audioService},v.getDefaultTelemetrySource=function(){return o.contextMenuItem.callSkype},v.getTelemetryActionName=function(){return s.audioVideo.audioCall}}var t=e("ui/contextMenu/items/baseCallingMenuItem"),n=e("swx-i18n").localization,r=e("swx-service-locator-instance").default,i=e("swx-constants").COMMON,s=e("ui/telemetry/actions/actionNames"),o=e("ui/telemetry/actions/actionSources"),u=e("constants/cssClasses"),a=e("ui/modelHelpers/personHelper"),f=e("swx-cafe-application-instance");return l.prototype=Object.create(t.prototype),l.TYPE="CallSkypeMenuItem",l}),define("ui/viewModels/people/deleteContactModal",["require","lodash-compat","utils/common/eventMixin","ui/modalDialog/modalDialog","ui/modelHelpers/personActionsHelper","vendor/knockout"],function(e){function u(e,t){function a(){n.actionsInProgress(!1),r.hide(o)}function f(){n.actionsInProgress(!1)}var n=this,u=e.getPerson();t=t||{},n.displayName=e.displayName,n.avatar=e.avatar,n.isAgent=e.isAgent,n.isPstn=e.isPstn,n.actionsInProgress=s.observable(!1),n.cancel=function(){r.hide(o)},n.deleteContact=function(){var e;return n.actionsInProgress(!0),e=i.removePerson(u,t,a,f),e}}var t=e("lodash-compat"),n=e("utils/common/eventMixin"),r=e("ui/modalDialog/modalDialog"),i=e("ui/modelHelpers/personActionsHelper"),s=e("vendor/knockout"),o="swx-overlayDeleteContact";return u.ELEMENT_ID=o,t.assign(u.prototype,n),u}),define("text!views/people/deleteContactModal.html",[],function(){return'<div id="swx-overlayDeleteContact" class="swx-overlayModal swx-hide" tabindex="-1">\r\n\r\n    <div class="overlayMain">\r\n        <div class="title">\r\n            <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { \'key\': \'modal_deleteContact_text_title\', params: { displayName: displayName } }"></h1>\r\n        </div>\r\n\r\n        <swx-avatar params="avatar: avatar, isAgent: isAgent, displayName: displayName, isPstn: isPstn, size: 160" class="avatar"></swx-avatar>\r\n\r\n        <p data-bind="l10n: { \'key\': \'modal_deleteContact_text_message\', params: { displayName: displayName } }" data-swx-testId="modalDeleteContactText"></p>\r\n\r\n        <div class="dual buttonRow">\r\n            <div class="column alignRight">\r\n                <button type="button" class="btn primary" data-swx-testId="modalDeleteContact" data-bind="click: deleteContact, disable: actionsInProgress, css: { \'in-progress\': actionsInProgress }, focusHandler: { priority: 1 }"><span data-bind="l10n: { key: \'action_button_delete\' }"></span></button>\r\n            </div>\r\n            <div class="column alignLeft">\r\n                <button type="button" class="btn secondary cancel" data-bind="click: cancel, disable: actionsInProgress, css: { \'in-progress\': actionsInProgress }"><span data-bind="l10n: { key: \'action_button_cancel\' }" class="clickable"></span></button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n</div>\r\n'}),define("ui/contextMenu/items/deleteContact",["require","swx-i18n","ui/contextMenu/menuItem","ui/modalDialog/modalDialog","ui/viewModels/people/deleteContactModal","text!views/people/deleteContactModal.html","ui/telemetry/actions/actionSources","constants/cssClasses","ui/modelHelpers/personHelper"],function(e){function f(e,l){function h(){var t=new i(e,l),n=d();r.build(i.ELEMENT_ID,t,s),r.show(i.ELEMENT_ID,n)}function p(){return e.isAgent()?t.fetch({key:"label_text_delete_agent"}):t.fetch({key:"label_text_deleteContact"})}function d(){return e.isAgent()?t.fetch({key:"modal_delete_agent_text_aria_label"}):t.fetch({key:"modal_deleteContact_text_aria_label"})}var c;if(!e)throw new Error("Parameter missing: contactVM is required");l=l||{source:o.contextMenuItem.deleteItem},c=p(),n.call(this,f.TYPE,c,h),this.cssClass=u.contextMenu.items.DELETE_CONTACT,this.isEnabled=function(){var t=e.getPerson();return a.isKnownPerson(t)&&!a.isOrganizationContact(t)}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("ui/modalDialog/modalDialog"),i=e("ui/viewModels/people/deleteContactModal"),s=e("text!views/people/deleteContactModal.html"),o=e("ui/telemetry/actions/actionSources"),u=e("constants/cssClasses"),a=e("ui/modelHelpers/personHelper");return f.prototype=Object.create(n.prototype),f.TYPE="DeleteContactMenuItem",f}),define("ui/contextMenu/items/editMessage",["require","swx-i18n","ui/contextMenu/menuItem","swx-enums","swx-constants"],function(e){function s(e,o){function a(){e.dispatchEvent(i.message.EDIT,o,e.DIRECTION.PARENT)}if(!e||!o)throw new Error("Parameter missing: context and message are required");var u=t.fetch({key:"chatLogmenuItem_text_edit"});n.call(this,s.TYPE,u,a),this.isEnabled=function(){var e=o.status()===r.activityStatus.Succeeded,t=o.html&&o.html.set.enabled()&&o.text&&o.type()!==r.activityType.SystemMessage,n=o._isSMS&&o._isSMS();return!!e&&!!t&&!n}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("swx-enums"),i=e("swx-constants").COMMON.events;return s.prototype=Object.create(n.prototype),s.TYPE="EditMessageMenuItem",s}),define("text!views/ui/modalDialog/confirmationDialog.html",[],function(){return'<div id="swx-overlayConfirmationDialog" class="swx-overlayModal swx-hide" tabindex="-1">\r\n     <div class="overlayMain">\r\n        <div class="title">\r\n            <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="text:title"></h1>\r\n        </div>\r\n\r\n        <div id="swx-overlayConfirmationDialog-content" class="content"></div>\r\n\r\n        <div class="dual buttonRow">\r\n            <div class="column alignRight">\r\n                <button type="button" class="btn primary" data-bind="click: _confirm, focusHandler: { priority: 1 }"><span data-bind="text:confirmButtonTitle"></span></button>\r\n            </div>\r\n            <div class="column alignLeft">\r\n                <button type="button" class="btn secondary cancel" data-bind="click: _cancel"><span data-bind="text:cancelButtonTitle" class="clickable"></span></button>\r\n            </div>\r\n        </div>\r\n     </div>\r\n</div>\r\n'}),define("ui/modalDialog/confirmationDialog",["require","lodash-compat","utils/common/eventMixin","ui/modalDialog/modalDialog","swx-i18n","swx-utils-chat","vendor/knockout","text!views/ui/modalDialog/confirmationDialog.html","browser/dom"],function(e){function l(e){var t=this,n=e.onConfirm,l=e.onCancel;t.title=s.unboxHrefContent(e.title),t.text=e.text,t.content=e.content,t.contentViewModel=e.contentViewModel,t.avatar=e.avatar,t.confirmButtonTitle=e.confirmButtonTitle||i.fetch({key:"action_button_confirm"}),t.cancelButtonTitle=e.cancelButtonTitle||i.fetch({key:"action_button_cancel"}),t.isGroupConversation=o.observable(e.isGroupConversation||!1),t._cancel=function(){r.hide(f),l&&l()},t._confirm=function(){r.hide(f),n&&n()},t.show=function(){r.build(f,t,u),r.show(f,t.title);var e=a.getElementById("swx-overlayConfirmationDialog-content");e.innerHTML=t.content,t.contentViewModel&&(o.cleanNode(e),o.applyBindings(t.contentViewModel,e))}}var t=e("lodash-compat"),n=e("utils/common/eventMixin"),r=e("ui/modalDialog/modalDialog"),i=e("swx-i18n").localization,s=e("swx-utils-chat").messageSanitizer,o=e("vendor/knockout"),u=e("text!views/ui/modalDialog/confirmationDialog.html"),a=e("browser/dom"),f="swx-overlayConfirmationDialog";return l.ELEMENT_ID=f,l.build=function(e){return new l(e)},t.assign(l.prototype,n),l}),define("telemetry/chat/leaveConversationTelemetry",["require","exports","module","swx-constants","experience/settings","services/telemetry/skypeData","services/telemetry/common/telemetryContext"],function(e,t){function u(e,t){function p(){u.data={cta:e||c,action:c,participantsCount:t.participantsCount()||c,statusCode:c,tim:c,ttd:c,lmg:c}}function d(){var e={type:i.TYPE,data:u.data};s.push(e,r.telemetry.chatTenantToken),p()}function v(e,t){return t-e}function m(){return(new Date).getTime()}var u=this,a=m(),f,l,c=n.telemetry.NOT_AVAILABLE,h=o.get();t.historyService._lastMessageFromServer&&(f=t.historyService._lastMessageFromServer.timestamp()),u.started=function(){l=m()},u.canceled=function(){var e=m();u.data.action=i.action.CANCELED,u.data.tim=v(a,m()),f&&(u.data.lmg=v(f,e)),d()},u.completed=function(){u.data.action=i.action.CONFIRMED;var e=m();u.data.statusCode=h.statusCode,u.data.tim=v(a,e),f&&(u.data.lmg=v(f,e)),l&&(u.data.ttd=v(l,e)),d()},p()}var n=e("swx-constants").COMMON,r=e("experience/settings"),i=n.telemetry.leaveConversation,s=e("services/telemetry/skypeData"),o=e("services/telemetry/common/telemetryContext");t.build=function(e,t){return new u(e,t)}}),define("text!views/chat/leaveConversationDialogContent.html",[],function(){return'<swx-avatar params="avatar: avatar, isAgent: isAgentConversation, isGroupAvatar: isGroupConversation, size: 160" class="avatar"></swx-avatar>\r\n<p data-bind="text:text"></p>\r\n'}),define("ui/modalDialog/leaveConversationDialog",["require","exports","module","swx-i18n","ui/modalDialog/confirmationDialog","swx-constants","swx-service-locator-instance","telemetry/chat/leaveConversationTelemetry","swx-utils-chat","ui/modelHelpers/conversationHelper","text!views/chat/leaveConversationDialogContent.html"],function(e,t){function l(e){function t(){var e="leave_conversation_confirmation_text";return p()?n.fetch({key:d(e)}):n.fetch({key:e})}this.text=t(),this.avatar=e.avatarUrl(),this.isGroupConversation=e.isGroupConversation(),this.isAgentConversation=a.isOneToOneConversationWithAgent(e)}function c(e){return e||i.telemetry.NOT_AVAILABLE}function h(e){var t="leave_conversation_confirmation_title",r=n.fetch({key:"conversation_header_topic_untitled_conversation"}),i=e.topic()?u.getSanitizedTopic(e.topic()):r;return p()?n.fetch({key:d(t)}):n.fetch({key:t,params:{topic:i}})}function p(){return s.resolve(i.serviceLocator.FEATURE_FLAGS).isFeatureOn(i.featureFlags.USE_BUSINESS_WORDING)}function d(e){return e+"_4b"}var n=e("swx-i18n").localization,r=e("ui/modalDialog/confirmationDialog"),i=e("swx-constants").COMMON,s=e("swx-service-locator-instance").default,o=e("telemetry/chat/leaveConversationTelemetry"),u=e("swx-utils-chat").messageSanitizer,a=e("ui/modelHelpers/conversationHelper"),f=e("text!views/chat/leaveConversationDialogContent.html");t.start=function(e,t){var i,s;i=o.build(c(t),e),s={title:h(e),content:f,contentViewModel:new l(e),confirmButtonTitle:n.fetch({key:"action_button_leave"}),onConfirm:function(){e.leave.enabled()&&(i.started(),e.leave().finally(function(){i.completed()}))},onCancel:function(){i.canceled()}},r.build(s).show()},t.canLeaveConversation=function(e){var t=s.resolve(i.serviceLocator.FEATURE_FLAGS),n=!t.isFeatureOn(i.featureFlags.DISABLE_LEAVE_CONVERSATION);return n&&e.leave.enabled()}}),define("ui/contextMenu/items/leaveConversation",["require","swx-i18n","ui/contextMenu/menuItem","ui/modalDialog/leaveConversationDialog","swx-constants"],function(e){function s(e){function u(){r.start(e,i.TIMELINE_MENU)}if(!e)throw new Error("Parameter missing: conversation is required");var o=t.fetch({key:"recentItemMenuItem_text_leave"});n.call(this,s.TYPE,o,u),this.isEnabled=function(){return r.canLeaveConversation(e)}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("ui/modalDialog/leaveConversationDialog"),i=e("swx-constants").COMMON.telemetry.removeConversationHistory.cta;return s.prototype=Object.create(n.prototype),s.TYPE="LeaveConversationMenuItem",s}),define("ui/contextMenu/items/markConversationAsRead",["require","swx-constants","ui/contextMenu/menuItem","swx-i18n","swx-service-locator-instance","experience/settings","ui/telemetry/telemetryClient"],function(e){function u(e){function c(){var t={unreadCount:f.unreadActivityItemsCount(),participantsCount:e.participantsCount()};f.markAllAsRead(),h(t)}function h(e){var n=t.telemetry.markConversationAsRead.TYPE;o.get().sendEvent(s.telemetry.uiTenantToken,n,e)}var a=r.fetch({key:"recentItemMenuItem_text_markRead"}),f=e.historyService,l=i.resolve(t.serviceLocator.FEATURE_FLAGS);n.call(this,u.TYPE,a,c),this.isEnabled=function(){return l.isFeatureOn(t.featureFlags.CONTEXT_MENU_MARK_AS_READ_ENABLED)&&f.unreadActivityItemsCount()>0}}var t=e("swx-constants").COMMON,n=e("ui/contextMenu/menuItem"),r=e("swx-i18n").localization,i=e("swx-service-locator-instance").default,s=e("experience/settings"),o=e("ui/telemetry/telemetryClient");return u.prototype=Object.create(n.prototype),u.TYPE="MarkConversationAsReadMenuItem",u}),define("ui/contextMenu/items/markAllConversationsAsRead",["require","swx-constants","ui/contextMenu/menuItem","swx-i18n","swx-cafe-application-instance","swx-service-locator-instance","experience/settings","ui/telemetry/telemetryClient"],function(e){function a(e){function h(){var e={unreadConversationsCount:c._allUnreadConversationsCount()},t=c._allUnreadConversations().map(function(e){return e.id});t.forEach(function(e){var t=c._getOrCreateConversation(e).historyService;t.markAllAsRead()}),p(e)}function p(e){var n=t.telemetry.markAllConversationsAsRead.TYPE;u.get().sendEvent(o.telemetry.uiTenantToken,n,e)}var f=r.fetch({key:"recentItemMenuItem_text_markAllConversationsRead"}),l=s.resolve(t.serviceLocator.FEATURE_FLAGS),c=i.get().conversationsManager;n.call(this,a.TYPE,f,h),this.isEnabled=function(){return l.isFeatureOn(t.featureFlags.CONTEXT_MENU_MARK_AS_READ_ENABLED)&&c._allUnreadConversationsCount()>0&&(e.historyService.unreadActivityItemsCount()===0||c._allUnreadConversationsCount()>1)}}var t=e("swx-constants").COMMON,n=e("ui/contextMenu/menuItem"),r=e("swx-i18n").localization,i=e("swx-cafe-application-instance"),s=e("swx-service-locator-instance").default,o=e("experience/settings"),u=e("ui/telemetry/telemetryClient");return a.prototype=Object.create(n.prototype),a.TYPE="MarkAllConversationsAsReadMenuItem",a}),define("ui/contextMenu/items/mutingConversation",["require","exports","module","ui/telemetry/actions/actionNames","swx-constants","ui/contextMenu/menuItem","swx-i18n","swx-service-locator-instance"],function(e,t){function u(e){return function(t){function f(){t.chatService._updateNotificationSettings(!e),l()}function l(){var t=o.resolve(r.serviceLocator.ACTION_TELEMETRY);t.recordAction(e?n.contextMenu.recents.notificationsMuted:n.contextMenu.recents.notificationsUnmuted)}this.prototype=Object.create(i.prototype),this.TYPE=e?"MuteConversationMenuItem":"UnmuteConversationMenuItem";var u=s.fetch({key:e?"recentItemMenuItem_text_muteConversation":"recentItemMenuItem_text_unmuteConversation"}),a=o.resolve(r.serviceLocator.FEATURE_FLAGS);i.call(this,this.TYPE,u,f),this.isEnabled=function(){return a.isFeatureOn(r.featureFlags.MUTE_SPECIFIC_CONVERSATIONS_ENABLED)&&t._notificationsEnabled()===e}}}var n=e("ui/telemetry/actions/actionNames"),r=e("swx-constants").COMMON,i=e("ui/contextMenu/menuItem"),s=e("swx-i18n").localization,o=e("swx-service-locator-instance").default;t.MuteConversationMenuItem=u(!0),t.UnmuteConversationMenuItem=u(!1)}),define("ui/contextMenu/items/openConversation",["require","swx-i18n","ui/contextMenu/menuItem","swx-pubsub-instance","swx-constants"],function(e){function o(e){function a(){r.publish(s.OPEN_CONVERSATION,{model:e,origin:i.telemetry.historyLoadOrigin.ROSTER})}var u=t.fetch({key:"label_text_headerMenuInstantMessage"});n.call(this,o.TYPE,u,a)}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("swx-pubsub-instance").default,i=e("swx-constants").COMMON,s=i.events.navigation;return o.prototype=Object.create(n.prototype),o.TYPE="OpenConversationMenuItem",o}),define("ui/contextMenu/items/openConversationWithPerson",["require","swx-i18n","ui/contextMenu/menuItem","swx-service-locator-instance","swx-constants","swx-cafe-application-instance"],function(e){function o(e,u){function l(){var t=r.resolve(i.serviceLocator.PUBSUB),n=s.get().conversationsManager.getConversation(e),o={model:n,origin:u||i.telemetry.historyLoadOrigin.ROSTER};t.publish(i.events.navigation.OPEN_CONVERSATION,o),s.get().conversationsManager.conversations.add(n)}var a=this,f=t.fetch({key:"label_text_headerMenuInstantMessage"});n.call(a,o.TYPE,f,l)}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("swx-service-locator-instance").default,i=e("swx-constants").COMMON,s=e("swx-cafe-application-instance");return o.prototype=Object.create(n.prototype),o.TYPE="OpenConversationWithPersonMenuItem",o}),define("ui/contextMenu/items/viewPersonProfile",["require","swx-i18n","ui/contextMenu/menuItem","swx-service-locator-instance","swx-constants","swx-cafe-application-instance","ui/modelHelpers/personHelper"],function(e){function u(e,a,f){function h(){var t=r.resolve(i.serviceLocator.PUBSUB),n=s.get().conversationsManager.getConversation(e),o={model:n,origin:a,target:{expandProfile:!0},telemetryContext:f};t.publish(i.events.navigation.OPEN_CONVERSATION,o),s.get().conversationsManager.conversations.add(n)}var l=this,c=t.fetch({key:"label_text_view_profile_menu_item"});n.call(l,u.TYPE,c,h),l.isEnabled=function(){return!o.isWelcomeAgent(e)}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("swx-service-locator-instance").default,i=e("swx-constants").COMMON,s=e("swx-cafe-application-instance"),o=e("ui/modelHelpers/personHelper");return u.prototype=Object.create(n.prototype),u.TYPE="ViewPersonProfileMenuItem",u}),define("telemetry/chat/quoteMessageEvent",["require","experience/settings","ui/telemetry/telemetryClient","swx-log-tracer","swx-constants"],function(e){function s(){var e;this.publish=function(s,o,u){e=i.events.actions.messageQuoted;try{var a={source:o,timeInStale:Math.round(((new Date).getTime()-(s&&s.timestamp().getTime()))/1e3),lengthOfQuote:s&&s.text().length,actionSuccess:u};n.get().sendEvent(t.telemetry.chatTenantToken,e,a)}catch(f){r.error("Unable to send quote action telemetry: "),r.error(f)}}}var t=e("experience/settings"),n=e("ui/telemetry/telemetryClient"),r=e("swx-log-tracer").getLogger(),i=e("swx-constants").COMMON;return new s}),define("ui/contextMenu/items/quoteMessage",["require","swx-i18n","ui/contextMenu/menuItem","swx-service-locator-instance","swx-constants","swx-enums","telemetry/chat/quoteMessageEvent","ui/telemetry/actions/actionSources"],function(e){function a(e,f){function h(){var e=u.contextMenuItem.quoteMessage;o.publish(f,e)}function p(){e.dispatchEvent(i.events.message.QUOTE,f,e.DIRECTION.PARENT),h()}if(!e||!f)throw new Error("Parameter missing: context and message are required");var l=t.fetch({key:"chatLogmenuItem_text_quote"}),c=r.resolve(i.serviceLocator.FEATURE_FLAGS);n.call(this,a.TYPE,l,p),this.isEnabled=function(){var e=c.isFeatureOn(i.featureFlags.CONTEXT_MENU_QUOTE_MESSAGES_ENABLED);return e&&!!f.text&&!f.isDeleted()&&f.type()!==s.activityType.SystemMessage}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("swx-service-locator-instance").default,i=e("swx-constants").COMMON,s=e("swx-enums"),o=e("telemetry/chat/quoteMessageEvent"),u=e("ui/telemetry/actions/actionSources");return a.prototype=Object.create(n.prototype),a.TYPE="QuoteMessageMenuItem",a}),define("telemetry/translator/translatorTelemetry",["require","exports","module","experience/settings","ui/telemetry/telemetryClient"],function(e,t){function i(){var e=this;e.send=function(e,t){var i=t||{};r.get().sendEvent(n.telemetry.chatTenantToken,e,i)}}var n=e("experience/settings"),r=e("ui/telemetry/telemetryClient");t.build=function(){return new i}}),define("utils/chat/translatorHelper",["require","exports","module","swx-cafe-application-instance","swx-constants","swx-utils-chat","ui/modelHelpers/personHelper","telemetry/translator/translatorTelemetry","lodash-compat"],function(e,t){function f(e){var t=e&&e().length,n;return t?(n=a.filter(e(),function(e){return e.users&&e.users[0]&&s.isMePersonId(e.users[0].mri)}),n.length?n[0]:null):null}var n=e("swx-cafe-application-instance"),r=e("swx-constants").COMMON,i=e("swx-utils-chat").messageSanitizer,s=e("ui/modelHelpers/personHelper"),o=r.telemetry.translator,u=e("telemetry/translator/translatorTelemetry"),a=e("lodash-compat");t.extractLanguageKey=function(e){if(!e)return;var t=/original./,n=t.test(e),r=e.replace(t,"");return n?r.substring(0,r.lastIndexOf(".")):e},t.isMatchingMyLanguage=function(e,n){var r=n&&n.isEnabled&&n.meLanguage?n.meLanguage.code:null,i=t.extractLanguageKey(e);return i===r},t.findMatchingTranslation=function(e,n){var r=e&&e().length,i,s;return r?(a.some(e(),function(e){return t.isMatchingMyLanguage(e.key,n)&&e.users&&e.users[0]&&e.users[0].value?(i=e.users[0].value,!0):!1}),i||(s=f(e),i=s?s.users[0].value:i),i):i},t.requestTranslation=function(e,t,s,a){function b(e){typeof a=="function"&&a(e)}function w(e){var t=e&&e.statusText||"Translator service failed";h.send(d,{action:o.action.TRANSLATE,error:t,language:g}),b({message:v})}function E(t){var n=i.removeNoTranslateTags(t),r=p?y:g,u=p?i.processOutgoingTextMessage(v,s):n,a=p?n:v,f={message:a,translation:{key:r,users:[{value:u,mri:c}]}};h.send(d,{action:o.action.TRANSLATE,success:!0,language:g});if(e===n){b({message:v});return}b(f)}var f=n.get(),l=f.translatorService,c=f.personsAndGroupsManager.mePerson.id(),h=u.build(),p=t===r.chat.messageType.OUTGOING,d=p?o.eventType.OUTGOING:o.eventType.INCOMING,v=e,m=p?i.processOutgoingTextMessageForTranslation(e,s):i.processIncomingSanitizedTextMessageForTranslation(e),g,y;p?(y=s._translatorSettings.meLanguage.code,g=s._translatorSettings.participantLanguage.code):g=s._translatorSettings.meLanguage.code,l.translateMessage(y,g,m).then(E,w)}}),define("utils/common/clipboard",[],function(){function n(n){e=document.createElement("input"),e.readOnly=!0,e.style.display="none";var i=document.getElementById("swxContent1");return i?i.appendChild(e):document.body.appendChild(e),t.copyText=r,t.copyText(n)}function r(t){e.style.display="",e.value=t,e.focus(),e.setSelectionRange(0,t.length);var n=!1;try{n=document.execCommand("copy")}catch(r){}return e.style.display="none",n}function i(){var e=!1;try{e=document.queryCommandSupported("copy")}catch(t){}return e}var e,t={copyText:n,isCopySupportedByBrowser:i,_reset:function(){t.copyText=n}};return t}),define("utils/chat/quoteMessageUtils",["require","exports","module","swx-cafe-application-instance","lodash-compat","swx-encoder","swx-encoder","swx-encoder","swx-utils-chat","swx-utils-chat","utils/chat/translatorHelper","swx-service-locator-instance","swx-constants","utils/common/clipboard"],function(e,t){function p(e){var t=a.unboxHrefContent(e.text()),n=e.getOriginalContent(),i=a.quotesPresentInXML(n);if(i==="")return t;try{var s=i.replace(/<<</g,"&lt;&lt;&lt;"),o=(new DOMParser).parseFromString(s,"text/xml");if(o.getElementsByTagName("parsererror").length!==0)throw new Error("ParserError");var u=o.documentElement.getElementsByTagName("legacyquote");if(r.isUndefined(u)||u.length!==2||o.childNodes.length!==1||o.childNodes[0].childNodes.length!==3)throw new Error("Bad quotes format error");var f=u[0].textContent+o.childNodes[0].childNodes[1].textContent+u[1].textContent;return f+=n.replace(i,""),f}catch(l){return t}}var n=e("swx-cafe-application-instance"),r=e("lodash-compat"),i=e("swx-encoder"),s=e("swx-encoder").QuoteEncoder,o=e("swx-encoder").QuoteDecoder,u=e("swx-utils-chat").dateTime,a=e("swx-utils-chat").messageSanitizer,f=e("utils/chat/translatorHelper"),l=e("swx-service-locator-instance"),c=e("swx-constants").COMMON,h=e("utils/common/clipboard");t.getContentToQuote=function(e){var t=p(e),n=f.findMatchingTranslation(e.translations,e.conversation._translatorSettings),r=l.default.resolve(c.serviceLocator.FEATURE_FLAGS),i=r.isFeatureOn(c.featureFlags.TRANSLATOR_SENDING_ENABLED),s=i&&n?a.extractMessageTextContent(n):t;return s},t.getQuotedXmlString=function(e,t,r,o,u){var a=s.build(),f=i.URLDomTransformer.build(),l={author:e,authorName:t,quoteMessage:r,conversationId:o,timestamp:u};return i.build(n,{domTransformers:[a,f]}).encode(JSON.stringify(l))},t.getQuotesDisplay=function(e){return i.build(n,{domDecoders:[o.build(u.formatTimestamp)]}).decode(e)},t.copySelectionAsQuote=function(e,t,n){var r=h.copyText(t);return n._setMessageCopiedToCache({sourceMessage:e,selectedText:t}),r},t.copyMessageAsQuote=function(e,t){var n=this.getContentToQuote(e),r=h.copyText(n);return t._setMessageCopiedToCache({sourceMessage:e}),r}}),define("ui/contextMenu/items/copyMessageMenuItem",["require","swx-constants","swx-i18n","ui/contextMenu/menuItem","swx-service-locator-instance","telemetry/chat/quoteMessageEvent","ui/telemetry/actions/actionSources","swx-enums","utils/chat/quoteMessageUtils","swx-cafe-application-instance","utils/common/clipboard"],function(e){function c(e,h){function m(e){var t=o.contextMenuItem.copyMessage;s.publish(h,t,e)}function g(){var e=a.copyMessageAsQuote(h,v);m(e)}if(!e||!h)throw new Error("Parameter missing: context and message are required");var p=n.fetch({key:"chatLogmenuItem_text_copy"}),d=i.resolve(t.serviceLocator.FEATURE_FLAGS),v=f.get().conversationsManager;r.call(this,c.TYPE,p,g),this.isEnabled=function(){var e=d.isFeatureOn(t.featureFlags.CONTEXT_MENU_COPY_MESSAGES_ENABLED),n=l.isCopySupportedByBrowser();return n&&e&&!!h.text&&!h.isDeleted()&&h.type()!==u.activityType.SystemMessage}}var t=e("swx-constants").COMMON,n=e("swx-i18n").localization,r=e("ui/contextMenu/menuItem"),i=e("swx-service-locator-instance").default,s=e("telemetry/chat/quoteMessageEvent"),o=e("ui/telemetry/actions/actionSources"),u=e("swx-enums"),a=e("utils/chat/quoteMessageUtils"),f=e("swx-cafe-application-instance"),l=e("utils/common/clipboard");return c.prototype=Object.create(r.prototype),c.TYPE="CopyMessageMenuItem",c}),define("ui/contextMenu/items/copySelectionMenuItem",["require","swx-constants","swx-i18n","ui/contextMenu/menuItem","swx-service-locator-instance","telemetry/chat/quoteMessageEvent","ui/telemetry/actions/actionSources","swx-enums","utils/chat/quoteMessageUtils","swx-cafe-application-instance","utils/common/clipboard"],function(e){function c(e,h,p){function g(e){var t=o.contextMenuItem.copySelection;s.publish(h,t,e)}function y(){var e=a.copySelectionAsQuote(h,p,m);g(e)}if(!e||!h||!p)throw new Error("Parameter missing: context, message and textSelection are required");var d=n.fetch({key:"chatLogmenuItem_text_copySelection"}),v=i.resolve(t.serviceLocator.FEATURE_FLAGS),m=f.get().conversationsManager;r.call(this,c.TYPE,d,y),this.isEnabled=function(){var e=v.isFeatureOn(t.featureFlags.CONTEXT_MENU_COPY_MESSAGES_ENABLED),n=l.isCopySupportedByBrowser();return n&&e&&!!h.text&&!h.isDeleted()&&h.type()!==u.activityType.SystemMessage}}var t=e("swx-constants").COMMON,n=e("swx-i18n").localization,r=e("ui/contextMenu/menuItem"),i=e("swx-service-locator-instance").default,s=e("telemetry/chat/quoteMessageEvent"),o=e("ui/telemetry/actions/actionSources"),u=e("swx-enums"),a=e("utils/chat/quoteMessageUtils"),f=e("swx-cafe-application-instance"),l=e("utils/common/clipboard");return c.prototype=Object.create(r.prototype),c.TYPE="CopySelectionMenuItem",c}),define("ui/contextMenu/items/copySelectionTextMenuItem",["require","swx-constants","swx-i18n","ui/contextMenu/menuItem","swx-service-locator-instance","telemetry/chat/quoteMessageEvent","ui/telemetry/actions/actionSources","swx-enums","utils/common/clipboard","swx-cafe-application-instance"],function(e){function l(e,c,h){function m(e){var t=o.contextMenuItem.copySelectionText;s.publish(c,t,e)}function g(){var e=a.copyText(h);v._setMessageCopiedToCache(undefined),m(e)}if(!e||!c||!h)throw new Error("Parameter missing: context, message and textSelection are required");var p=n.fetch({key:"chatLogmenuItem_text_copyText"}),d=i.resolve(t.serviceLocator.FEATURE_FLAGS),v=f.get().conversationsManager;r.call(this,l.TYPE,p,g),this.isEnabled=function(){var e=d.isFeatureOn(t.featureFlags.CONTEXT_MENU_COPY_MESSAGES_ENABLED),n=a.isCopySupportedByBrowser();return n&&e&&!!c.text&&!c.isDeleted()&&c.type()!==u.activityType.SystemMessage}}var t=e("swx-constants").COMMON,n=e("swx-i18n").localization,r=e("ui/contextMenu/menuItem"),i=e("swx-service-locator-instance").default,s=e("telemetry/chat/quoteMessageEvent"),o=e("ui/telemetry/actions/actionSources"),u=e("swx-enums"),a=e("utils/common/clipboard"),f=e("swx-cafe-application-instance");return l.prototype=Object.create(r.prototype),l.TYPE="CopySelectionTextMenuItem",l}),define("telemetry/chat/removeConversationHistoryTelemetry",["require","exports","module","swx-constants","experience/settings","services/telemetry/skypeData","services/telemetry/common/telemetryContext"],function(e,t){function u(e,t){function p(){u.data={cta:e||c,action:c,participantsCount:t.participantsCount()||c,statusCode:c,tim:c,ttd:c,lmg:c}}function d(){var e={type:i.TYPE,data:u.data};s.push(e,r.telemetry.chatTenantToken),p()}function v(e,t){return t-e}function m(){return(new Date).getTime()}var u=this,a=m(),f,l,c=n.telemetry.NOT_AVAILABLE,h=o.get();t.historyService._lastMessageFromServer&&(f=t.historyService._lastMessageFromServer.timestamp()),u.started=function(){l=m()},u.canceled=function(){var e=m();u.data.action=i.action.CANCELED,u.data.tim=v(a,e),f&&(u.data.lmg=v(f,e)),d()},u.completed=function(){u.data.action=i.action.CONFIRMED;var e=m();u.data.statusCode=h.statusCode,u.data.tim=v(a,e),f&&(u.data.lmg=v(f,e)),l&&(u.data.ttd=v(l,e)),d()},p()}var n=e("swx-constants").COMMON,r=e("experience/settings"),i=n.telemetry.removeConversationHistory,s=e("services/telemetry/skypeData"),o=e("services/telemetry/common/telemetryContext");t.build=function(e,t){return new u(e,t)}}),define("text!views/chat/removeConversationHistoryDialogContent.html",[],function(){return'<div id="removeConversationHistoryDialogContent">\r\n    <swx-avatar params="avatar: avatar, isAgent: isAgentConversation, isGroupAvatar: isGroupConversation, displayName: topic, size:160" class="avatar"></swx-avatar>\r\n    <p data-bind="text:text"></p>\r\n</div>\r\n'}),define("ui/modalDialog/removeConversationHistoryDialog",["require","exports","module","swx-cafe-application-instance","swx-i18n","ui/modalDialog/confirmationDialog","swx-service-locator-instance","swx-constants","telemetry/chat/removeConversationHistoryTelemetry","text!views/chat/removeConversationHistoryDialogContent.html","ui/modelHelpers/conversationHelper","utils/common/accessibility"],function(e,t){function c(e){this.text=d(),this.avatar=e.avatarUrl(),this.isGroupConversation=e.isGroupConversation(),this.isAgentConversation=f.isOneToOneConversationWithAgent(e),this.topic=e.topic()}function h(){return s.resolve(o.serviceLocator.FEATURE_FLAGS).isFeatureOn(o.featureFlags.USE_BUSINESS_WORDING)}function p(e){return e+"_4b"}function d(){var e="remove_conversation_confirmation_text";return h()?r.fetch({key:p(e)}):r.fetch({key:e})}function v(){var e="remove_conversation_confirmation_title";return h()?r.fetch({key:p(e)}):r.fetch({key:e})}function m(){var e="action_button_delete";return h()?r.fetch({key:p(e)}):r.fetch({key:e})}var n=e("swx-cafe-application-instance"),r=e("swx-i18n").localization,i=e("ui/modalDialog/confirmationDialog"),s=e("swx-service-locator-instance").default,o=e("swx-constants").COMMON,u=e("telemetry/chat/removeConversationHistoryTelemetry"),a=e("text!views/chat/removeConversationHistoryDialogContent.html"),f=e("ui/modelHelpers/conversationHelper"),l=e("utils/common/accessibility").narrator;t.start=function(e,t){function g(){e.historyService.removeAll.enabled()&&(h.started(),l.announce({key:"accessibility_remove_conversation_confirmation"}),e.historyService.removeAll().then(function(){f.conversations.remove(e).finally(function(){h.completed();var t={model:e,page:"swx-conversation"};p.publish(o.events.navigation.FRAGMENT_REMOVE,t)})}))}function y(){h.canceled()}var r,f=n.get().conversationsManager,h,p,d;p=s.resolve(o.serviceLocator.PUBSUB),d=s.resolve(o.serviceLocator.FEATURE_FLAGS),h=u.build(t,e),d.isFeatureOn(o.featureFlags.DISABLE_REMOVE_CONVERSATION_CONFIRMATION)?g():(r=i.build({title:v(),content:a,contentViewModel:new c(e),avatar:e.avatarUrl(),onConfirm:g,onCancel:y,confirmButtonTitle:m()}),r.show())},t.canDeleteConversation=function(e){var t=s.resolve(o.serviceLocator.FEATURE_FLAGS),n=t.isFeatureOn(o.featureFlags.REMOVE_CONVERSATION_HISTORY);return n&&e.historyService.removeAll.enabled()}}),define("ui/contextMenu/items/removeConversationHistory",["require","swx-i18n","ui/contextMenu/menuItem","ui/modalDialog/removeConversationHistoryDialog","swx-service-locator-instance","swx-constants"],function(e){function o(){return i.resolve(s.serviceLocator.FEATURE_FLAGS).isFeatureOn(s.featureFlags.USE_BUSINESS_WORDING)}function u(e){return e+"_4b"}function a(){var e="recentItemMenuItem_text_remove";return o()?t.fetch({key:u(e)}):t.fetch({key:e})}function f(e){function t(){r.start(e,s.telemetry.leaveConversation.cta.TIMELINE_MENU)}if(!e)throw new Error("Parameter missing: conversation is required");n.call(this,f.TYPE,a(),t),this.isEnabled=function(){return r.canDeleteConversation(e)}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("ui/modalDialog/removeConversationHistoryDialog"),i=e("swx-service-locator-instance").default,s=e("swx-constants").COMMON;return f.prototype=Object.create(n.prototype),f.TYPE="RemoveConversationHistoryMenuItem",f}),define("ui/contextMenu/items/addGroupConversationToFavorites",["require","experience/settings","swx-i18n","ui/contextMenu/menuItem","swx-service-locator-instance","swx-constants","swx-telemetry-buckets","ui/telemetry/telemetryClient"],function(e){function a(){return n.fetch({key:"favorites_add_to_favorite"})}function f(e,n){function l(){e._isFavorited&&e._isFavorited(!0),c()}function c(){var r="favorite_added",i=e.participantsCount(),a={origin:n||s.telemetry.NOT_AVAILABLE,isGroup:!0,participantCount:i,participantCountGroup:o.getParticipantCountGroup(i)};u.get().sendEvent(t.telemetry.uiTenantToken,r,a)}if(!e)throw new Error("Parameter missing: conversation is required");r.call(this,f.TYPE,a(),l),this.isEnabled=function(){var t=i.resolve(s.serviceLocator.FEATURE_FLAGS).isFeatureOn(s.featureFlags.FAVORITES_CONVERSATION_ENABLED),n=!!e._isFavorited&&!e._isFavorited(),r=e.leave.enabled();return t&&n&&r}}var t=e("experience/settings"),n=e("swx-i18n").localization,r=e("ui/contextMenu/menuItem"),i=e("swx-service-locator-instance").default,s=e("swx-constants").COMMON,o=e("swx-telemetry-buckets"),u=e("ui/telemetry/telemetryClient");return f.prototype=Object.create(r.prototype),f.TYPE="AddToFavoritesMenuItem",f}),define("ui/contextMenu/items/addContactToFavorites",["require","lodash-compat","experience/settings","swx-i18n","ui/contextMenu/menuItem","swx-service-locator-instance","swx-constants","swx-telemetry-buckets","ui/modelHelpers/personActionsHelper","ui/modelHelpers/groupHelper","swx-enums","ui/telemetry/telemetryClient"],function(e){function h(){return r.fetch({key:"favorites_add_to_favorite"})}function p(e,r){function v(){a.addFavorite(d),m()}function m(){var e="favorite_added",t={origin:r||o.telemetry.NOT_AVAILABLE,isGroup:!1,participantCount:1,participantCountGroup:u.getParticipantCountGroup(1)};c.get().sendEvent(n.telemetry.uiTenantToken,e,t)}var d;if(!e)throw new Error("Parameter missing: contact is required");d=t.isFunction(e.getPerson)?e.getPerson():e,i.call(this,p.TYPE,h(),v),this.isEnabled=function(){var e=s.resolve(o.serviceLocator.FEATURE_FLAGS).isFeatureOn(o.featureFlags.FAVORITE_CONTACTS_ENABLED),t=f.isPersonInGroup(l.groupType.Favorites,d),n=f.isPersonInGroup(l.groupType.Root,d);return e&&!t&&n}}var t=e("lodash-compat"),n=e("experience/settings"),r=e("swx-i18n").localization,i=e("ui/contextMenu/menuItem"),s=e("swx-service-locator-instance").default,o=e("swx-constants").COMMON,u=e("swx-telemetry-buckets"),a=e("ui/modelHelpers/personActionsHelper"),f=e("ui/modelHelpers/groupHelper"),l=e("swx-enums"),c=e("ui/telemetry/telemetryClient");return p.prototype=Object.create(i.prototype),p.TYPE="AddToFavoritesMenuItem",p}),define("ui/contextMenu/items/removeGroupConversationFromFavorites",["require","experience/settings","swx-i18n","ui/contextMenu/menuItem","swx-service-locator-instance","swx-constants","swx-telemetry-buckets","ui/telemetry/telemetryClient"],function(e){function a(){return n.fetch({key:"favorites_remove_from_favorite"})}function f(e,n){function l(){e._isFavorited&&e._isFavorited(!1),c()}function c(){var r="favorite_removed",i=e.participantsCount(),a={origin:n||s.telemetry.NOT_AVAILABLE,isGroup:!0,participantCount:i,participantCountGroup:o.getParticipantCountGroup(i)};u.get().sendEvent(t.telemetry.uiTenantToken,r,a)}if(!e)throw new Error("Parameter missing: conversation is required");r.call(this,f.TYPE,a(),l),this.isEnabled=function(){var t=i.resolve(s.serviceLocator.FEATURE_FLAGS).isFeatureOn(s.featureFlags.FAVORITES_CONVERSATION_ENABLED),n=!!e._isFavorited&&e._isFavorited();return t&&n}}var t=e("experience/settings"),n=e("swx-i18n").localization,r=e("ui/contextMenu/menuItem"),i=e("swx-service-locator-instance").default,s=e("swx-constants").COMMON,o=e("swx-telemetry-buckets"),u=e("ui/telemetry/telemetryClient");return f.prototype=Object.create(r.prototype),f.TYPE="RemoveFromFavoritesMenuItem",f}),define("ui/contextMenu/items/removeContactFromFavorites",["require","lodash-compat","experience/settings","swx-i18n","ui/contextMenu/menuItem","swx-service-locator-instance","swx-constants","swx-telemetry-buckets","ui/modelHelpers/personActionsHelper","ui/modelHelpers/groupHelper","swx-enums","ui/telemetry/telemetryClient"],function(e){function h(){return r.fetch({key:"favorites_remove_from_favorite"})}function p(e,r){function v(){a.removeFavorite(d),m()}function m(){var e="favorite_removed",t={origin:r||o.telemetry.NOT_AVAILABLE,isGroup:!1,participantCount:1,participantCountGroup:u.getParticipantCountGroup(1)};c.get().sendEvent(n.telemetry.uiTenantToken,e,t)}var d;if(!e)throw new Error("Parameter missing: contact is required");d=t.isFunction(e.getPerson)?e.getPerson():e,i.call(this,p.TYPE,h(),v),this.isEnabled=function(){var e=s.resolve(o.serviceLocator.FEATURE_FLAGS).isFeatureOn(o.featureFlags.FAVORITE_CONTACTS_ENABLED),t=f.isPersonInGroup(l.groupType.Favorites,d),n=f.isPersonInGroup(l.groupType.Root,d);return e&&t&&n}}var t=e("lodash-compat"),n=e("experience/settings"),r=e("swx-i18n").localization,i=e("ui/contextMenu/menuItem"),s=e("swx-service-locator-instance").default,o=e("swx-constants").COMMON,u=e("swx-telemetry-buckets"),a=e("ui/modelHelpers/personActionsHelper"),f=e("ui/modelHelpers/groupHelper"),l=e("swx-enums"),c=e("ui/telemetry/telemetryClient");return p.prototype=Object.create(i.prototype),p.TYPE="RemoveFromFavoritesMenuItem",p}),define("ui/contextMenu/items/removeMessage",["require","swx-i18n","ui/contextMenu/menuItem","swx-enums","swx-service-locator-instance","swx-constants","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","swx-telemetry-buckets","swx-pubsub-instance"],function(e){function c(e,h){function d(){var t=e.model?e.clientmessageid:e.key();e.html(""),m(),l.publish(o.message.REMOVED,t)}function v(){return new Date-e.timestamp()}function m(){h.lifetime=v(),h.timedelta=f.getMessageLifeDurationGroup(new Date-e.timestamp()),h.type=e.type();var t=i.resolve(s.serviceLocator.ACTION_TELEMETRY);t.recordAction(u.chat.removeMessage,h)}if(!e)throw new Error("Parameter missing: message is required");var p=t.fetch({key:"chatLogmenuItem_text_remove"});h=h||{source:a.contextMenuItem.removeMessage},n.call(this,c.TYPE,p,d),this.isEnabled=function(){var t=e.status()===r.activityStatus.Succeeded,n=e.html&&e.html.set.enabled(),i=n&&!e.isDeleted()&&e.type()!==r.activityType.SystemMessage,s=e._isSMS&&e._isSMS();return!!t&&!!i&&!s}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("swx-enums"),i=e("swx-service-locator-instance").default,s=e("swx-constants").COMMON,o=s.events,u=e("ui/telemetry/actions/actionNames"),a=e("ui/telemetry/actions/actionSources"),f=e("swx-telemetry-buckets"),l=e("swx-pubsub-instance").default;return c.prototype=Object.create(n.prototype),c.TYPE="RemoveMessageMenuItem",c}),define("ui/contextMenu/items/copyLink",["require","utils/common/clipboard","swx-constants","swx-telemetry-buckets","swx-i18n","ui/contextMenu/menuItem","experience/settings","ui/telemetry/telemetryClient","browser/window"],function(e){function f(e,l,c){function d(){t.copyText(p),v()}function v(){var t="message_urlpreview_copy_link",i=e.conversation.participantsCount(),s=(new a.Date).getTime()-l.timestamp.getTime(),f={tis:s,ttcGroup:r.getMessageLifeDurationGroup(s),participantCount:i,participantCountGroup:r.getParticipantCountGroup(i),contentType:l.copyLinkEnabled()?l.previews()[0].type():n.telemetry.NOT_AVAILABLE};u.get().sendEvent(o.telemetry.uiTenantToken,t,f)}if(!e||!l)throw new Error("Parameter missing: context and message are required");var h=i.fetch({key:"chatLogmenuItem_copy_link"});s.call(this,f.TYPE,h,d);var p=l.copyLinkEnabled()?l.previews()[0].originalRequest:c&&c.target&&c.target.href;this.isEnabled=function(){var e=t.isCopySupportedByBrowser();return e&&(l.copyLinkEnabled()||!!p)}}var t=e("utils/common/clipboard"),n=e("swx-constants").COMMON,r=e("swx-telemetry-buckets"),i=e("swx-i18n").localization,s=e("ui/contextMenu/menuItem"),o=e("experience/settings"),u=e("ui/telemetry/telemetryClient"),a=e("browser/window");return f.prototype=Object.create(s.prototype),f.TYPE="CopyLinkMenuItem",f}),define("ui/contextMenu/items/openLink",["require","swx-constants","swx-telemetry-buckets","swx-focus-handler","swx-i18n","ui/contextMenu/menuItem","experience/settings","ui/telemetry/telemetryClient","browser/window"],function(e){function f(e,l,c){function d(){var e=a.open(p,"_blank");r.get().addFocusRequestToQueue(e),v()}function v(){var r="message_urlpreview_open_link",i=e.conversation.participantsCount(),s=(new a.Date).getTime()-l.timestamp.getTime(),f={tis:s,ttcGroup:n.getMessageLifeDurationGroup(s),participantCount:i,participantCountGroup:n.getParticipantCountGroup(i),contentType:l.copyLinkEnabled()?l.previews()[0].type():t.telemetry.NOT_AVAILABLE};u.get().sendEvent(o.telemetry.uiTenantToken,r,f)}if(!e||!l)throw new Error("Parameter missing: context and message are required");var h=i.fetch({key:"chatLogmenuItem_open_link"});s.call(this,f.TYPE,h,d);var p=l.copyLinkEnabled()?l.previews()[0].originalRequest:c&&c.target&&c.target.href;this.isEnabled=function(){return l.copyLinkEnabled()||!!p}}var t=e("swx-constants").COMMON,n=e("swx-telemetry-buckets"),r=e("swx-focus-handler"),i=e("swx-i18n").localization,s=e("ui/contextMenu/menuItem"),o=e("experience/settings"),u=e("ui/telemetry/telemetryClient"),a=e("browser/window");return f.prototype=Object.create(s.prototype),f.TYPE="OpenLinkMenuItem",f}),define("ui/contextMenu/items/removeParticipant",["require","swx-i18n","ui/contextMenu/menuItem"],function(e){function r(e,i){function o(){e.participants.remove(i)}if(!e||!i)throw new Error("Parameter missing: conversation and participant are required");var s=t.fetch({key:"label_text_headerMenuRemoveGroup"});n.call(this,r.TYPE,s,o),this.isEnabled=function(){return e.participants.remove.enabled()}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem");return r.prototype=Object.create(n.prototype),r.TYPE="RemoveParticipantMenuItem",r}),define("ui/contextMenu/items/saveVideoMessage",["require","swx-i18n","browser/dom","ui/contextMenu/menuItem","swx-service-locator-instance","swx-constants","swx-enums","ui/telemetry/actions/actionNames"],function(e){function a(e){function c(){var t=n.createElement("a");t.href=e.mediaUrl(),t.click()}function h(){var e=i.resolve(s.serviceLocator.ACTION_TELEMETRY);e.recordAction(u.chat.saveVideoMessage)}function p(){c(),h()}if(!e)throw new Error("Parameter missing: message is required");var f=t.fetch({key:"chatLogmenuItem_text_save"}),l=i.resolve(s.serviceLocator.FEATURE_FLAGS);r.call(this,a.TYPE,f,p),this.isEnabled=function(){var t=l.isFeatureOn(s.featureFlags.CONTEXT_MENU_SAVE_VIDEO_MESSAGES_ENABLED),n=e.type()===o.activityType.VideoMessage;return t&&n&&!e.isDeleted()}}var t=e("swx-i18n").localization,n=e("browser/dom"),r=e("ui/contextMenu/menuItem"),i=e("swx-service-locator-instance").default,s=e("swx-constants").COMMON,o=e("swx-enums"),u=e("ui/telemetry/actions/actionNames");return a.prototype=Object.create(r.prototype),a.TYPE="SaveVideoMessageMenuItem",a}),define("telemetry/calling/pstn/pstn",["require","experience/settings","ui/telemetry/telemetryClient","swx-constants"],function(e){function i(){function e(e,r){var i={Entry_Point:r};n.get().sendEvent(t.telemetry.uiTenantToken,e,i)}function i(e,r){var i={Credit_Update_Duration_Seconds:r};n.get().sendEvent(t.telemetry.uiTenantToken,e,i)}this.initiatingPSTNCall=function(t){e(r.eventName.PSTN_CALL_INITIATED,t)},this.addingSubscription=function(t){e(r.eventName.ADD_SUBSCRIPTION,t)},this.addingCredit=function(t){e(r.eventName.ADD_CREDIT,t)},this.updatingCreditBalance=function(e){i(r.eventName.CREDIT_BALANCE_UPDATE_CALL_END,e)}}var t=e("experience/settings"),n=e("ui/telemetry/telemetryClient"),r=e("swx-constants").COMMON.telemetry.pstn;return new i}),define("ui/contextMenu/items/startPSTNCall",["require","ui/contextMenu/items/baseCallingMenuItem","swx-i18n","swx-service-locator-instance","swx-constants","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","constants/cssClasses","swx-enums","swx-cafe-application-instance","telemetry/calling/pstn/pstn","swx-constants","swx-utils-common","lodash-compat"],function(e){function d(e,n,h,p){var m,g,y=this;m=v(n),g=u.contextMenu.items.START_PSTN_CALL,t.call(y,d.TYPE,m,g,e,h,p),y.featuresAreEnabled=function(){var e=r.resolve(i.serviceLocator.FEATURE_FLAGS);return e.isFeatureOn(i.featureFlags.PSTN_ENABLED)},y.mePersonHasCallingCapability=function(){return f.get().personsAndGroupsManager.mePerson.capabilities.audio()},y.personHasSkypeCallingCapability=function(){return!0},y.getCallingService=function(e){return e.audioService},y.getDefaultTelemetrySource=function(){return o.contextMenuItem.startPSTNCall},y.getTelemetryActionName=function(){return s.audioVideo.pstnCall},y.addTelemetryContextData=function(e){if(!e.phoneNumberType){var t=n.type()||a.phoneType.Other;e.phoneNumberType=t}},y.setCallingServiceEndpoint=function(e){var t=e.participants(0);t.audio.endpoint(n.telUri())},y.sendFeatureTelemetry=function(){var e;p.parent===o.conversation.header.button?e=c.entryPoint.CONVERSATION:p.parent===o.contactsPage.contact?e=c.entryPoint.CONTACT_LIST:p.parent===o.recentItem?e=c.entryPoint.RECENTS:p.parent===o.searchItem.addressBook&&(e=c.entryPoint.SEARCH),l.initiatingPSTNCall(e)}}function v(e){var t=e.type(),r=h.forceLTREmbedding(e.displayString());return t&&m(t)&&t!==a.phoneType.Other?n.fetch({key:"label_text_call_phone_number_"+t.toLowerCase(),params:{phoneNumber:r}}):n.fetch({key:"label_text_call_phone_number",params:{phoneNumber:r}})}function m(e){var t=!1;return p.forOwn(a.phoneType,function(n){n===e&&(t=!0)}),t}var t=e("ui/contextMenu/items/baseCallingMenuItem"),n=e("swx-i18n").localization,r=e("swx-service-locator-instance").default,i=e("swx-constants").COMMON,s=e("ui/telemetry/actions/actionNames"),o=e("ui/telemetry/actions/actionSources"),u=e("constants/cssClasses"),a=e("swx-enums"),f=e("swx-cafe-application-instance"),l=e("telemetry/calling/pstn/pstn"),c=e("swx-constants").COMMON.telemetry.pstn,h=e("swx-utils-common").stringUtils,p=e("lodash-compat");return d.prototype=Object.create(t.prototype),d.TYPE="StartPSTNCallMenuItem",d}),define("ui/contextMenu/items/unblockContact",["require","swx-i18n","ui/contextMenu/menuItem","swx-cafe-application-instance","swx-service-locator-instance","swx-constants","ui/telemetry/actions/actionSources","ui/modelHelpers/personActionsHelper","constants/cssClasses"],function(e){function f(e,l){function d(){function e(){p.publish(s.events.navigation.OPEN_CONVERSATION,{model:r.get().conversationsManager.getConversation(h),origin:s.telemetry.historyLoadOrigin.CONTACT_SEARCH})}return u.unblockPerson(h,l,e)}function v(){return e.isAgent()?t.fetch({key:"label_text_unblock_agent"}):t.fetch({key:"label_text_unblockContact"})}var c,h,p=i.resolve(s.serviceLocator.PUBSUB);if(!e)throw new Error("Parameter missing: contactVM is required");h=e.getPerson(),l=l||{source:o.contextMenuItem.unblock},c=v(),n.call(this,f.TYPE,c,d),this.cssClass=a.contextMenu.items.UNBLOCK_CONTACT,this.isEnabled=function(){return h.isBlocked.set.enabled()&&e.isBlocked()&&!e.isPstn()}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("swx-cafe-application-instance"),i=e("swx-service-locator-instance").default,s=e("swx-constants").COMMON,o=e("ui/telemetry/actions/actionSources"),u=e("ui/modelHelpers/personActionsHelper"),a=e("constants/cssClasses");return f.prototype=Object.create(n.prototype),f.TYPE="UnblockContactMenuItem",f}),define("ui/contextMenu/items/videoCall",["require","ui/contextMenu/items/baseCallingMenuItem","swx-i18n","swx-service-locator-instance","swx-constants","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","constants/cssClasses","swx-cafe-application-instance"],function(e){function f(e,l,c){var h,p,d=this;h=n.fetch({key:"label_text_call_skype_video"}),p=u.contextMenu.items.VIDEO_CALL,t.call(d,f.TYPE,h,p,e,l,c),d.featuresAreEnabled=function(){var e=r.resolve(i.serviceLocator.FEATURE_FLAGS);return e.isFeatureOn(i.featureFlags.CALLING)},d.mePersonHasCallingCapability=function(){return a.get().personsAndGroupsManager.mePerson.capabilities.video()},d.personHasSkypeCallingCapability=function(e){return e.capabilities.video()},d.getCallingService=function(e){return e.videoService},d.isVideoCall=function(){return!0},d.getDefaultTelemetrySource=function(){return o.contextMenuItem.videoCall},d.getTelemetryActionName=function(){return s.audioVideo.videoCall}}var t=e("ui/contextMenu/items/baseCallingMenuItem"),n=e("swx-i18n").localization,r=e("swx-service-locator-instance").default,i=e("swx-constants").COMMON,s=e("ui/telemetry/actions/actionNames"),o=e("ui/telemetry/actions/actionSources"),u=e("constants/cssClasses"),a=e("swx-cafe-application-instance");return f.prototype=Object.create(t.prototype),f.TYPE="VideoCallMenuItem",f}),define("ui/contextMenu/items/addParticipants",["require","exports","module","swx-i18n","ui/contextMenu/menuItem"],function(e,t){function i(e,i){var s=n.fetch({key:"actionsMenuItem_text_addParticipants"});r.call(this,t.TYPE,s,i),this.isEnabled=function(){return!e()}}var n=e("swx-i18n").localization,r=e("ui/contextMenu/menuItem");i.prototype=Object.create(r.prototype),t.TYPE="AddParticipantsMenuItem",t.build=function(e,t){return new i(e,t)}}),define("ui/modelHelpers/meetingScheduler",["require","exports","module","swx-cafe-application-instance","swx-utils-chat","ui/viewModels/chat/conversationTopic","swx-i18n","swx-constants","experience/settings","swx-service-locator-instance"],function(e,t){function f(e){return e?e.isGroupConversation()?e.isJoiningEnabled()?e:c(e):l(e):c()}function l(e){var t=h(e);return p(t,e)}function c(e){return p([],e)}function h(e){var t,n=[];if(e)for(t=0;t<e.participants.size();++t)n.push(e.participants(t).person);return n}function p(e,t){var i=n.get().conversationsManager,s=r.createConversation(e,i,!0),o=d(t);return s.topic.set.enabled.once(!0,function(){s.topic.set(o)}),s}function d(e){var t,n;return!e||e.participants.size()===0?s.fetch({key:"schedule_call_new_conversation_topic"}):(t=i.build(e),n=t.topic(),t.dispose(),s.fetch({key:"schedule_call_subject_text",params:{topic:n}}))}function v(e){var t=a.resolve(o.serviceLocator.PUBSUB);t.publish(o.events.navigation.OPEN_CONVERSATION,{model:e,origin:o.telemetry.historyLoadOrigin.CREATE_CONVERSATION_FOR_SCHEDULED_CALL})}function m(e){return new Promise(function(t){e.isJoiningEnabled.set.enabled.once(!0,function(){e.isJoiningEnabled.set(!0).then(function(){e.uri.get().then(t)})})})}function g(e,t,n){var r,i,s;return n?(s=u.legacyCalendarUrl,r=y(e,t)):(s=u.calendarUrl,r=b(e,t)),i=Object.keys(r).map(function(e){return e+"="+encodeURIComponent(r[e])}),s+i.join("&")}function y(e,t){var n=d(t);return{summary:n,description:w(e,n),location:n,dtstart:T(E()),dtend:T(S())}}function b(e,t){var n=d(t);return{subject:n,location:n,body:w(e,n),startdt:x(E()),enddt:x(S())}}function w(e,t){return t+"\n"+e.uri()}function E(){var e=new Date;return e.setUTCDate(e.getUTCDate()+7),e}function S(){var e=E();return e.setUTCHours(e.getUTCHours()+1),e}function x(e){var t=e.getUTCFullYear(),n=N(e.getUTCMonth()+1),r=N(e.getUTCDate()),i=N(e.getUTCHours()),s=N(e.getUTCMinutes()),o=N(e.getUTCSeconds()),u=i+":"+s+":"+o;return t+"-"+n+"-"+r+"T"+u}function T(e){var t=e.getUTCFullYear(),n=N(e.getUTCMonth()+1),r=N(e.getUTCDate()),i=N(e.getUTCHours()),s=N(e.getUTCMinutes()),o=N(e.getUTCSeconds()),u=i.toString()+s.toString()+o.toString();return t.toString()+n.toString()+r.toString()+"T"+u}function N(e){return("0"+e).slice(-2)}var n=e("swx-cafe-application-instance"),r=e("swx-utils-chat").conversation,i=e("ui/viewModels/chat/conversationTopic"),s=e("swx-i18n").localization,o=e("swx-constants").COMMON,u=e("experience/settings"),a=e("swx-service-locator-instance").default;t.generateMeetingUri=function(t,n){var r=f(t);return v(r),m(r).then(function(){return g(r,t,n)})}}),define("ui/viewModels/chat/scheduleCallModal",["require","exports","module","lodash-compat","vendor/knockout","browser/window","swx-service-locator-instance","utils/common/eventMixin","ui/modalDialog/modalDialog","swx-constants","ui/telemetry/actions/actionNames","ui/modelHelpers/meetingScheduler"],function(e,t){function h(e){function o(){var t=s.resolve(a.serviceLocator.FEATURE_FLAGS),r=t.isFeatureOn(a.featureFlags.USE_LEGACY_SCHEDULER_URI_FORMAT);l.generateMeetingUri(e,r).then(n)}function h(){i.open(n(),a.window.BLANK_NAME)}function p(){var e=s.resolve(a.serviceLocator.ACTION_TELEMETRY);e.recordAction(f.scheduleCall.scheduleCallConfirmButton)}var t=this,n=r.observable();o(),t.isGeneratingJoinUrl=r.computed(function(){return!n()}),t.goToCalendar=function(){h(),p(),t.close()},t.close=function(){u.hide(c)}}var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("browser/window"),s=e("swx-service-locator-instance").default,o=e("utils/common/eventMixin"),u=e("ui/modalDialog/modalDialog"),a=e("swx-constants").COMMON,f=e("ui/telemetry/actions/actionNames"),l=e("ui/modelHelpers/meetingScheduler"),c="swx-overlayScheduleCall";n.assign(h.prototype,o),t.ELEMENT_ID=c,t.build=function(e){return new h(e)}}),define("text!views/chat/scheduleCallModal.html",[],function(){return'<div id="swx-overlayScheduleCall" class="overlayScheduleCall" tabindex="-1">\r\n    <div class="overlayControls">\r\n        <div class="right">\r\n            <button class="btn narrow transparent" data-bind="click: close" type="button">\r\n                <span class="iconfont after cross pull3" data-bind="l10n: { \'key\': \'modal_scheduleCall_close_button\' }"></span>\r\n            </button>\r\n        </div>\r\n    </div>\r\n    <div class="overlayScheduleCallMain">\r\n        <span class="iconfont subscription"></span>\r\n\r\n        <!-- ko if: isGeneratingJoinUrl() -->\r\n        <p class="label" data-bind="l10n: { \'key\': \'modal_scheduleCall_getting_ready_label\' }"></p>\r\n        <!-- /ko -->\r\n        <!-- ko if: !isGeneratingJoinUrl() -->\r\n        <p class="label" data-bind="l10n: { \'key\': \'modal_scheduleCall_ready_label\' }"></p>\r\n        <!-- /ko -->\r\n\r\n        <div class="row">\r\n            <!-- ko if: isGeneratingJoinUrl() -->\r\n            <div class="swx-spinner blue">\r\n                <div class="circle one">\r\n                    <div class="rotate">\r\n                        <div class="position">\r\n                            <div class="scale">\r\n                                <div class="shape"></div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class="circle two">\r\n                    <div class="rotate">\r\n                        <div class="position">\r\n                            <div class="scale">\r\n                                <div class="shape"></div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class="circle three">\r\n                    <div class="rotate">\r\n                        <div class="position">\r\n                            <div class="scale">\r\n                                <div class="shape"></div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class="circle four">\r\n                    <div class="rotate">\r\n                        <div class="position">\r\n                            <div class="scale">\r\n                                <div class="shape"></div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: !isGeneratingJoinUrl() -->\r\n            <button type="button" class="btn primary" data-bind="click: goToCalendar">\r\n                <span data-bind="l10n: { key: \'modal_scheduleCall_create_event_button\' }"></span>\r\n            </button>\r\n            <!-- /ko -->\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("services/flagsApi/flagsApiService",["require","exports","module","swx-cafe-application-instance","reqwest","experience/settings","browser/window"],function(e,t){function o(){this.getAll=function(){function e(e){var t=a(e,"GET");return r.compat(t)}function t(){return Promise.reject()}return u().then(e,t)},this.set=function(e){function t(t){var i=a(t,"PUT",e);return r.compat(i).then(function(e){return e.status===201?Promise.resolve():n()})}function n(){return Promise.reject()}return u().then(t).catch(n)}}function u(){return n.get().signInManager._skypeToken()}function a(e,t,n){var r={url:i.flagsApiUrl,dataType:"json",crossOrigin:!0,headers:{"X-Skypetoken":e}};return t&&(r.method=t),n&&(r.url+="/"+s.encodeURIComponent(n)),r}var n=e("swx-cafe-application-instance"),r=e("reqwest"),i=e("experience/settings"),s=e("browser/window");t.build=function(){return new o}}),define("services/flagsApi/flagsApiServiceBusiness",["require","exports","module","swx-constants","swx-pubsub-instance","experience/settings","swx-utils-common"],function(e,t){function o(){var e=[];this.getAll=function(){var t=[],n=[];if(i.flags==null)t=[-1];else if(i.flags)try{n=JSON.parse(i.flags),n.forEach(function(n){t.push(parseInt(n.split("-")[1])),e.push(n)})}catch(r){}else!s.get("SkypeFirstRun")&&i.flags===""&&(t=[-1]);return Promise.resolve(t)},this.set=function(t){var o="";if(parseInt(t)){s.get("SkypeFirstRun")&&s.remove("SkypeFirstRun"),o=i.version+"/EducationBubble-"+t,e.push(o);try{r.publish(n.events.flags.SET_FLAG,JSON.stringify(e))}catch(u){}}}}var n=e("swx-constants").COMMON,r=e("swx-pubsub-instance").default,i=e("experience/settings"),s=e("swx-utils-common").sessionStorage;t.build=function(){return new o}}),define("services/flagsApi/flagsProvider",["require","exports","module","services/flagsApi/flagsApiService","services/flagsApi/flagsApiServiceBusiness"],function(e,t){function s(e){function o(t){return e?i.indexOf(t)>-1||i[0]===-1:i.indexOf(t)>-1}var t,i=[],s=null;e?t=r.build():t=n.build(),this.fetchFlags=function(){function n(e,n){function r(t){i=t,e()}t.getAll().then(r,n)}return s||(s=new Promise(n)),s},this.get=function(t){return o(t)},this.set=function(n){return i.push(n),t.set(n)}}var n=e("services/flagsApi/flagsApiService"),r=e("services/flagsApi/flagsApiServiceBusiness"),i;t.getInstance=function(e){return i||(i=new s(e)),i},t.destroy=function(){i=null}}),define("text!views/ui/educationBubbles.html",[],function(){return"<div class=\"EducationBubble swx\" data-bind=\"css: { 'EducationBubble--hidden': hidden, 'EducationBubble--orientTop': orientation() === 'TOP', 'EducationBubble--orientLeft': orientation() === 'LEFT', 'EducationBubble--orientRight': orientation() === 'RIGHT' }, attr: { 'data-swx-testId': 'education-bubble-' + id }\">\r\n    <div class=\"EducationBubble-arrow\" data-bind=\"style: { top: arrowTop, bottom: arrowBottom, left: arrowLeft, right: arrowRight }\"></div>\r\n    <div class=\"EducationBubble-content\" data-bind=\"style: { top: top, bottom: bottom, left: left, right: right, backgroundImage: 'url(' + iconUrl + ')' }\">\r\n        <p class=\"EducationBubble-text js-EducationBubble-text\" tabindex=\"-1\" data-bind=\"text: text\" role=\"alert\"></p>\r\n    </div>\r\n</div>\r\n"}),define("text!views/ui/educationBubblesBusiness.html",[],function(){return'<div class="EducationBubbleBusiness swx" data-bind="css: { \'EducationBubbleBusiness--hidden\': hidden, \'EducationBubbleBusiness--orientTop\': orientation() === \'TOP\', \'EducationBubbleBusiness--orientLeft\': orientation() === \'LEFT\', \'EducationBubbleBusiness--orientRight\': orientation() === \'RIGHT\' }, attr: { \'data-swx-testId\': \'education-bubble-\' + id }">\r\n    <div class="EducationBubbleBusiness-arrow" data-bind="style: { top: arrowTop, bottom: arrowBottom, left: arrowLeft, right: arrowRight }"></div>\r\n    <div class="EducationBubbleBusiness-content" data-bind="style: { top: top, bottom: bottom, left: left, right: right }">\r\n        <!-- ko if: title -->\r\n        <p class="EducationBubbleBusiness-title" tabindex="-1" data-bind="text: title" aria-live="assertive"></p>\r\n        <!-- /ko -->\r\n        <p class="EducationBubbleBusiness-text js-EducationBubbleBusiness-text" tabindex="-1" data-bind="text: text" aria-live="assertive"></p>\r\n        <!-- ko if: buttonText -->\r\n        <button class="EducationBubbleBusiness-button" tabindex="-1" data-bind="click: hideBubble, text: buttonText"></button>\r\n        <!-- /ko -->\r\n    </div>\r\n</div>\r\n'}),define("utils/common/rtlChecker",["require","exports","module","browser/dom"],function(e,t){function i(e){e=e||n.getElement("div.swx");var t=document.createElement("div");t.style.cssText="position: absolute; visibility: hidden; width: 10px;",t.innerHTML='<span class="probe" style="display: inline-block;"></span>',e.appendChild(t);var i=t.querySelector(".probe"),s=t.getBoundingClientRect(),o=i.getBoundingClientRect(),u=s.right===o.right;t.innerHTML="",e.removeChild(t),r=u}var n=e("browser/dom"),r=null;t.isRtl=function(e){return r===null&&i(e),r},t.reset=function(){r=null}}),define("ui/viewModels/educationBubbles/educationBubbleViewModel",["require","exports","module","swx-service-locator-instance","swx-constants","browser/window","browser/document","browser/dom","vendor/knockout","lodash-compat","utils/common/rtlChecker"],function(e,t){function h(e,h,p,d,v,m){function N(){f.isRtl()&&(m.orientation===r.educationBubbles.ORIENTATION.LEFT?m.orientation=r.educationBubbles.ORIENTATION.RIGHT:m.orientation===r.educationBubbles.ORIENTATION.RIGHT&&(m.orientation=r.educationBubbles.ORIENTATION.LEFT))}function C(){if(!E.hidden())switch(m.orientation){case r.educationBubbles.ORIENTATION.TOP:k();break;case r.educationBubbles.ORIENTATION.LEFT:L();break;case r.educationBubbles.ORIENTATION.RIGHT:A();break;default:O()}}function k(){B(),R()}function L(){M()?P():D()?H():O()}function A(){D()?H():M()?P():O()}function O(){j(),R()}function M(){var e=b.BUBBLE_WIDTH+b.ARROW_HEIGHT,t=h.getBoundingClientRect();return t.left-e>b.OUTER_SPACING}function D(){var e=b.BUBBLE_WIDTH+b.ARROW_HEIGHT,t=h.getBoundingClientRect();return t.right+e<s.documentElement.clientWidth-b.OUTER_SPACING}function P(){F(),U()}function H(){F(),z()}function B(){var e=Math.ceil(p.getBoundingClientRect().bottom-h.getBoundingClientRect().top);E.bottom(e+b.ARROW_HEIGHT+c),E.arrowBottom(e+c),E.orientation(r.educationBubbles.ORIENTATION.TOP)}function j(){var e=Math.floor(h.getBoundingClientRect().bottom-p.getBoundingClientRect().top);E.top(e+b.ARROW_HEIGHT+c),E.arrowTop(e+c),E.orientation(r.educationBubbles.ORIENTATION.BOTTOM)}function F(){var e=Math.floor(h.getBoundingClientRect().bottom-p.getBoundingClientRect().top-h.getBoundingClientRect().height/2);E.top(e-b.BUBBLE_MIN_HEIGHT/2+c),E.arrowTop(e+c)}function I(){return s.documentElement.clientWidth}function q(e){return e.width}function R(){var e=p.getBoundingClientRect(),t=h.getBoundingClientRect(),n=t.left-e.left+t.width/2,r=b.OUTER_SPACING,i=w(e)-b.BUBBLE_WIDTH-b.OUTER_SPACING,s=Math.max(Math.min(n-b.BUBBLE_WIDTH/2,i),r);E.left(Math.floor(s)+c),E.right(l),E.arrowLeft(Math.floor(n-b.ARROW_WIDTH/2)+c),E.arrowRight(l)}function U(){var e=b.BUBBLE_WIDTH+b.ARROW_HEIGHT,t=h.getBoundingClientRect();E.left(t.left-e+c),E.right(l),E.arrowLeft(Math.floor(t.left-b.ARROW_HEIGHT/2-b.ARROW_WIDTH/2)+c),E.arrowRight(l),E.orientation(r.educationBubbles.ORIENTATION.LEFT)}function z(){var e=h.getBoundingClientRect();E.left(e.right+b.ARROW_HEIGHT+c),E.right(l),E.arrowLeft(Math.floor(e.right+b.ARROW_HEIGHT/2-b.ARROW_WIDTH/2)+c),E.arrowRight(l),E.orientation(r.educationBubbles.ORIENTATION.RIGHT)}function W(e){var t=s.querySelector(e);t&&(y=o.createDomObserverSubscription(t,C))}function X(){E.title=m.title,m.buttonText&&(E.buttonText=m.buttonText,E.hideBubble=E.hidden.bind(null,!0)),b.OUTER_SPACING=5,b.ARROW_WIDTH=25,b.ARROW_HEIGHT=9,b.BUBBLE_WIDTH=150}function V(){i.removeEventListener(r.events.browser.RESIZE,x),S.unsubscribe(r.events.narrowMode.SIDEBAR_STATE_CHANGED,T),g.dispose(),y&&y.dispose()}var g,y,b=t.DIMENSIONS_IN_PX,w=I,E=this,S=n.resolve(r.serviceLocator.PUBSUB),x=a.debounce(C,100),T=function(){E.hidden(!0)};m=m||{},E.id=e,E.text=d,E.iconUrl=v,E.hidden=u.observable(!1),E.left=u.observable(),E.right=u.observable(),E.top=u.observable(),E.bottom=u.observable(),E.arrowLeft=u.observable(),E.arrowRight=u.observable(),E.arrowTop=u.observable(),E.arrowBottom=u.observable(),E.orientation=u.observable(),g=E.hidden.subscribe(V),m.isBusinessFlagService&&(w=q,X()),N(),C(),i.addEventListener(r.events.browser.RESIZE,x),S.subscribe(r.events.narrowMode.SIDEBAR_STATE_CHANGED,T),m.mutatingContainerElementQuery&&W(m.mutatingContainerElementQuery)}var n=e("swx-service-locator-instance").default,r=e("swx-constants").COMMON,i=e("browser/window"),s=e("browser/document"),o=e("browser/dom"),u=e("vendor/knockout"),a=e("lodash-compat"),f=e("utils/common/rtlChecker"),l="auto",c="px";t.DIMENSIONS_IN_PX={OUTER_SPACING:15,ARROW_WIDTH:35,ARROW_HEIGHT:9,BUBBLE_WIDTH:288,BUBBLE_MIN_HEIGHT:68},t.build=function(e,t,n,r,i,s){return new h(e,t,n,r,i,s)}}),define("ui/viewModels/experience/welcomeDialog",["require","exports","module","experience/settings"],function(e,t){function i(e){this.cookiesPrivacyUrl=n.cookiesPrivacyUrl,this.close=function(){e()}}var n=e("experience/settings"),r="swx-overlayWelcome";t.ELEMENT_ID=r,t.build=function(e){return new i(e)}}),define("text!views/experience/welcomeDialog.html",[],function(){return'<div id="swx-overlayWelcome" class="swx-overlayModal swx-overlayWelcome">\r\n    <div class="title">\r\n        <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { key: \'welcomeDialog_header\' }"></h1>\r\n    </div>\r\n\r\n    <div class="subtitle">\r\n        <p class="fontSize-h2 fontSizeNarrow-h4" data-bind="l10n: { key: \'welcomeDialog_getInTouch\' }"></p>\r\n    </div>\r\n\r\n    <div class="featureTiles">\r\n        <div class="row">\r\n            <div class="column unit4">\r\n                <span class="iconfont message"></span>\r\n                <div class="text">\r\n                    <p class="fontSize-h3 fontSizeNarrow-p" data-bind="l10n: { key: \'welcomeDialog_sendIM\' }"></p>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="column unit4">\r\n                <span class="iconfont callStart"></span>\r\n                <div class="text">\r\n                    <p class="fontSize-h3 fontSizeNarrow-p" data-bind="l10n: { key: \'welcomeDialog_makeCalls\' }"></p>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="column unit4">\r\n                <span class="iconfont video"></span>\r\n                <div class="text">\r\n                    <p class="fontSize-h3 fontSizeNarrow-p" data-bind="l10n: { key: \'welcomeDialog_makeVideoCalls\' }"></p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="buttonRow">\r\n        <button type="btn" class="btn green narrow large close" data-bind="click: close">\r\n            <span data-bind="l10n: { key: \'welcomeDialog_getStarted_button\' }" tabindex="-1"></span>\r\n        </button>\r\n    </div>\r\n\r\n    <div class="legalNotices">\r\n        <div class="emergencyCalling">\r\n            <span class="iconfont callOff"></span>\r\n            <p data-bind="l10n: { key: \'welcomeDialog_notForEmergencyCalls\' }"></p>\r\n        </div>\r\n\r\n        <div class="cookiesNotice">\r\n            <p data-bind="l10n: { key: \'welcomeDialog_cookiesConsent\' }"></p>\r\n            <p><a data-bind="attr: { href: cookiesPrivacyUrl }, l10n: { key: \'welcomeDialog_readMore\' }" target=\'_blank\'></a></p>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("ui/modalDialog/welcomeDialog",["require","exports","module","swx-i18n","swx-constants","swx-service-locator-instance","services/flagsApi/flagsProvider","ui/modalDialog/modalDialog","ui/viewModels/experience/welcomeDialog","text!views/experience/welcomeDialog.html"],function(e,t){function f(){function n(){return e.get(t.WELCOME_DIALOG_FLAG_ID)}var e=s.getInstance();return e.fetchFlags().then(function(){n()||l()})}function l(){var e=u.build(c),t=n.fetch({key:"welcomeDialog_header"});o.build(u.ELEMENT_ID,e,a),o.show(u.ELEMENT_ID,t)}function c(){var e=s.getInstance();o.hide(u.ELEMENT_ID),e.set(t.WELCOME_DIALOG_FLAG_ID)}var n=e("swx-i18n").localization,r=e("swx-constants").COMMON,i=e("swx-service-locator-instance").default,s=e("services/flagsApi/flagsProvider"),o=e("ui/modalDialog/modalDialog"),u=e("ui/viewModels/experience/welcomeDialog"),a=e("text!views/experience/welcomeDialog.html");t.WELCOME_DIALOG_FLAG_ID=1,t.init=function(){var e=i.resolve(r.serviceLocator.FEATURE_FLAGS),t;e.isFeatureOn(r.featureFlags.WELCOME_DIALOG)&&(t=i.resolve(r.serviceLocator.PUBSUB),t.subscribe(r.apiUIEvents.SWX_TIMELINE_LOADED,f))}}),define("ui/educationBubbles/educationBubble",["require","exports","module","lodash-compat","browser/dom","browser/document","vendor/knockout","swx-i18n","swx-constants","constants/cssClasses","swx-constants","swx-utils-common","swx-g11n","swx-service-locator-instance","ui/telemetry/actions/actionNames","experience/settings","services/flagsApi/flagsProvider","text!views/ui/educationBubbles.html","text!views/ui/educationBubblesBusiness.html","ui/viewModels/educationBubbles/educationBubbleViewModel","ui/modalDialog/welcomeDialog"],function(e,t){function w(e,t,w,E,S){function C(){return x.get(e)}function k(){var e=h.resolve(u.serviceLocator.FEATURE_FLAGS);return!x.get(b.WELCOME_DIALOG_FLAG_ID)&&e.isFeatureOn(u.featureFlags.WELCOME_DIALOG)}function L(){var e=S&&S.prerequisiteBubbleIds||[];return n.every(e,function(e){return x.get(e)})}function A(e,t,n,r,s){var o=i.querySelector(t),u=O(n,s),a=d.appBaseUrl+r;return o?(D(e,o,u,a,M(s)),x.set(e),q(e),!0):!1}function O(e,t){return t&&t.i18nParams?o.fetch({key:e,params:t.i18nParams}):o.fetch({key:e})}function M(e){return e&&(e.i18nTitleKey&&(e.title=o.fetch({key:e.i18nTitleKey})),e.i18nButtonKey&&(e.buttonText=o.fetch({key:e.i18nButtonKey}))),e}function D(e,t,n,r,i){var o=P(i),u=o.parentNode;N=y.build(e,t,u,n,r,i),j(o),F(o,N),I(o,N),c.initLocaleDirection(o),s.applyBindings(N,o)}function P(e){var t=r.createElement("div"),n=H();return t.innerHTML=T,t=t.firstChild,d.mode&&r.addClass(t,a.educationBubbles.PREFIX+d.mode),e&&e.size===u.educationBubbles.SIZE.LARGE&&r.addClass(t,a.educationBubbles.LARGE),n.appendChild(t),t}function H(){var e=B(d.controls.content.toLowerCase()),t=B(d.controls.sidebar.toLowerCase());return r.findFirstCommonAncestor(e,t)}function B(e){var t=h.resolve(u.serviceLocator.CONTROLS_BUILDER),s=n.find(t.registeredElements,function(t){return t.name===e}).element;return r.isElement(s)||(s=i.querySelector(s)),s}function j(e){var t=function(){e.parentNode.removeChild(e),e.removeEventListener(u.events.browser.TRANSITIONEND,t)};e.addEventListener(u.events.browser.TRANSITIONEND,t)}function F(e,t){function n(s){var o=r.getLastChildElement(e);o.contains(s.target)||(t.hidden(!0),i.removeEventListener(u.events.browser.CLICK,n))}l.execute(function(){i.addEventListener(u.events.browser.CLICK,n,!0)})}function I(e,t){function n(e){e.keyCode===f.ESCAPE&&(t.hidden(!0),i.removeEventListener(u.events.browser.KEYDOWN,n))}i.addEventListener(u.events.browser.KEYDOWN,n)}function q(e){var t=h.resolve(u.serviceLocator.ACTION_TELEMETRY);t.recordAction(p.educationBubbles.educationBubbleShown,{educationBubbleId:e})}var x,T,N;S&&S.isBusinessFlagService?(T=g,x=v.getInstance(S.isBusinessFlagService)):(T=m,x=v.getInstance()),this.show=function(){return x.fetchFlags().then(function(){return!C()&&!k()&&L()?A(e,t,w,E,S):!1})},this.hide=function(){N&&N.hidden(!0)}}var n=e("lodash-compat"),r=e("browser/dom"),i=e("browser/document"),s=e("vendor/knockout"),o=e("swx-i18n").localization,u=e("swx-constants").COMMON,a=e("constants/cssClasses"),f=e("swx-constants").KEYS,l=e("swx-utils-common").async,c=e("swx-g11n").globalization,h=e("swx-service-locator-instance").default,p=e("ui/telemetry/actions/actionNames"),d=e("experience/settings"),v=e("services/flagsApi/flagsProvider"),m=e("text!views/ui/educationBubbles.html"),g=e("text!views/ui/educationBubblesBusiness.html"),y=e("ui/viewModels/educationBubbles/educationBubbleViewModel"),b=e("ui/modalDialog/welcomeDialog");t.EDUCATION_BUBBLE_TEXT_ELEMENT_CLASS="js-EducationBubble-text",t.build=function(e,t,n,r,i){return new w(e,t,n,r,i)}}),define("ui/educationBubbles/educationBubbleInfo",["require","exports","module","lodash-compat","swx-constants"],function(e,t){var n=e("lodash-compat"),r=e("swx-constants").COMMON;t.SEARCH_EDUCATION_BUBBLE={id:8,anchorElementQuery:".swx .icon .search",i18nKey:"education_bubble_search",iconUrlPath:"/assets/images/components/educationBubbles/educationBubbleSearch.svg"},t.SEARCH_EDUCATION_BUBBLE_BUSINESS={id:9,anchorElementQuery:".swx .icon .search",i18nKey:"education_bubble_search_4b",iconUrlPath:"/assets/images/components/educationBubbles/educationBubbleSearch.svg",options:{isBusinessFlagService:!0,i18nButtonKey:"education_bubble_gotit_button_4b",i18nTitleKey:"education_bubble_search_title_4b"}},t.CALL_EDUCATION_BUBBLE={id:6,anchorElementQuery:".fragment:not(.hide) .headerMain .headerControls .callButtons button",i18nKey:"education_bubble_call",iconUrlPath:"/assets/images/components/educationBubbles/educationBubbleCall.svg",options:{mutatingContainerElementQuery:".fragment:not(.hide) .headerMain"}},t.CHAT_EDUCATION_BUBBLE={id:10,anchorElementQuery:".ContactsPage-body .contactTile:not(.echo)",i18nKey:"education_bubble_chat",iconUrlPath:"/assets/images/components/educationBubbles/educationBubbleChat.svg",options:{orientation:r.educationBubbles.ORIENTATION.TOP}},t.CHAT_EDUCATION_BUBBLE_BUSINESS={id:11,anchorElementQuery:".ContactsPage-body .contactTile:not(.echo)",i18nKey:"education_bubble_chat_4b",iconUrlPath:"/assets/images/components/educationBubbles/educationBubbleChat.svg",options:{orientation:r.educationBubbles.ORIENTATION.TOP,isBusinessFlagService:!0,i18nButtonKey:"education_bubble_gotit_button_4b",i18nTitleKey:"education_bubble_chat_title_4b"}},t.SCHEDULE_CALL_EDUCATION_BUBBLE_1_GROUP={id:17,anchorElementQuery:".fragment:not(.hide) .headerMain .headerControls .moreActions button",i18nKey:"education_bubble_schedule_call_1_group",iconUrlPath:"/assets/images/components/educationBubbles/educationBubbleScheduleCall.svg",options:{prerequisiteBubbleIds:[6],mutatingContainerElementQuery:".fragment:not(.hide) .headerMain",size:r.educationBubbles.SIZE.LARGE}},t.SCHEDULE_CALL_EDUCATION_BUBBLE_1=n.extend({},t.SCHEDULE_CALL_EDUCATION_BUBBLE_1_GROUP,{i18nKey:"education_bubble_schedule_call_1"}),t.SCHEDULE_CALL_EDUCATION_BUBBLE_2_GROUP={id:18,anchorElementQuery:".swxContextMenu .scheduleCallMenuItem",i18nKey:"education_bubble_schedule_call_1_group",iconUrlPath:"/assets/images/components/educationBubbles/educationBubbleScheduleCall.svg",options:{prerequisiteBubbleIds:[17],orientation:r.educationBubbles.ORIENTATION.LEFT}},t.SCHEDULE_CALL_EDUCATION_BUBBLE_2=n.extend({},t.SCHEDULE_CALL_EDUCATION_BUBBLE_2_GROUP,{i18nKey:"education_bubble_schedule_call_1_group"})}),define("ui/contextMenu/items/scheduleCall",["require","exports","module","swx-i18n","ui/contextMenu/menuItem","swx-service-locator-instance","swx-constants","constants/cssClasses","ui/telemetry/actions/actionNames","ui/modalDialog/modalDialog","ui/viewModels/chat/scheduleCallModal","text!views/chat/scheduleCallModal.html","ui/educationBubbles/educationBubble","ui/educationBubbles/educationBubbleInfo"],function(e,t){function p(e){function v(){m(),g()}function m(){var t=f.build(e),r=n.fetch({key:"modal_scheduleCall_text_aria_label"});a.build(f.ELEMENT_ID,t,l),a.show(f.ELEMENT_ID,r)}function g(){var e=i.resolve(s.serviceLocator.ACTION_TELEMETRY);e.recordAction(u.conversation.scheduleCallButton)}function y(){var e=h.SCHEDULE_CALL_EDUCATION_BUBBLE_2,t=i.resolve(s.serviceLocator.FEATURE_FLAGS);t.isFeatureOn(s.featureFlags.SCHEDULE_CALL_EDUCATION_BUBBLE_2)&&(d=c.build(e.id,e.anchorElementQuery,e.i18nKey,e.iconUrlPath,e.options),d.show())}var p=n.fetch({key:"actionsMenuItem_text_scheduleCall"}),d;r.call(this,t.TYPE,p,v),y(),this.cssClass=o.contextMenu.items.SCHEDULE_CALL,this.dispose=function(){d&&d.hide()}}var n=e("swx-i18n").localization,r=e("ui/contextMenu/menuItem"),i=e("swx-service-locator-instance").default,s=e("swx-constants").COMMON,o=e("constants/cssClasses"),u=e("ui/telemetry/actions/actionNames"),a=e("ui/modalDialog/modalDialog"),f=e("ui/viewModels/chat/scheduleCallModal"),l=e("text!views/chat/scheduleCallModal.html"),c=e("ui/educationBubbles/educationBubble"),h=e("ui/educationBubbles/educationBubbleInfo");p.prototype=Object.create(r.prototype),t.TYPE="ScheduleCallMenuItem",t.build=function(e){return new p(e)}}),define("ui/contextMenu/items/shareScreen",["require","exports","module","swx-i18n","ui/contextMenu/menuItem"],function(e,t){function i(e,i,s){var o=n.fetch({key:"callscreen_text_shareScreens"}),u=n.fetch({key:"callscreen_text_stopSharingScreen"});r.call(this,t.TYPE,i?o:u,s),this.isEnabled=function(){return!e()}}var n=e("swx-i18n").localization,r=e("ui/contextMenu/menuItem");i.prototype=Object.create(r.prototype),t.TYPE="ShareScreenMenuItem",t.build=function(e,t,n){return new i(e,t,n)}}),define("ui/contextMenu/items/avSettings",["require","exports","module","swx-i18n","ui/contextMenu/menuItem"],function(e,t){function i(e,i){r.call(this,t.TYPE,n.fetch({key:"callscreen_text_showAVSettings"}),i),this.isEnabled=function(){return!e()}}var n=e("swx-i18n").localization,r=e("ui/contextMenu/menuItem");i.prototype=Object.create(r.prototype),t.TYPE="AVSettingsMenuItem",t.build=function(e,t){return new i(e,t)}}),define("ui/contextMenu/items/transferCall",["require","exports","module","swx-i18n","ui/contextMenu/menuItem"],function(e,t){function i(e,i){r.call(this,t.TYPE,n.fetch({key:"callscreen_text_transferCall"}),i),this.isEnabled=function(){return!e()}}var n=e("swx-i18n").localization,r=e("ui/contextMenu/menuItem");i.prototype=Object.create(r.prototype),t.TYPE="AVSettingsMenuItem",t.build=function(e,t){return new i(e,t)}}),define("ui/contextMenu/items/unansweredCallWrap",["require","exports","module","ui/contextMenu/menuItem"],function(e,t){function r(e,r,i){function o(){s.actionBefore(),e.action()}function u(){}var s=this;s.wrappedMenuItem=e,s.actionBefore=i||u,n.call(this,t.TYPE,r,o)}var n=e("ui/contextMenu/menuItem");return r.prototype=Object.create(n.prototype),r.TYPE="UnansweredCallWrapMenuItem",r}),define("ui/contextMenu/items/goToDialPad",["require","swx-i18n","constants/components","swx-constants","ui/contextMenu/menuItem","swx-pubsub-instance"],function(e){function o(e){function f(){u.actionBefore(),l()}function l(){function e(){return{page:n.calling.SKYPEOUT_PAGE,origin:r.telemetry.historyLoadOrigin.SKYPEOUT_PAGE}}s.publish(r.events.navigation.NAVIGATE,e())}var u=this;u.actionBefore=e;var a=t.fetch({key:"unanswered_call_dial_number"});i.call(this,o.TYPE,a,f)}var t=e("swx-i18n").localization,n=e("constants/components"),r=e("swx-constants").COMMON,i=e("ui/contextMenu/menuItem"),s=e("swx-pubsub-instance").default;return o.prototype=Object.create(i.prototype),o.TYPE="GoToDialPadMenuItem",o}),define("ui/contextMenu/items/callParticipant/chat",["require","swx-cafe-application-instance","swx-i18n","ui/contextMenu/menuItem","swx-constants","ui/telemetry/actions/actionNames","swx-service-locator-instance","swx-browser-detect"],function(e){function a(e){function l(){c(),h()}function c(){var n=o.resolve(i.serviceLocator.PUBSUB),r=t.get().conversationsManager.getConversation(e),s={model:r};n.publish(i.events.navigation.OPEN_CONVERSATION,s),n.publish(i.events.narrowMode.SHOW_SIDEBAR)}function h(){var e=o.resolve(i.serviceLocator.ACTION_TELEMETRY);e.recordAction(s.audioVideo.participantMenu.chat)}if(!e)throw new Error("Parameter missing: person is required");var f=n.fetch({key:"callscreen_participantMenu_chat"});r.call(this,a.TYPE,f,l),this.isEnabled=function(){var e=!o.resolve(i.serviceLocator.FEATURE_FLAGS).isFeatureOn(i.featureFlags.DISABLE_CALLSCREEN_CHAT_OPTION);return!u.getBrowserInfo().isShellApp&&e}}var t=e("swx-cafe-application-instance"),n=e("swx-i18n").localization,r=e("ui/contextMenu/menuItem"),i=e("swx-constants").COMMON,s=e("ui/telemetry/actions/actionNames"),o=e("swx-service-locator-instance").default,u=e("swx-browser-detect").default;return a.prototype=Object.create(r.prototype),a.TYPE="CallParticipantChatMenuItem",a}),define("ui/contextMenu/items/callParticipant/pin",["require","swx-i18n","ui/contextMenu/menuItem","swx-constants","ui/telemetry/actions/actionNames","swx-service-locator-instance"],function(e){function o(e,u,a){function c(){h(),p()}function h(){var t=s.resolve(r.serviceLocator.PUBSUB),n={participant:e,isScreenSharing:u,shouldBePinned:!a};t.publish(r.events.callScreen.PINNED_PARTICIPANT_CHANGED,n)}function p(){var e=s.resolve(r.serviceLocator.ACTION_TELEMETRY);e.recordAction(i.audioVideo.participantMenu.pin)}var f=a?"callscreen_participantMenu_unpin":"callscreen_participantMenu_pin",l=t.fetch({key:f});n.call(this,o.TYPE,l,c),this.isEnabled=function(){return!0}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("swx-constants").COMMON,i=e("ui/telemetry/actions/actionNames"),s=e("swx-service-locator-instance").default;return o.prototype=Object.create(n.prototype),o.TYPE="CallParticipantPinMenuItem",o}),define("ui/contextMenu/items/callParticipant/zoom",["require","swx-i18n","ui/contextMenu/menuItem","swx-constants","ui/telemetry/actions/actionNames","swx-service-locator-instance"],function(e){function o(e,u){function l(){c(),h()}function c(){u()&&e(!e())}function h(){var e=s.resolve(r.serviceLocator.ACTION_TELEMETRY);e.recordAction(i.audioVideo.participantMenu.zoom)}var a=e()?"callscreen_participantMenu_zoomOut":"callscreen_participantMenu_zoomIn",f=t.fetch({key:a});n.call(this,o.TYPE,f,l),this.isEnabled=function(){return!0}}var t=e("swx-i18n").localization,n=e("ui/contextMenu/menuItem"),r=e("swx-constants").COMMON,i=e("ui/telemetry/actions/actionNames"),s=e("swx-service-locator-instance").default;return o.prototype=Object.create(n.prototype),o.TYPE="CallParticipantZoomMenuItem",o}),define("ui/contextMenu/items/all",["require","exports","module","ui/contextMenu/menuItemGroup","ui/contextMenu/items/blockContact","ui/contextMenu/items/callSkype","ui/contextMenu/items/deleteContact","ui/contextMenu/items/editMessage","ui/contextMenu/items/leaveConversation","ui/contextMenu/items/markConversationAsRead","ui/contextMenu/items/markAllConversationsAsRead","ui/contextMenu/items/mutingConversation","ui/contextMenu/items/mutingConversation","ui/contextMenu/items/openConversation","ui/contextMenu/items/openConversationWithPerson","ui/contextMenu/items/viewPersonProfile","ui/contextMenu/items/quoteMessage","ui/contextMenu/items/copyMessageMenuItem","ui/contextMenu/items/copySelectionMenuItem","ui/contextMenu/items/copySelectionTextMenuItem","ui/contextMenu/items/removeConversationHistory","ui/contextMenu/items/addGroupConversationToFavorites","ui/contextMenu/items/addContactToFavorites","ui/contextMenu/items/removeGroupConversationFromFavorites","ui/contextMenu/items/removeContactFromFavorites","ui/contextMenu/items/removeMessage","ui/contextMenu/items/copyLink","ui/contextMenu/items/openLink","ui/contextMenu/items/removeParticipant","ui/contextMenu/items/saveVideoMessage","ui/contextMenu/items/startPSTNCall","ui/contextMenu/items/unblockContact","ui/contextMenu/items/videoCall","ui/contextMenu/items/addParticipants","ui/contextMenu/items/scheduleCall","ui/contextMenu/items/shareScreen","ui/contextMenu/items/avSettings","ui/contextMenu/items/transferCall","ui/contextMenu/items/unansweredCallWrap","ui/contextMenu/items/goToDialPad","ui/contextMenu/items/callParticipant/chat","ui/contextMenu/items/callParticipant/pin","ui/contextMenu/items/callParticipant/zoom"],function(e,t){t.MenuItemGroup=e("ui/contextMenu/menuItemGroup"),t.BlockContactMenuItem=e("ui/contextMenu/items/blockContact"),t.CallSkypeMenuItem=e("ui/contextMenu/items/callSkype"),t.DeleteContactMenuItem=e("ui/contextMenu/items/deleteContact"),t.EditMessageMenuItem=e("ui/contextMenu/items/editMessage"),t.LeaveConversationMenuItem=e("ui/contextMenu/items/leaveConversation"),t.MarkConversationAsReadMenuItem=e("ui/contextMenu/items/markConversationAsRead"),t.MarkAllConversationsAsReadMenuItem=e("ui/contextMenu/items/markAllConversationsAsRead"),t.MuteConversationMenuItem=e("ui/contextMenu/items/mutingConversation").MuteConversationMenuItem,t.UnmuteConversationMenuItem=e("ui/contextMenu/items/mutingConversation").UnmuteConversationMenuItem,t.OpenConversationMenuItem=e("ui/contextMenu/items/openConversation"),t.OpenConversationWithPersonMenuItem=e("ui/contextMenu/items/openConversationWithPerson"),t.ViewPersonProfileMenuItem=e("ui/contextMenu/items/viewPersonProfile"),t.QuoteMessageMenuItem=e("ui/contextMenu/items/quoteMessage"),t.CopyMessageMenuItem=e("ui/contextMenu/items/copyMessageMenuItem"),t.CopySelectionMenuItem=e("ui/contextMenu/items/copySelectionMenuItem"),t.CopySelectionTextMenuItem=e("ui/contextMenu/items/copySelectionTextMenuItem"),t.RemoveConversationMenuItem=e("ui/contextMenu/items/removeConversationHistory"),t.AddGroupConversationToFavoritesMenuItem=e("ui/contextMenu/items/addGroupConversationToFavorites"),t.AddContactToFavoritesMenuItem=e("ui/contextMenu/items/addContactToFavorites"),t.RemoveGroupConversationFromFavoritesMenuItem=e("ui/contextMenu/items/removeGroupConversationFromFavorites"),t.RemoveContactFromFavoritesMenuItem=e("ui/contextMenu/items/removeContactFromFavorites"),t.RemoveMessageMenuItem=e("ui/contextMenu/items/removeMessage"),t.CopyLinkMenuItem=e("ui/contextMenu/items/copyLink"),t.OpenLinkMenuItem=e("ui/contextMenu/items/openLink"),t.RemoveParticipantMenuItem=e("ui/contextMenu/items/removeParticipant"),t.SaveVideoMessageMenuItem=e("ui/contextMenu/items/saveVideoMessage"),t.StartPSTNCallMenuItem=e("ui/contextMenu/items/startPSTNCall"),t.UnblockContactMenuItem=e("ui/contextMenu/items/unblockContact"),t.VideoCallMenuItem=e("ui/contextMenu/items/videoCall"),t.AddParticipantsMenuItem=e("ui/contextMenu/items/addParticipants"),t.ScheduleCallMenuItem=e("ui/contextMenu/items/scheduleCall"),t.ShareScreen=e("ui/contextMenu/items/shareScreen"),t.AVSettings=e("ui/contextMenu/items/avSettings"),t.TransferCall=e("ui/contextMenu/items/transferCall"),t.UnansweredCallWrapMenuItem=e("ui/contextMenu/items/unansweredCallWrap"),t.GoToDialPadMenuItem=e("ui/contextMenu/items/goToDialPad"),t.CallParticipantChatMenuItem=e("ui/contextMenu/items/callParticipant/chat"),t.CallParticipantPinMenuItem=e("ui/contextMenu/items/callParticipant/pin"),t.CallParticipantZoomMenuItem=e("ui/contextMenu/items/callParticipant/zoom"),t.itemOrderPriorities={},t.itemOrderPriorities[t.OpenConversationMenuItem.TYPE]={priority:0},t.itemOrderPriorities[t.OpenConversationWithPersonMenuItem.TYPE]={priority:0},t.itemOrderPriorities[t.CallSkypeMenuItem.TYPE]={priority:1},t.itemOrderPriorities[t.StartPSTNCallMenuItem.TYPE]={priority:2,subPriorities:{Cell:{priority:0},Home:{priority:1},Work:{priority:2},Other:{priority:3}}},t.itemOrderPriorities[t.VideoCallMenuItem.TYPE]={priority:3},t.itemOrderPriorities[t.ViewPersonProfileMenuItem.TYPE]={priority:4},t.itemOrderPriorities[t.MuteConversationMenuItem.TYPE]={priority:5},t.itemOrderPriorities[t.UnmuteConversationMenuItem.TYPE]={priority:5},t.itemOrderPriorities[t.BlockContactMenuItem.TYPE]={priority:6},t.itemOrderPriorities[t.UnblockContactMenuItem.TYPE]={priority:7},t.itemOrderPriorities[t.DeleteContactMenuItem.TYPE]={priority:8},t.itemOrderPriorities[t.LeaveConversationMenuItem.TYPE]={priority:9},t.itemOrderPriorities[t.RemoveConversationMenuItem.TYPE]={priority:10},t.itemOrderPriorities[t.MarkConversationAsReadMenuItem.TYPE]={priority:11},t.itemOrderPriorities[t.MarkAllConversationsAsReadMenuItem.TYPE]={priority:12},t.itemOrderPriorities[t.AddGroupConversationToFavoritesMenuItem.TYPE]={priority:13},t.itemOrderPriorities[t.RemoveGroupConversationFromFavoritesMenuItem.TYPE]={priority:14},t.itemOrderPriorities[t.AddContactToFavoritesMenuItem.TYPE]={priority:11},t.itemOrderPriorities[t.RemoveContactFromFavoritesMenuItem.TYPE]={priority:12}}),define("ui/viewModels/people/contactGroup",["require","vendor/knockout","utils/common/ko","ui/viewModels/people/contactBuilder"],function(e){function i(e){function n(e){return r.build(e)}function i(){return this.contacts().length===0}e=e||{},e.contacts=e.contacts||[],this.name=e.name,this.contacts=t.observableArray([]),this.isHidden=t.computed(i,this),this.init=function(){var t=e.contacts.map(n);this.contacts(t)}}var t=e("vendor/knockout"),n=e("utils/common/ko"),r=e("ui/viewModels/people/contactBuilder");return i.prototype.dispose=function(){this.isHidden.dispose(),n.disposeAndClearArray(this.contacts)},i.build=function(e){return new i(e)},i}),define("ui/contextMenu/menuItemHelper",["require","exports","module","ui/telemetry/actions/actionSources","ui/contextMenu/items/all","lodash-compat","swx-enums"],function(e,t){function o(e,t){return e.type()===t.type()?u(e.displayString(),t.displayString()):a(e,t)}function u(e,t){var n=e.trim().toLowerCase(),r=t.trim().toLowerCase();return n.localeCompare(r)}function a(e,t){var n=e.type()||s.phoneType.Other,i=t.type()||s.phoneType.Other;return r.itemOrderPriorities.StartPSTNCallMenuItem.subPriorities[n].priority-r.itemOrderPriorities.StartPSTNCallMenuItem.subPriorities[i].priority}function f(e,t){return c(e,t.type)||h(e,t)?u(e.label,t.label):i.isUndefined(r.itemOrderPriorities[t.type])?-1:i.isUndefined(r.itemOrderPriorities[e.type])?1:l(e,t)}function l(e,t){var n=r.itemOrderPriorities[e.type],i=r.itemOrderPriorities[t.type];return n.priority-i.priority}function c(e,t){return e.type===t.type}function h(e,t){var n=r.itemOrderPriorities[e.type],i=r.itemOrderPriorities[t.type];return p(n,i)||d(n,i)&&n.priority===i.priority}function p(e,t){return i.isUndefined(e)&&i.isUndefined(t)}function d(e,t){return!i.isUndefined(e)&&!i.isUndefined(t)}var n=e("ui/telemetry/actions/actionSources"),r=e("ui/contextMenu/items/all"),i=e("lodash-compat"),s=e("swx-enums");t.getMenuItemTelemetryContext=function(e,t){var n={source:e};return t&&t.source&&(n.parent=t.source),n},t.getConversationContextMenuItemGroup=function(e,n,i){var s=[],o=t.getCallPhoneContextMenuItems(e,n,i);return s.push(new r.CallSkypeMenuItem(e,n,i)),Array.prototype.push.apply(s,o),s.push(new r.VideoCallMenuItem(e,n,i)),s.push(new r.ViewPersonProfileMenuItem(e.getPerson(),n,i)),new r.MenuItemGroup(r.CallSkypeMenuItem.TYPE,s)},t.getCallPhoneContextMenuItems=function(e,s,u){var a=[],f=e.getPerson();if(f.phoneNumbers.size()){var l=f.phoneNumbers();l.sort(o),i.forEach(l,function(i){a.push(new r.StartPSTNCallMenuItem(e,i,s,t.getMenuItemTelemetryContext(n.contextMenuItem.startPSTNCall,u)))})}return a},t.sortMenuItems=function(e){e.sort(f)}}),define("ui/viewModels/people/baseContactList",["require","lodash-compat","vendor/knockout","swx-i18n","swx-cafe-application-instance","swx-constants","swx-enums","browser/dom","browser/window","utils/common/ko","utils/common/eventMixin","swx-constants","swx-service-locator-instance","ui/viewModels/people/contactListHelper","ui/contextMenu/contextMenu","ui/contextMenu/items/all","ui/telemetry/actions/actionSources","utils/common/scroll","ui/viewModels/people/contactGroup","ui/modelHelpers/groupHelper","ui/contextMenu/menuItemHelper"],function(e){function S(){function t(){return e.isSelectable()?x("selectable"):x("default")}var e=this;e.contactGroups=n.observableArray(),e.contactsCount=n.observable(0),e.batchTimers=[],e.exclusionList=[],e.subscriptions={},e.isSelectable=n.observable(!1),e.templateName=n.computed(t)}function x(e){return"contactList-"+e}function T(e){return u.getElement("div.scrollinWrapper",e)}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-i18n").localization,i=e("swx-cafe-application-instance"),s=e("swx-constants").COMMON,o=e("swx-enums"),u=e("browser/dom"),a=e("browser/window"),f=e("utils/common/ko"),l=e("utils/common/eventMixin"),c=e("swx-constants").COMMON.serviceLocator,h=e("swx-service-locator-instance").default,p=e("ui/viewModels/people/contactListHelper"),d=e("ui/contextMenu/contextMenu"),v=e("ui/contextMenu/items/all"),m=e("ui/telemetry/actions/actionSources"),g=e("utils/common/scroll"),y=e("ui/viewModels/people/contactGroup"),b=e("ui/modelHelpers/groupHelper"),w=e("ui/contextMenu/menuItemHelper"),E=s.telemetry.historyLoadOrigin.CONTACTS_PAGE;return t.assign(S.prototype,l,{init:function(e,t){return this.isSelectable(Boolean(e.isSelectable)),this.scrollbar=g.build(T(t)),this.scrollbar.init(),this.contactGroupConstructor=e.contactGroupConstructor||y,this.populate(e,t)},populate:function(){function i(){e.populateGroups(n())}var e=this,t=h.resolve(c.SUBSCRIPTION_PROVIDER),n=t.getPersonsObservable(),r=t.getFavoritesObservable();return e.subscriptions.persons=n.subscribe(i,null,"arrayChange"),e.subscriptions.favorites=r.subscribe(i,null,"arrayChange"),i(),Promise.resolve()},populateGroups:function(e){function a(e){return n.contactGroupConstructor.build({name:r.fetch({key:"favorites_recents_category_name"}),contacts:e})}function f(e){return e?p.organizeByAlphabet(e).map(n.contactGroupConstructor.build):[]}function l(e){return n.shouldPersonBeIncluded(e,n.exclusionList)}function c(e){function i(e,n){return t.some(e,function(e){return e.id()===n.id()})}var n=b.getPersonsFromGroup(o.groupType.Favorites),r=i.bind(null,n);return t.groupBy(e,function(e){return r(e)?o.groupType.Favorites:o.groupType.None})}var n=this,i=e.filter(l),s=c(i),u=[].concat(a(s[o.groupType.Favorites]),f(s[o.groupType.None]));n.contactsCount(i.length),n.setContactGroups(u)},dispose:function(){this.contactsCount(0),this.exclusionList=[],f.disposeAndClearArray(this.contactGroups),this.scrollbar.dispose(),this.templateName.dispose&&this.templateName.dispose(),this.subscriptions&&(this.subscriptions.persons&&this.subscriptions.persons.dispose(),this.subscriptions.favorites&&this.subscriptions.favorites.dispose()),this.batchTimers=this.batchTimers.reduce(function(e,t){return a.clearTimeout(t),e},[])},afterRender:function(e){return e||t.noop},openConversation:function(e,n,r){var o=h.resolve(s.serviceLocator.PUBSUB),u={model:i.get().conversationsManager.getConversation(e.getPerson()),origin:E};t.assign(u,r),o.publish(s.events.navigation.OPEN_CONVERSATION,u)},setContactGroups:function(e){e.length===0?this.contactGroups(e):this.addNextGroup(e,[])},addNextGroup:function(e,t){var n,r;e.length>0&&(r=e.shift(),r.init(),this.applyPropertyChangeToContacts(r.contacts()),t=t.concat(r),n=this.addNextGroup.bind(this,e,t),this.contactGroups(t),this.batchTimers.push(a.setTimeout(n,10)))},showContextMenu:function(e,t,n){var r=[];r.push(w.getConversationContextMenuItemGroup(e,E,n)),r.push(new v.BlockContactMenuItem(e,w.getMenuItemTelemetryContext(m.contextMenuItem.block,n))),r.push(new v.UnblockContactMenuItem(e,w.getMenuItemTelemetryContext(m.contextMenuItem.unblock,n))),r.push(new v.DeleteContactMenuItem(e,w.getMenuItemTelemetryContext(m.contextMenuItem.deleteItem,n))),r.push(new v.AddContactToFavoritesMenuItem(e,w.getMenuItemTelemetryContext(m.contextMenuItem.addContactToFavorites,n))),r.push(new v.RemoveContactFromFavoritesMenuItem(e,w.getMenuItemTelemetryContext(m.contextMenuItem.removeContactFromFavorites,n))),w.sortMenuItems(r),d.show(r,t,n)},shouldPersonBeIncluded:p.shouldPersonBeIncluded,applyPropertyChangeToContacts:t.noop}),S}),define("ui/viewModels/people/contactPicker",["require","vendor/knockout","usertiming","swx-cafe-application-instance","swx-i18n","experience/settings","swx-enums","utils/common/ko","swx-constants","swx-constants","swx-service-locator-instance","services/telemetry/common/afterRenderHandler","ui/viewModels/people/contactListHelper","ui/viewModels/people/baseContactList","ui/modelHelpers/personHelper","ui/telemetry/telemetryClient","utils/common/accessibility"],function(e){function w(){function M(){return i.state()===g.STATE_SEARCH}function _(){return i.state()===g.STATE_DEFAULT}function D(){var e=i.hasSearchList()&&i.contactsCount()>0,t=i.hasDefaultList()&&i.contactGroups().length>0;return e||t}function P(e){var t,n=r.get().personsAndGroupsManager.all.persons();return t=n.filter(function(t){var n=!d.isAuthorizedContact(t);return n||d.isAgent(t)&&H(t,e)}),t}function H(e,t){return j(e)?B(t)&&!F(e):!0}function B(e){return!!e.selfParticipant&&e.selfParticipant.audio.state()===o.callConnectionState.Connected}function j(e){return typeof e.capabilities._groupChat=="function"&&e.capabilities._groupChat()}function F(e){return typeof e.capabilities._gvc=="function"&&e.capabilities._gvc()&&e.capabilities.audio()}function I(e){var t=P(e),n;n=C().map(function(e){return e.person}),i.exclusionList=n.concat(t)}var e,i=this,w=t.observable(""),C=null,k=null,L=l.resolve(a.serviceLocator.FEATURE_FLAGS),A=null,O=null;p.call(i),i.searchResults=t.observableArray(),i.selectedContacts=t.observableArray(),i.state=t.observable(g.STATE_DEFAULT),i.hasSearchList=t.computed(M),i.hasDefaultList=t.computed(_),i.isVisible=t.computed(D),i.css=t.computed(w),i.spacesEnabled=L.isFeatureOn(a.featureFlags.SPACES),e=i.hasSearchList.subscribe(function(e){e&&m.announce({key:"input_placeholder_typeContactName"})}),i.init=function(e,n){return i.showJumpToConversation=e.showJumpToConversation,w(e.className),t.isObservable(e.conversation.participants)?i.exclusionList=P(e.conversation):(C=e.conversation.participants,A=C.subscribe(),O=I.bind(null,e.conversation),C.changed(O)),i.registerEvent(y.ROSTER_QUERY_CHANGED,function(e){e&&Boolean(e.query)?i.search(e.query,x(e.selectedContacts,i.exclusionList)):(i.state(g.STATE_DEFAULT),i.contactsCount(0))}),i.registerEvent(y.ROSTER_SELECTION_REMOVED,function(e){if(e&&e.person){var t=S(i.selectedContacts(),e.person.id());T(t),i.selectedContacts.remove(t),h.deselectContactFromDefaultList(t.getPerson(),i)}}),p.prototype.init.call(i,e,n)},i.dispose=function(){u.disposeAndClearArray(i.searchResults),u.disposeAndClearArray(i.selectedContacts),i.hasSearchList.dispose(),i.hasDefaultList.dispose(),i.isVisible.dispose(),i.css.dispose(),e.dispose(),A!==null&&(A.dispose(),A=null,C.changed.off(O),O=null,C=null),p.prototype.dispose.call(i)},i.afterRender=function(){function t(){var e=l.resolve(a.serviceLocator.PUBSUB);e.publish(a.events.search.LOCAL_SEARCH_RESULTS_RENDERED,{resultCount:i.contactsCount()})}var e=c(i.contactsCount(),t);return p.prototype.afterRender.call(i,e)},i.search=function(e,t){var l=r.get().personsAndGroupsManager.createPersonSearchQuery(),c;n.mark(b.SEARCH.LOCAL.START);if(k!==null)try{k.cancel("Another search query triggered")}catch(p){v.get().sendEvent(s.telemetry.uiTenantToken,a.telemetry.promiseInvalidStateException.TYPE,{feature:a.telemetry.promiseInvalidStateException.feature.CONTACT_PICKER,exception:JSON.stringify(p)})}return l.limit(f.searchLimit),l.sources(o.searchScope.AddressBook),l.text(e),c=l.getMore().then(function(){var e,r;if(c!==k)return;e=h.filterSearchResults(l.results(),t),k=null,i.state(g.STATE_SEARCH),n.mark(b.SEARCH.LOCAL.END),u.disposeAndClearArray(i.searchResults),i.contactsCount(e.length),i.searchResults(e),r=N(e.length),m.announce(r),i.dispatchEvent(y.ROSTER_QUERY_EXECUTED,{moreResultsAvailable:l.moreResultsAvailable()})}),k=c,k},i.onContactSelected=function(e,t){t.preventDefault(),T(e),e.isActive()?E(e,i.selectedContacts())||(i.selectedContacts.push(e),i.dispatchEvent(y.PICKER_CONTACT_SELECTED,e.getPerson()),h.selectContactFromDefaultList(e.getPerson(),i)):(i.selectedContacts.remove(S(i.selectedContacts(),e.id())),i.dispatchEvent(y.PICKER_CONTACT_DESELECTED,e.getPerson()),h.deselectContactFromDefaultList(e.getPerson(),i)),i.state(g.STATE_DEFAULT)}}function E(e,t){return Boolean(S(t,e.id()))}function S(e,n){return t.utils.arrayFirst(e,function(e){return e.id()===n})}function x(e,t){var n=e||[];return n.concat(t)}function T(e){var t=e.isActive();e.isActive(!t)}function N(e){var t;return e===0?t=i.fetch({key:"accessibility_contactPickerNoResults"}):t=i.fetch({key:"accessibility_contactPickerUpdated",params:{totalSearchResults:e},count:e}),t}var t=e("vendor/knockout"),n=e("usertiming"),r=e("swx-cafe-application-instance"),i=e("swx-i18n").localization,s=e("experience/settings"),o=e("swx-enums"),u=e("utils/common/ko"),a=e("swx-constants").COMMON,f=e("swx-constants").PEOPLE,l=e("swx-service-locator-instance").default,c=e("services/telemetry/common/afterRenderHandler"),h=e("ui/viewModels/people/contactListHelper"),p=e("ui/viewModels/people/baseContactList"),d=e("ui/modelHelpers/personHelper"),v=e("ui/telemetry/telemetryClient"),m=e("utils/common/accessibility").narrator,g=f.contactPicker.states,y=a.events.roster,b=a.telemetry.performanceMarks;return w.prototype=new p,w.prototype.constructor=w,w}),define("text!views/people/picker.html",[],function(){return'<div data-bind="visible: isVisible, css: css, keyboardNavigation: { itemSelector: \'.contactList:not(.hidden) .searchItem\', persistSelection: false }" class="scrollinWrapper">\r\n    <div class="scrollViewport scrollViewportV" tabindex="-1">\r\n        <div role="menu" class="scrollingPane peoplePicker themeWhite" data-bind="css: { all: hasDefaultList }">\r\n            <!-- ko if: spacesEnabled && showJumpToConversation -->\r\n            <swx-selected-participants-conversation params="contacts: selectedContacts"></swx-selected-participants-conversation>\r\n            <!-- /ko -->\r\n\r\n            <div class="grid verticalGutter fixSmall contactList" data-bind="css: { hidden: hasSearchList, visible: hasDefaultList }">\r\n                <div class="row">\r\n                    <div class="separator peopleFilter">\r\n                        <p class="strong" data-bind="l10n: {key: \'message_title_allContacts\'}"></p>\r\n                    </div>\r\n                </div>\r\n\r\n                <ul class="row" data-bind="foreach: { data: contactGroups }">\r\n                    <div role="presentation" class="column" data-bind="css: { \'swx-hide\': $data.isHidden }">\r\n                        <div aria-hidden="true" class="separator">\r\n                            <p role="presentation" aria-hidden="true" class="strong" data-bind="text: $data.name"></p>\r\n                        </div>\r\n\r\n                        <div role="presentation" class="grid verticalGutter fixSmall row people">\r\n                            <!-- ko foreach: { data: $data.contacts, as: \'contact\' } -->\r\n                            <li role="menuitem" class="column searchItem Avatar-whiteThemeHover" data-bind="css: { active: contact.isActive }, attr: { \'data-title\': contact.textDetails, title: contact.displayName  }, enterKey: $parentContext.$parent.onContactSelected, event: { click: $parentContext.$parent.onContactSelected }">\r\n                                 <label>\r\n                                    <span class="icon">\r\n                                        <span class="iconfont tick"></span>\r\n                                    </span>\r\n                                    <swx-avatar class="Avatar--whiteTheme" params="status: contact.statusClassName, avatar: contact.avatar, isAgent: contact.isAgent, displayName: contact.displayNameUnescaped, isPstn: contact.isPstn, isSelected: contact.isActive"></swx-avatar>\r\n                                    <span class="text">\r\n                                        <span class="tileName">\r\n                                            <h4 data-bind="text: contact.displayNameUnescaped"></h4>\r\n                                        </span>\r\n                                        <!-- ko if: $data.displayMessage -->\r\n                                        <span class="message tile">\r\n                                            <p data-bind="html: contact.displayMessage" class="small"></p>\r\n                                        </span>\r\n                                        <!-- /ko -->\r\n                                    </span>\r\n                                </label>\r\n                            </li>\r\n                            <!-- /ko -->\r\n                        </div>\r\n                    </div>\r\n                </ul>\r\n            </div>\r\n\r\n            <div class="grid verticalGutter fixSmall contactList" data-bind="css: { hidden: hasDefaultList, visible: hasSearchList }">\r\n                <ul role="presentation" class="row people" data-bind="foreach: { data: searchResults, as: \'contact\', afterRender: afterRender() }">\r\n\r\n                    <li role="presentation" class="column" data-bind="attr: { \'data-title\': contact.textDetails, title: contact.displayName }">\r\n                        <div role="menuitem" data-bind="css: { searchItem: true, active: isActive }, enterKey: $parent.onContactSelected">\r\n                            <label>\r\n                                <input type="checkbox" tabindex="-1" name="sampleOne" data-bind="event: { change: $parent.onContactSelected }" />\r\n                                <span class="icon">\r\n                                    <span class="iconfont tick"></span>\r\n                                </span>\r\n                                <swx-avatar params="status: contact.statusClassName, avatar: contact.avatar, isAgent: contact.isAgent, displayName: contact.displayNameUnescaped, isPstn: contact.isPstn, isSelected: contact.isActive"></swx-avatar>\r\n                                <span class="text">\r\n                                    <span class="tileName">\r\n                                        <h4 data-bind="text: contact.displayNameUnescaped"></h4>\r\n                                    </span>\r\n                                    <!-- ko if: $data.displayMessage -->\r\n                                    <span class="message tile">\r\n                                        <p data-bind="html: contact.displayMessage" class="small"></p>\r\n                                    </span>\r\n                                    <!-- /ko -->\r\n                                </span>\r\n                            </label>\r\n                        </div>\r\n                    </li>\r\n\r\n                </ul>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/people/contactPicker",["require","exports","module","vendor/knockout","ui/viewModels/people/contactPicker","constants/components","text!views/people/picker.html"],function(e,t){function i(e,t){var i=new r;return e.isSelectable=!0,i.setContext(n.dataFor(t.element)),i.init(e,t.element),i}var n=e("vendor/knockout"),r=e("ui/viewModels/people/contactPicker");t.name=e("constants/components").people.CONTACT_PICKER,t.template=e("text!views/people/picker.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/people/contactProfile",["require","exports","module","lodash-compat","utils/common/eventMixin","swx-i18n","utils/common/cafeObservable","vendor/knockout","swx-service-locator-instance","swx-constants","ui/telemetry/actions/actionSources","ui/modalDialog/modalDialog","ui/viewModels/people/blockContactModal","text!views/people/blockContactModal.html","swx-cafe-application-instance","swx-enums","ui/viewModels/people/deleteContactModal","text!views/people/deleteContactModal.html","ui/modelHelpers/personHelper","ui/modelHelpers/groupHelper","ui/modelHelpers/personActionsHelper"],function(e,t){function w(e,t){function L(){return N()&&!r.contact.isPstn()}function A(){r.isInContacts(g.isKnownPerson(x))}function O(){C(Z())}function M(e,t){S.publish(a.events.interaction.SCROLL_START,t)}function D(){return r.contact.isAgent()?d.activityType.ContactRequestOutgoingAgent:r.contact.isPstn()?d.activityType.ContactRequestOutgoingPSTN:d.activityType.ContactRequestOutgoing}function P(){var e=new c(w,k),t=w.isAgent()?i.fetch({key:"modal_block_agent_text_aria_label"}):i.fetch({key:"modal_blockContact_text_aria_label"});return l.build(c.ELEMENT_ID,e,h),l.show(c.ELEMENT_ID,t),Promise.resolve()}function H(){var e={key:"label_text_blockContact_with_name",params:{name:r.contact.displayNameUnescaped()}};return T()&&(e.key="label_text_unblockContact_with_name"),i.fetch(e)}function B(){var e={key:"favorites_add_to_favorite"};return C()&&(e.key="favorites_remove_from_favorite"),i.fetch(e)}function j(){var e={key:g.isAgent(w)?"label_text_delete_agent":"label_text_deleteContact"};return i.fetch(e)}function F(){r.actionsInProgress(!1)}function I(){return!!r.contact.locationText()}function q(){return E.isFeatureOn(a.featureFlags.SHOW_AGENT_RATING_ON_PROFILE)&&r.contact.isAgent()&&G("rating")}function R(){return r.contact.isAgent()&&G("author")}function U(){return r.contact.isAgent()&&G("description")}function z(){return r.contact.isAgent()&&G("website")}function W(){return r.contact.isAgent()&&G("privacyStatement")}function X(){return r.contact.isAgent()&&G("termsOfService")}function V(){return E.isFeatureOn(a.featureFlags.SHOW_AGENT_EXTRA_INFO_ON_PROFILE)&&r.contact.isAgent()&&G("extraInfo")}function $(){return r.contact.isAgent()&&(W()||X())}function J(){return r.contact.isAgent()&&G("capabilitiesText")}function K(){return R()||U()||r.showAgentId||q()||z()}function Q(){var e=r.contact.agentDetails();return r.contact.isAgent()?e&&e.capabilities&&typeof e.capabilities.media_autoplay=="function"&&!!e.capabilities.media_autoplay():!1}function G(e){var t;return Y(e)?(t=r.contact.agentDetails()[e](),t!==undefined&&t!==null&&(""+t).trim().length>0):!1}function Y(e){return!!r.contact.agentDetails()&&typeof r.contact.agentDetails()[e]=="function"}function Z(){return y.isPersonInGroup(d.groupType.Favorites,w)}function et(){var e=E.isFeatureOn(a.featureFlags.USE_BUSINESS_WORDING),t=E.isFeatureOn(a.featureFlags.ENABLE_BUSINESS_CONTACT_MANAGEMENT);return e&&!t?!1:!0}var r=this,w=e.conversationTile.contact().getPerson(),E=u.resolve(a.serviceLocator.FEATURE_FLAGS),S=u.resolve(a.serviceLocator.PUBSUB),x=e.conversationModel.participants(0).person,T=s.newObservableProperty(x.isBlocked),N=s.newObservableProperty(x.isBlocked.set.enabled),C=o.observable(Z()),k={source:f.contactProfile};r.closeLabel=i.fetch({key:"header_text_close"}),r.model=e.conversationModel,r.contact=e.conversationTile.contact(),r.avatar=s.newObservableProperty(e.conversationModel.avatarUrl),r.hasContactInfo=o.computed(I),r.enableContactsManagement=et,r.actionsInProgress=o.observable(!1),r.canBlockContact=o.computed(L),r.isInContacts=o.observable(!1),r.isOrganizationContact=g.isOrganizationContact(w),r.blockContactText=o.computed(H),r.favoriteContactText=o.computed(B),r.deleteContactText=o.computed(j),r.showAgentId=E.isFeatureOn(a.featureFlags.SHOW_AGENT_ID_ON_PROFILE),r.favoritesFeatureEnabled=E.isFeatureOn(a.featureFlags.FAVORITE_CONTACTS_ENABLED),r.hasAgentRating=o.computed(q),r.hasAgentAuthor=o.computed(R),r.hasAgentDescription=o.computed(U),r.hasAgentWebsite=o.computed(z),r.hasAgentPrivacyStatement=o.computed(W),r.hasAgentTermsOfService=o.computed(X),r.hasAgentExtraInfo=o.computed(V),r.hasAgentPrivacyLinks=o.computed($),r.hasAgentCapabilitiesText=o.computed(J),r.hasAgentDetailsToShow=o.computed(K),r.hasAgentCapabilityAutoPlay=o.computed(Q),r.addContact=function(){function i(){r.dispatchEvent(a.events.conversation.CLOSE_PROFILE,undefined,r.DIRECTION.PARENT),F()}var t,n=D();return r.actionsInProgress(!0),p.get().conversationsManager.conversations.add(e.conversationModel),t=b.addPerson(w,n,e.conversationModel,k,i,F),r.dispatchEvent(a.events.message.ADD_CONTACT,k,r.DIRECTION.PARENT),t},r.toggleContactBlocked=function(){var e;return r.actionsInProgress(!0),T()?e=b.unblockPerson(w,k):e=P(),e.then(F,F),e},r.deleteContact=function(){var e=new v(r.contact,k),t=g.isAgent(w)?i.fetch({key:"label_text_delete_agent"}):i.fetch({key:"modal_deleteContact_text_aria_label"});return l.build(v.ELEMENT_ID,e,m),l.show(v.ELEMENT_ID,t),Promise.resolve()},r.toggleFavoriteContact=function(){var e;return r.actionsInProgress(!0),C()?e=b.removeFavorite(w,k):e=b.addFavorite(w,k),e.then(F,F),e},r.onScroll=n.debounce(M,1e3,{leading:!0,trailing:!1}),r.init=function(){t.init()},r.dispose=function(){p.get().personsAndGroupsManager.all.persons.changed.off(A),y.unsubscribeFromGroup(d.groupType.Favorites,O),r.hasContactInfo.dispose(),r.hasAgentRating.dispose(),r.hasAgentAuthor.dispose(),r.hasAgentDescription.dispose(),r.hasAgentWebsite.dispose(),r.hasAgentPrivacyStatement.dispose(),r.hasAgentTermsOfService.dispose(),r.hasAgentExtraInfo.dispose(),r.hasAgentPrivacyLinks.dispose(),r.hasAgentCapabilitiesText.dispose(),r.hasAgentDetailsToShow.dispose(),r.hasAgentCapabilityAutoPlay.dispose(),r.canBlockContact.dispose(),r.blockContactText.dispose(),r.deleteContactText.dispose(),r.favoriteContactText.dispose(),t.dispose()},p.get().personsAndGroupsManager.all.persons.changed(A),y.subscribeToGroup(d.groupType.Favorites,O)}var n=e("lodash-compat"),r=e("utils/common/eventMixin"),i=e("swx-i18n").localization,s=e("utils/common/cafeObservable"),o=e("vendor/knockout"),u=e("swx-service-locator-instance").default,a=e("swx-constants").COMMON,f=e("ui/telemetry/actions/actionSources"),l=e("ui/modalDialog/modalDialog"),c=e("ui/viewModels/people/blockContactModal"),h=e("text!views/people/blockContactModal.html"),p=e("swx-cafe-application-instance"),d=e("swx-enums"),v=e("ui/viewModels/people/deleteContactModal"),m=e("text!views/people/deleteContactModal.html"),g=e("ui/modelHelpers/personHelper"),y=e("ui/modelHelpers/groupHelper"),b=e("ui/modelHelpers/personActionsHelper");n.assign(w.prototype,r),t.classFunction=w,t.build=function(e,t){return new w(e,t)}}),define("text!views/people/contactProfile.html",[],function(){return'<div class="ContactProfile fixSmall">\r\n    <div class="ContactProfile--avatar">\r\n        <swx-avatar params="avatar: avatar, isAgent: contact.isAgent, isPstn: contact.isPstn, size: 220, displayName: contact.displayNameUnescaped"></swx-avatar>\r\n    </div>\r\n\r\n    <div class="ContactProfile--main">\r\n        <!-- ko if: enableContactsManagement() -->\r\n        <div class="ContactProfile--actions" data-bind="css: { \'ContactProfile--actions-agent\': hasAgentPrivacyLinks }">\r\n            <!-- ko if: !isInContacts() -->\r\n            <div class="ContactProfile--action-item fontSize-p">\r\n                <span data-bind="css: { \'in-progress\': actionsInProgress }">\r\n                    <a href="#" role="button" data-bind="l10n: {key: \'contact_information_add_to_contacts\'}, click: addContact, css: { \'in-progress\': actionsInProgress }"></a>\r\n                </span>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: isInContacts() && !isOrganizationContact -->\r\n            <div class="ContactProfile--action-item fontSize-p">\r\n                <span data-bind="css: { \'in-progress\': actionsInProgress }">\r\n                    <a href="#" role="button" data-bind="text: deleteContactText, click: deleteContact, css: { \'in-progress\': actionsInProgress }"></a>\r\n                </span>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: isInContacts() && favoritesFeatureEnabled -->\r\n            <div class="ContactProfile--action-item fontSize-p">\r\n                <span data-bind="css: { \'in-progress\': actionsInProgress }">\r\n                    <a href="#" role="button" data-bind="text: favoriteContactText, click: toggleFavoriteContact, css: { \'in-progress\': actionsInProgress }"></a>\r\n                </span>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: canBlockContact -->\r\n            <div class="ContactProfile--action-item fontSize-p">\r\n                <span data-bind="css: { \'in-progress\': actionsInProgress }">\r\n                    <a href="#" role="button" data-bind="click: toggleContactBlocked, text: blockContactText, css: { \'in-progress\': actionsInProgress }"></a>\r\n                </span>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- ko if: hasAgentPrivacyLinks -->\r\n                <div class="ContactProfile--action-item-privacy">\r\n                    <!-- ko if: hasAgentTermsOfService -->\r\n                    <div class="ContactProfile--action-item fontSize-p">\r\n                        <a href="#" target="_blank" role="button" data-bind="l10n: {key: \'label_text_agent_profile_link_text_terms_of_service\'}, attr: { href: contact.agentDetails().termsOfService }"></a>\r\n                    </div>\r\n                    <!-- /ko -->\r\n                    <!-- ko if: hasAgentPrivacyStatement -->\r\n                    <div class="ContactProfile--action-item fontSize-p">\r\n                        <a href="#" target="_blank" role="button" data-bind="l10n: {key: \'label_text_agent_profile_link_text_privacy_statement\'}, attr: { href: contact.agentDetails().privacyStatement }"></a>\r\n                    </div>\r\n                    <!-- /ko -->\r\n                </div>\r\n            <!-- /ko -->\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <div class="ContactProfile--data scrollingContainer">\r\n            <div class="scrollViewport scrollViewportV" data-bind="event: { scroll: onScroll }" tabindex="-1">\r\n\r\n                <!-- ko if: !contact.isAgent() -->\r\n                <div class="ContactProfile--data-section ContactProfile--details fontSize-p">\r\n                    <h2 data-bind="l10n: {key: \'label_text_contact_profile_details\'}"></h2>\r\n                    <ul>\r\n                        <!-- ko if: !contact.isPstn() -->\r\n                        <li class="ContactProfile--data-item">\r\n                            <span class="fontSize-h2" data-bind="l10n: {key: \'label_text_contact_profile_skype_name\'}"></span>\r\n                            <span data-swx-testId="contact-profile-contact-id" data-bind="text: contact.id"></span>\r\n                        </li>\r\n                        <!-- /ko -->\r\n\r\n                        <!-- ko foreach: contact.phoneNumbers -->\r\n                        <li class="ContactProfile--data-item">\r\n                            <swx-contact-profile-phone-number params="phoneNumber: $data"></swx-contact-profile-phone-number>\r\n                        </li>\r\n                        <!-- /ko -->\r\n                    </ul>\r\n                </div>\r\n                <!-- /ko -->\r\n\r\n                <!-- ko if: !contact.isAgent() && hasContactInfo() -->\r\n                <div class="ContactProfile--data-section ContactProfile--info fontSize-p">\r\n                    <h2 data-bind="l10n: {key: \'label_text_contact_profile_information\'}"></h2>\r\n                    <ul>\r\n                        <li class="ContactProfile--data-item">\r\n                            <span class="fontSize-h2" data-bind="l10n: {key: \'label_text_contact_profile_location\'}"></span>\r\n                            <span data-swx-testId="contact-profile-contact-location" data-bind="text: contact.locationText"></span>\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n                <!-- /ko -->\r\n\r\n                <!-- ko if: contact.isAgent() -->\r\n                <div class="ContactProfile--data-section ContactProfile--agent-details fontSize-p" data-bind="css: {hide: !hasAgentDetailsToShow()}">\r\n                    <ul>\r\n                        <!-- ko if: hasAgentAuthor -->\r\n                        <li class="ContactProfile--data-item">\r\n                            <span class="fontSize-h2" data-bind="l10n: {key: \'label_text_agent_profile_label_author\'}"></span>\r\n                            <span data-swx-testId="contact-profile-agent-author" data-bind="html: contact.agentDetails().author"></span>\r\n                        </li>\r\n                        <!-- /ko -->\r\n                        <!-- ko if: hasAgentDescription -->\r\n                        <li class="ContactProfile--data-item">\r\n                            <span class="fontSize-h2" data-bind="l10n: {key: \'label_text_agent_profile_label_description\'}"></span>\r\n                            <span data-swx-testId="contact-profile-agent-description" data-bind="html: contact.agentDetails().descriptionWithLinks"></span>\r\n                        </li>\r\n                        <!-- /ko -->\r\n                        <!-- ko if: showAgentId -->\r\n                        <li class="ContactProfile--data-item">\r\n                            <span class="fontSize-h2" data-bind="l10n: {key: \'label_text_agent_profile_label_agentid\'}"></span>\r\n                            <span data-swx-testId="contact-profile-agent-id" data-bind="text: contact.id"></span>\r\n                        </li>\r\n                        <!-- /ko -->\r\n                        <!-- ko if: hasAgentRating -->\r\n                        <li class="ContactProfile--data-item">\r\n                            <span class="fontSize-h2" data-bind="l10n: {key: \'label_text_agent_profile_label_rating\'}"></span>\r\n                            <span class="ContactProfile--agent-rating-value">\r\n                                <!-- ko foreach: { data: contact.agentDetails().ratingStars, as: \'star\' } -->\r\n                                <!-- ko if: star === 1 -->\r\n                                <span class="ContactProfile--agent-rating-star ContactProfile--agent-rating-star-full iconfont favourite"></span>\r\n                                <!-- /ko -->\r\n                                <!-- ko if: star !== 1 -->\r\n                                <span class="ContactProfile--agent-rating-star ContactProfile--agent-rating-star-half iconfont favourite"></span>\r\n                                <!-- /ko -->\r\n                                <!-- /ko -->\r\n                                <span class="ContactProfile--agent-rating-number" data-swx-testId="contact-profile-agent-rating">\r\n                                    (<span data-swx-testId="contact-profile-agent-rating" data-bind="text: contact.agentDetails().rating"></span>)\r\n                                </span>\r\n                            </span>\r\n                        </li>\r\n                        <!-- /ko -->\r\n                        <!-- ko if: hasAgentWebsite -->\r\n                        <li class="ContactProfile--data-item">\r\n                            <span class="fontSize-h2" data-bind="l10n: {key: \'label_text_agent_profile_label_website\'}"></span>\r\n                            <a data-swx-testId="contact-profile-agent-website" data-bind="attr: { href: contact.agentDetails().website }, text: contact.agentDetails().website" target="_blank"></a>\r\n                        </li>\r\n                        <!-- /ko -->\r\n                    </ul>\r\n                </div>\r\n                <div class="ContactProfile--data-section ContactProfile--agent-details fontSize-p">\r\n                    <ul>\r\n                        <!-- ko if: hasAgentCapabilitiesText -->\r\n                        <li class="ContactProfile--data-item">\r\n                            <span class="fontSize-h2" data-bind="l10n: {key: \'label_text_agent_profile_label_capabilities\'}"></span>\r\n                            <span data-swx-testId="contact-profile-agent-capabilities" data-bind="html: contact.agentDetails().capabilitiesText"></span>\r\n                        </li>\r\n                        <!-- /ko -->\r\n                        <!-- ko if: hasAgentExtraInfo -->\r\n                        <li class="ContactProfile--data-item">\r\n                            <span class="fontSize-h2" data-bind="l10n: {key: \'label_text_agent_profile_label_extra_info\'}"></span>\r\n                            <span data-swx-testId="contact-profile-agent-extraInfo" data-bind="text: contact.agentDetails().extraInfoWithLinks"></span>\r\n                        </li>\r\n                        <!-- /ko -->\r\n                        <li class="ContactProfile--data-item">\r\n                            <span class="fontSize-h2" data-bind="l10n: {key: \'label_text_agent_profile_label_privacy\'}"></span>\r\n                            <span data-swx-testId="contact-profile-agent-privacy" data-bind="l10n: {key: \'label_text_agent_profile_value_privacy\'}"></span>\r\n                            <!-- ko if: hasAgentCapabilityAutoPlay -->\r\n                            <span data-swx-testId="contact-profile-agent-privacy_autoplay" data-bind="l10n: {key: \'label_text_agent_profile_value_privacy_autoplay\'}"></span>\r\n                            <!-- /ko -->\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n                <!-- /ko -->\r\n            </div>\r\n        </div>\r\n\r\n        <swx-mute-conversation-setting-item params="conversationModel: model, contactProfile: true"></swx-mute-conversation-setting-item>\r\n    </div>\r\n\r\n</div>\r\n'}),define("ui/components/people/contactProfile",["require","exports","module","ui/viewModels/people/contactProfile","browser/dom","utils/common/scroll","vendor/knockout","constants/components","text!views/people/contactProfile.html"],function(e,t){function o(e,t){var o=s.dataFor(t.element),u=r.getElement(".scrollingContainer",t.element),a=i.build(u),f=n.build(e,a);return f.setContext(o),f.init(),f}var n=e("ui/viewModels/people/contactProfile"),r=e("browser/dom"),i=e("utils/common/scroll"),s=e("vendor/knockout");t.name=e("constants/components").people.CONTACT_PROFILE,t.template=e("text!views/people/contactProfile.html"),t.viewModel={createViewModel:o}}),define("ui/viewModels/people/phoneNumber",["require","exports","module","vendor/knockout","utils/common/cafeObservable","swx-utils-common","swx-i18n","swx-enums"],function(e,t){function u(e){function u(){var e=t.type()||o.phoneType.Other,n="label_text_phone_number_type_"+e.toLowerCase();return s.fetch({key:n})}function a(){return i.forceLTREmbedding(t.phoneNumber())}var t=this;t.phoneNumber=r.newObservableProperty(e.displayString),t.displayString=n.computed(a),t.type=r.newObservableProperty(e.type),t.displayType=n.computed(u)}var n=e("vendor/knockout"),r=e("utils/common/cafeObservable"),i=e("swx-utils-common").stringUtils,s=e("swx-i18n").localization,o=e("swx-enums");u.prototype.dispose=function(){this.displayType.dispose(),this.displayString.dispose()},t.classFunction=u,t.build=function(e){return new u(e)}}),define("text!views/people/contactProfilePhoneNumber.html",[],function(){return'<span data-bind="text: displayType" class="ContactProfile--phone-number-type fontSize-h2"></span>\r\n<span data-bind="text: displayString" class="ContactProfile--phone-number-value"></span>\r\n'}),define("ui/components/people/contactProfilePhoneNumber",["require","exports","module","ui/viewModels/people/phoneNumber","constants/components","text!views/people/contactProfilePhoneNumber.html"],function(e,t){function r(e){var t=n.build(e.phoneNumber);return t}var n=e("ui/viewModels/people/phoneNumber");t.name=e("constants/components").people.CONTACT_PROFILE_PHONE_NUMBER,t.template=e("text!views/people/contactProfilePhoneNumber.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/people/contactListMenuItem",["require","exports","module","lodash-compat","vendor/knockout","usertiming","swx-constants","swx-service-locator-instance","experience/settings","ui/telemetry/telemetryClient"],function(e,t){function f(e){var t=this,f=o.resolve(s.serviceLocator.ACTION_TELEMETRY);t.id=e.id?"menuItem-"+e.id:"",t.strategy=e.strategy,t.text=e.text||"",t.selected=r.observable(Boolean(e.selected)),t.onClick=function(t,r){return e.uiAction&&f.recordAction(e.uiAction),e.perfMarker&&i.mark(e.perfMarker),e.event&&a.get().sendEvent(u.uiTenantToken,e.event.name,e.event.data),n.isFunction(e.callback)&&e.callback(),r.preventDefault(),!0}}var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("usertiming"),s=e("swx-constants").COMMON,o=e("swx-service-locator-instance").default,u=e("experience/settings").telemetry,a=e("ui/telemetry/telemetryClient");t.build=function(e){return e||(e={}),new f(e)}}),define("telemetry/shortCircuit/shortCircuit",["require","exports","module","ui/telemetry/telemetryClient","swx-constants","experience/settings"],function(e,t){function s(){this.sendStartEvent=function(e){n.get().sendEvent(i.telemetry.uiTenantToken,r.shortCircuit.START,e||{})},this.sendFinishedEvent=function(e){n.get().sendEvent(i.telemetry.uiTenantToken,r.shortCircuit.FINISHED,e||{})},this.sendAddressBookAddedEvent=function(e){n.get().sendEvent(i.telemetry.uiTenantToken,r.shortCircuit.ADDRESS_BOOK_ADDED,e||{})},this.sendVisibleEvent=function(e){n.get().sendEvent(i.telemetry.uiTenantToken,r.shortCircuit.VISIBLE,e||{})}}var n=e("ui/telemetry/telemetryClient"),r=e("swx-constants").COMMON.telemetry.contacts,i=e("experience/settings");t.build=function(){return new s}}),define("ui/shortCircuit/shortCircuit",["require","exports","module","experience/settings","browser/window","browser/document","swx-constants","ui/session/localSession","swx-cafe-application-instance","swx-service-locator-instance","telemetry/shortCircuit/shortCircuit"],function(e,t){function b(){function b(e){var t="message";return new Promise(function(i){function o(e){e.origin===n.pnvService.host.replace(/\/$/,"")&&(a(),i(JSON.parse(e.data)))}function u(){e.closed&&(a(),i({error:"windowClosed"}))}function a(){r.clearInterval(s),r.removeEventListener(t,o)}var s=r.setInterval(u,1e3);r.addEventListener(t,o)})}function w(e,t){return r.open(t||"",e,"width="+c+",height="+h+",scrollbars,status")}function E(e){return Date.now()- +e<v}function S(e,t,r){function s(){return n.pnvService.host+n.pnvService.pnvEndpoint+"?"}function u(e){var t=[];return t.push("client_id="+n.pnvService.clientId),t.push("redirect_uri="+i.location.origin),t.push("response_type="+d),t.push("partner="+p),t.push("setlang="+n.initParams.locale),t.push("clientVersion="+n.uiVersion),t.push("scenario="+e),t.push("theme="+g),t.push("session_id="+o.getSessionId()),t.join("&")}return r=r||(E(t)?m:y),s()+u(r)+"#Skypetoken="+e}var e=this,t=f.build();e.open=function(e,n){var r,i=u.get(),s=l+ +Date.now(),o=w(s),a=!1;return r=b(o),r.then(function(e){var r=!!e&&!!e.flow_complete,i={contactsCount:n?n():0,newUser:a};e.error&&(i.error=e.error),r?(i.flowCompleted=r,t.sendAddressBookAddedEvent(i)):t.sendFinishedEvent(i)}),i.signInManager._skypeToken().then(function(o){return i.personsAndGroupsManager.mePerson.registeredAt.get().then(function(i){return a=E(i),t.sendStartEvent({contactsCount:n?n():0,newUser:a}),w(s,S(o,i,e)),r})}).catch(function(){return o.close(),r})},e.isEnabled=function(){var e=u.get().personsAndGroupsManager.mePerson,n=a.resolve(s.serviceLocator.FEATURE_FLAGS),r=n.isFeatureOn(s.featureFlags.SHORT_CIRCUIT);return!r||e._isLinkedMsaAutoGenerated===undefined||e.registeredAt===undefined?Promise.resolve(!1):e._isLinkedMsaAutoGenerated.get().then(function(e){return e||t.sendVisibleEvent(),!e})}}var n=e("experience/settings"),r=e("browser/window"),i=e("browser/document"),s=e("swx-constants").COMMON,o=e("ui/session/localSession"),u=e("swx-cafe-application-instance"),a=e("swx-service-locator-instance").default,f=e("telemetry/shortCircuit/shortCircuit"),l="Skype.ShortCircuit",c=720,h=472,p=999,d="postmessage",v=864e5,m="signup",g="skype-white",y="afterlogin";t.build=function(){return new b}}),define("ui/viewModels/people/contactPageContactGroup",["require","lodash-compat","vendor/knockout","utils/common/ko","ui/viewModels/people/contactBuilder"],function(e){function s(e){function r(){return this._hiddenContacts().every(function(e){return e()})}function s(){this._hiddenContacts(t.map(this.contacts(),"isHidden"))}function o(e){return i.build(e,{hideable:!0})}e=e||{},e.contacts=e.contacts||[],this.name=e.name,this.contacts=n.observableArray([]),this._hiddenContacts=n.observableArray(),this._contactsSubscription=this.contacts.subscribe(s,this,"arrayChange"),this.isHidden=n.computed(r,this),this.init=function(){var t=e.contacts.map(o);this.contacts(t)}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/ko"),i=e("ui/viewModels/people/contactBuilder");return s.prototype.dispose=function(){this._contactsSubscription.dispose(),this.isHidden.dispose(),r.disposeAndClearArray(this.contacts)},s.build=function(e){return new s(e)},s}),define("ui/viewModels/people/contactsPage",["require","lodash-compat","swx-cafe-application-instance","vendor/knockout","swx-enums","usertiming","swx-constants","constants/components","swx-constants","browser/dom","ui/telemetry/actions/actionNames","experience/settings","ui/telemetry/telemetryClient","services/telemetry/common/afterRenderHandler","ui/viewModels/people/baseContactList","swx-service-locator-instance","ui/telemetry/actions/actionSources","ui/viewModels/people/contactListHelper","swx-i18n","ui/modelHelpers/personHelper","ui/modelHelpers/groupHelper","ui/viewModels/people/contactListMenuItem","ui/shortCircuit/shortCircuit","ui/educationBubbles/educationBubble","ui/viewModels/people/contactPageContactGroup","ui/educationBubbles/educationBubbleInfo","swx-pubsub-instance","swx-constants","utils/common/eventHelper","swx-focus-handler"],function(e){function B(e){k.publish(o.events.navigation.NAVIGATE_TO_SEARCH_INPUT),p.get().sendEvent(h.telemetry.chatTenantToken,e,{})}function j(){var e=h.initParams.locale?h.initParams.locale:H;v.call(this),F().isFeatureOn(o.featureFlags.SHOW_CONTACTS_PAGE_HINT)?this.showHint=r.computed(function(){return this.contactsCount()>0},this):this.showHint=function(){return!1},this.oneAccountHtml=V(b.fetch({key:"one_account_link"})),this.showOneAccount=W(),this.menuItems=[],this.isShortCircuitEnabled=r.observable(!1),this.showNewBeePage=r.observable(!1),this.showFirstRunPage=r.observable(!1),this.isFirstRunPageFlagEnabled=F().isFeatureOn(o.featureFlags.SHOW_FIRST_RUN_LANDING_EXPERIENCE),this.onMouseDown=function(){B.call(this,P.event.CLICK)},this.onKeyDown=function(e,t){return t&&A.getKeyCode(t)!==L.TAB&&B.call(this,P.event.KEYDOWN),!0},this.learnMoreUrl=h.skypeFromOutlook.host+e+h.skypeFromOutlook.page}function F(){return m.resolve(o.serviceLocator.FEATURE_FLAGS)}function I(e,t){var n=m.resolve(o.serviceLocator.ACTION_TELEMETRY);n.recordAction(e,t)}function q(e){var t,n=R();n.ttc&&n.ttr&&(t={name:M.contacts.name.CONTACTS_PAGE_PERFORMANCE,timeToComplete:n.ttc.duration.toString(),timeToRender:n.ttr.duration.toString(),contactsCount:e.toString()},p.get().sendEvent(h.telemetry.uiTenantToken,M.contacts.type.CONTACTS,t)),z()}function R(){return{ttc:s.getEntriesByName(D.TTC)[0],ttr:s.getEntriesByName(D.TTR)[0]}}function U(){return s.getEntriesByName(_.OPENED).length>0}function z(){s.clearMarks(_.OPENED),s.clearMarks(_.INITIALIZED),s.clearMarks(_.RENDERED),s.clearMeasures(D.TTC),s.clearMeasures(D.TTR)}function W(){return F().isFeatureOn(o.featureFlags.SHOW_ONE_ACCOUNT_LINK)&&X()}function X(){return w.isTechnicalAccount(n.get().personsAndGroupsManager.mePerson)}function V(e){var t='<a href="'+h.oneAccountSupportUrl+'">';return e.replace("{link_start}",t).replace("{link_end}","</a>")}function $(){var e={},t=F().isFeatureOn(o.featureFlags.SEARCH_EDUCATION_BUBBLE_BUSINESS),r=F().isFeatureOn(o.featureFlags.SEARCH_EDUCATION_BUBBLE),i=m.resolve(o.serviceLocator.SUBSCRIPTION_PROVIDER);if(t&&r)throw new Error("Search education bubble should not be set for business and consumer flavors in the same time.");t&&(e=C.SEARCH_EDUCATION_BUBBLE_BUSINESS),r&&(e=C.SEARCH_EDUCATION_BUBBLE),(r||t)&&i.getContacts().then(function(){var t=E.getPersonsOtherThanEchoAndAgents(),r=n.get().conversationsManager.conversations;t.length===0&&r.size()===0&&G(e)})}function J(){var e=F().isFeatureOn(o.featureFlags.CHAT_EDUCATION_BUBBLE),n=F().isFeatureOn(o.featureFlags.CHAT_EDUCATION_BUBBLE_BUSINESS),r=m.resolve(o.serviceLocator.SUBSCRIPTION_PROVIDER);if(e&&n)throw new Error("Chat education bubble should not be set for business and consumer flavors in the same time.");e&&r.getContacts().then(function(){var e=E.getPersonsOtherThanEchoAndAgents(),n=e.length,r=t.filter(e,w.isSuggestedContact).length;n>0&&r===n&&G(C.CHAT_EDUCATION_BUBBLE)}),n&&r.getContacts().then(function(){var e=E.getPersonsOtherThanEchoAndAgents(),t=e.length;t>0&&G(C.CHAT_EDUCATION_BUBBLE_BUSINESS)})}function K(e){var t=F().isFeatureOn(o.featureFlags.SHOW_CONTACTS_PAGE_INFORMATIONAL_MESSAGE),n=m.resolve(o.serviceLocator.LOCAL_STORAGE),r=h.contactsPageInformationalMessage;e.canShowInformationalMessage=t&&r&&r.key&&r.link,e.canShowInformationalMessage&&(e.contactsPageInformationalMessage=r),n.getItem(o.teamsMigration.LOCAL_STORAGE_KEY).then(Q.bind(e))}function Q(e){function f(e){return e===o.teamsAsDefaultClient.CHAT||e===o.teamsAsDefaultClient.CALLING||e===o.teamsAsDefaultClient.CHAT_AND_CALLING}function l(){return(!e||e<+(new Date))&&(s||u)}function c(e){!e&&t.canShowInformationalMessage?(t.showInformationalMessage(!0),t.showTeamsAlert(!1)):e&&(t.showTeamsAlert(!0),t.showInformationalMessage(!1))}var t=this,r=n.get(),s=!!r.personsAndGroupsManager.mePerson._clientUpdatePolicy,u=!!r.personsAndGroupsManager.mePerson._teamsAsDefaultClient,a=r.signInManager.state;l()?a.when(i.loginState.SignedIn,function(){s&&r.personsAndGroupsManager.mePerson._clientUpdatePolicy.changed(function(e){function t(e){return e===o.teamsMigration.SHOW_NOTIFICATION}c(t(e))}),u&&r.personsAndGroupsManager.mePerson._teamsAsDefaultClient.changed(function(e){e>o.teamsAsDefaultClient.NONE&&(c(f(e)),t.teamsAsDefaultClient(e))})}):c(!1)}function G(e){var t=T.build(e.id,e.anchorElementQuery,e.i18nKey,e.iconUrlPath,e.options);t.show()}function Y(){function t(t){this.applyPropertyChangeToContacts=y.setObservablePropertyOnContacts.bind(this,"hideStrategy",t),this.applyPropertyChangeToContacts(this.contactGroups()),e.forEach(function(e){var n=e.strategy===t;e.selected(n)})}var e=[];return e.push(S.build({id:f.contactPageTabIds.ALL_CONTACTS_TAB,strategy:f.showStrategies.ALL,text:b.fetch({key:"contactPage_text_tab_allContacts"}),callback:t.bind(this,f.showStrategies.ALL),selected:!0})),e.push(S.build({id:f.contactPageTabIds.AVAILABLE_TAB,strategy:f.showStrategies.AVAILABLE_ONLY,text:b.fetch({key:"contactPage_text_tab_available"}),callback:t.bind(this,f.showStrategies.AVAILABLE_ONLY)})),F().isFeatureOn(o.featureFlags.AGENTS_DISCOVERABLE)&&e.push(S.build({id:f.contactPageTabIds.AGENTS_TAB,strategy:f.showStrategies.AGENTS_ONLY,text:b.fetch({key:"contactPage_text_tab_agents"}),callback:t.bind(this,f.showStrategies.AGENTS_ONLY)})),e}function Z(e){O.get().addFocusRequestToQueue(e),k.subscribe(u.FRAGMENT_LOADED,et.bind(null,e))}function et(e,t){t===a.people.CONTACTS_PAGE&&O.get().addFocusRequestToQueue(e)}var t=e("lodash-compat"),n=e("swx-cafe-application-instance"),r=e("vendor/knockout"),i=e("swx-enums"),s=e("usertiming"),o=e("swx-constants").COMMON,u=o.events.navigation,a=e("constants/components"),f=e("swx-constants").PEOPLE,l=e("browser/dom"),c=e("ui/telemetry/actions/actionNames"),h=e("experience/settings"),p=e("ui/telemetry/telemetryClient"),d=e("services/telemetry/common/afterRenderHandler"),v=e("ui/viewModels/people/baseContactList"),m=e("swx-service-locator-instance").default,g=e("ui/telemetry/actions/actionSources"),y=e("ui/viewModels/people/contactListHelper"),b=e("swx-i18n").localization,w=e("ui/modelHelpers/personHelper"),E=e("ui/modelHelpers/groupHelper"),S=e("ui/viewModels/people/contactListMenuItem"),x=e("ui/shortCircuit/shortCircuit"),T=e("ui/educationBubbles/educationBubble"),N=e("ui/viewModels/people/contactPageContactGroup"),C=e("ui/educationBubbles/educationBubbleInfo"),k=e("swx-pubsub-instance").default,L=e("swx-constants").KEYS,A=e("utils/common/eventHelper"),O=e("swx-focus-handler"),M=o.telemetry,_=M.performanceMarks.CONTACTS.PAGE,D=M.measurements.CONTACTS.PAGE,P=M.contacts.searchForFriends,H="en";return j.prototype=new v,j.prototype.constructor=j,j.prototype.init=function(e,t){var n=this,i,u,a=l.getElement(".ContactsPage",t);return U()&&(s.mark(_.INITIALIZED),s.measure(D.TTC,_.OPENED,_.INITIALIZED)),e.contactGroupConstructor=N,i=v.prototype.init.call(this,e,a),u=x.build().isEnabled().then(function(e){return e||(n.isFirstRunPageFlagEnabled?(n.showFirstRunPage(!0),Z(l.getElement(".ContactsPage-FirstRunInput",t)),p.get().sendEvent(h.telemetry.chatTenantToken,P.event.SHOW,{})):n.showNewBeePage(!0)),n.isShortCircuitEnabled(e)}),Array.prototype.push.apply(this.menuItems,Y.call(this)),n.showTeamsAlert=r.observable(!1),n.showInformationalMessage=r.observable(!1),n.teamsAsDefaultClient=r.observable(o.teamsAsDefaultClient.NONE),K(n),$(),n.isFirstRunPageFlagEnabled||Z(a),Promise.all([i,u])},j.prototype.dispose=function(){this.showHint.dispose&&this.showHint.dispose(),k.unsubscribe(u.FRAGMENT_LOADED,et),v.prototype.dispose.call(this)},j.prototype.afterRender=function(){function n(){U()&&(s.mark(_.RENDERED),s.measure(D.TTR,_.OPENED,_.RENDERED),q(e.contactsCount())),J()}var e=this,t=d(e.contactGroups().length,n);return v.prototype.afterRender.call(this,t)},j.prototype.openConversation=function(e,t){I(c.contacts.openConversation),v.prototype.openConversation.call(this,e,t)},j.prototype.showContextMenu=function(e,t){var n={source:g.contactsPage.contact};v.prototype.showContextMenu.call(this,e,t,n)},j.prototype.launchShortCircuit=function(){x.build().open(undefined,this.contactsCount),m.resolve(o.serviceLocator.ACTION_TELEMETRY).recordAction(c.shortCircuit.contactsPageOpen)},j.prototype.openInformationalMessageLink=function(){I(c.contacts.informationButtonClicked,{link:this.contactsPageInformationalMessage.link}),window.open(this.contactsPageInformationalMessage.link,"_blank")},j.prototype.shouldPersonBeIncluded=function(e,t){return y.personExistsInCollection(e,t)?!1:w.isEchoContact(e)?E.getPersonsOtherThanEcho().length>0:!0},j}),define("text!views/people/contactsPage.html",[],function(){return'<div data-swx-testId="contactsPage" class="ContactsPage themeWhite" tabindex="-1" data-bind="l10n_attr: {\'aria-label\': \'contactPage_text_header\'}">\r\n    <div class="ContactsPage-header">\r\n        <h1 class="ContactsPage-heading" data-bind="l10n: { key: \'contactPage_text_header\' }"></h1>\r\n\r\n        <!-- ko if: showHint() -->\r\n        <p class="ContactsPage-hint" data-bind="l10n: { key: \'contactPage_text_hint_search\' }"></p>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: contactsCount() > 0 -->\r\n        <ul role="tablist" class="ContactsPage-categories" data-bind="foreach: menuItems">\r\n            <li role="tab" class="ContactsPage-categoryItem" data-bind="attr: { \'aria-selected\': !!$data.selected() }">\r\n                <swx-contact-list-menu-item params="viewModel: $data"></swx-contact-list-menu-item>\r\n            </li>\r\n        </ul>\r\n        <!-- /ko -->\r\n    </div>\r\n    <div data-swx-testId="contactsPageBody" class="scrollinWrapper ContactsPage-body">\r\n        <div class="scrollViewport scrollViewportV" tabindex="-1">\r\n            <div class="scrollingPane themeWhite peoplePicker all">\r\n                <!-- ko template: { name: templateName } --><!-- /ko -->\r\n\r\n                <!-- ko if: !contactsCount() -->\r\n                    <div class="ContactsPage-cta">\r\n                        <div class="ContactsPage-ctaContent">\r\n                            <!-- ko if: isShortCircuitEnabled() -->\r\n                            <div class="ContactsPage-Image-addFriends"></div>\r\n                            <p class="ContactsPage-ctaText ContactsPage-ctaText--addFriends fontSize-h2" data-bind="l10n: {key: \'short_circuit_contacts_page_message_v2\'}"></p>\r\n                            <button type="button" class="ContactsPage-ctaButton btn primary cancel" data-bind="click: launchShortCircuit, l10n_attr: {\'aria-label\': \'short_circuit_contacts_page_message_v2\'}">\r\n                                <span class="clickable" data-bind="l10n: {key: \'short_circuit_contacts_page_cta\'}"></span>\r\n                            </button>\r\n                            <!-- /ko -->\r\n\r\n                            <!-- ko if: showFirstRunPage() -->\r\n                            <h1 class="ContactsPage-ctaHeading ContactsPage-ctaHeading--findFriends fontSize-h0" data-bind="l10n: {key: \'search_skype_for_friends_and_family_header\'}"></h1>\r\n                            <div class="ContactsPage-Image-findFriends"></div>\r\n                            <h3 class="ContactsPage-ctaText fontSize-h3 ContactsPage-ctaText--findFriends" data-bind="l10n: {key: \'search_skype_for_friends_and_family_message\'}"></h3>\r\n                            <input type="text" role="search" class="inputField ContactsPage-FirstRunInput fontSize-h4" data-bind="event: { mousedown: onMouseDown, keydown: onKeyDown }, l10n_attr: {\'placeholder\': \'search_skype_for_friends_and_family_searchDirectory\', \'aria-label\': \'input_placeholder_searchSkype\'}" />\r\n                            <p class="ContactsPage-ctaText smaller ContactsPage-ctaText--findFriends" data-bind="l10n: {key: \'search_skype_for_friends_and_family_tip\'}"></p>\r\n                            <!-- /ko -->\r\n\r\n                            <!-- ko if: showNewBeePage() -->\r\n                            <div class="ContactsPage-ctaCover"></div>\r\n                            <h1 class="ContactsPage-ctaHeading fontSize-h0" data-swx-testId="contactsPageCtaHeading" data-bind="l10n: {key: \'newbee_text_header\'}"></h1>\r\n                            <p class="ContactsPage-ctaText fontSize-h2" data-bind="businessAwareL10n: {key: \'newbee_text_cta\'}"></p>\r\n                            <!-- /ko -->\r\n                        </div>\r\n                    </div>\r\n                <!-- /ko -->\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- ko if: showOneAccount -->\r\n    <p class="ContactsPage-oneAccount" data-bind="html: oneAccountHtml"></p>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: showInformationalMessage -->\r\n    <div class="InformationalMessage">\r\n        <a href="#" role="button" data-bind="click: openInformationalMessageLink, l10n: {key: contactsPageInformationalMessage.key}"></a>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- ko if: showTeamsAlert -->\r\n        <swx-teams-alert params="showTeamsAlert: $data.showTeamsAlert, teamsAsDefaultClient: $data.teamsAsDefaultClient, showInformationalMessage: $data.showInformationalMessage, canShowInformationalMessage: $data.canShowInformationalMessage" class="TeamsAlert"></swx-teams-alert>\r\n    <!-- /ko -->\r\n</div>\r\n\r\n<script type="text/html" id="contactList-default">\r\n    <ul class="grid verticalGutter fixSmall" data-bind="foreach: { data: contactGroups, afterRender: afterRender() }, keyboardNavigation: { itemSelector: \'li.contactTile:not(.swx-hide)\', persistSelection: false }">\r\n        <div class="row separator" data-bind="css: { \'swx-hide\': $data.isHidden }">\r\n            <p role="presentation" aria-hidden="true" class="strong" data-bind="text: $data.name, css: { \'swx-hide\': $data.isHidden }"></p>\r\n            <div class="row people">\r\n                <!-- ko foreach: { data: contacts } -->\r\n                <li class="column contactTile searchItem Avatar-whiteThemeHover" data-bind="css: { \'swx-hide\': $data.isHidden, active: $data.isActive },  enterKey: $parentContext.$parent.openConversation,\r\n                event: { click: $parentContext.$parent.openConversation, contextmenu: $parentContext.$parent.showContextMenu }, attr: { \'aria-label\': $data.ariaLabel, title: $data.displayName }" tabindex="0">\r\n                        <swx-avatar params="status: $data.statusClassName, avatar: $data.avatar, isAgent: $data.isAgent, isPstn: $data.isPstn, displayName: $data.displayNameUnescaped"></swx-avatar>\r\n                        <span class="text">\r\n                            <span class="tile">\r\n                                <span class="tileName">\r\n                                    <h4>\r\n                                        <span class="topic" data-bind="text: $data.displayNameUnescaped, attr: {title: $data.displayName}"></span>\r\n                                        <!-- ko if: $data.agentDetails() && $data.agentDetails().certification() -->\r\n                                        <span class="iconfont avatarBotCertified"></span>\r\n                                        <!-- /ko -->\r\n                                    </h4>\r\n                                </span>\r\n                            </span>\r\n                            <!-- ko if: $data.displayMessage -->\r\n                            <span class="message tile">\r\n                                <p data-bind="html: $data.displayMessage" data-swx-testId="displayMessage" class="small"></p>\r\n                            </span>\r\n                            <!-- /ko -->\r\n                        </span>\r\n                </li>\r\n                <!-- /ko -->\r\n            </div>\r\n        </div>\r\n    </ul>\r\n</script>\r\n\r\n<script type="text/html" id="contactList-selectable">\r\n    <ol role="list" class="grid verticalGutter fixSmall" data-bind="foreach: { data: contactGroups }">\r\n        <li class="row separator" data-bind="css: { \'swx-hide\': $data.isHidden }">\r\n            <p role="presentation" aria-hidden="true" class="strong" data-bind="text: $data.name"></p>\r\n            <div class="row people">\r\n                <ul data-bind="foreach: { data: $data.contacts }">\r\n                    <li class="column contactTile">\r\n                        <div data-bind="css: { \'swx-hide\': $data.isHidden, active: $data.isActive }">\r\n                            <label>\r\n                                <input type="checkbox" name="sampleOne">\r\n                                <span class="icon">\r\n                                    <span class="iconfont tick"></span>\r\n                                </span>\r\n                                <swx-avatar params="status: $data.statusClassName, avatar: $data.avatar, isAgent: $data.isAgent, displayName: $data.displayNameUnescaped"></swx-avatar>\r\n                                <span class="text">\r\n                                    <span class="tileName">\r\n                                        <h4 data-bind="text: $data.displayNameUnescaped"></h4>\r\n                                    </span>\r\n                                    <!-- ko if: $data.displayMessage -->\r\n                                    <span class="message tile">\r\n                                        <p data-bind="html: $data.displayMessage" data-swx-testId="displayMessage" class="small"></p>\r\n                                    </span>\r\n                                    <!-- /ko -->\r\n                                </span>\r\n                            </label>\r\n                        </div>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n        </li>\r\n    </ol>\r\n</script>\r\n'}),define("ui/components/people/contactsPage",["require","exports","module","vendor/knockout","ui/viewModels/people/contactsPage","constants/components","text!views/people/contactsPage.html"],function(e,t){function i(e,t){var i=new r;return i.setContext(n.dataFor(t.element)),i.init(s(),t.element),i}function s(){return{className:"ContactsPage",isSelectable:!1}}var n=e("vendor/knockout"),r=e("ui/viewModels/people/contactsPage");t.name=e("constants/components").people.CONTACTS_PAGE,t.template=e("text!views/people/contactsPage.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/people/baseList",["require","lodash-compat","vendor/knockout","swx-cafe-application-instance","experience/settings","swx-i18n","swx-service-locator-instance","swx-constants","swx-constants","ui/viewModels/people/contactBuilder","ui/telemetry/telemetryClient","ui/telemetry/people/contactSearch","utils/common/statusMapper"],function(e){function d(e){this.activeSearchPromise=null,this.listSource=n.observable(e),this.contacts=n.observableArray(),this.emptyListText=s.fetch({key:"message_text_emptySearchResults"}),this.showEmptyListText=n.observable(!1),this.showListTitle=n.observable(!1),this.listHasContacts=n.computed(function(){return this.contacts().length>0},this),this.listRole=n.computed(function(){return this.contacts().length>0?"menubar":"group"},this)}function v(){return o.resolve(u.serviceLocator.PUBSUB)}function m(e){if(e)try{e.cancel("Another search query triggered")}catch(t){l.get().sendEvent(i.telemetry.uiTenantToken,u.telemetry.promiseInvalidStateException.TYPE,{feature:u.telemetry.promiseInvalidStateException.feature.PEOPLE_SEARCH,exception:JSON.stringify(t)})}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-cafe-application-instance"),i=e("experience/settings"),s=e("swx-i18n").localization,o=e("swx-service-locator-instance").default,u=e("swx-constants").COMMON,a=e("swx-constants").PEOPLE,f=e("ui/viewModels/people/contactBuilder"),l=e("ui/telemetry/telemetryClient"),c=e("ui/telemetry/people/contactSearch"),h=e("utils/common/statusMapper"),p=u.events.search;return d.prototype.init=function(){v().subscribe(p.QUERY_CHANGED,this.search)},d.prototype.dispose=function(){v().unsubscribe(p.QUERY_CHANGED,this.search)},d.prototype.reset=function(){this.showListTitle(!1),this.showEmptyListText(!1),this.contacts([])},d.prototype.search=function(t,n){function u(){if(o.activeSearchPromise!==s)return;h(),o.contacts(i.results().map(function(e){return f.build(e.result,{keepPresenceSubscription:!1,keepLastSeenAtSubscription:!1,keepActivitySubscription:!1,keepEndpointTypeSubscription:!1})})),v().publish(p.QUERY_EXECUTED,{moreResultsAvailable:i.moreResultsAvailable()})}function l(e){if(e&&e.message==="Canceled")return;if(o.activeSearchPromise!==s)return;c.onContactSearchEnd({success:!1,searchScope:o.listSource()}),h()}function h(){o.activeSearchPromise=null,o.totalSearchResults=i.results().length,o.latestSearchQueryResults=i.results(),v().publish(n.results,o.totalSearchResults),o.showListTitle(!0),o.showEmptyListText(!i.results().length)}var i,s,o=this;if(!t)return;return this.showEmptyListText(!1),m(o.activeSearchPromise),i=r.get().personsAndGroupsManager.createPersonSearchQuery(),i.sources(o.listSource()),i.text(t),i.limit(a.searchLimit),s=i.getMore().then(u,l),this.activeSearchPromise=s,s},d.prototype.sendOpenConversationEvent=function(t){v().publish(u.events.navigation.OPEN_CONVERSATION,{model:t,origin:this.historyLoadOrigin})},d.prototype.getSearchItemDetails=function(t,n){var r=h.getAvailabilityText(t.status());return s.fetch({key:this.searchItemI18nKey,params:{contactName:t.displayName(),id:t.id(),status:r!==null?r:"",index:n+1,totalResults:this.totalSearchResults}})},d.prototype.indexOfSelectedContactInSearchResults=function(n){var r;if(!n||!t.isArray(this.latestSearchQueryResults))return;return r=t.findIndex(this.latestSearchQueryResults,function(e){return e.result.id()===n.id()}),r!==-1?r+1:undefined},d}),define("ui/viewModels/people/directoryList",["require","ui/viewModels/people/baseList","swx-cafe-application-instance","swx-service-locator-instance","vendor/knockout","swx-constants","swx-i18n","swx-constants","swx-enums","lodash-compat","ui/telemetry/actions/actionSources","ui/contextMenu/contextMenu","ui/contextMenu/menuItemHelper","ui/contextMenu/items/all","ui/telemetry/people/contactSearch"],function(e){function m(){function m(){return r.resolve(u.serviceLocator.PUBSUB)}function g(e){return{source:e,parent:l.searchItem.skypeDirectory}}var e=this,f=t.prototype;this.listClass=i.observable(s.contactList.className.DIRECTORY),this.listTitle=i.observable(o.fetch({key:"message_text_contactTitleDirectory"})),this.showListTitle=i.observable(!1),this.events={results:v.DIRECTORY_SEARCH_RESULTS,rendered:v.DIRECTORY_SEARCH_RESULTS_RENDERED},this.historyLoadOrigin=u.telemetry.historyLoadOrigin.DIRECTORY_SEARCH,this.searchItemI18nKey="accessibility_searchItem_directoryList",t.call(e,a.searchScope.SkypeDirectory),e.lastQuery="",e.isActive=!1,e.init=function(){m().subscribe(v.DIRECTORY_SEARCH_ACTIVATED,e.activate),m().subscribe(v.DIRECTORY_SEARCH_DEACTIVATED,e.deactivate),f.init.call(e)},e.dispose=function(){m().unsubscribe(v.DIRECTORY_SEARCH_ACTIVATED,e.activate),m().unsubscribe(v.DIRECTORY_SEARCH_DEACTIVATED,e.deactivate),f.dispose.call(e)},e.search=function(n){e.lastQuery=n,f.reset.call(e);if(e.isActive)return f.search.call(e,n,e.events)},e.openConversation=function(r){var i=n.get().conversationsManager.getConversation(r.getPerson());f.sendOpenConversationEvent.call(e,i),d.onContactSearchEnd({searchScope:a.searchScope.SkypeDirectory,success:!0,resultCount:e.totalSearchResults,clickPosition:f.indexOfSelectedContactInSearchResults.call(e,r),source:l.search.reset.openConversation})},e.showContextMenu=function(t,n){var r,i={source:l.searchItem.skypeDirectory},s=g(l.contextMenuItem.unblock),o=g(l.contextMenuItem.block);r=[new p.BlockContactMenuItem(t,o),new p.UnblockContactMenuItem(t,s)],h.sortMenuItems(r),c.show(r,n,i)},e.activate=function(){e.isActive=!0,e.search(e.lastQuery)},e.deactivate=function(){e.isActive=!1}}var t=e("ui/viewModels/people/baseList"),n=e("swx-cafe-application-instance"),r=e("swx-service-locator-instance").default,i=e("vendor/knockout"),s=e("swx-constants").PEOPLE,o=e("swx-i18n").localization,u=e("swx-constants").COMMON,a=e("swx-enums"),f=e("lodash-compat"),l=e("ui/telemetry/actions/actionSources"),c=e("ui/contextMenu/contextMenu"),h=e("ui/contextMenu/menuItemHelper"),p=e("ui/contextMenu/items/all"),d=e("ui/telemetry/people/contactSearch"),v=u.events.search;return m.prototype=f.create(t.prototype,{constructor:m}),m}),define("text!views/people/list.html",[],function(){return'<ul data-bind="css: listClass, keyboardNavigation: { itemSelector: \'.searchItem\', persistSelection: false }, attr: {\'role\': listRole, \'aria-label\': listTitle }">\r\n    <!-- ko if: showListTitle -->\r\n    <div class="separator">\r\n        <p class="strong" data-bind="text: listTitle"></p>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: showEmptyListText -->\r\n    <li class="grid container">\r\n        <p data-bind="text: emptyListText"></p>\r\n    </li>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: listHasContacts -->\r\n    <!-- ko foreach: { data: contacts, as: \'contact\' } -->\r\n    <li class="list-selectable searchItem clearfix Avatar-whiteThemeHover" role="menuitem" data-bind="attr: { \'data-title\': $parent.getSearchItemDetails(contact, $index()) },\r\n    event: { click: $parent.openConversation, contextmenu: $parent.showContextMenu }, enterKey: $parent.openConversation, css: { active: contact.isActive }">\r\n        <swx-avatar params="status: contact.statusClassName, avatar: contact.avatar, isAgent: contact.isAgent, displayName: contact.displayNameUnescaped, isPstn: contact.isPstn"></swx-avatar>\r\n        <span class="text">\r\n            <span class="arrow"></span>\r\n            <span class="tileName">\r\n                <h4 data-bind="text: contact.displayNameUnescaped"></h4>\r\n            </span>\r\n            <!-- ko if: contact.displayMessage -->\r\n            <span class="message">\r\n                <p class="small" data-bind="html: contact.displayMessage"></p>\r\n            </span>\r\n            <!-- /ko -->\r\n        </span>\r\n    </li>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n</ul>\r\n'}),define("ui/components/people/directorySearch",["require","exports","module","ui/viewModels/people/directoryList","constants/components","text!views/people/list.html"],function(e,t){function r(){var e=new n;return e.init(),e}var n=e("ui/viewModels/people/directoryList");t.name=e("constants/components").people.DIRECTORY_SEARCH,t.template=e("text!views/people/list.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/people/discoverAgentsPage",["require","swx-cafe-application-instance","usertiming","swx-constants","ui/viewModels/chat/navigationHelper","constants/components","browser/dom","ui/telemetry/actions/actionNames","experience/settings","ui/telemetry/telemetryClient","services/telemetry/common/afterRenderHandler","ui/viewModels/people/baseContactList","swx-service-locator-instance","ui/telemetry/actions/actionSources","ui/viewModels/people/contactListHelper","constants/cssClasses","swx-enums","vendor/knockout","ui/contextMenu/items/all","ui/contextMenu/contextMenu","swx-pubsub-instance","swx-focus-handler"],function(e){function A(){var e=this,t=p.resolve(r.serviceLocator.FEATURE_FLAGS);h.call(e),e.templateName="contactList-agents",e.agentsDiscoverable=t.isFeatureOn(r.featureFlags.AGENTS_DISCOVERABLE),e.menuItems=[],e.searchInProgress=y.observable(!1),e.hasResults=y.computed(function(){return!e.searchInProgress()&&!!e.contactGroups().length}),e.hasZeroResults=y.computed(function(){return!e.searchInProgress()&&e.contactGroups().length===0})}function O(e){var t=p.resolve(r.serviceLocator.ACTION_TELEMETRY);t.recordAction(e)}function M(e){var t,n=_();n.ttc&&n.ttr&&(t={name:r.telemetry.agents.name.DISCOVER_AGENTS_PAGE_PERFORMANCE,timeToComplete:n.ttc.duration.toString(),timeToRender:n.ttr.duration.toString(),contactsCount:e.toString()},l.get().sendEvent(f.telemetry.uiTenantToken,r.telemetry.agents.type.AGENTS,t)),P()}function _(){return{ttc:n.getEntriesByName(C.TTC)[0],ttr:n.getEntriesByName(C.TTR)[0]}}function D(){return n.getEntriesByName(N.OPENED).length>0}function P(){n.clearMarks(N.OPENED),n.clearMarks(N.INITIALIZED),n.clearMarks(N.RENDERED),n.clearMeasures(C.TTC),n.clearMeasures(C.TTR)}function H(e){S.get().addFocusRequestToQueue(e),E.subscribe(s.FRAGMENT_LOADED,B)}function B(e){e===o.people.DISCOVER_AGENTS_PAGE&&S.get().addFocusRequestToQueue(x)}var t=e("swx-cafe-application-instance"),n=e("usertiming"),r=e("swx-constants").COMMON,i=e("ui/viewModels/chat/navigationHelper"),s=r.events.navigation,o=e("constants/components"),u=e("browser/dom"),a=e("ui/telemetry/actions/actionNames"),f=e("experience/settings"),l=e("ui/telemetry/telemetryClient"),c=e("services/telemetry/common/afterRenderHandler"),h=e("ui/viewModels/people/baseContactList"),p=e("swx-service-locator-instance").default,d=e("ui/telemetry/actions/actionSources"),v=e("ui/viewModels/people/contactListHelper"),m=e("constants/cssClasses"),g=e("swx-enums"),y=e("vendor/knockout"),b=e("ui/contextMenu/items/all"),w=e("ui/contextMenu/contextMenu"),E=e("swx-pubsub-instance").default,S=e("swx-focus-handler"),x=null,T=r.telemetry,N=T.performanceMarks.DISCOVER_AGENTS.PAGE,C=T.measurements.DISCOVER_AGENTS.PAGE,k=r.telemetry.historyLoadOrigin.DISCOVER_AGENTS_PAGE,L={source:d.discoverAgentsPage.agent};return A.prototype=new h,A.prototype.constructor=A,A.prototype.init=function(e,t){var r;return this.agentsDiscoverable?(x=u.getElement("."+m.discoverAgents.PAGE,t),D()&&(n.mark(N.INITIALIZED),n.measure(C.TTC,N.OPENED,N.INITIALIZED)),r=h.prototype.init.call(this,e,x),H(x),r):(i.navigateToContactsPage(),Promise.resolve())},A.prototype.dispose=function(){x=null,this.hasResults.dispose(),this.hasZeroResults.dispose(),E.unsubscribe(s.FRAGMENT_LOADED,B),h.prototype.dispose.call(this)},A.prototype.afterRender=function(){function r(){D()&&(n.mark(N.RENDERED),n.measure(C.TTR,N.OPENED,N.RENDERED),M(e.contactsCount()))}var e=this,t=c(e.contactGroups().length,r);return h.prototype.afterRender.call(this,t)},A.prototype.openConversation=function(e,t){var n={origin:k,target:{expandProfile:!0},telemetryContext:L};O(a.discoverAgents.openConversation),h.prototype.openConversation.call(this,e,t,n)},A.prototype.showContextMenu=function(e,t){var n=[new b.ViewPersonProfileMenuItem(e.getPerson(),k,L)];w.show(n,t,L)},A.prototype.shouldPersonBeIncluded=function(e,t){return!v.personExistsInCollection(e,t)},A.prototype.populate=function(e){function a(){n.exclusionList=o(),u.then(f)}function f(){var t=i.results().map(function(e){return e.result});n.populateGroups(t,e),n.searchInProgress(!1)}var n=this,i=t.get().personsAndGroupsManager.createPersonSearchQuery(),s=p.resolve(r.serviceLocator.SUBSCRIPTION_PROVIDER),o=s.getPersonsObservable(),u;return n.searchInProgress(!0),n.exclusionList=o(),i.sources(g.searchScope.Agent),u=i.getMore(),u.then(f),n.subscriptions.persons=o.subscribe(a,null,"arrayChange"),u},A}),define("text!views/people/discoverAgentsPage.html",[],function(){return'<!-- ko if: agentsDiscoverable -->\r\n<div data-swx-testId="DiscoverAgentsPage" class="DiscoverAgentsPage themeWhite" tabindex="-1">\r\n    <div class="DiscoverAgentsPage--header">\r\n        <h1 class="DiscoverAgentsPage--heading" data-bind="l10n: { key: \'label_text_discover_agents_page_header\' }"></h1>\r\n        <p class="DiscoverAgentsPage--hint" data-bind="l10n: { key: \'label_text_discover_agents_page_hint\' }"></p>\r\n    </div>\r\n    <div data-swx-testId="discoverAgentsPageBody" class="scrollinWrapper DiscoverAgentsPage--body">\r\n        <div class="scrollViewport scrollViewportV" tabindex="-1">\r\n            <div class="scrollingPane themeWhite peoplePicker all">\r\n                <!-- ko if: searchInProgress -->\r\n                <div class="DiscoverAgentsPage--spinner">\r\n                    <swx-loading-animation data-bind="visible: searchInProgress" class="spinner fog"></swx-loading-animation>\r\n                </div>\r\n                <!-- /ko -->\r\n\r\n                <!-- ko if: hasResults -->\r\n                <!-- ko template: { name: templateName } --><!-- /ko -->\r\n                <!-- /ko -->\r\n\r\n                <!-- ko if: hasZeroResults -->\r\n                <div class="DiscoverAgentsPage--zero-results">\r\n                    <p data-bind="l10n: { key: \'label_text_discover_agents_page_zero_results_text_part_1\' }"></p>\r\n                    <p data-bind="l10n: { key: \'label_text_discover_agents_page_zero_results_text_part_2\' }"></p>\r\n                </div>\r\n                <!-- /ko -->\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<script type="text/html" id="contactList-agents">\r\n    <ul class="grid verticalGutter fixSmall" data-bind="foreach: { data: contactGroups, afterRender: afterRender() },\r\n    keyboardNavigation: { itemSelector: \'li.contactTile:not(.swx-hide)\', persistSelection: false }, attr_l10n: {\'aria-label\': \'label_text_discover_agents_page_header\'}">\r\n        <div class="row separator" data-bind="css: { \'swx-hide\': $data.isHidden }">\r\n            <p role="presentation" aria-hidden="true" class="strong" data-bind="text: $data.name"></p>\r\n            <div class="row people">\r\n                <!-- ko foreach: { data: contacts } -->\r\n                <li class="column contactTile searchItem Avatar-whiteThemeHover" data-bind="css: { \'swx-hide\': $data.isHidden, active: $data.isActive },  enterKey: $parentContext.$parent.openConversation,\r\n                event: { click: $parentContext.$parent.openConversation, contextmenu: $parentContext.$parent.showContextMenu }, attr: { \'aria-label\': $data.ariaLabel }">\r\n                    <swx-avatar params="status: $data.statusClassName, avatar: $data.avatar, isAgent: $data.isAgent"></swx-avatar>\r\n                        <span class="text">\r\n                            <span class="tile">\r\n                                <span class="tileName">\r\n                                    <h4>\r\n                                        <span class="topic" data-bind="text: $data.displayName, attr: {title: $data.displayName}"></span>\r\n                                        <!-- ko if: $data.agentDetails() && $data.agentDetails().certification() -->\r\n                                        <span class="iconfont avatarBotCertified"></span>\r\n                                        <!-- /ko -->\r\n                                    </h4>\r\n                                </span>\r\n                            </span>\r\n                            <!-- ko if: $data.displayMessage -->\r\n                            <span class="message tile">\r\n                                <p data-bind="html: $data.displayMessage" data-swx-testId="displayMessage" class="small"></p>\r\n                            </span>\r\n                            <!-- /ko -->\r\n                        </span>\r\n                </li>\r\n                <!-- /ko -->\r\n            </div>\r\n        </div>\r\n    </ul>\r\n</script>\r\n<!-- /ko -->'}),define("ui/components/people/discoverAgentsPage",["require","exports","module","vendor/knockout","constants/cssClasses","ui/viewModels/people/discoverAgentsPage","constants/components","text!views/people/discoverAgentsPage.html"],function(e,t){function s(e,t){var r=new i;return r.setContext(n.dataFor(t.element)),r.init(o(),t.element),r}function o(){return{className:r.discoverAgents.PAGE,isSelectable:!1}}var n=e("vendor/knockout"),r=e("constants/cssClasses"),i=e("ui/viewModels/people/discoverAgentsPage");t.name=e("constants/components").people.DISCOVER_AGENTS_PAGE,t.template=e("text!views/people/discoverAgentsPage.html"),t.viewModel={createViewModel:s}}),define("ui/viewModels/people/name",["require","vendor/knockout","ui/viewModels/people/contact","ui/viewModels/people/contactBuilder"],function(e){function s(e){function r(){var e=i.replace(/\{importance\}/g,n.headerImportance());return e.replace("{displayName}",n.contact.displayName())}var n=this;n.contact=o(e),n.headerImportance=t.observable(4),n.heading=t.computed(r)}function o(e){return e instanceof n?e:e._isPartialPersonObject?e:r.build(e)}var t=e("vendor/knockout"),n=e("ui/viewModels/people/contact"),r=e("ui/viewModels/people/contactBuilder"),i="<h{importance}>{displayName}</h{importance}>";return s.prototype.dispose=function(){this.heading.dispose(),this.contact.dispose&&this.contact.dispose()},s}),define("text!views/people/name.html",[],function(){return'<span class="tile" data-bind="css: contact.statusClassName">\r\n    <span class="tileName" data-bind="html: heading"></span>\r\n</span>\r\n'}),define("ui/components/people/name",["require","exports","module","ui/viewModels/people/name","ui/viewModels/people/contact","constants/components","text!views/people/name.html"],function(e,t){function i(e){var t;if(e&&typeof e.person=="object")return t=new n(s(e)),e.headerImportance&&t.headerImportance(e.headerImportance),t;throw new Error('missing parameter: "person"')}function s(e){return e.person instanceof r?e.person.getPerson():e.person}var n=e("ui/viewModels/people/name"),r=e("ui/viewModels/people/contact");t.name=e("constants/components").people.NAME,t.template=e("text!views/people/name.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/people/contactList",["require","lodash-compat","swx-constants","vendor/knockout","swx-constants","swx-i18n","swx-cafe-application-instance","swx-enums","swx-service-locator-instance","ui/contextMenu/contextMenu","ui/contextMenu/items/all","ui/contextMenu/menuItemHelper","ui/telemetry/actions/actionSources","ui/viewModels/people/baseList","ui/telemetry/people/contactSearch"],function(e){function m(){function m(e){return{source:e,parent:h.searchItem.addressBook}}var e=this,t=p.prototype;this.listClass=r.observable(i.contactList.className.LOCAL),this.listTitle=r.observable(s.fetch({key:"message_text_contactTitleLocal"})),this.events={results:v.LOCAL_SEARCH_RESULTS,rendered:v.LOCAL_SEARCH_RESULTS_RENDERED},this.historyLoadOrigin=n.telemetry.historyLoadOrigin.CONTACT_SEARCH,this.searchItemI18nKey="accessibility_searchItem_oneToOne",p.call(e,u.searchScope.AddressBook),this.showListTitle(!0),e.search=function(r){e.contacts([]),t.search.call(e,r,e.events)},e.openConversation=function(i){var s=a.resolve(n.serviceLocator.PUBSUB),f=o.get().conversationsManager.getConversation(i.getPerson()),l={source:h.search.reset.openConversation};o.get().conversationsManager.conversations.add(f),s.publish(n.events.search.RESET,l),t.sendOpenConversationEvent.call(e,f),d.onContactSearchEnd({searchScope:u.searchScope.AddressBook,success:!0,resultCount:e.totalSearchResults,clickPosition:t.indexOfSelectedContactInSearchResults.call(e,i),source:h.search.reset.openConversation})},e.showContextMenu=function(t,r){var i={source:h.searchItem.addressBook},s=m(h.contextMenuItem.block),o=m(h.contextMenuItem.unblock),u=m(h.contextMenuItem.deleteItem),a=m(h.contextMenuItem.addContactToFavorites),p=m(h.contextMenuItem.removeContactFromFavorites),d=[];d.push(c.getConversationContextMenuItemGroup(t,n.telemetry.historyLoadOrigin.CONTACT_SEARCH,i)),d.push(new l.BlockContactMenuItem(t,s)),d.push(new l.UnblockContactMenuItem(t,o)),d.push(new l.DeleteContactMenuItem(t,u)),d.push(new l.AddContactToFavoritesMenuItem(t,a)),d.push(new l.RemoveContactFromFavoritesMenuItem(t,p)),c.sortMenuItems(d),f.show(d,r,i)}}var t=e("lodash-compat"),n=e("swx-constants").COMMON,r=e("vendor/knockout"),i=e("swx-constants").PEOPLE,s=e("swx-i18n").localization,o=e("swx-cafe-application-instance"),u=e("swx-enums"),a=e("swx-service-locator-instance").default,f=e("ui/contextMenu/contextMenu"),l=e("ui/contextMenu/items/all"),c=e("ui/contextMenu/menuItemHelper"),h=e("ui/telemetry/actions/actionSources"),p=e("ui/viewModels/people/baseList"),d=e("ui/telemetry/people/contactSearch"),v=n.events.search;return m.prototype=t.create(p.prototype,{constructor:m}),m}),define("ui/components/people/peopleSearch",["require","exports","module","ui/viewModels/people/contactList","constants/components","text!views/people/list.html"],function(e,t){function r(){var e=new n;return e.init(),e}var n=e("ui/viewModels/people/contactList");t.name=e("constants/components").people.PEOPLE_SEARCH,t.template=e("text!views/people/list.html"),t.viewModel={createViewModel:r}}),define("ui/components/people/index",["require","ui/components/people/avatar","ui/components/people/avatarDeprecated","ui/components/people/contactListMenuItem","ui/components/people/contactPicker","ui/components/people/contactProfile","ui/components/people/contactProfilePhoneNumber","ui/components/people/contactsPage","ui/components/people/directorySearch","ui/components/people/discoverAgentsPage","ui/components/people/name","ui/components/people/peopleSearch"],function(e){return[e("ui/components/people/avatar"),e("ui/components/people/avatarDeprecated"),e("ui/components/people/contactListMenuItem"),e("ui/components/people/contactPicker"),e("ui/components/people/contactProfile"),e("ui/components/people/contactProfilePhoneNumber"),e("ui/components/people/contactsPage"),e("ui/components/people/directorySearch"),e("ui/components/people/discoverAgentsPage"),e("ui/components/people/name"),e("ui/components/people/peopleSearch")]}),define("experience/components/people",["require","exports","module","ui/components/people/index","ui/components/registrar"],function(e,t){var n=e("ui/components/people/index"),r=e("ui/components/registrar");t.init=function(e){r.register(n),e()}}),define("services/telemetry/common/telemetry",["require","exports","module","services/telemetry/eventBus","services/telemetry/skypeData"],function(e,t){function i(e){return function(t){var n=e?e(t):t;r.push(n)}}var n=e("services/telemetry/eventBus"),r=e("services/telemetry/skypeData");t.instrumentEvent=function(e,t){n.get().subscribe(e,i(t))},t.instrumentAllEvents=function(e){Object.keys(e).forEach(function(n){t.instrumentEvent(n,e[n])})}}),define("services/telemetry/common/instrumentation",["require","lodash-compat","swx-cafe-application-instance","swx-enums"],function(e){function i(e){var t={};return Object.keys(e).forEach(function(n){e[n].forEach(function(e){t[e.eventName]=s(e.telemetryName,n,e.extensions,e.newContextIds)})}),t}function s(e,t,n,r){return function(i){var s={type:t,data:{name:e},contextIds:{},isPluginInstalled:u(),mePersonId:a()};return i=i||{},o(i,n,s.data),o(i,r,s.contextIds),s}}function o(e,n,r){function i(t){e[t]!==null&&e[t]!==undefined&&(r[t]=e[t])}if(!n)return;if(typeof n=="function")return t.merge(r,n(e));n.forEach(i)}function u(){return n.get().personsAndGroupsManager&&n.get().personsAndGroupsManager.mePerson?n.get().personsAndGroupsManager.mePerson.capabilities.audio.reason!==r.callingNotSupportedReasons.PluginNotInstalled:"unknown"}function a(){return n.get().personsAndGroupsManager&&n.get().personsAndGroupsManager.mePerson?n.get().personsAndGroupsManager.mePerson.id():"unknown"}var t=e("lodash-compat"),n=e("swx-cafe-application-instance"),r=e("swx-enums");return{create:function(e){return i(e)}}}),define("services/telemetry/calling.instrumentation.eventTypes",["require","swx-constants"],function(e){function n(e){return e.isGroupConversation()?"multiparty":"single"}function r(e){return e?"video":"audio"}var t=e("swx-constants").CALLING;return{Calling:[{eventName:t.EVENTS.START_CALL,telemetryName:"AttemptCall",extensions:function(e){return{source:e.source,conversationType:n(e.conversation),modality:r(e.isVideo)}}},{eventName:t.EVENTS.ANSWER,telemetryName:"AcceptCall",extensions:function(e){return{conversationType:n(e.conversation),modality:r(e.isVideo)}}},{eventName:t.EVENTS.REJECT,telemetryName:"RejectCall",extensions:function(e){return{conversationType:n(e.conversation),modality:r(e.isVideo)}}}],TrouterInit:[{eventName:t.EVENTS.INCOMING_INIT_ERROR,telemetryName:"IncomingInitialisationError"},{eventName:t.EVENTS.INCOMING_INIT_SUCCESS,telemetryName:"IncomingInitialisationSuccess",extensions:["durationInMs"]}]}}),define("text!views/calling/endCallButton.html",[],function(){return'<button data-bind="click: endCall, enable: isCallControlEnabled(), css: { disabled: !isCallControlEnabled() }, l10n_attr: { \'title\': \'callscreen_text_endCall\' }" class="btn small red circle endCall" type="button">\r\n    <span class="iconfont callEnd" data-bind="l10n: { \'key\': \'callscreen_text_endCall\' }"></span>\r\n</button>\r\n'}),define("ui/viewModels/calling/baseCallControlViewModel",["require","vendor/knockout","utils/common/cafeObservable","swx-enums"],function(e){function i(e,i){var o=n.newObservableProperty(e.selfParticipant.audio.state);this.isCallControlEnabled=t.computed(function(){var e=o();return s(e)&&(!i||i())}),this.isCallConnected=t.computed(function(){var e=o();return e===r.callConnectionState.Connected}),this.dispose=function(){o.dispose(),this.isCallControlEnabled.dispose(),this.isCallConnected.dispose()}}function s(e){return e===r.callConnectionState.Connecting||e===r.callConnectionState.Ringing||e===r.callConnectionState.EarlyMedia||e===r.callConnectionState.Connected}var t=e("vendor/knockout"),n=e("utils/common/cafeObservable"),r=e("swx-enums");return i}),define("ui/viewModels/calling/endCallControlViewModel",["require","ui/viewModels/calling/baseCallControlViewModel","ui/telemetry/actions/actionNames","swx-constants","swx-service-locator-instance","ui/calling/unansweredCallHandler"],function(e){function o(e,o){function u(){var e=i.resolve(r.serviceLocator.ACTION_TELEMETRY),t=o?n.audioVideo.endCall:n.audioVideo.timeline.endCall;e.recordAction(t)}t.call(this,e),this.endCall=function(){e.audioService.stop(),s.callHungUpByCaller(),u()}}var t=e("ui/viewModels/calling/baseCallControlViewModel"),n=e("ui/telemetry/actions/actionNames"),r=e("swx-constants").COMMON,i=e("swx-service-locator-instance").default,s=e("ui/calling/unansweredCallHandler");return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,{build:function(e,t){return new o(e,t)}}}),define("ui/controls/calling/endCallControl",["require","text!views/calling/endCallButton.html","vendor/knockout","swx-constants","ui/viewModels/calling/endCallControlViewModel"],function(e){var t=e("text!views/calling/endCallButton.html"),n=e("vendor/knockout"),r=e("swx-constants").CALLING,i=e("ui/viewModels/calling/endCallControlViewModel");return{name:r.CONTROLS.END_CALL_CONTROL,render:function(e,r){var s,o=document.createElement("div"),u=e.conversation;s=i.build(u),o.innerHTML=t,n.applyBindings(s,o),r(o.firstElementChild)}}}),define("text!views/calling/muteButton.html",[],function(){return'<button data-bind="click: toggleMicrophone, css: { disabled: !isMicrophoneButtonEnabled() }, attr: { title: microphoneStateText(), \'aria-disabled\': isMicrophoneButtonEnabled() }" class="btn small primary circle toggleMic" type="button">\r\n    <span class="iconfont microphoneOn" data-bind="css: { microphoneOff: !isMicrophoneOn() }, text: microphoneStateText"></span>\r\n</button>\r\n'}),define("ui/viewModels/calling/micControlViewModel",["require","ui/viewModels/calling/baseCallControlViewModel","vendor/knockout","utils/common/cafeObservable","swx-i18n","swx-cafe-application-instance","utils/common/eventHelper","ui/telemetry/actions/actionNames","swx-constants","swx-service-locator-instance"],function(e){function l(e,l){function v(){var e=f.resolve(a.serviceLocator.ACTION_TELEMETRY),t=l?u.audioVideo.toggleMute:u.audioVideo.timeline.toggleMute;e.recordAction(t)}var c=this,h=r.newObservableProperty(s.get().devicesManager.selectedMicrophone),p=r.newObservableProperty(e.selfParticipant.audio.isMuted),d=r.newObservableProperty(e.selfParticipant.audio.isMuted.set.enabled);t.call(c,e,d),c.isMicrophoneAvailable=n.computed(function(){return h()!==null}),c.isMicrophoneOn=n.computed(function(){return c.isMicrophoneAvailable()&&!p()}),c.microphoneStateText=n.computed(function(){return c.isMicrophoneOn()?i.fetch({key:"callscreen_text_microphoneOff"}):i.fetch({key:"callscreen_text_microphoneOn"})}),c.isMicrophoneButtonEnabled=n.computed(function(){return c.isMicrophoneAvailable()&&c.isCallControlEnabled()}),c.toggleMicrophone=function(t,n){c.isMicrophoneButtonEnabled()&&(e.selfParticipant.audio.isMuted(c.isMicrophoneOn()),v()),o.swallow(n)},c.dispose=function(){h.dispose(),c.microphoneStateText.dispose(),p.dispose()}}var t=e("ui/viewModels/calling/baseCallControlViewModel"),n=e("vendor/knockout"),r=e("utils/common/cafeObservable"),i=e("swx-i18n").localization,s=e("swx-cafe-application-instance"),o=e("utils/common/eventHelper"),u=e("ui/telemetry/actions/actionNames"),a=e("swx-constants").COMMON,f=e("swx-service-locator-instance").default;return l.prototype=Object.create(t.prototype),l.prototype.constructor=l,{build:function(e,t){return new l(e,t)}}}),define("ui/controls/calling/micControl",["require","text!views/calling/muteButton.html","vendor/knockout","swx-constants","ui/viewModels/calling/micControlViewModel"],function(e){var t=e("text!views/calling/muteButton.html"),n=e("vendor/knockout"),r=e("swx-constants").CALLING,i=e("ui/viewModels/calling/micControlViewModel");return{name:r.CONTROLS.MUTE_CONTROL,render:function(e,r){var s,o=document.createElement("div"),u=e.conversation;s=i.build(u),o.innerHTML=t,n.applyBindings(s,o),r(o.firstElementChild)}}}),define("ui/viewModels/calling/callScreenViewModel/callState",["require","swx-constants","swx-enums","vendor/knockout"],function(e){function s(e){function c(){s.state()===t.ENDING?o=window.setTimeout(h,i):window.clearTimeout(o)}function h(){s.state(t.ENDED)}function p(){s.state()!==t.ENDING&&s.state(t.CONNECTING)}function d(r,i){if(!i||i===n.callConnectionState.Disconnected)return;e.selfParticipant.audio.state.reason!==n.callDisconnectionReason.CallEscalated?(s.totalCallDuration=s.getCurrentDuration(),s.state(t.ENDING)):s.state(t.ENDED)}function v(){s.state()!==t.EARLY_MEDIA&&s.state()!==t.ENDING&&s.state(t.CALLING)}function m(){s.state()!==t.ENDING&&(v(),s.state(t.EARLY_MEDIA))}function g(){s.state()!==t.ENDING&&(l=e.audioService.callConnected(),s.state(t.CONNECTED),y())}function y(){x(f),x(a)}function b(e){function t(t,n){var r=e.audio.state.when(t,n);r.participant=e,f.push(r)}t(n.callConnectionState.Ringing,v),t(n.callConnectionState.EarlyMedia,m),t(n.callConnectionState.Disconnected,E)}function w(e){for(var t=f.length;t--;){var n=f[t];n.participant===e&&(f.splice(t,1),n.dispose())}E()}function E(){var r=e.participants().some(function(e){return e.audio.state()===n.callConnectionState.EarlyMedia});s.state()===t.EARLY_MEDIA&&!r&&s.state(t.CALLING)}function S(){u.push(s.state.subscribe(c),e.selfParticipant.audio.state.when(n.callConnectionState.Connecting,p),e.selfParticipant.audio.state.when(n.callConnectionState.Connected,g),e.selfParticipant.audio.state.when(n.callConnectionState.Disconnecting,d),e.selfParticipant.audio.state.when(n.callConnectionState.Disconnected,d)),e.selfParticipant.audio.state()!==n.callConnectionState.Connected&&a.push(e.participants.added(b)),a.push(e.participants.removed(w))}function x(e){e.forEach(function(e){e.dispose()}),e.length=0}var s=this,o,u=[],a=[],f=[],l=null;this.state=r.observable(t.CONNECTING),this.totalCallDuration=null,this.dispose=function(){x(u),y(),window.clearTimeout(o)},this.getCurrentDuration=function(){return l!==null?Date.now()-l:null},S()}var t=e("swx-constants").CALLING.CALL_STATES,n=e("swx-enums"),r=e("vendor/knockout"),i=3500;return{build:function(e){return new s(e)}}}),define("telemetry/calling/devicesTracker",["require","exports","module","swx-cafe-application-instance","swx-constants","swx-util-calling-stack","experience/settings","ui/telemetry/telemetryClient"],function(e,t){var n=e("swx-cafe-application-instance"),r=e("swx-constants").COMMON,i=e("swx-util-calling-stack"),s=e("experience/settings"),o=e("ui/telemetry/telemetryClient");t.reportCurrentDeviceCount=function(){var e=n.get().devicesManager;if(i.get().isInBrowserCallingSupported()){var t={camerasCount:e.cameras().length,speakersCount:e.speakers().length,microphonesCount:e.microphones().length};o.get().sendEvent(s.telemetry.uiTenantToken,r.telemetry.calling.DEVICES,t)}}}),define("utils/common/elementQueryHelper",["require","exports","module","browser/window"],function(e,t){var n=e("browser/window"),r={".swx .av":{"max-width":["680px","600px","420px","320px","305px"],"max-height":["600px","480px","420px"]}};t.initialiseSelectors=function(){n.elementQuery&&n.elementQuery(r)},t.refresh=function(){n.elementQuery&&n.elementQuery()}}),define("utils/common/focusRestrictor",["require","exports","module","lodash-compat"],function(e,t){function r(e,t){var r=this,i={};r.restrict=function(){var s,o=[],u='[tabindex="0"], a, button, input, select, textarea';s=Array.prototype.slice.call(document.querySelectorAll(u)),t&&t.forEach(function(e){var t=document.querySelector(e);t&&(o=Array.prototype.concat.call(o,Array.prototype.slice.call(t.querySelectorAll(u))))}),n.difference(s,o).forEach(function(t){var n=t.getAttribute("tabindex"),r="-100";!e.contains(t)&&n!==r&&(i[Object.keys(i).length]={element:t,tabIndex:n},t.setAttribute("tabindex",r))})},r.restore=function(){Object.keys(i).forEach(function(e){var t=i[e];t.tabIndex?t.element.setAttribute("tabindex",t.tabIndex):t.element.removeAttribute("tabindex")}),i={}}}var n=e("lodash-compat");t.build=function(t,n){return new r(t,n)}}),function(e,t){function st(e){return G.test(e+"")}function ot(){var e,t=[];return e=function(n,r){return t.push(n+=" ")>i.cacheLength&&delete e[t.shift()],e[n]=r}}function ut(e){return e[y]=!0,e}function at(e){var t=c.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ft(e,t,n,r){var i,s,o,u,a,f,h,v,m,E;(t?t.ownerDocument||t:b)!==c&&l(t),t=t||c,n=n||[];if(!e||typeof e!="string")return n;if((u=t.nodeType)!==1&&u!==9)return[];if(p&&!r){if(i=Y.exec(e))if(o=i[1]){if(u===9){s=t.getElementById(o);if(!s||!s.parentNode)return n;if(s.id===o)return n.push(s),n}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(o))&&g(t,s)&&s.id===o)return n.push(s),n}else{if(i[2])return P.apply(n,t.getElementsByTagName(e)),n;if((o=i[3])&&w.getElementsByClassName&&t.getElementsByClassName)return P.apply(n,t.getElementsByClassName(o)),n}if(w.qsa&&(!d||!d.test(e))){v=h=y,m=t,E=u===9&&e;if(u===1&&t.nodeName.toLowerCase()!=="object"){f=mt(e),(h=t.getAttribute("id"))?v=h.replace(tt,"\\$&"):t.setAttribute("id",v),v="[id='"+v+"'] ",a=f.length;while(a--)f[a]=v+gt(f[a]);m=V.test(e)&&t.parentNode||t,E=f.join(",")}if(E)try{return P.apply(n,m.querySelectorAll(E)),n}catch(S){}finally{h||t.removeAttribute("id")}}}return Nt(e.replace(z,"$1"),t,n,r)}function lt(e,t){var n=t&&e,r=n&&(~t.sourceIndex||A)-(~e.sourceIndex||A);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ct(e,n,r){var i;return r?t:(i=e.getAttributeNode(n))&&i.specified?i.value:e[n]===!0?n.toLowerCase():null}function ht(e,n,r){var i;return r?t:i=e.getAttribute(n,n.toLowerCase()==="type"?1:2)}function pt(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function dt(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function vt(e){return ut(function(t){return t=+t,ut(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function mt(e,t){var n,r,s,o,u,a,f,l=T[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=i.preFilter;while(u){if(!n||(r=W.exec(u)))r&&(u=u.slice(r[0].length)||u),a.push(s=[]);n=!1;if(r=X.exec(u))n=r.shift(),s.push({value:n,type:r[0].replace(z," ")}),u=u.slice(n.length);for(o in i.filter)(r=Q[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(n=r.shift(),s.push({value:n,type:o,matches:r}),u=u.slice(n.length));if(!n)break}return t?u.length:u?ft.error(e):T(e,a).slice(0)}function gt(e){var t=0,n=e.length,r="";for(;t<n;t++)r+=e[t].value;return r}function yt(e,t,n){var i=t.dir,s=n&&i==="parentNode",o=S++;return t.first?function(t,n,r){while(t=t[i])if(t.nodeType===1||s)return e(t,n,r)}:function(t,n,u){var a,f,l,c=E+" "+o;if(u){while(t=t[i])if(t.nodeType===1||s)if(e(t,n,u))return!0}else while(t=t[i])if(t.nodeType===1||s){l=t[y]||(t[y]={});if((f=l[i])&&f[0]===c){if((a=f[1])===!0||a===r)return a===!0}else{f=l[i]=[c],f[1]=e(t,n,u)||r;if(f[1]===!0)return!0}}}}function bt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function wt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function Et(e,t,n,r,i,s){return r&&!r[y]&&(r=Et(r)),i&&!i[y]&&(i=Et(i,s)),ut(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||Tt(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?wt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=wt(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?B.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=wt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):P.apply(o,g)})}function St(e){var t,n,r,s=e.length,o=i.relative[e[0].type],u=o||i.relative[" "],f=o?1:0,l=yt(function(e){return e===t},u,!0),c=yt(function(e){return B.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==a)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];for(;f<s;f++)if(n=i.relative[e[f].type])h=[yt(bt(h),n)];else{n=i.filter[e[f].type].apply(null,e[f].matches);if(n[y]){r=++f;for(;r<s;r++)if(i.relative[e[r].type])break;return Et(f>1&&bt(h),f>1&&gt(e.slice(0,f-1)).replace(z,"$1"),n,f<r&&St(e.slice(f,r)),r<s&&St(e=e.slice(r)),r<s&&gt(e))}h.push(n)}return bt(h)}function xt(e,t){var n=0,s=t.length>0,o=e.length>0,u=function(u,f,l,h,p){var d,v,m,g=[],y=0,b="0",w=u&&[],S=p!=null,x=a,T=u||o&&i.find.TAG("*",p&&f.parentNode||f),N=E+=x==null?1:Math.random()||.1;S&&(a=f!==c&&f,r=n);for(;(d=T[b])!=null;b++){if(o&&d){v=0;while(m=e[v++])if(m(d,f,l)){h.push(d);break}S&&(E=N,r=++n)}s&&((d=!m&&d)&&y--,u&&w.push(d))}y+=b;if(s&&b!==y){v=0;while(m=t[v++])m(w,g,f,l);if(u){if(y>0)while(b--)!w[b]&&!g[b]&&(g[b]=_.call(h));g=wt(g)}P.apply(h,g),S&&!u&&g.length>0&&y+t.length>1&&ft.uniqueSort(h)}return S&&(E=N,a=x),w};return s?ut(u):u}function Tt(e,t,n){var r=0,i=t.length;for(;r<i;r++)ft(e,t[r],n);return n}function Nt(e,t,n,r){var s,o,a,f,l,c=mt(e);if(!r&&c.length===1){o=c[0]=c[0].slice(0);if(o.length>2&&(a=o[0]).type==="ID"&&t.nodeType===9&&p&&i.relative[o[1].type]){t=(i.find.ID(a.matches[0].replace(nt,rt),t)||[])[0];if(!t)return n;e=e.slice(o.shift().value.length)}s=Q.needsContext.test(e)?0:o.length;while(s--){a=o[s];if(i.relative[f=a.type])break;if(l=i.find[f])if(r=l(a.matches[0].replace(nt,rt),V.test(o[0].type)&&t.parentNode||t)){o.splice(s,1),e=r.length&&gt(o);if(!e)return P.apply(n,r),n;break}}}return u(e,c)(r,t,!p,n,V.test(e)),n}function Ct(){}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y="sizzle"+ -(new Date),b=e.document,w={},E=0,S=0,x=ot(),T=ot(),N=ot(),C=!1,k=function(){return 0},L=typeof t,A=1<<31,O=w.hasOwnProperty,M=[],_=M.pop,D=M.push,P=M.push,H=M.slice,B=M.indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},j="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",F="[\\x20\\t\\r\\n\\f]",I="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",q=I.replace("w","w#"),R="\\["+F+"*("+I+")"+F+"*(?:([*^$|!~]?=)"+F+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+q+")|)|)"+F+"*\\]",U=":("+I+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+R.replace(3,8)+")*)|.*)\\)|)",z=new RegExp("^"+F+"+|((?:^|[^\\\\])(?:\\\\.)*)"+F+"+$","g"),W=new RegExp("^"+F+"*,"+F+"*"),X=new RegExp("^"+F+"*([>+~]|"+F+")"+F+"*"),V=new RegExp(F+"*[+~]"),$=new RegExp("="+F+"*([^\\]'\"]*)"+F+"*\\]","g"),J=new RegExp(U),K=new RegExp("^"+q+"$"),Q={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I.replace("w","w*")+")"),ATTR:new RegExp("^"+R),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+F+"*(even|odd|(([+-]|)(\\d*)n|)"+F+"*(?:([+-]|)"+F+"*(\\d+)|))"+F+"*\\)|)","i"),bool:new RegExp("^(?:"+j+")$","i"),needsContext:new RegExp("^"+F+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+F+"*((?:-\\d)?\\d*)"+F+"*\\)|)(?=[^-]|$)","i")},G=/^[^{]+\{\s*\[native \w/,Y=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Z=/^(?:input|select|textarea|button)$/i,et=/^h\d$/i,tt=/'|\\/g,nt=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,rt=function(e,t){var n="0x"+t-65536;return n!==n?t:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,n&1023|56320)};try{P.apply(M=H.call(b.childNodes),b.childNodes),M[b.childNodes.length].nodeType}catch(it){P={apply:M.length?function(e,t){D.apply(e,H.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}o=ft.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},l=ft.setDocument=function(e){var n=e?e.ownerDocument||e:b;if(n===c||n.nodeType!==9||!n.documentElement)return c;c=n,h=n.documentElement,p=!o(n),w.getElementsByTagName=at(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),w.attributes=at(function(e){return e.className="i",!e.getAttribute("className")}),w.getElementsByClassName=at(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",e.getElementsByClassName("i").length===2}),w.sortDetached=at(function(e){return e.compareDocumentPosition(c.createElement("div"))&1}),w.getById=at(function(e){return h.appendChild(e).id=y,!n.getElementsByName||!n.getElementsByName(y).length}),w.getById?(i.find.ID=function(e,t){if(typeof t.getElementById!==L&&p){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},i.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){return e.getAttribute("id")===t}}):(i.find.ID=function(e,n){if(typeof n.getElementById!==L&&p){var r=n.getElementById(e);return r?r.id===e||typeof r.getAttributeNode!==L&&r.getAttributeNode("id").value===e?[r]:t:[]}},i.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){var n=typeof e.getAttributeNode!==L&&e.getAttributeNode("id");return n&&n.value===t}}),i.find.TAG=w.getElementsByTagName?function(e,t){if(typeof t.getElementsByTagName!==L)return t.getElementsByTagName(e)}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if(e==="*"){while(n=s[i++])n.nodeType===1&&r.push(n);return r}return s},i.find.CLASS=w.getElementsByClassName&&function(e,t){if(typeof t.getElementsByClassName!==L&&p)return t.getElementsByClassName(e)},v=[],d=[];if(w.qsa=st(n.querySelectorAll))at(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||d.push("\\["+F+"*(?:value|"+j+")"),e.querySelectorAll(":checked").length||d.push(":checked")}),at(function(e){var t=c.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("t",""),e.querySelectorAll("[t^='']").length&&d.push("[*^$]="+F+"*(?:''|\"\")"),e.querySelectorAll(":enabled").length||d.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),d.push(",.*:")});return(w.matchesSelector=st(m=h.webkitMatchesSelector||h.mozMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&at(function(e){w.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),v.push("!=",U)}),d=d.length&&new RegExp(d.join("|")),v=v.length&&new RegExp(v.join("|")),g=st(h.contains)||h.compareDocumentPosition?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&r.nodeType===1&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&e.compareDocumentPosition(r)&16)}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},k=h.compareDocumentPosition?function(e,t){if(e===t)return C=!0,0;var r=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t);if(r)return r&1||!w.sortDetached&&t.compareDocumentPosition(e)===r?e===n||g(b,e)?-1:t===n||g(b,t)?1:f?B.call(f,e)-B.call(f,t):0:r&4?-1:1;return e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,s=e.parentNode,o=t.parentNode,u=[e],a=[t];if(e===t)return C=!0,0;if(!s||!o)return e===n?-1:t===n?1:s?-1:o?1:f?B.call(f,e)-B.call(f,t):0;if(s===o)return lt(e,t);r=e;while(r=r.parentNode)u.unshift(r);r=t;while(r=r.parentNode)a.unshift(r);while(u[i]===a[i])i++;return i?lt(u[i],a[i]):u[i]===b?-1:a[i]===b?1:0},c},ft.matches=function(e,t){return ft(e,null,null,t)},ft.matchesSelector=function(e,t){(e.ownerDocument||e)!==c&&l(e),t=t.replace($,"='$1']");if(w.matchesSelector&&p&&(!v||!v.test(t))&&(!d||!d.test(t)))try{var n=m.call(e,t);if(n||w.disconnectedMatch||e.document&&e.document.nodeType!==11)return n}catch(r){}return ft(t,c,null,[e]).length>0},ft.contains=function(e,t){return(e.ownerDocument||e)!==c&&l(e),g(e,t)},ft.attr=function(e,n){(e.ownerDocument||e)!==c&&l(e);var r=i.attrHandle[n.toLowerCase()],s=r&&(O.call(i.attrHandle,n.toLowerCase())?r(e,n,!p):t);return s===t?w.attributes||!p?e.getAttribute(n):(s=e.getAttributeNode(n))&&s.specified?s.value:null:s},ft.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ft.uniqueSort=function(e){var t,n=[],r=0,i=0;C=!w.detectDuplicates,f=!w.sortStable&&e.slice(0),e.sort(k);if(C){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)e.splice(n[r],1)}return e},s=ft.getText=function(e){var t,n="",r=0,i=e.nodeType;if(!i)for(;t=e[r];r++)n+=s(t);else if(i===1||i===9||i===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=s(e)}else if(i===3||i===4)return e.nodeValue;return n},i=ft.selectors={cacheLength:50,createPseudo:ut,match:Q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(nt,rt),e[3]=(e[4]||e[5]||"").replace(nt,rt),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1].slice(0,3)==="nth"?(e[3]||ft.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*(e[3]==="even"||e[3]==="odd")),e[5]=+(e[7]+e[8]||e[3]==="odd")):e[3]&&ft.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return Q.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&J.test(n)&&(t=mt(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(nt,rt).toLowerCase();return e==="*"?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=x[e+" "];return t||(t=new RegExp("(^|"+F+")"+e+"("+F+"|$)"))&&x(e,function(e){return t.test(typeof e.className=="string"&&e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=ft.attr(r,e);return i==null?t==="!=":t?(i+="",t==="="?i===n:t==="!="?i!==n:t==="^="?n&&i.indexOf(n)===0:t==="*="?n&&i.indexOf(n)>-1:t==="$="?n&&i.slice(-n.length)===n:t==="~="?(" "+i+" ").indexOf(n)>-1:t==="|="?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s=e.slice(0,3)!=="nth",o=e.slice(-4)!=="last",u=t==="of-type";return r===1&&i===0?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),b=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:c.nodeType===1)return!1;d=v=e==="only"&&!d&&"nextSibling"}return!0}d=[o?m.firstChild:m.lastChild];if(o&&b){l=m[y]||(m[y]={}),f=l[e]||[],p=f[0]===E&&f[1],h=f[0]===E&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(c.nodeType===1&&++h&&c===t){l[e]=[E,p,h];break}}else if(b&&(f=(t[y]||(t[y]={}))[e])&&f[0]===E)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:c.nodeType===1)&&++h){b&&((c[y]||(c[y]={}))[e]=[E,h]);if(c===t)break}return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||ft.error("unsupported pseudo: "+e);return r[y]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?ut(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=B.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:ut(function(e){var t=[],n=[],r=u(e.replace(z,"$1"));return r[y]?ut(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:ut(function(e){return function(t){return ft(e,t).length>0}}),contains:ut(function(e){return function(t){return(t.textContent||t.innerText||s(t)).indexOf(e)>-1}}),lang:ut(function(e){return K.test(e||"")||ft.error("unsupported lang: "+e),e=e.replace(nt,rt).toLowerCase(),function(t){var n;do if(n=p?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||n.indexOf(e+"-")===0;while((t=t.parentNode)&&t.nodeType===1);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===c.activeElement&&(!c.hasFocus||c.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||e.nodeType===3||e.nodeType===4)return!1;return!0},parent:function(e){return!i.pseudos.empty(e)},header:function(e){return et.test(e.nodeName)},input:function(e){return Z.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},text:function(e){var t;return e.nodeName.toLowerCase()==="input"&&e.type==="text"&&((t=e.getAttribute("type"))==null||t.toLowerCase()===e.type)},first:vt(function(){return[0]}),last:vt(function(e,t){return[t-1]}),eq:vt(function(e,t,n){return[n<0?n+t:n]}),even:vt(function(e,t){var n=0;for(;n<t;n+=2)e.push(n);return e}),odd:vt(function(e,t){var n=1;for(;n<t;n+=2)e.push(n);return e}),lt:vt(function(e,t,n){var r=n<0?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:vt(function(e,t,n){var r=n<0?n+t:n;for(;++r<t;)e.push(r);return e})}};for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[n]=pt(n);for(n in{submit:!0,reset:!0})i.pseudos[n]=dt(n);u=ft.compile=function(e,t){var n,r=[],i=[],s=N[e+" "];if(!s){t||(t=mt(e)),n=t.length;while(n--)s=St(t[n]),s[y]?r.push(s):i.push(s);s=N(e,xt(i,r))}return s},i.pseudos.nth=i.pseudos.eq,Ct.prototype=i.filters=i.pseudos,i.setFilters=new Ct,w.sortStable=y.split("").sort(k).join("")===y,l(),[0,0].sort(k),w.detectDuplicates=C,at(function(e){e.innerHTML="<a href='#'></a>";if(e.firstChild.getAttribute("href")!=="#"){var t="type|href|height|width".split("|"),n=t.length;while(n--)i.attrHandle[t[n]]=ht}}),at(function(e){if(e.getAttribute("disabled")!=null){var t=j.split("|"),n=t.length;while(n--)i.attrHandle[t[n]]=ct}}),e.Sizzle=ft}(window),define("sizzle",function(){}),function(e,t,n){var r=e.Sizzle||jQuery.find,i={},s=null,o=function(){if(t.styleSheets[0]){try{t.styleSheets[0].cssRules}catch(e){return}s=t.styleSheets[0].cssRules!==n?"cssRules":"rules"}},u=function(e,t,s,o,u){e=c(e);if(e!=""){var a;!o&&!u&&(a=/^([0-9]*.?[0-9]+)(px|em)$/.exec(s),a!=null&&(o=Number(a[1]),o+""!="NaN"&&(u=a[2]))),u&&(r.compile&&r.compile(e),i[e]===n&&(i[e]={}),i[e][t]===n&&(i[e][t]={}),i[e][t][s]=[o,u])}},a=function(e,t){var n,r,i;for(n in e)for(r in e[n])if(typeof e[n][r]=="string")u(n,r,e[n][r]);else if(typeof e[n][r]=="object")for(i=0;i<e[n][r].length;i++)u(n,r,e[n][r][i]);t==1&&m()},f=function(e){if(e){var t=/(\[(min\-width|max\-width|min\-height|max\-height)\~\=(\'|\")([0-9]*.?[0-9]+)(px|em)(\'|\")\])(\[(min\-width|max\-width|min\-height|max\-height)\~\=(\'|\")([0-9]*.?[0-9]+)(px|em)(\'|\")\])?/gi,r=e.split(","),i,s,o,a,f,l,c,h;for(i=0;i<r.length;i++){s=null,f=0,l=0;while(l==0||o!=null)o=t.exec(r[i]),o!=null&&(a=Number(o[4]),a+""!="NaN"&&(s==null&&(s=r[i].substring(f,o.index),c=r[i].substring(o.index+o[1].length),c.length>0&&(h=c.indexOf(" "),h!=0&&(h>0&&(c=c.substring(0,h)),c=c.replace(/(\[(min\-width|max\-width|min\-height|max\-height)\~\=(\'|\")([0-9]*.?[0-9]+)(px|em)(\'|\")\])/gi,""),s+=c))),u(s,o[2],o[4]+o[5],a,o[5])),o[7]===n||o[7]==""?(f=o.index+o[1].length,s=null):t.lastIndex=o.index+o[1].length),l++}}},l=function(e,t){s==null&&o();try{e[s].length}catch(n){return}if(e[s]&&e[s].length>0){var r=e.ownerNode||e.owningElement;if(t||r.getAttribute("data-elementquery-bypass")===null&&r.getAttribute("data-elementquery-processed")===null){var i,u,a;for(i=0;i<e[s].length;i++){a=e[s][i];if(a[s]&&a[s].length>0)for(u=0;u<a[s].length;u++)f(a[s][u].selectorText);else f(a.selectorText)}r.setAttribute("data-elementquery-processed","")}}},c=function(e){if(e==null)return"";var t="".trim;return t&&!t.call("﻿ ")?t.call(e):(e+"").replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},h=function(e,t){var n=e.getAttribute(t);return n?(" "+n+" ").replace(/[\t\r\n]/g," "):" "},p=function(e,t,n){if(e.nodeType===1){var r=c(n);if(r!=""){var i=h(e,t);i.indexOf(" "+r+" ")<0&&e.setAttribute(t,c(i+r))}}},d=function(e,t,n){if(e.nodeType===1){var r=c(n);if(r!=""){var i=h(e,t),s=!1;while(i.indexOf(" "+r+" ")>=0)i=i.replace(" "+r+" "," "),s=!0;s&&e.setAttribute(t,c(i))}}},v=function(){var e;for(e=0;e<t.styleSheets.length;e++)l(t.styleSheets[e]);m()},m=function(){var n,s,o,u,a,f,l;for(n in i){a=r(n);if(a.length>0)for(s=0;s<a.length;s++){f=a[s];for(o in i[n])for(u in i[n][o])l=i[n][o][u][0],i[n][o][u][1]=="em"&&(l*=e.getEmPixels?getEmPixels(f):16),o=="min-width"&&f.offsetWidth>=l||o=="max-width"&&f.offsetWidth<=l||o=="min-height"&&f.offsetHeight>=l||o=="max-height"&&f.offsetHeight<=l?p(f,o,u):d(f,o,u)}}if(!e.addEventListener&&e.attachEvent){var c=t.documentElement.className;t.documentElement.className=" "+c,t.documentElement.className=c}};e.elementQuery=function(e,t){e&&typeof e=="object"?e.cssRules||e.rules?(l(e,!0),t==1&&m()):a(e,t):!e&&!t&&m()},e.elementQuery.selectors=function(){var e={},t,r,s;for(t in i)for(r in i[t])for(s in i[t][r])e[t]===n&&(e[t]={}),e[t][r]===n&&(e[t][r]=[]),e[t][r][e[t][r].length]=s;return e},e.addEventListener?(e.addEventListener("resize",m,!1),e.addEventListener("DOMContentLoaded",v,!1),e.addEventListener("load",v,!1)):e.attachEvent&&(e.attachEvent("onresize",m),e.attachEvent("onload",v))}(this,document,undefined),function(e,t){var n="!important;",r="position:absolute"+n+"visibility:hidden"+n+"width:1em"+n+"font-size:1em"+n+"padding:0"+n;window.getEmPixels=function(i){var s;i||(i=s=e.createElement("body"),s.style.cssText="font-size:1em"+n,t.insertBefore(s,e.body));var o=e.createElement("i");o.style.cssText=r,i.appendChild(o);var u=o.clientWidth;return s?t.removeChild(s):i.removeChild(o),u}}(document,document.documentElement),define("elementQuery",["sizzle"],function(){}),define("ui/viewModels/calling/callScreenViewModel/callScreenViewModel",["require","lodash-compat","utils/common/cafeObservable","swx-constants","ui/viewModels/calling/callScreenViewModel/callState","swx-constants","swx-constants","telemetry/calling/devicesTracker","utils/common/eventMixin","utils/common/elementQueryHelper","swx-i18n","vendor/knockout","browser/window","swx-pubsub-instance","browser/document","swx-utils-common","utils/common/styleModeHelper","swx-browser-detect","utils/common/focusRestrictor","swx-service-locator-instance","ui/viewModels/chat/conversationTile","ui/viewModels/chat/conversationTopic","swx-constants","elementQuery"],function(e){function C(e,t){function j(e){switch(e){case s.CALL_SCREEN_DIALOG.NAME.ADD_PARTICIPANTS:a.isAddParticipantsVisible(!a.isAddParticipantsVisible());break;case s.CALL_SCREEN_DIALOG.NAME.TRANSFER_CALL:a.isTransferCallVisible(!a.isTransferCallVisible());break;case s.CALL_SCREEN_DIALOG.NAME.AV_SETTINGS:a.isAVSettingsVisible(!a.isAVSettingsVisible());break;case s.CALL_SCREEN_DIALOG.NAME.SCREEN_SHARING_PREVIEW:a.isScreenSharingPreviewVisible(!a.isScreenSharingPreviewVisible())}}function F(){a.dispatchEvent(o.events.callScreen.SIDEBAR_TOGGLED,a.DIRECTION.CHILD),f.refresh()}function I(){a.handleShowHideControls()}function q(){if(!a.isConversationVisible())return;a.addClassToShowSidebar()?(p.publish(N.HIDE_SIDEBAR),a.addClassToShowSidebar(!1),a.addClassToHideSidebar(!0)):(p.publish(N.SHOW_SIDEBAR),a.addClassToShowSidebar(!0),a.addClassToHideSidebar(!1)),U()}function R(e){a.isContainerFullScreen(e),f.refresh(),e&&C&&a.bottomValueInPixels(C)}function U(){h.setTimeout(f.refresh,1e3)}function z(e){switch(e){case r.CALLING:case r.EARLY_MEDIA:q(),f.refresh();break;case r.CONNECTED:u.reportCurrentDeviceCount(),a.isContainerFullScreen()&&a.isConversationVisible()&&h.setTimeout(function(){J(),$()},200),a.handleShowHideControls();break;case r.ENDING:a.isAddParticipantsVisible(!1),a.isTransferCallVisible(!1),a.isAVSettingsVisible(!1),a.isScreenSharingPreviewVisible(!1);break;case r.ENDED:K()}}function W(e){a.isConversationVisible(e),e&&f.refresh()}function X(e){e?$():J()}function V(e){e&&a.dispatchEvent(o.events.callScreen.FOCUS_CALL_SCREEN,null,a.DIRECTION.CHILD)}function $(){a.isFocusRestricted()||(P.restrict(),a.isFocusRestricted(!0))}function J(){a.isFocusRestricted()&&(P.restore(),a.isFocusRestricted(!1))}function K(){p.publish(N.SHOW_SIDEBAR),a.dispatchEvent(s.EVENTS.CALL_SCREEN_CLOSE,a.DIRECTION.PARENT),a.dispose()}function Q(){x=h.setTimeout(function(){x=null,Y()},T)}function G(){x&&(h.clearTimeout(x),x=null)}function Y(){_&&a.controlsVisible(!1)}function Z(){a.controlsVisible()||(a.controlsVisible(!0),a.dispatchEvent(o.events.callScreen.CONTROLS_VISIBLE,!0,a.DIRECTION.CHILD))}function et(){_=!1,a.handleShowHideControls()}function tt(){_=!0,a.handleShowHideControls()}function nt(){function t(){return e.autoCall&&e.autoCall()}function n(){return M()===r.CONNECTING&&!t()}function i(){return t()&&M()===r.CONNECTING||M()===r.CALLING||M()===r.EARLY_MEDIA}return{connecting:n(),calling:i(),connected:M()===r.CONNECTED,ended:M()===r.ENDED,ending:M()===r.ENDING,showControls:a.controlsVisible(),hideControls:!a.controlsVisible()}}function rt(e){return e<6e4?l.fetch({key:"callscreen_text_statusMessageScreenReaderEnding_less_than_minute"}):l.fetch({key:"callscreen_text_statusMessageScreenReaderEnding_minutes",count:Math.floor(e/1e3/60)})}function it(){if(m.get().isIntegratedProperty()&&g.getBrowserInfo().browserName===g.BROWSERS.SAFARI){var e=d.querySelector("#FlexPane");e&&(e.style.overflow=a.isContainerFullScreen()?"visible":"")}}var a=this,C,k,L,A,O=i.build(e),M=O.state,_=!0,D=b.resolve(S.FEATURE_FLAGS),P=y.build(t,[".swxContextMenu"]),H=E.build(e),B=w.build(e);a.callScreenStrings={CONNECTING:l.fetch({key:"callscreen_text_statusMessageConnecting"}),CALLING:l.fetch({key:"callscreen_text_statusMessageCalling"}),ENDED:l.fetch({key:"callscreen_text_terminationMessage"}),CONTROLS_ANIMATION_NAME:"av-controls-hide"},a.conversation=e,a.callingState=O,a.isContainerFullScreen=c.observable(!1),a.isFocusRestricted=c.observable(!1),a.bottomValueInPixels=c.observable("0%"),a.avatarUrl=n.newObservableProperty(e.avatarUrl),a.topic=H.topic,a.displayName=H.displayName,a.isPstn=B.isPstn,a.addClassToShowSidebar=c.observable(!0),a.addClassToHideSidebar=c.observable(!1),a.controlsVisible=c.observable(!0),a.isConversationVisible=c.observable(!0),a.isResizeVisible=D.isFeatureOn(s.FEATURE_FLAGS.RESIZE_CALL_AND_CHAT),a.footerButtonsWidth=c.observable(0),a.ADD_PARTICIPANTS_DIALOG_NAME=s.CALL_SCREEN_DIALOG.NAME.ADD_PARTICIPANTS,a.TRANSFER_CALL_DIALOG_NAME=s.CALL_SCREEN_DIALOG.NAME.TRANSFER_CALL,a.isAddParticipantsVisible=c.observable(!1),a.isTransferCallVisible=c.observable(!1),a.isAVSettingsVisible=c.observable(!1),a.isScreenSharingPreviewVisible=c.observable(!1),a.callStatusScreenReader=c.computed(function(){var t=M();if(t===r.ENDING)return rt(O.totalCallDuration);if(t===r.CONNECTING)return l.fetch({key:"callscreen_text_statusMessageScreenReaderConnecting",params:{contactName:e.topic()}})}),a.mainClass=c.computed(nt),a.handleAnimationEnded=function(e,t){var n=t&&t.originalEvent&&t.originalEvent.animationName&&t.originalEvent.animationName.search(a.callScreenStrings.CONTROLS_ANIMATION_NAME)>-1||t&&t.animationName&&t.animationName.search(a.callScreenStrings.CONTROLS_ANIMATION_NAME)>-1;n&&a.dispatchEvent(o.events.callScreen.CONTROLS_VISIBLE,!1,a.DIRECTION.CHILD)},a.init=function(){k=M.subscribe(z),L=a.isContainerFullScreen.subscribe(function(e){it(),p.publish(s.EVENTS.FULLSCREEN_CHANGED,e),a.isConversationVisible()&&(X(e),V(e))}),A=a.isConversationVisible.subscribe(function(e){a.isContainerFullScreen()&&(X(e),V(e))}),a.registerEvent(o.events.callScreen.TOGGLE_MODAL_DIALOG,j),a.registerEvent(o.events.callScreen.BUTTONS_WIDTH_CHANGED,a.footerButtonsWidth.bind(a)),a.registerEvent(o.events.callScreen.TOGGLE_NARROW_MENU,q),a.registerEvent(o.events.callScreen.BUTTON_FOCUSED,I),a.registerEvent(o.events.callScreen.MORE_ACTION_MENU_VISIBLE,et),a.registerEvent(o.events.callScreen.MORE_ACTION_MENU_HIDDEN,tt),a.registerEvent(o.events.callScreen.DIALPAD_VISIBLE,et),a.registerEvent(o.events.callScreen.DIALPAD_HIDDEN,tt),a.registerEvent(o.events.callScreen.HIDE_CHAT,v.execute.bind(null,f.refresh)),a.forwardEvent(o.events.callScreen.TOGGLE_FULLSCREEN,a.DIRECTION.CHILD,R),a.forwardEvent(o.events.navigation.FRAGMENT_SHOW,a.DIRECTION.CHILD,W.bind(a,!0)),a.forwardEvent(o.events.navigation.FRAGMENT_BEFORE_HIDE,a.DIRECTION.CHILD,W.bind(a,!1)),a.forwardEvent(o.events.callScreen.PINNED_PARTICIPANT_CHANGED,a.DIRECTION.CHILD),a.forwardEvent(o.events.callScreen.TOGGLE_GRID_VIEW,a.DIRECTION.CHILD),a.forwardEvent(o.events.callScreen.SHOW_CHAT),a.forwardEvent(o.events.callScreen.HIDE_CHAT),f.refresh(),p.subscribe(N.SIDEBAR_TRANSITION_ENDED,F)},a.handleShowHideControls=function(){M()===r.CONNECTED&&(G(),Z(),_&&Q())},a.handleMouseMove=a.handleShowHideControls,a.dispose=function(){X(!1),a.isContainerFullScreen(!1),k.dispose(),L.dispose(),A.dispose(),O.dispose(),a.mainClass.dispose(),a.callStatusScreenReader.dispose(),p.unsubscribe(N.SIDEBAR_TRANSITION_ENDED,F)}}var t=e("lodash-compat"),n=e("utils/common/cafeObservable"),r=e("swx-constants").CALLING.CALL_STATES,i=e("ui/viewModels/calling/callScreenViewModel/callState"),s=e("swx-constants").CALLING,o=e("swx-constants").COMMON,u=e("telemetry/calling/devicesTracker"),a=e("utils/common/eventMixin"),f=e("utils/common/elementQueryHelper"),l=e("swx-i18n").localization,c=e("vendor/knockout"),h=e("browser/window"),p=e("swx-pubsub-instance").default,d=e("browser/document"),v=e("swx-utils-common").async,m=e("utils/common/styleModeHelper"),g=e("swx-browser-detect").default,y=e("utils/common/focusRestrictor"),b=e("swx-service-locator-instance").default,w=e("ui/viewModels/chat/conversationTile"),E=e("ui/viewModels/chat/conversationTopic"),S=e("swx-constants").COMMON.serviceLocator;e("elementQuery");var x,T=2e3,N=o.events.narrowMode;return t.assign(C.prototype,a),{build:function(e,t){return new C(e,t)}}}),define("text!views/calling/callScreen.html",[],function(){return'<div class="av themeDark" data-bind="\r\n    css: { fullscreen: isContainerFullScreen(), isHidden: !isConversationVisible(), showSidebar: addClassToShowSidebar(), hideSidebar: addClassToHideSidebar() },\r\n    style: { bottom: bottomValueInPixels() },\r\n    event: {\r\n        mousemove: handleMouseMove,\r\n        webkitAnimationEnd: handleAnimationEnded, animationend: handleAnimationEnded, oanimationend: handleAnimationEnded, MSAnimationEnd: handleAnimationEnded\r\n    }">\r\n\r\n    <div class="main animate" data-bind="css: mainClass">\r\n\r\n        <div class="top">\r\n            <!-- ko component: { name: "swx-call-header", params: { state: callingState, conversation: conversation, callScreenStrings: callScreenStrings } } --><!-- /ko -->\r\n        </div>\r\n\r\n        <!-- ko if: isAddParticipantsVisible() -->\r\n        <swx-add-participants params="dialogName: ADD_PARTICIPANTS_DIALOG_NAME, conversation: conversation"></swx-add-participants>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: isTransferCallVisible() -->\r\n        <swx-add-participants params="dialogName: TRANSFER_CALL_DIALOG_NAME, conversation: conversation"></swx-add-participants>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: isAVSettingsVisible() -->\r\n        <swx-audio-video-settings-pane params="conversation: conversation"></swx-audio-video-settings-pane>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: isScreenSharingPreviewVisible() -->\r\n        <swx-screen-sharing-preview params="conversation: conversation"></swx-screen-sharing-preview>\r\n        <!-- /ko -->\r\n\r\n        <div class="table">\r\n            <div class="cell">\r\n                <swx-call-animation params="onAnimationIteration: function() {}, onAnimationEnded: function() {}, avatarUrl: $data.avatarUrl, isGroupConversation: conversation.isGroupConversation(), displayName: displayName, isPstn: isPstn"></swx-call-animation>\r\n                <swx-loading-animation class="spinner white"></swx-loading-animation>\r\n            </div>\r\n        </div>\r\n\r\n        <swx-call-content params="callState: callingState, conversation: conversation, footerButtonsWidth: footerButtonsWidth"></swx-call-content>\r\n\r\n\r\n        <div class="bottom">\r\n            <swx-call-footer params="conversation: conversation"></swx-call-footer>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="background">\r\n        <span class="connecting"></span>\r\n        <span class="connected"></span>\r\n    </div>\r\n\r\n    <div aria-live="polite" role="status" class="offScreen" data-bind="text: callStatusScreenReader"></div>\r\n</div>\r\n'}),define("ui/components/calling/callScreen",["require","exports","module","vendor/knockout","ui/viewModels/calling/callScreenViewModel/callScreenViewModel","constants/components","text!views/calling/callScreen.html"],function(e,t){function i(e,t){var i=r.build(e.conversation,t.element);return i.setContext(n.dataFor(t.element)),i.init(),i}var n=e("vendor/knockout"),r=e("ui/viewModels/calling/callScreenViewModel/callScreenViewModel");t.name=e("constants/components").calling.CALL_SCREEN,t.template=e("text!views/calling/callScreen.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/calling/callScreenViewModel/participantMenuViewModel",["require","lodash-compat","vendor/knockout","browser/dom","swx-enums","swx-constants","swx-constants","utils/common/eventMixin","swx-service-locator-instance","ui/contextMenu/contextMenu","ui/contextMenu/items/all","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","ui/viewModels/people/properties/displayNameText"],function(e){function d(e,t){function b(e){e||u.isContextMenuVisible(e),u.dispatchEvent(s.events.callScreen.PARTICIPANT_MENU_VISIBILITY_CHANGED,{layoutItemModel:v,isVisible:e},u.DIRECTION.PARENT)}function w(e,n){var r={source:h.callScreen.participantMenu},s=[];v.isChatable()&&s.push(new l.CallParticipantChatMenuItem(m.person)),v.isPinable()&&s.push(new l.CallParticipantPinMenuItem(m,v.isScreenSharing,v.isPinned())),v.isZoomable()&&s.push(new l.CallParticipantZoomMenuItem(v.isZoomedIn,v.isZoomable)),s.length&&(n&&(e.customClientOptions={offsetElement:v.isInRoster()?t:e.target,offset:v.isInRoster()?d:E(),position:i.contextMenuPosition.Top}),f.show(s,e,r),S(),u.isContextMenuVisible(!0))}function E(){var e=r.getElement(o.PARTICIPANT_MENU.ANIMATION_ELEMENT_SELECTOR,t);if(e){var n=window.getComputedStyle(e).getPropertyValue("animation-name");return n===o.PARTICIPANT_MENU.ANIMATION_NAME?o.PARTICIPANT_MENU.DEFAULT_OFFSET+o.PARTICIPANT_MENU.ANIMATION_OFFSET:o.PARTICIPANT_MENU.DEFAULT_OFFSET}return d}function S(){var e=a.resolve(s.serviceLocator.ACTION_TELEMETRY);e.recordAction(c.audioVideo.participantMenu.show)}function x(){u.isContextMenuVisible()&&f.hide()}var u=this,d=4,v=e.layoutItemModel,m=v.participant,g=p.build(m.person),y=[];u.displayName=n.computed(g.compute),u.isPillVisible=v.isParticipantPillVisible,u.isContextMenuVisible=n.observable(!1),u.init=function(){y.push(g),y.push(u.displayName),y.push(f.isVisible.subscribe(b)),y.push(v.isInRoster.subscribe(x)),u.registerEvent(s.events.callScreen.PARTICIPANT_ITEM_CONTEXT_MENU,function(e){e&&e.layoutItemModel===v&&w(e.event,!1)})},u.dispose=function(){x(),y.forEach(function(e){e.dispose()}),y=[]},u.onParticipantPillClick=function(e,t){u.isContextMenuVisible()?x():w(t,!0)},u.onFocus=function(){u.dispatchEvent(s.events.callScreen.PARTICIPANT_MENU_FOCUSED,!0,u.DIRECTION.PARENT)},u.onBlur=function(){u.dispatchEvent(s.events.callScreen.PARTICIPANT_MENU_FOCUSED,!1,u.DIRECTION.PARENT)}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("browser/dom"),i=e("swx-enums"),s=e("swx-constants").COMMON,o=e("swx-constants").CALLING,u=e("utils/common/eventMixin"),a=e("swx-service-locator-instance").default,f=e("ui/contextMenu/contextMenu"),l=e("ui/contextMenu/items/all"),c=e("ui/telemetry/actions/actionNames"),h=e("ui/telemetry/actions/actionSources"),p=e("ui/viewModels/people/properties/displayNameText");return t.assign(d.prototype,u),{build:function(e,t){return new d(e,t)}}}),define("text!views/calling/participantMenu.html",[],function(){return'<!-- ko if: isPillVisible -->\r\n<div class="participantMenuPill">\r\n    <div class="participantNameWrapper" data-bind="click: onParticipantPillClick">\r\n        <div class="participantName">\r\n            <span data-bind="text: displayName, attr: { \'aria-label\': displayName, \'title\': displayName }, event: { focus: onFocus, blur: onBlur }" tabindex="0"></span>\r\n        </div>\r\n        <div class="participantMenuButton">\r\n            <button data-bind="event: { focus: onFocus, blur: onBlur }" class="btn small circle transparent" type="button">\r\n                <span class="iconfont chevronDown" data-bind="css: { chevronUp: isContextMenuVisible() }"></span>\r\n            </button>\r\n        </div>\r\n    </div>\r\n</div>\r\n<!-- /ko -->\r\n'}),define("ui/components/calling/participantMenu",["require","exports","module","vendor/knockout","ui/viewModels/calling/callScreenViewModel/participantMenuViewModel","constants/components","text!views/calling/participantMenu.html"],function(e,t){function i(e,t){var i=r.build(e,t.element),s=n.dataFor(t.element);return i.setContext(s),i.init(),i}var n=e("vendor/knockout"),r=e("ui/viewModels/calling/callScreenViewModel/participantMenuViewModel");t.name=e("constants/components").calling.PARTICIPANT_MENU,t.template=e("text!views/calling/participantMenu.html"),t.viewModel={createViewModel:i}}),define("jsviews/calling/roster",["require","swx-constants","browser/window"],function(e){function s(e){var s,o;this.getRosterWidth=function(){return e.querySelector(t).offsetWidth+n},this.init=function(e){s=e,o=!1,i.addEventListener(r.events.browser.RESIZE,function(){o||s()})},this.dispose=function(){o=!0,i.removeEventListener(r.events.browser.RESIZE,s)}}var t=".participants",n=50,r=e("swx-constants").COMMON,i=e("browser/window");return{build:function(e){return new s(e)}}}),define("ui/viewModels/calling/callScreenViewModel/rosterViewModel",["require","lodash-compat","vendor/knockout","swx-constants","swx-enums","browser/window","utils/common/eventMixin","swx-utils-common","utils/common/scroll"],function(e){function f(e,t){function d(){u.execute(function(){o.dispatchEvent(r.events.callScreen.ROSTER_WIDTH_CHANGED,p.getRosterWidth(),o.DIRECTION.PARENT)})}function v(){o.layoutItemModels().forEach(function(e){e.appendParticipantComponentToNewContainer(o.rosterParticipantsContainer)}),d()}var o=this,f,l,c,h,p;o.layoutItemModels=e.layoutItemModels,o.selfLayoutItemModel=e.selfLayoutItemModel,o.isLocalVideoOn=o.selfLayoutItemModel.isVideoActive,o.conversation=e.conversation,o.rosterParticipantsContainer=n.observable(),o.init=function(e){p=e,p.init(d),f=a.build(t),f.init({horizontal:!0}),l=o.layoutItemModels.subscribe(v),c=o.selfLayoutItemModel.isVideoActive.subscribe(d),h=o.selfLayoutItemModel.participant.audio.state.when(i.callConnectionState.Connected,d)},o.dispose=function(){p.dispose(),f.dispose(),l.dispose(),c.dispose(),h.dispose(),s.removeEventListener(r.events.browser.RESIZE,d)}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-constants").COMMON,i=e("swx-enums"),s=e("browser/window"),o=e("utils/common/eventMixin"),u=e("swx-utils-common").async,a=e("utils/common/scroll");return t.assign(f.prototype,o),{build:function(e,t){return new f(e,t)}}}),define("text!views/calling/roster.html",[],function(){return'<div class="roster">\r\n    <div class="participants">\r\n\r\n        <div class="scrollWrapper">\r\n            <div class="others scrollViewport scrollViewportH"\r\n                data-bind="visible: layoutItemModels().length,\r\n                           overflowClass: { right: \'partially-hidden\' },\r\n                           css: {videoActive: isLocalVideoOn()},\r\n                           getElement: rosterParticipantsContainer"\r\n                tabindex="-1"></div>\r\n        </div>\r\n\r\n        <div class="participant-wrapper localPipPlaceholder" data-bind="css: selfLayoutItemModel.aspectRatioClasses"></div>\r\n\r\n    </div>\r\n</div>\r\n'}),define("ui/components/calling/roster",["require","exports","module","vendor/knockout","jsviews/calling/roster","ui/viewModels/calling/callScreenViewModel/rosterViewModel","constants/components","text!views/calling/roster.html"],function(e,t){function s(e,t){var s=t.element.getElementsByClassName("scrollWrapper")[0],o=i.build(e,s),u=n.dataFor(t.element),a=r.build(t.element);return o.setContext(u),o.init(a),o}var n=e("vendor/knockout"),r=e("jsviews/calling/roster"),i=e("ui/viewModels/calling/callScreenViewModel/rosterViewModel");t.name=e("constants/components").calling.ROSTER,t.template=e("text!views/calling/roster.html"),t.viewModel={createViewModel:s}}),define("text!views/calling/callAnimation.html",[],function(){return'<div class="animation" data-bind="event: { webkitAnimationIteration: onAnimationIteration, animationiteration: onAnimationIteration, oanimationiteration: onAnimationIteration, MSAnimationIteration: onAnimationIteration,\r\nwebkitAnimationEnd:onAnimationEnded, animationend:onAnimationEnded, oanimationend:onAnimationEnded, MSAnimationEnd:onAnimationEnded }">\r\n    <div class="radial one">\r\n        <span class="shape"></span>\r\n    </div>\r\n    <div class="radial two">\r\n        <span class="shape"></span>\r\n    </div>\r\n    <div class="radial three">\r\n        <span class="shape"></span>\r\n    </div>\r\n    <div class="circle small">\r\n        <div class="right">\r\n            <span class="shape"></span>\r\n        </div>\r\n        <div class="left">\r\n            <span class="shape"></span>\r\n        </div>\r\n    </div>\r\n    <div class="circle large inner">\r\n        <span class="shape"></span>\r\n    </div>\r\n    <div class="avatar">\r\n        <swx-avatar params="avatar: avatarUrl, isGroupAvatar: isGroupConversation, displayName: displayName, isPstn: isPstn, isFullSize: true"></swx-avatar>\r\n    </div>\r\n    <div class="circle large outer">\r\n        <span class="shape"></span>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/calling/callAnimation",["require","exports","module","constants/components","text!views/calling/callAnimation.html"],function(e,t){t.name=e("constants/components").calling.CALL_ANIMATION,t.template=e("text!views/calling/callAnimation.html")}),define("text!views/calling/endCall.html",[],function(){return'<div class="avatar">\r\n    <swx-avatar params="avatar: avatarUrl, isGroupAvatar: isGroupConversation, displayName: displayName, isPstn: isPstn, isFullSize: true, size: 330"></swx-avatar>\r\n</div>\r\n<div class="text summary">\r\n    <p class="fontSize-h2" data-bind="l10n: {key: \'callscreen_text_terminationMessage\'}"></p>\r\n</div>\r\n<div class="text duration">\r\n    <p class="fontSize-h1 large" data-bind="text: duration"></p>\r\n</div>\r\n'}),define("ui/components/calling/endCall",["require","exports","module","constants/components","text!views/calling/endCall.html"],function(e,t){t.name=e("constants/components").calling.END_CALL,t.template=e("text!views/calling/endCall.html")}),define("jsviews/calling/callScreenContent",["require","browser/window","swx-constants"],function(e){function i(e){var i;this.getContentWidth=function(){return e.querySelector(r).offsetWidth},this.init=function(e){i=e,t.addEventListener(n.events.browser.RESIZE,i)},this.dispose=function(){t.removeEventListener(n.events.browser.RESIZE,i)}}var t=e("browser/window"),n=e("swx-constants").COMMON,r=".stage";return{build:function(e){return new i(e)}}}),define("services/calling/participantManager",["require","swx-enums","swx-constants"],function(e){function r(e){function l(){return e.selfParticipant.audio.state()===t.callConnectionState.Connected}function c(e){return e===t.callConnectionState.Connecting||e===t.callConnectionState.Ringing||e===t.callConnectionState.Connected}function h(e,n){return n===t.callConnectionState.Disconnecting&&e===t.callConnectionState.Disconnected}function p(e){if(!a[e.person.id()]){var t=window.setTimeout(m.bind(r,e),n.PARTICIPANT_REMOVE_FROM_CALLSCREEN_TIMEOUT);a[e.person.id()]=t}}function d(e){var t=e.person.id();a[t]&&(window.clearTimeout(a[t]),delete a[t]);if(s[t])return;s[t]=!0,o(e)}function v(e){function t(t,n,r){if(r===t)return;l()&&(d(e),p(e)),c(t)&&d(e),h(t,r)&&p(e)}e.person.id.get().then(function(){f[e.person.id()]=function(){e.audio.state.changed.off(t)},e.audio.state.changed(t)})}function m(e){var t=e.person.id();delete a[t],delete s[t],u(e)}function g(e){var t=e.person.id();f[t]&&(f[t](),delete f[t]),a[t]&&(window.clearTimeout(a[t]),delete a[t]),delete s[t],u(e)}var r=this,i=function(){},s={},o=i,u=i,a={},f={};return r.onParticipantAddedToCall=function(e){o=e},r.onParticipantRemovedFromCall=function(e){u=e},r.dispose=function(){Object.keys(f).forEach(function(e){f[e]()}),f={},Object.keys(a).forEach(function(e){window.clearTimeout(a[e])}),a={},e.participants.added.off(v),e.participants.removed.off(g),o=i,u=i},r.init=function(){e.participants.added(v),e.participants.removed(g)},r}var t=e("swx-enums"),n=e("swx-constants").CALLING;return{build:function(e){return new r(e)}}}),define("services/calling/screenSharingHandler",["require","swx-enums"],function(e){function n(e){function a(e){return e===t.mediaStreamState.Started||e===t.mediaStreamState.Active||e===t.mediaStreamState.Inactive}function f(e,n){var r=a(n);return r&&e===t.mediaStreamState.Stopped}function l(e){var t=e.person.id();if(o[t])return;o[t]=!0,i(e)}function c(e){var t=e.person.id();delete o[t],s(e)}function h(e){function t(t,n,r){a(t)&&l(e),f(t,r)&&c(e)}u[e.person.id()]=function(){e.screenSharing.stream.state.changed.off(t)},e.screenSharing.stream.state.changed(t)}function p(e){var t=e.person.id();u[t]&&(u[t](),delete u[t]),o[t]&&(s(e),delete o[t])}var n=this,r=function(){},i=r,s=r,o={},u={};n.init=function(){e.participants.added(h),e.participants.removed(p)},n.onScreenSharingStarted=function(e){i=e||r},n.onScreenSharingStopped=function(e){s=e||r},n.dispose=function(){Object.keys(u).forEach(function(e){u[e]()}),u={},e.participants.added.off(h),e.participants.removed.off(p),i=r,s=r}}var t=e("swx-enums");return{build:function(e){return new n(e)}}}),define("ui/viewModels/calling/callScreenViewModel/callScreenLayoutHelper",["require","exports","module","lodash-compat","swx-browser-detect","swx-enums","utils/common/rtlChecker"],function(e,t){function w(e,n,r,i,s){function g(e){return u.itemToPin=e||null,u.itemsForStage=e?[e]:[],u.itemsForRoster=n.filter(function(t){return t!==e}),u.grid=E(y(1,1),u.itemsForStage,f,l),u}function y(e,t){return e>o?null:m[Math.min(e,t)]}var u={self:i,localPipInRoster:!0},f=e&&e.width||0,l=e&&e.height||0;u.stageWidth=f,u.stageHeight=l;if(r)return g(r);var c=y(n.length,s);if(!c)return g(n[0]);var h=n.slice(0,s),p=n.slice(s,n.length),d=E(c,h,f,l);if(t.getObscuredByLocalPipPercentage(d,i,f,l)>a){c=y(n.length+1,s+1);if(!c)return g(n[0]);var v=n.slice(0,s);v.push(i),u.localPipInRoster=!1,d=E(c,v,f,l)}return u.itemToPin=null,u.itemsForStage=h,u.itemsForRoster=p,u.grid=d,u}function E(e,t,n,r){var i;return e.forEach(function(e){var s=S(e,t,n,r);if(!i||i.emptySpace>s.emptySpace)i=s}),i}function S(e,t,n,r){function o(e,t,n){n||(n=[]);for(var r=0;r<e.length;r++){n.push(e[r]);var i=e.slice(0,r);i.push.apply(i,e.slice(r+1)),o(i,t,n),n.pop()}e.length||t(n)}var i,s;return o(t,function(t){var o=x(e,t,n,r);if(!i||s>o)i=t.slice(0),s=o}),{cells:e,orderedParticipantItems:i,emptySpace:s}}function x(e,n,r,i){var s=0;return n.forEach(function(n,o){var u,a,f,l=e[o],c=l.width*r/100,h=l.height*i/100;n.isVideoActive()&&(u=n.isScreenSharing?n.participant.screenSharing.stream:n.participant.video.channels(0).stream,a=u.width(),f=u.height());if(n.isVideoActive()&&c&&h&&a&&f){if(!n.isZoomable()||!t.canAutoZoom(a,f,c,h))s+=t.getEmptySpaceAroundVideo(a,f,c,h)}else s+=c*h}),s}function T(){return r.supportsCssProperty(r.CSS_PROPERTIES.OBJECT_FIT)||r.getBrowserInfo().browserName!==r.BROWSERS.EDGE}var n=e("lodash-compat"),r=e("swx-browser-detect").default,i=e("swx-enums"),s=e("utils/common/rtlChecker"),o=6,u=40,a=30,f=5,l=["#1f1f1f","#2b2b2b","#252525","#313131"],c="#000",h=1,p=2,d=4,v=p|d,m={1:[[{left:0,top:0,width:100,height:100,atTheBottom:v}]],2:[[{left:0,top:0,width:50,height:100,atTheBottom:d},{left:50,top:0,width:50,height:100,atTheBottom:p}],[{left:0,top:0,width:100,height:50},{left:0,top:50,width:100,height:50,atTheBottom:v}]],3:[[{left:0,top:0,width:50,height:50},{left:0,top:50,width:50,height:50,atTheBottom:d},{left:50,top:0,width:50,height:100,atTheBottom:p}],[{left:0,top:0,width:100,height:50},{left:0,top:50,width:50,height:50,atTheBottom:d},{left:50,top:50,width:50,height:50,atTheBottom:p}],[{left:0,top:0,width:100,height:100/3},{left:0,top:100/3,width:100,height:100/3},{left:0,top:200/3,width:100,height:100/3,atTheBottom:v}],[{left:0,top:0,width:100/3,height:100,atTheBottom:d},{left:100/3,top:0,width:100/3,height:100,atTheBottom:h},{left:200/3,top:0,width:100/3,height:100,atTheBottom:p}]],4:[[{left:0,top:0,width:50,height:50},{left:50,top:0,width:50,height:50},{left:0,top:50,width:50,height:50,atTheBottom:d},{left:50,top:50,width:50,height:50,atTheBottom:p}],[{left:0,top:0,width:100/3,height:100,atTheBottom:d},{left:100/3,top:0,width:100/3,height:50},{left:100/3,top:50,width:100/3,height:50,atTheBottom:h},{left:200/3,top:0,width:100/3,height:100,atTheBottom:p}],[{left:0,top:0,width:50,height:100,atTheBottom:d},{left:50,top:0,width:50,height:100/3},{left:50,top:100/3,width:50,height:100/3},{left:50,top:200/3,width:50,height:100/3,atTheBottom:p}],[{left:0,top:0,width:100,height:25},{left:0,top:25,width:100,height:25},{left:0,top:50,width:100,height:25},{left:0,top:75,width:100,height:25,atTheBottom:v}],[{left:0,top:0,width:25,height:100,atTheBottom:d},{left:25,top:0,width:25,height:100,atTheBottom:h},{left:50,top:0,width:25,height:100,atTheBottom:h},{left:75,top:0,width:25,height:100,atTheBottom:p}],[{left:0,top:0,width:100,height:50},{left:0,top:50,width:100/3,height:50,atTheBottom:d},{left:100/3,top:50,width:100/3,height:50,atTheBottom:h},{left:200/3,top:50,width:100/3,height:50,atTheBottom:p}]],5:[[{left:0,top:0,width:100/3,height:50},{left:0,top:50,width:50,height:50,atTheBottom:d},{left:100/3,top:0,width:100/3,height:50},{left:50,top:50,width:50,height:50,atTheBottom:p},{left:200/3,top:0,width:100/3,height:50}],[{left:0,top:0,width:50,height:100/3},{left:0,top:100/3,width:50,height:100/3},{left:0,top:200/3,width:50,height:100/3,atTheBottom:d},{left:50,top:0,width:50,height:50},{left:50,top:50,width:50,height:50,atTheBottom:p}],[{left:0,top:0,width:50,height:100/3},{left:50,top:0,width:50,height:100/3},{left:0,top:100/3,width:100,height:100/3},{left:0,top:200/3,width:50,height:100/3,atTheBottom:d},{left:50,top:200/3,width:50,height:100/3,atTheBottom:p}],[{left:0,top:0,width:100/3,height:50},{left:0,top:50,width:100/3,height:50,atTheBottom:d},{left:100/3,top:0,width:100/3,height:100,atTheBottom:h},{left:200/3,top:0,width:100/3,height:50},{left:200/3,top:50,width:100/3,height:50,atTheBottom:p}]],6:[[{left:0,top:0,width:100/3,height:50},{left:0,top:50,width:100/3,height:50,atTheBottom:d},{left:100/3,top:0,width:100/3,height:50},{left:100/3,top:50,width:100/3,height:50,atTheBottom:h},{left:200/3,top:0,width:100/3,height:50},{left:200/3,top:50,width:100/3,height:50,atTheBottom:p}],[{left:0,top:0,width:50,height:100/3},{left:50,top:0,width:50,height:100/3},{left:0,top:100/3,width:50,height:100/3},{left:50,top:100/3,width:50,height:100/3},{left:0,top:200/3,width:50,height:100/3,atTheBottom:d},{left:50,top:200/3,width:50,height:100/3,atTheBottom:p}]]},g,y=[],b;t.MAX_STAGE_SIZE=o,t.GRIDS=m,t.getGridConfiguration=function(r){function a(){return i&&b&&i.localPipInRoster===b.localPipInRoster&&i.itemsForStage&&b.itemsForStage&&i.itemsForRoster&&b.itemsForRoster&&n.isEqual(i.itemsForStage,b.itemsForStage)&&n.isEqual(i.itemsForRoster,b.itemsForRoster)}var i=w(r.stageDimensions,r.items,r.pinnedItem,r.selfParticipantLayoutItem,r.maxVideos||o);if(!t.isInActiveSpeakerMode(r.conversation)&&a()){var s=b.grid,u=x(s.cells,s.orderedParticipantItems,i.stageWidth,i.stageHeight);if(100*Math.abs(u-i.grid.emptySpace)/u<f)return b.stageWidth=i.stageWidth,b.stageHeight=i.stageHeight,b}return b=i,i},t.arrangeGridItems=function(n,r){if(!n||!n.grid||!n.stageWidth||!n.stageHeight)return;var i=n.grid.cells,s=t.getSmallestLayoutItemDimension(i,n.stageWidth,n.stageHeight),o=n.self;s<210?r(s>110?"stage-avatar_size_100":"stage-avatar_size_50"):r(""),n.localPipInRoster!==o.isInRoster()&&(o.isInRoster(n.localPipInRoster),n.localPipInRoster&&(o.isZoomedIn(!1),o.positionInGrid(""),o.isParticipantAtTheBottom(!1))),n.grid.orderedParticipantItems.forEach(function(e,t){var n=i[t];e.isParticipantAtTheBottom(!!n.atTheBottom),e.positionInGrid("left: "+n.left.toFixed(8)+"%; "+"top: "+n.top.toFixed(8)+"%; "+"width: "+n.width.toFixed(8)+"%; "+"height: "+n.height.toFixed(8)+"%; "+"display: block; "+"background-color: "+(e.isSelfParticipant?c:l[t%l.length]))})},t.calculateVideoStyles=function(t,n,r,i,s,o){var u,a,f,l={};u=r/t,a=i/n;if(s&&!T()&&!o)u>a?(f=(n*u/i-1)/2*100,f&&(l.height=100+f+f,l.top=-f)):(f=(t*a/r-1)/2*100,f&&(l.width=100+f+f,l.left=-f));else if(!s||o)u>a?(f=(1-i/(n*u))/2*100,f&&(l.width=100-f-f,l.left=f)):(f=(1-r/(t*a))/2*100,f&&(l.height=100-f-f,l.top=f));var c=[];return Object.keys(l).forEach(function(e){c.push(e+": "+l[e].toFixed(8)+"%")}),c.join("; ")},t.canAutoZoom=function(n,r,i,s){return t.getCroppedVideoPercentage(n,r,i,s)<=u},t.executeInAnimationFrame=function(t){return function(){y.push({cb:t,args:arguments});if(g)return;g=window.requestAnimationFrame(function(){g=null;var e=[];for(var t=y.length;t--;){var n=y[t];n.cb.__processed||(e.unshift(n),n.cb.__processed=!0)}y=[],e.forEach(function(e){e.cb.apply(null,e.args),delete e.cb.__processed})})}},t.getEmptySpaceAroundVideo=function(t,n,r,i){var s=t/r,o=n/i,u,a;return s>o?(u=r,a=n/s):(u=t/o,a=i),r*i-u*a},t.getCroppedVideoPercentage=function(t,n,r,i){var s=r/t,o=i/n,u,a;return s>o?(u=r,a=i+i*(n*s/i-1)):(u=r+r*(t*o/r-1),a=i),100-r*i*100/(u*a)},t.getObscuredByLocalPipPercentage=function(t,n,r,i){if(!n.isVideoActive())return 0;var o,u,a=s.isRtl()?d:p;t.cells.some(function(e,t){return e.atTheBottom&&e.atTheBottom&a?(o=t,!0):!1}),u=t.orderedParticipantItems[o];if(!u.isVideoActive())return 0;n._rosterNode||(n._rosterNode=document.querySelector(".call-roster"));if(!n._rosterNode)return 0;var f=n.participant.video.channels(0).stream,l=t.cells[o],c=l.width*r/100,h=l.height*i/100,v=(f.width()/f.height()).toFixed(1)==="1.8"?16/9:4/3,m=n._rosterNode.offsetHeight,g=m*v;return g*m*100/(c*h)},t.getSmallestLayoutItemDimension=function(t,n,r){return t.reduce(function(e,t){return Math.floor(Math.min(e,n*t.width/100,r*t.height/100))},Math.floor(Math.min(n,r)))},t.isInActiveSpeakerMode=function(t){return t.videoService.videoMode()===i.videoMode.ActiveSpeaker&&t.isGroupConversation()}}),define("ui/viewModels/calling/callScreenViewModel/participantViewModel",["require","exports","module","lodash-compat","ui/telemetry/actions/actionNames","swx-constants","swx-util-calling-stack","swx-constants","swx-enums","utils/common/eventMixin","swx-constants","vendor/knockout","ui/modelHelpers/personHelper","swx-service-locator-instance","ui/viewModels/calling/callScreenViewModel/callScreenLayoutHelper"],function(e,t){function g(e){function _(){y.forEach(function(e){e.dispose&&e.dispose()}),y.length=0}function D(e){!A.isScreenSharing&&A.isGroupConversation()&&b&&X(b,!!e)}function P(e){e&&A.isZoomedIn()&&A.isZoomedIn(!1)}function H(){var e=t.videoElement(),n=t.participantElement(),r;A.videoIsAllowed()&&e&&n&&a&&a.width()&&a.height()&&(r=p.calculateVideoStyles(a.width(),a.height(),n.offsetWidth,n.offsetHeight,A.isZoomedIn(),A.isScreenSharing),r!==N&&(N=r,e.style.cssText=N))}function B(){A.isVideoAvailable(g()!==u.mediaStreamState.Stopped),A.videoIsAllowed()&&(k(t.videoElement()),L()),t.dispatchEvent(o.events.callScreen.VIDEO_STATE_CHANGED,null,t.DIRECTION.PARENT)}function j(e){k(e?t.videoElement():null)}function F(e){var n=e===u.callConnectionState.Connecting||e===u.callConnectionState.Ringing,r=e===u.callConnectionState.Disconnecting||e===u.callConnectionState.Disconnected;t.isConnecting(n),t.isDisconnecting(r)}function I(e){e.audio.isSpeaking.changed(t.isSpeaking),e.audio.isMuted.changed(t.isMuted),e.audio.state.changed(F),e.video.channels.added($),e.video.channels.removed(J),A.isScreenSharing&&K(e.screenSharing.stream),y.push(t.videoElement.subscribe(k))}function q(e){!e||(e.audio.state.changed.off(F),e.video.channels.added.off($),e.video.channels.removed.off(J),e.audio.isSpeaking.changed.off(t.isSpeaking),e.audio.isMuted.changed.off(t.isMuted),a&&(a.state.changed.off(g),Z()))}function R(e){t.isParticipantMenuVisible(e)}function U(e){t.isParticipantMenuFocused(e)}function z(e,n,r){e===!0&&r===!1&&!!t.participant()&&!A.isScreenSharing&&!A.isSelfParticipant&&b&&V(b)}function W(e,t){if(!e.isStarted.set.enabled())return;t?(A._dfdStopVideo?A._dfdStartVideo=A._dfdStopVideo.then(function(){return e.isStarted.set(!0)}):A._dfdStartVideo||(A._dfdStartVideo=e.isStarted.set(!0)),A._dfdStartVideo.finally(function(){A._dfdStartVideo=null})):(A._dfdStartVideo?A._dfdStopVideo=A._dfdStartVideo.then(function(){return e.isStarted.set(!1)}):A._dfdStopVideo||(A._dfdStopVideo=e.isStarted.set(!1)),A._dfdStopVideo.finally(function(){A._dfdStopVideo=null}))}function X(e,t){var n=A._dfdSetContainer||A._dfdRemoveContainer;n?n.then(function(){W(e,t)}):W(e,t)}function V(e){var t=e.isVideoOn.subscribe(),n=e.isVideoOn.changed(function(t){t&&A.videoIsAllowed()?S?X(e,!0):x=!0:(X(e,!1),x=!1)});y.push(t),y.push(n)}function $(e){A.isScreenSharing||(b=e,A.isSelfParticipant||V(e),K(b.stream))}function J(){t.dispose()}function K(e){a=e,k(t.videoElement()),Y(a),a.state.changed(g)}function Q(e){if(!a)return;var t=e||null;t?(A._dfdRemoveContainer?A._dfdSetContainer=A._dfdRemoveContainer.then(function(){return a.source.sink.container.set(t)}):A._dfdSetContainer||(A._dfdSetContainer=a.source.sink.container.set(t)),A._dfdSetContainer.finally(function(){S=!0,A._dfdSetContainer=null,x&&(X(b,A.videoIsAllowed()),x=!1)})):(A._dfdSetContainer?A._dfdRemoveContainer=A._dfdSetContainer.then(function(){return a.source.sink.container.set(null)}):A._dfdRemoveContainer||(A._dfdRemoveContainer=a.source.sink.container.set(null)),A._dfdRemoveContainer.finally(function(){S=!1,A._dfdRemoveContainer=null}))}function G(e){var t=A._dfdStartVideo||A._dfdStopVideo;t?t.then(function(){Q(e)}):Q(e)}function Y(e){var t=p.executeInAnimationFrame(function(){tt(e)});w=e.width.changed(t),E=e.height.changed(t)}function Z(){w&&w.dispose(),E&&E.dispose()}function et(e){switch(e){case"1.8":n(i.CLASSES.ASPECT_RATIO_16BY9);break;default:n(i.CLASSES.ASPECT_RATIO_4BY3)}}function tt(e){if(e.width()&&e.height()){var n=(e.width()/e.height()).toFixed(1);et(n),T!==n&&(T=n,L(),t.dispatchEvent(o.events.callScreen.VIDEO_STATE_CHANGED,null,t.DIRECTION.PARENT))}}function nt(){a&&t.participantElement()&&a.width()&&a.height()&&t.isVideoActive()&&(A.isZoomedIn(p.canAutoZoom(a.width(),a.height(),t.participantElement().offsetWidth,t.participantElement().offsetHeight)),C())}function rt(e){return e.keyCode||e.which}function it(){O&&(window.clearTimeout(O),O=null),nt(),t.inTransition(!1)}function st(){var e=t.videoElement();e&&(M&&window.clearTimeout(M),M=window.setTimeout(function(){M=null,ot()},v),e.classList.add(m),C())}function ot(){var e=t.videoElement();e&&(M&&(window.clearTimeout(M),M=null),e.classList.remove(m),H())}var t=this,n=l.observable(i.CLASSES.ASPECT_RATIO_1BY1),a,g=l.observable(),y=[],b,w,E,S,x,T,N,C=p.executeInAnimationFrame(H),k=p.executeInAnimationFrame(G),L=p.executeInAnimationFrame(nt),A=e.layoutItemModel,O,M;t.layoutItemModel=e.layoutItemModel,t.participant=l.observable(),t.participantElement=l.observable(),t.videoElement=l.observable(),t.isSpeaking=l.observable(!1),t.isMuted=l.observable(!1),t.isFocused=l.observable(),t.isParticipantMenuVisible=l.observable(!1),t.isParticipantMenuFocused=l.observable(!1),t.isPstn=!1,t.inTransition=l.observable(!1),t.avatarVisible=l.computed(function(){return!!t.participant()&&(!A.videoIsAllowed()||g()===u.mediaStreamState.Stopped||t.inTransition())}),t.isVideoLoading=l.computed(function(){return!!t.participant()&&A.videoIsAllowed()&&(g()===u.mediaStreamState.Started||g()===u.mediaStreamState.Inactive)}),t.isVideoActive=l.computed(function(){var e=!!t.participant()&&A.videoIsAllowed()&&g()===u.mediaStreamState.Active;return A.isVideoActive(e),e}),t.cssClasses=l.computed(function(){var e=[];return t.isVideoLoading()||t.isVideoActive()?A.aspectRatioClasses(i.CLASSES.VIDEO_ON+" "+n()):A.aspectRatioClasses(i.CLASSES.ASPECT_RATIO_1BY1),e.push(A.aspectRatioClasses()),s.get().isPluginlessEnabledInCurrentBrowser()&&e.push(i.CLASSES.PLUGINLESS),A.isScreenSharing&&e.push(i.CLASSES.SCREEN_SHARING),t.inTransition()&&e.push("inTransition"),A.isParticipantAtTheBottom()||e.push(i.CLASSES.SMALL_PREVIEW),e.join(" ")}),t.isConnecting=l.observable(!1),t.isDisconnecting=l.observable(!1),t.handleTransitionStart=function(){O&&window.clearTimeout(O),O=window.setTimeout(function(){O=null,it()},d),t.inTransition(!0)},t.handleTransitionEnd=function(e){e.target.classList.contains("participant-wrapper")&&t.inTransition()?it():e.target.classList.contains("videoElement")&&ot()},t.init=function(){t.registerEvent(o.events.callScreen.VIDEO_CONTAINER_SIZE_CHANGED,L),t.registerEvent(o.events.callScreen.PARTICIPANT_MENU_VISIBILITY_CHANGED,R),t.registerEvent(o.events.callScreen.PARTICIPANT_MENU_FOCUSED,U),y.push(t.participant.subscribe(I)),y.push(t.participant.subscribe(q,this,"beforeChange")),y.push(A.isVisible.subscribe(j)),A.isGroupConversation.changed(z),y.push(g.subscribe(B)),t.participant(A.participant),y.push(A.positionInGrid.subscribe(t.handleTransitionStart)),y.push(A.isZoomedIn.subscribe(st)),t.avatarVisible.subscribe(P),!t.participant()||(t.isPstn=c.isPstn(t.participant().person)),y.push(A.videoIsAllowed.subscribe(D)),e.isVideoActive&&y.push(t.isVideoActive.subscribe(function(){e.isVideoActive(t.isVideoActive())}))},t.toggleZoom=function(){if(A.isZoomable()){var e=h.resolve(o.serviceLocator.ACTION_TELEMETRY);A.isZoomedIn(!A.isZoomedIn()),e.recordAction(r.audioVideo.zoomInOut)}},t.onZoomToggleKeyUp=function(e,n){var r=rt(n);return r===f.TAB&&t.isFocused(!0),!0},t.onZoomToggleKeyDown=function(e,n){var r=rt(n);return(r===f.ENTER||r===f.SPACE)&&t.toggleZoom(),r===f.TAB&&t.isFocused(!1),!0},t.onZoomToggleBlur=function(){t.isFocused(!1)},t.showContextMenu=function(e,n){if(n.altKey)return!0;t.dispatchEvent(o.events.callScreen.PARTICIPANT_ITEM_CONTEXT_MENU,{layoutItemModel:A,event:n},t.DIRECTION.CHILD)},t.dispose=function(){B(u.mediaStreamState.Stopped),q(t.participant()),a&&(G(null),a.state.changed.off(g),a=null),D(!1),b&&(X(b,!1),b=null),_(),A.isGroupConversation.changed.off(z),t.avatarVisible.dispose(),t.isVideoLoading.dispose(),S=!1,x=!1}}var n=e("lodash-compat"),r=e("ui/telemetry/actions/actionNames"),i=e("swx-constants").CALLING,s=e("swx-util-calling-stack"),o=e("swx-constants").COMMON,u=e("swx-enums"),a=e("utils/common/eventMixin"),f=e("swx-constants").KEYS,l=e("vendor/knockout"),c=e("ui/modelHelpers/personHelper"),h=e("swx-service-locator-instance").default,p=e("ui/viewModels/calling/callScreenViewModel/callScreenLayoutHelper"),d=700,v=400,m="zoomChanging";n.assign(g.prototype,a),t.build=function(e){return new g(e)}}),define("text!views/calling/participant.html",[],function(){return'<div class="participant-wrapper" data-bind="css: cssClasses,\r\n                                            attr: { style: layoutItemModel.positionInGrid },\r\n                                            transitionEnd: handleTransitionEnd">\r\n\r\n    <div class="participant" data-bind="getElement: participantElement,\r\n                                        css: { self: layoutItemModel.isSelfParticipant,\r\n                                               participantMenuVisible: layoutItemModel.isContextMenuVisible,\r\n                                               participantMenuFocused: isParticipantMenuFocused,\r\n                                               participantAtTheBottom: layoutItemModel.isParticipantAtTheBottom },\r\n                                        event: { dblclick: toggleZoom, contextmenu: showContextMenu }">\r\n\r\n        <div class="videoElement" data-bind="getElement: videoElement, css: { videoActive: isVideoActive()}">\r\n            <a class="button" data-bind="event: { keyup: onZoomToggleKeyUp, keydown: onZoomToggleKeyDown, blur: onZoomToggleBlur }, visible: !avatarVisible(), css: { zoomedIn: layoutItemModel.isZoomedIn, focused: isFocused }, l10n_attr: { \'title\': \'callscreen_title_zoom\' }"></a>\r\n        </div>\r\n\r\n        <div class="avatar" data-bind="visible: avatarVisible()">\r\n            <swx-avatar params="avatar: participant().person.avatarUrl(), displayName: participant().person.displayName(), isFullSize: true, isPstn: isPstn"></swx-avatar>\r\n            <div class="overlay" data-bind="visible: isConnecting() || isDisconnecting() || isVideoLoading()"></div>\r\n        </div>\r\n\r\n        <swx-participant-menu params="layoutItemModel: layoutItemModel" data-bind="css: { participantMenuPillVisible: layoutItemModel.isParticipantPillVisible }"></swx-participant-menu>\r\n\r\n        <!-- ko if: layoutItemModel.isGroupConversation() && !layoutItemModel.isSelfParticipant -->\r\n        <div class="participantStateIcon" data-bind="visible: isConnecting() || isDisconnecting()">\r\n            <span class="iconfont callIn white" data-bind="css: { callIn: isConnecting(), callEnd: isDisconnecting() }"></span>\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <swx-loading-animation class="spinner white" data-bind="visible: isVideoLoading()"></swx-loading-animation>\r\n\r\n        <!-- ko if: !layoutItemModel.isSelfParticipant && isMuted() -->\r\n        <span class="Participant--isMuted iconfont microphoneOff"></span>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: isSpeaking() && !layoutItemModel.isScreenSharing && !layoutItemModel.isSelfParticipant -->\r\n        <div class="speakingIndicator"></div>\r\n        <!-- /ko -->\r\n\r\n    </div>\r\n\r\n</div>\r\n'}),define("ui/viewModels/calling/callScreenViewModel/participantLayoutItem",["require","vendor/knockout","ui/viewModels/calling/callScreenViewModel/participantViewModel","text!views/calling/participant.html"],function(e){function s(e){function p(){if(!s.participantComponent)return;s.participantComponent.element.parentNode&&s.participantComponent.element.parentNode.removeChild(s.participantComponent.element),s.participantComponent.viewModel.dispose(),t.cleanNode(s.participantComponent.element),s.participantComponent=null}function d(){var e=f(),t=l();if(!e&&!o){o=f.subscribe(d);return}if(!t&&!u){u=l.subscribe(d);return}v(),a=window.setTimeout(function(){a=null;var n=c._callHandler&&c._callHandler.isPluginless(),r=!s.participantComponent||s.participantComponent.element.parentNode!==t;!n&&r&&p(),s.participantComponent||g(e),r&&t.appendChild(s.participantComponent.element)},0)}function v(){o&&(o.dispose(),o=null),u&&(u.dispose(),u=null)}function m(){a&&(clearTimeout(a),a=null)}function g(e){if(s.participantComponent)return;var i=document.createElement("div"),o=n.build({layoutItemModel:s}),u=t.contextFor(e).$component;o.setContext(u),o.init(),s.isSelfParticipant&&(i.className="localPip"),i.innerHTML=r,t.applyBindings(o,i),s.participantComponent={element:i,viewModel:o}}var s=this,o,u,a,f,l,c=e.conversation,h;s.participant=e.participant,s.isSelfParticipant=e.isSelfParticipant,s.isScreenSharing=e.isScreenSharing,s.isGroupConversation=e.isGroupConversation,s.isVisible=e.isVisible,s.isInRoster=t.observable(),s.videoIsAllowed=t.observable(e.isSelfParticipant),s.isVideoActive=t.observable(!1),s.isVideoAvailable=t.observable(!1),s.aspectRatioClasses=t.observable(),s.isPinable=t.observable(!1),s.isZoomable=t.computed(function(){return s.isVideoActive()&&!s.isInRoster()&&!s.isScreenSharing}),s.isChatable=t.computed(function(){return e.isGroupConversation()&&!s.isSelfParticipant}),s.isPinned=t.observable(!1),s.isZoomedIn=t.observable(!1),s.isParticipantPillVisible=t.computed(function(){return s.isPinable()||s.isChatable()}),s.isParticipantAtTheBottom=t.observable(!1),s.positionInGrid=t.observable(""),s.importance=e.importance,s.order=++i,s.appendParticipantComponentToNewContainer=function(t){if(h)return;m(),v(),f=e.contextElement,l=t,d()},s.removeParticipantComponent=function(){m(),v(),p()},s.dispose=function(){h=!0,s.removeParticipantComponent()}}var t=e("vendor/knockout"),n=e("ui/viewModels/calling/callScreenViewModel/participantViewModel"),r=e("text!views/calling/participant.html"),i=0;return{build:function(e){return new s(e)}}}),define("ui/viewModels/calling/helpers/textFormatter",[],function(){function e(e,n){var r=[],i=Math.floor(e/1e3/60/60);e-=i*1e3*60*60;var s=Math.floor(e/1e3/60);e-=s*1e3*60;var o=Math.floor(e/1e3);return i&&r.push(t(i)),r.push(t(s)),(!n||!i)&&r.push(t(o)),r.join(":")}function t(e){return e=e.toString(),e.length>1?e:"0"+e}return{getFormattedDuration:e}}),define("ui/viewModels/calling/callScreenViewModel/renderer",["require","lodash-compat","vendor/knockout","jcafe-property-model","ui/viewModels/calling/callScreenViewModel/callScreenLayoutHelper","ui/viewModels/calling/callScreenViewModel/participantLayoutItem"],function(e){function o(){var e=this;e.getGrid=function(e){return i.getGridConfiguration(e)},e.update=function(e){if(!t.isEqual(e.participantsInStage(),e.grid.itemsForStage)||!t.isEqual(e.participantsInRoster(),e.grid.itemsForRoster)){e.participantsInStage.removeAll(),e.participantsInRoster.removeAll();var n=e.grid.itemsForStage.length+e.grid.itemsForRoster.length>1;e.grid.itemsForRoster.forEach(function(t){t.isInRoster(!0),t.videoIsAllowed(t.isScreenSharing||t.participant===e.screenSharingParticipant),t.isPinable(n),t.isZoomedIn(!1),t.positionInGrid(""),t.isParticipantAtTheBottom(!1)}),e.grid.itemsForStage.forEach(function(e){e.isInRoster(!1),e.videoIsAllowed(!0),e.isPinable(n)}),a(e.participantsInStage,e.grid.itemsForStage),a(e.participantsInRoster,e.grid.itemsForRoster)}},e.setUpdateLayoutCallback=t.noop}function u(e,o){function p(e){return e.participant===h.participant()?(e.removeParticipantComponent(),!1):!0}function d(){return s.build({conversation:e,participant:v(),isSelfParticipant:!1,isScreenSharing:!1,isGroupConversation:e.isGroupConversation,isVisible:n.observable(!0),importance:0,contextElement:o})}function v(){return{audio:{isSpeaking:r.property(),isMuted:r.property(),state:r.property()},video:{channels:r.collection()},person:{type:r.property({value:"proxy"}),phoneNumbers:r.collection(),avatarUrl:r.property(),displayName:r.property({value:"Participant Proxy"}),id:r.property({value:"personProxy"})}}}function m(e){var t;g();if(!e)return;c.participant.person.displayName(e.person.displayName()),c.participant.person.id(e.person.id()),t=y(Object.getPrototypeOf(e.person))[0],t&&(c.participant.person[t]=e.person[t]),f.push(e.audio.isSpeaking.changed(c.participant.audio.isSpeaking)),f.push(e.audio.isMuted.changed(c.participant.audio.isMuted)),f.push(e.audio.state.changed(c.participant.audio.state)),l()}function g(){f.forEach(function(e){if(!e.dispose)return;e.dispose()}),f=[]}function y(e){function n(e){return e.match("href_")}var t=[];for(;e!=null;e=Object.getPrototypeOf(e))Array.prototype.push.apply(t,Object.getOwnPropertyNames(e));return t.filter(n)}var u=this,f=[],l=t.noop,c=d(),h=e.videoService.activeSpeaker;c.participant.video.channels.add(h.channel),h.participant.changed(m),u.getGrid=function(t){var n;return t.pinnedItem=null,h.participant()&&h.participant()!==e.selfParticipant&&(t.pinnedItem=c),n=i.getGridConfiguration(t),n.itemsForRoster=n.itemsForRoster.filter(p),n},u.update=function(e){t.isEqual(e.participantsInStage(),e.grid.itemsForStage)||(e.participantsInStage.removeAll(),e.grid.itemsForStage.forEach(function(e){e.isInRoster(!1),e.videoIsAllowed(!0),e.isPinable(!1)}),a(e.participantsInStage,e.grid.itemsForStage)),t.isEqual(e.participantsInRoster(),e.grid.itemsForRoster)||(e.participantsInRoster.removeAll(),e.grid.itemsForRoster.forEach(function(e){e.isInRoster(!0),e.videoIsAllowed(!1),e.isPinable(!1),e.isZoomedIn(!1),e.positionInGrid(""),e.isParticipantAtTheBottom(!1)}),a(e.participantsInRoster,e.grid.itemsForRoster))},u.setUpdateLayoutCallback=function(e){l=e}}function a(e,t){var n=e();e.valueWillMutate(),n.push.apply(n,t),e.valueHasMutated()}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("jcafe-property-model"),i=e("ui/viewModels/calling/callScreenViewModel/callScreenLayoutHelper"),s=e("ui/viewModels/calling/callScreenViewModel/participantLayoutItem");return{getRenderer:function(e,t){return i.isInActiveSpeakerMode(e)?new u(e,t):new o}}}),define("ui/viewModels/calling/callScreenViewModel/callScreenContentViewModel",["require","lodash-compat","vendor/knockout","utils/common/eventMixin","swx-enums","utils/common/cafeObservable","swx-constants","services/calling/participantManager","services/calling/screenSharingHandler","ui/viewModels/calling/callScreenViewModel/participantLayoutItem","ui/viewModels/calling/helpers/textFormatter","swx-constants","swx-i18n","ui/viewModels/chat/conversationTile","ui/viewModels/chat/conversationTopic","ui/viewModels/calling/callScreenViewModel/callScreenLayoutHelper","ui/viewModels/calling/callScreenViewModel/renderer","swx-service-locator-instance"],function(e){function y(e){function _(e){w.push(e.stream.state.changed(function(e){t.isLocalVideoOn(e!==i.mediaStreamState.Stopped)}))}function D(e,n){var r=b.state()===o.CALL_STATES.CONNECTED;r&&t.participantNotification(h.fetch({key:e,params:{name:n}}))}function P(e,n){var r=H(e,n);T.push(r),n?Y(r,!0):t.updateLayout()}function H(n,r){var i=e.selfParticipant===n;return f.build({conversation:e,participant:n,isSelfParticipant:i,isScreenSharing:r,isGroupConversation:e.isGroupConversation,isVisible:t.isVisible,importance:n.audio.importance,contextElement:t.stageElement})}function B(e,n){var r,i;T=T.filter(function(t){return t.participant===e&&t.isScreenSharing===n?(N===t?i=!0:r=!0,t.dispose(),!1):!0}),i&&Y(null),r&&(C&&!N.isScreenSharing?Y(null):t.updateLayout())}function j(e){P(e,!1),D("callscreen_text_participant_joined_notification",e.person.displayName())}function F(e){P(e,!0),D("callscreen_text_participant_screen_shared_notification",e.person.displayName())}function I(e){B(e,!1),B(e,!0),D("callscreen_text_participant_left_notification",e.person.displayName())}function q(e){B(e,!0),D("callscreen_text_participant_screen_unshared_notification",e.person.displayName())}function R(){b.totalCallDuration&&t.duration(l.getFormattedDuration(b.totalCallDuration))}function U(){return e.autoCall&&e.autoCall()}function z(){return e.autoCall&&!e.autoCall()}function W(){var e=U()?h.fetch({key:"callscreen_text_autoCallConnectingMessage"}):"";t.callScreenMessageText(e)}function X(){t.callScreenMessageText("")}function V(){z()?e.autoCall.reason===i.callDisconnectionReason.AutoCallFailed?t.callScreenMessageText(h.fetch({key:"callscreen_text_autoCallFailedMessage"})):e.autoCall.reason===i.callDisconnectionReason.AutoCallTimeout&&t.callScreenMessageText(h.fetch({key:"callscreen_text_autoCallTimeoutMessage"})):t.callScreenMessageText("")}function $(e){switch(e){case o.CALL_STATES.CONNECTING:t.isCallConnected(!1),W();break;case o.CALL_STATES.ENDING:t.isCallConnected(!1),V(),R();break;case o.CALL_STATES.CONNECTED:t.isCallConnected(!0),L(),X()}}function J(){function n(t){return!t||t&&(t.width!==e.offsetWidth||t.height!==e.offsetHeight)}var e=t.stageParticipantsContainer();e?(n(k())&&k({width:e.offsetWidth,height:e.offsetHeight}),t.updateLayout(),t.updateContentWidth(),t.dispatchEvent(c.events.callScreen.VIDEO_CONTAINER_SIZE_CHANGED,null,t.DIRECTION.CHILD)):k(null)}function K(){t.isVisible(!0),L()}function Q(){var e=[];return t.canFit()&&e.push("fit"),t.avatarSizeClass()&&e.push(t.avatarSizeClass()),t.selfParticipantLayoutItem.isInRoster()&&e.push(o.CLASSES.LOCAL_PIP_IN_ROSTER),e.join(" ")}function G(){var n=N;T.sort(function(e,t){return e===n?-1:t===n?1:e.isScreenSharing&&!t.isScreenSharing?-1:!e.isScreenSharing&&t.isScreenSharing?1:e.isVideoAvailable()&&!t.isVideoAvailable()?-1:!e.isVideoAvailable()&&t.isVideoAvailable()?1:e.importance&&t.importance?t.importance-e.importance:e.order<t.order?1:e.order>t.order?-1:0});var r,i=T.slice(0);i.some(function(e){return e.isScreenSharing?(r=e.participant,!0):!1});var s=M.getGrid({stageDimensions:k(),items:i,pinnedItem:n,selfParticipantLayoutItem:t.selfParticipantLayoutItem,conversation:e,maxVideos:e.videoService.maxVideos()});n!==s.itemToPin&&Y(s.itemToPin,!0,!1),M.update({participantsInStage:t.participantsInStage,participantsInRoster:t.participantsInRoster,grid:s,screenSharingParticipant:r}),t.participantsInStage().forEach(function(e){e.appendParticipantComponentToNewContainer(t.stageParticipantsContainer)}),v.arrangeGridItems(s,t.avatarSizeClass)}function Y(e,n,r){e||(e=null),r===undefined&&(r=!0),N!==e&&(N&&N.isPinned(!1),e&&e.isPinned(!0),N=e,C=e?!!n:!1,r&&t.updateLayout(),t.dispatchEvent(c.events.callScreen.PINNED_PARTICIPANT_CHANGED,e?e.participant:null,t.DIRECTION.PARENT))}function Z(e){e=e||{};var n=e.shouldBePinned?e.participant:null;t.setPinnedParticipant(n,e.isScreenSharing)}function et(){var t=e.videoService.videoMode();return(t===i.videoMode.ActiveSpeaker||t===i.videoMode.Both)&&e.isGroupConversation()}function tt(e){var t=N&&C&&!N.isScreenSharing;if(e&&et()&&t){var n;T.some(function(t){return!t.isScreenSharing&&t.participant===e?(n=t,!0):!1});if(!n)return;Y(n,!0)}}function nt(){t.updateLayout()}var t=this,r,y,b,w=[],E,S=d.build(e),x=p.build(e),T=[],N,C,k=n.observable(),L=v.executeInAnimationFrame(J),A=g.resolve(c.serviceLocator.PUBSUB),O=n.observable(),M=m.getRenderer(e,O);t.conversation=e,t.participantsInStage=n.observableArray(),t.participantsInRoster=n.observableArray(),t.stageElement=O,t.stageParticipantsContainer=n.observable(),t.isCallConnected=n.observable(!1),t.showEndCall=n.observable(!1),t.avatarUrl=s.newObservableProperty(e.avatarUrl),t.topic=S.topic,t.displayName=S.displayName,t.isPstn=x.isPstn,t.callScreenMessageText=n.observable(""),t.duration=n.observable(""),t.participantNotification=n.observable(""),t.isVisible=n.observable(!0),t.selfParticipantLayoutItem=H(e.selfParticipant,!1),t.selfParticipantLayoutItem.isInRoster(!0),t.isLocalVideoOn=t.selfParticipantLayoutItem.isVideoActive,t.isLocalVideoAllowed=t.selfParticipantLayoutItem.videoIsAllowed,t.canFit=n.observable(!1),t.avatarSizeClass=n.observable(""),t.mainClass=n.computed(Q),t.rosterWidth=n.observable(50),t.init=function(n,i,s){E=n,E.init(L),b=i,t.footerButtonsWidth=s,e.selfParticipant.video.channels.added(_),w.push(t.stageParticipantsContainer.subscribe(L)),t.selfParticipantLayoutItem.appendParticipantComponentToNewContainer(t.stageElement),r=u.build(e),r.onParticipantAddedToCall(j),r.onParticipantRemovedFromCall(I),r.init(),y=a.build(e),y.onScreenSharingStarted(F),y.onScreenSharingStopped(q),y.init(),t.forwardEvent(c.events.callScreen.TOGGLE_FULLSCREEN,t.DIRECTION.CHILD,L),t.registerEvent(c.events.callScreen.SHOW_CHAT,L),t.registerEvent(c.events.callScreen.HIDE_CHAT,L),t.registerEvent(c.events.navigation.FRAGMENT_SHOW,K),t.registerEvent(c.events.navigation.FRAGMENT_BEFORE_HIDE,t.isVisible.bind(t,!1)),t.registerEvent(c.events.callScreen.SIDEBAR_TOGGLED,L),t.registerEvent(c.events.callScreen.VIDEO_STATE_CHANGED,L),t.registerEvent(c.events.callScreen.TOGGLE_NARROW_MENU,L),t.registerEvent(c.events.callScreen.ROSTER_WIDTH_CHANGED,t.rosterWidth.bind(t)),t.registerEvent(c.events.callScreen.TOGGLE_GRID_VIEW,Z.bind(t,null)),w.push(b.state.subscribe($)),$(b.state()),w.push(s.subscribe(t.updateContentWidth)),w.push(t.rosterWidth.subscribe(t.updateContentWidth)),w.push(t.participantsInStage.subscribe(function(){L()})),A.subscribe(c.events.callScreen.PINNED_PARTICIPANT_CHANGED,Z),et()&&w.push(t.conversation.videoService.activeSpeaker.participant.changed(tt)),w.push(t.conversation.videoService.maxVideos.changed(nt)),t.updateContentWidth(),M.setUpdateLayoutCallback(t.updateLayout)},t.updateLayout=function(){b.state()===o.CALL_STATES.CONNECTED&&v.executeInAnimationFrame(G)()},t.updateContentWidth=v.executeInAnimationFrame(function(){var e=(E.getContentWidth()-t.footerButtonsWidth())/2;t.canFit(e>t.rosterWidth())}),t.setPinnedParticipant=function(e,t){var n;e&&(n=T.filter(function(n){return n.participant===e&&n.isScreenSharing===!!t})[0]),Y(n)},t.dispose=function(){e.selfParticipant.video.channels.added.off(_),E.dispose(),w.forEach(function(e){e.dispose()}),w=[],A.unsubscribe(c.events.callScreen.PINNED_PARTICIPANT_CHANGED,Z),r&&r.dispose(),T.forEach(function(e){e.dispose()}),t.selfParticipantLayoutItem.dispose()}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/eventMixin"),i=e("swx-enums"),s=e("utils/common/cafeObservable"),o=e("swx-constants").CALLING,u=e("services/calling/participantManager"),a=e("services/calling/screenSharingHandler"),f=e("ui/viewModels/calling/callScreenViewModel/participantLayoutItem"),l=e("ui/viewModels/calling/helpers/textFormatter"),c=e("swx-constants").COMMON,h=e("swx-i18n").localization,p=e("ui/viewModels/chat/conversationTile"),d=e("ui/viewModels/chat/conversationTopic"),v=e("ui/viewModels/calling/callScreenViewModel/callScreenLayoutHelper"),m=e("ui/viewModels/calling/callScreenViewModel/renderer"),g=e("swx-service-locator-instance").default;return t.assign(y.prototype,r),{build:function(e){return new y(e)}}}),define("text!views/calling/callScreenContent.html",[],function(){return'<div class="stage" data-bind="css: mainClass, getVisibility: isVisible, getElement: stageElement">\r\n    <div class="stage-inner">\r\n        <div class="participantsInStage" data-bind="getElement: stageParticipantsContainer"></div>\r\n\r\n        <!-- ko if: callScreenMessageText -->\r\n        <div class="callScreenMessage fontSize-h2" data-bind="text: callScreenMessageText"></div>\r\n        <!-- /ko -->\r\n\r\n        <swx-end-call class="end-call"\r\n                params="avatarUrl: avatarUrl,\r\n                        duration: duration,\r\n                        isGroupConversation: $parent.conversation.isGroupConversation(),\r\n                        displayName: displayName,\r\n                        isPstn: isPstn">\r\n        </swx-end-call>\r\n\r\n        <swx-call-roster class="call-roster"\r\n                        data-bind="css: { hasBorder: isLocalVideoOn() || (isCallConnected() && participantsInRoster().length > 0)}"\r\n                        params="layoutItemModels: participantsInRoster,\r\n                                selfLayoutItemModel: selfParticipantLayoutItem,\r\n                                conversation: $parent.conversation">\r\n        </swx-call-roster>\r\n\r\n        <div aria-live="polite" role="status" class="offScreen" data-bind="text: participantNotification"></div>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/calling/callScreenContent",["require","exports","module","vendor/knockout","jsviews/calling/callScreenContent","ui/viewModels/calling/callScreenViewModel/callScreenContentViewModel","constants/components","text!views/calling/callScreenContent.html"],function(e,t){function s(e,t){var s=i.build(e.conversation),o=r.build(t.element),u=n.dataFor(t.element);return s.setContext(u),s.init(o,e.callState,e.footerButtonsWidth),s}var n=e("vendor/knockout"),r=e("jsviews/calling/callScreenContent"),i=e("ui/viewModels/calling/callScreenViewModel/callScreenContentViewModel");t.name=e("constants/components").calling.CONTENT,t.template=e("text!views/calling/callScreenContent.html"),t.viewModel={createViewModel:s}}),define("ui/viewModels/calling/helpers/fullScreenModeTracker",["require","exports","module"],function(e,t){function r(){var e=this,t=!0,n=t;e.modeChanged=function(e){n=e},e.getLastMode=function(){return n}}var n=null;t.get=function(){return n===null&&(n=new r),n},t.dispose=function(){n!==null&&(n=null)}}),define("ui/viewModels/calling/callScreenViewModel/callScreenHeaderViewModel",["require","lodash-compat","vendor/knockout","swx-browser-detect","swx-i18n","utils/common/eventMixin","ui/viewModels/calling/helpers/textFormatter","swx-constants","swx-constants","swx-pubsub-instance","ui/telemetry/actions/actionNames","swx-service-locator-instance","swx-enums","experience/settings","utils/common/styleModeHelper","ui/viewModels/calling/helpers/fullScreenModeTracker","ui/viewModels/calling/callScreenViewModel/callScreenLayoutHelper","ui/viewModels/chat/conversationTopic"],function(e){function b(e,t,s){function k(e){if(N){C.dispatchEvent(a.events.callScreen.HIDE_CHAT,null,C.DIRECTION.PARENT),N=!1;return}C.isContainerFullScreen(e),C.dispatchEvent(a.events.callScreen.TOGGLE_FULLSCREEN,e,C.DIRECTION.PARENT),f.publish(a.apiUIEvents.SWX_CALLSCREEN_MAXIMIZE,e),v.get().modeChanged(e)}function L(){d.get().isIntegratedProperty()&&T&&k(!0)}function A(){return r.getBrowserInfo().browserName===r.BROWSERS.SKYPE_SHELL?!0:t.autoCall&&t.autoCall()?!0:t.selfParticipant.audio.state.reason===h.callDisconnectionReason.CallEscalated?v.get().getLastMode():d.get().isIntegratedProperty()&&T?!1:T}function O(){return C.isContainerFullScreen()?i.fetch({key:"callscreen_text_exitFullscreen"}):i.fetch({key:"callscreen_text_enterFullscreen"})}function M(){return C.isSidebarExpanded()?i.fetch({key:"callscreen_text_hideSidebar"}):i.fetch({key:"callscreen_text_showSidebar"})}function _(){return(E()===u.CONNECTED||E()===u.ENDING)&&C.watermarkCanBeShown()}function D(e){E()===u.CONNECTED&&C.watermarkCanBeShown(!e)}function P(){b?(B(),window.clearInterval(b)):C.callStatusDisplay(s.ENDED)}function H(e){switch(e){case u.CALLING:case u.EARLY_MEDIA:C.callStatusDisplay(s.CALLING);break;case u.CONNECTED:L(),j();break;case u.ENDING:P(),N=!1}}function B(){C.callStatusDisplay(o.getFormattedDuration(e.getCurrentDuration()))}function j(){B(),b=window.setInterval(B,y)}function F(e){var n=!!e;C.isGridViewControlVisible(n&&!m.isInActiveSpeakerMode(t))}var b,w,E=e.state,S,x=c.resolve(a.serviceLocator.FEATURE_FLAGS),T=x.isFeatureOn(a.featureFlags.CALLING_FULL_SCREEN_ENABLED),N=!1,C=this;C.callStatusDisplay=n.observable(s.CONNECTING),C.watermarkCanBeShown=n.observable(!1),C.isContainerFullScreen=n.observable(!1),C.isSidebarExpanded=n.observable(!1),C.sidebarButtonText=n.computed(M),C.showToggleSidebarIcon=p.API.version!==2,C.isInShellApp=n.observable(!1),C.fullscreenText=n.computed(O),C.isWatermarkVisible=n.computed(_),C.isGridViewControlVisible=n.observable(!1),C.onButtonFocused=function(){C.dispatchEvent(a.events.callScreen.BUTTON_FOCUSED,!0,C.DIRECTION.PARENT)},C.onButtonBlurred=function(){C.dispatchEvent(a.events.callScreen.BUTTON_FOCUSED,!1,C.DIRECTION.PARENT)},C.toggleContainerFullScreen=function(){var e=c.resolve(a.serviceLocator.ACTION_TELEMETRY);k(!C.isContainerFullScreen()),e.recordAction(l.audioVideo.toggleFullScreen)},C.toggleNarrowMenu=function(){var e=c.resolve(a.serviceLocator.ACTION_TELEMETRY);C.isSidebarExpanded(!C.isSidebarExpanded()),C.dispatchEvent(a.events.callScreen.TOGGLE_NARROW_MENU,null,C.DIRECTION.PARENT),e.recordAction(l.audioVideo.toggleNarrowMenu)},C.toggleGridView=function(){var e=c.resolve(a.serviceLocator.ACTION_TELEMETRY);C.dispatchEvent(a.events.callScreen.TOGGLE_GRID_VIEW,null,C.DIRECTION.PARENT),e.recordAction(l.audioVideo.toggleGridView)},C.init=function(){S=g.build(t),C.conversationTopic=S.topic,C.registerEvent(a.events.callScreen.CONTROLS_VISIBLE,D),C.registerEvent(a.events.callScreen.PINNED_PARTICIPANT_CHANGED,F),C.registerEvent(a.events.callScreen.SHOW_CHAT,function(){k(!1),N=!0}),w=E.subscribe(H),H(E()),k(A()),r.getBrowserInfo().browserName===r.BROWSERS.SKYPE_SHELL&&C.isInShellApp(!0)},C.dispose=function(){w.dispose(),C.fullscreenText.dispose(),C.sidebarButtonText.dispose(),C.isWatermarkVisible.dispose(),b&&window.clearInterval(b),S.dispose()}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-browser-detect").default,i=e("swx-i18n").localization,s=e("utils/common/eventMixin"),o=e("ui/viewModels/calling/helpers/textFormatter"),u=e("swx-constants").CALLING.CALL_STATES,a=e("swx-constants").COMMON,f=e("swx-pubsub-instance").default,l=e("ui/telemetry/actions/actionNames"),c=e("swx-service-locator-instance").default,h=e("swx-enums"),p=e("experience/settings"),d=e("utils/common/styleModeHelper"),v=e("ui/viewModels/calling/helpers/fullScreenModeTracker"),m=e("ui/viewModels/calling/callScreenViewModel/callScreenLayoutHelper"),g=e("ui/viewModels/chat/conversationTopic"),y=1e3;return t.assign(b.prototype,s),{build:function(e,t,n){return new b(e,t,n)}}}),define("text!views/calling/callScreenHeader.html",[],function(){return'<div class="header">\r\n    <div class="controls">\r\n        <button class="calling btn circle small" data-bind="click: toggleGridView, css: { hide: !isGridViewControlVisible() }, l10n_attr: { \'title\': \'callscreen_text_enterGvcGrid\' }, event: { focus: onButtonFocused, blur: onButtonBlurred }" type="button">\r\n                <span class="iconfont gvcGrid" data-bind="l10n: {\'key\': \'callscreen_text_enterGvcGrid\' }"></span>\r\n        </button>\r\n        <button class="calling btn circle small" data-bind="click: toggleContainerFullScreen, css: { hide: isInShellApp() }, attr: { title: fullscreenText }, event: { focus: onButtonFocused, blur: onButtonBlurred }" type="button">\r\n            <span class="iconfont fullscreenOn" data-bind="css: { fullscreenOff: isContainerFullScreen() }, text: fullscreenText"></span>\r\n        </button>\r\n        <button class="calling btn circle small menuButton" data-bind="visible: showToggleSidebarIcon, click: toggleNarrowMenu, event: { focus: onButtonFocused, blur: onButtonBlurred }, attr: { title: sidebarButtonText }" type="button">\r\n            <span class="iconfont menu" data-bind="text: sidebarButtonText"></span>\r\n        </button>\r\n    </div>\r\n    <div class="title">\r\n        <h3 class="conversationTopic" data-bind="text: conversationTopic"></h3>\r\n        <h3 class="info callStatus" data-bind="text: callStatusDisplay"></h3>\r\n    </div>\r\n</div>\r\n<div class="watermark" data-bind="visible: isWatermarkVisible()"></div>\r\n'}),define("ui/components/calling/callScreenHeader",["require","exports","module","vendor/knockout","ui/viewModels/calling/callScreenViewModel/callScreenHeaderViewModel","constants/components","text!views/calling/callScreenHeader.html"],function(e,t){function i(e,t){var i=r.build(e.state,e.conversation,e.callScreenStrings),s=n.dataFor(t.element);return i.setContext(s),i.init(),i}var n=e("vendor/knockout"),r=e("ui/viewModels/calling/callScreenViewModel/callScreenHeaderViewModel");t.name=e("constants/components").calling.HEADER,t.template=e("text!views/calling/callScreenHeader.html"),t.viewModel={createViewModel:i}}),define("jsviews/calling/callScreenFooter",["require","swx-constants","browser/window"],function(e){function i(e){var i,s;this.getButtonsWidth=function(){return e.querySelector(t).offsetWidth},this.init=function(e){i=e,s=!1,r.addEventListener(n.events.browser.RESIZE,function(){s||i()})},this.dispose=function(){s=!0,r.removeEventListener(n.events.browser.RESIZE,i)}}var t=".button.row.center",n=e("swx-constants").COMMON,r=e("browser/window");return{build:function(e){return new i(e)}}}),define("ui/viewModels/calling/moreActionsControlViewModel",["require","lodash-compat","utils/common/eventMixin","vendor/knockout","ui/viewModels/calling/baseCallControlViewModel","ui/telemetry/actions/actionNames","swx-constants","swx-constants","swx-service-locator-instance","ui/contextMenu/items/all","ui/contextMenu/contextMenu","ui/telemetry/actions/actionSources","utils/common/cafeObservable","swx-enums","swx-i18n"],function(e){function v(e){function k(){return n.isFeatureOn(o.featureFlags.AUDIO_VIDEO_SETTINGS_SUPPORT)}function L(e){var t=a.resolve(o.serviceLocator.ACTION_TELEMETRY);t.recordAction(e)}function A(){l.hide()}function O(){t.dispatchEvent(o.events.callScreen.TOGGLE_MODAL_DIALOG,u.CALL_SCREEN_DIALOG.NAME.SCREEN_SHARING_PREVIEW,t.DIRECTION.PARENT),L(s.audioVideo.shareScreenPreview)}function M(){e.screenSharingService.start(),L(s.audioVideo.shareScreen)}function _(){e.screenSharingService.stop(),L(s.audioVideo.stopSharingScreen)}var t=this,n=a.resolve(o.serviceLocator.FEATURE_FLAGS),v=r.observable(!0),m=h.newObservableProperty(e.selfParticipant.audio.state),g=h.newObservableProperty(e.participants.add.enabled),y=h.newObservableProperty(e.screenSharingService.start.enabled),b=h.newObservableProperty(e.screenSharingService.stop.enabled),w,E,S,x,T=d.fetch({key:"callscreen_text_shareScreens"}),N=d.fetch({key:"callscreen_text_stopSharingScreen"});i.call(t,e,v),t.addParticipantText=d.fetch({key:"callscreen_text_addParticipants"}),t.moreActionsText=d.fetch({key:"callscreen_text_plusButton"}),t.screenShareText=r.pureComputed(function(){return y()||!b()?T:N}),t.avSettingsText=d.fetch({key:"callscreen_text_showAVSettings"}),t.isAddingParticipantsAllowed=r.pureComputed(function(){return g()&&m()===p.callConnectionState.Connected}),t.isScreenSharingAllowed=r.pureComputed(function(){return y()||b()}),t.isMoreActionsButtonEnabled=r.pureComputed(function(){return(t.isAddingParticipantsAllowed()||t.isScreenSharingAllowed()||k())&&t.isCallControlEnabled()}),t.showMoreActionsMenu=function(r,i){var u=5,a=[f.AddParticipantsMenuItem.build(function(){return!t.isAddingParticipantsAllowed()},t.addParticipants),f.ShareScreen.build(function(){return!t.isScreenSharingAllowed()},y(),t.shareScreen),f.AVSettings.build(function(){return!k()},t.avSettings),f.TransferCall.build(function(){return!n.isFeatureOn(o.featureFlags.TRANSFER_CALL)},t.transferCall)],h={source:c.recentItem,isGroupConversation:e.isGroupConversation()};i.customClientOptions={offsetElement:i.target,position:p.contextMenuPosition.Top,offset:u},l.show(a,i,h),L(s.audioVideo.moreActions)},t.addParticipants=function(){t.dispatchEvent(o.events.callScreen.TOGGLE_MODAL_DIALOG,u.CALL_SCREEN_DIALOG.NAME.ADD_PARTICIPANTS,t.DIRECTION.PARENT),L(s.audioVideo.addParticipants)},t.shareScreen=function(){y()?n.isFeatureOn(o.featureFlags.OUTGOING_SCREEN_SHARING_PREVIEW)?O():M():b()&&_()},t.avSettings=function(){t.dispatchEvent(o.events.callScreen.TOGGLE_MODAL_DIALOG,u.CALL_SCREEN_DIALOG.NAME.AV_SETTINGS,t.DIRECTION.PARENT)},t.transferCall=function(){t.dispatchEvent(o.events.callScreen.TOGGLE_MODAL_DIALOG,u.CALL_SCREEN_DIALOG.NAME.TRANSFER_CALL,t.DIRECTION.PARENT)},w=g.subscribe(A),E=y.subscribe(A),S=b.subscribe(A),x=l.isVisible.subscribe(function(e){e?t.dispatchEvent(o.events.callScreen.MORE_ACTION_MENU_VISIBLE,null,t.DIRECTION.PARENT):t.dispatchEvent(o.events.callScreen.MORE_ACTION_MENU_HIDDEN,null,t.DIRECTION.PARENT)});var C=t.dispose;t.dispose=function(){w&&w.dispose(),E&&E.dispose(),S&&S.dispose(),m.dispose(),g.dispose(),y.dispose(),b.dispose(),x.dispose(),C.call(t)}}var t=e("lodash-compat"),n=e("utils/common/eventMixin"),r=e("vendor/knockout"),i=e("ui/viewModels/calling/baseCallControlViewModel"),s=e("ui/telemetry/actions/actionNames"),o=e("swx-constants").COMMON,u=e("swx-constants").CALLING,a=e("swx-service-locator-instance").default,f=e("ui/contextMenu/items/all"),l=e("ui/contextMenu/contextMenu"),c=e("ui/telemetry/actions/actionSources"),h=e("utils/common/cafeObservable"),p=e("swx-enums"),d=e("swx-i18n").localization;return v.prototype=Object.create(i.prototype),v.prototype.constructor=v,t.assign(v.prototype,n),{build:function(e){return new v(e)}}}),define("ui/viewModels/calling/videoControlViewModel",["require","ui/viewModels/calling/baseCallControlViewModel","vendor/knockout","swx-enums","utils/common/cafeObservable","swx-i18n","swx-cafe-application-instance","ui/telemetry/actions/actionNames","swx-constants","ui/modelHelpers/personHelper","swx-service-locator-instance"],function(e){function c(e){function g(e){e.stream.state.changed(p),e.isStarted.set.enabled.changed(function(e){m=e,y()})}function y(){h(e.videoService.start.enabled()||m)}function b(){var t=e.participants();v(t.length===1&&f.isEchoContact(t[0].person))}function w(t){e.selfParticipant.video.channels(0).isStarted(t)}var c=this,h=n.observable(!1),p=n.observable(),d=i.newObservableProperty(o.get().devicesManager.selectedCamera),v=n.observable(!1),m=!1;e.videoService.start.enabled.changed(y),e.participants.changed(b),t.call(c,e,h),c.isLocalVideoAvailable=n.computed(function(){return d()!==null}),c.isLocalVideoOn=n.computed(function(){return p&&c.isLocalVideoAvailable()&&!!p()&&p()!==r.mediaStreamState.Stopped}),c.isLocalVideoButtonEnabled=n.computed(function(){return c.isLocalVideoAvailable()&&c.isCallControlEnabled()&&!v()}),c.videoStateText=n.computed(function(){return c.isLocalVideoOn()?s.fetch({key:"callscreen_text_videoOff"}):s.fetch({key:"callscreen_text_videoOn"})}),c.toggleVideo=function(){if(!c.isLocalVideoButtonEnabled())return;var t=l.resolve(a.serviceLocator.ACTION_TELEMETRY);t.recordAction(u.audioVideo.toggleVideo),c.isLocalVideoOn()?w(!1):e.selfParticipant.video.state()===r.callConnectionState.Disconnected&&e.videoService.start.enabled()?e.videoService.start().then(function(){w(!0)}):w(!0)},c.dispose=function(){d.dispose(),c.videoStateText.dispose(),e.selfParticipant.video.channels.added.off(g),e.participants.changed.off(b),e.videoService.start.enabled.changed.off(y)},e.selfParticipant.video.channels.added(g)}var t=e("ui/viewModels/calling/baseCallControlViewModel"),n=e("vendor/knockout"),r=e("swx-enums"),i=e("utils/common/cafeObservable"),s=e("swx-i18n").localization,o=e("swx-cafe-application-instance"),u=e("ui/telemetry/actions/actionNames"),a=e("swx-constants").COMMON,f=e("ui/modelHelpers/personHelper"),l=e("swx-service-locator-instance").default;return c.prototype=Object.create(t.prototype),c.prototype.constructor=c,{build:function(e){return new c(e)}}}),define("ui/viewModels/calling/messageControlViewModel",["require","ui/viewModels/calling/baseCallControlViewModel","lodash-compat","vendor/knockout","swx-enums","swx-i18n","swx-constants","ui/telemetry/actions/actionNames","swx-service-locator-instance"],function(e){function f(e,f){function h(e){if(!e||!e.direction||!e.type)return;e.direction()===o.chat.messageType.INCOMING&&e.type()===i.activityType.TextMessage&&l.hasMessage(!0)}var l=this,c=r.observable(!1);f=f||n.noop,t.call(l,e,c),l.buttonText=s.fetch({key:"callscreen_text_showChat"}),l.showChat=function(){var e=a.resolve(o.serviceLocator.ACTION_TELEMETRY);e.recordAction(u.audioVideo.showChat),l.hasMessage(!1),f()},l.hasMessage=r.observable(!1),l.dispose=function(){e.historyService.activityItems.added.off(h)},e.historyService.activityItems.added(h)}var t=e("ui/viewModels/calling/baseCallControlViewModel"),n=e("lodash-compat"),r=e("vendor/knockout"),i=e("swx-enums"),s=e("swx-i18n").localization,o=e("swx-constants").COMMON,u=e("ui/telemetry/actions/actionNames"),a=e("swx-service-locator-instance").default;return f.prototype=Object.create(t.prototype),f.prototype.constructor=f,{build:function(e,t){return new f(e,t)}}}),define("utils/common/outsideClickHandler",["require","exports","module","lodash-compat","browser/dom","browser/document","swx-constants","constants/cssClasses","swx-constants"],function(e,t){function f(e){function t(t){var n=!!r.getParentWithClass(e.target,t.name);n||t.callback()}if(!a)return;a.forEach(t)}function l(){return!!r.getElement("."+o.contextMenu.CONTEXT_MENU)}function c(e){var t=e.which||e.keyCode;if(!a||t!==u.ESCAPE||l())return;a.forEach(function(e){e.callback()}),e.stopPropagation()}function h(e){n.remove(a,function(t){return t.name===e})}var n=e("lodash-compat"),r=e("browser/dom"),i=e("browser/document"),s=e("swx-constants").COMMON,o=e("constants/cssClasses"),u=e("swx-constants").KEYS,a=null;t.add=function(e,t){if(!e)throw new Error("className is mandatory");if(!t)throw new Error("handler is not provided");a=a||[],h(e),a.length===0&&(i.body.addEventListener(s.events.browser.CLICK,f,!0),i.body.addEventListener(s.events.browser.KEYDOWN,c,!0)),a.push({name:e,callback:t})},t.remove=function(e){if(!e)throw new Error("className is mandatory");h(e);if(a===null||a.length>0)return;a=null,i.body.removeEventListener(s.events.browser.CLICK,f,!0),i.body.removeEventListener(s.events.browser.KEYDOWN,c,!0)},t._getListenters=function(){return a},t._dispose=function(){a=null,i.body.removeEventListener(s.events.browser.CLICK,f,!0),i.body.removeEventListener(s.events.browser.KEYDOWN,c,!0)}}),define("ui/viewModels/calling/callScreenDialpadViewModel",["require","ui/viewModels/calling/baseCallControlViewModel","vendor/knockout","swx-utils-common","swx-i18n","utils/common/eventHelper","ui/telemetry/actions/actionNames","lodash-compat","swx-utils-common","swx-constants","utils/common/eventMixin","swx-service-locator-instance","utils/common/outsideClickHandler"],function(e){function d(e){function d(e){var t=u.dialpadText(),n=a.inject(t,e,t.length);u.dialpadText(n),r.execute(function(){v(n.length)})}function v(e){l.selectionStart=e,l.selectionEnd=e}function m(){var e=c.resolve(f.serviceLocator.ACTION_TELEMETRY),t=o.audioVideo.toggleDialpad;e.recordAction(t)}function g(){u.isDialpadOn()?r.execute(function(){u.dispatchEvent(f.events.callScreen.DIALPAD_VISIBLE,null,u.DIRECTION.PARENT)}):u.dispatchEvent(f.events.callScreen.DIALPAD_HIDDEN,null,u.DIRECTION.PARENT)}var u=this,l;u.isDialpadOn=n.observable(!1),u.dialpadText=n.observable(""),t.call(u,e),u.init=function(e){l=e,u.registerEvent(f.events.skypeOut.DIAL_BUTTON_CLICKED,u.sendDtmf)},u.sendDtmf=function(t){return e.audioService.sendDtmf(t.text).then(function(e){d(e)})},u.toggleDialpad=function(e,t){if(u.isDialpadButtonEnabled()){var n=u.isDialpadOn();n?h.remove(p):h.add(p,u.toggleDialpad),u.isDialpadOn(!n),m(),g()}t&&s.swallow(t)},u.isDialpadButtonEnabled=n.computed(function(){return u.isCallConnected()}),u.displayDialpad=n.computed(function(){return u.isDialpadButtonEnabled()&&u.isDialpadOn()}),u.dialpadStateText=n.computed(function(){return u.isDialpadOn()?i.fetch({key:"callscreen_text_dialpadOff"}):i.fetch({key:"callscreen_text_dialpadOn"})}),u.dispose=function(){h.remove(p),u.dialpadStateText.dispose(),u.displayDialpad.dispose(),u.isDialpadButtonEnabled.dispose(),u.isDialpadOn(!1),u.dialpadText("")}}var t=e("ui/viewModels/calling/baseCallControlViewModel"),n=e("vendor/knockout"),r=e("swx-utils-common").async,i=e("swx-i18n").localization,s=e("utils/common/eventHelper"),o=e("ui/telemetry/actions/actionNames"),u=e("lodash-compat"),a=e("swx-utils-common").stringUtils,f=e("swx-constants").COMMON,l=e("utils/common/eventMixin"),c=e("swx-service-locator-instance").default,h=e("utils/common/outsideClickHandler"),p="DialPadController";return d.prototype=Object.create(t.prototype),d.prototype.constructor=d,u.assign(d.prototype,l),{build:function(e){return new d(e)}}}),define("ui/calling/callingCapabilityHelper",["require","exports","module","swx-cafe-application-instance","swx-browser-detect","swx-service-locator-instance","swx-constants","ui/modelHelpers/conversationHelper","vendor/knockout"],function(e,t){var n=e("swx-cafe-application-instance"),r=e("swx-browser-detect").default,i=e("swx-service-locator-instance").default,s=e("swx-constants").COMMON,o=e("ui/modelHelpers/conversationHelper"),u=e("vendor/knockout");t.getVideoCapabilityObservable=function(e){function h(t){if(!t){l(!1);return}if(e.isGroupConversation()&&r.getBrowserInfo().isChromeOnLinux){l(a.isFeatureOn(s.featureFlags.PLUGINLESS_GROUP_VIDEO_CALLING_CHROME_LINUX));return}if(e.isGroupConversation()){l(!0);return}l(!f)}var t=n.get().personsAndGroupsManager.mePerson.capabilities.video,a=i.resolve(s.serviceLocator.FEATURE_FLAGS),f=o.isConversationWithPstn(e),l=u.observable(!1),c;return c=t.changed(h),l.dispose=c.dispose.bind(c),l}}),define("ui/viewModels/calling/callScreenViewModel/callScreenFooterViewModel",["require","lodash-compat","vendor/knockout","browser/dom","swx-util-calling-stack","swx-constants","swx-service-locator-instance","utils/common/eventMixin","ui/modelHelpers/conversationHelper","ui/viewModels/calling/endCallControlViewModel","ui/viewModels/calling/moreActionsControlViewModel","ui/viewModels/calling/micControlViewModel","ui/viewModels/calling/videoControlViewModel","ui/viewModels/calling/messageControlViewModel","ui/viewModels/calling/callScreenDialpadViewModel","swx-focus-handler","swx-utils-common","ui/calling/callingCapabilityHelper"],function(e){function y(e,t){function N(){return e.selfParticipant.isAnonymous()?!1:i.get().isPluginlessCallingSupported()?y.isFeatureOn(s.featureFlags.PLUGINLESS_LOCAL_ESCALATION):y.isFeatureOn(s.featureFlags.GVC_LOCAL_ESCALATION)}function C(){return!i.get().isPluginlessCallingSupported()&&y.isFeatureOn(s.featureFlags.OUTGOING_SCREEN_SHARING)}function k(){return y.isFeatureOn(s.featureFlags.AUDIO_VIDEO_SETTINGS_SUPPORT)}function L(){m.execute(function(){u.dispatchEvent(s.events.callScreen.BUTTONS_WIDTH_CHANGED,u.view.getButtonsWidth(),u.DIRECTION.PARENT)})}function A(e){if(u.showDialpadControl()||!a.isPstnParticipant(e))return;M(),u.showDialpadControl(!0),_()}function O(t){if(!u.showDialpadControl()||!a.isPstnParticipant(t))return;a.isConversationWithPstn(e)||u.showDialpadControl(!1)}function M(){u.dialpadControl||(u.dialpadControl=d.build(e,t),u.dialpadControl.setContext(u))}function _(){u.dialpadControl.init(r.getElement(".DialPadController-input",t))}function D(){var e=u.showVideoControl()?".toggleVideo":".toggleMic",n=r.getElement(e,t);n&&m.execute(function(){v.get().addFocusRequestToQueue(n,v.Priorities.Immediate)})}var u=this,y=o.resolve(s.serviceLocator.FEATURE_FLAGS),b=y.isFeatureOn(s.featureFlags.PSTN_ENABLED),w=a.isConversationWithPstn(e),E=b&&w,S,x,T=g.getVideoCapabilityObservable(e);u.endCallControl=f.build(e,!0),u.micControl=c.build(e,!0),u.videoControl=h.build(e,!0),u.moreActionsControl=l.build(e),u.moreActionsControl.setContext(u),u.showDialpadControl=n.observable(E),u.showVideoControl=T,u.showMessageControl=y.isFeatureOn(s.featureFlags.CALLSCREEN_MINMAX),u.messageControl=p.build(e,function(){u.dispatchEvent(s.events.callScreen.SHOW_CHAT,null,u.DIRECTION.PARENT)}),u.isLocalEscalationEnabled=N(),u.isScreenSharingEnabled=C(),u.isAVSettingsEnabled=k(),u.hasMoreThanOneMoreAction=u.isLocalEscalationEnabled&&u.isScreenSharingEnabled||u.isLocalEscalationEnabled&&u.isAVSettingsEnabled||u.isAVSettingsEnabled&&u.isScreenSharingEnabled,E&&M(),u.view=null,u.onButtonFocused=function(){u.dispatchEvent(s.events.callScreen.BUTTON_FOCUSED,!0,u.DIRECTION.PARENT)},u.onButtonBlurred=function(){u.dispatchEvent(s.events.callScreen.BUTTON_FOCUSED,!1,u.DIRECTION.PARENT)},u.init=function(t){u.view=t,u.view.init(L),u.dialpadControl&&_(),u.forwardEvent(s.events.callScreen.TOGGLE_MODAL_DIALOG,u.DIRECTION.PARENT),u.forwardEvent(s.events.callScreen.MORE_ACTION_MENU_VISIBLE,u.DIRECTION.PARENT),u.forwardEvent(s.events.callScreen.MORE_ACTION_MENU_HIDDEN,u.DIRECTION.PARENT),u.forwardEvent(s.events.callScreen.DIALPAD_VISIBLE,u.DIRECTION.PARENT),u.forwardEvent(s.events.callScreen.DIALPAD_HIDDEN,u.DIRECTION.PARENT),u.registerEvent(s.events.callScreen.FOCUS_CALL_SCREEN,D),u.registerEvent(s.events.callScreen.HIDE_CHAT,u.messageControl.hasMessage.bind(u,!1)),e.isGroupConversation()&&b&&(S=e.participants.added(A),x=e.participants.removed(O)),L(),D()},u.dispose=function(){u.view&&u.view.dispose(),T.dispose(),u.endCallControl.dispose(),u.micControl.dispose(),u.videoControl.dispose(),u.moreActionsControl.dispose(),u.messageControl.dispose(),u.dialpadControl&&u.dialpadControl.dispose(),S&&S.dispose(),x&&x.dispose()}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("browser/dom"),i=e("swx-util-calling-stack"),s=e("swx-constants").COMMON,o=e("swx-service-locator-instance").default,u=e("utils/common/eventMixin"),a=e("ui/modelHelpers/conversationHelper"),f=e("ui/viewModels/calling/endCallControlViewModel"),l=e("ui/viewModels/calling/moreActionsControlViewModel"),c=e("ui/viewModels/calling/micControlViewModel"),h=e("ui/viewModels/calling/videoControlViewModel"),p=e("ui/viewModels/calling/messageControlViewModel"),d=e("ui/viewModels/calling/callScreenDialpadViewModel"),v=e("swx-focus-handler"),m=e("swx-utils-common").async,g=e("ui/calling/callingCapabilityHelper");return t.assign(y.prototype,u),{build:function(e,t){return new y(e,t)}}}),define("text!views/calling/callScreenFooter.html",[],function(){return'<div class="controls">\r\n    <div class="button row center">\r\n        <!-- ko if: showMessageControl -->\r\n            <!-- ko with: messageControl -->\r\n            <button data-bind="visible: isCallConnected, click: showChat, event: {focus: $parent.onButtonFocused, blur: $parent.onButtonBlurred}, attr: { title: buttonText}" class="calling btn primary circle large toggleMessage protected" type="button">\r\n                <span class="iconfont" data-bind="css: { message: !hasMessage(), messageWithBadge: hasMessage}, text: buttonText"></span>\r\n                <span class="toggleMessage-unread" data-bind="visible: hasMessage"></span>\r\n            </button>\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: showVideoControl -->\r\n            <!-- ko with: videoControl -->\r\n            <button data-bind="click: toggleVideo, event: {focus: $parent.onButtonFocused, blur: $parent.onButtonBlurred}, enable: isLocalVideoAvailable(), css: { selected: isLocalVideoOn(), disabled: !isLocalVideoButtonEnabled() }, attr: { title: videoStateText, \'aria-disabled\': !isLocalVideoButtonEnabled() }" class="calling btn primary circle large toggleVideo protected" type="button">\r\n                <span class="iconfont videoOn" data-bind="css: { videoOffStatus: !isLocalVideoOn() }, text: videoStateText"></span>\r\n            </button>\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n\r\n        <!-- ko with: micControl -->\r\n        <button data-bind="click: toggleMicrophone, event: {focus: $parent.onButtonFocused, blur: $parent.onButtonBlurred}, enable: isMicrophoneAvailable(), css: { selected: isMicrophoneOn(), disabled: !isMicrophoneButtonEnabled() }, attr: { title: microphoneStateText, \'aria-disabled\': !isMicrophoneButtonEnabled() }" class="calling btn primary circle large toggleMic protected" type="button">\r\n            <span class="iconfont microphoneOn" data-bind="css: { microphoneOffStatus: !isMicrophoneOn() }, text: microphoneStateText"></span>\r\n        </button>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: showDialpadControl -->\r\n            <!-- ko with: dialpadControl -->\r\n            <div class="DialPadController">\r\n                <div class="DialPadController-container popup arrow down" data-bind="css: { \'DialPadController-container--active\': displayDialpad() }">\r\n                    <div class="DialPadController-inputContainer">\r\n                        <input type="text" name="dialPadController-input" class="DialPadController-input" data-bind="textInput: dialpadText" readonly="true" disabled />\r\n                    </div>\r\n                    <swx-dialpad class="DialPad DialPad--themeDark"></swx-dialpad>\r\n                </div>\r\n                <button data-bind="click: toggleDialpad, event: {focus: $parent.onButtonFocused, blur: $parent.onButtonBlurred}, enable: isDialpadButtonEnabled(), css: { disabled: !isDialpadButtonEnabled() }, attr: { title: dialpadStateText, \'aria-disabled\': !isDialpadButtonEnabled() }" class="calling btn primary circle large toggleDialpad protected" type="button">\r\n                    <span class="iconfont dialpad" data-bind="css: { dialpadOff: !isDialpadButtonEnabled() }, text: dialpadStateText"></span>\r\n                </button>\r\n            </div>\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: hasMoreThanOneMoreAction -->\r\n            <!-- ko with: moreActionsControl -->\r\n            <button data-bind="click: showMoreActionsMenu, enable: isMoreActionsButtonEnabled(), css: { disabled: !isMoreActionsButtonEnabled() }, event: {focus: $parent.onButtonFocused, blur: $parent.onButtonBlurred}, attr: { title: moreActionsText, \'aria-disabled\': !isMoreActionsButtonEnabled() }" class="calling btn primary circle large plus protected" type="button">\r\n                <span class="iconfont plus"></span>\r\n            </button>\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n\r\n        <!-- ko ifnot: hasMoreThanOneMoreAction -->\r\n            <!-- ko if: isLocalEscalationEnabled -->\r\n                <!-- ko with: moreActionsControl -->\r\n                <button data-bind="click: addParticipants, enable: isAddingParticipantsAllowed(), css: { disabled: !isAddingParticipantsAllowed() }, event: {focus: $parent.onButtonFocused, blur: $parent.onButtonBlurred}, attr: { title: addParticipantText, \'aria-disabled\': !isAddingParticipantsAllowed() }" class="calling btn primary circle large toggleAdd protected" type="button">\r\n                    <span class="iconfont contactAdd"></span>\r\n                </button>\r\n                <!-- /ko -->\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: isScreenSharingEnabled -->\r\n                <!-- ko with: moreActionsControl -->\r\n                <button data-bind="click: shareScreen, enable: isScreenSharingAllowed(), css: { disabled: !isScreenSharingAllowed() }, event: {focus: $parent.onButtonFocused, blur: $parent.onButtonBlurred}, attr: { title: screenShareText, \'aria-disabled\': !isScreenSharingAllowed() }" class="calling btn primary circle large screenshare protected" type="button">\r\n                    <span class="iconfont screenshare"></span>\r\n                </button>\r\n                <!-- /ko -->\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: isAVSettingsEnabled -->\r\n                <!-- ko with: moreActionsControl -->\r\n                <button data-bind="click: avSettings, enable: true, css: { disabled: false }, event: {focus: $parent.onButtonFocused, blur: $parent.onButtonBlurred}, attr: { title: avSettingsText }" class="calling btn primary circle large toggleAdd protected" type="button">\r\n                    <span class="iconfont settings"></span>\r\n                </button>\r\n                <!-- /ko -->\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n\r\n        <!-- ko with: endCallControl -->\r\n        <button data-bind="click: endCall, event: {focus: $parent.onButtonFocused, blur: $parent.onButtonBlurred}, enable: isCallControlEnabled(), css: { disabled: !isCallControlEnabled() }, l10n_attr: { \'title\': \'callscreen_text_endCall\' }" class="calling btn primary circle large red endCall protected" type="button">\r\n            <span class="iconfont callEnd" data-bind="l10n: { \'key\': \'callscreen_text_endCall\' }"></span>\r\n        </button>\r\n        <!-- /ko -->\r\n    </div>\r\n</div>\r\n'}),define("ui/components/calling/callScreenFooter",["require","exports","module","vendor/knockout","jsviews/calling/callScreenFooter","ui/viewModels/calling/callScreenViewModel/callScreenFooterViewModel","constants/components","text!views/calling/callScreenFooter.html"],function(e,t){function s(e,t){var s=i.build(e.conversation,t.element),o=r.build(t.element),u=n.dataFor(t.element);return s.setContext(u),s.init(o),s}var n=e("vendor/knockout"),r=e("jsviews/calling/callScreenFooter"),i=e("ui/viewModels/calling/callScreenViewModel/callScreenFooterViewModel");t.name=e("constants/components").calling.FOOTER,t.template=e("text!views/calling/callScreenFooter.html"),t.viewModel={createViewModel:s}}),define("ui/modelObservers/calling/activeCallObserver",["require","exports","module","swx-constants","swx-service-locator-instance","vendor/knockout"],function(e,t){function s(){function u(t){e.isCallActive(t.length>0)}var e=this,t,s,o;s=r.resolve(n.serviceLocator.FEATURE_FLAGS).isFeatureOn(n.featureFlags.DISABLE_CONCURRENT_ACTIVE_CALLS),o=r.resolve(n.serviceLocator.MODEL_UI_OBSERVER).conversationsCallStateObserver,e.isCallActive=i.observable(s&&o.activeCalls().length>0),e.dispose=function(){s&&t.dispose()},s&&(t=o.activeCalls.subscribe(u))}var n=e("swx-constants").COMMON,r=e("swx-service-locator-instance").default,i=e("vendor/knockout");t.build=function(){return new s}}),define("ui/viewModels/chat/conversationActivity",["require","exports","module","vendor/knockout","swx-enums","browser/window","ui/modelObservers/calling/activeCallObserver"],function(e,t){function o(e){function c(e){t.isOnCall(e===r.callConnectionState.Connected)}function h(){var n=!!e.activeModalities.audio(),i=e.selfParticipant.audio.state()===r.callConnectionState.Disconnected||e.selfParticipant.audio.state()===r.callConnectionState.Notified,s=e.isGroupConversation();l.isCallActive()?t.canJoinCall(!1):t.canJoinCall(s&&n&&i)}function p(e){c(e),h(e);switch(e){case r.callConnectionState.Connected:m();break;case r.callConnectionState.Disconnected:g()}}function d(e,n){var i=!e,s=n!==r.callingNotSupportedReasons.PluginNotInstalled;t.isCallingDisabled(i&&s)}function v(e,n){var i=!e,s=n!==r.callingNotSupportedReasons.PluginNotInstalled;t.isVideoCallingDisabled(i&&s)}function m(){o||(t.callDuration(f),u=e.audioService.callConnected(),o=i.setInterval(y,a))}function g(){o&&(i.clearInterval(o),o=null,t.callDuration(f))}function y(){var e=new Date,n=e-u;t.callDuration(n)}function b(){return t.isCallingDisabled()||!t.canJoinCall()}function w(){return t.isVideoCallingDisabled()||!t.canJoinCall()}var t=this,o,u,a=1e3,f=-1,l=s.build();t.callDuration=n.observable(f),t.isOnCall=n.observable(!1),t.isCallingDisabled=n.observable(!0),t.isVideoCallingDisabled=n.observable(!0),t.canJoinCall=n.observable(!1),t.isJoinCallDisabled=n.computed(b),t.isJoinCallWithVideoDisabled=n.computed(w),e.selfParticipant.audio.state.changed(p),e.activeModalities.audio.changed(h),e.audioService.start.enabled.changed(d),e.videoService.start.enabled.changed(v),t.dispose=function(){l.dispose(),t.isJoinCallDisabled.dispose(),t.isJoinCallWithVideoDisabled.dispose(),e.selfParticipant.audio.state.changed.off(p),e.activeModalities.audio.changed.off(h),e.audioService.start.enabled.changed.off(d),e.videoService.start.enabled.changed.off(v),o&&(i.clearInterval(o),o=null)}}var n=e("vendor/knockout"),r=e("swx-enums"),i=e("browser/window"),s=e("ui/modelObservers/calling/activeCallObserver");t.classFunction=o,t.build=function(e){return new o(e)}}),define("ui/viewModels/calling/joinCallButtonViewModel",["require","lodash-compat","utils/common/eventMixin","swx-i18n","swx-cafe-application-instance","ui/telemetry/actions/actionNames","ui/viewModels/calling/helpers/callingFacade","ui/viewModels/chat/conversationActivity","swx-constants","swx-service-locator-instance"],function(e){function l(e){function c(e){e=e?!0:!1;var t=e?"joinCallWithVideoButton":"joinCallButton";i.get().conversationsManager.conversations.add(n),o.placeCall(n,e,t)}var t=this,n=e.conversationModel,l;l=u.build(n),t.icon=e.showIcon?e.withVideo?"video":"callStart":"",t.cssClass=e.cssClass,t.tabIndex=e.tabIndex,t.isOnCall=l.isOnCall,t.isJoinCallDisabled=e.withVideo?l.isJoinCallWithVideoDisabled:l.isJoinCallDisabled,t.joinCallTitle=e.withVideo?r.fetch({key:"button_text_joinCallWithVideo"}):r.fetch({key:"button_text_joinCall"}),t.joinCallTextKey=e.withVideo?"button_text_joinCallWithVideo":"button_text_joinCall",t.joinCall=function(){var t=f.resolve(a.serviceLocator.ACTION_TELEMETRY),n=e.withVideo?s.audioVideo.joinCallWithVideo:s.audioVideo.joinCall;t.recordAction(n),c(e.withVideo)},t.dispose=function(){l.dispose()}}var t=e("lodash-compat"),n=e("utils/common/eventMixin"),r=e("swx-i18n").localization,i=e("swx-cafe-application-instance"),s=e("ui/telemetry/actions/actionNames"),o=e("ui/viewModels/calling/helpers/callingFacade"),u=e("ui/viewModels/chat/conversationActivity"),a=e("swx-constants").COMMON,f=e("swx-service-locator-instance").default;return t.assign(l.prototype,n),l}),define("text!views/calling/joinCallButton.html",[],function(){return' <swx-button params="icon: icon,\r\n                        cssClass: cssClass,\r\n                        disabled: isJoinCallDisabled,\r\n                        action: joinCall,\r\n                        withVideo: false,\r\n                        titleKey: joinCallTextKey,\r\n                        textKey: joinCallTextKey,\r\n                        i18nTitle: joinCallTitle,\r\n                        ariaLabelKey: joinCallTextKey"></swx-button>\r\n'}),define("ui/components/calling/joinCallButton",["require","exports","module","vendor/knockout","ui/viewModels/calling/joinCallButtonViewModel","constants/components","text!views/calling/joinCallButton.html"],function(e,t){function i(e,t){var i=new r(e);return i.setContext(n.dataFor(t.element)),i}var n=e("vendor/knockout"),r=e("ui/viewModels/calling/joinCallButtonViewModel");t.name=e("constants/components").calling.JOINCALL_BUTTON,t.template=e("text!views/calling/joinCallButton.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/calling/startCallButtonViewModel",["require","exports","module","lodash-compat","utils/common/eventMixin","vendor/knockout","swx-constants","swx-service-locator-instance","ui/contextMenu/menuItemHelper","ui/contextMenu/items/all","ui/modelHelpers/personHelper"],function(e,t){function l(e){function c(){n.callButtonViewModel.conversationModel.participants.changed.off(p),t=null}function h(){t&&t.phoneNumbers.changed.off(d)}function p(){h(),n.callButtonViewModel.isOneToOneConversation()&&(t=n.callButtonViewModel.participantPerson(),t.phoneNumbers.changed(d))}function d(){n.phoneNumbers(t.phoneNumbers())}function v(){return!!n.phoneNumbers().length}function m(){var e=o.resolve(s.serviceLocator.FEATURE_FLAGS);return e.isFeatureOn(s.featureFlags.PSTN_ENABLED)}var t,n=this,r=e.historyOrigin,l=e.telemetryContext;n.callButtonViewModel=e.callButtonViewModel,n.phoneNumbers=i.observable([]),n.callButtonViewModel.conversationModel.participants.changed(p),n.getMenuOptions=function(){var e,t=[],i={getPerson:n.callButtonViewModel.participantPerson};return m()&&(f.isPstn(n.callButtonViewModel.participantPerson())||t.push(new a.CallSkypeMenuItem(i,r,l)),e=u.getCallPhoneContextMenuItems(i,r,l),e&&!!e.length&&Array.prototype.push.apply(t,e)),t},n.hasMenuOptions=function(){function e(){return n.getMenuOptions().filter(function(e){return e.isEnabled()})}return n.callButtonViewModel.isOneToOneConversation()&&v()&&e().length>1},n.dispose=function(){h(),c()}}var n=e("lodash-compat"),r=e("utils/common/eventMixin"),i=e("vendor/knockout"),s=e("swx-constants").COMMON,o=e("swx-service-locator-instance").default,u=e("ui/contextMenu/menuItemHelper"),a=e("ui/contextMenu/items/all"),f=e("ui/modelHelpers/personHelper");n.assign(l.prototype,r),t.classFunction=l,t.build=function(e){return new l(e)}}),define("text!views/calling/startCallButton.html",[],function(){return"<swx-button params=\"icon: 'callStart',\r\n                cssClass: 'primary circle',\r\n                disabled: callButtonViewModel.isAudioDisabled,\r\n                textKey: 'button_text_audioCall',\r\n                i18nTitle: callButtonViewModel.buttonCallTitle,\r\n                action: callButtonViewModel.startCallWithAudio,\r\n                ariaLabel: callButtonViewModel.buttonCallAriaLabel\"></swx-button>\r\n"}),define("ui/components/calling/startCallButton",["require","exports","module","vendor/knockout","ui/viewModels/calling/startCallButtonViewModel","constants/components","text!views/calling/startCallButton.html"],function(e,t){function i(e,t){var i=r.build(e);return i.setContext(n.dataFor(t.element)),i}var n=e("vendor/knockout"),r=e("ui/viewModels/calling/startCallButtonViewModel");t.name=e("constants/components").calling.START_CALL_BUTTON,t.template=e("text!views/calling/startCallButton.html"),t.viewModel={createViewModel:i}}),define("ui/calling/telemetry/cqfActions",["require","exports","module","swx-constants","swx-log-tracer","experience/settings","ui/telemetry/telemetryClient"],function(e,t){function u(){function e(e){var o={call_id:e.callId,call_mos_score_questionary_id:e.questionaryId,call_mos_score:e.score,call_mos_score_tracking_reason:e.reason,call_mos_score_problem_tokens:t(e)};e.nodeId&&(o.node_id=e.nodeId),e.ngcEndpointId&&(o.endpoint_id=e.ngcEndpointId),e.ngcParticipantId&&(o.participant_id=e.ngcParticipantId),r.log("[CQF Telemetry] event",n.MASTER_EVENT,"data",o),s.get().sendEvent(i.telemetry.uiTenantToken,n.MASTER_EVENT,o)}function t(e){var t=n.PROBLEM_TOKEN_PREFIX,r="%20",i=e.tokensSelected||[],s=e.othersSelected||[];return t+=i.concat(s).map(function(e){return e.token}).join(r),s.forEach(function(e){e.token&&e.value&&(t+="&"+e.token+"="+encodeURIComponent(e.value).replace(/'/g,escape))}),t}this.submit=function(t){if(typeof t.score!="number")return this.cancel(t);t.reason=n.reason.RANDOM,e(t)},this.cancel=function(t){t.score="",t.reason=n.reason.CANCEL,t.problemTokens=n.PROBLEM_TOKEN_PREFIX,t.tokensSelected=[],t.othersSelected=[],e(t)}}var n=e("swx-constants").COMMON.telemetry.callQualityFeedback,r=e("swx-log-tracer").getLogger(),i=e("experience/settings"),s=e("ui/telemetry/telemetryClient"),o;t.get=function(){return o||(o=new u),o}}),define("services/cqf/questionnaire",[],function(){return[{qid:104},{category:"q",token:101,uri:"skype:?cqg&target=audio.nolocal&ui_entrypoint=cqf",text:"cqf_audio_nolocal"},{category:"q",token:102,uri:"skype:?cqg&target=audio.noremote&ui_entrypoint=cqf",text:"cqf_audio_noremote"},{category:"q",token:103,uri:"skype:?cqg&target=audio.quality.echo&ui_entrypoint=cqf",text:"cqf_audio_quality_echo"},{category:"q",token:104,uri:"skype:?cqg&target=audio.quality.noise&ui_entrypoint=cqf",text:"cqf_audio_quality_noise"},{category:"q",token:105,uri:"skype:?cqg&target=audio.quality.volume&ui_entrypoint=cqf",text:"cqf_audio_quality_volume"},{category:"q",token:106,uri:"skype:?cqg&target=audio.dropped&ui_entrypoint=cqf",text:"cqf_audio_dropped"},{category:"q",token:107,uri:"skype:?cqg&target=audio.quality.distorted&ui_entrypoint=cqf",text:"cqf_audio_quality_distorted"},{category:"q",token:108,uri:"skype:?cqg&target=audio.quality.delay&ui_entrypoint=cqf",text:"cqf_audio_quality_delay"},{category:"pq",token:301,uri:"skype:?cqg&target=audio.quality.dialpad&ui_entrypoint=cqf",text:"cqf_audio_quality_dialpad"},{category:"qe",token:109,uri:"skype:?cqg&target=audio.other&ui_entrypoint=cqf",text:"cqf_audio_other",editlength:100},{category:"vq",token:201,uri:"skype:?cqg&target=video.nolocal&ui_entrypoint=cqf",text:"cqf_video_nolocal"},{category:"vq",token:202,uri:"skype:?cqg&target=video.noremote&ui_entrypoint=cqf",text:"cqf_video_noremote"},{category:"vq",token:203,uri:"skype:?cqg&target=video.quality.poor&ui_entrypoint=cqf",text:"cqf_video_quality_poor"},{category:"vq",token:204,uri:"skype:?cqg&target=video.quality.freezing&ui_entrypoint=cqf",text:"cqf_video_quality_freezing"},{category:"vq",token:205,uri:"skype:?cqg&target=video.dropped&ui_entrypoint=cqf",text:"cqf_video_dropped"},{category:"vq",token:206,uri:"skype:?cqg&target=video.quality.dark&ui_entrypoint=cqf",text:"cqf_video_quality_dark"},{category:"vq",token:207,uri:"skype:?cqg&target=video.quality.sync&ui_entrypoint=cqf",text:"cqf_video_quality_sync"},{category:"vqe",token:208,uri:"skype:?cqg&target=video.other&ui_entrypoint=cqf",text:"cqf_video_other",editlength:100}]}),define("ui/viewModels/calling/cqfViewModel",["require","lodash-compat","swx-constants","ui/calling/telemetry/cqfActions","utils/common/eventMixin","swx-i18n","vendor/knockout","services/cqf/questionnaire","utils/common/scroll","experience/settings","browser/window","utils/common/accessibility"],function(e){function h(){function p(){function t(e){return e.category==="q"||e.category==="qe"}function n(e){return e.category==="pq"}function r(e){return e.category==="vq"||e.category==="vqe"}u.forEach(function(i){i.checked=o.observable(!1),i.comment=o.observable(),i.qid&&(e.callData.questionaryId=i.qid),t(i)&&e.audioQuestions.push(i),n(i)&&e.isPSTN&&e.audioQuestions.push(i),r(i)&&e.isVideoCall&&e.videoQuestions.push(i)})}function d(){i=l.setTimeout(e.close,f.cqf.inactivityTimeout)}function v(){i&&(l.clearTimeout(i),i=null)}function m(){e.selectedStar()===-1?e.close():e.submitWithoutTokens()}function g(){e.callData.score=e.selectedStar()}function y(){e.callData.tokensSelected=[],e.callData.othersSelected=[],e.audioQuestions.concat(e.videoQuestions).forEach(function(t){t.checked()&&e.callData.tokensSelected.push({token:t.token}),t.comment()&&t.comment().trim().length>0&&e.callData.othersSelected.push({token:t.token,value:t.comment()})})}function b(){c.announce(s.fetch({key:"cqf_thanks_title"})),e.currentStep(n.CQF.STEPS.THANKS),l.setTimeout(function(){e.dispatchEvent(n.EVENTS.CQF_SCREEN_CLOSE,e.DIRECTION.PARENT)},n.CQF.THANKS_TIMEOUT)}var e=this,t,i;e.currentStep=o.observable(n.CQF.STEPS.INTRO),e.selectedStar=o.observable(-1),e.canBeSubmitted=o.observable(!1),e.audioQuestions=[],e.videoQuestions=[];var h=e.selectedStar.subscribe(function(){e.canBeSubmitted(!0),v()});e.init=function(r,i){e.isVideoCall=r.callData.isVideo,e.isPSTN=r.callData.isPSTN,e.callData=r.callData,e.questionsTitle=o.computed(function(){return e.isVideoCall?s.fetch({key:"cqf_video_title"}):s.fetch({key:"cqf_audio_title"})}),t=a.build(i),t.init(),p(),d(),e.registerEvent(n.EVENTS.CQF_CANCEL,m)},e.close=function(){v(),r.get().cancel(e.callData),e.selectedStar(0),e.dispatchEvent(n.EVENTS.CQF_SCREEN_CLOSE,e.DIRECTION.PARENT)},e.handleStarRating=function(){e.selectedStar()===4?e.submitWithoutTokens():e.currentStep(n.CQF.STEPS.QUESTIONNAIRE)},e.submitWithoutTokens=function(){g(),r.get().submit(e.callData),b()},e.submit=function(){g(),y(),r.get().submit(e.callData),b()},e.dispose=function(){t.dispose(),h.dispose()}}var t=e("lodash-compat"),n=e("swx-constants").CALLING,r=e("ui/calling/telemetry/cqfActions"),i=e("utils/common/eventMixin"),s=e("swx-i18n").localization,o=e("vendor/knockout"),u=e("services/cqf/questionnaire"),a=e("utils/common/scroll"),f=e("experience/settings"),l=e("browser/window"),c=e("utils/common/accessibility").narrator;return t.assign(h.prototype,i),{build:function(){return new h}}}),define("text!views/calling/cqf.html",[],function(){return'<div class="CallQualityFeedback">\r\n    <div class="CallQualityFeedback-content">\r\n    	<!-- ko if: currentStep() === \'intro\' -->\r\n    	<div class="CallQualityFeedback-step1" role="dialog" aria-labelledby="cqf-step1-title">\r\n    		<div>\r\n				<h1 id="cqf-step1-title" data-bind="l10n: {key: \'cqf_title\'}"></h1>\r\n                <swx-star-rating params="selectedStar: selectedStar"></swx-star-rating>\r\n\r\n				<!-- ko if: !canBeSubmitted() -->\r\n				<button class="btn secondary circle stroke" data-bind="click: close, l10n_attr: {\'aria-label\': \'cqf_accessibility_cancel_btn\', \'title\': \'cqf_accessibility_cancel_btn\'}" type="button">\r\n					<span class="iconfont cancel"></span>\r\n				</button>\r\n				<!-- /ko -->\r\n\r\n				<!-- ko if: canBeSubmitted() -->\r\n				<button class="btn secondary circle stroke" data-bind="click: handleStarRating, l10n_attr: {\'aria-label\': \'cqf_accessibility_submit_btn\', \'title\': \'cqf_accessibility_submit_btn\'}" type="button">\r\n					<span class="iconfont ok"></span>\r\n				</button>\r\n				<!-- /ko -->\r\n			</div>\r\n		</div>\r\n		<!-- /ko -->\r\n\r\n		<!-- ko if: currentStep() === \'questionnaire\' -->\r\n		<div class="CallQualityFeedback-QuestionsWrapper CallQualityFeedback-step2" data-bind="css: {\'CallQualityFeedback-QuestionWrapper--withVideo\': isVideoCall}" role="dialog" aria-labelledby="cqf-step2-title" tabindex="-1">\r\n			 <div class="scrollWrapper">\r\n				<div class="scrollViewport scrollViewportV">\r\n					<h2 id="cqf-step2-title" data-bind="text: questionsTitle" role="heading"></h2>\r\n\r\n					<div class="CallQualityFeedback-Questions">\r\n						<div class="CallQualityFeedback-audioQuestions">\r\n							<h3 data-bind="l10n: {key: \'cqf_audio_tokens_title\'}"></h3>\r\n							<!-- ko foreach: audioQuestions -->\r\n							<swx-cqf-question params="question: $data"></swx-cqf-question>\r\n							<!-- /ko -->\r\n						</div>\r\n\r\n						<!-- ko if: isVideoCall -->\r\n						<div class="CallQualityFeedback-videoQuestions">\r\n							<h3 data-bind="l10n: {key: \'cqf_video_tokens_title\'}"></h3>\r\n							<!-- ko foreach: videoQuestions -->\r\n							<swx-cqf-question params="question: $data"></swx-cqf-question>\r\n							<!-- /ko -->\r\n						</div>\r\n						<!-- /ko -->\r\n					</div>\r\n				</div>\r\n\r\n				<div class="CallQualityFeedback-Actions">\r\n					<div class="CallQualityFeedback-ActionsWrapper">\r\n						<button class="btn secondary circle stroke" data-bind="click: submitWithoutTokens, l10n_attr: {\'aria-label\': \'cqf_accessibility_cancel_btn\', \'title\': \'cqf_accessibility_cancel_btn\'}" type="button">\r\n							<span class="iconfont cancel"></span>\r\n						</button>\r\n						<button class="btn secondary circle stroke" data-bind="click: submit, l10n_attr: {\'aria-label\': \'cqf_accessibility_submit_btn\', \'title\': \'cqf_accessibility_submit_btn\'}" type="button">\r\n							<span class="iconfont ok"></span>\r\n						</button>\r\n					</div>\r\n				</div>\r\n			</div>\r\n		</div>\r\n		<!-- /ko -->\r\n\r\n		<!-- ko if: currentStep() === \'thanks\' -->\r\n    	<div class="CallQualityFeedback-step3" aria-labelledby="cqf-step3-title">\r\n    		<div>\r\n				<h1 id="cqf-step3-title" data-bind="l10n: {key: \'cqf_thanks_title\'}"></h1>\r\n			</div>\r\n		</div>\r\n		<!-- /ko -->\r\n\r\n	</div>\r\n</div>\r\n'}),define("ui/components/calling/cqf",["require","exports","module","vendor/knockout","ui/viewModels/calling/cqfViewModel","constants/components","text!views/calling/cqf.html"],function(e,t){function i(e,t){var i=r.build(),s=t.element.getElementsByClassName("scrollWrapper")[0];return i.setContext(n.dataFor(t.element)),i.init(e,s),i}var n=e("vendor/knockout"),r=e("ui/viewModels/calling/cqfViewModel");t.name=e("constants/components").calling.CQF,t.template=e("text!views/calling/cqf.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/calling/cqfStarRatingViewModel",["require","browser/document"],function(e){function n(e){function a(){var e=t.querySelector(".CallQualityFeedbackStarRating .selected");if(e)return e}function f(e){e.firstElementChild.classList.remove(u),e.firstElementChild.classList.add(o)}function l(e){e.firstElementChild.classList.remove(o),e.firstElementChild.classList.add(u)}function c(e){var t=e.previousElementSibling;while(t&&t.classList.contains(i))f(t),t=t.previousElementSibling}function h(){var e=a();p(),e&&(f(e),c(e))}function p(){var e;for(e=0;e<r.length;++e)l(r[e])}var n=this,r=t.querySelectorAll(".CallQualityFeedbackStarRating .btn"),i="btn",s="selected",o="favouriteOn",u="favouriteOff";n.selectedStar=e.selectedStar,n.mouseoverHandler=function(e,t){var n=t.currentTarget;f(n),c(n)},n.mouseoutHandler=function(){h()},n.clickHandler=function(e,t){var r=t.currentTarget,i=a();i&&i.classList.remove(s),n.selectedStar(parseInt(r.getAttribute("data-value"))),r.classList.add(s),h()}}var t=e("browser/document");return{build:function(e){return new n(e)}}}),define("text!views/calling/cqfStarRating.html",[],function(){return'<div class="CallQualityFeedbackStarRating">\r\n    <button class="btn transparent" type="button" data-bind="event: {mouseover: mouseoverHandler, mouseout: mouseoutHandler}, click: clickHandler, attr: {\'aria-selected\': selectedStar() === 0 ? \'true\' : \'false\'}, l10n_attr: {\'aria-label\': \'cqf_accessibility_oneStar_ariaLabel\'}, focusHandler: { priority: 1 }" data-value="0">\r\n        <span class="iconfont favouriteOff"></span>\r\n    </button>\r\n    <button class="btn transparent" type="button" data-bind="event: {mouseover: mouseoverHandler, mouseout: mouseoutHandler}, click: clickHandler, attr: {\'aria-selected\': selectedStar() === 1 ? \'true\' : \'false\'}, l10n_attr: {\'aria-label\': \'cqf_accessibility_twoStars_ariaLabel\'}" data-value="1">\r\n        <span class="iconfont favouriteOff"></span>\r\n    </button>\r\n    <button class="btn transparent" type="button" data-bind="event: {mouseover: mouseoverHandler, mouseout: mouseoutHandler}, click: clickHandler, attr: {\'aria-selected\': selectedStar() === 2 ? \'true\' : \'false\'}, l10n_attr: {\'aria-label\': \'cqf_accessibility_threeStars_ariaLabel\'}" data-value="2">\r\n        <span class="iconfont favouriteOff"></span>\r\n    </button>\r\n    <button class="btn transparent" type="button" data-bind="event: {mouseover: mouseoverHandler, mouseout: mouseoutHandler}, click: clickHandler, attr: {\'aria-selected\': selectedStar() === 3 ? \'true\' : \'false\'}, l10n_attr: {\'aria-label\': \'cqf_accessibility_fourStars_ariaLabel\'}" data-value="3">\r\n        <span class="iconfont favouriteOff"></span>\r\n    </button>\r\n    <button class="btn transparent" type="button" data-bind="event: {mouseover: mouseoverHandler, mouseout: mouseoutHandler}, click: clickHandler, attr: {\'aria-selected\': selectedStar() === 4 ? \'true\' : \'false\'}, l10n_attr: {\'aria-label\': \'cqf_accessibility_fiveStars_ariaLabel\'}" data-value="4">\r\n        <span class="iconfont favouriteOff"></span>\r\n    </button>\r\n</div>\r\n'}),define("ui/components/calling/cqfStarRating",["require","exports","module","ui/viewModels/calling/cqfStarRatingViewModel","constants/components","text!views/calling/cqfStarRating.html"],function(e,t){function r(e){return n.build(e)}var n=e("ui/viewModels/calling/cqfStarRatingViewModel");t.name=e("constants/components").calling.CQF_STAR_RATING,t.template=e("text!views/calling/cqfStarRating.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/calling/cqfQuestionViewModel",[],function(){function e(e){var t=this;t.text=e.question.text,t.checked=e.question.checked,t.comment=e.question.comment,t.editlength=e.question.editlength,t.isWithTextarea=!!e.question.editlength,t.category=e.question.category,t.isAudio=function(){return t.category!=="vq"&&t.category!=="vqe"},t.clickAction=function(){t.isWithTextarea||t.checked(!t.checked())},t.checkCommentLength=function(){t.comment()&&t.comment().length>t.editlength&&t.comment(t.comment().substring(0,t.editlength))}}return{build:function(t){return new e(t)}}}),define("text!views/calling/cqfQuestion.html",[],function(){return'<div class="CallQualityFeedbackQuestion" data-bind="click: clickAction, css: {\'CallQualityFeedbackQuestion--withTextarea\': editlength}">\r\n	<div class="CallQualityFeedbackQuestion-text" data-bind="l10n: {key: text}" aria-hidden="true"></div>\r\n\r\n	<!-- ko if: !isWithTextarea -->\r\n    <div class="CallQualityFeedbackQuestion-checkbox" role="checkbox" tabindex="0"\r\n         data-bind="hasFocus: $index() === 0 && isAudio(), css: {\'CallQualityFeedbackQuestion-checkbox--checked\': checked()}, attr: {\'aria-checked\': checked() ? \'true\' : \'false\'}, l10n_attr: {\'aria-label\': text}, enterKey: clickAction">\r\n        <div></div>\r\n    </div>\r\n	<!-- /ko -->\r\n\r\n	<!-- ko if: isWithTextarea -->\r\n	<textarea class="CallQualityFeedbackQuestion-textarea"\r\n              data-bind="textInput: comment, valueUpdate: \'afterkeydown\', event: {\'keyup\': checkCommentLength }, attr: {maxlength: editlength}, l10n_attr: {\'aria-label\': text}"></textarea>\r\n	<!-- /ko -->\r\n</div>\r\n'}),define("ui/components/calling/cqfQuestion",["require","exports","module","ui/viewModels/calling/cqfQuestionViewModel","constants/components","text!views/calling/cqfQuestion.html"],function(e,t){function r(e){return n.build(e)}var n=e("ui/viewModels/calling/cqfQuestionViewModel");t.name=e("constants/components").calling.CQF_QUESTION,t.template=e("text!views/calling/cqfQuestion.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/calling/skypeOutViewModel",["require","exports","module","lodash-compat","swx-constants","browser/dom","utils/common/scroll","utils/common/eventMixin","swx-service-locator-instance"],function(e,t){function a(){var e=this,t,n,o="#SkypeOutBody-scrollWrapper";e.init=function(u){e.forwardEvent(r.events.skypeOut.DIAL_BUTTON_CLICKED,e.DIRECTION.CHILD),n=i.getElement(o,u),t=s.build(n),t.init()},e.dispose=function(){t.dispose()},e.isBusinessMode=u.resolve(r.serviceLocator.FEATURE_FLAGS).isFeatureOn(r.featureFlags.USE_BUSINESS_WORDING)}var n=e("lodash-compat"),r=e("swx-constants").COMMON,i=e("browser/dom"),s=e("utils/common/scroll"),o=e("utils/common/eventMixin"),u=e("swx-service-locator-instance").default;n.assign(a.prototype,o),t.build=function(){return new a}}),define("text!views/calling/skypeOut.html",[],function(){return'<div class="SkypeOutPage themeWhite" data-swx-testId="skypeOutPage">\r\n    <swx-skype-out-header class="SkypeOutHeader"></swx-skype-out-header>\r\n\r\n    <div class="SkypeOutPage-body" id="SkypeOutBody-scrollWrapper">\r\n        <div class="scrollViewport scrollViewportV" tabindex="-1">\r\n            <div class="SkypeOutBody-scrollContent scrollViewport-inner">\r\n                <div class="SkypeOutPage-content">\r\n                    <swx-dialpad role="list" class="DialPad" data-bind="keyboardNavigation: { itemSelector: \'.DialPad-key\' }" data-swx-testId="skypeOut-dialpad"></swx-dialpad>                    \r\n                    \r\n                    <div class="SkypeOutOffers"  data-bind="if: !isBusinessMode">\r\n                        <swx-credit-balance class="SkypeOutOffer SkypeOutOffer--creditBalance"></swx-credit-balance>\r\n                        <swx-subscription-entitlement class="SkypeOutOffer SkypeOutOffer--subscriptionEntitlement"></swx-subscription-entitlement>\r\n                        <div class="SkypeOutOffer SkypeOutOffer--pstnNotice">\r\n                            <div class="SkypeOutOffer-body">\r\n                                <span class="iconfont callDisabledStatus SkypeOutOffer-icon SkypeOutOffer-icon--callDisabledStatus"></span>\r\n                                <div class="SkypeOutOffer-content">\r\n                                    <p class="SkypeOutOffer-text" data-bind="l10n: { key: \'pstn_emergency_notice_text\' }">Skype for Web (Beta) is not a replacement for your telephone and can\'t be used for emergency calling.</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/calling/skypeOut",["require","exports","module","vendor/knockout","ui/viewModels/calling/skypeOutViewModel","constants/components","text!views/calling/skypeOut.html"],function(e,t){function i(e,t){var i=r.build(),s=n.dataFor(t.element);return i.setContext(s),i.init(t.element),i}var n=e("vendor/knockout"),r=e("ui/viewModels/calling/skypeOutViewModel");t.name=e("constants/components").calling.SKYPEOUT_PAGE,t.template=e("text!views/calling/skypeOut.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/calling/skypeOut/skypeOutHeaderViewModel",["require","exports","module","lodash-compat","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","swx-cafe-application-instance","ui/viewModels/calling/helpers/callingFacade","swx-constants","swx-constants","swx-enums","utils/common/eventHelper","utils/common/eventMixin","utils/common/localStorage","swx-constants","vendor/knockout","telemetry/calling/pstn/pstn","swx-service-locator-instance","swx-utils-common","swx-constants"],function(e,t){function E(){function N(){var t=e.skypeOutInput();return t=t.replace(/\D/g,""),t.length>=10&&t.length<=15}function C(){e.hasFocus(!0)}function k(){e.hasFocus(!1)}function L(e){x=e}function A(e){t.selectionStart=e,t.selectionEnd=e}function O(e){e&&(x=null)}function M(t){if(t===T)return;w.test(t)?(T=t,_(t)||e.dispatchEvent(u.events.skypeOut.INPUT_CHANGED,e.skypeOutInput(),e.DIRECTION.CHILD)):(e.skypeOutInput(T),O(!0))}function _(t){var n,r;return n=t.substr(0,2),n==="00"?(r="+"+t.substr(2),e.skypeOutInput(r),e.hasFocus()?A(1):L(1),!0):!1}function D(){return x!==null}function P(){D()||C()}var e=this,t,n=m.resolve(u.serviceLocator.PUBSUB),a=m.resolve(u.serviceLocator.MODEL_UI_OBSERVER).conversationsCallStateObserver,c,E,S,x=null,T="";e.hasFocus=d.observable(!0),e.skypeOutInput=d.observable(""),e.isCallButtonDisabled=d.computed(function(){return a.activeCalls().length>0||!N()}),e.selectedCountry=d.observable(),e.init=function(r){t=r,e.registerEvent(u.events.skypeOut.DIAL_BUTTON_CLICKED,e.insertAtCursor),n.subscribe(u.events.navigation.FRAGMENT_LOADED,C),c=e.skypeOutInput.subscribe(M),E=e.selectedCountry.subscribe(P),S=e.hasFocus.subscribe(O)},e.insertAtCursor=function(n){var r=D()?x:t.selectionStart,i=D()?x:t.selectionEnd,s=e.skypeOutInput(),o=g.inject(s,n.text,r,i);L(r+n.text.length),e.skypeOutInput(o)},e.onKeyDown=function(t,n){var r=l.getKeyCode(n);if(r===p.ESCAPE){e.skypeOutInput()?(e.resetSkypeOutInput(),C()):k(),n.stopPropagation();return}if(r===p.ENTER){e.skypeOutInput()&&!e.isCallButtonDisabled()&&e.callPSTN(),n.stopPropagation();return}return!0},e.callPSTN=function(){function c(){return o.placeCall(n,!1,u.telemetry.historyLoadOrigin.SKYPEOUT_PAGE,!0)}function p(e){var t=n.participants(0),r=t.person.phoneNumbers(0)?t.person.phoneNumbers(0).telUri():e;t.audio.endpoint&&t.audio.endpoint(r)}function d(){var e=m.resolve(u.serviceLocator.ACTION_TELEMETRY),t={source:i.skypeOutPage.skypeOutHeader,phoneNumberType:f.phoneType.Other};e.recordAction(r.audioVideo.pstnCall,t)}function g(){d(),v.initiatingPSTNCall(y.entryPoint.SKYPE_OUT_PAGE)}function w(){return!n.audioService.start.enabled()&&n.audioService.start.enabled.reason!==f.callingNotSupportedReasons.PluginNotInstalled?Promise.reject(Error("Audio service disabled: "+n.audioService.start.enabled.reason)):(p(l),h.set(u.storageKeys.RECENT_COUNTRY,JSON.stringify(e.selectedCountry())),c())}function E(){function r(){var r=e.results().length,i=r?e.results(0).result:undefined;if(!i)return;return n=t.getConversation(i),w()}var e=s.get().personsAndGroupsManager.createPersonSearchQuery();return e.sources(f.searchScope.All),e.text(l),e.getMore().then(r)}var t,n,a,l=e.skypeOutInput().replace(/\s+/g,"");return l.charAt(0)!=="+"?(e.dispatchEvent(u.events.selectBox.TOGGLE,e.DIRECTION.CHILD),Promise.reject()):(l="+"+l.replace(/\D+/g,""),g(),t=s.get().conversationsManager,a=m.resolve(u.serviceLocator.FEATURE_FLAGS).isFeatureOn(u.featureFlags.USE_BUSINESS_WORDING),a?E():(n=t.getConversationByUri(b+l),w()))},e.resetSkypeOutInput=function(){e.skypeOutInput("")},e.dispose=function(){n.unsubscribe(u.events.navigation.FRAGMENT_LOADED,C),e.isCallButtonDisabled.dispose(),c.dispose(),E.dispose(),S.dispose()},e.resetSkypeOutInputViaKey=function(t,n){var r=l.getKeyCode(n);return r===p.ENTER&&(e.resetSkypeOutInput(),e.hasFocus(!0),n.stopPropagation()),!0}}var n=e("lodash-compat"),r=e("ui/telemetry/actions/actionNames"),i=e("ui/telemetry/actions/actionSources"),s=e("swx-cafe-application-instance"),o=e("ui/viewModels/calling/helpers/callingFacade"),u=e("swx-constants").COMMON,a=e("swx-constants").PEOPLE,f=e("swx-enums"),l=e("utils/common/eventHelper"),c=e("utils/common/eventMixin"),h=e("utils/common/localStorage"),p=e("swx-constants").KEYS,d=e("vendor/knockout"),v=e("telemetry/calling/pstn/pstn"),m=e("swx-service-locator-instance").default,g=e("swx-utils-common").stringUtils,y=e("swx-constants").COMMON.telemetry.pstn,b=a.contactTypes.PSTN+":",w=/^(\+?[\s\d\-\(\)\.)]*$)/;n.assign(E.prototype,c),t.build=function(){return new E}}),define("text!views/calling/skypeOut/skypeOutHeader.html",[],function(){return'<div class="SkypeOutHeader-main" data-swx-testId="skypeOut-header">\r\n    <div class="SkypeOutHeader-inner">\r\n        <input type="text" name="skypeOutInput" class="SkypeOutHeader-input" data-bind="hasFocus: hasFocus,\r\n           event: { keydown: onKeyDown },\r\n           l10n_attr: {\'placeholder\': \'input_text_skypeOut_short\'},\r\n           textInput: skypeOutInput" />\r\n        <swx-countrypicker params="selectedCountry: selectedCountry, skypeOutInput: skypeOutInput"></swx-countrypicker>\r\n    </div>\r\n    <div class="SkypeOutHeader-clrBtn">\r\n        <button data-bind="visible: skypeOutInput().length,\r\n            event: { mousedown: resetSkypeOutInput, keypress: resetSkypeOutInputViaKey },\r\n            l10n_attr: { \'aria-label\': \'clear_phonenumber_input_label\', title: \'clear_phonenumber_input_label\' }"\r\n            type="button" class="btn primary circle small transparent">\r\n            <span class="iconfont cross"></span>\r\n        </button>\r\n    </div>\r\n</div>\r\n<div class="SkypeOutHeader-controls">\r\n    <div class="buttonRow">\r\n        <swx-button class="callButtons" params="icon: \'callStart\', cssClass: \'primary circle\', disabled: isCallButtonDisabled, action: callPSTN, titleKey: \'startCall_tooltip\', textKey: \'startCall_tooltip\',\r\n                        ariaLabelKey: \'accessibility_startCall_ariaLabel\'"></swx-button>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/calling/skypeOut/skypeOutHeader",["require","exports","module","browser/dom","vendor/knockout","ui/viewModels/calling/skypeOut/skypeOutHeaderViewModel","constants/components","text!views/calling/skypeOut/skypeOutHeader.html"],function(e,t){function s(e,t){var s=t.element,o=n.getElement(".SkypeOutHeader-input",s),u=i.build(),a=r.dataFor(s);return u.setContext(a),u.init(o),u}var n=e("browser/dom"),r=e("vendor/knockout"),i=e("ui/viewModels/calling/skypeOut/skypeOutHeaderViewModel");t.name=e("constants/components").calling.SKYPEOUT_HEADER,t.template=e("text!views/calling/skypeOut/skypeOutHeader.html"),t.viewModel={createViewModel:s}}),define("ui/viewModels/calling/skypeOut/skypeOutDialpadViewModel",["require","lodash-compat","swx-constants","utils/common/eventMixin","utils/common/eventHelper","swx-constants"],function(e){function o(){function u(i,s){var u,a;return r?(a=s&&o?s-o>t:!1,a&&(u=r.attributes.getNamedItem("data-secondary")),u||(u=r.attributes.getNamedItem("data-key")),u&&e.dispatchEvent(n.events.skypeOut.DIAL_BUTTON_CLICKED,{text:u.value,inputType:i}),r=null,o=null,!1):!1}var e=this,t=600,r,o;e.onMouseDown=function(e,t){return r=t.currentTarget,o=t.timeStamp,!0},e.onTouchStart=function(e,t){return r=t.currentTarget,o=t.timeStamp,!1},e.onKeyDown=function(e,t){var n=i.getKeyCode(t);return n!==s.SPACE?!0:r?!1:(r=t.currentTarget,o=t.timeStamp,!1)},e.onKeyUp=function(e,t){return u(n.events.skypeOut.INPUT_TYPE_KEYBOARD,t.timeStamp),!0},e.onTouchEnd=function(e,t){u(n.events.skypeOut.INPUT_TYPE_TOUCH,t.timeStamp)},e.onMouseUp=function(e,t){u(n.events.skypeOut.INPUT_TYPE_MOUSE,t.timeStamp)}}var t=e("lodash-compat"),n=e("swx-constants").COMMON,r=e("utils/common/eventMixin"),i=e("utils/common/eventHelper"),s=e("swx-constants").KEYS;return t.assign(o.prototype,r),o}),define("text!views/calling/skypeOut/dialpad.html",[],function(){return'<div class="DialPad-row">\r\n    <div role="listitem" class="DialPad-key" data-key="1" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd, touchcancel: onTouchEnd,  mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">1</div>\r\n        <div class="title"></div>\r\n    </div>\r\n    <div role="listitem" class="DialPad-key" data-key="2" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd, touchcancel: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">2</div>\r\n        <div class="title">ABC</div>\r\n    </div>\r\n    <div role="listitem" class="DialPad-key" data-key="3" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd, touchcancel: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">3</div>\r\n        <div class="title">DEF</div>\r\n    </div>\r\n</div>\r\n<div class="DialPad-row">\r\n    <div role="listitem" class="DialPad-key" data-key="4" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd, touchcancel: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">4</div>\r\n        <div class="title">GHI</div>\r\n    </div>\r\n    <div role="listitem" class="DialPad-key" data-key="5" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd, touchcancel: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">5</div>\r\n        <div class="title">JKL</div>\r\n    </div>\r\n    <div role="listitem" class="DialPad-key" data-key="6" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd, touchcancel: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">6</div>\r\n        <div class="title">MNO</div>\r\n    </div>\r\n</div>\r\n<div class="DialPad-row">\r\n    <div role="listitem" class="DialPad-key" data-key="7" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd, touchcancel: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">7</div>\r\n        <div class="title">PQRS</div>\r\n    </div>\r\n    <div role="listitem" class="DialPad-key" data-key="8" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd, touchcancel: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">8</div>\r\n        <div class="title">TUV</div>\r\n    </div>\r\n    <div role="listitem" class="DialPad-key" data-key="9" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd, touchcancel: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">9</div>\r\n        <div class="title">WXYZ</div>\r\n    </div>\r\n\r\n</div>\r\n<div class="DialPad-row">\r\n    <div role="listitem" class="DialPad-key" data-key="*" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd, touchcancel: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">*</div>\r\n    </div>\r\n    <div role="listitem" class="DialPad-key" data-key="0" data-secondary="+" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchcancel: onTouchEnd, touchend: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">0</div>\r\n        <div class="title">+</div>\r\n    </div>\r\n    <div role="listitem" class="DialPad-key" data-key="#" data-bind="event: {mousedown: onMouseDown, touchstart: onTouchStart, touchend: onTouchEnd,touchcancel: onTouchEnd, mouseup: onMouseUp, keyup: onKeyUp, keydown: onKeyDown }, enterKey: onMouseDown" tabindex="0">\r\n        <div class="icon">#</div>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/calling/skypeOut/dialpad",["require","exports","module","vendor/knockout","ui/viewModels/calling/skypeOut/skypeOutDialpadViewModel","constants/components","text!views/calling/skypeOut/dialpad.html"],function(e,t){function i(e,t){var i=n.dataFor(t.element),s=new r;return s.setContext(i),s}var n=e("vendor/knockout"),r=e("ui/viewModels/calling/skypeOut/skypeOutDialpadViewModel");t.name=e("constants/components").calling.SKYPEOUT_DIALPAD,t.template=e("text!views/calling/skypeOut/dialpad.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/calling/skypeOut/countryPickerViewModel",["require","exports","module","lodash-compat","swx-constants","utils/common/eventMixin","vendor/knockout","swx-i18n","utils/common/localStorage","swx-service-locator-instance","experience/settings","swx-utils-common","browser/window"],function(e,t){function h(e){function y(e){return!s.isObservable(e)}function b(e){var n=w(e.substring(0,d));n!==i&&(i=n,t.selectedCountry(i))}function w(e){return e.length===0?null:e in t.countriesMap?t.countriesMap[e]:w(e.substring(0,e.length-1))}function E(e){var t;e?t=e.value:t="",e!==i&&(i?h(h().replace(i.value,t)):t!==""&&h(t+" "+h())),i=e}function S(e){var n;for(n=0;n<e.length;n++)if(e[n].name===m.name&&e[n].value===m.value&&e[n].description===m.description){t.selectedCountry(e[n]),m=e[n];return}t.selectedCountry(null)}function x(e){function a(){return r.length>0&&r[r.length-1].value===s}var n=JSON.parse(e).destinations,r=[],i,s,o,u;for(u=0;u<n.length;u++){i=n[u],s="+"+i.countryPrefix;if(!i.countryPrefix||a(r,s))continue;o={value:s,name:i.name,description:l.forceLTREmbedding(s)},t.countriesMap[s]=o,r.push(o)}r.sort(function(e,t){return e.name.localeCompare(t.name,f.initParams.locale)}),t.countries(r),m&&S(r)}function T(){var e=new XMLHttpRequest,t="?language="+f.initParams.locale+"&currency=USD&expand=country-prefix&host="+c.location.hostname+"&client="+f.version;e.addEventListener("readystatechange",function(){this.readyState===4&&(this.status===200?x(this.responseText):p||(p=!0,T()))}),e.open("GET",f.assetsServiceHost+t),e.send()}function N(){m?(t.countries().push(m),t.selectedCountry(m)):t.countries().push(g)}function C(){m&&h()===""&&t.selectedCountry(m)}var t=this,n,i,h,p=!1,d=6,v=a.resolve(r.serviceLocator.PUBSUB),m,g={value:"",name:o.fetch({key:"splashScreen_text_loading"}),description:""};if(y(e.skypeOutInput)||y(e.selectedCountry))throw new Error("[CountryPicker] Passing incorrect parameter, expecting ko.obervables.");t.countriesMap={},t.countries=s.observableArray(),t.selectedCountry=e.selectedCountry,h=e.skypeOutInput,t.init=function(){m=JSON.parse(u.get(r.storageKeys.RECENT_COUNTRY)),T(),t.registerEvent(r.events.skypeOut.INPUT_CHANGED,b),t.forwardEvent(r.events.selectBox.TOGGLE,t.DIRECTION.CHILD),n=t.selectedCountry.subscribe(E),N(),v.subscribe(r.events.navigation.FRAGMENT_LOADED,C)},t.dispose=function(){n.dispose(),v.unsubscribe(r.events.navigation.FRAGMENT_LOADED,C)}}var n=e("lodash-compat"),r=e("swx-constants").COMMON,i=e("utils/common/eventMixin"),s=e("vendor/knockout"),o=e("swx-i18n").localization,u=e("utils/common/localStorage"),a=e("swx-service-locator-instance").default,f=e("experience/settings"),l=e("swx-utils-common").stringUtils,c=e("browser/window");n.assign(h.prototype,i),t.build=function(e){return new h(e)}}),define("text!views/calling/skypeOut/countryPicker.html",[],function(){return'<div class="SkypeOutHeader-countryPicker" data-swx-testId="skypeOut-countryPicker">\r\n    <swx-select-box class="SelectBox" params="selectOptions: countries, selectedOption: selectedCountry, placeholderKey: \'select_placeholder_skypeOut\'"></swx-select-box>\r\n</div>\r\n'}),define("ui/components/calling/skypeOut/countryPicker",["require","exports","module","ui/viewModels/calling/skypeOut/countryPickerViewModel","vendor/knockout","constants/components","text!views/calling/skypeOut/countryPicker.html"],function(e,t){function i(e,t){var i=n.build(e),s=t.element,o=r.dataFor(s);return i.setContext(o),i.init(),i}var n=e("ui/viewModels/calling/skypeOut/countryPickerViewModel"),r=e("vendor/knockout");t.name=e("constants/components").calling.SKYPEOUT_COUNTRY_PICKER,t.template=e("text!views/calling/skypeOut/countryPicker.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/calling/screenSharingPreviewViewModel",["require","lodash-compat","swx-utils-common","swx-constants","swx-constants","utils/common/eventMixin","swx-i18n","vendor/knockout","ui/telemetry/actions/actionNames","swx-service-locator-instance"],function(e){function c(e){var t=this;t.DIALOG_NAME=r.CALL_SCREEN_DIALOG.NAME.SCREEN_SHARING_PREVIEW,t.cancelButtonHasFocus=u.observable(!1),t.previewImage=u.observable(null),t.cancelTitle=o.fetch({key:"action_button_cancel"}),t.shareScreenTitle=o.fetch({key:"callscreen_text_shareScreen"}),t.closePreview=function(){t.dispatchEvent(i.events.callScreen.TOGGLE_MODAL_DIALOG,t.DIALOG_NAME,t.DIRECTION.PARENT)},t.shareScreen=function(){e.screenSharingService.start(),t.closePreview();var n=f.resolve(i.serviceLocator.ACTION_TELEMETRY);n.recordAction(a.audioVideo.shareScreen)},t.init=function(){t.forwardEvent(i.events.callScreen.TOGGLE_MODAL_DIALOG,t.DIRECTION.PARENT),e.screenSharingService.shareableResources.get(0).then(function(e){e._getPreviewImage(l).then(function(e){var n=new Image;n.onload=function(){t.previewImage(n.src)},n.onerror=t.closePreview,n.src="data:image/png;base64,"+e.data,t.cancelButtonHasFocus(!0)},t.closePreview)},t.closePreview)}}var t=e("lodash-compat"),n=e("swx-utils-common").builderMixin,r=e("swx-constants").CALLING,i=e("swx-constants").COMMON,s=e("utils/common/eventMixin"),o=e("swx-i18n").localization,u=e("vendor/knockout"),a=e("ui/telemetry/actions/actionNames"),f=e("swx-service-locator-instance").default,l=400;return t.assign(c,n),t.assign(c.prototype,s),c}),define("text!views/calling/screenSharingPreview.html",[],function(){return'<!-- ko if: previewImage() -->\r\n<swx-call-screen-modal params="name: DIALOG_NAME">\r\n    <img class="ssPreviewImage" data-bind="attr: { src: previewImage() }">\r\n    <div class="actions">\r\n        <swx-button params="cssClass: \'secondary circle\', textKey: \'action_button_cancel\', i18nTitle: cancelTitle, action: closePreview, hasFocus: cancelButtonHasFocus"></swx-button>\r\n        <swx-button params="cssClass: \'primary circle\', textKey: \'callscreen_text_shareScreen\', i18nTitle: shareScreenTitle, action: shareScreen"></swx-button>\r\n    </div>\r\n</swx-call-screen-modal>\r\n<!-- /ko -->'}),define("ui/components/calling/screenSharingPreview",["require","exports","module","ui/viewModels/calling/screenSharingPreviewViewModel","vendor/knockout","constants/components","text!views/calling/screenSharingPreview.html"],function(e,t){function i(e,t){var i=n.build(e.conversation,t.element);return i.setContext(r.dataFor(t.element)),i.init(),i}var n=e("ui/viewModels/calling/screenSharingPreviewViewModel"),r=e("vendor/knockout");t.name=e("constants/components").calling.SCREEN_SHARING_PREVIEW,t.template=e("text!views/calling/screenSharingPreview.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/calling/unansweredCallViewModel",["require","lodash-compat","ui/viewModels/calling/helpers/callingFacade","swx-constants","swx-constants","ui/viewModels/people/contactBuilder","ui/contextMenu/contextMenu","ui/viewModels/chat/conversationTopic","browser/dom","swx-enums","utils/common/eventMixin","swx-focus-handler","swx-i18n","vendor/knockout","swx-log-tracer","ui/contextMenu/menuItemHelper","ui/contextMenu/items/all","swx-service-locator-instance","experience/settings","ui/telemetry/telemetryClient"],function(e){function w(e,l){function k(){var e=T();return e?{chatButton:e.UnansweredCallUIChatButton_Green,retryButton:e.UnansweredCallUIRetryButton_Green}:y.unansweredUI.defaultGreenButtons}function L(){var e=g.resolve(i.serviceLocator.FEATURE_FLAGS),t=e.isFeatureOn(i.featureFlags.PSTN_ENABLED);return t}function A(){return!w.isGroupConversation&&L()}function O(e){var t=5,n=M();e.customClientOptions={offsetElement:e.target,position:f.contextMenuPosition.Top,offset:t},o.show(n,e)}function M(){function u(){P(r.UNANSWERED_CALL_ACTIONS.RETRY,r.UNANSWERED_CALL_RETRY_ACTIONS.SKYPE),w.dispatchEvent(r.EVENTS.UNANSWERED_CALL_CLOSE,null,w.DIRECTION.PARENT)}function a(){P(r.UNANSWERED_CALL_ACTIONS.RETRY,r.UNANSWERED_CALL_RETRY_ACTIONS.PSTN),w.dispatchEvent(r.EVENTS.UNANSWERED_CALL_CLOSE,null,w.DIRECTION.PARENT)}function f(){P(r.UNANSWERED_CALL_ACTIONS.RETRY,r.UNANSWERED_CALL_RETRY_ACTIONS.DIAL_PAD),w.dispatchEvent(r.EVENTS.UNANSWERED_CALL_CLOSE,null,w.DIRECTION.PARENT)}var e=E.conversation.participants(0).person,n=s.build(e),o=[],l;x()?l=new m.VideoCallMenuItem(n,i.telemetry.historyLoadOrigin.UNANSWERED_CALL_UI):l=new m.CallSkypeMenuItem(n,i.telemetry.historyLoadOrigin.UNANSWERED_CALL_UI),o.push(new m.UnansweredCallWrapMenuItem(l,l.label,u));var c=v.getCallPhoneContextMenuItems(n);return c&&!!c.length&&t.forEach(c,function(e){o.push(new m.UnansweredCallWrapMenuItem(e,e.label,a))}),o.push(new m.GoToDialPadMenuItem(f)),o}function D(){var e={prefillTextarea:!1,focusTextarea:!0};w.dispatchEvent(r.EVENTS.UNANSWERED_CALL_CLOSE,e,w.DIRECTION.PARENT)}function P(e,t){if(N)return;var n={Action:e,Leave_Reason:S()};t&&(n.Retry_Action=t),d.log("[Unanswered Call UI Telemetry] event",i.telemetry.unansweredCallUI.MASTER_EVENT,"data",n),b.get().sendEvent(y.telemetry.uiTenantToken,i.telemetry.unansweredCallUI.MASTER_EVENT,n),N=!0}function H(){l.restrict();var e=a.getElement(".swx .UnansweredCall .UnansweredCall-greenButton .btn");e||(e=a.getElement(".swx .UnansweredCall .UnansweredCall-chatButton .btn")),e&&c.get().addFocusRequestToQueue(e,c.Priorities.Immediate)}var w=this,E=e.payload,S=E.reason,x=E.wasVideoCall,T=E.ecsConfig,N=!1,C=u.build(E.conversation);w.avatar=E.conversation.avatarUrl(),w.isGroupConversation=E.conversation.isGroupConversation(),w.topic=C.topic,w.title=p.pureComputed(function(){return S()===r.UNANSWERED_CALL_REASONS.BUSY?h.fetch({key:"unanswered_call_title_busy"}):S()===r.UNANSWERED_CALL_REASONS.MISSED?h.fetch({key:"unanswered_call_title_noanswer"}):h.fetch({key:"unanswered_call_title_unavailable"})}),w.titleDescription=p.pureComputed(function(){return S()===r.UNANSWERED_CALL_REASONS.BUSY?h.fetch({key:"unanswered_call_accessibility_title_busy"}):S()===r.UNANSWERED_CALL_REASONS.MISSED?h.fetch({key:"unanswered_call_accessibility_title_noanswer"}):h.fetch({key:"unanswered_call_accessibility_title_unavailable"})}),w.isButtonGreen=k(),w.sendMessage=function(){var e={prefillTextarea:!w.isGroupConversation,focusTextarea:!0};P(r.UNANSWERED_CALL_ACTIONS.CHAT),w.dispatchEvent(r.EVENTS.UNANSWERED_CALL_CLOSE,e,w.DIRECTION.PARENT)},w.retryCall=function(e){A()?O(e):(P(r.UNANSWERED_CALL_ACTIONS.RETRY,r.UNANSWERED_CALL_RETRY_ACTIONS.SKYPE),w.dispatchEvent(r.EVENTS.UNANSWERED_CALL_CLOSE,null,w.DIRECTION.PARENT),n.placeCall(E.conversation,x()))},w.goToChat=function(){P(r.UNANSWERED_CALL_ACTIONS.OTHER_DISMISS),D()},w.cancel=function(){P(r.UNANSWERED_CALL_ACTIONS.CANCEL),D()},setTimeout(H,0),w.dispose=function(){l.restore(),C.dispose(),P(r.UNANSWERED_CALL_ACTIONS.OTHER_DISMISS)}}var t=e("lodash-compat"),n=e("ui/viewModels/calling/helpers/callingFacade"),r=e("swx-constants").CALLING,i=e("swx-constants").COMMON,s=e("ui/viewModels/people/contactBuilder"),o=e("ui/contextMenu/contextMenu"),u=e("ui/viewModels/chat/conversationTopic"),a=e("browser/dom"),f=e("swx-enums"),l=e("utils/common/eventMixin"),c=e("swx-focus-handler"),h=e("swx-i18n").localization,p=e("vendor/knockout"),d=e("swx-log-tracer").getLogger(),v=e("ui/contextMenu/menuItemHelper"),m=e("ui/contextMenu/items/all"),g=e("swx-service-locator-instance").default,y=e("experience/settings"),b=e("ui/telemetry/telemetryClient");return t.assign(w.prototype,l),{build:function(e,t){return new w(e,t)}}}),define("text!views/calling/unansweredCall.html",[],function(){return"<div class=\"UnansweredCall\" role=\"dialog\" data-bind=\"attr: {'aria-label': titleDescription}\" tabindex=\"-1\">\r\n\r\n    <div class=\"UnansweredCall-topContainer\">\r\n        <div class=\"UnansweredCall-titleBar\">\r\n            <span class=\"UnansweredCall-topic\" data-bind=\"text: topic\"></span>\r\n            <swx-button class=\"UnansweredCall-titleBarButton UnansweredCall-goToChatButton\"\r\n                        params=\"icon: 'message',\r\n                                cssClass: 'circle',\r\n                                action: goToChat,\r\n                                titleKey: 'unanswered_call_button_showchat', textKey: 'unanswered_call_button_showchat',\r\n                                ariaLabelKey: 'unanswered_call_accessibility_button_showchat'\">\r\n            </swx-button>\r\n        </div>\r\n\r\n        <swx-button class=\"UnansweredCall-closeButton\"\r\n                    params=\"icon: 'cross',\r\n                            cssClass: 'circle',\r\n                            action: cancel,\r\n                            titleKey: 'unanswered_call_button_close', textKey: 'unanswered_call_button_close',\r\n                            ariaLabelKey: 'unanswered_call_accessibility_button_close'\">\r\n        </swx-button>\r\n    </div>\r\n\r\n    <div class=\"UnansweredCall-middleContainer\">\r\n        <div class=\"UnansweredCall-avatarReasonContainer\">\r\n        	<swx-avatar class=\"UnansweredCall-avatar\" params=\"avatar: avatar, isGroupAvatar: isGroupConversation, displayName: topic, isPstn: false, size: 195\"></swx-avatar>\r\n\r\n        	<p class=\"UnansweredCall-reason fontSize-h2\" data-bind=\"text: title\"></p>\r\n        </div>\r\n\r\n    	<div class=\"UnansweredCall-buttons\">\r\n    		<div class=\"UnansweredCall-buttonContainer\">\r\n    		    <swx-button class=\"UnansweredCall-button UnansweredCall-chatButton\"\r\n                            data-bind=\"css: { 'UnansweredCall-greenButton': isButtonGreen['chatButton'],\r\n                                              'UnansweredCall-nonGreenButton': !isButtonGreen['chatButton'] }\"\r\n    		    			params=\"icon: 'message',\r\n    		    					cssClass: isButtonGreen['chatButton'] ? 'circle' : 'secondary circle stroke',\r\n    		    					action: sendMessage,\r\n    		    					titleKey: 'unanswered_call_button_chat', textKey: 'unanswered_call_button_chat',\r\n    		                        ariaLabelKey: 'unanswered_call_accessibility_button_chat'\">\r\n    			</swx-button>\r\n    			<p class=\"UnansweredCall-buttonLabel\" data-bind=\"l10n: {'key': 'unanswered_call_button_chat'}\"></p>\r\n    		</div>\r\n\r\n    		<div class=\"UnansweredCall-buttonContainer\">\r\n    		    <swx-button class=\"UnansweredCall-button UnansweredCall-retryButton\"\r\n                            data-bind=\"css: { 'UnansweredCall-greenButton': isButtonGreen['retryButton'],\r\n                                              'UnansweredCall-nonGreenButton': !isButtonGreen['retryButton'] }\"\r\n    		    			params=\"icon: 'reload',\r\n    		    					cssClass: isButtonGreen['retryButton'] ? 'circle' : 'secondary circle stroke',\r\n    		    					action: retryCall,\r\n    		    					titleKey: 'unanswered_call_button_retry', textKey: 'unanswered_call_button_retry',\r\n    		                        ariaLabelKey: 'unanswered_call_accessibility_button_retry'\">\r\n    			</swx-button>\r\n    			<p class=\"UnansweredCall-buttonLabel\" data-bind=\"l10n: {'key': 'unanswered_call_button_retry'}\"></p>\r\n    		</div>\r\n    	</div>\r\n    </div>\r\n\r\n</div>\r\n"}),define("ui/components/calling/unansweredCall",["require","exports","module","utils/common/focusRestrictor","vendor/knockout","ui/viewModels/calling/unansweredCallViewModel","constants/components","text!views/calling/unansweredCall.html"],function(e,t){function s(e,t){var s=[".Me",".toasts",".footer",".notifications","swx-sidebar"],o=n.build(t.element,s),u=i.build(e,o);return u.setContext(r.dataFor(t.element)),u}var n=e("utils/common/focusRestrictor"),r=e("vendor/knockout"),i=e("ui/viewModels/calling/unansweredCallViewModel");t.name=e("constants/components").calling.UNANSWERED_CALL,t.template=e("text!views/calling/unansweredCall.html"),t.viewModel={createViewModel:s}}),define("ui/viewModels/calling/callScreenModalViewModel",["require","lodash-compat","swx-utils-common","swx-constants","swx-constants","utils/common/eventMixin","utils/common/focusRestrictor","utils/common/outsideClickHandler"],function(e){function f(e,t){var n=this,s=o.build(t,i.CALL_SCREEN_DIALOG.ALLOWED_FOCUS_SELECTORS);return n.close=function(){n.dispatchEvent(r.events.callScreen.TOGGLE_MODAL_DIALOG,e,n.DIRECTION.PARENT)},n.init=function(){u.add(a,n.close),s.restrict()},n.dispose=function(){u.remove(a),s.restore()},n}var t=e("lodash-compat"),n=e("swx-utils-common").builderMixin,r=e("swx-constants").COMMON,i=e("swx-constants").CALLING,s=e("utils/common/eventMixin"),o=e("utils/common/focusRestrictor"),u=e("utils/common/outsideClickHandler"),a="call-screen-modal-content";return t.assign(f,n),t.assign(f.prototype,s),f}),define("text!views/calling/callScreenModal.html",[],function(){return'<div class="call-screen-modal-content"><!-- ko template: { nodes: $componentTemplateNodes, data: $parent } --><!-- /ko --></div>'}),define("ui/components/calling/callScreenModal",["require","exports","module","ui/viewModels/calling/callScreenModalViewModel","vendor/knockout","constants/components","text!views/calling/callScreenModal.html"],function(e,t){function i(e,t){var i=n.build(e.name,t.element);return i.setContext(r.dataFor(t.element)),i.init(),i}var n=e("ui/viewModels/calling/callScreenModalViewModel"),r=e("vendor/knockout");t.name=e("constants/components").calling.CALL_SCREEN_MODAL,t.template=e("text!views/calling/callScreenModal.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/calling/addParticipantsViewModel",["require","lodash-compat","swx-utils-common","swx-constants","swx-constants","swx-utils-chat","utils/common/eventMixin","swx-i18n","vendor/knockout","ui/telemetry/actions/actionNames","swx-service-locator-instance"],function(e){function c(e,n){function h(e){var t=l.resolve(i.serviceLocator.ACTION_TELEMETRY),n=e?f.audioVideo.submitParticipantsInGroup:f.audioVideo.submitParticipantsIn1to1;t.recordAction(n)}function p(e){o.closeAddParticipantsDialog(),n.audioService.transfer(e.id())}var o=this,c;o.DIALOG_NAME=e,o.conversation=n,o.addParticipantsTitle=u.fetch({key:"button_text_addParticipants"}),o.cancelAddParticipantsTitle=u.fetch({key:"button_text_cancelAddParticipants"}),o.selectedParticipantsCount=a.observable(0),o.setParticipantProvider=function(e){c=e,c.selectedContacts.subscribe(function(){c&&o.DIALOG_NAME===r.CALL_SCREEN_DIALOG.NAME.ADD_PARTICIPANTS&&o.selectedParticipantsCount(c.selectedContacts().length)})},o.submitSelectedParticipants=function(){var e=c.selectedContacts;e().length>0&&(h(n.isGroupConversation()),s.addPersonsToConversation(e(),n)),o.closeAddParticipantsDialog()},o.closeAddParticipantsDialog=function(){o.dispatchEvent(i.events.callScreen.TOGGLE_MODAL_DIALOG,o.DIALOG_NAME,o.DIRECTION.PARENT)},o.init=function(){if(e===r.CALL_SCREEN_DIALOG.NAME.TRANSFER_CALL){var n=t.once(p);o.registerEvent(i.events.roster.PICKER_CONTACT_SELECTED,n)}o.forwardEvent(i.events.callScreen.TOGGLE_MODAL_DIALOG,o.DIRECTION.PARENT),o.forwardEvent(i.events.roster.ROSTER_QUERY_CHANGED,o.DIRECTION.CHILD),o.forwardEvent(i.events.roster.ROSTER_QUERY_EXECUTED,o.DIRECTION.CHILD),o.forwardEvent(i.events.roster.ROSTER_SELECTION_REMOVED,o.DIRECTION.CHILD),o.forwardEvent(i.events.roster.PICKER_CONTACT_SELECTED,o.DIRECTION.CHILD),o.forwardEvent(i.events.roster.PICKER_CONTACT_DESELECTED,o.DIRECTION.CHILD)},o.dispose=function(){c=null}}var t=e("lodash-compat"),n=e("swx-utils-common").builderMixin,r=e("swx-constants").CALLING,i=e("swx-constants").COMMON,s=e("swx-utils-chat").conversation,o=e("utils/common/eventMixin"),u=e("swx-i18n").localization,a=e("vendor/knockout"),f=e("ui/telemetry/actions/actionNames"),l=e("swx-service-locator-instance").default;return t.assign(c,n),t.assign(c.prototype,o),c}),define("text!views/calling/addParticipants.html",[],function(){return'<swx-call-screen-modal params="name: DIALOG_NAME">\r\n    <div class="headerAdd">\r\n        <swx-contact-picker-input params="setParticipantProvider: setParticipantProvider"></swx-contact-picker-input>\r\n    </div>\r\n    <swx-contact-picker params="conversation: conversation, className: \'addToCallPicker\'"></swx-contact-picker>\r\n    <div class="actions">\r\n        <swx-button params="cssClass: \'secondary circle\', textKey: \'button_text_cancelAddParticipants\', i18nTitle: cancelAddParticipantsTitle, action: closeAddParticipantsDialog"></swx-button>\r\n        <!-- ko if: selectedParticipantsCount() > 0 -->\r\n            <swx-button params="cssClass: \'primary circle\', textKey: \'button_text_addParticipants\', i18nTitle: addParticipantsTitle, action: submitSelectedParticipants"></swx-button>\r\n        <!-- /ko -->\r\n    </div>\r\n</swx-call-screen-modal>'}),define("ui/components/calling/addParticipants",["require","exports","module","ui/viewModels/calling/addParticipantsViewModel","vendor/knockout","constants/components","text!views/calling/addParticipants.html"],function(e,t){function i(e,t){var i=n.build(e.dialogName,e.conversation,t.element);return i.setContext(r.dataFor(t.element)),i.init(),i}var n=e("ui/viewModels/calling/addParticipantsViewModel"),r=e("vendor/knockout");t.name=e("constants/components").calling.ADD_PARTICIPANTS,t.template=e("text!views/calling/addParticipants.html"),t.viewModel={createViewModel:i}}),define("ui/components/calling/index",["require","ui/components/calling/callScreen","ui/components/calling/participantMenu","ui/components/calling/roster","ui/components/calling/callAnimation","ui/components/calling/endCall","ui/components/calling/callScreenContent","ui/components/calling/callScreenHeader","ui/components/calling/callScreenFooter","ui/components/calling/joinCallButton","ui/components/calling/startCallButton","ui/components/calling/cqf","ui/components/calling/cqfStarRating","ui/components/calling/cqfQuestion","ui/components/calling/skypeOut","ui/components/calling/skypeOut/skypeOutHeader","ui/components/calling/skypeOut/dialpad","ui/components/calling/skypeOut/countryPicker","ui/components/calling/screenSharingPreview","ui/components/calling/unansweredCall","ui/components/calling/callScreenModal","ui/components/calling/addParticipants"],function(e){return[e("ui/components/calling/callScreen"),e("ui/components/calling/participantMenu"),e("ui/components/calling/roster"),e("ui/components/calling/callAnimation"),e("ui/components/calling/endCall"),e("ui/components/calling/callScreenContent"),e("ui/components/calling/callScreenHeader"),e("ui/components/calling/callScreenFooter"),e("ui/components/calling/joinCallButton"),e("ui/components/calling/startCallButton"),e("ui/components/calling/cqf"),e("ui/components/calling/cqfStarRating"),e("ui/components/calling/cqfQuestion"),e("ui/components/calling/skypeOut"),e("ui/components/calling/skypeOut/skypeOutHeader"),e("ui/components/calling/skypeOut/dialpad"),e("ui/components/calling/skypeOut/countryPicker"),e("ui/components/calling/screenSharingPreview"),e("ui/components/calling/unansweredCall"),e("ui/components/calling/callScreenModal"),e("ui/components/calling/addParticipants")]}),define("experience/components/calling",["require","exports","module","services/telemetry/common/telemetry","services/telemetry/common/instrumentation","services/telemetry/calling.instrumentation.eventTypes","swx-constants","swx-constants","swx-service-locator-instance","ui/controls/calling/endCallControl","ui/controls/calling/micControl","ui/components/calling/index","ui/components/registrar"],function(e,t){function h(){var e=r.create(i);n.instrumentAllEvents(e)}var n=e("services/telemetry/common/telemetry"),r=e("services/telemetry/common/instrumentation"),i=e("services/telemetry/calling.instrumentation.eventTypes"),s=e("swx-constants").COMMON,o=e("swx-constants").CALLING,u=e("swx-service-locator-instance").default,a=e("ui/controls/calling/endCallControl"),f=e("ui/controls/calling/micControl"),l=e("ui/components/calling/index"),c=e("ui/components/registrar");t.init=function(e){var t=u.resolve(s.serviceLocator.FEATURE_FLAGS),n=u.resolve(s.serviceLocator.CONTROLS_BUILDER);n.register(a),n.register(f),c.register(l),t.isFeatureOn(o.FEATURE_FLAGS.CALLING)&&h(),e()}}),define("ui/players/mediaPlayerController",["require","swx-constants","lodash-compat","browser/document","swx-pubsub-instance","swx-service-locator-instance","swx-cafe-application-instance","browser/window"],function(e){function a(){function d(e){n.forEach(e,function(e){e.pause(),e.type===t.chat.messageType.VIDEO&&e.mute(!0)})}function v(e){if(!e)return;return n.find(a,function(t){return t.id===e})}function m(e){return n.filter(a,function(t){return t.conversationId===e})}function g(e){if(!e){var t=b();t&&t.pause()}}function y(){if(n.isUndefined(p)){var e=s.resolve(t.serviceLocator.FEATURE_FLAGS);p=e.isFeatureOn(t.featureFlags.VIDEO_AUTOPLAY_SETTINGS_ENABLED),p&&o.get().personsAndGroupsManager.mePerson.preferences(t.userSettings.preferences.VIDEO_AUTOPLAY).value.get().then(g)}return p&&o.get().personsAndGroupsManager.mePerson.preferences(t.userSettings.preferences.VIDEO_AUTOPLAY).value()}function b(){return n.find(a,function(e){return e.isPlaying()||e.isQueuedForPlaying()})}function w(t){var n=t.target&&(t.target.id&&t.target.id.substring(0,7)==="yt_msg_"||t.target.activeElement&&t.target.activeElement.id&&t.target.activeElement.id.substring(0,7)==="yt_msg_");if(n)return;var i=!!(r.fullscreenElement||r.mozFullScreenElement||r.webkitFullscreenElement),s=v(l);s&&s.isInFullscreen(i),i||e.onLeavingFullscreen()}function E(){var e=b();e&&!e.triggeredByUser()&&(e.pause(),c=e)}function S(){c&&(c.play(),c=null)}var e=this,a=[],f={},l,c,h=function(){},p;e.pauseAllInConversation=function(e){d(m(e))},e.registerPlayer=function(e){var t={id:e.id,conversationId:e.conversationId,isInFullscreen:e.isInFullscreen||h,pause:e.pause,play:e.play,mute:e.mute||h,type:e.mediaType,isPlaying:e.isPlaying,autoplay:e.autoplay,isQueuedForPlaying:e.isQueuedForPlaying,triggeredByUser:e.triggeredByUser||function(){return!0}};f[e.conversationId]=!0,a.push(t)},e.removePlayer=function(e){var t=v(e);a.splice(a.indexOf(t),1);var n=a.filter(function(e){return e.conversationId===t.conversationId});f[t.conversationId]=n.length>0},e.onEnteringFullscreen=function(e){i.publish(t.events.videoPlayer.FULLSCREEN_ON),l=e},e.onLeavingFullscreen=function(){l&&(i.publish(t.events.videoPlayer.FULLSCREEN_OFF,l),l=null)},e.onVisibleViewPortChanged=function(e,n){if(!y())return;var r=b(),i;if(r&&(r.conversationId!==e||r.triggeredByUser()))return;if(!f.hasOwnProperty(e))return;n.sort(function(e,t){return e-t});for(var s=n.length-1;s>=0;s--){var o=v(n[s]);if(o&&o.type===t.chat.messageType.VIDEO&&o.autoplay){i=o;break}}if(i&&i===r)return;r&&r.pause(),i&&(i.mute(!0),i.play())},r.addEventListener("webkitfullscreenchange",w),r.addEventListener("mozfullscreenchange",w),r.addEventListener("MSFullscreenChange",w),r.addEventListener("fullscreenchange",w),u.addEventListener(t.events.browser.BLUR,E),u.addEventListener(t.events.browser.FOCUS,S)}var t=e("swx-constants").COMMON,n=e("lodash-compat"),r=e("browser/document"),i=e("swx-pubsub-instance").default,s=e("swx-service-locator-instance").default,o=e("swx-cafe-application-instance"),u=e("browser/window");return new a}),define("ui/viewModels/chat/chatLog",["require","lodash-compat","browser/document","vendor/knockout","utils/common/ko","swx-utils-common","utils/common/cafeObservable","swx-constants","swx-constants","utils/common/eventMixin","ui/contextMenu/contextMenu","ui/contextMenu/items/all","swx-utils-chat","swx-utils-common","swx-service-locator-instance","utils/common/appVisibilityProvider","swx-i18n","ui/telemetry/actions/actionSources","swx-utils-chat","experience/settings","swx-cafe-application-instance","utils/common/accessibility","swx-enums","ui/modelHelpers/personHelper","swx-log-tracer","browser/dom","ui/players/mediaPlayerController"],function(e){function _(e,f){function tt(t){var n=new e;return n.setContext(f),n.init(t,_.conversation),D[n.clientmessageid]=n,n}function nt(e,t){(!t.text||_t(t.text()))&&s.insertAt(_.collection(),e,tt(t))}function rt(e,t){var n=s.removeFrom(_.collection(),e);delete D[n.clientmessageid],n.clientmessageid!==t.key()&&T.warn("Removing wrong element ! There was de-synchronization between model activityItems and viewmodel messages ! Crash !")}function it(){var e={},t=_.collection();t.forEach(function(t){e=P.processMessage(t,e)}),P.processMyLastMessageIfAny(t),_.collection.valueHasMutated()}function st(e){i.handleArrayChanges(_.collection(),e,nt,rt),it()}function ot(){q=j.activityItems.subscribe()}function ut(){H=F.subscribe(st,null,"arrayChange")}function at(){if(!F)return;X.start(),ot();var e=F(),t;e.length<k&&p.execute(gt);if(e.length===0){ut(),_.dispatchEvent(u.events.conversation.MESSAGES_LOADED,e,_.DIRECTION.PARENT);return}t=e.filter(function(e){return!e.text||_t(e.text())}),t=t.map(function(e){return tt(e)}),r.utils.arrayPushAll(_.collection(),t),it(),ut(),_.dispatchEvent(u.events.conversation.MESSAGES_LOADED,e,_.DIRECTION.PARENT)}function ft(){var e=[];return t.forEach(_.collection(),function(t){W.isMessageVisible(t.clientmessageid)&&e.push(t.model)}),e}function lt(){var e=j.unreadActivityItemsCount(),t=_.collection(),n=ct(t);if(e>t.length){gt();return}W.isVisible()&&e>0&&e<M&&n&&W.isScrolledToBottom()&&W.scrollToMessage(n)}function ct(e){return t.find(e,function(e){return!e.model.isRead()})}function ht(e){if(U&&W.isVisible()&&(e||v.hasFocus())&&!z){var t=[];Y&&(t=ft()),j.markAllAsRead(t)}}function pt(e){e&&e.suggestedActions&&e.suggestedActions().length?(_.suggestedActions(e.suggestedActions()),_.suggestedActionsAuthor=e.author,_.showSuggestedActions(!0)):(_.suggestedActions([]),_.suggestedActionsAuthor={},_.showSuggestedActions(!1))}function dt(){if(!W)return;if(yt())return;_._updatingMessages=!0,W.showNewMessages(),Y&&lt(),_._updatingMessages=!1,K&&K(),P.processMyBeforeLastMessageIfAny(_.collection()),!W.isScrollable()&&!I&&p.execute(gt),X.registerSync()}function vt(){X.registerSync(),I=!1,dt()}function mt(){X.registerError()}function gt(){j.getMoreActivityItems.enabled()&&(I=!0,j.getMoreActivityItems(L).then(vt,mt))}function yt(){return _.collection&&_.collection().filter(function(e){return!e.isRendered}).length>0}function bt(){yt()||p.execute(dt)}function wt(){W.restoreScrollPosition()}function Et(){if(W.isScrollPositionStored())return;W.storeScrollPosition()}function St(e){U=!0,W.onShow();if(!W.isScrollable()){gt(),ht();return}Y&&lt(),e&&e.messageId&&xt(e.messageId)}function xt(e){var t,n=_.collection();K=null;for(t=0;t<n.length;t++){var r=n[t];if(r.clientmessageid===e){W.scrollToMessage(r),K=null;return}}K=xt.bind(null,e),gt()}function Tt(){ht(),U=!1,W.onHide()}function Nt(){function e(e){V.publish(a.interaction.SCROLL_START,e)}return t.debounce(e,1e3,{leading:!0,trailing:!1})}function Ct(e){z=e,e||ht()}function kt(){j.isHistoryDisclosed()&&gt()}function Lt(){var e=n.fullScreenElement&&n.fullScreenElement!==null||n.mozFullScreen||n.webkitIsFullScreen;return e||J}function At(){J=!0}function Ot(e){J=!1,e&&xt(e)}function Mt(){function n(e){W.isMessageVisible(e.id)&&j._messagesWithUnseenHearts.remove(e.id)}var e=j._messagesWithUnseenHearts();if(e.length===0)return;t.forEach(e,n)}function _t(e){var n=b.messageFilters&&b.messageFilters.chatLogMessageFilter?b.messageFilters.chatLogMessageFilter:null;return t.isFunction(n)?n(e):!0}function Dt(e,t){_.conversation.historyService.removeCustomActivityItem(S.activityType.ContactRequestOutgoing),_.conversation.historyService.removeCustomActivityItem(S.activityType.ContactRequestIsNowContact),_.conversation.historyService.addCustomActivityItem(e,{sender:t})}function Pt(e){var t=_.participants(0).person;e.id()===t.id()&&Dt(S.activityType.ContactRequestOutgoing,t)}function Ht(e){var t=_.participants(0).person;e.id()===t.id()&&_.conversation.historyService.removeCustomActivityItem(S.activityType.ContactRequestOutgoing)}function Bt(){var e;if(!Q.isFeatureOn(u.featureFlags.ENABLE_BUSINESS_CONTACT_MANAGEMENT))return;var t=d.resolve(u.serviceLocator.SUBSCRIPTION_PROVIDER);t.getContacts().then(function(){if(_.conversation.isGroupConversation()||_.participants.size()!==1)return;e=_.participants(0).person,!x.isKnownPerson(e)&&!x.isWelcomeAgent(e)&&Dt(S.activityType.ContactRequestOutgoing,e),w.get().personsAndGroupsManager.all.persons.removed(Pt),w.get().personsAndGroupsManager.all.persons.added(Ht)})}function jt(){var e,t,n;_.showIntroText=Q.isFeatureOn(u.featureFlags.SHOW_CHAT_INTRO_TEXT);if(!_.showIntroText)return;_.introMessages=[],b.chatIntroText&&b.chatIntroText.key&&(e=b.chatIntroText.key);if(!e)return;b.chatIntroText&&b.chatIntroText.delimiter&&(n=b.chatIntroText.delimiter),t=m.fetch({key:e});if(!t)return;n?t.split(n).forEach(function(e){_.introMessages.push({text:e.trim()})}):_.introMessages.push({text:t.trim()})}function Ft(){function i(){return t.model.type()===S.activityType.UnblockContact||t.model.type()===S.activityType.ContactRequestOutgoing}var e,t,n,r=_.collection();if(r===undefined||r.length<=0)return;t=r[r.length-1];if(i())return;t.authorName&&(e=t.authorName()),t.author&&t.author.displayName&&(e=t.author.displayName()),n=y.stripHTML(t.content()),e?E.announce({key:"accessibility_chatLog_newMessage",params:{author:e,content:n}},{key:t.clientmessageid}):E.announce({key:"accessibility_chatLog_newMessage_withoutAuthor",params:{content:n}},{key:t.clientmessageid}),pt(t)}function It(e){var t=N.getElement('[data-id="'+e+'"]');t&&t.focus()}var _=this,D={},P,H,B,j,F,I,q,R,U=!0,z,W,X,V=d.resolve(u.serviceLocator.PUBSUB),$=Nt(),J,K,Q=d.resolve(u.serviceLocator.FEATURE_FLAGS),G=Q.isFeatureOn(u.featureFlags.HEARTS_ENABLED),Y=Q.isFeatureOn(u.featureFlags.MARK_READ_MESSAGES_V2_ENABLED),Z,et=null;this.collection=r.observableArray(),this.participants=null,this.init=function(e,t,i,s){V.subscribe(u.events.narrowMode.SIDEBAR_STATE_CHANGED,Ct),V.subscribe(u.events.videoPlayer.FULLSCREEN_ON,At),V.subscribe(u.events.videoPlayer.FULLSCREEN_OFF,Ot),V.subscribe(u.events.message.REMOVED,It),W=t,P=i,j=e.historyService,h.forModel(e),F=o.newObservableCollection(j.activityItems),_.conversation=e,_.participants=e.participants,_.isMouseOver=r.observable(),_.suggestedActionsEnabled=Q.isFeatureOn(u.featureFlags.SUGGESTED_ACTIONS_ENABLED),_.showSuggestedActions=r.observable(!1),_.hasSuggestedActionOnLeft=r.observable(!1),_.hasSuggestedActionOnRight=r.observable(!1),_.suggestedActionsAuthor={},_.suggestedActions=r.observableArray([]),_.showBotDetails=r.pureComputed(function(){return e.isGroupConversation()&&_.showSuggestedActions()&&!!_.suggestedActionsAuthor.displayName&&!!_.suggestedActionsAuthor.avatar}),_.suggestionChanged=function(){var e=W?W.getArrowsPositions():null;if(!e)return;_.hasSuggestedActionOnLeft(e.left),_.hasSuggestedActionOnRight(e.right)},_.scrollLeft=function(){W.scrollSuggestedArea("left",_.suggestionChanged)},_.scrollRight=function(){W.scrollSuggestedArea("right",_.suggestionChanged)},W.init({onContextMenu:_.showContextMenu,onMessageVisibilityChange:_.messageVisibilityChange},e),B=v.hasFocus.subscribe(ht),Z=_.collection.subscribe(Ft),R=j.isHistoryDisclosed.changed(kt),this.registerEvent(a.message.RENDERED,bt),this.registerEvent(a.navigation.FRAGMENT_BEFORE_HIDE,Tt,this.DIRECTION.PARENT),this.forwardEvent(a.navigation.FRAGMENT_SHOW,this.DIRECTION.CHILD,St,this.DIRECTION.PARENT),this.forwardEvent(a.navigation.FRAGMENT_BEFORE_HIDE,this.DIRECTION.CHILD,null),this.forwardEvent(a.conversation.OPEN_PROFILE,this.DIRECTION.PARENT,null,this.DIRECTION.CHILD),this.forwardEvent(a.message.ADD_CONTACT,this.DIRECTION.PARENT,null,this.DIRECTION.CHILD),this.registerEvent(a.conversation.MARK_AS_READ,ht),this.registerEvent(a.message.BEFORE_EXPANDED,Et),this.registerEvent(a.message.AFTER_EXPANDED,wt),this.registerEvent(u.events.videoPlayer.FULLSCREEN_ON,Et),this.registerEvent(u.events.videoPlayer.FULLSCREEN_OFF,wt),G&&_.conversation.historyService._messagesWithUnseenHearts&&j._messagesWithUnseenHearts.changed(Mt),X=s,p.execute(at),Bt(),jt(),_.suggestedActionsEnabled&&(n.addEventListener("resize",_.suggestionChanged),window.setTimeout(function(){_.suggestionChanged()},100))},this.onMouseOver=function(){_.isMouseOver(!0)},this.onMouseOut=function(){_.isMouseOver(!1)},this.onScroll=function(e,t){W&&($(t),W.onScroll(t,A),W.isScrolledToTop()&&!_._updatingMessages&&!Lt()&&gt(),Y?(clearTimeout(et),et=setTimeout(function(){ht(_.isMouseOver())},O)):ht())},this.dispose=function(){W.dispose(),q&&q.dispose(),H&&H.dispose(),R&&R.dispose(),_.showBotDetails.dispose(),B.dispose(),Z.dispose(),X.dispose(),V.unsubscribe(u.events.narrowMode.SIDEBAR_STATE_CHANGED,Ct),V.unsubscribe(u.events.videoPlayer.FULLSCREEN_ON,At),V.unsubscribe(u.events.videoPlayer.FULLSCREEN_OFF,Ot),V.unsubscribe(u.events.message.REMOVED,It),H=null,_.collection=null,W=null,F=null,D=null,G&&j._messagesWithUnseenHearts&&j._messagesWithUnseenHearts.changed.off(Mt),Q.isFeatureOn(u.featureFlags.ENABLE_BUSINESS_CONTACT_MANAGEMENT)&&(w.get().personsAndGroupsManager.all.persons.removed.off(Pt),w.get().personsAndGroupsManager.all.persons.added.off(Ht)),_.suggestedActionsEnabled&&n.removeEventListener("resize",_.suggestionChanged)},this.showContextMenu=function(e,t,n){var r=D[e],i=r&&r.model,s=[],o={source:g.conversation.messageItem},u,a=_.conversation.chatService.sendMessage.enabled();if(!i||!a)return;return n?(s.push(new c.CopySelectionMenuItem(_,i,n)),s.push(new c.CopySelectionTextMenuItem(_,i,n))):(u={source:g.contextMenuItem.removeMessage,parent:g.conversation.messageItem},s.push(new c.CopyMessageMenuItem(_,i)),s.push(new c.QuoteMessageMenuItem(_,i)),s.push(new c.EditMessageMenuItem(_,i)),s.push(new c.RemoveMessageMenuItem(i,u)),s.push(new c.CopyLinkMenuItem(_,r,t)),s.push(new c.OpenLinkMenuItem(_,r,t)),s.push(new c.SaveVideoMessageMenuItem(i))),l.show(s,t,o),l.isVisible()},this.messageVisibilityChange=function(e){if(!U)return;var t=[];e.forEach(function(e){t.push(e.getAttribute("data-id"))}),C.onVisibleViewPortChanged(_.conversation.conversationId,t)}}var t=e("lodash-compat"),n=e("browser/document"),r=e("vendor/knockout"),i=e("utils/common/ko"),s=e("swx-utils-common").array,o=e("utils/common/cafeObservable"),u=e("swx-constants").COMMON,a=e("swx-constants").COMMON.events,f=e("utils/common/eventMixin"),l=e("ui/contextMenu/contextMenu"),c=e("ui/contextMenu/items/all"),h=e("swx-utils-chat").conversationCache,p=e("swx-utils-common").async,d=e("swx-service-locator-instance").default,v=e("utils/common/appVisibilityProvider"),m=e("swx-i18n").localization,g=e("ui/telemetry/actions/actionSources"),y=e("swx-utils-chat").messageSanitizer,b=e("experience/settings"),w=e("swx-cafe-application-instance"),E=e("utils/common/accessibility").narrator,S=e("swx-enums"),x=e("ui/modelHelpers/personHelper"),T=e("swx-log-tracer").getLogger(),N=e("browser/dom"),C=e("ui/players/mediaPlayerController"),k=10,L=10,A=300,O=400,M=51;return t.assign(_.prototype,f),_}),define("jsviews/chat/chatLog",["require","browser/dom","lodash-compat","swx-utils-chat","swx-constants","utils/common/scroll"],function(e){function v(e,v){function L(e){var n=document.getSelection().toString(),r;r=t.getParentWithClass(e.target,o);if(!r)return;if(n&&n.length>0){var i=m.onContextMenu(r.getAttribute("data-id"),e,n);i&&e.preventDefault();return}m.onContextMenu(r.getAttribute("data-id"),e),e.preventDefault()}function A(e){t.addClass(e,h),setTimeout(function(){e&&t.removeClass(e,h)},a)}function O(e){var n=e.length===1;Array.prototype.forEach.call(e,function(e){n&&M(e)&&A(e),t.removeClass(e,p)})}function M(e){return g.lastElementChild===e&&g.childElementCount>1}function D(){return!y||y.scrollHeight-y.scrollTop-e.clientHeight<l}function P(){return!!y&&y.scrollTop<c}function H(){if(!y)return;C=!0,E.scrollHeight=y.scrollHeight,E.scrollBottom=E.scrollHeight-y.scrollTop}function B(t){if(!y){b.scrollTop=b.scrollHeight-e.clientHeight,w.scrollTop=b.scrollHeight-e.clientHeight,C=!1;return}var n=y.scrollHeight,r=n===E.scrollHeight||t,i=r?E.scrollBottom:0;y.scrollTop=n-i,C=!1}function j(){W(),x.resize()}function I(e,t,n){if(!e||!n||!t)return;if(t.children.length<2)return e;var r=n.getBoundingClientRect(),i=t.children,s=null,o=0,u=i.length-1,a,f;while(e){s=e.getBoundingClientRect();if(s.top>r.bottom)u=Array.prototype.indexOf.call(i,e);else{if(!(s.bottom<r.top))return e;o=Array.prototype.indexOf.call(i,e)}a=q(o,u);if(f===a)break;f=a,e=i[a]}}function q(e,t){return e+(t-e>>1)}function R(e,t){var n=e.getBoundingClientRect(),r=n.height/2;return n.top+r<=t.bottom&&n.bottom-r>=t.top}function U(e,t,n){function s(e){if(e&&e.nodeType===1)return R(e,r)?(i.push(e),!1):!0}var r=n.getBoundingClientRect(),i=[];i.push(e);var o=e.nextSibling;while(o){if(s(o))break;o=o.nextSibling}o=e.previousSibling;while(o){if(s(o))break;o=o.previousSibling}return i}function z(){var e=F.slice(),n=I(g.lastElementChild,g,w);n&&(F=U(n,g,w));for(var r=0;r<e.length;r++)F.indexOf(e[r])<0&&t.setClass(e[r],u,!1);F.forEach(function(e){t.setClass(e,u,!0)}),m.onMessageVisibilityChange(F)}function W(e){clearTimeout(T),T=setTimeout(z,e)}function X(e){return D()?!0:P()?!n.find(e,function(e){return e.className.indexOf(d)>-1}):!1}function V(e,t,n,r){var i=n==="scrollLeft"?k.scrollLeft:k.scrollTop,s=e-i,o=s/t*10;window.setTimeout(function(){var s=i+o;n==="scrollLeft"?k.scrollLeft=s:k.scrollTop=s,t-=10;if(s===e||t<=0){r&&r();return}V(e,t,n,r)},10)}var m=null,g,y,b,w,E=null,S,x,T=null,N,C=!1,k,F=[];this.init=function(n,o){m=n,g=t.getElement(".messageHistory",e),E=r.forModel(o),g.addEventListener("contextmenu",L),b=t.getElement(".scroller",e),w=t.getElement(".scrollable",e),window.addEventListener(i.events.browser.RESIZE,j),k=e.querySelector("#chatlog-suggestedActionsArea"),S=s.build(e),S.init(),x=new v(e)},this.dispose=function(){g.removeEventListener("contextmenu",L),window.removeEventListener(i.events.browser.RESIZE,j),m=null,E=null,S.dispose(),x.dispose(),clearTimeout(T)},this.showNewMessages=function(){var e=g.querySelectorAll("."+o+"."+p),t=X(e),n=D();t&&H(),O(e),t&&B(!n),S.update(),W()},this.scrollToMessage=function(e){S.scrollToElement(e.elementInfo.element)},this.restoreScrollPosition=function(){B(!N),S.update()},this.storeScrollPosition=function(){N=D(),H()},this.isScrolledToTop=function(){return P()},this.isScrolledToBottom=function(){return D()},this.scrollSuggestedArea=function(e,t){if(!k)return;var n=e==="left"?k.scrollLeft-k.clientWidth:k.scrollLeft+k.clientWidth;V(n,250,"scrollLeft",t)},this.getArrowsPositions=function(){if(!k)return null;var e=k.scrollLeft===0?!1:!0,t=k.scrollLeft===k.scrollWidth-k.clientWidth?!1:!0;return{left:e,right:t}},this.isScrollable=function(){return e.clientHeight<g.clientHeight+f},this.isScrollPositionStored=function(){return C},this.isVisible=function(){return g.offsetHeight>0},this.isMessageVisible=function(e){var t=n.find(F,function(t){return e===t.attributes["data-id"].value});return!!t},this.onShow=function(){B()},this.onHide=function(){H()},this.onScroll=function(e,t){y=y||e.target,W(t)}.bind(this),this._setScroller=function(e){y=e}}var t=e("browser/dom"),n=e("lodash-compat"),r=e("swx-utils-chat").conversationCache,i=e("swx-constants").COMMON,s=e("utils/common/scroll"),o="message",u="swx-in-viewport",a=800,f=60,l=150,c=100,h="animate",p="loading",d="unread";return v}),define("telemetry/chat/contactInfoEvent",["require","exports","module","experience/settings","swx-constants","ui/telemetry/telemetryClient","swx-telemetry-buckets","ui/modelHelpers/personHelper"],function(e,t){function a(e){var t=e.person;return{state:f(t),hasDisplayName:l(t),contactType:c(t),participantsCount:e.participantsCount,participantsCountGroup:o.getParticipantCountGroup(e.participantsCount),timeInStale:e.timeInStale,timeInStaleGroup:o.getMessageLifeDurationGroup(new Date-e.timeInStale),actionName:e.actionName}}function f(e){return u.isKnownPerson(e)?"EXISTING":"NEW"}function l(e){return e.displayName()!==e.id()}function c(e){return u.isPstn(e)?"PSTN":"SKYPE"}function h(e){var t=i.TYPE,r=a(e);s.get().sendEvent(n.telemetry.chatTenantToken,t,r)}var n=e("experience/settings"),r=e("swx-constants").COMMON,i=r.telemetry.contactInfo,s=e("ui/telemetry/telemetryClient"),o=e("swx-telemetry-buckets"),u=e("ui/modelHelpers/personHelper");t.publishShowEvent=function(e){return e.actionName=i.action.SHOW,h(e)},t.publishActionEvent=function(e){return e.actionName=i.action.CLICK,h(e)}}),define("ui/contactInfoMessage/contactInfoMessage",["require","exports","module","vendor/knockout","utils/common/cafeObservable","swx-i18n","telemetry/chat/contactInfoEvent","ui/modelHelpers/personHelper"],function(e,t){var n=e("vendor/knockout"),r=e("utils/common/cafeObservable"),i=e("swx-i18n").localization,s=e("telemetry/chat/contactInfoEvent"),o=e("ui/modelHelpers/personHelper");t.render=function(t,u,a){function f(e){function s(e){return u.isMyself?i.fetch({key:"chat_contactSent_label"}):o.isKnownPerson(e)?i.fetch({key:"contact_information_already_contact"}):i.fetch({key:"contact_information_add_to_contacts"})}var t={};t.name=n.observable(e.id()),t.fullName=n.observable(e.displayName()),t.actionKey=n.observable(s(e)),t.titleKey=n.observable(i.fetch({key:"label_text_openConversation",params:{displayName:e.displayName()}})),t.avatar=r.newObservableProperty(e.avatarUrl,{keepAlive:!0}),u.contacts.push(t)}function l(e){return u.isMyself?i.fetch({key:"message_text_sentContacts"}):i.fetch({key:"message_text_receivedContacts",params:{from:e.sender.displayName()}})}u.contacts=n.observableArray([]),t.contacts().forEach(function(e){f(e),s.publishShowEvent({participantsCount:a.participantsCount(),timeInStale:u.timestamp.getTime(),person:e})}),u.content=n.observable(l(t))},t.handleContactAdded=function(t,n){n.contacts().forEach(function(e){e.name()===t&&e.actionKey(i.fetch({key:"contact_information_already_contact"}))})}}),define("ui/viewModels/people/contactName",["require","lodash-compat","vendor/knockout","utils/common/eventMixin","ui/viewModels/people/properties/displayNameText"],function(e){function s(e){var t=this,r=i.build(e);t.displayName=n.computed(r.compute),t.getPerson=function(){return e},t.dispose=function(){t.displayName.dispose(),r.dispose()}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/eventMixin"),i=e("ui/viewModels/people/properties/displayNameText");return t.assign(s.prototype,r),s}),define("constants/contentTemplates",["require","exports","module","swx-enums","swx-constants"],function(e,t){var n=e("swx-enums"),r=e("swx-constants").COMMON,i="MessageContentTemplate",s={};s[n.activityType.TextMessage]="text"+i,s[n.activityType.CallStarted]="calling"+i,s[n.activityType.CallEnded]="calling"+i,s[n.activityType.CallMissed]="calling"+i,s[n.activityType.PluginFreeFallbackScreenSharing]="pluginFree"+i,s[n.activityType.PluginFreeFallbackMicrophoneAccess]="pluginFree"+i,s[n.activityType.PluginFreeNoVideoCapability]="pluginFree"+i,s[n.activityType.PluginFreeVideoCompatibility]="pluginFree"+i,s[n.activityType.NgcUpgradeMessage]="ngcUpgrade"+i,s[n.activityType.PstnInsufficientFunds]="pstn"+i,s[n.activityType.PstnInvalidNumber]="pstn"+i,s[n.activityType.PstnForbiddenNumber]="pstn"+i,s[n.activityType.VideoMessage]="video"+i,s[n.activityType.AudioMessage]="audio"+i,s[n.activityType.PictureMessage]="picture"+i,s[n.activityType.FileTransfer]="fileTransfer"+i,s[n.activityType.ContactRequestIncoming]="contactRequestIncoming"+i,s[n.activityType.ContactRequestIncomingInviteFree]="contactRequestIncomingInviteFree"+i,s[n.activityType.ContactRequestOutgoing]="contactRequestOutgoing"+i,s[n.activityType.ContactRequestOutgoingResend]="contactRequestOutgoingResend"+i,s[n.activityType.ContactRequestOutgoingAgent]="contactRequestOutgoingAgent"+i,s[n.activityType.SuggestedContact]="suggestedContact"+i,s[n.activityType.MojiMessage]="moji"+i,s[n.activityType.PollMessage]="poll"+i,s[n.activityType.UnblockContact]="unblockContact"+i,s[n.activityType.ContactInfoMessage]="contactInfo"+i,s[r.customActivityItemTemplates.SPACES_WELCOME_MESSAGE]="spacesWelcome"+i,t.templates=s}),define("telemetry/chat/videoMessagePlayback",["require","experience/settings","swx-constants","ui/telemetry/telemetryClient"],function(e){function i(){function o(e){r.get().sendEvent(t.telemetry.chatTenantToken,i,e)}var e=this,i=n.chat.VIDEO_MESSAGE.TYPE,s={};e.sendLoadedEvent=function(){s.action=n.chat.VIDEO_MESSAGE.eventName.LOADED,o(s)},e.sendFirstPlayAction=function(){s.action=n.chat.VIDEO_MESSAGE.action.FIRST_PLAY,o(s)},e.sendFullscreenAction=function(){s.action=n.chat.VIDEO_MESSAGE.action.FULLSCREEN,o(s)},e.sendSeekAction=function(){s.action=n.chat.VIDEO_MESSAGE.action.SEEK,o(s)},e.sendReplayAction=function(){s.action=n.chat.VIDEO_MESSAGE.action.REPLAY,o(s)}}var t=e("experience/settings"),n=e("swx-constants").COMMON.telemetry,r=e("ui/telemetry/telemetryClient");return new i}),define("telemetry/chat/audioMessagePlayback",["require","experience/settings","swx-constants","ui/telemetry/telemetryClient"],function(e){function i(){function o(e){r.get().sendEvent(t.telemetry.chatTenantToken,i,e)}var e=this,i=n.chat.AUDIO_MESSAGE.TYPE,s={};e.sendFirstPlayAction=function(){s.action=n.chat.AUDIO_MESSAGE.action.VM_CHAT_PLAYBACK,o(s)},e.sendReplayAction=function(){s.action=n.chat.AUDIO_MESSAGE.action.VM_CHAT_REPLAY,o(s)}}var t=e("experience/settings"),n=e("swx-constants").COMMON.telemetry,r=e("ui/telemetry/telemetryClient");return new i}),define("ui/viewModels/chat/messageMediaTypesHandlers",["require","exports","module","swx-enums","utils/common/cafeObservable","swx-i18n","vendor/knockout","swx-service-locator-instance","swx-constants","browser/dom","telemetry/chat/videoMessagePlayback","telemetry/chat/audioMessagePlayback"],function(e,t){function h(){}function p(e,t){var o;t?o=i.fetch({key:"media_picturesharing_group",params:{senderName:e.model.sender.displayName()}}):o=i.fetch({key:"media_picturesharing_one"}),e.hasFailed=s.pureComputed(function(){return e.status()===n.activityStatus.Failed}),e.isPending=s.pureComputed(function(){return e.status()===n.activityStatus.Pending}),e.status=r.newObservableProperty(e.model.status),e.progress=r.newObservableProperty(e.model.progress),e.thumbnailUrl=r.newObservableProperty(e.model.thumbnailUrl),e.pictureUrl=r.newObservableProperty(e.model.pictureUrl),e.content=s.observable(o),e.isPicture=s.observable(!0),e.open=function(){return!e.isPending()&&!e.hasFailed()},e.progressIndicatorBG=s.pureComputed(function(){var t=e.progress(),n=90,r="#C4DAE3",i="#E7F1F5",s=t<=50?i:r,o=Math.floor(t*3.6)+n,u=t<=50?-n:n,a=t===0?0:50;return"linear-gradient("+u+"deg, transparent "+a+"%, "+s+" 50%),"+"linear-gradient("+o+"deg, "+r+" 50%, transparent 50%)"})}function d(e){function t(e){if(!e||e===0)return"0 Bytes";var t=1e3,n=["Bytes","KB","MB","GB"],r=Math.floor(Math.log(e)/Math.log(t));return r>=n.length&&(r=n.length-1),Math.round(e/Math.pow(t,r)*10)/10+" "+n[r]}function o(){var r=e.progress(),s=e.status()===n.activityStatus.Pending,o=Math.round(r*e.model.fileSize/100);if(s){var u=i.fetch({key:"file_transfer_upload_state",params:{size:t(e.model.fileSize),uploaded:t(o)}});return u}return t(e.model.fileSize)}e.typeClasses={},e.typeClasses[e.model.fileType]=!0,e.fileName=e.model.fileName,e.fileType=e.model.fileType,e.fileThumbnailUri=r.newObservableProperty(e.model.fileThumbnailUri),e.fileSize=s.pureComputed(o),e.fileUri=r.newObservableProperty(e.model.fileUri),e.status=r.newObservableProperty(e.model.status),e.progress=r.newObservableProperty(e.model.progress),e.shouldAbort=r.newObservableProperty(e.model.shouldAbort),e.iconClasses={},e.iconClasses[e.fileType]=!0,e.content=s.observable(i.fetch({key:"file_transfer_file_shared"})),e.isAborted=s.pureComputed(function(){var t=e.shouldAbort(),r=e.status()===n.activityStatus.Failed;return t&&r}),e.abortUploading=function(){e.model.shouldAbort(!0)}}function v(e,t){function r(){var t=a.createElement("img");e.onBeforeExpanded(),t.addEventListener("load",function(t){e.isLoaded(!0),t.target.width>t.target.height?e.orientationClass("landscape"):e.orientationClass("portrait"),e.onAfterExpanded()}),t.addEventListener("error",function(){e.hasFailed(!0),e.onAfterExpanded()}),t.src=e.thumbnailUrl}var n;t?n=i.fetch({key:"media_videosharing_group",params:{senderName:e.model.sender.displayName()}}):n=i.fetch({key:"media_videosharing_one"}),e.thumbnailUrl=e.model.thumbnailPath(),e.mediaUrl=e.model.mediaUrl(),e.isLoaded=s.observable(!1),e.isPlaying=s.observable(!1),e.hasExpired=s.observable(!1),e.hasFailed=s.observable(!1),e.orientationClass=s.observable(),e.content=s.observable(n),e.play=function(){e.isPlaying(!0),f.sendFirstPlayAction()},e.model.isExpired.get().then(function(t){t?e.hasExpired(!0):e.isRendered?r():e.registerEvent(u.events.message.RENDERED,r)})}function m(e,t){var n;t?n=i.fetch({key:"media_audiosharing_group",params:{senderName:e.model.sender.displayName()}}):n=i.fetch({key:"media_audiosharing_one"}),e.mediaUrl=e.model.mediaUrl(),e.isLoaded=s.observable(!0),e.isPlaying=s.observable(!1),e.hasExpired=s.observable(!1),e.hasFailed=s.observable(!1),e.content=s.observable(n),e.voiceMessage=s.observable(i.fetch({key:"media_voice_message"})),e.play=function(){e.isPlaying(!0),l.sendFirstPlayAction()},e.model.isExpired.get().then(function(t){t&&e.hasExpired(!0)})}function g(e,t){function a(e,t){var n,r;n=t._mojiURL,r=t._thumbnailURL,e.mojiUrl(n),e.mojiThumbnailUrl(r)}function f(t){a(e,t),e.mojiTitle(t.description),e.mojiLinkName(t.auxiliaryText),e.mojiLinkUrl(t.auxiliaryUrl),e.mojiCopyright(t.copyright),e.typeClasses("moji keyframe"),e.mojiErrorText(null)}function l(){e.typeClasses("moji mojifailed"),e.mojiErrorText(i.fetch({key:"pes_moji_error_text"}))}function c(){return r.fetchMetadata(e.model.mojiUrl()).then(f,l)}var n,r=o.resolve(u.serviceLocator.PES_CONFIG_SERVICE);return t?n=i.fetch({key:"media_mojisharing_group",params:{senderName:e.model.sender.displayName()}}):n=i.fetch({key:"media_mojisharing_one"}),e.typeClasses=s.observable("mojiloading"),e.mojiThumbnailUrl=s.observable(),e.mojiUrl=s.observable(),e.isSticker=s.observable(!0),e.isMoji=s.observable(!0),e.mojiTitle=s.observable(""),e.mojiLinkName=s.observable(""),e.mojiLinkUrl=s.observable(""),e.mojiCopyright=s.observable(""),e.mojiErrorText=s.observable(),e.isMojiPlaying=s.observable(!1),e.isMojiPlayed=s.observable(!1),r.on(u.events.personalExpression.CONFIG_INITIALIZED,c),e.autoDisposer.registerDisposable({dispose:function(){r.off(u.events.personalExpression.CONFIG_INITIALIZED,c)}}),e.stopMojiPlay=function(e,t){var n=t.target,r=n.previousElementSibling;r.pause()},e.playMoji=function(t,n){function s(){e.isMojiPlayed(!0),e.isMojiPlaying(!1),i.removeEventListener("pause",s,!1),i.removeEventListener("ended",s,!1)}var r=n.target,i=r.previousElementSibling.previousElementSibling;if(e.isMojiPlaying()){i.pause();return}e.isMojiPlaying(!0),i.play(),i.addEventListener("ended",s,!1),i.addEventListener("pause",s,!1)},e.i18n=function(e){return i.fetch({key:e})},e.content=s.observable(n),c()}var n=e("swx-enums"),r=e("utils/common/cafeObservable"),i=e("swx-i18n").localization,s=e("vendor/knockout"),o=e("swx-service-locator-instance").default,u=e("swx-constants").COMMON,a=e("browser/dom"),f=e("telemetry/chat/videoMessagePlayback"),l=e("telemetry/chat/audioMessagePlayback"),c={};c[n.activityType.VideoMessage]=v,c[n.activityType.AudioMessage]=m,c[n.activityType.PictureMessage]=p,c[n.activityType.MojiMessage]=g,c[n.activityType.FileTransfer]=d,t.fetch=function(e){return c[e]||h}}),define("constants/activityTypeGroups",["require","exports","module","swx-enums"],function(e,t){var n=e("swx-enums");t.CALL_MESSAGES=[n.activityType.CallStarted,n.activityType.CallEnded,n.activityType.CallMissed],t.PSTN_MESSAGES=[n.activityType.PstnInsufficientFunds,n.activityType.PstnInvalidNumber,n.activityType.PstnForbiddenNumber],t.PLUGIN_FREE_MESSAGES=[n.activityType.PluginFreeFallbackScreenSharing,n.activityType.PluginFreeFallbackMicrophoneAccess,n.activityType.PluginFreeNoVideoCapability,n.activityType.PluginFreeVideoCompatibility],t.NGC_UPGRADE_MESSAGES=[n.activityType.NgcUpgradeMessage],t.MEDIA_MESSAGES=[n.activityType.VideoMessage,n.activityType.PictureMessage,n.activityType.AudioMessage,n.activityType.MojiMessage,n.activityType.FileTransfer],t.PARTICIPANT_MESSAGES=[n.activityType.ParticipantJoined,n.activityType.ParticipantLeft,n.activityType.ParticipantJoinFailed,n.activityType.ParticipantRoleUpdate,n.activityType.ParticipantTopicUpdate,n.activityType.ParticipantPictureUpdate,n.activityType.ParticipantHistoryDisclosed,n.activityType.ParticipantJoiningEnabled,n.activityType.ParticipantLegacyMemberAdded,n.activityType.ParticipantLegacyMemberUpgraded],t.CONTACT_REQUEST_MESSAGES=[n.activityType.ContactRequestIncoming,n.activityType.ContactRequestIncomingInviteFree,n.activityType.ContactRequestOutgoing,n.activityType.ContactRequestOutgoingResend,n.activityType.ContactRequestIsNowContact,n.activityType.SuggestedContact,n.activityType.UnblockContact,n.activityType.ContactRequestOutgoingAgent],t.CONTACT_INFO_MESSAGES=[n.activityType.ContactInfoMessage],t.TRANSACTION_MESSAGES=[n.activityType.CreditTransaction],t.POLL_MESSAGES=[n.activityType.PollMessage],t.CUSTOM_MESSAGES=[n.activityType.CustomMessage],t.TRANSCRIPT_MESSAGES=[n.activityType.Transcript],t.SYSTEM_MESSAGES=[n.activityType.SystemMessage]}),define("utils/chat/message",["require","swx-enums","constants/activityTypeGroups","swx-constants","swx-browser-detect","constants/calling.resources","swx-i18n","swx-utils-chat","swx-service-locator-instance","swx-utils-chat","ui/viewModels/people/properties/displayNameText","ui/viewModels/people/properties/locationText","experience/settings","lodash-compat","ui/modelHelpers/personHelper"],function(e){function v(e,t,n){var i,s="28:"+e,u=n._botsSettings,a=u?m(s,u):r.chat.BOT_MESSAGING_MODE.UNDEFINED;switch(a){case r.chat.BOT_MESSAGING_MODE.ALL:i="message_text_addedBotGroupConversation_allMessagesMode";break;case r.chat.BOT_MESSAGING_MODE.AT:case r.chat.BOT_MESSAGING_MODE.UNDEFINED:i="message_text_addedBotGroupConversation_privateMode"}return o.fetch({key:i,params:{botName:t}})}function m(e,t){return e&&t[e]?t[e].messagingMode:r.chat.BOT_MESSAGING_MODE.UNDEFINED}var t=e("swx-enums"),n=e("constants/activityTypeGroups"),r=e("swx-constants").COMMON,i=e("swx-browser-detect").default,s=e("constants/calling.resources").fallbackMessages,o=e("swx-i18n").localization,u=e("swx-utils-chat").dateTime,a=e("swx-service-locator-instance").default,f=e("swx-utils-chat").messageSanitizer,l=e("ui/viewModels/people/properties/displayNameText"),c=e("ui/viewModels/people/properties/locationText"),h=e("experience/settings"),p=e("lodash-compat"),d=e("ui/modelHelpers/personHelper");return{getMessageFromParticipantActivityItem:function(e,n,i,s,u,l){function b(){var e="";return i.forEach(function(t,n){e=n===0?e+t.displayName():e+", "+t.displayName()}),e}function w(e){var t="",n=p.some(e,function(e){return d.isAgent(e.getPerson())});return n?(e.forEach(function(e){var n=e.getPerson(),r=p.escape(n.displayName());if(!d.isAgent(n))return;m?t+="\n"+v(n.id(),r,l):t+="\n"+o.fetch({key:"message_text_botWasAddedToConversation",params:{botName:r}})}),t):""}function E(){return o.fetch({key:"message_text_wasAddedToConversation",params:{participant:g(),contact:b()}})}function S(e,t){return a.resolve(r.serviceLocator.FEATURE_FLAGS).isFeatureOn(r.featureFlags.SPACES)?e()===t():!1}function x(e){var t=[];e.participants().forEach(function(e){t.push(e.person.displayName())});if(t.length===0)return;if(t.length===1)return o.fetch({key:"message_text_meJoinedConversation_one",params:{participant:t[0]}});var n=t.pop();return o.fetch({key:"message_text_meJoinedConversation_more",params:{participants:t.join(", "),participant:n}})}var c=a.resolve(r.serviceLocator.FEATURE_FLAGS),h=c.isFeatureOn(r.featureFlags.SINGLE_CONVERSATION_MODE),m=c.isFeatureOn(r.featureFlags.BOT_MESSAGES_MODE_V2_ENABLED),g=n.displayName,y=d.isMePerson(n);switch(e){case t.activityType.ParticipantJoined:if(i.length>0)return E()+w(i);if(h&&y&&l)return x(l);return o.fetch({key:"message_text_joinedConversation",params:{participant:g()}});case t.activityType.ParticipantJoinFailed:return o.fetch({key:"message_text_joinConversationFailed",params:{participant:g()}});case t.activityType.ParticipantLeft:if(S(g,s))return o.fetch({key:"message_text_guestRemovedBySystem",params:{participant:b()}});if(i.length>0)return o.fetch({key:"message_text_wasRemovedFromConversation",params:{participant:g(),removedParticipant:b()}});if(u&&u.subcode==="Ejected"&&u.message==="You were removed from the meeting.")return o.fetch({key:"message_text_youWereRemovedFromConversation"});return o.fetch({key:"message_text_hasLeftConversation",params:{participant:g()}});case t.activityType.ParticipantRoleUpdate:return o.fetch({key:"message_text_roleUpdated",params:{who:g(),whom:i[0]?i[0].displayName():g(),role:s()}});case t.activityType.ParticipantTopicUpdate:var T=s?f.escapeHTML(s()):"";return o.fetch({key:"message_text_topicUpdated",params:{participant:g(),topic:T}});case t.activityType.ParticipantPictureUpdate:return o.fetch({key:"message_text_threadPictureUpdated",params:{participant:g()}});case t.activityType.ParticipantHistoryDisclosed:return o.fetch({key:s()?"message_text_historyDisclosed":"message_text_historyClosed",params:{participant:g()}});case t.activityType.ParticipantJoiningEnabled:return o.fetch({key:s()?"message_text_joiningEnabled":"message_text_joiningDisabled",params:{participant:g()}});case t.activityType.ParticipantLegacyMemberAdded:return o.fetch({key:"message_text_legacyMemberAdded",params:{participant:g()}});case t.activityType.ParticipantLegacyMemberUpgraded:return o.fetch({key:"message_text_legacyMemberUpgraded",params:{participant:g()}})}return""},getMessageFromCallActivityItem:function(e,n){function a(){return i?o.fetch({key:"message_text_ended"+r}):o.fetch({key:"message_text_outgoing"+r+"NoAnswer"})}var r=n?"GroupCall":"Call",i=!!e.duration(),s={callAction:"",duration:i?u.formatCallDuration(e.duration()):"",text:""};switch(e.type()){case t.activityType.CallStarted:s.callAction="callStart",s.text=o.fetch({key:"message_text_started"+r});break;case t.activityType.CallEnded:s.callAction="callEnd",s.text=a();break;case t.activityType.CallMissed:s.callAction="callMissed",s.text=o.fetch({key:"message_text_missed"+r})}return s},getMessageFromContactRequestActivityItem:function(e,n){var r;switch(e){case t.activityType.ContactRequestIncoming:return o.fetch({key:"message_text_addingContactRequest",params:{id:n.id()}});case t.activityType.ContactRequestIsNowContact:return o.fetch({key:"message_text_contactRequestIsNowContact",params:{displayName:l.format(n.id(),n.displayName())}});case t.activityType.ContactRequestIncomingInviteFree:return r=c.format(n.location),r?o.fetch({key:"invite_free_message_received_location",params:{displayName:l.format(n.id(),n.displayName()),location:r}}):o.fetch({key:"invite_free_message_received",params:{displayName:l.format(n.id(),n.displayName())}})}return""},getMessageFromNgcUpgradeActivityItem:function(e){var t=e.participantNames();return t.length===1?o.fetch({key:"message_text_ngcUpgradeMessage_one",params:{participant:t[0],link:s.ngcUpgradeLink}}):t.length>1?o.fetch({key:"message_text_ngcUpgradeMessage_many",params:{participantList:t.slice(0,t.length-1).join(", "),lastParticipant:t[t.length-1],link:s.ngcUpgradeLink}}):""},getMessageFromPluginFreeActivityItem:function(e){function n(){var e=o.fetch({key:"message_text_pluginFree_screenSharingFallback_line1"}),t=o.fetch({key:"message_text_pluginFree_screenSharingFallback_line2",params:{upgrade_link:s.skypeUpgradeLink}});return e+"\r\n"+t}function r(){return o.fetch({key:i.getBrowserInfo().isEdge?"message_text_pluginFree_microphoneAccess_edge":"message_text_pluginFree_microphoneAccess_others"})}function u(){return o.fetch({key:"message_text_pluginFree_noVideoCapability"})}function a(){return u()}switch(e.type()){case t.activityType.PluginFreeFallbackScreenSharing:return n();case t.activityType.PluginFreeFallbackMicrophoneAccess:return r();case t.activityType.PluginFreeNoVideoCapability:return u();case t.activityType.PluginFreeVideoCompatibility:return a()}return""},getMessageFromPstnActivityItem:function(e){function n(e){var t='<a href="{url}" target="_blank" class="{class}">{text}</a>',n=h.commerce.purchaseCreditUrl,i=h.commerce.purchaseSubscriptionUrl,s,u,a,f,l=r.telemetry.pstn.cssClasses.ADD_CREDIT,c=r.telemetry.pstn.cssClasses.ADD_SUBSCRIPTION;return s=o.fetch({key:"pstn_insufficient_funds_credit"}),u=o.fetch({key:"pstn_insufficient_funds_subscription"}),a=t.replace("{url}",n).replace("{text}",s).replace("{class}",l),f=t.replace("{url}",i).replace("{text}",u).replace("{class}",c),e.isGroup()?e.participantName()===e.participantEndpoint()?o.fetch({key:"pstn_insufficient_funds_group",params:{phoneNumber:e.participantEndpoint(),credit:a,subscription:f}}):o.fetch({key:"pstn_insufficient_funds_group_name",params:{displayName:e.participantName(),phoneNumber:e.participantEndpoint(),credit:a,subscription:f}}):o.fetch({key:"pstn_insufficient_funds",params:{credit:a,subscription:f}})}function i(e){return e.isGroup()?e.participantName()===e.participantEndpoint()?o.fetch({key:"pstn_invalid_number_group",params:{phoneNumber:e.participantEndpoint()}}):o.fetch({key:"pstn_invalid_number_group_name",params:{displayName:e.participantName(),phoneNumber:e.participantEndpoint()}}):o.fetch({key:"pstn_invalid_number"})}function s(e){return e.isGroup()?e.participantName()===e.participantEndpoint()?o.fetch({key:"pstn_forbidden_number_group",params:{phoneNumber:e.participantEndpoint()}}):o.fetch({key:"pstn_forbidden_number_group_name",params:{displayName:e.participantName(),phoneNumber:e.participantEndpoint()}}):o.fetch({key:"pstn_forbidden_number"})}switch(e.type()){case t.activityType.PstnInsufficientFunds:return n(e);case t.activityType.PstnInvalidNumber:return i(e);case t.activityType.PstnForbiddenNumber:return s(e)}return""},getActivityItemGroup:function(e){return n.PARTICIPANT_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.PARTICIPANT:n.CALL_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.CALL:n.NGC_UPGRADE_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.NGC_UPGRADE:n.PLUGIN_FREE_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.PLUGIN_FREE:n.MEDIA_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.MEDIA:n.CONTACT_REQUEST_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.CONTACT_REQUEST:n.POLL_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.POLL:n.CONTACT_INFO_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.CONTACT_INFO:n.TRANSACTION_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.TRANSACTION:n.PSTN_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.PSTN:n.CUSTOM_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.CUSTOM:n.TRANSCRIPT_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.TRANSCRIPT:n.SYSTEM_MESSAGES.indexOf(e)!==-1?r.activityItemGroups.SYSTEM:r.activityItemGroups.TEXT},getBotDisclosureMessage:v}}),define("telemetry/chat/poll",["require","experience/settings","swx-constants","ui/telemetry/telemetryClient","swx-service-locator-instance","utils/common/styleModeHelper"],function(e){function o(){this.pollDesignerOpened=function(o){var u={};u[n.telemetry.poll.property.CONVERSATION_ID]=o,u.mediaBarV2Enabled=i.resolve(n.serviceLocator.FEATURE_FLAGS).isFeatureOn(n.featureFlags.MEDIA_BAR_V2_ENABLED),u.styleMode=s.get().currentMode(),r.get().sendEvent(t.telemetry.chatTenantToken,n.telemetry.poll.eventName.DESIGNER_OPENED,u)},this.stickyMessageClicked=function(i){var s={};s[n.telemetry.poll.property.CONVERSATION_ID]=i.conversationId(),s[n.telemetry.poll.property.MESSAGE_ID]=i.key(),r.get().sendEvent(t.telemetry.chatTenantToken,n.telemetry.poll.eventName.STICKY_MESSAGE_CLICKED,s)},this.avatarElipsisClicked=function(i){var s={};s[n.telemetry.poll.property.CONVERSATION_ID]=i.conversationId(),s[n.telemetry.poll.property.MESSAGE_ID]=i.key(),r.get().sendEvent(t.telemetry.chatTenantToken,n.telemetry.poll.eventName.AVATAR_ELIPSIS_CLICKED,s)},this.activityVote=function(s){var o=e(s,n.telemetry.poll.activityType.VOTE);o[n.telemetry.poll.property.IS_NEW_VOTE]=!0,r.get().sendEvent(t.telemetry.chatTenantToken,n.telemetry.poll.eventName.ACTIVITY,o)};var e=function(t,r){var i={};return i[n.telemetry.poll.property.CONVERSATION_ID]=t.conversationId(),i[n.telemetry.poll.property.MESSAGE_ID]=t.key(),i[n.telemetry.poll.property.ACTIVITY_TYPE]=r,i[n.telemetry.poll.property.XMM_TYPE]=t.xmmType(),i[n.telemetry.poll.property.QUESTION_LENGTH]=t.pollQuestion().length,i[n.telemetry.poll.property.ANSWERS_COUNT]=t.pollAnswers().length,i[n.telemetry.poll.property.MULTI_VOTE]=t.multipleVotes(),i[n.telemetry.poll.property.TIME_SINCE_CREATION]=(new Date).getTime()-t.timestamp(),i}}var t=e("experience/settings"),n=e("swx-constants").COMMON,r=e("ui/telemetry/telemetryClient"),i=e("swx-service-locator-instance").default,s=e("utils/common/styleModeHelper");return new o}),define("ui/viewModels/chat/pollAvatars",["require","exports","module","vendor/knockout","swx-i18n","ui/viewModels/people/contactBuilder","telemetry/chat/poll"],function(e,t){function o(e,t){function u(e){var t=o.model.pollAnswers()[e];o.selectedEllipsis(e),o.users.removeAll(),t.users.forEach(function(e){var t={};t.person=e.person,t.displayName=e.displayName,e.person&&(t.contact=i.build(e.person)),o.users.push(t)})}var o=this;o.selectedEllipsis=n.observable(-1),o.model=e,o.users=n.observableArray(),o.isSelfPopup=function(e,t){return o.selectedEllipsis()===e&&t.key==="polls"},o.onEllipsisClick=function(e,n,r){s.avatarElipsisClicked(o.model),u(e),t({key:"polls",eventPageY:r.pageY})},o.votedByCount=function(e){return r.fetch({key:"poll_list_title",params:{count:e}})}}var n=e("vendor/knockout"),r=e("swx-i18n").localization,i=e("ui/viewModels/people/contactBuilder"),s=e("telemetry/chat/poll");t.build=function(e,t){return new o(e,t)}}),define("ui/viewModels/chat/messageParsers/swift/telemetry/swiftCardTelemetry",["require","swx-constants","experience/settings","ui/telemetry/telemetryClient"],function(e){function s(){function o(e){for(var t in e)e.hasOwnProperty(t)&&!(typeof e[t]=="string"||e[t]instanceof String)&&(e[t]=e[t]+"");return e}function u(e,t,n){var r={};return r.card_cta_type=e||s,r.card_cta_success=t?1:0,r.card_bot_id=n?"28:"+n:s,r}function a(e,t){try{i.get().sendEvent(r.telemetry.uiTenantToken,e,o(t))}catch(n){}}function f(e,t,n){var r={};r.card_failure_reason=t||s,r.card_bot_id=n?"28:"+n:s,a(e,r)}var e=this,s=t.telemetry.NOT_AVAILABLE;e.publishCardAction=function(e,t,r){var i=u(e,t,r);a(n.swiftCardActionEventName,i)},e.publishInvalidCard=function(e,t){f(n.swiftCardInvalidEventName,e,t)},e.publishUnsupportedCard=function(e,t){f(n.swiftCardUnsupportedEventName,e,t)}}var t=e("swx-constants").COMMON,n=t.telemetry.swiftCard,r=e("experience/settings"),i=e("ui/telemetry/telemetryClient");return s.build=function(){return new s},s}),define("ui/viewModels/chat/messageParsers/swift/utils",["require","lodash-compat","swx-constants","swx-cafe-application-instance","swx-encoder/lib/encoders/emoticonEncoder","swx-encoder","swx-utils-chat","swx-service-locator-instance","experience/settings"],function(e){function h(e,n){var r=v(e,n);return r=t.filter(r,function(e){return!e.isValid||e.isValid()}),r}function p(e,n){var r=v(e,n);return r=t.filter(r,function(e){return!e.isDisabled||!e.isDisabled()}),r}function d(e){return!e.isDisabled||!e.isDisabled()?e:null}function v(e,n){var r=t.isArray(e)?t.compact(e.map(n)):[];return r}function m(e){return e?o.getMessageSanitizedContent(e):null}function g(e,t){function i(e){var t;for(var n=0;n<r.length;n++){t=new RegExp("^"+r[n]+":","i");if(t.test(e))return c}return e}function s(e){var t=["https:","http:","skype:"];try{var n=document.createElement("a");return n.href=e,t.indexOf(n.protocol)>-1?e:c}catch(r){return c}}function u(e){var t=new RegExp(/^skype:[a-zA-Z0-9-_,\.\*@\?:]{6,256}/g),n=new RegExp(/^(https?:\/\/)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g);return!!e.match(n)|!!e.match(t)?e:c}function f(e){if(e===c)return c;var t=new RegExp(/^[\s\S]*javascript:/igm);return e.match(t)?c:e}var n=e?o.getMessageSanitizedContent(e):c,r=a.swift.urlPrefixBlacklist;switch(t){case"openUrl":case"payment":case"showImage":n=s(n),n=u(n),n=i(n);break;case"signIn":n=/^https/i.test(n)?n:c;break;default:}return n=f(n),n}function y(e){return/^(skype|tel):/i.test(e)?o.getMessageSanitizedContent(e):c}function b(e,t,n){return e=e&&e.toLowerCase(),t.hasOwnProperty(e)?t[e]:n}function w(e){return e?f(o.getMessageSanitizedContent(o.unwebify(e))):null}function E(){var e=u.resolve(n.serviceLocator.FEATURE_FLAGS),t=e.isFeatureOn(n.featureFlags.SWIFT_CARD_RENDERING_MEDIA_CARDS);l["application/vnd.microsoft.card.hero"]=l.hero,l["application/vnd.microsoft.card.thumbnail"]=l.thumb,l["application/vnd.microsoft.card.receipt"]=l.receipt,l["application/vnd.microsoft.card.signin"]=l.signIn,l["application/vnd.microsoft.card.flex"]=l.flex,t&&(l["application/vnd.microsoft.card.video"]=l.video,l["application/vnd.microsoft.card.audio"]=l.audio,l["application/vnd.microsoft.card.animation"]=l.animation)}var t=e("lodash-compat"),n=e("swx-constants").COMMON,r=e("swx-cafe-application-instance"),i=e("swx-encoder/lib/encoders/emoticonEncoder"),s=e("swx-encoder"),o=e("swx-utils-chat").messageSanitizer,u=e("swx-service-locator-instance").default,a=e("experience/settings"),f,l={unknown:"Unknown",hero:"Hero",thumb:"Thumb",receipt:"Receipt",signIn:"SignIn",flex:"Flex",audio:"Audio",video:"Video",animation:"Animation"},c="invalidValue";return f=function(t){var n=i.build(),o=s.build(r,{domTransformers:[n]});return f=function(t){return o.decode(o.encode(t,!1))},f(t)},{ContentType:l,invalidValue:c,filterOutNotValidItems:h,filterOutDisabledItems:p,normalizeDestination:y,normalizeEnum:b,normalizeRichText:w,normalizeText:m,normalizeUrl:g,mapArray:v,getItemIfNotDisabled:d,setSupportedSwiftCardTypes:E}}),define("ui/viewModels/chat/messageParsers/swift/action",["require","swx-cafe-application-instance","ui/viewModels/calling/helpers/callingFacade","swx-enums","swx-i18n","vendor/knockout","swx-encoder/lib/encoders/mentionsEncoder","swx-constants","swx-constants","ui/viewModels/chat/messageParsers/swift/telemetry/swiftCardTelemetry","ui/viewModels/chat/messageParsers/swift/utils","swx-pubsub-instance"],function(e){function m(e,t,n){this.type=e.type?c.normalizeEnum(e.type,m.Type,m.Type.unknown):null,this.title=c.normalizeRichText(e.title),this.value=e.value?e.value:null,this.fallbackUri=e.fallback&&e.fallback.uri?c.normalizeUrl(e.fallback.uri,m.Type.payment):null,this.isCalling=s.observable(!1),this.senderId=n.id(),this.tooltip=this.title;switch(this.type){case m.Type.call:this.value=c.normalizeDestination(this.value);break;case m.Type.imBack:var r;if(t.isGroupConversation()){var u=o.build(t),a=u.getMentionUserData(this.senderId);r=a?u.createXmlElement(document,a).outerHTML:null}r&&(this.value=r+" "+this.value);break;case m.Type.showImage:this.value&&(this.value=c.normalizeUrl(e.value,m.Type.showImage)),this.title||(this.title=i.fetch({key:"accessibility_swift_showImage"}));break;case m.Type.openUrl:this.value=c.normalizeUrl(e.value,m.Type.openUrl),this.tooltip?this.tooltip+="\n\n"+this.value:this.tooltip=this.value;break;case m.Type.payment:this.value=this.fallbackUri?this.fallbackUri:c.normalizeUrl(e.value,m.Type.payment),this.tooltip?this.tooltip+="\n\n"+this.value:this.tooltip=this.value,this.title||(this.title=this.tooltip);break;case m.Type.signIn:this.value=c.normalizeUrl(e.value,m.Type.signIn),this.title||(this.title=i.fetch({key:"message_text_swift_signInTitle"}));break;case m.Type.unsupportedType:this.type=m.Type.openUrl,this.title||(this.title=i.fetch({key:"message_text_swift_unsupported_button"})),this.value||(this.value=d);break;default:}this.conversation=t,this.action=this.action.bind(this);if(!this.isValid()){var h=l.build();this.type?this.title?this.value||h.publishInvalidCard(f.invalidCardReasons.MissinActionValue,this.senderId):h.publishInvalidCard(f.invalidCardReasons.MissinActionTitle,this.senderId):h.publishInvalidCard(f.invalidCardReasons.MissingActionType,this.senderId)}}var t=e("swx-cafe-application-instance"),n=e("ui/viewModels/calling/helpers/callingFacade"),r=e("swx-enums"),i=e("swx-i18n").localization,s=e("vendor/knockout"),o=e("swx-encoder/lib/encoders/mentionsEncoder"),u=e("swx-constants").PEOPLE,a=e("swx-constants").COMMON,f=a.telemetry.swiftCard,l=e("ui/viewModels/chat/messageParsers/swift/telemetry/swiftCardTelemetry"),c=e("ui/viewModels/chat/messageParsers/swift/utils"),h=a.events,p=e("swx-pubsub-instance").default,d="https://www.skype.com/",v="width=600, height=620, menubar=no, status=no, titlebar=no, toolbar=no, rel=noopener noreferrer";m.Type={unknown:"unknown",unsupportedType:"unsupportedType",openUrl:"openUrl",imBack:"imBack",signIn:"signIn",call:"call",showImage:"showImage",payment:"payment",chat:"chat"};for(var g in m.Type){var y=g.toLowerCase();m.Type.hasOwnProperty(g)&&!m.Type.hasOwnProperty(y)&&(m.Type[y]=m.Type[g])}return m.prototype.isValid=function(){return!!this.type&&!!this.title&&(!!this.value||!!this.fallbackUri)},m.prototype.isDisabled=function(){return!!this.value&&this.value===c.invalidValue},m.prototype.isSupported=function(){return!!this.type&&this.type!==m.Type.unknown},m.prototype.action=function(){function n(e,t,n){var r=l.build();r.publishCardAction(e,t,n)}var t=this;return this.isValid()&&!this.isCalling()?this[this.type]().then(function(){n(t.type,!0,t.senderId)}).catch(function(){n(t.type,!1,t.senderId)}):(n(this.type,!1,this.senderId),Promise.resolve())},m.prototype[m.Type.openUrl]=function(){var t;return this.value.match(/^skype:.*\?chat$/)?this.chat():this.value.match(/^skype:/)?this.call():(t=window.open(),t.opener=null,t.location=this.value,Promise.resolve())},m.prototype[m.Type.payment]=function(){if(!this.value)return;var t=window.open(this.value,"_blank",v);return t&&window.focus&&t.focus(),t.opener=null,Promise.resolve()},m.prototype[m.Type.showImage]=m.prototype[m.Type.openUrl],m.prototype[m.Type.signIn]=m.prototype[m.Type.openUrl],m.prototype[m.Type.imBack]=function(){return this.conversation.chatService._sendMessageWithoutSanitization(this.value)},m.prototype[m.Type.call]=function(){function c(){var e=f.results().length,t=e?f.results(0).result:undefined;s.isCalling(!1);if(t&&t.id()===a)return h(t._type()+":"+t.id())}function h(e){var r=t.get().conversationsManager._getOrCreateConversation(e);if(!o){var i=r.participants(0),s=i&&i.person.phoneNumbers(0)?i.person.phoneNumbers(0).telUri():a;i.audio.endpoint&&i.audio.endpoint(s)}return n.placeCall(r,!1,"swiftCardAction",!0)}var i=this.value.match(/^(skype|tel):(.*)$/),s=this,o=i[1]==="skype",a=i[2];if(o){var f=t.get().personsAndGroupsManager.createPersonSearchQuery(),l=r.searchScope.All;return f.sources(l).keywords.id=a,this.isCalling(!0),f.getMore().then(c)}return h(u.contactTypes.PSTN+":"+a)},m.prototype[m.Type.chat]=function(){function d(){var e=l.results().length,t=e?l.results(0).result:undefined;if(t&&t.id()===u){var n=i.conversationsManager.getConversation(t);return v(n)}}function v(e){i.conversationsManager.conversations.add(e),p.publish(h.navigation.OPEN_CONVERSATION,{model:e,origin:a.telemetry.historyLoadOrigin.AUTHOR_SWITCH})}var n=this.value.match(/^(skype):(.*)\?chat$/),i=t.get(),s=n[1]==="skype",o=n[2].match(/^19:/)!==null,u=n[2];if(o){var f=i.conversationsManager.getConversationByUri(u);return new Promise(function(){return v(f)})}if(s){var l=t.get().personsAndGroupsManager.createPersonSearchQuery(),c=r.searchScope.All;return l.sources(c).keywords.id=u,l.getMore().then(d)}},{build:function(e,t,n){return new m(e,t,n)},Type:m.Type}}),define("ui/viewModels/chat/messageParsers/swift/fact",["require","ui/viewModels/chat/messageParsers/swift/utils"],function(e){function n(e){this.key=t.normalizeRichText(e.key),this.value=t.normalizeRichText(e.value)}var t=e("ui/viewModels/chat/messageParsers/swift/utils");return n.prototype.isValid=function(){return!!this.key||!!this.value},{build:function(e){return new n(e)}}}),define("ui/viewModels/chat/messageParsers/swift/image",["require","ui/viewModels/chat/messageParsers/swift/action","vendor/knockout","swx-constants","utils/common/styleModeHelper","ui/viewModels/chat/messageParsers/swift/utils","swx-i18n","experience/settings","utils/common/rtlChecker"],function(e){function d(e,t,n){var i;return t!==r.NARROW?n?i=l.carouselDefault:i=l.default:n?i=l.carouselNarrow:i=l.narrow,i[e]}function v(e){var t="/v1/url/content?url=",n=a.urlPServiceHost+t,r,i,o;return e.url?(e.url.indexOf(p[0])!==-1||e.url.indexOf(p[1])!==-1?o=s.normalizeUrl(e.url):e.url.indexOf(n)===-1?o=n+encodeURIComponent(e.url):(r=n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),i=new RegExp(r,"g"),o=n+encodeURIComponent(e.url.replace(i,""))),o):null}function m(e,r,i,o){this.contentType=o,this.alt=s.normalizeRichText(e.alt),this.url=v(e),this.tap=null,e.tap&&(this.tap=s.getItemIfNotDisabled(t.build(e.tap,r,i)),this.tap&&this.tap.type===t.Type.showImage&&!this.tap.value&&(this.tap.value=this.url)),this.naturalSize=n.observable({height:0,width:0}),this.uiSize=n.pureComputed(this.getUiSize.bind(this)),this.bottomAlignment=n.observable(),this.leftAlignment=n.observable(),this.rightAlignment=n.observable(),this.isImageInCarousel=n.observable(!1),this.url&&this.loadImageSize()}var t=e("ui/viewModels/chat/messageParsers/swift/action"),n=e("vendor/knockout"),r=e("swx-constants").COMMON.styleMode,i=e("utils/common/styleModeHelper"),s=e("ui/viewModels/chat/messageParsers/swift/utils"),o=s.ContentType,u=e("swx-i18n").localization,a=e("experience/settings"),f=e("utils/common/rtlChecker"),l={narrow:{},"default":{},carouselDefault:{},carouselNarrow:{}},c="auto",h="px",p=[a.amdServiceHost,a.pesCDNAuthentication.cdnServiceHost];return l.narrow[o.hero]={height:105,width:188},l.default[o.hero]={height:153,width:272},l.carouselDefault[o.hero]={height:145,width:256},l.carouselNarrow[o.hero]={height:105,width:188},l.narrow[o.thumb]={height:76,width:76},l.default[o.thumb]={height:112,width:112},l.carouselDefault[o.thumb]={height:112,width:112},l.carouselNarrow[o.thumb]={height:76,width:76},l.narrow[o.receipt]={height:76,width:76},l.default[o.receipt]={height:112,width:112},l.narrow[o.animation]={height:97,width:172},l.default[o.animation]={height:153,width:272},l.carouselDefault[o.animation]={height:153,width:272},l.carouselNarrow[o.animation]={height:97,width:172},l.narrow[o.audio]={height:97,width:172},l.default[o.audio]={height:153,width:272},l.carouselDefault[o.audio]={height:153,width:272},l.carouselNarrow[o.audio]={height:97,width:172},l.narrow[o.flex]={height:105,width:188},l.default[o.flex]={height:153,width:272},l.carouselDefault[o.flex]={height:145,width:256},l.carouselNarrow[o.flex]={height:105,width:188},m.prototype.isValid=function(){return!!this.url},m.prototype.loadImageSize=function(){var t=this,n=new Image;n.onload=function(){t.naturalSize({height:n.naturalHeight,width:n.naturalWidth})},n.src=this.url},m.prototype.getUiSize=function(){function p(){var e=u.width/-2+h;f.isRtl()?(t.leftAlignment(c),t.rightAlignment(e)):(t.leftAlignment(e),t.rightAlignment(c))}function v(){var e=(u.height-r.height)/2+h;t.bottomAlignment(e)}function m(){if(s.height<s.width)u.width=r.width,u.height=s.height*r.width/s.width;else{u.width=s.width*r.height/s.height,u.height=s.height*r.height/s.height;var e=(r.width-u.width)/2+h;f.isRtl()?t.rightAlignment(e):t.leftAlignment(e)}}var t=this,n=i.get().currentMode(),r=d(this.contentType,n,this.isImageInCarousel()),s=this.naturalSize(),u={height:0,width:0};if(s.height===0||s.width===0||r.height===0)return u;var a=r.width/r.height,l=s.width/s.height;switch(this.contentType){case o.hero:l<a?(u.width=r.width,u.height=s.height*r.width/s.width,v()):(u.height=r.height,u.width=s.width*r.height/s.height),p();break;case o.animation:case o.audio:l<a?m():(u.height=r.height,u.width=s.width*r.height/s.height);break;case o.thumb:l<a?(u.height=r.height,u.width=u.height*l):l===a?(u.height=r.height,u.width=s.width*r.height/s.height):(u.width=r.width,u.height=u.width/l),v(),p();break;case o.receipt:l<a?(u.height=r.height,u.width=u.height*l):l===a?(u.height=r.height,u.width=s.width*r.height/s.height):(u.width=r.width,u.height=u.width/l),p();break;case o.flex:l<=a?l===1?(u.height=r.height,u.width=r.height):(u.width=r.width,u.height=s.height*r.width/s.width,v(),p()):(u.height=r.height,u.width=s.width*r.height/s.height,p());break;default:}return u},m.prototype.getTitleByType=function(){function r(){var e=u.fetch({key:"accessibility_swift_action_prefix",params:{swiftAction:i(n.tap.title)}});return(n.alt?n.alt+" ":"")+e}function i(e){return e[0].toLowerCase()+e.substring(1)}var n=this;switch(this.tap.type){case t.Type.call:case t.Type.imBack:return r();case t.Type.openUrl:return r()+"\n\n"+this.tap.value;case t.Type.showImage:return(this.alt?this.alt+" ":"")+i(this.tap.title);default:}},{build:function(e,t,n,r){return new m(e,t,n,r)},_prototype:m.prototype}}),define("ui/viewModels/chat/messageParsers/swift/section",["require","ui/viewModels/chat/messageParsers/swift/action","swx-i18n","ui/viewModels/chat/messageParsers/swift/image","ui/viewModels/chat/messageParsers/swift/utils"],function(e){function s(e,n,s,o){var u=r.build(e.image||{},n,s,o);this.title=i.normalizeRichText(e.title),this.subtitle=i.normalizeRichText(e.subtitle),this.text=i.normalizeRichText(e.text),this.price=i.normalizeRichText(e.price),this.images=i.filterOutNotValidItems(e.images,function(e){return r.build(e,n,s,o)}),this.images.length===0&&u.isValid()&&this.images.push(u),this.tap=e.tap?i.getItemIfNotDisabled(t.build(e.tap,n,s)):null,this.expandedText=function(){return this.title&&this.subtitle?"":this.title||this.subtitle?"expandedTextOnce":"expandedTextTwice"}}var t=e("ui/viewModels/chat/messageParsers/swift/action"),n=e("swx-i18n").localization,r=e("ui/viewModels/chat/messageParsers/swift/image"),i=e("ui/viewModels/chat/messageParsers/swift/utils");return s.prototype.isValid=function(){return!!this.title||!!this.subtitle||!!this.text||this.images.length!==0},s.prototype.getTitleByType=function(){function i(){return n.fetch({key:"accessibility_swift_action_prefix",params:{swiftAction:s(r.tap.title)}})}function s(e){return e[0].toLowerCase()+e.substring(1)}var r=this;switch(this.tap.type){case t.Type.call:case t.Type.imBack:return i();case t.Type.openUrl:return i()+"\n\n"+this.tap.value;default:}},{build:function(e,t,n,r){return new s(e,t,n,r)}}}),define("ui/viewModels/chat/messageParsers/swift/content",["require","lodash-compat","ui/viewModels/chat/messageParsers/swift/action","ui/viewModels/chat/messageParsers/swift/fact","ui/viewModels/chat/messageParsers/swift/section","ui/viewModels/chat/messageParsers/swift/utils","vendor/knockout","swx-i18n","swx-constants","ui/viewModels/chat/messageParsers/swift/image","ui/viewModels/chat/messageParsers/swift/telemetry/swiftCardTelemetry","ui/modelHelpers/personHelper"],function(e){function m(e){switch(e.length){case 2:return!t.every(e,function(e){return e.title.length<=11});case 3:return!t.every(e,function(e){return e.title.length<=5})}return!0}function g(e,t,r,o){this.type=o,this.buttons=s.filterOutDisabledItems(e.buttons,function(e){return n.build(e,t,r)}),this.tap=e.tap?s.getItemIfNotDisabled(n.build(e.tap,t,r)):null,this.mainSection=i.build(e,t,r,o);var u=this.computeButtonsLimit();this.buttons.length>u&&(this.buttons=this.buttons.slice(0,u)),this.areButtonsMultiLine=m(this.buttons);var a=c.build();this.isValid()||(this.mainSection.isValid()?a.publishInvalidCard(f.invalidCardReasons.InvalidButton,r.id()):a.publishInvalidCard(f.invalidCardReasons.MainSectionNotValid,r.id())),this.isSupported()||a.publishUnsupportedCard(f.unsupportedCardReasons.ContentUnsupportedButton,r.id())}function y(e,t,r,i){this.type=i,this.buttons=s.filterOutDisabledItems(e.buttons,function(e){return n.build(e,t,r)}),this.title=e.title?s.normalizeRichText(e.title):null,this.subtitle=e.subtitle?s.normalizeRichText(e.subtitle):null,this.text=e.text?s.normalizeRichText(e.text):null,this.tap=e.tap?s.getItemIfNotDisabled(n.build(e.tap,t,r)):null,this.images=s.filterOutNotValidItems(e.images,function(e){return l.build(e,t,r,i)});var o=this.computeButtonsLimit();this.buttons.length>o&&(this.buttons=this.buttons.slice(0,o)),this.areButtonsMultiLine=m(this.buttons),this.expandedText=function(){return this.title&&this.subtitle?"":this.title||this.subtitle?"expandedTextOnce":"expandedTextTwice"};var u=c.build();this.isValid()||u.publishInvalidCard(f.invalidCardReasons.InvalidButton,r.id()),this.isSupported()||u.publishUnsupportedCard(f.unsupportedCardReasons.ContentUnsupportedButton,r.id())}function b(e){return h.isAgent(e)&&e.capabilities._mediaAutoplay&&e.capabilities._mediaAutoplay()}function w(e){var t=e.replace(/^(https?:\/\/)?(w*\.)?/i,""),n="/";return t.split(n)[0]}function E(e,t,r,i){this.type=i,this.autoloop=e.autoloop,this.autostart=(!t.isGroupConversation()||h.isKnownPerson(r))&&b(r)?e.autostart:!1,this.shareable=e.shareable,this.subtitle=e.subtitle?s.normalizeText(e.subtitle):null,this.title=e.title?s.normalizeText(e.title):null,this.image=l.build(e.image||{},t,r,i),this.aspect=e.aspect&&e.aspect===d?"portrait":"landscape",this.hasThumbnail=function(){return!!this.image&&!!this.image.url};var o={},u=e.media&&e.media.length&&e.media[0],a=u?s.normalizeUrl(u.url):null;if(u)switch(i){case p.video:o[v.VIDEO]=a;break;case p.audio:o[v.AUDIO]=a;break;case p.animation:o[v.ANIMATION]=l.build(u||{},t,r,i)}this.media=o,this.mediaSourceDomain=a?w(a):null,this.buttons=s.filterOutDisabledItems(e.buttons,function(e){return n.build(e,t,r)}),this.areButtonsMultiLine=m(this.buttons),this.hasTextInfo=function(){return!!this.title||!!this.subtitle};var g=c.build();this.isValid()||g.publishInvalidCard(f.invalidCardReasons.MediaCardMissingSrc,r.id())}function S(e,r,i){this.type=p.signIn,this.buttons=s.filterOutDisabledItems(e.buttons,function(e){return n.build(e,r,i)});var o=t.find(this.buttons,function(e){return e.type===n.Type.signIn});this.buttons=o?[o]:[],this.text=s.normalizeRichText(e.text);if(!this.isValid()){var u=c.build();this.buttons.length===0?u.publishInvalidCard(f.invalidCardReasons.SignInMissingButtons,i.id()):this.text||u.publishInvalidCard(f.invalidCardReasons.SignInMissingText,i.id())}}function x(e,t,a){function y(){l.displayedItems(h),l.foldButtonText(u.fetch({key:"message_text_swift_showAll"}))}function b(){var e=0;for(var t=0;t<l.items.length;t++){if(e>=d)return;h.push(l.items[t]),l.items[t].images.length>0?e+=v:e++}h=[]}var l=this,h=[],d=5,v=3;this.type=p.receipt,this.buttons=s.filterOutDisabledItems(e.buttons,function(e){return n.build(e,t,a)}),this.buttons.length>3&&(this.buttons=this.buttons.slice(0,3)),this.areButtonsMultiLine=m(this.buttons),this.tap=e.tap?n.build(e.tap,t,a):null,this.title=s.normalizeRichText(e.title),this.total=s.normalizeText(e.total),this.tax=s.normalizeText(e.tax),this.vat=s.normalizeText(e.vat),this.facts=s.filterOutNotValidItems(e.facts,function(e){return r.build(e,t)}),this.items=s.filterOutNotValidItems(e.items,function(e){return i.build(e,t,a,p.thumb)}),this.displayedItems=o.observableArray(),this.showFoldButton=o.observable(!1),this.isCollapsed=o.observable(!1),this.foldButtonText=o.observable(),b(),h.length>0?(this.showFoldButton(!0),l.isCollapsed(!0),y()):this.displayedItems(this.items);var g=c.build();this.isValid()||(this.total?g.publishInvalidCard(f.invalidCardReasons.ReceiptInvalidButton,a.id()):g.publishInvalidCard(f.invalidCardReasons.ReceiptMissingTotal,a.id())),this.isSupported()||g.publishUnsupportedCard(f.unsupportedCardReasons.ReceiptUnsupportedButton,a.id()),this.triggerFoldAction=function(){l.isCollapsed(!l.isCollapsed()),l.isCollapsed()?y():(l.displayedItems(l.items),l.foldButtonText(u.fetch({key:"message_text_swift_showLess"})))}}var t=e("lodash-compat"),n=e("ui/viewModels/chat/messageParsers/swift/action"),r=e("ui/viewModels/chat/messageParsers/swift/fact"),i=e("ui/viewModels/chat/messageParsers/swift/section"),s=e("ui/viewModels/chat/messageParsers/swift/utils"),o=e("vendor/knockout"),u=e("swx-i18n").localization,a=e("swx-constants").COMMON,f=a.telemetry.swiftCard,l=e("ui/viewModels/chat/messageParsers/swift/image"),c=e("ui/viewModels/chat/messageParsers/swift/telemetry/swiftCardTelemetry"),h=e("ui/modelHelpers/personHelper"),p=s.ContentType,d="9:16",v={VIDEO:"video",AUDIO:"audio",ANIMATION:"animation"};return g.prototype.computeButtonsLimit=function(){if(this.type===p.thumb)return 3;var t=3;return this.mainSection.images.length===0&&(t+=2),this.mainSection.text||(t++,this.mainSection.title||t++,this.mainSection.subtitle||t++),Math.min(t,6)},g.prototype.isValid=function(){return this.buttons.length!==0?t.every(this.buttons,function(e){return e.isValid()}):this.mainSection.isValid()},g.prototype.isSupported=function(){return(this.tap&&this.tap.isSupported()||!this.tap)&&t.every(this.buttons,function(e){return e.isSupported()})},y.prototype.isValid=function(){return!!this.title||!!this.subtitle||!!this.text||this.images.length!==0&&t.every(this.images,function(e){return e.isValid()})},y.prototype.isSupported=function(){return this.isValid()},y.prototype.computeButtonsLimit=function(){if(this.type===p.thumb)return 3;var t=3;return this.images.length===0&&(t+=2),this.text||(t++,this.title||t++,this.subtitle||t++),Math.min(t,6)},E.prototype.isValid=function(){return!!this.media&&(!!this.media.video||!!this.media.audio||!!this.media.animation&&!!this.media.animation.url)},E.prototype.isSupported=function(){return this.isValid()},S.prototype.isValid=function(){return this.buttons.length!==0&&!!this.text},S.prototype.isSupported=function(){return this.isValid()},x.prototype.isValid=function(){return!!this.total&&t.every(this.buttons,function(e){return e.isValid()})},x.prototype.isSupported=function(){return(this.tap&&this.tap.isSupported()||!this.tap)&&t.every(this.buttons,function(e){return e.isSupported()})},{main:{build:function(e,t,n,r){return new g(e,t,n,r)}},receipt:{build:function(e,t,n){return new x(e,t,n)}},signIn:{build:function(e,t,n){return new S(e,t,n)}},media:{build:function(e,t,n,r){return new E(e,t,n,r)}},flex:{build:function(e,t,n,r){return new y(e,t,n,r)}}}}),define("ui/viewModels/chat/messageParsers/swift/card",["require","ui/viewModels/chat/messageParsers/swift/content","ui/viewModels/chat/messageParsers/swift/content","ui/viewModels/chat/messageParsers/swift/content","ui/viewModels/chat/messageParsers/swift/content","ui/viewModels/chat/messageParsers/swift/content","ui/viewModels/chat/messageParsers/swift/utils","swx-constants","ui/viewModels/chat/messageParsers/swift/telemetry/swiftCardTelemetry"],function(e){function c(e,u,c,h){this.contentType=o.normalizeEnum(e.contentType,l,l.unknown),this.messageId=c.clientmessageid,this.conversationId=u.conversationId,this.content=null;var p=f.build();if(!e.content){this.isValid()||p.publishInvalidCard(a.invalidCardReasons.CardMissingContent,h.id()),this.isSupported()||p.publishUnsupportedCard(a.unsupportedCardReasons.CardUnsupportedType,h.id());return}switch(this.contentType){case l.hero:case l.thumb:this.content=t.build(e.content,u,h,this.contentType);break;case l.signIn:this.content=r.build(e.content,u,h);break;case l.receipt:this.content=n.build(e.content,u,h);break;case l.audio:case l.video:case l.animation:this.content=i.build(e.content,u,h,this.contentType);break;case l.flex:this.content=s.build(e.content,u,h,this.contentType)}!this.isSupported()&&this.contentType===l.unknown&&p.publishUnsupportedCard(a.unsupportedCardReasons.CardUnsupportedType,h.id())}var t=e("ui/viewModels/chat/messageParsers/swift/content").main,n=e("ui/viewModels/chat/messageParsers/swift/content").receipt,r=e("ui/viewModels/chat/messageParsers/swift/content").signIn,i=e("ui/viewModels/chat/messageParsers/swift/content").media,s=e("ui/viewModels/chat/messageParsers/swift/content").flex,o=e("ui/viewModels/chat/messageParsers/swift/utils"),u=e("swx-constants").COMMON,a=u.telemetry.swiftCard,f=e("ui/viewModels/chat/messageParsers/swift/telemetry/swiftCardTelemetry"),l=o.ContentType;return c.prototype.isValid=function(){return this.contentType!==l.unknown&&this.content&&this.content.isValid()||this.contentType===l.unknown},c.prototype.isSupported=function(){return this.contentType!==l.unknown&&(!this.content||this.content.isSupported())},{build:function(e,t,n,r){return new c(e,t,n,r)}}}),define("ui/viewModels/chat/messageParsers/swift/swift",["require","ui/viewModels/chat/messageParsers/swift/action","lodash-compat","ui/viewModels/chat/messageParsers/swift/card","vendor/knockout","ui/viewModels/chat/messageParsers/swift/utils","swx-constants","ui/viewModels/chat/messageParsers/swift/telemetry/swiftCardTelemetry","utils/common/styleModeHelper","ui/modelHelpers/personHelper","utils/common/rtlChecker"],function(e){function v(e){return e.some(l.isMePersonId)}function m(e,l,g,y){var b=a.build();this.summary=s.normalizeText(e.summary),this.type=e.type?s.normalizeEnum(e.type,m.Type,m.Type.unknown):null,this.cards=s.mapArray(e.attachments,function(e){return r.build(e,l,g,y)});if(!this.isValid()){this.type?this.cards.length===0&&b.publishInvalidCard(u.invalidCardReasons.SwiftMissingCards,y.id()):b.publishInvalidCard(u.invalidCardReasons.SwiftMissingType,y.id());return}this.isSupported()||(this.button=t.build({type:t.Type.unsupportedType},l,y),this.type===m.Type.unknown&&b.publishUnsupportedCard(u.unsupportedCardReasons.SwiftUnknownType,y.id()));if(e.suggestedActions&&e.suggestedActions.actions){var w=!0,E=e.suggestedActions.to&&e.suggestedActions.to.length>0;l.isGroupConversation()&&E&&(w=v(e.suggestedActions.to)),w&&s.mapArray(e.suggestedActions.actions,function(e){g.suggestedActions.push(t.build(e,l,y))})}this.areButtonsMultiLine=!n.every(this.cards,function(e){return e.content&&e.isValid()&&e.content.areButtonsMultiLine===!1}),this.isFirst=i.observable(!0),this.isLast=i.observable(this.cards.length===1),this.selectedCard=i.observable(0),this.isMultiple=i.observable(this.cards.length>1),this.isMultiple()&&n.each(this.cards,function(e){if(!e.isValid()||!e.content)return;e.content.mainSection?n.each(e.content.mainSection.images,function(e){e.isImageInCarousel(!0)}):e.content.media&&e.content.media.animation&&e.content.media.animation.isImageInCarousel(!0)}),this.calculatePosition=function(){var t=h;return f.get().currentMode()===o.styleMode.NARROW&&(t=p),this.isFirst()?"0px":this.isLast()?"calc("+this.selectedCard()*-t+"px + (100% - "+t+"px))":"calc("+this.selectedCard()*-t+"px + (100% - "+t+"px) / 2)"},this.carouselLeftPosition=function(){return c.isRtl()?d:this.calculatePosition()},this.carouselRightPosition=function(){return c.isRtl()?this.calculatePosition():d}}var t=e("ui/viewModels/chat/messageParsers/swift/action"),n=e("lodash-compat"),r=e("ui/viewModels/chat/messageParsers/swift/card"),i=e("vendor/knockout"),s=e("ui/viewModels/chat/messageParsers/swift/utils"),o=e("swx-constants").COMMON,u=o.telemetry.swiftCard,a=e("ui/viewModels/chat/messageParsers/swift/telemetry/swiftCardTelemetry"),f=e("utils/common/styleModeHelper"),l=e("ui/modelHelpers/personHelper"),c=e("utils/common/rtlChecker"),h=288,p=188,d="auto";return m.prototype.isSupported=function(){return this.isValid()&&this.type!==m.Type.unknown&&n.every(this.cards,function(e){return e.isSupported()})},m.prototype.isValid=function(){return!!this.type&&this.cards.length!==0&&n.every(this.cards,function(e){return e.isValid()})},m.prototype.isCarousel=function(){return this.type===m.Type.carousel},m.prototype.nextCard=function(){this.moveTo(this.selectedCard()+1)},m.prototype.prevCard=function(){this.moveTo(this.selectedCard()-1)},m.prototype.moveTo=function(t){if(t<0||t>=this.cards.length)return;this.selectedCard(t),this.isFirst(t===0),this.isLast(t===this.cards.length-1)},m.prototype.moveToCard=function(t){this.moveTo(this.cards.indexOf(t))},m.Type={unknown:"Unknown",card:"Card",carousel:"Carousel",signIn:"SignIn",receipt:"Receipt"},m.Type["message/card"]=m.Type.card,m.Type["message/card.carousel"]=m.Type.carousel,m.Type["message/card.signin"]=m.Type.signIn,m.Type["message/card.receipt"]=m.Type.receipt,{build:function(e,t,n,r){return new m(e,t,n,r)},Type:m.Type}}),define("ui/viewModels/chat/messageParsers/skypeSwiftProcessor",["require","exports","module","ui/viewModels/chat/messageParsers/swift/swift"],function(e,t){function r(e,t){this.conversation=e,this.message=t}var n=e("ui/viewModels/chat/messageParsers/swift/swift");r.prototype.process=function(t,r){return n.build(t,this.conversation,this.message,r)},t.build=function(e,t){return new r(e,t)}}),define("ui/viewModels/chat/messageParsers/swiftCard",["require","exports","module","lodash-compat","vendor/knockout","ui/viewModels/chat/messageParsers/skypeSwiftProcessor","swx-utils-chat"],function(e,t){var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("ui/viewModels/chat/messageParsers/skypeSwiftProcessor"),s=e("swx-utils-chat").messageSanitizer;t.parse=function(e,t,o){var u=/^<swiftcard/i.test(t._originalContent)?t._originalContent:t.html();if(!/^<swiftcard/i.test(u))return;var a=new DOMParser,f=a.parseFromString(u,"text/xml"),l,c,h,p,d;l=n.find(f.childNodes,function(e){return e.nodeName.toLocaleLowerCase()==="swiftcard"});if(!l)return;c=n.find(l.attributes,function(e){return e.nodeName.toLocaleLowerCase()==="swift"});if(!c)return r.observable(s.getMessageSanitizedContent(l.textContent));try{d=decodeURIComponent(c.textContent)}catch(v){if(v.message!=="URI malformed")return r.observable(s.getMessageSanitizedContent(l.textContent));d=c.textContent}try{h=JSON.parse(d)}catch(v){return r.observable(s.getMessageSanitizedContent(l.textContent))}p=i.build(o,e);var m=p.process(h,t.sender);return e.isDisjoined=!0,e.contentTemplate="swiftCardMessageContentTemplate",e.swift=m,e.customMessageClasses="swiftCard "+(m.isSupported()?m.type.toLowerCase():"unsupported")+(m.isValid()?"":" invalid"),n.isUndefined(m.cards)||(e.customMessageClasses+=m.cards.length===1?" single":"",e.customMessageClasses+=m.cards.length===2?" double":""),r.observable(s.getMessageSanitizedContent(l.textContent))}}),define("ui/viewModels/chat/translator/translationItem",["require","exports","module","swx-service-locator-instance","swx-constants","swx-i18n","vendor/knockout","swx-utils-chat","telemetry/translator/translatorTelemetry","ui/modelHelpers/personHelper","utils/chat/translatorHelper"],function(e,t){function c(e,t){function x(){return y&&y.isEnabled}function T(){return!g&&x()}function N(e,n){var r=l.extractLanguageKey(n);x()||c.translationText(e),l.isMatchingMyLanguage(r,t._translatorSettings)&&(c.translationText(e),c.visible(!0)),S.send(E,{action:u.action.SHOW,success:!0})}function C(e,t){var n=o.getMessageSanitizedContent(e);f.isMePersonId(t)&&(c.translationText(n),c.visible(!0),S.send(E,{action:u.action.SHOW,success:!0}))}function k(){if(!m().length){c.isRemoved(!0),c.visible(!1);return}m.each(function(e){var t=e.key,n=e.users&&e.users[0],r=n&&n.value,i=n&&n.mri,s=r===c.translationText();if(!t||!r||s)return;if(o.isMessageWithEmoticonsOnly(r)||o.isMessageWithMentionOnly(r)){c.visible(!1),c.translationText("");return}c.isRemoved(!1),g?C(r,i):N(r,t)})}function L(){return T()?c.visible()?u.action.CLICK_SEE_ORIGINAL:u.action.CLICK_SEE_TRANSLATION:c.visible()?u.action.CLICK_SEE_TRANSLATION:u.action.CLICK_SEE_ORIGINAL}function A(){m&&(w=m.observe(k)),e.model.isDeleted&&(b=e.model.isDeleted.changed(function(e){c.isRemoved(e),c.visible(!1)}))}var c=this,h=n.resolve(r.serviceLocator.FEATURE_FLAGS),p=h.isFeatureOn(r.featureFlags.TRANSLATOR_SENDING_ENABLED),d=i.fetch({key:"button_translations_see_original_message"}),v=i.fetch({key:"button_translations_see_translated_message"}),m=e.model.translations,g=e.model.direction&&e.model.direction()===r.chat.messageType.OUTGOING,y=t._translatorSettings,b,w,E=g?u.eventType.OUTGOING:u.eventType.INCOMING,S=a.build();c.init=function(){c.isRemoved=s.observable(!1),c.visible=s.observable(!1),c.translationText=s.observable(""),c.isEnabled=s.pureComputed(function(){return p&&!c.isRemoved()&&!!c.translationText()}),c.toggle=function(){var e=L();c.visible(!c.visible()),S.send(E,{action:e})},c.toggleText=s.pureComputed(function(){return T()?c.visible()?d:v:c.visible()?v:d}),p&&A()},c.dispose=function(){b&&b.dispose(),w&&w.dispose()}}var n=e("swx-service-locator-instance").default,r=e("swx-constants").COMMON,i=e("swx-i18n").localization,s=e("vendor/knockout"),o=e("swx-utils-chat").messageSanitizer,u=r.telemetry.translator,a=e("telemetry/translator/translatorTelemetry"),f=e("ui/modelHelpers/personHelper"),l=e("utils/chat/translatorHelper");t.build=function(e,t){return new c(e,t)}}),define("services/pes/constants",["require","lodash-compat","swx-browser-detect"],function(e){function r(){var e=t.once(function(){return n.getScreenInfo().pixelRatio>1});this.CACHE_KEY="swx|pes",this.SAVED_DATA_VERSION="v1.0",this.FEATURED_IN_PREFIX="FeaturedIn-",this.itemTypes={typeKeyName:"type",tab:{id:"tab",ariaLabelLocKey:"expressionPicker_mruTab_ariaLabel",titleLocKey:"expressionPicker_mruTab_title"},emoticon:{id:"emoticon",ariaLabelLocKey:"expressionPicker_mruEmoticonPack_ariaLabel",titleLocKey:"expressionPicker_mruEmoticonPack_title",mruLimit:27},moji:{id:"flik",ariaLabelLocKey:"expressionPicker_mruMojiPack_ariaLabel",titleLocKey:"expressionPicker_mruMojiPack_title",mruLimit:10},image:{id:"image"},message:{id:"message"},sticker:{id:"sticker"}},this.isHighDpi=e,this.itemTypes.flik=this.itemTypes.moji,this.mru={TAB_ID:"mru",PACK_PREFIX:"mru:"},this.bingSearch={TAB_ID:"bing",PACK_PREFIX:"bing:"},this.giphyImageSearch={TAB_ID:"giphyImages",PACK_PREFIX:"giphy-imh:"},this.localSearch={TAB_ID:"localSearch",PACK_PREFIX:"local:",titleLocKey:"expressionPicker_localSearchPack_title",ariaLabelLocKey:"expressionPicker_localSearchPack_ariaLabel"},this.frameHeights={emoticons:{SMALL:20,LARGE:40,EXTRA_LARGE:80},moji:{THUMBNAIL:40,KEYFRAME:80},packs:{TAB:19}},this.profiles={emoticons:{getSmall:function(){return e()?"default_40":"default_20"},getLarge:function(){return e()?"default_80":"default_40"},getExtraLarge:function(){return e()?"default_160":"default_80"},getSmallAnimated:function(){return e()?"default_40_anim":"default_20_anim"},getLargeAnimated:function(){return e()?"default_80_anim":"default_40_anim"},getExtraLargeAnimated:function(){return e()?"default_160_anim":"default_80_anim"}},moji:{thumbnail:"thumbnail",content:"default"}}}var t=e("lodash-compat"),n=e("swx-browser-detect").default;return new r}),define("ui/viewModels/chat/reactions",["require","exports","module","vendor/knockout","lodash-compat","swx-service-locator-instance","swx-constants","services/pes/constants","experience/settings","utils/common/cafeObservable"],function(e,t){function f(e){function h(e){return l+e+"/views/"+c}var t=this,f=i.resolve(s.serviceLocator.FEATURE_FLAGS),l="https://"+u.pesCDNAuthentication.cdnServiceHost+"/pes/v1/emoticons/",c=o.profiles.emoticons.getSmall();t.enabled=n.observable(f.isFeatureOn(s.featureFlags.REACTIONS_SUPPORT_ENABLED)),t.reactions=t.enabled()&&e.model.emotions?a.newObservableCollection(e.model.emotions):n.observableArray(),t.reactionsCount=n.computed(function(){return t.reactions().length}),t.dummyReaction="reactionsConsumptionHorizon",t.showHighDpiClass=o.isHighDpi(),t.getEmoticonUrl=function(e){return e?'url("'+h(e)+'")':""},t.getUserListNames=function(e){var n="",i=r.find(t.reactions(),function(t){return t.key===e}),s=[];return i&&i.users.forEach(function(e){e.person.displayName&&s.push(e.person.displayName())}),s.length>0&&(n=s.join("\n")),n},t.dispose=function(){t.reactionsCount.dispose()}}var n=e("vendor/knockout"),r=e("lodash-compat"),i=e("swx-service-locator-instance").default,s=e("swx-constants").COMMON,o=e("services/pes/constants"),u=e("experience/settings"),a=e("utils/common/cafeObservable");t.build=function(e){return new f(e)}}),define("services/telemetry/hashingService",["require","msr-crypto"],function(e){function n(){this.getHash=function(e){var n=t.utilities.stringToBytes(e),r=t.sha256.computeHash(n);return t.utilities.bytesToHexString(r)}}var t=e("msr-crypto").aes;return new n}),define("telemetry/chat/urlPreviewShow",["require","exports","module","experience/settings","swx-constants","ui/telemetry/telemetryClient","swx-telemetry-buckets","services/telemetry/hashingService"],function(e,t){function a(e){function l(){return{messageIdHash:u.getHash(e.contentId),urlCount:e.urlCount,hasThumbnail:!1,urlPosition:e.urlPosition,contentType:o.getUrlContentType(e.url),result:f,ttl:f,ttlGroup:f,participantCount:e.participantsCount,participantCountGroup:o.getParticipantCountGroup(e.participantsCount)}}function c(){t.data.ttl=h(a,p()),t.data.ttlGroup=o.getSecondsDurationGroup(t.data.ttl);var e=i.TYPE,r=t.data;s.get().sendEvent(n.telemetry.chatTenantToken,e,r)}function h(e,t){return t-e}function p(){return(new Date).getTime()}var t=this,a=p(),f=r.telemetry.NOT_AVAILABLE;t.data=l(),t.error=function(e){e&&(t.data.result=e),c()},t.succeeded=function(e,n){t.data.hasThumbnail=n,t.data.result=e,c()}}var n=e("experience/settings"),r=e("swx-constants").COMMON,i=r.telemetry.urlPreviewShown,s=e("ui/telemetry/telemetryClient"),o=e("swx-telemetry-buckets"),u=e("services/telemetry/hashingService");t.build=function(e){return new a(e)}}),define("telemetry/chat/youtubeShowEvent",["require","experience/settings","services/telemetry/hashingService","ui/telemetry/telemetryClient","swx-log-tracer"],function(e){function s(){var e="message_youtube_show";this.publish=function(s,o,u,a){try{var f={messageIdHash:n.getHash(s.contentId),videoId:s.youtubeId,participantsCount:a,meSender:s.isMyself,batchOrdinal:s.ordinal,videoLength:u,playerWidth:o.getIframe().clientWidth,playerHeight:o.getIframe().clientHeight,preferencesEnabled:s.ytEnabled};r.get().sendEvent(t.telemetry.chatTenantToken,e,f)}catch(l){i.error("Unable to send YT show telemetry: "),i.error(l)}}}var t=e("experience/settings"),n=e("services/telemetry/hashingService"),r=e("ui/telemetry/telemetryClient"),i=e("swx-log-tracer").getLogger();return new s}),define("telemetry/chat/youtubeActionEvent",["require","experience/settings","services/telemetry/hashingService","ui/telemetry/telemetryClient","swx-log-tracer"],function(e){function s(){var e="message_youtube_action";this.publish=function(s,o,u,a){try{var f={messageIdHash:n.getHash(s.contentId),videoId:s.youtubeId,meSender:s.isMyself,batchOrdinal:s.ordinal,timeInStale:(a-s.messageTimestamp)/1e3,playerWidth:o.getIframe().clientWidth,playerHeight:o.getIframe().clientHeight,playerMode:!!o.inFullScreenMode,participantsCount:u.participantsCount,playerActionType:u.type,videoLength:u.videoLength,playerActionDuration:u.duration,preferencesEnabled:s.ytEnabled};u.startTime&&(f.startTime=u.startTime),r.get().sendEvent(t.telemetry.chatTenantToken,e,f)}catch(l){i.error("Unable to send YT action telemetry: "),i.error(l)}}}var t=e("experience/settings"),n=e("services/telemetry/hashingService"),r=e("ui/telemetry/telemetryClient"),i=e("swx-log-tracer").getLogger();return new s}),define("ui/players/ytPlayer",["require","swx-constants","experience/settings","browser/window","browser/document","swx-log-tracer","telemetry/chat/youtubeShowEvent","telemetry/chat/youtubeActionEvent","swx-pubsub-instance"],function(e){function f(){function c(){try{e.testContext.removePlayer(this.playerId)}catch(t){s.error("Error in disposing the Player: "),s.error(t)}}function h(t){e.testContext.players[t]&&(e.testContext.players[t].destroy(),delete e.testContext.players[t]),e.testContext.previewItems[t]&&delete e.testContext.previewItems[t]}function p(e){return e.B?e.B.currentTime:e.F?e.F.currentTime:e.getCurrentTime?e.getCurrentTime():0}function d(e){return e.H&&e.H.duration?e.H.duration:e.F&&e.F.duration?e.F.duration:e.getDuration?e.getDuration():0}function v(e,t,n,r){var i=d(n);return t/=1e3,t=t>i?i:t,{type:e,duration:t,startTime:p(n),participantsCount:m(r),videoLength:i}}function m(e){return e&&e.conversation?e.conversation.participantsCount():t.telemetry.NOT_AVAILABLE}function g(n){n.previews().forEach(function(n){if(!r||!r.YT||!r.YT.Player)return;if(n.type()!==t.urlPreviewType.YT||!n.playerId)return;if(e.testContext.players[n.playerId])return;e.testContext.players[n.playerId]=new r.YT.Player(n.playerId,{events:{onReady:e.testContext.onPlayerReady,onStateChange:e.testContext.onPlayerStateChange,onError:e.testContext.onPlayerError}})})}function y(t,n){var r="yt_"+t+"_"+n;return e.randomIdEnabled?r+"_"+Math.random().toString(36).substring(7):r}function b(e){return e.protocol+"//"+e.hostname+(e.port?":"+e.port:"")}function w(e,t){var i="https://www.youtube.com/embed/"+e+"?showinfo=0&enablejsapi=1&modestbranding=1&disablekb=1&rel=0&iv_load_policy=3"+"&hl="+n.initParams.locale+"&"+"&origin="+b(r.location);return t&&(i+="&autoplay=true"),i}function E(e){return e.target.id||e.target.getIframe().id}var e=this,f,l=1e4;e.testContext={players:{},previewItems:{},onPlayerReady:function(t){try{var n=E(t),r=e.testContext.previewItems[n],i=e.testContext.players[n];if(i.toDestroy){h(n);return}i.renderedAndReady=!0;if(!r)return;o.publish(r,t.target,d(t.target),m(r))}catch(u){s.error("Error in onPlayerReady: "),s.error(u)}},onPlayerStateChange:function(t){try{var n=(new r.Date).getTime(),i=E(t),o=e.testContext.previewItems[i],a=e.testContext.players[i];switch(t.data){case r.YT.PlayerState.BUFFERING:case r.YT.PlayerState.CUED:case r.YT.PlayerState.UNSTARTED:return;case r.YT.PlayerState.PLAYING:o.lastActionTimestamp=n,u.publish(o,a,v(e.actionType.PLAYING,0,a,o),n);break;case r.YT.PlayerState.PAUSED:o.lastActionTimestamp=o.lastActionTimestamp||n,u.publish(o,a,v(e.actionType.PAUSED,n-o.lastActionTimestamp,a,o),{type:e.actionType.PAUSED,duration:n-o.lastActionTimestamp,participantsCount:m(o),videoLength:d(a)},n),o.lastActionTimestamp=null;break;case r.YT.PlayerState.ENDED:o.lastActionTimestamp=o.lastActionTimestamp||n,u.publish(o,a,v(e.actionType.ENDED,n-o.lastActionTimestamp,a,o),n),o.lastActionTimestamp=null}}catch(f){s.error("Error in onPlayerStateChange: "),s.error(f)}},removePlayer:function(n){try{var i=e.testContext.players[n];if(!i)return;i.renderedAndReady?h(n):(r.setTimeout(h.bind(null,n),l),i.toDestroy=!0)}catch(o){s.error("Error in removePlayer: "),s.error(o)}},onFullscreenChangedHandler:function(n){function l(){i&&a.publish(t.events.videoPlayer.FULLSCREEN_OFF,i.messageId)}var i,o;if(n.target.id&&n.target.id.substring(0,7)==="yt_msg_"){f&&(s.error("[YOUTUBE] Trying to go to fullscreen twice! Message in a fullscreen: "+f),o=e.testContext.players[f]||{},o.inFullScreenMode=!1);try{f=E(n),i=e.testContext.previewItems[f],o=e.testContext.players[f],o.inFullScreenMode=!0,a.publish(t.events.videoPlayer.FULLSCREEN_ON,i?i.messageId:null),u.publish(i,o,{type:e.actionType.FULLSCREEN,duration:p(o),participantsCount:m(i),videoLength:d(o)},(new r.Date).getTime())}catch(c){s.error("Error in onFullscreenChangedHandler: "),s.error(c)}}else{try{i=e.testContext.previewItems[f],o=e.testContext.players[f],l()}catch(c){s.error("Error in onFullscreenChangedHandler: "),s.error(c)}o&&(o.inFullScreenMode=!1,f=null)}},onPlayerError:function(e){s.error("[YT ERROR]"),s.error(e)}},e.actionType={PLAYING:"play",PAUSED:"pause",FULLSCREEN:"fullscreen",ENDED:"end"},e.render=function(i,o,u,a){var f=i.originalRequest,l=/(?:youtube.com|youtu.be)\/(watch)?((?:.*)v=|v\/|embed\/)?([\w-]{11})/.exec(f);if(l){var h=l[3],p=!!a;i.originalSize(!0),i.target(""),i.youtubeId=h,i.youtubeUri=w(h,p),i.playerId=y(o.contentId,h),i.messageId=o.model.key(),i.contentId=o.contentId,i.isMyself=o.isMyself,i.messageTimestamp=o.timestamp,i.lastActionTimestamp=null,i.ytPlayer(!0),i.type(t.urlPreviewType.YT),i.dispose=c.bind(i),i.conversation=u,e.testContext.previewItems[i.playerId]=i,r.setTimeout(g.bind(null,o),n.youtubeWrapDelay)}else i.target("_blank"),s.error("Unmatched yt link: "+f);return!!l},e.parseYTLinks=function(e){var t=e.match(/(?:https?:\/\/|\/\/)?(?:www\.|m\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+?&v=))([\w-]{11})(?:[^\s.]*)/gi);return t?t:[]},e.isYT=function(t){return e.parseYTLinks(t).length>0},e.handleClick=function(t){var n=e.testContext.players[t.playerId];if(!n){s.error("Unable to find a player for "+t.playerId);return}n.getPlayerState()===r.YT.PlayerState.PLAYING?n.pauseVideo():n.playVideo()},e.randomIdEnabled=!0,r.onYouTubeIframeAPIReady=function(){i.addEventListener("mozfullscreenchange",e.testContext.onFullscreenChangedHandler),i.addEventListener("webkitfullscreenchange",e.testContext.onFullscreenChangedHandler),i.addEventListener("fullscreenchange",e.testContext.onFullscreenChangedHandler),i.addEventListener("MSFullscreenChange",e.testContext.onFullscreenChangedHandler)}}var t=e("swx-constants").COMMON,n=e("experience/settings"),r=e("browser/window"),i=e("browser/document"),s=e("swx-log-tracer").getLogger(),o=e("telemetry/chat/youtubeShowEvent"),u=e("telemetry/chat/youtubeActionEvent"),a=e("swx-pubsub-instance").default;return new f}),define("ui/urlPreview/urlPreview",["require","exports","module","lodash-compat","swx-cafe-application-instance","swx-constants","browser/dom","swx-telemetry-buckets","utils/common/eventHelper","vendor/knockout","swx-utils-chat","swx-log-tracer","reqwest","swx-service-locator-instance","experience/settings","utils/common/styleModeHelper","telemetry/chat/urlPreviewShow","browser/window","swx-skypeuri-parser","ui/players/ytPlayer"],function(e,t){function A(e,t,n){function i(e){return e.status_code!=="200"?!1:!e.title&&!e.site&&!e.description?!1:e.thumbnail?!0:!1}return r.get().signInManager._skypeToken().then(function(r){function u(r){return r.urlPreviewShowTelemetryEvent=s,r.urlRequest=e,r.encodedRequest=t,i(r)?(s.succeeded(r.status_code,!!r.thumbnail),new Promise(function(e,t){var i=g.setTimeout(t,S),s=new g.Image;s.onload=function(){g.clearTimeout(i),r.width=this.width,r.height=this.height,r.oneUrlOnly=j(n.urlPosition),e(r)},s.onerror=t.bind(null,r),s.src=r.thumbnail})):(r.skip=!0,s.error(r.status_code),Promise.reject(r))}function a(e){return e=e||{},e.skip=!0,s.error(e.status_code?e.status_code:null),e}var s,o={url:p.urlPServiceHost+"/v1/url/info?url="+t,method:"GET",crossOrigin:!0,dataType:"json",headers:{Authorization:"skype_token "+r,"X-Client-Version":L+"/"+I()}};return n.url=e,s=m.build(n),Promise.resolve(c.compat(o)).then(u,a).catch(a)})}function O(e,t,n){var r=/<a\s+(?:[^>]*?\s+)?href="((?!mailto:)[^"]*)".*?>(.*?)<\/a>/g,i=e.match(r)||[];if(t){var s=e.replace(r,"");i=i.concat(n.parseYTLinks(s))}if(!i)return;return i=M(i),i.length===0?null:i}function M(e){return e.filter(function(e,t,n){return t===n.indexOf(e)}).filter(function(e){return!y.containsSkypeUri(e)})}function _(e){var t=/^<a\s+(?:[^>]*?\s+)?href="([^"]*)".*<\/a>$/.exec(e);return t?t[1]:e}function D(e,t){return t.length===1&&!e.replace(t[0],"")?v.UrlOnly:n.endsWith(e,t[t.length-1])?v.TextEndingWithUrl:v.TextWithUrl}function P(e,t){return t.previews.remove(function(t){var n=e.indexOf(t.originalRequest);return n>-1&&e.splice(n,1),n===-1}),e}function H(e){return e==="image/gif"}function B(e){return e?n.escape(e):e}function j(e){return e===v.UrlOnly}function F(e){return{description:a.observable(e.description),title:a.observable(e.title),site:a.observable(),url:a.observable(e.url),target:a.observable("_blank"),rel:a.observable("noreferrer noopener"),favicon:a.observable(e.favicon),thumbnail:a.observable(e.thumbnail),category:a.observable(e.category),type:a.observable(i.urlPreviewType.WWW),typeClasses:{youtube:a.observable(!1)},scaledByW:a.observable(!1),scaledByH:a.observable(!1),originalSize:a.observable(!1),tall:a.observable(!1),wide:a.observable(!1),isGif:a.observable(!1),ytPlayer:a.observable(!1),ordinal:0,originalRequest:e.urlRequest,encodedRequest:e.encodedRequest,restrictions:e.restrictions}}function I(){if(k)return k;var e=p&&p.version?p.version.split(".",4):[];while(e.length<4)e.push("0");return e[3]=e[2],e[2]="0",k=e.join("."),k}var n=e("lodash-compat"),r=e("swx-cafe-application-instance"),i=e("swx-constants").COMMON,s=e("browser/dom"),o=e("swx-telemetry-buckets"),u=e("utils/common/eventHelper"),a=e("vendor/knockout"),f=e("swx-utils-chat").messageSanitizer,l=e("swx-log-tracer").getLogger(),c=e("reqwest"),h=e("swx-service-locator-instance").default,p=e("experience/settings"),d=e("utils/common/styleModeHelper"),v=o.enums.urlPositionBucket,m=e("telemetry/chat/urlPreviewShow"),g=e("browser/window"),y=e("swx-skypeuri-parser"),b=e("ui/players/ytPlayer"),w=.5,E=2,S=3e3,x=!1,T=!1,N=!0,C=!1,k="",L=908;t.render=function(t,n,o,c,p){function k(e){return{urlCount:e.length,urlPosition:D(t,e),participantsCount:o.participantsCount(),contentId:n.contentId}}function L(e){var t=n.elementInfo.element;if(!e){t.onkeydown=null;return}t.onkeydown=function(e){var r=u.isActivation(e);if(!r)return;try{var i=s.getElement(".thumbnail",t);i?i.click():b.handleClick(n.previews()[0])}catch(o){l.error(o)}}}function M(e){function t(e){return e=e||{},e.skip=!0,e}return A(e,encodeURIComponent(e),g).catch(t)}function I(e){if(!n._parentContext)return;n.onBeforeExpanded();var t=0;e.forEach(function(e){e.skip||q(e,t++)}),n.onAfterExpanded(),n.copyLinkEnabled(y&&n.previews().length===1),L(n.copyLinkEnabled())}function q(e,t){function h(e){return e>=w&&e<=E&&!d.get().isIntegratedProperty()}var r=a.utils.arrayFirst(n.previews(),function(t){return t.encodedRequest===e.encodedRequest});if(r)return;var s=b.isYT(e.url),u,f=H(e.content_type),l=e.width/e.height,c=s?i.urlPreviewType.YT:f?i.urlPreviewType.GIF:i.urlPreviewType.WWW;u=!s||!m.isFeatureOn(i.featureFlags.URL_PREVIEW_LOAD_YOUTUBE_PLAYER)||!!e.restrictions,r=F(e),r.target(u?"_blank":""),r.type(c),r.isGif(f),r.site(f?"":B(e.site)),r.typeClasses.youtube(s),r.ytEnabled=T,r.ordinal=t;if(s&&T&&!e.restrictions&&b.render(r,n,o)){n.previews.push(r);return}if(!x)return;if(f||h(l))r.originalSize(!r.isGif()),r.scaledByW(!1),r.scaledByH(!1);else{var p=l<w;r.scaledByW(p),r.scaledByH(!p),r.originalSize(!1)}r.tall(!f&&l<=1),r.wide(!f&&l>1),n.previews.push(r),n.isGif(f)}function R(){return x||T?Promise.all(v.map(M)).then(I):Promise.resolve()}function U(){var e=r.get().personsAndGroupsManager.mePerson,t=[];return t.push(e.preferences(i.userSettings.preferences.URL_PREVIEWS)?e.preferences(i.userSettings.preferences.URL_PREVIEWS).value.get():Promise.resolve(N)),t.push(e.preferences(i.userSettings.preferences.YOUTUBE_PLAYER)?e.preferences(i.userSettings.preferences.YOUTUBE_PLAYER).value.get():Promise.resolve(C)),Promise.all(t).then(function(e){x=p&&e[0],T=c&&e[1]})}var v=O(t,c,b),m=h.resolve(i.serviceLocator.FEATURE_FLAGS);if(!v)return n.isUrlPreview(!1),n.copyLinkEnabled(!1),n.group(i.activityItemGroups.TEXT),n.contentTemplate("textMessageContentTemplate"),Promise.resolve();var g=k(v),y=j(g.urlPosition);for(var S=0;S<v.length;S++)v[S]=f.unescapeHTML(_(v[S]));return n.previews?v=P(v,n):n.previews=a.observableArray([]),n.isUrlPreview(!0),n.group(i.activityItemGroups.MEDIA),n.contentTemplate("urlMessageContentTemplate"),U().then(R)}}),define("telemetry/chat/urlPreviewAction",["require","exports","module","experience/settings","swx-constants","ui/telemetry/telemetryClient","swx-telemetry-buckets","browser/window","services/telemetry/hashingService"],function(e,t){var n=e("experience/settings"),r=e("swx-constants").COMMON,i=r.telemetry.urlPreviewClicked,s=e("ui/telemetry/telemetryClient"),o=e("swx-telemetry-buckets"),u=e("browser/window"),a=e("services/telemetry/hashingService");t.publishActionEvent=function(e){function r(){var t=f();return{messageIdHash:a.getHash(e.contentId),contentType:o.getUrlContentType(e.url),ttc:t,ttcGroup:o.getMessageLifeDurationGroup(t),participantCount:e.participantCount,participantCountGroup:o.getParticipantCountGroup(e.participantCount)}}function f(){return l(e.timestamp,c())}function l(e,t){return t-e}function c(){return(new u.Date).getTime()}function h(e){var t=i.TYPE,r=e;s.get().sendEvent(n.telemetry.chatTenantToken,t,r)}var t;t=r(),h(t)}}),define("ui/viewModels/chat/message",["require","lodash-compat","ui/telemetry/actions/actionSources","swx-cafe-application-instance","swx-focus-handler","text!views/people/blockContactModal.html","ui/viewModels/people/blockContactModal","utils/common/cafeObservable","constants/components","swx-constants","ui/viewModels/people/contactBuilder","telemetry/chat/contactInfoEvent","ui/contactInfoMessage/contactInfoMessage","ui/viewModels/people/contactName","constants/contentTemplates","swx-encoder/lib/encoders/emoticonEncoder","ui/viewModels/calling/helpers/callingFacade","swx-enums","utils/common/eventMixin","swx-i18n","vendor/knockout","ui/viewModels/chat/messageMediaTypesHandlers","swx-utils-chat","swx-ui-navigation","utils/chat/message","ui/modalDialog/modalDialog","ui/modelHelpers/personHelper","ui/viewModels/chat/pollAvatars","telemetry/chat/poll","telemetry/calling/pstn/pstn","swx-pubsub-instance","swx-service-locator-instance","utils/common/styleModeHelper","ui/viewModels/chat/messageParsers/swiftCard","ui/viewModels/chat/translator/translationItem","ui/viewModels/chat/reactions","utils/chat/translatorHelper","utils/common/disposableMixin","ui/urlPreview/urlPreview","telemetry/chat/urlPreviewAction","ui/players/ytPlayer","ui/modelHelpers/personActionsHelper","swx-utils-chat","utils/chat/quoteMessageUtils","telemetry/chat/quoteMessageEvent","utils/common/clipboard"],function(e){function $(e){function ct(e){return d.templates[e]||d.templates[g.activityType.TextMessage]}function ht(){var e={},n=y.isRead(),r=y.group()===f.activityItemGroups.TEXT||y.group()===f.activityItemGroups.MEDIA||y.group()===f.activityItemGroups.CONTACT_INFO||y.group()===f.activityItemGroups.POLL||y.group()===f.activityItemGroups.TRANSCRIPT,i;return e.me=y.isMyself&&r,e.their=!e.me,e.first=y.isFirstMessage(),e.last=y.isLastMessage(),e.edited=y.isEdited,e.showTimestamp=y.showTimestamp,e.showBottomTimestamp=y.showBottomTimestamp,e.sticker=y.isSticker(),e.spacesWelcomeMessage=Q,e.deliveryFailed=y.deliveryFailed,e.urlPreview=y.isUrlPreview(),e.mojiItem=y.isMoji(),e.integrated=y.isIntegrated,e.picture=y.isPicture(),e.copyLink=y.copyLinkEnabled(),e.lastInBubble=y.isLastMessageInBubble(),e.sms=y.isSMS,e.meCommandMessage=y.isMeCommandMessage,y.isMeCommandMessage&&(e.edited=!1),ft&&(e.read=n,e.unread=!n),t.forIn(f.activityItemGroups,function(t){i=t&&t.toLowerCase(),i&&(e[i]=!1)}),y.group()===f.activityItemGroups.PSTN?e[f.activityItemGroups.CALL]=!0:e[y.group()]=!0,y.group()===f.activityItemGroups.CONTACT_REQUEST&&pt(e),y.group()===f.activityItemGroups.CUSTOM&&(e.participant=!0),t.trim(t.reduce(e,function(e,t,n){return E.unwrap(t)?e+" "+n:e},y.customMessageClasses||""))}function pt(e){function n(){return t.includes([g.activityType.ContactRequestIncoming,g.activityType.ContactRequestOutgoing,g.activityType.ContactRequestOutgoingAgent,g.activityType.SuggestedContact,g.activityType.UnblockContact],y.model.type())}function r(){return t.includes([g.activityType.ContactRequestOutgoingResend,g.activityType.ContactRequestIsNowContact,g.activityType.ContactRequestIncomingInviteFree],y.model.type())}e.contactMessage=n(),e.their=!e.me&&!n(),e.participant=r()}function dt(e){var t=e.type()===g.activityType.ParticipantJoined,n=e.persons();return!G||!t?!1:(Q=n.indexOf($.personsAndGroupsManager.mePerson)>=0,Q)}function vt(e){function o(t){return e.author!==t}function a(e){return new p(e)}function l(e){return!k.isMePerson(e)}function c(){var e;return!J||!J.participants()?e:(J.participants().forEach(function(n){if(k.isAgent(n.person)){var r=u.newObservableProperty(n.person.displayName),i=t.escape(r()),s=w.fetch({key:"message_text_joiningConversationWithBots",params:{botName:i}}),o=w.fetch({key:"message_text_joiningConversationWithBotsV2",params:{botName:i}});e?e+="\n":e="",ut.push({subscription:r}),lt?e+=o+N.getBotDisclosureMessage(n.person.id(),i,J):e+=s}}),e)}var n=u.newObservableProperty(e.context),r=e.persons().filter(o),i;e.reason&&(i=e.reason()),y.participantsWithoutAuthor=r.map(a);if(dt(e)){var s=u.newObservableProperty(J.selfParticipant.role);y.participantsWithoutMyself=r.filter(l).map(a),y.contentTemplate(ct(f.customActivityItemTemplates.SPACES_WELCOME_MESSAGE)),y.spaceLink=u.newObservableProperty(J.uri),y.isJoiningEnabled=u.newObservableProperty(J.isJoiningEnabled),y.conversation=J,y.showSpacesCTA=E.computed(function(){return s()===g.participantRole.Leader&&!z.isGuestHostConversation(J.conversationId)}),y.welcomeMessage=E.computed(function(){return w.fetch({key:y.isJoiningEnabled()?"spaces_welcomeMessage":"spaces_welcomeMessageWithoutLink"})}),y.agentsMessageContent=E.computed(c),y.editTopicAction=function(){y.dispatchEvent(b.conversation.OPEN_PROFILE,{editTopic:!0},y.DIRECTION.PARENT)},y.settingsAction=function(){y.dispatchEvent(b.conversation.OPEN_PROFILE,{editTopic:!1},y.DIRECTION.PARENT)},y.othersAddedMessageContent=E.computed(function(){if(y.participantsWithoutMyself.length>0)return N.getMessageFromParticipantActivityItem(e.type(),y.author,y.participantsWithoutMyself,n,i,J)})}return E.computed(function(){return N.getMessageFromParticipantActivityItem(e.type(),y.author,y.participantsWithoutAuthor,n,i,J)})}function mt(e){e.sender&&(y.author=l.build(e.sender),y.isMyself=k.isMePerson(e.sender),y.displayname=E.observable(y.isMyself?"me":y.author),y.renderAuthorInfo(!y.isMyself),y.showAuthorInfo(!y.isMyself),y.openConversationLabel=E.pureComputed(function(){return w.fetch({key:"label_text_openConversation",params:{displayName:e.sender.displayName()}})})),y.direction=e.direction&&e.direction()}function gt(e,t){if(t.translation){var n={key:t.translation.key,value:t.translation.users[0].value,mri:t.translation.users[0].mri};e.translations.add(n)}}function yt(e,n){switch(y.group()){case f.activityItemGroups.PARTICIPANT:y.author=l.build(e.author),y.content=vt(e);break;case f.activityItemGroups.CALL:var r=N.getMessageFromCallActivityItem(e,n);mt(e),y.content=E.observable(r.text),y.liveSessionDuration=r.duration,y.callAction=r.callAction,y.typeClasses={liveSessionText:!0,"fontSize-h4":!0};break;case f.activityItemGroups.NGC_UPGRADE:y.content=E.observable(N.getMessageFromNgcUpgradeActivityItem(e));break;case f.activityItemGroups.PLUGIN_FREE:y.content=E.observable(N.getMessageFromPluginFreeActivityItem(e));break;case f.activityItemGroups.PSTN:y.content=E.observable(N.getMessageFromPstnActivityItem(e)),e.type()===g.activityType.PstnInvalidNumber&&!e.isGroup()?(y.linkContent=w.fetch({key:"pstn_invalid_number_return_link"}),y.linkVisible=!0):(y.linkContent="",y.linkVisible=!1),mt(e),y.callAction="callError",y.typeClasses={liveSessionText:!0,"fontSize-h4":!0};break;case f.activityItemGroups.TEXT:var i,s;mt(e),i=u.newObservableProperty(e.html),tt.isFeatureOn(f.featureFlags.SWIFT_CARD_RENDERING)&&(s=P.parse(y,e,J)),typeof s!="undefined"?y.content=s:y.content=E.computed(function(){var t=i(),n=Y||!t.trim().length,r=tt.isFeatureOn(f.featureFlags.URL_PREVIEWS),s=tt.isFeatureOn(f.featureFlags.YOUTUBE_PLAYER_ENABLED),o=J._translatorSettings&&J._translatorSettings.isEnabled,u=e.direction&&e.direction()===f.chat.messageType.INCOMING,a=!et&&rt&&o&&u&&!e.isDeleted();n?t=x.transform(e.text(),"text/typed","text/html"):tt.isFeatureOn(f.featureFlags.ENABLE_RAW_EMOTICONS_RENDERING)&&(t=x.encodeEmoticonsRawRepresentation(t));if(y.isMeCommandMessage){var l;try{return l=new RegExp("^"+y.model.sender.displayName()+" "),t.replace(l,"<b>"+y.model.sender.displayName()+"</b> ")}catch(c){return t}}return Z&&(s||r)&&E.ignoreDependencies(function(){I.render(t,y,J,s,r)}),a&&j.requestTranslation(t,e.direction(),J,gt.bind(null,e)),y.isSticker(st.hasLargeEmoticon(t)),t}),y.isEdited=u.newObservableProperty(e.isEdited),y.isDeleted=u.newObservableProperty(e.isDeleted),bt();break;case f.activityItemGroups.MEDIA:var o=S.fetch(e.type());mt(e),o(y,n);break;case f.activityItemGroups.CONTACT_REQUEST:y.author=l.build(e.sender),y.content=E.computed(function(){return N.getMessageFromContactRequestActivityItem(e.type(),y.author.getPerson())}),y.actionInProgress=E.observable(!1),e.type()===g.activityType.ContactRequestIncoming&&(y.greeting=u.newObservableProperty(e.greeting)),y.isBusinessContactMgmtEnabled&&(e.type()===g.activityType.ContactRequestOutgoing||e.type()===g.activityType.ContactRequestIsNowContact)&&e.isRead(!0);break;case f.activityItemGroups.POLL:mt(e),y.pollAvatarsVM=L.build(e,function(e){y.dispatchEvent(b.userListPopup.POPUP_TOGGLE,e)}),y.isEdited=u.newObservableProperty(e.isEdited),y.isDeleted=u.newObservableProperty(e.isDeleted),y.content=E.observable(w.fetch({key:"poll_message_question_header",params:{pollQuestion:e.pollQuestion()}})),y.pollQuestion=u.newObservableProperty(e.pollQuestion),y.pollAnswers=u.newObservableCollection(e.pollAnswers),y.answerSent=u.newObservableProperty(e.meVoted),y.checkedAnswer=E.observable(),y.checkedAnswerSubscription=e.meCheckedAnswerPositions.changed(function(){y.checkedAnswer(t.isEmpty(e.meCheckedAnswerPositions())?-1:e.meCheckedAnswerPositions()[0])}),y.peopleVotedText=E.observable(),y.peopleVotedNumSubscription=e.peopleVotedNum.changed(function(e){y.peopleVotedText(w.fetch({key:"poll_message_people_voted",params:{count:e}}))}),y.onAnswerClick=function(t){return e.meVoted()?y.checkedAnswer(e.meCheckedAnswerPositions()[0]):(A.activityVote(y.model),y.model.addAnswer(t)),!0};break;case f.activityItemGroups.CONTACT_INFO:mt(e),h.render(e,y,J);break;case f.activityItemGroups.TRANSACTION:var a="Unsupported transaction message";mt(e),y.content=E.observable(a),y.group(f.activityItemGroups.TEXT);break;case f.activityItemGroups.SYSTEM:case f.activityItemGroups.CUSTOM:y.content=E.observable(e.text());break;case f.activityItemGroups.TRANSCRIPT:y.content=E.observable(e.text()),y.author=e.author(),y.isMyself=e.isMyself(),y.renderAuthorInfo(!y.isMyself),y.showAuthorInfo(!y.isMyself)}}function bt(){it&&it.dispose(),it=y.isDeleted.subscribe(function(e){if(!e)return;it.dispose(),it=null,y.group(f.activityItemGroups.TEXT),y.contentTemplate("textMessageContentTemplate"),y.isUrlPreview(!1),y.previews&&(_t(y.previews()),y.previews([]))})}function wt(){y.showSpacesCTA&&y.showSpacesCTA.dispose(),y.welcomeMessage&&y.welcomeMessage.dispose(),y.othersAddedMessageContent&&y.othersAddedMessageContent.dispose(),y.participantsWithoutMyself&&t.forEach(y.participantsWithoutMyself,function(e){e.dispose()})}function Et(){wt(),y.participantsWithoutAuthor&&t.forEach(y.participantsWithoutAuthor,function(e){e.dispose()})}function St(){y.messageDeliveryStatusEnabled&&y.model.status.changed.off(xt)}function xt(e){var t=y.model.type()===g.activityType.ParticipantJoinFailed,n="iconfont ";y.deliveryFailed(!1);switch(e){case g.activityStatus.Failed:y.deliveryFailed(!t),y.statusText(w.fetch({key:"message_failed_status"})),n+="warning";break;case g.activityStatus.Succeeded:y.statusText(w.fetch({key:"message_sent_status"})),n+="presenceOnlineStroke";break;case g.activityStatus.Pending:y.statusText(w.fetch({key:"message_sending_status"})),n+="presenceStroke";break;default:y.statusText("")}y.deliveryStatusIconCssClass(n)}function Tt(e){if(J.selfParticipant.isAnonymous()||k.isGuest(e))return!1;var t;t=$.conversationsManager.getConversation(e),$.conversationsManager.conversations.add(t),M.publish(b.navigation.OPEN_CONVERSATION,{model:t,origin:f.telemetry.historyLoadOrigin.AUTHOR_SWITCH})}function Nt(e){if(!y.contacts||y.isMyself)return;h.handleContactAdded(e.id(),y)}function Ct(e){var t;return y.model.contacts().some(function(n){n.id()===e&&(t=n)}),t}function kt(e){e?y.model.status.changed(xt):St()}function Lt(){y.actionInProgress(!1)}function At(e){e&&e.giphyExpression?y.giphyMetadata("/giphy "+e.giphyExpression):y.giphyMetadata(!1)}function Ot(){var e=_.resolve(f.serviceLocator.FEATURE_FLAGS).isFeatureOn(f.featureFlags.LOW_FOCUS_IMPORTANCE_CONTACT_REQUEST);return e?i.Priorities.Low:i.Priorities.High}function Mt(){K&&K()}function _t(e){e.forEach(function(e){t.isFunction(e.dispose)&&(e.ytPlayer(!1),e.dispose.call(e))})}var y=this,$=r.get(),J,K,Q=!1,G,Y,Z=!e||!e.noUrlPreview,et=e&&e.noTranslationItem,tt=_.resolve(f.serviceLocator.FEATURE_FLAGS),nt=$.translatorService,rt=nt&&$.translatorService.state()===f.translatorServiceState.Authenticated,it,st=v.build(),ot=t.assign({},F),ut=E.observableArray(),at=_.resolve(f.serviceLocator.FEATURE_FLAGS),ft=at.isFeatureOn(f.featureFlags.MARK_READ_MESSAGES_V2_ENABLED),lt;this.autoDisposer=ot,this.init=function(e,t){var n=_.resolve(f.serviceLocator.FEATURE_FLAGS),r=e.key();G=n.isFeatureOn(f.featureFlags.SPACES),Y=n.isFeatureOn(f.featureFlags.MESSAGE_ENFORCE_TEXT_FORMAT),lt=tt.isFeatureOn(f.featureFlags.BOT_MESSAGES_MODE_V2_ENABLED),J=t,y.isEdited=E.observable(!1),y.messageDeliveryIndicatorEnabledSW4B=n.isFeatureOn(f.featureFlags.SHOW_MESSAGE_DELIVERY_INDICATOR_SW4B),y.messageDeliveryStatusEnabled=n.isFeatureOn(f.featureFlags.SHOW_MESSAGE_DELIVERY_STATUS)&&e.type()!==g.activityType.SystemMessage,y.timestampsInNarrowModeEnabled=n.isFeatureOn(f.featureFlags.SHOW_TIMESTAMPS_IN_NARROW_MODE),y.disableOpenConversationWithAuthor=n.isFeatureOn(f.featureFlags.DISABLE_OPEN_CONVERSATION_WITH_AUTHOR),y.isDeleted=E.observable(!1),y.isMyself=!1,y.clientmessageid=r,y.contentId=r?"msg_"+r:null,y.timestamp=e.timestamp(),y.setTimestamp=E.observable("00:00"),y.setBottomTimestamp=E.observable("00:00"),y.setLongTimestamp=E.observable("00:00"),y.showTimestamp=E.observable(!0),y.showBottomTimestamp=E.observable(!1),y.isRead=u.newObservableProperty(e.isRead),y.isFirstMessage=E.observable(!1),y.isLastMessage=E.observable(!1),y.isLastMessageInBubble=E.observable(!1),y.model=e,y.group=E.observable(N.getActivityItemGroup(e.type())),y.isGroupConversation=J.isGroupConversation(),y.conversationId=t.conversationId,y.renderAuthorInfo=E.observable(!1),y.showAuthorInfo=E.observable(!1),y.liveSessionDuration=!1,y.isCallActivityItem=E.computed(function(){return y.group()===f.activityItemGroups.CALL||y.group()===f.activityItemGroups.PSTN}),y.isSticker=E.observable(),y.isMoji=E.observable(!1),y.isPicture=E.observable(!1),y.isUrlPreview=E.observable(!1),y.deliveryFailed=E.observable(!1),y.deliveryFailedMessage=E.computed(function(){return y.deliveryFailed()?w.fetch({key:"message_not_delivered_text"}):""}),y.statusText=E.observable(),y.deliveryStatusIconCssClass=E.observable(),y.isMyLastMessageInChat=E.observable(!1),y.isIntegrated=D.get().isIntegratedProperty(),y.copyLinkEnabled=E.observable(!1),y.giphyMetadata=E.observable(!1),y.isGif=E.observable(!1),y.isSMS=e._isSMS?e._isSMS():!1,y.smsStatus=y.isSMS?u.newObservableProperty(e._smsInfo().status):{},y.suggestedActions=E.observableArray([]),y.reactionsVM=B.build(y),y.contentTemplate=E.observable(ct(e.type())),y.focusImportance=Ot(),y.typeClasses={},y.isMeCommandMessage=!!e._skypeemoteoffset,yt(e,J.isGroupConversation()),y.cssClass=E.computed(ht,this),y.showGiphyMetadata=E.computed(function(){return y.isGif()&&!y.isDeleted()&&y.giphyMetadata()}),y.focusHandlerCallback=function(e){K=e},y.messageDeliveryIndicatorEnabledSW4B&&y.model.status.changed(xt),y.messageDeliveryStatusEnabled&&y.isMyLastMessageInChat.subscribe(kt),$.personsAndGroupsManager.all.persons.added(Nt),et||(y.translationItem=H.build(y,J),y.translationItem.init()),y.model._activityData&&y.model._activityData.changed(At),y.isCopySelectionAsQuoteEnabled=tt.isFeatureOn(f.featureFlags.COPY_SELECTION_AS_QUOTE_KEYBOARD)&&V.isCopySupportedByBrowser(),y.forwardEvent(b.videoPlayer.FULLSCREEN_ON,y.DIRECTION.PARENT,null,y.DIRECTION.CHILD),y.forwardEvent(b.videoPlayer.FULLSCREEN_OFF,y.DIRECTION.PARENT,null,y.DIRECTION.CHILD),y.registerEvent(b.navigation.FRAGMENT_SHOW,Mt)},y.onCopy=function(e){var t=e.model,r=document.getSelection().toString(),i=W.copySelectionAsQuote(t,r,$.conversationsManager),s=n.selectionCopyKeyboard;X.publish(t,s,i)},this.dispose=function(){it&&it.dispose(),y.content&&y.content.dispose&&y.content.dispose(),y.deliveryFailedMessage&&y.deliveryFailedMessage.dispose(),y.cssClass&&y.cssClass.dispose(),y.author&&y.author.dispose&&y.author.dispose(),y.isCallActivityItem&&y.isCallActivityItem.dispose(),y.checkedAnswerSubscription&&y.checkedAnswerSubscription.dispose&&y.checkedAnswerSubscription.dispose(),y.peopleVotedNumSubscription&&y.peopleVotedNumSubscription.dispose&&y.peopleVotedNumSubscription.dispose(),y.isSMS&&y.model._smsInfo&&y.model._smsInfo().dispose(),Et(),y.model&&(y.messageDeliveryIndicatorEnabledSW4B||y.messageDeliveryStatusEnabled)&&y.model.status.changed.off(xt),y.showGiphyMetadata&&y.showGiphyMetadata.dispose(),y.reactionsVM&&y.reactionsVM.dispose(),$.personsAndGroupsManager.all.persons.added.off(Nt),y.model&&y.model._activityData&&y.model._activityData.changed.off(At),y.translationItem&&y.translationItem.dispose(),y.previews&&(_t(y.previews()),y.previews([])),ot.dispose&&ot.dispose(),ut().length&&ut().forEach(function(e){e.subscription.dispose()})},this.onRendered=function(){y.isRendered=!0,y.dispatchEvent(b.message.RENDERED)},this.onBeforeExpanded=function(){y.dispatchEvent(b.message.BEFORE_EXPANDED)},this.onAfterExpanded=function(){y.dispatchEvent(b.message.AFTER_EXPANDED)},this.openConversationWithAuthor=function(){Tt(y.model.sender)},this.navigateToDialPad=function(){function e(){return{page:a.calling.SKYPEOUT_PAGE,origin:f.telemetry.historyLoadOrigin.SKYPEOUT_PAGE}}M.publish(f.events.navigation.NAVIGATE,e())},this.isBusinessContactMgmtEnabled=tt.isFeatureOn(f.featureFlags.ENABLE_BUSINESS_CONTACT_MANAGEMENT),this.sendContactRequest=function(){var e,t={source:n.conversation.messageItem},r=y.model.sender,i=y.model.type();return y.actionInProgress(!0),$.conversationsManager.conversations.add(J),e=U.addPerson(r,i,J,t),e.then(Lt,Lt),y.dispatchEvent(b.message.ADD_CONTACT,{source:n.conversation.messageItem},y.DIRECTION.PARENT),e},this.acceptContactRequest=function(){var e,t={source:n.conversation.messageItem},r=y.model.sender;return y.actionInProgress(!0),e=U.addPerson(r,g.activityType.ContactRequestIncoming,J,t,Lt,Lt),e},this.declineContactRequest=function(){var e,t={source:n.conversation.messageItem},r=y.model.sender;return y.actionInProgress(!0),e=U.declinePerson(r,J,t,Lt,Lt),e},this.blockContactRequest=function(){var e={source:n.contactRequestIncomingActivityItem},t=new o(y.author.getPerson(),e),r=w.fetch({key:"modal_blockContact_text_aria_label"});return C.build(o.ELEMENT_ID,t,s),C.show(o.ELEMENT_ID,r),Promise.resolve()},this.unblockContact=function(){var e,t={source:n.contactRequestIncomingActivityItem},r=y.model.sender;return y.actionInProgress(!0),e=U.unblockPerson(r,t,Lt,Lt),e},this.openUrlPreview=function(e,t){function n(){if(!tt.isFeatureOn(f.featureFlags.URL_PREVIEW_LOAD_YOUTUBE_PLAYER))return!1;var n=t||E.utils.arrayFirst(y.previews(),function(t){return t.url()===e});return n&&n.type()===f.urlPreviewType.YT&&!n.restrictions?n:null}var r=n(),i={url:e,timestamp:y.timestamp,participantCount:J.participantsCount(),contentId:y.contentId};q.publishActionEvent(i);if(r&&R.render(r,y,J,e))return!1;var s=window.open();return s.opener=null,s.location=e,!1},this.isPSTNContactMessage=function(e){var t=Ct(e);return k.isPstn(t)},this.contactHasFullName=function(e){var t=Ct(e);return t.displayName()!==e||k.isPstn(t)},this.isMePersonContactMessage=function(e){return k.isMePersonId(e)},this.openConversationWithUser=function(e){var t=Ct(e);Tt(t),c.publishActionEvent({person:t,participantsCount:J.participantsCount(),timeInStale:y.timestamp.getTime()})},this.addCreditTelemetry=function(e,t){var n=f.telemetry.pstn;return t.target.className===n.cssClasses.ADD_CREDIT?O.addingCredit(n.entryPoint.NO_CREDIT_CALL_END):t.target.className===n.cssClasses.ADD_SUBSCRIPTION&&O.addingSubscription(n.entryPoint.NO_SUBSCRIPTION_CALL_END),!0},this.activateFirstLink=function(e,t){var n=e.elementInfo.element.querySelector(".content a");n&&t.target.tagName!=="A"&&(n.click(),t.preventDefault(),t.stopPropagation())},this.messageClicked=function(e,t){t.target&&t.target.href&&(T.navigate(t.target.href,m),t.preventDefault(),t.stopPropagation())}}var t=e("lodash-compat"),n=e("ui/telemetry/actions/actionSources"),r=e("swx-cafe-application-instance"),i=e("swx-focus-handler"),s=e("text!views/people/blockContactModal.html"),o=e("ui/viewModels/people/blockContactModal"),u=e("utils/common/cafeObservable"),a=e("constants/components"),f=e("swx-constants").COMMON,l=e("ui/viewModels/people/contactBuilder"),c=e("telemetry/chat/contactInfoEvent"),h=e("ui/contactInfoMessage/contactInfoMessage"),p=e("ui/viewModels/people/contactName"),d=e("constants/contentTemplates"),v=e("swx-encoder/lib/encoders/emoticonEncoder"),m=e("ui/viewModels/calling/helpers/callingFacade"),g=e("swx-enums"),y=e("utils/common/eventMixin"),b=f.events,w=e("swx-i18n").localization,E=e("vendor/knockout"),S=e("ui/viewModels/chat/messageMediaTypesHandlers"),x=e("swx-utils-chat").messageSanitizer,T=e("swx-ui-navigation"),N=e("utils/chat/message"),C=e("ui/modalDialog/modalDialog"),k=e("ui/modelHelpers/personHelper"),L=e("ui/viewModels/chat/pollAvatars"),A=e("telemetry/chat/poll"),O=e("telemetry/calling/pstn/pstn"),M=e("swx-pubsub-instance").default,_=e("swx-service-locator-instance").default,D=e("utils/common/styleModeHelper"),P=e("ui/viewModels/chat/messageParsers/swiftCard"),H=e("ui/viewModels/chat/translator/translationItem"),B=e("ui/viewModels/chat/reactions"),j=e("utils/chat/translatorHelper"),F=e("utils/common/disposableMixin"),I=e("ui/urlPreview/urlPreview"),q=e("telemetry/chat/urlPreviewAction"),R=e("ui/players/ytPlayer"),U=e("ui/modelHelpers/personActionsHelper"),z=e("swx-utils-chat").conversation,W=e("utils/chat/quoteMessageUtils"),X=e("telemetry/chat/quoteMessageEvent"),V=e("utils/common/clipboard");return t.assign($.prototype,y),$}),define("ui/viewModels/chat/conversationProcessor",["require","lodash-compat","swx-utils-chat","swx-constants"],function(e){var t=e("lodash-compat"),n=e("swx-utils-chat").dateTime,r=e("swx-constants").COMMON,i=3e5,s=function(e){return n.getMidnight(e)},o=function(e,t){return t===undefined?!0:e!==t},u=function(e,t){return s(t)!==s(e)},a=function(e,t,n){var r=e>t,s=e-n;return r&&s>=i},f=function(e){if(e&&e.isMeCommandMessage)return!1;if(e&&t.isFunction(e.group))switch(e.group()){case r.activityItemGroups.TEXT:case r.activityItemGroups.MEDIA:case r.activityItemGroups.CONTACT_INFO:case r.activityItemGroups.POLL:case r.activityItemGroups.TRANSCRIPT:case r.activityItemGroups.CALL:case r.activityItemGroups.PSTN:return!0}return!1},l=function(e){return!!(e&&e.messageDeliveryStatusEnabled&&e.deliveryFailed())},c=function(e){return!!e&&!!(e.playerId||t.isFunction(e.group)&&e.group()===r.activityItemGroups.MEDIA)};return function(){this.processMessage=function(e,t){var i=e.group()===r.activityItemGroups.TEXT,h=e.group()===r.activityItemGroups.MEDIA,p=e.group()===r.activityItemGroups.CONTACT_INFO,d=e.group()===r.activityItemGroups.CALL,v=e.group()===r.activityItemGroups.POLL,m=e.group()===r.activityItemGroups.PSTN,g=e.group()===r.activityItemGroups.PARTICIPANT,y=e.group()===r.activityItemGroups.TRANSCRIPT,b=i||h||p||v||y,w=f(e),E=d||h||m,S=e.author&&e.author.id(),x=o(t.previousAuthor,S),T=t.midnight||s((new Date).getTime()),N=u(t.previousTimestamp,e.timestamp),C=E||x||N||c(e)||a(e.timestamp,T,t.lastShowedTimestamp),k=x||N||g||c(t.previousMessage),L=!e.isMyself,A=b&&(x||!!t.suppressedLastAuthor),O=w&&(C||!!t.suppressedLastTimestamp),M=n.formatTimestamp(e.timestamp,T),_=n.formatTimestampLong(e.timestamp,T),D=n.formatTimestampForceLong(e.timestamp),P=t.previousMessage&&O&&!A&&!t.previousMessage.showTimestamp()||g,H=f(t.previousMessage)&&k&&!l(t.previousMessage);return e.isFirstMessage(b&&(e.isDisjoined||t.previousIsDisjoined||A)),e.isLastMessage(!0),e.showAuthorInfo(L&&e.isFirstMessage()),e.showTimestamp(O),e.setTimestamp(M),e.showBottomTimestamp(w&&!l(e)),e.setBottomTimestamp(_),e.setLongTimestamp(D),O&&(t.lastShowedTimestamp=e.timestamp),t.previousMessage&&(t.previousMessage.isLastMessageInBubble(P),t.previousMessage.showBottomTimestamp(H)),t.previousAuthor=S,t.previousTimestamp=e.timestamp,t.suppressedLastAuthor=!b,t.suppressedLastTimestamp=!w||h,t.midnight=T,t.previousIsDisjoined=e.isDisjoined,t.previousMessage=e,t},this.processMyLastMessageIfAny=function(e){var t;if(e.length<=0)return;for(t=e.length-1;t>=0;t--)if(e[t].isMyself){e[t].isMyLastMessageInChat(!0),e[t].showBottomTimestamp(!e[t].messageDeliveryStatusEnabled&&e[t].showBottomTimestamp());return}},this.processMyBeforeLastMessageIfAny=function(e){var t,n=!1;if(e.length<=1)return;for(t=e.length-1;t>=0;t--){if(!e[t].isMyself||!e[t].isMyLastMessageInChat())continue;if(!!n){e[t].isMyLastMessageInChat(!1);return}n=!0}}}}),define("telemetry/utils/telemetryUtils",["require","exports","module","swx-constants"],function(e,t){var n=e("swx-constants").COMMON,r=n.telemetry.NOT_AVAILABLE;t.stringify=function(e){for(var t in e)e.hasOwnProperty(t)&&!(typeof e[t]=="string"||e[t]instanceof String)&&(e[t]=e[t]+"");return e},t.getOriginDescription=function(e,t){for(var n in t)if(t.hasOwnProperty(n)&&t[n]===e)return n;return r}}),define("telemetry/chat/conversationHistoryLoad",["require","swx-constants","experience/settings","services/telemetry/skypeData","services/telemetry/common/telemetryContext","telemetry/utils/telemetryUtils","swx-telemetry-buckets","telemetry/chat/activityItemHelper"],function(e){function f(e){var f=this;f._context={timer:null,startTime:null,syncEndTime:null,renderEndTime:null,SYNC_TIMEOUT:1e4,conversationLoaded:e,pageNumber:0,isUnread:0,hasError:!1,isCached:t.telemetry.NOT_AVAILABLE,timeInStale:t.telemetry.NOT_AVAILABLE},function(){var n=e.historyService.activityItems(),r=n[n.length-1];f._context.isUnread=!1;if(!r)return;f._context.isUnread=!r.isRead(),f._context.timeInStale=0;if(f._context.isUnread){var i=+(new Date);f._context.timeInStale=(i-r.timestamp())/1e3}}(),f.start=function(){f._context.startTime=(new Date).getTime(),f._context.timer=setTimeout(f.publish,f._context.SYNC_TIMEOUT)},f.registerSync=function(){f._context.timer||(f._context.pageNumber++,f.start()),f._context.syncEndTime=(new Date).getTime(),f._context.renderEndTime=f._context.syncEndTime},f.registerRender=function(){f._context.renderEndTime=(new Date).getTime()},f.registerError=function(){f._context.hasError=!0,f._context.syncEndTime=(new Date).getTime(),f.publish()},f.dispose=function(){f._context.conversationLoaded=null},f.publish=function(){f._context.timer&&(clearTimeout(f._context.timer),f._context.timer=null);var l=u.processConversation(e),c=i.get(),h=a.TYPE,p,d=c.chatHistoryLoadResult[e.conversationId];return l.participantsCount=e.participants().length,l.participantsCountGroup=o.getParticipantCountGroup(e.participants().length),l.isFavorite=!!e._isFavorited&&e._isFavorited(),l.ttl=f._context.syncEndTime-f._context.startTime,l.ttlDurationGroup=o.getSecondsDurationGroupFromMs(l.ttl),l.tis=f._context.timeInStale,l.isUnread=f._context.isUnread,l.pageNumber=f._context.pageNumber,l.responseCode=d,f._context.hasError?l.ttr=t.telemetry.NOT_AVAILABLE:l.ttr=f._context.renderEndTime-f._context.startTime,l.ttrDurationGroup=o.getSecondsDurationGroupFromMs(l.ttr),l.origin=c.historyLoadOrigin,l.originDescription=s.getOriginDescription(c.historyLoadOrigin,t.telemetry.historyLoadOrigin),l.t404=c.isChatHistoryLoad404,l.isError=o.isError(d),p={type:h,data:l},r.push(p,n.telemetry.uiTenantToken),f.dispose(),l}}var t=e("swx-constants").COMMON,n=e("experience/settings"),r=e("services/telemetry/skypeData"),i=e("services/telemetry/common/telemetryContext"),s=e("telemetry/utils/telemetryUtils"),o=e("swx-telemetry-buckets"),u=e("telemetry/chat/activityItemHelper"),a=t.telemetry.conversationHistoryLoadEvent;return f}),define("text!views/chat/chatLog.html",[],function(){return'<div class="conversation scrollable scrollViewport scrollViewportV" data-bind="event: { scroll: onScroll, mouseover: onMouseOver, mouseout: onMouseOut }" tabindex="-1">\r\n    <div class="history scrollViewport-inner">\r\n        <div class="scroller">\r\n            <!-- ko if: showIntroText -->\r\n            <div class="chatLogIntroText" data-bind="foreach: introMessages">\r\n                <p data-bind="text: $data.text" tabindex="-1"></p>\r\n            </div>\r\n            <!-- /ko -->\r\n            <div class="messageHistory largeAllowed" role="list" data-swx-testId="messageHistory" data-bind="foreach: collection, css: { visible: collection().length > 0 }, keyboardNavigation: { itemSelector: \'swx-message, [tabindex=\\\'-1\\\']:not([disabled])\', selectLastItem: true }">\r\n                <swx-message role="listitem" params="viewModel: $data" data-bind="css: $data.cssClass, attr: { \'data-id\': $data.clientmessageid }, enterKey: activateFirstLink" class="message showName loading" tabindex="-1" aria-relevant="all"></swx-message>\r\n            </div>\r\n            <swx-typing-indicator class="typingIndicator" params="participants: participants"></swx-typing-indicator>\r\n            <!-- ko if: suggestedActionsEnabled -->\r\n            <div class="suggested-actions" data-bind="css: {\'show-suggested-actions\': showSuggestedActions()}">\r\n                <div class="navBtnWrapper" data-bind="click: scrollLeft, css: { disabled: !hasSuggestedActionOnLeft()}">\r\n                    <span class="button prev iconfont" role="button" tabindex="0"></span>\r\n                </div>\r\n                <div id="chatlog-suggestedActionsArea" class="actionItems" data-bind="scroll: suggestionsChanged">\r\n                    <!-- ko if: showBotDetails -->\r\n                    <swx-avatar class="avatar" params="isGroupAvatar: false, avatar: suggestedActionsAuthor.avatar, isAgent: suggestedActionsAuthor.isAgent, displayName: suggestedActionsAuthor.displayName, useAbsolutePosition: false"></swx-avatar>\r\n                    <!-- /ko -->\r\n                    <!-- ko foreach: suggestedActions -->\r\n                    <div class="actionItem" data-bind="click: action">\r\n                        <!-- ko if: type === \'openUrl\' -->\r\n                        <span class="iconfont screenshare icon"></span>\r\n                        <!-- /ko -->\r\n                        <!-- ko if: type === \'call\' -->\r\n                        <span class="iconfont callStart icon"></span>\r\n                        <!-- /ko -->\r\n                        <span class="text" data-bind="html: title"></span>\r\n                    </div>\r\n                    <!-- /ko -->\r\n                </div>\r\n                <div class="navBtnWrapper" data-bind="click: scrollRight, css: { disabled: !hasSuggestedActionOnRight()}">\r\n                    <span class="button next iconfont" role="button" tabindex="0"></span>\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/chat/chatLog",["require","exports","module","vendor/knockout","ui/viewModels/chat/chatLog","jsviews/chat/chatLog","ui/viewModels/chat/message","ui/viewModels/chat/conversationProcessor","utils/common/resizeHandler","telemetry/chat/conversationHistoryLoad","constants/components","text!views/chat/chatLog.html"],function(e,t){function f(e,t){var f=new i(t.element,u),l=n.dataFor(t.element),c=new r(s,l),h=new o,p=new a(e.conversationModel);return c.setContext(l),c.init(e.conversationModel,f,h,p),c}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/chatLog"),i=e("jsviews/chat/chatLog"),s=e("ui/viewModels/chat/message"),o=e("ui/viewModels/chat/conversationProcessor"),u=e("utils/common/resizeHandler"),a=e("telemetry/chat/conversationHistoryLoad");t.name=e("constants/components").chat.CHAT_LOG,t.template=e("text!views/chat/chatLog.html"),t.viewModel={createViewModel:f}}),define("telemetry/chat/pes",["require","lodash-compat","swx-constants","swx-utils-common","experience/settings","ui/telemetry/telemetryClient","swx-service-locator-instance","utils/common/styleModeHelper"],function(e){function a(){function e(e,r){var i=t.find(r,function(t){return t.item.id===e});return i?(r.splice(r.indexOf(i),1),i):{type:n.telemetry.pes.source.TYPED,section:n.telemetry.pes.UNKNOWN,tabName:n.telemetry.pes.UNKNOWN,tabIndex:n.telemetry.pes.UNKNOWN}}function a(e){return e?e:n.telemetry.NOT_AVAILABLE}this.emoticonsSentInMessage=function(o,u){var a=r.create();o.forEach(function(t){var r=e(t,u);s.get().sendEvent(i.telemetry.chatTenantToken,n.telemetry.pes.eventName.EMO_SENT,{message_id:a+"",emo_id:t+"",emo_source:r.type+"",emo_section:r.section+"",emo_tab_name:r.tabName+"",emo_tab_index:r.tabIndex+""})})},this.mojiPlayed=function(t,r){s.get().sendEvent(i.telemetry.chatTenantToken,n.telemetry.pes.eventName.MOJI_PLAYED,{moji_id:t.id+"",moji_name:t.pickerTitle+"",cause:r+""})},this.mojiSent=function(t,r){s.get().sendEvent(i.telemetry.chatTenantToken,n.telemetry.pes.eventName.MOJI_SENT,{moji_id:t.id+"",moji_name:t.pickerTitle+"",moji_source:r.type+"",moji_section:r.section+"",moji_tab_name:r.tabName+"",moji_tab_index:r.tabIndex+""})},this.imageSent=function(t,r){s.get().sendEvent(i.telemetry.chatTenantToken,n.telemetry.pes.eventName.IMAGE_SENT,{image_id:t.id+"",image_query:a(r.query)+"",image_picker_index:t.pickerIndex+"",image_source:r.type+"",image_section:r.section+"",image_tab_name:r.tabName+"",image_tab_index:r.tabIndex+"",image_result_type:a(t.querySource)+""})},this.expressionPickerOpened=function(){var t={};t.mediaBarV2Enabled=o.resolve(n.serviceLocator.FEATURE_FLAGS).isFeatureOn(n.featureFlags.MEDIA_BAR_V2_ENABLED),t.styleMode=u.get().currentMode(),s.get().sendEvent(i.telemetry.chatTenantToken,n.telemetry.pes.eventName.PICKER_OPENED,t)}}var t=e("lodash-compat"),n=e("swx-constants").COMMON,r=e("swx-utils-common").guid,i=e("experience/settings"),s=e("ui/telemetry/telemetryClient"),o=e("swx-service-locator-instance").default,u=e("utils/common/styleModeHelper");return new a}),define("ui/modelObservers/agentAuthorizationObserver",["require","exports","module","vendor/knockout","swx-cafe-application-instance","ui/modelHelpers/conversationHelper","ui/modelHelpers/personHelper"],function(e,t){function o(e){function o(){i.isOneToOneConversationWithAgent(e)&&r.get().personsAndGroupsManager.all.persons.changed(u)}function u(){var n=e.participants()[0].person,r=s.isKnownPerson(n);t.isConversationWithUnauthorizedAgent(!r)}var t=this;t.isConversationWithUnauthorizedAgent=n.observable(!1),t.dispose=function(){r.get().personsAndGroupsManager.all.persons.changed.off(u)},o()}var n=e("vendor/knockout"),r=e("swx-cafe-application-instance"),i=e("ui/modelHelpers/conversationHelper"),s=e("ui/modelHelpers/personHelper");t.build=function(e){return new o(e)}}),define("ui/viewModels/chat/chatInput",["require","lodash-compat","vendor/knockout","swx-pubsub-instance","utils/common/cafeObservable","swx-constants","swx-constants","utils/common/eventMixin","swx-constants","swx-service-locator-instance","telemetry/chat/pes","ui/modelObservers/agentAuthorizationObserver","utils/common/styleModeHelper","ui/modelHelpers/conversationHelper","ui/modelHelpers/personHelper"],function(e){function m(){function b(){return!!e.conversationModel}function w(e){var n=t.find(e.sourceTab.packs,function(t){return t.items.some(function(t){return t===e.item})}),r={type:e.sourceTab.id==="mru"?a.telemetry.pes.source.RECENTS:a.telemetry.pes.source.ROSTER,tabIndex:e.sourceTab._index||e.sourceTab.index,tabName:e.sourceTab.title,section:n&&n.isFeatured?a.telemetry.pes.section.FEATURED:a.telemetry.pes.section.REGULAR};l.mojiSent(e.item,r)}function E(e){var n=t.find(e.sourceTab.packs,function(t){return t.items.some(function(t){return t.id===e.item.id})}),r=t.findIndex(n.items,{id:e.item.id}),i={type:a.telemetry.pes.source.ROSTER,section:n&&n.id,query:e.sourceTab._currentQuery,tabName:e.sourceTab.id,tabIndex:e.sourceTab._index};l.mojiSent({id:e.item.id,type:e.item.type},i),l.imageSent({id:e.item.id,pickerIndex:r,querySource:e.item.querySource},i)}function S(t){u.isFeatureOn(a.featureFlags.GIPHY)&&(/^\/giphy\b/.test(t)?O("giphy"):O(null)),e.isSendDisabled(!t||t.length===0)}function x(t){if(!b()||t.conversation!==e.conversationModel)return;switch(t.item.type){case"flik":e.conversationModel.chatService.sendMessage("/moji "+t.item.mojiId),w(t);var n=f.resolve(a.serviceLocator.PES_MRU_SERVICE);n.addItemsToMru(t.item);break;case"image":t.query?e.conversationModel.chatService.sendMessage(t.item.url,null,{activityData:JSON.stringify({giphyExpression:t.query})}):e.conversationModel.chatService.sendMessage(t.item.url),E(t)}}function T(){if(u.isFeatureOn(a.featureFlags.SKIP_CHAT_CAPABILITY_CHECK)){e.hasChatCapability(!0);return}var t=!1,n,r=e.conversationModel.participants().length;for(var i=0;i<r&&!t;i++)t=e.conversationModel.participants()[i].person.capabilities.chat();n=r===0||t,e.hasChatCapability(n)}function N(){m&&(C(),T()),m=[],e.conversationModel.participants().forEach(function(e){var t=e.person,n=t.capabilities.chat.subscribe(),r={person:t,subscription:n};t.capabilities.chat.get(),t.capabilities.chat.changed(T),m.push(r)})}function C(){m&&(m.forEach(function(e){e.person.capabilities.chat.changed.off(T),e.subscription.dispose()}),m=undefined)}function k(){return e.isServiceEnabled()&&e.hasChatCapability()&&!g.isConversationWithUnauthorizedAgent()}function L(){return e.isServiceEnabled()&&!g.isConversationWithUnauthorizedAgent()&&(e.hasChatCapability()||A())}function A(){if(e.conversationModel&&!e.conversationModel.isGroupConversation()&&e.conversationModel.participants(0))return d.isPstn(e.conversationModel.participants(0).person)}function O(t){e.attribution(t),e.showTermsOfUse(!!t)}function M(){var t=[];return e.attribution()&&t.push(e.attribution()),e.isMediaBarV2Enabled()&&t.push("mediabarV2enabled"),e.shouldOptimizeAvailableSpace&&t.push("ChatInput--optimizeSpace"),t.join(" ")}function D(){return L()&&A()?(e.isPstnSmsOnly=!0,a.messageDestination.SMS_NETWORK):a.messageDestination.SKYPE_NETWORK}function P(){return u.isFeatureOn(a.featureFlags.SMS_SUPPORT_ENABLED)&&e.isServiceEnabled()&&!e.conversationModel.isGroupConversation()&&!p.isOneToOneConversationWithAgent(e.conversationModel)&&L()}function H(){return u.isFeatureOn(a.featureFlags.OPTIMIZE_SPACE_FOR_CC)}var e=this,u=f.resolve(a.serviceLocator.FEATURE_FLAGS),m,g,y;this.init=function(t,u){this.sendMessage=t.sendMessage,this.chatInputEl=u,this.attribution=n.observable(null),this.conversationModel=t.conversationModel,this.alwaysHideExpressionPicker=!!t.alwaysHideExpressionPicker,this.isServiceEnabled=b()?i.newObservableProperty(this.conversationModel.chatService.sendMessage.enabled):n.observable(!0),this.hasChatCapability=n.observable(!0),this.shouldOptimizeAvailableSpace=H(),b()&&this.conversationModel.participants.changed(N),g=c.build(t.conversationModel),this.isEnabled=n.computed(k),this.isChatAndSmsInputEnabled=n.computed(L),this.isPstnSmsOnly=!1,this.showTermsOfUse=n.observable(!1),this.isSendDisabled=n.observable(!0),this.isStyleModeWide=n.observable(h.get().currentMode()===v.WIDE),this.formHolderCssClasses=n.computed(M),this.forwardEvent(s.message.QUOTE,this.DIRECTION.CHILD),this.forwardEvent(s.message.EDIT,this.DIRECTION.CHILD),this.forwardEvent(s.message.COPY,this.DIRECTION.CHILD),this.forwardEvent(s.suggestionList.SHOWN,this.DIRECTION.CHILD),this.forwardEvent(s.suggestionList.HIDDEN,this.DIRECTION.CHILD),this.forwardEvent(s.suggestionList.ITEM_SELECTED,this.DIRECTION.CHILD),this.forwardEvent(o.EVENTS.CALL_SCREEN_CLOSE,this.DIRECTION.CHILD),this.forwardEvent(o.EVENTS.UNANSWERED_CALL_CLOSE,this.DIRECTION.CHILD),this.forwardEvent(s.navigation.FRAGMENT_SHOW,this.DIRECTION.CHILD),this.forwardEvent(s.emoticonPicker.EMOTICON_SELECTED,this.DIRECTION.CHILD),this.forwardEvent(s.emoticonPicker.CLOSE,this.DIRECTION.CHILD),this.registerEvent(s.textarea.CHANGED,S),this.registerEvent(s.textarea.SET_ATTRIBUTION,O),this.forwardEvent(s.textarea.MESSAGE_SENT,this.DIRECTION.PARENT),this.forwardEvent(s.textarea.UPDATE_SMS_FRAGMENTS,this.DIRECTION.CHILD),this.forwardEvent(s.textarea.UPDATE_SMS_DESTINATION,this.DIRECTION.CHILD),r.subscribe(s.expressionPicker.ITEM_SEND_REQUEST,x),this._parentContext&&(this.forwardEvent(s.textarea.INITIALIZATION_COMPLETE,this.DIRECTION.PARENT),this.dispatchEvent(s.chatInput.INITIALIZATION_COMPLETE,e,e.DIRECTION.PARENT)),y=h.get().currentMode.subscribe(function(t){e.isStyleModeWide(t===v.WIDE)}),this.destination=n.observable(D()),this.canSendSms=n.pureComputed(P)},this.sendButtonClicked=function(){e.dispatchEvent(s.textarea.SUBMIT_AND_FOCUS,null,e.DIRECTION.CHILD)},this.dispose=function(){b()&&(e.isEnabled.dispose(),e.isServiceEnabled.dispose(),C(),e.conversationModel.participants.changed.off(N)),y.dispose(),g.dispose(),r.unsubscribe(s.expressionPicker.ITEM_SEND_REQUEST,x)},this.isExpressionPickerButtonVisible=function(){return!e.alwaysHideExpressionPicker&&!u.isFeatureOn(a.featureFlags.HIDE_EMOTICON_PICKER_BUTTON)},this.isPESEnabled=function(){return b()},this.isMediaBarEnabled=function(){return u.isFeatureOn(a.featureFlags.MEDIA_BAR_ENABLED)},this.isMediaBarV2Enabled=function(){return u.isFeatureOn(a.featureFlags.MEDIA_BAR_ENABLED)&&u.isFeatureOn(a.featureFlags.MEDIA_BAR_V2_ENABLED)},this.isFooterMediaBarVisible=function(){return this.isMediaBarV2Enabled()&&!this.isStyleModeWide()}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-pubsub-instance").default,i=e("utils/common/cafeObservable"),s=e("swx-constants").COMMON.events,o=e("swx-constants").CALLING,u=e("utils/common/eventMixin"),a=e("swx-constants").COMMON,f=e("swx-service-locator-instance").default,l=e("telemetry/chat/pes"),c=e("ui/modelObservers/agentAuthorizationObserver"),h=e("utils/common/styleModeHelper"),p=e("ui/modelHelpers/conversationHelper"),d=e("ui/modelHelpers/personHelper"),v=a.styleMode;return t.assign(m.prototype,u),m}),define("text!views/chat/chatInput.html",[],function(){return'<div class="tc" data-bind="css: {showTermsOfUse: showTermsOfUse}">\r\n    <div class="form-holder" data-bind="css: formHolderCssClasses">\r\n            <!-- ko if: !shouldOptimizeAvailableSpace -->\r\n            <div class=\'smsInfoHolder\'>\r\n            <!-- ko if: canSendSms() -->                \r\n                <div class=\'messageDestinationHolder\'>\r\n                        <swx-message-destination-picker params="destination:destination, conversation:conversationModel, isPstnSmsOnly:isPstnSmsOnly"></swx-message-destination-picker>\r\n                </div>\r\n                <div class=\'smsPriceHolder\'>\r\n                    <swx-sms-price params="destination:destination, conversation: conversationModel"></swx-sms-price>\r\n                </div>\r\n            <!-- /ko -->                \r\n            </div>\r\n            <!-- /ko -->\r\n\r\n        <div class="upper-row-form">\r\n            <div class="form">\r\n                <form id="textarea-bindings">\r\n                    <swx-textarea params="conversationModel: conversationModel, isEnabled: isChatAndSmsInputEnabled, isServiceEnabled: isServiceEnabled, sendMessage: sendMessage, chatInputEl: chatInputEl, hasChatCapability: hasChatCapability, destination:destination, isPstnSmsOnly:isPstnSmsOnly"></swx-textarea>\r\n                </form>\r\n            </div>\r\n\r\n            <div class="buttonRow">\r\n                <!-- ko if: !isFooterMediaBarVisible() -->\r\n                <!-- ko if: isMediaBarEnabled() -->\r\n                <swx-chat-input-action-picker params="isDisabled: !isEnabled(), conversationModel: conversationModel,\r\n                    isCollapsible: true"></swx-chat-input-action-picker>\r\n                <!-- /ko -->\r\n                <!-- ko if: isExpressionPickerButtonVisible() -->\r\n                    <swx-expression-picker params="isDisabled: !isEnabled()" class="expressionPicker"></swx-expression-picker>\r\n                <!-- /ko -->\r\n                <!-- /ko -->\r\n                <div class="send-button-holder">\r\n                    <swx-button params="icon: \'send\', cssClass: \'swx-chat-input-send-btn circle send-button large\', disabled: isSendDisabled,\r\n                        titleKey: \'action_button_send\', textKey: \'action_button_send\', action: sendButtonClicked,\r\n                        ariaLabelKey: \'action_button_send\'"></swx-button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- ko if: isFooterMediaBarVisible() -->\r\n        <div class="button-row-footer">\r\n            <!-- ko if: isExpressionPickerButtonVisible() -->\r\n            <swx-expression-picker params="isDisabled: !isEnabled()" class="expressionPicker"></swx-expression-picker>\r\n            <!-- /ko -->\r\n            <!-- ko if: isMediaBarEnabled() -->\r\n            <swx-chat-input-action-picker params="isDisabled: !isEnabled(), conversationModel: conversationModel,\r\n                isCollapsible: false"></swx-chat-input-action-picker>\r\n            <!-- /ko -->\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n    <!-- ko if: showTermsOfUse -->\r\n    <div class="termsOfUse">\r\n        <a class="termsOfUseLink fontSize-p small" target="_blank" href="http://giphy.com/terms" data-bind="l10n: { \'key\': \'expressionPicker_giphyImgTab_terms\' }"></a>\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("ui/components/chat/chatInput",["require","exports","module","vendor/knockout","ui/viewModels/chat/chatInput","constants/components","text!views/chat/chatInput.html"],function(e,t){function i(e,t){var i=new r,s=n.dataFor(t.element);return i.init(e,t.element),i.setContext(s),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/chatInput");t.name=e("constants/components").chat.CHAT_INPUT,t.template=e("text!views/chat/chatInput.html"),t.viewModel={createViewModel:i}}),define("services/telemetry/common/analyticsInfo",["require","swx-cafe-application-instance","swx-constants","lodash-compat"],function(e){function o(e){return r.isString(e)&&/^19:/.test(e)}function u(){function u(e){return e&&e!==s}function a(e){return{thread1Count:e,thread30Count:e,conversation1Count:e,conversation30Count:e,unreadConversationsCount:e}}var e=function(e){var t=new Date;return e.setHours(0,0,0,0)===t.setHours(0,0,0,0)},r=function(n,r){var i=n.lastMessage,s=o(n.id);return i?(e(new Date(i.timestamp))&&(s?r.thread1Count++:r.conversation1Count++),s?r.thread30Count++:r.conversation30Count++,i.isUnread&&r.unreadConversationsCount++,r):r},i={};return i.conversationsInfo=function(){var e,n,i,o=a(0);if(t.get().conversationsManager&&t.get().conversationsManager._allConversations){i=t.get().conversationsManager._allConversations();for(e=0,n=i.length;e<n;e++)o=r(i[e],o)}else o=a(s);return o},i.contactsInfo=function(){return{totalContacts:t.get().personsAndGroupsManager.all.persons().length}},i.getPersonaId=function(){var e,t=i.contactsInfo().totalContacts,r=i.conversationsInfo(),s=u(r.thread30Count)||u(r.conversation30Count),o=t===0;return s?(e=r.thread30Count===0,e?n.telemetry.persona.CLASSIC_IM:n.telemetry.persona.POWER_IM):o?n.telemetry.persona.NEWBEE:n.telemetry.persona.RETURNING},i}var t=e("swx-cafe-application-instance"),n=e("swx-constants").COMMON,r=e("lodash-compat"),i,s=n.telemetry.NOT_AVAILABLE;return u.get=function(){return i||(i=new u),i},u}),define("telemetry/chat/conversationUpdateFlow",["require","swx-constants","experience/settings","services/telemetry/common/analyticsInfo","services/telemetry/common/telemetryContext","services/telemetry/skypeData","usertiming"],function(e){function p(){function a(){e.cta=t.telemetry.NOT_AVAILABLE,e.failedParticipants=t.telemetry.NOT_AVAILABLE,e.addedParticipantsCount=0,e.ttc=t.telemetry.NOT_AVAILABLE,e.tts=t.telemetry.NOT_AVAILABLE,e.conversationType=f.UNKNOWN,e.isSuccess=!0,e.isCompleted=!1,e.isStarted=!1}function p(){for(var e in r.CONVERSATION_UPDATE)r.CONVERSATION_UPDATE.hasOwnProperty(e)&&l.clearMarks(r.CONVERSATION_UPDATE[e]);for(var t in i.CONVERSATION_UPDATE)i.CONVERSATION_UPDATE.hasOwnProperty(t)&&l.clearMeasures(i.CONVERSATION_UPDATE[t])}function d(e,n,r){l.measure(e,n,r);var i=l.getEntriesByName(e);return i&&i.length>0?i[0]:t.telemetry.NOT_AVAILABLE}function v(){e.ttc=d(i.CONVERSATION_UPDATE.TTC,r.CONVERSATION_UPDATE.UPDATE_START,r.CONVERSATION_UPDATE.UPDATE_END),e.isCompleted&&(e.tts=d(i.CONVERSATION_UPDATE.TTS,r.CONVERSATION_UPDATE.UPDATE_END,r.CONVERSATION_UPDATE.SYNC_END))}function m(){l.mark(r.CONVERSATION_UPDATE.SYNC_END);try{v(),p()}catch(t){}var i={type:c,data:{stage:e.stage,cta:e.cta,contactsCount:e.contactsCount,originalParticipantCount:e.originalParticipantCount,addedParticipantsCount:e.addedParticipantsCount,conversationType:e.conversationType,failedParticipants:e.failedParticipants,ttc:e.ttc,tts:e.tts,ttr:"n/a",isSuccess:e.isSuccess}};u.push(i,n.telemetry.chatTenantToken),e.isStarted=!1}function g(t,n){e.stage=t,l.mark(r.CONVERSATION_UPDATE.UPDATE_END),n&&m()}var e=this;e.start=function(t,n){a(),e.isStarted=!0;var i=new s;e.originalParticipantCount=t,e.contactsCount=i.contactsInfo().totalContacts,e.conversationType=n?f.GROUP:f.DIALOG,l.mark(r.CONVERSATION_UPDATE.UPDATE_START)},e.abandoned=function(){var t;if(!e.isStarted||e.isCompleted)return;t=o.get(),e.cta=t.historyLoadOrigin,g(h.ABANDONED,!0)},e.cancelled=function(){g(h.CANCELLED,!0)},e.completed=function(t){e.addedParticipantsCount=t,e.isCompleted=!0,g(h.COMPLETED,!1)},e.performed=function(t){e.isSuccess=t>0,e.failedParticipants=t,m()},a()}var t=e("swx-constants").COMMON,n=e("experience/settings"),r=t.telemetry.performanceMarks,i=t.telemetry.measurements,s=e("services/telemetry/common/analyticsInfo"),o=e("services/telemetry/common/telemetryContext"),u=e("services/telemetry/skypeData"),a=t.telemetry.stages,f=t.telemetry.conversationType,l=e("usertiming"),c="chat_conversation_update",h=a.CONVERSATION_UPDATE;return p}),define("services/cqf/cqfSettings",["require","exports","module","services/ecs/configLoader","swx-enums","experience/settings"],function(e,t){function o(){function o(){if(!t||!s)s=n.loadConfig(r.ecsClientNames.Skype,i.ecsCqfKey);return s}function u(){return{minimumCallLength:i.cqf.minimumCallLengthSec*1e3,pstnCallPercentage:i.cqf.pstnCallPercentage,groupCallPercentage:i.cqf.groupCallPercentage,skypeCallPercentage:i.cqf.skypeCallPercentage}}function a(e){return{minimumCallLength:e.Configurations.CQF_Trigger.MinCallDurationSecs*1e3,pstnCallPercentage:e.Configurations.CQF_Trigger.PSTN_Percent,groupCallPercentage:e.Configurations.CQF_Trigger.GroupCall_Percent,skypeCallPercentage:e.Configurations.CQF_Trigger.S2S_Percent}}var e=this,t=!1,s;return e.get=function(){var e=new Promise(function(e){o().then(function(n){t=!0,e(a(n))}).catch(function(){t=!1,e(u())})});return e},e}var n=e("services/ecs/configLoader"),r=e("swx-enums"),i=e("experience/settings"),s;t.build=function(){return s||(s=new o),s}}),define("services/cqf/trigger",["require","exports","module","msr-crypto","services/cqf/cqfSettings"],function(e,t){var n=e("msr-crypto").aes,r=e("services/cqf/cqfSettings");t.validateCall=function(e){var t=r.build(),i;return i=new Promise(function(r,i){t.get().then(function(t){function s(e){return e.hasPSTN?t.pstnCallPercentage:e.isGroupConversation?t.groupCallPercentage:t.skypeCallPercentage}function o(e){var t=n.utilities.stringToBytes(e),r=n.sha256.computeHash(t),i=n.utilities.bytesToInt32(r);return i>>>0}if(!e.callId||e.callEscalated)i();else if(e.duration<t.minimumCallLength)i();else{var u=s(e),a=o(e.callId),f=a%100;f<u?r():i()}})}),i}}),define("services/cqf/CQFHandler",["require","exports","module","lodash-compat","swx-constants","ui/modelHelpers/conversationHelper","services/cqf/trigger","utils/common/disposableMixin","swx-enums","swx-service-locator-instance","browser/window"],function(e,t){function w(){var e=a.resolve(r.serviceLocator.FEATURE_FLAGS),t=e.isFeatureOn(r.featureFlags.CQF_ENABLED);return t}function E(){h=!0,l._dmDisposeAll()}function S(e){if(e.video.channels(0)){var t=e.video.channels(0).stream.state.once(u.mediaStreamState.Started,E);l.registerDisposable(t)}}var n=e("lodash-compat"),r=e("swx-constants").COMMON,i=e("ui/modelHelpers/conversationHelper"),s=e("services/cqf/trigger"),o=e("utils/common/disposableMixin"),u=e("swx-enums"),a=e("swx-service-locator-instance").default,f=e("browser/window"),l={},c,h=!1,p,d=!1,v,m,g,y,b;t.observe=function(e){if(!w())return;h=!1;var t=e.participants.added(S);l.registerDisposable(t);if(e.selfParticipant.video.channels(0)){var n=e.selfParticipant.video.channels(0).stream.state.once(u.mediaStreamState.Started,E);l.registerDisposable(n)}},t.updateCallData=function(e){if(!w())return;c=e.audioService.callId(),g=e._callData.nodeId(),y=e._callData.ngcEndpointId(),b=e._callData.ngcParticipantId(),p=e.audioService.callConnected()?f.Date.now()-e.audioService.callConnected():0,d=e.selfParticipant.audio.state.reason===u.callDisconnectionReason.CallEscalated,v=e.isGroupConversation(),m=i.isConversationWithPstn(e),d||l._dmDisposeAll()},t.setupCQF=function(){if(!w())return Promise.reject();var e=new Promise(function(e,t){var n={duration:p,callId:c,callEscalated:d,hasPSTN:m,isGroupConversation:v};s.validateCall(n).then(function(){e({isVideo:h,isPSTN:m,callId:c,nodeId:g,ngcEndpointId:y,ngcParticipantId:b})}).catch(t)});return e},n.extend(l,o)}),define("ui/calling/pstnEventsHandler",["require","exports","module","swx-enums","lodash-compat","ui/modelHelpers/personHelper"],function(e,t){function s(e){function u(e){e===n.callConnectionState.Disconnected?(o&&o.dispose(),t.participants().forEach(l)):e===n.callConnectionState.Connecting&&(o=t.participants.observe(a),t.participants().forEach(f))}function a(e,t){r.forIn(e,function(e){f(e)}),r.forIn(t,function(e){l(e)})}function f(n){function o(r){var i=n.audio.state.reason;e.process(t,n,i,r)}if(!c(n.audio.endpoint())&&!i.isPstn(n.person))return;var r=n.person.id();if(r in s)return;s[r]=o,n.audio.state.changed(o)}function l(e){var t,n;n=e.person.id(),n in s&&(t=s[n],e.audio.state.changed.off(t),delete s[n])}function c(e){return/^(\+)?\d+$/.test(e)}var t,s={},o;this.subscribeToConversation=function(e){t=e,t.selfParticipant.audio.state.changed(u)},this.dispose=function(){o&&o.dispose(),t.participants().forEach(l),s.length=0,t.selfParticipant.audio.state.changed.off(u)}}var n=e("swx-enums"),r=e("lodash-compat"),i=e("ui/modelHelpers/personHelper");t.build=function(e){return new s(e)}}),define("ui/calling/invalidNumberRedirector",["require","exports","module","swx-enums","swx-constants","constants/components","swx-service-locator-instance","browser/window"],function(e,t){function u(){function a(){t&&(o.clearTimeout(t),t=null,u.unsubscribe(r.events.navigation.NAVIGATE,a))}var e=5e3,t,u=s.resolve(r.serviceLocator.PUBSUB);this.process=function(s,f,l,c){if(c!==n.callConnectionState.Disconnected||l!==n.callDisconnectionReason.InvalidNumber)return;if(s.participants.size()>1)return;t||(u.subscribe(r.events.navigation.NAVIGATE,a),t=o.setTimeout(function(){u.publish(r.events.navigation.NAVIGATE,{page:i.calling.SKYPEOUT_PAGE,origin:r.telemetry.historyLoadOrigin.SKYPEOUT_PAGE})},e))},this.dispose=function(){a()}}var n=e("swx-enums"),r=e("swx-constants").COMMON,i=e("constants/components"),s=e("swx-service-locator-instance").default,o=e("browser/window");t.build=function(){return new u}}),define("ui/viewModels/chat/conversation",["require","lodash-compat","swx-enums","utils/common/eventMixin","swx-constants","utils/common/elementQueryHelper","vendor/knockout","telemetry/chat/conversationUpdateFlow","ui/modelHelpers/conversationHelper","swx-cafe-application-instance","swx-constants","constants/components","swx-browser-detect","swx-service-locator-instance","services/cqf/CQFHandler","ui/calling/unansweredCallHandler","ui/calling/pstnEventsHandler","ui/calling/invalidNumberRedirector","telemetry/chat/conversationJoined"],function(e){function b(e,r){function B(){return b.minimizeCallScreen(!1),window.shellApp?j():F().catch(j)}function j(){return d.setupCQF().then(function(e){b.callData=e,b.isCQFVisible(!0),b.isInCall(!1)}).catch(function(){b.isInCall(!1),R()})}function F(){return v.setup().then(function(e){b.unansweredCallPayload.reason(e.reason),b.unansweredCallPayload.wasVideoCall(e.wasVideoCall),b.unansweredCallPayload.ecsConfig(e.ecsConfig),b.isUnansweredCallVisible(!0)})}function I(){b.isUnansweredCallVisible(!1)}function q(){b.isCQFVisible(!1),R()}function R(){window.shellApp&&b.isConversationVisible()&&!b.isInCall()&&e.selfParticipant.audio.state.reason!==n.callDisconnectionReason.CallEscalated&&(window.shellAppInfo.supportsPreloading?(window.shellApp.invoke(i.SHELL_APP_METHODS.HIDE_WINDOW),U(!1)):window.shellApp.invoke(i.SHELL_APP_METHODS.CLOSE_WINDOW),window.shellAppInfo.hidePromiseResolve&&window.shellAppInfo.hidePromiseResolve())}function U(e){var t=document.querySelector("#contentWrapper");t&&(t.style.display=e?"block":"none")}function z(e,n){var r={successCriteria:e};w.publish(l.events.search.SESSION_SUCCESS,t.merge(r,n))}function W(){b.forwardEvent(l.events.navigation.FRAGMENT_SHOW,b.DIRECTION.CHILD,$),b.forwardEvent(l.events.navigation.FRAGMENT_BEFORE_HIDE,b.DIRECTION.CHILD,J),b.forwardEvent(l.events.navigation.FRAGMENT_HIDE,b.DIRECTION.CHILD),b.forwardEvent(l.events.message.QUOTE,b.DIRECTION.CHILD),b.forwardEvent(l.events.message.EDIT,b.DIRECTION.CHILD),b.forwardEvent(l.events.message.COPY,b.DIRECTION.CHILD),b.forwardEvent(l.events.conversation.OPEN_PROFILE,b.DIRECTION.CHILD),b.forwardEvent(l.events.conversation.VIEWPORT_CHANGED,b.DIRECTION.CHILD),b.forwardEvent(l.events.conversation.MESSAGES_LOADED,b.DIRECTION.CHILD),b.forwardEvent(i.EVENTS.CALL_SCREEN_CLOSE,b.DIRECTION.CHILD,B),b.forwardEvent(i.EVENTS.UNANSWERED_CALL_CLOSE,b.DIRECTION.CHILD,I),b.registerEvent(l.events.roster.EDIT_ROSTER_MODE,G),b.registerEvent(l.events.conversation.OVERLAY_CLOSED,Y),b.registerEvent(l.events.navigation.COMPONENT_RENDERED,K),b.registerEvent(i.EVENTS.CQF_SCREEN_CLOSE,q),b.registerEvent(l.events.callScreen.SHOW_CHAT,b.minimizeCallScreen.bind(b,!0)),b.registerEvent(l.events.callScreen.HIDE_CHAT,b.minimizeCallScreen.bind(b,!1));if(r===l.telemetry.historyLoadOrigin.CONTACT_SEARCH||r===l.telemetry.historyLoadOrigin.DIRECTORY_SEARCH)b.registerEvent(l.events.textarea.MESSAGE_SENT,t.partial(z,l.telemetry.contactsV2.searchSession.enums.success_criteria.IM_SENT)),b.registerEvent(l.events.message.ADD_CONTACT,t.partial(z,l.telemetry.contactsV2.searchSession.enums.success_criteria.CONTACT_ADDED)),b.registerEvent(l.events.actions.callMade,t.partial(z,l.telemetry.contactsV2.searchSession.enums.success_criteria.CALL_MADE));w.subscribe(l.events.shareControl.SHARE_CONTROL_SHOW,Z),w.subscribe(l.events.shareControl.SHARE_CONTROL_HIDE,et),P=v.newCallStartedInShellApp.subscribe(tt),H=v.previousCallEndedInShellApp.subscribe(nt),f.get().conversationsManager.conversations.removed(Q)}function X(){function t(){e._updateThreadPropertiesSubscription.remove(t),y.get().onConversationJoined({participantsCount:e.participantsCount()})}if(e.conversationId&&!y.get().isTriggeredFor(e.conversationId))return;if(!e._updateThreadPropertiesSubscription){y.get().onConversationJoined({participantsCount:e.participantsCount()});return}e._updateThreadPropertiesSubscription.add(t)}function V(){T=b.conversationModel.participants.subscribe()}function $(t){window.shellApp&&U(!0),b.isInCall()&&s.refresh(),b.isConversationVisible(!0),b.isInCall(a.isCallingActive(e)),b.isFullyOverlayed(b.showStartConversationOverlay()),N=e.acknowledge.enabled.when(!0,e.acknowledge),k=b.isInCall.subscribe(function(e){e&&(b.dispatchEvent(i.EVENTS.CQF_CANCEL,b.DIRECTION.CHILD),b.isCQFVisible(!1),b.isUnansweredCallVisible(!1))}),t&&t.model===b.conversationModel&&t.target&&t.target.expandProfile&&(b.dispatchEvent(l.events.conversation.OPEN_PROFILE,t.telemetryContext,b.DIRECTION.CHILD),M=!0,D=t.telemetryContext)}function J(){b.isUnansweredCallVisible(!1),b.isConversationVisible(!1),b.conversationUpdateFlow.abandoned(),A&&b.conversationModel.historyService._messagesWithUnseenHearts.size()>0&&b.conversationModel.historyService._messagesWithUnseenHearts.empty()}function K(e){e===c.chat.HEADER&&M&&b.dispatchEvent(l.events.conversation.OPEN_PROFILE,D,b.DIRECTION.CHILD)}function Q(t){if(t===e){var n={model:t,page:"swx-conversation"};w.publish(l.events.navigation.FRAGMENT_REMOVE,n)}}function G(e){b.isEditRosterMode(e.isActive),b.isEditing(e.isEditMode)}function Y(){b.isFullyOverlayed(!1)}function Z(e){e.conversationModel.conversationId===b.conversationModel.conversationId&&(b.shareControlPayload(e),b.isSelectingContacts(!0))}function et(){b.isSelectingContacts(!1)}function tt(e){e&&e.conversationId===b.conversationModel.conversationId&&b.isUnansweredCallVisible(!1)}function nt(e){e&&e.conversationId===b.conversationModel.conversationId&&F().catch(t.noop)}var b=this,w=p.resolve(l.serviceLocator.PUBSUB),E=p.resolve(l.serviceLocator.FEATURE_FLAGS),S=E.isFeatureOn(l.featureFlags.PSTN_ENABLED),x,T,N,C,k,L,A,O,M,D,P,H;b.init=function(){function t(e){return e.preventDefault(),e.stopPropagation(),h.getBrowserInfo().isIeEngine&&(e.returnValue=!1),!1}function n(e,t){var n=e.dataTransfer||e.originalEvent.dataTransfer;return Array.prototype.some.call(n.types,function(e){return e===t})}function r(e){return x&&n(e,"Files")&&b.conversationModel.fileTransferService.send.enabled()}function i(e,n){var r=e.dataTransfer||e.originalEvent.dataTransfer;return r&&(r.dropEffect=n?"copy":"none"),t(e)}x=E.isFeatureOn(l.featureFlags.FILE_DRAG_DROP_ENABLED),A=E.isFeatureOn(l.featureFlags.HEARTS_ENABLED),b.isSingleConversationMode=E.isFeatureOn(l.featureFlags.SINGLE_CONVERSATION_MODE),b.conversationModel=e,b.isEditRosterMode=o.observable(!1),b.isEditing=o.observable(!1),b.isFullyOverlayed=o.observable(!1),b.isSelectingContacts=o.observable(!1),b.showCover=o.pureComputed(function(){return!e.selfParticipant.isAnonymous()&&b.isEditRosterMode()||b.isSelectingContacts()}),b.isInCall=o.observable(!1),b.isUnansweredCallVisible=o.observable(!1),b.unansweredCallPayload={conversation:e,reason:o.observable(),wasVideoCall:o.observable(),ecsConfig:o.observable()},b.isCQFVisible=o.observable(!1),b.isConversationVisible=o.observable(!0),b.conversationUpdateFlow=new u,b.newConversationV2=o.observable(E.isFeatureOn(l.featureFlags.NEW_CONVERSATION_V2)),b.shareControlPayload=o.observable({}),b.isPollsFeatureEnabled=o.observable(!1),S&&!h.getBrowserInfo().isShellApp&&(O=g.build(),L=m.build(O),L.subscribeToConversation(e)),b.onDragEnter=function(e,t){var n=r(t);return n,i(t,n)},b.onDragOver=function(e,t){return i(t,r(t))},b.onDragLeave=function(){},b.onDrop=function(e,n){var i=[];if(r(n))return Array.prototype.forEach.call(n.dataTransfer.files,function(e){i.push(e)}),i.length&&b.conversationModel.fileTransferService.send(i),t(n)},b.markAsRead=function(){return b.dispatchEvent(l.events.conversation.MARK_AS_READ),!0},b.minimizeCallScreen=o.observable(!1),b.maximizeCallScreen=o.computed(function(){var e=E.isFeatureOn(l.featureFlags.CALLSCREEN_MINMAX);return e&&b.isInCall()&&!b.minimizeCallScreen()}),b.conversationModel.sendPollMessage&&(C=b.conversationModel.sendPollMessage.enabled.changed(function(e){b.isPollsFeatureEnabled(e)})),V(),W(),X()},b.dispose=function(){T.dispose(),b.maximizeCallScreen.dispose(),N&&N.dispose(),f.get().conversationsManager.conversations.removed.off(Q),b.conversationUpdateFlow=null,C&&C.dispose(),L&&(L.dispose(),O.dispose()),k&&k.dispose(),w.unsubscribe(l.events.shareControl.SHARE_CONTROL_SHOW,Z),w.unsubscribe(l.events.shareControl.SHARE_CONTROL_HIDE,et),H&&H.dispose(),P&&P.dispose()},b.coverHeader=o.pureComputed(function(){return!e.selfParticipant.isAnonymous()&&b.isFullyOverlayed()}),b.coverChatLogAndInput=o.pureComputed(function(){return!e.selfParticipant.isAnonymous()&&(b.isFullyOverlayed()||b.isEditRosterMode())}),b.showStartConversationOverlay=o.pureComputed(function(){var e=E.isFeatureOn(l.featureFlags.INVITE_FREE);return e&&!b.conversationModel.isGroupConversation()&&b.conversationModel.historyService.activityItems().length===0})}var t=e("lodash-compat"),n=e("swx-enums"),r=e("utils/common/eventMixin"),i=e("swx-constants").CALLING,s=e("utils/common/elementQueryHelper"),o=e("vendor/knockout"),u=e("telemetry/chat/conversationUpdateFlow"),a=e("ui/modelHelpers/conversationHelper"),f=e("swx-cafe-application-instance"),l=e("swx-constants").COMMON,c=e("constants/components"),h=e("swx-browser-detect").default,p=e("swx-service-locator-instance").default,d=e("services/cqf/CQFHandler"),v=e("ui/calling/unansweredCallHandler"),m=e("ui/calling/pstnEventsHandler"),g=e("ui/calling/invalidNumberRedirector"),y=e("telemetry/chat/conversationJoined");return t.assign(b.prototype,r),t.assign(b.prototype,{isInShellApp:function(){return h.getBrowserInfo().isShellApp}}),b}),define("text!views/chat/conversation.html",[],function(){return'<div class="conversationControl chat themeLight allowTextSelection"\r\n     data-bind="click: markAsRead,\r\n      css: { editRosterMode: isEditRosterMode, group: conversationModel.isGroupConversation(), isInCall: (isInCall() && !minimizeCallScreen()) || isCQFVisible(), inShellApp: isInShellApp() },\r\n      event: {dragenter: onDragEnter, dragover: onDragOver, dragleave: onDragLeave, drop: onDrop }">\r\n\r\n    <!-- ko ifnot: isInShellApp() -->\r\n        <!-- ko ifnot: isSingleConversationMode -->\r\n        <swx-header class="conversationHeader" params="conversationModel: conversationModel, conversationUpdateFlow: conversationUpdateFlow" data-bind="css: { active: isEditRosterMode, newConversationV2: newConversationV2, editMode: isEditing, showCover: coverHeader}"></swx-header>\r\n        <!-- /ko -->\r\n        <!-- ko if: isSingleConversationMode -->\r\n        <swx-header-single-conversation class="conversationHeader overrideMinHeight" params="conversationModel: conversationModel"></swx-header-single-conversation>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: isSelectingContacts -->\r\n        <swx-share-control params="payload:shareControlPayload"></swx-share-control>\r\n        <!-- /ko -->\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: isInCall -->\r\n    <swx-call-screen class="callScreen" data-bind="css: { \'callScreen--maximizeCallScreen\': maximizeCallScreen, \'callScreen--minimized\': minimizeCallScreen }" params="conversation: conversationModel"></swx-call-screen>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: isCQFVisible -->\r\n    <swx-cqf class="cqfScreen" params="callData: callData"></swx-cqf>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: isUnansweredCallVisible -->\r\n    <swx-unanswered-call class="unansweredCall" params="payload: unansweredCallPayload"></swx-unanswered-call>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko ifnot: isInShellApp() || isCQFVisible -->\r\n        <!-- ko if: isPollsFeatureEnabled -->\r\n        <swx-sticky-message params="conversationModel: conversationModel"></swx-sticky-message>\r\n        <!-- /ko -->\r\n        <swx-chat-log class="conversationHistory" data-bind="visible: !maximizeCallScreen(), css: { showCover: coverChatLogAndInput }" params="conversationModel: conversationModel"></swx-chat-log>\r\n        <label class="input swx-chat-input" data-bind="visible: !maximizeCallScreen(), component: {name:\'swx-chat-input\', params: {conversationModel: conversationModel}}, css: { showCover: coverChatLogAndInput, hide: isEditing }"></label>\r\n    <!-- /ko -->\r\n</div>\r\n<!-- ko if: showStartConversationOverlay -->\r\n<swx-start-conversation-overlay class="StartConversationOverlay" data-bind="css: { hide: !isFullyOverlayed() }" params="conversationModel: conversationModel"></swx-start-conversation-overlay>\r\n<!-- /ko -->\r\n'}),define("ui/components/chat/conversation",["require","exports","module","vendor/knockout","swx-constants","ui/viewModels/chat/conversation","constants/components","text!views/chat/conversation.html"],function(e,t){function s(e,t){var s=t.element,o=e.model,u=e.origin,a=n.dataFor(s),f;if(!o)return;return f=new i(o,u),f.setContext(a),f.init(),f.dispatchEvent(r.navigation.COMPONENT_RENDERED),f}var n=e("vendor/knockout"),r=e("swx-constants").COMMON.events,i=e("ui/viewModels/chat/conversation");t.name=e("constants/components").chat.CONVERSATION,t.template=e("text!views/chat/conversation.html"),t.viewModel={createViewModel:s}}),define("ui/viewModels/chat/groupSearch",["require","lodash-compat","vendor/knockout","utils/common/ko","swx-utils-common","swx-utils-common","swx-cafe-application-instance","swx-pubsub-instance","swx-constants","ui/telemetry/telemetryClient","experience/settings","swx-constants","ui/telemetry/actions/actionSources","swx-enums","ui/telemetry/people/contactSearch"],function(e){var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/ko"),i=e("swx-utils-common").array,s=e("swx-utils-common").stringUtils,o=e("swx-cafe-application-instance"),u=e("swx-pubsub-instance").default,a=e("swx-constants").COMMON,f=e("ui/telemetry/telemetryClient"),l=e("experience/settings"),c=e("swx-constants").COMMON.events.search,h=e("ui/telemetry/actions/actionSources"),p=e("swx-enums"),d=e("ui/telemetry/people/contactSearch");return function(v,m){function x(e){if(e)try{e.cancel("Another search triggered")}catch(t){f.get().sendEvent(l.telemetry.uiTenantToken,a.telemetry.promiseInvalidStateException.TYPE,{feature:a.telemetry.promiseInvalidStateException.feature.GROUP_SEARCH,exception:JSON.stringify(t)})}}function T(e){function r(){if(S!==n)return;S=null,y(b.results().map(function(e){return e.result}))}function i(e){if(e&&e.message==="Canceled")return;if(g.activeSearchPromise!==n)return;d.onContactSearchEnd({success:!1,searchScope:p.searchScope.Groups})}var t,n;if(!e){y([]);return}return x(S),t=s.removeNonWordCharacters(e).toLowerCase(),b=o.get().conversationsManager.createSearchQuery(),N("group",!0),N("topic",t),n=b.getMore(),n.then(r,i),S=n,n}function N(e,t){if(b.supportedKeywords().indexOf(e)<0)return;b.keywords[e]=t}function C(e){function n(e,n){var r=new v(m);r.init(n),r.groupSearchResults(E),i.insertAt(t,e,r)}var t=g.searchResults();r.handleArrayChanges(t,e,n),g.searchResults.valueHasMutated()}function k(e){var n=y(),r;if(!e||n.length===0)return;return r=t.findIndex(n,function(t){return t.conversationId===e.conversation.conversationId}),r!==-1?r+1:undefined}var g=this,y=n.observableArray(),b,w,E,S;y.subscribe(function(e){E=e.length,u.publish(c.GROUPS_SEARCH_RESULTS,E)}),this.searchResults=n.observableArray(),this.init=function(){u.subscribe(c.QUERY_CHANGED,T),w=y.subscribe(C,null,"arrayChange")},this.dispose=function(){u.unsubscribe(c.QUERY_CHANGED,T),w&&w.dispose()},this.openConversation=function(t){d.onContactSearchEnd({searchScope:p.searchScope.Groups,success:!0,resultCount:y().length,clickPosition:k.call(g,t),source:h.search.reset.openConversation})}}}),define("services/telemetry/logging/perf/usertimingTracer",["require","usertiming"],function(e){function n(e){if(typeof t.getEntriesByName!="function")return!1;var n=t.getEntriesByName(e);return n!==undefined&&n.length>0}var t=e("usertiming");return function(r){this.logger=r,this.startTrace=function(e){if(n(e))return;typeof t.mark=="function"&&t.mark(e)},this.stopTrace=function(e){if(!n(e))return;typeof t.measure=="function"&&(t.measure(e+"_measure",e),t.clearMarks(e))},this.dumpMeasurements=function(){if(typeof t.getEntriesByType!="function")return{};var e=t.getEntriesByType("measure")||{};return e.length===0?e:(this.logger.perf(e),typeof t.clearMeasures=="function"&&t.clearMeasures(),e)}}}),define("services/telemetry/logging/perf/dummyTracer",[],function(){return function(){this.startTrace=function(){},this.stopTrace=function(){},this.dumpMeasurements=function(){}}}),define("services/telemetry/logging/perf/environments",["require","services/telemetry/logging/perf/usertimingTracer","services/telemetry/logging/perf/dummyTracer"],function(e){var t=e("services/telemetry/logging/perf/usertimingTracer"),n=e("services/telemetry/logging/perf/dummyTracer"),r={live:t,mock:t,dev:t};return{fetch:function(e){return r[e]||n}}}),define("services/telemetry/logging/perf/main",["require","services/telemetry/logging/perf/environments"],function(e){function r(e){var n=e?e.environment:"default";return t.fetch(n)}var t=e("services/telemetry/logging/perf/environments"),n;return{getInstance:function(){return n||this.construct(),n},construct:function(e,t){var i=r(e);n=new i(t)},destroy:function(){n=undefined}}}),define("ui/viewModels/chat/recent",["require","lodash-compat","vendor/knockout","swx-i18n","swx-constants","swx-enums","swx-pubsub-instance","swx-service-locator-instance","services/telemetry/common/telemetryContext","services/telemetry/logging/perf/main","utils/common/cafeObservable","utils/common/ko","ui/contextMenu/contextMenu","ui/contextMenu/items/all","ui/contextMenu/menuItemHelper","ui/telemetry/actions/actionSources","ui/viewModels/calling/helpers/textFormatter","ui/viewModels/chat/conversationActivity","ui/viewModels/chat/conversationTile","ui/viewModels/chat/conversationTopic","utils/common/styleModeHelper"],function(e){var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-i18n").localization,i=e("swx-constants").COMMON,s=e("swx-enums"),o=e("swx-pubsub-instance").default,u=e("swx-service-locator-instance").default,a=e("services/telemetry/common/telemetryContext"),f=e("services/telemetry/logging/perf/main"),l=e("utils/common/cafeObservable"),c=e("utils/common/ko"),h=e("ui/contextMenu/contextMenu"),p=e("ui/contextMenu/items/all"),d=e("ui/contextMenu/menuItemHelper"),v=e("ui/telemetry/actions/actionSources"),m=e("ui/viewModels/calling/helpers/textFormatter"),g=e("ui/viewModels/chat/conversationActivity"),y=e("ui/viewModels/chat/conversationTile"),b=e("ui/viewModels/chat/conversationTopic"),w=e("utils/common/styleModeHelper"),E=i.events.navigation;return function(S){function R(){x.hasUnseenHearts(C.historyService._messagesWithUnseenHearts.size()>0)}function U(e,t){var n=!e;if(e&&t)return"accessibility_recentItem_group_unread";if(e)return"accessibility_recentItem_group";if(n&&t)return"accessibility_recentItem_oneToOne_unread";if(n)return"accessibility_recentItem_oneToOne"}function z(e){var t=50,n=e();return n>=t?t+"+":n===0?"":n}function W(){var e=A();return e?e.direction===s.direction.Outgoing:!1}function X(){return O.currentPlaceModel()===C}function V(){return x.unreadCount()===0&&(!x.unreadWithKeywordsCount||x.unreadWithKeywordsCount()===0)}function $(){var e=A(),t;if(!e)return;return e.model.type()===s.activityType.ContactRequestIsNowContact?r.fetch({key:"message_text_isNowAContact",params:{id:e.model.sender.id()}}):(t=e.content(),/<\/a>/i.test(t)&&(t=t.replace(/ onclick="[^"]+"/i,""),t=t.replace(/ title="[^"]+"/i,"")),t)}function J(){var e=k(),n=e[e.length-1],r;if(!n||t.isEmpty(n))return null;if(T&&n.key()===T.clientmessageid)return T;r=new S({noUrlPreview:!0,noTranslationItem:!0}),r.init(n,C),x.isLiveSession(r.group()===i.activityItemGroups.CALL),x.isInfoMessage(r.group()===i.activityItemGroups.CONTACT_REQUEST);if(x.isLiveSession.peek())x.callAction(r.callAction||""),L("live-session");else if(x.isInfoMessage.peek()){var s=r.model.type(),o=K(s);x.infoType(o),L("info")}else L("message");return T&&T.dispose(),T=r,r}function K(e){return e===s.activityType.ContactRequestIncoming?"contactAdd":e===s.activityType.ContactRequestIsNowContact?"contact":""}function Q(){var e,t=x.isRead();return e={message:t,"live-session":!1,"file-transfer":!1,info:!1,unknown:!1,contact:!1,media:!1},t||(e[L()]=!0),e.read=t,e.unread=!t,e.lightNotification=!x.notificationEnabled()&&(!x.unreadWithKeywordsCount||x.unreadWithKeywordsCount()===0),e.hide=x.isOnCall()||x.isBlocked()||x.canJoinCall(),e.active=x.isActive(),e.group=x.isGroupConversation(),e.unseenHeart=x.displayUnseenHeartsIcon(),e}function G(){var e=M.callDuration(),t=w.get().currentMode()===i.styleMode.NARROW;return e<0?"":m.getFormattedDuration(e,t)}var x=this,T,N,C,k,L,A,O,M,D,P=300,H=u.resolve(i.serviceLocator.FEATURE_FLAGS),B,j,F,I,q;x.init=function(t){C=t,M=g.build(t),D=b.build(t),L=n.observable("message"),N=y.build(C),O=u.resolve(i.serviceLocator.NAVIGATION_CONTEXT),B=H.isFeatureOn(i.featureFlags.HEARTS_ENABLED),j=H.isFeatureOn(i.featureFlags.HEARTS_NOTIFICATION_ENABLED),F=H.isFeatureOn(i.featureFlags.FAVORITES_CONVERSATION_ENABLED),I=H.isFeatureOn(i.featureFlags.MUTE_SPECIFIC_CONVERSATIONS_ENABLED),x.displayMessage=N.displayMessage,x.isBlocked=N.isBlocked,x.topic=D.topic,x.displayName=D.displayName,x.isPstn=N.isPstn,x.unreadCount=l.newObservableProperty(C.historyService.unreadActivityItemsCount),k=l.newObservableCollection(C.historyService.activityItems),x.isLiveSession=n.observable(!1),x.callAction=n.observable(""),x.isOnCall=M.isOnCall,x.canJoinCall=M.canJoinCall,x.isFavorited=C._isFavorited?l.newObservableProperty(C._isFavorited):n.observable(!1),x.isInfoMessage=n.observable(!1),x.infoType=n.observable(""),x.isGroupConversation=l.newObservableProperty(C.isGroupConversation),x.avatarUrl=l.newObservableProperty(C.avatarUrl,{keepAlive:!0}),x.timestamp=l.newObservableProperty(C.lastModificationTimestamp),x.statusClassName=N.statusClassName,x.groupSearchResults=n.observable(0),x.ariaRole=n.computed(function(){return w.get().isIntegratedProperty()?"presentation":"menuitem"}),x.conversation=C,x.isAgent=N.isAgent,x.isCertifiedAgent=N.isCertifiedAgent,x.isPstn=N.isPstn,x.unreadActivityItemsCount=n.computed(z.bind(null,x.unreadCount)),C.historyService._unreadActivityItemsWithKeywordsCount?(x.unreadWithKeywordsCount=l.newObservableProperty(C.historyService._unreadActivityItemsWithKeywordsCount),x.unreadActivityItemsWithKeywordsCount=n.computed(z.bind(null,x.unreadWithKeywordsCount))):x.unreadActivityItemsWithKeywordsCount=n.observable(!1),x.notificationEnabled=n.observable(!0),x.displayNotificationsDisabledIndicator=n.computed(function(){return I&&!x.notificationEnabled()}),A=n.computed(J),x.lastMessageIsOutgoing=n.computed(W),x.content=n.computed($),x.isActive=n.computed(X),x.isRead=n.computed(V).extend({rateLimit:P}),x.hasUnseenHearts=n.observable(!1),x.displayUnseenHeartsIcon=n.computed(function(){return j&&x.hasUnseenHearts()&&!x.isActive()}),B&&j&&C.historyService._messagesWithUnseenHearts.changed(R),x.cssClass=n.computed(Q),x.callDuration=n.computed(G),C._notificationsEnabled&&(q=C._notificationsEnabled.changed(function(e){x.notificationEnabled(e)}))},x.dispose=function(){x.unreadActivityItemsCount.dispose(),A.dispose(),x.lastMessageIsOutgoing.dispose(),x.content.dispose(),x.isActive.dispose(),x.isRead.dispose(),x.cssClass.dispose(),D.dispose(),N.dispose(),T&&(T.dispose(),T=null),M.dispose(),B&&j&&C.historyService._messagesWithUnseenHearts.changed.off(R),x.displayUnseenHeartsIcon.dispose(),q&&q.dispose(),x.unreadActivityItemsWithKeywordsCount&&x.unreadActivityItemsWithKeywordsCount.dispose&&x.unreadActivityItemsWithKeywordsCount.dispose()},x.showContextMenu=function(e,n){function u(){if(!F)return;x.isFavorited()?x.isGroupConversation()?s.push(new p.RemoveGroupConversationFromFavoritesMenuItem(C,v.recentItem)):s.push(new p.RemoveContactFromFavoritesMenuItem(C.participants(0).person,v.recentItem)):x.isGroupConversation()?s.push(new p.AddGroupConversationToFavoritesMenuItem(C,v.recentItem)):s.push(new p.AddContactToFavoritesMenuItem(C.participants(0).person,v.recentItem))}function a(e){var t={source:v.contextMenuItem.block,parent:v.recentItem},i={source:v.contextMenuItem.deleteItem,parent:v.recentItem};s.push(d.getConversationContextMenuItemGroup(e,r,o)),s.push(new p.BlockContactMenuItem(e,t)),s.push(new p.DeleteContactMenuItem(e,i)),d.sortMenuItems(s),h.show(s,n,o,!0)}if(x.isOnCall())return;var r=i.telemetry.historyLoadOrigin.TIMELINE_CLICK,s=[new p.LeaveConversationMenuItem(C),new p.RemoveConversationMenuItem(C),new p.MuteConversationMenuItem(C),new p.UnmuteConversationMenuItem(C),new p.MarkConversationAsReadMenuItem(C),new p.MarkAllConversationsAsReadMenuItem(C)],o={source:v.recentItem,isGroupConversation:!1};u(),x.isGroupConversation()?(o.isGroupConversation=!0,h.show(s,n,o,!0)):c.once(N.contact,t.isObject,a)},x.handleClick=function(t,n){var r=i.telemetry.historyLoadOrigin.TIMELINE_CLICK;f.getInstance().startTrace("navigateConversation"),n.preventDefault();if(!t.model.isActive()){var s=a.get();s.timelineInSearchMode&&(r=i.telemetry.historyLoadOrigin.GROUP_SEARCH)}o.publish(E.OPEN_CONVERSATION,{model:C,origin:r})},x.ariaLabel=n.pureComputed(function(){var e,t,n;return e=x.unreadCount()>0,t=U(x.isGroupConversation(),e),n=x.displayNotificationsDisabledIndicator()?r.fetch({key:"accessibility_recentItem_conversation_muted"}):"",r.fetch({key:t,count:x.unreadCount(),params:{topic:x.topic(),muted:n}})}),x.getSearchItemDetails=function(e){var t="";return x.isGroupConversation()?(x.displayMessage()?t=r.fetch({key:"accessibility_searchItem_group_displayMessage",params:{groupName:x.topic(),displayMessage:x.displayMessage(),index:e+1,totalResults:x.groupSearchResults()}}):t=r.fetch({key:"accessibility_searchItem_group",params:{groupName:x.topic(),index:e+1,totalResults:x.groupSearchResults()}}),t):t}}}),define("text!views/chat/groupSearch.html",[],function(){return'<!-- ko if: searchResults().length > 0 -->\r\n<ul class="groups" role="menubar" data-bind="foreach: { data: searchResults }, keyboardNavigation: { itemSelector: \'a.group\', persistSelection: false }">\r\n    <!-- ko if: $index() === 0 -->\r\n    <li class="separator">\r\n        <p class="strong" data-bind="l10n: {key: \'message_text_groupSearchResultsTitle\'}"></p>\r\n    </li>\r\n    <!-- /ko -->\r\n\r\n    <swx-recent-item params="model: $data, dispose: $data.dispose" class="list-selectable" data-bind="attr: { \'data-title\': $data.getSearchItemDetails($index()) }, event: { click: $parent.openConversation }, enterKey: $parent.openConversation"></swx-recent-item>\r\n</ul>\r\n<!-- /ko -->\r\n'}),define("ui/components/chat/groupSearch",["require","exports","module","ui/viewModels/chat/groupSearch","ui/viewModels/chat/message","ui/viewModels/chat/recent","constants/components","text!views/chat/groupSearch.html"],function(e,t){function s(){var e=new n(i,r);return e.init(),e}var n=e("ui/viewModels/chat/groupSearch"),r=e("ui/viewModels/chat/message"),i=e("ui/viewModels/chat/recent");t.name=e("constants/components").chat.GROUP_SEARCH,t.template=e("text!views/chat/groupSearch.html"),t.viewModel={createViewModel:s}}),define("ui/viewModels/chat/messagesSearch",["require","vendor/knockout","swx-i18n","swx-pubsub-instance","swx-constants","swx-service-locator-instance","swx-cafe-application-instance","swx-constants"],function(e){var t=e("vendor/knockout"),n=e("swx-i18n").localization,r=e("swx-pubsub-instance").default,i=e("swx-constants").COMMON,s=e("swx-service-locator-instance").default,o=e("swx-cafe-application-instance"),u=e("swx-constants").COMMON.events.search;return function(a){function m(e){var t;if(!v)return;y(),f.hasAdditionalResults(!1);if(!e||e.length<h)return;t=e.replace(/[^\w\s]/g,"").trim().toLowerCase(),l=t,o.get()._messagesSearchService.query(t,20).then(function(n){if(l!==t)return;y(),f.hasAdditionalResults(!1);var r=0;n.forEach(function(e){var t,n=g(e);if(!n)return;t=new a,t.init(e,n),r++<c?f.searchResults.push(t):(p.push(t),f.hasAdditionalResults(!0))})})}function g(e){return o.get().conversationsManager._getConversation(e.ConversationId)}function y(){p.forEach(function(e){e.dispose()}),p=[],f.searchResults().forEach(function(e){e.dispose()}),f.searchResults.removeAll()}var f=this,l,c=5,h=4,p=[],d=s.resolve(i.serviceLocator.FEATURE_FLAGS),v=d.isFeatureOn(i.featureFlags.CONTENT_SEARCH);this.searchResults=t.observableArray(),this.title=n.fetch({key:"content_search_header"}),this.displayAdditionResults=function(){p.forEach(function(e){f.searchResults.push(e)}),p=[],f.hasAdditionalResults(!1)},this.hasAdditionalResults=t.observable(!1),this.additionalResultsTitle=n.fetch({key:"content_search_additional_results"}),this.init=function(){if(!v)return;r.subscribe(u.QUERY_CHANGED,m)},this.dispose=function(){r.unsubscribe(u.QUERY_CHANGED,m),y()}}}),define("ui/viewModels/chat/messageSearchItem",["require","lodash-compat","vendor/knockout","swx-i18n","swx-constants","swx-utils-chat","swx-utils-chat","swx-cafe-application-instance","swx-pubsub-instance","services/telemetry/logging/perf/main","ui/viewModels/chat/conversationTile","ui/modelHelpers/personHelper","swx-enums"],function(e){var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-i18n").localization,i=e("swx-constants").COMMON,s=e("swx-utils-chat").messageSanitizer,o=e("swx-utils-chat").dateTime,u=e("swx-cafe-application-instance"),a=e("swx-pubsub-instance").default,f=e("services/telemetry/logging/perf/main"),l=e("ui/viewModels/chat/conversationTile"),c=e("ui/modelHelpers/personHelper"),h=e("swx-enums"),p=i.events.navigation;return function(){function g(e){function s(){return u.get().personsAndGroupsManager.mePerson.id()===i?(n=u.get().personsAndGroupsManager.mePerson,d.avatarUrl(n.avatarUrl()),d.userName(n.displayName()),!0):!1}function o(){var e=m.participants(),r=t.findIndex(e,function(e){return e.person.id()===i});return r!==-1?(n=e[r].person,d.avatarUrl(n.avatarUrl()),d.userName(n.displayName()),!0):!1}var n,r,i=c.getId(e.From);if(s()||o())return;r=u.get().personsAndGroupsManager.createPersonSearchQuery(),r.sources(h.searchScope.All),r.text("id:"+i),r.getMore().then(function(){var e=r.results();n=e[0].result,d.avatarUrl(n.avatarUrl()),d.userName(n.displayName())})}function y(e,t){var n={key:"content_search_conversation_title",params:{conversationTitle:s.escapeIncomingHTML(t)}},r=new Date(e);return o.getTimeSinceTimestamp(r,n)}var d=this,v,m;d.init=function(t,r){m=r,v=l.build(m),d.displayMessage=t.Content,d.messageId=t.ClientMessageId,d.isGroupConversation=!1,d.conversation=y(t.CreationDate,m.topic()),d.userName=n.observable(""),d.avatarUrl=n.observable(""),g(t),d.statusClassName=v.statusClassName,d.isAgent=v.isAgent,d.isActive=!1},d.dispose=function(){v.dispose()},d.handleClick=function(t,n){var r=i.telemetry.historyLoadOrigin.TIMELINE_CLICK;f.getInstance().startTrace("navigateConversation"),n.preventDefault(),a.publish(p.OPEN_CONVERSATION,{model:m,messageId:t.messageId+"",origin:r})},d.ariaLabel=n.pureComputed(function(){var e="content_search_aria";return r.fetch({key:e,count:0,params:{topic:m.topic()}})})}}),define("text!views/chat/messagesList.html",[],function(){return'<!-- ko if: searchResults().length > 0 -->\r\n<ul class="groups" data-bind="foreach: { data: searchResults }">\r\n    <!-- ko if: $index() === 0 -->\r\n    <li class="separator">\r\n        <p class="strong" data-bind="html: $parent.title" />\r\n    </li>\r\n    <!-- /ko -->\r\n\r\n    <li class="list-selectable">\r\n        <a role="button" data-bind="event: { click: handleClick }, attr: {\'aria-label\':ariaLabel }" class="recent unread">\r\n\r\n            <swx-avatar-deprecated params="isGroupAvatar: isGroupConversation, isAgent: isAgent, avatar: avatarUrl, displayName: topic" class="avatar"></swx-avatar-deprecated>\r\n\r\n            <div class="text">\r\n                <span class="arrow"></span>\r\n                <span class="tile">\r\n                    <span class="tileName">\r\n                        <h4>\r\n                            <span class="topic" data-bind="text: userName, attr: {title: userName}"></span>\r\n                        </h4>\r\n                    </span>\r\n                </span>\r\n\r\n                <div class="message">\r\n                    <p data-bind="html: displayMessage" class="small"></p>\r\n                </div>\r\n                <div class="message">\r\n                    <p class="small"><span data-bind="html: conversation" /></p>\r\n                </div>\r\n            </div>\r\n        </a>\r\n    </li>\r\n</ul>\r\n<!-- ko if: hasAdditionalResults --> \r\n<div class="additionalResults fontSize-p">\r\n    <span>\r\n        <a role="button" data-bind="event: {click: displayAdditionResults}, attr: {\'aria-label\':additionalResultsTitle}"><span data-bind="text: additionalResultsTitle"></span></a>\r\n    </span>\r\n</div>\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n'}),define("ui/components/chat/messagesSearch",["require","exports","module","ui/viewModels/chat/messagesSearch","ui/viewModels/chat/messageSearchItem","constants/components","text!views/chat/messagesList.html"],function(e,t){function i(){var e=new n(r);return e.init(),e}var n=e("ui/viewModels/chat/messagesSearch"),r=e("ui/viewModels/chat/messageSearchItem");t.name=e("constants/components").chat.MESSAGES_SEARCH,t.template=e("text!views/chat/messagesList.html"),t.viewModel={createViewModel:i}}),define("utils/common/location",[],function(){return{setHref:function(e){window.location.href=e}}}),define("ui/viewModels/chat/inviteLink",["require","exports","module","lodash-compat","vendor/knockout","browser/dom","browser/window","swx-utils-chat","swx-constants","utils/common/eventMixin","utils/common/cafeObservable","utils/common/location","swx-constants","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","swx-service-locator-instance","swx-i18n"],function(e,t){function g(e,t){function E(){return n._parentContext.constructor.name}function S(t){var n=e.telemetryContext?e.telemetryContext:{source:p.invitesShareButtons.groupInformationPanel};w.recordAction(t,n)}function x(e){var t=document.createRange();t.selectNodeContents(e);var n=s.getSelection();n.removeAllRanges(),n.addRange(t)}var n=this,a=e.topic,g=e.uri,y=i.getElement(".copyArea",t.element),b=i.getElement("p.link",t.element),w=d.resolve(c.serviceLocator.ACTION_TELEMETRY);n.init=function(){var t,i=function(){n.showCopiedIndicator(!1)};n.copyActive=r.observable(!1),n.topic=f.newObservableProperty(a),n.uri=f.newObservableProperty(g),n.showCopiedIndicator=r.observable(!1),n.copiedIndicatorText="",n.tabIndex=e.isMessageContent?-1:0,n.copy=function(){n.copyActive(!0),y.select(),S(h.invites.copyButton);try{var e=document.execCommand("copy");n.copyActive(!1),n.copiedIndicatorText=e?v.fetch({key:"header_text_copied"}):v.fetch({key:"header_text_cant_copy"}),n.showCopiedIndicator(!0),t&&s.clearTimeout(t),t=s.setTimeout(i,m),e||x(b)}catch(r){}n.dispatchEvent(u.conversation.COPY_LINK,{parent:E()},n.DIRECTION.PARENT)},n.send=function(){n.dispatchEvent(u.conversation.EMAIL_LINK,{parent:E()},n.DIRECTION.PARENT),S(h.invites.mailButton),l.setHref(n.mailtoLink())},n.cancel=function(){n.copyActive(!1)},n.mailtoLink=r.computed(function(){return o.createMailtoLink(n.topic(),n.uri())})},n.dispose=function(){n.mailtoLink.dispose()}}var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("browser/dom"),s=e("browser/window"),o=e("swx-utils-chat").spaceMail,u=e("swx-constants").COMMON.events,a=e("utils/common/eventMixin"),f=e("utils/common/cafeObservable"),l=e("utils/common/location"),c=e("swx-constants").COMMON,h=e("ui/telemetry/actions/actionNames"),p=e("ui/telemetry/actions/actionSources"),d=e("swx-service-locator-instance").default,v=e("swx-i18n").localization,m=3e3;n.assign(g.prototype,a),t.classFunction=g,t.build=function(e,t){return new g(e,t)}}),define("text!views/chat/inviteLink.html",[],function(){return'<div class="inviteLink" data-bind="css: { active: copyActive }">\r\n    <!-- ko ifnot: uri -->\r\n    <swx-loading-animation class="spinner small blue"></swx-loading-animation>\r\n    <!-- /ko -->\r\n    <!-- ko if: uri -->\r\n    <p class="link fontSize-p"><span data-bind="text: uri"></span></p>\r\n    <!-- /ko -->\r\n    <input class="copyArea fontSize-p" data-bind="value: uri" readonly />\r\n    <div class="menu fontSize-p small">\r\n        <div class="copyWrapper">\r\n            <a href="#" role="button" class="copy" data-bind="css: {copyHidden: showCopiedIndicator}, click: copy, attr: { tabindex: tabIndex }">\r\n                <span class="iconfont link" data-bind="l10n: {key: \'header_text_copyLink\'}"></span>\r\n            </a>\r\n            <!-- ko if: showCopiedIndicator -->\r\n            <div class="copiedIndicator" data-bind="css: {copiedIndicatorFadeIn: showCopiedIndicator}"><span class="iconfont link" data-bind="l10n: {key: \'header_text_copied\'}"></span></div>\r\n            <!-- /ko -->\r\n        </div>\r\n        <a href="#" role="button" class="email" data-bind="click: send, attr: { tabindex: tabIndex }">\r\n            <span class="iconfont email" data-bind="l10n: {key: \'header_text_inviteViaEmail\'}"></span>\r\n        </a>\r\n        <a role="button" class="cancel" data-bind="click: cancel, l10n: {key: \'action_button_cancel\'}"></a>\r\n    </div>\r\n </div>\r\n'}),define("ui/components/chat/inviteLink",["require","exports","module","vendor/knockout","ui/viewModels/chat/inviteLink","constants/components","text!views/chat/inviteLink.html"],function(e,t){function i(e,t){var i=r.build(e,t),s=n.dataFor(t.element);return i.setContext(s),i.init(),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/inviteLink");t.name=e("constants/components").chat.INVITE_LINK,t.template=e("text!views/chat/inviteLink.html"),t.viewModel={createViewModel:i}}),define("telemetry/chat/newConversationFlow",["require","swx-constants","experience/settings","services/telemetry/skypeData","services/telemetry/common/telemetryContext","services/telemetry/common/analyticsInfo","usertiming"],function(e){function l(){function h(){for(var e in r.NEW_CONVERSATION)r.NEW_CONVERSATION.hasOwnProperty(e)&&f.clearMarks(r.NEW_CONVERSATION[e]);for(var t in s.NEW_CONVERSATION)s.NEW_CONVERSATION.hasOwnProperty(t)&&f.clearMeasures(s.NEW_CONVERSATION[t])}function p(){try{var e=f.getEntriesByName(r.NEW_CONVERSATION.CREATION_END_OK).length>0;if(e){c=!0,f.measure(s.NEW_CONVERSATION.TTS,r.NEW_CONVERSATION.CREATION_START,r.NEW_CONVERSATION.CREATION_END_OK);return}c=!1,f.measure(s.NEW_CONVERSATION.TTS,r.NEW_CONVERSATION.CREATION_START,r.NEW_CONVERSATION.CREATION_END_ERROR)}catch(t){}}var e=i.STARTED,l=0,c=t.telemetry.NOT_AVAILABLE;this.participantsCountUpdated=function(e){l=e},this.publish=function(){function x(){try{f.mark(r.NEW_CONVERSATION.RENDER_END),f.measure(s.NEW_CONVERSATION.TTC,r.NEW_CONVERSATION.FLOW_START,r.NEW_CONVERSATION.RENDER_END),f.measure(s.NEW_CONVERSATION.TTR,r.NEW_CONVERSATION.CREATION_START,r.NEW_CONVERSATION.RENDER_END);var e=f.getEntriesByName(s.NEW_CONVERSATION.TTC),t=f.getEntriesByName(s.NEW_CONVERSATION.TTR);e&&e.length>0&&(g=e[0].duration),t&&t.length>0&&(b=t[0].duration)}catch(n){}}var d=u.get(),v=a.get(),m=v.contactsInfo(),g=t.telemetry.NOT_AVAILABLE,y=t.telemetry.NOT_AVAILABLE,b=t.telemetry.NOT_AVAILABLE,w=[t.telemetry.historyLoadOrigin.NEW_CHAT_OPEN_EXISTING,t.telemetry.historyLoadOrigin.CALLING],E=w.indexOf(d.historyLoadOrigin)>-1,S=d.historyLoadOrigin===t.telemetry.historyLoadOrigin.NEW_CHAT_CREATION;if(E)e=i.REDIRECTED,x();else if(S){e=i.CREATED,x(),p(),y=t.telemetry.NOT_AVAILABLE;var T=f.getEntriesByName(s.NEW_CONVERSATION.TTS);T&&T.length&&(y=T[0].duration)}else e=i.ABANDONED;var N={type:"chat_conversation_new",data:{stage:e,contactsCount:m.totalContacts,participantsCount:l,CTA:d.historyLoadOrigin,TTC:g,TTS:y,TTR:b,success:c}};h(),o.push(N,n.telemetry.chatTenantToken)}}var t=e("swx-constants").COMMON,n=e("experience/settings"),r=t.telemetry.performanceMarks,i=t.telemetry.stages.NEW_CONVERSATION,s=t.telemetry.measurements,o=e("services/telemetry/skypeData"),u=e("services/telemetry/common/telemetryContext"),a=e("services/telemetry/common/analyticsInfo"),f=e("usertiming");return l}),define("ui/viewModels/chat/headerNewConversation",["require","lodash-compat","vendor/knockout","utils/common/eventMixin","swx-i18n","ui/modelHelpers/conversationHelper","swx-service-locator-instance","swx-constants","swx-constants","utils/common/eventHelper","ui/telemetry/actions/actionSources"],function(e){function h(e,t){function g(){d(r.selectedContacts().length),t.participantsCountUpdated(d())}var r=e.participantsProvider,h,p=this,d=n.observable(0),v=o.resolve(u.serviceLocator.FEATURE_FLAGS),m;e.conversationModel?p.conversationModel=e.conversationModel:p.conversationModel={isGroupConversation:n.observable(!0),topic:n.observable("DEFAULT_TOPIC"),participants:n.observableArray(),participantsCount:n.observable(0)},p.spacesEnabled=v.isFeatureOn(u.featureFlags.SPACES),p.telemetryContext={source:l.invitesShareButtons.newConversation},p.newConversationV2=n.observable(v.isFeatureOn(u.featureFlags.NEW_CONVERSATION_V2)),p.showMoreActions=function(){return v.isFeatureOn(u.featureFlags.SCHEDULE_CALL_FROM_CONVERSATION)&&!s.isOneToOneConversationWithAgent(p.conversationModel)&&!s.isOneToOneConversationWithEcho(p.conversationModel)},m=n.observable(p.spacesEnabled),p.participantCount=n.pureComputed(function(){var e=d();return v.isFeatureOn(u.featureFlags.INCLUDE_SELF_IN_PARTICIPANTS_COUNT)&&(e+=1),i.fetch({key:"label_text_participant",count:e})}),p.confirmButtonDisabled=n.pureComputed(function(){return d()===0&&!m()}),p.topic=n.pureComputed(function(){return p.newConversationV2()?i.fetch({key:"conversation_header_topic_untitled_conversation"}):m()?s.createSpaceTopic():i.fetch({key:"conversation_header_topic_untitled_conversation"})}),p.setParticipantProvider=function(t){e.setParticipantProvider(t),r=t,h=r.selectedContacts.subscribe(g)},p.confirm=function(){p.dispatchEvent(c.newConversation.CONFIRMED,m()),m(p.spacesEnabled),t.publish()},p.cancel=function(){p.dispatchEvent(c.newConversation.CANCELLED),m(p.spacesEnabled)},p.forwardEvent(c.roster.ROSTER_QUERY_CHANGED),p.forwardEvent(c.roster.ROSTER_QUERY_EXECUTED),p.forwardEvent(c.roster.ROSTER_SELECTION_REMOVED),p.forwardEvent(c.roster.PICKER_CONTACT_SELECTED),p.forwardEvent(c.roster.PICKER_CONTACT_DESELECTED),p.forwardEvent(c.conversation.SHARED),p.registerEvent(c.conversation.JOINING_ENABLED,m),p.dispose=function(){h&&h.dispose()},p.handleKeyDown=function(e,t){var n=f.getKeyCode(t);return n===a.ESCAPE&&(e.cancel(),t.stopPropagation()),!0}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/eventMixin"),i=e("swx-i18n").localization,s=e("ui/modelHelpers/conversationHelper"),o=e("swx-service-locator-instance").default,u=e("swx-constants").COMMON,a=e("swx-constants").KEYS,f=e("utils/common/eventHelper"),l=e("ui/telemetry/actions/actionSources"),c=u.events;return t.assign(h.prototype,r),h}),define("text!views/chat/headerNewConversation.html",[],function(){return'<div class="headerMain">\r\n    <div class="roster">\r\n        <div class="grid">\r\n            <span class="tile conversationTopic">\r\n                <span class="tileText">\r\n                    <span class="tileName square">\r\n                        <h3 data-bind="html: topic"></h3>\r\n                    </span>\r\n                    <span class="tileMessage">\r\n                        <div class="message">\r\n                            <a class="participantCount">\r\n                                 <p data-bind="text: participantCount"></p>\r\n                            </a>\r\n                        </div>\r\n                    </span>\r\n                </span>\r\n            </span>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<div class="contactPickerWrapper" data-bind="event: { keydown: handleKeyDown }">\r\n    <div class="headerAdd">\r\n        <swx-contact-picker-input params="setParticipantProvider: setParticipantProvider"></swx-contact-picker-input>\r\n    </div>\r\n\r\n    <swx-contact-picker params="conversation: conversationModel, className: \'headerPicker\', showJumpToConversation: true"></swx-contact-picker>\r\n    <!-- ko if: !newConversationV2() -->\r\n        <!-- ko if: spacesEnabled -->\r\n            <swx-space-settings params="conversationModel: conversationModel, defaultVal: true"></swx-space-settings>\r\n        <!-- /ko -->\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: newConversationV2 -->\r\n    <div class="actions">\r\n        <div class="conversationButtons">\r\n            <div class="submitConversation">\r\n                <swx-button params="cssClass: \'secondary circle\', disabled: false, textKey: \'action_button_cancel\', titleKey: \'action_button_cancel\', ariaLabelKey: \'action_button_cancel\', action: cancel"></swx-button>\r\n                <swx-button params="cssClass: \'primary circle\', disabled: confirmButtonDisabled, textKey: \'action_button_confirm\', titleKey: \'action_button_confirm\', ariaLabelKey: \'action_button_confirm\', action: confirm"></swx-button>\r\n            </div>\r\n\r\n            <!-- ko if: spacesEnabled -->\r\n            <swx-conversation-share-link class="conversation-share-link-actions" params="conversationModel: conversationModel, telemetryContext: telemetryContext"></swx-conversation-share-link>\r\n            <!-- /ko -->\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n\r\n<div class="headerControls" data-bind="css: { newConversationV2: newConversationV2 }">\r\n    <!-- ko if: !newConversationV2() -->\r\n    <div class="buttonRow">\r\n        <swx-button params="icon: \'tick\', cssClass: \'primary circle\', disabled: confirmButtonDisabled, textKey: \'action_button_confirm\', titleKey: \'action_button_confirm\', ariaLabelKey: \'action_button_confirm\', action: confirm"></swx-button>\r\n        <swx-button params="icon: \'cross\', cssClass: \'primary circle\', disabled: false, textKey: \'action_button_cancel\', titleKey: \'action_button_cancel\', ariaLabelKey: \'action_button_cancel\', action: cancel"></swx-button>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- ko if: newConversationV2 -->\r\n    <div class="buttonRow newConversationV2">\r\n        <swx-button class="callButtons" params="icon: \'videoOn\', cssClass: \'primary circle\', disabled: \'true\', textKey: \'button_text_videoCall\'"></swx-button>\r\n        <swx-button class="callButtons" params="icon: \'callStart\', cssClass: \'primary circle\', disabled: \'true\', textKey: \'button_text_audioCall\'"></swx-button>\r\n\r\n        <!-- ko if: !showMoreActions() -->\r\n        <swx-button data-swx-testId="addParticipantAction" params="icon: \'contactAdd\', cssClass: \'primary circle\', disabled: \'true\', textKey: \'button_text_addParticipants\'"></swx-button>\r\n        <!-- /ko -->\r\n        <!-- ko if: showMoreActions() -->\r\n        <swx-button params="icon: \'more\', cssClass: \'secondary circle stroke\', disabled: \'true\', textKey: \'button_text_moreActions\'"></swx-button>\r\n        <!-- /ko -->\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("ui/components/chat/headerNewConversation",["require","exports","module","vendor/knockout","telemetry/chat/newConversationFlow","ui/viewModels/chat/headerNewConversation","constants/components","text!views/chat/headerNewConversation.html"],function(e,t){function s(e,t){var s=new r,o=new i(e,s);return o.setContext(n.dataFor(t.element)),o}var n=e("vendor/knockout"),r=e("telemetry/chat/newConversationFlow"),i=e("ui/viewModels/chat/headerNewConversation");t.name=e("constants/components").chat.HEADER_NEW_CONVERSATION,t.template=e("text!views/chat/headerNewConversation.html"),t.viewModel={createViewModel:s}}),define("text!views/chat/message.html",[],function(){return'<!-- ko ifnot: isMeCommandMessage -->\r\n<!-- ko if: showAuthorInfo -->\r\n<!-- ko if: isGroupConversation -->\r\n<!-- ko ifnot: disableOpenConversationWithAuthor -->\r\n<a data-bind="click: openConversationWithAuthor, attr: {\'aria-label\': openConversationLabel, title: openConversationLabel}" role="button">\r\n    <swx-avatar params="isGroupAvatar: false, avatar: author.avatar, isAgent: author.isAgent, displayName: author.displayName, useAbsolutePosition: true" class="clickable"></swx-avatar>\r\n</a>\r\n<!-- /ko -->\r\n<!-- ko ifnot: isGroupConversation -->\r\n<swx-avatar params="isGroupAvatar: false, avatar: author.avatar, isAgent: author.isAgent, displayName: author.displayName, useAbsolutePosition: true"></swx-avatar>\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n<!-- /ko -->\r\n\r\n<!-- ko if: isCallActivityItem -->\r\n<div class="callAction">\r\n    <div class="iconfont" data-bind="css: callAction"></div>\r\n</div>\r\n<!-- /ko -->\r\n\r\n<div class="bubble">\r\n\r\n    <!-- ko if: isSMS -->\r\n    <div class="smsStatus">\r\n        <!-- ko if:smsStatus() === \'Sending\' -->\r\n        <div class="offScreen" data-bind="l10n: { \'key\': \'sms_status_sending\'}"></div>\r\n        <span class="iconfont mobile" data-bind="attr:{title: smsStatus}"></span>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if:smsStatus() === \'Delivered\' -->\r\n        <div class="offScreen" data-bind="l10n: { \'key\': \'sms_status_delivered\'}"></div>\r\n        <span class="iconfont mobileOk" data-bind="attr:{title: smsStatus}"></span>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if:smsStatus() === \'Error\' -->\r\n        <div class="offScreen" data-bind="l10n: { \'key\': \'sms_status_deliveringError\'}"></div>\r\n        <span class="iconfont mobileError" data-bind="attr:{title: smsStatus}"></span>\r\n        <!-- /ko -->\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko ifnot: isMeCommandMessage -->\r\n    <!-- ko if: renderAuthorInfo -->\r\n    <div class="offScreen" data-bind="l10n: { \'key\': \'label_text_from\' }"> </div>\r\n    <!-- ko if: isGroupConversation -->\r\n    <!-- ko ifnot: disableOpenConversationWithAuthor -->\r\n    <a data-bind="css: { offScreen: !showAuthorInfo() }, attr: {\'aria-label\': openConversationLabel}, click: openConversationWithAuthor" role="button">\r\n        <swx-name params="person: author"></swx-name>\r\n    </a>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: disableOpenConversationWithAuthor -->\r\n    <swx-name params="person: author" data-bind="css: { offScreen: !showAuthorInfo() }"></swx-name>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n\r\n    <!-- ko ifnot: isGroupConversation -->\r\n    <swx-name params="person: author" data-bind="css: { offScreen: !showAuthorInfo() }"></swx-name>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n\r\n    <div class="arrow" data-bind="css:{hide:showGiphyMetadata}"></div>\r\n\r\n    <div class="content" data-bind="template: { name: contentTemplate, data: $data }, attr: { id: $data.contentId }"></div>\r\n\r\n    <div class="timestamp" data-bind="css: { offScreen: !showTimestamp() }">\r\n        <div class="offScreen" data-bind="l10n: { \'key\': \'message_text_timeStampMessage\' }"></div>\r\n        <p data-bind="text: setTimestamp, attr: {id: \'time_\' + $data.clientmessageid, title: setLongTimestamp}" class="smaller"></p>\r\n    </div>\r\n\r\n    <!-- ko ifnot: isMeCommandMessage -->\r\n    <!-- ko if: isEdited -->\r\n    <div class="messageIcon">\r\n        <!-- ko ifnot: isDeleted -->\r\n        <div class="offScreen" data-bind="l10n: { \'key\': \'message_edited_text\' }"></div>\r\n        <!-- /ko -->\r\n        <span class="iconfont edit"></span>\r\n    </div>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n    <!-- ko if: isDeleted -->\r\n    <div class="offScreen" data-bind="l10n: { \'key\': \'message_removed_success\' }"></div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: messageDeliveryIndicatorEnabledSW4B -->\r\n    <div class="messageIcon" data-bind="css:{hide:!deliveryFailed()}, attr:{title:deliveryFailedMessage, \'aria-label\':deliveryFailedMessage}">\r\n        <span class="iconfont warning"></span>\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n\r\n<!-- ko if: messageDeliveryStatusEnabled && !isMeCommandMessage -->\r\n<div class="DeliveryStatus" data-bind="css:{hide: (!isMyLastMessageInChat() && !deliveryFailed())}">\r\n    <span data-bind="css: deliveryStatusIconCssClass"></span>\r\n    <span class="DeliveryStatus-status fontSize-p smaller" data-bind="text: statusText"></span>\r\n</div>\r\n<!-- /ko -->\r\n\r\n<!-- ko if: timestampsInNarrowModeEnabled -->\r\n<div class="bottomTimestamp">\r\n    <div class="offScreen" data-bind="l10n: { \'key\': \'message_text_timeStampMessage\' }"></div>\r\n    <p data-bind="text: setBottomTimestamp, attr: {id: \'time_\' + $data.clientmessageid}" class="smaller"></p>\r\n</div>\r\n<!-- /ko -->\r\n'}),define("ui/components/chat/message",["require","exports","module","vendor/knockout","constants/components","text!views/chat/message.html"],function(e,t){function r(e,t){var r=e.viewModel,i=n.contextFor(t.element).$parent;return r.setContext(i),r.onRendered(),r.elementInfo=t,r}var n=e("vendor/knockout");t.name=e("constants/components").chat.MESSAGE,t.template=e("text!views/chat/message.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/chat/fragment",["require","lodash-compat","vendor/knockout","swx-constants","utils/common/eventMixin"],function(e){function s(e){function i(){t.dispatchEvent(r.COMPONENT_RENDERED,{fragment:t},t.DIRECTION.PARENT)}var t=this;this.name=e.page,this.options=e,this.hidden=n.observable(!0),this.setVisible=function(e){this.dispatchEvent(e?r.FRAGMENT_BEFORE_SHOW:r.FRAGMENT_BEFORE_HIDE,this.options,this.DIRECTION.CHILD),this.hidden(!e),this.dispatchEvent(e?r.FRAGMENT_SHOW:r.FRAGMENT_HIDE,this.options,this.DIRECTION.CHILD)},this.registerEvent(r.COMPONENT_RENDERED,i)}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-constants").COMMON.events.navigation,i=e("utils/common/eventMixin");return t.assign(s.prototype,i),s}),define("ui/viewModels/chat/navigation",["require","lodash-compat","vendor/knockout","swx-cafe-application-instance","swx-enums","swx-constants","constants/components","swx-pubsub-instance","swx-service-locator-instance","services/telemetry/common/telemetryContext","ui/viewModels/chat/navigationHelper","utils/common/eventMixin","ui/viewModels/chat/fragment","experience/settings"],function(e){function b(e){return y.indexOf(e)!==-1}function w(e){return e===o.chat.NEW_CONVERSATION||e===o.userSettings.USER_SETTINGS_PAGE}function E(e){function T(e){return t.fragments().filter(e)[0]}function N(){clearTimeout(t._cacheLimitOverflowCheckTimer),t._cacheLimitOverflowCheckTimer=setTimeout(A,g)}function C(e){var t=e.options.model;return!t||t.selfParticipant&&t.selfParticipant.audio.state()===i.callConnectionState.Disconnected}function k(){return T(function(e){return e.hidden()&&C(e)})}function L(e){t.fragments.remove(e),e.dispose()}function A(){if(t.fragments().length<=m)return;var e=k();e&&L(e),N()}function O(){return T(function(e){return!e.hidden()})}function M(e){var t=O();t&&t!==e&&(t.setVisible(!1),w(t.name)&&L(t)),e.setVisible(!0),H(e)}function _(e){M(e.fragment)}function D(e){var n=new h(e);return n.setContext(t),t.fragments.push(n),n}function P(e){var t=O(),n=j(e);n&&L(n);if(S===e||S&&S.model&&e&&e.model&&S.model===e.model)S=null;t&&t===n&&R()}function H(e){S=E?E.options:null,E=e,x.currentPlaceModel(e.options.model),x.currentPlaceName(e.name),y.historyLoadOrigin=e.options.origin,u.publish(d.FRAGMENT_LOADED,e.name)}function B(e,t){return t&&t.name===e.page&&t.options.model===e.model}function j(e){return T(function(t){return B(e,t)})}function F(e){var t=j(e);t?(t.options=e,M(t)):(t=D(e),b(e.page)&&M(t)),N()}function I(e){var t=j(e);t.options=e,t.setVisible(!0)}function q(t){if(!t||!t.page)throw new TypeError("You need to specify where you navigate !");if(!t.contentElementId||t.contentElementId===e){if(B(t,E)){I(t);return}if(p.API.version===2&&t.origin===s.telemetry.historyLoadOrigin.CALLING)return;F(t)}}function R(){var e=c.conversationsManager.conversations().length,t=c.signInManager.state()===i.loginState.SignedIn,n;if(!t)return;S&&e?u.publish(d.NAVIGATE,S):e?(n={page:o.chat.CONVERSATION,model:c.conversationsManager.conversations()[0]},u.publish(d.NAVIGATE,n)):l.navigateToContactsPage()}function U(t){if(!t.contentElementId||t.contentElementId===e)t.page=o.chat.CONVERSATION,u.publish(d.NAVIGATE,t)}function z(){t.shrinkContent(!1),t.expandContent(!0)}function W(){t.expandContent(!1),t.shrinkContent(!0)}function X(){[].concat(t.fragments()).forEach(function(e){e.hidden()&&C(e)&&L(e)})}var t=this,c=r.get(),y,E,S,x;this.expandContent=n.observable(!1),this.shrinkContent=n.observable(!0),this.fragments=n.observableArray(),this.isInBackground=n.observable(!1),this.dispose=function(){u.unsubscribe(d.OPEN_CONVERSATION,U),u.unsubscribe(d.NAVIGATE,q),u.unsubscribe(v.SIDEBAR_STATE_CHANGED,this.isInBackground),u.unsubscribe(d.NAVIGATE_TO_PREVIOUS_PAGE,R),u.unsubscribe(v.SHOW_SIDEBAR,W),u.unsubscribe(v.HIDE_SIDEBAR,z),u.unsubscribe(d.FRAGMENT_REMOVE,P),u.unsubscribe(d.FRAGMENT_REMOVE_ALL_HIDDEN,X)},this.handleUserAction=function(){return c.isEndpointActive&&c.isEndpointActive.set(!0),!0},this.init=function(){var n=p.API.version===2;u.subscribe(d.OPEN_CONVERSATION,U),u.subscribe(d.NAVIGATE,q),u.subscribe(v.SIDEBAR_STATE_CHANGED,this.isInBackground),u.subscribe(d.NAVIGATE_TO_PREVIOUS_PAGE,R),u.subscribe(v.SHOW_SIDEBAR,W),n||u.subscribe(v.HIDE_SIDEBAR,z),u.subscribe(d.FRAGMENT_REMOVE,P),u.subscribe(d.FRAGMENT_REMOVE_ALL_HIDDEN,X),this.registerEvent(d.COMPONENT_RENDERED,_),y=f.get(),x=a.resolve(s.serviceLocator.NAVIGATION_CONTEXT),u.publish(s.apiUIEvents.SWX_CONTENT_LOADED,{contentElementId:e}),c.signInManager.state.when(i.loginState.SignedOut,function(){t.fragments.removeAll(),x.reset(),E=undefined,S=undefined})}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-cafe-application-instance"),i=e("swx-enums"),s=e("swx-constants").COMMON,o=e("constants/components"),u=e("swx-pubsub-instance").default,a=e("swx-service-locator-instance").default,f=e("services/telemetry/common/telemetryContext"),l=e("ui/viewModels/chat/navigationHelper"),c=e("utils/common/eventMixin"),h=e("ui/viewModels/chat/fragment"),p=e("experience/settings"),d=s.events.navigation,v=s.events.narrowMode,m=1,g=2e4,y=[o.people.CONTACTS_PAGE,o.people.DISCOVER_AGENTS_PAGE,o.calling.SKYPEOUT_PAGE,o.userSettings.USER_SETTINGS_PAGE];return t.assign(E.prototype,c),{build:function(e){return new E(e)}}}),define("text!views/chat/navigation.html",[],function(){return'<div class="fragmentsContainer" data-bind="foreach: fragments, css: { showContent: expandContent, hideContent: shrinkContent }, event: { mousemove: handleUserAction, click: handleUserAction, mousewheel: handleUserAction, keydown: handleUserAction }">\r\n    <div class="fragment hide" aria-hidden="true" data-bind="component: { name: $data.name, params: $data.options },css: { hide: hidden },attr: { \'aria-hidden\': hidden }"></div>\r\n</div>\r\n<swx-narrator></swx-narrator>\r\n'}),define("ui/components/chat/navigation",["require","exports","module","ui/viewModels/chat/navigation","browser/dom","constants/components","text!views/chat/navigation.html"],function(e,t){function i(e,t){var r=s(t.element),i=n.build(r);return i.init(),i}function s(e){var t=r.getParentWithClass(e,"swxContent");return t?t.getAttribute("id"):null}var n=e("ui/viewModels/chat/navigation"),r=e("browser/dom");t.name=e("constants/components").chat.NAVIGATION,t.template=e("text!views/chat/navigation.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/newConversation",["require","lodash-compat","swx-constants","utils/common/eventMixin","swx-utils-chat","swx-utils-common","swx-cafe-application-instance","swx-pubsub-instance","swx-service-locator-instance","usertiming"],function(e){function c(){function c(){l.mark(u.NEW_CONVERSATION.FLOW_START)}function h(r){var f,c=o.get().conversationsManager;e.conversation||(e.conversation=i.createConversation(t.selectedContacts(),c,r)),e.conversation.isJoiningEnabled.set.enabled.once(!0,function(){e.conversation.isJoiningEnabled.set(r)}),e.newConversationV2&&i.addPersonsToConversation(t.selectedContacts(),e.conversation),f=e.conversation.isGroupConversation()?n.telemetry.historyLoadOrigin.NEW_CHAT_CREATION:n.telemetry.historyLoadOrigin.NEW_CHAT_OPEN_EXISTING,e.conversation.isGroupConversation()||o.get().conversationsManager.conversations.add(e.conversation),s.execute(function(){l.mark(u.NEW_CONVERSATION.RENDER_END),a.publish(n.events.navigation.OPEN_CONVERSATION,{model:e.conversation,origin:f})})}function p(){l.mark(u.NEW_CONVERSATION.RENDER_END),a.publish(n.events.navigation.NAVIGATE_TO_PREVIOUS_PAGE)}function d(s){var u=o.get().conversationsManager,a=r.isFeatureOn(n.featureFlags.SPACES);e.conversation||(e.conversation=i.createConversation(t.selectedContacts(),u,a),e.conversation.isJoiningEnabled.set.enabled.once(!0,function(){e.conversation.isJoiningEnabled.set(a)})),s(e.conversation)}var e=this,t,r=f.resolve(n.serviceLocator.FEATURE_FLAGS);e.registerEvent(n.events.newConversation.CONFIRMED,h),e.registerEvent(n.events.newConversation.CANCELLED,p),e.registerEvent(n.events.conversation.SHARED,d),e.forwardEvent(n.events.navigation.FRAGMENT_SHOW,e.DIRECTION.CHILD,c),e.newConversationV2=r.isFeatureOn(n.featureFlags.NEW_CONVERSATION_V2),e.conversation=null,e.setParticipantProvider=function(e){t=e}}var t=e("lodash-compat"),n=e("swx-constants").COMMON,r=e("utils/common/eventMixin"),i=e("swx-utils-chat").conversation,s=e("swx-utils-common").async,o=e("swx-cafe-application-instance"),u=n.telemetry.performanceMarks,a=e("swx-pubsub-instance").default,f=e("swx-service-locator-instance").default,l=e("usertiming");return t.assign(c.prototype,r),c}),define("text!views/chat/newConversation.html",[],function(){return'<div class="conversationControl chat themeLight editRosterMode newConversation">\r\n    <swx-header-new-conversation class="conversationHeader active editMode" params="setParticipantProvider: setParticipantProvider, conversationModel: conversation" data-bind="css: { newConversationV2: newConversationV2 }"></swx-header-new-conversation>\r\n</div>\r\n\r\n'}),define("ui/components/chat/newConversation",["require","exports","module","vendor/knockout","swx-constants","ui/viewModels/chat/newConversation","constants/components","text!views/chat/newConversation.html"],function(e,t){function s(e,t){var s=t.element,o=n.dataFor(s),u=new i;return u.setContext(o),u.dispatchEvent(r.navigation.COMPONENT_RENDERED),u}var n=e("vendor/knockout"),r=e("swx-constants").COMMON.events,i=e("ui/viewModels/chat/newConversation");t.name=e("constants/components").chat.NEW_CONVERSATION,t.template=e("text!views/chat/newConversation.html"),t.viewModel={createViewModel:s}}),define("ui/viewModels/chat/contactPickerInput",["require","lodash-compat","vendor/knockout","utils/common/eventMixin","swx-i18n","swx-constants","swx-service-locator-instance","swx-constants","utils/common/eventHelper","swx-utils-common","browser/dom","utils/common/scroll","swx-focus-handler","utils/common/accessibility"],function(e){function y(){function b(t){var r=n.utils.arrayFirst(e.selectedContacts(),function(e){return t.id()===e.id()});r||(e.selectedContacts.push(t),p.announce({key:"contact_isSelected"}),N(),T())}function w(t){e.selectedContacts.remove(function(e){return t.id()===e.id()}),C(t.displayName())}function E(t){e.inputValue()&&t&&e.showMoreResultsAvailableMessage(g&&t.moreResultsAvailable),e.showSpinner(!1)}function S(t){t.length||e.showMoreResultsAvailableMessage(!1);var n={query:t,selectedContacts:e.selectedContacts().slice()};e.dispatchEvent(d.roster.ROSTER_QUERY_CHANGED,n),e.showSpinner(k(s.featureFlags.SHOW_PICKER_SPINNER)&&t.length>0)}function x(){var t;if(e.selectedContacts().length===0)return;t=e.selectedContacts.pop(),e.dispatchEvent(d.roster.ROSTER_SELECTION_REMOVED,{person:t}),C(t.displayName())}function T(){h.get().addFocusRequestToQueue(t),f.execute(y.scrollToBottom)}function N(){e.inputValue(m),e.showMoreResultsAvailableMessage(!1)}function C(e){p.announce({key:"accessibility_contactPickerResultRemoved",params:{displayName:e}})}function k(e){return o.resolve(s.serviceLocator.FEATURE_FLAGS).isFeatureOn(e)}var e=this,t=null,r=null,y;e.showSpinner=n.observable(!1),e.selectedContacts=n.observableArray(),e.placeholder=n.computed(function(){return e.selectedContacts().length>0?i.fetch({key:"input_placeholder_addAnotherContact"}):i.fetch({key:"input_placeholder_typeContactName"})}),e.inputValue=n.observable(m).extend({rateLimit:{timeout:v,method:"notifyWhenChangesStop"}}),e.init=function(i){r=i,g=k(s.featureFlags.SHOW_SEARCH_QUERY_MORE_RESULTS_AVAILABLE),e.showMoreResultsAvailableMessage=n.observable(!1),t=r.querySelector("input"),r.addEventListener(d.browser.CLICK,T),e.inputSubscription=e.inputValue.subscribe(S),e.registerEvent(d.roster.PICKER_CONTACT_SELECTED,b),e.registerEvent(d.roster.PICKER_CONTACT_DESELECTED,w),e.registerEvent(d.roster.ROSTER_QUERY_EXECUTED,E),y=c.build(l.getElement("div.scrollinWrapper",r)),y.init(),T()},e.dispose=function(){r.removeEventListener(d.browser.CLICK,T),e.inputSubscription&&e.inputSubscription.dispose(),e.placeholder.dispose(),e.selectedContacts=null,y.dispose()},e.handleKeyDown=function(e,t){var n=a.getKeyCode(t);return n===u.BACKSPACE&&e.inputValue()===m?(x(),e.showMoreResultsAvailableMessage(!1)):n===u.ESCAPE&&e.inputValue()!==m&&(N(),t.stopPropagation()),!0}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/eventMixin"),i=e("swx-i18n").localization,s=e("swx-constants").COMMON,o=e("swx-service-locator-instance").default,u=e("swx-constants").KEYS,a=e("utils/common/eventHelper"),f=e("swx-utils-common").async,l=e("browser/dom"),c=e("utils/common/scroll"),h=e("swx-focus-handler"),p=e("utils/common/accessibility").narrator,d=s.events,v=500,m="",g;return t.assign(y.prototype,r),y}),define("text!views/chat/contactPickerInput.html",[],function(){return'<div class="contactPickerInput scrollinWrapper">\r\n    <div class="scrollViewport scrollViewportV" tabindex="-1">\r\n        <div class="contacts">\r\n            <!-- ko foreach: selectedContacts -->\r\n            <swx-contact-pill params="person: $data" class="contact-pill"></swx-contact-pill>\r\n            <!-- /ko -->\r\n            \r\n            <input autocomplete="organization" type="text" class="fontSize-p" data-bind="attr: { placeholder: placeholder }, textInput: inputValue, valueUpdate: \'afterkeydown\', event: { keydown: handleKeyDown },\r\n            l10n_attr: {\'placeholder\': \'input_placeholder_typeContactName\'}">\r\n            <swx-loading-animation data-bind="css: { hide: !showSpinner() }" class="ContactPickerInput-spinner spinner blue"></swx-loading-animation>\r\n        </div>\r\n    </div>\r\n    <!-- ko if: showMoreResultsAvailableMessage() -->\r\n    <div class="moreSearchResults">\r\n        <p class="strong" data-bind="l10n: {key: \'message_more_search_results_available\'}"></p>\r\n    </div>\r\n    <!-- /ko-->\r\n</div>\r\n'}),define("ui/components/chat/contactPickerInput",["require","exports","module","vendor/knockout","ui/viewModels/chat/contactPickerInput","constants/components","text!views/chat/contactPickerInput.html"],function(e,t){function i(e,t){var i=new r;return i.setContext(n.dataFor(t.element)),i.init(t.element),e.setParticipantProvider(i),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/contactPickerInput");t.name=e("constants/components").chat.CONTACT_PICKER_INPUT,t.template=e("text!views/chat/contactPickerInput.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/spaceSettings",["require","lodash-compat","vendor/knockout","utils/common/eventMixin","swx-i18n","swx-enums","swx-utils-chat","utils/common/cafeObservable","swx-constants","utils/common/eventHelper"],function(e){function l(e,t){function l(){r.joiningEnabled(!!t)}function c(){r.role=u.newObservableProperty(e.selfParticipant.role),r.spaceLink=u.newObservableProperty(e.uri),r.joiningEnabled(e.isJoiningEnabled()),e.isJoiningEnabled.get(function(e){r.joiningEnabled(e),r.dispatchEvent(a.conversation.JOINING_ENABLED,e,r.DIRECTION.PARENT)})}var r=this;r.role=n.observable(s.participantRole.Leader),r.spaceLink=n.observable(),r.joiningEnabled=n.observable(!!t),r.registerEvent(a.newConversation.CANCELLED,l),r.registerEvent(a.newConversation.CONFIRMED,l),e.selfParticipant&&c(),r.label=n.pureComputed(function(){return r.isAdmin()?i.fetch({key:"header_text_allowOthersToJoin"}):i.fetch({key:"header_text_othersCanJoin"})}),r.isAdmin=n.pureComputed(function(){return r.role()===s.participantRole.Leader||!e.isGroupConversation()}),r.mailtoLink=n.pureComputed(function(){return o.createMailtoLink(e.topic(),r.spaceLink())}),r.linkShown=n.pureComputed(function(){return!!r.spaceLink()&&!!r.joiningEnabled()}),r.hideSettings=n.pureComputed(function(){return!r.isAdmin()&&!r.linkShown()}),r.joiningEnabledHandler=function(){var e=r.joiningEnabled();r.joiningEnabled(!e),r.dispatchEvent(a.conversation.JOINING_ENABLED,!e,r.DIRECTION.PARENT)},r.onJoinEnablerKeydown=function(e,t){var n=f.isActivation(t);return n&&r.joiningEnabledHandler(),!n}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/eventMixin"),i=e("swx-i18n").localization,s=e("swx-enums"),o=e("swx-utils-chat").spaceMail,u=e("utils/common/cafeObservable"),a=e("swx-constants").COMMON.events,f=e("utils/common/eventHelper");return t.assign(l.prototype,r),l}),define("text!views/chat/spaceSettings.html",[],function(){return'<div class="hide spaceSettings" data-bind="css: { hide: hideSettings, admin: isAdmin, linkShown: linkShown } ">\r\n    <div class="spaces">\r\n        <span class="label fontSize-p" data-bind="text: label"></span>\r\n        <a href="#" class="fontSize-p link" data-bind="text: spaceLink, attr: { href: spaceLink }"></a>\r\n        <a href="#" class="fontSize-p smaller copySpaceLink" data-bind="l10n: {key: \'header_text_copyLink\'}"></a>\r\n        <a href="#" class="fontSize-p smaller sendSpaceLink" data-bind="attr: { href: mailtoLink }, l10n: {key: \'header_text_inviteViaEmail\'}"></a>\r\n    </div>\r\n    <button class="toggler" data-bind="click: joiningEnabledHandler, css: { checked: joiningEnabled }, event: { keydown: onJoinEnablerKeydown }, attr: { \'aria-checked\': joiningEnabled ? \'true\' : \'false\' }" type="button"><span class="on"></span><span class="off"></span></button>\r\n</div>\r\n'}),define("ui/components/chat/spaceSettings",["require","exports","module","vendor/knockout","ui/viewModels/chat/spaceSettings","constants/components","text!views/chat/spaceSettings.html"],function(e,t){function i(e,t){var i=new r(e.conversationModel,e.defaultVal);return i.setContext(n.dataFor(t.element)),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/spaceSettings");t.name=e("constants/components").chat.SPACE_SETTINGS,t.template=e("text!views/chat/spaceSettings.html"),t.viewModel={createViewModel:i}}),define("utils/common/feedback",["require","exports","module","experience/settings","swx-browser-detect","ui/session/localSession","swx-cafe-application-instance","swx-i18n"],function(e,t){var n=e("experience/settings"),r=e("swx-browser-detect").default,i=e("ui/session/localSession"),s=e("swx-cafe-application-instance"),o=e("swx-i18n").localization;t.getFeedbackPageUrl=function(){var e=n.platformId,t=n.version,u=n.initParams.locale,a=s.get().personsAndGroupsManager.mePerson.id(),f=n.biAppName,l=n.initParams.correlationIds.hostProperty,c,h,p,d,v,m;return n.feedbackPageUrl.indexOf("mailto:")===0?(v=r.getBrowserInfo(),d=String.fromCharCode(10),h=o.fetch({key:"giveFeedback_subject"}),p=o.fetch({key:"giveFeedback_body"}),p+=d+d,p+=d+"-------------------------------",p+=d+"Skype Version: "+t,p+=d+"Browser Name: "+v.browserName,p+=d+"Browser Version: "+v.browserMajorVersion,p+=d+"Language: "+u,p+=d+"Property: "+f,p+=d+"Session Id: "+(i.getSessionId()||""),p+=d+"Tab Session Id: "+(i.getTabSessionId()||""),p+=d+"Host Property: "+l,p+=d+"Host User Id: "+n.initParams.correlationIds.userId,p+=d+"Host Session Id: "+n.initParams.correlationIds.sessionId,m=n.feedbackPageUrl+"?subject="+encodeURIComponent(h)+"&body="+encodeURIComponent(p)):(c={userId:n.initParams.correlationIds.userId,sessionId:n.initParams.correlationIds.sessionId},m=n.feedbackPageUrl+"?p="+encodeURIComponent(e)+"&v="+encodeURIComponent(t)+"&lang="+encodeURIComponent(u)+"&e="+encodeURIComponent(f),a&&(m+="&u="+encodeURIComponent(a)),l&&(m+="&tag="+encodeURIComponent(l)),m+="&tcg="+encodeURIComponent(JSON.stringify(c))),m},t.getFeedbackPageTarget=function(){return n.feedbackPageUrl.indexOf("mailto:")===0?"_self":"_blank"}}),define("ui/viewModels/chat/recentList",["require","lodash-compat","vendor/knockout","swx-service-locator-instance","utils/common/cafeObservable","swx-enums","swx-constants","swx-cafe-application-instance","swx-utils-common","swx-pubsub-instance","swx-utils-chat","utils/common/ko","swx-utils-common","usertiming","swx-i18n","browser/window","ui/viewModels/chat/navigationHelper","utils/common/scroll","utils/common/feedback","experience/settings","utils/common/styleModeHelper"],function(e){var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-service-locator-instance").default,i=e("utils/common/cafeObservable"),s=e("swx-enums"),o=e("swx-constants").COMMON,u=o.events.navigation,a=e("swx-cafe-application-instance"),f=e("swx-utils-common").async,l=e("swx-pubsub-instance").default,c=e("swx-utils-chat").dateTime,h=e("utils/common/ko"),p=e("swx-utils-common").array,d=o.telemetry.performanceMarks,v=e("usertiming"),m=e("swx-i18n").localization,g=e("browser/window"),y=e("ui/viewModels/chat/navigationHelper"),b=e("utils/common/scroll"),w=e("utils/common/feedback"),E=e("experience/settings"),S=o.styleMode,x=e("utils/common/styleModeHelper");return function(T,N,C,k){function K(){return J.isFeatureOn(o.featureFlags.FAVORITES_CONVERSATION_ENABLED)}function Q(){U(c.getDate().toDateString())}function G(){M().forEach(function(e,t){bt(t,e)}),H.valueHasMutated()}function Y(e,t){l.publish(o.events.interaction.SCROLL_START,t)}function Z(e){return e.isOnCall()}function et(e){return e.canJoinCall()}function tt(){function e(e){var t=Z(e),n=et(e);return I!==t&&(I=t),t||n}return H().filter(e)}function nt(e){return!Z(e)&&!et(e)}function rt(e,t){return!e.isFavorited()&&e.timestamp()===null&&e.conversation.lastModificationTimestamp._set(new Date),e.isFavorited()===t.isFavorited()||!K()?t.timestamp()-e.timestamp():e.isFavorited()?-1:1}function it(e){return!e.isBlocked()}function st(e){return K()?!0:!e.isFavorited()||e.timestamp()!==null}function ot(e){return e.isFavorited()}function ut(){var e;return e=H().filter(it).filter(nt).filter(st).sort(rt),at(e[0]),e}function at(e){if(!e)return;f.execute(function(){St(q,e),Nt(e),R.update(),q=e})}function ft(){v.mark(d.TIMELINE.SYNC_START),B.mePerson.displayName.get(),mt(),g.addEventListener("resize",mt)}function lt(){g.removeEventListener("resize",mt),P=!0,V=!1}function ct(){if(V)return;var e=O.conversations().length>0;e?yt():y.navigateToContactsPage(yt)}function ht(e){z=e}function pt(){ht(!1),mt()}function dt(){return W.clientHeight<X.scrollHeight}function vt(){return W.scrollTop+W.clientHeight+100>X.scrollHeight}function mt(){!dt()&&O.getMoreConversations.enabled()?(ht(!0),O.getMoreConversations(5).then(pt,ct)):ct()}function gt(){if(z||!O.getMoreConversations.enabled())return;vt()&&(ht(!0),O.getMoreConversations(5).then(function(){ht(!1)}))}function yt(){v.mark(d.TIMELINE.SYNC_END_OK);var e=new k;e.publish(),l.publish(o.apiUIEvents.SWX_TIMELINE_LOADED,{}),V=!0}function bt(e,t){var n=new N(C);n.init(t),Ct(n),p.insertAt(H(),e,n),R.update()}function wt(e){var t=H()[e];t.separator.dispose(),t.separator=null,t.dispose(),p.removeFrom(H(),e),R.update()}function Et(e){h.handleArrayChanges(H(),e,bt,wt),H.valueHasMutated(),R.update()}function St(e,t){t&&t!==e&&t.isActive()&&t.lastMessageIsOutgoing()&&xt()}function xt(){document.querySelector(A).scrollTop=0}function Tt(){return!j.currentPlaceName()}function Nt(e){if(!P||!e)return;P=!1,Tt()&&l.publish(u.OPEN_CONVERSATION,{model:e.conversation,origin:o.telemetry.historyLoadOrigin.TIMELINE_INIT})}function Ct(e){e.separator=n.computed(function(){return K()&&e.isFavorited()?m.fetch({key:"favorites_recents_category_name"}):(U(),c.getDateGroup(e.timestamp()))})}var L=this,A=".timeline .history",O,M,D,P=!0,H,B,j,F,I,q=null,R,U=n.observable(),z=!1,W,X,V=!1,$=t.debounce(Y,1e3,{leading:!0,trailing:!1}),J=r.resolve(o.serviceLocator.FEATURE_FLAGS);L.init=function(){Q(),R=b.build(document.querySelector(".swx .side .timeline .scrollingWrapper")),R.init(),W=document.querySelector(".swx .side .timeline .scrollingWrapper .scrollable"),X=document.querySelector(".swx .side .timeline .scrollingWrapper .scrollable div"),O=a.get().conversationsManager,B=a.get().personsAndGroupsManager,H=n.observableArray(),L.recentConversations=n.computed(ut),L.currentCalls=n.pureComputed(tt),L.hasCurrentCall=function(){return L.currentCalls().length>0},j=r.resolve(o.serviceLocator.NAVIGATION_CONTEXT),L.buttonsDisabled=T.buttonsDisabled,L.hasNotificationsToggle=J.isFeatureOn(o.featureFlags.NOTIFICATIONS_TOGGLE_ENABLED),L.hasButtonFullSize=J.isFeatureOn(o.featureFlags.FULL_SCREEN_MODE_FROM_SIDEPANE),L.hasBetaLabel=J.isFeatureOn(o.featureFlags.HAS_BETA_LABEL),L.hasFeedbackLink=J.isFeatureOn(o.featureFlags.HAS_FEEDBACK_LINK),L.hasFeedbackIcon=J.isFeatureOn(o.featureFlags.HAS_FEEDBACK_ICON),L.feedbackIconURL=E.appBaseUrl+"/assets/images/components/common/feedback.svg",I=!1,M=i.newObservableCollection(O.conversations),D=M.subscribe(Et,null,"arrayChange"),L.mePersonId=i.newObservableProperty(B.mePerson.id),a.get().signInManager.state.when(s.loginState.SignedIn,ft),a.get().signInManager.state.when(s.loginState.SignedOut,lt),l.subscribe(o.events.system.DATE_CHANGED,Q),G()},L.dispose=function(){D.dispose(),R.dispose(),L.recentConversations.dispose(),L.mePersonId.dispose(),l.unsubscribe(o.events.system.DATE_CHANGED,Q),g.removeEventListener("resize",mt),F&&F.dispose()},L.showSeparatorIcon=function(n){var r=L.recentConversations(),i=x.get().currentMode()===S.NARROW,s=K()&&t.some(L.recentConversations(),ot),o=n===0||r[n-1]&&r[n-1].isFavorited()&&!r[n].isFavorited();return i&&s&&L.showSeparator(n)&&o},L.separatorIconClass=function(t){var n={},r=K()&&L.recentConversations()[t].isFavorited();return n.favourite=r,n.clock=!r,n},L.separatorText=function(t){var n=K()&&L.recentConversations()[t].isFavorited();return n?"favorites_recents_category_name":"accessibility_recentItem_recent_group"},L.showSeparator=function(t){var n=L.recentConversations();return t===0||n[t-1].separator()!==n[t].separator()},L.onScroll=function(e,t){gt(),$(e,t)},L.feedbackLabelTitle=function(){return m.fetch({key:"giveFeedback_tooltip"})},L.feedbackPageUrl=n.pureComputed(function(){return w.getFeedbackPageUrl()}),L.feedbackPageTarget=function(){return w.getFeedbackPageTarget()},L.stopSidebarExpanding=function(e,t){t.stopPropagation()}}}),define("telemetry/chat/timelineLoad",["require","usertiming","swx-browser-detect","swx-constants","experience/settings","services/telemetry/common/analyticsInfo","services/telemetry/common/telemetryContext","swx-telemetry-buckets","telemetry/utils/telemetryUtils","ui/telemetry/telemetryClient"],function(e){function p(){var e=r.telemetry.NOT_AVAILABLE,p=r.telemetry.NOT_AVAILABLE,d=r.telemetry.NOT_AVAILABLE,v=function(){t.mark(c.TIMELINE.RENDER_END);var r=t.getEntriesByName(c.TIMELINE.SYNC_END_OK);if(r.length>0){t.measure(h.TIMELINE.TTL,c.TIMELINE.SYNC_START,c.TIMELINE.SYNC_END_OK);var i=t.getEntriesByName(h.TIMELINE.TTL);i&&i.length>0&&(e=i[0].duration)}else{t.measure(h.TIMELINE.TTL,c.TIMELINE.SYNC_START,c.TIMELINE.SYNC_END_ERROR);var s=t.getEntriesByName(h.TIMELINE.TTL);s&&s.length>0&&(e=s[0].duration)}var o=t.getEntriesByName(c.TIMELINE.SYNC_END_404),u=o.length>0;if(u){t.measure(h.TIMELINE.TTL404,c.TIMELINE.SYNC_START,c.TIMELINE.SYNC_END_404);var a=t.getEntriesByName(h.TIMELINE.TTR);a&&a.length&&(d=a[0].duration)}t.measure(h.TIMELINE.TTR,c.TIMELINE.SYNC_START,c.TIMELINE.RENDER_END);var f=t.getEntriesByName(h.TIMELINE.TTR);f&&f.length>0&&(p=f[0].duration)};this.publish=function(){var c=o.get(),h=s.get(),m=h.conversationsInfo(),g=h.contactsInfo();try{v()}catch(y){}var b=l.TYPE,w=a.stringify({contactsCount:g.totalContacts,conv1Count:m.conversation1Count,conv30Count:m.conversation30Count,thread1Count:m.thread1Count,threads30Count:m.thread30Count,unreadCount:m.unreadConversationsCount,origin:c.historyLoadOrigin,activeEndpoints:c.activeEndpoints,isPinned:n.getBrowserInfo().isPinnedSite,ttl:e,ttr:p,t404:d,responseCode:c.timelineLoadStatusCode,contactsCountGroup:u.getContactsGroup(g.totalContacts),conv1CountGroup:u.getConversationCountGroup(m.conversation1Count),conv30CountGroup:u.getConversationCountGroup(m.conversation30Count),thread1CountGroup:u.getConversationCountGroup(m.thread1Count),thread30CountGroup:u.getConversationCountGroup(m.thread30Count),unreadCountGroup:u.getMessageCountGroup(m.unreadConversationsCount),ttlDurationGroup:u.getSecondsDurationGroupFromMs(e),ttrDurationGroup:u.getSecondsDurationGroupFromMs(p),t404DurationGroup:u.getSecondsDurationGroupFromMs(d),originDescription:a.getOriginDescription(c.historyLoadOrigin,r.telemetry.timelineLoadOrigin),isError:u.isError(c.timelineLoadStatusCode)});f.get().sendEvent(i.telemetry.uiTenantToken,b,w)}}var t=e("usertiming"),n=e("swx-browser-detect").default,r=e("swx-constants").COMMON,i=e("experience/settings"),s=e("services/telemetry/common/analyticsInfo"),o=e("services/telemetry/common/telemetryContext"),u=e("swx-telemetry-buckets"),a=e("telemetry/utils/telemetryUtils"),f=e("ui/telemetry/telemetryClient"),l=r.telemetry.timelineLoadEvent,c=r.telemetry.performanceMarks,h=r.telemetry.measurements;return p}),define("text!views/chat/recents.html",[],function(){return'<div data-bind="css:{ hide:hasCurrentCall()==false }">\r\n    <div class="current">\r\n        <div class="separator">\r\n            <p class="strong" data-bind="l10n: { key: \'label_text_currentCallHeading\'}"></p>\r\n        </div>\r\n    </div>\r\n    <!-- ko foreach: currentCalls -->\r\n    <div class="current">\r\n        <swx-current-call params="model: $data"></swx-current-call>\r\n    </div>\r\n    <!--/ko -->\r\n</div>\r\n\r\n<div class="scrollingWrapper" data-bind="keyboardNavigation: { itemSelector: \'a\' }">\r\n    <div class="history scrollable scrollViewport scrollViewportV fixSmall" data-bind="event: { scroll: onScroll }" tabindex="-1">\r\n\r\n        <div class="recents scrollViewport-inner" role="menu" data-bind="template: { name: \'recent-template\', foreach: recentConversations, as: \'recent\' }"></div>\r\n\r\n        <!-- ko if: recentConversations().length == 0 -->\r\n        <div role="listitem" class="RecentsMessage">\r\n            <p class="RecentsMessage-emptyConversation" data-bind="l10n: { key:  \'label_text_conversationsLoadNone\'}"></p>\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n</div>\r\n\r\n<!-- ko if: hasNotificationsToggle || hasButtonFullSize || hasBetaLabel || hasFeedbackIcon -->\r\n<div class="recents-badge">\r\n\r\n    <!-- ko if: hasButtonFullSize -->\r\n    <a class="buttonFullSize" href="https://web.skype.com/en/?source=owa" target="_blank">Full size</a>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: hasNotificationsToggle -->\r\n    <swx-notifications-toggle-button params="isDisabled: buttonsDisabled" data-bind=" event: { mouseover: stopSidebarExpanding }"></swx-notifications-toggle-button>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: hasFeedbackIcon -->\r\n    <a data-bind="attr: { title: feedbackLabelTitle(), href: feedbackPageUrl(), target: feedbackPageTarget()}, event: { mouseover: stopSidebarExpanding }">\r\n        <p>\r\n            <img data-bind="attr: {src: feedbackIconURL, alt: feedbackLabelTitle()}" />\r\n        </p>\r\n    </a>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: hasBetaLabel -->\r\n    <!-- ko if: hasFeedbackLink -->\r\n    <a data-bind="attr: { title: feedbackLabelTitle(), href: feedbackPageUrl(), target: feedbackPageTarget()}, event: { mouseover: stopSidebarExpanding }">\r\n        <p class="smaller badge">♥ BETA</p>\r\n    </a>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko ifnot: hasFeedbackLink -->\r\n    <p class="smaller badge">♥ BETA</p>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n</div>\r\n<!-- /ko -->\r\n\r\n<script type="text/html" id="recent-template">\r\n    <!-- ko if: $parent.showSeparatorIcon($index()) -->\r\n    <div role="heading" class="splitter" data-bind="l10n_attr: {\'aria-label\': $parent.separatorText($index())}">\r\n        <span class="icon iconfont favourite" data-bind="css:$parent.separatorIconClass($index())"></span>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: $parent.showSeparator($index())-->\r\n    <div role="heading" class="separator">\r\n        <p data-bind="text: recent.separator(), attr: {\'aria-label\': recent.separator()}" class="strong"></p>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <swx-recent-item role="group" params="model: recent" class="list-selectable"></swx-recent-item>\r\n</script>\r\n'}),define("ui/components/chat/recents",["require","exports","module","ui/viewModels/chat/recentList","ui/viewModels/chat/recent","ui/viewModels/chat/message","telemetry/chat/timelineLoad","constants/components","text!views/chat/recents.html"],function(e,t){function o(e){var t=new n(e,r,i,s);return t.init(),t}var n=e("ui/viewModels/chat/recentList"),r=e("ui/viewModels/chat/recent"),i=e("ui/viewModels/chat/message"),s=e("telemetry/chat/timelineLoad");t.name=e("constants/components").chat.RECENTS,t.template=e("text!views/chat/recents.html"),t.viewModel={createViewModel:o}}),define("telemetry/chat/sendSmsTelemetry",["require","exports","module","swx-constants","experience/settings","services/telemetry/skypeData","swx-jskype-main/lib/utils/chat/smsMessageBuilder"],function(e,t){function u(e,t,u){function l(){a.data={size:f,count:f,numberOfDestinations:f,participantsCount:f,status:f}}function c(){a.data.size=e.length,a.data.count=o.calculateSmsFragments(e),a.data.numberOfDestinations=u?u.length:f,a.data.participantsCount=t.participantsCount()||f;var n={type:i.TYPE,data:a.data};s.push(n,r.telemetry.chatTenantToken),l()}var a=this,f=n.telemetry.NOT_AVAILABLE;a.publish=c,l()}var n=e("swx-constants").COMMON,r=e("experience/settings"),i=n.telemetry.sendSms,s=e("services/telemetry/skypeData"),o=e("swx-jskype-main/lib/utils/chat/smsMessageBuilder");t.build=function(e,t,n){return new u(e,t,n)}}),define("ui/viewModels/chat/textarea",["require","services/telemetry/logging/perf/main","swx-cafe-application-instance","lodash-compat","utils/common/eventMixin","swx-constants","experience/settings","swx-constants","swx-constants","swx-utils-chat","swx-browser-detect","swx-focus-handler","swx-utils-common","swx-utils-chat","vendor/knockout","swx-service-locator-instance","swx-utils-chat","utils/common/cafeObservable","swx-i18n","swx-pubsub-instance","services/pes/constants","ui/modelHelpers/personHelper","swx-utils-common","ui/viewModels/chat/conversationTopic","ui/telemetry/actions/actionNames","telemetry/chat/sendSmsTelemetry","browser/window","ui/telemetry/telemetryClient","telemetry/chat/pes","swx-telemetry-buckets","swx-enums","utils/chat/translatorHelper","utils/chat/quoteMessageUtils","utils/common/accessibility"],function(e){function j(e,i){function ct(){return!!i.conversationModel}function ht(){var e=n.get().personsAndGroupsManager.mePerson.preferences(s.userSettings.preferences.TYPING_INDICATOR);return e?e.value():!0}function pt(){var e;if(!ct()||!rt.isFeatureOn(s.featureFlags.TYPING_INDICATOR_ENABLED)||!ht())return;e=i.conversationModel.chatService;if(!e.sendIsTyping.enabled())return;if(R.personsAndGroupsManager.mePerson.status()===_.onlineStatus.Hidden)return;X=!0,V=L.setTimeout(function(){X=!1},m.THROTTLE),e.sendIsTyping()}function dt(){z=j.messageBody().length,p.execute(e.updateSizing)}function vt(){return!!j.messageBody().trim()||!!j.quotedMessageHTML().trim()}function mt(){W&&(W=null,e.editing(!1),At())}function gt(t,n){var r=n.stopImmediatePropagation;return n._stopImmediatePropagationCalled=!1,n.stopImmediatePropagation=function(){n._stopImmediatePropagationCalled=!0,r.apply(n,arguments)},j.dispatchEvent(t,{event:n,viewModel:j,view:e},j.DIRECTION.CHILD),n._stopImmediatePropagationCalled}function yt(){return!!q}function bt(e){var t=e.isEdited?s.telemetry.chat.UI_EDIT_MESSAGE:s.telemetry.chat.UI_SEND_MESSAGE,n={emoticonsCount:e.emoticonsCount||0,messageLength:e.messageLength,participantsCount:Z()};ct()&&Z()===1&&(n.user_to=[i.conversationModel.participants()[0].person.id(),L.skypeTelemetryManager.PIIType.Identity]),e.isEdited&&(n.timedelta=e.timedelta),A.get().sendEvent(o.telemetry.uiTenantToken,t,n)}function wt(){var e=F._translatorSettings&&F._translatorSettings.isEnabled;return e&&(st=F._translatorSettings.meLanguage.code,ot=F._translatorSettings.participantLanguage.code),U&&e&&st&&ot&&st!==ot}function Et(e){e.translation?q(e.message,null,e):q(e.message)}function St(){var e=d.processOutgoingTextMessage(d.stripHTML(j.messageBody()));return d.isMessageWithEmoticonsOnly(e)}function xt(){return j.destination()===s.messageDestination.SKYPE_NETWORK}function Tt(){function n(){var t=o.messageFilters&&o.messageFilters.outgoingMessageFilter?o.messageFilters.outgoingMessageFilter:null,n=r.isFunction(t)?t(j.messageBody()):j.messageBody(),i={quotesPresent:kt(),quotedMessageXML:j.quotedMessageXML()};e==="RichText/Sms"&&(i.targets=[j.destination()]),q(n,e,i),e==="RichText/Sms"&&k.build(n,j.conversationModel,i.targets).publish()}var e=xt()?"RichText":"RichText/Sms";t.getInstance().startTrace("messagePostSuccess"),t.getInstance().startTrace("messagePost"),t.getInstance().startTrace("messageAdd");if(yt()){wt()&&!St()?D.requestTranslation(j.messageBody(),s.chat.messageType.OUTGOING,F,Et):n();var i=d.getEmoticonNamesFromMessage(d.processOutgoingTextMessage(j.messageBody())),u=g.resolve(s.serviceLocator.PES_MRU_SERVICE);u.addItemsToMru(r.map(i,function(e){return{id:e,type:S.itemTypes.emoticon.id}})),O.emoticonsSentInMessage(i,nt),nt=[],j.dispatchEvent(a.textarea.MESSAGE_SENT,{},j.DIRECTION.PARENT),bt({messageLength:j.messageBody().length,emoticonsCount:i.length})}}function Nt(e,t){var n=t.translation,i=r.filter(e.translations(),function(e){return e.users&&e.users[0]&&x.isMePersonId(e.users[0].mri)}).length;n&&(!e.translations||!e.translations().length||!i?e._translationsArray.add(n):e.translations().forEach(function(e){x.isMePersonId(e.users[0].mri)&&(e.users[0].value=n.users[0].value)})),e.html(t.message)}function Ct(){var e=d.getEmoticonNamesFromMessage(d.processOutgoingTextMessage(j.messageBody())),t=j.quotedMessageXML()+d.processOutgoingTextMessage(j.messageBody(),i.conversationModel),n=t.length,r=W.timestamp(),o=D.findMatchingTranslation(W.translations,F._translatorSettings),u=wt()&&(o&&o!==t||!o&&W.html()!==t),a={messageLength:n,emoticonsCount:e.length,isEdited:!0,timedelta:M.getMessageLifeDurationGroup(new Date-r)};u?(D.requestTranslation(j.messageBody(),s.chat.messageType.OUTGOING,F,Nt.bind(null,W)),bt(a),ft.announce({key:"message_edited_success"})):W.html()!==t&&(W.translations&&W.translations().length&&W.translations.empty(),W.html(t),bt(a),ft.announce({key:"message_edited_success"})),mt()}function kt(){return j.quotedMessageXML().length>0}function Lt(){j.quotedMessageHTML(""),j.quotedMessageXML(""),j.messageQuoted=undefined}function At(t){!t&&j.messageBody("").length&&j.messageBody(""),kt()&&Lt(),z=-1,dt(),E.publish(a.textarea.HAS_INPUT,!1),j.dispatchEvent(a.textarea.INPUT,{viewModel:j,view:e},j.DIRECTION.CHILD)}function Ot(e){if(e.type==="button")return e.isEditedMessage?C.chat.editMessageButton:C.chat.sendMessageButton;if(e.type==="enter")return e.isEditedMessage?C.chat.editMessageEnter:C.chat.sendMessageEnter}function Mt(e){var t=g.resolve(s.serviceLocator.ACTION_TELEMETRY),n=Ot(e);t.recordAction(n)}function _t(){Mt({type:"button",isEditedMessage:W}),Pt()}function Dt(){Mt({type:"enter",isEditedMessage:W}),Pt()}function Pt(){if(!vt())return;if(!W&&!yt())return;W?Ct():Tt(),W=null,At()}function Ht(){_t(),zt()}function Bt(e){if(W||yt())e.preventDefault(),Dt()}function jt(){var e=i.conversationModel.historyService.activityItems().reverse(),t=R.personsAndGroupsManager.mePerson.id();return e.filter(function(e){var n=e._isSMS&&e._isSMS();return e.sender&&e.sender.id()===t&&!n})[0]}function Ft(e){xt()||j.dispatchEvent(a.textarea.UPDATE_SMS_FRAGMENTS,e,j.DIRECTION.PARENT)}function It(e){$.chatInput=e,j.dispatchEvent(a.textarea.CHANGED,e,j.DIRECTION.PARENT),E.publish(a.textarea.HAS_INPUT,!0),Ft(e)}function qt(e){$.quotedMessageXML=e,j.dispatchEvent(a.textarea.CHANGED,e,j.DIRECTION.PARENT)}function Rt(e){$.quotedMessageHTML=e,j.dispatchEvent(a.textarea.CHANGED,e,j.DIRECTION.PARENT),E.publish(a.textarea.HAS_INPUT,!0)}function Ut(e){j.dispatchEvent(a.textarea.UPDATE_SMS_DESTINATION,{destination:e,inputText:j.messageBody()},j.DIRECTION.PARENT)}function zt(){h.get().addFocusRequestToQueue(i.chatInputEl.querySelector("textarea"),h.Priorities.Low)}function Wt(){if(!j.hasChatCapability())return;Xt()&&zt()}function Xt(){return Boolean(i.chatInputEl.offsetParent)}function Vt(){var e=j.hasChatCapability()?"area_text_insertText":"area_text_agent_insertText";return $t()&&(e="invite_free_respond_request"),j.destination()!==s.messageDestination.SKYPE_NETWORK&&rt.isFeatureOn(s.featureFlags.SMS_SUPPORT_ENABLED)&&(e="sms_input_text_message",!j.isEnabled()&&j.isPstnSmsOnly&&(e="sms_insufficient_balance")),w.fetch({key:e})}function $t(){function e(){return r.find(et(),function(e){return e.type()===_.activityType.ContactRequestIncomingInviteFree})}return e()&&rt.isFeatureOn(s.featureFlags.INVITE_FREE_IMPLICIT_INCOMING_CONTACT_REQUEST)}function Jt(e){var t=r.find(e.sourceTab.packs,function(t){return t.items.some(function(t){return t===e.item})});nt.push({item:e.item,type:e.sourceTab.id==="mru"?s.telemetry.pes.source.RECENTS:s.telemetry.pes.source.ROSTER,tabIndex:e.sourceTab.index,tabName:e.sourceTab.title,section:t&&t.isFeatured?s.telemetry.pes.section.FEATURED:s.telemetry.pes.section.REGULAR})}function Kt(t){t&&t.prefillTextarea&&!j.messageBody()&&(j.messageBody(w.fetch({key:"unanswered_call_chatinput_placeholder"})),e.setCaretToEnd()),t&&t.focusTextarea&&zt()}function Qt(t){var n=e.getSelectionStart(),r=e.getSelectionEnd();n===0&&r===0&&(At(!0),t.stopPropagation(),ft.announce({key:"label_text_clearedQuotes"}))}function Gt(e){return e===u.ESCAPE&&!Yt()?!0:e===u.BACKSPACE&&j.messageBody()===""&&kt()?!0:!1}function Yt(){return j.messageBody().length===0&&!kt()}function Zt(e){return e.preventDefault(),e.stopPropagation(),c.getBrowserInfo().isIeEngine&&(e.returnValue=!1),!1}function en(){return ut&&xt()}function tn(e,t){var n=e.sender.displayName(),r=n||e.sender.id(),i=l.formatTimestamp(e.timestamp()),s=t||P.getContentToQuote(e),o="["+i+"] "+n+": "+s+" \n \n <<< ";j.narratorTextForQuotes(w.fetch({key:"label_quoted_message",params:{quotesContent:s,senderName:n,time:i}}));if(en()){var u=j.conversationModel&&j.conversationModel.conversationId?j.conversationModel.conversationId:"";o=P.getQuotedXmlString(e.sender.id(),r,s,u,e.timestamp())}return o}function nn(e){j.quotedMessageXML(e),j.quotedMessageHTML(P.getQuotesDisplay(j.quotedMessageXML()))}var j=this,F=i.conversationModel,I=F&&F.chatService.sendMessage,q=i.sendMessage||I,R=n.get(),U=R.translatorService,z=-1,W=null,X=!1,V,$,J,K,Q,G,Y,Z=ct()?b.newObservableProperty(i.conversationModel.participantsCount):v.observable(1),et=ct()?b.newObservableCollection(i.conversationModel.historyService.activityItems):v.observableArray(),tt="active",nt=[],rt=g.resolve(s.serviceLocator.FEATURE_FLAGS),it=rt.isFeatureOn(s.featureFlags.TRANSLATOR_SENDING_ENABLED),st,ot,ut=rt.isFeatureOn(s.featureFlags.FORMAT_QUOTES_ENABLED),at=rt.isFeatureOn(s.featureFlags.CONTEXT_MENU_COPY_MESSAGES_ENABLED),ft=H.narrator,lt;j.init=function(){ct()?$=y.forModel(i.conversationModel):$={chatInput:null,quotedMessageXML:null,quotedMessageHTML:null},lt=n.get().conversationsManager,j.conversationModel=i.conversationModel,j.isEnabled=v.observable(i.isEnabled),j.isServiceEnabled=i.isServiceEnabled,j.hasChatCapability=i.hasChatCapability,j.getSelectionStart=e.getSelectionStart,j.setBlurAndFocus=Wt,j.messageMaxLength=s.textarea.MAX_LENGTH,j.destination=i.destination||v.observable(s.messageDestination.SKYPE_NETWORK),j.isPstnSmsOnly=i.isPstnSmsOnly||!1,j.topicViewModel=N.build(i.conversationModel),Y=j.isEnabled().subscribe(function(e){e&&p.execute(Wt)}),j.messageBody=v.observable(),J=j.messageBody.subscribe(It),j.messageBody($.chatInput||""),G=j.destination.subscribe(Ut),j.quotedMessageHTML=v.observable($.quotedMessageHTML||""),j.quotedMessageXML=v.observable($.quotedMessageXML||""),j.narratorTextForQuotes=v.observable(""),j.label=v.pureComputed(function(){return Z()<2?w.fetch({key:"label_text_insertText_oneToOne",params:{displayName:j.topicViewModel.topic(),quotedText:j.quotedMessageHTML()!==""?j.narratorTextForQuotes():""}}):w.fetch({key:"label_text_insertText_group",params:{displayName:j.topicViewModel.topic(),participantsText:w.fetch({key:"label_text_participant",count:Z()}),quotedText:j.quotedMessageHTML()!==""?j.narratorTextForQuotes():""}})}),j.placeholder=v.computed(Vt),j.selectedSuggestion=v.observable(),dt(),K=j.quotedMessageXML.subscribe(qt),Q=j.quotedMessageHTML.subscribe(Rt),j.registerEvent(a.textarea.SUBMIT_AND_FOCUS,Ht),j.registerEvent(a.emoticonPicker.EMOTICON_SELECTED,j.insertAtCursor),j.registerEvent(f.EVENTS.CALL_SCREEN_CLOSE,zt),j.registerEvent(f.EVENTS.UNANSWERED_CALL_CLOSE,Kt),j.registerEvent(a.message.QUOTE,j.quoteMessageText),j.registerEvent(a.message.EDIT,j.requestEditMessageText),j.registerEvent(a.expressionPicker.CLOSE_REQUEST,Wt),j.registerEvent(a.shareControl.SHARE_CONTROL_HIDE,zt),j.registerEvent(a.suggestionList.ITEM_SELECTED,j.selectedSuggestion),E.subscribe(a.textarea.UPDATE_SMS_DESTINATION,j.updateQuotedMessage),E.subscribe(a.newConversation.CANCELLED,zt),E.subscribe(a.navigation.FRAGMENT_LOADED,Wt),E.subscribe(a.navigation.LEAVE_EDIT_MODE,zt),E.subscribe(a.expressionPicker.ITEM_SEND_REQUEST,j.insertAtCursor),E.subscribe(a.textarea.UPDATE_TEXTAREA_ENABLE,j.updateTextAreaEnable),j.dispatchEvent(a.textarea.INITIALIZATION_COMPLETE,j,j.DIRECTION.PARENT),Wt()},j.dispose=function(){L.clearTimeout(V),E.unsubscribe(a.newConversation.CANCELLED,zt),E.unsubscribe(a.navigation.LEAVE_EDIT_MODE,zt),E.unsubscribe(a.navigation.FRAGMENT_LOADED,Wt),E.unsubscribe(a.expressionPicker.ITEM_SEND_REQUEST,j.insertAtCursor),E.unsubscribe(a.textarea.UPDATE_SMS_DESTINATION,j.updateQuotedMessage),E.unsubscribe(a.textarea.UPDATE_TEXTAREA_ENABLE,j.updateTextAreaEnable),Y.dispose(),J.dispose(),K.dispose(),Q.dispose(),j.placeholder.dispose(),j.topicViewModel.dispose(),G.dispose()},j.updateTextAreaEnable=function(e){j.isPstnSmsOnly&&j.isEnabled(e)},j.insertAtCursor=function(t,n){var r,s,o,u,a=t.item;if(a.type!=="emoticon"||t.conversation!==i.conversationModel)return;Jt(t),r=n||e.getSelectionStart(),s=j.messageBody(),o=a.shortcut+" ",u=T.inject(s,o,r),j.messageBody(u),e.setCursorAt(r+o.length),Wt()},j.handleKeyDown=function(e,t){if(gt(a.textarea.KEY_DOWN,t))return!1;var n=t.keyCode||t.which;return n===u.UP&&e.messageBody()===""&&e.requestEditMessageText(),Gt(n)?(mt(),At(),t.stopPropagation(),ft.announce({key:"label_text_clearedText"})):n===u.BACKSPACE&&kt()&&Qt(t),!0},j.handleInput=function(){j.messageBody().length!==z&&dt(),Yt()&&(E.publish(a.textarea.HAS_INPUT,!1),mt()),j.dispatchEvent(a.textarea.INPUT,{viewModel:j,view:e},j.DIRECTION.CHILD)},j.handleKeyPress=function(e,t){if(gt(a.textarea.KEY_PRESS,t))return!1;var n=t.keyCode||t.which;return n===u.ENTER&&!t.shiftKey?Bt(t):X||pt(),!0},j.onFocus=function(){i.chatInputEl.addClass(tt)},j.onBlur=function(){i.chatInputEl.removeClass(tt),e.updateSizing()},j.onBeforePaste=function(e,t){return Zt(t)},j.onPaste=function(t,r){function b(e){e.name=B,o.push(e)}function E(){var e=lt._getMessageCopiedToCache(),t=e&&e.sourceMessage;if(!t)return!1;var n=e.selectedText,r=n?n:P.getContentToQuote(t);return r&&r.replace(/\n/g,"")===v?(j.quoteMessageText(t,n),v="",!0):!1}function S(){if(en()&&at){var e=E();e||lt._setMessageCopiedToCache(undefined)}}var i=r.clipboardData||L.clipboardData,o=[],u=!!L.clipboardData,a=rt.isFeatureOn(s.featureFlags.FILE_PASTE_ENABLED),f=j.conversationModel.fileTransferService.send.enabled(),l=a&&n.get().personsAndGroupsManager.mePerson.preferences(s.userSettings.preferences.FILE_PASTE).value(),c=a&&f&&l,h,d,v,m,g,y;r.originalEvent&&(i=i||r.originalEvent.clipboardData),h=i.getData("Text");if(!h&&c){u?Array.prototype.forEach.call(i.files,function(e){b(e)}):Array.prototype.some.call(i.types,function(e){return e==="Files"})&&Array.prototype.forEach.call(i.items,function(e){var t=e.getAsFile();t&&b(t)});if(o.length)return j.conversationModel.fileTransferService.send(o),Zt(r)}h=i.getData("Text"),v="",m=j.messageBody(),g=e.getSelectionStart(),y=e.getSelectionEnd(),d=j.messageMaxLength-m.length+y-g,h=h.trim();for(var w=0;w<h.length&&d>0;w++)v+=h[w],d--;return S(),j.messageBody(T.inject(m,v,g,y)),p.execute(function(){e.setCursorAt(g+v.length)}),dt(),Zt(r)},j.quoteMessageText=function(t,n){var r=tn(t,n);mt(),j.messageQuoted=t,en()?nn(r):j.messageBody(r+j.messageBody()),dt(),p.execute(e.setCaretToEnd)},j.updateQuotedMessage=function(){if(kt()&&!xt()){var e=j.messageQuoted;Lt(),j.quoteMessageText(e)}},j.requestEditMessageText=function(t){if(!ct())return;var n=i.conversationModel.historyService.activityItems();if(!n.length)return;t=t||jt();if(!t||t.type()===_.activityType.SystemMessage)return;if(t.html&&t.html.set.enabled()&&t.text){At();var s=d.compactHtml(t.html()),o=D.findMatchingTranslation(t.translations,F._translatorSettings),u=it&&o?o:s,a=d.quotesPresentInHTML(u);if(a){var f=d.quotesPresentInXML(t.getOriginalContent());j.quotedMessageHTML(a),j.quotedMessageXML(f),u=r.isUndefined(u)?"":u.replace(a,"")}t._skypeemoteoffset&&(u=u.substr(t._skypeemoteoffset)),u=d.extractMessageTextContent(u),j.messageBody(u),W=t,dt(),p.execute(e.setCaretToEnd),e.editing(!0)}}}var t=e("services/telemetry/logging/perf/main"),n=e("swx-cafe-application-instance"),r=e("lodash-compat"),i=e("utils/common/eventMixin"),s=e("swx-constants").COMMON,o=e("experience/settings"),u=e("swx-constants").KEYS,a=s.events,f=e("swx-constants").CALLING,l=e("swx-utils-chat").dateTime,c=e("swx-browser-detect").default,h=e("swx-focus-handler"),p=e("swx-utils-common").async,d=e("swx-utils-chat").messageSanitizer,v=e("vendor/knockout"),m=s.isTyping,g=e("swx-service-locator-instance").default,y=e("swx-utils-chat").conversationCache,b=e("utils/common/cafeObservable"),w=e("swx-i18n").localization,E=e("swx-pubsub-instance").default,S=e("services/pes/constants"),x=e("ui/modelHelpers/personHelper"),T=e("swx-utils-common").stringUtils,N=e("ui/viewModels/chat/conversationTopic"),C=e("ui/telemetry/actions/actionNames"),k=e("telemetry/chat/sendSmsTelemetry"),L=e("browser/window"),A=e("ui/telemetry/telemetryClient"),O=e("telemetry/chat/pes"),M=e("swx-telemetry-buckets"),_=e("swx-enums"),D=e("utils/chat/translatorHelper"),P=e("utils/chat/quoteMessageUtils"),H=e("utils/common/accessibility"),B="fileFromClipboard";return r.assign(j.prototype,i),j}),define("jsviews/chat/textarea",["require","browser/dom","swx-focus-handler"],function(e){function u(e,u){function h(){try{var e=l.placeholder,t=window.getComputedStyle(l),n=document.createElement("canvas").getContext("2d");return n.font=t.fontSize+" "+t.fontFamily,n.measureText(e).width>parseInt(t.width)?2*parseInt(t.lineHeight):parseInt(t.lineHeight)}catch(r){return 0}}var a=this,f=e,l=t.getElement("textarea",e),c=t.getElementById("chatInputContainer",e);u=t.getElement(u),a.updateSizing=function(){var e,n,r=t.getElementById("quoteContainer",f),u=c&&c.scrollTop;l.style.height=i+"px",e=l.value===""?h():l.scrollHeight,e=Math.max(i,e),l.style.height=e+"px";if(!c)return;n=e+o+(r?r.scrollHeight:0),n<s?c.style.height=n+"px":(c.style.height=s+"px",c.scrollTop=u)},a.setCaretToEnd=function(){n.get().addFocusRequestToQueue(l);if(typeof l.selectionStart=="number"){l.selectionStart=l.selectionEnd=l.value.length;return}if(typeof l.createTextRange!="undefined"){var e=l.createTextRange();e.collapse(!1),e.select()}},a.getSelectionStart=function(){return l.selectionStart},a.getSelectionEnd=function(){return l.selectionEnd},a.setCursorAt=function(e){l.selectionStart=e,l.selectionEnd=e},a.editing=function(e){e?u.addClass(r):u.removeClass(r)}}var t=e("browser/dom"),n=e("swx-focus-handler"),r="EDITING",i=30,s=180,o=9;return u}),define("text!views/chat/textarea.html",[],function(){return"<swx-suggestion-list></swx-suggestion-list>\r\n\r\n<div id='chatInputContainer' class = 'container'>\r\n\r\n<!-- ko if: quotedMessageXML().length > 0 -->\r\n<div id='quoteContainer' data-bind=\"html:quotedMessageHTML\" ></div>\r\n<!-- /ko -->\r\n\r\n<textarea id=\"chatInputAreaWithQuotes\" data-bind=\"value: messageBody, enable: isEnabled(), css: {hide: !isServiceEnabled()},\r\n        valueUpdate: ['afterkeydown','propertychange','input'],\r\n        event: {\r\n            keypress: handleKeyPress,\r\n            keydown: handleKeyDown,\r\n            input: handleInput,\r\n            focus: onFocus,\r\n            blur: onBlur,\r\n            paste: onPaste,\r\n            beforepaste: onBeforePaste },\r\n        focusHandler: { priority: 2 },\r\n        l10n_attr: {'placeholder': placeholder},\r\n        attr: {\r\n            'aria-label': label,\r\n            'maxlength': messageMaxLength,\r\n            'aria-activedescendant' : (selectedSuggestion()!= null) && ('suggestionList-item-'+selectedSuggestion()) }\"\r\n      name=\"messageInput\"\r\n      aria-live=\"polite\"\r\n      class=\"inputField fontSize-p\"\r\n      aria-autocomplete=\"list\"\r\n      aria-owns=\"suggestionList\"\r\n      role=\"combobox\"></textarea>\r\n</div>\r\n\r\n\r\n"}),define("ui/components/chat/textarea",["require","exports","module","vendor/knockout","ui/viewModels/chat/textarea","jsviews/chat/textarea","constants/components","text!views/chat/textarea.html"],function(e,t){function s(e,t){var s=t.element,o=new i(s,e.chatInputEl),u=new r(o,e),a=n.dataFor(s);return u.setContext(a),u.init(),u}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/textarea"),i=e("jsviews/chat/textarea");t.name=e("constants/components").chat.TEXTAREA,t.template=e("text!views/chat/textarea.html"),t.viewModel={createViewModel:s}}),define("telemetry/chat/menuItemTelemetry",["require","exports","module","swx-constants","experience/settings","utils/common/styleModeHelper","swx-service-locator-instance","ui/telemetry/telemetryClient"],function(e,t){function f(){function l(){e.data={narrow:t,button:t,ordinal:t,navigationMenuIconsEnabled:t}}function c(e){for(var t in e)e.hasOwnProperty(t)&&!(typeof e[t]=="string"||e[t]instanceof String)&&(e[t]=e[t]+"");return e}var e=this,t=n.telemetry.NOT_AVAILABLE,f=u.resolve(n.serviceLocator.FEATURE_FLAGS);e.publish=function(u){e.data.narrow=o.get().currentMode()===s.NARROW,e.data.button=u.id||t,e.data.ordinal=u.ordinal||t,e.data.navigationMenuIconsEnabled=f.isFeatureOn(n.featureFlags.NAVIGATION_MENU_ICONS_ENABLED);var h=i.TYPE,p=c(e.data);a.get().sendEvent(r.telemetry.chatTenantToken,h,p),l()},l()}var n=e("swx-constants").COMMON,r=e("experience/settings"),i=n.telemetry.menuItemClicked,s=n.styleMode,o=e("utils/common/styleModeHelper"),u=e("swx-service-locator-instance").default,a=e("ui/telemetry/telemetryClient");t.build=function(){return new f}}),define("ui/viewModels/chat/menuItem",["require","exports","module","lodash-compat","vendor/knockout","usertiming","utils/common/eventHelper","swx-constants","swx-service-locator-instance","experience/settings","ui/telemetry/telemetryClient","telemetry/chat/menuItemTelemetry"],function(e,t){function c(e){var t=this,n=h(e),c=l.build(),p=u.resolve(o.serviceLocator.FEATURE_FLAGS);t.id=n.id?"menuItem-"+n.id:n.id,t.icon=n.icon,t.text=n.text,t.page=n.navigation.page,t.isActive=r.observable(!1),t.isDisabled=n.isDisabled?n.isDisabled:r.observable(!1),t.isNavigationMenuIconsEnabled=p.isFeatureOn(o.featureFlags.NAVIGATION_MENU_ICONS_ENABLED),t.onKeyDown=function(e,n){var r=s.isActivation(n);return r&&t.onClick(),!r},t.onClick=function(){var r=n.telemetry,s=u.resolve(o.serviceLocator.PUBSUB),l=u.resolve(o.serviceLocator.ACTION_TELEMETRY);r.uiAction&&l.recordAction(r.uiAction),r.perfMarker&&i.mark(r.perfMarker),r.event&&f.get().sendEvent(a.uiTenantToken,r.event.name,r.event.data),e.ordinal=t.ordinal,c.publish(e),t.isActive(!0),s.publish(o.events.navigation.NAVIGATE,e.navigation)},t.getTitleText=function(){if(t.isNavigationMenuIconsEnabled)return t.text}}function h(e){var t="";return n.merge({id:t,icon:t,text:t,navigation:{page:t,origin:t},telemetry:{uiAction:t,perfMarker:t,event:t}},e)}var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("usertiming"),s=e("utils/common/eventHelper"),o=e("swx-constants").COMMON,u=e("swx-service-locator-instance").default,a=e("experience/settings").telemetry,f=e("ui/telemetry/telemetryClient"),l=e("telemetry/chat/menuItemTelemetry");t.build=function(e){return new c(e)}}),define("ui/viewModels/chat/sidebar",["require","lodash-compat","vendor/knockout","swx-i18n","constants/components","swx-constants","swx-cafe-application-instance","ui/telemetry/actions/actionNames","swx-service-locator-instance","ui/viewModels/chat/menuItem","ui/telemetry/actions/actionSources"],function(e){function p(){function b(){e.itemsDisabled(!1)}function w(){e.itemsDisabled(!0)}function E(t){e.isNotificationsCenterActive(t),t&&e.isSearchActive(!1)}function S(t){var n={source:l.search.reset.content},r=e.userSettingsMenuItem();e.items().forEach(function(e){e.isActive(e.page===t.page),g.publish(h.search.RESET,n)}),r.page!==t.page&&r.isActive(!1)}function x(){e.isSearchActive(!1)}function T(t){t!==""&&e.isSearchActive(!0)}function N(){var t=[];return e.isNavigationMenuIconsEnabled?(t.push(f.build(k())),v&&t.push(f.build(L())),d&&t.push(f.build(A())),e.isUserSettingsEnabled()&&t.push(f.build(O())),t.push(f.build(C()))):e.isSidebarInAlternativeLayout?(t=[f.build(C()),f.build(k())],v&&t.push(f.build(L())),d&&t.push(f.build(A()))):(t=[f.build(k())],v&&t.push(f.build(L())),t.push(f.build(C())),d&&t.push(f.build(A()))),t.forEach(function(e,t){e.ordinal=t+1}),t}function C(){return{navigation:{page:i.chat.NEW_CONVERSATION,origin:c.NEW_CHAT_DUMMY},id:"newChat",icon:"add",text:r.fetch({key:"button_text_newChat"}),isDisabled:e.itemsDisabled}}function k(){return{navigation:{page:i.people.CONTACTS_PAGE,origin:c.CONTACTS_PAGE},telemetry:{uiAction:u.contacts.openPage,perfMarker:s.telemetry.performanceMarks.CONTACTS.PAGE.OPENED},id:"contacts",icon:"skypeAddressBook",text:r.fetch({key:"contactPage_text_menuLink"}),isDisabled:e.itemsDisabled}}function L(){return{navigation:{page:i.people.DISCOVER_AGENTS_PAGE,origin:c.DISCOVER_AGENTS_PAGE},telemetry:{uiAction:u.discoverAgents.openPage,perfMarker:s.telemetry.performanceMarks.DISCOVER_AGENTS.PAGE.OPENED},id:"discoverAgents",icon:"botAdd",text:r.fetch({key:"button_text_discover_agents"}),isDisabled:e.itemsDisabled}}function A(){return{navigation:{page:i.calling.SKYPEOUT_PAGE,origin:c.SKYPEOUT_PAGE},telemetry:{uiAction:u.skypeOut.openPage,perfMarker:s.telemetry.performanceMarks.SKYPEOUT.PAGE.OPENED,event:{name:s.telemetry.pstn.eventName.PSTN_BUTTON_CLICKED,data:{}}},id:"dialpad",icon:"dialpad",text:r.fetch({key:"button_text_dialpad"}),isDisabled:e.itemsDisabled}}function O(){return{navigation:{page:i.userSettings.USER_SETTINGS_PAGE,origin:c.SKYPEOUT_PAGE},telemetry:{uiAction:u.userSettings.openPage,perfMarker:s.telemetry.performanceMarks.USER_SETTINGS.PAGE.OPENED},id:"userSettings",icon:"settings",text:r.fetch({key:"settings_page_text_header"}),isDisabled:e.itemsDisabled}}function M(){var n=t.clone(e.items()),r=m?n.length-2:n.length-1;e.items.removeAll(),n.splice(r,0,f.build(O())),n.forEach(function(t){e.items.push(t)})}var e=this,p=a.resolve(s.serviceLocator.FEATURE_FLAGS),d=p.isFeatureOn(s.featureFlags.PSTN_ENABLED),v=p.isFeatureOn(s.featureFlags.AGENTS_DISCOVERABLE),m=p.isFeatureOn(s.featureFlags.ALTERNATIVE_SETTINGS_POSITION),g=a.resolve(s.serviceLocator.PUBSUB),y=t.once(M);e.items=n.observableArray(),e.itemsDisabled=n.observable(!0),e.userSettingsMenuItem=n.observable(),e.isSearchActive=n.observable(!1),e.isNotificationsCenterActive=n.observable(!1),e.isNavigationMenuIconsEnabled=p.isFeatureOn(s.featureFlags.NAVIGATION_MENU_ICONS_ENABLED),e.isNotificationsCenterEnabled=p.isFeatureOn(s.featureFlags.NOTIFICATIONS_CENTER),e.isSidebarInAlternativeLayout=p.isFeatureOn(s.featureFlags.ALTERNATIVE_SIDEBAR_LAYOUT_ENABLED),e.isUserSettingsEnabled=n.observable(!1),e.hideRecents=n.computed(function(){return e.isSearchActive()||e.isNotificationsCenterActive()}),e.init=function(){function n(){var n=o.get().personsAndGroupsManager.mePerson.preferences(),r=p.isFeatureOn(s.featureFlags.USER_SETTINGS_ENABLED);e.isUserSettingsEnabled(r&&!!n.length),e.isNavigationMenuIconsEnabled&&e.isUserSettingsEnabled()&&y(),t&&(t.dispose(),t=null)}var t;g.subscribe(h.search.RESET,x),g.subscribe(h.search.QUERY_CHANGED,T),g.subscribe(h.navigation.NAVIGATE,S),g.subscribe(h.navigation.NOTIFICATIONS_CENTER,E),g.subscribe(s.apiUIEvents.SWX_TIMELINE_LOADED,b),g.subscribe(s.apiUIEvents.SWX_ON_SIGN_OUT,w),N().forEach(function(t){e.items.push(t)}),e.userSettingsMenuItem(f.build(O())),o.get().personsAndGroupsManager.mePerson.preferences().length?n():t=o.get().personsAndGroupsManager.mePerson.preferences.changed(n)},e.dispose=function(){g.unsubscribe(h.search.RESET,x),g.unsubscribe(h.search.QUERY_CHANGED,T),g.unsubscribe(h.navigation.NAVIGATE,S),g.unsubscribe(h.navigation.NOTIFICATIONS_CENTER,E),g.unsubscribe(s.apiUIEvents.SWX_TIMELINE_LOADED,b),g.unsubscribe(s.apiUIEvents.SWX_ON_SIGN_OUT,w),e.hideRecents.dispose()}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-i18n").localization,i=e("constants/components"),s=e("swx-constants").COMMON,o=e("swx-cafe-application-instance"),u=e("ui/telemetry/actions/actionNames"),a=e("swx-service-locator-instance").default,f=e("ui/viewModels/chat/menuItem"),l=e("ui/telemetry/actions/actionSources"),c=s.telemetry.historyLoadOrigin,h=s.events;return p}),define("text!views/chat/sidebar.html",[],function(){return'<!-- ko if: isSidebarInAlternativeLayout  -->\r\n    <div class="navigation beforeSearch">\r\n        <div role="menubar" data-bind="foreach: items">\r\n            <swx-menu-item params="viewModel: $data"></swx-menu-item>\r\n        </div>\r\n        <!-- ko if: isNotificationsCenterEnabled -->\r\n        <swx-notifications-menu-item params="isDisabled: itemsDisabled"></swx-notifications-menu-item>\r\n        <!-- /ko -->\r\n    </div>\r\n    <!-- ko ifnot: isNotificationsCenterActive -->\r\n    <div class="search afterMenuItems" data-bind="css: {active: isSearchActive}">\r\n        <div class="splitter"></div>\r\n        <swx-search-input></swx-search-input>\r\n        <swx-search-results></swx-search-results>\r\n    </div>\r\n    <!-- /ko -->\r\n<!-- /ko -->\r\n\r\n<!-- ko ifnot: isSidebarInAlternativeLayout  -->\r\n<div class="search beforeMenuItems" data-bind="css: {active: isSearchActive}">\r\n    <swx-search-input></swx-search-input>\r\n    <div class="splitter"></div>\r\n    <swx-search-results></swx-search-results>\r\n</div>\r\n<div class="navigation afterSearch" data-bind="css: {hide: isSearchActive}">\r\n    <div role="menubar" data-bind="foreach: items, keyboardNavigation: { itemSelector: \'a\' }, css: { navigationMenuIcons: isNavigationMenuIconsEnabled }">\r\n        <swx-menu-item params="viewModel: $data" role="presentation"></swx-menu-item>\r\n    </div>\r\n    <!-- ko if: isNotificationsCenterEnabled -->\r\n    <swx-notifications-menu-item params="isDisabled: itemsDisabled"></swx-notifications-menu-item>\r\n    <!-- /ko -->\r\n</div>\r\n<!-- /ko -->\r\n\r\n<swx-recents params="buttonsDisabled: itemsDisabled" class="timeline" data-bind="css: {hide: hideRecents}"></swx-recents>\r\n<!-- ko if: isUserSettingsEnabled() && !isNavigationMenuIconsEnabled -->\r\n<div class="navigation afterTimeline" data-bind="keyboardNavigation: { itemSelector: \'a\' }">\r\n    <swx-menu-item params="viewModel: userSettingsMenuItem"></swx-menu-item>\r\n</div>\r\n<!-- /ko -->\r\n\r\n<!-- ko if: isNotificationsCenterEnabled && isNotificationsCenterActive() -->\r\n<swx-notifications></swx-notifications>\r\n<!-- /ko -->\r\n\r\n'}),define("ui/components/chat/sidebar",["require","exports","module","ui/viewModels/chat/sidebar","constants/components","text!views/chat/sidebar.html"],function(e,t){function r(){var e=new n;return e.init(),e}var n=e("ui/viewModels/chat/sidebar");t.name=e("constants/components").chat.SIDEBAR,t.template=e("text!views/chat/sidebar.html"),t.viewModel={createViewModel:r}}),define("text!views/chat/contactPill.html",[],function(){return'<span class="tile" data-bind="css: statusClassName">\r\n    <span class="tileName presence square">\r\n        <h4 data-bind="text: displayName"></h4>\r\n    </span>\r\n</span>\r\n'}),define("ui/components/chat/contactPill",["require","exports","module","ui/viewModels/people/contact","ui/viewModels/people/contactBuilder","constants/components","text!views/chat/contactPill.html"],function(e,t){function i(e){if(e&&typeof e.person=="object")return e.person instanceof n?e.person:r.build(e.person);throw new Error('missing parameter: "person"')}var n=e("ui/viewModels/people/contact"),r=e("ui/viewModels/people/contactBuilder");t.name=e("constants/components").chat.CONTACT_PILL,t.template=e("text!views/chat/contactPill.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/contactCard",["require","lodash-compat","vendor/knockout","swx-i18n","ui/telemetry/actions/actionSources","utils/common/cafeObservable","swx-enums","swx-constants","utils/common/eventHelper","utils/common/eventMixin","ui/contextMenu/contextMenu","swx-service-locator-instance","ui/contextMenu/items/all","ui/modelHelpers/personHelper","ui/viewModels/people/contactBuilder"],function(e){function m(e){function C(e){var t=document.createEvent("MouseEvents"),n=e.target.getBoundingClientRect();return t.initMouseEvent("contextmenu",!0,!1,window,0,0,0,n.right,n.top,!1,!1,!0,!1,2,null),e.target.dispatchEvent(t),a.swallow(e),e.stopPropagation(),t}var f=e.participant,m=s.newObservableProperty(e.model.participants.remove.enabled),b=d.build(f.person),w=this,E=s.newObservableProperty(f.role),S=c.resolve(u.serviceLocator.FEATURE_FLAGS),x=S.isFeatureOn(u.featureFlags.DISABLE_CONTACT_CARD_MENU),T=S.isFeatureOn(u.featureFlags.HIDE_USER_ROLE),N=n.computed(function(){return E()===o.participantRole.Leader?v.ADMIN:f.isAnonymous()?v.GUEST:v.ATTENDEE});t.merge(w,b),w.role=n.computed(function(){var e;return T?"":N()===v.ATTENDEE?"":(e="header_text_"+N(),N()===v.ADMIN&&g()&&(e=y(e)),r.fetch({key:e}))}),w.chevronAriaLabel=n.computed(function(){return r.fetch({key:"accessibility_groupProfile_"+N()+"Menu",params:{participantName:w.displayName()}})}),w.isMenuDisabled=n.computed(function(){return x?!0:(e.model.selfParticipant.isAnonymous()||f.isAnonymous())&&!m()}),w.dispose=function(){b.dispose(),N.dispose(),w.role.dispose(),w.chevronAriaLabel.dispose(),w.isMenuDisabled.dispose()},w.onMenuHandlerKeydown=function(e,t){var n,r=a.isActivation(t);return r&&(n=C(t),w.menuHandler(e,n)),!r},w.menuHandler=function(t,n){var r=[],s={source:i.conversation.groupRoster};!f.isAnonymous()&&!e.model.selfParticipant.isAnonymous()&&((S.isFeatureOn(u.featureFlags.PSTN_ENABLED)||!p.isPstn(f.person))&&r.push(new h.OpenConversationWithPersonMenuItem(f.person)),r.push(new h.ViewPersonProfileMenuItem(f.person,u.telemetry.historyLoadOrigin.ROSTER,s))),m()&&r.push(new h.RemoveParticipantMenuItem(e.model,e.participant)),l.show(r,n)}}function g(){return c.resolve(u.serviceLocator.FEATURE_FLAGS).isFeatureOn(u.featureFlags.USE_BUSINESS_WORDING)}function y(e){return e+"_4b"}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-i18n").localization,i=e("ui/telemetry/actions/actionSources"),s=e("utils/common/cafeObservable"),o=e("swx-enums"),u=e("swx-constants").COMMON,a=e("utils/common/eventHelper"),f=e("utils/common/eventMixin"),l=e("ui/contextMenu/contextMenu"),c=e("swx-service-locator-instance").default,h=e("ui/contextMenu/items/all"),p=e("ui/modelHelpers/personHelper"),d=e("ui/viewModels/people/contactBuilder"),v={GUEST:"guest",ADMIN:"admin",ATTENDEE:"attendee"};return t.assign(m.prototype,f),m}),define("text!views/chat/contactCard.html",[],function(){return'<swx-avatar params="avatar: avatar, status: statusClassName, displayName: displayNameUnescaped, isPstn: isPstn, size: 40"></swx-avatar>\r\n<div class="text">\r\n    <span class="role fontSize-p smaller" data-bind="text: role"></span>\r\n    <span class="tile swxTileName">\r\n        <span class="tileName">\r\n            <span role="button" class="navigation-item">\r\n                <h4 data-bind="text: displayNameUnescaped"></h4>\r\n                <a role="listitem" class="menu iconfont chevronDown btnOutline" data-bind="event: {keydown: onMenuHandlerKeydown, click: menuHandler }, css: { hide: isMenuDisabled }, attr: {\'aria-label\': chevronAriaLabel}"></a>\r\n            </span>\r\n        </span>\r\n    </span>\r\n    <span class="tile">\r\n        <span class="tileMessage circle">\r\n            <div class="message">\r\n                <p data-bind="html: displayMessage"></p>\r\n            </div>\r\n        </span>\r\n    </span>\r\n</div>\r\n\r\n'}),define("ui/components/chat/contactCard",["require","exports","module","vendor/knockout","ui/viewModels/chat/contactCard","constants/components","text!views/chat/contactCard.html"],function(e,t){function i(e,t){var i=new r(e);return i.setContext(n.dataFor(t.element)),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/contactCard");t.name=e("constants/components").chat.CONTACT_CARD,t.template=e("text!views/chat/contactCard.html"),t.viewModel={createViewModel:i}}),define("text!views/chat/timeline/menuItem.html",[],function(){return'<a href="#" role="menuitem" class="navItem"\r\n   data-bind="css: {active: isActive, icon: isNavigationMenuIconsEnabled}, visible: !isDisabled(), event: {click: onClick, keydown: onKeyDown}, attr: {\'aria-label\': getTitleText(), id: id }">\r\n        <span class="icon">\r\n            <span class="iconfont" data-bind="css: icon, attr: { title: getTitleText() }"></span>\r\n        </span>\r\n        <span class="text">\r\n            <h4 data-bind="text: text"></h4>\r\n        </span>\r\n</a>\r\n'}),define("ui/components/chat/menuItem",["require","exports","module","text!views/chat/timeline/menuItem.html","constants/components"],function(e,t){function r(e){return e.viewModel}var n=e("text!views/chat/timeline/menuItem.html");t.name=e("constants/components").chat.MENU_ITEM,t.viewModel={createViewModel:r},t.template=n}),define("ui/telemetry/chat/guestActionsInHeader",["require","exports","module","swx-constants","experience/settings","swx-cafe-application-instance","usertiming","ui/telemetry/telemetryClient","ui/modelHelpers/personHelper"],function(e,t){function h(){function t(e){if(!n())return;var t={ttp:c(),participantsNumber:e.participantsCount,totalMessagesCount:e.totalMessagesCount,userMessagesCount:e.userMessagesCount,cta:e.cta};o.get().sendEvent(r.telemetry.uiTenantToken,"chat_guest_headerActions",t)}function n(){return u.isGuest(i.get().personsAndGroupsManager.mePerson)}function c(){s.mark(f.CONVERSATION.TTP),s.measure(l.EXPERIENCE.TTL,f.EXPERIENCE.TTL_START,f.CONVERSATION.TTP);var e=s.getEntriesByName(l.EXPERIENCE.TTL),t=e&&e.length?e[0].duration:"undefined";return s.clearMeasures(l.EXPERIENCE.TTL),s.clearMarks(f.CONVERSATION.TTP),t}var e=this;return e.onProfileToggled=function(e){e.cta=a.cta.PROFILE_TOGGLED,e.telemetryItem===a.telemetryItem.AVATAR?e.cta=1:e.telemetryItem===a.telemetryItem.TOPIC?e.cta=e.groupProfileExpanded?3:2:e.telemetryItem===a.telemetryItem.CHEVRON_DOWN?e.cta=4:e.telemetryItem===a.telemetryItem.CHEVRON_UP&&(e.cta=5),t(e)},e.onCopyLinkClicked=function(e){e.cta=a.cta.COPY_LINK,e.parent===a.parent.GROUP_PROFILE_VIEW_MODEL?e.cta=6:e.parent===a.parent.HEADER_VIEW_MODEL&&(e.cta=7),t(e)},e.onEmailLinkClicked=function(e){e.cta=a.cta.EMAIL_LINK,e.parent===a.parent.GROUP_PROFILE_VIEW_MODEL?e.cta=8:e.parent===a.parent.HEADER_VIEW_MODEL&&(e.cta=9),t(e)},e.onMediaButtonClicked=function(e){e.cta=10,t(e)},e}var n=e("swx-constants").COMMON,r=e("experience/settings"),i=e("swx-cafe-application-instance"),s=e("usertiming"),o=e("ui/telemetry/telemetryClient"),u=e("ui/modelHelpers/personHelper"),a=n.telemetry.guestActionsInHeader,f=n.telemetry.performanceMarks,l=n.telemetry.measurements,c;t.get=function(){return c||(c=new h),c}}),define("ui/viewModels/chat/conversation/callButtonViewModel",["require","exports","module","lodash-compat","vendor/knockout","utils/common/eventMixin","swx-enums","swx-cafe-application-instance","swx-i18n","swx-constants","swx-constants","ui/modelHelpers/personHelper","swx-service-locator-instance","utils/common/cafeObservable","ui/modelHelpers/conversationHelper","swx-utils-chat","ui/viewModels/calling/helpers/callingFacade","ui/telemetry/actions/actionNames","ui/telemetry/chat/guestActionsInHeader","ui/viewModels/chat/conversationActivity","ui/modelObservers/agentAuthorizationObserver","ui/modelObservers/calling/activeCallObserver"],function(e,t){var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("utils/common/eventMixin"),s=e("swx-enums"),o=e("swx-cafe-application-instance"),u=e("swx-i18n").localization,a=e("swx-constants").COMMON,f=e("swx-constants").CALLING,l=e("ui/modelHelpers/personHelper"),c=e("swx-service-locator-instance").default,h=e("utils/common/cafeObservable"),p=e("ui/modelHelpers/conversationHelper"),d=e("swx-utils-chat").conversation,v=e("ui/viewModels/calling/helpers/callingFacade"),m=e("ui/telemetry/actions/actionNames"),g=e("ui/telemetry/chat/guestActionsInHeader"),y=e("ui/viewModels/chat/conversationActivity"),b=e("ui/modelObservers/agentAuthorizationObserver"),w=e("ui/modelObservers/calling/activeCallObserver"),E=function(e){function _(n){D(),o.get().conversationsManager.conversations.add(e),t.dispatchEvent(a.events.actions.callMade,{},t.DIRECTION.PARENT),v.placeCall(e,n,"startCallButton")}function D(){if(!e.isGroupConversation()&&n.isFeatureOn(a.featureFlags.PSTN_ENABLED)){var t=e.participants(0);t.audio.endpoint(t.person.id())}}function P(){return{participantsCount:t.conversationModel.participants.size(),userMessagesCount:t.conversationModel.historyService.activityItems().filter(function(e){return e.type()===s.activityType.TextMessage&&l.isMePerson(e.sender)}).length,totalMessagesCount:t.conversationModel.historyService.activityItems().length}}function H(){var e=!1,n=t.conversationModel.participants().length,r;for(var i=0;i<n&&!e;i++)r=t.conversationModel.participants()[i].person,e=!r.isBlocked()&&r.capabilities.audio();t.hasAudioCapability(n===0||e)}function B(){var e=!1,n=t.conversationModel.participants().length,r;for(var i=0;i<n&&!e;i++)r=t.conversationModel.participants()[i].person,e=!r.isBlocked()&&r.capabilities.video();t.hasVideoCapability(n===0||e)}function j(){L=[],t.conversationModel.participants().forEach(function(e){var t=e.person,n=t.capabilities.audio.subscribe(),r={person:t,subscription:n};t.capabilities.audio.get(),t.capabilities.audio.changed(H),L.push(r)})}function F(){A=[],t.conversationModel.participants().forEach(function(e){var t=e.person,n=t.capabilities.video.subscribe(),r={person:t,subscription:n};t.capabilities.video.get(),t.capabilities.video.changed(B),A.push(r)})}function I(){L&&(L.forEach(function(e){e.person.capabilities.audio.changed.off(H),e.subscription.dispose()}),L=undefined)}function q(){A&&(A.forEach(function(e){e.person.capabilities.video.changed.off(B),e.subscription.dispose()}),A=undefined)}function R(){t.isOneToOneConversation()&&(k=t.participantPerson(),k.isBlocked.changed(H),k.isBlocked.changed(B))}function U(){k&&(k.isBlocked.changed.off(H),k.isBlocked.changed.off(B))}function z(){I(),q(),U(),j(),F(),R(),d.isGuestHostConversation(e.conversationId)&&M(e.participants.size())}function W(){var e=c.resolve(a.serviceLocator.FEATURE_FLAGS);return e.isFeatureOn(f.FEATURE_FLAGS.CALLING)}function X(){return N.isCallActive()?!0:t.callingDisabled()?!0:$()?!0:!t.hasAudioCapability()}function V(){return N.isCallActive()?!0:t.videoCallingDisabled()?!0:$()?!0:!t.hasVideoCapability()}function $(){return d.isGuestHostConversation(e.conversationId)&&M()<1}function J(){i(p.isPstnOnlyConversation(e))}var t=this,n=c.resolve(a.serviceLocator.FEATURE_FLAGS),i=r.observable(p.isPstnOnlyConversation(e)),E=n.isFeatureOn(a.featureFlags.CALLING),S=y.build(e),x=r.observable(!e.videoService.start.enabled()),T=b.build(e),N=w.build(),C,k,L,A,O,M=r.observable(0);t.conversationModel=e,t.participants=h.newObservableCollection(e.participants),t.isOneToOneConversation=r.computed(function(){return t.participants().length===1}),t.participantPerson=r.computed(function(){if(t.isOneToOneConversation())return t.participants()[0].person}),t.callingDisabled=r.computed(function(){return!E||S.isCallingDisabled()||T.isConversationWithUnauthorizedAgent()}),t.videoCallingDisabled=r.computed(function(){return!E||S.isVideoCallingDisabled()||T.isConversationWithUnauthorizedAgent()}),t.hasAudioCapability=r.observable(!0),t.hasVideoCapability=r.observable(!0),t.conversationModel.participants.changed(z),t.isAudioDisabled=r.computed(X),t.isVideoDisabled=r.computed(V),C=e.participants.observe(J),O=e.videoService.start.enabled.changed(function(){x(!e.videoService.start.enabled())}),t.callingDisabledTooltip=r.computed(function(){var e=o.get().personsAndGroupsManager.mePerson.capabilities.audio;return e()?"":W()?e.reason===s.callingNotSupportedReasons.BrowserNotSupported?u.fetch({key:"message_text_callingNotSupportedBrowser"}):e.reason===s.callingNotSupportedReasons.OSNotSupported?u.fetch({key:"message_text_callingNotSupportedOS"}):"":u.fetch({key:"message_text_callingIsDisabled"})}),t.buttonVideoTitle=r.pureComputed(function(){if(!t.hasVideoCapability())return u.fetch({key:"videoCallDisabled_tooltip",params:{agentName:t.getDisabledConversationName()}});var e=t.callingDisabledTooltip();return e===""&&(e=u.fetch({key:"startVideoCall_tooltip"})),e}),t.buttonVideoAriaLabel=r.pureComputed(function(){var e=t.callingDisabledTooltip();return e===""&&(e=u.fetch({key:"accessibility_startVideoCall_ariaLabel"})),e}),t.buttonCallTitle=r.pureComputed(function(){if(!t.hasAudioCapability())return u.fetch({key:"callDisabled_tooltip",params:{agentName:t.getDisabledConversationName()}});var e=t.callingDisabledTooltip();return e===""&&(t.conversationModel.isGroupConversation()?e=u.fetch({key:"startGroupCall_tooltip"}):e=u.fetch({key:"startCall_tooltip"})),e}),t.buttonCallAriaLabel=r.pureComputed(function(){var e=t.callingDisabledTooltip();return e===""&&(t.conversationModel.isGroupConversation()?e=u.fetch({key:"accessibility_startGroupCall_ariaLabel"}):e=u.fetch({key:"accessibility_startCall_ariaLabel"})),e}),t.startCallWithAudio=function(){var e=c.resolve(a.serviceLocator.ACTION_TELEMETRY);e.recordAction(m.audioVideo.audioCall),g.get().onMediaButtonClicked(P()),_(!1)},t.startCallWithVideo=function(){var e=c.resolve(a.serviceLocator.ACTION_TELEMETRY);e.recordAction(m.audioVideo.videoCall),g.get().onMediaButtonClicked(P()),_(!0)},t.joinCall=function(){var e=c.resolve(a.serviceLocator.ACTION_TELEMETRY);e.recordAction(m.audioVideo.joinCall),g.get().onMediaButtonClicked(P()),_(!1)},t.getDisabledConversationName=function(){var e=t.participantPerson();return e?e.displayName():t.conversationModel.topic()},t.dispose=function(){t.participants.dispose(),t.participantPerson.dispose(),t.callingDisabledTooltip.dispose(),t.buttonVideoTitle.dispose(),t.buttonVideoAriaLabel.dispose(),t.buttonCallTitle.dispose(),t.buttonCallAriaLabel.dispose(),t.isOneToOneConversation.dispose(),t.callingDisabled.dispose(),t.videoCallingDisabled.dispose(),S.dispose(),C&&C.dispose(),I(),q(),U(),t.conversationModel.participants.changed.off(z),O.dispose(),T.dispose(),N.dispose()}};n.assign(E.prototype,i),t.build=function(e){return new E(e)}}),define("telemetry/chat/profileCards",["require","experience/settings","ui/telemetry/telemetryClient","swx-constants"],function(e){function i(){function e(e,i){var s={Entry_Point:(i?i:r.NOT_AVAILABLE).toString()};n.get().sendEvent(t.telemetry.chatTenantToken,e,s)}this.profileOpened=function(t){e(r.contacts.name.PROFILE_OPENED,t)}}var t=e("experience/settings"),n=e("ui/telemetry/telemetryClient"),r=e("swx-constants").COMMON.telemetry;return new i}),define("ui/viewModels/chat/header",["require","exports","module","lodash-compat","vendor/knockout","utils/common/eventMixin","utils/common/outsideClickHandler","swx-i18n","swx-cafe-application-instance","swx-service-locator-instance","swx-constants","ui/modelHelpers/conversationHelper","swx-utils-chat","swx-pubsub-instance","utils/common/cafeObservable","ui/viewModels/chat/conversation/callButtonViewModel","ui/viewModels/calling/startCallButtonViewModel","swx-constants","utils/common/eventHelper","ui/telemetry/actions/actionSources","ui/telemetry/chat/guestActionsInHeader","swx-enums","swx-utils-chat","swx-constants","ui/viewModels/chat/conversationActivity","ui/viewModels/chat/conversationTopic","ui/modelHelpers/personHelper","ui/viewModels/chat/conversationTile","ui/educationBubbles/educationBubble","ui/educationBubbles/educationBubbleInfo","utils/common/styleModeHelper","telemetry/chat/profileCards","utils/common/accessibility","ui/telemetry/actions/actionNames"],function(e,t){function P(e,t,n){function nt(e){return!!e&&e.participants().length===1}function rt(e){return nt(e)?e.participants(0).person.capabilities.groupAdd?e.participants(0).person.capabilities.groupAdd():!c.isOneToOneConversationWithAgent(e):!0}function it(e){var t=0;e.forEach(function(e){e&&(!e.response||e.response.status!==200)&&t++}),q.performed(t)}function st(){P.hasNoSelectedParticipants(B?B.selectedContacts().length===0:!0)}function ot(e){var n=P.editModeActive()||P.profileExpanded();P.dispatchEvent(g.roster.EDIT_ROSTER_MODE,{isActive:n,isEditMode:P.editModeActive()},P.DIRECTION.PARENT),e?(s.add("conversationHeader",P.toggleProfile),t.restrict()):(s.remove("conversationHeader"),t.restore())}function ut(){z(!1),B=null,st(),P.toggleEditMode(),p.publish(l.LEAVE_EDIT_MODE)}function at(e){var t=u.get().conversationsManager,r=e().slice(0),s=z()?!R():R(),o;r.push(i.participants(0).person),o=h.createConversation(r,t,!0),o.isJoiningEnabled.set.enabled.once(!0,function(){o.isJoiningEnabled.set(s)}),s&&P.spacesEnabled&&o.topic.set.enabled.once(!0,function(){o.topic(c.createSpaceTopic())}),p.publish(l.OPEN_CONVERSATION,{model:o,origin:f.telemetry.historyLoadOrigin.CONVERSATION_TO_THREAD,contentElementId:n})}function ft(){return P.editModeActive()}function lt(){return!U.isFeatureOn(f.featureFlags.CALLING)||U.isFeatureOn(f.featureFlags.USE_BUSINESS_WORDING)&&P.isCallingDisabled()?!0:!1}function ct(){return!U.isFeatureOn(f.featureFlags.CALLING)||U.isFeatureOn(f.featureFlags.USE_BUSINESS_WORDING)&&P.isVideoCallingDisabled()?!0:!1}function ht(){var e="secondary circle stroke";return P.editModeActive()?e+" active":e}function pt(){return tt()?!0:G()?!P.canAddParticipants():!0}function dt(){z(!z())}function vt(e){e&&mt()}function mt(){var e=P.editModeActive(),t=P.profileExpanded();if(!e&&!t)return;e?P.canAddParticipants()?P.undoSelectedParticipants():P.toggleEditMode():P.toggleProfile()}function gt(){var t=a.resolve(f.serviceLocator.ACTION_TELEMETRY);t.recordAction(D.conversation.addParticipantsButton),P.profileExpanded(!1),q=e.conversationUpdateFlow,q.start(i.participants().length,i.isGroupConversation())}function yt(e){P.profileExpanded()||P.toggleProfile(undefined,e),e.editTopic&&!P.topicEditorExpanded()&&P.openTopicEditor()}function bt(){P.profileExpanded()&&P.toggleProfile()}function wt(){return!P.isGroupConversation()}function Et(){return c.isConversationWithWelcomeAgent(P.conversationModel)?!1:P.isGroupConversation()&&P.headerControlsEnabled()||!P.isGroupConversation()}function St(){return Et()?0:-1}function xt(e){var t=Nt();t.parent=e.parent,w.get().onCopyLinkClicked(t)}function Tt(e){var t=Nt();t.parent=e.parent,w.get().onEmailLinkClicked(t)}function Nt(){return{participantsCount:P.conversationModel.participants.length,userMessagesCount:P.conversationModel.historyService.activityItems().filter(function(e){return e.type()===E.activityType.TextMessage&&C.isMePerson(e.sender)}).length,totalMessagesCount:P.conversationModel.historyService.activityItems().length}}function Ct(e){P.participantCount(e),U.isFeatureOn(f.featureFlags.INCLUDE_SELF_IN_PARTICIPANTS_COUNT)&&P.participantCount(e+1)}function kt(e){P._internal.isModelTopicEditable(e)}function Lt(){var e=c.isOneToOneConversationWithBlockedPerson(P.conversationModel);G(!e&&rt(P.conversationModel))}function At(){nt(P.conversationModel)&&P.conversationModel.participants()[0].person.capabilities.groupAdd?(Y=P.conversationModel.participants()[0].person,Y.capabilities.groupAdd.changed(Lt)):Lt()}function Ot(){nt(P.conversationModel)?(Y=P.conversationModel.participants()[0].person,Y.isBlocked.changed(Lt)):Lt()}function Mt(){_t(),Dt(),At(),Ot()}function _t(){Y&&Y.capabilities.groupAdd&&Y.capabilities.groupAdd.changed.off(Lt)}function Dt(){Y&&Y.isBlocked.changed.off(Lt)}function Pt(e){e.conversationModel.conversationId===P.conversationModel.conversationId&&tt(!0)}function Ht(){tt(!1)}function Bt(){var e;U.isFeatureOn(f.featureFlags.CALL_EDUCATION_BUBBLE)&&(e=a.resolve(f.serviceLocator.SUBSCRIPTION_PROVIDER),e.getContacts().then(function(){!P.isCallingDisabled()&&!P.callButtonViewModel.isVideoDisabled()&&It()&&Ft(A.CALL_EDUCATION_BUBBLE)}))}function jt(){var e;P.showMoreActions()&&U.isFeatureOn(f.featureFlags.SCHEDULE_CALL_EDUCATION_BUBBLE_1)&&(P.isGroupConversation()?e=A.SCHEDULE_CALL_EDUCATION_BUBBLE_1_GROUP:(e=A.SCHEDULE_CALL_EDUCATION_BUBBLE_1,e.options.i18nParams={name:P.topic()}),Ft(e))}function Ft(e){var t=L.build(e.id,e.anchorElementQuery,e.i18nKey,e.iconUrlPath,e.options);t.show()}function It(){var e=i.participants().filter(function(e){return e.person.status()===E.onlineStatus.Online});return e.length>0}function qt(e,t){var n=e?"accessibility_contactProfile_closedProfile":"accessibility_contactProfile_openedProfile";_.announce({key:n,params:{topic:t}})}var i=e.conversationModel,P=this,H,B=null,j,F,I,q=e.conversationUpdateFlow,R=d.newObservableProperty(i.isJoiningEnabled),U=a.resolve(f.serviceLocator.FEATURE_FLAGS),z=r.observable(!1),W,X=T.build(i),V=N.build(i),$=u.get().translatorService,J=c.isPstnOnlyConversation(i),K=c.isOneToOneConversationWithAgent(i),Q=c.isOneToOneConversationWithEcho(i),G=r.observable(!1),Y,Z,et,tt=r.observable(!1);P._internal={isModelTopicEditable:r.observable(!1)},P.conversation=k.build(i,{contactOptions:{moodMessageFirst:!0}}),P.callButtonViewModel=v.build(i),P.callButtonViewModel.setContext(this),P.startCallButtonViewModel=m.build({callButtonViewModel:P.callButtonViewModel,historyOrigin:f.telemetry.historyLoadOrigin.CONVERSATION_HEADER_BUTTON,telemetryContext:{source:b.conversation.header.button}}),P.conversationModel=i,P.conversationModel.participants.changed(Mt),P.spacesEnabled=U.isFeatureOn(f.featureFlags.SPACES),P.telemetryContext={source:b.invitesShareButtons.header},P.newConversationV2=U.isFeatureOn(f.featureFlags.NEW_CONVERSATION_V2),P.headerControlsEnabled=function(){return U.isFeatureOn(f.featureFlags.HEADER_CONTROLS_DISABLED)?!1:c.isConversationWithWelcomeAgent(P.conversationModel)?!1:!0},P.joinCallAriaLabel=o.fetch({key:"button_text_joinCall"}),P.joinCallTitle=o.fetch({key:"button_text_joinCall"}),P.addParticipantsTitle=o.fetch({key:"button_text_addParticipants"}),P.cancelAddParticipantsTitle=o.fetch({key:"button_text_cancelAddParticipants"}),P.spaceLink=d.newObservableProperty(i.uri),$&&(P.translatorServiceStateObservable=d.newObservableProperty($.state)),P.role=d.newObservableProperty(i.selfParticipant.role),P.isAdmin=r.computed(function(){return P.role()===E.participantRole.Leader}),P.buttonAddPeopleToConversationTitle=r.pureComputed(function(){var e="";return P.addParticipantsBtnDisabled()===!1&&(e=o.fetch({key:"addPeopleToConversation_tooltip"})),e}),P.buttonAddPeopleToConversationAriaLabel=r.pureComputed(function(){var e="";return P.addParticipantsBtnDisabled()===!1&&(e=o.fetch({key:"accessibility_addPeopleToConversation_ariaLabel"})),e}),P.editModeActive=r.observable(!1),P.canJoinCall=X.canJoinCall,P.initializeParticipants=r.observable(!1),P.hasNoSelectedParticipants=r.observable(!0),P.profileExpanded=r.observable(!1).extend({rateLimit:100}),P.isGroupConversation=d.newObservableProperty(i.isGroupConversation),P.canShowContactProfile=r.computed(wt),P.canExpandProfile=r.computed(Et),P.tabIndex=r.computed(St),P.avatar=d.newObservableProperty(i.avatarUrl),P.topic=V.topic,P.displayName=V.displayName,P.canAddParticipants=r.observable(!1),P.contact=null,P.isAgent=P.conversation.isAgent,P.isPstn=P.conversation.isPstn,P.confirmButtonsVisible=r.computed(ft),P.addParticipantsBtnClasses=r.computed(ht),P.addParticipantsBtnDisabled=r.computed(pt),P.isGuestHostConversation=h.isGuestHostConversation(i.conversationId),P.isCallingDisabled=X.isCallingDisabled,P.isVideoCallingDisabled=X.isVideoCallingDisabled,P.hideAudioButton=r.computed(lt),P.hideVideoButton=r.computed(ct),P.spaceLink=r.observable(),P.isTooltipVisible=r.observable(!1),et=i.participants.add.enabled.changed(function(e){P.canAddParticipants(e)}),Z=i.topic.set.enabled.changed(kt),P.spaceTopicEditorEnabled=U.isFeatureOn(f.featureFlags.SPACE_TOPIC_EDITOR),P.isServiceEnabled=d.newObservableProperty(P.conversationModel.chatService.sendMessage.enabled),P.topicEditable=r.computed(function(){return P.isServiceEnabled()&&P.isGroupConversation()&&P._internal.isModelTopicEditable()&&P.spaceTopicEditorEnabled}),P.canEditTopic=r.computed(function(){return P.topicEditable()&&P.profileExpanded()}),P.editTopicTitle=o.fetch({key:"spaces_welcomeRenameBtnTitle"}),P.editTopicConfirmAria=o.fetch({key:"action_button_confirm"}),P.editTopicCancelAria=o.fetch({key:"action_button_cancel"}),P.editTopic=r.observable(""),P.topicEditorExpanded=r.observable(!1),P.topicHasFocus=r.observable(!1),P.participantCount=r.observable(i.participantsCount()),i.participantsCount.changed(Ct),P.isIntegratedProperty=r.observable(O.get().isIntegratedProperty()),P.showMoreActions=function(){return U.isFeatureOn(f.featureFlags.SCHEDULE_CALL_FROM_CONVERSATION)&&!K&&!Q},P.closeTopicEditor=function(){P.topicEditorExpanded(!1),P.editTopic("")},P.openTopicEditor=function(){P.editTopic(S.getSanitizedTopic(i.topic())),P.topicEditorExpanded(!0),P.topicHasFocus(!1),H.onTopicEdit()},P.onTopicEditKeyDown=function(e,t){return t.keyCode===x.ENTER?(P.updateTopic(),P.topicHasFocus(!0),!1):t.keyCode===x.ESCAPE?(P.closeTopicEditor(),t.stopPropagation(),P.topicHasFocus(!0),!1):!0},P.updateTopic=function(){var e=S.processOutgoingTextMessage(P.editTopic());e.length&&(i.topic(e),P.topicEditorExpanded(!1),P.editTopic(""),_.announce({key:"spaces_conversation_renamed_success",params:{conversationName:e}}))},P.onUpdateTopicKeyDown=function(e,t){var n=y.isActivation(t);return n&&P.updateTopic(),!n},P.onCloseTopicEditorKeyDown=function(e,t){var n=y.isActivation(t);return n&&P.closeTopicEditor(),!n},P.linkShown=r.pureComputed(function(){return P.spacesEnabled&&(R()||P.isAdmin())}),P.showTranslatorSettings=r.pureComputed(function(){return!!$&&!J&&!K&&!Q&&!P.isGroupConversation()&&!P.profileExpanded()&&P.translatorServiceStateObservable()===f.translatorServiceState.Authenticated}),P.headerAriaLabel=r.pureComputed(function(){var e;return P.isGroupConversation()?e=P.profileExpanded()?"accessibility_groupProfile_headingWithOpenedProfile":"accessibility_groupProfile_headingWithClosedProfile":e=P.profileExpanded()?"accessibility_contactProfile_headingWithOpenedProfile":"accessibility_contactProfile_headingWithClosedProfile",o.fetch({key:e,params:{topic:P.topic()}})}),j=P.editModeActive.subscribe(ot),F=P.profileExpanded.subscribe(ot),P.focusRestrict=function(){P.profileExpanded()&&t.restrict()},P.init=function(e){H=e,H.init({toggleProfile:P.toggleProfile,abandonEditMode:mt}),I=P.addParticipantsBtnDisabled.subscribe(vt),i.isGroupConversation()&&(P.spaceLink=d.newObservableProperty(i.uri)),P.forwardEvent(g.roster.ROSTER_QUERY_CHANGED),P.forwardEvent(g.roster.ROSTER_QUERY_EXECUTED),P.forwardEvent(g.roster.ROSTER_SELECTION_REMOVED),P.forwardEvent(g.roster.PICKER_CONTACT_SELECTED),P.forwardEvent(g.roster.PICKER_CONTACT_DESELECTED),P.forwardEvent(g.message.ADD_CONTACT,this.DIRECTION.PARENT,null,this.DIRECTION.CHILD),P.forwardEvent(g.actions.callMade,this.DIRECTION.PARENT,null,this.DIRECTION.CHILD),P.registerEvent(g.conversation.JOINING_ENABLED,dt),P.registerEvent(g.conversation.OPEN_PROFILE,yt),P.registerEvent(g.conversation.CLOSE_PROFILE,bt),P.registerEvent(g.conversation.COPY_LINK,xt),P.registerEvent(g.conversation.EMAIL_LINK,Tt),P.registerEvent(g.conversation.MESSAGES_LOADED,P.focusRestrict),p.subscribe(f.events.shareControl.SHARE_CONTROL_SHOW,Pt),p.subscribe(f.events.shareControl.SHARE_CONTROL_HIDE,Ht),Bt(),jt()},P.dispose=function(){j.dispose(),F.dispose(),I.dispose(),P.selectedContactsSubscription&&P.selectedContactsSubscription.dispose(),P.confirmButtonsVisible.dispose(),P.addParticipantsBtnDisabled.dispose(),P.addParticipantsBtnClasses.dispose(),P.topicEditable.dispose(),P.canEditTopic.dispose(),P.isAdmin.dispose(),P.canShowContactProfile.dispose(),P.canExpandProfile.dispose(),P.tabIndex.dispose(),H&&H.dispose(),H=null,P.conversation.dispose(),X.dispose(),V.dispose(),P.callButtonViewModel.dispose(),P.startCallButtonViewModel.dispose(),Z&&Z.dispose(),et&&et.dispose(),P.translatorServiceStateObservable&&P.translatorServiceStateObservable.dispose(),P.headerAriaLabel.dispose(),i.participantsCount.changed.off(Ct),_t(),Dt(),P.conversationModel.participants.changed.off(Mt),p.unsubscribe(f.events.shareControl.SHARE_CONTROL_SHOW,Pt),p.unsubscribe(f.events.shareControl.SHARE_CONTROL_HIDE,Ht),s.remove("conversationHeader")},P.submitButtonDisabled=r.pureComputed(function(){return P.hasNoSelectedParticipants()&&!z()}),P.toggleProfile=function(e,t){if(!Et())return;var n=P.profileExpanded();qt(n,P.topic()),P.profileExpanded(!n);if(i.isGroupConversation()){var r=Nt();r.telemetryItem=e,r.profileExpanded=n,w.get().onProfileToggled(r),P.initializeParticipants(!0),P.profileExpanded()&&P.editModeActive()&&ut(),P.profileExpanded()||P.closeTopicEditor(),H.onEditModeToggled(P.profileExpanded())}else if(P.profileExpanded()){var s=t&&t.source?t.source:b.conversation.header.button;M.profileOpened(s)}},P.setParticipantProvider=function(e){P.selectedContactsSubscription&&P.selectedContactsSubscription.dispose(),B=e,P.selectedContactsSubscription=B.selectedContacts.subscribe(st),st()},P.toggleEditMode=function(){var e=!P.editModeActive();P.editModeActive(e),e&&gt(),H.onEditModeToggled(e)},P.showTooltip=function(){W&&window.clearTimeout(W),P.isTooltipVisible(!0)},P.hideTooltip=function(){W=window.setTimeout(function(){P.isTooltipVisible(!1)},500)},P.undoSelectedParticipants=function(){ut(),q.cancelled(),q=null},P.submitSelectedParticipants=function(){var e=B.selectedContacts,t=e().length;q.completed(t),i.isGroupConversation()?(z()&&i.isJoiningEnabled.set(!R()),h.addPersonsToConversation(e(),i).then(it)):at(e),ut()},P.onToggleProfileKeyDown=function(e,t){var n=y.isActivation(t);return n&&P.toggleProfile(),!n}}var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("utils/common/eventMixin"),s=e("utils/common/outsideClickHandler"),o=e("swx-i18n").localization,u=e("swx-cafe-application-instance"),a=e("swx-service-locator-instance").default,f=e("swx-constants").COMMON,l=f.events.navigation,c=e("ui/modelHelpers/conversationHelper"),h=e("swx-utils-chat").conversation,p=e("swx-pubsub-instance").default,d=e("utils/common/cafeObservable"),v=e("ui/viewModels/chat/conversation/callButtonViewModel"),m=e("ui/viewModels/calling/startCallButtonViewModel"),g=e("swx-constants").COMMON.events,y=e("utils/common/eventHelper"),b=e("ui/telemetry/actions/actionSources"),w=e("ui/telemetry/chat/guestActionsInHeader"),E=e("swx-enums"),S=e("swx-utils-chat").messageSanitizer,x=e("swx-constants").KEYS,T=e("ui/viewModels/chat/conversationActivity"),N=e("ui/viewModels/chat/conversationTopic"),C=e("ui/modelHelpers/personHelper"),k=e("ui/viewModels/chat/conversationTile"),L=e("ui/educationBubbles/educationBubble"),A=e("ui/educationBubbles/educationBubbleInfo"),O=e("utils/common/styleModeHelper"),M=e("telemetry/chat/profileCards"),_=e("utils/common/accessibility").narrator,D=e("ui/telemetry/actions/actionNames");n.assign(P.prototype,i),t.build=function(e,t,n){return new P(e,t,n)}}),define("jsviews/chat/header",["require","browser/dom","swx-constants","swx-constants"],function(e){function o(e){function u(e){e.keyCode===n.ESCAPE&&(e.stopPropagation(),o.abandonEditMode())}function a(){e.removeEventListener("keydown",u),document.removeEventListener(r.events.browser.CLICK,f,!0)}function f(e){var n=!t.getParentWithClass(e.target,i)&&t.getParentWithClass(e.target,s);n&&o.abandonEditMode()}var o;this.init=function(e){o=e},this.dispose=function(){a()},this.onEditModeToggled=function(t){t?(e.addEventListener("keydown",u),document.addEventListener(r.events.browser.CLICK,f,!0)):a()},this.onTopicEdit=function(){t.getElement(".editTopic input.edit",e).select()}}var t=e("browser/dom"),n=e("swx-constants").KEYS,r=e("swx-constants").COMMON,i="conversationHeader",s="swx-container";return o}),define("text!views/chat/header.html",[],function(){return'<div class="headerMain" data-bind="css: { canJoinCall: canJoinCall }">\r\n    <div class="roster">\r\n        <div class="grid" data-bind="css: { group: isGroupConversation, staticHeader: !canExpandProfile() }">\r\n            <swx-avatar role="button" data-bind="click: toggleProfile.bind(this, \'telemetryItemAvatar\', null), css: { hide: profileExpanded }" params="isGroupAvatar: isGroupConversation, avatar: avatar, isAgent: isAgent, status: conversation.statusClassName, isPstn: isPstn, displayName: displayName, useAbsolutePosition: true" class="avatar Avatar--fogTheme"></swx-avatar>\r\n\r\n            <swx-button data-bind="css: { hide: !profileExpanded()}" params="ariaLabelKey: headerAriaLabel, icon: \'chevronUp\', cssClass: \'primary circle\', titleKey: \'header_text_close\', textKey: \'header_text_close\', action: toggleProfile.bind(this, \'telemetryItemChevronUp\', true), tabindex:-1" class="hideProfile"></swx-button>\r\n\r\n            <span class="tile conversationTopic" data-bind="css: conversation.statusClassName">\r\n                <span class="tileText">\r\n                    <span class="tileName square">\r\n                        <h3 data-bind="css: { editable: topicEditable() }">\r\n                            <span role="button" class="iconfont button chevronUp" data-bind="css: { hide: !profileExpanded() }, click: toggleProfile.bind(this, \'telemetryItemChevronUp\'), enterKey: toggleProfile.bind(this, \'telemetryItemChevronUp\')"></span>\r\n                            <span class="hoverWrap" data-bind="css: { \'Header-Title--agent\': conversation.isCertifiedAgent() }">\r\n                                <span data-swx-testId="conversationTopic" data-bind="text: topic, click: toggleProfile.bind(this, \'telemetryItemTopic\'), enterKey: toggleProfile.bind(this, \'telemetryItemChevronUp\'), attr: {\'aria-label\': headerAriaLabel, \'aria-expanded\': profileExpanded, \'tabindex\': tabIndex}, hasFocus: topicHasFocus"></span>\r\n                                <!-- ko if: conversation.isCertifiedAgent() -->\r\n                                <span class="iconfont avatarBotCertified"></span>\r\n                                <!-- /ko -->\r\n                                <!-- ko if: canExpandProfile -->\r\n                                <span role="button" class="iconfont chevronDown" data-bind="css: { hide: profileExpanded }, click: toggleProfile.bind(this, \'telemetryItemChevronDown\')"></span>\r\n                                <!-- /ko -->\r\n                            </span>\r\n                            <button class="iconfont edit" data-bind="css: { hide: !canEditTopic() }, attr: {\'aria-label\': editTopicTitle, \'title\': editTopicTitle}, click: openTopicEditor" type="button"></button>\r\n                        </h3>\r\n                        <!-- ko if: isGroupConversation -->\r\n                        <div class="editTopic" data-bind="css: { hide: !topicEditorExpanded(), integratedProperty : isIntegratedProperty}">\r\n                            <input class="edit" data-bind="textInput: editTopic, event: {keydown: onTopicEditKeyDown }, hasFocus: topicEditorExpanded(), selected: topicEditorExpanded()" maxlength="200" />\r\n                            <a href="#" class="iconfont ok" role="button" data-bind="event: {click: updateTopic, keydown: onUpdateTopicKeyDown}, attr: {\'aria-label\': editTopicConfirmAria}"></a>\r\n                            <a href="#" class="iconfont cancel" role="button" data-bind="event: {click: closeTopicEditor, keydown: onCloseTopicEditorKeyDown}, attr: {\'aria-label\': editTopicCancelAria}"></a>\r\n                        </div>\r\n                        <!-- /ko -->\r\n                    </span>\r\n                    <span class="tileMessage" data-bind="css: { empty: !conversation.displayMessage(), presence: !profileExpanded(), circle: !profileExpanded()}">\r\n                        <div class="message fixSmall">\r\n                            <div class="displayMessage">\r\n                                <span data-bind="html: conversation.displayMessage, attr: {title: conversation.displayMessageTitle}" class="iconfont groupParticipantsLabel fontSize-p"></span>\r\n                                <!--ko if: conversation.displayMessage() && linkShown() -->\r\n                                <span class="fontSize-p divider">|</span>\r\n                                <!-- /ko -->\r\n                                <!-- ko if: linkShown -->\r\n                                <swx-conversation-share-link class="conversation-share-link conversation-share-link-header" params="conversationModel: conversationModel, telemetryContext: telemetryContext"></swx-conversation-share-link>\r\n                                <!-- /ko -->\r\n                            </div>\r\n                        </div>\r\n                    </span>\r\n                </span>\r\n            </span>\r\n\r\n            <!-- ko if: headerControlsEnabled() -->\r\n            <div class="headerControls" data-bind="css: { newConversationV2: newConversationV2, hide: confirmButtonsVisible }">\r\n                <div class="buttonRow">\r\n                    <swx-joincall-button data-bind="css: { hide: isCallingDisabled() || isVideoCallingDisabled() }" params="cssClass: \'primary circle joinCall\', conversationModel: conversationModel, showIcon: true, withVideo: true"></swx-joincall-button>\r\n                    <swx-joincall-button data-bind="css: { hide: isCallingDisabled }" params="cssClass: \'primary circle joinCall\', conversationModel: conversationModel, showIcon: true"></swx-joincall-button>\r\n                    <swx-button data-bind="css: { hide: hideVideoButton}" class="callButtons" params="icon: \'videoOn\', cssClass: \'swx-video-call-btn primary circle\', disabled: callButtonViewModel.isVideoDisabled, textKey: \'button_text_videoCall\', i18nTitle: callButtonViewModel.buttonVideoTitle, action: callButtonViewModel.startCallWithVideo, ariaLabel: callButtonViewModel.buttonVideoAriaLabel"></swx-button>\r\n                    <swx-button data-bind="css: { hide: hideAudioButton}" class="callButtons" params="icon: \'callStart\', cssClass: \'swx-audio-call-btn primary circle\', disabled: callButtonViewModel.isAudioDisabled, textKey: \'button_text_audioCall\', i18nTitle: callButtonViewModel.buttonCallTitle, action: callButtonViewModel.startCallWithAudio, ariaLabel: callButtonViewModel.buttonCallAriaLabel, hasMenuOptions: startCallButtonViewModel.hasMenuOptions, menuOptions: startCallButtonViewModel.getMenuOptions"></swx-button>\r\n\r\n                    <!-- ko if: !showMoreActions() && !isGuestHostConversation -->\r\n                    <swx-button data-swx-testId="addParticipantAction" params="conversation: conversationModel, icon: \'contactAdd\', disabled: addParticipantsBtnDisabled, cssClass: addParticipantsBtnClasses, textKey: \'button_text_addParticipants\', i18nTitle: buttonAddPeopleToConversationTitle, action: toggleEditMode, ariaLabel: buttonAddPeopleToConversationAriaLabel"></swx-button>\r\n                    <!-- /ko -->\r\n                    <!-- ko if: showMoreActions() -->\r\n                    <swx-more-actions-button class="moreActions" params="conversation: conversationModel, cssClass: \'secondary circle stroke\', addParticipantsDisabled: addParticipantsBtnDisabled, addParticipantsAction: toggleEditMode"></swx-more-actions-button>\r\n                    <!-- /ko -->\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: showTranslatorSettings -->\r\n                <swx-translator-settings params="conversationModel: conversationModel"></swx-translator-settings>\r\n            <!-- /ko -->\r\n            <!-- ko if: initializeParticipants -->\r\n                <swx-group-profile params="conversationModel: conversationModel" data-bind="css: { hide: !profileExpanded() }" class="themeWhite groupProfileContainer"></swx-group-profile>\r\n            <!-- /ko -->\r\n            <!-- ko if: canShowContactProfile() && profileExpanded() -->\r\n                <swx-contact-profile params="conversationModel: conversationModel, conversationTile: conversation" class="themeWhite groupProfileContainer"></swx-contact-profile>\r\n            <!-- /ko -->\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<!-- ko if: editModeActive -->  <!-- TODO: make sure this is not unnecessary disposed -->\r\n<div class="contactPickerWrapper" css="modal" >\r\n    <div class="headerAdd">\r\n        <swx-contact-picker-input params="setParticipantProvider: setParticipantProvider"></swx-contact-picker-input>\r\n    </div>\r\n    <swx-contact-picker params="conversation: conversationModel, className: \'headerPicker\'"></swx-contact-picker>\r\n\r\n    <!-- ko if: !newConversationV2 -->\r\n        <!-- ko if: spacesEnabled -->\r\n            <swx-space-settings params="conversationModel: conversationModel"></swx-space-settings>\r\n        <!-- /ko -->\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: newConversationV2 -->\r\n        <div class="actions">\r\n             <div class="submitConversation">\r\n                <swx-button params="cssClass: \'secondary circle\', textKey: \'button_text_cancelAddParticipants\', i18nTitle: cancelAddParticipantsTitle, ariaLabelKey: cancelAddParticipantsTitle, action: undoSelectedParticipants"></swx-button>\r\n                <swx-button params="cssClass: \'primary circle\', textKey: \'button_text_addParticipants\', i18nTitle: addParticipantsTitle, ariaLabelKey: addParticipantsTitle, action: submitSelectedParticipants"></swx-button>\r\n            </div>\r\n            <!-- ko if: linkShown -->\r\n            <swx-conversation-share-link class="conversation-share-link-actions" params="conversationModel: conversationModel"></swx-conversation-share-link>\r\n            <!-- /ko -->\r\n        </div>\r\n    <!-- /ko -->\r\n</div>\r\n<!-- /ko -->\r\n\r\n<div class="headerControls" data-bind="css: { newConversationV2: newConversationV2, hide: !confirmButtonsVisible() }">\r\n    <!-- ko if: !newConversationV2 -->\r\n    <div class="buttonRow">\r\n        <swx-button params="conversation: conversationModel, icon: \'tick\', disabled: submitButtonDisabled, cssClass: \'secondary circle\', textKey: \'button_text_addParticipants\', ariaLabelKey: \'button_text_addParticipants\', titleKey: \'action_button_confirm\', action: submitSelectedParticipants"></swx-button>\r\n        <swx-button params="conversation: conversationModel, icon: \'cross\', cssClass: \'secondary circle\', textKey: \'button_text_cancelAddParticipants\', ariaLabelKey: \'button_text_cancelAddParticipants\', titleKey: \'action_button_cancel\', action: undoSelectedParticipants"></swx-button>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: newConversationV2 -->\r\n    <div class="buttonRow newConversationV2">\r\n        <swx-button data-bind="css: { hide: hideVideoButton}" class="callButtons" params="icon: \'videoOn\', cssClass: \'primary circle\', disabled: \'true\', textKey: \'button_text_videoCall\', i18nTitle: callButtonViewModel.buttonVideoTitle"></swx-button>\r\n        <swx-button data-bind="css: { hide: hideAudioButton}" class="callButtons" params="icon: \'callStart\', cssClass: \'primary circle\', disabled: \'true\', textKey: \'button_text_audioCall\', i18nTitle: callButtonViewModel.buttonCallTitle"></swx-button>\r\n\r\n        <!-- ko if: !showMoreActions() -->\r\n        <swx-button data-swx-testId="addParticipantAction" params="icon: \'contactAdd\', disabled: \'true\', cssClass: addParticipantsBtnClasses, textKey: \'button_text_addParticipants\', i18nTitle: buttonAddPeopleToConversationTitle"></swx-button>\r\n        <!-- /ko -->\r\n        <!-- ko if: showMoreActions() -->\r\n        <swx-more-actions-button class="moreActions" params="icon: \'more\', disabled: \'true\', cssClass: \'secondary circle stroke\', textKey: \'button_text_moreActions\'"></swx-more-actions-button>\r\n        <!-- /ko -->\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("ui/components/chat/header",["require","exports","module","vendor/knockout","swx-constants","ui/viewModels/chat/header","jsviews/chat/header","utils/common/focusRestrictor","browser/dom","constants/components","text!views/chat/header.html"],function(e,t){function a(e,u){var a=u.element,l=f(u.element),c=new s(a),h=[".Me",".toasts",".footer",".notifications","swx-sidebar"],p=o.build(a,h),d=i.build(e,p,l);return d.setContext(n.dataFor(a)),d.init(c),d.dispatchEvent(r.navigation.COMPONENT_RENDERED,t.name,d.DIRECTION.PARENT),d}function f(e){var t=u.getParentWithClass(e,"swxContent");return t?t.getAttribute("id"):null}var n=e("vendor/knockout"),r=e("swx-constants").COMMON.events,i=e("ui/viewModels/chat/header"),s=e("jsviews/chat/header"),o=e("utils/common/focusRestrictor"),u=e("browser/dom");t.name=e("constants/components").chat.HEADER,t.template=e("text!views/chat/header.html"),t.viewModel={createViewModel:a}}),define("ui/viewModels/chat/headerSingleConversation",["require","exports","module","lodash-compat","vendor/knockout","utils/common/cafeObservable","utils/common/eventMixin","swx-i18n","swx-service-locator-instance","swx-utils-common","swx-constants","swx-enums","browser/dom","utils/common/scroll","ui/telemetry/chat/guestActionsInHeader","ui/modelHelpers/personHelper","utils/common/outsideClickHandler"],function(e,t){function m(e,t){function S(e){m.participantsCount(e+(E?1:0))}function x(){return o.fetch({key:"conversation_header_topic_people_chatting",count:m.participantsCount()})}function T(){return{participantsCount:s.participants.length,userMessagesCount:s.historyService.activityItems().filter(function(e){return e.type()===l.activityType.TextMessage&&d.isMePerson(e.sender)}).length,totalMessagesCount:s.historyService.activityItems().length}}function N(e,t){w.publish(f.events.interaction.SCROLL_START,t)}var s=e.conversationModel,m=this,g=null,y,b=u.resolve(f.serviceLocator.FEATURE_FLAGS),w=u.resolve(f.serviceLocator.PUBSUB),E=b.isFeatureOn(f.featureFlags.INCLUDE_SELF_IN_PARTICIPANTS_COUNT);m.initializeParticipants=r.observable(!1),y=m.initializeParticipants.subscribe(function(e){!g&&e===!0&&a.execute(function(){g=h.build(c.getElement(".js-SingleConversation-scrollContainer",t)),g.init()},0)}),m.profileExpanded=r.observable(!1),m.participantsCount=r.observable(s.participantsCount()),s.participantsCount.changed(S),m.selfParticipant=s.selfParticipant,m.participants=i.newObservableCollection(s.participants),m.topic=r.computed(x),m.dispose=function(){s.participantsCount.changed.off(S),m.topic.dispose(),y.dispose(),v.remove("conversationHeader"),g&&g.dispose()},m.getParticipantName=function(e){return e.person.displayName()},m.onScroll=n.debounce(N,1e3,{leading:!0,trailing:!1}),m.toggleProfile=function(e){var t,n=m.profileExpanded();m.profileExpanded(!n),m.profileExpanded()?v.add("conversationHeader",m.toggleProfile):v.remove("conversationHeader"),t=T(),t.telemetryItem=e,t.profileExpanded=n,p.get().onProfileToggled(t),m.initializeParticipants(!0)},m.toggleProfileChevron=function(){m.toggleProfile(f.telemetry.guestActionsInHeader.telemetryItem[m.profileExpanded()?"CHEVRON_UP":"CHEVRON_DOWN"])}}var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("utils/common/cafeObservable"),s=e("utils/common/eventMixin"),o=e("swx-i18n").localization,u=e("swx-service-locator-instance").default,a=e("swx-utils-common").async,f=e("swx-constants").COMMON,l=e("swx-enums"),c=e("browser/dom"),h=e("utils/common/scroll"),p=e("ui/telemetry/chat/guestActionsInHeader"),d=e("ui/modelHelpers/personHelper"),v=e("utils/common/outsideClickHandler");n.assign(m.prototype,s),t.build=function(e,t){return new m(e,t)}}),define("text!views/chat/headerSingleConversation.html",[],function(){return'<div class="headerWac squeeze">\r\n    <div class="roster squeeze">\r\n        <span class="tileName square">\r\n            <h3>\r\n                <span class="hoverWrap">\r\n                    <a role="button" data-swx-testId="conversationTopic" data-bind="text: topic, click: toggleProfile.bind(this, \'telemetryItemTopic\'), attr: {\'tabindex\': -1,\'title\': topic}"></a>\r\n                    <span class="iconfont" data-bind="css: {chevronUp: profileExpanded, chevronDown: !profileExpanded()}, click: toggleProfileChevron"></span>\r\n        </span>\r\n        </h3>\r\n        </span>\r\n    </div>\r\n    <div class="notificationsBell">\r\n        <swx-notifications-toggle-button></swx-notifications-toggle-button>\r\n    </div>\r\n</div>\r\n<!-- ko if: initializeParticipants -->\r\n<div class="chat-participants" data-bind="css: {show: profileExpanded}">\r\n    <div class="scrollingContainer js-SingleConversation-scrollContainer">\r\n        <div class="participants-list scrollViewport scrollViewportV">\r\n            <ul data-bind="event: {scroll: onScroll}">\r\n                <li>\r\n                    <span data-bind="text: getParticipantName(selfParticipant)">\r\n                </span>\r\n                </li>\r\n                <!-- ko foreach: participants -->\r\n                <li>\r\n                    <span data-bind="text: $parent.getParticipantName($data)">\r\n                </span>\r\n                </li>\r\n                <!-- /ko -->\r\n            </ul>\r\n        </div>\r\n    </div>\r\n</div>\r\n<!-- /ko -->'}),define("ui/components/chat/headerSingleConversation",["require","exports","module","vendor/knockout","ui/viewModels/chat/headerSingleConversation","constants/components","text!views/chat/headerSingleConversation.html"],function(e,t){function i(e,t){var i=r.build(e,t.element);return i.setContext(n.dataFor(t.element)),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/headerSingleConversation");t.name=e("constants/components").chat.HEADER_SINGLE_CONVERSATION,t.template=e("text!views/chat/headerSingleConversation.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/groupProfile",["require","lodash-compat","vendor/knockout","utils/common/eventMixin","swx-constants","swx-i18n","swx-enums","swx-service-locator-instance","swx-constants","ui/contextMenu/contextMenu","utils/common/cafeObservable","swx-utils-chat","ui/contextMenu/menuItem","utils/common/eventHelper","swx-pubsub-instance","utils/common/location","ui/modalDialog/leaveConversationDialog","ui/modalDialog/removeConversationHistoryDialog","ui/modelHelpers/personHelper","swx-cafe-application-instance"],function(e){function w(e,r){function L(e,t){d.publish(a.events.interaction.SCROLL_START,t)}function A(e){S.lessParticipants(e<=4),S.participantCount(e),x.isFeatureOn(a.featureFlags.INCLUDE_SELF_IN_PARTICIPANTS_COUNT)&&S.participantCount(e+1)}function M(){return x.isFeatureOn(a.featureFlags.USE_BUSINESS_WORDING)}function D(e){return e+"_4b"}var E=e.conversationModel,S=this,x=u.resolve(a.serviceLocator.FEATURE_FLAGS),T=x.isFeatureOn(a.featureFlags.SPACES),N=x.isFeatureOn(a.featureFlags.REMOVE_CONVERSATION_HISTORY),C=!x.isFeatureOn(a.featureFlags.DISABLE_LEAVE_CONVERSATION),k=x.isFeatureOn(a.featureFlags.GROUP_AVATAR_UPDATE_ENABLED),O=l.newObservableProperty(E.isJoiningEnabled.set.enabled);S.model=E,S.closeLabel=s.fetch({key:"header_text_close"}),S.avatar=l.newObservableProperty(E.avatarUrl),S.spaceLink=l.newObservableProperty(E.uri),S.participants=l.newObservableCollection(E.participants),S.canLeaveConversation=C?l.newObservableProperty(E.leave.enabled):n.observable(!1),S.canRemoveConversation=!y.isGuest(b.get().personsAndGroupsManager.mePerson)&&N&&E.historyService.removeAll?l.newObservableProperty(E.historyService.removeAll.enabled):n.observable(!1),S.mailtoLink=n.computed(function(){return c.createMailtoLink(E.topic(),S.spaceLink())}),S.role=l.newObservableProperty(E.selfParticipant.role),S.isAdmin=n.computed(function(){return S.role()===o.participantRole.Leader}),S.groupProfileHeading=n.computed(function(){return S.isAdmin()?s.fetch({key:"header_text_adminSettings"}):s.fetch({key:"header_text_groupSettings"})}),S.spacesLinkAriaLabel=n.computed(function(){return s.fetch({key:"groupProfile_spacesLink_ariaLabel",params:{spacesUrl:S.spaceLink()}})}),S.participantCount=n.observable(E.participantsCount()),S.lessParticipants=n.observable(!0),E.participantsCount.changed(A),S.joiningEnabled=n.observable(E.isJoiningEnabled()),E.isJoiningEnabled.changed(S.joiningEnabled),S.historyDisclosed=n.observable(E.historyService.isHistoryDisclosed()),E.historyService.isHistoryDisclosed.changed(S.historyDisclosed),S.historyToggleAriaLabel=n.computed(function(){var e=S.historyDisclosed()?"accessibility_groupProfile_historyToggle_on":"accessibility_groupProfile_historyToggle_off";return s.fetch({key:e})}),S.joiningToggleAriaLabel=n.computed(function(){var e=S.joiningEnabled()?"accessibility_groupProfile_joiningToggle_on":"accessibility_groupProfile_joiningToggle_off";return s.fetch({key:e})}),S.joiningEnabledVisible=n.computed(function(){return T&&S.isAdmin()&&O()}),S.spaceLinkVisible=n.computed(function(){return T&&S.joiningEnabled()&&S.spaceLink()}),S.historyDisclosedVisible=n.observable(!1),E.historyService.isHistoryDisclosed.set.enabled.changed(S.historyDisclosedVisible),S.showSettings=n.computed(function(){return Boolean(S.historyDisclosedVisible()&&S.isAdmin()||S.joiningEnabledVisible()||S.spaceLinkVisible())}),S.avatarUpdateEnabled=k,S.dispose=function(){E.isJoiningEnabled.changed.off(S.joiningEnabled),E.historyService.isHistoryDisclosed.changed.off(S.historyDisclosed),E.isJoiningEnabled.set.enabled.changed.off(S.joiningEnabledVisible),E.historyService.isHistoryDisclosed.set.enabled.changed.off(S.historyDisclosedVisible),E.participantsCount.changed.off(A),r.dispose(),S.mailtoLink.dispose(),S.isAdmin.dispose(),S.groupProfileHeading.dispose(),S.spacesLinkAriaLabel.dispose(),S.joiningEnabledVisible.dispose(),S.spaceLinkVisible.dispose(),S.showSettings.dispose(),S.historyToggleAriaLabel.dispose(),S.joiningToggleAriaLabel.dispose()},S.leaveConversation=function(){m.start(S.model,a.telemetry.leaveConversation.cta.PROFILE)},S.handleLeaveConversationKeyUp=function(e,t){var n=p.isActivation(t);n&&S.leaveConversation()},S.removeConversationText=function(){var e="recentItemMenuItem_text_remove";return M()?s.fetch({key:D(e)}):s.fetch({key:e})},S.removeConversation=function(){g.start(S.model,a.telemetry.removeConversationHistory.cta.PROFILE)},S.handleRemoveConversationKeyUp=function(e,t){var n=p.isActivation(t);n&&S.removeConversation()},S.onHistoryDisclosedKeydown=function(e,t){var n=p.isActivation(t);return n&&S.historyDisclosedHandler(),!n},S.historyDisclosedHandler=function(){var e=S.historyDisclosed();E.historyService.isHistoryDisclosed.set(!e).catch(function(){})},S.onJoiningEnabledKeydown=function(e,t){var n=p.isActivation(t);return n&&S.joiningEnabledHandler(),!n},S.joiningEnabledHandler=function(){var e=S.joiningEnabled();E.isJoiningEnabled.set(!e).catch(function(){})},S.spaceMenuHandler=function(e,t){function o(){v.setHref(S.mailtoLink())}var n,r,i=[];n=new h(w.CopyLinkMenuItemType,s.fetch({key:"header_text_copyLink"})),i.push(n),r=new h(w.SendViaEmailMenuItemType,s.fetch({key:"header_text_inviteViaEmail"}),o),i.push(r),f.show(i,t)},S.onScroll=t.debounce(L,1e3,{leading:!0,trailing:!1}),S.init=function(){r.init(),S.forwardEvent(i.conversation.COPY_LINK,S.DIRECTION.PARENT),S.forwardEvent(i.conversation.EMAIL_LINK,S.DIRECTION.PARENT)}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/eventMixin"),i=e("swx-constants").COMMON.events,s=e("swx-i18n").localization,o=e("swx-enums"),u=e("swx-service-locator-instance").default,a=e("swx-constants").COMMON,f=e("ui/contextMenu/contextMenu"),l=e("utils/common/cafeObservable"),c=e("swx-utils-chat").spaceMail,h=e("ui/contextMenu/menuItem"),p=e("utils/common/eventHelper"),d=e("swx-pubsub-instance").default,v=e("utils/common/location"),m=e("ui/modalDialog/leaveConversationDialog"),g=e("ui/modalDialog/removeConversationHistoryDialog"),y=e("ui/modelHelpers/personHelper"),b=e("swx-cafe-application-instance");return t.assign(w.prototype,r),w.CopyLinkMenuItemType="CopyLinkMenuItem",w.SendViaEmailMenuItemType="SendViaEmailMenuItemType",w}),define("text!views/chat/groupProfile.html",[],function(){return'<div class="groupProfile fixSmall">\r\n    <div class="groupAvatarContainer">\r\n        <swx-avatar params="isGroupAvatar: true, size: 220, avatar: avatar"></swx-avatar>\r\n        <!-- ko if: avatarUpdateEnabled -->\r\n        <swx-avatar-file-picker class="Group-avatarFilePicker" params="conversationModel: model"></swx-avatar-file-picker>\r\n        <!-- /ko -->\r\n    </div>\r\n    <div class="settings" data-bind=\'css: { lessParticipants: lessParticipants }\'>\r\n        <!-- ko if: showSettings -->\r\n        <h4 data-bind="text: groupProfileHeading" class="fontSize-p">Manage group</h4>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: canLeaveConversation -->\r\n        <div class="settingItem fontSize-p">\r\n            <span>\r\n                <a href="#" role="button" data-bind="click: leaveConversation, l10n: {key: \'recentItemMenuItem_text_leave\'}"></a>\r\n            </span>\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: canRemoveConversation -->\r\n        <div class="settingItem fontSize-p">\r\n            <span>\r\n                <a href="#" role="button" data-bind="click: removeConversation, l10n: {key: removeConversationText()}"></a>\r\n            </span>\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <swx-mute-conversation-setting-item params="conversationModel: model"></swx-mute-conversation-setting-item>\r\n\r\n        <!-- ko if: historyDisclosedVisible() && isAdmin() -->\r\n        <div class="settingItem">\r\n            <span id="makeHistoryAvailable" class="fontSize-h4" data-bind="l10n: {key: \'header_text_makeHistoryAvailable\'}"></span>\r\n            <button role="checkbox" aria-labelledby="makeHistoryAvailable" class="toggler" data-bind="event: { keydown: onHistoryDisclosedKeydown }, click: historyDisclosedHandler, css: { checked: historyDisclosed }, attr: { \'aria-checked\': historyDisclosed() ? \'true\' : \'false\', \'aria-label\': historyToggleAriaLabel }" type="button"><span class="on"></span><span class="off"></span></button>\r\n        </div>\r\n        <!-- /ko -->\r\n        <!-- ko if: joiningEnabledVisible -->\r\n        <div class="settingItem">\r\n            <span id="joinViaLink" class="fontSize-h4" data-bind="l10n: {key: \'header_text_joinViaLink\'}"></span>\r\n            <button role="checkbox" aria-labelledby="joinViaLink" class="toggler" data-bind="event: { keydown: onJoiningEnabledKeydown }, click: joiningEnabledHandler, css: { checked: joiningEnabled }, attr: { \'aria-checked\': joiningEnabled() ? \'true\' : \'false\', \'aria-label\': joiningToggleAriaLabel }" type="button"><span class="on"></span><span class="off"></span></button>\r\n        </div>\r\n        <!-- /ko -->\r\n        <!-- ko if: spaceLinkVisible -->\r\n        <div class="space settingItem">\r\n            <swx-invite-link class="invite-link" params="topic: model.topic, uri: model.uri">\r\n            </swx-invite-link>\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n\r\n    <!-- ko if: participantCount -->\r\n    <div class="scrollingContainer participants" style="width:auto; overflow: hidden !important;" data-bind="keyboardNavigation: { itemSelector: \'a\' }">\r\n        <div role="list" id="groupParticipantsList" class="scrollViewport scrollViewportV" style="position: relative !important; max-height: 11em;" data-bind="event: { scroll: onScroll }, css: { lessParticipants: lessParticipants }, foreach: participants" tabindex="-1">\r\n            <swx-contact-card params="participant: $data, model: $parent.model" class="participant"></swx-contact-card>\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("ui/components/chat/groupProfile",["require","exports","module","browser/dom","utils/common/scroll","ui/viewModels/chat/groupProfile","vendor/knockout","constants/components","text!views/chat/groupProfile.html"],function(e,t){function o(e,t){var o=n.getElement(".scrollingContainer",t.element),u=r.build(o),a=s.dataFor(t.element),f=new i(e,u);return f.setContext(a),f.init(),f}var n=e("browser/dom"),r=e("utils/common/scroll"),i=e("ui/viewModels/chat/groupProfile"),s=e("vendor/knockout");t.name=e("constants/components").chat.GROUP_PROFILE,t.template=e("text!views/chat/groupProfile.html"),t.viewModel={createViewModel:o}}),define("ui/viewModels/chat/isTypingIndicator",["require","vendor/knockout","swx-constants","swx-utils-common","lodash-compat","swx-i18n","swx-service-locator-instance","swx-utils-people","utils/common/accessibility"],function(e){var t=e("vendor/knockout"),n=e("swx-constants").COMMON,r=e("swx-utils-common").array,i=e("lodash-compat"),s=n.isTyping,o=e("swx-i18n").localization,u=e("swx-service-locator-instance").default,a=e("swx-utils-people").personPropertyFormatter,f=e("utils/common/accessibility").narrator;return function(l){function g(){function r(n){e.length<s.DETAILED_PARTICIPANTS_MAX_COUNT?e.push(n.person):t++}function i(e){return a.truncateDisplayName(e.displayName())}var e=[],t=0,n;p.forEach(r),n=e.length+t,c.typingParticipantsCount(n);switch(n){case 0:return"";case 1:var u=o.fetch({key:"typingIndicator_label_oneParticipant",params:{firstParticipantName:i(e[0])}});return c.avatar(e[0].avatarUrl()),c.displayName(e[0].displayName()),f.announce(u),u;case 2:var l=o.fetch({key:"typingIndicator_label_twoParticipants",params:{firstParticipantName:i(e[0]),secondParticipantName:i(e[1])}});return c.displayName(null),c.avatar(null),f.announce(l),l;default:var h=o.fetch({key:"typingIndicator_label_multipleParticipants",params:{firstParticipantName:i(e[0]),secondParticipantName:i(e[1])},count:t});return c.displayName(null),c.avatar(null),f.announce(h),h}}function y(e,t){t?p.push(e):p=i.without(p,e),c.isTypingLabel(g())}function b(e){e.__isTypingSubscription=e.chat.isTyping.changed(y.bind(null,e))}function w(e){var t=i.indexOf(p,e);t>-1&&(r.removeFrom(p,t),c.isTypingLabel(g())),E(e)}function E(e){e.__isTypingSubscription&&(e.__isTypingSubscription.dispose(),delete e.__isTypingSubscription)}var c=this,h=l.participants,p=[],d=u.resolve(n.serviceLocator.FEATURE_FLAGS),v,m;this.avatar=t.observable(""),this.displayName=t.observable(""),this.typingParticipantsCount=t.observable(0),this.isTypingLabel=t.observable(""),this.isFeatureOn=d.isFeatureOn(n.featureFlags.IS_TYPING_INDICATOR),v=h.added(b),m=h.removed(w),this.dispose=function(){v.dispose(),m.dispose(),h.each(E)}}}),define("text!views/chat/isTypingIndicator.html",[],function(){return'<div class="typing" data-bind="css: { active: typingParticipantsCount() > 0 }">\r\n    <!-- ko if: isFeatureOn -->\r\n        <div class="grid margin">\r\n            <div class="indicator">\r\n                <swx-avatar params="avatar: avatar, displayName: displayName, useAbsolutePosition: true"></swx-avatar>\r\n                <span class="text">\r\n                    <p class="small" data-bind="html: isTypingLabel"></p>\r\n                </span>\r\n            </div>\r\n        </div>\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("ui/components/chat/isTypingIndicator",["require","exports","module","constants/components","ui/viewModels/chat/isTypingIndicator","text!views/chat/isTypingIndicator.html"],function(e,t){t.name=e("constants/components").chat.TYPING_INDICATOR,t.viewModel=e("ui/viewModels/chat/isTypingIndicator"),t.template=e("text!views/chat/isTypingIndicator.html")}),define("text!views/chat/timeline/currentCall.html",[],function(){return'<a data-bind="event: { click: model.handleClick, contextmenu: model.showContextMenu }, css: {read: model.isRead(), unread: !model.isRead(), \'active themeBlue\': model.isActive(), group: model.isGroupConversation, joinCall: model.canJoinCall}" class="recent">\r\n\r\n    <swx-avatar params="isGroupAvatar: model.isGroupConversation, avatar: model.avatarUrl, displayName: model.displayName, isPstn: model.isPstn"></swx-avatar>\r\n\r\n    <div class="text">\r\n        <span class="tile">\r\n            <span class="tileName">\r\n                <!-- ANTONMAG: Do not change it to HTML Binding! -->\r\n                <h4 data-bind="text: model.topic"></h4>\r\n            </span>\r\n        </span>\r\n\r\n        <div class="message callduration">\r\n            <p data-bind="text: model.callDuration, css:{\'iconfont callStart\': model.callDuration() === \'\'}">00:00</p>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- ko ifnot: model.isRead -->\r\n    <swx-unread-message-counter params="model:model"></swx-unread-message-counter>\r\n    <!-- /ko -->\r\n\r\n    <span class="controls">\r\n        <swx-current-call-actions params="conversationModel:model.conversation"></swx-current-call-actions>\r\n    </span>\r\n</a>\r\n'}),define("ui/components/chat/currentCall",["require","exports","module","constants/components","text!views/chat/timeline/currentCall.html"],function(e,t){t.name=e("constants/components").chat.CURRENT_CALL,t.template=e("text!views/chat/timeline/currentCall.html")}),define("text!views/chat/unreadMessageCounter.html",[],function(){return'<span class="counter"  data-bind="css: {complexNotification: model.unreadActivityItemsWithKeywordsCount() && model.unreadActivityItemsCount()}">\r\n    <!-- ko if: model.unreadActivityItemsCount()-->\r\n    <span class="circle" data-bind="css: {lightNotification: !model.notificationEnabled()}">\r\n        <p class="fontSize-h4" data-bind="text: model.unreadActivityItemsCount(), css: {light: !model.notificationEnabled()}">1</p>\r\n    </span>\r\n    <!-- /ko -->\r\n    <!-- ko if: model.unreadActivityItemsWithKeywordsCount()-->\r\n    <span class="circle with-keywords">\r\n        <p class="fontSize-h4" data-bind="text: model.unreadActivityItemsWithKeywordsCount">1</p>\r\n    </span>\r\n    <!-- /ko -->\r\n</span>\r\n'}),define("ui/components/chat/unreadMessageCounter",["require","exports","module","constants/components","text!views/chat/unreadMessageCounter.html"],function(e,t){t.name=e("constants/components").chat.UNREAD_MESSAGE_COUNTER,t.template=e("text!views/chat/unreadMessageCounter.html")}),define("ui/viewModels/chat/currentCallActions",["require","lodash-compat","utils/common/cafeObservable","utils/common/eventMixin","ui/viewModels/chat/conversationActivity"],function(e){function s(e){var t=this,r=e.conversationModel,s;s=i.build(r),t.conversation=r,t.isOnCall=s.isOnCall,t.canJoinCall=s.canJoinCall,t.canJoinWithVideo=n.newObservableProperty(r.videoService.start.enabled),t.dispose=function(){t.canJoinWithVideo.dispose(),s.dispose()}}var t=e("lodash-compat"),n=e("utils/common/cafeObservable"),r=e("utils/common/eventMixin"),i=e("ui/viewModels/chat/conversationActivity");return t.assign(s.prototype,r),s}),define("text!views/chat/timeline/currentCallActions.html",[],function(){return"<!-- ko if: canJoinCall -->\r\n    <swx-joincall-button params=\"visible: canJoinWithVideo, cssClass:'btn small primary green circle', conversationModel:conversation, showIcon:true, withVideo: true\"></swx-joincall-button>\r\n    <swx-joincall-button params=\"cssClass:'btn small primary green circle', conversationModel:conversation, showIcon:true\"></swx-joincall-button>\r\n<!-- /ko -->\r\n\r\n<!-- ko if: isOnCall -->\r\n    <!-- ko control: { name: 'muteControl', model: { conversation: conversation, isInCallScreen: false } } --> <!-- /ko -->\r\n    <!-- ko control: { name: 'endCallControl', model: { conversation: conversation, isInCallScreen: false } } --> <!-- /ko -->\r\n<!-- /ko -->\r\n"}),define("ui/components/chat/currentCallActions",["require","exports","module","vendor/knockout","ui/viewModels/chat/currentCallActions","constants/components","text!views/chat/timeline/currentCallActions.html"],function(e,t){function i(e,t){var i=new r(e);return i.setContext(n.dataFor(t.element)),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/currentCallActions");t.name=e("constants/components").chat.CURRENT_CALL_ACTIONS,t.template=e("text!views/chat/timeline/currentCallActions.html"),t.viewModel={createViewModel:i}}),define("text!views/chat/timeline/recentItem.html",[],function(){return'<a href="#" data-bind="event: { click: model.handleClick, contextmenu: model.showContextMenu }, attr: { \'role\': model.ariaRole }, css: model.cssClass" class="recent unread Avatar-whiteThemeHover" tabindex="-1">\r\n    <span role="log" class="offScreen" data-bind="text:model.ariaLabel"></span>\r\n    <swx-avatar params="isGroupAvatar: model.isGroupConversation, isAgent: model.isAgent, avatar: model.avatarUrl, status: model.statusClassName, isPstn: model.isPstn, displayName: model.displayName, isSelected: model.isActive"\r\n        class="avatar Avatar--whiteTheme"></swx-avatar>\r\n    <div class="text">\r\n        <span class="arrow"></span>\r\n        <span class="tile" aria-hidden="true">\r\n            <span class="tileName">\r\n                <h4>\r\n                    <!-- ANTONMAG: Do not change it to HTML Binding! -->\r\n                    <span class="topic" data-bind="text: model.topic, attr: {title: model.topic}"></span>\r\n                    <!-- ko if: model.isCertifiedAgent -->\r\n                    <span class="iconfont avatarBotCertified"></span>\r\n                    <!-- /ko -->\r\n                </h4>\r\n            </span>\r\n        </span>\r\n\r\n        <!-- ko if: model.isRead -->\r\n        <span class="tile">\r\n            <span class="tileMessage circle">\r\n                <!-- ko if: model.displayMessage() -->\r\n                <div class="message">\r\n                    <p data-bind="html: model.displayMessage" tabindex="-1"></p>\r\n                </div>\r\n                <!-- /ko -->\r\n            </span>\r\n        </span>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: model.displayNotificationsDisabledIndicator() -->\r\n        <div class="notificationsDisabledIndicator" aria-hidden="true">\r\n            <span class="iconfont"></span>\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: model.displayUnseenHeartsIcon() || !model.isRead() -->\r\n        <div class="unseenNotifications" aria-hidden="true">\r\n            <!-- ko if: model.displayUnseenHeartsIcon -->\r\n            <span class="circleHeart">\r\n                <span class="iconfont heart"></span>\r\n            </span>\r\n            <!-- /ko -->\r\n            <!-- ko ifnot: model.isRead -->\r\n            <swx-unread-message-counter params="model:model"></swx-unread-message-counter>\r\n            <!-- /ko -->\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko ifnot: model.isRead -->\r\n        <div class="message" aria-hidden="true">\r\n            <p data-bind="html: model.content" class="small" tabindex="-1"></p>\r\n\r\n            <!-- ko if: model.isLiveSession -->\r\n            <div class="callAction">\r\n                <div class="iconfont" data-bind="css: model.callAction"></div>\r\n            </div>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: model.isInfoMessage -->\r\n            <div class="infoMessage">\r\n                <div class="iconfont" data-bind="css: model.infoType"></div>\r\n            </div>\r\n            <!-- /ko -->\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n</a>\r\n'}),define("ui/components/chat/recentItem",["require","exports","module","constants/components","text!views/chat/timeline/recentItem.html"],function(e,t){t.name=e("constants/components").chat.RECENT_ITEM,t.template=e("text!views/chat/timeline/recentItem.html")}),define("utils/common/cancelation",["require","exports","module","lodash-compat"],function(e,t){function r(){}function i(){Error.call(this,"Operation canceled")}var n=e("lodash-compat");i.prototype=Error.prototype,r.prototype.getToken=function(){var t=this,n=function(){var n=new Promise(function(e,n){t.rejectTokenFn=n});return Object.defineProperty(n,"isCanceled",{get:function(){return t.isCanceled}}),n.throwIfCanceled=function(){if(t.isCanceled)throw new i},t.isCanceled=!1,n};return this.token=this.token||n(),this.token},r.prototype.cancel=function(t){t=t||new i,this.isCanceled=!0,this.rejectTokenFn(t)},t.makeCancelablePromise=function(t,n){return Promise.race([Promise.resolve(t),n])},t.makeCancelable=function(r,i){if(!i||!r||!n.isObject(r))return Promise.resolve(r);if(n.isFunction(r.makeCancelable))return r.makeCancelable(i);if(n.isFunction(r.then))return t.makeCancelablePromise(r,i)},t.adaptAbortable=function(t){return!t||!n.isObject(t)||!n.isFunction(t.abort)?t:(t.makeCancelable=function(e){var t=this,n;return e.catch(function(e){n=e,t.abort()}),Promise.resolve(this).catch(function(t){throw e.isCanceled?(n.innerException=t,n):t})},t)},t.cancelableOperation=function(){return new r},t.OperationCanceledError=i}),define("utils/common/interactor",["require","exports","module","lodash-compat"],function(e,t){function r(e){return e.hasOwnProperty("success")||Object.defineProperties(e,{failure:{value:!1,writable:!0,enumerable:!1},success:{value:!0,writable:!0,enumerable:!1},error:{value:null,writable:!0,enumerable:!1},fail:{value:function(e){this.failure=!0,this.success=!1,this.error=e},writable:!0,enumerable:!1}}),e}function i(){this.definition={before:[],after:[],around:[],run:null,rollback:null}}function s(e){this._definition=e}function o(e){return e instanceof s?function(){Function.prototype.apply.call(e.run,e,arguments)}:e}function u(e){return e instanceof s?e:t.defineSimpleInteractor(e)}function a(){}function f(e){if(!e.success)throw new a}function l(e,t){n.forEach(e.before,function(e){Function.prototype.apply.call(e,t,[t.context].concat(t.arguments)),f(t.context)})}function c(e,t){e.rollback&&Function.prototype.apply.call(e.rollback,t,[t.context].concat(t.arguments))}function h(e,t){(function n(r){f(t.context),r<e.around.length?Function.prototype.apply.call(e.around[r],t,[t.context,n.bind(null,r+1)].concat(t.arguments)):Function.prototype.apply.call(e.run,t,[t.context].concat(t.arguments)),f(t.context)})(0)}function p(e,t){n.forEachRight(e.after,function(e){Function.prototype.apply.call(e,t,[t.context].concat(t.arguments)),f(t.context)})}function d(e,t){l(e,t),h(e,t),p(e,t)}function v(e){var t=n.map(e,u),r={before:[],after:[],around:[],run:function(){var e=this,n=0,r;try{while(n<t.length)r=t[n]._definition,d(r,e),n++}catch(i){i instanceof a||e.context.fail(i),n--;while(n>=0)r=t[n]._definition,c(r,e),n--;throw i}},rollback:function(){var e=this,n=0,r;n=t.length-1;while(n>=0)r=t[n]._definition,c(r,e),n--}};s.call(this,r)}function m(e){var t;if(!e)return;e.run&&this.run(e.run),e.before&&(t=n.isArray(e.before)?e.before:[e.before],n.forEach(t,function(e){this.before(e)},this)),e.after&&(t=n.isArray(e.after)?e.after:[e.after],n.forEach(t,function(e){this.after(e)},this)),e.onlyIf&&(t=n.isArray(e.onlyIf)?e.onlyIf:[e.onlyIf],n.forEach(t,function(e){this.onlyIf(e)},this)),e.around&&(t=n.isArray(e.around)?e.around:[e.around],n.forEach(t,function(e){this.around(e)},this)),e.rollback&&this.rollback(e.rollback)}var n=e("lodash-compat");i.prototype={run:function(e){this.definition.run=o(e)},before:function(e){this.definition.before.push(o(e))},after:function(e){this.definition.after.push(o(e))},around:function(e){this.definition.around.push(o(e))},onlyIf:function(e){var t=e;n.isFunction(e)||(t=function(){return e}),this.around(function(e,n){t()&&n()})},rollback:function(e){this.definition.rollback=o(e)}},s.prototype.run=function(){var e=Array.prototype.slice.call(arguments),t={context:r(e[0]||{}),arguments:e.slice(1)},n=this,i=n._definition;try{d(i,t)}catch(s){!s instanceof a&&t.context.fail(s)}return t.context},v.prototype=Object.create(s.prototype),t.defineInteractor=function(t){var r=new i,o=t;return n.isFunction(t)||(o=function(){m.call(this,t)}),o.call(r,r.run.bind(r),r.before.bind(r),r.after.bind(r),r.around.bind(r),r.rollback.bind(r)),new s(r.definition)},t.defineSimpleInteractor=function(n){return t.defineInteractor({run:n})},t.defineComposer=function(t){return new v(t)}}),define("services/pes/interactors/bing",["require","exports","module","lodash-compat","swx-i18n","utils/common/interactor","experience/settings","services/pes/constants"],function(e,t){var n=e("lodash-compat"),r=e("swx-i18n").localization,i=e("utils/common/interactor"),s=e("experience/settings"),o=e("services/pes/constants");t.computeAspectRatios=i.defineSimpleInteractor(function(e){var t=e.items||[];n.forEach(t,function(e){e.aspectRatio=e.width/e.height})}),t.computeGridLayoutSizes=i.defineInteractor(function(e){function t(e,t){var n=[],r,i;for(r=0;r<e;r+=1){var s=[];for(i=0;i<t;i+=1)s.push(0);n.push(s)}return n}function r(e,r){var i,s,o,u,a,f,l,c,h;a=e.length;if(r<=0)return[];if(r>a)return e.map(function(e){return[e]});l=t(a,r),f=t(a-1,r-1);for(s=0;s<a;s+=1)l[s][0]=e[s]+(s?l[s-1][0]:0);for(o=0;o<r;o+=1)l[0][o]=e[0];for(s=1;s<a;s+=1)for(o=1;o<r;o+=1){h=[];for(c=0;c<s;c+=1)h.push([n.max([l[c][o-1],l[s][0]-l[c][0]]),c]);u=n.min(h,function(e){return e[0]}),l[s][o]=u[0],f[s-1][o-1]=u[1]}a-=1,r-=2,i=[];while(r>=0)i=[function(){var t,n,i,o;o=[];for(s=t=n=f[a-1][r]+1,i=a+1;n<=i?t<i:t>i;s=n<=i?++t:--t)o.push(e[s]);return o}()].concat(i),a=f[a-1][r],r-=1;return[function(){var t,n,r;r=[];for(s=t=0,n=a+1;0<=n?t<n:t>n;s=0<=n?++t:--t)r.push(e[s]);return r}()].concat(i)}e(function(e,t,i,s,o){t=t||6,i=i||100,s=s||100,o=o||0;var u=e.items||[],a=s/t,f=u.reduce(function(e,t){return e+t.aspectRatio*a},0),l=Math.round(f/i)||1,c=u.map(function(e){return e.aspectRatio*100}),h=r(c,l),p=0;n.forEach(h,function(e){var t=[],r=i-o*e.length;n.forEach(e,function(){t.push(u[p]),p+=1});var s=t.reduce(function(e,t){return e+t.aspectRatio},0);n.forEach(t,function(e){e.scaledWidth=parseInt(r/s*e.aspectRatio),e.scaledHeight=parseInt(r/s)})})})}),t.collectItemsToPack=i.defineSimpleInteractor(function(e){var t=e.items||[],n={ariaLabel:r.fetch({key:e.packAriaLabelKey}),title:r.fetch({key:e.packTitleKey}),id:e.packID,isHidden:!1,items:[]};n.items=n.items.concat(t),e.pack=n}),t.assignImageItemProperties=i.defineSimpleInteractor(function(e){var t=e.items||[],r=e.sizingUnit||"em";n.forEach(t,function(e){e.thumbnail=e.thumbnail.replace("http:","https:"),e.staticThumbnail=e.thumbnail,e.type="image",e.thumbnailStyle="width: "+e.scaledWidth+r+"; height: "+e.scaledHeight+r+";",["aspectRatio","height","scaledHeight","scaledWidth","width"].forEach(function(t){e.hasOwnProperty(t)&&delete e[t]})})}),t.createBingPacks=i.defineSimpleInteractor(function(e){var r,s,u=i.defineComposer([t.computeAspectRatios,function(e){t.computeGridLayoutSizes.run(e,6,99,200)},t.assignImageItemProperties,t.collectItemsToPack]),a,f;e.packs=[],e.items=[],e.featureGifsFirst?(r=e.gifResults,s=e.memeResults):(r=e.memeResults,s=e.gifResults),e.featureCombine?(a=n.compact(n.flatten(n.flatten(n.zip(r,s)))),f=u.run(n.assign({items:a,packTitleKey:"expressionPicker_bingPack_title",packAriaLabelKey:"expressionPicker_bingPack_ariaLabel",packID:o.bingSearch.PACK_PREFIX+"items"},n.pick(e,["desiredRows","idealWidth","availableHeight","lossToPadding"]))),f.pack&&(e.packs.push(f.pack),e.items=e.items.concat(f.items))):(f=u.run(n.assign({items:r,packTitleKey:e.featureGifsFirst?"expressionPicker_bingGifsPack_title":"expressionPicker_bingMemePack_title",packAriaLabelKey:e.featureGifsFirst?"expressionPicker_bingGifsPack_ariaLabel":"expressionPicker_bingMemePack_ariaLabel",packID:o.bingSearch.PACK_PREFIX+(e.featureGifsFirst?"gifs":"memes")},n.pick(e,["desiredRows","idealWidth","availableHeight","lossToPadding"]))),f.pack&&(e.packs.push(f.pack),e.items=e.items.concat(f.items)),f=u.run(n.assign({items:s,packTitleKey:e.featureGifsFirst?"expressionPicker_bingMemePack_title":"expressionPicker_bingGifsPack_title",packAriaLabelKey:e.featureGifsFirst?"expressionPicker_bingMemePack_ariaLabel":"expressionPicker_bingGifsPack_ariaLabel",packID:o.bingSearch.PACK_PREFIX+(e.featureGifsFirst?"memes":"gifs")},n.pick(e,["desiredRows","idealWidth","availableHeight","lossToPadding"]))),f.pack&&(e.packs.push(f.pack),e.items=e.items.concat(f.items)))}),t.putBingTab=i.defineSimpleInteractor(function(e){var t={id:o.bingSearch.TAB_ID,type:o.itemTypes.tab.id,title:r.fetch({key:"expressionPicker_bingTab_title"}),ariaLabel:r.fetch({key:"expressionPicker_bingTab_ariaLabel"}),emptyTabMessageKey:"expressionPicker_bingTab_emptyText",thumbnailUrl:s.appBaseUrl+"/assets/images/components/chat/pes/tab_bing.png",styleOverride:"large-tab",packs:[]};n.remove(e.tabs,{id:o.bingSearch.TAB_ID}),e.tabs.push(t)}),t.setBingTabProperties=i.defineSimpleInteractor(function(e){e.selectedTab&&e.selectedTab.id===o.bingSearch.TAB_ID&&(e.pickerMaximized=!0,e.searchCapabilityEnabled=!0)})}),define("services/pes/interactors/giphy",["require","exports","module","lodash-compat","swx-i18n","utils/common/interactor","services/pes/interactors/bing","experience/settings","services/pes/constants"],function(e,t){var n=e("lodash-compat"),r=e("swx-i18n").localization,i=e("utils/common/interactor"),s=e("services/pes/interactors/bing"),o=e("experience/settings"),u=e("services/pes/constants");t.putGiphyTab=i.defineSimpleInteractor(function(e){var t={id:u.giphyImageSearch.TAB_ID,type:u.itemTypes.tab.id,title:r.fetch({key:"expressionPicker_giphyImgTab_title"}),ariaLabel:r.fetch({key:"expressionPicker_giphyImgTab_ariaLabel"}),emptyTabMessageKey:"expressionPicker_giphyImgTab_emptyText",thumbnailUrl:o.appBaseUrl+"/assets/images/components/chat/pes/tab_giphy.png",styleOverride:"large-tab",packs:[]};n.remove(e.tabs,{id:u.giphyImageSearch.TAB_ID}),e.tabs.push(t)}),t.setGiphyTabProperties=i.defineSimpleInteractor(function(e){e.selectedTab&&e.selectedTab.id===u.giphyImageSearch.TAB_ID&&(e.pickerMaximized=!0,e.searchCapabilityEnabled=!0)}),t.mapGiphyAPIResults=i.defineSimpleInteractor(function(e){e.items=n.map(e.data,function(e){return{querySource:e.querySource,width:e.images.downsized.width,height:e.images.downsized.height,thumbnail:e.images.downsized.url,id:e.id,url:e.images.original.url}})}),t.createGiphyPacks=i.defineSimpleInteractor(function(e){var r=i.defineComposer([t.mapGiphyAPIResults,s.computeAspectRatios,function(e){s.computeGridLayoutSizes.run(e,6,99,200)},s.assignImageItemProperties,s.collectItemsToPack]);e.packs=[],e.items=[];var o=r.run(n.assign({data:e.data,packTitleKey:"expressionPicker_giphyImgPack_title",packAriaLabelKey:"expressionPicker_giphyImgPack_ariaLabel",packID:u.giphyImageSearch.PACK_PREFIX+"items"},n.pick(e,["desiredRows","idealWidth","availableHeight","lossToPadding"])));o.pack&&(e.packs.push(o.pack),e.items=e.items.concat(o.items))})}),define("utils/common/url",["require","exports","module","lodash-compat"],function(e,t){function r(e,t){return e+n.reduce(n.pairs(t||{}),function(e,t){return e?e+="&":e="?",n.isUndefined(t[1])||t[1]===null?e+=encodeURIComponent(t[0]):e=e+encodeURIComponent(t[0])+"="+encodeURIComponent(t[1]),e},"")}var n=e("lodash-compat");t.buildUrl=r}),define("utils/chat/pesUtils",["require","lodash-compat","swx-constants","services/pes/constants","swx-service-locator-instance","experience/settings","utils/common/url"],function(e){function u(){function f(t){var r=i.resolve(n.serviceLocator.FEATURE_FLAGS);return r.isFeatureOn(n.featureFlags.PES_CDN_AUTH_ENABLED)?a=function(t){return e.rewriteUrls(t,s.pesCDNAuthentication.rewriteRules)}:a=function(e){return e},a(t)}var e=this,u={small:"getSmall",large:"getLarge",extraLarge:"getExtraLarge"},a=f;this.buildEmoticonUrl=function(t,n,i,s){var f=t+"/"+n.id+"/views/";f=a(f);var l=u[i]+(s?"Animated":"");return o.buildUrl(f+r.profiles.emoticons[l](),{etag:n.etag})},this.rewriteUrls=function(n,r){if(typeof n!="string")return n;var i=n;return t.any(r,function(e){return i.search(e.from)!==-1?(i=i.replace(e.from,e.to),!0):!1}),i},this._resetUrlRewriterSetup=function(){a=f}}var t=e("lodash-compat"),n=e("swx-constants").COMMON,r=e("services/pes/constants"),i=e("swx-service-locator-instance").default,s=e("experience/settings"),o=e("utils/common/url");return new u}),define("services/pes/interactors/cloud",["require","exports","module","lodash-compat","swx-constants","utils/common/interactor","services/pes/constants","ui/modelHelpers/personHelper","utils/chat/pesUtils","swx-service-locator-instance","experience/settings"],function(e,t){var n=e("lodash-compat"),r=e("swx-constants").COMMON,i=e("utils/common/interactor"),s=e("services/pes/constants"),o=e("ui/modelHelpers/personHelper"),u=e("utils/chat/pesUtils"),a=e("swx-service-locator-instance").default,f=e("experience/settings");t.pesGetConfig=i.defineSimpleInteractor(function(t){var i=a.resolve(r.serviceLocator.PES_CONFIG_SERVICE);n.assign(t,n.cloneDeep(i.getConfiguration()))}),t.pesDecorateTabs=i.defineSimpleInteractor(function(t){var r={emptyTabMessageKey:"expressionPicker_tab_emptyText"};t.tabs.forEach(function(e){n.defaults(e,r)})}),t.pesHideMojis=i.defineSimpleInteractor(function(t){var r=t.conversationModel;if(!r||!r.participants().length)return;var i=r.participants(0).person,u=o.isAgent(i),a=!!i&&!!i.capabilities._mojiSend&&i.capabilities._mojiSend();!r.isGroupConversation()&&u&&!a&&n.forEach(t.items,function(e){e.type===s.itemTypes.moji.id&&(e.visible=!1)})}),t.pesRemoveHiddenItems=i.defineSimpleInteractor(function(t){n(t.tabs).map("packs").flatten().forEach(function(e){e.items=n.reject(e.items,{visible:!1})}).value()}),t.pesDecorateEmoticons=i.defineSimpleInteractor(function(e){e.items.forEach(function(e){e.type===s.itemTypes.emoticon.id&&(e.staticHtmlClass=e.id,e.staticExtraLargeHtmlClass=e.staticHtmlClass+" extraLarge",e.animatedExtraLargeHtmlClass=e.staticExtraLargeHtmlClass+" animated",e.shortcut=n.first(e.shortcuts)||"",["etag","facebook","keywords","media","shortcuts","useInSms","visible"].forEach(function(t){e.hasOwnProperty(t)&&delete e[t]}))})}),t.pesDecorateMojis=i.defineSimpleInteractor(function(e){e.items.forEach(function(t){t.type===s.itemTypes.moji.id&&(t.mojiId=e.itemsRoot+"/"+t.id,t.thumbnailClass="id_"+t.id+" thumbnail",t.keyframeClass="id_"+t.id+" keyframe",t.contentUrl=e.itemsRoot+"/"+t.id+"/views/"+s.profiles.moji.content,e._requiresCDNUrlAuthentication&&(t.contentUrl+="?"+e._cdnToken),["etag","auxiliaryUrl","isSponsored","keywords"].forEach(function(e){t.hasOwnProperty(e)&&delete t[e]}))})}),t.pesRewriteMojiPaths=i.defineSimpleInteractor(function(e){var t=a.resolve(r.serviceLocator.FEATURE_FLAGS);t.isFeatureOn(r.featureFlags.PES_CDN_AUTH_ENABLED)&&e.items.forEach(function(e){e.type===s.itemTypes.moji.id&&(e.contentUrl=u.rewriteUrls(e.contentUrl,f.pesCDNAuthentication.rewriteRules))})}),t.pesConfigPipeline=i.defineComposer([t.pesGetConfig,t.pesHideMojis,t.pesRemoveHiddenItems,t.pesDecorateTabs,t.pesDecorateEmoticons,t.pesDecorateMojis,t.pesRewriteMojiPaths]),t.putPesTabs=i.defineSimpleInteractor(function(e){var n=t.pesConfigPipeline.run({conversationModel:e.conversationModel});e.tabs=e.tabs.concat(n.tabs),e._configuredItems=e._configuredItems.concat(n.items)})}),define("services/pes/interactors/mru",["require","exports","module","lodash-compat","swx-constants","swx-i18n","utils/common/interactor","services/pes/constants","swx-service-locator-instance","experience/settings"],function(e,t){var n=e("lodash-compat"),r=e("swx-constants").COMMON,i=e("swx-i18n").localization,s=e("utils/common/interactor"),o=e("services/pes/constants"),u=e("swx-service-locator-instance").default,a=e("experience/settings");t.createMRUTab=s.defineInteractor(function(e){function t(){return{id:o.mru.TAB_ID,type:o.itemTypes.tab.id,title:i.fetch({key:o.itemTypes.tab.titleLocKey}),ariaLabel:i.fetch({key:o.itemTypes.tab.ariaLabelLocKey}),emptyTabMessageKey:"expressionPicker_mruTab_emptyText",thumbnailUrl:a.appBaseUrl+"/assets/images/components/chat/pes/tab_mru.png",packs:[]}}function s(e){return o.mru.PACK_PREFIX+e}function f(e){return{ariaLabel:i.fetch({key:o.itemTypes[e].ariaLabelLocKey}),title:i.fetch({key:o.itemTypes[e].titleLocKey}),id:s(e),isHidden:!1,items:[]}}function l(){return[f(o.itemTypes.emoticon.id),f(o.itemTypes.moji.id)]}e(function(e){var i=u.resolve(r.serviceLocator.PES_MRU_SERVICE),o=i.getMRUItems(),a=t(),f=l();n.forEach(o,function(t){var r=n.find(f,{id:s(t.type)}),i=n.find(e._configuredItems,{id:t.id});i&&r.items.push(i)}),a.packs=n.reject(f,function(e){return e.items.length===0}),e.mruTab=a})}),t.putMRUTab=s.defineSimpleInteractor(function(e){var r=t.createMRUTab.run(n.pick(e,"_configuredItems"));n.remove(e.tabs,{id:o.mru.TAB_ID}),e.tabs.unshift(r.mruTab)})}),define("services/pes/interactors/localSearch",["require","exports","module","lodash-compat","swx-i18n","utils/common/interactor","experience/settings","services/pes/constants"],function(e,t){var n=e("lodash-compat"),r=e("swx-i18n").localization,i=e("utils/common/interactor"),s=e("experience/settings"),o=e("services/pes/constants");t.putLocalSearchTab=i.defineSimpleInteractor(function(e){var t={id:o.localSearch.TAB_ID,type:o.itemTypes.tab.id,title:r.fetch({key:"expressionPicker_localSearchTab_title"}),ariaLabel:r.fetch({key:"expressionPicker_localSearchTab_title"}),emptyTabMessageKey:"expressionPicker_localSearchTab_emptyText",thumbnailUrl:s.appBaseUrl+"/assets/images/components/chat/pes/tab_search.png",styleOverride:"",packs:[]};e.tabs=e.tabs||[],n.remove(e.tabs,{id:o.localSearch.TAB_ID}),e.tabs.push(t)}),t.setLocalSearchTabProperties=i.defineSimpleInteractor(function(e){e.selectedTab&&e.selectedTab.id===o.localSearch.TAB_ID&&(e.searchCapabilityEnabled=!0)}),t.groupByType=i.defineSimpleInteractor(function(e){var t=n(["emoticon","flik"]).reduce(function(e,t){return e[t]={ariaLabel:r.fetch({key:o.itemTypes[t].ariaLabelLocKey}),title:r.fetch({key:o.itemTypes[t].titleLocKey}),id:o.localSearch.PACK_PREFIX+o.itemTypes[t].id,items:[]},e},{});n(e.packs).pluck("items").flatten().reduce(function(e,t){return t.type in e&&e[t.type].items.push(t),e},t),e.packs=n(t).map(function(e){return e}).value(),n.forEach(e.packs,function(e){e.items.length===0&&e.items.push({id:"",type:o.itemTypes.message.id,htmlClass:"",text:r.fetch({key:"message_text_emptySearchResults"})})})})}),define("services/pes/interactors/picker",["require","exports","module","lodash-compat","services/pes/interactors/bing","services/pes/interactors/giphy","services/pes/interactors/cloud","swx-constants","experience/settings","utils/common/interactor","services/pes/interactors/mru","services/pes/interactors/localSearch","services/pes/constants","swx-service-locator-instance"],function(e,t){function p(e){return e===c.localSearch.TAB_ID||e===c.giphyImageSearch.TAB_ID||e===c.bingSearch.TAB_ID?"":"multiLineImageItem"}var n=e("lodash-compat"),r=e("services/pes/interactors/bing"),i=e("services/pes/interactors/giphy"),s=e("services/pes/interactors/cloud"),o=e("swx-constants").COMMON,u=e("experience/settings"),a=e("utils/common/interactor"),f=e("services/pes/interactors/mru"),l=e("services/pes/interactors/localSearch"),c=e("services/pes/constants"),h=e("swx-service-locator-instance").default;t.clearContext=a.defineSimpleInteractor(function(t){t.tabs=[],t.selectedTab=null,t.selectedItem=null,t.selectedTabId=null,t.selectedItemId=null,t._configuredItems=[]}),t.fillTabProperties=a.defineSimpleInteractor(function(e){n.forEach(e.tabs,function(e){n.defaults(e,{ariaLabel:e.title,htmlClass:p(e.id),styleOverride:"",emptyTabMessageKey:"expressionPicker_tab_emptyText"})})}),t.fillPackProperties=a.defineSimpleInteractor(function(e){n(e.tabs).pluck("packs").flatten().forEach(function(e){e.items["@Meta"]=n.assign(e.items["@Meta"]||{},{typeKey:c.itemTypes.typeKeyName})}).value()}),t.hideEmptyTabs=a.defineSimpleInteractor(function(e){e.tabs=n.filter(e.tabs,function(e){if(e.id===c.mru.TAB_ID||e.id===c.bingSearch.TAB_ID||e.id===c.localSearch.TAB_ID||e.id===c.giphyImageSearch.TAB_ID)return!0;var t;return n.forEach(e.packs,function(e){e.items&&e.items.length&&(t=!0)}),t})}),t.paginateTabs=a.defineInteractor(function(e){function t(){return{tabs:[]}}function r(e){if(e.length<7){var r=t(!0);return r.tabs=n.map(e,function(e){return n.pick(e,["id","title","ariaLabel","htmlClass","type","thumbnailUrl"])}),[r]}var i=e.reduce(function(e,r,i){var s=e[e.length-1];return s.tabs.length>=4&&i!==4&&(s=t(),e.push(s)),s.tabs.push(n.pick(r,["id","title","ariaLabel","htmlClass","type","thumbnailUrl"])),e},[t()]),s=i[i.length-1];return s.tabs.length===1&&(i[i.length-2].tabs.push(s.tabs[0]),i.pop()),i}e(function(e){e.pagedTabs=r(e.tabs)})}),t.setSelectedTab=a.defineSimpleInteractor(function(e){e.selectedTab=n.find(e.tabs,{id:e.currentTabId})||n.first(n.dropWhile(e.tabs,{id:c.mru.TAB_ID}))||n.first(e.tabs)}),t.scrollToSelectedTab=a.defineSimpleInteractor(function(e){e.selectedPageIndex=n.findIndex(e.pagedTabs,function(t){return n.any(t.tabs,{id:e.selectedTab.id})})}),t.setNormalTabProperties=a.defineSimpleInteractor(function(e){e.pickerMaximized=!1,e.searchCapabilityEnabled=!1}),t.selectItemAction=a.defineSimpleInteractor(function(e){e.selectedItem=n.find(e._configuredItems,{id:e.selectedItemId})||null}),t.setSelectionState=a.defineComposer([t.setSelectedTab,t.setNormalTabProperties,r.setBingTabProperties,i.setGiphyTabProperties,l.setLocalSearchTabProperties,t.fillPackProperties]),t.numberTabs=a.defineSimpleInteractor(function(t){n.forEach(t.tabs,function(e,t){e._index=t})}),t.placeTab=a.defineSimpleInteractor(function(t,r,i){var s=n.remove(t.tabs,{id:r});s.length&&(i===-1?t.tabs.push(s[0]):t.tabs.splice(i,0,s[0]))}),t.applyTabPlacementOverrides=a.defineSimpleInteractor(function(r){var i=r.pesTabPlacementOverrides||u.pesPicker.tabPlacementOverrides;n.forOwn(i,function(e,n){t.placeTab.run(r,n,e)})}),t.pickerStateConstructor=function(){var e=h.resolve(o.serviceLocator.FEATURE_FLAGS),n=[t.clearContext,s.putPesTabs];return e.isFeatureOn(o.featureFlags.PES_BING_IMAGE_SEARCH_ENABLED)&&n.push(r.putBingTab),e.isFeatureOn(o.featureFlags.PES_GIPHY_IMAGE_SEARCH_ENABLED)&&n.push(i.putGiphyTab),e.isFeatureOn(o.featureFlags.PES_LOCAL_SEARCH_ENABLED)&&n.push(l.putLocalSearchTab),n=n.concat([f.putMRUTab,t.fillTabProperties,t.fillPackProperties,t.hideEmptyTabs,t.applyTabPlacementOverrides,t.paginateTabs,t.numberTabs,t.setSelectionState]),a.defineComposer(n)},t.mruStateUpdater=a.defineComposer([f.putMRUTab,t.fillTabProperties,t.fillPackProperties,t.paginateTabs,t.numberTabs,t.setSelectionState])}),define("ui/components/chat/pes/bingTab/bingSearchTab",["require","lodash-compat","swx-cafe-application-instance","utils/common/cancelation","swx-constants","services/pes/constants","swx-service-locator-instance","services/pes/interactors/bing","services/pes/interactors/picker","experience/settings"],function(e){function l(e,t){var n=o.resolve(i.serviceLocator.PES_BING_SEARCH_SERVICE);return Promise.all([n.search(e+" meme",{cancelationToken:t}),n.search(e+" gif",{cancelationToken:t})])}function c(e,r,s){return n.get().signInManager._skypeToken?n.get().signInManager._skypeToken().then(function(n){var u=o.resolve(i.serviceLocator.URL_PREVIEW_SERVICE),a=t.map(e,function(e){if(e.contentType==="image/animatedgif"){var t=u.getPreviewFor(e.url,{cancelationToken:r,skypeToken:n}),i=function(t){s&&s(e,t)};return t.then(i).catch(function(){})}return Promise.resolve()});return Promise.all(a)}):Promise.resolve([])}function h(e,n,r,i){function g(n,r){if(r.thumbnail&&r.content_type==="image/gif"){var i=t.find(e._configuredItems,{id:n.id});i&&(i.thumbnail=r.thumbnail,d())}}var o=n[0],a=n[1],l=f.pesSearchServices.bingPickFirst==="gif",h=!!f.pesSearchServices.bingMergeItems,p=u.createBingPacks.run({featureGifsFirst:l,featureCombine:h,gifResults:a,memeResults:o}),d=t.throttle(function(){i.isCanceled||r(e)},400),v;i.throwIfCanceled(),t.remove(e._configuredItems,function(e){return e.type===s.itemTypes.image.id&&t.find(p.items,{id:e.id})}),e._configuredItems=e._configuredItems.concat(p.items),v=t.find(e.tabs,{id:s.bingSearch.TAB_ID});var m=t.every(p.packs,function(e){return e.items.length===0});return m?v.emptyTabMessageKey="message_text_emptySearchResults":(v.packs=p.packs,v.emptyTabMessageKey="expressionPicker_bingTab_emptyText"),r(e),c(p.items,i,g)}function p(e,n,i){var o,u;u=t.find(n.tabs,{id:s.bingSearch.TAB_ID}),u&&(u.emptyTabMessageKey="expressionPicker_bingTab_loadingText"),v(n),o=r.cancelableOperation(),n._currentOperation=o,u._currentQuery=e,u.packs=[],i(n),l(e,o.getToken()).then(function(e){h(n,e,i,o.getToken())}).catch(function(e){if(e instanceof r.OperationCanceledError)return;var o=t.find(n.tabs,{id:s.bingSearch.TAB_ID});o.emptyTabMessageKey="expressionPicker_bingTab_errorText",i(n)})}function d(e,n,r){var i=t.map(f.pesSearchServices.bingTriggerWords,function(e){return e.toLowerCase()}),o=(e||"").toLowerCase().split(/\s/),u=t.remove(o,t.includes.bind(t,i)),l,c;t.any(u)&&(l=t.compact(o).join(" "),c=t.find(n.tabs,{id:s.bingSearch.TAB_ID}),c._currentQuery=l,n.currentTabId=s.bingSearch.TAB_ID,n=a.setSelectionState.run(n),r(n))}function v(e){var n;e._currentOperation&&(n=t.find(e.tabs,{id:s.bingSearch.TAB_ID}),n&&(n._currentQuery=""),e._currentOperation.cancel())}var t=e("lodash-compat"),n=e("swx-cafe-application-instance"),r=e("utils/common/cancelation"),i=e("swx-constants").COMMON,s=e("services/pes/constants"),o=e("swx-service-locator-instance").default,u=e("services/pes/interactors/bing"),a=e("services/pes/interactors/picker"),f=e("experience/settings");return{highlightTabOnBingKeywords:d,doBingSearch:p,cancelBingSearch:v,getResultsFromBing:l,getImagesFromURLPService:c,processResultsFromBing:h}}),define("telemetry/chat/giphyServiceQOS",["require","exports","module","swx-utils-common","experience/settings","swx-constants","ui/telemetry/telemetryClient","swx-telemetry-buckets"],function(e,t){function u(){function u(e){return e?e:i.telemetry.NOT_AVAILABLE}var e=this,t=n.build();e.publish=function(e){var n="giphy_qos",i=t.duration(),a={ttc:i,ttcGroup:o.getMessageLifeDurationGroup(i),querySource:e.querySource,success:e.success,giphyCount:u(e.count)+"",responseCode:u(e.responseCode)+""};s.get().sendEvent(r.telemetry.chatTenantToken,n,a)}}var n=e("swx-utils-common").stopwatch,r=e("experience/settings"),i=e("swx-constants").COMMON,s=e("ui/telemetry/telemetryClient"),o=e("swx-telemetry-buckets");t.build=function(){return new u}}),define("ui/components/chat/pes/giphyTab/giphySearchTab",["require","lodash-compat","utils/common/cancelation","swx-constants","services/pes/constants","swx-service-locator-instance","experience/settings","services/pes/interactors/giphy","telemetry/chat/giphyServiceQOS"],function(e){function h(e){return t.isArray(e.data)?e:(e.data=[e.data],e)}function p(e){return t.isArray(e.data)?e:(e.data.images={downsized:{width:e.data.fixed_height_downsampled_width,height:e.data.fixed_height_downsampled_height,url:e.data.fixed_height_downsampled_url},original:{url:e.data.image_url}},e.data=[e.data],e)}function d(e,t,n){var i=s.resolve(r.serviceLocator.PES_GIPHY_SEARCH_SERVICE);return Promise.all(t.map(function(t){var r=i[t],s;return r?(t in l?r=r.bind(i):r=r.bind(i,e),s=a.build(),r({cancelationToken:n,limit:f}).catch(function(e){throw s.publish({querySource:t,success:!1,responseCode:e.status}),e}).then(c[t]).then(function(e){return s.publish({querySource:t,success:!0,count:e.data.length,responseCode:200}),e}).then(function(e){return e.data.forEach(function(e){e.querySource=t}),e})):Promise.resolve([{data:[]}])}))}function v(e,n){var r=e?o.pesSearchServices.giphy.withQuerySources:o.pesSearchServices.giphy.withoutQuerySources,i=d(e,r,n);return i.then(function(e){var n=t(e).map(function(e){return e.data}).flatten().reduce(function(e,n){return t.find(e,{id:n.id})||e.push(n),e},[]);return{data:t.take(n,f)}})}function m(e,n,r,s){var o=u.createGiphyPacks.run(n),a;s.throwIfCanceled(),t.remove(e._configuredItems,function(e){return e.type===i.itemTypes.image.id&&t.find(o.items,{id:e.id})}),e._configuredItems=e._configuredItems.concat(o.items),a=t.find(e.tabs,{id:i.giphyImageSearch.TAB_ID});var f=t.every(o.packs,function(e){return e.items.length===0});f?a.emptyTabMessageKey="message_text_emptySearchResults":(a.packs=o.packs,a.emptyTabMessageKey="expressionPicker_giphyImgTab_emptyText"),r(e)}function g(e,r,s){var o,u;u=t.find(r.tabs,{id:i.giphyImageSearch.TAB_ID}),u&&(u.emptyTabMessageKey="expressionPicker_giphyImgTab_loadingText"),y(r),o=n.cancelableOperation(),r._currentOperation=o,u._currentQuery=e,u.packs=[],s(r),v(e,o.getToken()).then(function(e){m(r,e,s,o.getToken())}).catch(function(e){if(e instanceof n.OperationCanceledError)return;var o=t.find(r.tabs,{id:i.giphyImageSearch.TAB_ID});o.emptyTabMessageKey="expressionPicker_giphyImgTab_errorText",s(r)})}function y(e){var n;e._currentOperation&&(n=t.find(e.tabs,{id:i.giphyImageSearch.TAB_ID}),n&&(n._currentQuery=""),e._currentOperation.cancel())}var t=e("lodash-compat"),n=e("utils/common/cancelation"),r=e("swx-constants").COMMON,i=e("services/pes/constants"),s=e("swx-service-locator-instance").default,o=e("experience/settings"),u=e("services/pes/interactors/giphy"),a=e("telemetry/chat/giphyServiceQOS"),f=20,l={trending:!0},c={translate:h,random:p,search:t.identity,trending:t.identity};return{doGiphySearch:g,cancelGiphySearch:y,getResultsFromGiphy:v,processResultsFromGiphy:m}}),define("ui/components/chat/pes/localSearchTab/localSearchTab",["require","lodash-compat","swx-constants","swx-i18n","services/pes/constants","swx-service-locator-instance","experience/settings","services/pes/interactors/picker","services/pes/interactors/localSearch"],function(e){function f(e,n){var r=t([e.keywords||[],e.shortcut||[],e.description.split(/\s/),(e.copyright||"").split(/\s/),(e.pickerTitle||"").split(/\s/),(e.transcript||"").split(/\s/)]).flatten().compact().map(function(e){return e.toLowerCase()}).value(),i=t(n.split(/\s/)).compact().map(function(t){return t.toLowerCase()}).value();return t.any(i,function(e){return t.any(r,function(t){return t.search(e)===0})})}function l(e,n,r,i){i.packs=[];var s={};t.forEach(e.tabs,function(e){t.forEach(e.packs,function(e){var o=t.filter(e.items,t.bind(f,null,t,n)),u;o=t.filter(o,function(e){var t=e.id in s;return t||(s[e.id]=!0),!t}),o.length&&(u=t.cloneDeep(e),u.items=t.map(o,function(e){return t.find(r._configuredItems,{id:e.id})}),i.packs.push(u))})}),o.pesSearchServices.localSearchGroupByType&&a.groupByType.run(i)}function c(e,n){n.packs=[{ariaLabel:r.fetch({key:i.localSearch.ariaLabelLocKey}),title:r.fetch({key:i.localSearch.titleLocKey}),id:i.localSearch.PACK_PREFIX+"categories"}],n.packs[0].items=t(o.pesSearchServices.localSearchCategories).map(function(e){return{id:e,type:i.itemTypes.message.id,htmlClass:"clickable",text:e}}).value()}function h(e,r,o){var a=t.find(r.tabs,{id:i.localSearch.TAB_ID}),f=s.resolve(n.serviceLocator.PES_CONFIG_SERVICE),h=f.getConfiguration();e=(e||"").toLowerCase(),a._currentQuery=e,e?l(h,e,r,a):c(r,a),u.setSelectionState.run(r),o(r,["selectedTab","selectedItem"])}var t=e("lodash-compat"),n=e("swx-constants").COMMON,r=e("swx-i18n").localization,i=e("services/pes/constants"),s=e("swx-service-locator-instance").default,o=e("experience/settings"),u=e("services/pes/interactors/picker"),a=e("services/pes/interactors/localSearch");return{doLocalSearch:h}}),define("services/pes/interactors/store",["require","exports","module","lodash-compat","utils/common/interactor","ui/modalDialog/modalDialog","swx-constants","swx-service-locator-instance"],function(e,t){var n=e("lodash-compat"),r=e("utils/common/interactor"),i=e("ui/modalDialog/modalDialog"),s=e("swx-constants").COMMON,o=e("swx-service-locator-instance").default;t.setStoreTabProperties=r.defineSimpleInteractor(function(e){e.pickerState.storeEnabled||(e.pickerState.storeEnabled=!0,e.storeDialog=i,e.pickerState.purchasedTabs=[],e.pickerState.purchasedTabIds=[],i.build("pes-store",e,'<div id="pes-store" class="swx-hide"><swx-expressionstore-v2-browsepacks id="pes-store-comp" params="pickerState: pickerState, pickerVM: pickerVM, storeModalDialog: storeDialog"></swx-expressionstore-browsepacks></div>'))}),t.disposeStore=r.defineSimpleInteractor(function(){}),t.showStore=r.defineSimpleInteractor(function(e){e.showStore&&e.showStore()}),t.downloadPreviouslyPurchasedTabs=r.defineSimpleInteractor(function(e,t){var n=o.resolve(s.serviceLocator.PES_STORE_SERVICE),r=0,i,u,a;i=e.purchasedTabs=e.purchasedTabs||{},u=e.purchasedTabIds=e.purchasedTabIds||[],a=e.hiddenTabIds=e.hiddenTabIds||[],n.downloadPurchasedTabsFromEntitlement().then(function(s){n.getHiddenTabs().then(function(n){a.push.apply(a,n),s.forEach(function(n){n.pesConfig.then(function(o){i[n.id]=o.tabs[0],e._configuredItems=e._configuredItems.concat(o.items),r++,r===s.length&&typeof t=="function"&&t()}),u.push(n.id)})})})}),t.putPurchasedTabs=r.defineSimpleInteractor(function(e){if(!e.purchasedTabs)return;var t=e.purchasedTabIds,r=e.purchasedTabs;t.forEach(function(t){e.hiddenTabIds.indexOf(t)===-1&&(n.remove(e.tabs,{id:t}),e.tabs.splice(4,0,r[t]))})}),t.putNewPurchasedTab=r.defineSimpleInteractor(function(e,t,n){var r=e.purchasedTabIds,i=e.purchasedTabs;r.indexOf(t)===-1&&(r.push(t),i[t]=n.tabs[0]),e._configuredItems=e._configuredItems.concat(n.items),e.tabs.splice(4,0,i[t])}),t.hidePurchasedTabOnPicker=r.defineSimpleInteractor(function(e,t){var r=e.hiddenTabIds;r.push(t),n.remove(e.tabs,{id:t})})}),define("ui/components/chat/pes/expressionPickerController",["require","lodash-compat","ui/components/chat/pes/bingTab/bingSearchTab","ui/components/chat/pes/giphyTab/giphySearchTab","ui/components/chat/pes/localSearchTab/localSearchTab","swx-utils-common","swx-constants","utils/common/eventMixin","services/pes/constants","services/pes/interactors/picker","services/pes/interactors/store","swx-pubsub-instance","experience/settings","swx-service-locator-instance","swx-focus-handler","vendor/knockout","browser/dom","utils/common/accessibility","telemetry/chat/pes"],function(e){function w(){this.model={itemStartPlayRequest:0,_currentOperation:null,_conversationModel:null,_startPlaybackAction:t.debounce(t.bind(this.startPlaybackAction,this),600)},this.subscriptions=[],this.viewModel=null}function E(e){var r=t.find(e.model.tabs,{id:f.bingSearch.TAB_ID});r._currentQuery||(r._currentQuery=p.pesSearchServices.bingDefaultSearchTerm||""),r._currentQuery&&e.model.query!==r._currentQuery&&(e.model.query=r._currentQuery,n.doBingSearch(r._currentQuery,e.model,e.viewModel.applyState.bind(e.viewModel))),e.model.hasFocus=!0,e.viewModel.applyState(e.model)}function S(e){var n=t.find(e.model.tabs,{id:f.giphyImageSearch.TAB_ID});e.model.query||(e.model.query=""),e.model.query!==n._currentQuery&&(e.model.query=n._currentQuery,r.doGiphySearch(n._currentQuery,e.model,e.viewModel.applyState.bind(e.viewModel))),e.model.hasFocus=!0,e.viewModel.applyState(e.model)}function x(e){var n=t.find(e.model.tabs,{id:f.localSearch.TAB_ID});e.model.query=n._currentQuery,i.doLocalSearch(e.model.query,e.model,e.viewModel.applyState.bind(e.viewModel)),e.model.hasFocus=!0,e.viewModel.applyState(e.model,["hasFocus","query"])}function T(){var e=".swx .chat .inputField",t=g.getElement(e);t&&v.get().addFocusRequestToQueue(t)}var t=e("lodash-compat"),n=e("ui/components/chat/pes/bingTab/bingSearchTab"),r=e("ui/components/chat/pes/giphyTab/giphySearchTab"),i=e("ui/components/chat/pes/localSearchTab/localSearchTab"),s=e("swx-utils-common").builderMixin,o=e("swx-constants").COMMON,u=o.events,a=e("utils/common/eventMixin"),f=e("services/pes/constants"),l=e("services/pes/interactors/picker"),c=e("services/pes/interactors/store"),h=e("swx-pubsub-instance").default,p=e("experience/settings"),d=e("swx-service-locator-instance").default,v=e("swx-focus-handler"),m=e("vendor/knockout"),g=e("browser/dom"),y=e("utils/common/accessibility").narrator,b=e("telemetry/chat/pes");return w.prototype.init=function(e,s){var a=d.resolve(o.serviceLocator.PES_CONFIG_SERVICE),f=d.resolve(o.serviceLocator.PES_MRU_SERVICE),l=d.resolve(o.serviceLocator.FEATURE_FLAGS),h;this.setContext(s),this.viewModel=e,this.model._conversationModel=s.conversationModel,this.subscriptions.push(a.on(u.personalExpression.CONFIG_INITIALIZED,this.emit.bind(this,"handlePesConfig"))),this.subscriptions.push(f.on(u.personalExpression.CONFIG_INITIALIZED,this.emit.bind(this,"handleMruConfig"))),l.isFeatureOn(o.featureFlags.PES_BING_IMAGE_SEARCH_ENABLED)&&(this.subscriptions.push(s.registerEvent(u.textarea.CHANGED,this.emit.bind(this,"handleChatInput"))),this.highlightTabOnBingKeywords=t.debounce(n.highlightTabOnBingKeywords,400),this.doBingSearch=t.debounce(n.doBingSearch,400)),l.isFeatureOn(o.featureFlags.PES_GIPHY_IMAGE_SEARCH_ENABLED)&&(this.doGiphySearch=t.debounce(r.doGiphySearch,400)),l.isFeatureOn(o.featureFlags.PES_LOCAL_SEARCH_ENABLED)&&(this.doLocalSearch=t.debounce(i.doLocalSearch,400)),this.handlePesConfigEvent(),l.isFeatureOn(o.featureFlags.PES_STORE_ENABLED)&&(h=c.setStoreTabProperties.run({pickerState:this.model,pickerVM:this.viewModel}),this.subscriptions.push({dispose:function(){c.disposeStore.run(h)}}),this.viewModel.applyState(this.model),c.downloadPreviouslyPurchasedTabs.run(this.model,this.emit.bind(this,"handleDownloadPurchasedTabs")))},w.prototype.dispose=function(){},w.prototype.done=function(){t.forEach(this.subscriptions,function(e){e.cancel?e.cancel():e.dispose&&e.dispose()}),this.dispose(),this.model=null,this.viewModel=null},w.prototype.handlePesConfigEvent=function(){var n=m.utils.unwrapObservable(this.viewModel.state.selectedTab)&&m.utils.unwrapObservable(this.viewModel.state.selectedTab).id,r=l.pickerStateConstructor(),i=r.run({currentTabId:n,conversationModel:this.model._conversationModel});delete i.conversationModel,t.assign(this.model,i),this.viewModel.applyState(this.model)},w.prototype.handleMruConfigEvent=function(){this.model=l.mruStateUpdater.run(this.model),this.viewModel.applyState(this.model)},w.prototype.handleChatInputEvent=function(t){this.model._chatInputText=t,t?this.highlightTabOnBingKeywords(t,this.model,this.viewModel.applyState.bind(this.viewModel)):(this.highlightTabOnBingKeywords.cancel(),n.cancelBingSearch(this.model))},w.prototype.handleQueryChangedEvent=function(t,n){this.model.query!==t&&(this.model.query=t,this.viewModel.applyState(this.model));switch(this.model.selectedTab.id){case f.bingSearch.TAB_ID:this.doBingSearch(t,this.model,this.viewModel.applyState.bind(this.viewModel));break;case f.giphyImageSearch.TAB_ID:this.doGiphySearch(t,this.model,this.viewModel.applyState.bind(this.viewModel));break;case f.localSearch.TAB_ID:n?i.doLocalSearch(t,this.model,this.viewModel.applyState.bind(this.viewModel)):this.doLocalSearch(t,this.model,this.viewModel.applyState.bind(this.viewModel))}},w.prototype.handleResetQueryEvent=function(){this.handleQueryChangedEvent("",!0)},w.prototype.startPlaybackAction=function(){this.model.isOpened&&(this.model.itemStartPlayRequest=this.model.itemStartPlayRequest>=0?this.model.itemStartPlayRequest+1:1,this.viewModel.applyState(this.model))},w.prototype.stopPlaybackAction=function(){this.model.itemStartPlayRequest=this.model.itemStartPlayRequest>0?0:this.model.itemStartPlayRequest-1,this.viewModel.applyState(this.model),this.model._startPlaybackAction.cancel()},w.prototype.handleMouseoverEvent=function(t,n){switch(t){case f.itemTypes.moji.id:case f.itemTypes.emoticon.id:case f.itemTypes.image.id:this.model.selectedItemId=n,this.model=l.selectItemAction.run(this.model),this.stopPlaybackAction(),this.model._startPlaybackAction(),this.viewModel.applyState(this.model);break;default:}},w.prototype.handleTouchendEvent=function(t,n,r){switch(t){case f.itemTypes.tab.id:break;case f.itemTypes.moji.id:case f.itemTypes.emoticon.id:case f.itemTypes.image.id:this.model.selectedItemId!==n&&(this.model.selectedItemId=n,this.model=l.selectItemAction.run(this.model),this.viewModel.applyState(this.model),this.startPlaybackAction(),r.preventDefault())}},w.prototype.handleHighlightEvent=function(t,n){switch(t){case f.itemTypes.moji.id:case f.itemTypes.emoticon.id:case f.itemTypes.image.id:this.model.selectedItemId=n,this.model=l.selectItemAction.run(this.model),this.stopPlaybackAction(),this.model._startPlaybackAction(),this.viewModel.applyState(this.model);break;default:}},w.prototype.handleMouseoutEvent=function(t){switch(t){case f.itemTypes.moji.id:case f.itemTypes.emoticon.id:this.stopPlaybackAction();break;default:}},w.prototype.activateTab=function(t){t!==this.model.selectedTab.id&&(this.model.currentTabId=t,l.setSelectionState.run(this.model),this.viewModel.applyState(this.model)),this.model.selectedTab.id===f.bingSearch.TAB_ID&&(n.highlightTabOnBingKeywords(this.model._chatInputText,this.model,this.viewModel.applyState.bind(this.viewModel)),E(this)),this.model.selectedTab.id===f.localSearch.TAB_ID&&x(this),this.model.selectedTab.id===f.giphyImageSearch.TAB_ID?(S(this),this.dispatchEvent(u.textarea.SET_ATTRIBUTION,"giphy")):this.dispatchEvent(u.textarea.SET_ATTRIBUTION,null)},w.prototype.handleClickEvent=function(t,n){switch(t){case f.itemTypes.tab.id:this.activateTab(n);break;case f.itemTypes.moji.id:case f.itemTypes.emoticon.id:case f.itemTypes.image.id:this.model.selectedItemId=n,this.model=l.selectItemAction.run(this.model),h.publish(o.events.expressionPicker.ITEM_SEND_REQUEST,{item:this.model.selectedItem,conversation:this.model._conversationModel,sourceTab:this.model.selectedTab,query:this.model.query}),this.handleCloseBubbleEvent(),T();break;case f.itemTypes.message.id:this.model.selectedTab.id===f.localSearch.TAB_ID&&this.handleQueryChangedEvent(n,!0);break;default:}},w.prototype.handleKeydownEvent=function(t,n){this.handleMouseoverEvent(t,n),this.handleClickEvent(t,n)},w.prototype.handleActivationEvent=function(t,n){switch(t){case f.itemTypes.moji.id:case f.itemTypes.emoticon.id:case f.itemTypes.image.id:h.publish(o.events.expressionPicker.ITEM_SEND_REQUEST,{item:this.model.selectedItem,conversation:this.model._conversationModel,sourceTab:this.model.selectedTab,query:this.model.query}),this.handleCloseBubbleEvent();break;case f.itemTypes.message.id:this.model.selectedTab.id===f.localSearch.TAB_ID&&this.handleQueryChangedEvent(n,!0);break;default:}},w.prototype.handlePlaybackPausedEvent=function(){this.stopPlaybackAction()},w.prototype.handleResetQueryEvent=function(){this.model.query="",this.viewModel.applyState(this.model)},w.prototype.handleOpenBubbleEvent=function(){this.model.isOpened?this.handleCloseBubbleEvent():(this.model.isOpened=!0,this.model.wasOpenedBefore=!0,this.activateTab(this.model.selectedTab.id),b.expressionPickerOpened(),y.announce({key:"accessibility_open_picker"})),this.viewModel.applyState(this.model)},w.prototype.handleCloseBubbleEvent=function(){this.stopPlaybackAction(),this.model.isOpened=!1;if(this.model.selectedTab.id===f.bingSearch.TAB_ID){var n=t.find(this.model.tabs,{id:f.bingSearch.TAB_ID});n._currentQuery=""}this.viewModel.applyState(this.model),this.dispatchEvent(u.textarea.SET_ATTRIBUTION,null),y.announce({key:"accessibility_close_picker"})},w.prototype.handleShowStoreEvent=function(){c.showStore.run(this.model)},w.prototype.handleDownloadPurchasedTabsEvent=function(){c.putPurchasedTabs.run(this.model),this.model=l.mruStateUpdater.run(this.model),this.viewModel.applyState(this.model)},w.prototype.emit=function(){var t=Array.prototype.slice.call(arguments),n=this[t[0]+"Event"];n&&n.apply(this,t.slice(1))},t.assign(w,s),t.assign(w.prototype,a),w}),define("utils/common/stateMixin",["require","lodash-compat","vendor/knockout","browser/window"],function(e){function i(){}function s(){this.storage=[],this.lastFreeSlot=-1}function u(){}function a(){}function f(){}function p(e,t){return n.isObservable(e[t])?e[t].push?h:c:l}function v(e){if(typeof e=="string"||typeof e=="number")e=[e];this.key=e}function g(e){return typeof e in m||e===null||e instanceof Date||t.isElement(e)||Promise&&e instanceof Promise}function y(){}function b(){this.preserveReferences=!1}function E(e,n,r,i,s){var o=i.resolve(e),u=s.resolve(e),a,f=undefined,l;o!==d&&(l=t.findIndex(r,w.bind(null,i,o)),l!==-1&&l!==n&&(f=r[l],r[l]=undefined)),f||(f=r[n]);if(f&&u!==d){a=s.resolve(f);if(a===d||a!==u&&!t.isEqual(a,u))f=undefined}return f}function S(){this._scheduledTaskHandler&&(r.requestAnimationFrame?r.cancelAnimationFrame(this._scheduledTaskHandler):n.tasks.cancel(this._scheduledTaskHandler))}function x(){var e=this._taskQueue;return this._taskQueue=[],e}function T(e,n){var r=t.reduce(e,function(e,r){var i=r.newState;return t.isFunction(i)?i=i(this.state,this.props):r.limitKeys&&(i=t.pick(i,r.limitKeys)),r.callback&&n.push(r.callback),t.assign(e,i)},{},this);return r}function N(e){return this.beforeStateApplied&&(e=this.beforeStateApplied(e)||e),e}function C(e){var t=new b;(new y).execute(this.state,e,t)}function k(e){this.afterStateApplied&&this.afterStateApplied(),t.forEach(e,function(e){e&&t.isFunction(e)&&e.call(this)})}function L(e,r){return t.isFunction(r)?r:t.isArray(r)?n.observableArray(r):t.isPlainObject(r)||t.isBoolean(r)||t.isString(r)||t.isNumber(r)||t.isNull(r)||t.isUndefined(r)||t.isDate(r)||t.isElement(r)?n.observable(r):r}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("browser/window");s.prototype.get=function(e){var n=t.find(this.storage,{key:e});return n&&n.value},s.prototype.set=function(e,n){var r=this.lastFreeSlot;if(r===-1){r=t.findIndex(this.storage,null);if(r===-1){this.storage.push({key:e,value:n});return}}this.storage[r]={key:e,value:n},this.lastFreeSlot=-1},s.prototype.delete=function(e){var n=t.findIndex(this.storage,{key:e});if(n===-1)return;this.storage[n]=null,this.lastFreeSlot=n};var o=s;typeof WeakMap=="function"&&(o=WeakMap),u.prototype.EMPTY_VALUE=null,u.prototype.isBound=function(e,t){return t===null?!0:e&&e.hasOwnProperty(t)},u.prototype.resolve=function(e,t){return t===null?e:e&&e[t]},u.prototype.assign=function(e,t,n){if(t===null)throw new Error("References are immutable");e[t]=n},u.prototype.delete=function(e,t){if(t===null)throw new Error("References are immutable");e.hasOwnProperty(t)?delete e[t]:e[t]=undefined},a.prototype=Object.create(u.prototype),a.prototype.resolve=function(e,t){return t===null?e&&e():e&&e[t]&&e[t]()},a.prototype.assign=function(e,t,r){t!==null?e[t]?e[t](r):e[t]=n.observable(r):e(r)},a.prototype.delete=function(e){this.assign(e,undefined)},f.prototype=Object.create(a.prototype),f.prototype.assign=function(e,t,r){t!==null?e[t]?e[t](r):e[t]=n.observableArray(r):e(r)},f.prototype.EMPTY_VALUE=[];var l=new u,c=new a,h=new f,d=[NaN];v.prototype=Object.create(u.prototype),v.prototype.resolve=function(e){return this.key?typeof this.key=="function"?this.key(e)||d:this.key.map(function(t){return p(e,t).resolve(e,t)}):d};var m={"undefined":1,"boolean":1,number:1,string:1,"function":1};b.prototype.valueAssign=function(e,t,n){var r;typeof t!="string"&&typeof t!="number"||!!e.hasOwnProperty(t)?r=p(e,t):r=typeof n=="function"?l:c,r.assign(e,t,n)};var w=function(n,r,i){return t.isEqual(n.resolve(i),r)};return b.prototype.deepArrayAssign=function(e,r,i){var s,o,u;(typeof r=="string"||typeof r=="number")&&!e.hasOwnProperty(r)&&(e[r]=n.observableArray());var a=p(e,r),f=a.resolve(e,r)||[],l=[],c;o=new v(this.typeKeyFor(i)),s=new v(this.keyFor(i));for(c=0;c<i.length;++c){var h=p(i,c).resolve(i,c);g(h)?p(l,c).assign(l,c,h):t.isArray(h)?this.deepArrayAssign(l,c,h):(u=E(h,c,f,s,o)||{},p(l,c).assign(l,c,u),this.deepObjectAssign(l,c,h))}Array.prototype.splice.apply(f,[0,f.length].concat(l)),a.assign(e,r,f)},b.prototype.deepObjectAssign=function(e,n,r){var i,s,o=p(e,n),u=new v(this.typeKeyFor(r)),a,f,l=!1;if(!r){o.assign(e,n,i);return}i=this.getFromStack(r);if(i){this.breakCycles&&(i=null),o.assign(e,n,i);return}if(this.preserveReferences){i=this.getKnownObject(r);if(i){o.assign(e,n,i);return}}s=null,o.isBound(e,n)&&(s=o.resolve(e,n)),a=u.resolve(r);if(s&&a!==d){f=u.resolve(s),l=!0;if(f===d||f!==a&&!t.isEqual(f,a))l=!1}s===null&&(s={}),this.pushContextUpdate(r,s),y.prototype.execute(s,r,this),this.popContext(r),l||o.assign(e,n,s)},b.prototype.getFromStack=function(e){var t=this.contextStack&&this.contextStack.get(e);return t&&t.target},b.prototype.getKnownObject=function(e){return this.knownObjects&&this.knownObjects.get(e)},b.prototype.pushContextUpdate=function(e,t){var n=this.contextStack||new o,r;this.contextStack=n,this.preserveReferences&&(r=this.knownObjects||new o,this.knownObjects=r,r.set(e,t)),n.set(e,{target:t,breakCycles:this.breakCycles,removeExtra:this.removeExtra}),this.breakCycles=!0,this.removeExtra=!1},b.prototype.popContext=function(e){var t=this.contextStack&&this.contextStack.get(e);if(!t)return;this.breakCycles=t.breakCycles,this.removeExtra=t.removeExtra,this.contextStack.delete(e)},b.prototype.ignoreProperty=function(e){return e&&(e[0]==="_"||e[0]==="@")},b.prototype.keyFor=function(){return null},b.prototype.typeKeyFor=function(e){return e["@Meta"]&&e["@Meta"].typeKey},y.prototype.execute=function(e,n,r){var i,s,o=[],u,a,f,l;r.removeExtra&&t.forOwn(e,function(t,r){n.hasOwnProperty(r)||p(e,r).delete(e,r)});for(u in n)n.hasOwnProperty(u)&&!r.ignoreProperty(u)&&(s=p(n,u),i=s.resolve(n,u),l=g(i)?1:t.isArray(i)?2:3,o.push({name:u,value:i,semantics:l}));a=o.length;switch(a){case 4:f=o[3];switch(f.semantics){case 1:r.valueAssign(e,f.name,f.value);break;case 2:r.deepArrayAssign(e,f.name,f.value);break;case 3:r.deepObjectAssign(e,f.name,f.value)};case 3:f=o[2];switch(f.semantics){case 1:r.valueAssign(e,f.name,f.value);break;case 2:r.deepArrayAssign(e,f.name,f.value);break;case 3:r.deepObjectAssign(e,f.name,f.value)};case 2:f=o[1];switch(f.semantics){case 1:r.valueAssign(e,f.name,f.value);break;case 2:r.deepArrayAssign(e,f.name,f.value);break;case 3:r.deepObjectAssign(e,f.name,f.value)};case 1:f=o[0];switch(f.semantics){case 1:r.valueAssign(e,f.name,f.value);break;case 2:r.deepArrayAssign(e,f.name,f.value);break;case 3:r.deepObjectAssign(e,f.name,f.value)};case 0:break;default:t.forEach(o,function(t){switch(t.semantics){case 1:r.valueAssign(e,t.name,t.value);break;case 2:r.deepArrayAssign(e,t.name,t.value);break;case 3:r.deepObjectAssign(e,t.name,t.value)}})}},i.prototype.baseApplyState=function(e,n,r){var s=this.scheduleStateMerge||i.prototype.scheduleStateMerge;this.state=this.state||{};if(t.isString(n)||t.isArray(n))r=n,n=null;t.isString(r)&&(r=[r]),this._taskQueue=this._taskQueue||[],this._taskQueue.push({newState:e,callback:n,limitKeys:r}),s.call(this)},i.prototype.applyState=i.prototype.baseApplyState,i.prototype.scheduleStateMerge=function(){var e=this.processTaskQueue||i.prototype.processTaskQueue;if(this._scheduledTaskHandler)return;r.requestAnimationFrame?this._scheduledTaskHandler=r.requestAnimationFrame(e.bind(this)):this._scheduledTaskHandler=n.tasks.schedule(e.bind(this))},i.prototype.processTaskQueue=function(){var e,t=[],n,r=this.scheduleStateMerge||i.prototype.scheduleStateMerge;S.call(this);if(!this._taskQueue||this._taskQueue.length===0){this._scheduledTaskHandler=null;return}n=x.call(this),e=T.call(this,n,t),e=N.call(this,e),C.call(this,e),this._scheduledTaskHandler=null,this._taskQueue.length&&r.call(this),k.call(this,t)},i.overrideDefaults=function(){var e=Array.prototype.slice.call(arguments);return e.push(L),t.assign.apply(t,e),e[0]},t.assign(i,i.prototype),i}),define("ui/viewModels/chat/pes/expressionPicker",["require","lodash-compat","swx-constants","swx-utils-common","browser/document","browser/dom","utils/common/eventHelper","utils/common/interactor","vendor/knockout","experience/settings","utils/common/stateMixin","utils/common/outsideClickHandler","swx-focus-handler","services/pes/constants","swx-constants","utils/common/accessibility","swx-i18n"],function(e){function N(e,r){function S(e){var t=null;u.applyState({selectedPageIndex:e},t)}function x(){u.params.eventEmitter.emit("handleCloseBubble")}function N(e,t,n){e===v.itemTypes.tab.id&&(t===g.events.browser.KEYDOWN||t===g.events.browser.CLICK)&&y.announce({key:"expressionPicker_selected_item_title",params:{itemTitle:n||""}})}function C(){return s.getElement(w,r)}function k(){var e=C();e&&h.get().addFocusRequestToQueue(e)}function L(){return s.getElement(p,s.getParentMatching(r,d))}function A(){var e=L();e&&h.get().addFocusRequestToQueue(e)}function O(){c.remove(m)}var u=this,f,E;u.state=l.overrideDefaults({},u.getInitialState()),u.params=l.overrideDefaults({},u.getDefaultParams(),e),f=u.state.query.subscribe(function(e){u.params.eventEmitter.emit("handleQueryChanged",e)}),E=u.state.isOpened.subscribe(function(e){e?c.add(m,x):O()}),u.afterStateApplied=function(){T.run(this.state)},u.onSearchBoxKeyDown=function(e,t){var r=o.getKeyCode(t);if(r===n.ESCAPE){if(u.state.query()){u.resetQuery(),t.stopPropagation();return}return}if(r===n.BACKSPACE&&!u.state.query()){o.swallow(t);return}return r!==n.ENTER},u.resetQuery=function(){u.params.eventEmitter.emit("handleResetQuery")},u.nextPage=function(){var t=u.state.selectedPageIndex()+1;t<u.state.pagedTabs().length&&S(t)},u.prevPage=function(){var t=u.state.selectedPageIndex()-1;t>=0&&S(t)},u.init=function(){T.run(this.state)},u.openBubble=function(){u.params.eventEmitter.emit("handleOpenBubble")},u.handleEnter=function(e,t){function n(){return t.target.tagName!=="BUTTON"}n()&&t.target.tagName!=="INPUT"&&t.preventDefault(),u.handleMouseEvent(e,t)},u.handleMouseEvent=function(e,n){var r=a.dataFor(n.target);if(r&&r.type&&r.id){var i="handle"+t.capitalize(n.type);u.params.eventEmitter.emit(i,r.type(),r.id(),n),r.title&&N(r.type(),n.type,r.title())}return!1},u.selectedTabAriaLabel=function(e){var t=e.ariaLabel&&e.ariaLabel()||"";return e.type&&e.type()===v.itemTypes.tab.id&&u.state.selectedTab().id()===e.id()?b.fetch({key:"expressionPicker_selected_item_title",params:{itemTitle:t}}):t},u.handleKeyDown=function(e,t){var r=o.getKeyCode(t);if(r===n.ESCAPE&&u.state.isOpened()){t.stopPropagation(),x(),k();return}if(r===n.ESCAPE&&i.activeElement===C()){t.stopPropagation(),A();return}return!0},u.dispose=function(){O(),f.dispose(),E.dispose(),u.params.eventEmitter.done()},u.showStore=function(){u.params.eventEmitter.emit("handleShowStore")}}var t=e("lodash-compat"),n=e("swx-constants").KEYS,r=e("swx-utils-common").builderMixin,i=e("browser/document"),s=e("browser/dom"),o=e("utils/common/eventHelper"),u=e("utils/common/interactor"),a=e("vendor/knockout"),f=e("experience/settings"),l=e("utils/common/stateMixin"),c=e("utils/common/outsideClickHandler"),h=e("swx-focus-handler"),p=".swx .chat .inputField",d=".swx .chat",v=e("services/pes/constants"),m="expressionPicker",g=e("swx-constants").COMMON,y=e("utils/common/accessibility").narrator,b=e("swx-i18n").localization,w=".emoticon-picker-button",E=u.defineSimpleInteractor(function(t){t.pickerButtonClass("swx-expression-picker-btn transparent circle emoticon-picker-button large"),t.pickerButtonIcon("emoticonStroke")}),S=u.defineInteractor(function(){this.onlyIf(function(){return f.pesPicker.useSelectedTabIconForPicker}),this.run(function(t){var n=t.selectedTab();n&&(t.pickerButtonClass("swx-expression-picker-btn transparent tab-icon emoticon-picker-button large"),t.pickerButtonIcon("tab enabled "+n.htmlClass()))})}),x=u.defineSimpleInteractor(function(e){var t=e.pagedTabs().length,n=e.selectedPageIndex(),r="page"+n,i;t<=1?i="singlePage":i=n===t-1?r+" last":r,e.storeEnabled()&&(i="storeEnabled "+i),e.tabsCss(i)}),T=u.defineComposer([E,S,x]);return N.prototype.getInitialState=function(){return{isOpened:!1,wasOpenedBefore:!1,pickerButtonIcon:"",pickerButtonClass:"",pagedTabs:[],tabsCss:"",selectedPageIndex:0,selectedTab:null,selectedItem:null,itemStartPlayRequest:0,pickerMaximized:!1,searchCapabilityEnabled:!1,query:"",storeEnabled:!1}},N.prototype.getDefaultParams=function(){return{isDisabled:!0,eventEmitter:o.emptyEmitter}},t.assign(N.prototype,l),t.assign(N,r),N}),define("text!views/chat/pes/expressionPicker.html",[],function(){return'<div class="wrapper swx-expression-picker"\r\n     data-bind="event: {\r\n        keydown:        handleKeyDown,\r\n        mouseover:      handleMouseEvent,\r\n        mouseout:       handleMouseEvent,\r\n        touchend:       handleMouseEvent,\r\n        pointerover:    handleMouseEvent,\r\n        click:          handleMouseEvent\r\n        }, enterKey: handleEnter">\r\n    <swx-button params="cssClass: state.pickerButtonClass,\r\n                        icon: state.pickerButtonIcon,\r\n                        disabled: params.isDisabled, titleKey: \'button_title_emoticons\',\r\n                        textKey: \'button_text_emoticons\', action: openBubble,\r\n                        ariaLabelKey: \'emoticonPicker_heading_label\'"></swx-button>\r\n    <!-- ko if: state.wasOpenedBefore -->\r\n    <div class="bubble popup arrow down" data-bind="css: { active:state.isOpened }">\r\n\r\n        <!-- ko ifnot: state.pickerMaximized -->\r\n        <swx-expressionitem-roster params="item: state.selectedItem, itemStartPlayRequest: state.itemStartPlayRequest, eventEmitter: params.eventEmitter"></swx-expressionitem-roster>\r\n        <div class="infoLine"></div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: state.searchCapabilityEnabled -->\r\n        <div class="searchContainer">\r\n            <input type="text" data-bind="\r\n                hasFocus:       state.hasFocus,\r\n                textInput:      state.query,\r\n                event: {\r\n                    keydown:    onSearchBoxKeyDown\r\n                    },\r\n                l10n_attr: {\r\n                    \'placeholder\':  \'input_placeholder_searchPESItems\',\r\n                    \'aria-label\':   \'input_searchPESItems_ariaLabel\'\r\n                    }"\r\n                value="" name="query" class="inputField fontSize-h4"/>\r\n            <button tabindex="-1" data-bind="visible: state.query, event: { mousedown: resetQuery }, enterKey: resetQuery" type="button" class="btn primary circle small transparent searchReset">\r\n                <span class="iconfont cross"></span>\r\n            </button>\r\n            <div class="offScreen" role="log" aria-live="polite" data-bind="text: state.searchStatus"></div>\r\n        </div>\r\n        <div class="infoLine"></div>\r\n        <!-- /ko -->\r\n\r\n\r\n        <swx-expressionitems-picker params="tab: state.selectedTab, item: state.selectedItem, isVisible: state.isOpened, eventEmitter: params.eventEmitter"></swx-expressionitems-picker>\r\n\r\n        <div class="infoLine"></div>\r\n\r\n        <div class="navigationTabs">\r\n            <div class="tabs" data-bind="css: state.tabsCss, keyboardNavigation: { itemSelector: \'.tab-item\' }, enterKey: handleMouseEvent">\r\n                <span class="prev" data-bind="event: { click: prevPage },\r\n                                              l10n_attr: {\r\n                                                  \'title\': \'expressionPicker_prevPage\',\r\n                                                  \'aria-label\': \'expressionPicker_prevPage\'\r\n                                              }">\r\n                    <span class="tab"></span>\r\n                </span>\r\n                <span class="tabsWrapper">\r\n                    <span class="container" role="menu"\r\n                          data-bind="template: { name: \'tabs-page-template\', foreach: state.pagedTabs, as: \'page\'  }"></span>\r\n                </span>\r\n                <span class="next" data-bind="event: { click: nextPage },\r\n                                              l10n_attr: {\r\n                                                  \'title\': \'expressionPicker_nextPage\',\r\n                                                  \'aria-label\': \'expressionPicker_nextPage\'\r\n                                              }">\r\n                    <span class="tab"></span>\r\n                </span>\r\n            </div>\r\n\r\n            <!-- ko if: state.storeEnabled -->\r\n            <div class="store iconfont add" data-bind="event: {click: showStore}, enterKey: showStore,\r\n                                          l10n_attr: {\r\n                                              \'title\': \'expressionPicker_storeTab_title\',\r\n                                              \'aria-label\': \'expressionPicker_storeTab_title\'\r\n                                          }" tabindex="0"></div>\r\n            <!-- /ko -->\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n\r\n<script type="text/html" id="tabs-page-template">\r\n    <span class="tabPage"\r\n          data-bind="template: { name: \'tab-template\', foreach: page.tabs, as: \'tab\' }"></span>\r\n</script>\r\n\r\n<script type="text/html" id="tab-template">\r\n    <span data-bind="attr: {\r\n            \'data-name\': tab.id,\r\n            \'title\': tab.title,\r\n            \'aria-label\': $parents[1].selectedTabAriaLabel(tab)\r\n            }"\r\n          aria-live="polite" role="menuitem" class="tab-item">\r\n        <span data-bind="css: \'tab \'+tab.htmlClass() + ($parents[1].state.selectedTab().id() === tab.id() ? \' active\' : \'\')">\r\n            <img data-bind="attr: {src: tab.thumbnailUrl()}"/>\r\n        </span>\r\n    </span>\r\n</script>\r\n'}),define("ui/components/chat/pes/expressionPicker",["require","exports","module","ui/components/chat/pes/expressionPickerController","ui/viewModels/chat/pes/expressionPicker","swx-service-locator-instance","swx-constants","vendor/knockout","constants/components","text!views/chat/pes/expressionPicker.html"],function(e,t){function u(e,t){var u,a=i.resolve(s.serviceLocator.FEATURE_FLAGS).isFeatureOn(s.featureFlags.OPTIMIZE_SPACE_FOR_CC),f=n.build(),l=t.element,c=o.dataFor(l);return a&&l.classList.add("Mode--conversationControl"),u=r.build({isDisabled:e.isDisabled,eventEmitter:f},l),u.init(),f.init(u,c),u}var n=e("ui/components/chat/pes/expressionPickerController"),r=e("ui/viewModels/chat/pes/expressionPicker"),i=e("swx-service-locator-instance").default,s=e("swx-constants").COMMON,o=e("vendor/knockout");t.name=e("constants/components").chat.EXPRESSION_PICKER,t.template=e("text!views/chat/pes/expressionPicker.html"),t.viewModel={createViewModel:u}}),define("ui/viewModels/chat/pes/itemsPicker",["require","lodash-compat","swx-utils-common","swx-utils-common","vendor/knockout","browser/document","utils/common/eventHelper","utils/common/stateMixin","swx-focus-handler"],function(e){function f(e,t){function l(){n.execute(function(){t.adjustToRTLLayout()},null,!0)}var r=this,o,f;r.params=u.overrideDefaults({},r.getDefaultParams(),e),f=r.params.item.subscribe(function(t){var n;if(!t)return;n=s.activeElement,n&&a.get().addFocusRequestToQueue(n)}),r.params.isVisible()?l():o=r.params.isVisible.subscribe(function(t){t&&(o.dispose(),l())}),r.showEmptyTabMessage=i.computed(function(){return r.params.tab().packs().length===0}),r.tabStyleOverride=i.computed(function(){return r.params.tab().styleOverride?r.params.tab().styleOverride():""}),r.emptyTabMessageKey=i.computed(function(){return i.utils.unwrapObservable(r.params.tab().emptyTabMessageKey)}),r.init=function(){t.init()},r.dispose=function(){o&&o.dispose(),f.dispose(),r.showEmptyTabMessage.dispose(),r.tabStyleOverride.dispose(),r.emptyTabMessageKey.dispose(),t.dispose()}}var t=e("lodash-compat"),n=e("swx-utils-common").async,r=e("swx-utils-common").builderMixin,i=e("vendor/knockout"),s=e("browser/document"),o=e("utils/common/eventHelper"),u=e("utils/common/stateMixin"),a=e("swx-focus-handler");return f.prototype.getDefaultParams=function(){return{tab:{packs:i.observableArray(),emptyTabMessageKey:"no_key"},item:null,isVisible:!0,eventEmitter:o.emptyEmitter}},t.assign(f.prototype,u),t.assign(f,r),f}),define("text!views/chat/pes/itemsPicker.html",[],function(){return'<div class="picker"\r\n     data-bind="css: tabStyleOverride, keyboardNavigation: { itemSelector: \'li.picker-item\', persistSelection: false }">\r\n\r\n    <!-- ko if: showEmptyTabMessage -->\r\n    <span class="mrutext"\r\n          data-bind="l10n: {key: params.tab().emptyTabMessageKey() }"></span>\r\n    <!-- /ko -->\r\n\r\n    <ul class="picker-list scrollViewport scrollViewportV"\r\n        data-bind="template: {name: \'pack-template\', foreach: params.tab().packs, as: \'pack\'}" tabindex="-1">\r\n    </ul>\r\n</div>\r\n\r\n<script type="text/html" id="pack-template">\r\n    <!-- ko if: pack.title -->\r\n    <span class="tile">\r\n        <span class="tileName"><h4 data-bind="text:pack.title"></h4></span>\r\n    </span>\r\n    <!-- /ko -->\r\n\r\n    <li data-bind="attr: { \'data-name\': pack.id, \'aria-label\': pack.ariaLabel }"\r\n        role="listitem" class="picker-pack">\r\n        <ul class="picker-pack-items"\r\n            data-bind="template: { name: \'item-template\', foreach: pack.items, as: \'item\' }"></ul>\r\n    </li>\r\n</script>\r\n\r\n<script type="text/html" id="item-template">\r\n    <li data-bind="attr: { \'data-id\': item.id, \'aria-label\': item.description, style: item.thumbnailStyle}, css: item.type() + \' \' + (item.htmlClass && item.htmlClass() || \'\') "\r\n        role="listitem" class="picker-item">\r\n\r\n        <!-- ko template: { name: \'item-template-\'+item.type() } -->\r\n        <!-- /ko -->\r\n</script>\r\n\r\n<script type="text/html" id="item-template-emoticon">\r\n    <span\r\n        data-bind="css: item.staticHtmlClass, attr: {\'aria-label\': item.description}"\r\n        class="emoticon">\r\n            <span class="emoSprite"></span>\r\n            <canvas data-bind="attr: { \'data-item-id\': item.id }"></canvas>\r\n    </span>\r\n</script>\r\n\r\n<script type="text/html" id="item-template-flik">\r\n    <span data-bind="css: item.thumbnailClass" class="moji">\r\n        <span class="mojimask small"></span><span class="mojiThumbnail"></span>\r\n        <a class="actionButtons iconfont send mojisend"\r\n           data-bind="\r\n            visible: $parents[1].params.item() && (item.id() === $parents[1].params.item().id() )"\r\n           tabindex="-1"></a>\r\n    </span>\r\n</script>\r\n\r\n<script type="text/html" id="item-template-image">\r\n    <img data-bind="attr: {src: item.thumbnail}"/>\r\n</script>\r\n\r\n<script type="text/html" id="item-template-message">\r\n    <span class="message" data-bind="text: item.text"></span>\r\n</script>\r\n'}),define("ui/components/chat/pes/itemsPicker",["require","exports","module","ui/viewModels/chat/pes/itemsPicker","utils/common/scroll","browser/dom","constants/components","text!views/chat/pes/itemsPicker.html"],function(e,t){function s(e,t){var s=t.element,o=r.build(i.getElement(".picker",s)),u=new n(e,o,s);return u.init(),u}var n=e("ui/viewModels/chat/pes/itemsPicker"),r=e("utils/common/scroll"),i=e("browser/dom");t.name=e("constants/components").chat.EXPRESSION_ITEMS_PICKER,t.template=e("text!views/chat/pes/itemsPicker.html"),t.viewModel={createViewModel:s}}),define("ui/viewModels/chat/pes/itemRoster",["require","lodash-compat","browser/dom","swx-utils-common","utils/common/stateMixin","utils/common/eventHelper","services/pes/constants","vendor/knockout"],function(e){function a(e,t){function f(){var e=n.getElement("video.moji.preview",t);e&&e.pause&&e.pause()}function l(){function r(e){s.params.eventEmitter.emit(e)}function i(){e.removeEventListener("ended",i),e.removeEventListener("pause",u),r("handlePlaybackPaused")}function u(){e.removeEventListener("ended",i),e.removeEventListener("pause",u),r("handlePlaybackPaused")}var e=n.getElement("video.moji.preview",t);if(!e||s.params.item()&&s.params.item().type()!==o.itemTypes.moji.id)return;e.play(),e.addEventListener("ended",i,!1),e.addEventListener("pause",u,!1)}var s=this,a;s.params=i.overrideDefaults({},s.getDefaultParams(),e),s.playState=u.computed(function(){return s.params.itemStartPlayRequest()>0}),a=s.params.itemStartPlayRequest.subscribe(function(e){r.execute(function(){e>0?l():f()},null,!0)}),s.init=function(){},s.dispose=function(){a.dispose(),s.playState.dispose()}}var t=e("lodash-compat"),n=e("browser/dom"),r=e("swx-utils-common").async,i=e("utils/common/stateMixin"),s=e("utils/common/eventHelper"),o=e("services/pes/constants"),u=e("vendor/knockout");return a.prototype.getDefaultParams=function(){return{item:{},itemStartPlayRequest:0,eventEmitter:s.emptyEmitter}},t.assign(a.prototype,i),a}),define("text!views/chat/pes/itemRoster.html",[],function(){return'<div class="wrapper roster">\r\n    <!-- ko if: params.item() && params.item().type() === \'emoticon\' -->\r\n    <div class="largeAllowed large wrapper">\r\n        <span data-bind="css: playState() ? params.item().animatedExtraLargeHtmlClass : params.item().staticExtraLargeHtmlClass" class="emoticon">\r\n            <span class="emoSprite"></span>\r\n            <canvas data-draw-state="transient" data-bind="attr: { \'data-item-id\': params.item().id, \'data-is-animated\': playState() }"></canvas>\r\n        </span>\r\n    </div>\r\n    <div class="info">\r\n        <p data-bind="text: params.item().description" class="smaller name"></p>\r\n\r\n        <p data-bind="text: params.item().shortcut" class="smaller text"></p>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: params.item() && params.item().type() === \'flik\' -->\r\n    <div class="large wrapper">\r\n        <span data-bind="css: params.item().keyframeClass" class="moji preview">\r\n            <span class="keyframe" data-bind="css: {hide: playState}"></span>\r\n            <video class="moji preview" data-bind="css: {hide: !playState()}, attr: { src: params.item().contentUrl }"\r\n                   tabindex="-1"></video>\r\n            <span class="mojimask preview"></span>\r\n        </span>\r\n    </div>\r\n    <div class="info">\r\n        <p data-bind="text: params.item().pickerTitle" class="smaller name"></p>\r\n\r\n        <p data-bind="text: params.item().copyright" class="smaller text"></p>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: !(params.item() && params.item().type) || ([\'emoticon\', \'flik\'].indexOf(params.item().type()) === -1) -->\r\n    <div class="large wrapper">\r\n        <p data-bind="l10n: {\'key\': \'emoticonPicker_heading_label\'}" class="smaller name"></p>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n\r\n</div>\r\n'}),define("ui/components/chat/pes/itemRoster",["require","exports","module","ui/viewModels/chat/pes/itemRoster","constants/components","text!views/chat/pes/itemRoster.html"],function(e,t){function r(e,t){var r=t.element,i=new n(e,r);return i.init(),i}var n=e("ui/viewModels/chat/pes/itemRoster");t.name=e("constants/components").chat.EXPRESSION_ITEM_ROSTER,t.template=e("text!views/chat/pes/itemRoster.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/chat/conversationShareLink",["require","lodash-compat","utils/common/eventMixin","vendor/knockout","swx-constants","swx-service-locator-instance","utils/common/cafeObservable","swx-i18n","ui/telemetry/actions/actionNames","utils/common/outsideClickHandler","swx-utils-chat"],function(e){function p(e){function v(){t.isTooltipOpened(!0),l.add("conversationShareLink",m),d.recordAction(f.invites.shareButton,e.telemetryContext)}function m(){t.isTooltipOpened(!1),l.remove("conversationShareLink")}function g(e){return e=e||{},e.conversationOrigin=c.isGuestHostConversation(t.conversationModel.conversationId)?s.GUEST_HOST:s.NORMAL,e.participantsCount=t.conversationModel.participantsCount(),e}function y(){return t.conversationModel.uri}var t=this,n=o.resolve(i.serviceLocator.FEATURE_FLAGS),p=n.isFeatureOn(i.featureFlags.SPACES),d=o.resolve(i.serviceLocator.ACTION_TELEMETRY);t.isTooltipOpened=r.observable(!1),t.conversationModel=e.conversationModel,t.isJoiningEnabled=t.conversationModel.isJoiningEnabled?u.newObservableProperty(t.conversationModel.isJoiningEnabled):r.observable(!0),t.telemetryContext=g(e.telemetryContext),t.share=function(){t.isJoiningEnabled()&&!y()&&t.dispatchEvent(h.conversation.SHARED,function(e){t.conversationModel=e,t.isJoiningEnabled(p),t.conversationModel.uri.get()}),v()},t.joiningDisabledTextStart=function(){return a.fetch({key:"spaces_joining_disabled_message_start"})},t.joiningDisabledAnchorText=function(){return a.fetch({key:"spaces_joining_disabled_anchor_text"})},t.joiningDisabledTextEnd=function(){return a.fetch({key:"spaces_joining_disabled_message_end"})},t.showSettings=function(){t.dispatchEvent(h.conversation.OPEN_PROFILE,{editTopic:!1},t.DIRECTION.PARENT),m()},t.dispose=function(){t.isTooltipOpened()&&m()}}var t=e("lodash-compat"),n=e("utils/common/eventMixin"),r=e("vendor/knockout"),i=e("swx-constants").COMMON,s=i.telemetry.conversationOrigin,o=e("swx-service-locator-instance").default,u=e("utils/common/cafeObservable"),a=e("swx-i18n").localization,f=e("ui/telemetry/actions/actionNames"),l=e("utils/common/outsideClickHandler"),c=e("swx-utils-chat").conversation,h=i.events;return t.assign(p.prototype,n),p}),define("text!views/chat/conversationShareLink.html",[],function(){return'<div class="conversationShareLink">\r\n    <swx-button params="cssClass:\'shareButton circle classicShare\', disabled:false, action: share, textKey: \'action_button_share_conversation\', icon: \'share\'"></swx-button>\r\n\r\n    <swx-button params="cssClass:\'shareButton circle narrowShare\', disabled:false, action: share, textKey: \'share_on_skype_share_button\', icon: \'share\'"></swx-button>\r\n    <!-- ko if: isTooltipOpened -->\r\n    <div class="tooltip popup arrow down">\r\n        <!-- <span class="arrow"></span> -->\r\n        <!-- ko if: isJoiningEnabled -->\r\n        <span class="tooltipLabel fontSize-p" data-bind="l10n: { key: \'spaces_tooltip_text\'}"></span>\r\n        <swx-invite-link class="invite-link invite-link-narrow" params="topic: conversationModel.topic, uri: conversationModel.uri, telemetryContext: telemetryContext"></swx-invite-link>\r\n        <!-- /ko -->\r\n        <!-- ko ifnot: isJoiningEnabled -->\r\n        <div class="tooltipLabel fontSize-p">\r\n            <span data-bind="html:joiningDisabledTextStart()">\r\n            </span>\r\n\r\n            <a href="#" data-bind="click:showSettings, text:joiningDisabledAnchorText()"></a>\r\n\r\n            <span data-bind="html:joiningDisabledTextEnd()">\r\n            </span>\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("ui/components/chat/conversationShareLink",["require","exports","module","vendor/knockout","ui/viewModels/chat/conversationShareLink","constants/components","text!views/chat/conversationShareLink.html"],function(e,t){function i(e,t){var i=new r(e);return i.setContext(n.dataFor(t.element)),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/conversationShareLink");t.name=e("constants/components").chat.CONVERSATION_SHARE_LINK,t.template=e("text!views/chat/conversationShareLink.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/selectedParticipantsConversation",["require","vendor/knockout","swx-cafe-application-instance","swx-pubsub-instance","swx-constants","ui/telemetry/telemetryClient","experience/settings","swx-constants"],function(e){function a(){function l(t){if(a)try{a.cancel("Another search triggered")}catch(n){s.get().sendEvent(o.telemetry.uiTenantToken,i.telemetry.promiseInvalidStateException.TYPE,{feature:i.telemetry.promiseInvalidStateException.feature.GROUP_SEARCH,exception:JSON.stringify(n)})}e.matchingConversations([]);if(t.length===0)return;t.length===1?c(t[0]):h(t)}function c(t){var r=t.getPerson(),i=n.get().conversationsManager.getConversation(r);e.matchingConversations([i])}function h(t){function o(e){return e.id()}function u(e,t){if(r.supportedKeywords().indexOf(e)<0)return;r.keywords[e]=t}function f(){if(a!==s)return;a=null,e.matchingConversations(r.results().map(function(e){return e.result}))}var r,i,s;i=t.map(o).join(" "),r=n.get().conversationsManager.createSearchQuery(),u("participantsByIds",i),s=r.getMore().then(f),a=s}var e=this,a,f;e.init=function(n){f=n.contacts.subscribe(l),e.matchingConversations=t.observableArray(),e.hasMatchingConversations=t.computed(function(){return e.matchingConversations().length>0})},e.dispose=function(){e.hasMatchingConversations.dispose(),f.dispose()},e.navigateToConversation=function(e){r.publish(u.navigation.OPEN_CONVERSATION,{model:e})}}var t=e("vendor/knockout"),n=e("swx-cafe-application-instance"),r=e("swx-pubsub-instance").default,i=e("swx-constants").COMMON,s=e("ui/telemetry/telemetryClient"),o=e("experience/settings"),u=e("swx-constants").COMMON.events;return a}),define("text!views/chat/selectedParticipantsConversation.html",[],function(){return'<div class="jumpToConversation" data-bind="css:{hide:!hasMatchingConversations()}">\r\n    <div class="topic">\r\n        <p data-bind="l10n: {key: \'label_jumpToConversation\'}">Jump to conversation</p>\r\n    </div>\r\n    <div data-bind="foreach: matchingConversations">\r\n        <swx-conversation-card params="conversationModel:$data, action:$parent.navigateToConversation"></swx-conversation-card>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/chat/selectedParticipantsConversation",["require","exports","module","ui/viewModels/chat/selectedParticipantsConversation","constants/components","text!views/chat/selectedParticipantsConversation.html"],function(e,t){function r(e){var t=new n;return t.init(e),t}var n=e("ui/viewModels/chat/selectedParticipantsConversation");t.name=e("constants/components").chat.SELECTED_PARTICIPANTS_CONVERSATION,t.template=e("text!views/chat/selectedParticipantsConversation.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/chat/conversationCard",["require","utils/common/cafeObservable"],function(e){function n(e){var n=this,r=e.conversationModel;n.topic=t.newObservableProperty(r.topic),n.isGroupConversation=t.newObservableProperty(r.isGroupConversation),n.avatarUrl=t.newObservableProperty(r.avatarUrl),n.statusClassName=null,n.action=function(){e.action&&e.action(r)}}var t=e("utils/common/cafeObservable");return n}),define("text!views/chat/conversationCard.html",[],function(){return'<div class="participant" role="button" data-bind="click: action">\r\n    <swx-avatar-deprecated params="isGroupAvatar: isGroupConversation, avatar: avatarUrl, status: statusClassName, displayName: topic" class="avatar"></swx-avatar-deprecated>\r\n    <div class="text">\r\n        <span class="tile">\r\n            <span class="tileName">\r\n                <h4 data-bind="text: topic"></h4>\r\n            </span>\r\n        </span>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/chat/conversationCard",["require","exports","module","ui/viewModels/chat/conversationCard","constants/components","text!views/chat/conversationCard.html"],function(e,t){function r(e){return new n(e)}var n=e("ui/viewModels/chat/conversationCard");t.name=e("constants/components").chat.CONVERSATION_CARD,t.template=e("text!views/chat/conversationCard.html"),t.viewModel={createViewModel:r}}),define("telemetry/chat/mediaPickerTelemetry",["require","exports","module","swx-constants","swx-service-locator-instance","experience/settings","utils/common/styleModeHelper","ui/telemetry/telemetryClient"],function(e,t){function a(){function f(){e.data={paperclipButtonClicked:t,filePickerClicked:t}}function l(e){for(var t in e)e.hasOwnProperty(t)&&!(typeof e[t]=="string"||e[t]instanceof String)&&(e[t]=e[t]+"");return e}var e=this,t=n.telemetry.NOT_AVAILABLE,a=r.resolve(n.serviceLocator.FEATURE_FLAGS);e.publish=function(){e.data.mediaBarV2Enabled=a.isFeatureOn(n.featureFlags.MEDIA_BAR_V2_ENABLED),e.data.styleMode=s.get().currentMode();var t=o.TYPE,r=l(e.data);u.get().sendEvent(i.telemetry.chatTenantToken,t,r),f()},f()}var n=e("swx-constants").COMMON,r=e("swx-service-locator-instance").default,i=e("experience/settings"),s=e("utils/common/styleModeHelper"),o=n.telemetry.mediaBarEvent,u=e("ui/telemetry/telemetryClient");t.build=function(){return new a}}),define("ui/viewModels/chat/filePicker",["require","vendor/knockout","swx-i18n","swx-constants","browser/dom","swx-service-locator-instance","telemetry/chat/mediaPickerTelemetry","utils/common/eventMixin","lodash-compat","swx-browser-detect","swx-focus-handler"],function(e){function p(e,f,p){function y(){var t={},n=l.isFunction(e.icon)?e.icon():e.icon;return n&&(t.iconfont=!0,t[n]=!0),t}function b(){var e=i.getElement(".fileInput",f.element);c.getBrowserInfo().browserName===c.BROWSERS.FIREFOX?h.get().addFocusRequestToQueue(e):e.click()}function w(){return i.getElement(u,i.getParentMatching(p,a))}function E(){var e=w();e&&h.get().addFocusRequestToQueue(e)}var d=this,v=s.resolve(r.serviceLocator.FEATURE_FLAGS),m=v.isFeatureOn(r.featureFlags.FILE_TRANSFER_ENABLED),g=l.isFunction(e.text)?e.text():e.text;d.conversationModel=e.conversationModel,g&&(d.text=n.fetch({key:g})),d.isDisabled=e.isDisabled,d.iconCssClass=t.computed(y,this),d.isFocused=t.observable(!1),d.supportedFileTypes=m?"":r.fileTransfer.SUPPORTED_PICTURE_TYPES,d.mediaPickerTelemetryEvent=e.mediaPickerTelemetryEvent||o.build(),d.init=function(){d.registerEvent(r.events.mediaPicker.FILE_PICKER_SELECTED,b)},d.onOpenDialog=function(){return d.mediaPickerTelemetryEvent.data.filePickerClicked=!0,d.mediaPickerTelemetryEvent.publish(),d.dispatchEvent(r.events.mediaPicker.CLOSE_PICKER,d.DIRECTION.PARENT),d.isFocused(!1),!0},d.processFiles=function(e,t){d.conversationModel.fileTransferService.send(t.target.files),t.target.value=null,E()},d.dispose=function(){d.iconCssClass.dispose()}}var t=e("vendor/knockout"),n=e("swx-i18n").localization,r=e("swx-constants").COMMON,i=e("browser/dom"),s=e("swx-service-locator-instance").default,o=e("telemetry/chat/mediaPickerTelemetry"),u=".swx .chat .inputField",a=".swx .chat",f=e("utils/common/eventMixin"),l=e("lodash-compat"),c=e("swx-browser-detect").default,h=e("swx-focus-handler");return l.assign(p.prototype,f),{build:function(e,t){return new p(e,t)}}}),define("text!views/chat/filePicker.html",[],function(){return'<div class="swx-file-picker-btn filePicker" data-bind="css: {disabled: isDisabled, focused: isFocused}">\r\n    <label data-bind="attr: {\'title\': text}" aria-relevant="all">\r\n        <span class="icon" data-bind="css: iconCssClass"></span>\r\n        <span id="filePickerLabel" class="text" data-bind="l10n: {key: text}, attr: {\'aria-label\': text}"></span>\r\n        <input type="file" class="fileInput" multiple="multiple" role="button" aria-labelledby="filePickerLabel"\r\n               data-bind="event: {change: processFiles},\r\n                attr: {\'title\': text, accept:supportedFileTypes},\r\n                hasFocus: isFocused,\r\n                click: onOpenDialog,\r\n                disable: isDisabled"/>\r\n    </label>\r\n</div>\r\n'}),define("ui/components/chat/filePicker",["require","exports","module","ui/viewModels/chat/filePicker","vendor/knockout","constants/components","text!views/chat/filePicker.html"],function(e,t){function i(e,t){var i=n.build(e,t);return i.setContext(r.dataFor(t.element)),i.init(),i}var n=e("ui/viewModels/chat/filePicker"),r=e("vendor/knockout");t.name=e("constants/components").chat.FILE_PICKER,t.template=e("text!views/chat/filePicker.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/notificationsCenter",[],function(){function e(){}return e}),define("text!views/chat/notificationsCenter.html",[],function(){return"<div>\r\n    List of Notifications\r\n</div>\r\n"}),define("ui/components/chat/notificationsCenter",["require","exports","module","ui/viewModels/chat/notificationsCenter","constants/components","text!views/chat/notificationsCenter.html"],function(e,t){function r(e){return new n(e)}var n=e("ui/viewModels/chat/notificationsCenter");t.name=e("constants/components").chat.NOTIFICATIONS_CENTER,t.template=e("text!views/chat/notificationsCenter.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/chat/notificationsMenuItem",["require","swx-pubsub-instance","swx-constants","swx-i18n"],function(e){function i(e){var i=this,s=!1;i.id="menuItem-notifications",i.text=r.fetch({key:"notificationsPage_text_menuLink"}),i.isDisabled=e.isDisabled?e.isDisabled:!1,i.onClick=function(){s=!s,t.publish(n.navigation.NOTIFICATIONS_CENTER,s)}}var t=e("swx-pubsub-instance").default,n=e("swx-constants").COMMON.events,r=e("swx-i18n").localization;return i}),define("text!views/chat/notificationsMenuItem.html",[],function(){return'<a role="button" class="navItem"\r\n   data-bind="event: {mousedown: onClick}, attr: { id: id }, visible: !isDisabled()">\r\n        <span class="icon">\r\n            <span class="iconfont messageUnread"></span>\r\n        </span>\r\n        <span class="text">\r\n            <h4 data-bind="text: text"></h4>\r\n        </span>\r\n</a>\r\n'}),define("ui/components/chat/notificationsMenuItem",["require","exports","module","ui/viewModels/chat/notificationsMenuItem","constants/components","text!views/chat/notificationsMenuItem.html"],function(e,t){function r(e){return new n(e)}var n=e("ui/viewModels/chat/notificationsMenuItem");t.name=e("constants/components").chat.NOTIFICATIONS_MENU_ITEM,t.template=e("text!views/chat/notificationsMenuItem.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/chat/notificationsToggleButton",["require","exports","module","vendor/knockout","notifications/settings","swx-constants","ui/telemetry/actions/actionNames","swx-service-locator-instance","swx-i18n"],function(e,t){function a(e){function a(e,t){var n=o.resolve(i.serviceLocator.ACTION_TELEMETRY);n.recordAction(e,t)}var t=this;t.notificationsMuted=r.chatNotificationsMuted,t.toggleNotificationsTitle=n.computed(function(){return u.fetch({key:t.notificationsMuted()?"turnOnChatNotifications_tooltip":"turnOffChatNotifications_tooltip"})}),t.isDisabled=e.isDisabled?e.isDisabled:n.observable(!1),t.toggleNotifications=function(){r.chatNotificationsMuted()?a(s.chat.notificationsEnabled):a(s.chat.notificationsDisabled),r.chatNotificationsMuted(!r.chatNotificationsMuted())},t.dispose=function(){t.toggleNotificationsTitle.dispose()}}var n=e("vendor/knockout"),r=e("notifications/settings"),i=e("swx-constants").COMMON,s=e("ui/telemetry/actions/actionNames"),o=e("swx-service-locator-instance").default,u=e("swx-i18n").localization;t.build=function(e){return new a(e)}}),define("text!views/chat/notificationsToggleButton.html",[],function(){return'<button data-bind="visible: !isDisabled(), click: toggleNotifications, attr: { title: toggleNotificationsTitle }" class="NotificationsSwitcher btn primary circle" type="button" data-preventdefault="false">\r\n    <span class="iconfont" data-bind="css: { notificationsMuted: notificationsMuted }, text: toggleNotificationsTitle"></span>\r\n</button>\r\n'}),define("ui/components/chat/notificationsToggleButton",["require","exports","module","ui/viewModels/chat/notificationsToggleButton","constants/components","text!views/chat/notificationsToggleButton.html"],function(e,t){function r(e){return n.build(e)}var n=e("ui/viewModels/chat/notificationsToggleButton");t.name=e("constants/components").chat.NOTIFICATIONS_TOGGLE_BUTTON,t.template=e("text!views/chat/notificationsToggleButton.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/chat/uploadManager",["require","vendor/knockout","utils/common/cafeObservable"],function(e){function r(e){function i(){return r.files().length>0}function s(){return r.files().length>1?"Sending "+r.files().length+" files":r.files().length===1?"Sending "+r.files()[0].name():""}var r=this;r.conversation=e.conversationModel,r.files=n.newObservableCollection(r.conversation.fileTransferService.files),r.isUploading=t.computed(i),r.statusText=t.computed(s),r.dispose=function(){r.isUploading.dispose(),r.statusText.dispose()}}var t=e("vendor/knockout"),n=e("utils/common/cafeObservable");return r}),define("text!views/chat/uploadManager.html",[],function(){return'<div data-bind="visible: isUploading">\r\n    <p class="status-text" data-bind="text: statusText"></p>\r\n</div>'}),define("ui/components/chat/uploadManager",["require","exports","module","ui/viewModels/chat/uploadManager","constants/components","text!views/chat/uploadManager.html"],function(e,t){function r(e){return new n(e)}var n=e("ui/viewModels/chat/uploadManager");t.name=e("constants/components").chat.UPLOAD_MANAGER,t.template=e("text!views/chat/uploadManager.html"),t.viewModel={createViewModel:r}}),define("text!views/chat/downloadFileConfirmationDialog.html",[],function(){return'<div class="downloadFileConfirmationDialogContent">\r\n    <p class="description" data-bind="text:text"></p>\r\n    <!-- ko if:isSafetype -->\r\n    <p class="donotshowagain">\r\n        <input type="checkbox" data-bind="checked:stopShowingAgain"/>\r\n        <span data-bind="l10n:{key:\'file_transfer_download_dialog_do_not_ask_checkbox\'}"></span>\r\n    </p>\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("ui/modalDialog/downloadFileConfirmationDialog",["require","exports","module","vendor/knockout","swx-constants","experience/settings","swx-i18n","ui/modalDialog/confirmationDialog","text!views/chat/downloadFileConfirmationDialog.html","swx-flags-service-api","swx-cafe-application-instance"],function(e,t){function l(e,t,r){var i=r?"file_transfer_download_safe_file_dialog_text":"file_transfer_download_unsafe_file_dialog_text";this.isSafetype=r,this.text=s.fetch({key:i,params:{filename:e,author:t}}),this.stopShowingAgain=n.observable(!1)}var n=e("vendor/knockout"),r=e("swx-constants").COMMON,i=e("experience/settings"),s=e("swx-i18n").localization,o=e("ui/modalDialog/confirmationDialog"),u=e("text!views/chat/downloadFileConfirmationDialog.html"),a=e("swx-flags-service-api"),f=e("swx-cafe-application-instance");t.start=function(e,t,n,c){function v(){n&&n();if(p.stopShowingAgain())return f.get().signInManager._skypeToken().then(m)}function m(e){a.build(i.flagsApiUrl).update(r.fileTransfer.FILE_DOWNLOAD_WARNING_FLAG_API_ID,!0,e)}var h,p=new l(e,t,c),d=c?"file_transfer_download_safe_file_dialog_title":"file_transfer_download_unsafe_file_dialog_title";h=o.build({title:s.fetch({key:d}),content:u,contentViewModel:p,onConfirm:v,confirmButtonTitle:s.fetch({key:"file_transfer_download_dialog_confirm_button_title"})}),h.show()}}),define("ui/viewModels/chat/fileTransferActivityActions",["require","exports","module","lodash-compat","swx-enums","swx-constants","swx-i18n","vendor/knockout","experience/settings","browser/dom","swx-cafe-application-instance","swx-flags-service-api","swx-browser-detect","ui/modalDialog/downloadFileConfirmationDialog"],function(e,t){function p(e){if(!e.message)throw new Error("Message is not provided");if(!e.onabort)throw new Error("Abort handler is not provided");var t=this,p=e.message,d=e.onabort;t.fileUri=p.fileUri,t.fileName=p.fileName,t.isPending=o.computed(function(){return p.status()===r.activityStatus.Pending}),t.errorMessage=o.observable(),t.isFailed=o.computed(function(){var e=p.status()===r.activityStatus.Failed,n=p.shouldAbort();return t.errorMessage(s.fetch({key:"file_transfer_upload_failed"})),p.model.fileSize>i.fileTransfer.MAX_FILE_SIZE&&t.errorMessage(s.fetch({key:"file_transfer_upload_too_large_warning"})),e&&!n}),t.downloadButtonTitle=s.fetch({key:"file_transfer_download_button_title",params:{filename:p.model.fileName}}),t.abort=function(){d()},t.downloadFile=function(){function s(e){if(e&&r){v();return}h.start(p.fileName,p.author.displayName(),d,r)}function o(e){return e=e.trim().toLowerCase(),e===p.fileType||e==="."+p.fileType}function d(){v()}function v(){var e=a.createElement("a");e.download=t.fileName,e.href=t.fileUri();if(c.getBrowserInfo().isIeEngine){e.click();return}var n=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});return e.dispatchEvent(n)}var e=u.cloudFileSharing.unsafeFileTypes.split(","),r=!n.any(e,o);return f.get().signInManager._skypeToken().then(function(e){l.build(u.flagsApiUrl).read(i.fileTransfer.FILE_DOWNLOAD_WARNING_FLAG_API_ID,e).then(s)})},t.progressIndicatorBG=o.computed(function(){var e=p.progress(),t=90,n="#FFF",r="#333",i=e<=50?r:n,s=Math.floor(e*3.6)+t,o=e<=50?-t:t,u=e===0?0:50,a="linear-gradient("+o+"deg, transparent "+u+"%, "+i+" 50%),"+"linear-gradient("+s+"deg, "+n+" 50%, transparent 50%)";return a}),t.dispose=function(){t.progressIndicatorBG.dispose(),t.isPending.dispose(),t.isFailed.dispose()}}var n=e("lodash-compat"),r=e("swx-enums"),i=e("swx-constants").COMMON,s=e("swx-i18n").localization,o=e("vendor/knockout"),u=e("experience/settings"),a=e("browser/dom"),f=e("swx-cafe-application-instance"),l=e("swx-flags-service-api"),c=e("swx-browser-detect").default,h=e("ui/modalDialog/downloadFileConfirmationDialog");t.build=function(e){return new p(e)}}),define("text!views/chat/fileTransferActivityActions.html",[],function(){return'<!-- ko if: isPending -->\r\n    <span class="progressIndicator" data-bind="style:{backgroundImage:progressIndicatorBG}"></span>\r\n    <a data-bind="click:abort, l10n_attr:{\'aria-label\':\'file_transfer_upload_cancel\', \'title\':\'file_transfer_upload_cancel\'}" role="button" tabindex="-2">\r\n        <span class="abort iconfont cancel" ></span>\r\n    </a>\r\n<!-- /ko -->\r\n<!-- ko ifnot: isPending -->\r\n    <!-- ko ifnot:isFailed -->\r\n    <a data-bind="click:downloadFile, attr:{title: downloadButtonTitle, \'aria-label\': downloadButtonTitle}" role="button" tabindex="-2">\r\n        <span class="download iconfont down"></span>\r\n    </a>\r\n    <!-- /ko -->\r\n    <!-- ko if: isFailed -->\r\n    <span class="failedIcon iconfont errorSad" data-bind="l10n_attr:{\'title\':\'file_transfer_upload_failed\'}"></span>\r\n    <span class="errorMessage" data-bind="html:errorMessage, attr:{\'title\':errorMessage}"></span>\r\n    <!-- /ko -->\r\n<!-- /ko -->\r\n'}),define("ui/components/chat/fileTransferActivityActions",["require","exports","module","ui/viewModels/chat/fileTransferActivityActions","constants/components","text!views/chat/fileTransferActivityActions.html"],function(e,t){function r(e){return n.build(e)}var n=e("ui/viewModels/chat/fileTransferActivityActions");t.name=e("constants/components").chat.FILE_TRANSFER_ACTIVITY_ACTIONS,t.template=e("text!views/chat/fileTransferActivityActions.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/chat/chatInputActionPicker",["require","lodash-compat","swx-cafe-application-instance","ui/modelHelpers/personHelper","utils/common/eventMixin","vendor/knockout","swx-service-locator-instance","swx-constants","telemetry/chat/mediaPickerTelemetry","utils/common/styleModeHelper","swx-constants","utils/common/eventHelper","utils/common/outsideClickHandler","ui/modelHelpers/conversationHelper","utils/common/accessibility"],function(e){function m(e){function k(e){e?v.announce({key:"accessibility_close_picker"}):v.announce({key:"accessibility_open_picker"})}function L(){E&&t.isFunction(E.capabilities._contactSend)&&E.capabilities._contactSend.changed.off(X)}function A(){E&&t.isFunction(E.capabilities._photoSend)&&E.capabilities._photoSend.changed.off(V)}function O(){E&&t.isFunction(E.capabilities._fileSend)&&E.capabilities._fileSend.changed.off($)}function M(){i.conversationModel.participants.changed.off(W),E=null}function D(){p.remove(N)}function P(){i.isActionPickerOpened(!1)}function H(e){i.isActionPickerCollapsed(!!e),i.isActionPickerCollapsed()&&P()}function B(){S||(g.subscribe(u.events.textarea.HAS_INPUT,H),S=!S)}function j(){S&&(g.unsubscribe(u.events.textarea.HAS_INPUT,H),S=!S)}function F(){return y&&!i.__internal.isGuestUser()&&(!i.isOneToOneConversationWithAgent()||i.isOneToOneConversationWithAgent()&&i.agentHasSendContactsCapability())}function I(){return b&&(!i.isOneToOneConversationWithAgent()||i.isOneToOneConversationWithAgent()&&i.agentHasSendPhotosCapability())}function q(){return w&&(!i.isOneToOneConversationWithAgent()||i.isOneToOneConversationWithAgent()&&i.agentHasSendFilesCapability())}function R(){return i.canSendPhotos()||i.canTransferFiles()}function U(){if(i.canSendPhotos()&&i.canTransferFiles())return"media";if(i.canSendPhotos())return"picture";if(i.canTransferFiles())return"file"}function z(){if(i.canSendPhotos()&&i.canTransferFiles())return"file_transfer_send_photos_and_files";if(i.canSendPhotos())return"button_text_filePicker";if(i.canTransferFiles())return"file_transfer_share_file"}function W(){var e;L(),A(),O(),e=d.isOneToOneConversationWithAgent(i.conversationModel),i.isOneToOneConversationWithAgent(e);if(!e){i.agentHasSendContactsCapability(!1),i.agentHasSendPhotosCapability(!1),i.agentHasSendFilesCapability(!1);return}E=i.conversationModel.participants()[0].person,E&&(t.isFunction(E.capabilities._contactSend)&&E.capabilities._contactSend.changed(X),t.isFunction(E.capabilities._photoSend)&&E.capabilities._photoSend.changed(V),t.isFunction(E.capabilities._fileSend)&&E.capabilities._fileSend.changed($))}function X(){E&&t.isFunction(E.capabilities._contactSend)&&i.agentHasSendContactsCapability(E.capabilities._contactSend())}function V(){E&&t.isFunction(E.capabilities._photoSend)&&i.agentHasSendPhotosCapability(E.capabilities._photoSend())}function $(){E&&t.isFunction(E.capabilities._fileSend)&&i.agentHasSendFilesCapability(E.capabilities._fileSend())}var i=this,m=o.resolve(u.serviceLocator.FEATURE_FLAGS),g=o.resolve(u.serviceLocator.PUBSUB),y=m.isFeatureOn(u.featureFlags.SEND_CONTACT_CARD_ENABLED),b=m.isFeatureOn(u.featureFlags.PHOTO_SHARING_ENABLED),w=m.isFeatureOn(u.featureFlags.FILE_TRANSFER_ENABLED),E,S=!1,x,T,N="chatInputActionPicker",C;i.__internal={isGuestUser:r.isGuest.bind(null,n.get().personsAndGroupsManager.mePerson)},i.isActionPickerOpened=s.observable(!1).extend({rateLimit:100}),i.isActionPickerCollapsed=s.observable(!1),i.conversationModel=e.conversationModel,i.isDisabled=e.isDisabled,i.isCollapsible=e.isCollapsible,i.mediaPickerTelemetryEvent=a.build(),i.isPollsFeatureEnabled=s.observable(!1),i.isOneToOneConversationWithAgent=s.observable(!1),i.agentHasSendContactsCapability=s.observable(!1),i.canSendContactCard=s.computed(F),i.agentHasSendPhotosCapability=s.observable(!1),i.canSendPhotos=s.computed(I),i.agentHasSendFilesCapability=s.observable(!1),i.canTransferFiles=s.computed(q),i.isPhotoSharingOrFileTransferEnabled=s.computed(R),i.filePickerIcon=s.computed(U),i.filePickerText=s.computed(z),i.init=function(){i.registerEvent(u.events.mediaPicker.CLOSE_PICKER,P),i.forwardEvent(u.events.mediaPicker.POLL_BUTTON_SELECTED,i.DIRECTION.CHILD),f.get().currentMode()===l.WIDE&&B(),x=f.get().currentMode.subscribe(function(e){e===l.WIDE?B():j()}),C=i.isActionPickerOpened.subscribe(function(e){if(f.get().currentMode()===l.WIDE)return;e?p.add(N,P):D()}),i.conversationModel.participants.changed(W),i.conversationModel.sendPollMessage&&(T=i.conversationModel.sendPollMessage.enabled.changed(function(e){i.isPollsFeatureEnabled(e)}))},i.triggerActionMenu=function(){var e=i.isActionPickerOpened();k(e),i.isActionPickerOpened(!e),i.isActionPickerOpened()&&(i.isActionPickerCollapsed(!1),i.mediaPickerTelemetryEvent.data.paperclipButtonClicked=!0)},i.handleKeyDown=function(e,t){var n=h.getKeyCode(t);if(n===c.ESCAPE&&i.isActionPickerOpened()){t.stopPropagation(),P();return}return!0},i.dispose=function(){D(),j(),x.dispose(),C.dispose(),T&&T.dispose(),L(),A(),O(),M(),i.canSendContactCard.dispose(),i.canSendPhotos.dispose(),i.canTransferFiles.dispose(),i.isPhotoSharingOrFileTransferEnabled.dispose(),i.filePickerIcon.dispose(),i.filePickerText.dispose()}}var t=e("lodash-compat"),n=e("swx-cafe-application-instance"),r=e("ui/modelHelpers/personHelper"),i=e("utils/common/eventMixin"),s=e("vendor/knockout"),o=e("swx-service-locator-instance").default,u=e("swx-constants").COMMON,a=e("telemetry/chat/mediaPickerTelemetry"),f=e("utils/common/styleModeHelper"),l=u.styleMode,c=e("swx-constants").KEYS,h=e("utils/common/eventHelper"),p=e("utils/common/outsideClickHandler"),d=e("ui/modelHelpers/conversationHelper"),v=e("utils/common/accessibility").narrator;return t.assign(m.prototype,i),{build:function(e){return new m(e)}}}),define("text!views/chat/chatInputActionPicker.html",[],function(){return"<div class=\"chatInputActionPicker\" data-bind=\"css: {collapsed: isActionPickerCollapsed(), collapsible: isCollapsible}, event: { keydown: handleKeyDown}\">\r\n    <swx-button params=\"icon: 'paperclip', cssClass: 'transparent circle actionButton',\r\n                textKey: 'button_text_chatInputActionPicker', titleKey: 'button_text_chatInputActionPicker', ariaLabelKey: 'button_text_chatInputActionPicker', ariaHasPopup: 'true', action: triggerActionMenu,\r\n                disabled: isDisabled\"></swx-button>\r\n\r\n    <!-- ko if: isPollsFeatureEnabled -->\r\n    <swx-poll-designer class=\"chatInputPollButton\" params=\"isDisabled: isDisabled\"></swx-poll-designer>\r\n    <!-- /ko -->\r\n\r\n    <div class=\"wrapper\">\r\n        <div class=\"menuContainer\" data-bind=\"css: {inline: !isActionPickerOpened()}\">\r\n            <ul class=\"menu fontSize-p\">\r\n                <!-- ko if: isPhotoSharingOrFileTransferEnabled -->\r\n                <li class=\"action btnOutline\" data-bind=\"attr: {'media-item': 'file-picker', 'data-preventdefault': 'false'}\">\r\n                    <swx-file-picker params=\"isDisabled: isDisabled, conversationModel: conversationModel, icon: filePickerIcon(), text: filePickerText(), mediaPickerTelemetryEvent: mediaPickerTelemetryEvent\"></swx-file-picker>\r\n                </li>\r\n                <!-- /ko -->\r\n                <!-- ko if: canSendContactCard -->\r\n                <li class=\"action btnOutline\" data-bind=\"attr:{'media-item':'send-contactCard', 'data-preventdefault': 'false'}\">\r\n                    <swx-chat-input-send-contact-card params=\"isDisabled: isDisabled, conversationModel: conversationModel, mediaPickerTelemetryEvent: mediaPickerTelemetryEvent\"></swx-chat-input-send-contact-card>\r\n                </li>\r\n                <!-- /ko -->\r\n                <!-- ko if: isPollsFeatureEnabled -->\r\n                <li class=\"action btnOutline\" data-bind=\"attr:{'media-item':'poll-button', 'data-preventdefault': 'false'}\">\r\n                    <swx-chat-input-poll-button params=\"isDisabled: isDisabled, conversationModel: conversationModel\"></swx-chat-input-poll-button>\r\n                </li>\r\n                <!-- /ko -->\r\n            </ul>\r\n        </div>\r\n    </div>\r\n</div>\r\n"}),define("ui/components/chat/chatInputActionPicker",["require","exports","module","vendor/knockout","ui/viewModels/chat/chatInputActionPicker","constants/components","text!views/chat/chatInputActionPicker.html"],function(e,t){function i(e,t){var i=r.build(e);return i.setContext(n.dataFor(t.element)),i.init(),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/chatInputActionPicker");t.name=e("constants/components").chat.CHAT_INPUT_ACTION_PICKER,t.template=e("text!views/chat/chatInputActionPicker.html"),t.viewModel={createViewModel:i}}),define("telemetry/chat/sendContactsTelemetry",["require","exports","module","swx-constants","ui/telemetry/telemetryClient","telemetry/utils/telemetryUtils","experience/settings","swx-utils-chat","swx-service-locator-instance","utils/common/styleModeHelper"],function(e,t){function l(e){function d(){t.data={cta:h||c,action:c,participantsCount:e.participantsCount()||c,statusCodestatusCode:c,timeBeforeActionTaken:c,numberOfContacts:c}}function v(){t.data.timeBeforeActionTaken=m(l,u.getDate()),t.data.mediaBarV2Enabled=p.isFeatureOn(n.featureFlags.MEDIA_BAR_V2_ENABLED),t.data.styleMode=f.get().currentMode();var e=s.stringify(t.data);i.get().sendEvent(o.telemetry.chatTenantToken,r.TYPE,e),d()}function m(e,t){return t-e}var t=this,l=u.getDate(),c=n.telemetry.NOT_AVAILABLE,h=r.cta.MEDIABAR,p=a.resolve(n.serviceLocator.FEATURE_FLAGS);t.canceled=function(){t.data.action=r.action.CANCELED,v()},t.confirmed=function(){t.data.action=r.action.CONFIRMED,v()},d()}var n=e("swx-constants").COMMON,r=n.telemetry.sendContacts,i=e("ui/telemetry/telemetryClient"),s=e("telemetry/utils/telemetryUtils"),o=e("experience/settings"),u=e("swx-utils-chat").dateTime,a=e("swx-service-locator-instance").default,f=e("utils/common/styleModeHelper");t.build=function(e){return new l(e)}}),define("ui/viewModels/chat/chatInputSendContactCard",["require","exports","module","swx-constants","utils/common/eventMixin","lodash-compat","swx-i18n","swx-pubsub-instance","telemetry/chat/sendContactsTelemetry","utils/common/accessibility","swx-focus-handler","browser/dom"],function(e,t){function c(e){function r(){var e=".swx .chat .inputField",t=l.getElement(e);t&&f.get().addFocusRequestToQueue(t)}var t=this;t.conversationModel=e.conversationModel,t.isDisabled=e.isDisabled,t.openShareControl=function(){var e=u.build(t.conversationModel),i=function(n){n.length>0&&(t.conversationModel.sendContactInfo(n),r(),e.numberOfContacts=n.length,e.confirmed(),a.announce({key:"accessibility_contact_sent"}))},f={conversationModel:t.conversationModel,title:s.fetch({key:"send_contacts_action_title"}),description:s.fetch({key:"send_contacts_action_text"}),confirmButtonTitleKey:"action_button_send",onConfirm:i,onCancel:function(){e.canceled()}};t.dispatchEvent(n.events.mediaPicker.CLOSE_PICKER,t.DIRECTION.PARENT),o.publish(n.events.shareControl.SHARE_CONTROL_SHOW,f)},t.registerEvent(n.events.mediaPicker.SEND_CONTACTS_SELECTED,t.openShareControl)}var n=e("swx-constants").COMMON,r=e("utils/common/eventMixin"),i=e("lodash-compat"),s=e("swx-i18n").localization,o=e("swx-pubsub-instance").default,u=e("telemetry/chat/sendContactsTelemetry"),a=e("utils/common/accessibility").narrator,f=e("swx-focus-handler"),l=e("browser/dom");t.build=function(e){return new c(e)},i.assign(c.prototype,r)}),define("text!views/chat/chatInputSendContactCard.html",[],function(){return"<button class=\"sendContactCard\" data-bind=\"click:openShareControl, l10n_attr:{'title':'contactPicker_sendContacts_title', 'aria-label':'contactPicker_sendContacts_title'}, css:{disabled: isDisabled}, attr:{disabled : isDisabled}\">\r\n    <span class=\"icon iconfont contactCard\"></span>\r\n    <span class=\"text\" data-bind=\"l10n:{'key':'contactPicker_sendContacts_title'}\"></span>\r\n</button>\r\n"}),define("ui/components/chat/chatInputSendContactCard",["require","exports","module","vendor/knockout","ui/viewModels/chat/chatInputSendContactCard","constants/components","text!views/chat/chatInputSendContactCard.html"],function(e,t){function i(e,t){var i=r.build(e,t),s=n.dataFor(t.element);return i.setContext(s),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/chatInputSendContactCard");t.name=e("constants/components").chat.CHAT_INPUT_SEND_CONTACT_CARD,t.template=e("text!views/chat/chatInputSendContactCard.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/shareControl",["require","exports","module","vendor/knockout","utils/common/eventMixin","swx-constants","lodash-compat","swx-constants","swx-service-locator-instance","utils/common/eventHelper"],function(e,t){function l(e){function h(){var e=r?r.selectedContacts().length:0;t.isSendButtonDisabled(e===0)}if(!e.conversationModel)throw new Error("Conversation is not provided");var t=this,r=null,o=e.onConfirm,l=e.onCancel,c=a.resolve(i.serviceLocator.PUBSUB);t.conversationModel=e.conversationModel,t.title=e.title,t.description=e.description,t.confirmButtonTitleKey=e.confirmButtonTitleKey,t.isSendButtonDisabled=n.observable(!0),t.setParticipantProvider=function(e){t.selectedContactsSubscription&&t.selectedContactsSubscription.dispose(),r=e,t.selectedContactsSubscription=r.selectedContacts.subscribe(h),h()},t.cancel=function(){l&&l(),c.publish(s.shareControl.SHARE_CONTROL_HIDE)},t.confirm=function(){var e=[];r&&r!==null&&(e=r.selectedContacts()),o&&o(e),c.publish(s.shareControl.SHARE_CONTROL_HIDE)},t.handleKeyDown=function(e,t){var n=f.getKeyCode(t);return n===u.ESCAPE&&(e.cancel(),t.stopPropagation()),!0},t.forwardEvent(s.roster.PICKER_CONTACT_SELECTED),t.forwardEvent(s.roster.PICKER_CONTACT_DESELECTED),t.forwardEvent(s.roster.ROSTER_QUERY_CHANGED),t.forwardEvent(s.roster.ROSTER_QUERY_EXECUTED),t.forwardEvent(s.roster.ROSTER_SELECTION_REMOVED)}var n=e("vendor/knockout"),r=e("utils/common/eventMixin"),i=e("swx-constants").COMMON,s=i.events,o=e("lodash-compat"),u=e("swx-constants").KEYS,a=e("swx-service-locator-instance").default,f=e("utils/common/eventHelper");t.build=function(e){return new l(e)},o.assign(l.prototype,r)}),define("text!views/chat/shareControl.html",[],function(){return'<div class="shareControlWrapper" data-bind="event: { keydown: handleKeyDown }">\r\n    <div class="title" data-bind="text:title"></div>\r\n\r\n    <div class="description" data-bind="text:description"></div>\r\n\r\n    <div class="headerAdd">\r\n        <swx-contact-picker-input params="setParticipantProvider: setParticipantProvider"></swx-contact-picker-input>\r\n    </div>\r\n\r\n    <swx-contact-picker params="conversation: conversationModel, className: \'headerPicker\', showJumpToConversation: false"></swx-contact-picker>\r\n\r\n    <div class="actions">\r\n       <div class="conversationButtons">\r\n            <swx-button params="cssClass: \'secondary circle\', disabled: false, textKey: \'action_button_cancel\', titleKey: \'action_button_cancel\', ariaLabelKey: \'action_button_cancel\', action: cancel"></swx-button>\r\n            <swx-button params="cssClass: \'primary circle\', disabled: isSendButtonDisabled, textKey: confirmButtonTitleKey, titleKey: confirmButtonTitleKey, ariaLabelKey: confirmButtonTitleKey, action: confirm"></swx-button>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/chat/shareControl",["require","exports","module","vendor/knockout","ui/viewModels/chat/shareControl","constants/components","text!views/chat/shareControl.html"],function(e,t){function i(e,t){var i=e.payload()||{},s=r.build(i),o=n.dataFor(t.element);return s.setContext(o),s}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/shareControl");t.name=e("constants/components").chat.SHARE_CONTROL,t.template=e("text!views/chat/shareControl.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/chatInputPollButton",["require","exports","module","swx-constants","lodash-compat","utils/common/eventMixin","swx-constants","utils/common/eventHelper"],function(e,t){function u(e){var t=this;t.isDisabled=e.isDisabled,t.conversationModel=e.conversationModel,t.openPollDesigner=function(e){o.getKeyCode(e)===s.ENTER&&e.preventDefault(),t.dispatchEvent(n.events.mediaPicker.POLL_BUTTON_SELECTED,null,t.DIRECTION.PARENT),t.dispatchEvent(n.events.mediaPicker.CLOSE_PICKER,null,t.DIRECTION.PARENT)}}var n=e("swx-constants").COMMON,r=e("lodash-compat"),i=e("utils/common/eventMixin"),s=e("swx-constants").KEYS,o=e("utils/common/eventHelper");t.build=function(e){return new u(e)},r.assign(u.prototype,i)}),define("text!views/chat/chatInputPollButton.html",[],function(){return'<div class="chatInputPollButton">\r\n    <button class="pollButton" data-bind="click:openPollDesigner, l10n_attr:{\'title\':\'button_text_poll\'}, css:{disabled: isDisabled}, attr:{disabled : isDisabled}">\r\n        <span class="icon iconfont poll"></span>\r\n        <span class="text" data-bind="l10n:{\'key\':\'button_text_poll\'}"></span>\r\n    </button>\r\n    <swx-poll-designer params="isDisabled: isDisabled"></swx-poll-designer>\r\n</div>\r\n'}),define("ui/components/chat/chatInputPollButton",["require","exports","module","vendor/knockout","ui/viewModels/chat/chatInputPollButton","constants/components","text!views/chat/chatInputPollButton.html"],function(e,t){function i(e,t){var i=r.build(e,t),s=n.dataFor(t.element);return i.setContext(s),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/chatInputPollButton");t.name=e("constants/components").chat.CHAT_INPUT_POLL_BUTTON,t.template=e("text!views/chat/chatInputPollButton.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/pollDesigner",["require","lodash-compat","vendor/knockout","swx-utils-common","utils/common/eventMixin","utils/common/eventHelper","swx-utils-common","telemetry/chat/poll","swx-constants","swx-constants","browser/document","utils/common/outsideClickHandler","swx-focus-handler"],function(e){function m(e,i,m){function E(){c.remove("chatInputPollButton")}function S(){c.add("chatInputPollButton",x)}function x(){r.execute(function(){g.isOpened(!1)}),E()}function T(e){return!o.isCarriageReturn(e)&&!o.isNewLine(e)&&!o.isWhiteSpace(e)}function N(){w&&h.get().addFocusRequestToQueue(w)}function C(){g.isOpened()?(g.isOpened(!1),E()):(u.pollDesignerOpened(i.conversationId),S(),g.isOpened(!0),m.focusPollQuestion())}var g=this,y,b,w=l.querySelector(".swx .chat .inputField");g.isDisabled=e,g.isOpened=n.observable(!1),g.questionText=n.observable(""),g.answers=n.observableArray(),g.isMultipleChoice=n.observable(!1),g.isSendButtonEnabled=n.computed(function(){var e=!0,n=g.answers();return y=t.filter(n,function(e){return t.trim(e.value()).length>0}),b=t.trim(g.questionText()),b.length===0&&(e=!1),y.length<2&&(e=!1),e}),g.init=function(){g.initPollBubble(),g.registerEvent(f.events.mediaPicker.POLL_BUTTON_SELECTED,C)},g.initPollBubble=function(){g.questionText(""),m.initPollQuestion(),g.isMultipleChoice(!1),g.answers.removeAll(),g.addNewAnswer("",!0,!1),g.addNewAnswer("",!1,!1)},g.removeCurrentAnswer=function(e){var t=g.answers(),n=t.indexOf(e);g.answers.remove(e),t.length===2&&(t[0].allowRemove(!1),t[1].allowRemove(!1));var r=n>=1?n-1:0;t[r].focused(!0)},g.addNewAnswer=function(e,t,r){var i={value:n.observable(""),focused:n.observable(t),allowRemove:n.observable(r)};g.answers.push(i)},g.onPaste=function(e,t,n){function c(e){s?T(e)&&(u+=e,s=!1):(u+=e,o.isNewLine(e)&&(s=!0))}var r=t.clipboardData||window.clipboardData;t.originalEvent&&(r=r||t.originalEvent.clipboardData);var i=r.getData("Text"),s=!0,u="",a=v(t.target),f=p(t.target),l=d(t.target);for(var h=0;h<i.length;h++)c(i[h]);n(o.inject(a,u,f,l))},g.onPasteQuestion=function(e,t){g.onPaste(e,t,function(e){g.questionText(e)}),g.questionChanged(e,t)},g.onPasteAnswer=function(e,t){g.onPaste(e,t,function(t){var n=g.answers().indexOf(e);g.answers()[n].value(t)}),g.onAnswerKeypress(e,t)},g.submitPoll=function(){if(!g.isSendButtonEnabled())return;var e={};e.question=b,e.answers=t.map(y,function(e){return e.value()}),e.multipleChoice=g.isMultipleChoice(),i.sendPollMessage(JSON.stringify(e)),g.initPollBubble(),x()},g.removeAnswer=function(e){g.removeCurrentAnswer(e)},g.onAnswerKeydown=function(e,n){var r=g.answers(),i=s.getKeyCode(n);return i!==a.BACKSPACE?!0:e.value().length>0?!0:e===t.last(r)?(e.focused(!1),r[r.length-2].focused(!0),!1):e.allowRemove()?(g.removeCurrentAnswer(e),!1):!0},g.onAnswerKeypress=function(e,n){var r=g.answers(),i=r.indexOf(e),o=s.getKeyCode(n);return o!==a.TAB&&e===t.last(r)&&(g.addNewAnswer("",!1,!1),e.allowRemove(!0)),i>=1&&r[0].allowRemove(!0),o===a.ENTER&&r[i+1].focused(!0),m.scrollToBottom(),!0},g.questionChanged=function(){return m.updatePollQuestion(),!0},g.handleKeyDown=function(e,t){var n=s.getKeyCode(t);if(n===a.ESCAPE&&g.isOpened()){t.stopPropagation(),x(),N();return}return!0},g.dispose=function(){g.isSendButtonEnabled.dispose(),E()}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-utils-common").async,i=e("utils/common/eventMixin"),s=e("utils/common/eventHelper"),o=e("swx-utils-common").stringUtils,u=e("telemetry/chat/poll"),a=e("swx-constants").KEYS,f=e("swx-constants").COMMON,l=e("browser/document"),c=e("utils/common/outsideClickHandler"),h=e("swx-focus-handler"),p=function(e){return e.selectionStart},d=function(e){return e.selectionEnd},v=function(e){return e.value};return t.assign(m.prototype,i),m}),define("jsviews/chat/pollDesigner",["require","browser/dom","swx-focus-handler"],function(e){function s(e){var s=t.getElement(".poll-designer-content",e),o=t.getElement("textarea",e);this.scrollToBottom=function(){s.scrollTop=s.scrollHeight-s.clientHeight},this.focusPollQuestion=function(){n.get().addFocusRequestToQueue(o)},this.initPollQuestion=function(){o.style.height=i+"px"},this.updatePollQuestion=function(){var e;o.style.height="auto",e=Math.max(i,Math.min(o.scrollHeight,r)),o.style.height=e+"px"}}var t=e("browser/dom"),n=e("swx-focus-handler"),r=150,i=19;return s}),define("text!views/chat/pollDesigner.html",[],function(){return'<div class="bubble popup arrow down" data-bind="css: { active: isOpened }, event: { keydown: handleKeyDown }">\r\n\r\n    <textarea rows="1" data-bind="l10n_attr: { \'placeholder\': \'poll_designer_question_placeholder\' }, textInput: questionText, event: { input: questionChanged, paste: onPasteQuestion }"></textarea>\r\n\r\n    <fieldset class="poll-designer-content" data-bind="template: { name: \'answer-template\', foreach: answers, as: \'a\' }"></fieldset>\r\n\r\n    <div class="send-poll-button">\r\n        <swx-button params="icon: \'send\', cssClass: \'circle send-button large\', disabled: !isSendButtonEnabled(),\r\n            titleKey: \'action_button_send\', textKey: \'action_button_send\', action: submitPoll,\r\n            ariaLabelKey: \'action_button_send\'"></swx-button>\r\n    </div>\r\n</div>\r\n\r\n<script type="text/html" id="answer-template">\r\n    <div class="answer-box">\r\n        <input type="text" data-bind="l10n_attr: { \'placeholder\': \'poll_designer_answer_placeholder\' }, textInput: a.value, event: { keypress: $parent.onAnswerKeypress, keydown: $parent.onAnswerKeydown, paste: $parent.onPasteAnswer}, hasfocus: a.focused" />\r\n        <button tabindex="-1" data-bind="visible: a.allowRemove, event: { click: $parent.removeAnswer }" type="button" class="btn primary circle small transparent delete-answer">\r\n            <span class="iconfont cross" tabindex="0"></span>\r\n        </button>\r\n    </div>\r\n</script>\r\n'}),define("ui/components/chat/pollDesigner",["require","exports","module","vendor/knockout","ui/viewModels/chat/pollDesigner","jsviews/chat/pollDesigner","constants/components","text!views/chat/pollDesigner.html"],function(e,t){function s(e,t){var s=t.element,o=n.dataFor(s),u=new i(s),a=new r(e.isDisabled,o.conversationModel,u);return a.setContext(o),a.init(),a}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/pollDesigner"),i=e("jsviews/chat/pollDesigner");t.name=e("constants/components").chat.POLL_DESIGNER,t.template=e("text!views/chat/pollDesigner.html"),t.viewModel={createViewModel:s}}),define("ui/viewModels/chat/stickyMessage",["require","lodash-compat","vendor/knockout","utils/common/eventMixin","swx-constants","swx-enums","telemetry/chat/poll","swx-i18n"],function(e){function p(e,r){var a=this,f=r.conversationModel,p,d,v,m,g=[],y=function(){var e=h(g),t=!0;a.latestPoll()!==e&&(a.latestPoll(e),a.latestPoll()?a.showStickyMessageData({isActive:!0,isVisible:t}):a.showStickyMessageData(null))};a.latestPoll=n.observable(null),a.pollQuestion=n.observable(),a.pollAuthor=n.observable(),a.statsMessageText=n.observable(),a.ongoingPoll=n.pureComputed(function(){return u.fetch({key:"poll_sticky_message_new_poll",params:{author:a.pollAuthor()}})}),a.showStickyMessageData=n.observable({isVisible:!1,isActive:!1}),a.showStickyMessage=n.observable(!1),a.showStickyMessageData.subscribe(function(e){a.showStickyMessage(e!==null&&e.isActive&&!e.isVisible)}),v=a.latestPoll.subscribe(function(e){if(!e)return;m&&m.dispose(),a.pollQuestion(e.pollQuestion()),a.pollAuthor(e.sender.firstName()),a.statsMessageText(l(e)),m=e.poll.changed(function(){a.statsMessageText(l(e))})}),p=f.historyService.activityItems.added(function(e){e.type()===s.activityType.PollMessage&&(g.push(e),y())}),d=f.historyService.activityItems.removed(function(e){e.type()===s.activityType.PollMessage&&(g=t.reject(g,function(t){return t.key()===e.key()}),y())}),a.scrollToPoll=function(){o.stickyMessageClicked(a.latestPoll()),e.scrollToLastPollElement()},a.dispose=function(){v.dispose(),p.dispose(),d.dispose(),a.ongoingPoll.dispose(),m&&m.dispose()},a.init=function(){a.registerEvent(i.events.conversation.VIEWPORT_CHANGED,function(t){var n,r;a.latestPoll()&&(n=c(a.latestPoll()),r=e.checkPollIsVisible(a.latestPoll(),t),a.showStickyMessageData({isActive:n,isVisible:r}))})}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/eventMixin"),i=e("swx-constants").COMMON,s=e("swx-enums"),o=e("telemetry/chat/poll"),u=e("swx-i18n").localization,a=1800,f=86400,l=function(e){var n=e.meCheckedAnswerPositions(),r=t.isEmpty(n)?-1:n[0],i=e.pollAnswers(),s;return i&&r>=0&&r<i.length?s=u.fetch({key:"poll_sticky_message_me_voted",params:{answerText:i[r].answerText}}):s=u.fetch({key:"poll_sticky_message_me_not_voted"}),s+" · "+u.fetch({key:"poll_message_people_voted",params:{count:e.peopleVotedNum()}})},c=function(e){if(!e)return!1;var n=a;return t.isEmpty(e.meCheckedAnswerPositions())&&(n=f),t.now()-e.timestamp().getTime()<n*1e3},h=function(e){var n=t.filter(e,function(e){return c(e)});return n.length===0?null:n.sort(function(e,t){return t.timestamp()-e.timestamp()})[0]};return t.assign(p.prototype,r),p}),define("jsviews/chat/stickyMessage",["require","browser/dom","lodash-compat","vendor/knockout","browser/window","browser/document"],function(e){function u(e){function a(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(i.innerHeight||s.documentElement.clientHeight)&&t.right<=(i.innerWidth||s.documentElement.clientWidth)}function f(e,t,n,r){if(n<=0)return;var i=t-e.scrollTop,s=i<0,o=i/n*10;setTimeout(function(){e.scrollTop=e.scrollTop+o;if(s&&e.scrollTop<=t){r();return}if(!s&&e.scrollTop>=t){r();return}f(e,t,n-10,r)},10)}var u=this;u.lastPollElement=r.observable(null),u.scrollToLastPollElement=function(){var n=u.lastPollElement(),r=t.getElement(".conversation.scrollable",e.parentElement),i=Math.min(n.offsetTop-25,r.scrollHeight-r.offsetHeight);t.removeClass(n,"highlight"),f(r,i,o,function(){t.addClass(n,"highlight")})},u.checkPollIsVisible=function(e,t){var r=!1,i=e.key();return n.some(t,function(e){if(e.getAttribute("data-id")===i)return u.lastPollElement(e),r=a(e),!0}),r}}var t=e("browser/dom"),n=e("lodash-compat"),r=e("vendor/knockout"),i=e("browser/window"),s=e("browser/document"),o=200;return u}),define("text!views/chat/stickyMessage.html",[],function(){return'<div class="stickyMessage" data-bind="event: { click: scrollToPoll }">\r\n    <div class="stickyMessageWrapper" data-bind="css: { \'visible\': showStickyMessage }">\r\n        <div class="stickyMessageContent">\r\n            <span class="stickyMessageAuthor" data-bind="\'text\': ongoingPoll()"></span>\r\n            <span class="stickyMessageQuestion" data-bind="text: pollQuestion()"></span>\r\n        </div>\r\n        <span class="stickyMessageStats" data-bind="text: statsMessageText()"></span>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/chat/stickyMessage",["require","exports","module","vendor/knockout","ui/viewModels/chat/stickyMessage","jsviews/chat/stickyMessage","constants/components","text!views/chat/stickyMessage.html"],function(e,t){function s(e,t){var s=t.element,o=new i(s),u=new r(o,e,t),a=n.dataFor(s);return u.setContext(a),u.init(),u}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/stickyMessage"),i=e("jsviews/chat/stickyMessage");t.name=e("constants/components").chat.STICKY_MESSAGE,t.template=e("text!views/chat/stickyMessage.html"),t.viewModel={createViewModel:s}}),define("ui/viewModels/chat/startConversationOverlay",["require","lodash-compat","vendor/knockout","swx-constants","utils/common/eventMixin","ui/viewModels/people/contactBuilder","ui/viewModels/chat/conversation/callButtonViewModel"],function(e){function u(e){function l(){return a.displayMessage()===a.locationText()?"":a.displayMessage()}var t=this,i=e.conversationModel,u=i.participants()[0].person,a=s.build(u),f=o.build(i);t.avatar=a.avatar,t.statusClassName=a.statusClassName,t.displayName=a.displayName,t.displayMessage=n.computed(l),t.locationText=a.locationText,t.isAudioDisabled=f.isAudioDisabled,t.isVideoDisabled=f.isVideoDisabled,t.buttonVideoTitle=f.buttonVideoTitle,t.buttonVideoAriaLabel=f.buttonVideoAriaLabel,t.buttonCallTitle=f.buttonCallTitle,t.buttonCallAriaLabel=f.buttonCallAriaLabel,t.forwardEvent(r.events.conversation.OVERLAY_CLOSED),t.startCallWithAudio=function(){f.startCallWithAudio(),t.dispatchEvent(r.events.conversation.OVERLAY_CLOSED,t.DIRECTION.PARENT)},t.startCallWithVideo=function(){f.startCallWithVideo(),t.dispatchEvent(r.events.conversation.OVERLAY_CLOSED,t.DIRECTION.PARENT)},t.startChat=function(){t.dispatchEvent(r.events.conversation.OVERLAY_CLOSED,t.DIRECTION.PARENT)},t.dispose=function(){a.dispose(),f.dispose()}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-constants").COMMON,i=e("utils/common/eventMixin"),s=e("ui/viewModels/people/contactBuilder"),o=e("ui/viewModels/chat/conversation/callButtonViewModel");return t.assign(u.prototype,i),{build:function(e){return new u(e)}}}),define("text!views/chat/startConversationOverlay.html",[],function(){return'<div class="StartConversationOverlay-container themeWhite">\r\n    <div class="StartConversationOverlay-content">\r\n        <div class="StartConversationOverlay-col1">\r\n            <swx-avatar params="isGroupAvatar: false, avatar: avatar, status: statusClassName"></swx-avatar>\r\n        </div>\r\n        <div class="StartConversationOverlay-col2">\r\n            <div class="StartConversationOverlay-greeting" data-bind="l10n: { key: \'invite_free_overlay_greeting\' }"></div>\r\n\r\n            <swx-avatar params="isGroupAvatar: false, avatar: avatar, status: statusClassName"></swx-avatar>\r\n\r\n            <div data-bind="text: displayName, attr: {title: displayName}" class="StartConversationOverlay-displayName"></div>\r\n            <!-- ko if: displayMessage -->\r\n            <div data-bind="text: displayMessage, attr: {title: displayMessage}" class="StartConversationOverlay-statusMessage"></div>\r\n            <!--  /ko -->\r\n            <!-- ko if: locationText -->\r\n            <div class="StartConversationOverlay-location">\r\n                <span class="iconfont location"></span>\r\n                <span data-bind="text: locationText, attr: {title: locationText}" class="StartConversationOverlay-locationText"></span>\r\n            </div>\r\n            <!-- /ko -->\r\n\r\n            <div class="StartConversationOverlay-buttonContainer">\r\n                <label class="StartConversationOverlay-button">\r\n                    <swx-button params="icon: \'videoOn\', cssClass: \'primary circle\', disabled: isVideoDisabled, textKey: \'button_text_videoCall\', i18nTitle: buttonVideoTitle, action: startCallWithVideo, ariaLabel: buttonVideoAriaLabel"></swx-button>\r\n                    <span class="StartConversationOverlay-buttonText" data-bind="l10n: { key: \'label_text_call_skype_video\' }"></span>\r\n                </label>\r\n                <label class="StartConversationOverlay-button">\r\n                    <swx-button params="icon: \'callStart\', cssClass: \'primary circle\', disabled: isAudioDisabled, textKey: \'button_text_audioCall\', i18nTitle: buttonCallTitle, action: startCallWithAudio, ariaLabel: buttonCallAriaLabel"></swx-button>\r\n                    <span class="StartConversationOverlay-buttonText" data-bind="l10n: { key: \'label_text_call\' }"></span>\r\n                </label>\r\n                <label class="StartConversationOverlay-button">\r\n                    <swx-button params="icon: \'message\', cssClass: \'primary circle\', textKey: \'label_text_send_message\', titleKey: \'label_text_send_message\', action: startChat,  ariaLabelKey: \'label_text_send_message\'"></swx-button>\r\n                    <span class="StartConversationOverlay-buttonText" data-bind="l10n: { key: \'label_text_send_message\' }"></span>\r\n                </label>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/chat/startConversationOverlay",["require","exports","module","vendor/knockout","ui/viewModels/chat/startConversationOverlay","constants/components","text!views/chat/startConversationOverlay.html"],function(e,t){function i(e,t){var i=r.build(e);return i.setContext(n.dataFor(t.element)),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/startConversationOverlay");t.name=e("constants/components").chat.START_CONVERSATION_OVERLAY,t.template=e("text!views/chat/startConversationOverlay.html"),t.viewModel={createViewModel:i}}),define("ui/components/chat/suggestions/simpleWordSuggestion",["require","swx-utils-common"],function(e){function n(){}var t=e("swx-utils-common").stringUtils;return n.prototype.applySuggestion=function(n){var r=this.textarea.viewModel.messageBody(),i=t.wordBoundariesAt(r,this.searchPosition),s=this.getReplacer(n),o=r.slice(i.end);o===""&&(s+=" "),r=r.slice(0,i.start)+s+o,this.textarea.viewModel.messageBody(r),this.textarea.view.setCursorAt(i.start+s.length),n.data.criteriaLength=i.end-i.start,n.data.suggestionType=this.suggestionType},n}),define("ui/components/chat/suggestions/emoticonSuggestion",["require","lodash-compat","ui/components/chat/suggestions/simpleWordSuggestion"],function(e){function s(e,t,n,r,i){this.emoticon=r,this.textarea={view:t,viewModel:e},this.searchPosition=n,this.shortcut=i}var t=e("lodash-compat"),n=e("ui/components/chat/suggestions/simpleWordSuggestion"),r="EMOTICONS",i="swx-suggestion-emoticon";return s.prototype.templateId=i,s.prototype.suggestionType=r,s.prototype.getReplacer=function(){return this.shortcut},s.build=function(t,n,r,i,o){return new s(t,n,r,i,o)},t.assign(s.prototype,n.prototype),s}),define("ui/components/chat/suggestions/emoticonSuggestionEngine",["require","lodash-compat","swx-constants","ui/components/chat/suggestions/emoticonSuggestion","services/pes/constants","swx-service-locator-instance","swx-cafe-application-instance","swx-utils-common"],function(e){function f(){var e=s.resolve(n.serviceLocator.FEATURE_FLAGS);this.isEnabled=e.isFeatureOn(n.featureFlags.EMOTICON_SUGGESTION_ENABLED),this.isImplicitEnabled=!e.isFeatureOn(n.featureFlags.EMOTICON_IMPLICIT_SUGGESTION_DISABLED),this.suggestHidden=e.isFeatureOn(n.featureFlags.SUGGEST_HIDDEN_EMOTICONS),this.canBeDisabledInSettings=e.isFeatureOn(n.featureFlags.SHOW_EMOTICON_SUGGESTIONS_SETTINGS)}function l(e,n){return t.any(n.shortcuts,function(t){return t===e})}var t=e("lodash-compat"),n=e("swx-constants").COMMON,r=e("ui/components/chat/suggestions/emoticonSuggestion"),i=e("services/pes/constants"),s=e("swx-service-locator-instance").default,o=e("swx-cafe-application-instance"),u=e("swx-utils-common").stringUtils,a=4;return f.prototype.priority=2,f.prototype.filterEmoticons=function(r){var o=s.resolve(n.serviceLocator.PES_CONFIG_SERVICE),a=o.getConfiguration().items,f=this.suggestHidden;return a.reduce(function(e,n){if(n.type!==i.itemTypes.emoticon.id||!n.visible&&!f)return e;var s=t.any(n.keywords.concat(n.description),function(e){return u.anyWordStartsWith(e,r)});if(s)return e.push({emoticon:n,shortcut:n.shortcuts[0]}),e;var o=t.find(n.shortcuts,function(e){return u.anyWordStartsWith(e,r)});return o&&e.push({emoticon:n,shortcut:o}),e},[])},f.prototype.getSuggestions=function(t,i){if(!this.isEnabled)return{isExplicit:!1,suggestions:[]};if(this.canBeDisabledInSettings){var s=o.get().personsAndGroupsManager.mePerson,f=s.preferences(n.userSettings.preferences.EMOTICON_SUGGESTIONS).value();if(!f)return{isExplicit:!1,suggestions:[]}}var c=t.getSelectionStart(),h=u.wordAt(t.messageBody(),c),p=h.indexOf("(")===0;p&&(h=h.substring(1));if(!p&&(h.length<a||!this.isImplicitEnabled))return{isExplicit:p,suggestions:[]};var d=this.filterEmoticons(h);return d.length===1&&p&&l("("+h,d[0].emoticon)&&(d=[]),{isExplicit:p,suggestions:d.map(function(e){return r.build(t,i,c,e.emoticon,e.shortcut)})}},f}),define("telemetry/chat/suggestionSelectedEvent",["require","swx-constants","experience/settings","swx-constants","ui/telemetry/telemetryClient"],function(e){function s(){var e=this,s="message_suggestion_action";e.enums={TRIGGER:{EXPLICIT:"explicit",IMPLICIT:"implicit",QUOTE:"quote"},RESOLUTION:{ENTER:"enter",TAB:"tab",ESC:"escape",CLICKIN:"click-in",CLICKOUT:"click-out",MISSMATCH:"missmatch"},getResolution:function(n){switch(n){case r.TAB:return e.enums.RESOLUTION.TAB;case r.ENTER:return e.enums.RESOLUTION.ENTER;case r.ESC:return e.enums.RESOLUTION.ESC;default:return t.telemetry.NOT_AVAILABLE}}},e.data={},e.publish=function(){e.data.selectedIndex!==t.telemetry.NOT_AVAILABLE&&i.get().sendEvent(n.telemetry.chatTenantToken,s,e.data),e.reset()},e.reset=function(){e.data={criteriaLength:t.telemetry.NOT_AVAILABLE,resolution:t.telemetry.NOT_AVAILABLE,selectedIndex:t.telemetry.NOT_AVAILABLE,suggestionType:t.telemetry.NOT_AVAILABLE,totalMatchCount:t.telemetry.NOT_AVAILABLE,trigger:t.telemetry.NOT_AVAILABLE,visibleMatchCount:t.telemetry.NOT_AVAILABLE}},e.reset()}var t=e("swx-constants").COMMON,n=e("experience/settings"),r=e("swx-constants").KEYS,i=e("ui/telemetry/telemetryClient");return s}),define("ui/components/chat/suggestions/mentionSuggestion",["require","lodash-compat","ui/components/chat/suggestions/simpleWordSuggestion"],function(e){function s(e,t,n,r){this.participant=r,this.textarea={view:t,viewModel:e},this.searchPosition=n}var t=e("lodash-compat"),n=e("ui/components/chat/suggestions/simpleWordSuggestion"),r="MENTIONS",i="swx-suggestion-mention";return s.prototype.templateId=i,s.prototype.suggestionType=r,s.prototype.getReplacer=function(t){t.data.participantsCount=this.textarea.viewModel.conversationModel.participants().length;var n=this.participant.person;return"@"+(n.isAgent()?"("+n.displayName().replace(/(\(|\))/g,"")+")":n.id())},s.build=function(t,n,r,i){return new s(t,n,r,i)},t.assign(s.prototype,n.prototype),s}),define("ui/components/chat/suggestions/mentionSuggestionEngine",["require","lodash-compat","swx-constants","ui/components/chat/suggestions/mentionSuggestion","ui/modelHelpers/personHelper","swx-service-locator-instance","swx-utils-common"],function(e){function a(){var e=s.resolve(n.serviceLocator.FEATURE_FLAGS);this.isEnabled=e.isFeatureOn(n.featureFlags.MENTIONS_ENABLED),this.isEnabledForPeople=e.isFeatureOn(n.featureFlags.MENTIONS_PEOPLE_ENABLED),this.matchImplicitByContains=e.isFeatureOn(n.featureFlags.AGGRESSIVE_IMPLICT_MENTIONS_MATCHING)}function f(e,n){if(!e)return!1;var r=new RegExp(t.escapeRegExp(n),"i");return o.normalize(e).search(r)!==-1}var t=e("lodash-compat"),n=e("swx-constants").COMMON,r=e("ui/components/chat/suggestions/mentionSuggestion"),i=e("ui/modelHelpers/personHelper"),s=e("swx-service-locator-instance").default,o=e("swx-utils-common").stringUtils,u=4;return a.prototype.priority=1,a.prototype.filterParticipants=function(t,n,r){function a(e){return!i.isPstn(e.person)&&(o.anyWordStartsWith(e.person.displayName(),r)||o.anyWordStartsWith(e.person.id(),r))}function l(e){return!i.isPstn(e.person)&&(f(e.person.displayName(),r)||f(e.person.id(),r))}function c(e){return i.isAgent(e.person)}var s=n||this.matchImplicitByContains?l:a,u;return u=t.filter(s),this.isEnabledForPeople||(u=u.filter(c)),u.length>1&&u.sort(function(e,t){return e.person.displayName().toLowerCase().localeCompare(t.person.displayName().toLowerCase())}),u},a.prototype.getSuggestions=function(t,n){if(!t.conversationModel.isGroupConversation()||!this.isEnabled)return{isExplicit:!1,suggestions:[]};var i=t.getSelectionStart(),s=t.conversationModel.participants(),a=o.wordAt(t.messageBody(),i),f=a[0]==="@";f&&(a=a.substring(1));if(!f&&a.length<u)return{isExplicit:f,suggestions:[]};var l=this.filterParticipants(s,f,a);return l.length===1&&f&&a===l[0].person.id()&&(l=[]),{isExplicit:f,suggestions:l.map(function(e){return r.build(t,n,i,e)})}},a}),define("ui/viewModels/chat/suggestions/suggestionList",["require","exports","module","lodash-compat","swx-constants","ui/components/chat/suggestions/emoticonSuggestionEngine","utils/common/eventMixin","swx-constants","vendor/knockout","telemetry/chat/suggestionSelectedEvent","ui/components/chat/suggestions/mentionSuggestionEngine","utils/common/outsideClickHandler"],function(e,t){function p(){function p(n,r){var i=e.suggestions()[e.selectedIndex()];i.applySuggestion(t),t.data.selectedIndex=e.selectedIndex(),t.data.resolution=t.enums.getResolution(n),t.publish(),e.isVisible(!1),r.setBlurAndFocus()}function d(){t.data.resolution=t.enums.RESOLUTION.ESC,t.data.selectedIndex=e.selectedIndex(),t.publish(),e.isVisible(!1)}function v(t){var n=e.selectedIndex()+t;e.selectedIndex()===-1&&(n=t===-1?e.suggestions().length-1:0),0<=n&&n<e.suggestions().length&&e.selectedIndex(n),e.dispatchEvent(o.suggestionList.ITEM_SELECTED,e.selectedIndex())}function m(){e.isVisible()&&(t.data.resolution=t.enums.RESOLUTION.CLICKOUT,t.data.selectedIndex=e.selectedIndex(),t.publish(),e.isVisible(!1))}function g(i){s=i.viewModel;var o=r.map(function(e){return e.getSuggestions(i.viewModel,i.view)}),u=n.some(o,function(e){return e.isExplicit});t.data.trigger=u?t.enums.TRIGGER.EXPLICIT:t.enums.TRIGGER.IMPLICIT,o=o.reduce(function(e,t){return t.isExplicit===u?e.concat(t.suggestions):e},[]),t.data.totalMatchCount=o.length,o=n.take(o,h),t.data.visibleMatchCount=o.length;var a=e.isVisible();e.suggestions(o),e.isVisible(o.length!==0),e.selectedIndex()>=o.length?e.selectedIndex(o.length-1):(!a||e.selectedIndex()===-1)&&e.selectedIndex(u?0:-1),a&&!e.isVisible()&&(t.data.resolution=t.enums.RESOLUTION.MISSMATCH,t.data.selectedIndex=e.selectedIndex(),t.publish())}function y(t){var n=t.event.keyCode||t.event.which;if(!e.isVisible())return;var r=!0;switch(n){case u.ESCAPE:d();break;case u.UP:case u.DOWN:v(n===u.UP?-1:1);break;case u.ENTER:case u.TAB:e.selectedIndex()!==-1?p(n,t.viewModel):r=!1;break;default:r=!1}r&&t.event.stopImmediatePropagation()}var e=this,t,r,s;e.isVisible=a.observable(!1),e.selectedIndex=a.observable(0),e.suggestions=a.observableArray([]),e.dispose=function(){c.remove("suggestionList")},e.init=function(u){t=u.suggestionSelectedTelemetryEvent||new f,r=u.suggestionEngines||[],r.length===0&&(r.push(new l),r.push(new i)),r=n.sortBy(r,"priority"),e.registerEvent(o.textarea.KEY_DOWN,y),e.registerEvent(o.textarea.INPUT,g),e.isVisible.subscribe(function(t){t?(c.add("suggestionList",m),e.dispatchEvent(o.suggestionList.SHOWN)):(c.remove("suggestionList"),e.dispatchEvent(o.suggestionList.HIDDEN))})},e.onSuggestionClick=function(r){r.applySuggestion(t);var i=e.suggestions().indexOf(r);t.data.selectedIndex=i,t.data.resolution=t.enums.RESOLUTION.CLICKIN,t.publish(),e.selectedIndex(i),e.isVisible(!1),s&&s.setBlurAndFocus()},e.onSuggestionMouseOver=function(n){var r=e.suggestions().indexOf(n);e.selectedIndex(r)}}var n=e("lodash-compat"),r=e("swx-constants").COMMON,i=e("ui/components/chat/suggestions/emoticonSuggestionEngine"),s=e("utils/common/eventMixin"),o=r.events,u=e("swx-constants").KEYS,a=e("vendor/knockout"),f=e("telemetry/chat/suggestionSelectedEvent"),l=e("ui/components/chat/suggestions/mentionSuggestionEngine"),c=e("utils/common/outsideClickHandler"),h=8;n.assign(p.prototype,s),t.build=function(){return new p}}),define("text!views/chat/suggestions/suggestionList.html",[],function(){return'<div class="suggestionList" data-bind="visible: isVisible" >\r\n    <ul class="list" data-bind="attr: {\'aria-expanded\': isVisible}, foreach: { data: suggestions, as: \'suggestion\' }" id="suggestionList" role="listbox">\r\n        <li class="item" tabindex="-1" role="option" data-bind="event: { mouseover: $parent.onSuggestionMouseOver, click: $parent.onSuggestionClick },\r\n                                    css: { selected: $index() === $parent.selectedIndex() },\r\n                                    attr: { id: \'suggestionList-item-\'+$index() },\r\n                                    template: { name: suggestion.templateId, data: { isSelected: $index() === $parent.selectedIndex(), data: suggestion } }"></li>\r\n    </ul>\r\n</div>\r\n\r\n<script type="text/html" id="swx-suggestion-mention">\r\n    <span class="mention" data-type="mention">\r\n        <swx-avatar params="avatar: data.participant.person.avatarUrl(), displayName: data.participant.person.displayName(), size:36"></swx-avatar>\r\n        <span class="participantName" data-bind="html: \'@\' + data.participant.person.displayName()"></span>\r\n    </span>\r\n</script>\r\n\r\n<script type="text/html" id="swx-suggestion-emoticon">\r\n    <span class="emoticonSuggestion largeAllowed" data-type="emoticon" data-bind="attr: { \'aria-label\': data.emoticon.description }" >\r\n        <span class="emoticon large" data-bind="css: data.emoticon.id + (isSelected ? \' animated\' : \'\')"><span class="emoSprite" data-bind="text: data.emoticon.shortcuts[0]"></span><canvas data-bind="attr: { \'data-item-id\': data.emoticon.id, \'data-is-animated\': isSelected }"></canvas></span>\r\n        <span class="description" data-bind="html: data.emoticon.description"></span>\r\n    </span>\r\n</script>\r\n'}),define("ui/components/chat/suggestions/suggestionList",["require","vendor/knockout","constants/components","ui/viewModels/chat/suggestions/suggestionList","text!views/chat/suggestions/suggestionList.html"],function(e){var t=e("vendor/knockout"),n=e("constants/components").chat.SUGGESTION_LIST,r=e("ui/viewModels/chat/suggestions/suggestionList"),i=e("text!views/chat/suggestions/suggestionList.html");return{name:n,template:i,viewModel:{createViewModel:function(n,i){var s=r.build();return s.init(n),s.setContext(t.dataFor(i.element)),s}}}}),define("ui/viewModels/chat/videoPlayer",["require","exports","module","lodash-compat","browser/dom","browser/document","utils/common/eventMixin","swx-constants","vendor/knockout","swx-i18n","telemetry/chat/videoMessagePlayback","ui/players/mediaPlayerController"],function(e,t){function c(e,t){function T(e){function r(e){return e.toString().length===1?"0"+e:e}var t=Math.round(e),n=0;return t>=y&&(n=parseInt(t/y),t-=n*y),r(n)+":"+r(t)}function N(e){n.currentProgress("width: "+e+"%")}function C(e){if(!e||!e.pageX)return;var t=h.offsetWidth,n=h.getBoundingClientRect().left,r=e.pageX-n;c.currentTime=c.duration*(r/t),N(r/t*100)}function k(){s.requestFullscreen?s.requestFullscreen():s.mozRequestFullScreen?s.mozRequestFullScreen():s.webkitRequestFullScreen?s.webkitRequestFullScreen():s.msRequestFullScreen&&s.msRequestFullScreen()}function L(){i.exitFullscreen?i.exitFullscreen():i.mozCancelFullScreen?i.mozCancelFullScreen():i.webkitExitFullscreen?i.webkitExitFullscreen():i.msExitFullscreen&&i.msExitFullscreen()}function A(){d||(d=!0,f.sendSeekAction())}function O(){v||(v=!0,f.sendFullscreenAction())}function M(e){var t=new Image;t.onload=function(){n.thumbnail(e)},t.src=e}var n=this,s=r.getElement(".VideoPlayer",e),c=r.getElement(".VideoPlayer-player",e),h=r.getElement(".VideoPlayer-timeline",e),p=!1,d=!1,v=!1,m=u.observable(0),g=u.observable(0),y=60,b=a.fetch({key:"swift_videocard_control_button_mute"}),w=a.fetch({key:"swift_videocard_control_button_unmute"}),E,S=!1,x=!1;n.media=t.media,n.autoloop=t.autoloop||!1,n.autoplay=t.autoplay||!1,n.id=t.messageId,n.conversationId=t.conversationId,n.title=t.title||!1,n.subtitle=t.subtitle||!1,n.showLoadingInfo=t.showLoadingInfo||!1,n.mediaType=o.chat.messageType.VIDEO,n.displayCurrentTime=t.displayCurrentTime,n.displayTotalTime=t.displayTotalTime,n.displayMuteButton=t.displayMuteButton,c&&(c.muted=t.muted),n.isPlaying=u.observable(!1),n.isInFullscreen=u.observable(!1),n.isMuted=u.observable(t.muted),n.thumbnail=u.observable(""),t.thumbnail&&M(t.thumbnail),n.isFullscreenSupported=s.requestFullscreen||s.mozRequestFullScreen||s.webkitRequestFullScreen||s.msRequestFullScreen,n.currentProgress=u.observable("0"),n.canPlay=u.observable(!1),n.isLoading=u.observable(!0),n.failed=u.observable(!1),n.currentTime=u.pureComputed(function(){return T(m())}),n.totalTime=u.pureComputed(function(){return T(g())}),n.playButtonText=u.pureComputed(function(){return n.isPlaying()?a.fetch({key:"mediaPlayer_pause"}):a.fetch({key:"mediaPlayer_play"})}),n.mute=function(e){c&&(c.muted=e,n.isMuted(e))},n.toggleMute=function(e){e&&e.touched&&(x=!0),n.isMuted()?n.mute(!1):n.mute(!0)},n.toggleMuteText=function(){return n.isMuted()?w:b},n.fullscreenButtonText=u.pureComputed(function(){return n.isInFullscreen()?a.fetch({key:"videoPlayer_exitFullscreen"}):a.fetch({key:"videoPlayer_fullscreen"})}),n.onError=function(){n.canPlay(!1),n.isLoading(!1),n.failed(!0)},n.onReady=function(){n.canPlay(!0),n.isLoading(!1)},n.onMetadataLoaded=function(){p=!0,E&&E(),m(c.currentTime),g(c.duration),f.sendLoadedEvent()},n.onTimeUpdated=function(){m(c.currentTime),N(m()/g()*100)},n.onVideoEnded=function(){x=!1,n.isPlaying(!1)},n.play=function(){S=!p,p?(c.play(),n.isPlaying(!0),E=null):E=n.play.bind(n)},n.pause=function(){S=!1,x=!1,p?(c.pause(),n.isPlaying(!1),E=null):E=n.pause.bind(n)},n.togglePlay=function(e){c.ended&&f.sendReplayAction(),c.paused||c.ended?(l.pauseAllInConversation(n.conversationId),n.play(),n.mute(!1),e&&e.touched&&(x=!0)):n.pause()},n.toggleFullscreen=function(e){e&&e.touched&&(x=n.isPlaying()),n.isInFullscreen()?(L(),n.dispatchEvent(o.events.videoPlayer.FULLSCREEN_OFF,null,n.DIRECTION.PARENT)):(k(),l.onEnteringFullscreen(n.id),n.dispatchEvent(o.events.videoPlayer.FULLSCREEN_ON,null,n.DIRECTION.PARENT),O())},n.onTimelineClick=function(e,t){x=n.isPlaying(),C(t),A()},n.onHandleStartDrag=function(e,t){function n(){i.removeEventListener("mousemove",C),i.removeEventListener("mouseup",n)}C(t),i.addEventListener("mousemove",C),i.addEventListener("mouseup",n),A()},n.isQueuedForPlaying=function(){return S},n.triggeredByUser=function(){return x},n.init=function(){l.registerPlayer(n)},n.dispose=function(){n.currentTime.dispose(),n.totalTime.dispose(),n.playButtonText.dispose(),n.fullscreenButtonText.dispose(),l.removePlayer(n.id)}}var n=e("lodash-compat"),r=e("browser/dom"),i=e("browser/document"),s=e("utils/common/eventMixin"),o=e("swx-constants").COMMON,u=e("vendor/knockout"),a=e("swx-i18n").localization,f=e("telemetry/chat/videoMessagePlayback"),l=e("ui/players/mediaPlayerController");t.build=function(e,t){return new c(e,t)},n.assign(c.prototype,s)}),define("text!views/chat/videoPlayer.html",[],function(){return'<div class="VideoPlayer">\r\n\r\n    <div class="VideoPlayer-fullsreenInfo" data-bind="visible: isInFullscreen">\r\n        <!-- ko if: title -->\r\n        <h1 data-bind="text: title, attr: { title: title }"></h1>\r\n        <!-- /ko -->\r\n        <!-- ko if: subtitle -->\r\n        <h2 data-bind="text: subtitle, attr: { title: subtitle }"></h2>\r\n        <!-- /ko -->\r\n    </div>\r\n\r\n    <!-- ko if: showLoadingInfo -->\r\n    <div class="VideoPlayer-loadingIndicator" data-bind="visible: isLoading()">\r\n        <swx-loading-animation class="spinner fog"></swx-loading-animation>\r\n    </div>\r\n    <div class="VideoPlayer-error" data-bind="visible: failed()">\r\n        <span class="iconfont warning"></span>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <div class="VideoPlayer-controlsOverlay" data-bind="click: togglePlay.bind(this, {touched: true})"></div>\r\n\r\n    <video class="VideoPlayer-player" data-bind="attr: { src: media, poster: thumbnail, loop: autoloop}, click: togglePlay,\r\n            event: {canplay: onReady, error: onError, loadedmetadata: onMetadataLoaded, timeupdate: onTimeUpdated, ended: onVideoEnded}">\r\n    </video>\r\n\r\n    <div class="VideoPlayer-controls" data-bind="visible: canPlay">\r\n\r\n        <button data-bind="click: togglePlay.bind(this, {touched: true}), attr: {title: playButtonText }"\r\n                class="VideoPlayer-button VideoPlayer-togglePlay btn circle" type="button">\r\n            <span class="iconfont play" data-bind="css: { pause: isPlaying() }, text: playButtonText"></span>\r\n        </button>\r\n\r\n        <!-- ko if: displayCurrentTime -->\r\n        <div class="VideoPlayer-currentTime" data-bind="text: currentTime"></div>\r\n        <!-- /ko  -->\r\n\r\n        <div class="VideoPlayer-timeline" data-bind="click: onTimelineClick.bind(this, {touched: true})">\r\n            <div class="VideoPlayer-totalProgress"></div>\r\n            <div class="VideoPlayer-progress" data-bind="attr: {style: currentProgress}">\r\n                <div class="VideoPlayer-handle" data-bind="event: {mousedown: onHandleStartDrag}"></div>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- ko if: displayTotalTime -->\r\n        <div class="VideoPlayer-totalTime" data-bind="text: totalTime"></div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: displayMuteButton -->\r\n        <button data-bind="click: toggleMute.bind(this, {touched: true}), attr: {title: toggleMuteText() }"\r\n                class="VideoPlayer-button VideoPlayer-toggleFullscreen btn circle" type="button">\r\n            <span class="iconfont volume" data-bind="text: toggleMuteText(), css: { volumeOff: isMuted(), volumeMax: !isMuted() }"></span>\r\n        </button>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: isFullscreenSupported -->\r\n        <button data-bind="click: toggleFullscreen.bind(this, {touched: true}), attr: {title: fullscreenButtonText }"\r\n                class="VideoPlayer-button VideoPlayer-toggleFullscreen btn circle" type="button">\r\n            <span class="iconfont fullscreen" data-bind="css: { fullscreenOff: isInFullscreen() }, text: fullscreenButtonText"></span>\r\n        </button>\r\n        <!-- /ko -->\r\n\r\n    </div>\r\n</div>\r\n'}),define("ui/components/chat/videoPlayer",["require","exports","module","vendor/knockout","ui/viewModels/chat/videoPlayer","constants/components","text!views/chat/videoPlayer.html"],function(e,t){function i(e,t){var i=t.element,s=r.build(i,e),o=n.dataFor(i);return s.init(),s.setContext(o),s}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/videoPlayer");t.name=e("constants/components").chat.VIDEO_PLAYER,t.template=e("text!views/chat/videoPlayer.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/audioPlayer",["require","exports","module","lodash-compat","browser/dom","browser/document","utils/common/eventMixin","vendor/knockout","swx-i18n","swx-constants","ui/players/mediaPlayerController","telemetry/chat/audioMessagePlayback"],function(e,t){function c(e,t){function y(e){function r(e){return e.toString().length===1?"0"+e:e}var t=Math.round(e),n=0;return t>=v&&(n=parseInt(t/v),t-=n*v),r(n)+":"+r(t)}function b(e){n.currentProgress("width: "+e+"%")}function w(e){var t=c.offsetWidth,n=c.getBoundingClientRect().left,r=e.pageX-n;s.currentTime=s.duration*(r/t),b(r/t*100)}var n=this,s=r.getElement(".AudioPlayer-player",e),c=r.getElement(".AudioPlayer-timeline",e),h=!1,p=o.observable(0),d=o.observable(0),v=60,m,g;n.media=t.media,n.thumbnail=t.thumbnail,n.id=t.messageId,n.conversationId=t.conversationId,n.mediaType=a.chat.messageType.AUDIO,n.showLoadingInfo=t.showLoadingInfo||!1,n.isPlaying=o.observable(!1),n.currentProgress=o.observable("0"),n.canPlay=o.observable(!1),n.isLoading=o.observable(!0),n.failed=o.observable(!1),n.currentTime=o.pureComputed(function(){return y(p())}),n.totalTime=o.pureComputed(function(){return y(d())}),n.playButtonText=o.pureComputed(function(){return n.isPlaying()?u.fetch({key:"mediaPlayer_pause"}):u.fetch({key:"mediaPlayer_play"})}),n.onError=function(){n.canPlay(!1),n.isLoading(!1),n.failed(!0)},n.onReady=function(){n.canPlay(!0),n.isLoading(!1)},n.onMetadataLoaded=function(){h=!0,m&&m(),p(s.currentTime),d(s.duration)},n.onTimeUpdated=function(){p(s.currentTime),b(p()/d()*100)},n.onAudioEnded=function(){n.isPlaying(!1)},n.play=function(){g=!h,h?(s.play(),n.isPlaying(!0),m=null):m=n.play.bind(n)},n.pause=function(){g=!1,h?(s.pause(),n.isPlaying(!1),m=null):m=n.pause.bind(n)},n.togglePlay=function(){s.ended&&l.sendReplayAction(),s.paused||s.ended?(f.pauseAllInConversation(n.conversationId),n.play()):n.pause()},n.onTimelineClick=function(e,t){w(t)},n.onHandleStartDrag=function(e,t){function n(){i.removeEventListener("mousemove",w),i.removeEventListener("mouseup",n)}w(t),i.addEventListener("mousemove",w),i.addEventListener("mouseup",n)},n.isQueuedForPlaying=function(){return g},n.init=function(){f.registerPlayer(n)},n.dispose=function(){n.currentTime.dispose(),n.totalTime.dispose(),n.playButtonText.dispose()}}var n=e("lodash-compat"),r=e("browser/dom"),i=e("browser/document"),s=e("utils/common/eventMixin"),o=e("vendor/knockout"),u=e("swx-i18n").localization,a=e("swx-constants").COMMON,f=e("ui/players/mediaPlayerController"),l=e("telemetry/chat/audioMessagePlayback");t.build=function(e,t){return new c(e,t)},n.assign(c.prototype,s)}),define("text!views/chat/audioPlayer.html",[],function(){return'<div class="AudioPlayer">\r\n\r\n    <!-- ko if: showLoadingInfo -->\r\n    <div class="AudioPlayer-loadingIndicator" data-bind="visible: isLoading()">\r\n        <swx-loading-animation class="spinner fog"></swx-loading-animation>\r\n    </div>\r\n    <div class="AudioPlayer-error" data-bind="visible: failed()">\r\n        <span class="iconfont warning"></span>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <div class="AudioPlayer-controlsOverlay" data-bind="click: togglePlay"></div>\r\n\r\n    <audio class="AudioPlayer-player" data-bind="attr: { src: media, poster: thumbnail }, click: togglePlay,\r\n            event: {canplay: onReady, error: onError, loadedmetadata: onMetadataLoaded, timeupdate: onTimeUpdated, ended: onAudioEnded}"></audio>\r\n\r\n    <div class="AudioPlayer-controls" data-bind="visible: canPlay">\r\n\r\n        <button data-bind="click: togglePlay, attr: {title: playButtonText }"\r\n                class="AudioPlayer-button AudioPlayer-togglePlay btn circle" type="button">\r\n            <span class="iconfont play" data-bind="css: { pause: isPlaying() }, text: playButtonText"></span>\r\n        </button>\r\n\r\n        <div class="AudioPlayer-timeline" data-bind="click: onTimelineClick">\r\n            <div class="AudioPlayer-timers">\r\n                <div class="AudioPlayer-currentTime" data-bind="text: currentTime"></div>\r\n                <div class="AudioPlayer-totalTime" data-bind="text: totalTime"></div>\r\n            </div>\r\n            <div class="AudioPlayer-totalProgress"></div>\r\n\r\n            <div class="AudioPlayer-progress" data-bind="attr: {style: currentProgress}">\r\n                <div class="AudioPlayer-handle" data-bind="event: {mousedown: onHandleStartDrag}"></div>\r\n            </div>\r\n\r\n        </div>\r\n\r\n    </div>\r\n</div>\r\n'}),define("ui/components/chat/audioPlayer",["require","exports","module","vendor/knockout","ui/viewModels/chat/audioPlayer","constants/components","text!views/chat/audioPlayer.html"],function(e,t){function i(e,t){var i=t.element,s=r.build(i,e),o=n.dataFor(i);return s.init(),s.setContext(o),s}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/audioPlayer");t.name=e("constants/components").chat.AUDIO_PLAYER,t.template=e("text!views/chat/audioPlayer.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/gifPlayer",["require","exports","module","lodash-compat","utils/common/eventMixin","vendor/knockout"],function(e,t){function s(e){var t=this;t.media=e.media&&e.media.url?e.media:null,t.canPlay=i.observable(!1),t.isLoading=i.observable(!0),t.failed=i.observable(!1);if(t.media){var n=new Image;n.onload=function(){t.canPlay(!0),t.isLoading(!1)},n.onerror=function(){t.canPlay(!1),t.isLoading(!1),t.failed(!0)},n.src=t.media.url}}var n=e("lodash-compat"),r=e("utils/common/eventMixin"),i=e("vendor/knockout");t.build=function(e,t){return new s(e,t)},n.assign(s.prototype,r)}),define("text!views/chat/gifPlayer.html",[],function(){return'<div class="GifPlayer">\r\n    <div class="loadingIndicator" data-bind="visible: isLoading()">\r\n        <swx-loading-animation class="spinner fog"></swx-loading-animation>\r\n    </div>\r\n    <div class="error" data-bind="visible: failed()">\r\n        <span class="iconfont warning"></span>\r\n    </div>\r\n\r\n    <!-- ko if: media -->\r\n    <img data-bind="visible: canPlay(),\r\n            attr: { src: media.url,\r\n                alt: media.alt,\r\n                width: media.uiSize().width,\r\n                height: media.uiSize().height\r\n            }, style: { left: media.leftAlignment(),\r\n                bottom: media.bottomAlignment(),\r\n                right: media.rightAlignment()\r\n            }" />\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("ui/components/chat/gifPlayer",["require","exports","module","ui/viewModels/chat/gifPlayer","constants/components","text!views/chat/gifPlayer.html"],function(e,t){function r(e){var t=n.build(e);return t}var n=e("ui/viewModels/chat/gifPlayer");t.name=e("constants/components").chat.GIFPLAYER,t.template=e("text!views/chat/gifPlayer.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/chat/userListPopup",["require","exports","module","utils/common/eventMixin","swx-constants","swx-utils-common","browser/document","browser/dom","vendor/knockout","lodash-compat","utils/common/scroll","utils/common/outsideClickHandler"],function(e,t){function c(e,t){function d(e){n.hidden()&&a(e)&&(e.eventPageY/s.body.clientHeight>.5?p(!0):p(!1),v())}function v(){n.hidden(!1),i.execute(function(){l.add("UserListPopup",m)})}function m(){n.hidden(!0),l.remove("UserListPopup")}var n=this,a=e.isSelfPopup()||function(){return!0},c=o.getElement(".UserListPopup-scrollingContainer",t),h,p;n.title=e.title,n.users=e.users,n.hidden=u.observable(!0),p=u.observable(),n.userListPopupCss=u.computed(function(){var e={UserListPopup:!0,popup:!0,arrow:!0,down:p(),up:!p(),"fontSize-p":!0};return e}),n.init=function(){t.addEventListener("contextmenu",function(e){e.stopPropagation()}),n.registerEvent(r.events.userListPopup.POPUP_TOGGLE,d),h=f.build(c),h.init()},n.dispose=function(){h.dispose(),n.userListPopupCss.dispose()}}var n=e("utils/common/eventMixin"),r=e("swx-constants").COMMON,i=e("swx-utils-common").async,s=e("browser/document"),o=e("browser/dom"),u=e("vendor/knockout"),a=e("lodash-compat"),f=e("utils/common/scroll"),l=e("utils/common/outsideClickHandler");t.build=function(e,t){return new c(e,t)},a.assign(c.prototype,n)}),define("text!views/chat/userListPopup.html",[],function(){return'<div data-bind="css: userListPopupCss, visible: !hidden()">\r\n    <h3 class="UserListPopup-title" data-bind="text: title"></h3>\r\n    <div class="UserListPopup-scrollingContainer">\r\n        <ul class="UserListPopup-usersContainer scrollViewport scrollViewportV" data-bind="foreach: users" tabindex="-1">\r\n            <li class="UserListPopup-user list-selectable">\r\n                <!-- ko if: person -->\r\n                <swx-avatar params="avatar: person.avatarUrl(), status: contact.statusClassName, displayName: displayName"></swx-avatar>\r\n                <!-- /ko -->\r\n                <!-- ko ifnot: person -->\r\n                <swx-avatar params="isGroupAvatar: false"></swx-avatar>\r\n                <!-- /ko -->\r\n                <div class="UserListPopup-info">\r\n                    <span class="UserListPopup-displayName" data-bind="text: displayName"></span>\r\n                    <!-- ko if: (person && contact.displayMessage) -->\r\n                    <span class="UserListPopup-status" data-bind="text: contact.displayMessage"></span>\r\n                    <!-- /ko -->\r\n                    <!-- ko ifnot: (person && contact.displayMessage) -->\r\n                    <span class="UserListPopup-status" data-bind="l10n: { key: \'message_text_presenceUnknown\' }"></span>\r\n                    <!-- /ko -->\r\n                </div>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/chat/userListPopup",["require","exports","module","ui/viewModels/chat/userListPopup","constants/components","text!views/chat/userListPopup.html"],function(e,t){function r(e,t){var r=n.build(e,t.element);return r.setContext(e.eventContext),r.init(),r}var n=e("ui/viewModels/chat/userListPopup");t.name=e("constants/components").chat.USER_LIST_POPUP,t.template=e("text!views/chat/userListPopup.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/chat/translator/translatorSettings",["require","exports","module","swx-cafe-application-instance","browser/dom","browser/document","swx-i18n","vendor/knockout","utils/common/eventHelper","utils/common/cafeObservable","experience/settings","swx-constants","telemetry/translator/translatorTelemetry","utils/common/outsideClickHandler"],function(e,t){function d(e){function N(){t.dialogOpened(!0),p.add(w,C),i.body.addEventListener("focus",k,!0),i.body.addEventListener("keydown",L,!0)}function C(){t.dialogOpened(!1),p.remove(w),i.body.removeEventListener("focus",k,!0),i.body.removeEventListener("keydown",L,!0)}function k(e){var t=!!r.getParentWithClass(e.target,w)||!!r.getParentWithClass(e.relatedTarget,w)||!!r.getParentWithClass(e.explicitOriginalTarget,w);t||C()}function L(e){u.isDeactivation(e)&&(C(),T.send(c.eventType.SETTINGS_HIDE,{initiator:c.initiator.ESCAPE_KEY}))}function A(){return l._translatorSettings&&l._translatorSettings.meLanguage||y||b}function O(){return l._translatorSettings&&l._translatorSettings.participantLanguage||b}function M(e){t.translatorEnabled(!0),l._translatorSettings.meLanguage=e,T.send(c.eventType.ME_LANGUAGE_CHANGED,{language:e.code,settingsInitParamsLocale:f.initParams.locale})}function _(e){t.translatorEnabled(!0),l._translatorSettings.participantLanguage=e,T.send(c.eventType.PARTICIPANT_LANGUAGE_CHANGED,{selectedLanguage:e.code})}function D(){l._translatorSettings.meLanguage=null,l._translatorSettings.participantLanguage=null}function P(){l._translatorSettings.meLanguage=t.meLanguage(),l._translatorSettings.participantLanguage=t.participantLanguage()}function H(e){l._translatorSettings&&(l._translatorSettings.isEnabled=e,e?P():D())}function B(){return f.initParams.locale.replace(/-\w+/,"").toLowerCase()}function j(){n.get().translatorService.supportedLanguages().forEach(function(e){var n={name:e.name(),code:e.code()};n.code===g&&(y=n),n.code==="en"&&(b=n),t.availableLanguages.push(n)})}var t=this,l=e.conversationModel,d=n.get().personsAndGroupsManager.mePerson,v=s.fetch({key:"label_translator_translatorOn"}),m=s.fetch({key:"label_translator_translatorOff"}),g,y,b={name:"English",code:"en"},w="TranslatorSettings",E,S,x,T=h.build();t.init=function(){t.availableLanguages=o.observableArray(),g=B(),j(),t.translatorEnabled=o.observable(!1),t.participantAvatar=a.newObservableProperty(l.participants()[0].person.avatarUrl),t.participantDisplayName=a.newObservableProperty(l.participants()[0].person.displayName),t.participantLanguage=o.observable(O()),t.meAvatar=a.newObservableProperty(d.avatarUrl),t.meDisplayName=a.newObservableProperty(d.displayName),t.meLanguage=o.observable(A()),t.dialogOpened=o.observable(!1),t.settingsButtonLabel=s.fetch({key:"button_translator_translatorSettings"}),t.settingsButtonAriaLabel=o.computed(function(){return t.translatorEnabled()?t.settingsButtonLabel+". "+s.fetch({key:"button_translator_translatorSettingsOn"}):t.settingsButtonLabel+". "+s.fetch({key:"button_translator_translatorSettingsOff"})}),t.settingsDialogLabel=s.fetch({key:"label_translator_translatorSettings"}),t.meLanguagePickerLabel=o.computed(function(){return s.fetch({key:"label_translator_selected_myLanguage",params:{language:t.meLanguage().name}})}),t.theirLanguagePickerLabel=o.computed(function(){return s.fetch({key:"label_translator_selected_theirLanguage",params:{name:t.participantDisplayName(),language:t.participantLanguage().name}})}),E=t.translatorEnabled.subscribe(H),S=t.participantLanguage.subscribe(_),x=t.meLanguage.subscribe(M),t.translatorToggleText=o.computed(function(){return t.translatorEnabled()?v:m}),t.translatorEnabledHandler=function(){var e=t.translatorEnabled();t.translatorEnabled(!t.translatorEnabled()),e||T.send(c.eventType.SETTINGS_BUTTON_ENABLED,{meLanguage:t.meLanguage().code,participantLanguage:t.participantLanguage().code})},t.onTranslatorEnabledKeyDown=function(e,n){var r=u.isActivation(n);return r&&t.translatorEnabledHandler(),!r},t.settingsButtonHandler=function(){t.dialogOpened()?(C(),T.send(c.eventType.SETTINGS_HIDE,{initiator:c.initiator.CLICK_GLOBE_BUTTON})):(N(),T.send(c.eventType.SETTINGS_SHOW))},l._translatorSettings?t.translatorEnabled(l._translatorSettings.isEnabled):l._translatorSettings={meLanguage:t.meLanguage(),participantLanguage:t.participantLanguage(),isEnabled:t.translatorEnabled()}},t.dispose=function(){t.dialogOpened()&&C(),t.participantAvatar.dispose(),t.participantDisplayName.dispose(),t.meAvatar.dispose(),t.meDisplayName.dispose(),t.translatorToggleText.dispose(),t.meLanguagePickerLabel.dispose(),t.theirLanguagePickerLabel.dispose(),t.settingsButtonAriaLabel.dispose(),S.dispose(),x.dispose(),E.dispose()}}var n=e("swx-cafe-application-instance"),r=e("browser/dom"),i=e("browser/document"),s=e("swx-i18n").localization,o=e("vendor/knockout"),u=e("utils/common/eventHelper"),a=e("utils/common/cafeObservable"),f=e("experience/settings"),l=e("swx-constants").COMMON,c=l.telemetry.translator,h=e("telemetry/translator/translatorTelemetry"),p=e("utils/common/outsideClickHandler");t.build=function(e){return new d(e)}}),define("text!views/chat/translator/translatorSettings.html",[],function(){return'<div class="TranslatorSettings">\r\n    <button class="settingsButton btn transparent circle" data-bind="click: settingsButtonHandler, attr: {\'aria-label\': settingsButtonAriaLabel, title: settingsButtonLabel}, css: {off: !translatorEnabled()}" type="button">\r\n        <span id="settingsButtonLabelId" class="iconfont globe" data-bind="text: settingsButtonLabel"></span>\r\n    </button>\r\n    <!-- ko if: dialogOpened -->\r\n    <div class="SettingsDialog popup arrow up">\r\n        <h4 class="header" data-bind="text: settingsDialogLabel"></h4>\r\n\r\n        <div class="Splitter"></div>\r\n\r\n        <div class="SettingsDialog-toggle">\r\n            <span id="enableTranslator" class="fontSize-p" data-bind="text: translatorToggleText"></span>\r\n            <button aria-labelledby="settingsButtonLabelId" class="toggler" type="button" role="checkbox" aria-relevant="all"\r\n                    data-bind="click: translatorEnabledHandler, event: { keydown: onTranslatorEnabledKeyDown }, css: { checked: translatorEnabled }, attr: { \'aria-checked\': translatorEnabled() ? \'true\' : \'false\', \'aria-label\': settingsButtonLabel}">\r\n                <span class="on"></span>\r\n                <span class="off"></span>\r\n            </button>\r\n        </div>\r\n\r\n        <div class="Splitter"></div>\r\n\r\n        <div class="SettingsDialog-lang">\r\n            <swx-avatar params="avatar: meAvatar, displayName: meDisplayName, useAbsolutePosition: true"></swx-avatar>\r\n            <div class="text" >\r\n                <p data-bind="text: meDisplayName" class="displayName"></p>\r\n                <swx-translator-language-picker params="language: meLanguage, supportedLanguages: availableLanguages, class: \'LanguagePicker-mine\', ariaLabel: meLanguagePickerLabel"></swx-translator-language-picker>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="SettingsDialog-icons">\r\n            <div class="Splitter lang"></div>\r\n            <div class="iconsGroup">\r\n                <div class="chat"><span class="iconfont message"></span></div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="SettingsDialog-lang bottom">\r\n            <swx-avatar params="avatar: participantAvatar, displayName: participantDisplayName, useAbsolutePosition: true"></swx-avatar>\r\n            <div class="text">\r\n                <p data-bind="text: participantDisplayName" class="displayName"></p>\r\n                <swx-translator-language-picker params="language: participantLanguage, supportedLanguages: availableLanguages, class: \'LanguagePicker-their\', ariaLabel: theirLanguagePickerLabel"></swx-translator-language-picker>\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("ui/components/chat/translatorSettings",["require","exports","module","ui/viewModels/chat/translator/translatorSettings","constants/components","text!views/chat/translator/translatorSettings.html"],function(e,t){function r(e){var t=n.build(e);return t.init(),t}var n=e("ui/viewModels/chat/translator/translatorSettings");t.name=e("constants/components").chat.TRANSLATOR_SETTINGS,t.template=e("text!views/chat/translator/translatorSettings.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/chat/translator/translatorLanguagePicker",["require","exports","module","browser/dom","vendor/knockout","utils/common/eventHelper","utils/common/scroll","utils/common/outsideClickHandler","swx-focus-handler"],function(e,t){function a(e,t){function p(e,t){return e.name.localeCompare(t.name)}function d(){a.menuOpened(!0),o.add(h,v),m()}function v(){a.menuOpened(!1),o.remove(h),g()}function m(){var e=n.getElement(".LanguagePicker-item.selected",t);e&&e.scrollIntoView()}function g(){var e=n.getElement(".LanguagePicker-button",t);e&&u.get().addFocusRequestToQueue(e)}var a=this,f=e.language,l=e.supportedLanguages.sort(p),c,h=e.class;a.init=function(){a.language=f,a.menuOpened=r.observable(!1),a.supportedLanguages=l,c=s.build(n.getElement("div.LanguagePicker-content",t)),c.init(),a.pickerClass={},a.pickerClass[e.class]=!0,a.languageButtonLabel=e.ariaLabel,a.languageButtonHandler=function(){a.menuOpened()?v():d()},a.onLanguageButtonKeyDown=function(e,t){var n=i.isActivation(t);return n&&a.languageButtonHandler(),!n},a.languageSelectionHandler=function(e){f(e),v()}},a.dispose=function(){a.menuOpened()&&v(),c.dispose()}}var n=e("browser/dom"),r=e("vendor/knockout"),i=e("utils/common/eventHelper"),s=e("utils/common/scroll"),o=e("utils/common/outsideClickHandler"),u=e("swx-focus-handler");t.build=function(e,t){return new a(e,t)}}),define("text!views/chat/translator/translatorLanguagePicker.html",[],function(){return'<div class="LanguagePicker" data-bind="css:pickerClass">\r\n    <div class="fontSize-p">\r\n        <a href="#" role="button" class="LanguagePicker-button" data-bind="text: language().name, click: languageButtonHandler, event: { keydown: onLanguageButtonKeyDown }, attr:{\'aria-label\' : languageButtonLabel}"></a>\r\n        <span class="iconfont chevronDown" data-bind="click: languageButtonHandler"></span>\r\n    </div>\r\n\r\n    <div class="LanguagePicker-menu popup arrow up" data-bind="css: {hide: !menuOpened()}">\r\n        <div class="LanguagePicker-content" data-bind="keyboardNavigation: { itemSelector: \'.LanguagePicker-item\' }">\r\n            <div class="scrollViewport scrollViewportV" tabindex="-1">\r\n                <ul role="menu">\r\n                    <li><div class="icons"><span class="iconfont message"></span></div></li>\r\n                    <!-- ko foreach: { data: supportedLanguages, as: \'item\' } -->\r\n                    <li role="menuitem"><span class="LanguagePicker-item fontSize-p" data-bind="text: item.name, click: $parent.languageSelectionHandler, enterKey: $parent.languageSelectionHandler, css:{selected: $parent.language().name === item.name}, attr:{\'aria-label\' : item.name}"></span></li>\r\n                    <!-- /ko -->\r\n                </ul>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/chat/translatorLanguagePicker",["require","exports","module","ui/viewModels/chat/translator/translatorLanguagePicker","constants/components","text!views/chat/translator/translatorLanguagePicker.html"],function(e,t){function r(e,t){var r=t.element,i=n.build(e,r);return i.init(),i}var n=e("ui/viewModels/chat/translator/translatorLanguagePicker");t.name=e("constants/components").chat.TRANSLATOR_LANGUAGE_PICKER,t.template=e("text!views/chat/translator/translatorLanguagePicker.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/chat/moreActionsButton",["require","exports","module","lodash-compat","vendor/knockout","swx-constants","utils/common/eventMixin","swx-i18n","ui/contextMenu/items/all","swx-service-locator-instance","ui/telemetry/actions/actionNames"],function(e,t){function l(e){function n(){var e=a.resolve(i.serviceLocator.ACTION_TELEMETRY);e.recordAction(f.conversation.moreActionsButton)}var t=this;t.cssClass=e.cssClass,t.tabIndex=e.tabIndex,t.title=o.fetch({key:"button_text_moreActions"}),t.showMenuOptions=r.observable(!1),t.hasMenuOptions=function(){return!0},t.getMenuOptions=function(){var t=[];return n(),t.push(u.AddParticipantsMenuItem.build(e.addParticipantsDisabled,e.addParticipantsAction)),t.push(u.ScheduleCallMenuItem.build(e.conversation)),t}}var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("swx-constants").COMMON,s=e("utils/common/eventMixin"),o=e("swx-i18n").localization,u=e("ui/contextMenu/items/all"),a=e("swx-service-locator-instance").default,f=e("ui/telemetry/actions/actionNames");n.assign(l.prototype,s),t.build=function(e){return new l(e)}}),define("text!views/chat/moreActionsButton.html",[],function(){return"<swx-button params=\"icon: 'more',\r\n    cssClass: cssClass,\r\n    titleKey: 'button_text_moreActions',\r\n    textKey: 'button_text_moreActions',\r\n    i18nTitle: title,\r\n    ariaLabelKey: 'button_text_moreActions',\r\n    showMenuOptions: showMenuOptions,\r\n    hasMenuOptions: hasMenuOptions,\r\n    menuOptions: getMenuOptions\"></swx-button>\r\n"}),define("ui/components/chat/moreActionsButton",["require","exports","module","vendor/knockout","ui/viewModels/chat/moreActionsButton","constants/components","text!views/chat/moreActionsButton.html"],function(e,t){function i(e,t){var i=r.build(e),s=n.dataFor(t.element);return i.setContext(s),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/moreActionsButton");t.name=e("constants/components").chat.MORE_ACTIONS_BUTTON,t.template=e("text!views/chat/moreActionsButton.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/heart",["require","exports","module","vendor/knockout","swx-i18n"],function(e,t){function i(e,t){function a(){u.forEach(function(e){t.element.addEventListener(e,c,!1)})}function f(){u.forEach(function(e){t.element.removeEventListener(e,c,!1)})}function l(){s.dispose(),h(!0),a()}function c(){h(!1),s=i.heartsCount.subscribe(l),f()}function h(e){var t={hasLikes:!!i.heartsCount(),hasMyLike:i.isHeartedByMe(),anim:!!e};i.heartCss(t)}var i=this,s,o=e.heartsVM,u=["webkitAnimationEnd","animationend","oanimationend"];i.onClickHandler=o.heartMessage,i.heartsCount=o.heartsCount,i.isHeartedByMe=o.isHeartedByMe,i.heartCss=n.observable({}),i.heartButtonLabel=n.computed(function(){return i.isHeartedByMe()?r.fetch({key:"hearts_accessibility_unlike"}):r.fetch({key:"hearts_accessibility_like"})}),i.dispose=function(){i.heartButtonLabel.dispose(),f(),s.dispose()},h(!1),s=o.heartsCount.subscribe(l)}var n=e("vendor/knockout"),r=e("swx-i18n").localization;t.build=function(e,t){return new i(e,t)}}),define("text!views/chat/heart.html",[],function(){return'<div class="Heart" data-bind="css: heartCss">\r\n    <span class="iconfont clickable" data-bind="click: onClickHandler, attr: {\'aria-label\': heartButtonLabel}" role="button"></span>\r\n    <!-- ko if: (heartsCount && heartsCount() > 1) -->\r\n    <span class="counter" data-bind="text: heartsCount"></span>\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("ui/components/chat/heart",["require","exports","module","ui/viewModels/chat/heart","constants/components","text!views/chat/heart.html"],function(e,t){function r(e,t){return n.build(e,t)}var n=e("ui/viewModels/chat/heart");t.name=e("constants/components").chat.HEART,t.template=e("text!views/chat/heart.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/chat/narrator",["require","lodash-compat","utils/common/accessibility","swx-constants","swx-i18n","swx-utils-common","swx-utils-common","swx-utils-chat","utils/common/disposableMixin","swx-utils-chat"],function(e){function c(){function s(){e.narrationLog().length>=l&&e.narrationLog.splice(0,e.narrationLog().length-(l-1)),e.narrationLog().forEach(function(e){e.visible(!1)})}function a(n){return t.any(e.narrationLog(),function(e){return e.key!=null&&e.key===n})}function c(n,r){var o,l;if(r&&a(r.key))return;s();switch(!0){case t.isFunction(n):o=n();break;case t.isObject(n)&&n.hasOwnProperty("key"):o=i.fetch(n);break;default:o=n.toString()}l=u.stripHTML(o),e.narrationLog.push({message:l,timestamp:f.getDate(),visible:e.observable(!0),key:r&&r.key})}var e=this;this.narrationLog=this.observableArray().extend({deferred:!0}),this.dispose=function(){},this.registerDisposable(n.on(r.events.browser.NARRATOR_ANNOUNCE,function(e,n){o.execute(t.partial(c,e,n),null,!1)}))}var t=e("lodash-compat"),n=e("utils/common/accessibility").narrator,r=e("swx-constants").COMMON,i=e("swx-i18n").localization,s=e("swx-utils-common").builderMixin,o=e("swx-utils-common").async,u=e("swx-utils-chat").messageSanitizer,a=e("utils/common/disposableMixin"),f=e("swx-utils-chat").dateTime,l=5;return t.extend(c.prototype,a),t.extend(c,s),c}),define("text!views/chat/narrator.html",[],function(){return'<div aria-live="assertive" role="log" class="offScreen">\r\n    <!-- ko foreach: narrationLog -->\r\n    <div>\r\n        <span data-bind="html: message, visible: visible"></span>\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("ui/components/chat/narrator",["require","exports","module","ui/viewModels/chat/narrator","constants/components","text!views/chat/narrator.html"],function(e,t){function r(){return n.build()}var n=e("ui/viewModels/chat/narrator");t.name=e("constants/components").chat.NARRATOR,t.template=e("text!views/chat/narrator.html"),t.viewModel={createViewModel:r}}),define("text!views/chat/pes/store/browseTabs.html",[],function(){return'<div class="overlayControls">\r\n    <h1  class="storeTitle" data-bind="l10n: { \'key\': \'expressionPicker_store_title\' }"></h1>\r\n    <input type="text" data-bind="\r\n        textInput: searchQuery,\r\n        event: {keydown: onSearchBoxKeyDown},\r\n        l10n_attr: {\r\n            \'placeholder\':  \'input_placeholder_searchPESStore\',\r\n            \'aria-label\':   \'input_placeholder_searchPESStore\'\r\n            }" value="" name="query" class="inputField fontSize-h4 store-search" placeholder="Search for items..." aria-label="Search items. Type keyword" data-focusmanager="3" style="">\r\n    <div class="storeSearchIcon"></div>\r\n    <div class="right">\r\n        <button class="btn narrow transparent" data-bind="click: close" type="button">\r\n            <span class="iconfont after cross pull3" data-bind="l10n: { \'key\': \'pluginInstall_main_text_close\' }"></span>\r\n        </button>\r\n    </div>\r\n</div>\r\n<div class="wrapper swx-pes-store">\r\n    <swx-loading-animation data-bind="visible: showSpinner()" class="spinner blue loading-data"></swx-loading-animation>\r\n    <p class="error" data-bind="visible: showErrorText()">Error Loading Tabs</p>\r\n    <div data-bind="visible: showTabList()" class="tabs-list">\r\n        <ul data-bind="template: { name: \'tab-item-template\', foreach: tabs, as: \'tab\'  }" class="scrollViewport scrollViewportV" tabindex="-1"></ul>\r\n    </div>\r\n    <div  class="tabs-details-wrapper" data-bind="visible: showTabDetails()">\r\n        <div  data-bind="template: { name: \'tab-details-template\', if: selectedTab(), data: selectedTab  }" class="scrollViewport scrollViewportV">\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<script type="text/html" id="tab-item-template">\r\n    <li class="store-tab-item" data-bind="attr: { \'data-name\': tab.id, \'title\': tab.name}, event: {click: $parent.tabSelected}, css: tab.isSelectedCSS, visible: tab.showInList()"\r\n        aria-live="polite" role="listitem">\r\n        <div class="tab-thumbnail" data-bind="style: {backgroundImage:\'url(\'+tab.thumbnail+\')\'}"></div>\r\n        <div class="buy-or-download" data-bind="template: { name: \'buy-download-tab-template\', data: tab }, event: {click: $parent.buyOrDownloadTab}"></div>\r\n        <p class="title"><span class="tab-name" data-bind="text: tab.name"></span></p>\r\n    </li>\r\n</script>\r\n\r\n<script type="text/html" id="tab-details-template">\r\n    <div class="store-tab-item-details">\r\n        <div class="buy-or-download" data-bind="template: { name: \'buy-download-tab-detailSection-template\'}, event: {click: $parent.buyOrDownloadTab}"></div>\r\n        <div class="tab-desc">\r\n            <div class="tab-title">\r\n                <h2 class="title" data-bind="text:name"></h2>\r\n                <p class="description" data-bind="text:description"></p>\r\n                <p class="description" data-bind="text:copyright"></p>\r\n            </div>\r\n        </div>\r\n        <div class="pack-items-list">\r\n           <div class="content" data-bind="template: { name: \'pack-items-listing-template\', data: {packs: configData().tabs[0].packs, token: cdnToken()}}"></div>\r\n        </div>\r\n    </div>\r\n</script>\r\n\r\n\r\n<script type="text/html" id="pack-items-listing-template">\r\n    <ul data-bind="foreach: { data: packs, as: \'pack\' }">\r\n        <li aria-live="polite" role="listitem">\r\n            <h4 class="pack-title" data-bind="text: pack.title"></h4>\r\n            <div class="pack-items" data-bind="visible: pack.items && pack.items.length, css: \'pack-\'+pack.id">\r\n                <ul data-bind="foreach: { data: pack.items, as: \'item\' }">\r\n                    <li class="item" data-bind="attr: {\'title\': item.pickerTitle}">\r\n                        <!-- ko if: item.type === \'emoticon\' -->\r\n                            <img class="item-thumbnail" data-bind="attr: {src: item.thumbnail}">\r\n                        <!-- /ko -->\r\n                        <!-- ko if: item.type === \'flik\' -->\r\n                            <div  class="moji-item" data-bind="template: { name: \'moji-item-template\', data:{item: item, token: $parents[1].token}}"></div>\r\n                        <!-- /ko -->\r\n                            <p class="item-title" data-bind="text: (item.pickerTitle) ? item.pickerTitle : item.title"></p>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n        </li>\r\n    </ul>\r\n</script>\r\n\r\n\r\n<script type="text/html" id="buy-download-tab-template">\r\n   <div class="buy-download-text" data-bind="visible: !showDownloadSpinner(), style: {cursor: isDownloaded() ? \'default\':\'pointer\'}">\r\n        <span data-bind="css: { tick: isDownloaded(), arrowDown: !isDownloaded() }, style: {backgroundColor: isDownloaded() ? \'#7FBA00\':\'#0078CA\'}" class="iconfont">\r\n        </span>\r\n    </div>\r\n    <div class="download-spinner" data-bind="visible: showDownloadSpinner()">\r\n        <swx-loading-animation class="spinner blue"></swx-loading-animation>\r\n    </div>\r\n    <p data-bind="visible: !isDownloaded(), l10n: { key: \'expressionPicker_store_free\' }"></p>\r\n</script>\r\n\r\n<script type="text/html" id="buy-download-tab-detailSection-template">\r\n   <div class="buy-download-text" data-bind="visible: !showDownloadSpinner()">\r\n        <span data-bind="css: { cross: isDownloaded(), arrowDown: !isDownloaded() }" class="iconfont">\r\n            <span data-bind="visible: !isDownloaded(), l10n: { key: \'expressionPicker_store_free\' }"></span>\r\n            <span data-bind="visible: isDownloaded(), l10n: { key: \'expressionPicker_store_removeTab\' }"></span>\r\n        </span>\r\n    </div>\r\n    <div class="download-spinner-wrapper" data-bind="visible: showDownloadSpinner()">\r\n        <div class="download-spinner">\r\n            <swx-loading-animation class="spinner white"></swx-loading-animation>\r\n        </div>\r\n        <p data-bind="l10n: { key: \'expressionPicker_store_Downloading\'}"></p>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="moji-item-template">\r\n    <img class="moji-item-thumbnail" data-bind="attr: {src: (token)?item.thumbnail+\'?\'+token : item.thumbnail}">\r\n    <span class="mojimask"></span>\r\n</script>\r\n'}),define("services/pes/emoticons/styleKeyFrameFactory",[],function(){function e(e,t,n,i,s){var o="@"+(i||"")+"keyframes "+e+" { ";return o+=r(t,n,i,s),o+="} \n",o}function t(e){return" top: "+e+"; "}function n(e){return" transform: translateY("+e+"); "}function r(e,n,r,i){i=i||t;var s="";return s+="from { ",s+=i(e),s+="} ",s+="to { ",s+=i(n),s+="} ",s}function i(t,n,r){var i="0",s=-n+"px";return e(t,i,s,"",r)+e(t,i,s,"-moz-",r)+e(t,i,s,"-webkit-",r)}function s(){}return s.prototype.create=function(e){var r=i(e.id,e.styleDef.smallHeight,n);return r+=i(e.id+"_large",e.styleDef.largeHeight,n),r+=i(e.id+"_extraLarge",e.styleDef.extraLargeHeight,t),r},new s}),define("services/pes/emoticons/styleDefinitionFactory",["require","services/pes/constants"],function(e){function n(){function n(e){var n=e.largeUrl,r=t.frameHeights.emoticons.LARGE,i=e.styleDef.largeHeight,s=e.styleDef.largeOffset;return o(e,n,r,i,s,"large")}function r(e){return" top: "+e+";\n"+" -webkit-transform: initial;\n"+"transform: initial;\n"+" transform: translateZ(0);"}function i(e){return" -webkit-transform: translateY("+e+");\n"+" transform: translateY("+e+");"}function s(e){var n=e.extraLargeUrl,i=t.frameHeights.emoticons.EXTRA_LARGE,s=e.styleDef.extraLargeHeight,u=e.styleDef.extraLargeOffset;return o(e,n,i,s,u,"extraLarge",r)}function o(e,t,n,r,s,o,u){var a=e.id,f=e.id,l=e.styleDef.duration,c=e.styleDef.frameCount;u=u||i,o&&(f+="_"+o);var h="\n .swx .largeAllowed span.emoticon."+a+".animated";return o&&(h+="."+o),h+=" span.emoSprite \n",h+="{ \n",h+=" -ms-high-contrast-adjust: none;\n",h+=" background-image: url('"+t+"');\n",h+=" background-size: "+n+"px "+r+"px; \n",h+=" height: "+r+"px; \n",h+=u(s)+"\n",h+=" -moz-animation: "+f+" "+l+" steps("+c+") infinite; \n",h+=" -webkit-animation: "+f+" "+l+" steps("+c+") infinite; \n",h+=" animation: "+f+" "+l+" steps("+c+") infinite; \n",h+="} ",h}function u(e){var n=e.id,r=e.styleDef.duration,s=e.styleDef.frameCount,o=e.smallUrl,u=t.frameHeights.emoticons.SMALL,a=e.styleDef.smallOffset,f=e.styleDef.smallHeight,l="\n.swx span.emoticon."+e.id+".animated span.emoSprite, \n";return l+=".swx span.emoticon."+e.id+".large.animated span.emoSprite, \n",l+=".swx span.emoticon."+e.id+".extraLarge.animated span.emoSprite, \n",l+=".swx .largeAllowed span.emoticon."+e.id+".animated span.emoSprite",l+="{ \n",l+=" -ms-high-contrast-adjust: none;\n",l+=" background-image: url('"+o+"'); \n",l+=" background-size: "+u+"px "+f+"px; \n",l+=" height: "+f+"px; \n",l+=i(a),l+=" -webkit-animation: "+n+" "+r+" steps("+s+") infinite; \n",l+=" -moz-animation: "+n+" "+r+" steps("+s+") infinite; \n",l+=" animation: "+n+" "+r+" steps("+s+") infinite; \n",l+="} ",l}function a(e,t,n,r,s,o){var u="\n.swx span.emoticon."+e.id+t+" span.emoSprite \n";return u+="{\n",u+=" -ms-high-contrast-adjust: none;\n",u+=" background-image: url('"+n+"'); \n",u+=" background-size: "+r+"px "+s+"px; \n",u+=" height: "+s+"px; \n",u+=i(o),u+=" -moz-animation: none; \n",u+=" -webkit-animation: none; \n",u+=" animation: none \n",u+="}",u}function f(e){return a(e,"",e.smallStaticUrl,t.frameHeights.emoticons.SMALL,t.frameHeights.emoticons.SMALL,0)+a(e,".large",e.largeStaticUrl,t.frameHeights.emoticons.LARGE,t.frameHeights.emoticons.LARGE,0)+a(e,".extraLarge",e.extraLargeStaticUrl,t.frameHeights.emoticons.EXTRA_LARGE,t.frameHeights.emoticons.EXTRA_LARGE,0)}var e=this;e.create=function(e){var t=f(e);return t+=u(e),t+=n(e),t+=s(e),t}}var t=e("services/pes/constants");return new n}),define("services/pes/emoticons/stylesFactory",["require","services/pes/constants","services/pes/emoticons/styleKeyFrameFactory","services/pes/emoticons/styleDefinitionFactory"],function(e){function s(){function s(e){var n=e.media.default,r=(n.firstFrame<n.framesCount?n.firstFrame:n.framesCount-1)||0;e.styleDef={frameCount:n.framesCount,firstFrame:r,duration:n.framesCount/i+"s",smallHeight:t.frameHeights.emoticons.SMALL*n.framesCount,smallOffset:-r*t.frameHeights.emoticons.SMALL,largeHeight:t.frameHeights.emoticons.LARGE*n.framesCount,largeOffset:-r*t.frameHeights.emoticons.LARGE,extraLargeHeight:t.frameHeights.emoticons.EXTRA_LARGE*n.framesCount,extraLargeOffset:-r*t.frameHeights.emoticons.EXTRA_LARGE},e.styleDef.smallOffset!==0&&(e.styleDef.smallOffset+="px"),e.styleDef.largeOffset!==0&&(e.styleDef.largeOffset+="px"),e.styleDef.extraLargeOffset!==0&&(e.styleDef.extraLargeOffset+="px")}var e=this;e.create=function(e){s(e);var t=n.create(e),i=r.create(e);return t+i}}var t=e("services/pes/constants"),n=e("services/pes/emoticons/styleKeyFrameFactory"),r=e("services/pes/emoticons/styleDefinitionFactory"),i=24;return new s}),define("services/pes/emoticons/fetcher",["require","lodash-compat","swx-constants","services/pes/constants","utils/chat/pesUtils","swx-service-locator-instance","experience/settings","services/pes/emoticons/stylesFactory","utils/common/url"],function(e){function f(){function f(e,t){return a.buildUrl(e,{etag:t})}function l(e,t){var u=s.resolve(n.serviceLocator.FEATURE_FLAGS);return u.isFeatureOn(n.featureFlags.PES_CDN_AUTH_ENABLED)&&(e=i.rewriteUrls(e,o.pesCDNAuthentication.rewriteRules)),{smallStaticUrl:f(e+r.profiles.emoticons.getSmall(),t),largeStaticUrl:f(e+r.profiles.emoticons.getLarge(),t),extraLargeStaticUrl:f(e+r.profiles.emoticons.getExtraLarge(),t),smallUrl:f(e+r.profiles.emoticons.getSmallAnimated(),t),largeUrl:f(e+r.profiles.emoticons.getLargeAnimated(),t),extraLargeUrl:f(e+r.profiles.emoticons.getExtraLargeAnimated(),t)}}var e=this;e.process=function(){return null},e.getResources=function(e,i){var o,a,f=[],c=s.resolve(n.serviceLocator.FEATURE_FLAGS),h;return e.type!==r.itemTypes.emoticon.id?null:(a=[],h=i.emoticonsRoot+"/"+e.id+"/views/",e.shortcuts.forEach(function(t){a.push({shortcut:t,id:e.id,type:r.itemTypes.emoticon.id})}),o=l(h,e.etag),t.extend(e,o),c.isFeatureOn(n.featureFlags.PES_FETCH_SMALL_ASSETS_ON_DEMAND)||(f.push(e.smallUrl),f.push(e.smallStaticUrl)),c.isFeatureOn(n.featureFlags.PES_FETCH_MEDIUM_ASSETS_ON_DEMAND)||(f.push(e.largeUrl),f.push(e.largeStaticUrl)),c.isFeatureOn(n.featureFlags.PES_FETCH_LARGE_ASSETS_ON_DEMAND)||(f.push(e.extraLargeUrl),f.push(e.extraLargeStaticUrl)),{styleDef:c.isFeatureOn(n.featureFlags.CANVAS_EMOTICONS_ENABLED)?"":u.create(e),prefetchUrls:f,encoderMaps:a})}}var t=e("lodash-compat"),n=e("swx-constants").COMMON,r=e("services/pes/constants"),i=e("utils/chat/pesUtils"),s=e("swx-service-locator-instance").default,o=e("experience/settings"),u=e("services/pes/emoticons/stylesFactory"),a=e("utils/common/url");return new f}),define("services/pes/emoticons/renderLoop",["require","lodash-compat","swx-constants","services/pes/constants","browser/window","utils/chat/pesUtils","swx-service-locator-instance"],function(e){function l(e,t,n){return e.dataset?e.dataset[t]:e.getAttribute("data-"+n)}function c(e,t,n,r){e.dataset?e.dataset[t]=r:e.setAttribute("data-"+n,r)}function h(e,t){this.url=e,this.mediaInfo=t}function p(e,t){var n=this,r=i.Image;this.image=new r,this.image.onload=function(){n.draw=d,n.draw(e,t)},this.draw=function(){},this.image.src=this.url}function d(e,t){var n=e.getContext("2d"),r=f.INVALID,i=this.image.naturalWidth;n.clearRect(0,0,e.width,e.width);var s;this.mediaInfo.framesCount===1?s=0:s=Math.floor(t*this.mediaInfo.fps)%this.mediaInfo.framesCount,l(e,"drawState","draw-state")!==f.TRANSIENT&&c(e,"drawState","draw-state",r),n.drawImage(this.image,0,i*s,i,i,0,0,e.width,e.width)}function v(e,t){this.smallAnimated=new h(s.buildEmoticonUrl(e,t,"small",!0),t.media.default),this.largeAnimated=new h(s.buildEmoticonUrl(e,t,"large",!0),t.media.default),this.extraLargeAnimated=new h(s.buildEmoticonUrl(e,t,"extraLarge",!0),t.media.default),this.smallStatic=new h(s.buildEmoticonUrl(e,t,"small",!1),a),this.largeStatic=new h(s.buildEmoticonUrl(e,t,"large",!1),a),this.extraLargeStatic=new h(s.buildEmoticonUrl(e,t,"extraLarge",!1),a)}function m(){function m(n){if(n-a>=p){a=n;var r=g();t.forEach(r,function(t){var r=t.getBoundingClientRect();if(r.width<=u||!b(r))return;w(t,r);var i=l(t,"itemId","item-id"),s=e._imageCache[i],o=l(t,"isAnimated","is-animated")==="true";try{s&&y(t,s,r.width,o,n/1e3)}catch(a){}})}s&&i.requestAnimationFrame(m)}function g(){return document.querySelectorAll(".swx span.emoticon canvas")}function y(e,t,n,i,s){var o;n<=r.frameHeights.emoticons.SMALL?o="small":n<=r.frameHeights.emoticons.LARGE?o="large":o="extraLarge",t[o+(i?"Animated":"Static")].draw(e,s)}function b(e){return e.bottom>0&&e.right>0&&e.top<i.innerHeight&&e.left<i.innerWidth}function w(e,t){var n=t.width*d;if(e.width===n&&e.height===n)return;e.width=n,e.height=n,l(e,"drawState","draw-state")!==f.TRANSIENT&&c(e,"drawState","draw-state",f.INVALID)}var e=this,s=!1,a=-1313,p=0,d=1;this._imageCache={},this.isRunning=function(){return s},this.start=function(){"devicePixelRatio"in i&&(d=i.devicePixelRatio),s=!0,a=-1313,i.requestAnimationFrame(m)},this.stop=function(){s=!1},this.updateCache=function(){var s=o.resolve(n.serviceLocator.PES_CONFIG_SERVICE).getConfiguration(),u=0;t.forEach(s.items,function(t){!e._imageCache[t.id]&&t.type===r.itemTypes.emoticon.id&&(e._imageCache[t.id]=new v(s.emoticonsRoot,t),t.media&&t.media.default&&t.media.default.fps>u&&(u=t.media.default.fps))}),u!==0&&(p=Math.floor(1e3/u))},this._CacheItem=v,this._DrawStateMachine=h}var t=e("lodash-compat"),n=e("swx-constants").COMMON,r=e("services/pes/constants"),i=e("browser/window"),s=e("utils/chat/pesUtils"),o=e("swx-service-locator-instance").default,u=2,a={firstFrame:0,framesCount:1,fps:1},f={INVALID:"invalid",TRANSIENT:"transient"};return h.prototype.draw=p,new m}),define("services/pes/mojis/stylesFactory",["require","services/pes/constants"],function(e){function n(){function n(e){var n=e.thumbnailUrl,r=t.frameHeights.moji.THUMBNAIL,i="\n.swx span.moji.id_"+e.id+" span.mojiThumbnail \n";return i+="{\n",i+=" -ms-high-contrast-adjust: none;\n",i+=" background-image: url('"+n+"'); \n",i+=" height: "+r+"px; \n",i+=" background-size: 100%; \n",i+="}",i}function r(e){var t=e.thumbnailUrl,n="\n.swx span.moji.id_"+e.id+" span.keyframe \n";return n+="{\n",n+=" -ms-high-contrast-adjust: none;\n",n+=" background-image: url('"+t+"'); \n",n+=" height: 100%; \n",n+=" background-size: 100%; \n",n+=" border-radius: 8px; \n",n+=" display: block; \n",n+="}",n}var e=this;e.create=function(e){var t=n(e);return t+=r(e),t}}var t=e("services/pes/constants");return new n}),define("services/pes/mojis/fetcher",["require","services/pes/constants","services/pes/mojis/stylesFactory","utils/chat/pesUtils","swx-service-locator-instance","swx-constants","experience/settings"],function(e){function u(){var e=this;e.process=function(){return null},e.getResources=function(e,u){var a=[];if(e.type!==t.itemTypes.moji.id)return null;var f=u.itemsRoot+"/"+e.id+"/views/",l=i.resolve(s.serviceLocator.FEATURE_FLAGS);return l.isFeatureOn(s.featureFlags.PES_CDN_AUTH_ENABLED)&&(f=r.rewriteUrls(f,o.pesCDNAuthentication.rewriteRules)),e.thumbnailUrl=f+t.profiles.moji.thumbnail,u._requiresCDNUrlAuthentication&&(e.thumbnailUrl=e.thumbnailUrl+"?"+u._cdnToken),l.isFeatureOn(s.featureFlags.PES_FETCH_MOJI_ASSETS_ON_DEMAND)||a.push(e.thumbnailUrl),{styleDef:n.create(e),prefetchUrls:a,encoderMaps:[]}}}var t=e("services/pes/constants"),n=e("services/pes/mojis/stylesFactory"),r=e("utils/chat/pesUtils"),i=e("swx-service-locator-instance").default,s=e("swx-constants").COMMON,o=e("experience/settings");return new u}),define("utils/common/prefetcher",["require","ui/controls/calling/sounds"],function(e){function i(){var e=document.createDocumentFragment();s(e),document.head.appendChild(e)}function s(e){r.forEach(function(r){n.forEach(function(n){var i=t.buildSoundAssetUrl(r,n);o(e,i)})})}function o(e,t){var n=u(t);e.appendChild(n)}function u(e){var t=document.createElement("link");return t.rel="prefetch",t.href=e,t}function a(e){var t=[],n=e.length;for(var r=0;r<n;r++){var i=new Image;i.src=e[r],t[r]=i}}var t=e("ui/controls/calling/sounds"),n=["m4a","ogg"],r=[t.KEYS.CALL_ANSWER,t.KEYS.CALL_DIALING,t.KEYS.CALL_OUTGOING_P1,t.KEYS.CALL_OUTGOING_P2,t.KEYS.CALL_INCOMING,t.KEYS.MESSAGE_RECEIVED_1];return{prefetchAssets:i,prefetchImages:a}}),define("services/pes/tabs/stylesFactory",[],function(){function e(){function t(e){var t="\n.swx .tab_id_"+e.id+"\n";return t+="{\n",t+=" -ms-high-contrast-adjust: none;\n",t+=" background-image: url('"+e.thumbnailUrl+"'); \n",t+="} \n",t}var e=this;e.create=function(e){return t(e)}}return new e}),define("services/pes/tabs/fetcher",["require","services/pes/tabs/stylesFactory","services/pes/constants"],function(e){function r(){var e=this;e.process=function(){return null},e.getResources=function(e){return e.type!==n.itemTypes.tab.id?null:{styleDef:t.create(e),prefetchUrls:[e.thumbnailUrl],encoderMaps:[]}}}var t=e("services/pes/tabs/stylesFactory"),n=e("services/pes/constants");return new r}),define("services/pes/configProcessor",["require","lodash-compat","swx-constants","swx-emoticon-map-instance","services/pes/emoticons/fetcher","services/pes/emoticons/renderLoop","services/pes/mojis/fetcher","services/pes/constants","utils/common/prefetcher","swx-service-locator-instance","services/pes/tabs/fetcher"],function(e){function c(){function c(e){var t,n,r;return r=document.getElementById("pesStyles"),r||(n=document.head,r=document.createElement("style"),r.id="pesStyles",r.type="text/css"),r.styleSheet?r.styleSheet.cssText=e:(t=document.createTextNode(e),r.firstChild&&r.removeChild(r.firstChild),r.appendChild(t)),n&&n.appendChild(r),e}var e=this;e.process=function(n){n.tabs.forEach(function(t,r){l.process(t,r),t.packs.forEach(function(t){t.items.forEach(function(t){e._processItem(t,n,"process")})})})},e._processItem=function(e,t,n){n=n||"process";if(!e)throw new Error("Ad hoc fetching is not implemented, yet!");switch(e.type){case u.itemTypes.emoticon.id:return i[n](e,t);case u.itemTypes.moji.id:return o[n](e,t);case u.itemTypes.sticker.id:throw new Error("Stickers are not implemented, yet!");default:throw new Error(e.type+" is not supported, yet!")}},e.prefetch=function(i){var o=[],u=[],a=[],c=t.cloneDeep(i,function(e){return e&&t.isFunction(e.then)?{}:undefined}),h=f.resolve(n.serviceLocator.FEATURE_FLAGS);return c.tabs.forEach(function(t){var n=l.getResources(t);o.push(n.styleDef),u.splice(0,0,n.prefetchUrls[0]),t.packs.forEach(function(t){t.items.forEach(function(t){var n=e._processItem(t,i,"getResources");o.push(n.styleDef),n.encoderMaps.forEach(function(e){a.push(e)}),n.prefetchUrls.forEach(function(e){u.push(e)})})})}),h.isFeatureOn(n.featureFlags.CANVAS_EMOTICONS_ENABLED)&&(s.isRunning()||s.start(),s.updateCache()),{pesStyles:o,prefetchUrls:u,encodingMaps:a}},e.register=function(t){var n="";r.map={},t.encodingMaps.forEach(function(e){switch(e.type){case u.itemTypes.emoticon.id:r.map[e.shortcut]=e.id;break;case u.itemTypes.tab.id:case u.itemTypes.moji.id:case u.itemTypes.sticker.id:throw new Error("mapping.type not implemented yet:"+e.type);default:throw new Error("mapping.type not supported yet:"+e.type)}}),t.pesStyles.forEach(function(e){n+=e}),c(n)},e.prefetchImages=function(t){a.prefetchImages(t.prefetchUrls||[])}}var t=e("lodash-compat"),n=e("swx-constants").COMMON,r=e("swx-emoticon-map-instance"),i=e("services/pes/emoticons/fetcher"),s=e("services/pes/emoticons/renderLoop"),o=e("services/pes/mojis/fetcher"),u=e("services/pes/constants"),a=e("utils/common/prefetcher"),f=e("swx-service-locator-instance").default,l=e("services/pes/tabs/fetcher");return new c}),define("services/i18n/cultureInfo",[],function(){function e(){function i(e){for(t=0;t<n.length;t++)if(n[t].language.toLowerCase()===e.toLowerCase())return n[t]}function s(e){for(t=0;t<r.length;t++)if(r[t].locale.toLowerCase()===e.toLowerCase())return r[t]}var e=this,t,n=[{language:"am",defaultLocale:"am-et"},{language:"ar",defaultLocale:"ar-sa"},{language:"bg",defaultLocale:"bg-bg"},{language:"bn",defaultLocale:"bn-in"},{language:"ca",defaultLocale:"ca-es"},{language:"cs",defaultLocale:"cs-cz"},{language:"cy",defaultLocale:"cy-gb"},{language:"da",defaultLocale:"da-dk"},{language:"de",defaultLocale:"de-de"},{language:"el",defaultLocale:"el-gr"},{language:"en",defaultLocale:"en-us"},{language:"es",defaultLocale:"es-es"},{language:"et",defaultLocale:"et-ee"},{language:"eu",defaultLocale:"eu-es"},{language:"fa",defaultLocale:"fa-ir"},{language:"fi",defaultLocale:"fi-fl"},{language:"fil",defaultLocale:"fil-ph"},{language:"fr",defaultLocale:"fr-fr"},{language:"gl",defaultLocale:"gl-es"},{language:"gu",defaultLocale:"gu-in"},{language:"he",defaultLocale:"he-il"},{language:"hi",defaultLocale:"hi-in"},{language:"hr",defaultLocale:"hr-hr"},{language:"hu",defaultLocale:"hu-hu"},{language:"id",defaultLocale:"id-id"},{language:"is",defaultLocale:"is-is"},{language:"it",defaultLocale:"it-it"},{language:"ja",defaultLocale:"ja-jp"},{language:"kk",defaultLocale:"kk-kz"},{language:"kn",defaultLocale:"kn-in"},{language:"ko",defaultLocale:"ko-kr"},{language:"ku",defaultLocale:"ku-arab-iq"},{language:"lt",defaultLocale:"lt-lt"},{language:"lv",defaultLocale:"lv-lv"},{language:"ml",defaultLocale:"ml-in"},{language:"mr",defaultLocale:"mr-in"},{language:"ms",defaultLocale:"ms-my"},{language:"nb",defaultLocale:"nb-no"},{language:"nl",defaultLocale:"nl-nl"},{language:"nn",defaultLocale:"nn-no"},{language:"or",defaultLocale:"or-in"},{language:"pl",defaultLocale:"pl-pl"},{language:"pt",defaultLocale:"pt-PT"},{language:"pt-pt",defaultLocale:"pt-PT"},{language:"pt-br",defaultLocale:"pt-BR"},{language:"ro",defaultLocale:"ro-ro"},{language:"ru",defaultLocale:"ru-ru"},{language:"sk",defaultLocale:"sk-sk"},{language:"sl",defaultLocale:"sl-si"},{language:"sr",defaultLocale:"sr-cyrl-rs"},{language:"sr-cyrl",defaultLocale:"sr-cyrl-rs"},{language:"sr-latn",defaultLocale:"sr-latn-rs"},{language:"sv",defaultLocale:"sv-se"},{language:"sw",defaultLocale:"sw-ke"},{language:"ta",defaultLocale:"ta-in"},{language:"te",defaultLocale:"te-in"},{language:"th",defaultLocale:"th-th"},{language:"tr",defaultLocale:"tr-tr"},{language:"uk",defaultLocale:"uk-ua"},{language:"ur",defaultLocale:"ur-pk"},{language:"vi",defaultLocale:"vi-vn"},{language:"zh",defaultLocale:"zh-cn"},{language:"zh-hant",defaultLocale:"zh-tw"},{language:"zh-cht",defaultLocale:"zh-tw"},{language:"zh-hk",defaultLocale:"zh-tw"},{language:"zh-mo",defaultLocale:"zh-tw"}],r=[{locale:"am-et",pesLocale:"am"},{locale:"ar-sa",pesLocale:"ar"},{locale:"az-latn-az",pesLocale:"az"},{locale:"be-by",pesLocale:"be-BY"},{locale:"bg-bg",pesLocale:"bg"},{locale:"bn-bd",pesLocale:"bn"},{locale:"bn-in",pesLocale:"bn"},{locale:"bs-latn-ba",pesLocale:"bs-Latn-BA"},{locale:"ca-es",pesLocale:"ca"},{locale:"ca-es-valencia",pesLocale:"ca"},{locale:"cs-cz",pesLocale:"cs"},{locale:"cy-gb",pesLocale:"cy-GB"},{locale:"da-dk",pesLocale:"da"},{locale:"de-de",pesLocale:"de"},{locale:"el-gr",pesLocale:"el"},{locale:"en-gb",pesLocale:"en"},{locale:"en-us",pesLocale:"en"},{locale:"es-es",pesLocale:"es"},{locale:"et-ee",pesLocale:"et"},{locale:"eu-es",pesLocale:"eu"},{locale:"fa-ir",pesLocale:"fa"},{locale:"fi-fl",pesLocale:"fi"},{locale:"fil-ph",pesLocale:"fil_PH"},{locale:"fr-fr",pesLocale:"fr"},{locale:"gd-gb",pesLocale:"gd-GB"},{locale:"gl-es",pesLocale:"gl"},{locale:"gu-in",pesLocale:"gu-IN"},{locale:"he-il",pesLocale:"he"},{locale:"hi-in",pesLocale:"hi"},{locale:"hr-hr",pesLocale:"hr"},{locale:"hu-hu",pesLocale:"hu"},{locale:"id-id",pesLocale:"id"},{locale:"is-is",pesLocale:"is"},{locale:"it-it",pesLocale:"it"},{locale:"ja-jp",pesLocale:"ja"},{locale:"ka-ge",pesLocale:"ka-GE"},{locale:"kk-kz",pesLocale:"kk"},{locale:"kn-in",pesLocale:"kn"},{locale:"ko-kr",pesLocale:"ko"},{locale:"ku-arab-iq",pesLocale:"ku-Arab-IQ"},{locale:"lb-lu",pesLocale:"lb-LU"},{locale:"lt-lt",pesLocale:"lt"},{locale:"lv-lv",pesLocale:"lv"},{locale:"mk-mk",pesLocale:"mk"},{locale:"ml-in",pesLocale:"ml"},{locale:"mr-in",pesLocale:"mr-IN"},{locale:"ms-my",pesLocale:"ms"},{locale:"nb-no",pesLocale:"no"},{locale:"nl-nl",pesLocale:"nl"},{locale:"nn-no",pesLocale:"no"},{locale:"or-in",pesLocale:"or-IN"},{locale:"pl-pl",pesLocale:"pl"},{locale:"pt-pt",pesLocale:"pt-PT"},{locale:"pt-br",pesLocale:"pt-BR"},{locale:"ro-ro",pesLocale:"ro"},{locale:"ru-ru",pesLocale:"ru"},{locale:"sk-sk",pesLocale:"sk"},{locale:"sl-sl",pesLocale:"sl"},{locale:"sq-al",pesLocale:"sq"},{locale:"sr-cyrl-ba",pesLocale:"sr"},{locale:"sr-cyrl-rs",pesLocale:"sr"},{locale:"sr-latn-rs",pesLocale:"sr"},{locale:"sv-se",pesLocale:"sv"},{locale:"sw-ke",pesLocale:"sw"},{locale:"ta-in",pesLocale:"ta"},{locale:"te-in",pesLocale:"te"},{locale:"th-th",pesLocale:"th"},{locale:"tr-tr",pesLocale:"tr"},{locale:"uk-ua",pesLocale:"uk"},{locale:"ur-pk",pesLocale:"ur-PK"},{locale:"uz-latn-uz",pesLocale:"uz"},{locale:"vi-vn",pesLocale:"vi"},{locale:"zh-cn",pesLocale:"zh_Hans"},{locale:"zh-tw",pesLocale:"zh_Hant"}];e.getPesLocale=function(t){var n,r;if(!t)return"default";n=s(t);if(n&&n.pesLocale)return n.pesLocale;r=e.getLocale(t);if(r!==t){n=s(r);if(n)return n.pesLocale}return"default"},e.getLocale=function(t){var n,r=i(t);return r?r.defaultLocale:(n=t.lastIndexOf("-"),n>-1?e.getLocale(t.substring(0,n)):t)}}return new e}),define("services/pes/configSync",["require","lodash-compat","swx-cafe-application-instance","services/ecs/configLoader","services/pes/configProcessor","swx-constants","services/i18n/cultureInfo","swx-enums","services/pes/constants","utils/chat/pesUtils","swx-pubsub-instance","reqwest","swx-service-locator-instance","experience/settings","browser/window"],function(e){function v(){function g(){function t(){return(new Promise(function(e){v=d.setTimeout(e,p.pesCDNAuthentication.cdnTokenTtlMs)})).then(function(){return n.get().signInManager._skypeToken()}).then(y).then(w).then(t)}m.isFeatureOn(s.featureFlags.PES_CDN_AUTH_ENABLED)&&p.pesCDNAuthentication.cdnTokenTtlMs>0&&(t().catch(function(e){}).then(t),n.get().signInManager.state.when(u.loginState.SignedOut,function(){e.dispose()}))}function y(t){var n="https://"+p.pesCDNAuthentication.skypeServiceHost+p.pesCDNAuthentication.tokenSourceEndpoint,r={headers:{Authorization:"skype_token "+t},url:n,dataType:"json",crossOrigin:!0};return Promise.resolve(c.compat(r)).catch(function(){return{token:"dummy_token"}}).then(function(t){var n=h.resolve(s.serviceLocator.PES_CONFIG_SERVICE);return e.latestToken=t.token,n.cdnTokenUpdated(t.token),l.publish(s.events.personalExpression.CDN_TOKEN_UPDATED,t.token),t.token})}function b(e){var t;return t="https://"+p.pesCDNAuthentication.cdnServiceHost+p.pesCDNAuthentication.cookieSourceEndpoint+"?vdms_skype_token="+e,{url:t,dataType:"json",crossOrigin:!0,withCredentials:!0}}function w(e){var t=b(e);return Promise.resolve(c.compat(t)).catch(function(){return!0})}var e=this,v=0,m;e.latestToken="",e.init=function(){function d(){var e,t;return p.pesConfigUrl?t=Promise.resolve({pes_config:p.pesConfigUrl}):(e=n.get().personsAndGroupsManager.mePerson,t=e.id.get().then(function(e){return r.loadConfig(u.ecsClientNames.Skype,p.ecsPesKey,e)})),t}function v(n){if(m.isFeatureOn(s.featureFlags.PES_CDN_AUTH_ENABLED)&&m.isFeatureOn(s.featureFlags.PES_CDN_AUTH_URL_FALLBACK_ENABLED)){var r,o,u=t.find(n.items,function(e){return e.type===a.itemTypes.moji.id});if(u)return o=n.itemsRoot+"/"+u.id+"/views/meta.default",r={dataType:"json",withCredentials:!0,url:f.rewriteUrls(o,p.pesCDNAuthentication.rewriteRules),crossOrigin:!0},Promise.resolve(c.compat(r)).then(function(){l.init(n);var e=i.prefetch(l.getConfiguration());i.register(e)}).catch(function(){e._requiresCDNUrlAuthentication=!0,n._requiresCDNUrlAuthentication=!0,n._cdnToken=e.latestToken,l.init(n);var t=i.prefetch(l.getConfiguration());i.register(t)})}else{l.init(n);var h=i.prefetch(l.getConfiguration());i.register(h)}}function y(e){throw e}function b(t){var r=(new Promise(function(t){n.get().signInManager.state.once(u.loginState.SignedIn,t)})).then(e.fetchConfiguration.bind(null,t.pes_config)).then(v).then(g).catch(y);return{configurationLoaded:r}}var l;return m=h.resolve(s.serviceLocator.FEATURE_FLAGS),p.locale=p.locale||{},p.initParams=p.initParams||{},p.locale.pes=o.getPesLocale(p.initParams.locale),l=h.resolve(s.serviceLocator.PES_CONFIG_SERVICE),d().then(b).catch(y)},e.fetchConfiguration=function(r){function i(){var e,t=Promise.resolve();return m.isFeatureOn(s.featureFlags.PES_CDN_AUTH_ENABLED)&&(e=n.get().signInManager._skypeToken(),t=Promise.resolve(e).then(y).then(w)),t}function o(n,r){var i,o=t.extend(r||{},{dataType:"json",crossOrigin:!0});return m.isFeatureOn(s.featureFlags.PES_CDN_AUTH_ENABLED)&&(n=f.rewriteUrls(n,p.pesCDNAuthentication.rewriteRules),o.withCredentials=!0),o.url=n,i=Promise.resolve(c.compat(o)),m.isFeatureOn(s.featureFlags.PES_CDN_AUTH_ENABLED)&&(i=i.catch(function(){var i=t.extend(r||{},{dataType:"json",crossOrigin:!0});return i.url=n+"?"+e.latestToken,Promise.resolve(c.compat(i))})),i}function u(){throw new Error("no pes configuration service endpoint")}function a(){return r.replace("/default","/"+p.locale.pes)}return i().then(function(){return o(a())}).catch(function(){return o(r)}).catch(u)},e.dispose=function(){v&&d.clearTimeout(v)}}var t=e("lodash-compat"),n=e("swx-cafe-application-instance"),r=e("services/ecs/configLoader"),i=e("services/pes/configProcessor"),s=e("swx-constants").COMMON,o=e("services/i18n/cultureInfo"),u=e("swx-enums"),a=e("services/pes/constants"),f=e("utils/chat/pesUtils"),l=e("swx-pubsub-instance").default,c=e("reqwest"),h=e("swx-service-locator-instance").default,p=e("experience/settings"),d=e("browser/window");return new v}),define("services/store/pes/catalogItemProcessor",["require","exports","module","lodash-compat","services/pes/constants","services/pes/tabs/stylesFactory","services/pes/mojis/stylesFactory","services/pes/emoticons/stylesFactory","utils/chat/pesUtils","services/pes/configProcessor","experience/settings"],function(e,t){function l(e,t){var n,r,i=t.packs;for(n=0;n<i.length;n++){r=i[n];if(r.id===e)return r.itemIds=r.items,r.isHidden=!1,r.items=[],c(r,t),r}}function c(e,t){var n,i,s=t.items;for(n=0;n<s.length;n++)i=s[n],e.itemIds.indexOf(i.id)>-1&&(i.thumbnail=i.type===r.itemTypes.moji.id?t.itemsRoot+"/"+i.id+"/views/thumbnail":t.emoticonsRoot+"/"+i.id+"/views/default_40",e.items.push(i))}function h(e,t,n){if(!e)return;var r,s,o=i.create(e.tabs[0]),u,a=e.tabs[0].packs,f;for(f=0;f<a.length;f++)u=a[f].items,o=p(o,u,t,n,e),r=document.createElement("style"),s=document.createTextNode(o),r.appendChild(s),document.head.appendChild(r)}function p(e,t,i,u,a){return n.forEach(t,function(t){t.type===r.itemTypes.moji.id?(t.thumbnailUrl=u?t.thumbnail+"?"+i:t.thumbnail,e+=s.create(t),t.thumbnailClass="id_"+t.id+" thumbnail",t.keyframeClass="id_"+t.id+" keyframe",t.contentUrl=a.itemsRoot+"/"+t.id+"/views/"+r.profiles.moji.content,u&&(t.contentUrl+="?"+i)):e+=o.create(t)}),e}var n=e("lodash-compat"),r=e("services/pes/constants"),i=e("services/pes/tabs/stylesFactory"),s=e("services/pes/mojis/stylesFactory"),o=e("services/pes/emoticons/stylesFactory"),u=e("utils/chat/pesUtils"),a=e("services/pes/configProcessor"),f=e("experience/settings");t.processTabConfig=function(e){var t=e.tabs,n,i,s,o;e.itemsRoot=u.rewriteUrls(e.itemsRoot,f.pesCDNAuthentication.rewriteRules);for(n=0;n<t.length;n++){s=t[n],s.packs=[],s.type||(s.type=r.itemTypes.tab.id),s.thumbnailUrl||(s.thumbnailUrl=e.tabsRoot+"/"+s.id+"/views/thumbnail");for(i=0;s.sections&&i<s.sections.length;i++)o=l(s.sections[i].pack,e),o.parentTab=s,s.packs.push(o)}a.process(e)},t.processSKUs=function(e){e.forEach(function(e){var t=e.attributes;t&&(e.bgColor="#"+t.glyphBgColor.substring(0,6),e.opacity=parseInt(t.glyphBgColor.substring(6,8),16)/255,e.items=t.items.__metadata.links.self,e.copyright=t.copyright,e.expiry=t.expiry)})},t.loadStyles=function(e,t,n){h(e,t,n)}}),define("ui/viewModels/chat/pes/store/browseTabs",["require","lodash-compat","vendor/knockout","swx-constants","browser/dom","utils/common/scroll","swx-service-locator-instance","swx-constants","utils/common/eventHelper","services/pes/interactors/store","services/pes/interactors/picker","services/pes/configSync","services/store/pes/catalogItemProcessor","utils/common/outsideClickHandler"],function(e){function d(e,d){function x(){v.showSpinner(!1),v.showErrorText(!1),v.showTabList(!0),v.showTabDetails(!0)}function T(t){v.showSpinner(!1),v.showErrorText(!1),v.showTabDetails(!0),v.showTabList(!0),v.selectedTab(t),y.scrollToElement(i.getElement(".store-tab-item-details",e))}function N(){p.remove("overlaySlideContent")}function C(){p.add("overlaySlideContent",v.close)}function k(){v.showSpinner(!0),v.showErrorText(!1),v.showTabDetails(!1),v.showTabList(!1)}function L(e){e.isDownloaded=n.observable(!1),e.showDownloadSpinner=n.observable(!1),e.thumbnailUrl=e.thumbnail,e.configData=n.observable(!1),e.showInList=n.observable(!0),e.cdnToken=n.observable(!1),e.isSelectedCSS=n.pureComputed(function(){return this.selectedTab().id===e.id?"selected":""},v),E.indexOf(e.id)!==-1&&S.indexOf(e.id)===-1&&e.isDownloaded(!0)}function A(){v.tabs().length||k(),E=v.pickerState&&v.pickerState.purchasedTabIds?v.pickerState.purchasedTabIds:[],S=v.pickerState&&v.pickerState.hiddenTabIds?v.pickerState.hiddenTabIds:[],b.loadCatalog().then(function(e){var t,n;x();for(t=0;e&&t<e.length;t++)n=e[t],m.indexOf(n.id)===-1&&(L(n),v.tabs.push(n),m.push(n.id));!v.selectedTab()&&v.tabs()[0]&&v.tabSelected(v.tabs()[0])},function(){v.showSpinner(!1),v.tabs().length||v.showErrorText(!0)})}function O(e){return Promise.resolve(b.getItems(e.items)).then(function(t){return e.configData(t),t}).catch(function(){return[]})}function M(e){return e.itemsLoaded?Promise.resolve(e.configData()):O(e)}function D(e){var t=e.configData();h.loadStyles(t,c.latestToken,c._requiresCDNUrlAuthentication),f.putNewPurchasedTab.run(v.pickerState,e.id,t),l.mruStateUpdater.run(v.pickerState),v.pickerVM.applyState(v.pickerState),e.showDownloadSpinner(!1),e.isDownloaded(!0)}function P(e,t){var n=[e.name,e.description].concat(e.keywords),r;for(r=0;r<n.length;r++)if(n[r]&&n[r].toLowerCase().indexOf(t.toLowerCase())>-1)return!0;return!1}function H(e){f.hidePurchasedTabOnPicker.run(v.pickerState,e.id),l.mruStateUpdater.run(v.pickerState)}var v=this,m=[],g=s.build(i.getElement(".tabs-list",e)),y=s.build(i.getElement(".tabs-details-wrapper",e)),b=o.resolve(u.serviceLocator.PES_STORE_SERVICE),w=o.resolve(u.serviceLocator.FEATURE_FLAGS),E=[],S=[];g.init(),y.init(),v.showSpinner=n.observable(!1),v.showErrorText=n.observable(!1),v.showTabList=n.observable(!1),v.showTabDetails=n.observable(!1),v.tabs=n.observableArray(),v.selectedTab=n.observable(!1),v.searchQuery=n.observable(""),d&&(v.modalDialog=d.storeModalDialog||!1,v.pickerVM=d.pickerVM||!1,v.pickerState=d.pickerState||!1),v.showStore=function(){v.modalDialog&&(C(),v.modalDialog.show("pes-store-comp"),g.adjustToRTLLayout(),y.adjustToRTLLayout(),A())},v.pickerState&&(v.pickerState.showStore=v.showStore),v.tabSelected=function(e){if(e.id===v.selectedTab().id)return;w.isFeatureOn(u.featureFlags.PES_CDN_AUTH_ENABLED)&&w.isFeatureOn(u.featureFlags.PES_CDN_AUTH_URL_FALLBACK_ENABLED)&&e.cdnToken(c.latestToken);if(e.itemsLoaded){T(e);return}O(e).then(function(){T(e),e.itemsLoaded=!0}).catch(function(){v.showErrorText(!0),v.showTabDetails(!1),v.selectedTab(e)})},v.goToTabList=function(){v.selectedTab(!1),x()},v.buyOrDownloadTab=function(e){if(e.isDownloaded())return e.isDownloaded(!1),H(e),!1;e.showDownloadSpinner(!0);if(E.indexOf(e.id)!==-1)return e.isDownloaded(!0),t.remove(v.pickerState.hiddenTabIds,function(t){return t===e.id}),M(e).then(function(){D(e)}),!1;b.buyTab(e).then(function(){M(e).then(function(){D(e)})})},v.doLocalSearch=t.debounce(function(){v.tabs().length&&v.tabs().forEach(function(e){if(!v.searchQuery()){e.showInList(!0);return}e.showInList(P(e,v.searchQuery()))})},400),v.onSearchBoxKeyDown=function(e,t){var n=a.getKeyCode(t);if(n===r.ESCAPE){v.searchQuery()&&v.resetSearchBox(),t.stopPropagation();return}if(n===r.BACKSPACE&&!v.searchQuery()){a.swallow(t);return}return n===r.ENTER?!1:(v.doLocalSearch(),!0)},v.close=function(){v.modalDialog.hide("pes-store-comp"),v.pickerState&&v.pickerState.hiddenTabIds&&b.postHiddenTabs(v.pickerState.hiddenTabIds),N()},v.resetSearchBox=function(){v.searchQuery("")},v.dispose=function(){g.dispose(),y.dispose()}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-constants").KEYS,i=e("browser/dom"),s=e("utils/common/scroll"),o=e("swx-service-locator-instance").default,u=e("swx-constants").COMMON,a=e("utils/common/eventHelper"),f=e("services/pes/interactors/store"),l=e("services/pes/interactors/picker"),c=e("services/pes/configSync"),h=e("services/store/pes/catalogItemProcessor"),p=e("utils/common/outsideClickHandler");return d.build=function(e,t){return new d(e,t)},d}),define("ui/components/chat/pes/store/browseTabs",["require","text!views/chat/pes/store/browseTabs.html","ui/viewModels/chat/pes/store/browseTabs","constants/components"],function(e){function r(){function r(e,t){var r=t.element,i=n.build(r,e);return i}return{viewModel:{createViewModel:r},template:t,name:e("constants/components").chat.EXPRESSION_STORE_V2_BROWSE_PACKS}}var t=e("text!views/chat/pes/store/browseTabs.html"),n=e("ui/viewModels/chat/pes/store/browseTabs");return new r}),define("ui/viewModels/chat/muteConversationSettingItem",["require","lodash-compat","vendor/knockout","utils/common/eventMixin","swx-i18n","swx-service-locator-instance","swx-constants","utils/common/eventHelper","ui/telemetry/actions/actionNames"],function(e){function f(e){var t=e.conversationModel,r=this,f=s.resolve(o.serviceLocator.FEATURE_FLAGS);r.muteConversationEnabled=n.observable(f.isFeatureOn(o.featureFlags.MUTE_SPECIFIC_CONVERSATIONS_ENABLED)),r.muteConversationEnabled()&&(r.conversationMuted=n.observable(!t._notificationsEnabled()),t._notificationsEnabled.changed(r.conversationMuted),r.isContactProfile=n.observable(!!e.contactProfile),r.muteConversationToggleAriaLabel=n.computed(function(){var e=r.conversationMuted()?"header_narrator_notifications_on":"header_narrator_notifications_off";return i.fetch({key:e})}),r.muteConversationKeydown=function(e,t){var n=u.isActivation(t);return n&&r.muteConversationHandler(),!n},r.muteConversationHandler=function(){if(t.chatService._updateNotificationSettings){var e=!r.conversationMuted(),n=s.resolve(o.serviceLocator.ACTION_TELEMETRY);n.recordAction(a.conversation.mute,{status:e}),t.chatService._updateNotificationSettings(e)}},r.dispose=function(){t._notificationsEnabled.changed.off(r.conversationMuted),r.muteConversationToggleAriaLabel.dispose()})}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("utils/common/eventMixin"),i=e("swx-i18n").localization,s=e("swx-service-locator-instance").default,o=e("swx-constants").COMMON,u=e("utils/common/eventHelper"),a=e("ui/telemetry/actions/actionNames");return t.assign(f.prototype,r),f}),define("text!views/chat/muteConversationSettingItem.html",[],function(){return'<!-- ko if: muteConversationEnabled -->\r\n    <div class="muteConversationSettingItem" data-bind="css: { border: isContactProfile }">\r\n        <div class="muteConversation-flex" data-bind="css: {\'fontSize-p\' : isContactProfile }">\r\n            <span id="muteConversation" class="label" data-bind="css: {\'fontSize-h2\' : isContactProfile, \'fontSize-h4\': !isContactProfile() }, l10n: {key: \'header_text_muteConversation\'}"></span>\r\n            <!-- ko ifnot: isContactProfile -->\r\n                <button role="checkbox" aria-labelledby="muteConversation" class="toggler" data-bind="event: { keydown: muteConversationKeydown }, click: muteConversationHandler, css: { checked: conversationMuted }, attr: { \'aria-checked\': conversationMuted() ? \'true\' : \'false\', \'aria-label\': muteConversationToggleAriaLabel }" type="button"><span class="on"></span><span class="off"></span></button>\r\n            <!-- /ko -->\r\n        </div>\r\n        <span id="muteConversation" data-bind="css: {\'fontSize-p label\' : isContactProfile, \'secondaryText\': !isContactProfile() }, l10n: {key: \'header_secondary_text_muteConversation\'}"></span>\r\n        <!-- ko if: isContactProfile -->\r\n        <div class="muteConversation-flex">\r\n            <span id="muteStatus" class="label fontSize-p" data-bind="l10n: {key: conversationMuted() ? \'setting_on\' : \'setting_off\'}"></span>\r\n            <button role="checkbox" aria-labelledby="muteConversation" class="toggler" data-bind="event: { keydown: muteConversationKeydown }, click: muteConversationHandler, css: { checked: conversationMuted }, attr: { \'aria-checked\': conversationMuted() ? \'true\' : \'false\', \'aria-label\': muteConversationToggleAriaLabel }" type="button"><span class="on"></span><span class="off"></span></button>\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n<!-- /ko -->'}),define("ui/components/chat/muteConversationSettingItem",["require","exports","module","vendor/knockout","ui/viewModels/chat/muteConversationSettingItem","constants/components","text!views/chat/muteConversationSettingItem.html"],function(e,t){function i(e,t){var i=new r(e),s=n.dataFor(t.element);return i.setContext(s),i}var n=e("vendor/knockout"),r=e("ui/viewModels/chat/muteConversationSettingItem");t.name=e("constants/components").chat.MUTE_CONVERSATION_SETTING_ITEM,t.template=e("text!views/chat/muteConversationSettingItem.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/chat/messageDestinationPicker",["require","vendor/knockout","swx-constants","swx-i18n","swx-constants","utils/common/outsideClickHandler","experience/settings","telemetry/calling/pstn/pstn","swx-constants","swx-cafe-application-instance","swx-log-tracer","swx-service-locator-instance"],function(e){function d(e){function x(e){e===n.messageDestination.SMS_NETWORK&&d.destinations()&&d.destinations()[0]&&(d.destination(d.destinations()[0].phone),d.skypeEnabled=!1)}function T(){s.remove(b),d.hideDestinationSelector(!0)}function N(){d.hideNewDestinationContainer(!0),s.remove(y)}function C(){var e=f.get().personsAndGroupsManager.mePerson;E=e.account,E.entitlements.get().then(function(){E._balance()<=0&&(d.openSkypeCreditContainerWindow(),d.isPstnSmsOnly&&(k(),v.publish(n.events.textarea.UPDATE_TEXTAREA_ENABLE,!1)))})}function k(){S||(S=!0,E._balance.changed(L))}function L(){v.publish(n.events.textarea.UPDATE_TEXTAREA_ENABLE,E._balance>0)}function A(){d.hideSkypeCreditContainer()||(d.hideSkypeCreditContainer(!0),s.remove(w),d.isPstnSmsOnly||d.setDestinationToSkype())}function O(e){var t=/^[\+]{1}[\d]+$/gm;return t.test(B(e))}function M(){var e=d.conversation.participants().map(function(e){return e.person.phoneNumbers()}),t=[];return e.forEach(function(e){if(!Array.isArray(e))return;e.forEach(function(e){t.push({phone:e.telUri(),persistent:e.fromProfile()})})}),t}function _(){d.destinations(M())}function D(e){if(!e){j();return}var t=e.value,n=d.skypeOutInput().trim(),r=B(d.newDestination());r.indexOf(n)===0?r=r.substring(n.length):r.indexOf(t)===0&&(r=r.substring(t.length)),d.newDestination(P(t,r)),d.newDestinationInputHasFocus(!0)}function P(e,t){return m+" ("+H(e)+") "+H(t)}function H(e){return e.replace(/[\s|\+|\(|\)]+/gm,"")}function B(e){var t=H(e);return t.substring(0,1)!==m&&(t=m+t),t}function j(){d.newDestination(m),d.skypeOutInput("")}function F(e,t){l.error("[messageDestinationPicker] action = "+e),l.error(t)}var d=this,v=c.resolve(n.serviceLocator.PUBSUB),m="+",g,y="newDestinationContainer",b="destinationSelectorContainer",w="buySkypeCreditContainer",E,S=!1;d.conversation=e.conversation,d.destination=e&&e.destination?e.destination:t.observable(n.messageDestination.SKYPE_NETWORK),d.skypeEnabled=!0,d.destinations=t.observableArray(),d.newDestination=t.observable(m),d.hideDestinationSelector=t.observable(!0),d.hideNewDestinationContainer=t.observable(!0),d.hideSkypeCreditContainer=t.observable(!0),d.selectedCountry=t.observable(),d.skypeOutInput=t.observable(""),d.newDestinationInputHasFocus=t.observable(!1),d.purchaseCreditUrl=o.commerce.purchaseCreditUrl,g=d.selectedCountry.subscribe(D),d.isPstnSmsOnly=e.isPstnSmsOnly||!1,d.hideSkypeNetworkSelector=t.pureComputed(function(){return d.destination()===n.messageDestination.SKYPE_NETWORK}),d.destinationDisplay=t.pureComputed(function(){var e=d.destination();return e!==n.messageDestination.SKYPE_NETWORK&&C(),e===n.messageDestination.SKYPE_NETWORK?r.fetch({key:"sms_message_destination_skype"}):r.fetch({key:"sms_message_destination_sms",params:{phone:e}})}),d.isNewDestinationAvailable=t.pureComputed(function(){return O(d.newDestination())}),d.init=function(){_(),x(d.destination())},d.openDestinationsList=function(){d.hideDestinationSelector(!1),s.add(b,d.cancel)},d.openNewDestinationWindow=function(){T(),d.hideNewDestinationContainer(!1),s.add(y,d.cancel),d.newDestinationInputHasFocus(!0)},d.openSkypeCreditContainerWindow=function(){d.hideSkypeCreditContainer(!1),s.add(w,d.cancel)},d.addCreditTelemetryFromSms=function(){return u.addingCredit(a.SMS_ADD_CREDIT),!0},d.confirm=function(){function t(){d.destinations.push({phone:e,persistent:!1})}var e=B(d.newDestination());if(!O(e))return;d.destination(e),N(),j(),d.conversation.participants()[0].person.addPhoneNumber(e).then(t,F.bind(this,h))},d.cancel=function(){N(),T(),j(),A()},d.setDestinationToSkype=function(){d.destination(n.messageDestination.SKYPE_NETWORK),T()},d.selectDestination=function(e){d.destination(e.phone),T()},d.removeDestination=function(e){function t(){d.destinations.remove(e),d.destinations().length===0&&d.setDestinationToSkype()}d.conversation.participants()[0].person.removePhoneNumber(e.phone).then(t,F.bind(this,p))},d.dispose=function(){g.dispose(),s.remove(b),s.remove(y),S&&E._balance.changed.off(L)},d.onKeyUp=function(e,t){switch(t.keyCode){case i.ENTER:d.confirm()}},d.init()}var t=e("vendor/knockout"),n=e("swx-constants").COMMON,r=e("swx-i18n").localization,i=e("swx-constants").KEYS,s=e("utils/common/outsideClickHandler"),o=e("experience/settings"),u=e("telemetry/calling/pstn/pstn"),a=e("swx-constants").COMMON.telemetry.chat,f=e("swx-cafe-application-instance"),l=e("swx-log-tracer").getLogger(),c=e("swx-service-locator-instance").default,h="adding_number",p="removing_number";return d}),define("text!views/chat/messageDestinationPicker.html",[],function(){return'<div class="destination-picker">\r\n    <span class=\'viaText\' data-bind="l10n: {key: \'sms_via_text\'};"></span>\r\n    <a href="#" class=\'destinationPickerText\' data-bind="text:destinationDisplay, event: {click: openDestinationsList}" title="Switch to sms" aria-label="Switch to sms"></a>\r\n\r\n    <!-- ko ifnot: hideDestinationSelector -->\r\n    <div role="list" class="destinationSelectorContainer popup arrow down" data-bind=" keyboardNavigation: { itemSelector: \'.number\' }">\r\n       <!-- ko if: skypeEnabled -->\r\n        <a class="turnOffSMS" data-bind="click:setDestinationToSkype, css:{hide: hideSkypeNetworkSelector}">\r\n            <button class="turnOffSMSButton" data-bind="l10n: {key: \'sms_turn_off_sms_sending\'};"></button>\r\n        </a>\r\n        <!-- /ko -->\r\n        <div class="title" data-bind="l10n: { key: \'sms_send_sms_to_section_title\'};"></div>\r\n        <ul class="destinationsList"  data-bind="foreach:destinations">\r\n            <li>\r\n                <div class="number" role="listitem" data-bind="enterKey:$parent.selectDestination, click:$parent.selectDestination, text:$data.phone, attr: {title: $data.phone}"></div>\r\n                <!-- ko if: !$data.persistent -->\r\n                <button class="iconfont delete" data-bind="click:$parent.removeDestination" title="Delete number" aria-label="Delete number"></button>\r\n                <!-- /ko -->\r\n            </li>\r\n        </ul>\r\n        <a class="addNumber" data-bind="click:openNewDestinationWindow">\r\n            <button class="addNumberButton" data-bind="l10n: { key: \'sms_add_phone_number\'};"></button>\r\n        </a>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <div class="newDestinationContainer popup arrow down" data-bind="css:{hide:hideNewDestinationContainer}">\r\n        <div class="title" data-bind="l10n: { key: \'sms_add_phone_number_dialog_text\', params: { accountDisplayName: conversation.topic }};"></div>\r\n\r\n        <swx-countrypicker params="selectedCountry: selectedCountry, skypeOutInput: skypeOutInput"></swx-countrypicker>\r\n\r\n        <input type="text" data-bind="textInput: newDestination, event:{keyup: onKeyUp}, hasFocus:newDestinationInputHasFocus" />\r\n\r\n        <div class="confirmButtonsContainer">\r\n            <swx-button params="cssClass: \'secondary\', textKey: \'action_button_cancel\', titleKey: \'action_button_cancel\', ariaLabelKey: \'action_button_cancel\', action: cancel"></swx-button>\r\n\r\n            <swx-button params="cssClass: \'primary\', disabled: !isNewDestinationAvailable(), textKey: \'action_button_confirm\', titleKey: \'action_button_confirm\', ariaLabelKey: \'action_button_confirm\', action: confirm"></swx-button>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="buySkypeCreditContainer popup arrow down" data-bind="css:{hide:hideSkypeCreditContainer}">\r\n        <div class=\'title\' data-bind="l10n: {key: \'sms_insufficient_balance\'}"></div>\r\n        <a data-bind="attr: {href: purchaseCreditUrl}, l10n: {key: \'credit_purchase_link_text\'}, click: addCreditTelemetryFromSms" target=\'_blank\'></a>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/chat/messageDestinationPicker",["require","exports","module","ui/viewModels/chat/messageDestinationPicker","constants/components","text!views/chat/messageDestinationPicker.html"],function(e,t){function r(e){return new n(e)}var n=e("ui/viewModels/chat/messageDestinationPicker");t.name=e("constants/components").chat.MESSAGE_DESTINATION_PICKER,t.template=e("text!views/chat/messageDestinationPicker.html"),t.viewModel={createViewModel:r}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-sms-price-web-service/lib/smsPriceWebService",["require","exports","swx-xhr-dispatcher"],e)}(function(e,t){function r(e,t){function i(t,n){return e().then(function(e){var i="skype",s="skype.client.sms.1way",o={headers:{"X-Skypetoken":e},params:{number:n,organizationId:i,flowId:s},reporting:{serviceName:"smsPrice"}},u="/skypesms/v1/user/"+t+"/price";return r.get(u,o)})}var r=n.build(t);return{getSmsPrice:i}}var n=e("swx-xhr-dispatcher");t.build=r}),define("swx-sms-price-web-service",["swx-sms-price-web-service/lib/smsPriceWebService"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-jskype-main/lib/services/smsPrice/instance",["require","exports","swx-jskype-internal-application-instance","jskype-settings-instance","swx-sms-price-web-service"],e)}(function(e,t){function o(){var e;return s||(e=n.get().signInManager._skypeToken,s=i.build(e,{host:r.settings.smsPriceWebService.host})),s}var n=e("swx-jskype-internal-application-instance"),r=e("jskype-settings-instance"),i=e("swx-sms-price-web-service"),s;t.get=o}),define("ui/viewModels/chat/smsPrice",["require","vendor/knockout","swx-constants","swx-i18n","lodash-compat","experience/settings","swx-jskype-main/lib/services/smsPrice/instance","utils/common/eventMixin","swx-jskype-main/lib/utils/chat/smsMessageBuilder"],function(e){function f(e){function h(e,t){var n=new Promise(function(n){var r=t.replace("+","");o.get().getSmsPrice(e,r).then(function(t){p(t,r),n()},function(t){var r=c.FAILURE_REQUEST;t&&t.status===400&&(r=c.BAD_NUMBER),v(r),n()})});return n}function p(e,t){if(!e||!e.response){v(c.BAD_RESPONSE);return}var n=e.response,r=n.code,i=r!==200||!n.prices||n.prices.length<=0||!n.currency;if(i){v(c.BAD_RESPONSE);return}l.fetchedCurrency=n.currency;var s=!1;n.prices.forEach(function(e){if(e.number===t){s=!0;if(isNaN(e.price)){v(c.ACCOUNT_PROBLEM);return}l.fetchedPrice=e.price,l.formattedFetchedPrice(d(l.fetchedPrice,l.fetchedCurrency))}},this),!s&&l.formattedFetchedPrice().length===0&&v(c.BAD_RESPONSE)}function d(e,t){return!e&&!t?"":(new Number(e)).toLocaleString(s.locale.i18n,{style:"currency",currency:t})}function v(e){var t;switch(e){case c.BAD_RESPONSE:case c.FAILURE_REQUEST:t=r.fetch({key:"sms_price_info_failed"});break;case c.ACCOUNT_PROBLEM:t=r.fetch({key:"sms_price_info_bad_number_account"});break;case c.BAD_NUMBER:t=r.fetch({key:"sms_price_info_bad_number"})}l.formattedFetchedPrice(""),l.errorMessage(t)}var l=this,c={FAILURE_REQUEST:0,BAD_RESPONSE:1,ACCOUNT_PROBLEM:2,BAD_NUMBER:3};l.fetchedPrice="",l.fetchedCurrency="",l.user=e.conversation.mePerson.id(),l.formattedFetchedPrice=t.observable(""),l.numberOfMessages=t.observable(""),l.errorMessage=t.observable(""),l.destination=e.destination&&e.destination(),l.init=function(){l.destination&&l.updateSmsPrice({destination:l.destination,inputText:""}),l.registerEvent(n.events.textarea.UPDATE_SMS_DESTINATION,l.updateSmsPrice),l.registerEvent(n.events.textarea.UPDATE_SMS_FRAGMENTS,l.updateSmsFragments)},l.updateSmsPrice=function(e){var t=e.destination,r=e.inputText;l.fetchedPrice=undefined,l.numberOfMessages(""),l.formattedFetchedPrice(""),l.errorMessage("");if(t===n.messageDestination.SKYPE_NETWORK)return;var i=h(l.user,t);i.then(function(){l.updateSmsFragments(r)})},l.updateSmsFragments=function(e){var t;e===""?t=0:t=a.calculateSmsFragments(e);if(t===-1)return;l.numberOfMessages(t);if(!isNaN(l.fetchedPrice)&&l.fetchedCurrency){var n=t===0?l.fetchedPrice:t*l.fetchedPrice;l.formattedFetchedPrice(d(n,l.fetchedCurrency))}},i.assign(f.prototype,u)}var t=e("vendor/knockout"),n=e("swx-constants").COMMON,r=e("swx-i18n").localization,i=e("lodash-compat"),s=e("experience/settings"),o=e("swx-jskype-main/lib/services/smsPrice/instance"),u=e("utils/common/eventMixin"),a=e("swx-jskype-main/lib/utils/chat/smsMessageBuilder");return f}),define("text!views/chat/smsPrice.html",[],function(){return"<div class='smsPriceContainer'>\r\n\r\n    <!-- ko if: numberOfMessages()!=='' -->\r\n    <span class='smsNumberCircle' data-bind='text:numberOfMessages'></span>\r\n    <!-- /ko -->\r\n\r\n    <span class='formatPrice' data-bind='text:formattedFetchedPrice'></span>\r\n\r\n    <!-- ko if: errorMessage().length > 0 -->\r\n    <span class='iconfont warning' data-bind=' attr: {title: errorMessage}'></span>\r\n    <!-- /ko -->\r\n</div>\r\n"}),define("ui/components/chat/smsPrice",["require","exports","module","ui/viewModels/chat/smsPrice","vendor/knockout","constants/components","text!views/chat/smsPrice.html"],function(e,t){function i(e,t){var i=t.element,s=new n(e),o=r.dataFor(i);return s.setContext(o),s.init(),s}var n=e("ui/viewModels/chat/smsPrice"),r=e("vendor/knockout");t.name=e("constants/components").chat.SMS_PRICE,t.template=e("text!views/chat/smsPrice.html"),t.viewModel={createViewModel:i}}),define("ui/components/chat/index",["require","ui/components/chat/chatLog","ui/components/chat/chatInput","ui/components/chat/conversation","ui/components/chat/groupSearch","ui/components/chat/messagesSearch","ui/components/chat/inviteLink","ui/components/chat/headerNewConversation","ui/components/chat/message","ui/components/chat/navigation","ui/components/chat/newConversation","ui/components/chat/contactPickerInput","ui/components/chat/spaceSettings","ui/components/chat/recents","ui/components/chat/textarea","ui/components/chat/sidebar","ui/components/chat/contactPill","ui/components/chat/contactCard","ui/components/chat/menuItem","ui/components/chat/header","ui/components/chat/headerSingleConversation","ui/components/chat/groupProfile","ui/components/chat/isTypingIndicator","ui/components/chat/currentCall","ui/components/chat/unreadMessageCounter","ui/components/chat/currentCallActions","ui/components/chat/recentItem","ui/components/chat/pes/expressionPicker","ui/components/chat/pes/itemsPicker","ui/components/chat/pes/itemRoster","ui/components/chat/conversationShareLink","ui/components/chat/selectedParticipantsConversation","ui/components/chat/conversationCard","ui/components/chat/filePicker","ui/components/chat/notificationsCenter","ui/components/chat/notificationsMenuItem","ui/components/chat/notificationsToggleButton","ui/components/chat/uploadManager","ui/components/chat/fileTransferActivityActions","ui/components/chat/chatInputActionPicker","ui/components/chat/chatInputSendContactCard","ui/components/chat/shareControl","ui/components/chat/chatInputPollButton","ui/components/chat/pollDesigner","ui/components/chat/stickyMessage","ui/components/chat/startConversationOverlay","ui/components/chat/suggestions/suggestionList","ui/components/chat/videoPlayer","ui/components/chat/audioPlayer","ui/components/chat/gifPlayer","ui/components/chat/userListPopup","ui/components/chat/translatorSettings","ui/components/chat/translatorLanguagePicker","ui/components/chat/moreActionsButton","ui/components/chat/heart","ui/components/chat/narrator","ui/components/chat/pes/store/browseTabs","ui/components/chat/muteConversationSettingItem","ui/components/chat/messageDestinationPicker","ui/components/chat/smsPrice"],function(e){return[e("ui/components/chat/chatLog"),e("ui/components/chat/chatInput"),e("ui/components/chat/conversation"),e("ui/components/chat/groupSearch"),e("ui/components/chat/messagesSearch"),e("ui/components/chat/inviteLink"),e("ui/components/chat/headerNewConversation"),e("ui/components/chat/message"),e("ui/components/chat/navigation"),e("ui/components/chat/newConversation"),e("ui/components/chat/contactPickerInput"),e("ui/components/chat/spaceSettings"),e("ui/components/chat/recents"),e("ui/components/chat/textarea"),e("ui/components/chat/sidebar"),e("ui/components/chat/contactPill"),e("ui/components/chat/contactCard"),e("ui/components/chat/menuItem"),e("ui/components/chat/header"),e("ui/components/chat/headerSingleConversation"),e("ui/components/chat/groupProfile"),e("ui/components/chat/isTypingIndicator"),e("ui/components/chat/currentCall"),e("ui/components/chat/unreadMessageCounter"),e("ui/components/chat/currentCallActions"),e("ui/components/chat/recentItem"),e("ui/components/chat/pes/expressionPicker"),e("ui/components/chat/pes/itemsPicker"),e("ui/components/chat/pes/itemRoster"),e("ui/components/chat/conversationShareLink"),e("ui/components/chat/selectedParticipantsConversation"),e("ui/components/chat/conversationCard"),e("ui/components/chat/filePicker"),e("ui/components/chat/notificationsCenter"),e("ui/components/chat/notificationsMenuItem"),e("ui/components/chat/notificationsToggleButton"),e("ui/components/chat/uploadManager"),e("ui/components/chat/fileTransferActivityActions"),e("ui/components/chat/chatInputActionPicker"),e("ui/components/chat/chatInputSendContactCard"),e("ui/components/chat/shareControl"),e("ui/components/chat/chatInputPollButton"),e("ui/components/chat/pollDesigner"),e("ui/components/chat/stickyMessage"),e("ui/components/chat/startConversationOverlay"),e("ui/components/chat/suggestions/suggestionList"),e("ui/components/chat/videoPlayer"),e("ui/components/chat/audioPlayer"),e("ui/components/chat/gifPlayer"),e("ui/components/chat/userListPopup"),e("ui/components/chat/translatorSettings"),e("ui/components/chat/translatorLanguagePicker"),e("ui/components/chat/moreActionsButton"),e("ui/components/chat/heart"),e("ui/components/chat/narrator"),e("ui/components/chat/pes/store/browseTabs"),e("ui/components/chat/muteConversationSettingItem"),e("ui/components/chat/messageDestinationPicker"),e("ui/components/chat/smsPrice")]}),define("experience/components/chat",["require","exports","module","experience/settings","swx-constants","swx-service-locator-instance","swx-utils-common","swx-utils-chat","swx-utils-chat","ui/components/chat/index","ui/components/registrar"],function(e,t){var n=e("experience/settings"),r=e("swx-constants").COMMON,i=e("swx-service-locator-instance").default,s=e("swx-utils-common").loader,o=e("swx-utils-chat").urlParser,u=e("swx-utils-chat").dateTime,a=e("ui/components/chat/index"),f=e("ui/components/registrar");t.init=function(e){var t=i.resolve(r.serviceLocator.FEATURE_FLAGS);t.isFeatureOn(r.featureFlags.LOCATION_MESSAGE_SUPPORT)&&s.loadScript(n.mapsApiUrl+(o.isHttps(location.href)?"&s=1":"")),u.notifyOnDayChange(),f.register(a),e()}}),define("ui/viewModels/commerce/creditBalance",["require","exports","module","utils/common/cafeObservable","swx-cafe-application-instance","experience/settings","telemetry/calling/pstn/pstn","swx-constants"],function(e,t){function u(){var e=this,t=r.get().personsAndGroupsManager.mePerson.account;e.displayBalance=n.newObservableProperty(t.displayBalance,{keepAlive:!0}),e.purchaseCreditUrl=i.commerce.purchaseCreditUrl,e.addCreditTelemetry=function(){return s.addingCredit(o.entryPoint.SKYPE_OUT_PAGE),!0}}var n=e("utils/common/cafeObservable"),r=e("swx-cafe-application-instance"),i=e("experience/settings"),s=e("telemetry/calling/pstn/pstn"),o=e("swx-constants").COMMON.telemetry.pstn;u.prototype.dispose=function(){this.displayBalance.dispose()},t.classFunction=u,t.build=function(){return new u}}),define("text!views/commerce/creditBalance.html",[],function(){return'<p class="SkypeOutOffer-title fontSize-h4" data-bind="l10n: { key: \'credit_balance_text\' }"></p>\r\n<div class="SkypeOutOffer-body" data-swx-testId="skypeOut-credit">\r\n    <span class="iconfont skypeCreditFill SkypeOutOffer-icon SkypeOutOffer-icon--skypeCreditFill"></span>\r\n    <div class="SkypeOutOffer-content">\r\n        <p class="SkypeOutOffer-message" data-bind="html: displayBalance"></p>\r\n        <p class="SkypeOutOffer-buyCredit">\r\n            <a data-bind="attr: {href: purchaseCreditUrl}, l10n: {key: \'credit_purchase_link_text\'}, click: addCreditTelemetry" target="_blank"></a>\r\n        </p>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/commerce/creditBalance",["require","exports","module","ui/viewModels/commerce/creditBalance","constants/components","text!views/commerce/creditBalance.html"],function(e,t){function r(){return n.build()}var n=e("ui/viewModels/commerce/creditBalance");t.name=e("constants/components").commerce.CREDIT_BALANCE,t.template=e("text!views/commerce/creditBalance.html"),t.viewModel={createViewModel:r}}),define("ui/viewModels/commerce/subscriptionEntitlement",["require","exports","module","lodash-compat","vendor/knockout","swx-i18n","swx-enums","experience/settings","swx-cafe-application-instance","telemetry/calling/pstn/pstn","utils/common/cafeObservable","swx-constants"],function(e,t){function c(){function h(){var e=n.filter(c(),p).length,t,r={count:e};switch(e){case 0:t="no_subscriptions_text";break;case 1:t="subscriptions_text_one";break;default:t="subscriptions_text_many"}return i.fetch({key:t,params:r})}function p(e){return e.active()&&(e.type()===s.subscriptionType.Package||e.type()===s.subscriptionType.Plan)}var e=this,t=u.get().personsAndGroupsManager.mePerson.account,c=f.newObservableCollection(t.entitlements);e.showSubscriptionsText=r.observable(!1),e.subscriptionsText=r.computed(h),e.purchaseSubscriptionUrl=o.commerce.purchaseSubscriptionUrl,t.entitlements.get().then(function(){e.showSubscriptionsText(!0)}),e.addSubscriptionTelemetry=function(){return a.addingSubscription(l.entryPoint.SKYPE_OUT_PAGE),!0}}var n=e("lodash-compat"),r=e("vendor/knockout"),i=e("swx-i18n").localization,s=e("swx-enums"),o=e("experience/settings"),u=e("swx-cafe-application-instance"),a=e("telemetry/calling/pstn/pstn"),f=e("utils/common/cafeObservable"),l=e("swx-constants").COMMON.telemetry.pstn;c.prototype.dispose=function(){this.subscriptionsText.dispose()},t.classFunction=c,t.build=function(){return new c}}),define("text!views/commerce/subscriptionEntitlement.html",[],function(){return'<p class="SkypeOutOffer-title fontSize-h4" data-bind="l10n: { key: \'subscription_entitlement_text\' }"></p>\r\n<div class="SkypeOutOffer-body" data-swx-testId="skypeOutPage-subscrptions">\r\n    <span class="iconfont calendarDay SkypeOutOffer-icon SkypeOutOffer-icon--skypeSubscriptionFill"></span>\r\n    <div class="SkypeOutOffer-content">\r\n\r\n        <p class="SkypeOutOffer-message">\r\n            <!-- ko if: showSubscriptionsText -->\r\n            <span data-bind="text: subscriptionsText"></span>\r\n            <!-- /ko -->\r\n        </p>\r\n        <p class="SkypeOutOffer-buySubscription">\r\n            <a data-bind="attr: {href: purchaseSubscriptionUrl}, l10n: {key: \'subscription_purchase_link_text\'}, click: addSubscriptionTelemetry" target="_blank"></a>\r\n        </p>\r\n    </div>\r\n</div>\r\n'}),define("ui/components/commerce/subscriptionEntitlement",["require","exports","module","ui/viewModels/commerce/subscriptionEntitlement","constants/components","text!views/commerce/subscriptionEntitlement.html"],function(e,t){function r(){return n.build()}var n=e("ui/viewModels/commerce/subscriptionEntitlement");t.name=e("constants/components").commerce.SUBSCRIPTION_ENTITLEMENT,t.template=e("text!views/commerce/subscriptionEntitlement.html"),t.viewModel={createViewModel:r}}),define("ui/components/commerce/index",["require","ui/components/commerce/creditBalance","ui/components/commerce/subscriptionEntitlement"],function(e){return[e("ui/components/commerce/creditBalance"),e("ui/components/commerce/subscriptionEntitlement")]}),define("experience/components/commerce",["require","exports","module","swx-constants","swx-service-locator-instance","ui/components/commerce/index","ui/components/registrar"],function(e,t){function o(){var e=r.resolve(n.serviceLocator.FEATURE_FLAGS);e.isFeatureOn(n.featureFlags.PSTN_ENABLED)&&s.register(i)}var n=e("swx-constants").COMMON,r=e("swx-service-locator-instance").default,i=e("ui/components/commerce/index"),s=e("ui/components/registrar");t.init=function(e){o(),e()}}),define("ui/viewModels/userSettings/preferenceMapping",["require","exports","module","swx-constants","swx-browser-detect"],function(e,t){var n=e("swx-constants").COMMON.userSettings,r=e("swx-browser-detect").default.BROWSERS;t.groups={CONTACTS:{id:n.categories.CONTACTS,titleI18NKey:"settings_contacts_category_title"},IM_SETTINGS:{id:n.categories.IM_SETTINGS,titleI18NKey:"settings_im_settings_category_title"},IM_APPEARANCE:{id:n.categories.IM_APPEARANCE,titleI18NKey:"settings_im_appearance_category_title"},PRIVACY:{id:n.categories.PRIVACY,titleI18NKey:"settings_privacy_category_title"},UNLISTED:{id:n.categories.UNLISTED,titleI18NKey:"settings_unlisted_category_title"},NOTIFICATIONS:{id:n.categories.NOTIFICATIONS,titleI18NKey:"settings_notifications_category_title"},PERSONALIZATION:{id:n.categories.PERSONALIZATION,titleI18NKey:"settings_personalization_category_title"}},t.templates={TOGGLE:"pref-template-boolean",SELECT:"pref-template-select",AUTO_BUDDY:"pref-template-autoBuddy",AUTO_BUDDY_DISCOVERY:"pref-template-autoBuddyDiscovery",NOTIFICATIONS:"pref-template-boolean",RINGING_DEFERRER:"pref-template-ringingDeferrer"},t.mapping={},t.mapping[n.preferences.DYNAMIC_DISCOVERY]={category:t.groups.CONTACTS.id},t.mapping[n.preferences.MENTIONS]={category:t.groups.IM_SETTINGS.id,titleKey:"settings_mentionsEnabled_title",altTextKey:"settings_mentionsEnabled_alt_text"},t.mapping[n.preferences.FILE_PASTE]={category:t.groups.IM_SETTINGS.id,titleKey:"settings_filePaste_title",altTextKey:"settings_filePaste_alt_text",supportedBrowsers:[r.CHROME,r.EDGE,r.ELECTRON]},t.mapping[n.preferences.TYPING_INDICATOR]={category:t.groups.IM_SETTINGS.id,titleKey:"settings_typingIndicator_title",altTextKey:"settings_typingIndicator_alt_text"},t.mapping[n.preferences.SKYPE_CALL_POLICY_SUPPORT]={category:t.groups.PRIVACY.id,titleKey:"settings_skypeCallPolicy_title",altTextKey:""},t.mapping[n.preferences.SKYPE_VIDEO_CALLING_POLICY_SUPPORT]={category:t.groups.PRIVACY.id,titleKey:"settings_skypeVideoPolicy_title",altTextKey:""},t.mapping[n.preferences.READ_RECEIPT]={category:t.groups.PRIVACY.id,titleKey:"settings_sendReadReceipts_title",altTextKey:"settings_sendReadReceipts_alt_text"},t.mapping[n.preferences.URL_PREVIEWS]={category:t.groups.IM_APPEARANCE.id,titleKey:"settings_urlPreview_title",altTextKey:"settings_urlPreview_alt_text"},t.mapping[n.preferences.YOUTUBE_PLAYER]={category:t.groups.IM_SETTINGS.id,titleKey:"settings_youtube_player_title",altTextKey:"settings_youtube_player_alt_text"},t.mapping[n.preferences.AUTO_BUDDY]={category:t.groups.CONTACTS.id,titleKey:"settings_short_circuit_title",template:t.templates.AUTO_BUDDY},t.mapping[n.preferences.AUTO_BUDDY_DISCOVERY]={category:t.groups.CONTACTS.id,template:t.templates.AUTO_BUDDY_DISCOVERY},t.mapping[n.preferences.NOTIFICATIONS]={category:t.groups.NOTIFICATIONS.id,titleKey:"settings_notifications_title",altTextKey:"settings_notifications_alt_text"},t.mapping[n.preferences.NOTIFICATIONS_SOUND]={category:t.groups.NOTIFICATIONS.id,titleKey:"settings_notifications_sound_title",altTextKey:"settings_notifications_sound_alt_text"},t.mapping[n.preferences.DEFER_RINGING_SOUND]={category:t.groups.NOTIFICATIONS.id,titleKey:"settings_ringing_deferrer_title",altTextKey:"settings_ringing_deferrer_alt_text",template:t.templates.RINGING_DEFERRER},t.mapping[n.preferences.CHAT_NOTIFICATIONS_SOUND]={category:t.groups.NOTIFICATIONS.id,titleKey:"settings_chat_notifications_sound_title",altTextKey:"settings_chat_notifications_sound_alt_text"},t.mapping[n.preferences.CALL_NOTIFICATIONS]={category:t.groups.NOTIFICATIONS.id,titleKey:"settings_call_notifications_title",altTextKey:"settings_call_notifications_alt_text"},t.mapping[n.preferences.CALL_NOTIFICATIONS_SOUND]={category:t.groups.NOTIFICATIONS.id,titleKey:"settings_call_notifications_sound_title",altTextKey:"settings_call_notifications_sound_alt_text"},t.mapping[n.preferences.EMOTICON_SUGGESTIONS]={category:t.groups.IM_SETTINGS.id,titleKey:"settings_emoticonSuggestions_title",altTextKey:"settings_emoticonSuggestions_alt_text"},t.mapping[n.preferences.SHOW_EMOTICONS]={category:t.groups.IM_APPEARANCE.id,titleKey:"settings_showEmoticons_title",altTextKey:"settings_showEmoticons_alt_text"},t.mapping[n.preferences.SHOW_ANIMATED_EMOTICONS]={category:t.groups.IM_APPEARANCE.id,titleKey:"settings_showAnimatedEmoticons_title",altTextKey:"settings_showAnimatedEmoticons_alt_text"},t.mapping[n.preferences.SHOW_LARGE_EMOTICONS]={category:t.groups.IM_APPEARANCE.id,titleKey:"settings_showLargeEmoticons_title",altTextKey:"settings_showLargeEmoticons_alt_text"},t.mapping[n.preferences.DARK_THEME]={category:t.groups.PERSONALIZATION.id,titleKey:"settings_dark_theme",altTextKey:"settings_dark_theme_alt_text"},t.mapping[n.preferences.VIDEO_AUTOPLAY]={category:t.groups.PERSONALIZATION.id,titleKey:"settings_video_autoplay",altTextKey:"settings_video_autoplay_alt_text"}}),define("ui/viewModels/userSettings/utils",["require","exports","module","lodash-compat","swx-enums","swx-constants","swx-i18n","swx-browser-detect","ui/viewModels/userSettings/preferenceMapping"],function(e,t){var n=e("lodash-compat"),r=e("swx-enums"),i=e("swx-constants").COMMON,s=e("swx-i18n").localization,o=e("swx-browser-detect").default,u=e("ui/viewModels/userSettings/preferenceMapping").templates,a=i.userSettings.preferences;t.getPrefCategory=function(e,t,r){var i=r;return e in t?(i=t[e].category,i):(n.keys(t).some(function(n){if(!!e.match(n))return i=t[n].category,!0}),i)},t.getPrefTemplate=function(e,t){var n=t[e.id];if(n&&n.template)return n.template;switch(e.type){case r.preferenceType.Boolean:case r.preferenceType.Notifications:return u.TOGGLE;case r.preferenceType.CallPolicy:case r.preferenceType.VideoPolicy:return u.SELECT;default:return null}},t.getPrefTitle=function(e,t){var n=t[e];return n&&n.titleKey?s.fetch({key:n.titleKey}):e.match(a.DYNAMIC_DISCOVERY)?e.replace(a.DYNAMIC_DISCOVERY+"-",""):s.fetch({key:"settings_unknownOption_title",params:{id:e}})},t.getPrefSecondaryText=function(e,t){var n=t[e];return n&&typeof n.altTextKey!="undefined"?n.altTextKey===""?null:s.fetch({key:n.altTextKey}):s.fetch({key:"settings_unknownOption_alt_text",params:{id:e}})},t.isPrefSupported=function(e,t){function r(){return!!t[e]}function i(){return t[e].hasOwnProperty("supportedBrowsers")}function s(){return n.indexOf(t[e].supportedBrowsers,o.getBrowserInfo().browserName)!==-1}return r()&&(!i()||s())},t.isUnlistedCategory=function(e,t,n,r){function i(){return n.indexOf(t)!==-1}function s(){return r.indexOf(e)!==-1}return i()||s()},t.getCategory=function(e){var t={id:e.id,title:s.fetch({key:e.titleI18NKey}),"@Meta":{typeKey:"id"},preferenceItems:[]};return t.preferenceItems["@Meta"]={typeKey:"template"},t}}),define("telemetry/settings/settingsPageTelemetry",["require","lodash-compat","swx-utils-common","swx-constants","experience/settings","ui/telemetry/telemetryClient"],function(e){function o(){}function u(e){var t={};return t[r.telemetry.userSettings.property.ITEM_NAME]=(e?e:r.telemetry.userSettings.UNKNOWN).toString(),t[r.telemetry.userSettings.property.ITEM_VALUE]=r.telemetry.userSettings.UNKNOWN,t[r.telemetry.userSettings.property.OPERATION_OUTCOME]=r.telemetry.userSettings.outcomeNames.SUCCESS,t}var t=e("lodash-compat"),n=e("swx-utils-common").builderMixin,r=e("swx-constants").COMMON,i=e("experience/settings"),s=e("ui/telemetry/telemetryClient");return o.prototype.sendShowPanelEvent=function(t){var n=u(t);s.get().sendEvent(i.telemetry.uiTenantToken,r.telemetry.userSettings.eventName.PANEL_SHOWN,n)},o.prototype.sendDismissPageEvent=function(t){var n=u("");n[r.telemetry.userSettings.property.OPERATION_DURATION]=isNaN(parseInt(t))?r.telemetry.userSettings.UNKNOWN:parseInt(t),s.get().sendEvent(i.telemetry.uiTenantToken,r.telemetry.userSettings.eventName.PAGE_DISMISSED,n)},t.assign(o,n),o}),define("ui/viewModels/userSettings/preferenceViewModel",["require","exports","module","lodash-compat","swx-enums","swx-constants","swx-i18n","swx-g11n","vendor/knockout","swx-log-tracer","browser/dom","ui/viewModels/userSettings/utils","ui/shortCircuit/shortCircuit","swx-service-locator-instance","ui/telemetry/actions/actionNames","ui/viewModels/userSettings/preferenceMapping","swx-focus-handler","notifications/ringingDeferrer/ringingDeferrerUtil"],function(e,t){function g(e,t,d){function b(e){h.resolve(i.serviceLocator.ACTION_TELEMETRY).recordAction(e)}function w(t){t=t||n.noop,g.toggleValue=function(){e.value.set(!e.value()),t()},g.activate=function(){g.toggleValue()}}function E(){var t=".pref-select-element > select",n=["settings_privacy_opt_1_title","settings_privacy_opt_2_title","settings_privacy_opt_3_title"];g.uiValue=function(t){return t=u.unwrap(t),t>=0&&t<n.length?s.fetch({key:n[t]}):null},g.activate=function(e){var n=f.getElement(t,e.target);n&&v.get().addFocusRequestToQueue(n)},g.optionChanged=function(n){e.value.set(n.value())},g.preventPropagation=function(e,t){return t.stopPropagation(),!0}}function S(){function e(){function e(e,t){e.push({id:t,text:u.observable(s.fetch({key:"settings_ringing_deferrer_defer_for",count:t}))})}var t=[];return e(t,r.ringingDeferrerOptions.Defer4Hours),e(t,r.ringingDeferrerOptions.Defer8Hours),e(t,r.ringingDeferrerOptions.Defer24Hours),t}function t(){var e=g.uiSelectOptions(),t=m.getCurrentSetting();if(!t)return null;for(var n=0;n<e.length;n++)if(e[n].id===t.option)return e[n].id;return null}g.uiToggled=u.observable(!1),g.uiToggleClicked=function(){var e;m.areRingingSoundsDeferred()?e=r.ringingDeferrerOptions.Unset:e=r.ringingDeferrerOptions.Defer4Hours,m.applyOption(e)},g.uiSelectOptions=u.observableArray(e()),g.uiSelectedOption=u.observable(t()),g.uiSelectedOptionChanged=function(e){var t=e.uiSelectedOption(),n=m.getCurrentSetting();if(t===n.option)return;m.applyOption(t)},g.uiUpdateSelectOptionsTexts=function(){function t(t){var n=s.fetch({key:"settings_ringing_deferrer_defer_for",count:t});return t===e.option&&(n+=" ("+o.formatDate(new Date(e.untilTimestamp),i.globalizationFormatKeys.time.SHORT)+")"),n}var e=m.getCurrentSetting();if(!e)return;for(var n=0;n<g.uiSelectOptions().length;n++){var r=g.uiSelectOptions()[n];r.text(t(r.id))}},g.activate=function(e){var t=".pref-select-element > select",n=f.getElement(t,e.target);n&&v.get().addFocusRequestToQueue(n)},g.preventPropagation=function(e,t){return t.stopPropagation(),!0}}function x(){var t=h.resolve(i.serviceLocator.ACTION_TELEMETRY);g.id===i.userSettings.preferences.NOTIFICATIONS?t.recordAction(p.notificationsSettings.toggleNotifications,{enabled:!e.value()}):g.id===i.userSettings.preferences.NOTIFICATIONS_SOUND&&t.recordAction(p.notificationsSettings.toggleSound,{enabled:!e.value()})}function T(t){return function(){var n=h.resolve(i.serviceLocator.ACTION_TELEMETRY);switch(t){case i.shortCircuit.scenarios.MANAGE_ADDRESSBOOKS:n.recordAction(p.shortCircuit.manageAddressBooks);break;case i.shortCircuit.scenarios.ADD_VERIFIED_PHONE:n.recordAction(p.shortCircuit.addNewNumber)}c.build().open(t).then(function(){e.value.get()})}}function N(e){return e.toString().replace(/\B(?=(\d{1})+(?!\d))/g,",")}var g=this,y=e.description.type;g.id=e.description.id,g.uiState=r.preferenceValueState.Unknown,g.value=null,g.ariaId="userSettings-"+g.id,g.disabled=u.observable(!1),g.template=l.getPrefTemplate(e.description,t),g.title=l.getPrefTitle(g.id,t),g.secondaryText=l.getPrefSecondaryText(g.id,t);switch(y){case r.preferenceType.Boolean:w();break;case r.preferenceType.CallPolicy:g.uiOptions=[r.privacyPolicyValues.Anyone,r.privacyPolicyValues.ContactsOnly],E();break;case r.preferenceType.VideoPolicy:g.uiOptions=[r.privacyPolicyValues.Anyone,r.privacyPolicyValues.ContactsOnly,r.privacyPolicyValues.NoOne],E();break;case r.preferenceType.AutoBuddy:g.launchShortCircuit=T(i.shortCircuit.scenarios.MANAGE_ADDRESSBOOKS),w(b.bind(g,p.shortCircuit.toggleAutoBuddy));break;case r.preferenceType.AutoBuddyDiscovery:g.launchPNV=T(i.shortCircuit.scenarios.ADD_VERIFIED_PHONE);break;case r.preferenceType.AutoBuddyDiscoveryEmail:g.showToggle=!1,g.showRemoveLink=!1;break;case r.preferenceType.AutoBuddyDiscoveryPhone:g.showToggle=!0,g.showRemoveLink=!0,g.ariaLabel=N(g.title),g.removeAriaLabel=s.fetch({key:"settings_short_circuit_remove_accessible_text",params:{proof:g.ariaLabel}}),g.remove=function(){h.resolve(i.serviceLocator.ACTION_TELEMETRY).recordAction(p.shortCircuit.deleteNumber),e.value.set(null).then(function(){d.value.get()})},w(b.bind(g,p.shortCircuit.togglePhoneProof));break;case r.preferenceType.Notifications:w(x.bind(g));break;case r.preferenceType.RingingDeferrer:S();break;default:a.log("UNKNOWN PREFERENCE TYPE!",g.id)}}var n=e("lodash-compat"),r=e("swx-enums"),i=e("swx-constants").COMMON,s=e("swx-i18n").localization,o=e("swx-g11n").globalization,u=e("vendor/knockout"),a=e("swx-log-tracer").getLogger(),f=e("browser/dom"),l=e("ui/viewModels/userSettings/utils"),c=e("ui/shortCircuit/shortCircuit"),h=e("swx-service-locator-instance").default,p=e("ui/telemetry/actions/actionNames"),d=e("ui/viewModels/userSettings/preferenceMapping").mapping,v=e("swx-focus-handler"),m=e("notifications/ringingDeferrer/ringingDeferrerUtil");t.Preference=g,t.build=function(e,t){return new g(e,d,t)}}),define("ui/viewModels/userSettings/userSettingsPageViewModel",["require","lodash-compat","swx-cafe-application-instance","swx-utils-common","swx-utils-common","swx-util-calling-stack","swx-i18n","swx-constants","browser/dom","swx-utils-common","swx-enums","utils/common/eventHelper","utils/common/eventMixin","vendor/knockout","utils/common/scroll","swx-service-locator-instance","utils/common/disposableMixin","utils/common/stateMixin","ui/viewModels/userSettings/utils","telemetry/settings/settingsPageTelemetry","experience/settings","ui/viewModels/userSettings/preferenceMapping","ui/viewModels/userSettings/preferenceMapping","ui/viewModels/userSettings/preferenceViewModel","notifications/settings","utils/common/styleModeHelper","notifications/ringingDeferrer/ringingDeferrerUtil"],function(e){function D(e){function r(e){return y.isPrefSupported(e.description.id,x)}var n=[y.getCategory(T.NOTIFICATIONS),y.getCategory(T.CONTACTS),y.getCategory(T.IM_SETTINGS),y.getCategory(T.IM_APPEARANCE),y.getCategory(T.PRIVACY),y.getCategory(T.UNLISTED),y.getCategory(T.PERSONALIZATION)];return t.filter(e,r).forEach(function(e){var r=e.description.id,i=y.getPrefCategory(r,x,T.UNLISTED.id),s=t.find(n,{id:i});y.isUnlistedCategory(r,i,E,S)&&(s=t.find(n,{id:T.UNLISTED.id})),s&&s.preferenceItems.push(N.build(e))}),n}function P(e){var n=t(this.model.categories).pluck("preferenceItems").flatten().find({id:e});if(!n&&!!e.match(u.userSettings.preferences.DYNAMIC_DISCOVERY)){var r=t.find(this.model.categories,{id:"contacts"});n=t(t.map(r.preferenceItems,"value").filter(t.isArray)[0]).find({id:e})}return n}function H(e){return e.categories=t.reject(e.categories,function(e){return e.preferenceItems.length===0}),e}function B(e){return e.categories=t.reject(e.categories,function(e){return e.id===T.UNLISTED.id}),e}function j(e,n){var r,i=e.description.id,s=e.description.type,o=P.call(this,i),a=u.userSettings.preferences,f;if(s===A.AutoBuddyDiscovery&&t.isArray(n)){r=t.map(n,function(t){return N.build(t,e)}),o.value=r,R.call(this,n),this.applyState(this.model);return}i===a.NOTIFICATIONS&&C.chatNotificationsMuted(!n),i===a.NOTIFICATIONS&&this.isNotificationSoundsSettingEnabled&&(f=P.call(this,a.NOTIFICATIONS_SOUND),n===!1&&f.value===!0&&f.toggleValue(),f.disabled=p.observable(!n)),i===a.NOTIFICATIONS&&!this.isNotificationSoundsSettingEnabled&&L.isFeatureEnabled()&&(f=P.call(this,a.DEFER_RINGING_SOUND),f.disabled=p.observable(!n),n||L.applyOption(l.ringingDeferrerOptions.Unset)),i===a.NOTIFICATIONS_SOUND&&C.notificationsSoundMuted(!n),i===a.NOTIFICATIONS_SOUND&&L.isFeatureEnabled()&&(f=P.call(this,a.DEFER_RINGING_SOUND),f.disabled=p.observable(!n),n||L.applyOption(l.ringingDeferrerOptions.Unset)),i===a.DEFER_RINGING_SOUND&&(L.areRingingSoundsDeferred()?(o.uiToggled(!0),o.uiUpdateSelectOptionsTexts(),o.uiSelectedOption(n.option)):o.uiToggled(!1)),i===a.CHAT_NOTIFICATIONS_SOUND&&C.chatNotificationsSoundMuted(!n),i===a.NOTIFICATIONS&&this.isChatNotificationSoundsSettingEnabled&&(f=P.call(this,a.CHAT_NOTIFICATIONS_SOUND),n===!1&&f.value===!0&&f.toggleValue(),f.disabled=p.observable(!n)),i===a.CALL_NOTIFICATIONS&&C.callNotificationsMuted(!n),i===a.CALL_NOTIFICATIONS&&this.isCallNotificationSoundSettingEnabled&&(f=P.call(this,a.CALL_NOTIFICATIONS_SOUND),n===!1&&f.value===!0&&f.toggleValue(),f.disabled=p.observable(!n)),i===u.userSettings.preferences.DARK_THEME&&!k.get().isIntegratedProperty()&&(n?document.body.classList.add("dark"):document.body.classList.remove("dark")),o.value=n,this.applyState(this.model)}function F(e,t){var n=P.call(this,e);n.uiState===l.preferenceValueState.Unknown&&(n.uiState=t);switch(t){case l.preferenceValueState.Saving:case l.preferenceValueState.Defined:n.uiState=t}this.applyState(this.model)}function I(e){e.selectedCategory=t.head(e.categories)||{},X(e.selectedCategory.id)}function q(e,n){var r=e.selectedCategory.id;e.selectedCategory=t.find(e.categories,{id:n})||{},r!==e.selectedCategory.id&&X(e.selectedCategory.id)}function R(e){t.forEach(e,function(e){this.registerDisposable(e.value.changed(j.bind(this,e))),this.registerDisposable(e.value.state.changed(F.bind(this,e.description.id))),!e.value.get.enabled()&&e.value.get.enabled._set&&e.value.get.enabled._set(!0),e.value.get()},this)}function U(){if(this.fragmentVisibility){v.resolve(u.serviceLocator.PUBSUB).publish(u.events.navigation.NAVIGATE_TO_PREVIOUS_PAGE);return}this.fragmentVisibility=!0,this.pageOpenTimeMark=f.build()}function z(){this.fragmentVisibility=!1,W(this.pageOpenTimeMark),this.pageOpenTimeMark=null,this.pageOpenTimeMark=null}function W(e){b.build().sendDismissPageEvent(e&&e.durationInSeconds())}function X(e){b.build().sendShowPanelEvent(e)}function V(e){this.scrollbar&&this.unregisterDisposable(this.scrollbar),this.scrollbar=d.build(a.getElement(e,this.parentElement)),this.registerDisposable(this.scrollbar),this.scrollbar.init()}function $(e){var t=a.getElement(".UserSettingsPage-list",e);t&&t.focus&&t.focus()}function J(){var e=this,t=w.assetsBaseUrl?w.assetsBaseUrl.match(/\d+.\d+.\d+/):null;this.appVersion(w.version),this.assetsVersion(t?t[0]:""),this.faqLink(w.faqPageUrl),this.isPluginSupported(!s.get().isPluginlessCallingSupported()),n.get().devicesManager.mediaCapabilities.installedVersion.get().then(function(t){e.pluginVersion(t),e.isPluginVersionFetched(!0)},function(){e.pluginVersion(o.fetch({key:"about_plugin_not_available"})),e.isPluginVersionFetched(!0)})}function K(e,n){var i=v.resolve(u.serviceLocator.FEATURE_FLAGS),s,o=this;this.pageOpenTimeMark=null,this.state=g.overrideDefaults({},this.getInitialState()),this.params=g.overrideDefaults({},this.getDefaultParams(),e),this.parentElement=n.element,this.scrollbar=null,this.isAboutPageEnabled=i.isFeatureOn(u.featureFlags.ABOUT_PAGE_ENABLED),this.isAboutPageVisible=p.observable(!1),this.isNotificationSoundsSettingEnabled=i.isFeatureOn(u.featureFlags.NOTIFICATIONS_SOUNDS_SETTING_ENABLED),this.isChatNotificationSoundsSettingEnabled=i.isFeatureOn(u.featureFlags.CHAT_NOTIFICATIONS_SOUND_SETTINGS_ENABLED),this.isCallNotificationSettingEnabled=i.isFeatureOn(u.featureFlags.CALL_NOTIFICATIONS_SETTINGS_ENABLED),this.isCallNotificationSoundSettingEnabled=i.isFeatureOn(u.featureFlags.CALL_NOTIFICATIONS_SOUND_SETTINGS_ENABLED),this.registerDisposable(this.state.selectedCategory.subscribe(function(){r.execute(function(){V.call(this,M)},o,!0)})),this.model={categories:D(this.params.preferences())},this.appVersion=p.observable(),this.assetsVersion=p.observable(),this.pluginVersion=p.observable(),this.faqLink=p.observable(),this.isPluginSupported=p.observable(),this.isPluginVersionFetched=p.observable(!1),H(this.model),i.isFeatureOn(u.featureFlags.SHOW_UNLISTED_SETTINGS)||B(this.model),I(this.model),s=t(this.model.categories).map(function(e){return e.preferenceItems}).flatten().map(function(e){return e.id}).sort().value(),R.call(this,t.filter(this.params.preferences(),function(e){return t.indexOf(s,e.description.id)>=0})),this.applyState(this.model),U.call(this),this.setContext(p.dataFor(n.element)),this.registerEvent(u.events.navigation.FRAGMENT_SHOW,U,h.DIRECTION.ANY,this),this.registerEvent(u.events.navigation.FRAGMENT_HIDE,z,h.DIRECTION.ANY,this),v.resolve(u.serviceLocator.PUBSUB).publish(u.events.navigation.FRAGMENT_REMOVE_ALL_HIDDEN),r.execute($.bind(null,n.element),null,!1),this.isAboutPageEnabled&&J.call(this)}var t=e("lodash-compat"),n=e("swx-cafe-application-instance"),r=e("swx-utils-common").async,i=e("swx-utils-common").builderMixin,s=e("swx-util-calling-stack"),o=e("swx-i18n").localization,u=e("swx-constants").COMMON,a=e("browser/dom"),f=e("swx-utils-common").stopwatch,l=e("swx-enums"),c=e("utils/common/eventHelper"),h=e("utils/common/eventMixin"),p=e("vendor/knockout"),d=e("utils/common/scroll"),v=e("swx-service-locator-instance").default,m=e("utils/common/disposableMixin"),g=e("utils/common/stateMixin"),y=e("ui/viewModels/userSettings/utils"),b=e("telemetry/settings/settingsPageTelemetry"),w=e("experience/settings"),E=w.userSettings.hiddenCategories,S=w.userSettings.hiddenPreferences,x=e("ui/viewModels/userSettings/preferenceMapping").mapping,T=e("ui/viewModels/userSettings/preferenceMapping").groups,N=e("ui/viewModels/userSettings/preferenceViewModel"),C=e("notifications/settings"),k=e("utils/common/styleModeHelper"),L=e("notifications/ringingDeferrer/ringingDeferrerUtil"),A=l.preferenceType,O="about",M=".UserSettingsPage-scroll-area",_=".UserSettingsPage-about-scroll";return K.prototype.switchCategory=function(t,n){var r=p.dataFor(n.target);r&&r.id?(q(this.model,r.id()),this.isAboutPageVisible(!1),this.applyState(this.model)):(V.call(this,_),this.state.selectedCategory().id(O),this.isAboutPageVisible(!0))},K.prototype.getInitialState=function(){return{categories:[],selectedCategory:null}},K.prototype.getDefaultParams=function(){function t(){return e.preferences&&e.preferences()}var e=n.get().personsAndGroupsManager.mePerson;return{preferences:t()||[],eventEmitter:c.emptyEmitter}},t.assign(K.prototype,m),t.assign(K.prototype,g),t.assign(K.prototype,h),t.assign(K,i),K}),define("text!views/userSettings/userSettingsPage.html",[],function(){return'<section class="UserSettingsPage themeWhite" role="region">\r\n    <div class="UserSettingsPage-master">\r\n        <h1 class="UserSettingsPage-heading" data-bind="l10n: { key: \'settings_page_text_header\' }"></h1>\r\n        <ul class="UserSettingsPage-list" role="listbox" tabindex="-1"\r\n            data-bind="click: switchCategory, keyboardNavigation: { itemSelector: \'.UserSettingsPage-category\' }, l10n_attr:{\'aria-label\':\'settings_pane_opened\'}, focusHandler: { priority: 1 }">\r\n            <!-- ko foreach: { data: state.categories, as: \'category\' } -->\r\n            <li role="option">\r\n                <a href="#"  class="UserSettingsPage-category"\r\n                   data-bind="css: { active: $parent.state.selectedCategory() && $parent.state.selectedCategory().id() === category.id() }">\r\n                    <h2 class="UserSettingsPage-label" data-bind="css: category.id, text: category.title, aria-label: category.title"></h2>\r\n                </a>\r\n            </li>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: isAboutPageEnabled -->\r\n            <li role="option">\r\n                <a href="#" class="UserSettingsPage-category" data-bind="css: {active: isAboutPageVisible}">\r\n                    <h2 class="UserSettingsPage-label about" data-bind="l10n: { key: \'settings_about_category_title\' }"></h2>\r\n                </a>\r\n            </li>\r\n            <!-- /ko -->\r\n        </ul>\r\n    </div>\r\n\r\n    <div class="UserSettingsPage-detail UserSettingsPage-detail--white">\r\n        <!-- ko if: !isAboutPageVisible() -->\r\n            <!-- ko with: state.selectedCategory -->\r\n            <h1 class="UserSettingsPage-heading" data-bind="text: title"></h1>\r\n            <div class="UserSettingsPage-scroll-area">\r\n                <div class="scrollViewport scrollViewportV" tabindex="-1">\r\n                    <ul class="UserSettingsPage-list" data-bind="foreach: { data: preferenceItems, as: \'param\' }">\r\n                        <li class="UserSettingsPage-option"\r\n                            data-bind="css: param.template, template: { name: param.template, data: param, as: param }">\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n\r\n        <div class="UserSettingsPage-about-scroll" data-bind="visible: isAboutPageVisible">\r\n            <div class="scrollViewport scrollViewportV" tabindex="-1">\r\n                <div class="UserSettingsPage-skypeLogo"></div>\r\n                <div class="UserSettingsPage-option">\r\n                    <p class="pref-heading UserSettingsPage-featureLabel">\r\n                        <strong data-bind="l10n: { key: \'about_app_version\' }"></strong>: <span data-bind="text: appVersion"></span>\r\n                    </p>\r\n                    <p class="pref-heading UserSettingsPage-featureLabel">\r\n                        <strong data-bind="l10n: { key: \'about_assets_version\' }"></strong>: <span data-bind="text: assetsVersion"></span>\r\n                    </p>\r\n                    <!-- ko if: isPluginSupported -->\r\n                    <p class="pref-heading UserSettingsPage-featureLabel">\r\n                        <strong data-bind="l10n: { key: \'about_plugin_version\' }"></strong>:\r\n\r\n                        <!-- ko ifnot: isPluginVersionFetched -->\r\n                        <swx-loading-animation class="spinner small blue"></swx-loading-animation>\r\n                        <!-- /ko -->\r\n\r\n                        <!-- ko if: isPluginVersionFetched -->\r\n                        <span data-bind="text: pluginVersion"></span>\r\n                        <!-- /ko -->\r\n                    </p>\r\n                    <!-- /ko -->\r\n\r\n                    <p class="pref-heading UserSettingsPage-featureLabel">\r\n                        <a target="_blank" data-bind="attr: {href: faqLink}, l10n: { key: \'about_faq\' }"></a>\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n</section>\r\n\r\n<script type="text/html" id="pref-template-boolean">\r\n    <div class="pref-template-boolean-inner">\r\n        <div class="pref-template-boolean-buttonWrap" data-bind="css: { \'pref-toggle--saving\': param.uiState() === \'Saving\', \'pref-toggle--disabled\': param.disabled }">\r\n            <!-- ko if: param.uiState() !== \'Unknown\' -->\r\n            <swx-toggle-button class="pref-toggle-btn"\r\n                               params="checked: param.value, disabled: param.disabled, click: param.toggleValue, ariaLabel: title, labelledById: param.ariaId"></swx-toggle-button>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: param.uiState() === \'Unknown\' -->\r\n            <swx-loading-animation class="spinner small blue"></swx-loading-animation>\r\n            <!-- /ko -->\r\n        </div>\r\n        <div class="pref-toggle-col">\r\n            <h2 class="pref-toggle-heading UserSettingsPage-featureLabel" data-bind="html: param.title, attr: {id: param.ariaId}"></h2>\r\n        </div>\r\n    </div>\r\n    <p class="pref-toggle-sec-text UserSettingsPage-secondaryText" data-bind="html: param.secondaryText"></p>\r\n</script>\r\n\r\n\r\n<script type="text/html" id="pref-template-select">\r\n    <h2 class="pref-heading UserSettingsPage-featureLabel" data-bind="html: param.title"></h2>\r\n    <div>\r\n        <!-- ko if: param.uiState() !== \'Unknown\' -->\r\n        <div class=\'pref-select-element\'>\r\n            <select data-bind=" options: param.uiOptions,\r\n                            optionsText: param.uiValue,\r\n                            value: param.value,\r\n                            event: {\r\n                                mousedown: param.preventPropagation,\r\n                                keydown: param.preventPropagation,\r\n                                change: param.optionChanged } "></select>\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: param.uiState() === \'Unknown\' -->\r\n        <swx-loading-animation class="spinner small blue"></swx-loading-animation>\r\n        <!-- /ko -->\r\n    </div>\r\n    <p class="pref-toggle-sec-text UserSettingsPage-secondaryText" data-bind="html: param.secondaryText"></p>\r\n</script>\r\n\r\n<script type="text/html" id="pref-template-ringingDeferrer">\r\n    <div class=\'pref-template-boolean-inner\'>\r\n        <div class="pref-template-boolean-buttonWrap" data-bind="css: { \'pref-toggle--saving\': param.uiState() === \'Saving\', \'pref-toggle--disabled\': param.disabled }">\r\n            <!-- ko if: param.uiState() !== \'Unknown\' -->\r\n            <swx-toggle-button class="pref-toggle-btn"\r\n                               params="checked: param.uiToggled,\r\n                                disabled: param.disabled || param.uiState() === \'Saving\',\r\n                                click: param.uiToggleClicked,\r\n                                ariaLabel: title,\r\n                                labelledById: param.ariaId"></swx-toggle-button>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: param.uiState() === \'Unknown\' -->\r\n            <swx-loading-animation class="spinner small blue"></swx-loading-animation>\r\n            <!-- /ko -->\r\n        </div>\r\n        <div class="pref-toggle-col">\r\n            <h2 class="pref-toggle-heading UserSettingsPage-featureLabel" data-bind="html: param.title, attr: {id: param.ariaId}"></h2>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- ko if: param.uiToggled() && param.uiState() !== \'Unknown\' -->\r\n    <div class=\'pref-select-element pref-ringingDeferrer-select-element\'\r\n         data-bind="css: { \'pref-select-element--saving\': param.uiState() === \'Saving\' }">\r\n        <select class="pref-select-element-selectbox"\r\n                data-bind=" options: param.uiSelectOptions,\r\n                        optionsText: \'text\',\r\n                        optionsValue: \'id\',\r\n                        value: param.uiSelectedOption,\r\n                        disabled: param.disabled || param.uiState() === \'Saving\',\r\n                        event: {\r\n                            mousedown: param.preventPropagation,\r\n                            keydown: param.preventPropagation,\r\n                            change: param.uiSelectedOptionChanged } "></select>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <p class="pref-ringingDeferrer-sec-text UserSettingsPage-secondaryText" data-bind="html: param.secondaryText"></p>\r\n</script>\r\n\r\n<script type="text/html" id="pref-template-autoBuddy">\r\n    <div class="pref-template-boolean-inner">\r\n        <div class="pref-template-boolean-buttonWrap" data-bind="css: { \'pref-toggle--saving\': param.uiState() === \'Saving\'}">\r\n            <!-- ko if: param.uiState() !== \'Unknown\' -->\r\n            <swx-toggle-button class="pref-toggle-btn"\r\n                               params="checked: param.value, click: param.toggleValue, ariaLabel: title, labelledById: param.ariaId"></swx-toggle-button>\r\n            <!-- /ko -->\r\n\r\n            <!-- ko if: param.uiState() === \'Unknown\' -->\r\n            <swx-loading-animation class="spinner small blue"></swx-loading-animation>\r\n            <!-- /ko -->\r\n        </div>\r\n        <div class="pref-toggle-col">\r\n            <h2 class="pref-toggle-heading UserSettingsPage-featureLabel" data-bind="l10n: { key: \'settings_short_circuit_title\' }, attr: {id: param.ariaId}"></h2>\r\n        </div>\r\n    </div>\r\n    <p class="pref-toggle-sec-text UserSettingsPage-secondaryText" data-bind="l10n: { key: \'settings_short_circuit_description\' }"></p>\r\n    <div class="pref-toggle-sec-text">\r\n        <a href="#" class="UserSettingsPage-actionSecondary clickable" data-actionItem="true" data-bind="click: param.launchShortCircuit, l10n: { key: \'settings_short_circuit_manage_contacts\' }"></a>\r\n        <div class="UserSettingsPage-images">\r\n            <span class="UserSettingsPage-image UserSettingsPage-googleImage"></span>\r\n            <span class="UserSettingsPage-image UserSettingsPage-linkedInImage"></span>\r\n            <span class="UserSettingsPage-image UserSettingsPage-yahooImage"></span>\r\n        </div>\r\n    </div>\r\n</script>\r\n\r\n<script type="text/html" id="pref-template-autoBuddyDiscovery">\r\n    <div>\r\n        <!-- ko if: param.uiState() === \'Unknown\' -->\r\n        <swx-loading-animation class="spinner small blue"></swx-loading-animation>\r\n        <!-- /ko -->\r\n    </div>\r\n    <div>\r\n        <h2 class="pref-heading UserSettingsPage-featureLabel" data-bind="l10n: { key: \'settings_short_circuit_auto_buddy_discovery_title\' }, attr: {id: param.ariaId}"></h2>\r\n        <p class="pref-toggle-sec-text UserSettingsPage-secondaryText" data-bind="l10n: { key: \'settings_short_circuit_auto_buddy_discovery_description\' }"></p>\r\n    </div>\r\n\r\n    <ul class="UserSettingsPage-list" data-bind="l10n_attr: {\'aria-label\': \'settings_short_circuit_auto_buddy_discovery_title\'}">\r\n        <!-- ko foreach: { data: param.value, as: \'proof\' }-->\r\n        <li class="UserSettingsPage-option pref-template-autoBuddyProof pref-template-boolean">\r\n            <!-- ko if: proof.showToggle -->\r\n            <div data-bind="css: { \'pref-toggle--saving\': proof.uiState() === \'Saving\'}">\r\n                <!-- ko if: proof.uiState() !== \'Unknown\' -->\r\n                <swx-toggle-button class="pref-toggle-btn"\r\n                                   params="checked: proof.value, click: proof.toggleValue, ariaLabel: ariaLabel"></swx-toggle-button>\r\n                <!-- /ko -->\r\n\r\n                <!-- ko if: proof.uiState() === \'Unknown\' -->\r\n                <swx-loading-animation class="spinner small blue"></swx-loading-animation>\r\n                <!-- /ko -->\r\n            </div>\r\n            <!-- /ko -->\r\n            <div class="pref-toggle-col" data-bind="css: { \'pref--indented\': !proof.showToggle() }">\r\n                <h2 class="pref-heading UserSettingsPage-featureLabel UserSettingsPage-featureLabel--marginless" data-bind="text: proof.title, attr: {id: param.ariaId}"></h2>\r\n                <a href="#" class="UserSettingsPage-actionSecondary clickable" data-actionItem="true" data-bind="click: proof.remove, l10n: { key: \'settings_short_circuit_remove\' }, attr: { \'aria-label\': proof.removeAriaLabel }, visible: proof.showRemoveLink"></a>\r\n            </div>\r\n        </li>\r\n        <!-- /ko -->\r\n        <li class="UserSettingsPage-option pref-template-autoBuddyProof pref-template-boolean">\r\n            <div class="pref-toggle-col pref--indented">\r\n                <a href="#" class="UserSettingsPage-actionPrimary clickable" data-actionItem="true" data-bind="click: param.launchPNV, l10n: { key: \'settings_short_circuit_add_number\' }"></a>\r\n            </div>\r\n        </li>\r\n    </ul>\r\n</script>\r\n'}),define("ui/components/userSettings/userSettingsPage",["require","exports","module","ui/viewModels/userSettings/userSettingsPageViewModel","constants/components","text!views/userSettings/userSettingsPage.html"],function(e,t){var n=e("ui/viewModels/userSettings/userSettingsPageViewModel");t.name=e("constants/components").userSettings.USER_SETTINGS_PAGE,t.template=e("text!views/userSettings/userSettingsPage.html"),t.viewModel={createViewModel:n.build.bind(n)}}),define("ui/viewModels/userSettings/audioVideoSettingsPaneViewModel",["require","lodash-compat","ui/telemetry/actions/actionNames","swx-cafe-application-instance","swx-utils-common","swx-util-calling-stack","utils/common/cafeObservable","swx-constants","swx-constants","utils/common/disposableMixin","swx-enums","utils/common/eventMixin","swx-i18n","swx-service-locator-instance","vendor/knockout","ui/calling/callingCapabilityHelper"],function(e){function m(e){function N(e){p.resolve(u.serviceLocator.ACTION_TELEMETRY).recordAction(e)}function C(e){switch(e){case a.DEVICE_TYPE.CAMERA:N(n.deviceSelection.cameraSelected);break;case a.DEVICE_TYPE.MICROPHONE:N(n.deviceSelection.microphoneSelected);break;case a.DEVICE_TYPE.SPEAKER:N(n.deviceSelection.speakerSelected)}}function k(e){var t,n,r,s,o;switch(e){case a.DEVICE_TYPE.CAMERA:t=f.cameras,n=f.selectedCamera,o=i.selectedDevice.selectedCamera();break;case a.DEVICE_TYPE.MICROPHONE:t=f.microphones,n=f.selectedMicrophone,o=i.selectedDevice.selectedMicrophone();break;case a.DEVICE_TYPE.SPEAKER:t=f.speakers,n=f.selectedSpeaker,o=i.selectedDevice.selectedSpeaker()}s=n();if(!o)return;if(s&&s.id()===o.value)return;C(e),t().forEach(function(e){e.id()===o.value&&(r=e)});if(!r)return!1;n.set(r,a.DEVICE_SELECTION_REASON.USER)}function L(e){return e===u.deviceSelection.DEFAULT_ID||e==="default_audio_device"||e==="default_video_device"}function A(e,t){return L(e.id())?h.fetch({key:"settings_default_device_name"}):t}function O(e){if(L(e.id()))return;e.type()===l.deviceType.Camera?S(!0):e.type()===l.deviceType.Microphone?x(!0):e.type()===l.deviceType.Speaker&&T(!0)}function M(e,n){var r=e.added(function(e){var r={value:e.id(),name:d.observable(A(e,name)),description:""};n.push(r),e.name.get().then(function(t){O(e),r.name(A(e,t))}).catch(t.noop)}),s=e.removed(function(e){n.remove(function(t){return t.value===e.id()})});i.registerDisposable(r),i.registerDisposable(s)}function D(e,t,n){var r=e.changed(function(e){if(e){var r=d.utils.arrayFirst(n(),function(t){return t.value===e.id()});r&&r!==t()&&t(r)}});i.registerDisposable(r)}function P(){setTimeout(function(){i.closeButtonHasFocus(!0)},0)}var i=this,f=r.get().devicesManager,c=o.newObservableProperty(f.selectedCamera.set.enabled),m=o.newObservableProperty(f.selectedMicrophone.set.enabled),g=o.newObservableProperty(f.selectedSpeaker.set.enabled),y,b,w,E=v.getVideoCapabilityObservable(e),S=d.observable(!1),x=d.observable(!1),T=d.observable(!1);return i.DIALOG_NAME=a.CALL_SCREEN_DIALOG.NAME.AV_SETTINGS,i.allowSpeakerSelection=d.observable(!s.get().isPluginlessCallingSupported()),i.allowCameraSelection=E,i.closeTitle=h.fetch({key:"settings_close_title"}),i.closeButtonHasFocus=d.observable(!1),i.availableDevices={cameras:d.observableArray(),speakers:d.observableArray(),microphones:d.observableArray()},i.selectedDevice={selectedCamera:d.observable(),selectedMicrophone:d.observable(),selectedSpeaker:d.observable()},i.cameraSelectionDisabled=d.pureComputed(function(){return!c()||i.availableDevices.cameras().length===0||!S()}),i.microphoneSelectionDisabled=d.pureComputed(function(){return!m()||i.availableDevices.microphones().length===0||!x()}),i.speakerSelectionDisabled=d.pureComputed(function(){return!g()||i.availableDevices.speakers().length===0||!T()}),i.cameraTitle=d.pureComputed(function(){return i.cameraSelectionDisabled()?"settings_no_camera_title":"settings_camera_title"}),i.microphoneTitle=d.pureComputed(function(){return i.microphoneSelectionDisabled()?"settings_no_microphone_title":"settings_microphone_title"}),i.speakerTitle=d.pureComputed(function(){return i.speakerSelectionDisabled()?"settings_no_speaker_title":"settings_speaker_title"}),i.closeSettings=function(){i.dispatchEvent(u.events.callScreen.TOGGLE_MODAL_DIALOG,i.DIALOG_NAME,i.DIRECTION.PARENT)},i.init=function(){i.forwardEvent(u.events.callScreen.TOGGLE_MODAL_DIALOG,i.DIRECTION.PARENT),M(f.cameras,i.availableDevices.cameras),D(f.selectedCamera,i.selectedDevice.selectedCamera,i.availableDevices.cameras),M(f.microphones,i.availableDevices.microphones),D(f.selectedMicrophone,i.selectedDevice.selectedMicrophone,i.availableDevices.microphones),M(f.speakers,i.availableDevices.speakers),D(f.selectedSpeaker,i.selectedDevice.selectedSpeaker,i.availableDevices.speakers),y=i.selectedDevice.selectedCamera.subscribe(k.bind(i,a.DEVICE_TYPE.CAMERA)),b=i.selectedDevice.selectedMicrophone.subscribe(k.bind(i,a.DEVICE_TYPE.MICROPHONE)),w=i.selectedDevice.selectedSpeaker.subscribe(k.bind(i,a.DEVICE_TYPE.SPEAKER)),i.registerDisposable(y),i.registerDisposable(b),i.registerDisposable(w),i.registerDisposable(E),N(n.deviceSelection.callScreenPaneOpened),P()},i}var t=e("lodash-compat"),n=e("ui/telemetry/actions/actionNames"),r=e("swx-cafe-application-instance"),i=e("swx-utils-common").builderMixin,s=e("swx-util-calling-stack"),o=e("utils/common/cafeObservable"),u=e("swx-constants").COMMON,a=e("swx-constants").CALLING,f=e("utils/common/disposableMixin"),l=e("swx-enums"),c=e("utils/common/eventMixin"),h=e("swx-i18n").localization,p=e("swx-service-locator-instance").default,d=e("vendor/knockout"),v=e("ui/calling/callingCapabilityHelper");return t.assign(m.prototype,f),t.assign(m,i),t.assign(m.prototype,c),m}),define("text!views/userSettings/audioVideoSettingsPane.html",[],function(){return'<script type="text/html" id="device-list-template">\r\n    <div class=\'pref-select-element\' data-bind="css: { \'pref-select-element--disabled\': selectionDisabled }">\r\n        <swx-select-box params="autoFocusAfterSelection: true,\r\n                                selectOptions: availableDevices,\r\n                                selectedOption: selectedDevice,\r\n                                disabled: selectionDisabled,\r\n                                placeholderKey: placeholderKey" class="SelectBox"></swx-select-box>\r\n    </div>\r\n</script>\r\n\r\n<swx-call-screen-modal params="name: DIALOG_NAME">\r\n    <div id="device-settings" class="avSettings" role="dialog" data-bind="l10n_attr: {\'aria-label\': \'callscreen_text_showAVSettings\' }">\r\n        <ul class="avSettings-detail">\r\n\r\n            <!-- ko if: allowCameraSelection() -->\r\n            <li class="avSettings-option">\r\n                <h2 class="avSettings-featureLabel" data-bind="l10n: { key: \'settings_camera_title\' }"></h2>\r\n                <div data-bind="template: { name: \'device-list-template\', data: {\r\n                        selectionDisabled: cameraSelectionDisabled,\r\n                        availableDevices: availableDevices.cameras,\r\n                        selectedDevice: selectedDevice.selectedCamera,\r\n                        placeholderKey: cameraTitle}}"></div>\r\n            </li>\r\n            <!-- /ko -->\r\n\r\n            <li class="avSettings-option">\r\n                <h2 class="avSettings-featureLabel" data-bind="l10n: { key: \'settings_microphone_title\' }"></h2>\r\n                <div data-bind="template: { name: \'device-list-template\', data: {\r\n                        selectionDisabled: microphoneSelectionDisabled,\r\n                        availableDevices: availableDevices.microphones,\r\n                        selectedDevice: selectedDevice.selectedMicrophone,\r\n                        placeholderKey: microphoneTitle}}"></div>\r\n            </li>\r\n\r\n            <!-- ko if: allowSpeakerSelection() -->\r\n            <li class="avSettings-option">\r\n                <h2 class="avSettings-featureLabel" data-bind="l10n: { key: \'settings_speaker_title\' }"></h2>\r\n                <div data-bind="template: { name: \'device-list-template\', data: {\r\n                        selectionDisabled: speakerSelectionDisabled,\r\n                        availableDevices: availableDevices.speakers,\r\n                        selectedDevice: selectedDevice.selectedSpeaker,\r\n                        placeholderKey: speakerTitle}}"></div>\r\n            </li>\r\n            <!-- /ko -->\r\n        </ul>\r\n\r\n        <div class="actions">\r\n            <swx-button params="cssClass: \'secondary circle\', textKey: \'button_text_closeSettings\', i18nTitle: closeTitle, action: closeSettings, hasFocus: closeButtonHasFocus"></swx-button>\r\n        </div>\r\n    </div>\r\n</swx-call-screen-modal>'}),define("ui/components/userSettings/audioVideoSettingsPane",["require","exports","module","ui/viewModels/userSettings/audioVideoSettingsPaneViewModel","vendor/knockout","constants/components","text!views/userSettings/audioVideoSettingsPane.html"],function(e,t){function i(e,t){var i=n.build(e.conversation,t.element);return i.setContext(r.dataFor(t.element)),i.init(),i}var n=e("ui/viewModels/userSettings/audioVideoSettingsPaneViewModel"),r=e("vendor/knockout");t.name=e("constants/components").userSettings.AUDIO_VIDEO_SETTINGS_PANE,t.template=e("text!views/userSettings/audioVideoSettingsPane.html"),t.viewModel={createViewModel:i}}),define("ui/components/userSettings/index",["require","ui/components/userSettings/userSettingsPage","ui/components/userSettings/audioVideoSettingsPane"],function(e){return[e("ui/components/userSettings/userSettingsPage"),e("ui/components/userSettings/audioVideoSettingsPane")]}),define("experience/components/userSettings",["require","exports","module","ui/components/userSettings/index","ui/components/registrar"],function(e,t){var n=e("ui/components/userSettings/index"),r=e("ui/components/registrar");t.init=function(e){r.register(n),e()}}),define("text!views/me/me.html",[],function(){return"<swx-me-area></swx-me-area>\r\n"}),define("ui/controls/me/me",["require","exports","module","vendor/knockout","browser/document","text!views/me/me.html"],function(e,t){var n=e("vendor/knockout"),r=e("browser/document"),i=e("text!views/me/me.html");t.name="me",t.render=function(e,t){var s=r.createElement("div");s.className="swxMe",s.innerHTML=i,n.applyBindings(null,s),t(s)}}),define("ui/viewModels/me/area",["require","exports","module","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","swx-cafe-application-instance","utils/common/cafeObservable","swx-enums","swx-service-locator-instance","utils/common/statusMapper","swx-constants","swx-i18n","vendor/knockout","experience/settings","experience/api/calling","browser/window","experience/api/authentication","utils/common/eventHelper","utils/common/eventMixin","lodash-compat","browser/dom","experience/api/me","ui/contextMenu/contextMenu","swx-utils-chat","swx-focus-handler","telemetry/calling/pstn/pstn","swx-constants"],function(e,t){function k(e,t,g){var k=this,L=i.get().personsAndGroupsManager.mePerson,A=L.account,O=p.buildApi(),M={source:r.me.area},D=y.now(),P=u.resolve(f.serviceLocator.ACTION_TELEMETRY),H=b.getElement(".Me-displayName",t),B={expand:1,collapse:2},j=y.once(function(e,t){var i;e&&(i=y.now()-D),P.recordAction(n.me.presenceLoaded,{source:r.me.area,mePresenceLoadTime:i,meStatus:t,meStatusLoaded:e})}),F=function(){if(i.get().signInManager.state()!==o.loginState.SignedIn)return;var e=L.status(),t=e===o.onlineStatus.Online;j(!0,e),k.notificationAvailabilityText(l.fetch({key:a.isNotificationOn(e)?"me_notificationsOn":"me_notificationsOff"})),k.online(t),k.availability(a.getMeAvailabilityText(e)),k.avatarStatusClassName(a.getStatusIconClass(e)),L.activity()||k.activityMessage(a.getMeAvailabilityText(e))},I=function(){var e=L.activity().replace(/class="emoticon extraLarge"/g,'class="emoticon"');k.activityMessage(e?e:k.availability())},q=function(){i.get().signInManager.state()===o.loginState.SignedIn&&k.displayName(L.displayName())},R=function(){i.get().signInManager.state()===o.loginState.SignedIn&&k.id(L.id())},U=function(){i.get().signInManager.state()===o.loginState.SignedIn&&(A._balance()>0?k.displayBalance(A.displayBalance()):k.displayBalance(""))},z=function(e){return e.target.className.indexOf("collapse")>-1?B.collapse:B.expand},W=function(e){return e.type==="click"||e.type==="keypress"&&m.isActivation(e)};setTimeout(function(){j(!1)},C),k.id=c.observable(L.id()),k.displayName=c.observable(L.displayName()),k.displayNameUnescaped=c.computed(function(){return y.unescape(k.displayName())}),k.activityMessage=c.observable(),k.activityMessageTitle=c.computed(function(){return S.stripHTML(k.activityMessage())}),k.displayBalance=c.observable(),L.id.get().then(function(){A.entitlements.get().then(function(){A._balance()>0&&k.displayBalance(A.displayBalance())})}),k.purchaseCreditUrl=h.commerce.purchaseCreditUrl,k.avatarUrl=s.newObservableProperty(L.avatarUrl),k.isExpanded=w.isExpanded,k.linkTabIndex=c.computed(function(){return w.isExpanded()?-1:0}),k.accountLinkValue=h.meProfileUrl,k.notificationAvailabilityText=c.observable(l.fetch({key:"me_notificationsOff"})),k.online=c.observable(!1),k.isFocused=c.observable(!1),k.availability=c.observable(l.fetch({key:"me_pendingPresence"})),k.avatarStatusClassName=c.observable(o.onlineStatus.Unknown.toLowerCase()),k.changePresenceAriaLabel=c.computed(function(){return l.fetch({key:"accessibility_me_changePresenceStatusAriaLabel",params:{currentStatus:k.availability()}})}),L.status.changed(F),L.activity.changed(I),L.displayName.changed(q),L.id.changed(R),A.displayBalance.changed(U),k.triggerPresencePopup=function(e,t,n){return W(n)&&(E.hide(n),n.preventDefault(),k.dispatchEvent(f.events.me.PRESENCE_POPUP_SHOW,e,k.DIRECTION.CHILD)),!0},k.isPluginInstalled=O.isPluginInstalled,k.collapse=function(){g.restore(),k.isExpanded(!1),P.recordAction(n.me.collapsed,M),x.get().addFocusRequestToQueue(H)},k.expand=function(){g.restrict(),k.isExpanded(!0),k.isFocused(!0),P.recordAction(n.me.expanded,M)},k.addCreditTelemetry=function(){return T.addingCredit(N.CREDIT_DISPLAY),!0},k.toggleMeSize=function(e,t){if(t.srcElement&&t.srcElement.id==="meDisplayBalance")return!0;if(W(t)){var n=z(t);n===B.collapse&&k.isExpanded()?k.collapse():n===B.expand&&!k.isExpanded()&&k.expand(),t.preventDefault(),t.stopPropagation()}return!0},k.installPlugin=function(){O.startPluginInstall(),P.recordAction(n.me.installPluginLinkClicked,M)},k.meAccountLinkClicked=function(e,t,r){d.open(e,"_blank"),P.recordAction(n.me.accountLinkClicked,M),r.preventDefault()},k.meSignOut=function(){v.signOut(),P.recordAction(n.me.signOutClicked,M)},k.dispose=function(){k.avatarUrl.dispose(),k.linkTabIndex.dispose(),k.changePresenceAriaLabel.dispose(),L.status.changed.off(F),L.activity.changed.off(I),L.id.changed.off(R),L.displayName.changed.off(q),A.displayBalance.changed.off(U)}}var n=e("ui/telemetry/actions/actionNames"),r=e("ui/telemetry/actions/actionSources"),i=e("swx-cafe-application-instance"),s=e("utils/common/cafeObservable"),o=e("swx-enums"),u=e("swx-service-locator-instance").default,a=e("utils/common/statusMapper"),f=e("swx-constants").COMMON,l=e("swx-i18n").localization,c=e("vendor/knockout"),h=e("experience/settings"),p=e("experience/api/calling"),d=e("browser/window"),v=e("experience/api/authentication"),m=e("utils/common/eventHelper"),g=e("utils/common/eventMixin"),y=e("lodash-compat"),b=e("browser/dom"),w=e("experience/api/me"),E=e("ui/contextMenu/contextMenu"),S=e("swx-utils-chat").messageSanitizer,x=e("swx-focus-handler"),T=e("telemetry/calling/pstn/pstn"),N=e("swx-constants").COMMON.telemetry.meArea,C=6e4;y.assign(k.prototype,g),t.build=function(e,t,n){return new k(e,t,n)}}),define("text!views/me/area.html",[],function(){return'<div class="Me" data-bind="css: { \'Me--expanded\': isExpanded() }">\r\n    <div class="Me-small">\r\n\r\n        <div class="Me-presenceStatus" tabindex="0" data-bind="event: { keypress: triggerPresencePopup.bind(null, \'Me-collapsed\'), click: triggerPresencePopup.bind(null, \'Me-collapsed\') },l10n_attr: {\'aria-label\': \'accessibility_me_changePresenceStatusAriaLabel\'}, clickBubble: false">\r\n            <button class="btn secondary circle Me-openPresencePopup" type="button">\r\n                <span class="iconfont chevronDown"></span>\r\n            </button>\r\n        </div>\r\n        <swx-me-presence-popup params="key: \'Me-collapsed\'" class="Me-presencePopup"></swx-me-presence-popup>\r\n\r\n        <div id="expandMeProfileLabel" class="offScreen">\r\n            <span data-bind="text: displayNameUnescaped"></span>\r\n            <span data-bind="l10n: {\'key\': \'accessibility_me_expandProfile\'}"></span>\r\n        </div>\r\n        <div class="Me-skyContainer" data-bind="click: toggleMeSize">\r\n            <div class="Me-sky"></div>\r\n                <swx-avatar class="Me-avatar" params="size: 40, avatar: avatarUrl, status: avatarStatusClassName, displayName: displayNameUnescaped"></swx-avatar>\r\n            <div class="Me-info">\r\n                <span class=\'Me-displayNameContainer\'>\r\n                    <p aria-labelledby="expandMeProfileLabel" class=\'Me-displayName fontSize-h3 strong\' role="button" data-bind="click: toggleMeSize, event: {keypress: toggleMeSize}, text: displayNameUnescaped, attr: {tabindex: linkTabIndex}"></p>\r\n                    <!-- ko if:displayBalance() -->\r\n                    <p ><a id=\'meDisplayBalance\' class=\'Me-displayBalance\' data-bind=\'attr: {href: purchaseCreditUrl}, text:displayBalance, click: addCreditTelemetry\' target=\'_blank\'></a></p>\r\n                    <!-- /ko -->\r\n                </span>\r\n                <p class="Me-moodMessage" role="button" data-bind="html: activityMessage, attr: {\'title\': activityMessageTitle, \'aria-label\': activityMessageTitle}, event: {keypress: toggleMeSize, click: toggleMeSize}, attr: {tabindex: linkTabIndex}"></p>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <!-- ko if: isExpanded ()-->\r\n    <div class="Me-large" data-bind="css: { \'Me-large--visible\': isExpanded() }">\r\n        <div class="Me-info">\r\n            <button class="btn secondary circle Me-collapseBtn" type="button" data-bind=" click: toggleMeSize, event: {keypress: toggleMeSize}, l10n_attr: {\'aria-label\': \'accessibility_me_collapseProfile\'}">\r\n                <span class="iconfont chevronUp" data-bind="l10n: { \'key\': \'accessibility_me_collapseProfile\' }"></span>\r\n            </button>\r\n            <p class="Me-displayName fontSize-h3 strong" data-bind="text: displayNameUnescaped"></p>\r\n            <p class="Me-availability" data-bind="text: availability"></p>\r\n        </div>\r\n        <div class="Me-content">\r\n            <div class="Me-avatarContainer">\r\n                <swx-avatar class="Me-avatar Me-avatar--large Avatar--fogTheme" params="size: 260, avatar: avatarUrl, displayName: displayNameUnescaped, status: avatarStatusClassName"></swx-avatar>\r\n                <swx-avatar-file-picker class="Me-avatarFilePicker"></swx-avatar-file-picker>\r\n            </div>\r\n\r\n            <div class="Me-accountInfoWrapper">\r\n                <p class="Me-accountInfo-displayName fontSize-h3 strong" data-bind="text: displayNameUnescaped"></p>\r\n                <p class="Me-skypename" data-bind="text: id" tabindex="0"></p>\r\n            </div>\r\n\r\n            <div class="Me-availabilityWrapper">\r\n\r\n                <button aria-haspopup="true" class="Me-availabilityText Me-availabilityTextAnchor" data-bind="event: { keypress: triggerPresencePopup.bind(null, \'Me-expanded\'), click: triggerPresencePopup.bind(null, \'Me-expanded\'), mousedown: function (data, e) { e.preventDefault(); } }, attr: { \'aria-label\': changePresenceAriaLabel }">\r\n                    <span data-bind="text: availability, attr: {\'aria-label\': availability}"></span>\r\n                    <span class="iconfont chevronDown Me-availabilityChevron"></span>\r\n                </button>\r\n                <swx-me-presence-popup params="key: \'Me-expanded\'"></swx-me-presence-popup>\r\n                <div class="Me-notificationsText" data-bind="text: notificationAvailabilityText, attr: {\'aria-label\': notificationAvailabilityText}"></div>\r\n            </div>\r\n            <div class="Me-moodWrapper">\r\n                <swx-me-mood-message params="key: \'Me-expanded\'" class="Me-moodMessage"></swx-me-mood-message>\r\n            </div>\r\n            <a class="Me-link" data-bind="visible: !isPluginInstalled(), event: { click: installPlugin }, l10n_attr: {\'aria-label\': \'me_pluginLinkText\'}" href="javascript:void(0);">\r\n                <span class="iconfont arrowDown Me-linkIcon"></span>\r\n                <span class="fontSize-h3 Me-linkText" data-bind="l10n: {\'key\': \'me_pluginLinkText\'}"></span>\r\n            </a>\r\n            <a class="Me-link" data-bind="attr: { href: accountLinkValue }, l10n_attr: {\'aria-label\': \'me_accountLinkText\'}, event: { click: meAccountLinkClicked.bind(null, accountLinkValue) }" target="_blank">\r\n                <span class="iconfont settings Me-linkIcon"></span>\r\n                <span class="fontSize-h3 Me-linkText" data-bind="l10n: {\'key\': \'me_accountLinkText\'}"></span>\r\n            </a>\r\n            <a class="Me-link" data-bind="event: { click: meSignOut }, l10n_attr: {\'aria-label\': \'me_accountSignOutLinkText\' }" href="javascript:void(0);">\r\n                <span class="iconfont signOut Me-linkIcon"></span>\r\n                <span class="fontSize-h3 Me-linkText" data-bind="l10n: {\'key\': \'me_accountSignOutLinkText\' }"></span>\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n</div>\r\n'}),define("ui/components/me/area",["require","exports","module","ui/viewModels/me/area","utils/common/focusRestrictor","constants/components","text!views/me/area.html"],function(e,t){function i(e,t){var i=[".toasts",".footer",".notifications"],s=r.build(t.element,i),o=n.build(e,t.element,s);return o}var n=e("ui/viewModels/me/area"),r=e("utils/common/focusRestrictor");t.name=e("constants/components").me.AREA,t.template=e("text!views/me/area.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/me/presencePopup",["require","vendor/knockout","swx-utils-common","swx-constants","swx-cafe-application-instance","swx-enums","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","swx-service-locator-instance","utils/common/eventMixin","browser/document","swx-focus-handler","lodash-compat","utils/common/outsideClickHandler"],function(e){function d(e){function m(){n.execute(function(){h.isOpened(!1)}),p.remove("PresencePopup"),c.get().addFocusRequestToQueue(f)}function g(t){!h.isOpened()&&e.key===t&&(f=l.activeElement,p.add("PresencePopup",m),h.isOpened(!0))}function y(){h.currentStatus(d.status())}var f,h=this,d=i.get().personsAndGroupsManager.mePerson,v=a.resolve(r.serviceLocator.ACTION_TELEMETRY);h.isOpened=t.observable(!1),h.currentStatus=t.observable(d.status()),h.presenceStatuses=[{status:s.onlineStatus.Online,l10nKey:"message_text_presenceOnline",cssClass:"PresencePopup-status--online"},{status:s.onlineStatus.Away,l10nKey:"message_text_presenceAway",cssClass:"PresencePopup-status--idle"},{status:s.onlineStatus.DoNotDisturb,l10nKey:"message_text_presenceDoNotDisturb",cssClass:"PresencePopup-status--dnd"},{status:s.onlineStatus.Hidden,l10nKey:"message_text_presenceHidden",cssClass:"PresencePopup-status--hidden"}],h.updateStatus=function(t){var n=h.presenceStatuses[t].status,r=d.status();return n!==r&&(d.status(n),v.recordAction(o.me.presenceChanged,{source:u.me.area,pickerVersion:"threeState",oldStatus:r,newStatus:n,meExpanded:e.key==="Me-expanded"}),m()),!0},h.getPresenceStatusCssClasses=function(e){var t="PresencePopup-status popup-select-option "+h.presenceStatuses[e].cssClass;return h.currentStatus()===h.presenceStatuses[e].status&&(t+=" popup-select-option--selected"),t},h.init=function(){d.status.changed(y),h.registerEvent(r.events.me.PRESENCE_POPUP_SHOW,g)},h.dispose=function(){d.status.changed.off(y)}}var t=e("vendor/knockout"),n=e("swx-utils-common").async,r=e("swx-constants").COMMON,i=e("swx-cafe-application-instance"),s=e("swx-enums"),o=e("ui/telemetry/actions/actionNames"),u=e("ui/telemetry/actions/actionSources"),a=e("swx-service-locator-instance").default,f=e("utils/common/eventMixin"),l=e("browser/document"),c=e("swx-focus-handler"),h=e("lodash-compat"),p=e("utils/common/outsideClickHandler");return d.build=function(e,t){return new d(e,t)},h.assign(d.prototype,f),d}),define("text!views/me/presencePopup.html",[],function(){return'<div class="PresencePopup popup popup-select arrow up" data-bind= "visible: isOpened, clickBubble: false">\r\n    <ul role="menu" class="PresencePopup-statusContainer" data-bind="foreach: presenceStatuses, keyboardNavigation: { itemSelector: \'li:not(.popup-select-option--selected)\' }">\r\n        <li role="menuitem" data-bind="css: $parent.getPresenceStatusCssClasses($index()), click: $parent.updateStatus.bind(null, $index()), enterKey: $parent.updateStatus.bind(null, $index()), l10n: { key: l10nKey }, clickBubble: false">\r\n        </li>\r\n    </ul>\r\n</div>\r\n'}),define("ui/components/me/presencePopup",["require","exports","module","vendor/knockout","ui/viewModels/me/presencePopup","constants/components","text!views/me/presencePopup.html"],function(e,t){function i(e,t){var i=t.element,s=n.dataFor(i),o=r.build(e,i);return o.setContext(s),o.init(),o}var n=e("vendor/knockout"),r=e("ui/viewModels/me/presencePopup");t.name=e("constants/components").me.PRESENCE_POPUP,t.template=e("text!views/me/presencePopup.html"),t.viewModel={createViewModel:i}}),define("ui/viewModels/me/moodMessage",["require","vendor/knockout","swx-constants","swx-cafe-application-instance","ui/telemetry/actions/actionNames","ui/telemetry/actions/actionSources","swx-service-locator-instance","swx-i18n","swx-constants","swx-utils-chat","utils/common/eventHelper"],function(e){function c(){function v(){e.activity(c.activity())}function m(){var t=e.activity();return t?t:d}function g(){var t=e.editableActivity(),n=e.currentActivityTitle(),r;return t!==n&&(t=y(t),r=c.activity.set(t),h.recordAction(i.me.activityChanged,{source:s.me.area,oldActivity:n,newActivity:t})),r||Promise.resolve()}function y(e){return f.escapeOutgoingHTML(e)}var e=this,c=r.get().personsAndGroupsManager.mePerson,h=o.resolve(n.serviceLocator.ACTION_TELEMETRY),p=o.resolve(n.serviceLocator.FEATURE_FLAGS),d=u.fetch({key:"me_input_text_activity_message_placeholder"});e.editMode=t.observable(!1),e.activity=t.observable(""),e.currentActivityMessage=t.computed(m),e.currentActivityTitle=t.computed(function(){return f.stripHTML(e.currentActivityMessage())}),e.editableActivity=t.observable(""),e.isEnabled=function(){return p.isFeatureOn(n.featureFlags.MOOD_MESSAGE_EDIT_ENABLED)},e.updateMoodButtonClick=function(){return g().then(function(){e.editMode(!1)}),!0},e.toggleEditMode=function(){var t=e.editMode();t||(e.currentActivityMessage()!==d?e.editableActivity(e.currentActivityTitle()):e.editableActivity("")),e.editMode(!t)},e.onEditMoodKeyDown=function(t,n){switch(n.keyCode){case a.ENTER:return g().then(function(){e.editMode(!1)}),!1;case a.ESCAPE:return e.editMode(!1),!1}return!0},e.onUpdateMoodKeyDown=function(t,n){var r=l.isActivation(n);return r&&g().then(function(){e.editMode(!1)}),!r},e.onCancelUpdateMoodKeyDown=function(t,n){var r=l.isActivation(n);return r&&e.editMode(!1),!r},e.init=function(){c.activity.changed(v)},e.dispose=function(){c.activity.changed.off(v),e.currentActivityMessage.dispose(),e.currentActivityTitle.dispose()}}var t=e("vendor/knockout"),n=e("swx-constants").COMMON,r=e("swx-cafe-application-instance"),i=e("ui/telemetry/actions/actionNames"),s=e("ui/telemetry/actions/actionSources"),o=e("swx-service-locator-instance").default,u=e("swx-i18n").localization,a=e("swx-constants").KEYS,f=e("swx-utils-chat").messageSanitizer,l=e("utils/common/eventHelper");return c.build=function(e,t){return new c(e,t)},c}),define("text!views/me/moodMessage.html",[],function(){return'<!-- ko if: isEnabled() -->\r\n\r\n<div data-bind="css: {hide: editMode}">\r\n    <p class="Me-moodMessage-moodMessage" data-bind="html: currentActivityMessage, attr: {\'aria-label\': currentActivityTitle, \'title\': currentActivityTitle}"></p>\r\n    <button class="Me-moodMessage-editButton iconfont edit" data-bind="l10n_attr: {\'aria-label\': \'me_edit_activity_message\', \'title\': \'me_edit_activity_message\'}, event: {\'click\': toggleEditMode, \'keydown\': toggleEditMode}" type="button"></button>\r\n</div>\r\n\r\n<!-- ko if: editMode() -->\r\n<div class="Me-moodMessage-editMoodContainer">\r\n    <input class="Me-moodMessage-editMoodContainer--input" data-bind="textInput: editableActivity, event: {keydown: onEditMoodKeyDown}, l10n_attr: {\'placeholder\': \'me_input_text_activity_message_placeholder\'}, hasfocus: editMode(), selected: editMode()" maxlength="200" />\r\n    <a href="#" class="Me-moodMessage-editMoodContainer--button iconfont ok" role="button" data-bind="event: {click: updateMoodButtonClick, keypress: onUpdateMoodKeyDown}, l10n_attr: {\'aria-label\': \'me_edit_activity_message_confirm\'}"></a>\r\n    <a href="#" class="Me-moodMessage-editMoodContainer--button iconfont cancel" role="button" data-bind="event: {click: toggleEditMode, keypress: onCancelUpdateMoodKeyDown}, l10n_attr: {\'aria-label\':  \'me_edit_activity_message_cancel\'}"></a>\r\n</div>\r\n<!-- /ko -->\r\n\r\n<!-- /ko -->\r\n'}),define("ui/components/me/moodMessage",["require","exports","module","ui/viewModels/me/moodMessage","constants/components","text!views/me/moodMessage.html"],function(e,t){function r(e,t){var r=t.element,i=n.build(e,r);return i.init(),i}var n=e("ui/viewModels/me/moodMessage");t.name=e("constants/components").me.MOOD_MESSAGE,t.template=e("text!views/me/moodMessage.html"),t.viewModel={createViewModel:r}}),define("ui/components/me/index",["require","ui/components/me/area","ui/components/me/presencePopup","ui/components/me/moodMessage"],function(e){return[e("ui/components/me/area"),e("ui/components/me/presencePopup"),e("ui/components/me/moodMessage")]}),define("experience/components/me",["require","exports","module","swx-constants","swx-service-locator-instance","ui/components/registrar","ui/controls/me/me","ui/components/me/index"],function(e,t){var n=e("swx-constants").COMMON,r=e("swx-service-locator-instance").default,i=e("ui/components/registrar"),s=e("ui/controls/me/me"),o=e("ui/components/me/index");t.init=function(e){var t=r.resolve(n.serviceLocator.CONTROLS_BUILDER);t.register(s),i.register(o),e()}}),define("text!views/notifications/allowBrowserNotifications.html",[],function(){return'<div id="overlayAllowBrowserNotifications" class="swx-overlayModal swx-hide">\r\n    <div class="overlayMain" data-bind="css: { darkTheme: darkTheme, rtl: browserIsRtl}">\r\n        <!-- ko ifnot: darkTheme -->\r\n        <div class="title">\r\n            <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="l10n: { \'key\': \'allow_browser_notifications_header\' }"></h1>\r\n        </div>\r\n        <div class="illustration">\r\n            <img class="circle" data-bind="attr: { src: skypeImageUrl }" alt="" role="presentation" aria-hidden="true"/>\r\n        </div>\r\n        <div class="subtitle">\r\n            <p class="fontSize-h2 fontSizeNarrow-h4" data-bind="l10n: { \'key\': \'allow_browser_notifications_text\' }"></p>\r\n        </div>\r\n        <div class="buttonRow">\r\n            <button class="btn green narrow large" data-bind="click: close" type="button">\r\n                <span class="iconfont after cross pull2" data-bind="l10n: { \'key\': \'button_text_closeSettings\' }"></span>\r\n            </button>\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n        <!-- ko if: darkTheme -->\r\n        <div class="table">\r\n            <div class="tableCell">\r\n                <div class="arrow">\r\n                    <span class="iconfont arrowUp"></span>\r\n                </div>\r\n                <div class="title">\r\n                    <h1 class="fontSize-h0" data-bind="l10n: { \'key\': \'allow_browser_notifications_header\' }"></h1>\r\n                </div>\r\n                <div class="subtitle">\r\n                    <p class="fontSize-h2" data-bind="l10n: { \'key\': \'allow_browser_notifications_text\' }"></p>\r\n                </div>\r\n                <div class="logo">\r\n                    <span class="iconfont logoSkypeMedium"></span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n</div>\r\n'}),define("ui/viewModels/notifications/allowBrowserNotificationModalDialog",["require","exports","module","vendor/knockout","lodash-compat","swx-service-locator-instance","swx-constants","experience/settings","services/i18n/cultureInfo","notifications/settings","swx-cafe-application-instance","swx-log-tracer","ui/modalDialog/modalDialog","text!views/notifications/allowBrowserNotifications.html","swx-browser-globals","ui/telemetry/actions/actionNames"],function(e,t){function y(){function f(){return[o.assetsBaseUrl,v,m].join("")}function l(){return r.includes(s.rtlLanguages,a)||r.includes(s.rtlLanguages,u.getLocale(a))}var e=i.resolve(s.serviceLocator.FEATURE_FLAGS),t=i.resolve(s.serviceLocator.ACTION_TELEMETRY),a=p.getWindow().navigator.language;this.browserIsRtl=n.observable(l()),this.darkTheme=n.observable(e.isFeatureOn(s.featureFlags.USE_DARK_THEME_FOR_BROWSER_NOTIFICATIONS_OPT_IN_FLOW)),this.skypeImageUrl=n.observable(f()),this.close=function(){c.dispose(g)},t.recordAction(d.allowBrowserNotificationsModalDialog.shown)}var n=e("vendor/knockout"),r=e("lodash-compat"),i=e("swx-service-locator-instance").default,s=e("swx-constants").COMMON,o=e("experience/settings"),u=e("services/i18n/cultureInfo"),a=e("notifications/settings"),f=e("swx-cafe-application-instance"),l=e("swx-log-tracer"),c=e("ui/modalDialog/modalDialog"),h=e("text!views/notifications/allowBrowserNotifications.html"),p=e("swx-browser-globals"),d=e("ui/telemetry/actions/actionNames"),v="/images/components/notifications/",m="allowNativeBrowserNotifications.png",g=s.modalDialog.ALLOW_BROWSER_NOTIFICATIONS_CONTAINER_ID;t.show=function(){function r(e){a.chatNotificationsMuted.extend({notify:"always"}),e===s.permission.DENIED?(a.chatNotificationsMuted(!0),f.get().personsAndGroupsManager.mePerson.preferences(s.userSettings.preferences.NOTIFICATIONS).value.set(!1)):e===s.permission.GRANTED&&(a.chatNotificationsMuted(!1),f.get().personsAndGroupsManager.mePerson.preferences(s.userSettings.preferences.NOTIFICATIONS).value.set(!0)),t.recordAction(d.notificationBox.permissionResponse,{permissionStatus:e}),p.getDocument().getElementById(g)&&c.dispose(g)}var e=p.getWindow();if(!e.Notification||e.Notification.permission!==s.permission.DEFAULT){l.getLogger().error("Tried to show 'allow browser notification' modal dialog when notification permissions were not in default state");return}var t=i.resolve(s.serviceLocator.ACTION_TELEMETRY),n=i.resolve(s.serviceLocator.FEATURE_FLAGS);e.Notification.requestPermission(r),c.build(g,new y,h),n.isFeatureOn(s.featureFlags.USE_DARK_THEME_FOR_BROWSER_NOTIFICATIONS_OPT_IN_FLOW)?c.show(g,null,null,!0):c.show(g)}}),define("ui/viewModels/notifications/notificationBox",["require","vendor/knockout","ui/viewModels/notifications/allowBrowserNotificationModalDialog","swx-browser-detect","swx-service-locator-instance","swx-constants","notifications/settings","swx-cafe-application-instance","ui/telemetry/actions/actionNames","swx-browser-globals"],function(e){function l(){function h(){return d()&&p()&&l.isFeatureOn(s.featureFlags.BROWSER_NATIVE_NOTIFICATIONS_ENABLED)&&u.get().personsAndGroupsManager.all.persons().length>0&&!o.chatNotificationsMuted()&&f.Notification.permission===s.permission.DEFAULT}function p(){return f.Notification!==undefined}function d(){return r.getBrowserInfo().browserName==="Chrome"&&r.getSystemInfo().osName==="Windows"}var e=this,l=i.resolve(s.serviceLocator.FEATURE_FLAGS),c=i.resolve(s.serviceLocator.ACTION_TELEMETRY);e.isVisible=t.observable(h()),e.requestPermission=function(){c.recordAction(a.notificationBox.requestPermission),n.show()},e.setNotificationBoxVisibility=function(){var t=h();e.isVisible()!==t&&e.isVisible(t)},e.isVisible()&&c.recordAction(a.notificationBox.shown),u.get().personsAndGroupsManager.all.persons.changed(e.setNotificationBoxVisibility),o.chatNotificationsMuted.subscribe(e.setNotificationBoxVisibility)}var t=e("vendor/knockout"),n=e("ui/viewModels/notifications/allowBrowserNotificationModalDialog"),r=e("swx-browser-detect").default,i=e("swx-service-locator-instance").default,s=e("swx-constants").COMMON,o=e("notifications/settings"),u=e("swx-cafe-application-instance"),a=e("ui/telemetry/actions/actionNames"),f=e("swx-browser-globals").getWindow();return l}),define("text!views/notifications/notificationBox.html",[],function(){return"<!-- ko if: isVisible -->\r\n<div class=\"bannerNotification info\">\r\n    <span class=\"iconfont bell\"></span>\r\n    <a href='#' data-bind=\"click: requestPermission, l10n: { 'key': 'enable_browser_notifications_link_text' }\"></a>\r\n</div>\r\n<!-- /ko -->\r\n"}),define("ui/components/notifications/notificationBox",["require","exports","module","ui/viewModels/notifications/notificationBox","constants/components","text!views/notifications/notificationBox.html"],function(e,t){function r(){return new n}var n=e("ui/viewModels/notifications/notificationBox");t.name=e("constants/components").notifications.NOTIFICATION_BOX,t.template=e("text!views/notifications/notificationBox.html"),t.viewModel={createViewModel:r}}),define("ui/components/notifications/index",["require","ui/components/notifications/notificationBox"],function(e){return[e("ui/components/notifications/notificationBox")]}),define("experience/components/notifications",["require","exports","module","ui/components/notifications/index","ui/components/registrar"],function(e,t){var n=e("ui/components/notifications/index"),r=e("ui/components/registrar");t.init=function(e){r.register(n),e()}}),define("componentsToLoad",["experience/components/experience","experience/components/people","experience/components/calling","experience/components/chat","experience/components/commerce","experience/components/userSettings","experience/components/me","experience/components/notifications"],function(){return Array.prototype.slice.apply(arguments)}),define("experience/componentsLoader",["require","experience/componentsInitializer","componentsToLoad"],function(e){function r(){return new Promise(function(e,r){t.init(n,e,r)})}var t=e("experience/componentsInitializer"),n=e("componentsToLoad");return{init:r}}),define("services/telemetry/experience.instrumentation",["require","swx-constants","swx-utils-common"],function(e){function i(e,t){if(e==="webapi-requestEndpointCreation"&&t===403)return n.get("chat-4171")}var t=e("swx-constants").COMMON,n=e("swx-utils-common").sessionStorage,r={};return r[t.events.errors.SERVICE_FAILURE]=function(e){return{type:"ServiceFault",data:{serviceName:e.serviceName,faultCode:e.faultCode,faultContext:i(e.serviceName,e.faultCode)||t.telemetry.NOT_AVAILABLE,errorCode:e.errorCode||t.telemetry.NOT_AVAILABLE,errorMessage:e.errorMessage||t.telemetry.NOT_AVAILABLE,verb:e.verb||t.telemetry.NOT_AVAILABLE,host:e.host||t.telemetry.NOT_AVAILABLE,contextId:e.contextId||t.telemetry.NOT_AVAILABLE}}},r[t.events.system.EXPERIENCE_INITIALIZED]=function(e){return{type:"session",data:{subType:"init",configLoadDuration:e.configLoadDuration,packageLoadDuration:e.packageLoadDuration,experienceInitializeDuration:e.experienceInitializeDuration}}},r}),define("bindings/ko.keyboardNavigation",["require","lodash-compat","vendor/knockout","swx-focus-handler","swx-constants","browser/window","browser/document","utils/common/eventHelper","swx-constants"],function(e){function f(){var e="tabindex";n.bindingHandlers.keyboardNavigation={init:function(f,l){function p(){var e=d();e.forEach(S)}function d(){var e=f.querySelectorAll(h.itemSelector);return v(e)}function v(e){return Array.prototype.slice.call(e)}function m(){f.addEventListener(a.events.browser.FOCUS,g,!0),f.addEventListener(a.events.browser.BLUR,y,!0),f.addEventListener(a.events.browser.KEYDOWN,b),n.utils.domNodeDisposal.addDisposeCallback(f,function(){f.removeEventListener(a.events.browser.FOCUS,g,!0),f.removeEventListener(a.events.browser.BLUR,y,!0),f.removeEventListener(a.events.browser.KEYDOWN,b)})}function g(e){var t;if(!x(e.target))return;t=d();if(!t.length)return;S(f),p(),t.indexOf(c)!==-1?w(c):h.selectLastItem?w(t[t.length-1]):t.length&&w(t[0])}function y(e){var t=e.target;s.setTimeout(function(){function n(){return x(t)||e.indexOf(o.activeElement)!==-1}var e=d();n()||E(f)},1)}function b(e){function r(n){var r=t[t.indexOf(e.target)];do{r=t[t.indexOf(r)+n];if(!r)break;w(r)}while(o.activeElement!==r)}function s(){w(t[0])}function a(){w(t[t.length-1])}var t,n=u.getKeyCode(e);if(N(e)){C(e);return}if(!T(n))return;return t=d(),e.preventDefault(),e.stopPropagation(),n===i.LEFT||n===i.UP?r(-1):n===i.RIGHT||n===i.DOWN?r(1):n===i.HOME?s():n===i.END&&a(),!1}function w(e){r.get().addFocusRequestToQueue(e,r.Priorities.Immediate),h.persistSelection&&(c=e)}function E(t){t.setAttribute(e,0)}function S(t){t.setAttribute(e,-1)}function x(e){return e===f}function T(e){var t=[i.LEFT,i.UP,i.RIGHT,i.DOWN,i.HOME,i.END];return t.indexOf(e)>-1}function N(e){var t=u.getKeyCode(e);return e.shiftKey&&t===i.F10}function C(e){var t=o.createEvent("MouseEvents"),n=e.target.getBoundingClientRect();e.preventDefault(),e.stopPropagation(),t.initMouseEvent("contextmenu",!0,!1,window,0,0,0,n.right,n.top,!1,!1,!0,!1,2,null),e.target.dispatchEvent(t)}var c,h=t.defaults(l(),{persistSelection:!0,selectLastItem:!1});E(f),p(),m()}}}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-focus-handler"),i=e("swx-constants").KEYS,s=e("browser/window"),o=e("browser/document"),u=e("utils/common/eventHelper"),a=e("swx-constants").COMMON;return{register:f}}),define("bindings/ko.enterKey",["require","vendor/knockout","utils/common/eventHelper","swx-constants","swx-constants"],function(e){function s(){t.bindingHandlers.enterKey={init:function(e,s,o,u){function a(e){var t=n.getKeyCode(e);if(t===i.ENTER||t===i.SPACE&&!f())s().call(u,u,e),e.stopPropagation()}function f(){return e.tagName.toLowerCase()==="input"&&e.type.toLowerCase()==="text"}e.addEventListener(r.events.browser.KEYDOWN,a),t.utils.domNodeDisposal.addDisposeCallback(e,function(){e.removeEventListener(r.events.browser.KEYDOWN,a)})}}}var t=e("vendor/knockout"),n=e("utils/common/eventHelper"),r=e("swx-constants").COMMON,i=e("swx-constants").KEYS;return{register:s}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-focus-handler/lib/knockoutBinding",["require","exports","./focusHandler"],e)}(function(e,t){function r(e){var t=n.get();e.bindingHandlers.focusHandler={init:function(e,n){var r=n();t.addFocusRequestToQueue(e,r.priority).then(function(e){r.callback&&r.callback(function(){t.addFocusRequestToQueue(e,r.priority)})})}}}var n=e("./focusHandler");t.register=r}),define("bindings/ko.getElement",["require","vendor/knockout"],function(e){function n(){t.bindingHandlers.getElement={init:function(e,t,n,r){t().call(r,e)}}}var t=e("vendor/knockout");return{register:n}}),define("bindings/ko.overflowClass",["require","vendor/knockout","browser/dom","browser/window"],function(e){function i(){t.bindingHandlers.overflowClass={init:function(e,n){function u(){var t=e.children,n,r,u;for(u=0;u<t.length;++u)n=t[u],r=s(n),o(n,r.isOverflowingToLeft,i.left),o(n,r.isOverflowingToRight,i.right)}function a(){r.removeEventListener("resize",u),e.removeEventListener("scroll",u),e.removeEventListener("DOMSubtreeModified",u)}var i=n();t.utils.domNodeDisposal.addDisposeCallback(e,a),e.addEventListener("DOMSubtreeModified",u),e.addEventListener("scroll",u),r.addEventListener("resize",u),u()}}}function s(e){var t=u(e,e.parentElement),n=t<e.parentElement.scrollLeft,r=t+e.clientWidth>e.parentElement.clientWidth+e.parentElement.scrollLeft;return{isOverflowingToLeft:n,isOverflowingToRight:r}}function o(e,t,r){if(!r)return;t?n.addClass(e,r):n.removeClass(e,r)}function u(e,t){var n=e.offsetLeft;while(t!==e.offsetParent)n-=t.offsetLeft,t=t.offsetParent;return n}var t=e("vendor/knockout"),n=e("browser/dom"),r=e("browser/window");return{register:i}}),define("bindings/ko.getVisibility",["require","vendor/knockout"],function(e){function n(){t.bindingHandlers.getVisibility={init:function(e,n,r,i){function a(){var t=e.offsetHeight>0&&e.offsetWidth>0;u!==t&&(u=t,o.call(i,t))}var s=window.setInterval(a,50),o=n(),u;t.utils.domNodeDisposal.addDisposeCallback(e,function(){window.clearInterval(s)})}}}var t=e("vendor/knockout");return{register:n}}),define("utils/common/cache/instance",["require","exports","module"],function(e,t){var n;t.get=function(){return n},t.set=function(e){n=e}}),define("utils/people/avatar/cache",["require","lodash-compat","experience/settings","swx-utils-chat","utils/common/cache/instance","swx-utils-people"],function(e){var t=e("lodash-compat"),n=e("experience/settings"),r=e("swx-utils-chat").dateTime,i=e("utils/common/cache/instance"),s=e("swx-utils-people").avatarCache.default,o=new s(i,n,r);return t.bindAll(o),o}),define("utils/people/avatar/helper",["require","lodash-compat","browser/window","swx-utils-people"],function(e){var t=e("lodash-compat"),n=e("browser/window"),r=e("swx-utils-people").avatarHelper.default,i=new r(n.document);return t.bindAll(i),i}),define("bindings/ko.fallBackOnDefaultAvatarOnError",["require","vendor/knockout","lodash-compat","browser/window","swx-constants","swx-service-locator-instance","utils/people/avatar/cache","utils/people/avatar/helper","experience/settings"],function(e){function p(){var e=g;v(s.USE_AVATAR_CACHE)&&(e=m),t.bindingHandlers.fallBackOnDefaultAvatarOnError={init:d,update:e}}function d(e,n,i){var o,u,f=i.get("displayName"),p=i.get("isPstn"),d=i.get("isGroupAvatar"),m=e.parentNode;if(!v(s.USE_AVATAR_INITIALS)||!t.isObservable(f)||p()||d())return;o=f.subscribe(function(){if(t.utils.domData.get(e,l))return;a.showColoredInitials(m,f())}),u=r.setTimeout(function(){a.showColoredInitials(m,f())},h),t.utils.domData.set(e,c,u),t.utils.domNodeDisposal.addDisposeCallback(e,function(){o.dispose()})}function v(e){return o.resolve(i.serviceLocator.FEATURE_FLAGS).isFeatureOn(e)}function m(e,n,r){var i=t.unwrap(n());return u.isCached(i).then(function(t){t||!i?w(e,r):(e.src=i,e.onload=b.bind(null,e),e.onerror=y.bind(null,e,r,u.add.bind(null,e.src)))})}function g(e,n,r){var i=t.unwrap(n());return i?(e.src=i,e.onload=b.bind(null,e),e.onerror=y.bind(null,e,r)):w(e,r),Promise.resolve()}function y(e,t,r){var i=n.isFunction(r)?r:n.noop;e.onload=n.noop,w(e,t),i()}function b(e){var n=t.utils.domData.get(e,c);r.clearTimeout(n),a.resetInitials(e.parentNode),t.utils.domData.set(e,l,!0)}function w(e,t){var r=n.isFunction(t.get("displayName"))?t.get("displayName")():null,i=t.get("isPstn"),o=t.get("isGroupAvatar"),u=t.get("useDefaultAvatar")||n.noop;e.src=E(t),e.onload=n.noop,e.onerror=n.noop,u(!0);if(v(s.USE_AVATAR_INITIALS)&&a.isValidDisplayName(r)&&!i()&&!o()){a.showColoredInitials(e.parentNode,r);return}a.resetInitials(e.parentNode)}function E(e){var t=e.get("isPstn"),n=e.get("isGroupAvatar");return t&&t()?f.appBaseUrl+f.images.relativeToAppBase.defaultPstnAvatarSvg:n&&n()?f.appBaseUrl+f.images.relativeToAppBase.defaultGroupAvatarSvg:f.appBaseUrl+f.images.relativeToAppBase.defaultProfileAvatarSvg}var t=e("vendor/knockout"),n=e("lodash-compat"),r=e("browser/window"),i=e("swx-constants").COMMON,s=i.featureFlags,o=e("swx-service-locator-instance").default,u=e("utils/people/avatar/cache"),a=e("utils/people/avatar/helper"),f=e("experience/settings"),l="imageLoaded",c="initialsTimer",h=100;return{register:p}}),define("bindings/ko.transitionEnd",["require","vendor/knockout"],function(e){function n(){t.bindingHandlers.transitionEnd={init:function(e,n){function u(e){o&&clearTimeout(o),o=setTimeout(function(){r(e),o=null},0)}var r=n(),i=["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"],s,o;r&&typeof r!="function"&&(s=r.moreElementsToWatch,r=r.callback),s=(s||[]).map(function(e){return document.querySelector(e)}).filter(function(e){return!!e}),i.forEach(function(t){e.addEventListener(t,u),s.forEach(function(e){e.addEventListener(t,u)})}),t.utils.domNodeDisposal.addDisposeCallback(e,function(){i.forEach(function(t){e.removeEventListener(t,u),s.forEach(function(e){e.removeEventListener(t,u)})})})}}}var t=e("vendor/knockout");return{register:n}}),define("experience/koBindingsRegistrar",["require","exports","module","vendor/knockout","bindings/ko.keyboardNavigation","bindings/ko.enterKey","swx-focus-handler/lib/knockoutBinding","bindings/ko.getElement","bindings/ko.overflowClass","bindings/ko.getVisibility","bindings/ko.fallBackOnDefaultAvatarOnError","bindings/ko.transitionEnd"],function(e,t){var n=e("vendor/knockout"),r=e("bindings/ko.keyboardNavigation"),i=e("bindings/ko.enterKey"),s=e("swx-focus-handler/lib/knockoutBinding"),o=e("bindings/ko.getElement"),u=e("bindings/ko.overflowClass"),a=e("bindings/ko.getVisibility"),f=e("bindings/ko.fallBackOnDefaultAvatarOnError"),l=e("bindings/ko.transitionEnd");t.registerBindings=function(){r.register(),i.register(),s.register(n),a.register(),o.register(),u.register(),f.register(),l.register()}}),define("notifications/init",["require","exports","module","swx-browser-globals","ui/viewModels/notifications/allowBrowserNotificationModalDialog","ui/telemetry/actions/actionNames","swx-cafe-application-instance","swx-constants","swx-enums","swx-i18n","swx-service-locator-instance","notifications/factory","notifications/common/notificationHub","utils/common/localStorage","notifications/settings"],function(e,t){var n=e("swx-browser-globals"),r=e("ui/viewModels/notifications/allowBrowserNotificationModalDialog"),i=e("ui/telemetry/actions/actionNames"),s=e("swx-cafe-application-instance"),o=e("swx-constants").COMMON,u=e("swx-enums"),a=e("swx-i18n").localization,f=e("swx-service-locator-instance").default,l=e("notifications/factory"),c=e("notifications/common/notificationHub"),h=e("utils/common/localStorage"),p=e("notifications/settings");t.isInitialized=!1,t.init=function(){if(t.isInitialized===!0)return;t.isInitialized=!0;var e=f.resolve(o.serviceLocator.MODEL_UI_OBSERVER);p.init(),s.get().signInManager.state.once(u.loginState.SignedIn,function(){e.observe(s.get())})},t.update=function(){function u(){var e,t,n,r=o.telemetry.idleUsersAnalytics.localKeys.signInData;try{return e=h.get(r),e?(t=JSON.parse(e),t.length<2?!0:(n=(new Date(Date.now())).setHours(0,0,0,0),(new Date(t[t.length-2])).getTime()<n)):!0}catch(i){return!0}}function d(){if(p.chatNotificationsMuted()||!e.isFeatureOn(o.featureFlags.BROWSER_NOTIFICATIONS_EDUCATIONAL_TOAST_ENABLED)||!m()||v())return;var n=f.resolve(o.serviceLocator.ACTION_TELEMETRY),s=l.build(o.notifications.UNREAD_MESSAGE,{educationalMessage:a.fetch({key:"enable_browser_notifications_toast"}),showAction:function(){h.set(t,Date.now()),n.recordAction(i.browserNotificationsOptInToast.shown)},clickAction:r.show});c.notify(s)}function v(){var e=h.get(t);return e?Date.now()-e<6048e5:!1}function m(){return c.areBrowserNotificationsSupported()&&n.getWindow().Notification.permission===o.permission.DEFAULT}function g(){var e=o.telemetry.browserToast.ignore,t=h.get(e.TIMEOUT_KEY),n;return t?(n=parseInt(t,10),n>=Date.now()?!0:(h.remove(e.TIMEOUT_KEY),!1)):!1}var e=f.resolve(o.serviceLocator.FEATURE_FLAGS),t="swx|browserNotificationsToastLastFired";p.init(),e.isFeatureOn(o.featureFlags.UNREAD_MESSAGE_REMINDER_TOAST)?s.get().conversationsManager._unreadCounversationsCounters().then(function(e){var t=!1,n=e[0]>0&&!g(),r=s.get().conversationsManager._unreadConversations();if(!n||p.chatNotificationsMuted()){d();return}t=u();if(!t){d();return}if(!r||!r.length)return;var i=l.build(o.notifications.UNREAD_MESSAGE,{isReminderToast:!0,unreadConversations:r});c.notify(i),setTimeout(function(){d()},3e3)}):d()}}),define("services/calling/autoCalling",["require","exports","module","swx-cafe-application-instance","ui/viewModels/calling/helpers/callingFacade","swx-constants","swx-log-tracer","swx-service-locator-instance","swx-utils-common","experience/api/helpers/conversationsSynchronizer"],function(e,t){function f(e){var t=n.get().conversationsManager,f=o.resolve(i.serviceLocator.FEATURE_FLAGS);if(!f.isFeatureOn(i.featureFlags.CALLING))return;if(!f.isFeatureOn(i.featureFlags.AUTO_CALLING))return;u.set(i.autoCallingThreadId,e),n.get().personsAndGroupsManager.mePerson.id.get().then(function(){a.sync().then(function(){var n=t.getConversationByUri(e);n&&n.autoCall?n.autoCall.once(!0,function(){r.placeCall(n,!0,"autoCalling")}):s.warn("Unable to find conversation with thread id = ",e)})})}var n=e("swx-cafe-application-instance"),r=e("ui/viewModels/calling/helpers/callingFacade"),i=e("swx-constants").COMMON,s=e("swx-log-tracer").getLogger(),o=e("swx-service-locator-instance").default,u=e("swx-utils-common").sessionStorage,a=e("experience/api/helpers/conversationsSynchronizer");t.init=function(){var e=u.get("userSession");if(!e){u.remove(i.autoCallingThreadId);return}try{var t=JSON.parse(e).threadId;t?new f(t):(u.remove(i.autoCallingThreadId),s.warn("Thread ID doesnt exist in user session"))}catch(n){u.remove(i.autoCallingThreadId),s.error("Unable to setup auto calling",n)}}}),define("services/g11n/default",[],function(){return{calendar:{days:{names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],namesAbbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},months:{names:["January","February","March","April","May","June","July","August","September","October","November","December"],namesAbbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},firstDay:0},time:{AM:"am",PM:"pm",separator:":",format:{duration:"mm:ss","short":"h:mm tt","long":"h:mm:ss tt"}},date:{separator:"/",format:{dayMonth:"M/d",dayMonthYear:"M/d/yy",dayAbbr:"dAbbr",dayName:"dName",dateAbbr:"mAbbr d yyyy",shortDateAbbr:"mAbbr d"}},dir:"ltr"}}),define("services/g11n/init",["require","swx-utils-common","swx-constants","swx-g11n","services/g11n/default","services/i18n/cultureInfo"],function(e){function o(e,t){e.locale=e.locale||{},e.locale.g11n=t}function u(e,i,u){function c(){var e=l[a];if(e.lang===n.i18n.EMBEDDED_LOCALE){o(u,e.lang);return}return(new Promise(function(n,r){t.loadScript(e.url,n,r)})).then(function(){o(u,e.lang)}).catch(function(){a++;if(a>=l.length)throw new Error("All attempts failed to load g11n settings for:"+i);return c()})}var a=0,f=s.getLocale(i),l=[{lang:i,url:e+"/"+i+"/settings.js"}];return f!==i&&l.push({lang:f,url:e+"/"+f+"/settings.js"}),l.push({lang:n.i18n.EMBEDDED_LOCALE,url:e+"/en-us/settings.js"}),Skype.WebExperience=Skype.WebExperience||{},Skype.WebExperience.setGlobalization=function(e){r.init(e)},c()}function a(e){var t=e.initParams.locale;if(t!==n.i18n.EMBEDDED_LOCALE){var r=e.appBaseUrl+"/resources/g11n";return u(r,t,e)}o(e,t)}var t=e("swx-utils-common").loader,n=e("swx-constants").COMMON,r=e("swx-g11n").globalization,i=e("services/g11n/default"),s=e("services/i18n/cultureInfo");return r.init(i),{init:a}}),define("services/i18n/swx/default",[],function(){return{splashScreen_text_logo_4b:"Skype for Business",splashScreen_text_loading:"Loading...",splashScreen_text_signingIn:"Signing in...",splashScreen_text_signingIn_wac:"Joining the chat...",splashScreen_text_loading_skype:"Loading Skype",splashScreen_text_loading_skype_4b:"Loading Skype for Business",splashScreen_text_signing_into_skype:"Signing in to Skype",splashScreen_text_signing_into_skype_4b:"Signing in to Skype for Business",splashScreen_signedOut_title:"Please sign in to get started.",splashScreen_signedOut_title_wac:"Please join the chat to get started.",splashScreen_signedOut_reauth_needed_title:"You have been signed out",splashScreen_signedOut_reauth_needed_description:"Sign in using your Microsoft account to continue using Skype.",splashScreen_disconnected_title:"You have been disconnected.",splashScreen_disconnected_description:"Please try to sign in again or refresh the page.",splashScreen_disconnected_description_wac:"Please try to join the chat again or refresh the page.",splashScreen_signInFailed_title:"We couldn't sign you in.",splashScreen_signInFailed_title_wac:"We couldn't join you to the chat.",splashScreen_signInFailed_title_security_validation:"Make video and voice calls with Skype for Web.",splashScreen_signInFailed_description:"Please try to sign in again or refresh the page.",splashScreen_signInFailed_description_wac:"Please try to join the chat again or refresh the page.",splashScreen_signInFailed_description_exceeded_endpoints:"Skype has exceeded number of endpoints allowed.",splashScreen_signInFailed_description_age_restriction:"Sorry, you can't use Skype due to age restrictions.",splashScreen_signInFailed_aad_description:"Please try to sign in again or refresh the page.",splashScreen_learn_more:"Learn more",splashScreen_signIn_button:"Sign in",splashScreen_signIn_button_wac:"Join the chat",splashScreen_signInExternal_button:"Sign in with a Microsoft account",splashScreen_eduCarousel_conversation_header:"Conversations",splashScreen_eduCarousel_conversation_text:"Chat with friends and family by sending them an instant message, Moji or photo.",splashScreen_eduCarousel_find_friends_header:"Find Friends",splashScreen_eduCarousel_find_friends_text:"Search for people you know on Skype using their Skype Name, email, mobile or full name.",splashScreen_signInExternal_title:"Attempting to sign in.",splashScreen_signInExternal_description:"Please enter your account and password when prompted.",unsupportedBrowser_title:"Please update your browser to start using Skype.",skypeUnavailable_title:"We're currently experiencing server issues. Skype is working on the issues and will be available again shortly.",aggressiveLinking_intro_title:"Say hello on Outlook",aggressiveLinking_intro_description:"You can now call and chat with Outlook contacts right from your inbox and best of all, it's free.",aggressiveLinking_intro_continue:"Continue",aggressiveLinking_intro_signin:"Already using Skype? {link_start}Sign in{link_end}",aggressiveLinking_intro_legal:"By continuing, you agree to {link_tou_start}Skype's Terms of Use{link_tou_end} and {link_privacy_start}Privacy Policy{link_privacy_end}.",one_account_link:"Already using Skype? {link_start}Learn more{link_end}",input_placeholder_searchSkype:"Search Skype",input_searchSkype_ariaLabel:"Search conversation. Type contact or group name.",input_searchSkype_ariaLabel_4b:"Search conversation. Type contact name.",input_searchSkypeDirectory_ariaLabel:"Search Skype Directory",clear_search_input_label:"Clear search",button_text_newChat:"New Chat",button_text_new:"New",button_text_dialpad:"Call phones",input_text_skypeOut:"Enter name or number",input_text_skypeOut_short:"Enter number",clear_phonenumber_input_label:"Clear phone number",select_placeholder_skypeOut:"Choose country/region",label_text_participant:"{count} participant",label_text_participant_few:"{count} participants",label_text_participant_many:"{count} participants",area_text_insertText:"Type a message here",area_text_insertTextWithCommands:"Type a message here or {helpCommand} for the list of commands",area_text_agent_insertText:"Sorry, you can't reply right now",area_text_insertTextNonMember:"You have left this group.",label_text_insertText_oneToOne:"Chat input, conversation with {displayName}. {quotedText}",label_text_insertText_group:"Chat input, conversation with {displayName}, {participantsText}. {quotedText}",label_text_conversationsLoading:"Loading recent conversations...",label_text_conversationsLoadNone:"No recent conversations",label_text_currentCallHeading:"Current call",label_text_openConversation:"Open conversation with {displayName}",label_text_from:"From: ",label_text_clearedText:"Text area cleared",label_text_clearedQuotes:"Quoted Message cleared",label_quoted_message:"Quoted Message {quotesContent} from {senderName} at {time}",today:"today",yesterday:"yesterday",olderThanAWeek:"older than a week",duration_days:"{count} day",duration_days_few:"{count} days",duration_days_many:"{count} days",duration_hours:"{count} hour",duration_hours_few:"{count} hours",duration_hours_many:"{count} hours",duration_minutes:"{count} minute",duration_minutes_few:"{count} minutes",duration_minutes_many:"{count} minutes",duration_moment:"moment",content_search_conversation_title_days:"{count} day ago in <b>{conversationTitle}</b>",content_search_conversation_title_days_few:"{count} days ago in <b>{conversationTitle}</b>",content_search_conversation_title_days_many:"{count} days ago in <b>{conversationTitle}</b>",content_search_conversation_title_hours:"{count} hour ago in <b>{conversationTitle}</b>",content_search_conversation_title_hours_few:"{count} hours ago in <b>{conversationTitle}</b>",content_search_conversation_title_hours_many:"{count} hours ago in <b>{conversationTitle}</b>",content_search_conversation_title_minutes:"{count} minute ago in <b>{conversationTitle}</b>",content_search_conversation_title_minutes_few:"{count} minutes ago in <b>{conversationTitle}</b>",content_search_conversation_title_minutes_many:"{count} minutes ago in <b>{conversationTitle}</b>",content_search_conversation_title_moment:"moment ago in <b>{conversationTitle}</b>",content_search_header:"Messages",content_search_aria:"Conversation with {topic}.",content_search_additional_results:"Show more messages",contact_isSelected:"Selected",label_text_headerMenuRemoveGroup:"Remove from the group",label_text_headerMenuChat:"Chat",label_text_headerMenuInstantMessage:"Instant message",button_text_discover_agents:"Discover Bots",label_text_discover_agents_page_header:"Bots",label_text_discover_agents_page_hint:"Hint: Interact with Bots by tapping on them and adding them to your contacts.",label_text_discover_agents_page_zero_results_text_part_1:"It looks like you've already connected with all of the Bots. You can interact with them from the Contacts page or by searching for them.",label_text_discover_agents_page_zero_results_text_part_2:"We're always adding new Bots, so check back here soon.",label_text_contact_profile_details:"Contact Details",label_text_contact_profile_skype_name:"Skype",label_text_contact_profile_skype_for_business_name:"Skype for Business",label_text_contact_profile_information:"Information",label_text_contact_profile_location:"Location",label_text_contact_profile_birthday:"Birthday",label_text_contact_profile_gender:"Gender",label_text_contact_profile_language:"Language",label_text_contact_profile_agent_description:"Description",label_text_contact_profile_agent_author:"Author",label_text_contact_profile_agent_certification:"Certification",label_text_contact_profile_agent_rating:"Average Rating",label_text_view_profile_menu_item:"View Profile",label_text_agent_profile_label_agentid:"Bot",label_text_agent_profile_label_skype_certified:"Skype Certified",label_text_agent_profile_label_author:"Created by",label_text_agent_profile_label_description:"About",label_text_agent_profile_label_website:"Website",label_text_agent_profile_label_privacy:"Privacy",label_text_agent_profile_value_privacy:"This bot will have access to your display name, country/region and language and any messages or content that you or other participants share with the bot.",label_text_agent_profile_value_privacy_autoplay:"It may also autoplay media content from third parties",label_text_agent_profile_link_text_terms_of_service:"Terms of Service",label_text_agent_profile_link_text_privacy_statement:"Privacy Statement",label_text_agent_profile_label_rating:"Rating",label_text_agent_profile_label_capabilities:"Here's what you can do with this bot",label_text_agent_profile_label_extra_info:"More info",label_text_agent_profile_capabilities_none:"read updates from this bot",label_text_agent_profile_capabilities_join_char:", ",label_text_agent_profile_capabilities_audio_send:"make voice calls",label_text_agent_profile_capabilities_video_send:"make video calls",label_text_agent_profile_capabilities_im_send:"send instant messages",label_text_agent_profile_capabilities_screen_sharing:"share your screen",label_text_agent_profile_capabilities_gvc:"make group video calls",label_text_agent_profile_capabilities_group_chat:"add bot to group chats",label_text_agent_profile_capabilities_group_chat_mention_only_mode:"(this bot receives messages sent to it using <i>@{botName}</i>)",label_text_agent_profile_capabilities_group_chat_all_messages_mode:"(this bot receives all messages and content sent in the group)",label_text_agent_profile_capabilities_file_send:"send files",label_text_agent_profile_capabilities_contact_send:"send contacts",label_text_agent_profile_capabilities_videomessage_send:"send video messages",label_text_agent_profile_capabilities_audiomessage_send:"send audio messages",label_text_agent_profile_capabilities_mediamessage_send:"send media messages",label_text_agent_profile_capabilities_photo_send:"send photos",label_text_agent_profile_capabilities_moji_send:"send Mojis",label_text_agent_profile_capabilities_location_send:"share location",label_text_agent_profile_capabilities_media_autoplay:"autoplay media content",label_text_blockContact:"Block contact",label_text_block_agent:"Block bot",label_text_blockContact_with_name:"Block {name}",label_text_unblockContact:"Unblock contact",label_text_unblock_agent:"Unblock bot",label_text_unblockContact_with_name:"Unblock {name}",label_text_deleteContact:"Delete contact",label_text_delete_agent:"Delete bot",label_text_call_skype_audio:"Skype call",label_text_call_skype_video:"Video call",label_text_send_message:"Send a message",label_text_call:"Call",label_text_call_phone_number:"Call ({phoneNumber})",label_text_call_phone_number_home:"Call Home ({phoneNumber})",label_text_call_phone_number_work:"Call Office ({phoneNumber})",label_text_call_phone_number_cell:"Call Mobile ({phoneNumber})",label_text_call_phone_number_type:"Call {phoneNumberType} ({phoneNumber})",label_text_phone_number_type_home:"Home",label_text_phone_number_type_work:"Office",label_text_phone_number_type_cell:"Mobile",label_text_phone_number_type_other:"Other",modal_blockContact_text_aria_label:"Block Contact",modal_block_agent_text_aria_label:"Block bot",modal_blockContact_text_title:"Are you sure you want to block {displayName}?",modal_blockContact_text_message:"They won't be able to contact you and won't appear in your Contact List.",modal_block_contact_text_learn_more_link:"Learn more",modal_blockContact_text_reportAbuse:"Report abuse from this person",modal_block_agent_text_reportAbuse:"Report abuse from this bot",select_placeholder_report_abuse_reason:"Select a reason...",report_abuse_reason_option_spam:"Spam",report_abuse_reason_option_pornography:"Contains nudity or pornography",report_abuse_reason_option_child_exploitation:"Child exploitation",report_abuse_reason_option_harassment:"Harassment or threats",modal_deleteContact_text_aria_label:"Delete Contact",modal_delete_agent_text_aria_label:"Delete bot",modal_deleteContact_text_title:"Are you sure you want to delete {displayName}?",modal_deleteContact_text_message:"{displayName} will be removed from your contact list.",modal_device_disabled_chrome_title:"To make Skype calls, please allow Google Chrome access to your camera and microphone.",modal_device_disabled_chrome_text:"Click the {image} icon in the address bar to allow camera and microphone access.",modal_device_disabled_edge_title:"To make Skype calls, please allow Microsoft Edge access to your camera and microphone.",modal_device_disabled_edge_text:'Simply reload this page and try to make another call. Then select "Yes" when prompted to allow access.',header_text_close:"Close",header_text_participantsOthersCanJoin:"{count} participant, others can join",header_text_participantsOthersCanJoin_few:"{count} participants, others can join",header_text_participantsOthersCanJoin_many:"{count} participants, others can join",header_text_shareThisGroup:"Share this group",header_text_groupSettings:"Group Settings",header_text_copyLink:"Copy link",header_text_copied:"Copied",header_text_inviteViaEmail:"Invite via email",header_text_adminSettings:"Manage group",header_text_makeHistoryAvailable:"Make chat history available to new joiners",header_text_joinViaLink:"Make a link for anyone to join",header_text_allowOthersToJoin:"Allow others to join with a link",header_text_othersCanJoin:"Others can join with a link",header_text_muteConversation:"Conversation notifications",header_secondary_text_muteConversation:"Notify me when something new happens",header_narrator_notifications_on:"Notifications on",header_narrator_notifications_off:"Notifications off",header_text_admin:"Admin",header_text_admin_4b:"Presenter",header_text_guest:"Guest",spaces_default_name:"Untitled conversation",spaces_tooltip_text:"Invite other people by sending them this link, even if they're not on Skype.",spaces_email_subject:"I'm ready to chat on Skype",spaces_joining_disabled_message_start:'Turn on <i>"Make a link for anyone to join"</i> from the ',spaces_joining_disabled_anchor_text:"profile ",spaces_joining_disabled_message_end:"to get a link you can share.",spaces_email_greeting:"Hello,",spaces_email_joinMe:"I've made a group on Skype for us to chat, share and collaborate.",spaces_email_link:"Join by click the link",spaces_welcomeTitle:"Your conversation is all set up",spaces_welcomeMessage:"Share photos, messages and much more with everyone here or invite even more people by sharing this link with them",spaces_welcomeMessageWithoutLink:"Share photos, messages and much more with everyone here",spaces_welcomeRenameBtnTitle:"Rename conversation",spaces_welcomeRenameBtnMessage:"Make your conversation unique",spaces_welcomeSettingsBtnTitle:"Settings",spaces_welcomeSettingsBtnMessage:"Manage your conversation",spaces_anyoneElse:"Anyone else? Send them a link",spaces_conversation_renamed_success:"Renamed conversation to {conversationName}.",input_placeholder_addAnotherContact:"Add another contact",input_placeholder_typeContactName:"Type contact name",message_text_hasLeftConversation:"{participant} has left this conversation",message_text_wasRemovedFromConversation:"{participant} has removed {removedParticipant} from this conversation",message_text_youWereRemovedFromConversation:"You have been removed from this conversation",message_text_joinedConversation:"{participant} joined this conversation",message_text_joinConversationFailed:"{participant} could not join this conversation",message_text_meJoinedConversation_one:"{participant} is already chatting",message_text_meJoinedConversation_more:"{participants} and {participant} are already chatting",message_text_wasAddedToConversation:"{participant} added {contact} to this conversation.",message_text_botWasAddedToConversation:"To chat, start your message with <i>@{botName}</i>. All other messages in the group are hidden from the bot.",message_text_joiningConversationWithBots:"<b>{botName} is participating in this group.</b></br>To chat, start your message with <i>@{botName}</i>. All other messages in the group are hidden from the bot.",message_text_joiningConversationWithBotsV2:"<b>{botName} is participating in this group.</b></br>",message_text_addedBotGroupConversation_privateMode:"<b>{botName} receives messages sent directly to it using <i>@{botName}</i>.",message_text_addedBotGroupConversation_allMessagesMode:"<b>{botName} receives all messages and content sent in this chat.",message_text_roleUpdated:"{who} updated {whom}'s role to {role}",message_text_topicUpdated:"{participant} has changed the conversation topic to '{topic}'",message_text_threadPictureUpdated:"{participant} has changed the conversation picture",message_text_historyClosed:"Conversation history was closed by {participant}",message_text_historyDisclosed:"Conversation history was disclosed by {participant}",message_text_sentContacts:"Contacts sent to the conversation",message_text_receivedContacts:"Contacts received from {from}",message_text_contactItem:"<li>{fullName} ({name})</li>",message_text_joiningEnabled:"{participant} enabled joining this conversation",message_text_joiningDisabled:"{participant} disabled joining this conversation",message_text_legacyMemberAdded:"{participant} needs to update Skype to participate in this conversation. Help by sending them to http://www.skype.com/en/download-skype/skype-for-computer/",message_text_legacyMemberUpgraded:"{participant} can now participate in this conversation.",message_text_emptyConversation:"No history available for this conversation",message_text_startedCall:"Call",message_text_startedGroupCall:"Group call",message_text_endedCall:"Call ended",message_text_endedGroupCall:"Group call ended",message_text_outgoingCallNoAnswer:"Call, no answer",message_text_outgoingGroupCallNoAnswer:"Group call, no answer",message_text_missedCall:"Missed call",message_text_missedGroupCall:"Missed group call",message_text_unknownMessageType:"Unknown message type '{mesageType}'",message_text_fileTransferNotSupported:"Receiving files over P2P network is not supported on Skype for Web",message_text_parsing_error:"There was error during message parsing !",message_text_unsupportedVideoMessageYet:"Receiving video messages is not supported on Skype for Web",message_text_unsupportedAudioMessageYet:"Receiving audio messages is not supported on Skype for Web",message_text_guestRemovedBySystem:"The guest account for {participant} has expired",message_text_pollsFeatureDisabled:"Sorry, Polls are not available at this moment. Please try again later. ",message_text_ngcUpgradeMessage_one:"<strong>{participant}</strong> was unable to join this call. They may need to come online, update Skype, or they're using an unsupported device. Find out more at {link}",message_text_ngcUpgradeMessage_many:"<strong>{participantList}</strong> and <strong>{lastParticipant}</strong> were unable to join this call. They may need to come online, update Skype, or they're using an unsupported device. Find out more at {link}",message_text_swift_card:"Card",message_text_swift_cards:"Cards",message_text_swift_receipt:"Receipt",message_text_swift_signIn:"Sign in",message_text_swift_defaultTitle:"Sent you a message",message_text_swift_defaultGroupTitle:"{displayName} sent a message",message_text_swift_vat:"VAT",message_text_swift_tax:"Tax",message_text_swift_totalPrice:"Total",message_text_swift_unsupported:"Get the latest version of Skype to view this card.",message_text_swift_unsupported_button:"Learn more",message_text_swift_showImageTitle:"Enlarge image",message_text_swift_signInTitle:"Connect",message_text_swift_prevCard:"Show previous",message_text_swift_nextCard:"Show next",message_text_swift_showAll:"Show all",message_text_swift_showLess:"Show less",swift_videocard_control_button_mute:"Mute",swift_videocard_control_button_unmute:"Unmute",accessibility_swift_openUrl:"Click to open website in your browser",accessibility_swift_imBack:"Click to send response to bot",accessibility_swift_call:"Click to make a call",accessibility_swift_showImage:"Click to enlarge image",accessibility_swift_action_prefix:"Click to {swiftAction}",message_text_pluginFree_screenSharingFallback_line1:"Screen sharing will be available shortly.",message_text_pluginFree_screenSharingFallback_line2:"Alternatively, switch to the Skype app for your device to receive screen sharing {upgrade_link}.",message_text_pluginFree_microphoneAccess_edge:"No microphone detected. Connect a microphone or check your microphone privacy settings in Settings -> Privacy -> Microphone.",message_text_pluginFree_microphoneAccess_others:"No microphone detected. Connect a microphone or check your microphone privacy settings for your device and browser.",message_text_pluginFree_noVideoCapability:"Sorry, video support is not yet available for this platform.",message_text_suggestedContactGreeting:"<strong>{displayName}</strong> is an address book contact, but needs you to connect first before chatting",message_text_suggestedContactConnectAction:"Connect on Skype",message_text_contactBlockedMessage:"You have blocked <strong>{displayName}</strong>",message_text_contactAccepted:"Contact accepted",message_text_addingContactRequest:"<strong>{id}</strong> wants to add you as a contact",message_text_isNowAContact:"<strong>{id}</strong> is now a contact",message_text_contactRequestGreeting:"Hi, {displayName}, I'd like to add you as a contact.",message_text_contactRequestIsNowContact:"<strong>{displayName}</strong> is now a contact",message_text_contactRequestOutgoingMessage:"<strong>{displayName}</strong> is not in your contacts",message_text_contactRequestOutgoingResendMessage:"Contact request sent",message_text_contactRequestOutgoingResendAction:"Resend contact request",message_text_contactRequestIncomingMessage:"<strong>{displayName}</strong> wants to add you as a contact",message_text_contactRequestSendAction:"Add to Contacts",message_text_contactRequestAcceptAction:"accept",message_text_contactRequestDeclineAction:"decline",message_text_unblockContact:"unblock",message_text_timeStampMessage:"Sent on: ",message_text_longTimeStamp:"{date} at {time}",message_text_removed:"Removed on {date} at {time}",message_text_presenceAvailable:"Available",message_text_presenceOnline:"Online",message_text_presenceNotAvailable:"Not Available",message_text_presenceOffline:"Offline",message_text_presenceHidden:"Invisible",message_text_contactTitleLocal:"People",message_text_contactTitleDirectory:"Directory",message_text_contactBlocked:"Blocked",button_translations_see_original_message:"See original",button_translations_see_translated_message:"See translation",button_translator_translatorSettings:"Skype Translator",label_translator_translatorSettings:"Translator preview",button_translator_translatorSettingsOn:"Switched on",button_translator_translatorSettingsOff:"Switched off",label_translator_translatorOn:"On",label_translator_translatorOff:"Off",label_translator_selected_theirLanguage:"Selected {language} for {name}",label_translator_selected_myLanguage:"Selected {language} for yourself",button_text_searchDirectory:"Search Skype Directory",message_text_emptySearchResults:"No results found",message_text_groupSearchResultsTitle:"Groups",message_title_allContacts:"All contacts",message_bucketName_other:"#",message_not_delivered_text:"This message has not been delivered",message_edited_text:"This message was edited",message_more_search_results_available:"Too many results; try refining your search",label_text_newConv:"New",newbee_text_header:"Get the conversation started",newbee_text_cta:"Find your friends by entering their name or email in the Search Skype field.",newbee_text_cta_4b:"Find your co-workers by entering their name in the Search field.",contactPage_text_menuLink:"Contacts",contactPage_text_header:"Contacts",contactPage_text_tab_allContacts:"All contacts",contactPage_text_tab_available:"Online",contactPage_text_tab_work:"Work",contactPage_text_tab_agents:"Bots",contactPage_text_hint_search:"Hint: you can add new contacts by searching",contactPage_text_manage_contacts_button:"Manage Contacts",contactPage_text_informational_message:"Get the Skype for Business app for video calls and online meetings.",settings_page_text_header:"Settings",settings_pane_opened:"Settings pane opened",settings_im_settings_category_title:"IM settings",settings_privacy_category_title:"Privacy",settings_unlisted_category_title:"Unlisted",settings_contacts_category_title:"Contacts",settings_about_category_title:"About",settings_personalization_category_title:"Personalization",settings_im_appearance_category_title:"IM appearance",settings_notifications_category_title:"Notifications",settings_unknownOption_title:"Unknown option: {id}",settings_unknownOption_alt_text:"Unknown option: {id}",settings_mentionsEnabled_title:"@mention notifications",settings_mentionsEnabled_alt_text:"Always notify me when someone mentions me on Skype. (@&lt;username&gt;)",settings_youtube_player_title:"YouTube player",settings_youtube_player_alt_text:"Use YouTube player directly to preview videos I send or receive.",settings_urlPreview_title:"Web link previews",settings_urlPreview_alt_text:"Show me a preview of websites I send or receive on Skype.",settings_filePaste_title:"Enable image paste",settings_filePaste_alt_text:"Enable pasting of images from clipboard directly into the chat",settings_skypeCallPolicy_title:"Allow calls from:",settings_skypeVideoPolicy_title:"Allow video and screen sharing from:",settings_camera_title:"Camera",settings_microphone_title:"Microphone",settings_speaker_title:"Speaker",settings_no_camera_title:"No camera available",settings_no_microphone_title:"No microphone available",settings_no_speaker_title:"No speaker available",settings_close_title:"Close",settings_default_device_name:"Automatically selected",settings_typingIndicator_title:"Typing indicator",settings_typingIndicator_alt_text:"Show when I am typing",settings_pinRecentFavorites_title:"Show favorites above recent conversations",settings_pinRecentFavorites_alt_text:"Pin your favorite contacts and conversations at the top of the recent message list",settings_emoticonSuggestions_title:"Emoticon suggestions",settings_emoticonSuggestions_alt_text:"Show emoticon suggestions as I type chat messages.",settings_showEmoticons_title:"Show emoticons",settings_showEmoticons_alt_text:"Show Skype emoticons in chat.",settings_showAnimatedEmoticons_title:"Show animated emoticons",settings_showAnimatedEmoticons_alt_text:"Animate Skype emoticons in chat.",settings_showLargeEmoticons_title:"Show large emoticons",settings_showLargeEmoticons_alt_text:"Make single emoticons larger in chat.",settings_translator_title:"Translator",settings_translator_title_alt_text:"Enable Skype Translator",settings_sendReadReceipts_title:"Send read receipts",settings_sendReadReceipts_alt_text:"Show when other people have read your messages. When turned off, you also won't see their read receipts either.",settings_privacy_opt_1_title:"Anyone",settings_privacy_opt_2_title:"Contacts only",settings_privacy_opt_3_title:"Nobody",settings_short_circuit_my_contact_list:"My contact list",settings_short_circuit_title:"Automatically add friends",settings_short_circuit_description:"Skype will check your address books and automatically add people you know to your Skype Contact list.",settings_short_circuit_deny:"Don't automatically add friends",settings_short_circuit_deny_title:"You'll need to manually find and add new contacts.",settings_short_circuit_manage_contacts:"Manage address books",settings_short_circuit_auto_buddy_discovery_title:"How people find me:",settings_short_circuit_auto_buddy_discovery_description:"These contact details can be used to find you on Skype",settings_short_circuit_remove:"Remove",settings_short_circuit_remove_accessible_text:"Remove {proof}",settings_short_circuit_add_number:"Add new number",settings_notifications_title:"Chat notifications",settings_notifications_alt_text:"Receive notifications for new chat messages",settings_notifications_sound_title:"Sound",settings_notifications_sound_alt_text:"Turn notification sounds on or off",settings_chat_notifications_sound_title:"Chat notification sounds",settings_chat_notifications_sound_alt_text:"Play notification sounds for new chat messages",settings_call_notifications_title:"Incoming call notification",settings_call_notifications_alt_text:"Receive notifications for incoming calls",settings_call_notifications_sound_title:"Incoming call notification sounds",settings_call_notifications_sound_alt_text:"Play notification sounds for incoming calls",settings_ringing_deferrer_title:"Mute ringing",settings_ringing_deferrer_alt_text:"Mute ringing sounds of incoming calls for a certain period of time",settings_ringing_deferrer_defer_for:"For {count} hour",settings_ringing_deferrer_defer_for_few:"For {count} hours",settings_ringing_deferrer_defer_for_many:"For {count} hours",settings_dark_theme:"Dark theme",settings_dark_theme_alt_text:"Change the colors of this app.",settings_video_autoplay:"Automatic video playback",settings_video_autoplay_alt_text:"Choose when to auto-play videos.",setting_on:"On",setting_off:"Off",search_skype_for_friends_and_family_header:"Find friends on Skype",search_skype_for_friends_and_family_message:"Enter their Skype Name, email or number.",search_skype_for_friends_and_family_tip:"Tip: Narrow your search by including their city, country or region.",search_skype_for_friends_and_family_text:"It's a cool and easy way to stay in touch.",search_skype_for_friends_and_family_link:"Learn more here.",search_skype_for_friends_and_family_searchDirectory:"Search Directory",short_circuit_contacts_page_message:"Quickly add people from your address book",short_circuit_contacts_page_message_v2:"Automatically add friends from your address book",short_circuit_contacts_page_cta:"Add friends",about_app_version:"App version",about_assets_version:"Assets version",about_plugin_version:"Plugin version",about_plugin_not_available:"Not available",about_faq:"Frequently asked questions",message_text_callingNotSupportedBrowser:"Audio and video calls are not supported on your browser",message_text_callingNotSupportedOS:"Audio and video calls are not supported on your OS",message_text_callingIsDisabled:"Calling is currently disabled.",chatLogmenuItem_text_copy:"Copy as Quote",chatLogmenuItem_text_quote:"Quote Message",chatLogmenuItem_text_edit:"Edit Message",chatLogmenuItem_text_remove:"Remove Message",chatLogmenuItem_text_like:"Like Message",chatLogmenuItem_text_save:"Save",chatLogmenuItem_copy_link:"Copy link",chatLogmenuItem_open_link:"Open",chatLogmenuItem_text_copySelection:"Copy as Quote",chatLogmenuItem_text_copyText:"Copy Text",chatLogIntroText_text:"Chat with people editing this file in Office Online. | This chat won't be saved when you close the file.",recentItemMenuItem_text_leave:"Leave conversation",recentItemMenuItem_text_remove:"Delete conversation",recentItemMenuItem_text_remove_4b:"Close conversation",recentItemMenuItem_text_markRead:"Mark as read",recentItemMenuItem_text_markAllConversationsRead:"Mark all as read",recentItemMenuItem_text_muteConversation:"Turn notifications off",recentItemMenuItem_text_unmuteConversation:"Turn notifications on",actionsMenuItem_text_addParticipants:"Add participants",actionsMenuItem_text_scheduleCall:"Schedule a call",typingIndicator_label_oneParticipant:"{firstParticipantName} is typing...",typingIndicator_label_twoParticipants:"{firstParticipantName} and {secondParticipantName} are typing...",typingIndicator_label_multipleParticipants:"{firstParticipantName}, {secondParticipantName} and {count} other are typing...",typingIndicator_label_multipleParticipants_few:"{firstParticipantName}, {secondParticipantName} and {count} others are typing...",typingIndicator_label_multipleParticipants_many:"{firstParticipantName}, {secondParticipantName} and {count} others are typing...",button_text_emoticons:"Emoticons",button_title_emoticons:"Emoticons",button_text_videoCall:"Video Call",button_text_audioCall:"Audio Call",button_text_joinCall:"Join Call",button_text_joinCallWithVideo:"Join Call with video",button_text_addParticipants:"Add",button_text_cancelAddParticipants:"Cancel",button_text_createConversation:"Create",button_text_filePicker:"Share a photo",button_text_chatInputActionPicker:"Send Files and Media",button_text_poll:"Send a poll",button_text_moreActions:"More actions",button_text_closeSettings:"Close",callScreen_text_terminationPrompt:"You're currently in a call, are you sure you want to hang up and close Skype?",callscreen_text_terminationMessage:"Call ended",callscreen_text_autoCallConnectingMessage:"Waiting for others to join...",callscreen_text_autoCallTimeoutMessage:"Looks like you're the only one here, try joining the call again later",callscreen_text_autoCallFailedMessage:"Unable to set up call, please try again later",callscreen_text_statusMessageConnecting:"Connecting...",callscreen_text_statusMessageScreenReaderConnecting:"Connecting to {contactName}",callscreen_text_statusMessageScreenReaderEnding_less_than_minute:"Call has ended, duration less than a minute",callscreen_text_statusMessageScreenReaderEnding_minutes:"Call has ended, duration {count} minute",callscreen_text_statusMessageScreenReaderEnding_minutes_few:"Call has ended, duration {count} minutes",callscreen_text_statusMessageScreenReaderEnding_minutes_many:"Call has ended, duration {count} minutes",callscreen_text_participant_joined_notification:"{name} joined",callscreen_text_participant_left_notification:"{name} left",callscreen_text_participant_screen_shared_notification:"{name} has started sharing their screen",callscreen_text_participant_screen_unshared_notification:"{name} has stopped sharing their screen",callscreen_text_statusMessageCalling:"Calling...",callscreen_text_enterFullscreen:"Enter fullscreen mode",callscreen_text_exitFullscreen:"Exit fullscreen mode",callscreen_text_enterGvcGrid:"Grid mode",callscreen_text_videoOn:"Turn video on",callscreen_text_videoOff:"Turn video off",callscreen_text_plusButton:"Add participants, share screens and more",callscreen_text_shareScreens:"Share screens...",callscreen_text_shareScreen:"Share screen",callscreen_text_stopSharingScreen:"Stop sharing",callscreen_text_addParticipants:"Add people to this call",callscreen_text_microphoneOn:"Turn microphone on",callscreen_text_microphoneOff:"Turn microphone off",callscreen_text_endCall:"End call",callscreen_text_participants:"{count} in the call",callscreen_text_showChat:"Show IM",callscreen_text_showContacts:"Show contacts",callscreen_text_hangUp:"Hang up",callscreen_text_addParticipantsToCall:"Add people to this call",callScreen_text_andMore:"and more",callscreen_text_dialpadOn:"Turn dialpad on",callscreen_text_dialpadOff:"Turn dialpad off",callscreen_title_zoom:"Double-click to zoom",callscreen_text_showAVSettings:"Audio and video settings",callscreen_text_transferCall:"Transfer call",callscreen_text_showSidebar:"Show sidebar",callscreen_text_hideSidebar:"Hide sidebar",callscreen_participantMenu_pin:"Pin",callscreen_participantMenu_unpin:"Unpin",callscreen_participantMenu_zoomIn:"Zoom In",callscreen_participantMenu_zoomOut:"Zoom Out",callscreen_participantMenu_chat:"Chat",toast_incoming_text_title:"Incoming call",toast_incoming_text_acceptWithVideo:"Accept with video",toast_incoming_text_acceptWithAudio:"Accept with audio",toast_incoming_text_reject:"Reject call",toast_install_text_title:"is trying to call you",toast_install_text_installButton:"Install plugin",toast_install_text_message:"You'll need a plugin to make Skype calls",pluginInstall_main_close_screen_title:"Are you sure you want to leave?",pluginInstall_main_close_screen_subtitle:"You're almost done setting up Skype calling.",pluginInstall_main_close_screen_finish_text:"Finish setup",pluginInstall_main_close_screen_leave_text:"Leave",pluginInstall_extension_main_text_title:"Enable Skype calls in a few simple steps...",pluginInstall_extension_main_text_subtitle:"Start by adding Skype Calling extension to Chrome",pluginInstall_extension_main_text_add_extension:"Add extension",pluginInstall_extension_main_installed_text_title:"Great!",pluginInstall_extension_main_installed_text_subtitle:"Now install Skype for Web plugin and you're all set",pluginInstall_extension_main_installed_get_plugin_text:"Get plugin",pluginInstall_extension_main_install_failed_text_title:"Oops, something went wrong",pluginInstall_extension_main_install_failed_text_subtitle:"Let's try again...",pluginInstall_extension_main_install_failed_go_to_chrome_webstore_text:"Go to the Chrome web store",pluginInstall_main_text_close:"Close",pluginInstall_main_text_title:"Want to make a call?",pluginInstall_main_text_subtitle:"You need to install the plugin to make Skype calls",pluginInstall_main_text_install:"Install plugin",pluginInstall_steps_text_restart:"Restart",pluginInstall_steps_text_title:"Let's install the plugin.",pluginInstall_steps_text_subtitle:"Simply follow these three steps to set up Skype calls",pluginInstall_steps_text_termsAndPrivacy:"By installing the Skype Plugin, you agree that you have read and accepted Skype's {terms_link} and {privacy_link}.",pluginInstall_steps_text_termsLink:"Terms of Use",pluginInstall_steps_text_privacyLink:"Skype's privacy policy",pluginInstall_mac_chrome_text_download:"Click on the plugin file.",pluginInstall_mac_chrome_text_install:"Follow the instructions.",pluginInstall_mac_chrome_text_enjoy:"Enjoy free Skype calls.",pluginInstall_mac_chrome_text_enjoy_4b:"Make Skype calls.",pluginInstall_mac_safari_text_download:"Go to downloads, then double-click on the plugin file.",pluginInstall_mac_safari_text_install:"Follow the instructions to install the plugin.",pluginInstall_mac_safari_text_enjoy:"Enjoy making free Skype calls from the web.",pluginInstall_mac_safari_text_enjoy_4b:"Make Skype calls.",pluginInstall_mac_firefox_text_download:"Open the plugin file.",pluginInstall_mac_firefox_text_install:"Follow the instructions.",pluginInstall_mac_firefox_text_enjoy:"Enjoy free Skype calls.",pluginInstall_mac_firefox_text_enjoy_4b:"Make Skype calls.",pluginInstall_mac_unknown_download:"Go to downloads, then double-click on the plugin file.",pluginInstall_mac_unknown_install:"Follow the instructions to install the plugin.",pluginInstall_mac_unknown_enjoy:"Enjoy making free Skype calls from the web.",pluginInstall_windows_chrome_text_download:"Click on the plugin file.",pluginInstall_windows_chrome_text_install:"Wait for the plugin to install.",pluginInstall_windows_chrome_text_enjoy:"Enjoy free Skype calls.",pluginInstall_windows_chrome_text_enjoy_4b:"Make Skype calls.",pluginInstall_windows_msie_text_download:'Click on "Run" to get started.',pluginInstall_windows_msie_text_install:"Wait for the plugin to install.",pluginInstall_windows_msie_text_enjoy:"Enjoy free Skype calls.",pluginInstall_windows_msie_text_enjoy_4b:"Make Skype calls.",pluginInstall_windows_firefox_text_download:'Click "Save File" to get started.',pluginInstall_windows_firefox_text_install:"Click on the plugin file.",pluginInstall_windows_firefox_text_enjoy:"Enjoy free Skype calls.",pluginInstall_windows_firefox_text_enjoy_4b:"Make Skype calls.",pluginInstall_windows_unknown_text_download:'Click on "Run" to get started.',pluginInstall_windows_unknown_text_install:"Wait for the plugin to install.",pluginInstall_windows_unknown_text_enjoy:"Enjoy free Skype calls.",pluginInstall_windows_unknown_text_enjoy_4b:"Make Skype calls.",pluginInstall_unblock_text_title:"Enable Skype Plugin",pluginInstall_unblock_text_chrome_subtitle:'Please click on the plugin icon in the address bar and select "Always allow plug-ins on web.skype.com" to continue with this call.',pluginInstall_unblock_text_firefox_subtitle:'Please click on the plugin icon in the address bar and select "Allow and Remember" to continue with this call.',pluginInstall_callback_text_title:"Call {displayName}",pluginInstall_callback_text_subtitle:"Your plugin is now installed, so you're good to start calling now",pluginInstall_callback_text_call:"Call",pluginInstall_callback_text_accept:"Accept call",pluginInstall_callback_text_notNow:"Not now",pluginInstall_label_text_start:"Plugin Install - Start",pluginInstall_label_text_download:"Plugin Install - Download",pluginInstall_label_text_unblock:"Plugin Install - Unblock Skype Plugin",pluginInstall_label_text_continue:"Plugin Install - Continue Call",pluginInstall_label_text_autoUpdateDisclaimer:"This plugin will automatically update to give you the best experience. If you don't want the updates, please do not install the plugin.",pluginInstall_firefox_unable_to_call_text_title:"Skype calls are temporarily unavailable in Firefox",pluginInstall_firefox_unable_to_call_text_subtitle:"Your current version of Firefox doesn't support making or receiving calls on Skype for Web. In the meantime, please use a different browser such as Microsoft Edge or Google Chrome.",notification_text_osNotSupported:"Missed call from {callerName}. Audio and video calls are not supported on this operating system.",notification_text_browserNotSupported:"Missed call from {callerName}. You are currently using an unsupported browser.",notification_text_learnMore:"Learn more",notification_text_hardware_camera:"Camera not found",notification_text_hardware_mic:"Microphone not found",notification_text_hardware_speaker:"Speaker not found",notification_text_group_conversation_from:"Group conversation from",notification_text_avatar_not_supported_image_type:"The image type you tried to upload is not supported",notification_text_avatar_too_large:"The image you selected is too big, please use an image with a smaller file size.",notification_text_avatar_upload_error:"Unable to change your profile picture, please try again.",enable_browser_notifications_toast:"Turn on desktop notifications to be notified of new messages.",enable_browser_notifications_link_text:"Turn on desktop notifications",allow_browser_notifications_header:"Never miss a message",allow_browser_notifications_text:'Click "Allow" to be notified of new messages.',media_clicktoplay:"Click to play",media_picturesharing_one:"shared a photo",media_picturesharing_group:"{senderName} shared a photo",media_picturesharing_label:"Open photo in a new window",media_voice_message:"Voice Message",media_audiosharing_one:"shared an audio message",media_audiosharing_group:"{senderName} shared an audio message",media_videosharing_one:"shared a video",media_videosharing_group:"{senderName} shared a video",media_videomessage_expired:"Video message has expired",media_audiomessage_expired:"Audio message has expired",mediaPlayer_play:"Play",mediaPlayer_pause:"Pause",videoPlayer_fullscreen:"Fullscreen",videoPlayer_exitFullscreen:"Exit fullscreen",action_button_confirm:"Confirm",action_button_cancel:"Cancel",action_button_save:"Save",action_button_block:"Block",action_button_delete:"Delete",action_button_delete_4b:"Close",action_button_send:"Send",action_button_share_conversation:"Share conversation",action_button_leave:"Leave",media_mojisharing_one:"shared a Moji",media_mojisharing_group:"{senderName} shared a Moji",emoticonPicker_heading_label:"Choose an emoticon",accessibility_recentItem_conversation_muted:"Conversation muted.",accessibility_recentItem_oneToOne:"Conversation with {topic}. {muted} Press Shift + F ten for more options.",accessibility_recentItem_oneToOne_many:"Conversation with {topic}. {muted} Press Shift + F ten for more options.",accessibility_recentItem_oneToOne_unread:"Conversation with {topic}, {count} unread message. {muted} Press Shift + F ten for more options.",accessibility_recentItem_oneToOne_unread_many:"Conversation with {topic}, {count} unread messages. {muted} Press Shift + F ten for more options.",accessibility_recentItem_group_unread:"Group conversation with {count} unread message {topic}. {muted} Press Shift + F ten for more options.",accessibility_recentItem_group_unread_many:"Group conversation with {count} unread messages {topic}. {muted} Press Shift + F ten for more options.",accessibility_recentItem_group:"Group conversation {topic}. {muted} Press Shift + F ten for more options.",accessibility_recentItem_group_many:"Group conversation {topic}. {muted} Press Shift + F ten for more options.",accessibility_recentItem_recent_group:"Recent conversations",accessibility_chatLog_newMessage:"New message from {author}, {content}",accessibility_chatLog_newMessage_withoutAuthor:"New message, {content}",accessibility_searching:"Searching",accessibility_searchItem_oneToOne:"{contactName}, {id}, {status}, {index} of {totalResults} in People.",accessibility_searchItem_group:"Group {groupName}, {index} of {totalResults} in Groups.",accessibility_searchItem_group_displayMessage:"Group {groupName}, {displayMessage}, {index} of {totalResults} in Groups.",accessibility_searchItem_directoryList:"{contactName}, {id}, {status}, {index} of {totalResults} in the Skype Directory.",accessibility_localSearchUpdated:"Search updated and {totalSearchResults} result found in your contacts and groups. {peopleSearchResults} in people and {groupsSearchResults} in Groups.",accessibility_localSearchUpdated_few:"Search updated and {totalSearchResults} results found in your contacts and groups. {peopleSearchResults} in people and {groupsSearchResults} in Groups.",accessibility_localSearchUpdated_many:"Search updated and {totalSearchResults} results found in your contacts and groups. {peopleSearchResults} in people and {groupsSearchResults} in Groups.",accessibility_localSearchUpdated_4b:"Search updated and {totalSearchResults} result found in your contacts.",accessibility_localSearchUpdated_4b_few:"Search updated and {totalSearchResults} results found in your contacts.",accessibility_localSearchUpdated_4b_many:"Search updated and {totalSearchResults} results found in your contacts.",accessibility_localSearchNoResults:"Search updated and no results found in your contacts and groups.",accessibility_localSearchNoResults_4b:"Search updated and no results found in your contacts.",accessibility_searchSkypeDirectory:"Press enter to search the Skype Directory.",accessibility_clearSearchField_ariaLabel:"Clear search input field.",accessibility_skypeDirectorySearchUpdated:"Search updated and {totalSearchResults} result found in the Skype Directory.",accessibility_skypeDirectorySearchUpdated_few:"Search updated and {totalSearchResults} results found in the Skype Directory.",accessibility_skypeDirectorySearchUpdated_many:"Search updated and {totalSearchResults} results found in the Skype Directory.",accessibility_totalSearchUpdated:"Search updated and {totalSearchResults} result found. {peopleSearchResults} in people, {groupsSearchResults} in groups and {SkypeDirectorySearchResults} in the Skype Directory.",accessibility_totalSearchUpdated_few:"Search updated and {totalSearchResults} results found. {peopleSearchResults} in people, {groupsSearchResults} in groups and {SkypeDirectorySearchResults} in the Skype Directory.",accessibility_totalSearchUpdated_many:"Search updated and {totalSearchResults} results found. {peopleSearchResults} in people, {groupsSearchResults} in groups and {SkypeDirectorySearchResults} in the Skype Directory.",accessibility_totalSearchNoResults:"Search updated and no results found in your contacts, groups and the Skype Directory.",accessibility_contactProfile_headingWithClosedProfile:"Open {topic}'s profile.",accessibility_contactProfile_openedProfile:"Opened {topic}'s profile.",accessibility_contactProfile_closedProfile:"Closed {topic}'s profile.",accessibility_contactProfile_headingWithOpenedProfile:"Close {topic}'s profile.",accessibility_groupProfile_headingWithClosedProfile:"Open group profile.",accessibility_groupProfile_headingWithOpenedProfile:"Close group profile.",accessibility_groupProfile_attendeeMenu:"{participantName}. More options.",accessibility_groupProfile_adminMenu:"{participantName}, admin. More options.",accessibility_groupProfile_guestMenu:"{participantName}, guest. More options.",accessibility_groupProfile_historyToggle_on:"Make chat history available to new joiner. On.",accessibility_groupProfile_historyToggle_off:"Make chat history available to new joiner. Off.",accessibility_groupProfile_joiningToggle_on:"Allow people to join this group via link. On.",accessibility_groupProfile_joiningToggle_off:"Allow people to join this group via link. Off.",accessibility_me_expandProfile:"Expand profile",accessibility_me_collapseProfile:"Collapse profile",accessibility_me_availabilityOnAriaLabel:"Online status set to online (notifications on)",accessibility_me_availabilityOffAriaLabel:"Online status set to invisible (notifications off)",accessibility_contactPickerUpdated:"Search updated and {totalSearchResults} result found in your contacts.",accessibility_contactPickerUpdated_few:"Search updated and {totalSearchResults} results found in your contacts.",accessibility_contactPickerUpdated_many:"Search updated and {totalSearchResults} results found in your contacts.",accessibility_contactPickerNoResults:"Search updated and no results found in your contacts.",accessibility_contactPickerResultRemoved:"Removed {displayName} from new conversation participant list",accessibility_contact_blocked_success:"Contact blocked",accessibility_contact_blocked_failure:"Blocking contact failed",accessibility_contact_unblocked_success:"Contact unblocked",accessibility_contact_unblocked_failure:"Unblocking contact failed",accessibility_contact_request_sent_success:"Contact request sent",accessibility_contact_request_sent_failure:"Sending contact request failed",accessibility_contact_request_accepted_success:"Contact request accepted",accessibility_contact_request_accepted_failure:"Accepting contact request failed",accessibility_contact_request_declined_success:"Contact request declined",accessibility_contact_request_declined_failure:"Declining contact request failed",accessibility_contact_sent:"Contact sent",accessibility_contact_deleted_success:"Contact deleted",accessibility_contact_deleted_failure:"Deleting contact failed",accessibility_contact_add_favorite_success:"Added contact to favorites",accessibility_contact_add_favorite_failure:"Adding contact to favorites failed",accessibility_contact_remove_favorite_success:"Removed contact from favorites",accessibility_contact_remove_favorite_failure:"Removing contact from favorites failed",accessibility_selectBox_expanded:"Combo box expanded",accessibility_selectBox_collapsed:"Combo box collapsed",accessibility_addPeopleToConversation_ariaLabel:"Add people to this conversation",addPeopleToConversation_tooltip:"Add people",accessibility_startVideoCall_ariaLabel:"Video call",startVideoCall_tooltip:"Video call",accessibility_startCall_ariaLabel:"Call",videoCallDisabled_tooltip:"You can't make video calls to {agentName}",startCall_tooltip:"Call",accessibility_startGroupCall_ariaLabel:"Call group",callDisabled_tooltip:"You can't make calls to {agentName}",startGroupCall_tooltip:"Call group",turnOffChatNotifications_tooltip:"Turn off chat notifications",turnOnChatNotifications_tooltip:"Turn on chat notifications",giveFeedback_tooltip:"Give feedback",giveFeedback_subject:"Feedback for Skype on the web",giveFeedback_body:"If you're experiencing a problem or have feedback to share with the Skype team, please let us know below.",giveFeedback_button_label:"Feedback",conversationHeader_heading_ariaLabel:"Conversation with {topic}.",groupProfile_spacesLink_ariaLabel:"Link to this group chat: {spacesUrl}",conversation_header_topic_default:"Untitled",conversation_header_topic_untitled_conversation:"Untitled conversation",conversation_header_topic_people_chatting:"{count} person is available",conversation_header_topic_people_chatting_few:"{count} people are available",conversation_header_topic_people_chatting_many:"{count} people are available",message_text_presenceActive:"Active",message_text_presenceMobile:"On mobile",message_text_presenceAway:"Away",message_text_presenceBusy:"Busy",message_text_presenceDoNotDisturb:"Do not disturb",message_text_presenceUnknown:"Status unknown",message_text_activity_inAMeeting:"In a meeting",message_text_activity_urgentInterruptionsOnly:"Urgent interruptions only",message_text_activity_onThePhone:"On the phone",message_text_activity_inAConference:"In a conference",message_text_activity_offWork:"Off work",message_text_activity_outOfOffice:"Out of office",message_text_activity_presenting:"Presenting",expressionPicker_prevPage:"Previous tabs",expressionPicker_nextPage:"Next tabs",expressionPicker_selected_item_title:"{itemTitle} selected.",expressionPicker_mruTab_title:"Most Recently Used",expressionPicker_mruTab_ariaLabel:"Most Recently Used",expressionPicker_mruTab_emptyText:"Recently used items will appear here.",expressionPicker_tab_emptyText:"This tab is empty",expressionPicker_bingTab_title:"Bing",expressionPicker_bingTab_ariaLabel:"Search with Bing for images",expressionPicker_bingTab_emptyText:"Bing results appear here",expressionPicker_bingTab_loadingText:"Loading...",expressionPicker_bingTab_errorText:"An error has occurred! Please try again later",expressionPicker_bingPack_title:"Bing search results",expressionPicker_bingPack_ariaLabel:"Bing search results",expressionPicker_bingGifsPack_title:"Popular Gifs from Bing",expressionPicker_bingMemePack_title:"Popular Memes from Bing",expressionPicker_bingGifsPack_ariaLabel:"Popular Gifs from Bing",expressionPicker_bingMemePack_ariaLabel:"Popular Memes from Bing",expressionPicker_giphyImgTab_title:"Search Giphy",expressionPicker_giphyImgTab_ariaLabel:"Search for animated GIFs. Powered by Giphy",expressionPicker_giphyImgTab_emptyText:"Giphy results appear here",expressionPicker_giphyImgTab_loadingText:"Loading...",expressionPicker_giphyImgTab_errorText:"An error has occurred! Please try again later",expressionPicker_giphyImgTab_terms:"Terms of use",expressionPicker_giphyImgPack_title:"Giphy search results",expressionPicker_giphyImgPack_ariaLabel:"Giphy search results",input_placeholder_searchPESItems:"Search for items...",input_searchPESItems_ariaLabel:"Search items. Type keyword",expressionPicker_localSearchTab_title:"Search",expressionPicker_localSearchTab_emptyText:"Find emoticons and Mojis",expressionPicker_localSearchPack_title:"Quick suggestions",expressionPicker_localSearchPack_ariaLabel:"Quick suggestions",expressionPicker_mruEmoticonPack_title:"Emoticons",expressionPicker_mruEmoticonPack_ariaLabel:"Emoticons",expressionPicker_mruMojiPack_title:"Mojis",expressionPicker_mruMojiPack_ariaLabel:"Mojis",expressionPicker_store_title:"Skype Expression Store",expressionPicker_store_free:"Free",expressionPicker_storeTab_title:"Store",expressionPicker_store_Downloaded:"Downloaded",expressionPicker_store_Downloading:"Downloading...",expressionPicker_store_removeTab:"Remove",input_placeholder_searchPESStore:"Search",accessibility_open_picker:"Menu expanded",accessibility_close_picker:"Menu collapsed",pes_moji_error_text:"The Moji failed to load! Please try again later",poll_designer_question_placeholder:"Ask a question...",poll_designer_answer_placeholder:"Add option...",poll_message_question_header:"Poll: {pollQuestion}",poll_message_goto_text:"Go to {fallbackLink} to vote.",poll_message_people_voted:"{count} people voted",poll_sticky_message_new_poll:"Ongoing poll by {author}: ",poll_sticky_message_me_voted:"My vote: {answerText}",poll_sticky_message_me_not_voted:"Click to vote",poll_fallback_link_text:"Skype for Web",poll_list_title:"Voted by ({count})",presence_lastseen_moments:"Last seen moments ago",presence_lastseen_minutes:"Last seen {number}m ago",presence_lastseen_hours:"Last seen {number}h ago",presence_lastseen_days:"Last seen {number}d ago",presence_lastseen_date_short:"Last seen {shortdate}",presence_lastseen_date_full:"Last seen {fulldate}",guest_user_displayname:"{displayName} (Guest)",pes_featured_title:"Featured",pes_moji_playbutton_label:"Click to play",label_jumpToConversation:"Jump to conversation",share_on_skype_dialog_title:"Share on Skype",share_on_skype_share_button:"Share",share_on_skype_alt_text_button:"Share on Skype",share_on_skype_message_prompt:"Include a message about this...",share_on_skype_picker_prompt:"Search or select...",share_on_skype_status_sending:"Sending...",share_on_skype_status_sent:"Sent",share_on_skype_signed_in_as:"Signed in as {displayName}",share_on_skype_my_account:"My Account",share_on_skype_sign_out:"Sign out",file_transfer_file_shared:"shared a file",file_transfer_share_file:"Share a File",file_transfer_send_photos_and_files:"Send Photos and Files",file_transfer_download_button_title:"Download file {filename}",file_transfer_download_dialog_confirm_button_title:"Accept",file_transfer_download_unsafe_file_dialog_title:"Warning - this file may be unsafe for your computer/device.",file_transfer_download_unsafe_file_dialog_text:"Do you want to accept the file {filename} from {author}?",file_transfer_download_safe_file_dialog_title:"Only accept files from people you trust.",file_transfer_download_safe_file_dialog_text:"Do you want to accept the file {filename} from {author}?",file_transfer_download_dialog_do_not_ask_checkbox:"Do not ask me again",file_transfer_upload_state:"{uploaded} of {size}",file_transfer_upload_completed:"File {filename} has been uploaded",file_transfer_upload_failed:"Cannot upload file",file_transfer_upload_canceled:"Upload canceled",file_transfer_upload_cancel:"Cancel uploading",file_transfer_upload_too_large_warning:"Not sent - File is larger than 100MB. <a href='http://go.skype.com/Cloud.File.Upload' target='_blank'>Learn more</a>",file_transfer_upload_starting:"Starting upload",file_transfer_upload_not_supported:"Sharing files is not supported on Skype for Web",notificationsPage_text_menuLink:"Notifications",remove_conversation_confirmation_text:"All the messages in this conversation will be deleted and it will be removed from both the sidebar and your history.",remove_conversation_confirmation_text_4b:"You will be leaving this conversation and it will be removed from the sidebar.",remove_conversation_confirmation_title:"Are you sure you want to delete this conversation?",remove_conversation_confirmation_title_4b:"Are you sure you want to close this conversation?",accessibility_remove_conversation_confirmation:"Conversation deleted",leave_conversation_confirmation_text:"This action cannot be undone.",leave_conversation_confirmation_text_4b:"You won't receive any more notifications from this conversation. You can later rejoin by sending a new message.",leave_conversation_confirmation_title:'Are you sure you want to leave "{topic}"?',leave_conversation_confirmation_title_4b:"Are you sure you want to leave the conversation?",contact_information_already_contact:"Already a contact",contact_information_add_to_contacts:"Add to contacts",mediaBar_sendContacts_label:"Send contacts...",contactPicker_sendContacts_title:"Send contacts",contactPicker_sendContacts_OKBUtton:"Send",chat_contactSent_label:"Contact sent",chat_contactSent_iconLabel:"Sent",mention_notification_title:"{participant} mentioned you in {chat}",contextMenu_picture_viewAction:"View",contextMenu_picture_commentAction:"Comment",contextMenu_picture_downloadAction:"Download",contextMenu_text_discussAction:"Discuss",send_contacts_action_title:"Send Contacts",send_contacts_action_text:"Add contacts you would like to send",invite_free_overlay_greeting:"Say hello to",invite_free_bubble_contact:"Type a message here",invite_free_bubble_non_contact:"Type a message here, then wait for a reply.",invite_free_textarea_waiting_for_reply:"Waiting for a reply...",invite_free_message_received:"<strong>{displayName}</strong> sent you a message",invite_free_message_received_location:"<strong>{displayName}</strong> sent you a message from {location}",invite_free_block_person:"Block this person",invite_free_respond_request:"Type any message to accept this contact",me_pluginLinkText:"Download Skype plugin",me_accountLinkText:"Manage account",me_accountSignOutLinkText:"Sign out",me_pendingPresence:"Getting status...",me_help:"Help",me_skypeCommunity:"Skype Community",me_sendFeedback:"Send feedback",me_mood:"Mood",me_status:"Status",me_accountInfo:"Account info",me_notifications:"Notifications",me_mobileNumber:"Mobile number",me_avatar_uploadProfilePictureText:"Upload a profile picture",group_avatar_uploadProfilePictureText:"Upload a group chat picture",me_avatar_uploadProfilePictureAriaLabel:"Upload avatar",me_edit_activity_message:"Edit activity message",me_activity_message_title:"Current activity",me_input_text_activity_message_placeholder:"Change activity message",me_edit_activity_message_confirm:"Save changes",me_edit_activity_message_cancel:"Cancel changes",accessibility_me_changePresenceStatusAriaLabel:"Change your online status (currently {currentStatus})",message_sent_status:"Sent",message_sending_status:"Sending",message_delivered_status:"Delivered",message_read_status:"Read",message_failed_status:"Failed",message_edited_success:"Message edited",message_removed_success:"Message removed",credit_balance_text:"Your Skype Credit",credit_purchase_link_text:"Add Skype Credit",subscription_entitlement_text:"Subscriptions",subscription_purchase_link_text:"Get a subscription",no_subscriptions_text:"You have no subscriptions",subscriptions_text_one:"You have {count} subscription",subscriptions_text_many:"You have {count} subscriptions",pstn_emergency_notice_text:"Skype for Web (Beta) is not a replacement for your telephone and can't be used for emergency calling.",pstn_insufficient_funds:"Call failed - you need {credit} or {subscription} to call landlines and mobiles from Skype.",pstn_insufficient_funds_credit:"Skype Credit",pstn_insufficient_funds_subscription:"a subscription",pstn_invalid_number:"The number you have dialed is invalid.",pstn_invalid_number_return_link:"Return to Call phones and try again.",pstn_forbidden_number:"The number you have dialed cannot be reached using Skype.",pstn_insufficient_funds_group:"A participant {phoneNumber} was unable to join the call - you need {credit} or {subscription} to add them to the call.",pstn_insufficient_funds_group_name:"A participant {displayName} ({phoneNumber}) was unable to join the call - you need {credit} or {subscription} to add them to the call.",pstn_invalid_number_group:"A participant {phoneNumber} was unable to join the call - the number is invalid.",pstn_invalid_number_group_name:"A participant {displayName} ({phoneNumber}) was unable to join the call - the number is invalid.",pstn_forbidden_number_group:"A participant {phoneNumber} was unable to join the call - the number cannot be reached using Skype.",pstn_forbidden_number_group_name:"A participant {displayName} ({phoneNumber}) was unable to join the call - the number cannot be reached using Skype.",hearts_bubble_title:"Who liked this",hearts_bubble_meliked:"You",hearts_loved_by:"{list}",hearts_loved_by_count:"Loved by {count}",hearts_loved_by_others:"Loved by {list} and <span>{count}&nbsp;others</span>",hearts_list_title:"Liked by ({count})",hearts_me_text:"You",hearts_like_byMeOnly:"You like this",hearts_like_byOne:"{participantName} likes this",hearts_like_byFew:"{participantFirst}{list} and {participantLast} like this",hearts_like_byMany:"{participantlist} and <span>{count}&nbsp;others</span> like this",hearts_notification_messageGroup:"{participantName} likes your message {messageText}",hearts_notification_messageConv:"likes your message {messageText}",hearts_notification_photoGroup:"{participantName} likes your photo",hearts_notification_photoConv:"likes your photo",hearts_notification_fileGroup:"{participantName} likes your file",hearts_notification_fileConv:"likes your file",hearts_notification_documentGroup:"{participantName} likes your document",hearts_notification_documentConv:"likes your document",hearts_notification_videoMessageGroup:"{participantName} likes your video message",hearts_notification_videoMessageConv:"likes your video message",hearts_notification_urlGroup:"{participantName} likes your url",hearts_notification_urlConv:"likes your url",hearts_notification_youTubeGroup:"{participantName} likes your YouTube video",hearts_notification_youTubeConv:"likes your YouTube video",hearts_accessibility_like:"Like message",hearts_accessibility_unlike:"Unlike message",hearts_toast_message:"new",hearts_toast_title:"click to navigate to the liked message",me_notificationsOn:"Notifications on",me_notificationsOff:"Notifications off",education_bubble_search:"Find people to call or chat with - search by email or Skype Name.",education_bubble_search_4b:"Click this button to find people to chat with.",education_bubble_search_title_4b:"Find a contact",education_bubble_call:"Select the camera button to start a video call.",education_bubble_chat:"Choose a contact to start a chat or call.",education_bubble_chat_4b:"Click on a contact to send them a message.",education_bubble_chat_title_4b:"Send an IM",education_bubble_gotit_button_4b:"Got it",education_bubble_schedule_call_1:"Schedule your next call with {name} here.",education_bubble_schedule_call_1_group:"Stay in touch, schedule your next call here.",schedule_call_new_conversation_topic:"Skype call",schedule_call_subject_text:"Skype call with {topic}",welcomeDialog_header:"Welcome to Skype for Web (Beta)",welcomeDialog_getInTouch:"Get in touch with your friends and family directly from your browser",welcomeDialog_sendIM:"Send instant messages",welcomeDialog_makeCalls:"Make Skype calls",welcomeDialog_makeVideoCalls:"Make video calls",welcomeDialog_getStarted_button:"Get started",welcomeDialog_notForEmergencyCalls:"Skype for Web (Beta) is not a replacement for your telephone and can't be used for emergency calling.",welcomeDialog_cookiesConsent:"By using this site you agree to the use of cookies for analytics, personalised content and ads.",welcomeDialog_readMore:"Read more about cookies",modal_scheduleCall_getting_ready_label:"Getting your call ready...",modal_scheduleCall_ready_label:"Your call is ready to be scheduled.",modal_scheduleCall_create_event_button:"Create event",modal_scheduleCall_close_button:"Close",cqf_title:"How would you rate the quality of this call?",cqf_audio_title:"Tell us about any audio issues you experienced. We'll use the feedback to improve Skype.",cqf_video_title:"Tell us about any audio or video issues you experienced. We'll use the feedback to improve Skype.",cqf_audio_tokens_title:"Audio",cqf_video_tokens_title:"Video",cqf_audio_nolocal:"I could not hear any sound",cqf_audio_noremote:"The other side could not hear any sound",cqf_audio_quality_echo:"I heard echo in the call",cqf_audio_quality_noise:"I heard noise in the call",cqf_audio_quality_volume:"Volume was low",cqf_audio_dropped:"The call ended unexpectedly",cqf_audio_quality_distorted:"Speech was not natural or sounded distorted",cqf_audio_quality_delay:"We kept interrupting each other",cqf_audio_other:"Other, please specify",cqf_audio_quality_dialpad:"Dial pad tones did not work",cqf_video_nolocal:"I could not see any video",cqf_video_noremote:"The other side could not see my video",cqf_video_quality_poor:"Image quality was poor",cqf_video_quality_freezing:"Video kept freezing",cqf_video_dropped:"Video stopped unexpectedly",cqf_video_quality_dark:"The other side was too dark",cqf_video_quality_sync:"Video was ahead or behind audio",cqf_video_other:"Other, please specify",cqf_thanks_title:"Thanks for your feedback!",cqf_accessibility_cancel_btn:"Cancel",cqf_accessibility_submit_btn:"Send feedback",cqf_accessibility_oneStar_ariaLabel:"Very bad",cqf_accessibility_twoStars_ariaLabel:"Poor",cqf_accessibility_threeStars_ariaLabel:"Fair",cqf_accessibility_fourStars_ariaLabel:"Good",cqf_accessibility_fiveStars_ariaLabel:"Excellent",unanswered_call_title_busy:"Busy",unanswered_call_accessibility_title_busy:"Callee is busy.",unanswered_call_title_noanswer:"No answer",unanswered_call_accessibility_title_noanswer:"Callee did not answer.",unanswered_call_title_unavailable:"Unavailable",unanswered_call_accessibility_title_unavailable:"Call unavailable.",unanswered_call_button_chat:"Chat message",unanswered_call_accessibility_button_chat:"Chat message",unanswered_call_button_retry:"Retry",unanswered_call_accessibility_button_retry:"Retry",unanswered_call_button_close:"Close",unanswered_call_accessibility_button_close:"Close",unanswered_call_button_showchat:"Show chat",unanswered_call_accessibility_button_showchat:"Show chat",unanswered_call_chatinput_placeholder:"Call me back (call)",unanswered_call_dial_number:"Dial Number",favorites_recents_category_name:"Favorites",favorites_add_to_favorite:"Add to Favorites",favorites_remove_from_favorite:"Remove from Favorites",welcome_im_display_name:"Send IMs in Outlook",welcome_im_toast_message:"Now you can send IMs from Outlook.\r\n\r\n",welcome_im_first_message:"Type a message below, and hit Enter to try it out.\r\n\r\nFor fun, add some :) B-) :D",welcome_im_reply_message:"(clap) Awesome! Now go forth and message.",sms_input_text_message:"Type an SMS here",sms_via_text:"via",sms_message_destination_skype:"Skype",sms_message_destination_sms:"SMS {phone}",sms_add_phone_number:"Add Phone Number...",sms_country_all_recent_codes_group_title:"Recent Countries and Regions",sms_country_all_country_codes_group_title:"All Countries and Regions",sms_add_phone_number_dialog_text:"Add a number for {accountDisplayName}",sms_send_sms_to_section_title:"Send SMS to:",sms_settings_identification_section_title:"When I send an SMS message, identify me by:",sms_settings_identification_section_option1:"My Skype Name ({skypeid}). Recipients can't send SMS replies.",sms_settings_identification_section_option2:"My mobile phone number. Recipients can send SMS replies.",sms_settings_destination_and_rates_link_text:"SMS destinations and rates",sms_settings_learnmore_link_text:"Learn more about SMS",sms_turn_off_sms_sending:"Send via Skype",sms_status_sending:"Sending SMS...",sms_status_delivered:"SMS delivered",sms_status_deliveringError:"SMS delivering failed",sms_insufficient_balance:"You need Skype Credit to send SMS",sms_price_info_failed:"Something went wrong in getting SMS prices.",sms_price_info_bad_number:"Number to send SMS is invalid",sms_price_info_bad_number_account:"Could not get price information for given number",unreadConversationsReminder:"You have {count} unread conversation",unreadConversationsReminder_few:"You have {count} unread conversations",unreadConversationsReminder_many:"You have {count} unread conversations",unreadMessageFromPersonAndOthersReminder:"You have unread messages from {name} and {count} other",unreadMessageFromPersonAndOthersReminder_few:"You have unread messages from {name} and {count} others",unreadMessageFromPersonAndOthersReminder_many:"You have unread messages from {name} and {count} others",unreadMessageFromPersonReminder:"You have unread messages from {name}",unreadMessageInGroupAndOthersReminder:"You have unread messages in {topic} and {count} other",unreadMessageInGroupAndOthersReminder_few:"You have unread messages in {topic} and {count} others",unreadMessageInGroupAndOthersReminder_many:"You have unread messages in {topic} and {count} others",unreadMessageInGroupReminder:"You have unread messages in {topic}",unreadMessageReminder:"{name} sent you a message.",unreadMessageFromTwoChatsReminder:"{name} and {secondName} sent you a message.",unreadMessageFromChatAndOthersReminder:"{name} and {count} others sent you a message.",unreadMessageFromChatAndOthersReminder_few:"{name} and {count} others sent you a message.",unreadMessageFromChatAndOthersReminder_many:"{name} and {count} others sent you a message.",newSummaryOwaToast:"Unread chats: {name}",newChatsSessionOwaToast:"You have {count} new chat.",newChatsSessionOwaToast_few:"You have {count} new chats.",newChatsSessionOwaToast_many:"You have {count} new chats.",owa_deprecation_notification_message:"Skype for Business is upgrading to Microsoft Teams.",owa_deprecation_notification_action:"Try it now",owa_deprecation_header:"Skype for Business is now Microsoft Teams!",owa_deprecation_body:"Everything's updated and ready for you.",owa_deprecation_action:"Start using Teams",owa_default_chat_client_message:"Your IMs are being sent to Teams!",owa_default_calling_client_message:"Your calls are being sent to Teams!",owa_default_chat_and_calling_client_message:"Your IMs and calls are being sent to Teams!",owa_default_client_notification_action:"Go to Teams"}}),define("bindings/ko.businessAwareL10n",["require","vendor/knockout","swx-constants","swx-service-locator-instance"],function(e){function i(){t.bindingHandlers.businessAwareL10n={update:function(e,n,r,i,o){var u=t.utils.unwrapObservable(n());if(s()){var a=u.key;u.key=a+"_4b"}t.bindingHandlers.l10n.update(e,function(){return u},r,i,o)}}}function s(){return r.resolve(n.serviceLocator.FEATURE_FLAGS).isFeatureOn(n.featureFlags.USE_BUSINESS_WORDING)}var t=e("vendor/knockout"),n=e("swx-constants").COMMON,r=e("swx-service-locator-instance").default;return{register:i}}),define("services/i18n/pluralizer",["require","swx-i18n","bindings/ko.businessAwareL10n","swx-i18n","vendor/knockout"],function(e){function s(){var e=this;e.init=function(e){var s,o=e.replace("-","_").toLowerCase(),u=r.pluralizationLocale[o];if(u)o=u;else{s=o.split("_");if(s.length===1)throw new Error("Unsupported language:"+e);o=s[0]}r.setLocale(o),t.init(i),n.register()}}var t=e("swx-i18n").knockoutBindingExtensions,n=e("bindings/ko.businessAwareL10n"),r=e("swx-i18n").plurals,i=e("vendor/knockout");return new s}),define("services/i18n/loader",["require","swx-utils-common","experience/settings","swx-i18n","services/i18n/pluralizer","services/i18n/cultureInfo","swx-constants","services/i18n/swx/default"],function(e){function a(){function h(e){n.locale=n.locale||{},n.locale.i18n=e}var e=this,a="/",f="Strings.js",l="strings.js",c="en-us";e.load=function(e,p,d){function m(e){return new Promise(function(n,r){t.loadScript(e,n,r)})}function g(){return r.set(u),n.applicationLanguage=c,o.i18n.EMBEDDED_LOCALE}function y(){var t=s.getLocale(d),r=e+a+p+a+t+a+f;return n.applicationLanguage=t,m(r).then(function(){return d})}function b(){var t=e+a+p+a+d+a+l;return m(t).then(function(){return d})}var v=e+a+p+a+d+a+f;return Skype.WebExperience=Skype.WebExperience||{},Skype.WebExperience.setTranslations=function(e){r.merge(e)},i.init(d),m(v).then(function(){return n.applicationLanguage=d,d}).catch(b).catch(y).catch(g).then(h.bind(null))}}var t=e("swx-utils-common").loader,n=e("experience/settings"),r=e("swx-i18n").resources,i=e("services/i18n/pluralizer"),s=e("services/i18n/cultureInfo"),o=e("swx-constants").COMMON,u=e("services/i18n/swx/default");return new a}),define("services/i18n/init",["require","swx-i18n","services/i18n/swx/default","services/i18n/pluralizer","swx-constants","services/i18n/loader"],function(e){function a(){var e=this;e.init=function(e,t){var n,r=e.initParams.locale,i=e.initParams.variant;return t.lang||(t.lang=r),r===o&&i===u?(e.locale=e.locale||{},e.locale.i18n=r,Promise.resolve()):(n=e.appBaseUrl+"/resources/i18n",s.load(n,i,r))},t.set(n),r.init(o)}var t=e("swx-i18n").resources,n=e("services/i18n/swx/default"),r=e("services/i18n/pluralizer"),i=e("swx-constants").COMMON,s=e("services/i18n/loader"),o=i.i18n.EMBEDDED_LOCALE,u="swx";return new a}),define("experience/featureFlags/api",[],function(){function e(e){var t=e.featureFlags?e.featureFlags:{};this.isFeatureOn=function(n){return Boolean(t[n])}}return e}),define("services/controls/controlsBuilder",["require","vendor/knockout","experience/settings","browser/dom","swx-service-locator-instance","swx-constants","utils/common/accessibility","utils/common/applicationFocusManager","swx-g11n"],function(e){function c(){function p(){t.virtualElements.allowedBindings.control=!0,t.bindingHandlers.control={init:function(e,n){var r=n(),i;r=t.unwrap(r),i=c[r.name],i.render(r.model,function(n){var r=e.parentNode,s=e.nextSibling;r.insertBefore(n,e),r.removeChild(e),r.removeChild(s),i.onDispose&&t.utils.domNodeDisposal.addDisposeCallback(n,i.onDispose.bind(i))})}}}function d(e){if(!b(e))throw'Invalid control. Make sure "name" and "render" attributes are present.';if(c[e.name])throw"The control you are trying to register (name: "+e.name+") has already been registered";c[e.name]=e}function v(e,t,n){c[e].render(n,function(e){g(t),m(e,t);var n=e.querySelectorAll("["+f+"]");for(var r=n.length-1;r>=0;r--){var i=n[r],s=i.getAttribute(f),o=w(i)||{};v(s,i,o)}})}function m(e,t){t.appendChild(e)}function g(e){var n;if(!e||!e.childNodes)return;n=e.childNodes;for(var r=n.length-1;r>=0;r--)y(n[r])||t.removeNode(n[r])}function y(e){for(var t=0;t<h.length;t++)if(h[t](e))return!0;return!1}function b(e){return e.name&&e.render&&typeof e.render=="function"}function w(e){var t;if(e.dataset)t=e.dataset[l];else if(e.attributes){var n=e.attributes["data-"+l];n&&(t=n.value)}if(!t)return{};try{return JSON.parse(t)}catch(r){return{}}}var e=this,c={},h=[];p(),this.registeredElements=[],this.build=function(t,f,l){var c=r.getElement(f),h=i.resolve(s.serviceLocator.FEATURE_FLAGS),p=h.isFeatureOn(s.featureFlags.SHOW_SPLASH_SCREEN),d;e.registeredElements.push({name:t,element:f}),t===n.controls.content.toLowerCase()&&p&&(d=i.resolve(s.serviceLocator.SPLASH_SCREEN),d.init(c.parentNode)),l=l||{},c.addClass(s.experience.RENDERER_CLASS),a.initLocaleDirection(c),o.initFocusRing(c),u.registerContainer(c),n.mode&&(l.mode=n.mode,c.addClass(n.mode)),v(t,c,l)},this.register=function(e){e instanceof Array?e.forEach(function(e){d(e)}):d(e)},this.get=function(e){if(!c[e])throw"Control not found";return c[e]},this.available=function(){return Object.keys(c)},this.registerNodePersistenceInspector=function(e){h.push(e)}}var t=e("vendor/knockout"),n=e("experience/settings"),r=e("browser/dom"),i=e("swx-service-locator-instance").default,s=e("swx-constants").COMMON,o=e("utils/common/accessibility"),u=e("utils/common/applicationFocusManager"),a=e("swx-g11n").globalization,f="data-control",l="model";return c}),define("services/navigation/navigationContext",["require","vendor/knockout"],function(e){function n(){this.currentPlaceName=t.observable(""),this.currentPlaceModel=t.observable(null),this.reset=function(){this.currentPlaceName(""),this.currentPlaceModel(null)}}var t=e("vendor/knockout");return n}),define("notifications/modelObservers/incomingCallObserver",["require","notifications/factory","swx-enums","swx-constants","notifications/common/notificationHub","swx-browser-detect","ui/telemetry/telemetryClient","experience/settings","swx-service-locator-instance","notifications/settings"],function(e){function l(){function v(e){var t=x(e);t.audioStateChangeSubscription=e.selfParticipant.audio.state.changed(function(t,n,r){g(e,t,n,r)})}function m(e){h.sendEvent(u.telemetry.uiTenantToken,r.telemetry.calling.MASTER_EVENT,e)}function g(e,t,n,r){var i={newValue:t,oldValue:r};if(s.getBrowserInfo().isShellApp)return;if(N(t)&&!b()){m({name:"LocalUserOffline"});return}if(N(t)&&y()){m({name:"CallInProgress"});return}N(t)&&w(e),T(i)&&S(e)}function y(){var e=a.resolve(r.serviceLocator.FEATURE_FLAGS).isFeatureOn(r.featureFlags.DISABLE_CONCURRENT_ACTIVE_CALLS),t=a.resolve(r.serviceLocator.MODEL_UI_OBSERVER).conversationsCallStateObserver;return e&&t.activeCalls().length>0?!0:!1}function b(){if(f.callNotificationsMuted())return!1;var e=l.mePerson.status();return p.isFeatureOn(r.featureFlags.USE_BUSINESS_WORDING)?e!==n.onlineStatus.DoNotDisturb:e===n.onlineStatus.Online||e===n.onlineStatus.Away}function w(e){C(e).then(function(e){E(e)||A(e)}).catch(function(){S(e)})}function E(e){return e&&e.active()}function S(e){var t=x(e),n=t.notification;n&&!n._keepActive&&(n.active(!1),t.notification=null),d.onNotificationCanceled&&d.onNotificationCanceled()}function x(t){var n;for(var r=0;r<e.length;r++){n=e[r];if(n.conversation===t)return n}return n={conversation:t},e.push(n),n}function T(e){return e.oldValue!==undefined&&e.newValue===n.callConnectionState.Disconnected}function N(e){return e===n.callConnectionState.Notified}function C(e){var t=x(e);return t.notification&&t.notification.active()?Promise.resolve(t.notification):k(e).then(function(e){return t.notification=e,t.notification})}function k(e){var t=c.mediaCapabilities,r,i=n.callingNotSupportedReasons.PluginNotInstalled;return new Promise(function(n){if(t.isPluginInstalled)t.isBrowserMediaSupported()||t.isPluginInstalled()?(r=L(e,!0,i),n(r)):t.isPluginInstalled.get().finally(function(){t.isPluginInstalled()?(r=L(e,!0,i),n(r)):(r=L(e,!1,i),n(r))});else{var s=e.audioService.accept.enabled();i=e.audioService.accept.enabled.reason,r=L(e,s,i),n(r)}})}function L(e,i,s){var o,u=r.notifications.INCOMING_CALL,a=!1;if(!i)switch(s){case n.callingNotSupportedReasons.PluginNotInstalled:case n.callingNotSupportedReasons.PluginBlocked:u=r.notifications.INCOMING_CALL_WITH_NO_PLUGIN;break;case n.callingNotSupportedReasons.BrowserNotSupported:u=r.notifications.INCOMING_CALL_BROWSER_NOT_SUPPORTED,a=!0;break;case n.callingNotSupportedReasons.OSNotSupported:u=r.notifications.INCOMING_CALL_OS_NOT_SUPPORTED,a=!0;break;default:u=r.notifications.INCOMING_CALL_OS_NOT_SUPPORTED}return o=t.build(u,{conversation:e}),o._keepActive=a,o}function A(e){var t,n;n=e.active.subscribe(function(e){e||n.dispose()}),e.type===r.notifications.AUDIO?e.sender.uri()?i.notify(e):t=e.sender.uri.subscribe(function(n){n&&(i.notify(e),t.dispose())}):i.notify(e)}var e=[],l,c,h=o.get(),p=a.resolve(r.serviceLocator.FEATURE_FLAGS),d=this;this.observe=function(e){e.conversationsManager.conversations.added(v),c=e.devicesManager,l=e.personsAndGroupsManager},this.onNotificationCanceled=null}var t=e("notifications/factory"),n=e("swx-enums"),r=e("swx-constants").COMMON,i=e("notifications/common/notificationHub"),s=e("swx-browser-detect").default,o=e("ui/telemetry/telemetryClient"),u=e("experience/settings"),a=e("swx-service-locator-instance").default,f=e("notifications/settings");return{build:function(){return new l}}}),define("telemetry/usage/inAppActivityTracker",["require","exports","module","swx-enums","swx-constants","browser/document","experience/settings","utils/common/localStorage","ui/telemetry/telemetryClient","swx-cafe-application-instance","telemetry/chat/sidebarReopenedEvent","browser/window","swx-mri"],function(e,t){function y(){var e=i.getElementsByClassName(r.experience.RENDERER_CLASS);for(var t=e.length-1;t>=0;--t)if(e[t].getBoundingClientRect().width!==0)return!0;return!1}function b(){var e=o.get(h.APP_FOCUSED_TIME_KEY),t=o.get(h.APP_CLOSED_TIME_KEY),n=o.get(h.SIGNED_IN_TIME_KEY);n&&t?w(parseInt(n,10),parseInt(t,10),h.APP_EXIT_POINT_REASON.APP_CLOSED,h.APP_ENTRY_POINT_REASON.APP_OPENED):e&&t&&w(parseInt(e,10),parseInt(t,10),h.APP_EXIT_POINT_REASON.APP_CLOSED,h.APP_ENTRY_POINT_REASON.APP_FOREGROUNDED),o.remove(h.APP_FOCUSED_TIME_KEY),o.remove(h.APP_CLOSED_TIME_KEY),o.remove(h.SIGNED_IN_TIME_KEY)}function w(e,t,n,i){var o=(t-e)/1e3,a=r.telemetry.inappActivity.KPI_INAPP_ACTIVITY_END,f={Entry_Point:i,Exit_Point:n,Foreground_Start_Time:e.toString(),Foregrounded_Duration:o.toString()};if(o<=0)return;u.get().sendEvent(s.telemetry.uiTenantToken,a,f)}function E(e,t){var n=a.get().personsAndGroupsManager.mePerson,i=r.telemetry.inappActivity.KPI_INAPP_ACTIVITY_START,o={Entry_Point:t,Foreground_Start_Time:e.toString(),GuestFlow:c.isGuestId(n.id())};u.get().sendEvent(s.telemetry.uiTenantToken,i,o)}function S(){o.set(h.APP_CLOSED_TIME_KEY,(new Date).getTime())}function x(){d||(d=setInterval(S,h.INTERVAL_30_SECONDS))}function T(){d&&(d=clearInterval(d))}function N(){y()?p||C():(o.remove(h.APP_FOCUSED_TIME_KEY),T())}function C(){if(!g)return;O(!0);var e=(new Date).getTime();o.set(h.APP_FOCUSED_TIME_KEY,e),E(e,h.APP_ENTRY_POINT_REASON.APP_FOREGROUNDED),x(),M(),p=!0}function k(){if(!g)return;y()||(O(!1),f.build().publishCloseTimeout(!0));var e=o.get(h.APP_FOCUSED_TIME_KEY),t=o.get(h.SIGNED_IN_TIME_KEY),n=(new Date).getTime();t?(w(parseInt(t,10),n,h.APP_EXIT_POINT_REASON.APP_BACKGROUNDED,h.APP_ENTRY_POINT_REASON.APP_OPENED),o.remove(h.SIGNED_IN_TIME_KEY)):e&&(w(parseInt(e,10),n,h.APP_EXIT_POINT_REASON.APP_BACKGROUNDED,h.APP_ENTRY_POINT_REASON.APP_FOREGROUNDED),o.remove(h.APP_FOCUSED_TIME_KEY)),T(),_(),p=!1}function L(){m||(m=setTimeout(function(){var e=y()&&i.hasFocus();e&&!p?C():!e&&p&&k(),m=null},h.TIMEOUT_1_SECOND))}function A(e){if(e===n.loginState.SignedIn){g=!0;if(y()&&i.hasFocus()){var t=(new Date).getTime();o.set(h.SIGNED_IN_TIME_KEY,t),E(t,h.APP_ENTRY_POINT_REASON.APP_OPENED),x(),M(),p=!0}}}function O(e){var t,n=r.telemetry.idleUsersAnalytics.localKeys.sidebarActivity,i,s=new Date;try{t=o.get(n),i=t?JSON.parse(t):{sidebar:{numberOfSignIns:1}},i.sidebar.timestamp=s,i.sidebar.state=e?"opened":"closed",e&&(i.sidebar.lastTimeOpened=s,i.sidebar.numberOfSignIns=0),o.set(n,JSON.stringify(i))}catch(u){}}function M(){v||(v=setInterval(D,h.ENDPOINT_ACTIVATION_TIMEOUT))}function _(){v&&(v=clearInterval(v))}function D(){if(!i.hasFocus()||!y()){_();return}a.get().isEndpointActive&&a.get().isEndpointActive.set(!0)}var n=e("swx-enums"),r=e("swx-constants").COMMON,i=e("browser/document"),s=e("experience/settings"),o=e("utils/common/localStorage"),u=e("ui/telemetry/telemetryClient"),a=e("swx-cafe-application-instance"),f=e("telemetry/chat/sidebarReopenedEvent"),l=e("browser/window"),c=e("swx-mri"),h={APP_FOCUSED_TIME_KEY:"swx|AppFocusedTimeMs",APP_CLOSED_TIME_KEY:"swx|appClosedTimeMs",SIGNED_IN_TIME_KEY:"swx|SingedInTimeMs",APP_ENTRY_POINT_REASON:{APP_OPENED:"Opened",APP_FOREGROUNDED:"Foregrounded"},APP_EXIT_POINT_REASON:{APP_CLOSED:"Closed",APP_BACKGROUNDED:"Backgrounded"},TIMEOUT_1_SECOND:1e3,INTERVAL_30_SECONDS:3e4,ENDPOINT_ACTIVATION_TIMEOUT:11e3},p,d,v,m,g;t.init=function(e){g=!1,p=!1,b(),e.state.changed(A),l.addEventListener(r.events.browser.FOCUS,N),l.addEventListener(r.events.browser.BLUR,k),l.addEventListener(r.events.browser.CLICK,L),l.addEventListener(r.events.browser.BEFOREUNLOAD,function(){o.set(h.APP_CLOSED_TIME_KEY,(new Date).getTime());return})},t.inappActivityConstants=h,t.isClientVisible=y}),define("notifications/modelObservers/unreadMessageObserver",["require","swx-cafe-application-instance","experience/settings","swx-constants","swx-service-locator-instance","swx-enums","notifications/factory","notifications/common/notificationHub","notifications/settings","ui/telemetry/telemetryClient","notifications/telemetry/browserToastTelemetry","telemetry/usage/inAppActivityTracker","utils/common/styleModeHelper"],function(e){function d(){function x(e,t,n){var r;if(!Array.isArray(e))return;if(S){e.forEach(function(e){b[e.id]=b[e.id]||p});return}n.length>e.length&&(r=n.filter(function(t){return e.indexOf(t)<0}),r.forEach(function(e){b[e.id]=undefined;var t=-1;w.find(function(n,r){n.conversationId===e.id&&(t=r)}),t>-1&&w.splice(t,1)}))}function T(e,n){function i(){function t(){return v?r.mentions.meIdentifier.test(n.html()):!1}return!e.chatService.shouldNotify||e.chatService.shouldNotify(n.text())||t()}function o(){return n.sender.id()===t.get().personsAndGroupsManager.mePerson.id()}function u(){return n.isDeleted()}function a(){return n.sender.isBlocked()}function f(e){return/^sip:.+@anonymous\.invalid$/.test(e.id())}function l(){if(d)return!0;var e=t.get().personsAndGroupsManager.mePerson;return f(e)?!0:e.status()===s.onlineStatus.Online}function g(e){return!t.get()._context||!t.get()._context.isMyEndpointActive?e(!0):m?t.get()._context.isTheOnlyActiveEndpoint().then(e):e(t.get()._context.isMyEndpointActive())}function w(){return y?(b[e.conversationId]||(b[e.conversationId]=0),b[e.conversationId]<p):!0}return new Promise(function(e){if(n.type()!==s.activityType.TextMessage)return e(!1);var t=!h.get().isConsumerIntegrated()||!c.isClientVisible(),r=!o()&&!a()&&!u()&&i()&&l()&&w()&&t;return r?g(e):e(!1)})}function N(e){e.historyService.activityItems.added(function(t){return C(e,t)})}function C(e,t){return T(e,t).then(function(i){if(!i)return;var s={muted:a.chatNotificationsMuted().toString(),isClientVisible:c.isClientVisible().toString()};e.state&&typeof e.state=="function"&&(s.conversationState=e.state()),f.get().sendEvent(n.telemetry.uiTenantToken,r.telemetry.chat.MESSAGE_NOTIFICATION,s),a.chatNotificationsMuted()||t.isRead.once(!1,function(){k(e,t)})})}function k(e,t){function a(){n.active(!1),u.dispose()}function f(t){g.publish(e,t)}y&&(b[e.conversationId]++,b[e.conversationId]===p&&w.push(e));var n,i,s={conversation:e,message:t,summary:A(e)},u;n=o.build(r.notifications.UNREAD_MESSAGE,s),n.publishUnreadMessageTelemetry=f,n.displayType=O(s.summary),n.isUnreadMessage=!0,i=t.timestamp()||new Date,L(n,e,i),u=t.html.changed(function(){if(s.summary&&s.summary.show)return;n.description(t.text())}),t.isDeleted.once(!0,a),t.isRead.once(!0,a)}function L(e,t,n){function i(){r.dispose()}var r;e.conversation=t,e.activityOccurence=n,e.sender.uri()?u.notify(e):r=e.sender.uri.subscribe(function(t){t&&(u.notify(e),i())})}function A(e){if(!y)return;var t={show:b[e.conversationId]===p,unreadConversations:w};return t}function O(e){return!e||!e.show?r.telemetry.browserToast.displayType.NORMAL:r.telemetry.browserToast.displayType.SUMMARY}var e=i.resolve(r.serviceLocator.FEATURE_FLAGS),d=e.isFeatureOn(r.featureFlags.NOTIFY_HOST_EVEN_WHEN_ME_NOTAVAILABLE),v=e.isFeatureOn(r.featureFlags.ENABLE_AGGRESSIVE_MENTIONS_TOAST),m=e.isFeatureOn(r.featureFlags.UNREAD_MESSAGE_TOAST_FOR_ACTIVE_ENDPOINT),g=l.build(r.telemetry.browserToast.EVENTS.SHOWN),y=e.isFeatureOn(r.featureFlags.CHAT_MESSAGE_TYPE_NOTIFICATION_ENABLED),b={},w=[],E=t.get().conversationsManager,S=!0;y&&E._unreadConversations&&E._unreadCounversationsCounters().then(function(){E._unreadConversations.subscribe(),E._unreadConversations.changed(x),S=!1}),this.observe=function(e){e.conversationsManager.conversations.added(N)}}var t=e("swx-cafe-application-instance"),n=e("experience/settings"),r=e("swx-constants").COMMON,i=e("swx-service-locator-instance").default,s=e("swx-enums"),o=e("notifications/factory"),u=e("notifications/common/notificationHub"),a=e("notifications/settings"),f=e("ui/telemetry/telemetryClient"),l=e("notifications/telemetry/browserToastTelemetry"),c=e("telemetry/usage/inAppActivityTracker"),h=e("utils/common/styleModeHelper"),p=3;return{build:function(){return new d}}}),define("notifications/modelObservers/contactRequestObserver",["require","swx-constants","swx-enums","notifications/factory","notifications/common/notificationHub"],function(e){function s(){function e(e){e.historyService.activityItems.added(function(t){s(e,t)})}function s(e,t){t.type()===n.activityType.ContactRequestIncoming&&t.isRead.once(!1,function(){o(e,t)})}function o(e,n){var i,s={conversation:e,activityItem:n};i=r.build(t.notifications.CONTACT_REQUEST,s),u(i),n.isRead.once(!0,function(){i.active(!1)})}function u(e){function n(){t.dispose()}var t;e.sender.uri()?i.notify(e):t=e.sender.uri.subscribe(function(t){t&&(i.notify(e),n())})}this.observe=function(t){t.conversationsManager.conversations.added(e)}}var t=e("swx-constants").COMMON,n=e("swx-enums"),r=e("notifications/factory"),i=e("notifications/common/notificationHub");return{build:function(){return new s}}}),define("notifications/modelObservers/chatRequestObserver",["require","notifications/factory","swx-enums","swx-constants","ui/modelHelpers/conversationHelper","notifications/settings","notifications/common/notificationHub","experience/settings","browser/window","swx-utils-common"],function(e){function l(){function e(e){e.selfParticipant.chat.state.changed(function(t){c(e,t)})}function l(){return!s.chatNotificationsMuted()}function c(e,t){l()&&t===n.callConnectionState.Notified&&f.execute(function(){e.selfParticipant.audio.state()!==n.callConnectionState.Notified&&h(e)},0)}function h(e){function f(){s&&s.dispose()}function l(){e.isGroupConversation()&&e.meeting.state()==="Disconnected"?n.decline():n.active(!1)}var n=t.build(r.notifications.CHAT,{conversation:e}),s;n.sender.uri()?o.notify(n):s=n.sender.uri.subscribe(function(e){e&&(o.notify(n),f())}),e.chatService.accept.enabled.once(!1,function(){function t(r){var s=!1,o,f,c;if(!n.active()){e.chatService.acceptType.changed.off(t),l();return}switch(r){case"AutoAccepted":e.chatService.acceptType.changed.off(t);if(!u.businessNotificationPersistence.persistWhenAutoAccepted.enabled){l();break}s=!0,o=u.businessNotificationPersistence.persistWhenAutoAccepted.timeout,i.isConversationWithWelcomeAgent(e)&&(o=u.welcomeExperience.toastPersistenceTimeout);break;case"ConnectedElsewhere":e.chatService.acceptType.changed.off(t);if(!u.businessNotificationPersistence.persistWhenConnectedElsewhere.enabled){l();break}s=!0,o=u.businessNotificationPersistence.persistWhenConnectedElsewhere.timeout;break;case"UserAccepted":case"Other":e.chatService.acceptType.changed.off(t),l();break;default:return}s&&(f=a.setTimeout(function(){l(),f=null},o),c=n.active.subscribe(function(e){if(e!==!1)return;c.dispose(),f&&(a.clearTimeout(f),f=null)}))}if(!e.chatService.acceptType||!n.active()){l();return}if(!u.businessNotificationPersistence.persistWhenConnectedElsewhere.enabled&&!u.businessNotificationPersistence.persistWhenAutoAccepted.enabled){l();return}e.chatService.acceptType.changed(t)})}this.observe=function(t){t.conversationsManager.conversations.added(e)}}var t=e("notifications/factory"),n=e("swx-enums"),r=e("swx-constants").COMMON,i=e("ui/modelHelpers/conversationHelper"),s=e("notifications/settings"),o=e("notifications/common/notificationHub"),u=e("experience/settings"),a=e("browser/window"),f=e("swx-utils-common").async;return{build:function(){return new l}}}),define("notifications/notificationObserversFactory",["require","exports","module","notifications/modelObservers/incomingCallObserver","notifications/modelObservers/unreadMessageObserver","notifications/modelObservers/contactRequestObserver","notifications/modelObservers/chatRequestObserver","swx-constants","swx-service-locator-instance"],function(e,t){function a(){var e=[],t=u.resolve(o.serviceLocator.FEATURE_FLAGS);return t.isFeatureOn(o.featureFlags.INCOMING_CALL_TOAST_NOTIFICATIONS)&&e.push(n.build()),t.isFeatureOn(o.featureFlags.UNREAD_MESSAGE_TOAST_NOTIFICATIONS)&&e.push(r.build()),t.isFeatureOn(o.featureFlags.CONTACT_REQUEST_TOAST_NOTIFICATIONS)&&e.push(i.build()),t.isFeatureOn(o.featureFlags.CHAT_REQUEST_TOAST_NOTIFICATIONS)&&e.push(s.build()),e}var n=e("notifications/modelObservers/incomingCallObserver"),r=e("notifications/modelObservers/unreadMessageObserver"),i=e("notifications/modelObservers/contactRequestObserver"),s=e("notifications/modelObservers/chatRequestObserver"),o=e("swx-constants").COMMON,u=e("swx-service-locator-instance").default;t.getObservers=a}),define("ui/calling/telemetry/callSession",["require","exports","module","swx-util-calling-stack","swx-log-tracer","swx-constants","ui/modelHelpers/conversationHelper","swx-enums","swx-utils-common","swx-utils-common","experience/settings","ui/telemetry/telemetryClient"],function(e,t){function c(e,t){function S(e){function n(e){return e===o.mediaStreamState.Active}function r(e){return!n(e)}var t=a.build();return t.pause(),d.push(e.state.when(n,t.resume.bind(t))),d.push(e.state.when(r,t.pause.bind(t))),t}function x(){e.selfParticipant.video.channels(0)&&(n.outboundVideo=S(e.selfParticipant.video.channels(0).stream)),n.outboundScreenshare=S(e.selfParticipant.screenSharing.stream)}function T(){var t=e.participants.added(function(e){var t=S(e.video.channels(0).stream);n.inboundVideoCollection.push(t);var r=S(e.screenSharing.stream);n.inboundScreenshareCollection.push(r)});d.push(t)}function N(e){if(e.length===0)return"0";var t=e.map(function(e){return e.durationInSeconds()});return Math.max.apply(null,t).toString()}function C(e){return e?e.durationInSeconds().toString():"0"}function k(t){var n=i.telemetry.calling.NA;e.isGroupConversation()&&e.conversationId&&(n=e.conversationId);var r={name:t,mediaConnectionType:E,callSessionId:m,isGroupCall:e.isGroupConversation(),conversation_id:n,call_leg_direction:M(),call_type:_(),conversation_members:e.participantsCount()+1,wasEscalated:h};return p>0&&(r.connected_pstn_participants_upper_bound=p),r}function L(e){r.log("[CallSession] event",e.name,"data",e),v.sendEvent(f.telemetry.uiTenantToken,i.telemetry.calling.MASTER_EVENT,e)}function A(n){if(t)return n?o.callDisconnectionReason.Terminated:O(e.selfParticipant);var r=!e.isGroupConversation();return n?o.callDisconnectionReason.Terminated:r?O(e.participants(0)):O(e.selfParticipant)}function O(e){return e&&e.audio.state.reason||o.callDisconnectionReason.Terminated}function M(){return t?i.telemetry.calling.direction.INCOMING:i.telemetry.calling.direction.OUTGOING}function _(){return e.isGroupConversation()?i.telemetry.calling.callType.S2S:s.isConversationWithPstn(e)?t?i.telemetry.calling.callType.SkypeIn:i.telemetry.calling.callType.SkypeOut:i.telemetry.calling.callType.S2S}function D(e){e!==o.mediaConnectionType.Unknown&&(E=e)}function P(){e.mediaConnectionType&&d.push(e.mediaConnectionType.changed(D))}function H(){e.selfParticipant.audio.state.reason===o.callDisconnectionReason.CallEscalated&&(h=!0);var t=0;e.participants.each(function(e){e.audio.state()===o.callConnectionState.Connected&&s.isPstnParticipant(e)&&++t}),p<t&&(p=t)}function B(){d.forEach(function(e){e.dispose&&e.dispose()})}var n={callStarted:a.build(),callDuration:null,outboundVideo:null,outboundScreenshare:null,inboundVideoCollection:[],inboundScreenshareCollection:[]},c={NotStarted:0,Started:1,Ringing:2,Connected:3,Ended:4},h=!1,p=0,d=[],v=l.get(),m=u.create(),g,y,b,w=c.NotStarted,E=o.mediaConnectionType.Unknown;this.isChildOf=function(t){return e===t},this.start=function(){if(w>=c.Started){r.log("Call session has already started. You are trying to start it twice");return}r.log("Call session started:",m),b=(new Date).getTime(),w=c.Started,P(),H();var t=k(i.telemetry.calling.START_CALL);t.audioAvailability=e.audioService.start.enabled.reason||i.telemetry.calling.AVAILABLE,L(t)},this.setRinging=function(){if(w===c.Ringing){r.log("Call is already ringing for another participant, skip ringing state");return}if(w===c.Connected){r.log("Call is already connected, skip ringing state");return}w=c.Ringing;var e=k(i.telemetry.calling.RINGING_CALL);y=C(n.callStarted),L(e)},this.setConnected=function(){if(w===c.Connected){r.log("You are trying to set a call session as connected but it is already in this state");return}if(w===c.NotStarted){r.log("You are trying to set a call session as connected that has not started");return}if(w===c.Ended){r.log("You are trying to set a call session as connected that has ended");return}x(),T(),w=c.Connected,n.callDuration=a.build(),g=C(n.callStarted),L(k(i.telemetry.calling.CONNECTED_CALL))},this.onParticipantStatusChanged=function(){H()},this.end=function(){var t,o,u,a=i.telemetry.calling.UNAVAILABLE;if(w===c.NotStarted){r.log("You are trying to end a call session that was not started"),B();return}if(w===c.Ended){r.log("You are trying to end a call session that has already ended"),B();return}e.audioService.callId&&e.audioService.callId()&&(a=e.audioService.callId()),t=w===c.Connected,o=t||w===c.Ringing,w=c.Ended,u=k(i.telemetry.calling.END_CALL),u.wasConnected=t,u.timeToCancelCall=t?"0":C(n.callStarted),u.timeToConnect=t?g:"0",u.wasAtLeastOnceParticipantOnline=s.isAtLeastOnceParticipantOnline(e),u.timeToRing=y||"0",u.call_id=a,u.call_end_reason=A(t),u.start_timestamp=b||"undefined",u.end_timestamp=(new Date).getTime(),u.call_leg_duration_sec=C(n.callDuration),u.call_leg_successful=o,u.inbound_video_duration_sec=N(n.inboundVideoCollection),u.outbound_video_duration_sec=C(n.outboundVideo),u.screenshare_duration_sec=C(n.outboundScreenshare),u.screenshare_inbound_duration_sec=N(n.inboundScreenshareCollection),u.screenshare_monitor_count=(e.screenSharingService.shareableResources&&e.screenSharingService.shareableResources.size()||0)+"",L(u),B()}}function h(){var e=function(){};this.start=e,this.setRinging=e,this.setConnected=e,this.onParticipantStatusChanged=e,this.end=e,this.escalate=e}function p(e,t,r){return n.get().isInBrowserCallingSupported()?new c(e,t,r):new h}var n=e("swx-util-calling-stack"),r=e("swx-log-tracer").getLogger(),i=e("swx-constants").COMMON,s=e("ui/modelHelpers/conversationHelper"),o=e("swx-enums"),u=e("swx-utils-common").guid,a=e("swx-utils-common").stopwatch,f=e("experience/settings"),l=e("ui/telemetry/telemetryClient");t.buildOutgoingCallSession=function(e){return p(e,!1)},t.buildIncomingCallSession=function(e){return p(e,!0)}}),define("telemetry/calling/pstn/creditBalanceTracker",["require","exports","module","swx-cafe-application-instance","ui/modelHelpers/conversationHelper","telemetry/calling/pstn/pstn","swx-browser-detect"],function(e,t){function o(){function u(){var e=(new Date).getTime();if(o){var t=e-o;i.updatingCreditBalance(t/1e3),o=null}}var e=this,t,o;e.init=function(){var e=n.get().personsAndGroupsManager.mePerson.account;e&&e.displayBalance&&e.displayBalance.changed(u)},e.callConnected=function(e){!s.getBrowserInfo().isShellApp&&r.isConversationWithPstn(e)&&(t=!0)},e.callEnded=function(e){t===!0&&r.isConversationWithPstn(e)&&(o=(new Date).getTime(),t=!1)}}var n=e("swx-cafe-application-instance"),r=e("ui/modelHelpers/conversationHelper"),i=e("telemetry/calling/pstn/pstn"),s=e("swx-browser-detect").default;t.build=function(){return new o}}),define("ui/viewModels/calling/deviceDisabledViewModel",["require","exports","module","swx-browser-detect","swx-i18n"],function(e,t){function s(e){var t=this;t.title="",t.text="",n.getBrowserInfo().browserName===n.BROWSERS.CHROME&&(t.title=r.fetch({key:"modal_device_disabled_chrome_title"}),t.text=r.fetch({key:"modal_device_disabled_chrome_text",params:{image:'<span class="iconDeviceDisabledChrome"></span>'}})),n.getBrowserInfo().isEdge&&(t.title=r.fetch({key:"modal_device_disabled_edge_title"}),t.text=r.fetch({key:"modal_device_disabled_edge_text"})),t.close=function(){e()}}var n=e("swx-browser-detect").default,r=e("swx-i18n").localization,i="swx-overlayDeviceDisabled";t.ELEMENT_ID=i,t.build=function(e){return new s(e)}}),define("text!views/calling/deviceDisabled.html",[],function(){return'<div id="swx-overlayDeviceDisabled" class="swx-overlayModal swx-overlayDeviceDisabled">\r\n\r\n    <div class="buttonRow">\r\n        <button class="btn narrow transparent" data-bind="click: close" type="button">\r\n            <span class="iconfont after cross pull3" data-bind="l10n: { \'key\': \'header_text_close\' }"></span>\r\n        </button>\r\n    </div>\r\n\r\n    <div class="title">\r\n        <h1 class="fontSize-h0 fontSizeNarrow-h1" data-bind="text: title"></h1>\r\n    </div>\r\n\r\n    <div class="subtitle">\r\n        <p class="fontSize-h4 fontSizeNarrow-h4" data-bind="html: text"></p>\r\n    </div>\r\n</div>'}),define("ui/modalDialog/deviceDisabledDialog",["require","exports","module","swx-cafe-application-instance","swx-browser-detect","swx-constants","ui/viewModels/calling/deviceDisabledViewModel","text!views/calling/deviceDisabled.html","swx-i18n","ui/modalDialog/modalDialog","swx-service-locator-instance"],function(e,t){function l(){var e=s.build(c),t;r.getBrowserInfo().browserName===r.BROWSERS.CHROME&&(t=u.fetch({key:"modal_device_disabled_chrome_title"})),r.getBrowserInfo().isEdge&&(t=u.fetch({key:"modal_device_disabled_edge_title"})),a.build(s.ELEMENT_ID,e,o),a.show(s.ELEMENT_ID,t)}function c(){a.dispose(s.ELEMENT_ID)}var n=e("swx-cafe-application-instance"),r=e("swx-browser-detect").default,i=e("swx-constants").COMMON,s=e("ui/viewModels/calling/deviceDisabledViewModel"),o=e("text!views/calling/deviceDisabled.html"),u=e("swx-i18n").localization,a=e("ui/modalDialog/modalDialog"),f=e("swx-service-locator-instance").default;t.init=function(){var e=f.resolve(i.serviceLocator.FEATURE_FLAGS);if(e.isFeatureOn(i.featureFlags.DEVICE_DISABLED_DIALOG_ENABLED)){var t=n.get().devicesManager.mediaCapabilities.isMicrophoneEnabled(),r=n.get().devicesManager.mediaCapabilities.isCameraEnabled();(!t||!r)&&l()}}}),define("ui/viewModels/calling/callScreenViewModel/sounds",["require","swx-browser-detect","ui/controls/calling/sounds"],function(e){function r(){if(t.getBrowserInfo().isShellApp)return;n.playOnce(n.KEYS.CALL_END_CALL)}function i(){if(t.getBrowserInfo().isShellApp)return;n.playOnce(n.KEYS.CALL_OUTGOING_P1,function(){n.playLoop(n.KEYS.CALL_OUTGOING_P2)})}function s(){if(t.getBrowserInfo().isShellApp)return;n.stop(n.KEYS.CALL_OUTGOING_P1),n.stop(n.KEYS.CALL_OUTGOING_P2),n.stop(n.KEYS.CALL_DIALING),n.stop(n.KEYS.CALL_CONNECTING)}var t=e("swx-browser-detect").default,n=e("ui/controls/calling/sounds");return{playEndCall:r,playRingingOut:i,stopAll:s}}),define("ui/modelObservers/calling/callStateObserver",["require","exports","module","ui/calling/telemetry/callSession","swx-util-calling-stack","swx-constants","telemetry/calling/pstn/creditBalanceTracker","services/cqf/CQFHandler","ui/modalDialog/deviceDisabledDialog","swx-enums","vendor/knockout","notifications/factory","notifications/common/notificationHub","swx-pubsub-instance","ui/viewModels/calling/callScreenViewModel/sounds","ui/calling/unansweredCallHandler"],function(e,t){function v(){function g(t){var n=T(t);n.participantsSubs=[],n.audioHandler=function(n,r,s){s&&(w(t,n,s),b(t),E(t,n)),n===a.callConnectionState.Disconnecting&&(r===a.callDisconnectionReason.MissingSpeaker?c.notify(l.build(i.notifications.DEVICE_MISSING_SPEAKER)):r===a.callDisconnectionReason.MissingMicrophone&&c.notify(l.build(i.notifications.DEVICE_MISSING_MICROPHONE))),n===a.callConnectionState.Disconnected&&e.activeCalls.remove(t)},n.videoHandler=function(e){E(t,e)},n.onParticipantAudioStateChanged=function(e){n.callSession&&(n.callSession.onParticipantStatusChanged(),e===a.callConnectionState.Ringing&&n.callSession.setRinging()),(e===a.callConnectionState.Ringing||e===a.callConnectionState.EarlyMedia)&&b(t)},n.participantAddedHandler=function(e){var r=e.audio.state.changed(n.onParticipantAudioStateChanged),i=e.screenSharing.state.when(a.callConnectionState.Notified,S.bind(null,t,e));r.participant=e,i.participant=e,n.participantsSubs.push(r,i)},n.participantRemovedHandler=function(e){n.participantsSubs=n.participantsSubs.filter(function(t){return t.participant===e?(t.dispose(),!1):!0})},n.getCallSession=function(e){return n.callSession?n.callSession:(e===a.callConnectionState.Notified||t.activeModalities.audio()?n.callSession=y(t,!0):n.callSession=y(t,!1),n.callSession)},n.clearCallSession=function(){delete n.callSession},n.spawnedConversationStateChanged=function(e){e&&h.publish(i.events.navigation.OPEN_CONVERSATION,{model:e,origin:i.telemetry.historyLoadOrigin.CALLING})},t.participants.added(n.participantAddedHandler),t.participants.removed(n.participantRemovedHandler),t.selfParticipant.audio.state.changed(n.audioHandler),t.selfParticipant.video.state.changed(n.videoHandler),t.spawnedConversation&&t.spawnedConversation.changed(n.spawnedConversationStateChanged)}function y(e,t){return t?n.buildIncomingCallSession(e):n.buildOutgoingCallSession(e)}function b(e){function r(){var t=e.participants().some(function(e){return e.audio.state()===a.callConnectionState.EarlyMedia});return t}function i(){var t=e.participants().some(function(e){return e.audio.state()===a.callConnectionState.Ringing});return t}var t=e.selfParticipant.audio.state(),n=e.selfParticipant.audio.state.reason;t===a.callConnectionState.Connected?p.stopAll():t===a.callConnectionState.Disconnected?(p.stopAll(),n!==a.callDisconnectionReason.Busy&&n!==a.callDisconnectionReason.Missed&&n!==a.callDisconnectionReason.Canceled&&n!==a.callDisconnectionReason.NotificationTimeout&&n!==a.callDisconnectionReason.CallEscalated&&p.playEndCall()):r()?p.stopAll():i()&&(p.stopAll(),p.playRingingOut())}function w(e,t,n){var r=T(e),i=r.getCallSession(t);switch(t){case a.callConnectionState.Notified:i.start(),i.setRinging();break;case a.callConnectionState.Connecting:i.start(),o.observe(e),d.observe(e);break;case a.callConnectionState.Connected:i.setConnected(),m.callConnected(e);break;case a.callConnectionState.Disconnecting:o.updateCallData(e);break;case a.callConnectionState.Disconnected:i.end(),r.clearCallSession(),m.callEnded(e),d.callEnded(),n!==a.callConnectionState.Disconnected&&u.init()}}function E(t,n){if(n!==a.callConnectionState.Connecting)return;r.get().isInBrowserCallingSupported()&&h.publish(i.events.navigation.OPEN_CONVERSATION,{model:t,origin:i.telemetry.historyLoadOrigin.CALLING}),e.activeCalls.indexOf(t)===-1&&e.activeCalls.push(t)}function S(e,t){e.screenSharingService.sharer(t),e.screenSharingService.accept.enabled()&&e.screenSharingService.accept()}function x(t){var n=T(t);n&&(n.conversation.selfParticipant.audio.state.changed.off(n.audioHandler),n.conversation.selfParticipant.video.state.changed.off(n.videoHandler),n.conversation.participants.added.off(n.participantAddedHandler),n.conversation.participants.removed.off(n.participantRemovedHandler),n.participantsSubs.forEach(function(e){e.dispose()}),n.participantsSubs.length=0,e.activeCalls.remove(t))}function T(e){var t;for(var n=0;n<v.length;n++){t=v[n];if(t.conversation===e)return t}return t={conversation:e},v.push(t),t}var e=this,t,v=[],m=s.build();e.activeCalls=f.observableArray(),e.observe=function(e){t=e.conversationsManager.conversations,t.added(g),t.removed(x),m.init(),d.init()}}var n=e("ui/calling/telemetry/callSession"),r=e("swx-util-calling-stack"),i=e("swx-constants").COMMON,s=e("telemetry/calling/pstn/creditBalanceTracker"),o=e("services/cqf/CQFHandler"),u=e("ui/modalDialog/deviceDisabledDialog"),a=e("swx-enums"),f=e("vendor/knockout"),l=e("notifications/factory"),c=e("notifications/common/notificationHub"),h=e("swx-pubsub-instance").default,p=e("ui/viewModels/calling/callScreenViewModel/sounds"),d=e("ui/calling/unansweredCallHandler");t.build=function(){return new v}}),define("ui/modelObservers/modelObserver",["require","exports","module","notifications/notificationObserversFactory","ui/modelObservers/calling/callStateObserver"],function(e,t){function i(){function t(){var t=[];return n.getObservers().forEach(function(e){t.push(e)}),t.push(e.conversationsCallStateObserver),t}var e=this;e.conversationsCallStateObserver=r.build(),e.observe=function(e){t().forEach(function(t){t.observe(e)})}}var n=e("notifications/notificationObserversFactory"),r=e("ui/modelObservers/calling/callStateObserver");t.build=function(){return new i}}),define("services/pes/mruService",["require","lodash-compat","swx-constants","utils/common/cache/instance","swx-utils-common","services/pes/constants"],function(e){function a(e,t){return e===t}function f(e,n){var r=5;return o.itemTypes[n]&&t.isNumber(o.itemTypes[n].mruLimit)&&(r=o.itemTypes[n].mruLimit),t.take(e,r)}function l(e,n){t.forEach(e,function(e){var r,i=e.id,s=e.type;n.configuration[s]=n.configuration[s]||[],r=t.findIndex(n.configuration[s],t.partial(a,i)),r>=0&&n.configuration[s].splice(r,1),n.configuration[s].unshift(i),n.configuration[s]=f(n.configuration[s],s)})}function c(e){t.forEach(e.registeredEvents[r.personalExpression.CONFIG_INITIALIZED],t.partial(t.attempt,t,e.getMRUItems()))}function h(){return i.get().getItem(u)}function p(){return h().then(function(e){return e&&e.mruItems&&t.isObject(e.mruItems)&&!t.isArray(e.mruItems)&&e.version===o.SAVED_DATA_VERSION?e.mruItems:{}})}function d(e){return i.get().setItem(u,{mruItems:e,version:o.SAVED_DATA_VERSION},0)}function v(){var e=this;this.configuration={},this.registeredEvents={},p().then(function(t){var n=e.getMRUItems();e.configuration=t,l(n,e),c(e)})}var t=e("lodash-compat"),n=e("swx-constants").COMMON,r=n.events,i=e("utils/common/cache/instance"),s=e("swx-utils-common").builderMixin,o=e("services/pes/constants"),u="pes2";return v.prototype.addItemsToMru=function(e){var n=this;return e?(t.isArray(e)||(e=[e]),e.length===0?Promise.resolve():(l(e,n),c(n),d(this.configuration))):Promise.resolve()},v.prototype.getMRUItems=function(){return t(this.configuration).map(function(e,n){return t.map(e,function(e){return{id:e,type:n}})}).flatten().value()},v.prototype.on=function(n,r){if(!n||!r)return;return this.registeredEvents.hasOwnProperty(n)||(this.registeredEvents[n]=[]),t.any(this.registeredEvents[n],t.partial(a,r))||this.registeredEvents[n].push(r),{cancel:this.off.bind(this,n,r)}},v.prototype.off=function(n,r){return this.registeredEvents.hasOwnProperty(n)?t.first(t.remove(this.registeredEvents[n],t.partial(a,r))):null},t.extend(v,s),v}),define("services/pes/bingSearch/bingSearchService",["require","lodash-compat","swx-utils-common","reqwest","utils/common/cancelation","utils/common/url","experience/settings"],function(e){function u(e,t,n){this.apiKey=e,this.authMethod=t,this.serviceUrl=n}var t=e("lodash-compat"),n=e("swx-utils-common").builderMixin,r=e("reqwest"),i=e("utils/common/cancelation"),s=e("utils/common/url"),o=e("experience/settings");return u.prototype.search=function(n,u){var a,f;return u=t.defaults({},u,{authMethod:this.authMethod,apiKey:this.apiKey,serviceUrl:this.serviceUrl},{authMethod:o.pesSearchServices.bingAuthMethod,apiKey:o.pesSearchServices.bingApiKey,serviceUrl:o.pesSearchServices.bingServiceURL},{fetch:20}),n?(a={headers:{Authorization:u.authMethod+" "+u.apiKey},url:s.buildUrl(u.serviceUrl,{Query:"'"+n+"'",$top:u.fetch}),dataType:"json",crossOrigin:!0},f=i.adaptAbortable(r.compat(a)),i.makeCancelable(f,u.cancelationToken).then(function(e){return e.d.results.map(function(e){return{id:e.ID,url:e.MediaUrl,contentType:e.ContentType,thumbnail:e.Thumbnail.MediaUrl,title:e.Title,width:e.Width,height:e.Height}})})):Promise.resolve()},t.extend(u,n),u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-giphy-service/lib/giphy",["require","exports","lodash-compat","swx-utils-common","reqwest"],e)}(function(e,t){function f(e,t){var n=r.cancelation.adaptAbortable(i.compat(e));return r.cancelation.makeCancelable(n,t)}function c(e){return new l(e)}var n=e("lodash-compat"),r=e("swx-utils-common"),i=e("reqwest"),s={endpoint:"v1/gifs/search",rating:"g",limit:20,offset:0},o={endpoint:"v1/gifs/translate",rating:"g"},u={endpoint:"v1/gifs/random",rating:"g"},a={endpoint:"v1/gifs/trending",rating:"g",limit:20},l=function(){function e(e){this.options=e}return e.prototype.search=function(e,t){if(!e)return Promise.resolve();t=n.defaults({},t,this.options,s);var i={url:r.url.buildUrl(t.serviceUrl,t.endpoint,{api_key:t.apiKey,rating:t.rating,limit:t.limit,offset:t.offset,q:e}),method:"get",dataType:"json",crossOrigin:!0};return f(i,t.cancelationToken)},e.prototype.translate=function(e,t){if(!e)return Promise.resolve();t=n.defaults({},t,this.options,o);var i={url:r.url.buildUrl(t.serviceUrl,t.endpoint,{api_key:t.apiKey,rating:t.rating,s:e}),method:"get",dataType:"json",crossOrigin:!0};return f(i,t.cancelationToken)},e.prototype.random=function(e,t){t=n.defaults({},t,this.options,u);var i={url:r.url.buildUrl(t.serviceUrl,t.endpoint,e?{api_key:t.apiKey,rating:t.rating,tag:e}:{api_key:t.apiKey,rating:t.rating}),method:"get",dataType:"json",crossOrigin:!0};return f(i,t.cancelationToken)},e.prototype.trending=function(e){e=n.defaults({},e,this.options,a);var t={url:r.url.buildUrl(e.serviceUrl,e.endpoint,{api_key:e.apiKey,rating:e.rating,limit:e.limit}),method:"get",dataType:"json",crossOrigin:!0};return f(t,e.cancelationToken)},e}();t.build=c}),define("swx-giphy-service",["swx-giphy-service/lib/giphy"],function(e){return e}),define("services/pes/config",["require","lodash-compat","swx-constants","swx-i18n","services/pes/constants","utils/chat/pesUtils","swx-service-locator-instance","swx-utils-common","swx-utils-common","swx-utils-chat","experience/settings","reqwest"],function(e){function p(){function d(){return{itemsRoot:"",emoticonsRoot:"",packsRoot:"",items:[],packs:[],tabs:[]}}function v(e){p.hasOwnProperty(r.personalExpression.CONFIG_INITIALIZED)&&t.forEach(p[r.personalExpression.CONFIG_INITIALIZED],function(t){t(e)})}function m(e,t){var r=(t||"#")+"/"+e.id+"/views/thumbnail",i=u.resolve(n.serviceLocator.FEATURE_FLAGS);return i.isFeatureOn(n.featureFlags.PES_CDN_AUTH_ENABLED)&&(r=o.rewriteUrls(r,c.pesCDNAuthentication.rewriteRules)),{id:e.id,type:s.itemTypes.tab.id,title:e.title,thumbnailUrl:r,packs:[e]}}function g(e,n){return t.find(e,{id:n})}function y(e){return(e.title||"").indexOf(s.FEATURED_IN_PREFIX)===0}function b(e,n){var r=[];return e&&(e.forEach(function(e){if(!y(e)){var t=m(e,n);r.push(t)}}),e.forEach(function(e){if(y(e)){var o=e.title.replace(s.FEATURED_IN_PREFIX,""),u=t.find(r,{title:o});u?(e.title=i.fetch({key:"pes_featured_title"}),e.isHidden=!1,u.packs.splice(0,0,e)):e.isHidden===!1&&(e.title=o,u=m(e,n),r.push(u))}})),r}function w(e){e.packs.forEach(function(t){var n=[];t.items.forEach(function(t){n.push(g(e.items,t))}),t.items=n})}function E(e){e.tabs.forEach(function(t){var n=[];t.sections.forEach(function(t){var r=g(e.packs,t.pack);r&&r.items&&r.items.length&&n.push(r)}),t.packs=n,t.type=s.itemTypes.tab.id,t.thumbnailUrl=m(t,e.tabsRoot).thumbnailUrl})}function S(t){var n="default";return c.locale&&c.locale.pes&&(n=c.locale.pes),t.type===s.itemTypes.emoticon.id?e.emoticonsRoot+"/"+t.id+"/views/meta."+n:t.type===s.itemTypes.moji.id?e.itemsRoot+"/"+t.id+"/views/meta."+n:null}function x(t){var r=u.resolve(n.serviceLocator.FEATURE_FLAGS);return t.type!==s.itemTypes.moji.id?t:(t.auxiliaryUrl=t.auxiliaryUrl||"",l.validate(t.auxiliaryUrl)||(t.auxiliaryUrl=""),t.description=t.description||"",t.auxiliaryText=t.auxiliaryText||t.auxiliaryUrl,t.copyright=t.copyright||"",t._mojiURL=e.itemsRoot+"/"+t.id+"/views/default",t._thumbnailURL=e.itemsRoot+"/"+t.id+"/views/thumbnail",r.isFeatureOn(n.featureFlags.PES_CDN_AUTH_ENABLED)&&(t._mojiURL=o.rewriteUrls(t._mojiURL,c.pesCDNAuthentication.rewriteRules),t._thumbnailURL=o.rewriteUrls(t._thumbnailURL,c.pesCDNAuthentication.rewriteRules),e._requiresCDNUrlAuthentication&&(t._mojiURL=t._mojiURL+"?"+e._cdnToken,t._thumbnailURL=t._thumbnailURL+"?"+e._cdnToken)),t)}var e,a=f.build(),p={};this.getConfiguration=function(){return e},this.init=function(n){return e=d(),t.assign(e,n),w(e),n.tabs?E(e):e.tabs=b(e.packs,e.packsRoot),v(e),a.resolve(),e},this.cdnTokenUpdated=function(t){if(e._cdnToken===t)return;e._cdnToken=t,e._requiresCDNUrlAuthentication&&v(e)},this.fetchMetadata=function(r){return a.then(function(){var i,s,a,f="default",p=u.resolve(n.serviceLocator.FEATURE_FLAGS);return l.validate(r)?(c.locale&&c.locale.pes&&(f=c.locale.pes),s=r.replace(/\/views\/[^]+$/,"/views/meta."+f),a=t.find(e.items,function(e){return S(e)===s}),a?Promise.resolve(x(a)):(p.isFeatureOn(n.featureFlags.PES_CDN_AUTH_ENABLED)&&(s=o.rewriteUrls(s,c.pesCDNAuthentication.rewriteRules),e._requiresCDNUrlAuthentication&&(s=s+"?"+e._cdnToken)),i={url:s,dataType:"json",crossOrigin:!0},p.isFeatureOn(n.featureFlags.PES_CDN_AUTH_ENABLED)&&(i.withCredentials=!0),Promise.resolve(h.compat(i)).then(function(n){var i=r.match(/\/([^\/]+)\/views\/[^\/]+$/);return i?(n.id=i[1],t.any(e.items,{id:n.id})||(e.items.push(n),v(e)),x(n)):Promise.reject(new Error("Moji ID not found"))}))):Promise.reject(new Error("URL is not valid"))})},this.on=function(n,r){if(!n||!r)return;return p.hasOwnProperty(n)||(p[n]=[]),t.any(p[n],function(e){return e===r})||p[n].push(r),{cancel:this.off.bind(this,n,r)}},this.off=function(n,r){return p.hasOwnProperty(n)?t.first(t.remove(p[n],function(e){return e===r})):null},e=d()}var t=e("lodash-compat"),n=e("swx-constants").COMMON,r=n.events,i=e("swx-i18n").localization,s=e("services/pes/constants"),o=e("utils/chat/pesUtils"),u=e("swx-service-locator-instance").default,a=e("swx-utils-common").builderMixin,f=e("swx-utils-common").settablePromise,l=e("swx-utils-chat").urlValidator,c=e("experience/settings"),h=e("reqwest");return t.assign(p,a),p}),define("text!views/experience/splashScreen.html",[],function(){return'<!-- ko if: isVisible -->\r\n<div class="swx shellSplashScreen" id="swxSplashScreen" data-bind="css: theme">\r\n    <!-- ko ifnot: teamsDeprecation  -->\r\n    <div class="shellSplashLogoContainer" data-bind="if: showLogo">\r\n        <div class="shellSplashLogo shellSplashLogoSkype" data-bind="if: !useBusinessWording">\r\n            <span class="iconfont logoSkypeMedium"></span>\r\n        </div>\r\n        <div class="shellSplashLogo shellSplashLogoSkypeForBusiness" data-bind="if: useBusinessWording">\r\n            <span class="iconfont iconSkypeForBusinessLarge"></span>\r\n            <p class="logoText" data-bind="l10n: { \'key\': \'splashScreen_text_logo_4b\' }"></p>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- ko if: showEducationCarousel -->\r\n    <swx-edu-carousel class="EduCarousel"></swx-edu-carousel>\r\n    <!-- /ko -->\r\n\r\n    <div class="shellSplashPage">\r\n        <!-- ko if: showLoader -->\r\n        <div class="shellSpinnerContainer">\r\n            <swx-loading-animation class="swx-spinner" data-bind="css: spinnerColor"></swx-loading-animation>\r\n        </div>\r\n        <div class="fontSize-h4" aria-live="polite" data-bind="html: loadingText"></div>\r\n        <span class="offScreen" aria-live="assertive" data-bind = "html: narratorText"></span>\r\n        <!-- /ko -->\r\n        <!-- ko if: showSignIn -->\r\n        <div class="shellSplashContent">\r\n            <h1 class="fontSize-h2" aria-live="polite" data-bind="html: signInTitle"></h1>\r\n            <p class="fontSize-h4" aria-live="polite" data-bind="html: signInDescription"></p>\r\n            <a class="btn" href="#" data-bind="click: signIn, visible: isSignInEnabled">\r\n                <span data-bind="l10n: { \'key\': \'splashScreen_signIn_button\' }"></span>\r\n            </a>\r\n            <!-- ko if: isSignInExternalEnabled() -->\r\n            <a class="btn" href="#" data-bind="click: signInExternal">\r\n                <span data-bind="l10n: { \'key\': \'splashScreen_signInExternal_button\' }"></span>\r\n            </a>\r\n            <!-- /ko -->\r\n            <!-- ko if: isSignInNotificationEnabled() -->\r\n            <a class="btn" href="#" data-bind="click: notifySignIn">\r\n                <span data-bind="text: getSignInButtonText()"></span>\r\n            </a>\r\n            <!-- /ko -->\r\n            <a class="fontSize-h4" target="_blank" data-bind="attr: {href: learnMoreUrl}, text: signInLearnMoreText, visible: isLearnMoreLinkVisible"></a>\r\n            <!-- ko if: isFeedbackEnabled() -->\r\n            <a class="btn" data-bind="attr: { href: feedbackPageUrl(), target: feedbackPageTarget()}">\r\n                <span data-bind="l10n: { \'key\': \'giveFeedback_button_label\' }"></span>\r\n            </a>\r\n            <!-- /ko -->\r\n        </div>\r\n        <!-- /ko -->\r\n    </div>\r\n    <!-- /ko  -->\r\n    <!-- ko if: teamsDeprecation  -->\r\n        <swx-teams-migrated class="TeamsMigrated"></swx-teams-migrated>\r\n    <!-- /ko  -->\r\n</div>\r\n<!-- /ko -->\r\n'}),define("telemetry/chat/splashScreenEvent",["require","exports","module","usertiming","experience/settings","swx-constants","swx-telemetry-buckets","ui/telemetry/telemetryClient","swx-utils-chat"],function(e,t){function c(){function p(){var e=l,t=f.EXPERIENCE.SPLASH_TIME,r=n.getEntriesByName(a.EXPERIENCE.CONTENT_INIT);if(r.length>0){n.measure(t,a.EXPERIENCE.CONTENT_INIT,a.TIMELINE.SYNC_END_OK);var i=n.getEntriesByName(t);i&&i.length>0&&(e=i[0].duration)}else{n.measure(t,a.EXPERIENCE.CONTENT_INIT,a.TIMELINE.SYNC_END_ERROR);var s=n.getEntriesByName(t);s&&s.length>0&&(e=s[0].duration)}return e}function d(){var e=l,t=n.getEntriesByName(f.TIMELINE.TTL),r=n.getEntriesByName(f.TIMELINE.TTL);return t&&t.length>0?e=t[0].duration:r&&r.length>0&&(e=r[0].duration),e}var e=this,t=i.telemetry.splashScreenEvent.TYPE,c,h={isSignInEnabled:l,isLearnMoreLinkVisible:l,timeToSplash:l,timeToSplashGroup:l};e.startSplashScreenMeasure=function(e,t){c=u.getDate(),h.isSignInEnabled=typeof e=="undefined"?l:e,h.isLearnMoreLinkVisible=typeof t=="undefined"?l:t},e.publish=function(){c&&(h.timeToSplash=u.getDate()-c,h.timeToSplashGroup=s.getSecondsDurationGroupFromMs(h.timeToSplash)),h.timeToContent=p(),h.timeToContentGroup=s.getSecondsDurationGroupFromMs(h.timeToContent),h.timelineTTL=d(),h.timelineTTLGroup=s.getSecondsDurationGroupFromMs(h.timelineTTL),o.get().sendEvent(r.telemetry.chatTenantToken,t,h)}}var n=e("usertiming"),r=e("experience/settings"),i=e("swx-constants").COMMON,s=e("swx-telemetry-buckets"),o=e("ui/telemetry/telemetryClient"),u=e("swx-utils-chat").dateTime,a=i.telemetry.performanceMarks,f=i.telemetry.measurements,l=i.telemetry.NOT_AVAILABLE;t.build=function(){return new c}}),define("utils/common/signInNotificationHandler",["require","exports","module","swx-constants","experience/settings","lodash-compat","ui/telemetry/actions/actionNames","browser/window","browser/document","notifications/common/notification","swx-service-locator-instance","notifications/common/notificationHub","swx-utils-common"],function(e,t){function h(e,t,n){function l(){var e=r.loginPopup,t=e.redirectUrl+"?origin="+u.location.origin;return e.loginUrl+"?response_type=token"+"&client_id="+o.encodeURIComponent(e.clientId)+"&redirect_uri="+o.encodeURIComponent(t)+"&resource="+o.encodeURIComponent(e.resourceUrl)}function c(e,t){e=e||r.loginPopup.defaultWidth,t=t||r.loginPopup.defaultHeight;var n=o.screenLeft!==undefined?o.screenLeft:screen.left,i=o.screenTop!==undefined?o.screenTop:screen.top,s=o.innerWidth?o.innerWidth:u.documentElement.clientWidth?u.documentElement.clientWidth:screen.width,a=o.innerHeight?o.innerHeight:u.documentElement.clientHeight?u.documentElement.clientHeight:screen.height,f=s/2-e/2+n,l=a/2-t/2+i;return"scrollbars=1,status=0,menubar=0,toolbar=0,resizable=1,width="+e+",height="+t+",left="+f+",top="+l}function h(){var e=o.open(i.url,i.name,i.props);if(!e){e=o.open(i.url,i.name);if(!e)throw new Error("Creating external sign in page has failed")}return e}var i=this,a=null,f=null;i.url=e||l(),i.name=t||"O365_ExternalSignInWindow",i.props=n||c(),i.open=function(e){if(!e)throw new Error('"callback" parameter is required');if(f===null||f.closed||!f.focus)try{f=h()}catch(t){return}else f.focus();d(s.externalSignIn.openSignInWindow),a&&o.clearInterval(a),a=o.setInterval(function(){f.closed&&(e(),o.clearInterval(a),a=null)},100)}}function p(){function p(){return r.initParams&&!!r.initParams.resigninAllowed}var e=this,t=r.splashScreen.signInNotificationEnabled,o=new a(n.notifications.SIGN_IN_REQUEST),u=new h,f=!1;e.isEnabled=function(){return t&&p()},e.isSignInPopupEnabled=function(){return f},e.setSignInPopup=function(e){f=e},e.notify=function(t){function r(e){i.isFunction(t)&&t(),d(e),l.notify(o)}if(!e.isEnabled())return;if(f)try{u.open(function(){r(s.externalSignIn.signInRequestAfterTokenRefresh),c.set(n.storageKeys.AAD_TOKEN_EXPIRED,!0)})}catch(a){}else r(s.externalSignIn.signInRequest)}}function d(e){var t=f.resolve(n.serviceLocator.ACTION_TELEMETRY);t.recordAction(e)}var n=e("swx-constants").COMMON,r=e("experience/settings"),i=e("lodash-compat"),s=e("ui/telemetry/actions/actionNames"),o=e("browser/window"),u=e("browser/document"),a=e("notifications/common/notification"),f=e("swx-service-locator-instance").default,l=e("notifications/common/notificationHub"),c=e("swx-utils-common").sessionStorage;t.build=function(){return new p}}),define("ui/viewModels/experience/splashScreen",["require","vendor/knockout","swx-cafe-application-instance","utils/common/accessibility","swx-service-locator-instance","swx-constants","swx-enums","ui/telemetry/actions/actionNames","text!views/experience/splashScreen.html","experience/api/authentication","experience/authContext","experience/settings","swx-browser-detect","browser/window","browser/document","lodash-compat","swx-i18n","telemetry/chat/splashScreenEvent","utils/common/feedback","utils/common/signInNotificationHandler","utils/common/styleModeHelper","ui/telemetry/telemetryClient"],function(e){function T(){function H(){var t=n.get(),r=!!t.personsAndGroupsManager.mePerson._clientUpdatePolicy,i=t.signInManager.state;r&&i.when(o.loginState.SignedIn,function(){function n(e){return e===s.teamsMigration.REDIRECT_CLIENT||e===s.teamsMigration.UPDATE_CLIENT}t.personsAndGroupsManager.mePerson._clientUpdatePolicy.changed(function(t){e.teamsDeprecation(n(t))})})}function B(t){return st(e.useBusinessWording?j(t):t)}function j(e){return e+"_4b"}function F(){var n=document.createElement("div");n.id="splashScreenElement",n.innerHTML=a,t.applyBindings(e,n),C&&C.appendChild(n)}function I(t){var n=t||"n/a";e.showLoader(!1),e.showSignIn(!1),e.showEducationCarousel(!1),O.publish(),P&&N.publish(x.action.HIDE,n)}function q(t){var n=v.assign({text:m.fetch({key:"splashScreen_text_loading"})},t);if(P){R();return}e.showSignIn(!1),e.showLoader(!0),r.updateAriaLiveHtml(e.loadingText,n.text)}function R(){e.showLoader(!1),e.showSignIn(!1),e.showEducationCarousel(!0)}function U(t,n){function i(){return{isSignInEnabled:e.isSignInEnabled(),isSignInExternalEnabled:e.isSignInExternalEnabled(),isLearnMoreLinkVisible:e.isLearnMoreLinkVisible(),isFeedbackEnabled:e.isFeedbackEnabled(),isSignInPopupEnabled:u.isSignInPopupEnabled,isSignInNotificationEnabled:e.isSignInNotificationEnabled(),hasTitle:t&&!!t.title,hasDescription:!!u.description,state:n||s.telemetry.NOT_AVAILABLE,isSideBarOpened:w.get().appIsVisible()}}var o=l.get().implicitSignIn||l.get().implicitSignOut,u=v.assign({title:o?"":st("splashScreen_signedOut_title"),description:"",showButton:!1,isSignInExternalEnabled:!1,isSignInPopupEnabled:!1,showLearnMore:!1,isFeedbackEnabled:!1},t);e.showEducationCarousel()&&N.publish(x.action.HIDE),e.showLoader(!1),e.showEducationCarousel(!1),e.showSignIn(!0),e.signInTitle(""),e.signInDescription(""),u.title&&r.updateAriaLiveHtml(e.signInTitle,u.title),u.description&&r.updateAriaLiveHtml(e.signInDescription,u.description),e.isSignInEnabled(u.showButton),e.isSignInExternalEnabled(u.isSignInExternalEnabled),e.isLearnMoreLinkVisible(u.showLearnMore),e.isFeedbackEnabled(u.isFeedbackEnabled),M.setSignInPopup(u.isSignInPopupEnabled),e.isSignInNotificationEnabled(M.isEnabled()),E.get().sendEvent(c.telemetry.uiTenantToken,S.TYPE,i())}function z(){U(null,S.STATE.APP_READY),O.startSplashScreenMeasure(e.showSignIn(),e.isLearnMoreLinkVisible());var t=n.get().signInManager.state;t.when(o.loginState.SigningIn,function(){q({text:st("splashScreen_text_signingIn")})}),t.when(o.loginState.SigningOut,$),t.when(o.loginState.SignedOut,J)}function W(){var e=h.getBrowserInfo();return e.isIeEngine||e.isEdge}function X(e){var t={title:st("splashScreen_signInFailed_title"),description:st("splashScreen_signInFailed_description"),isFeedbackEnabled:T.isFeatureOn(s.featureFlags.HAS_FEEDBACK_LINK_ON_ERROR)};if(G(e))return;Y(e)&&(t.title=m.fetch({key:"splashScreen_signInFailed_description_age_restriction"}),t.description="",t.isFeedbackEnabled=!1),L&&(t.description=m.fetch({key:"skypeUnavailable_title"}),t.isFeedbackEnabled=!1),Z(e)&&(t.description=m.fetch({key:"splashScreen_signInFailed_description_exceeded_endpoints"}),t.isFeedbackEnabled=!1),et(e)&&(t.title=m.fetch({key:"splashScreen_signInFailed_title_security_validation"}),t.description="",t.isSignInExternalEnabled=!0,t.isFeedbackEnabled=!1),tt(e)&&(t.description=m.fetch({key:"splashScreen_signInFailed_aad_description"}),t.isFeedbackEnabled=!1,t.isSignInPopupEnabled=!0),nt(e)&&!L&&(t.showButton=T.isFeatureOn(s.featureFlags.SHOW_SIGN_IN_BUTTON_ON_TIMEOUT)),t.showLearnMore=!!c.splashScreen.learnMoreUrl&&!!W(),U(t,S.STATE.SIGN_IN_FAILED)}function V(e,t){L=!1,U(e,t),N.publish(s.apiUIEvents.SWX_ON_SIGN_OUT)}function $(){ot()?V({isSignInExternalEnabled:!0,title:m.fetch({key:"splashScreen_signedOut_reauth_needed_title"}),description:m.fetch({key:"splashScreen_signedOut_reauth_needed_description"})},S.STATE.REAUTH_NEEDED):T.isFeatureOn(s.featureFlags.SHOW_SIGN_IN_BUTTON_ON_SIGNOUT)?V({isSignInExternalEnabled:!0},S.STATE.SIGNING_OUT):V({showButton:!1},S.STATE.SIGNING_OUT)}function J(e,t){if(!t||t!==o.loginState.SignedIn)return;V({title:m.fetch({key:"splashScreen_disconnected_title"}),description:st("splashScreen_disconnected_description")},S.STATE.SIGNED_OUT)}function K(){if(!A){N.subscribe(s.apiUIEvents.SWX_TIMELINE_LOADED,I.bind(null,"timelineLoaded"));return}N.subscribe(s.apiUIEvents.SWX_SINGLE_CONVERSATION,function(n){if(!n){e.showLoader(!1),e.showSignIn(!1),e.showEducationCarousel(!1);return}U({title:st("splashScreen_signInFailed_title"),description:st("splashScreen_signInFailed_description")},S.STATE.SIGN_IN_FAILED)})}function Q(){N.subscribe(s.events.system.EXPERIENCE_READY,z),N.subscribe(s.events.auth.SIGNIN_FAILED,X),K()}function G(e){try{return e.message===s.api.auth.errorTypes.SIGN_IN_CANCELED_ERROR&&JSON.parse(e.details.reason).code===s.api.auth.errorTypes.SIGNED_OUT_ERROR}catch(t){}}function Y(e){var t=new RegExp(s.api.auth.errorTypes.AGE_RESTRICTION_ERROR+"$"),n="error_description";if(e&&e[n])return t.test(e[n])}function Z(e){return e&&e.name===s.api.auth.errorTypes.TOO_MANY_CONNECTIONS_ERROR}function et(e){return e&&e.message===s.silentLogin.errorMessages.INVALID_GRANT}function tt(e){var t;if(e&&e.message===s.api.auth.errorTypes.LOGIN_REQUIRED_ERROR)return!0;try{return t=JSON.parse(e.details.reason),t.code===s.api.auth.errorTypes.OAUTH_FAILED_ERROR&&t.error===s.api.auth.errorTypes.LOGIN_REQUIRED_ERROR}catch(n){}}function nt(e){return e&&e.message===s.api.auth.errorTypes.TIMEOUT}function rt(){var e=c.webLoginClientId,t=c.uiVersion,n=c.appBaseUrl+"/assets/externalSignInHandler.html?origin="+d.location.origin,r="999";return c.webLoginUrl+"?client_id="+p.encodeURIComponent(e)+"&clientVersion="+p.encodeURIComponent(t)+"&redirect_uri="+p.encodeURIComponent(n)+"&partner="+p.encodeURIComponent(r)}function it(e){var t=i.resolve(s.serviceLocator.ACTION_TELEMETRY);t.recordAction(e)}function st(e){return m.fetch({key:A?e+"_wac":e})}function ot(){return n.get().signInManager.getSignOutContext&&n.get().signInManager.getSignOutContext()&&n.get().signInManager.getSignOutContext().reason===s.api.auth.errorTypes.REAUTH_NEEDED}var e=this,T=i.resolve(s.serviceLocator.FEATURE_FLAGS),N=i.resolve(s.serviceLocator.PUBSUB),C,k="swx-container",L=!1,A=T.isFeatureOn(s.featureFlags.SINGLE_CONVERSATION_MODE),O=g.build(),M=b.build(),D=T.isFeatureOn(s.featureFlags.SPLASH_SCREEN_WHITE_THEME),P=T.isFeatureOn(s.featureFlags.SHOW_EDU_CAROUSEL);this.showLoader=t.observable(!1),this.showSignIn=t.observable(!1),this.showEducationCarousel=t.observable(!1),this.teamsDeprecation=t.observable(!1),this.isVisible=t.computed(function(){return e.showLoader()||e.showSignIn()||e.showEducationCarousel()||e.teamsDeprecation()}),this.isSignInEnabled=t.observable(!1),this.isSignInExternalEnabled=t.observable(!1),this.isSignInNotificationEnabled=t.observable(!1),this.isLearnMoreLinkVisible=t.observable(!1),this.isFeedbackEnabled=t.observable(!1),this.useBusinessWording=T.isFeatureOn(s.featureFlags.USE_BUSINESS_WORDING),this.showLogo=!A,this.narratorText=t.observable("").extend({rateLimit:200}),this.loadingText=t.observable(""),this.signInTitle=t.observable(""),this.signInDescription=t.observable(""),this.signInLearnMoreText=m.fetch({key:"splashScreen_learn_more"}),this.learnMoreUrl=c.splashScreen.learnMoreUrl,this.theme=t.computed(function(){return D||e.teamsDeprecation()?s.classes.WHITE_THEME:s.classes.BLUE_THEME}),this.spinnerColor=t.computed(function(){return D?"":s.classes.WHITE_COLOR}),this.signIn=function(e){f.signIn(I.bind(null,"signIn"),X,e),L=!0},this.signInExternal=function(){var t,n,r=rt();it(u.externalSignIn.signIn),t=p.open(r),n=p.setInterval(function(){t.closed&&(e.signIn({isExternalSignIn:!0}),p.clearInterval(n))},100)},this.notifySignIn=function(){M.isSignInPopupEnabled()&&U({title:m.fetch({key:"splashScreen_signInExternal_title"}),description:m.fetch({key:"splashScreen_signInExternal_description"}),isSignInPopupEnabled:!0}),M.notify(q.bind(null,{text:m.fetch({key:"splashScreen_text_signingIn"})}))},this.getSignInButtonText=st.bind(null,"splashScreen_signIn_button"),this.feedbackPageUrl=t.pureComputed(function(){return y.getFeedbackPageUrl()}),this.feedbackPageTarget=function(){return y.getFeedbackPageTarget()},this.init=function(n){if(!n)return;C=n,C.classList.add(k);var r=document.getElementById("splashScreenElement");r&&t.removeNode(r),F(),e.showLoader()||e.showSignIn()||e.showEducationCarousel()||q(),e.showLoader()&&(e.loadingText().indexOf(st("splashScreen_text_signingIn"))>-1?e.narratorText(B("splashScreen_text_signing_into_skype")):e.narratorText(B("splashScreen_text_loading_skype"))),L=!1,N.publish(s.apiUIEvents.SWX_SPLASHSCREEN_LOADED),H()},Q()}var t=e("vendor/knockout"),n=e("swx-cafe-application-instance"),r=e("utils/common/accessibility"),i=e("swx-service-locator-instance").default,s=e("swx-constants").COMMON,o=e("swx-enums"),u=e("ui/telemetry/actions/actionNames"),a=e("text!views/experience/splashScreen.html"),f=e("experience/api/authentication"),l=e("experience/authContext"),c=e("experience/settings"),h=e("swx-browser-detect").default,p=e("browser/window"),d=e("browser/document"),v=e("lodash-compat"),m=e("swx-i18n").localization,g=e("telemetry/chat/splashScreenEvent"),y=e("utils/common/feedback"),b=e("utils/common/signInNotificationHandler"),w=e("utils/common/styleModeHelper"),E=e("ui/telemetry/telemetryClient"),S=s.telemetry.splashScreenSignInEvent,x=s.telemetry.eduCarouselEvents;return T}),define("services/subscriptions/subscriptionProvider",["require","lodash-compat","vendor/knockout","swx-enums","swx-cafe-application-instance"],function(e){function s(){function u(){return s?s:(s=i.get().personsAndGroupsManager.all.persons.get(),s)}function a(){var t=e.persons.observable,n=i.get().personsAndGroupsManager.all;n&&l(t,n)}function f(){var t=e.favorites.observable,n=c(r.groupType.Favorites,"type");n&&l(t,n)}function l(e,t){function n(){var r=t.persons(),i=r.filter(function(e){return e.displayName()?!0:(h(n,e),!1)});e(i)}e.extend({rateLimit:{timeout:50,method:"notifyWhenChangesStop"}}),u(),t.persons().forEach(h.bind(null,n)),t.persons.subscribe(),t.persons.changed(n)}function c(e,n){var r=i.get().personsAndGroupsManager.all.groups(),s=t.find(r,function(t){return t[n]()===e});return s}function h(e,n){function r(){t.contains(o,n)&&(t.remove(o,n),e())}function i(){t.contains(o,n)&&t.remove(o,n)}if(!!n.displayName())return;t.contains(o,n)||(o.push(n),n.displayName.get().then(r,i))}var e={persons:{observable:n.observableArray([]),initialize:t.once(a)},favorites:{observable:n.observableArray([]),initialize:t.once(f)}},s,o=[];this.getPersonsObservable=function(){return e.persons.initialize(),e.persons.observable},this.getFavoritesObservable=function(){return e.favorites.initialize(),e.favorites.observable},this.getContacts=u}var t=e("lodash-compat"),n=e("vendor/knockout"),r=e("swx-enums"),i=e("swx-cafe-application-instance");return s}),define("services/pes/bingSearch/urlPreviewService",["require","lodash-compat","swx-utils-common","reqwest","swx-cafe-application-instance","experience/settings","utils/common/url","swx-constants","utils/common/cancelation","swx-service-locator-instance"],function(e){function l(e,t,n){this.defaultServiceHost=e,this.defaultServceEndpoint=t,this.defaultTokenProvider=n}function c(e,t,n){var i;if(!e||!n)return Promise.resolve();i={url:o.buildUrl(t.serviceHost+t.serviceEndpoint,{url:e}),method:"GET",crossOrigin:!0,dataType:"json",headers:{Authorization:"skype_token "+n}};var s=a.adaptAbortable(r.compat(i));return a.makeCancelable(s,t.cancelationToken)}var t=e("lodash-compat"),n=e("swx-utils-common").builderMixin,r=e("reqwest"),i=e("swx-cafe-application-instance"),s=e("experience/settings"),o=e("utils/common/url"),u=e("swx-constants").COMMON,a=e("utils/common/cancelation"),f=e("swx-service-locator-instance").default;return l.prototype.getPreviewFor=function(n,r){var o=f.resolve(u.serviceLocator.FEATURE_FLAGS),a=o.isFeatureOn(u.featureFlags.NEW_URLP_DOMAIN_ENABLED)?s.urlPServiceHost:s.amdServiceHost;return r=t.defaults({},r,{serviceHost:this.defaultServiceHost,tokenProvider:this.defaultTokenProvider,serviceEndpoint:this.defaultServceEndpoint},{tokenProvider:function(){return i.get().signInManager._skypeToken&&i.get().signInManager._skypeToken()},serviceHost:a,serviceEndpoint:"/v1/url/info"}),r.skypeToken?c(n,r,r.skypeToken):Promise.resolve(r.tokenProvider()).then(c.bind(null,n,r))},t.extend(l,n),l}),define("services/store/pes/storeService",["require","lodash-compat","services/store/pes/catalogItemProcessor","experience/settings","swx-cafe-application-instance","swx-utils-common","services/pes/configSync","reqwest","swx-utils-common","swx-client-info"],function(e){function h(e){var n={dataType:"json",crossOrigin:!0};return e&&t.extend(n,e),n}function p(){return o.get().signInManager._skypeToken()}function d(){}var t=e("lodash-compat"),n=e("services/store/pes/catalogItemProcessor"),r=e("experience/settings"),i=r.pesStoreServices,s=r.entitlementService,o=e("swx-cafe-application-instance"),u=e("swx-utils-common").builderMixin,a=e("services/pes/configSync"),f=e("reqwest"),l=e("swx-utils-common").guid,c=e("swx-client-info"),v=l.create(),m="ui.hidden-expression-tabs";return d.prototype.loadCatalog=function(){var t=h({url:"https://"+i.catalogApiHost+i.catalogServiceEndpoint.replace("${lang}",r.locale.pes),headers:{Accept:"application/json; ver="+i.catalogServiceVersion}});return i.catalogDogfoodContentEnabled&&(t.headers["X-Skype-Config-Namespace"]="showNonDiscoverable"),Promise.resolve(f.compat(t)).then(function(e){var t=e.skus;return n.processSKUs(t),t}).catch(function(){return[]})},d.prototype.getItems=function(t){var r;return t?(r=h({url:t}),Promise.resolve(f.compat(r)).then(function(e){return n.processTabConfig(e),n.loadStyles(e,a.latestToken,a._requiresCDNUrlAuthentication),e}).catch(function(){return null})):Promise.reject("No valid config url Specified")},d.prototype.getItemsForTabs=function(t){var n=this;return Promise.resolve(n.loadCatalog()).then(function(e){return t.forEach(function(t){var r,i;for(r=0;r<e.length;r++){i=e[r];if(i.id===t.id){t.pesConfig=n.getItems(i.items);break}}}),t})},d.prototype.getHiddenTabs=function(){var t;return t=h({url:r.userOptionsService.host+r.userOptionsService.optionsEndpoint.replace("${userId}","self").replace("${optionName}",m)}),Promise.resolve(p()).catch(function(){return null}).then(function(e){return e?(t.headers={"X-Skypetoken":e,Accept:"application/json, text/javascript","X-Skype-Caller":c.getBIAppName(),"X-Microsoft-Skype-Chain-ID":v,"X-Microsoft-Skype-Message-ID":l.create()},f.compat(t)):Promise.reject("Invalid Skype token")}).catch(function(){}).then(function(e){var t=[];return e&&e.optionStr&&(t=JSON.parse(e.optionStr)),t})},d.prototype.postHiddenTabs=function(t){var n;return n=h({url:r.userOptionsService.host+r.userOptionsService.optionsEndpoint.replace("${userId}","self").replace("${optionName}",m),type:"put",data:JSON.stringify({value:t})}),Promise.resolve(p()).catch(function(){return null}).then(function(e){return e?(n.headers={"X-Skypetoken":e,"X-Skype-Caller":c.getBIAppName(),Accept:"application/json, text/javascript","X-Microsoft-Skype-Chain-ID":v,"X-Microsoft-Skype-Message-ID":l.create(),"Content-Type":"application/json; charset=utf-8"},f.compat(n)):Promise.reject("Invalid Skype token")}).catch(function(){}).then(function(){return"success"})},d.prototype.getTabsFromEntitlement=function(){var e=o.get().personsAndGroupsManager.mePerson,t;return t=h({url:s.host+s.listingEndpoint.substring(1).replace("${username}",e.id())}),Promise.resolve(p()).catch(function(){return null}).then(function(e){return e?(t.headers={"X-Skypetoken":e,Accept:"application/json; ver=3.0"},f.compat(t)):Promise.reject("Invalid Skype token")}).catch(function(){}).then(function(e){var t=[];return e&&(t=e.reduce(function(e,t){var n,r;return t.service==="sticker"&&t.attributes&&t.attributes.pack&&(n=t.attributes.pack,r=(new Date(t.start)).getTime(),e.push({id:n,purchaseDateTime:r})),e.sort(function(e,t){return e.purchaseDateTime-t.purchaseDateTime})},t)),t})},d.prototype.downloadPurchasedTabsFromEntitlement=function(){var t=this;return Promise.resolve(t.getTabsFromEntitlement()).then(function(e){return t.getItemsForTabs(e)}).then(function(e){var t=[];return e.forEach(function(e){e.pesConfig&&t.push(e)}),t})},d.prototype.buyTab=function(t){var n,r;return t?(r=t.__metadata.links.apiPurchase,n=h({url:r.hrefFull,type:"post",data:r.data}),Promise.resolve(p()).catch(function(){return null}).then(function(e){return e?(n.headers={"X-Skypetoken":e,Accept:"application/json; ver="+i.catalogPurchaseApiVersion},f.compat(n)):Promise.reject("Invalid Skype token")}).catch(function(){return null}).then(function(e){return e?"success":Promise.reject("error purchasing tab")})):Promise.reject("Not a valid tab")},t.extend(d,u),d}),define("ui/telemetry/identityTelemetry",["require","exports","module","browser/window","swx-enums","swx-cafe-application-instance"],function(e,t){function o(e){e.setCommonProperty("user_id",u,s.Identity),e.setCommonProperty("signed_in",a)}function u(){var e="ANONYMOUS";if(i.get().signInManager.state()===r.loginState.SignedIn)try{e=i.get().personsAndGroupsManager.mePerson.id()}catch(t){}return e}function a(){var e=0;try{e=i.get().signInManager.state()===r.loginState.SignedIn?1:0}catch(t){}return e}var n=e("browser/window"),r=e("swx-enums"),i=e("swx-cafe-application-instance"),s;t.addIdentityToAllEvents=function(e){s=s||n.skypeTelemetryManager.PIIType,o(e)}}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-local-storage/lib/constants",["require","exports"],e)}(function(e,t){var n;(function(e){e.VERSION="1.13",e.PREFIX_KEYWORD="swx";var t;(function(e){e.VERSION="version",e.ENCRYPTION_KEY="encryptionKey",e.KEYS_MAP="keysMap"})(t=e.INTERNAL_KEYS||(e.INTERNAL_KEYS={})),e.DEFAULT_BUFFER_TIMEOUT=300})(n=t.CACHE||(t.CACHE={}));var r;(function(e){e.DEACTIVATE_CACHE="deactivateCache"})(r=t.featureFlags||(t.featureFlags={}))}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-util-encryption/lib/msCryptoAdapter",["require","exports","global-portable","msr-crypto"],e)}(function(e,t){function i(e){return new Promise(function(t,n){e.oncomplete=function(e){t(e.target.result)},e.onerror=n})}var n=e("global-portable");typeof n["default"].window=="undefined"&&(n["default"].window={addEventListener:function(){}}),typeof n["default"].XMLHttpRequest=="undefined"&&(n["default"].XMLHttpRequest=function(){function e(){}return e}());var r=e("msr-crypto");r.aes.subtle.forceSync=!0,t.getRandomValues=r.aes.getRandomValues;var s;(function(e){function t(e,t,n){return i(r.aes.subtle.generateKey(e,t,n))}function n(e,t){return i(r.aes.subtle.exportKey(e,t))}function s(e,t,n,s,o){return i(r.aes.subtle.importKey(e,t,n,s,o))}function o(e,t,n){return i(r.aes.subtle.encrypt(e,t,n))}function u(e,t,n){return i(r.aes.subtle.decrypt(e,t,n))}e.generateKey=t,e.exportKey=n,e.importKey=s,e.encrypt=o,e.decrypt=u})(s=t.subtle||(t.subtle={}))}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-util-encryption/lib/encryption",["require","exports","./msCryptoAdapter","swx-browser-globals"],e)}(function(e,t){function a(e){var t=6e4,n=[],r=[];if(e.length<=t)return Array.apply(null,e);for(var i=0,s=e.length;i<s;i+=t)n.push(e.subarray(i,i+t));return n.forEach(function(e){r=r.concat(Array.apply(null,e))}),r}function f(e){var t=new Uint8Array(e.length);for(var n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function l(e){var t=6e4,n=[],r=new Uint8Array(e),i="";if(r.length<=t)return String.fromCharCode.apply(null,r);for(var s=0,o=r.length;s<o;s+=t)n.push(r.subarray(s,s+t));return n.forEach(function(e){i=i.concat(String.fromCharCode.apply(null,e))}),i}function c(e,t){return{data:l(t),iv:a(e)}}function h(){return u.crypto.subtle.generateKey({name:s,length:256},!0,o)}function p(e){return u.crypto.subtle.exportKey("jwk",e).then(u.exportedKeyProcessor)}function d(e){return u.crypto.subtle.importKey("jwk",u.importedKeyProcessor(e),{name:s},!0,o)}function v(e,t){var n={name:s};try{var r=f(encodeURI(JSON.stringify(t)));return n.iv=u.crypto.getRandomValues(new Uint8Array(16)),u.crypto.subtle.encrypt(n,e,r).then(function(e){return c(n.iv,e)})["catch"](function(){})}catch(i){return Promise.reject(i)}}function m(e,t){if(!t||!t.data||!t.iv)return Promise.reject("Invalid encrypted data");try{var n={name:s,iv:new Uint8Array(t.iv)};return u.crypto.subtle.decrypt(n,e,f(t.data)).then(function(e){var t=l(e);return t?JSON.parse(decodeURI(t)):{}})["catch"](function(){})}catch(r){return Promise.reject(r)}}var n=e("./msCryptoAdapter"),r=e("swx-browser-globals"),i=r.getWindow(),s="Aes-cbc",o=["encrypt","decrypt"],u;i&&i.crypto?i.crypto.webkitSubtle?u={crypto:{getRandomValues:i.crypto.getRandomValues.bind(i.crypto),subtle:i.crypto.webkitSubtle},importedKeyProcessor:f,exportedKeyProcessor:l}:u={crypto:i.crypto,importedKeyProcessor:JSON.parse,exportedKeyProcessor:JSON.stringify}:u={crypto:n,importedKeyProcessor:f,exportedKeyProcessor:l},t.generateEncryptionKey=h,t.exportEncryptionKey=p,t.importEncryptionKey=d,t.encrypt=v,t.decrypt=m}),define("swx-util-encryption",["swx-util-encryption/lib/encryption"],function(e){return e}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-local-storage/lib/keyHasher",["require","exports","./constants","lodash-compat"],e)}(function(e,t){function i(e,t){return t.key===e}function s(e,t){return t.hash===e}function u(e,t){return new o(e,t)}var n=e("./constants"),r=e("lodash-compat"),o=function(){function e(e,t){this.keysMap={cursor:0,map:[]},this.options={},r.merge(this.options,t),this.onHashMapChanged=e}return e.prototype.fillMap=function(e){!e||(this.keysMap=e)},e.prototype.getHashByKey=function(e){if(e===n.CACHE.INTERNAL_KEYS.KEYS_MAP)return e;var t=r.find(this.keysMap.map,i.bind(null,e));if(t&&t.hash)return t.hash;var s="key-"+this.keysMap.cursor;return this.options.debug&&(s+="-"+e),this.keysMap.cursor++,this.keysMap.map.push({key:e,hash:s}),this.onHashMapChanged(n.CACHE.INTERNAL_KEYS.KEYS_MAP,this.keysMap),s},e.prototype.getKeyByHash=function(e){var t=r.find(this.keysMap.map,s.bind(null,e));return t&&t.key?t.key:e},e.prototype.removeKeyFromMap=function(e){var t=r.remove(this.keysMap.map,i.bind(null,e));t.length&&this.onHashMapChanged(n.CACHE.INTERNAL_KEYS.KEYS_MAP,this.keysMap)},e}();t.build=u}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-local-storage/lib/base-driver",["require","exports","./constants"],e)}(function(e,t){var n=e("./constants");t.STORAGE_PREFIX_REGEX=new RegExp("^"+n.CACHE.PREFIX_KEYWORD+"\\|");var r=n.CACHE.PREFIX_KEYWORD+"|",i=function(){function e(){}return e.prototype.genKey=function(e){return r+e},e}();t.BaseDriver=i});var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};(function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-local-storage/lib/local-storage-driver",["require","exports","swx-browser-globals","./constants","./base-driver"],e)})(function(e,t){var n=e("swx-browser-globals"),r=e("./constants"),i=e("./base-driver"),s=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getItemFromStorage=function(e){var t=this;return new Promise(function(r){return r(n.getWindow().localStorage.getItem(t.genKey(e)))})},t.prototype.getAllKeys=function(){return this.getAllKeysRaw().then(function(e){return e.map(function(e){return e.replace(i.STORAGE_PREFIX_REGEX,"")})})},t.prototype.removeItemFromStorage=function(e){var t=this;return new Promise(function(r){var i=t.genKey(e);n.getWindow().localStorage[i]&&n.getWindow().localStorage.removeItem(i),r()})},t.prototype.invalidateCache=function(e){var t=this;return e===void 0&&(e=!1),this.getAllKeysRaw().then(function(i){var s=i.length;for(var o=0;o<s;o++){var u=i[o];(e||u!==t.genKey(r.CACHE.INTERNAL_KEYS.VERSION))&&n.getWindow().localStorage.removeItem(u)}})},t.prototype.setItemInStorage=function(e,t){var r=this;return new Promise(function(i){var s=r.genKey(e);n.getWindow().localStorage.setItem(s,t),i()})},t.prototype.getAllKeysRaw=function(){return new Promise(function(e){return e(Object.keys(n.getWindow().localStorage).filter(function(e){return i.STORAGE_PREFIX_REGEX.test(e)}))})},t}(i.BaseDriver);t.LocalStorageDriver=s}),function(e){if(typeof module=="object"&&typeof module.exports=="object"){var t=e(require,exports);t!==undefined&&(module.exports=t)}else typeof define=="function"&&define.amd&&define("swx-local-storage/lib/provider",["require","exports","./constants","swx-util-encryption","./keyHasher","./local-storage-driver","swx-browser-globals","lodash-compat","swx-utils-common"],e)}(function(e,t){function h(e){return new c(e)}var n=e("./constants"),r=e("swx-util-encryption"),i=e("./keyHasher"),s=e("./local-storage-driver"),o=e("swx-browser-globals"),u=e("lodash-compat"),a=e("swx-utils-common"),f="[CacheProvider]",l=n.CACHE,c=function(){function e(e){var t=this;this.options=e,this.chainingPromise=a.settablePromise.build(),this.debugSettings={log:!1,showKeys:!1,plainData:!1},this.setSensitiveItemBuffer={},this.internalCache={},this.VERSION=l.VERSION,this.resolveChainingPromise=function(){t.chainingPromise.resolve()},this._onVersionReceived=function(e){var n=t.printDebug.bind(t,"[_onVersionReceived]"),r=function(){return t.storageDriver.setItemInStorage(l.INTERNAL_KEYS.VERSION,t.VERSION)};return u.forEach(t.debugSettings,function(e,n){if(n==="log")return;e&&(t.VERSION+="|"+n)}),e!==t.VERSION?(e?n("Version changed from "+e+" to "+t.VERSION):n("Version not found"),t.storageDriver.invalidateCache(!0).then(r)):Promise.resolve()},this._initializeEncryption=function(e){var n=t.printDebug.bind(t,"[_initializeEncryption]");if(t.isDeactivated())return n("Cache is deactivated -> initialization completed"),Promise.resolve();var i=function(t){return t?(n("Getting key from KES",t),e.decrypt(t).then(s,o)):o()},s=function(e){return r.importEncryptionKey(e.response).then(function(e){t.encryptionKey=e,n("Key decrypted -> initialization completed")},c)},o=function(){return n("Starting with fresh cache"),t.storageDriver.invalidateCache(!1).then(u)},u=function(){return r.generateEncryptionKey().then(a,c)},a=function(n){return t.encryptionKey=n,r.exportEncryptionKey(n).then(function(t){return e.encrypt(t).then(f)})},f=function(e){return n("New key generated -> initialization completed"),t.storageDriver.setItemInStorage(l.INTERNAL_KEYS.ENCRYPTION_KEY,e.response)},c=function(){throw n("Encryption key manipulation failed"),new Error("Encryption key manipulation failed")};return t.storageDriver.getItemFromStorage(l.INTERNAL_KEYS.ENCRYPTION_KEY).then(i)},this._prepareKeysMap=function(){return t.getSensitiveItem(l.INTERNAL_KEYS.KEYS_MAP).then(function(e){t.keyHasher.fillMap(e)})},this.setItem=function(e,n){var r=t.printDebug.bind(t,"[SetItem: "+e+"]");return t.chainingPromise.then(function(){t.internalCache[e]=n;if(t.isDeactivated())return r("Cache deactivated, resolving"),Promise.resolve();var i=t.keyHasher.getHashByKey(e);return t.storageDriver.setItemInStorage(i,JSON.stringify(n)).then(function(){return r("stored")},function(e){return r("storage failed",e)})})},this._deactivateCache=function(e){t.printDebug("[_deactivateCache]",e),t.isCacheDeactivated=!0},this._encrypt=function(e){return t.debugSettings.plainData?Promise.resolve(JSON.stringify(e)):r.encrypt(t.encryptionKey,e).then(function(e){return JSON.stringify(e)})},this._decrypt=function(e){return t.debugSettings.plainData?Promise.resolve(JSON.parse(e)):r.decrypt(t.encryptionKey,JSON.parse(e))},this._getAllSwxKeys=function(e,n){return t.storageDriver.getAllKeys().then(function(r){var i=u(r).map(function(e){return t.keyHasher.getKeyByHash(e)});return n||(i=i.without(l.INTERNAL_KEYS.VERSION)),e&&(i=i.filter(function(t){return e.test(t)})),i.value()})},this.isCacheDeactivated=e.serviceLocator.featureFlagApi.isFeatureOn(n.featureFlags.DEACTIVATE_CACHE),u.merge(this.debugSettings,e.debugSettings)}return e.prototype.init=function(e){var t=this;return this.initializePromise?this.initializePromise:this.isCacheDeactivated?(this.initializePromise=this.chainingPromise,this.resolveChainingPromise(),this.initializePromise):(this.storageDriver=new s.LocalStorageDriver,this.keyHasher=i.build(function(e,n){return t.setSensitiveItem(e,n)},this.debugSettings.showKeys),this.initializePromise=this.storageDriver.getItemFromStorage(l.INTERNAL_KEYS.VERSION).then(this._onVersionReceived).then(function(){return t._initializeEncryption(e)}).then(this._prepareKeysMap)["catch"](this._deactivateCache).then(this.resolveChainingPromise,this.resolveChainingPromise),this.initializePromise)},e.prototype.isDeactivated=function(){return this.isCacheDeactivated},e.prototype.destroy=function(e){e===void 0&&(e=!1);var t=Promise.resolve();return!this.isDeactivated()&&e&&this.initializePromise&&(t=this.storageDriver.invalidateCache(!1)),this.initializePromise=null,this.setSensitiveItemBuffer={},this.internalCache={},t},e.prototype.getAllKeys=function(e){var t=this;return this.isDeactivated()?Promise.resolve([]):this.chainingPromise.then(function(){return t._getAllSwxKeys(e)})},e.prototype.setSensitiveItem=function(e,t,r){var i=this,s=this.setSensitiveItemBuffer[e]||{},u=this.printDebug.bind(this,"[SetSensitiveItem: "+e+"]");isNaN(r)&&(r=n.CACHE.DEFAULT_BUFFER_TIMEOUT);var a=function(){var t=function(t){var n=i.keyHasher.getHashByKey(e);i.storageDriver.setItemInStorage(n,t).then(function(){u("encrypted"),s.resolvePromise(),delete i.setSensitiveItemBuffer[e]},s.rejectPromise)};u("encrypting",i.internalCache[e]),i._encrypt(i.internalCache[e]).then(t,function(e){u("Encryption failed"),s.rejectPromise(e)})},f=function(){u("Starting new writing operation with delay of "+r+"ms"),s.promise=new Promise(function(e,t){s.resolvePromise=e,s.rejectPromise=t,r?s.timeout=o.getWindow().setTimeout(function(){return i.chainingPromise.then(a)},r):(s.timeout=0,i.chainingPromise.then(a))}),i.setSensitiveItemBuffer[e]=s},l=function(){u("Resetting writing operation timeout"),o.getWindow().clearTimeout(s.timeout),s.timeout=o.getWindow().setTimeout(function(){return i.chainingPromise.then(a)},r)};return this.internalCache[e]=t,this.isDeactivated()?this.chainingPromise.then(function(){u("Cache deactivated, resolving")}):(s.promise?l():f(),s.promise)},e.prototype.getSensitiveItem=function(e){var t=this,n=this.printDebug.bind(this,"[GetSensitiveItem: "+e+"]"),r=e===l.INTERNAL_KEYS.KEYS_MAP?Promise.resolve():this.chainingPromise;return r.then(function(){n("Getting");if(t.isDeactivated())return n("Cache deactivated, returning internal value",t.internalCache[e]),t.internalCache[e]||null;if(typeof t.internalCache[e]!="undefined")return n("Retrieved value already before, returning it",t.internalCache[e]),t.internalCache[e];var r=t.keyHasher.getHashByKey(e);return t.storageDriver.getItemFromStorage(r).then(function(r){return r?t._decrypt(r).then(function(r){return t.internalCache[e]=r,n("Decrypted",r),r},function(e){throw n("Decryption failed",e),e}):(n("No data found in storage"),null)})})},e.prototype.getSensitiveItems=function(e){var t=this;return this.getAllKeys(e).then(function(e){return Promise.all(e.map(function(e){return t.getSensitiveItem(e)}))})},e.prototype.getItem=function(e){var t=this,n=this.printDebug.bind(this,"[GetItem: "+e+"]");return this.chainingPromise.then(function(){n("Getting");if(t.isDeactivated())return n("Cache deactivated, returning internal value",t.internalCache[e]),t.internalCache[e]||null;if(typeof t.internalCache[e]!="undefined")return n("Retrieved value already before, returning it",t.internalCache[e]),t.internalCache[e];var r=t.keyHasher.getHashByKey(e);return t.storageDriver.getItemFromStorage(r).then(function(r){return r?(n("Found",r),t.internalCache[e]=JSON.parse(r),t.internalCache[e]):(n("No data found in storage"),null)})})},e.prototype.removeItem=function(e){var t=this,n=this.printDebug.bind(this,"[RemoveItem: "+e+"]");return this.chainingPromise.then(function(){return delete t.internalCache[e],t.isDeactivated()?(n("Removed"),Promise.resolve()):t.storageDriver.removeItemFromStorage(t.keyHasher.getHashByKey(e)).then(function(){t.keyHasher.removeKeyFromMap(e),typeof t.setSensitiveItemBuffer[e]!="undefined"&&(n("Item is removed prior encryption timeout finished. Cancelling encryption."),o.getWindow().clearTimeout(t.setSensitiveItemBuffer[e].timeout),t.setSensitiveItemBuffer[e].rejectPromise(),delete t.setSensitiveItemBuffer[e]),n("Removed")})})},e.prototype.printDebug=function(e,t,n){if(!this.debugSettings.log)return;n},e}();t.build=h}),define("swx-local-storage",["swx-local-storage/lib/provider"],function(e){return e}),define("experience/serviceLocatorInitializer",["require","exports","module","swx-service-locator","swx-constants","experience/featureFlags/api","services/controls/controlsBuilder","services/navigation/navigationContext","ui/modelObservers/modelObserver","services/pes/mruService","services/pes/bingSearch/bingSearchService","utils/common/cache/instance","swx-giphy-service","services/pes/config","swx-pubsub-instance","swx-service-locator-instance","ui/viewModels/experience/splashScreen","services/subscriptions/subscriptionProvider","swx-utils-people","services/pes/bingSearch/urlPreviewService","ui/telemetry/actions/actionTelemetryApi","services/store/pes/storeService","ui/telemetry/telemetryClient","ui/telemetry/identityTelemetry","swx-local-storage","browser/window"],function(e,t){function C(e){return n.serviceLocatorBuilder().withServiceInstance(e,{name:N.SETTINGS}).withService({name:N.PUBSUB,build:function(){return p}}).withService({name:N.FEATURE_FLAGS,build:function(){return new i(e)}}).buildSync(d)}function k(e,t){var r,i=E.get(),s=!0;t&&t.initParams&&t.initParams.disableTelemetry===!0&&(s=!1),i.enabled(s),S.addIdentityToAllEvents(i),r=x.build({serviceLocator:e}),n.serviceLocatorBuilder().withServiceInstance(i,{name:N.TELEMETRY_MANAGER}).withServiceInstance(r,{name:N.LOCAL_STORAGE}).buildSync(d),l.set(r)}function L(e){return n.serviceLocatorBuilder().withService({name:N.CONTROLS_BUILDER,build:function(){return new s}}).withService({name:N.NAVIGATION_CONTEXT,build:function(){return new o}}).withService({name:N.MODEL_UI_OBSERVER,build:function(){return u.build()}}).withService({name:N.SUBSCRIPTION_PROVIDER,build:function(){return new m}}).withService({name:N.ACTION_TELEMETRY,build:function(){return b.build()}}).withService({name:N.PROGRESSIVE_TIMEOUT,build:function(){return new g(T)}}).withService({name:N.PES_BING_SEARCH_SERVICE,build:function(){return f.build()}}).withService({name:N.PES_GIPHY_SEARCH_SERVICE,build:function(){return c.build(e.pesSearchServices.giphy)}}).withService({name:N.URL_PREVIEW_SERVICE,build:function(){return y.build()}}).buildSync(d),n.serviceLocatorBuilder().withService({name:N.PES_MRU_SERVICE,build:function(){return a.build()}}).withService({name:N.PES_CONFIG_SERVICE,build:function(){return h.build()}}).withService({name:N.PES_STORE_SERVICE,build:function(){return w.build()}}).buildSync(d),n.serviceLocatorBuilder().withService({name:N.SPLASH_SCREEN,build:function(){return new v}}).buildSync(d),d}var n=e("swx-service-locator"),r=e("swx-constants").COMMON,i=e("experience/featureFlags/api"),s=e("services/controls/controlsBuilder"),o=e("services/navigation/navigationContext"),u=e("ui/modelObservers/modelObserver"),a=e("services/pes/mruService"),f=e("services/pes/bingSearch/bingSearchService"),l=e("utils/common/cache/instance"),c=e("swx-giphy-service"),h=e("services/pes/config"),p=e("swx-pubsub-instance").default,d=e("swx-service-locator-instance").default,v=e("ui/viewModels/experience/splashScreen"),m=e("services/subscriptions/subscriptionProvider"),g=e("swx-utils-people").progressiveTimeout.default,y=e("services/pes/bingSearch/urlPreviewService"),b=e("ui/telemetry/actions/actionTelemetryApi"),w=e("services/store/pes/storeService"),E=e("ui/telemetry/telemetryClient"),S=e("ui/telemetry/identityTelemetry"),x=e("swx-local-storage"),T=e("browser/window"),N=r.serviceLocator;t._registerAll=function(e){return C(e),k(d,e),L(e)},t.registerDependencies=L,t.registerSharedServices=k,t.registerCoreServices=C}),define("utils/common/applicationReactivationManager",["require","exports","module","swx-cafe-application-instance","swx-constants","browser/document","browser/window","browser/dom"],function(e,t){function f(){n.get().suspended(!1),u=null}function l(){return n.get().suspended()}function c(){s.addEventListener(r.events.browser.FOCUS,p),s.addEventListener(r.events.browser.BLUR,d),i.addEventListener(r.events.browser.VISIBILITYCHANGE,p)}function h(){s.removeEventListener(r.events.browser.FOCUS,p),s.removeEventListener(r.events.browser.BLUR,d),i.removeEventListener(r.events.browser.VISIBILITYCHANGE,p)}function p(){!o.isDocumentHidden()&&l()?u||(u=s.setTimeout(f,a)):d()}function d(){u&&(s.clearTimeout(u),u=null)}var n=e("swx-cafe-application-instance"),r=e("swx-constants").COMMON,i=e("browser/document"),s=e("browser/window"),o=e("browser/dom"),u,a=3e3;t.init=function(){n.get().suspended.when(!0,c),n.get().suspended.when(!1,h)}}),define("utils/common/activityReportManager",["require","exports","module","swx-cafe-application-instance","swx-constants","browser/document","browser/window","browser/dom"],function(e,t){function l(){n.get().personsAndGroupsManager.mePerson.active(!0),u=null}function c(){n.get().personsAndGroupsManager.mePerson.active(!1),a=null}function h(){return n.get().personsAndGroupsManager.mePerson.active()}function p(){s.addEventListener(r.events.browser.FOCUS,v),s.addEventListener(r.events.browser.BLUR,m),i.addEventListener(r.events.browser.VISIBILITYCHANGE,v)}function d(){s.removeEventListener(r.events.browser.FOCUS,v),s.removeEventListener(r.events.browser.BLUR,m),i.removeEventListener(r.events.browser.VISIBILITYCHANGE,v)}function v(){!o.isDocumentHidden()&&!h()?u||(u=s.setTimeout(l,f)):m()}function m(){u&&(s.clearTimeout(u),u=null)}function g(){s.addEventListener(r.events.browser.FOCUS,E),s.addEventListener(r.events.browser.BLUR,w),i.addEventListener(r.events.browser.VISIBILITYCHANGE,b)}function y(){s.removeEventListener(r.events.browser.FOCUS,E),s.removeEventListener(r.events.browser.BLUR,w),i.removeEventListener(r.events.browser.VISIBILITYCHANGE,b)}function b(){o.isDocumentHidden()&&h()?a||(a=s.setTimeout(c,f)):E()}function w(){h()&&(a||(a=s.setTimeout(c,f)))}function E(){a&&(s.clearTimeout(a),a=null)}function S(){p(),y()}function x(){d(),g()}var n=e("swx-cafe-application-instance"),r=e("swx-constants").COMMON,i=e("browser/document"),s=e("browser/window"),o=e("browser/dom"),u,a,f=3e3;t.init=function(){var e=n.get().personsAndGroupsManager.mePerson.active;o.isDocumentHidden()&&e(!1),e.when(!0,x),e.when(!1,S)}}),define("telemetry/errors/runtimeErrorsHandler",["require","exports","module","browser/window","vendor/knockout","swx-constants","experience/settings","swx-service-locator-instance","ui/telemetry/telemetryClient"],function(e,t){function a(e){f(e)&&h(e)}function f(e){var t=e.stack||e.error&&e.error.stack;return(l(e.filename)||l(t))&&!c(e.message)}function l(e){return e&&e.indexOf(s.packageUrl)>=0}function c(e){return e&&e.indexOf(t.DEFAULT_SCRIPT_ERROR_MESSAGE)>=0}function h(e){var t=i.telemetry.runtimeErrors.TYPE,n={message:e.message==null?i.NOT_AVAILABLE:e.message,fileName:e.filename||i.NOT_AVAILABLE,lineNumber:e.lineno||e.error&&e.error.lineNumber||i.NOT_AVAILABLE,columnNumber:e.colno||e.error&&e.error.columnNumber||i.NOT_AVAILABLE,stack:e.stack||e.error&&e.error.stack||i.NOT_AVAILABLE};u.get().sendEvent(s.telemetry.uiTenantToken,t,n)}var n=e("browser/window"),r=e("vendor/knockout"),i=e("swx-constants").COMMON,s=e("experience/settings"),o=e("swx-service-locator-instance").default,u=e("ui/telemetry/telemetryClient");t.DEFAULT_SCRIPT_ERROR_MESSAGE="Script error",t.init=function(){var e=o.resolve(i.serviceLocator.FEATURE_FLAGS);e.isFeatureOn(i.featureFlags.TELEMETRY_RUNTIME_ERRORS_ENABLED)&&(n.addEventListener("error",a),r.onError=a)}}),define("experience/welcomeExperience",["require","exports","module","experience/settings","browser/window","swx-cafe-application-instance","swx-i18n"],function(e,t){function o(){function e(e,t){return Math.floor(Math.random()*(t-e+1))+e}i.get().personsAndGroupsManager.mePerson.id.get().then(function(t){var o=n.welcomeExperience.whitelist.some(function(e){var n=new RegExp(e);return n.test(t)});o&&r.setTimeout(function(){i.get().replayMessage(s.fetch({key:"welcome_im_display_name"}),s.fetch({key:"welcome_im_first_message"}),s.fetch({key:"welcome_im_reply_message"}),s.fetch({key:"welcome_im_toast_message"}))},e(n.welcomeExperience.minDelayBeforeFirstMessage,n.welcomeExperience.maxDelayBeforeFirstMessage))})}var n=e("experience/settings"),r=e("browser/window"),i=e("swx-cafe-application-instance"),s=e("swx-i18n").localization;t.init=function(){n.welcomeExperience.enabled&&i.get().replayMessage.enabled.once(!0,o)}}),define("experience/experience",["require","exports","module","swx-polyfill-initializer","lodash-compat","usertiming","swx-browser-detect","browser/window","swx-constants","swx-enums","swx-cafe-application-instance","jCafe","experience/api/builder","experience/componentsLoader","experience/settings","services/telemetry/common/telemetry","services/telemetry/experience.instrumentation","experience/koBindingsRegistrar","notifications/init","swx-util-calling-stack","services/calling/autoCalling","services/g11n/init","services/i18n/init","services/pes/configSync","swx-service-locator-instance","experience/serviceLocatorInitializer","utils/common/appVisibilityProvider","utils/common/applicationFocusManager","utils/common/applicationReactivationManager","utils/common/activityReportManager","utils/common/elementQueryHelper","swx-utils-common","swx-utils-common","utils/common/prefetcher","swx-utils-common","telemetry/usage/inAppActivityTracker","telemetry/errors/runtimeErrorsHandler","ui/modalDialog/welcomeDialog","utils/common/styleModeHelper","experience/welcomeExperience","ui/viewModels/chat/messageParsers/swift/utils"],function(e,t){function q(){var e=h.platformId,t=R(),n=h.biAppName;h.uiVersion=e+"/"+t+"//"+n,h.displayAppVersion&&!B.get().isIntegratedProperty()&&(document.title="Skype "+t)}function R(){try{var e=h.version.split(".");return e.length<4?e[0]+"."+e[1]+".0."+e[2]:h.version}catch(t){return"0.0.0.0"}}function U(e,t){var n=S.resolve(o.serviceLocator.PUBSUB);n.publish(o.events.system.EXPERIENCE_INITIALIZED,{configLoadDuration:e.configLoadDuration,packageLoadDuration:e.packageLoadDuration,experienceInitializeDuration:t.duration()}),r.mark(I.EXPERIENCE.TTL_START)}function z(){var e=n.pick(S,o.serviceLocator.SETTINGS,o.serviceLocator.TELEMETRY_MANAGER,o.serviceLocator.LOCAL_STORAGE),t=f.Application.create(e);a.set(t)}function W(){var e={};return e.coreServices=x.registerCoreServices(h),e.sharedServices=x.registerSharedServices(S,h),e.initApplication=z(),e.overrideSettings=G(),e.registeredServices=x.registerDependencies(h),e.runtimeErrorsHandler=P.init(),e.instrumentTelemetryEvents=Q(),e.loadCss=rt(),e.initCallingStack=J(),e.initAutoCalling=K(),e.prefetcher=M.prefetchAssets(),e.appVisibilityProvider=T.init(),e.inAppActivityTracker=D.init(a.get().signInManager),e.appReactivationManager=C.init(),e.activityReportManager=k.init(),e.elementQueryHelper=L.initialiseSelectors(),e.notifications=m.init(),e.welcomeDialog=H.init(),e.subscribeVisibilityProvider=ut(),e.initTranslatorService=Y(),e.initUserPreferences=Z(),e.initWelcomeExperience=j.init(),F.setSupportedSwiftCardTypes(),e}function X(e){n.merge(h,e.config),n.merge(h.initParams,e.initParams),["locale","variant"].forEach(function(e){h.initParams[e]=h.initParams[e].toLowerCase()}),h.sessionId=A.create(),V(),$()}function V(){function n(){h.featureFlags.calling=!1,h.featureFlags.PSTN=!1,h.supportsAudio=!1,h.supportsVideo=!1}var e=i.getBrowserInfo(),t=i.getSystemInfo();e.isShellApp&&(h.mode=undefined,h.featureFlags.showSplashScreen=!1,h.isPollingEnabled=!1),!h.featureFlags.pluginlessPSTNCalling&&e.browserName===i.BROWSERS.EDGE&&e.browserMajorVersion>13&&(h.featureFlags.PSTN=!1),e.browserName===i.BROWSERS.EDGE&&e.browserMajorVersion>13&&(h.featureFlags.outgoingScreenSharing=!1),!h.featureFlags.pluginlessPSTNCalling&&t.osName===i.OPERATING_SYSTEMS.LINUX&&(h.featureFlags.PSTN=!1),t.osName===i.OPERATING_SYSTEMS.LINUX&&(h.featureFlags.outgoingScreenSharing=!1),t.osName===i.OPERATING_SYSTEMS.MACOSX&&e.browserName===i.BROWSERS.CHROME&&(h.featureFlags.copySelectionAsQuoteKeyboard=!1),e.browserName===i.BROWSERS.MSIE&&h.featureFlags.disableCallingOnIE&&n(),e.browserName===i.BROWSERS.EDGE&&h.featureFlags.disableCallingOnEdge&&n(),e.browserName===i.BROWSERS.CHROME&&h.featureFlags.disableCallingOnChrome&&n(),e.browserName===i.BROWSERS.FIREFOX&&h.featureFlags.disableCallingOnFirefox&&n(),e.browserName===i.BROWSERS.SAFARI&&h.featureFlags.disableCallingOnSafari&&n()}function $(){function e(e){return e<10?"0"+e:e}var t=(new Date).getTimezoneOffset();h.utcOffset=t<0?"-":"+",t*=t<0?-1:1,h.utcOffset+=e(Math.floor(t/60)),h.utcOffset+=":",h.utcOffset+=e(t%60)}function J(){g.init(h)}function K(){y.init()}function Q(){p.instrumentAllEvents(d)}function G(){var e=i.getBrowserInfo(),t=S.resolve(o.serviceLocator.FEATURE_FLAGS);if(t.isFeatureOn(o.featureFlags.URL_OVERRIDE_ENABLED)){var n=e.getUrlParams();n.locale&&(h.initParams.locale=n.locale.toLowerCase()),n.variant&&(h.initParams.variant=n.variant.toLowerCase())}}function Y(){var e=a.get().translatorService;return e?(new Promise(function(e){a.get().signInManager.state.once(u.loginState.SignedIn,e)})).then(function(){return e.supportedLanguages.get()}):Promise.resolve()}function Z(){var e=S.resolve(o.serviceLocator.FEATURE_FLAGS);return e.isFeatureOn(o.featureFlags.INIT_PREFERENCES_AFTER_SIGNIN)?tt():et()}function et(){var e,t;return e=new Promise(function(e){function t(){n.unsubscribe(o.apiUIEvents.SWX_TIMELINE_LOADED,t),nt(),e()}var n=S.resolve(o.serviceLocator.PUBSUB);n.subscribe(o.apiUIEvents.SWX_TIMELINE_LOADED,t)}),t=new Promise(function(e){a.get().signInManager.state.once(u.loginState.SignedIn,e)}),Promise.all([e,t]).then(function(){var e=a.get().personsAndGroupsManager.mePerson.preferences(),t=n.map(e,function(e){return e.value.get.enabled()?e.value.get():Promise.resolve()});return Promise.all(t).then(function(){m.update()})})}function tt(){return(new Promise(function(e){a.get().signInManager.state.once(u.loginState.SignedIn,e)})).then(function(){function e(){i.unsubscribe(o.apiUIEvents.SWX_TIMELINE_LOADED,e),nt()}var t=a.get().personsAndGroupsManager.mePerson.preferences(),r=n.map(t,function(e){return e.value.get.enabled()?e.value.get():Promise.resolve()}),i=S.resolve(o.serviceLocator.PUBSUB);return i.subscribe(o.apiUIEvents.SWX_TIMELINE_LOADED,e),Promise.all(r).then(function(){m.update()})})}function nt(){var e=S.resolve(o.serviceLocator.FEATURE_FLAGS);(e.isFeatureOn(o.featureFlags.YOUTUBE_PLAYER_ENABLED)||e.isFeatureOn(o.featureFlags.URL_PREVIEW_LOAD_YOUTUBE_PLAYER))&&O.loadScript(h.youtubeApiUrl)}function rt(){var e=h.assetsBaseUrl,t=h.appBaseUrl;O.loadStyle(e+"/css/common.css"),O.loadStyle(t+"/css/swx.css")}function it(){var e=i.getBrowserInfo(),t=S.resolve(o.serviceLocator.FEATURE_FLAGS);return t.isFeatureOn(o.featureFlags.FAIL_INITIALIZATION_FOR_IE_AND_EDGE)&&(e.isEdge||e.isIeEngine)}function st(){ot(),a.get()._standbyMode&&a.get()._standbyMode(!1)}function ot(){N.focusTrackingEnabled=!0}function ut(){var e=S.resolve(o.serviceLocator.PUBSUB);e.subscribe(o.apiUIEvents.SWX_TIMELINE_LOADED,st)}e("swx-polyfill-initializer");var n=e("lodash-compat"),r=e("usertiming"),i=e("swx-browser-detect").default,s=e("browser/window"),o=e("swx-constants").COMMON,u=e("swx-enums"),a=e("swx-cafe-application-instance"),f=e("jCafe"),l=e("experience/api/builder"),c=e("experience/componentsLoader"),h=e("experience/settings"),p=e("services/telemetry/common/telemetry"),d=e("services/telemetry/experience.instrumentation"),v=e("experience/koBindingsRegistrar"),m=e("notifications/init"),g=e("swx-util-calling-stack"),y=e("services/calling/autoCalling"),b=e("services/g11n/init"),w=e("services/i18n/init"),E=e("services/pes/configSync"),S=e("swx-service-locator-instance").default,x=e("experience/serviceLocatorInitializer"),T=e("utils/common/appVisibilityProvider"),N=e("utils/common/applicationFocusManager"),C=e("utils/common/applicationReactivationManager"),k=e("utils/common/activityReportManager"),L=e("utils/common/elementQueryHelper"),A=e("swx-utils-common").guid,O=e("swx-utils-common").loader,M=e("utils/common/prefetcher"),_=e("swx-utils-common").stopwatch,D=e("telemetry/usage/inAppActivityTracker"),P=e("telemetry/errors/runtimeErrorsHandler"),H=e("ui/modalDialog/welcomeDialog"),B=e("utils/common/styleModeHelper"),j=e("experience/welcomeExperience"),F=e("ui/viewModels/chat/messageParsers/swift/utils"),I=o.telemetry.performanceMarks;s._perfRefForUserTimingPolyfill=s.performance,t.init=function(t,n,r){function f(){U(t,i)}function p(){n(l.get())}function d(){var e="https://s7.addthis.com/js/300/addthis_widget.js#provider=skype",t=document.createElement("script");t.src=e,document.body.appendChild(t)}function m(){var e=S.resolve(o.serviceLocator.PUBSUB),t=S.resolve(o.serviceLocator.FEATURE_FLAGS);e.publish(o.events.system.EXPERIENCE_READY),a.get().signInManager.state.once(u.loginState.SignedIn,function(){E.init(),t.isFeatureOn(o.featureFlags.HIGH_PRIORITY_SCRIPT_ENABLED)&&d()})}var i=_.build(),s;return X(t),q(),s=W(),it()?(r("Failing initialize for IE and Edge enabled"),s.everything=Promise.reject(),s):(s.i18nInit=Promise.all([b.init(h),w.init(h,document.documentElement)]),s.componentsLoaderInit=s.i18nInit.then(function(){return Promise.all([c.init()])}),s.componentsReady=s.componentsLoaderInit.then(f),s.apiReady=s.componentsReady.then(p),s.experienceReady=s.apiReady.then(m),s.everything=s.experienceReady.catch(function(e){return r(e),Promise.reject(e)}),v.registerBindings(),s)}}),define("experience/entryPoints/fullExperience",["require","experience/experience","browser/window"],function(e){function r(e){n.Skype&&n.Skype.onExperienceLoaded&&n.Skype.onExperienceLoaded(e)}var t=e("experience/experience"),n=e("browser/window");r({init:function(e,n,r){t.init(e,n,r)}})}),define("fullExperience",function(){}),require(["experience/entryPoints/fullExperience"])})()